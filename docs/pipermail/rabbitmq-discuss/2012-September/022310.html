<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Odd delay in federation exchanges being	recognized
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Odd%20delay%20in%20federation%20exchanges%20being%0A%09recognized&In-Reply-To=%3C504873B5.3020409%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022289.html">
   <LINK REL="Next"  HREF="022329.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Odd delay in federation exchanges being	recognized</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Odd%20delay%20in%20federation%20exchanges%20being%0A%09recognized&In-Reply-To=%3C504873B5.3020409%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Odd delay in federation exchanges being	recognized">simon at rabbitmq.com
       </A><BR>
    <I>Thu Sep  6 10:58:13 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022289.html">[rabbitmq-discuss] Odd delay in federation exchanges being	recognized
</A></li>
        <LI>Next message: <A HREF="022329.html">[rabbitmq-discuss] Odd delay in federation exchanges being	recognized
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22310">[ date ]</a>
              <a href="thread.html#22310">[ thread ]</a>
              <a href="subject.html#22310">[ subject ]</a>
              <a href="author.html#22310">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That... certainly sounds very odd.

So the &quot;unknown exchange type&quot; message is what you get when you declare 
an exchange using a plugin, and then remove that plugin.

So could the exchange type be getting registered slowly somehow? Hard to 
believe, the registration happens during startup, and RabbitMQ shouldn't 
be able to get to the point where it's accepting connections without all 
exchange types being registered.

I'll have a look at that code in case anything jumps out, but it's 
pretty simple so don't hold your breath...

Cheers, Simon

On 05/09/2012 7:27PM, Matt Pietrek wrote:
&gt;<i> Let me admit up front that this is a weird one, but I'll press ahead on
</I>&gt;<i> the chance there's something there.
</I>&gt;<i>
</I>&gt;<i> I've got two brokers I'm using the federation plugin with. I create a
</I>&gt;<i> single exchange 'skytap' on each broker, and make the 'skytap' exchange
</I>&gt;<i> on the other broker its upstream.
</I>&gt;<i>
</I>&gt;<i> I create the rabbitmq.config file dynamically before starting each
</I>&gt;<i> broker. Starting from a blank slate (blowing away the mnesia directory),
</I>&gt;<i> I launch the two nodes concurrently.
</I>&gt;<i>
</I>&gt;<i> When I go to the Exchange tab in either broker, I see two Exchanges as
</I>&gt;<i> expected:
</I>&gt;<i>
</I>&gt;<i>   * federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2.skytap.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2.skytap.com</A>&gt; B
</I>&gt;<i>   * skytap
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The type of the exchanges is x-federation-upstream and x-federation,
</I>&gt;<i> respectively. However, when first starting up, the type column is a red
</I>&gt;<i> color indicating a problem, and hovering over it, I get a message to the
</I>&gt;<i> effect of &quot;unknown exchange type x-federation. Messages published to
</I>&gt;<i> this exchange won't work.&quot;
</I>&gt;<i>
</I>&gt;<i> Now, here's the interesting thing: I*f I wait long enough (usually
</I>&gt;<i> around 10-15 minutes) **and without doing anything, the error state
</I>&gt;<i> eventually goes away* and the Exchanges seem happy. This has happened at
</I>&gt;<i> least three times, so it doesn't seem like a random fluke or that I
</I>&gt;<i> accidentally did something.
</I>&gt;<i>
</I>&gt;<i> Here's my config file, FWIW...
</I>&gt;<i>
</I>&gt;<i> [
</I>&gt;<i> {rabbit, [{cluster_nodes, [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>]}, {disk_free_limit, 104857600}]},
</I>&gt;<i> {mnesia, [{debug, trace}]},
</I>&gt;<i> {rabbitmq_federation, [{exchanges, [[{type, &quot;topic&quot;}, {upstream_set,
</I>&gt;<i> &quot;skytap_upstreams&quot;}, {virtual_host, &quot;/&quot;}, {exchange, &quot;skytap&quot;}]]},
</I>&gt;<i> {upstream_sets, [{&quot;skytap_upstreams&quot;, [[{connection, &quot;upstream-mq2&quot;},
</I>&gt;<i> {max_hops, 1}, {exchange, &quot;skytap&quot;}]]}]},
</I>&gt;<i> {connections, [{&quot;upstream-mq2&quot;, [{host, &quot;mq2&quot;}, {port, 5672}]}]}]}
</I>&gt;<i> ].
</I>&gt;<i>
</I>&gt;<i> Again, I realize this sounds a bit wonky, but it's happened enough times
</I>&gt;<i> to make me not think I'm crazy.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Matt
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022289.html">[rabbitmq-discuss] Odd delay in federation exchanges being	recognized
</A></li>
	<LI>Next message: <A HREF="022329.html">[rabbitmq-discuss] Odd delay in federation exchanges being	recognized
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22310">[ date ]</a>
              <a href="thread.html#22310">[ thread ]</a>
              <a href="subject.html#22310">[ subject ]</a>
              <a href="author.html#22310">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
