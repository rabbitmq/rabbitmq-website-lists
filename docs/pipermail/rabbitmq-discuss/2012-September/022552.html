<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustered nodes failure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustered%20nodes%20failure&In-Reply-To=%3CCAGJqB46QPN5tP5JxAVuXwTXVtXG%2BvXsBahEqKi2DLLmMjER4Ew%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022547.html">
   <LINK REL="Next"  HREF="022551.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustered nodes failure</H1>
    <B>Ian Cross</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustered%20nodes%20failure&In-Reply-To=%3CCAGJqB46QPN5tP5JxAVuXwTXVtXG%2BvXsBahEqKi2DLLmMjER4Ew%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Clustered nodes failure">ian.cross at gmail.com
       </A><BR>
    <I>Wed Sep 19 19:47:36 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022547.html">[rabbitmq-discuss] Clustered nodes failure
</A></li>
        <LI>Next message: <A HREF="022551.html">[rabbitmq-discuss] Strange start error issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22552">[ date ]</a>
              <a href="thread.html#22552">[ thread ]</a>
              <a href="subject.html#22552">[ subject ]</a>
              <a href="author.html#22552">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon,

Thanks for that - we'll upgrade this cluster to 2.8.6 as you suggest and
let you know how we get on.

Ian.

On Wed, Sep 19, 2012 at 1:08 PM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hi Ian.
</I>&gt;<i>
</I>&gt;<i> We've fixed quite a lot of bugs in mirrored queues since 2.7.1. So I would
</I>&gt;<i> have to suggest an upgrade to 2.8.6 first of all.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> On 19/09/12 12:45, Ian wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I wonder if anyone can help diagnose problems we've been having with our
</I>&gt;&gt;<i> 2-node clustered rabbit which sporadically seizes up completely. None of
</I>&gt;&gt;<i> the applications can get through to Rabbit though it is still up and
</I>&gt;&gt;<i> running. CPU and RAM spike up to 100%. The Management UI cannot be
</I>&gt;&gt;<i> reached and we end up having to restart the nodes to get service back.
</I>&gt;&gt;<i> Sometimes it does not come back gracefully requiring reboot.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Some stats:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     * Both nodes are 4 Core 8GB RAM CentOS 6.2 virtual machines, running
</I>&gt;&gt;<i>       on VMWare ESXi 4.1 host. We are running RabbitMQ version 2.7.1 on
</I>&gt;&gt;<i>       Erlang R14B04.
</I>&gt;&gt;<i>     * Looking at our metrics right now I see around:
</I>&gt;&gt;<i>           o 1000 queues
</I>&gt;&gt;<i>           o 4000 channels
</I>&gt;&gt;<i>           o 8000 bindings
</I>&gt;&gt;<i>           o 16 exchanges
</I>&gt;&gt;<i>     * Memory usage, erlang processes, file descriptors, socket
</I>&gt;&gt;<i>       descriptors are generally low and healthy
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Analysing errors in the rabbit logs from a recent failure reveals:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     * Before the failure we have a bunch of background errors which may
</I>&gt;&gt;<i>       be the fault of our applications like &quot;no binding X between
</I>&gt;&gt;<i>       exchange Y in vhost '/' and queue Z in vhost '/'&quot;
</I>&gt;&gt;<i>     * As we ramp up to the failure we see
</I>&gt;&gt;<i>           o Two errors like this:
</I>&gt;&gt;<i>                 + &#8220;** Generic server &lt;0.16813.1677&gt; terminating ** Last
</I>&gt;&gt;<i>                   message in was {'$gen_cast',
</I>&gt;&gt;<i>                   {run_backing_queue,rabbit_**mirror_queue_master,
</I>&gt;&gt;<i>                   #Fun&lt;rabbit_mirror_queue_**master.4.85178772&gt;}} ** When
</I>&gt;&gt;<i>                   Server state == {lim,0,undefined,false,[],0} ** Reason
</I>&gt;&gt;<i>                   for termination == ** {function_clause,
</I>&gt;&gt;<i>                   [{rabbit_limiter,handle_cast,
</I>&gt;&gt;<i>                   [{run_backing_queue,rabbit_**mirror_queue_master,
</I>&gt;&gt;<i>                   #Fun&lt;rabbit_mirror_queue_**master.4.85178772&gt;},
</I>&gt;&gt;<i>                   {lim,0,undefined,false,[],0}]}**,
</I>&gt;&gt;<i>                   {gen_server2,handle_msg,2},
</I>&gt;&gt;<i>                   {proc_lib,init_p_do_apply,3}]} &#8220;
</I>&gt;&gt;<i>           o A handful like this:
</I>&gt;&gt;<i>                 + &#8220;connection &lt;0.14270.7735&gt;, channel 38 - error:
</I>&gt;&gt;<i>                   {amqp_error,command_invalid,&quot;**second 'channel.open'
</I>&gt;&gt;<i>                   seen&quot;,'channel.open'} &#8220;
</I>&gt;&gt;<i>           o A couple of these:
</I>&gt;&gt;<i>                 + &#8220;connection &lt;0.158.6322&gt;, channel 135 - error:
</I>&gt;&gt;<i>                   {amqp_error,not_found, &quot;no queue
</I>&gt;&gt;<i>                   'InRunning.WebClient.**SessionId[**
</I>&gt;&gt;<i> l0mpn3egx5n0yj0lbs1hcehj]'
</I>&gt;&gt;<i>                   in vhost '/'&quot;, 'basic.get'} &#8220;
</I>&gt;&gt;<i>           o And then all these:
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.14270.7735&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:59106 {inet_error,enotconn}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.14577.1677&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:53163 {inet_error,enotconn}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.1520.5487&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:53435 {timeout,running}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.158.6322&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:63187
</I>&gt;&gt;<i>                   {writer,send_failed,{error,**enotconn}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.17097.1918&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:55161
</I>&gt;&gt;<i>                   {writer,send_failed,{error,**enotconn}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.18340.7733&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:52868 {inet_error,enotconn}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.24514.6782&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:64362 {timeout,blocking}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.24518.6782&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:61252 {timeout,blocking}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.24524.6782&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:55845 {timeout,blocking}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.24528.6782&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:53434 {timeout,blocking}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.24532.6782&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:54398 {timeout,blocking}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.24536.6782&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:58878 {timeout,blocking}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.24552.6782&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:63155 {timeout,blocking}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.2577.2793&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:52752
</I>&gt;&gt;<i>                   {writer,send_failed,{error,**enotconn}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.26105.2580&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:50364
</I>&gt;&gt;<i>                   {writer,send_failed,{error,**enotconn}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.27505.6740&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:56170
</I>&gt;&gt;<i>                   {writer,send_failed,{error,**enotconn}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.27741.2921&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:54600
</I>&gt;&gt;<i>                   {writer,send_failed,{error,**enotconn}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.28602.6323&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:56863
</I>&gt;&gt;<i>                   {writer,send_failed,{error,**enotconn}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.30059.3135&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:57078 {writer,send_failed,{error,**
</I>&gt;&gt;<i> closed}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.5634.2393&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:53807
</I>&gt;&gt;<i>                   {writer,send_failed,{error,**enotconn}}
</I>&gt;&gt;<i>                 + exception on TCP connection &lt;0.6691.6783&gt; from
</I>&gt;&gt;<i>                   WWW.XXX.YYY.ZZZ:64363 {timeout,blocking}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can anyone help?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ian
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ______________________________**_________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/cc135e8b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/cc135e8b/attachment.htm</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022547.html">[rabbitmq-discuss] Clustered nodes failure
</A></li>
	<LI>Next message: <A HREF="022551.html">[rabbitmq-discuss] Strange start error issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22552">[ date ]</a>
              <a href="thread.html#22552">[ thread ]</a>
              <a href="subject.html#22552">[ subject ]</a>
              <a href="author.html#22552">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
