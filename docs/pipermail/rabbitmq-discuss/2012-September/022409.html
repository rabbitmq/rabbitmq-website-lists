<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publisher confirms performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20confirms%20performance&In-Reply-To=%3C504E7974.7070908%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022408.html">
   <LINK REL="Next"  HREF="022429.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publisher confirms performance</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20confirms%20performance&In-Reply-To=%3C504E7974.7070908%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Publisher confirms performance">matthias at rabbitmq.com
       </A><BR>
    <I>Tue Sep 11 00:36:20 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022408.html">[rabbitmq-discuss] Publisher confirms performance
</A></li>
        <LI>Next message: <A HREF="022429.html">[rabbitmq-discuss] Publisher confirms performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22409">[ date ]</a>
              <a href="thread.html#22409">[ thread ]</a>
              <a href="subject.html#22409">[ subject ]</a>
              <a href="author.html#22409">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Allen,

On 10/09/12 22:06, Allen Riddle wrote:
&gt;<i> I am curious what people are seeing in their production deployments
</I>&gt;<i> of RabbitMQ using publisher confirms in a cluster of nodes with
</I>&gt;<i> durable queues.
</I>
Do you see the same results when running your tests against a single
node instead of a cluster? I suspect so, but would be good to get
confirmation of that.

Also, I am assuming you are running a recent (2.8.x) version of rabbit, 
right?

&gt;<i> With local benchmarks against a cluster with 2 nodes, I'm
</I>&gt;<i> synchronously publishing messages and confirming each, and it takes
</I>&gt;<i> roughly 46 ms on average per message.
</I>
You are asking RabbitMQ to confirm that the message has been written to
disk. That requires an fsync. Which is very, very expensive.

You can amortise that cost by: a) dealing with confirms asynchronously,
rather than waiting for a confirmation after every publish, and b)
publishing on multiple connections/channels, as long as that is
compatible with the message ordering guarantees your app requires.

&gt;<i> When I take away the publisher confirms piece, it falls down to 8 ms,
</I>
Be careful what you are measuring here. If you don't wait for confirms 
then publishing is an entirely asynchronous operation, so if you are 
simply timing the duration of the 'publish' API call then you may just 
be timing how long it takes for the client API to stuff the message into 
a local buffer.

Anyway, taking away confirms means that the client won't have to wait 
for a round trip to the server, and the fsync delay there.

&gt;<i> and when I remove durable queues, there is a net zero difference.
</I>
Not sure what you mean here. Zero difference compared to what? Making 
the queues non-durable eliminates the need to wait for an fsync. There's 
still the roundtrip latency though.

Regards,

Matthias.
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022408.html">[rabbitmq-discuss] Publisher confirms performance
</A></li>
	<LI>Next message: <A HREF="022429.html">[rabbitmq-discuss] Publisher confirms performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22409">[ date ]</a>
              <a href="thread.html#22409">[ thread ]</a>
              <a href="subject.html#22409">[ subject ]</a>
              <a href="author.html#22409">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
