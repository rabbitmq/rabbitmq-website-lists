<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster nodes stop/start order can lead to failures
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20nodes%20stop/start%20order%20can%20lead%20to%0A%20failures&In-Reply-To=%3C50519947.5060906%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022443.html">
   <LINK REL="Next"  HREF="022462.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster nodes stop/start order can lead to failures</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20nodes%20stop/start%20order%20can%20lead%20to%0A%20failures&In-Reply-To=%3C50519947.5060906%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Cluster nodes stop/start order can lead to failures">simon at rabbitmq.com
       </A><BR>
    <I>Thu Sep 13 09:28:55 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022443.html">[rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures
</A></li>
        <LI>Next message: <A HREF="022462.html">[rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22448">[ date ]</a>
              <a href="thread.html#22448">[ thread ]</a>
              <a href="subject.html#22448">[ subject ]</a>
              <a href="author.html#22448">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/09/2012 9:43PM, Matt Long wrote:
&gt;<i> Say I have node1 and node2 both running as disc nodes in a cluster
</I>&gt;<i> (there are no other nodes in the cluster). If I stop rabbitmq-server on
</I>&gt;<i> node1 and then stop rabbitmq-server on node2, I'm unable to then start
</I>&gt;<i> rabbitmq-server again on node1...in particular, the start command hangs
</I>&gt;<i> for ~35 seconds before showing FAILED...
</I>
That's correct - it's waiting 30s for node2 to become available.

&gt;<i> Is this the expected behavior?
</I>
Yes. The point is that node2 could have been running for a long time 
while node1 was down; all sorts of things could have happened. node1 
doesn't know. If node1 were to start and then allow node2 to join later, 
we could end up in a situation where the nodes have diverged and need to 
be merged manually... not good.

&gt;<i> Note that starting node2 after having
</I>&gt;<i> stopped node1 and then node2 works fine; I'm assuming because node2 was
</I>&gt;<i> aware that node1 had went offline prior to its stopping.
</I>
Yes.

So the answer is either to start all the nodes in the reverse order to 
how they were stopped, or start them all simultaneously (so that the 30s 
wait period is enough).

Cheers, Simon
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022443.html">[rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures
</A></li>
	<LI>Next message: <A HREF="022462.html">[rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22448">[ date ]</a>
              <a href="thread.html#22448">[ thread ]</a>
              <a href="subject.html#22448">[ subject ]</a>
              <a href="author.html#22448">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
