<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20.Net%20RabbitMQ.Client%20Issue%3A%20Deadlock%20on%0A%09ConnectionShutdown&In-Reply-To=%3CCAAzMECn9108i4E3AqNxr1kr9omicnYs-VvRUjGUDimdfk6qegw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022603.html">
   <LINK REL="Next"  HREF="022604.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown</H1>
    <B>Derek Greer</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20.Net%20RabbitMQ.Client%20Issue%3A%20Deadlock%20on%0A%09ConnectionShutdown&In-Reply-To=%3CCAAzMECn9108i4E3AqNxr1kr9omicnYs-VvRUjGUDimdfk6qegw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown">dbgreer at gmail.com
       </A><BR>
    <I>Fri Sep 21 15:24:44 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022603.html">[rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown
</A></li>
        <LI>Next message: <A HREF="022604.html">[rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on ConnectionShutdown
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22605">[ date ]</a>
              <a href="thread.html#22605">[ thread ]</a>
              <a href="subject.html#22605">[ subject ]</a>
              <a href="author.html#22605">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Since this thread was recently referenced
here&lt;<A HREF="http://markmail.org/search/Re:+%5Brabbitmq-discuss%5D+IModel+Dispose+locks+if+called+during+ConnectionShutdown+event#query:Re%3A%20%5Brabbitmq-discuss%5D%20IModel%20Dispose%20locks%20if%20called%20during%20ConnectionShutdown%20event+page:1+mid:rnnrrzk7bcknavtw+state:results">http://markmail.org/search/Re:+%5Brabbitmq-discuss%5D+IModel+Dispose+locks+if+called+during+ConnectionShutdown+event#query:Re%3A%20%5Brabbitmq-discuss%5D%20IModel%20Dispose%20locks%20if%20called%20during%20ConnectionShutdown%20event+page:1+mid:rnnrrzk7bcknavtw+state:results</A>&gt;,
 I
thought I'd follow up on this issue.

First, shortly after encountering this issue, I obtained a new HP laptop at
work which did not exhibit the blocking behavior upon calling
IModel.Close(), but rather threw an IOException as observed and mentioned
by Emile earlier in this thread.  The other machine which displays the
error is a Dell laptop, though I'm not sure what the difference is that
would account for the change in behavior.  Either way, the behavior is
undesired.



On Fri, Sep 21, 2012 at 8:59 AM, Derek Greer &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dbgreer at gmail.com</A>&gt; wrote:

&gt;<i> I just realized I sent this response directly to Emile instead of back to
</I>&gt;<i> the list, so copying the list now.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ---------- Forwarded message ----------
</I>&gt;<i> From: Derek Greer &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dbgreer at gmail.com</A>&gt;
</I>&gt;<i> Date: Tue, Aug 21, 2012 at 11:21 AM
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
</I>&gt;<i> ConnectionShutdown
</I>&gt;<i> To: Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for the example.  I'll take a look at how its being done there.
</I>&gt;<i>
</I>&gt;<i> Concerning subscriptions, I'm referring to a logical subscription not any
</I>&gt;<i> particular component of the rabbitmq API.  I have a Subscription class that
</I>&gt;<i> represents a logical subscription which contains a Renew(IConnection
</I>&gt;<i> connection) method which stops the current thread and restarts it with the
</I>&gt;<i> newly available connection.  I'm wanting to loop through all my
</I>&gt;<i> Subscription instances and call Renew() after I have a new connection.
</I>&gt;<i>  Part of the Renew() logic is to stop the current thread, and part of the
</I>&gt;<i> normal course of stopping is to attempt to close the channel/model.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Aug 21, 2012 at 11:13 AM, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi Derek,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 21/08/12 16:38, Derek Greer wrote:
</I>&gt;&gt;<i> &gt; I'm trying to deal with connection shutdown logic as an atomic
</I>&gt;&gt;<i> &gt; operation.  Here's the scenario I'm trying to implement:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I hesitate to mention it, because this library has been deprecated but
</I>&gt;&gt;<i> not yet completely removed:
</I>&gt;&gt;<i> <A HREF="http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/">http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In it you will find an example of how one might go about reconnecting to
</I>&gt;&gt;<i> a broker. Be warned that this code will be removed soon and is not
</I>&gt;&gt;<i> guaranteed to work with recent versions of the broker.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;       o refresh each subscription with the new connection
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is not possible to maintain the previous subscription to the broker
</I>&gt;&gt;<i> and somehow inject a new channel and/or connection into it. You will
</I>&gt;&gt;<i> need to re-establish all contained channels and all associated
</I>&gt;&gt;<i> subscriptions when the connection shuts down.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; aside, don't you agree that ConnectionShutdown should be the event you
</I>&gt;&gt;<i> &gt; should subscribe to when you want to know about connection shutdowns?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; As far as the blocking, I'm perplexed as to why we wouldn't be seeing
</I>&gt;&gt;<i> &gt; the same results.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When I run your Consumer.exe  standalone I also get the same exception
</I>&gt;&gt;<i> as before.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Emile
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> ___________________________________________
</I>&gt;<i> Derek Greer
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dbgreer at gmail.com</A>     | @derekgreer &lt;<A HREF="http://twitter.com/derekgreer">http://twitter.com/derekgreer</A>&gt;
</I>&gt;<i> lostechies.com &lt;<A HREF="http://derekgreer.lostechies.com/">http://derekgreer.lostechies.com/</A>&gt; | freshbrewedcode.com&lt;<A HREF="http://derekgreer.freshbrewedcode.com">http://derekgreer.freshbrewedcode.com</A>&gt;
</I>&gt;<i>  | aspiringcraftsman.com
</I>&gt;<i> ___________________________________________
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> ___________________________________________
</I>&gt;<i> Derek Greer
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dbgreer at gmail.com</A>     | @derekgreer &lt;<A HREF="http://twitter.com/derekgreer">http://twitter.com/derekgreer</A>&gt;
</I>&gt;<i> lostechies.com &lt;<A HREF="http://derekgreer.lostechies.com/">http://derekgreer.lostechies.com/</A>&gt; | freshbrewedcode.com&lt;<A HREF="http://derekgreer.freshbrewedcode.com">http://derekgreer.freshbrewedcode.com</A>&gt;
</I>&gt;<i>  | aspiringcraftsman.com
</I>&gt;<i> ___________________________________________
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
___________________________________________
Derek Greer
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dbgreer at gmail.com</A>     | @derekgreer &lt;<A HREF="http://twitter.com/derekgreer">http://twitter.com/derekgreer</A>&gt;
lostechies.com &lt;<A HREF="http://derekgreer.lostechies.com/">http://derekgreer.lostechies.com/</A>&gt; |
freshbrewedcode.com&lt;<A HREF="http://derekgreer.freshbrewedcode.com">http://derekgreer.freshbrewedcode.com</A>&gt;
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/66e62407/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/66e62407/attachment.htm</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022603.html">[rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown
</A></li>
	<LI>Next message: <A HREF="022604.html">[rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on ConnectionShutdown
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22605">[ date ]</a>
              <a href="thread.html#22605">[ thread ]</a>
              <a href="subject.html#22605">[ subject ]</a>
              <a href="author.html#22605">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
