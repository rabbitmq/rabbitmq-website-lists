<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20very%20slow%20%28or%20never%29%20shuts%20down&In-Reply-To=%3CCACLE7iz-D4xkRy7JuP4F5g0NFtsTWW5htJ%2BfyuboVXTspKJA0Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022482.html">
   <LINK REL="Next"  HREF="022541.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ very slow (or never) shuts down</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20very%20slow%20%28or%20never%29%20shuts%20down&In-Reply-To=%3CCACLE7iz-D4xkRy7JuP4F5g0NFtsTWW5htJ%2BfyuboVXTspKJA0Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ very slow (or never) shuts down">mpietrek at skytap.com
       </A><BR>
    <I>Thu Sep 13 21:05:45 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022482.html">[rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
</A></li>
        <LI>Next message: <A HREF="022541.html">[rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22483">[ date ]</a>
              <a href="thread.html#22483">[ thread ]</a>
              <a href="subject.html#22483">[ subject ]</a>
              <a href="author.html#22483">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here you to Tim:

The scrubbed <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1.log</A>:
--------
=INFO REPORT==== 13-Sep-2012::12:00:21 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:00:21 ===
    application: rabbitmq_federation
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:00:21 ===
Stopping Rabbit

=INFO REPORT==== 13-Sep-2012::12:00:21 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=WARNING REPORT==== 13-Sep-2012::12:00:21 ===
Connection (&lt;0.1659.0&gt;) closing: internal error in channel (&lt;0.1666.0&gt;):
shutdown

=INFO REPORT==== 13-Sep-2012::12:00:21 ===
stopped TCP Listener on 0.0.0.0:5672

=ERROR REPORT==== 13-Sep-2012::12:17:00 ===
** Generic server &lt;0.1676.0&gt; terminating
** Last message in was {inet_async,#Port&lt;0.5748&gt;,5106,{error,etimedout}}
** When Server state == {state,#Port&lt;0.5748&gt;,&lt;0.1671.0&gt;,&lt;0.1673.0&gt;,
                               {method,rabbit_framing_amqp_0_9_1},
                               none}
** Reason for termination ==
** {socket_error,etimedout}

=ERROR REPORT==== 13-Sep-2012::12:17:00 ===
** Generic server &lt;0.1671.0&gt; terminating
** Last message in was {socket_error,etimedout}
** When Server state == {state,amqp_network_connection,
                            {state,#Port&lt;0.5748&gt;,0,&lt;0.1675.0&gt;,131072,
                                undefined,false},
                            &lt;0.1670.0&gt;,&lt;0.1673.0&gt;,
                            {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
                                &lt;&lt;&quot;/&quot;&gt;&gt;,&quot;slg1matt1.xyz.com&quot;,
                                5672,0,0,0,infinity,none,
                                [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                 #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                                [],[]},
                            0,
                            [{&lt;&lt;&quot;capabilities&quot;&gt;&gt;,table,
                              [{&lt;&lt;&quot;publisher_confirms&quot;&gt;&gt;,bool,true},
                               {&lt;&lt;&quot;exchange_exchange_bindings&quot;&gt;&gt;,bool,true},
                               {&lt;&lt;&quot;basic.nack&quot;&gt;&gt;,bool,true},
                               {&lt;&lt;&quot;consumer_cancel_notify&quot;&gt;&gt;,bool,true}]},
                             {&lt;&lt;&quot;copyright&quot;&gt;&gt;,longstr,
                              &lt;&lt;&quot;Copyright (C) 2007-2012 VMware, Inc.&quot;&gt;&gt;},
                             {&lt;&lt;&quot;information&quot;&gt;&gt;,longstr,
                              &lt;&lt;&quot;Licensed under the MPL.  See
<A HREF="http://www.rabbitmq.com/&quot;">http://www.rabbitmq.com/&quot;</A>&gt;&gt;},
                             {&lt;&lt;&quot;platform&quot;&gt;&gt;,longstr,&lt;&lt;&quot;Erlang/OTP&quot;&gt;&gt;},
                             {&lt;&lt;&quot;product&quot;&gt;&gt;,longstr,&lt;&lt;&quot;RabbitMQ&quot;&gt;&gt;},
                             {&lt;&lt;&quot;version&quot;&gt;&gt;,longstr,&lt;&lt;&quot;2.8.6&quot;&gt;&gt;}],
                            #Fun&lt;amqp_connection_sup.0.39273983&gt;,
                            #Fun&lt;amqp_connection_sup.2.54430129&gt;,false}
** Reason for termination ==
** {socket_error,etimedout}

=ERROR REPORT==== 13-Sep-2012::12:17:00 ===
** Generic server &lt;0.1657.0&gt; terminating
** Last message in was {'EXIT',&lt;0.197.0&gt;,shutdown}
** When Server state == {state,
                         {upstream,
                          {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
                           &lt;&lt;&quot;/&quot;&gt;&gt;,&quot;slg1matt1.xyz.com&quot;,5672,0,
                           0,0,infinity,none,
                           [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                            #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                           [],[]},

&lt;&lt;&quot;skytap&quot;&gt;&gt;,1000,1,1,none,none,none,&quot;upstream-slg&quot;},
                         &lt;0.1671.0&gt;,&lt;0.1683.0&gt;,
                         &lt;&lt;&quot;federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1.matt.xyz.com</A>
&quot;&gt;&gt;,
                         &lt;&lt;&quot;federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1.matt.xyz.comA</A>&quot;&gt;&gt;,
                         {0,nil},
                         115,
                         {dict,10,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],
                            [[{&lt;&lt;&quot;charon.us-east.default&quot;&gt;&gt;,[]}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]],
                            [],
                            [[{&lt;&lt;&quot;cmcmd.us-east.default&quot;&gt;&gt;,[]}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}],
                             [{&lt;&lt;&quot;charon.us-west.default&quot;&gt;&gt;,[]}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;charon&quot;&gt;&gt;}],
                                 [],[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]],
                            [],
                            [[{&lt;&lt;&quot;cmcmd.us-west.default&quot;&gt;&gt;,[]}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;cmcmd&quot;&gt;&gt;}],
                                 [],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]],
                            [],
                            [[{&lt;&lt;&quot;system_test.us-east.default&quot;&gt;&gt;,[]}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]],
                            [],
                            [[{&lt;&lt;&quot;system_test.us-west.default&quot;&gt;&gt;,[]}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],

[{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;system_test&quot;&gt;&gt;}],
                                 [],[],[],[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]],
                            [],[],
                            [[{&lt;&lt;&quot;unit_test.us-east.default&quot;&gt;&gt;,[]}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]],
                            [[{&lt;&lt;&quot;ConfigurationManager.us-east.default&quot;&gt;&gt;,
                               []}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]],
                            [[{&lt;&lt;&quot;unit_test.us-west.default&quot;&gt;&gt;,[]}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;unit_test&quot;&gt;&gt;}],
                                 [],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]],
                            [[{&lt;&lt;&quot;ConfigurationManager.us-west.default&quot;&gt;&gt;,
                               []}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,
                                   &lt;&lt;&quot;ConfigurationManager&quot;&gt;&gt;}],
                                 [],[],[],[],
                                 [{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,
                                   &lt;&lt;&quot;federation: skytap -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slg1matt1.xyz.com</A> A&quot;&gt;&gt;}],
                                 [],[],[]}}}]]}}},
                         &lt;0.1659.0&gt;,&lt;0.1666.0&gt;,
                         {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;skytap&quot;&gt;&gt;},
                         {0,nil}}
** Reason for termination ==
** {undef,
       [{rabbit_federation_old_status,report,
            [{upstream,
                 {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                     &quot;slg1matt1.xyz.com&quot;,5672,0,0,0,infinity,
                     none,
                     [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                      #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                     [],[]},
                 &lt;&lt;&quot;skytap&quot;&gt;&gt;,1000,1,1,none,none,none,&quot;upstream-slg&quot;},
             {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;skytap&quot;&gt;&gt;},
             shutdown],
            []},
        {rabbit_federation_link,terminate,2,[]},
        {gen_server2,terminate,3,[]},
        {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]}
** In 'terminate' callback with reason ==
** shutdown

=INFO REPORT==== 13-Sep-2012::12:17:00 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:17:00 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:17:00 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:17:00 ===
Halting Erlang VM
--------

And the scrubbed <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1-sasl.log</A>:

--------
=SUPERVISOR REPORT==== 13-Sep-2012::12:00:21 ===
     Supervisor: {&lt;0.1664.0&gt;,amqp_channel_sup}
     Context:    child_terminated
     Reason:     shutdown
     Offender:   [{pid,&lt;0.1666.0&gt;},
                  {name,channel},
                  {mfa,{amqp_channel,start_link,
                                     [direct,&lt;0.1659.0&gt;,1,&lt;0.1665.0&gt;,
                                      #Fun&lt;amqp_channel_sup.0.24953263&gt;]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Sep-2012::12:00:21 ===
     Supervisor: {&lt;0.1664.0&gt;,amqp_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,&lt;0.1666.0&gt;},
                  {name,channel},
                  {mfa,{amqp_channel,start_link,
                                     [direct,&lt;0.1659.0&gt;,1,&lt;0.1665.0&gt;,
                                      #Fun&lt;amqp_channel_sup.0.24953263&gt;]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 13-Sep-2012::12:17:00 ===
  crasher:
    initial call: amqp_main_reader:init/1
    pid: &lt;0.1676.0&gt;
    registered_name: []
    exception exit: {socket_error,etimedout}
      in function  gen_server:terminate/6 (gen_server.erl, line 747)
    ancestors: [&lt;0.1674.0&gt;,&lt;0.1670.0&gt;,amqp_sup,&lt;0.240.0&gt;]
    messages: []
    links: [&lt;0.1674.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 2529
  neighbours:

=CRASH REPORT==== 13-Sep-2012::12:17:00 ===
  crasher:
    initial call: amqp_gen_connection:init/1
    pid: &lt;0.1671.0&gt;
    registered_name: []
    exception exit: {socket_error,etimedout}
      in function  gen_server:terminate/6 (gen_server.erl, line 747)
    ancestors: [&lt;0.1670.0&gt;,amqp_sup,&lt;0.240.0&gt;]
    messages: []
    links: [&lt;0.1670.0&gt;,#Port&lt;0.5748&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 805
  neighbours:

=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {&lt;0.1670.0&gt;,amqp_connection_sup}
     Context:    child_terminated
     Reason:     {socket_error,etimedout}
     Offender:   [{pid,&lt;0.1671.0&gt;},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
                               &lt;&lt;&quot;/&quot;&gt;&gt;,&quot;slg1matt1.xyz.com&quot;,
                               5672,0,0,0,infinity,none,
                               [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                               [],[]},
                           #Fun&lt;amqp_connection_sup.0.39273983&gt;,
                           #Fun&lt;amqp_connection_sup.2.54430129&gt;,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {&lt;0.1670.0&gt;,amqp_connection_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,&lt;0.1671.0&gt;},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
                               &lt;&lt;&quot;/&quot;&gt;&gt;,&quot;slg1matt1.xyz.com&quot;,
                               5672,0,0,0,infinity,none,
                               [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                               [],[]},
                           #Fun&lt;amqp_connection_sup.0.39273983&gt;,
                           #Fun&lt;amqp_connection_sup.2.54430129&gt;,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {&lt;0.1674.0&gt;,
                                           amqp_connection_type_sup}
     Context:    child_terminated
     Reason:     {socket_error,etimedout}
     Offender:   [{pid,&lt;0.1676.0&gt;},
                  {name,main_reader},
                  {mfa,
                      {amqp_main_reader,start_link,
                          [#Port&lt;0.5748&gt;,&lt;0.1671.0&gt;,&lt;0.1673.0&gt;,
                           {method,rabbit_framing_amqp_0_9_1}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {&lt;0.1674.0&gt;,
                                           amqp_connection_type_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,&lt;0.1676.0&gt;},
                  {name,main_reader},
                  {mfa,
                      {amqp_main_reader,start_link,
                          [#Port&lt;0.5748&gt;,&lt;0.1671.0&gt;,&lt;0.1673.0&gt;,
                           {method,rabbit_framing_amqp_0_9_1}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 13-Sep-2012::12:17:00 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.1657.0&gt;
    registered_name: []
    exception exit: {undef,
                        [{rabbit_federation_old_status,report,
                             [{upstream,
                                  {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,
                                      &lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                                      &quot;slg1matt1.xyz.com&quot;,
                                      5672,0,0,0,infinity,none,
                                      [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,

#Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                                      [],[]},
                                  &lt;&lt;&quot;skytap&quot;&gt;&gt;,1000,1,1,none,none,none,
                                  &quot;upstream-slg&quot;},
                              {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;skytap&quot;&gt;&gt;},
                              shutdown],
                             []},
                         {rabbit_federation_link,terminate,2,[]},
                         {gen_server2,terminate,3,[]},
                         {proc_lib,init_p_do_apply,3,
                             [{file,&quot;proc_lib.erl&quot;},{line,227}]}]}
      in function  gen_server2:terminate/3
    ancestors: [&lt;0.197.0&gt;,&lt;0.194.0&gt;,rabbit_federation_link_sup_sup,
                  rabbit_federation_sup,rabbit_sup,&lt;0.143.0&gt;]
    messages: [{'DOWN',#Ref&lt;0.0.0.8909&gt;,process,&lt;0.1683.0&gt;,shutdown}]
    links: []
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 9640
  neighbours:

=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {&lt;0.197.0&gt;,
                                           rabbit_federation_link_sup}
     Context:    shutdown_error
     Reason:     {undef,
                     [{rabbit_federation_old_status,report,
                          [{upstream,
                               {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
                                   &lt;&lt;&quot;/&quot;&gt;&gt;,
                                   &quot;slg1matt1.xyz.com&quot;,5672,0,
                                   0,0,infinity,none,
                                   [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                    #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                                   [],[]},
                               &lt;&lt;&quot;skytap&quot;&gt;&gt;,1000,1,1,none,none,none,
                               &quot;upstream-slg&quot;},
                           {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;skytap&quot;&gt;&gt;},
                           shutdown],
                          []},
                      {rabbit_federation_link,terminate,2,[]},
                      {gen_server2,terminate,3,[]},
                      {proc_lib,init_p_do_apply,3,
                          [{file,&quot;proc_lib.erl&quot;},{line,227}]}]}
     Offender:   [{pid,&lt;0.1657.0&gt;},
                  {name,
                      {upstream,
                          {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
                              &lt;&lt;&quot;/&quot;&gt;&gt;,&quot;slg1matt1.xyz.com&quot;,
                              5672,0,0,0,infinity,none,
                              [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                               #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                              [],[]},
                          &lt;&lt;&quot;skytap&quot;&gt;&gt;,1000,1,1,none,none,none,
                          &quot;upstream-slg&quot;}},
                  {mfa,
                      {rabbit_federation_link,start_link,
                          [{{upstream,

{amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
                                    &lt;&lt;&quot;/&quot;&gt;&gt;,
                                    &quot;slg1matt1.xyz.com&quot;,5672,
                                    0,0,0,infinity,none,
                                    [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                     #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                                    [],[]},
                                &lt;&lt;&quot;skytap&quot;&gt;&gt;,1000,1,1,none,none,none,
                                &quot;upstream-slg&quot;},
                            {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;skytap&quot;&gt;&gt;}}]}},
                  {restart_type,{permanent,1}},
                  {shutdown,4294967295},
                  {child_type,worker}]

--------

On Thu, Sep 13, 2012 at 12:30 PM, Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On 13 Sep 2012, at 20:26, Matt Pietrek wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; We &quot;own&quot; the network in that it's a direct connection between two
</I>&gt;<i> datacenters. It's not a particularly high speed connection, but it's
</I>&gt;<i> generally reliable. I've done some ping tests between the two nodes and
</I>&gt;<i> while an occasional packet will drop every once in awhile, it's not a
</I>&gt;<i> really horrible connection. The average ping round trip time is areound
</I>&gt;<i> 80ms.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'd be surprised if it's a dropped packet, as the shutdown on both
</I>&gt;<i> brokers seems to consistently take a long time. I just reproed this again,
</I>&gt;<i> and one broker took 1000 seconds to shut down, while the other took 995. I
</I>&gt;<i> have the logs from this repro, but a quick glance doesn't show anything
</I>&gt;<i> radically different. Let me know if there's anything else I can supply.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Ok - do send the second pair of logs (or a scrubbed version if you need to
</I>&gt;<i> hide private data) please, as we're keen to get to the bottom of this.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/480453f5/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/480453f5/attachment.htm</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022482.html">[rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
</A></li>
	<LI>Next message: <A HREF="022541.html">[rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22483">[ date ]</a>
              <a href="thread.html#22483">[ thread ]</a>
              <a href="subject.html#22483">[ subject ]</a>
              <a href="author.html#22483">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
