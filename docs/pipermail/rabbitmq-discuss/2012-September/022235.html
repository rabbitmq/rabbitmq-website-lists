<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Java client lib: up to 5 threads created in client when server publishes new message
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Java%20client%20lib%3A%20up%20to%205%20threads%20created%20in%0A%20client%20when%20server%20publishes%20new%20message&In-Reply-To=%3C5044DD9A.6060307%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022229.html">
   <LINK REL="Next"  HREF="022236.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Java client lib: up to 5 threads created in client when server publishes new message</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Java%20client%20lib%3A%20up%20to%205%20threads%20created%20in%0A%20client%20when%20server%20publishes%20new%20message&In-Reply-To=%3C5044DD9A.6060307%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Java client lib: up to 5 threads created in client when server publishes new message">simon at rabbitmq.com
       </A><BR>
    <I>Mon Sep  3 17:40:58 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022229.html">[rabbitmq-discuss] Java client lib: up to 5 threads created in client when server publishes new message
</A></li>
        <LI>Next message: <A HREF="022236.html">[rabbitmq-discuss] Java client lib: up to 5 threads created in client when server publishes new message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22235">[ date ]</a>
              <a href="thread.html#22235">[ thread ]</a>
              <a href="subject.html#22235">[ subject ]</a>
              <a href="author.html#22235">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/09/12 14:06, sharonbn wrote:
&gt;<i> Hello,
</I>
Hi.

&gt;<i> I created a simple client in Java, which consumes messages from a queue in a
</I>&gt;<i> loop.
</I>&gt;<i> what I see in the debugger, is that whenever I publish a new message into
</I>&gt;<i> queue &quot;q0&quot;
</I>&gt;<i> a new thread is opened in the client.  until 5 threads are open and running.
</I>&gt;<i> (this is besides the single thread named &quot;AMQP Connection&quot;)
</I>&gt;<i> the threads begin when the messages are published, not when they are
</I>&gt;<i> consumed...
</I>&gt;<i>
</I>&gt;<i> is this expected behavior?
</I>
Yes. This is the thread pool for consumer callbacks to get executed in.

&gt;<i> can this be changed?
</I>
Yes, invoke ConnectionFactory.newConnection(ExecutorService, Address[]) 
with a different ExecutorService.

Cheers, Simon

&gt;<i> here is the stack trace, the client code is below.
</I>&gt;<i>
</I>&gt;<i> Test at localhost:62105	
</I>&gt;<i> 	Thread [main] (Suspended (breakpoint at line 19 in Test))	
</I>&gt;<i> 		Test.main(String...) line: 19	
</I>&gt;<i> 	Thread [AMQP Connection 204.236.192.179:1883] (Running)	
</I>&gt;<i> 	Thread [pool-1-thread-1] (Running)	
</I>&gt;<i> 	Thread [pool-1-thread-2] (Running)	
</I>&gt;<i> 	Thread [pool-1-thread-3] (Running)	
</I>&gt;<i> 	Thread [pool-1-thread-4] (Running)	
</I>&gt;<i> 	Thread [pool-1-thread-5] (Running)	
</I>&gt;<i>
</I>&gt;<i> thanks,
</I>&gt;<i> Sharon.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> import com.rabbitmq.client.*;
</I>&gt;<i>
</I>&gt;<i> public class Test
</I>&gt;<i> {
</I>&gt;<i> 	static Connection connection;
</I>&gt;<i> 	static Channel channel;
</I>&gt;<i> 	static QueueingConsumer consumer;
</I>&gt;<i>
</I>&gt;<i> 	public static void main (String... args) throws Exception
</I>&gt;<i> 	{
</I>&gt;<i> 		ConnectionFactory factory = new ConnectionFactory();
</I>&gt;<i> 		factory.setHost(Constants.server);
</I>&gt;<i> 		factory.setPort(Constants.port);
</I>&gt;<i> 		connection = factory.newConnection();
</I>&gt;<i> 		channel = connection.createChannel();
</I>&gt;<i> 		consumer = new QueueingConsumer(channel);
</I>&gt;<i> 		channel.basicConsume(&quot;q0&quot;, true, consumer);
</I>&gt;<i>
</I>&gt;<i> 		for (int i = 0 ; i&lt;  10 ; i++) {
</I>&gt;<i> 			QueueingConsumer.Delivery d = consumer.nextDelivery();
</I>&gt;<i> 			System.out.println(&quot; got: &quot; + new String(d.getBody()));
</I>&gt;<i> 			try { Thread.sleep(1000); } catch (InterruptedException e) {}
</I>&gt;<i> 		}
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Java-client-lib-up-to-5-threads-created-in-client-when-server-publishes-new-message-tp21751.html">http://rabbitmq.1065348.n5.nabble.com/Java-client-lib-up-to-5-threads-created-in-client-when-server-publishes-new-message-tp21751.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022229.html">[rabbitmq-discuss] Java client lib: up to 5 threads created in client when server publishes new message
</A></li>
	<LI>Next message: <A HREF="022236.html">[rabbitmq-discuss] Java client lib: up to 5 threads created in client when server publishes new message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22235">[ date ]</a>
              <a href="thread.html#22235">[ thread ]</a>
              <a href="subject.html#22235">[ subject ]</a>
              <a href="author.html#22235">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
