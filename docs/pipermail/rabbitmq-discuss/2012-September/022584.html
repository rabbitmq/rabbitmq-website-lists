<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20nodes%20stop/start%20order%20can%20lead%20to%0A%09failures&In-Reply-To=%3C9c2c6423-65f7-4a18-82d7-edbfc6b17272%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022462.html">
   <LINK REL="Next"  HREF="022600.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures</H1>
    <B>Jonathan Oliver</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20nodes%20stop/start%20order%20can%20lead%20to%0A%09failures&In-Reply-To=%3C9c2c6423-65f7-4a18-82d7-edbfc6b17272%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures">jonathan.s.oliver42 at gmail.com
       </A><BR>
    <I>Thu Sep 20 20:52:50 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022462.html">[rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures
</A></li>
        <LI>Next message: <A HREF="022600.html">[rabbitmq-discuss] Cluster nodes stop/start order can lead	to	failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22584">[ date ]</a>
              <a href="thread.html#22584">[ thread ]</a>
              <a href="subject.html#22584">[ subject ]</a>
              <a href="author.html#22584">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wouldn't having no less than 3 nodes help with this? I would imagine that 
the last node, even if it's a RAM node, would have the latest exchanges, 
bindings, etc. and would be able to deliver them authoritatively to the any 
node coming back online.  Obviously changes to exchanges and bindings could 
not occur during the time period during which no durable nodes are 
available, but I can't see why a RAM node couldn't help in this scenario. 
 I haven't yet tested this scenario just yet, but it's simple enough to 
prove with a few AWS cloud instances.

On Thursday, September 13, 2012 2:57:15 AM UTC-6, Jignesh Purohit wrote:
&gt;<i>
</I>&gt;<i> Hi Matt,
</I>&gt;<i>
</I>&gt;<i> I too facing the same problem so kindly let me know if you get any 
</I>&gt;<i> solution for this problem.
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i> Jignesh Purohit
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thursday, September 13, 2012 2:13:14 AM UTC+5:30, Matt Long wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Say I have node1 and node2 both running as disc nodes in a cluster (there 
</I>&gt;&gt;<i> are no other nodes in the cluster). If I stop rabbitmq-server on node1 and 
</I>&gt;&gt;<i> then stop rabbitmq-server on node2, I'm unable to then start 
</I>&gt;&gt;<i> rabbitmq-server again on node1...in particular, the start command hangs for 
</I>&gt;&gt;<i> ~35 seconds before showing FAILED...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is this the expected behavior? Note that starting node2 after having 
</I>&gt;&gt;<i> stopped node1 and then node2 works fine; I'm assuming because node2 was 
</I>&gt;&gt;<i> aware that node1 had went offline prior to its stopping.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The relevant bit from the startup_log on node1 is :
</I>&gt;&gt;<i> BOOT FAILED
</I>&gt;&gt;<i> ===========
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Timeout contacting cluster nodes: ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>'].
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here's all the details:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *node1*$ sudo service rabbitmq-server stop
</I>&gt;&gt;<i> Stopping rabbitmq-server: rabbitmq-server.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *node2*$ sudo service rabbitmq-server stop
</I>&gt;&gt;<i> Stopping rabbitmq-server: rabbitmq-server.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *node1*$ sudo service rabbitmq-server start
</I>&gt;&gt;<i> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
</I>&gt;&gt;<i> _err}
</I>&gt;&gt;<i> rabbitmq-server.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Contents of startup_err:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Crash dump was written to: erl_crash.dump
</I>&gt;&gt;<i> Kernel pid terminated (application_controller) 
</I>&gt;&gt;<i> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Tail end of startup_log:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- rabbit boot start
</I>&gt;&gt;<i> starting file handle cache server                                     
</I>&gt;&gt;<i> ...done
</I>&gt;&gt;<i> starting worker pool                                                 
</I>&gt;&gt;<i>  ...done
</I>&gt;&gt;<i> starting database                                                     ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> BOOT FAILED
</I>&gt;&gt;<i> ===========
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Timeout contacting cluster nodes: ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>'].
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> DIAGNOSTICS
</I>&gt;&gt;<i> ===========
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> nodes in question: ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>']
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> hosts, their running nodes and ports:
</I>&gt;&gt;<i> - node2: []
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> current node details:
</I>&gt;&gt;<i> - node name: '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node1</A>'
</I>&gt;&gt;<i> - home dir: /var/lib/rabbitmq
</I>&gt;&gt;<i> - cookie hash: xxxredactedxxxxxxxxxxx==
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {&quot;Kernel pid 
</I>&gt;&gt;<i> terminated&quot;,application_controller,&quot;{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}&quot;}
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/684f10a6/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/684f10a6/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022462.html">[rabbitmq-discuss] Cluster nodes stop/start order can lead to	failures
</A></li>
	<LI>Next message: <A HREF="022600.html">[rabbitmq-discuss] Cluster nodes stop/start order can lead	to	failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22584">[ date ]</a>
              <a href="thread.html#22584">[ thread ]</a>
              <a href="subject.html#22584">[ subject ]</a>
              <a href="author.html#22584">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
