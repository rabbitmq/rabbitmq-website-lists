<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with rabbitmq-server.init
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20rabbitmq-server.init&In-Reply-To=%3CCAHyXxcf2VqK6eR%2BzGUmi4MLKOYhPAskamTgwjWrmZPw8VOLGCg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022717.html">
   <LINK REL="Next"  HREF="022724.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with rabbitmq-server.init</H1>
    <B>Sundar</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20rabbitmq-server.init&In-Reply-To=%3CCAHyXxcf2VqK6eR%2BzGUmi4MLKOYhPAskamTgwjWrmZPw8VOLGCg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Problem with rabbitmq-server.init">cybertoast at gmail.com
       </A><BR>
    <I>Thu Sep 27 16:50:36 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022717.html">[rabbitmq-discuss] Problem with rabbitmq-server.init
</A></li>
        <LI>Next message: <A HREF="022724.html">[rabbitmq-discuss] Problem with rabbitmq-server.init
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22723">[ date ]</a>
              <a href="thread.html#22723">[ thread ]</a>
              <a href="subject.html#22723">[ subject ]</a>
              <a href="author.html#22723">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Emile,
The problem is that I am trying to solve is as follows. I use
Fabric&lt;<A HREF="http://fabfile.org">http://fabfile.org</A>&gt;or
Ansible &lt;<A HREF="http://ansible.cc">http://ansible.cc</A>&gt; for my deployment process. Part of the
deployment process is to start/stop/restart certain services. What I found
is that running /etc/init.d/rabbitmq-server start would start the service,
but that the service would die right after the deployment task completed.

My understanding of debugging this problem is that the process is started
under the context of the deployer's connection to the remote host (the SSH
session) but as soon as that context dies the backgrounded process
(rabbitmq-server) also died. I was able to test this theory by putting in a
long wait at the end of the init.d/rabbitmq-server script and noticed that
the service stayed up during the wait, but as soon as the Ansible/Fabric
script exited the rabbitmq-server process also died. Note that this does
NOT happen under normal login. As a stop-gap fix I used nohup to ensure
that the process did not die, but upon discussion with others I was lead to
think that the init.d script may be malfunctioning.

Looking into the problem further I found that the Debian init script used
start-stop-daemon. The equivalent in RHEL seems to be the &quot;daemon&quot; function
in /etc/rc.d/init.d/functions. It's possible that I misunderstood this to
be present in all RHEL-type machines (it's present on my RHEL5.6+ and
CentOS 5.6+ machines).

Please let me know if the proposed fix is incorrect/problematic. I found
that applying this patch solved my problem, but perhaps there's a better
way to ensure that the backgrounded process (i.e., $START_PROG $DAEMON &amp;)
does not die upon termination of the caller's shell context.

Thanks much.

On Thu, Sep 27, 2012 at 7:20 AM, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 27/09/12 12:10, Emile Joubert wrote:
</I>&gt;<i> &gt; &quot;runuser&quot;. We are aware that this is not suitable for all RPM
</I>&gt;<i> &gt; distributions (notably SuSE) and we intend to correct that.
</I>&gt;<i>
</I>&gt;<i> Let me correct that: START_PROG is currently set to runuser for Fedora
</I>&gt;<i> and setsid for SuSE-based distributions. We intend to make the scripts
</I>&gt;<i> more idiomatic for SuSE.
</I>&gt;<i>
</I>&gt;<i> It is not clear from your patch what problem you are trying to solve.
</I>&gt;<i> Perhaps if you explain more what you intended to achieve we can help.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/c34ff2a5/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/c34ff2a5/attachment.htm</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022717.html">[rabbitmq-discuss] Problem with rabbitmq-server.init
</A></li>
	<LI>Next message: <A HREF="022724.html">[rabbitmq-discuss] Problem with rabbitmq-server.init
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22723">[ date ]</a>
              <a href="thread.html#22723">[ thread ]</a>
              <a href="subject.html#22723">[ subject ]</a>
              <a href="author.html#22723">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
