<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Crash on badmatch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Crash%20on%20badmatch&In-Reply-To=%3C505B2E6A.3070908%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022576.html">
   <LINK REL="Next"  HREF="022578.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Crash on badmatch</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Crash%20on%20badmatch&In-Reply-To=%3C505B2E6A.3070908%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Crash on badmatch">simon at rabbitmq.com
       </A><BR>
    <I>Thu Sep 20 15:55:38 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022576.html">[rabbitmq-discuss] Crash on badmatch
</A></li>
        <LI>Next message: <A HREF="022578.html">[rabbitmq-discuss] Crash on badmatch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22577">[ date ]</a>
              <a href="thread.html#22577">[ thread ]</a>
              <a href="subject.html#22577">[ subject ]</a>
              <a href="author.html#22577">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ouch.

'badmatch' is a rather generic error message - pattern matching did not 
succeed. In the case you've encountered, pattern matching is used as an 
assertion. More specifically, the message store was attempting to merge 
two files, and in doing so found that one of them was not the size it 
expected.

So it's possible you've found a bug. If you see this happening again, 
please zip up all the logs and also the message stores + Mnesia 
themselves (/mnt/drbd0/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/) since we may need to do quite 
a bit of digging to find out what's happened.

On the other hand, the message store is quite mature code; it hasn't 
changed in a while and it gets a lot of use. So I wouldn't *entirely* 
rule out RAM / HDD corruption as a cause either.

Cheers, Simon

On 20/09/12 15:34, Chris Larsen wrote:
&gt;<i> Hi folks, we had a problem today where the MQ server kept crashing and
</I>&gt;<i> we think it was due to some client pushing in a bad message as we were
</I>&gt;<i> able to keep the server up only after removing access to some users.
</I>&gt;<i> We&#8217;re still trying to track down the exact client that was causing the
</I>&gt;<i> issues. However the cause of the crash was listed in the logs as bellow.
</I>&gt;<i> I couldn&#8217;t find any references to &#8220;badmatch&#8221; errors on the list before
</I>&gt;<i> so I was wondering if anyone has seen it?
</I>&gt;<i>
</I>&gt;<i> We&#8217;re running Rabbitmq 2.8.5 on erlang 1:15.b.1-1~ubuntu~lucid. Thanks!
</I>&gt;<i>
</I>&gt;<i> =ERROR REPORT==== 20-Sep-2012::12:59:37 ===
</I>&gt;<i>
</I>&gt;<i> ** Generic server &lt;0.229.0&gt; terminating
</I>&gt;<i>
</I>&gt;<i> ** Last message in was {'$gen_cast',{combine,1001,999}}
</I>&gt;<i>
</I>&gt;<i> ** When Server state == {state,
</I>&gt;<i>
</I>&gt;<i> {dict,0,16,16,8,80,48,
</I>&gt;<i>
</I>&gt;<i> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i>
</I>&gt;<i> []},
</I>&gt;<i>
</I>&gt;<i> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i>
</I>&gt;<i> [],[]}}},
</I>&gt;<i>
</I>&gt;<i> [#Fun&lt;rabbit_msg_store.15.106110853&gt;],
</I>&gt;<i>
</I>&gt;<i> {gc_state,
</I>&gt;<i>
</I>&gt;<i> &quot;/mnt/drbd0/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/msg_store_persistent&quot;,
</I>&gt;<i>
</I>&gt;<i> rabbit_msg_store_ets_index,
</I>&gt;<i>
</I>&gt;<i> {state,458823,
</I>&gt;<i>
</I>&gt;<i> &quot;/mnt/drbd0/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/msg_store_persistent&quot;},
</I>&gt;<i>
</I>&gt;<i> 454726,462920,&lt;0.226.0&gt;}}
</I>&gt;<i>
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i>
</I>&gt;<i> **
</I>&gt;<i> {{badmatch,{[{msg_location,&lt;&lt;119,180,79,244,242,22,59,63,219,227,203,29,171,
</I>&gt;<i>
</I>&gt;<i> 138,191,149&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> 1,999,2301,298},
</I>&gt;<i>
</I>&gt;<i> {msg_location,&lt;&lt;15,166,249,210,74,141,92,125,164,106,201,179,
</I>&gt;<i>
</I>&gt;<i> 247,29,128,81&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> 1,999,4643,297},
</I>&gt;<i>
</I>&gt;<i> {msg_location,&lt;&lt;61,32,10,20,15,47,161,44,66,91,98,119,129,10,
</I>&gt;<i>
</I>&gt;<i> 230,135&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> 1,999,7239,297},
</I>&gt;<i>
</I>&gt;<i> {msg_location,&lt;&lt;242,222,190,244,108,107,42,177,98,113,130,255,
</I>&gt;<i>
</I>&gt;<i> 211,78,44,242&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> 1,999,7791,297},
</I>&gt;<i>
</I>&gt;<i> {msg_location,&lt;&lt;107,45,44,203,166,43,87,116,132,109,19,63,113,
</I>&gt;<i>
</I>&gt;<i> 184,191,143&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> 1,999,9877,297},
</I>&gt;<i>
</I>&gt;<i> ..... { THOUSANDS OF LINES } .....
</I>&gt;<i>
</I>&gt;<i> {msg_location,&lt;&lt;167,233,20,236,134,250,109,211,72,107,129,39,
</I>&gt;<i>
</I>&gt;<i> 57,87,109,67&gt;&gt;,
</I>&gt;<i>
</I>&gt;<i> 1,999,1580282,254}],
</I>&gt;<i>
</I>&gt;<i> 378139}},
</I>&gt;<i>
</I>&gt;<i> [{rabbit_msg_store,combine_files,3,[]},
</I>&gt;<i>
</I>&gt;<i> {rabbit_msg_store_gc,attempt_action,3,[]},
</I>&gt;<i>
</I>&gt;<i> {rabbit_msg_store_gc,handle_cast,2,[]},
</I>&gt;<i>
</I>&gt;<i> {gen_server2,handle_msg,2,[]},
</I>&gt;<i>
</I>&gt;<i> {proc_lib,wake_up,3,[{file,&quot;proc_lib.erl&quot;},{line,237}]}]}
</I>&gt;<i>
</I>&gt;<i> =ERROR REPORT==== 20-Sep-2012::13:31:15 ===
</I>&gt;<i>
</I>&gt;<i> Error description:
</I>&gt;<i>
</I>&gt;<i> {shutdown,
</I>&gt;<i>
</I>&gt;<i> {gen_server,call,
</I>&gt;<i>
</I>&gt;<i> [{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit_amqqueue_sup,rabbit at localhost</A>},
</I>&gt;<i>
</I>&gt;<i> {start_child,
</I>&gt;<i>
</I>&gt;<i> [{amqqueue,
</I>&gt;<i>
</I>&gt;<i> {resource,&lt;&lt;&quot;/exchange/queu&quot;&gt;&gt;,queue,
</I>&gt;<i>
</I>&gt;<i> &lt;&lt;&quot;/queue/hostname:1983&quot;&gt;&gt;},
</I>&gt;<i>
</I>&gt;<i> true,false,none,[],&lt;0.2434.0&gt;,[],undefined}]},
</I>&gt;<i>
</I>&gt;<i> infinity]}}
</I>&gt;<i>
</I>&gt;<i> Log files (may contain more information):
</I>&gt;<i>
</I>&gt;<i> /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost.log</A>
</I>&gt;<i>
</I>&gt;<i> /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost-sasl.log</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022576.html">[rabbitmq-discuss] Crash on badmatch
</A></li>
	<LI>Next message: <A HREF="022578.html">[rabbitmq-discuss] Crash on badmatch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22577">[ date ]</a>
              <a href="thread.html#22577">[ thread ]</a>
              <a href="subject.html#22577">[ subject ]</a>
              <a href="author.html#22577">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
