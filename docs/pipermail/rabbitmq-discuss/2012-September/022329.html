<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Odd delay in federation exchanges being	recognized
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Odd%20delay%20in%20federation%20exchanges%20being%0A%09recognized&In-Reply-To=%3CCACLE7ixU458C1%2BStszpkVOAagZ-F-7kH5UERBt_CA2rpQCFaFg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022310.html">
   <LINK REL="Next"  HREF="022290.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Odd delay in federation exchanges being	recognized</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Odd%20delay%20in%20federation%20exchanges%20being%0A%09recognized&In-Reply-To=%3CCACLE7ixU458C1%2BStszpkVOAagZ-F-7kH5UERBt_CA2rpQCFaFg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Odd delay in federation exchanges being	recognized">mpietrek at skytap.com
       </A><BR>
    <I>Thu Sep  6 17:18:05 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022310.html">[rabbitmq-discuss] Odd delay in federation exchanges being	recognized
</A></li>
        <LI>Next message: <A HREF="022290.html">[rabbitmq-discuss] Occasional slow message on a local machine
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22329">[ date ]</a>
              <a href="thread.html#22329">[ thread ]</a>
              <a href="subject.html#22329">[ subject ]</a>
              <a href="author.html#22329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Simon.

I agree, it's odd. I'll keep an eye out for further clues if/when I see it
again. I mostly wanted to know if there was something obvious to you folks.
For instance (totally a stab in the dark here...) perhaps connections
between federated brokers taking a long time to establish.

Matt

On Thu, Sep 6, 2012 at 2:58 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> That... certainly sounds very odd.
</I>&gt;<i>
</I>&gt;<i> So the &quot;unknown exchange type&quot; message is what you get when you declare an
</I>&gt;<i> exchange using a plugin, and then remove that plugin.
</I>&gt;<i>
</I>&gt;<i> So could the exchange type be getting registered slowly somehow? Hard to
</I>&gt;<i> believe, the registration happens during startup, and RabbitMQ shouldn't be
</I>&gt;<i> able to get to the point where it's accepting connections without all
</I>&gt;<i> exchange types being registered.
</I>&gt;<i>
</I>&gt;<i> I'll have a look at that code in case anything jumps out, but it's pretty
</I>&gt;<i> simple so don't hold your breath...
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 05/09/2012 7:27PM, Matt Pietrek wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Let me admit up front that this is a weird one, but I'll press ahead on
</I>&gt;&gt;<i> the chance there's something there.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've got two brokers I'm using the federation plugin with. I create a
</I>&gt;&gt;<i> single exchange 'skytap' on each broker, and make the 'skytap' exchange
</I>&gt;&gt;<i> on the other broker its upstream.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I create the rabbitmq.config file dynamically before starting each
</I>&gt;&gt;<i> broker. Starting from a blank slate (blowing away the mnesia directory),
</I>&gt;&gt;<i> I launch the two nodes concurrently.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When I go to the Exchange tab in either broker, I see two Exchanges as
</I>&gt;&gt;<i> expected:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   * federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2.skytap.com</A>
</I>&gt;&gt;<i>     &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2.skytap.com</A>&gt; B
</I>&gt;&gt;<i>   * skytap
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The type of the exchanges is x-federation-upstream and x-federation,
</I>&gt;&gt;<i> respectively. However, when first starting up, the type column is a red
</I>&gt;&gt;<i> color indicating a problem, and hovering over it, I get a message to the
</I>&gt;&gt;<i> effect of &quot;unknown exchange type x-federation. Messages published to
</I>&gt;&gt;<i> this exchange won't work.&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now, here's the interesting thing: I*f I wait long enough (usually
</I>&gt;&gt;<i> around 10-15 minutes) **and without doing anything, the error state
</I>&gt;&gt;<i> eventually goes away* and the Exchanges seem happy. This has happened at
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> least three times, so it doesn't seem like a random fluke or that I
</I>&gt;&gt;<i> accidentally did something.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here's my config file, FWIW...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [
</I>&gt;&gt;<i> {rabbit, [{cluster_nodes, [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>]}, {disk_free_limit, 104857600}]},
</I>&gt;&gt;<i> {mnesia, [{debug, trace}]},
</I>&gt;&gt;<i> {rabbitmq_federation, [{exchanges, [[{type, &quot;topic&quot;}, {upstream_set,
</I>&gt;&gt;<i> &quot;skytap_upstreams&quot;}, {virtual_host, &quot;/&quot;}, {exchange, &quot;skytap&quot;}]]},
</I>&gt;&gt;<i> {upstream_sets, [{&quot;skytap_upstreams&quot;, [[{connection, &quot;upstream-mq2&quot;},
</I>&gt;&gt;<i> {max_hops, 1}, {exchange, &quot;skytap&quot;}]]}]},
</I>&gt;&gt;<i> {connections, [{&quot;upstream-mq2&quot;, [{host, &quot;mq2&quot;}, {port, 5672}]}]}]}
</I>&gt;&gt;<i> ].
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Again, I realize this sounds a bit wonky, but it's happened enough times
</I>&gt;&gt;<i> to make me not think I'm crazy.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Matt
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ______________________________**_________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/4549c474/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/4549c474/attachment.htm</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022310.html">[rabbitmq-discuss] Odd delay in federation exchanges being	recognized
</A></li>
	<LI>Next message: <A HREF="022290.html">[rabbitmq-discuss] Occasional slow message on a local machine
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22329">[ date ]</a>
              <a href="thread.html#22329">[ thread ]</a>
              <a href="subject.html#22329">[ subject ]</a>
              <a href="author.html#22329">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
