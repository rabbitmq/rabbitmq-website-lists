<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to achieve HA consumers?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20achieve%20HA%20consumers%3F&In-Reply-To=%3C50447B8F.5040907%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022232.html">
   <LINK REL="Next"  HREF="022243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to achieve HA consumers?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20achieve%20HA%20consumers%3F&In-Reply-To=%3C50447B8F.5040907%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] How to achieve HA consumers?">matthias at rabbitmq.com
       </A><BR>
    <I>Mon Sep  3 10:42:39 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022232.html">[rabbitmq-discuss] How to achieve HA consumers?
</A></li>
        <LI>Next message: <A HREF="022243.html">[rabbitmq-discuss] How to achieve HA consumers?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22233">[ date ]</a>
              <a href="thread.html#22233">[ thread ]</a>
              <a href="subject.html#22233">[ subject ]</a>
              <a href="author.html#22233">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/09/12 10:29, Francesco Mazzoli wrote:
&gt;<i> That said, whoever wants to consume from the queue needs to consume from the
</I>&gt;<i> token queue first.  In the case of the OP, the main consumer will start first,
</I>&gt;<i> and the second right after it.  This way, the second will be blocked until the
</I>&gt;<i> first consumer dies/quits and the token message will be requeued.
</I>
In pseudo code, this is what each consumer looks like:

token_consumer = channel.basic_consume(token_queue)
wait_for_consumer_message(token_consumer)
main_consumer = channel.basic_consume(main_queue)
while(true) {
   msg = wait_for_consumer_msg(main_consumer)
   process_message(msg)
   channel.basic_ack(msg)
}


There is one snag with this: When a consumer dies, the order in which 
the token message and any pending &quot;proper&quot; messages are requeued is 
undefined. That means the consumer that is taking over might start 
consuming from the main queue before the unack'ed messages have been 
requeued. The messages will get requeued eventually, but they will be 
out of order.

In practice, introducing a slight delay before consuming from the main 
queue should prevent this.


Matthias.
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022232.html">[rabbitmq-discuss] How to achieve HA consumers?
</A></li>
	<LI>Next message: <A HREF="022243.html">[rabbitmq-discuss] How to achieve HA consumers?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22233">[ date ]</a>
              <a href="thread.html#22233">[ thread ]</a>
              <a href="subject.html#22233">[ subject ]</a>
              <a href="author.html#22233">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
