<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with rabbitmq-server.init
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20rabbitmq-server.init&In-Reply-To=%3CCAHyXxcf-j3qjaM133SAKM-kUHs%2BDtL84626AT6iLF88n%2Bw9FUA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022734.html">
   <LINK REL="Next"  HREF="022716.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with rabbitmq-server.init</H1>
    <B>Sundar</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20rabbitmq-server.init&In-Reply-To=%3CCAHyXxcf-j3qjaM133SAKM-kUHs%2BDtL84626AT6iLF88n%2Bw9FUA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Problem with rabbitmq-server.init">cybertoast at gmail.com
       </A><BR>
    <I>Wed Sep 26 16:52:57 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022734.html">[rabbitmq-discuss] Support for Python 3.x in rabbitmq-codegen
</A></li>
        <LI>Next message: <A HREF="022716.html">[rabbitmq-discuss] Problem with rabbitmq-server.init
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22706">[ date ]</a>
              <a href="thread.html#22706">[ thread ]</a>
              <a href="subject.html#22706">[ subject ]</a>
              <a href="author.html#22706">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The rabbitmq Fedora init script does not daemonize correctly (AFAICT). The
current script also does not match the Debian daemonization (using
start-stop-daemon).

Following is a patch to use &quot;daemon&quot; to make it work (I think). I'd
appreciate any feedback. I'm also not sure how to submit a pull/patch
request so if this is not the right place to submit this please could
someone point me to the right place. I cloned the code from
<A HREF="http://hg.rabbitmq.com/rabbitmq-server">http://hg.rabbitmq.com/rabbitmq-server</A>

Thanks much.

$ hg diff
diff -r 8792fb52db8a packaging/RPMS/Fedora/rabbitmq-server.init
--- a/packaging/RPMS/Fedora/rabbitmq-server.init    Wed Sep 26 13:57:55
2012 +0100
+++ b/packaging/RPMS/Fedora/rabbitmq-server.init    Wed Sep 26 11:44:21
2012 -0400
@@ -10,8 +10,6 @@
 # Provides:          rabbitmq-server
 # Required-Start:    $remote_fs $network
 # Required-Stop:     $remote_fs $network
-# Default-Start:     3 4 5
-# Default-Stop:      0 1 2 6
 # Description:       RabbitMQ broker
 # Short-Description: Enable AMQP service provided by RabbitMQ broker
 ### END INIT INFO
@@ -26,12 +24,16 @@
 INIT_LOG_DIR=/var/log/rabbitmq
 PID_FILE=/var/run/rabbitmq/pid

-START_PROG= # Set when building package
+START_PROG=&quot;daemon --user=$USER&quot;
 LOCK_FILE=/var/lock/subsys/$NAME

 test -x $DAEMON || exit 0
 test -x $CONTROL || exit 0

+# Source function library for the &quot;daemon&quot; function
+. /etc/rc.d/init.d/functions
+
+
 RETVAL=0
 set -e
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/6c8cc2cb/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/6c8cc2cb/attachment.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022734.html">[rabbitmq-discuss] Support for Python 3.x in rabbitmq-codegen
</A></li>
	<LI>Next message: <A HREF="022716.html">[rabbitmq-discuss] Problem with rabbitmq-server.init
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22706">[ date ]</a>
              <a href="thread.html#22706">[ thread ]</a>
              <a href="subject.html#22706">[ subject ]</a>
              <a href="author.html#22706">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
