<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbit won't restart - no next heap size	found
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20won%27t%20restart%20-%20no%20next%20heap%20size%0A%09found&In-Reply-To=%3C5066A629.3010702%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022740.html">
   <LINK REL="Next"  HREF="022676.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbit won't restart - no next heap size	found</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20won%27t%20restart%20-%20no%20next%20heap%20size%0A%09found&In-Reply-To=%3C5066A629.3010702%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Rabbit won't restart - no next heap size	found">matthias at rabbitmq.com
       </A><BR>
    <I>Sat Sep 29 08:41:29 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022740.html">[rabbitmq-discuss] Rabbit won't restart - no next heap size	found
</A></li>
        <LI>Next message: <A HREF="022676.html">[rabbitmq-discuss] C# posted messages to topic queue aren't going away when subscriber acks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22741">[ date ]</a>
              <a href="thread.html#22741">[ thread ]</a>
              <a href="subject.html#22741">[ subject ]</a>
              <a href="author.html#22741">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mike,

On 28/09/12 22:06, Mike Khristo wrote:
&gt;<i> Added a 200G swap... it used some of it, but still seg faults at
</I>&gt;<i> startup.
</I>
Did it fail with the same error, i.e. &quot;eheap_alloc: Cannot allocate ....
bytes of memory&quot;? That would be kinda surprising.

Is there anything in the log files?

There are scenarios in which an error can trigger the writing of an 
enormous log message, and it's the latter that is exhausting memory. If 
so, the log should contain the error.

&gt;<i> Is there any way to split up the data on disk so I can get 2 rabbits
</I>&gt;<i> up with half the data each?
</I>
Hmm. The following should work:

1) make a backup of the rabbit database dir

2) cd into the database dir and remove the &quot;clean shutdown&quot; markers with
    rm -f `find . -name &quot;clean.dot&quot;`
If rabbit was shut down cleanly there should be one of these per queue 
plus one each in the msg_store_persistent and msg_store_transient dirs. 
If rabbit wasn't shut down cleanly and those files aren't present then 
not to worry.

3) in the msg_store_persistent dir remove half the *.rdq files

4) start rabbit

Then process all the messages in that rabbit, stop it, restore the 
backup and repeat the above but this time removing the other half of the 
*.rdq files.


Regards,

Matthias.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022740.html">[rabbitmq-discuss] Rabbit won't restart - no next heap size	found
</A></li>
	<LI>Next message: <A HREF="022676.html">[rabbitmq-discuss] C# posted messages to topic queue aren't going away when subscriber acks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22741">[ date ]</a>
              <a href="thread.html#22741">[ thread ]</a>
              <a href="subject.html#22741">[ subject ]</a>
              <a href="author.html#22741">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
