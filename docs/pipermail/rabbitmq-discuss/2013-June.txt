From matthias at rabbitmq.com  Sat Jun  1 08:23:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 01 Jun 2013 08:23:07 +0100
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <8607A672AFB05B4D804456463DD7DCCF224CF3D6@008-AM1MPN1-043.mgdnok.nokia.com>
References: <8607A672AFB05B4D804456463DD7DCCF224CF3D6@008-AM1MPN1-043.mgdnok.nokia.com>
Message-ID: <51A9A15B.6060700@rabbitmq.com>

John,

On 31/05/13 23:50, john.hayden at nokia.com wrote:
> In the first post, I did post the error from the rabbit log. Is there
> anything else I can post to be more helpful?

Was the the *only* error that showed up in the logs?

Also, what permissions have you set for the 'sensu' user?

Matthias.

From dmitry.andrianov at alertme.com  Sat Jun  1 10:49:44 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Sat, 1 Jun 2013 10:49:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ monitoring app shows load balancer
	IP instead of client IP
In-Reply-To: <2ab116e2-c718-4262-8ea8-9dacaabf1b8a@googlegroups.com>
References: <abdd0428-6c47-427d-9c14-9efc7b7e2193@googlegroups.com>
	<2ab116e2-c718-4262-8ea8-9dacaabf1b8a@googlegroups.com>
Message-ID: <92D99638-2A25-4DD3-9E50-81126DB28EB1@alertme.com>

The x-forwarded-for is a application level thing and it only applies to HTTP.. In the case if AMQP, I doubt Amazon's LB operates at application level and understands the protocol. Instead, the LB operates at TCP/IP level establishing new TCP connection to Rabbit from its own IP and forwarding data between incoming connection and that Rabbit connection without any understanding what that data is.
Which means it cannot add any information what wasn't there already. 

Regards

On 31 May 2013, at 20:30, Joe Vandermark <joe.vandermark at gmail.com> wrote:

> I have a similar issue/requirement. Checking in to see if Mike figured this out or if anyone else has a similar need and solution.
> 
> On Monday, January 7, 2013 11:40:39 AM UTC-6, Mike wrote:
>> 
>> I have a rabbitMQ cluster running on EC2 behind an AWS load-balancer. In the rabbitMQ monitoring app, it shows the IP address of each machine that's currently connected to rabbitMQ. Since the clients are hitting rabbitMQ through the LB, it's showing the LBs IP address, instead of the client.
>> 
>> Is there a way to get the rabbitMQ monitoring plugin to show the x-forwarded-for request header, which contains the actual client IP address?
>> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130601/2c4c34cd/attachment.htm>

From rohit.yadav at wingify.com  Sat Jun  1 13:57:26 2013
From: rohit.yadav at wingify.com (Rohit Yadav)
Date: Sat, 1 Jun 2013 18:27:26 +0530
Subject: [rabbitmq-discuss] New lua-resty-rabbitmq library
Message-ID: <CAMF++H8tWSOHun=AtVyroz-JF2BQz7ZRBXVVfEY7jDwcaemhHA@mail.gmail.com>

Hi,

I've finished the first production ready iteration v0.1 of
lua-resty-rabbitmqstomp library. I've renamed the library after concerns
from Brian;

https://github.com/wingify/lua-resty-rabbitmqstomp

After correct usage of cosocket api, I'm able to publish concurrently
without any errors as seen in our lab tests. The throughput rate is still
low when receipts (or confirms) are enabled due to STOMP over AMQP overhead
so we've decided to go with a different architecture which involves Redis,
message aggregation and RabbitMQ for fast and reliable messaging. For this
work, we've written a transport agent called agentredrabbit which is
already being used in our production pipelines and we are planning to
opensource it soon.

Regards.



On Fri, May 31, 2013 at 12:40 AM, agentzh <agentzh at gmail.com> wrote:

> Hello!
>
> On Thu, May 30, 2013 at 11:56 AM, Rohit Yadav wrote:
> >
> > I think this could be a reason, due to RabbitMQ's disk io for persisting
> > queue/messages.
> > In that case would it be too much performance penalty to sleep for a
> while
> > and retry with a new connection in the request?
>
> Explicit sleeping may be too much, because the waiting latency is not
> under complete control.
>
> I've been thinking about some kind of automatic request queueing in
> ngx_lua's cosocket connection pool so that your tcpsock:connect() call
> can just temporarily hang up waiting for other connections to complete
> when the backend request concurrency limit is hit. That way, the
> waiting latency involved cannot be any longer than necessary and
> client traffic peaks cannot overload the backend services.
>
> Before that happens, the standard ngx_limit_req and ngx_limit_conn
> modules can also temporarily block exceeding client connections or
> request, thus effectively limiting the backend request concurrency
> level.
>
> > To make the request finish fast I can do a pcall(ngx.eof) and end the
> > request and then carry on with publishing message to the RabbitMQ broker.
> >
>
> This is a common trick used by the community. Alternatively, you can
> also use ngx.timer.at() to do async job processing:
>
> http://wiki.nginx.org/HttpLuaModule#ngx.timer.at
>
> But always keep in mind, async processing can be a devil because jobs
> can accumulate really fast and eventually exhaust the system resources
> if the backend cannot catch up with the frontend. This is also an
> effective DoS attack.
>
> Happy hacking!
>
> Best regards,
> -agentzh
>
> --
> You received this message because you are subscribed to the Google Groups
> "openresty-en" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to openresty-en+unsubscribe at googlegroups.com.
> For more options, visit https://groups.google.com/groups/opt_out.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130601/7d576c13/attachment.htm>

From john.hayden at nokia.com  Sat Jun  1 15:14:29 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Sat, 1 Jun 2013 14:14:29 +0000
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <51A9A15B.6060700@rabbitmq.com>
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224D93AE@008-AM1MPN1-043.mgdnok.nokia.com>

Matthias,

  The errors in the original post were from the rabbitxxxx.log and only
repeated themselves after what I showed. Here is a snippet from the
rabbit-sasl.log:


=CRASH REPORT==== 31-May-2013::15:13:09 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.227.0>
    registered_name: []
    exception exit: {{badmatch,{error,access_refused}},
                     [{rabbit_shovel_worker,make_conn_and_chan,1},
                      {rabbit_shovel_worker,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [<0.224.0>,test_shovel,rabbit_shovel_sup,<0.220.0>]
    messages: []
    links: [<0.224.0>]
    dictionary: [{random_seed,{22387,25790,8822}}]
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 2670
  neighbours:



Again, all subsequent errors are just repeats.

As for permissions:
Sensu can log in with password and
Configure regexp, read regexp and write regexp are .*, .* and .*

Thanks again

John Hayden

On 6/1/13 3:23 AM, "ext Matthias Radestock" <matthias at rabbitmq.com> wrote:

>John,
>
>On 31/05/13 23:50, john.hayden at nokia.com wrote:
>> In the first post, I did post the error from the rabbit log. Is there
>> anything else I can post to be more helpful?
>
>Was the the *only* error that showed up in the logs?
>
>Also, what permissions have you set for the 'sensu' user?
>
>Matthias.


From matthias at rabbitmq.com  Sat Jun  1 15:25:02 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 01 Jun 2013 15:25:02 +0100
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <8607A672AFB05B4D804456463DD7DCCF224D93AE@008-AM1MPN1-043.mgdnok.nokia.com>
References: <8607A672AFB05B4D804456463DD7DCCF224D93AE@008-AM1MPN1-043.mgdnok.nokia.com>
Message-ID: <51AA043E.8000903@rabbitmq.com>

On 01/06/13 15:14, john.hayden at nokia.com wrote:
> Sensu can log in with password and
> Configure regexp, read regexp and write regexp are .*, .* and .*

Are these permissions set for the 'sensu' user *on the 'sensu' vhost*?

Matthias.

From john.hayden at nokia.com  Sat Jun  1 15:29:38 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Sat, 1 Jun 2013 14:29:38 +0000
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <51AA043E.8000903@rabbitmq.com>
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224D942A@008-AM1MPN1-043.mgdnok.nokia.com>

Yes

On 6/1/13 10:25 AM, "ext Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 01/06/13 15:14, john.hayden at nokia.com wrote:
>> Sensu can log in with password and
>> Configure regexp, read regexp and write regexp are .*, .* and .*
>
>Are these permissions set for the 'sensu' user *on the 'sensu' vhost*?
>
>Matthias.


From john.hayden at nokia.com  Sat Jun  1 15:30:42 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Sat, 1 Jun 2013 14:30:42 +0000
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <51AA043E.8000903@rabbitmq.com>
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224D9441@008-AM1MPN1-043.mgdnok.nokia.com>

Verified by looking at the Management control panel

On 6/1/13 10:25 AM, "ext Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 01/06/13 15:14, john.hayden at nokia.com wrote:
>> Sensu can log in with password and
>> Configure regexp, read regexp and write regexp are .*, .* and .*
>
>Are these permissions set for the 'sensu' user *on the 'sensu' vhost*?
>
>Matthias.


From matthias at rabbitmq.com  Sat Jun  1 15:35:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 01 Jun 2013 15:35:07 +0100
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <8607A672AFB05B4D804456463DD7DCCF224D942A@008-AM1MPN1-043.mgdnok.nokia.com>
References: <8607A672AFB05B4D804456463DD7DCCF224D942A@008-AM1MPN1-043.mgdnok.nokia.com>
Message-ID: <51AA069B.2060606@rabbitmq.com>

On 01/06/13 15:29, john.hayden at nokia.com wrote:
> Yes

Oh well. No idea what could be the problem then. If you send us the 
entire broker config (output of 'rabbitmqctl report'), as well as the 
contents of your rabbitmq.config, we can try to reproduce what you are 
seeing.

Matthias.

From john.hayden at nokia.com  Sat Jun  1 15:56:02 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Sat, 1 Jun 2013 14:56:02 +0000
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <51AA069B.2060606@rabbitmq.com>
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224D9487@008-AM1MPN1-043.mgdnok.nokia.com>

They are attached

On 6/1/13 10:35 AM, "ext Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 01/06/13 15:29, john.hayden at nokia.com wrote:
>> Yes
>
>Oh well. No idea what could be the problem then. If you send us the
>entire broker config (output of 'rabbitmqctl report'), as well as the
>contents of your rabbitmq.config, we can try to reproduce what you are
>seeing.
>
>Matthias.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit1.report
Type: application/octet-stream
Size: 16162 bytes
Desc: rabbit1.report
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130601/2eedcc93/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit2.report
Type: application/octet-stream
Size: 7935 bytes
Desc: rabbit2.report
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130601/2eedcc93/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq.config.onRabbit1
Type: application/octet-stream
Size: 309 bytes
Desc: rabbitmq.config.onRabbit1
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130601/2eedcc93/attachment-0002.obj>

From matthias at rabbitmq.com  Sat Jun  1 16:04:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 01 Jun 2013 16:04:07 +0100
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <8607A672AFB05B4D804456463DD7DCCF224D9487@008-AM1MPN1-043.mgdnok.nokia.com>
References: <8607A672AFB05B4D804456463DD7DCCF224D9487@008-AM1MPN1-043.mgdnok.nokia.com>
Message-ID: <51AA0D67.1010706@rabbitmq.com>

On 01/06/13 15:56, john.hayden at nokia.com wrote:
> They are attached

The report shows that your vhost is called '/sensu', not 'sensu'.

So either delete the former and set up the latter, or change the source 
URI in the shovel to read "amqp://sensu:mypass@/%2fsensu" (and, I'm 
guessing, similarly for the destination URI).

Matthias.

From john.hayden at nokia.com  Sat Jun  1 16:25:05 2013
From: john.hayden at nokia.com (john.hayden at nokia.com)
Date: Sat, 1 Jun 2013 15:25:05 +0000
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <51AA0D67.1010706@rabbitmq.com>
Message-ID: <8607A672AFB05B4D804456463DD7DCCF224D94DD@008-AM1MPN1-043.mgdnok.nokia.com>

Wow!

Thank you is not enough as I probably never would have found that.

Thank you again!

John Hayden

On 6/1/13 11:04 AM, "ext Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 01/06/13 15:56, john.hayden at nokia.com wrote:
>> They are attached
>
>The report shows that your vhost is called '/sensu', not 'sensu'.
>
>So either delete the former and set up the latter, or change the source
>URI in the shovel to read "amqp://sensu:mypass@/%2fsensu" (and, I'm
>guessing, similarly for the destination URI).
>
>Matthias.


From matthias at rabbitmq.com  Sat Jun  1 17:45:33 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 01 Jun 2013 17:45:33 +0100
Subject: [rabbitmq-discuss] Shovel authentication question (possible bug)
In-Reply-To: <8607A672AFB05B4D804456463DD7DCCF224D94DD@008-AM1MPN1-043.mgdnok.nokia.com>
References: <8607A672AFB05B4D804456463DD7DCCF224D94DD@008-AM1MPN1-043.mgdnok.nokia.com>
Message-ID: <51AA252D.9070109@rabbitmq.com>

John,

On 01/06/13 16:25, john.hayden at nokia.com wrote:
> Thank you is not enough as I probably never would have found that.

No problem.

The error reporting during the establishment of direct connections is 
less than helpful. I will file a bug to get that improved.

Matthias.

From dburgan at peopleanswers.com  Sat Jun  1 23:20:19 2013
From: dburgan at peopleanswers.com (Darrell Burgan)
Date: Sat, 1 Jun 2013 15:20:19 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
Message-ID: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>

First let me say I absolutely love RabbitMQ. Fabulous uptime and 
zero-headaches. I don't even worry about it every going down, it is so 
stable. An outstanding product.

I'm sure I'm doing something totally dumb, but I've tried everything I can 
think of and I am stumped. I am trying to use the HTTP API to do external 
monitoring of my RabbitMQ instances from Nagios. I discovered the HTTP API, 
which is awesome. The only trouble is that no matter what query I run via 
the HTTP API, the rates always come back as 0.0. For example:

http://xxx:15672/api/overview?columns=message_stats.deliver_get_details.rate

This URL yields the following JSON:

{"message_stats":{"deliver_get_details":{"rate":0.0}}}


Note that the rate is 0.0. This is on a production server that is processing between 100 and 1000 messages per second. Same for this URL:


http://xxx:15672/api/overview?columns=message_stats.publish_details.rate


Yields:


{"message_stats":{"publish_details":{"rate":0.0}}}


I've verified that statistics are being gathered fine-grained.


Just for my own sanity management, I've attached a snippet of the management console from the same server that shows these rates are much higher than zero:


<https://lh6.googleusercontent.com/-XOjxEDFVhrA/UapynVGypWI/AAAAAAAAAAs/mG9ipbSjiN0/s1600/rabbitmq.png>

So I am stumped. I really want to run an HTTP API query that returns the "651" and "662" shown in the above image, but I cannot find it anywhere in the JSON the HTTP API returns. I have looked at the results for the following API calls to no avail:


/api/overview

/api/nodes

/api/connections

/api/channels

/api/exchanges

/api/queues

/api/vhosts


Any suggestions?


Thanks so much in advance!


Darrell Burgan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130601/409d24a8/attachment.htm>

From mantuano.fedele at gmail.com  Sun Jun  2 12:32:32 2013
From: mantuano.fedele at gmail.com (Fedele Mantuano)
Date: Sun, 2 Jun 2013 04:32:32 -0700 (PDT)
Subject: [rabbitmq-discuss] connection closed abruptly errors on logs
In-Reply-To: <3A4FD6E5-5454-4712-92C7-55A9B8E20C92@yahoo.com>
References: <237032.46347.qm@web111010.mail.gq1.yahoo.com>
	<yrv4cr5iqlczo.fsf@dwragg.eng.vmware.com>
	<yrv4cmxtelcw3.fsf@dwragg.eng.vmware.com>
	<3A4FD6E5-5454-4712-92C7-55A9B8E20C92@yahoo.com>
Message-ID: <5e4d7efb-6450-4585-9307-5a14d7e255f8@googlegroups.com>


Sorry I have the same problem. Can you give me di solution?

Thanks a lot

Il giorno mercoled? 28 luglio 2010 15:02:27 UTC+2, Dave Greggory ha scritto:
>
> That's exactly what it was. Thanks for helping me clear that up. 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130602/fb135ea0/attachment.htm>

From shomron at gmail.com  Sun Jun  2 17:26:59 2013
From: shomron at gmail.com (Oren Shomron)
Date: Sun, 2 Jun 2013 09:26:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to start rabbitmq-server on a fresh
	installed server
In-Reply-To: <8c3b4908-9445-487e-a645-6d2951007821@googlegroups.com>
References: <8c3b4908-9445-487e-a645-6d2951007821@googlegroups.com>
Message-ID: <939e0ae3-14af-46ae-b09f-216c50f73cba@googlegroups.com>

I've had this happen to me as well.
Killing epmd by hand and then starting RabbitMQ seemed to do the job.

Also, make sure name resolution is working for your local node name - this 
also can cause RabbitMQ to fail to start.

  - Oren

On Friday, May 31, 2013 10:44:40 AM UTC-4, Steven Yue wrote:
>
> Hi, everyone
>
> I'm trying to install rabbitmq-server on my VPS server. The server is 
> running newly fresh installed Ubuntu 12.04, and the rabbitmq is installed 
> from APT repository.
>
> The console shows this information:
>
> * Starting message broker rabbitmq-server
> * FAILED - check /var/log/rabbitmq/startup_\{log, _err\}
>
>
> And I check the log file, it shows this:
>
> ERROR: node with name "rabbit" already running on "mydomain"
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit@ mydomain]
>
> hosts, their running nodes and ports:
> - mydomain: [{rabbit,56948}]
>
> current node details:
> - node name: rabbitmqprelaunch5633@ mydomain
> - home dir: /var/lib/rabbitmq
> - cookie hash: AfrR2Uw6t3aBV6UMzo2KHA==
>
> When I run 'ps aux | grep rabbit', I get this:
>
> rabbitmq  5607  0.0  0.0   7416   316 ?        S    14:55   0:00 
> /usr/lib/erlang/erts-5.8.5/bin/epmd -daemon
>
> I tried to stop the server, by running:
>
> sudo rabbitmqctl stop
>
> And it show: Error: unable to connect to node rabbit@ mydomain: nodedown
>
> I've tried to google this problem, and followed those instructions in the 
> following posts, but still couldn't get any luck:
>
> http://stackoverflow.com/questions/8737754/node-with-name-rabbit-already-running-but-also-unable-to-connect-to-node
> http://stackoverflow.com/questions/10347751/rabbitmq-refusing-to-start
>
> I want to know why this happens on a newly install server? And can anyone 
> help me out to solve this?
>
> Thanks
>
> Steven
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130602/2164a148/attachment.htm>

From yonmost at gmail.com  Mon Jun  3 06:08:12 2013
From: yonmost at gmail.com (Joe)
Date: Sun, 2 Jun 2013 22:08:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Low disk space causes RabbitMQ to loose messages
 instead of blocking the connection
Message-ID: <1370236092874-27157.post@n5.nabble.com>

I have a java application that publishes messages to a RabbitMQ server. 
When the available disk space drops below rabbit's low watermark I get
unexpected behavior.  

The expected behavior is that  the connection will become blocking
<http://www.rabbitmq.com/memory.html>  , making my application hang on the
call to /Channel.basicPublish/.

The actual behavior is that the connection appears to be blocking in the
management console, but calls to /Channel.basicPublish/ return with no
errors and the messages that were supposed to be published are lost.  
This behavior undermines the most important feature of RabbitMQ, which is
robustness.

Below is a minimal version of my application for testing. All it does is
publish a message every second with an incrementing index (1, 2, 3, ...).
The messages are received just fine by the RabbitMQ server, until I set the
low watermark to a very high value, by putting the following line in the
/rabbitmq.config/ file:

    [    
      {rabbit, [{disk_free_limit, 60000000000}]}
    ].

After restarting the server, I get a low disk space notification in the
management console, the connection is marked as 'blocking', and no more
messages are received by the server. However, the application keeps running
and sending messages as if nothing is wrong. When I reduce the watermark
back to a normal value messages are received by the server again, but all
the messages that were sent while the connection was blocking are lost.

 - *Am I doing something wrong?*
 - *Is this a bug in RabbitMQ?*
 - *If so, is there a workaround?*

OS: Windows 8 64bit  
RabbitMQ server version: 3.1.1  
RabbitMQ Java client version: 3.1.0  

Test application code:

    import com.rabbitmq.client.Channel;
    import com.rabbitmq.client.Connection;
    import com.rabbitmq.client.ConnectionFactory;
    import com.rabbitmq.client.MessageProperties;
    import org.slf4j.Logger;
    import org.slf4j.LoggerFactory;
    import java.io.IOException;
    
    public class Main {
    
        private final static Logger logger =
LoggerFactory.getLogger(Main.class);
        private final static String QUEUE_NAME = "testQueue";
    
        private static Channel channel = null;
    
        private static void connectToRabbitMQ() throws IOException {
            ConnectionFactory factory = new ConnectionFactory();
            Connection connection = factory.newConnection();
            channel = connection.createChannel();
            channel.queueDeclare(
                    QUEUE_NAME,
                    true,       // Durable - survive a server restart
                    false,      // Not exclusive to this connection
                    false,      // Do not autodelete when no longer in use
                    null        // Arguments
            );
        }
    
        private static void disposeChannel()
        {
            if (channel == null) {
                return;
            }
            try {
                channel.close();
            } catch (Exception e) {
            } finally {
                channel = null;
            }
        }
    
        public static void main(String[] args) throws Exception {
    
            boolean interrupted = false;
            int messageNumber = 1;
    
            while (!interrupted) {
                byte[] message = Integer.toString(messageNumber).getBytes();
                try {
                    if (channel == null) {
                        connectToRabbitMQ();
                    }
                    channel.basicPublish(
                            "",
                            QUEUE_NAME,
                            MessageProperties.MINIMAL_PERSISTENT_BASIC,
                            message
                    );
                    logger.info("Published message number {}",
messageNumber);
                    messageNumber++;
                } catch (Exception e) {
                    logger.info("Unable to connect to RabbitMQ...");
                    disposeChannel();
                }
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    logger.info("Interrupted");
                    interrupted = true;
                }
            }
        }
    }



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Low-disk-space-causes-RabbitMQ-to-loose-messages-instead-of-blocking-the-connection-tp27157.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From pawansingh68 at gmail.com  Mon Jun  3 07:43:55 2013
From: pawansingh68 at gmail.com (pawanksingh)
Date: Sun, 2 Jun 2013 23:43:55 -0700 (PDT)
Subject: [rabbitmq-discuss] In RabbitMQ-C Getting AMQP_CHANNEL_CLOSE_METHOD
 without closing channel
Message-ID: <1370241835237-27158.post@n5.nabble.com>

I am Getting AMQP_CHANNEL_CLOSE_METHOD without closing any channel.
Because of this prob i have to run my program again and again for sending
and receiving msg.
Can anybody help me on this issue.
this is receiving and publishing code
while (1)
	{
		conn=Get_Server_Connection(index+MAX_CLIENTS);
		printf("\n__INDEX__%d CTM to client Entering while ........\n", index);
		amqp_maybe_release_buffers(conn);
		result = amqp_simple_wait_frame(conn, &frame);
		HU_ENABLE_DEBUG_INFO_PRINTS(("Result %d\n", result));
		if (result < 0)
		break;

		printf("__INDEX__%d CTM to client Frame type %d, channel %d\n", index,
frame.frame_type, frame.channel);
		if (frame.frame_type != AMQP_FRAME_METHOD)
		continue;

		printf("__INDEX__%d CTM to client Method %s\n", index,
amqp_method_name(frame.payload.method.id));
		if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
		continue;

		d = (amqp_basic_deliver_t *) frame.payload.method.decoded;

		printf("__INDEX__%d CTM to client Delivery %u, exchange %.*s routingkey
%.*s\n",index,
		(unsigned) d->delivery_tag,
		(int) d->exchange.len, (char *) d->exchange.bytes,
		(int) d->routing_key.len, (char *) d->routing_key.bytes);

		result = amqp_simple_wait_frame(conn, &frame);
		if (result < 0)
		break;

		if (frame.frame_type != AMQP_FRAME_HEADER)
		{
			fprintf(stderr, "Expected header!");
			abort();
		}

		p = (amqp_basic_properties_t *) frame.payload.properties.decoded;
		if (p->_flags & AMQP_BASIC_CONTENT_TYPE_FLAG)
		{
			printf("__INDEX__%d Content-type: %.*s\n", index,(int)
p->content_type.len, (char *) p->content_type.bytes);
		}
		HU_ENABLE_DEBUG_INFO_PRINTS(("----\n"));

		body_target = frame.payload.properties.body_size;
		body_received = 0;

		msg.bytes=calloc(((frame.payload.properties.body_size)+1),1);
		msg.len=frame.payload.properties.body_size;
		while (body_received < body_target)
		{
			result = amqp_simple_wait_frame(conn, &frame);
			if (result < 0)
			break;

			if (frame.frame_type != AMQP_FRAME_BODY)
			{
				fprintf(stderr, "Expected body!");
				abort();
			}

			body_received += frame.payload.body_fragment.len;
			assert(body_received <= body_target);

		
strncat(msg.bytes,frame.payload.body_fragment.bytes,frame.payload.body_fragment.len);


		}

		if (body_received != body_target)
		{
			/* Can only happen when amqp_simple_wait_frame returns <= 0 */
			/* We break here to close the connection */
			break;
		}
		else
		{
			char *p;
			int Message_Type;
			printf("pawanread1\n");
			printf("routing=%s\n",(char *) d->routing_key.bytes);
			p = strtok (((char *) d->routing_key.bytes),"_");
			printf("pawanread2\n");
			p=strtok (NULL,"_");
			printf("pawanread3\n");
//			amqp_basic_ack(conn,
Client_Connect[index].Queue_Info[Message_Type].listner_channel,
d->delivery_tag, 0);// giving acknowledgment for consumer
			p=strtok (NULL,"_");
			printf("pawanread4\n");
			p=strtok (NULL,"_");
			printf("pawanread5\n");
			Message_Type=atoi(p);
			printf("CTM to client Message_Type=%d\n",Message_Type);

			{
				printf("CTM to client index=%d response=%d exchange=%s
routing=%s\n",index,Client_Connect[index].Queue_Info[Message_Type].response_channel,Client_Connect[index].exchange,Client_Connect[index].Queue_Info[Message_Type].routingkey);
				amqp_basic_properties_t props;
				props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG |
AMQP_BASIC_DELIVERY_MODE_FLAG;
				props.content_type = amqp_cstring_bytes("text/plain");
				props.delivery_mode = 2; // persistent delivery mode

				die_on_error(amqp_basic_publish(conn,
											Client_Connect[index].Queue_Info[Message_Type].response_channel,
											amqp_cstring_bytes(Client_Connect[index].exchange),
										
amqp_cstring_bytes(Client_Connect[index].Queue_Info[Message_Type].routingkey),
											1,
											0,
											&props,
											msg),
											"Publishing to Client");
			}
			amqp_basic_ack(conn, frame.channel, d->delivery_tag, 0);
			free(msg.bytes);

		}

	}/*End while*/



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/In-RabbitMQ-C-Getting-AMQP-CHANNEL-CLOSE-METHOD-without-closing-channel-tp27158.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Jun  3 10:32:38 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 03 Jun 2013 10:32:38 +0100
Subject: [rabbitmq-discuss] Low disk space causes RabbitMQ to lose
 messages instead of blocking the connection
In-Reply-To: <1370236092874-27157.post@n5.nabble.com>
References: <1370236092874-27157.post@n5.nabble.com>
Message-ID: <51AC62B6.5080708@rabbitmq.com>


Hi,


On 03/06/13 06:08, Joe wrote:

>  - *Am I doing something wrong?*
>  - *Is this a bug in RabbitMQ?*
>  - *If so, is there a workaround?*

You are probably publishing into network buffers while the resource
alarm is set. Since the messages are tiny in your example, the network
buffers will take a while to fill up, but they will eventually fill up
and block publishers. Reducing the network buffer size will speed this up.

If you sever the connection before the messages reach the broker then
they will be lost. If the connection remains up when the resource alarm
is cleared then all messages will eventually make their way to the
broker. Use publisher confirms to avoid the possibility of message loss
when publishing: http://www.rabbitmq.com/confirms.html

Inserting "channel.waitForConfirms();" immediately after the publish
step will reduce overall throughput, but make the effect of the resource
block apparent to publishers immediately.



-Emile





From emile at rabbitmq.com  Mon Jun  3 10:54:20 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 03 Jun 2013 10:54:20 +0100
Subject: [rabbitmq-discuss] In RabbitMQ-C Getting
 AMQP_CHANNEL_CLOSE_METHOD without closing channel
In-Reply-To: <1370241835237-27158.post@n5.nabble.com>
References: <1370241835237-27158.post@n5.nabble.com>
Message-ID: <51AC67CC.10904@rabbitmq.com>


Hi,

On 03/06/13 07:43, pawanksingh wrote:
> I am Getting AMQP_CHANNEL_CLOSE_METHOD without closing any channel.


This is likely due to a channel exception. In that case the broker
logfile will also have an explanation of the problem.



-Emile










From simon at rabbitmq.com  Mon Jun  3 11:04:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Jun 2013 11:04:24 +0100
Subject: [rabbitmq-discuss] Many fanout exchanges or fewer direct
 exchanges with routing keys
In-Reply-To: <CAGxVCqwmVBGa9TUAxr7dcdYSvvSeiF0n4bgpLawx10uOO9frLQ@mail.gmail.com>
References: <CAGxVCqwmVBGa9TUAxr7dcdYSvvSeiF0n4bgpLawx10uOO9frLQ@mail.gmail.com>
Message-ID: <51AC6A28.6030405@rabbitmq.com>

The canonical answer is to run your own tests :-) But if I had to guess 
I'd say you might get marginally faster performance from many fanout 
exchanges.

Cheers, Simon

On 31/05/13 17:19, ???? ??????? wrote:
> Hi,
>
> I've been trying to use RabbitMQ and faced the following question.
>
> I need to intensively broadcast 10 types of messages (so there will be
> many consumers for each message type) and each type has ~100 subtypes.
>
> I wonder which of the following approaches is better:
>
>  1.
>
>     Create a direct exchange for each message type and send messages
>     with a routing key (subtype name) and consumers will be connected
>       with a temporary queue. (Because there is no complex routing keys
>     like 'key1.key2.*' I decided not to use topic exchange).
>
>  2.
>
>     Create a fanout exchange for each message subtype (something around
>     1000 exchanges).
>
> Best regards,
> Oleg
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun  3 11:24:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Jun 2013 11:24:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
In-Reply-To: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
Message-ID: <51AC6EEE.3000208@rabbitmq.com>

Hmm, not sure I can say much more than "works for me".

The numbers that are shown in the web UI are taken from the request 
http://xxx:15672/api/overview (albeit without the ?columns= parameter); 
there is only one source for these numbers.

One thing you might want to check is if you are using a different user 
for web UI vs nagios. Users that do not have the "administrator" or 
"monitoring" tags will only see message rates for vhosts they have 
access to - could you be seeing that?

Another possibility (and I know this might sound patronising, but we all 
make mistakes) - are you talking to the same server in each case?

Cheers, Simon

On 01/06/13 23:20, Darrell Burgan wrote:
> First let me say I absolutely love RabbitMQ. Fabulous uptime and
> zero-headaches. I don't even worry about it every going down, it is so
> stable. An outstanding product.
>
> I'm sure I'm doing something totally dumb, but I've tried everything I
> can think of and I am stumped. I am trying to use the HTTP API to do
> external monitoring of my RabbitMQ instances from Nagios. I discovered
> the HTTP API, which is awesome. The only trouble is that no matter what
> query I run via the HTTP API, the rates always come back as 0.0. For
> example:
>
> http://xxx:15672/api/overview?columns=message_stats.deliver_get_details.rate
>
> This URL yields the following JSON:
>
> {"message_stats":{"deliver_get_details":{"rate":0.0}}}
>
>
> Note that the rate is 0.0. This is on a production server that is processing between 100 and 1000 messages per second. Same for this URL:
>
>
> http://xxx:15672/api/overview?columns=message_stats.publish_details.rate
>
>
> Yields:
>
>
> {"message_stats":{"publish_details":{"rate":0.0}}}
>
>
> I've verified that statistics are being gathered fine-grained.
>
>
> Just for my own sanity management, I've attached a snippet of the management console from the same server that shows these rates are much higher than zero:
>
>
> <https://lh6.googleusercontent.com/-XOjxEDFVhrA/UapynVGypWI/AAAAAAAAAAs/mG9ipbSjiN0/s1600/rabbitmq.png>
>
> So I am stumped. I really want to run an HTTP API query that returns the "651" and "662" shown in the above image, but I cannot find it anywhere in the JSON the HTTP API returns. I have looked at the results for the following API calls to no avail:
>
>
> /api/overview
>
> /api/nodes
>
> /api/connections
>
> /api/channels
>
> /api/exchanges
>
> /api/queues
>
> /api/vhosts
>
>
> Any suggestions?
>
>
> Thanks so much in advance!
>
>
> Darrell Burgan
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Mon Jun  3 11:28:08 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 03 Jun 2013 11:28:08 +0100
Subject: [rabbitmq-discuss] Unable to start rabbitmq-server on a fresh
 installed server
In-Reply-To: <8c3b4908-9445-487e-a645-6d2951007821@googlegroups.com>
References: <8c3b4908-9445-487e-a645-6d2951007821@googlegroups.com>
Message-ID: <51AC6FB8.5050209@rabbitmq.com>



On 31/05/13 15:44, Steven Yue wrote:

> nodes in question: [rabbit@ mydomain]
> 
> hosts, their running nodes and ports:
> - mydomain: [{rabbit,56948}]


From videlalvaro at gmail.com  Mon Jun  3 11:32:27 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 3 Jun 2013 12:32:27 +0200
Subject: [rabbitmq-discuss] Writing RabbitMQ plugins with Elixir
Message-ID: <CAMcAHLUmfo_81df3XQkg59RUxsLUCbJ6Cj6dSCA3PGOb4qNJfA@mail.gmail.com>

Hi,

I'd like to share a little experiment where I wrote a RabbitMQ plugin using
Elixir http://elixir-lang.org/

If you wanted to write some RabbitMQ plugins but maybe Erlang syntax is a
bit off putting then maybe you could try with Elixir, which has a Ruby look
and feel. Read more here: http://elixir-lang.org/

I wrote about the process of creating the plugin here:

http://videlalvaro.github.io/2013/06/writing-rabbitmq-plugins-with-elixir.html

And you can find the source code here:

https://github.com/videlalvaro/rabbitmq-recent-history-exchange-elixir/

Let me know what you think about the project. If you find any issues,
please report them on github.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/1975848d/attachment.htm>

From emile at rabbitmq.com  Mon Jun  3 11:35:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 03 Jun 2013 11:35:33 +0100
Subject: [rabbitmq-discuss] connection closed abruptly errors on logs
In-Reply-To: <5e4d7efb-6450-4585-9307-5a14d7e255f8@googlegroups.com>
References: <237032.46347.qm@web111010.mail.gq1.yahoo.com>
	<yrv4cr5iqlczo.fsf@dwragg.eng.vmware.com>
	<yrv4cmxtelcw3.fsf@dwragg.eng.vmware.com>
	<3A4FD6E5-5454-4712-92C7-55A9B8E20C92@yahoo.com>
	<5e4d7efb-6450-4585-9307-5a14d7e255f8@googlegroups.com>
Message-ID: <51AC7175.4080209@rabbitmq.com>

On 02/06/13 12:32, Fedele Mantuano wrote:
> 
> Sorry I have the same problem. Can you give me di solution?



The log entries can safely be ignored if caused by loadbalancer liveness
tests. You can set the "log_levels" configuration to reduce the noise if
you don't want these entries to fill up the logfile. An alternative is
to use a loadbalancer that establishes and tears down AMQP connections
instead of just TCP connections.



-Emile







From simon at rabbitmq.com  Mon Jun  3 11:36:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Jun 2013 11:36:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <7F7BFE76D0F5234F9258D88C37C9EC6B151F43A4@VALVCSMBX001PH.val.vlss.local>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
	<5199FB29.70306@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>
	<51A8D0B9.7040200@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F43A4@VALVCSMBX001PH.val.vlss.local>
Message-ID: <51AC71B2.4050504@rabbitmq.com>

Just to be clear - at what point in this test are you unblocking the 
connection so the partition can heal?

Cheers, Simon

On 31/05/13 20:04, Maslinski, Ray wrote:
> The net_ticktime is using the default value, and event sequence seems
> consistent with the associated timeout.
>
> Roughly,
>
> Start test
>
> Block cluster connection at some point -> trace data shows that only
> publish events are occurring after this happens
>
> After a bit more than a minute, RabbitMQ server log shows lost
> cluster connection on both nodes, along with the death of the mirrors
> and promotion of slave to master.
>
> Test continues and completes publish phase, since these appeared to
> be progressing normally, with no errors visible to client
>
> Test then starts to verify that all messages were received by polling
> the contents of a buffer used to store incoming messages.  In a
> normal scenario without faults, this generally means that the first
> poll finds all the messages expected to be present and test completes
> successfully.  Otherwise, the poll rechecks for any missing messages
> once per second, and gives up if 30 seconds elapse without any new
> messages showing up (timer is reset if any messages arrived during
> polling window).
>
> The slow trickle of messages occurs during the last phase, as one
> appears to arrive every 14 seconds and the polling loop continues to
> retry.  Trace data doesn't appear to log any deliver events during
> this stage, but console shows a slow increment in the number of
> unacknowledged messages that lines up with the delivery rate observed
> by the client.
>
> Ray Maslinski Senior Software Developer, Engineering Valassis /
> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
> www.valassis.com
>
> Creating the future of intelligent media delivery to drive your
> greatest success
>
> _____________________________________________________________________________
>
>  This message may include proprietary or protected information. If
> you are not the intended recipient, please notify me, delete this
> message and do not further communicate the information contained
> herein without my express consent.
>
>
> -----Original Message----- From: Simon MacMullen
> [mailto:simon at rabbitmq.com] Sent: Friday, May 31, 2013 12:33 PM To:
> Maslinski, Ray Cc: Discussions about RabbitMQ Subject: Re:
> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures
> when recovering from cluster partition
>
> Hi. The behaviour you describe doesn't really match what I would
> expect to see. In the beginning of a partition I would expect:
>
> 1) Partition starts
>
> 2) Things behave slowly for approximately net_ticktime (see
> http://www.rabbitmq.com/partitions.html#net_ticktime) as nodes
> attempt to contact each other and time out
>
> 3) On each node, Erlang decides the other nodes are down. Things
> speed up again, HA queues fail over. Split-brain has begun.
>
> It sounds like you were stuck in 2) for an extended period of time.
> Have you changed net_ticktime?
>
> Alternatively, when testing partitions I have see really odd
> behaviour by blocking network traffic in one direction only with
> iptables. You might want to check if you've done that by mistake.
>
> Cheers, Simon
>
> On 30/05/13 22:14, Maslinski, Ray wrote:
>> Follow-up question ...
>>
>> I tried some experiments to gain some understanding of how the
>> cluster behaved with clients attached during a network partition
>> event. Essentially, I repeated the previous tests described below
>> for autohealing and automatic queue synchronization, but left the
>> cluster communications port blocked while the client test
>> completed. One oddity I noticed was that while the consumer
>> connected to the slave appeared to receive an indication that
>> something was amiss (client log showed a consumer cancel exception
>> being handled by the Spring AMQP framework, and other monitoring
>> logs appeared to show the client restarting a connection, which
>> seems to be consistent with documentation), the consumer connected
>> to the master seemed to remain oblivious to any possible issues.
>> That consumer continued to receive messages, but at an extremely
>> slow rate (test published at 16/sec fixed rate, but the remaining
>> consumer began to receive messages at the rate of about 1 every 14
>> seconds).
>>
>> Since the test client waits around for expected message deliveries
>> with a resettable 30 second timeout, it continued to run for an
>> extended period of time (longer than I waited around for).  In
>> addition, the admin console showed a relatively small number of
>> unacked messages on that server, with the unacked count increasing
>> with each actual delivery (client should always be acknowledging
>> in the test setup, and reported no errors).  Eventually unblocking
>> the cluster port released a bunch of messages in a short interval
>> (albeit with some lost, as described previously).
>>
>> I also saw  producer connections go into flow control during the
>> outage and remain there during the slow consumer delivery (though
>> the test had long since completed delivering all its messages).
>>
>> Does this sound like expected behavior during a partition?
>>
>> Ray Maslinski Senior Software Developer, Engineering Valassis /
>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
>> www.valassis.com
>>
>> Creating the future of intelligent media delivery to drive your
>> greatest success
>>
>> ______________________________________________________________________
>>
>>
_______
>>
>> This message may include proprietary or protected information. If
>> you are not the intended recipient, please notify me, delete this
>> message and do not further communicate the information contained
>> herein without my express consent.
>>
>> -----Original Message----- From: Simon MacMullen
>> [mailto:simon at rabbitmq.com] Sent: Monday, May 20, 2013 6:30 AM To:
>> Discussions about RabbitMQ Cc: Maslinski, Ray Subject: Re:
>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
>> failures when recovering from cluster partition
>>
>> On 17/05/13 20:38, Maslinski, Ray wrote:
>>> Hello,
>>
>> Hi!
>>
>>> To simulate a network partition failure, I've been using iptables
>>> to temporarily block inbound and outbound access on one of the
>>> nodes to the single port configured for cluster communications
>>> through inet_dist_listen_min and inet_dist_listen_max settings
>>> (min = max). Client access is not blocked during a simulated
>>> partition fault.
>>
>> Sounds reasonable.
>>
>>> I've observed two anomalies during testing that I wasn't
>>> expecting based on the documentation I've read:
>>>
>>> -At a sufficiently high message rate, some number of messages
>>> will be lost during the fault sequence, with the number lost
>>> tending to increase with message rate.  No indication of a send
>>> error has been observed by the client program. Based on results
>>> obtained from test logs and an independent monitor listening on
>>> trace messages from each node, it appears that as soon as the
>>> port is blocked, both nodes continue to accept published
>>> messages, but (temporarily) stop delivering messages until the
>>> cluster heartbeat failure is detected, at which point the cluster
>>> is partitioned and the slave promotes itself to become master. In
>>> the sequences I've looked at, the messages that are lost all
>>> appear to be published to the original master (and final master
>>> after a winner is selected during autoheal). Neither the start
>>> nor the end of the lost message window appear to line up with any
>>> events in the logs, other than the start occurring sometime after
>>> the port connection is blocked but before the cluster heartbeat
>>> failure is detected, and the end occurring sometime after the
>>> detection of the cluster heartbeat failure and before the
>>> detection of the partitioned cluster after the connection is
>>> unblocked.  Is message loss to be expected in this scenario?
>>
>> I would expect to see message loss in a cluster heal scenario.
>>
>> It's important to remember that a cluster partition is still a
>> substantial problem, and the healing process involves throwing
>> state away. Autoheal mode just means you get through this process
>> faster, and hopefully spend much less time accepting messages that
>> will end up being lost.
>>
>> I would expect intuitively that only messages from the losing
>> partitions would be lost. But I am not entirely surprised if
>> messages from the winner are lost too; there is a period after the
>> partitions have come back together but before autoheal kicks in
>> during which we will have multiple masters for a queue, and
>> behaviour can be unpredictable.
>>
>>> -Occasionally the autoheal loser node fails to rejoin the
>>> cluster after restart.  I don't have a lot of data points on this
>>> one since it's only happened a handful of times during overnight
>>> test iterations.  During one failure, the autoheal winner showed
>>> the log message below during recovery:
>>
>> Ah, that looks like a bug in autoheal. I think the stack trace you
>> posted should contain enough information to fix it. Thanks.
>>
>> Cheers, Simon
>>
>> -- Simon MacMullen RabbitMQ, Pivotal
>>
>
>
> -- Simon MacMullen RabbitMQ, Pivotal
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From tamiragamy at gmail.com  Mon Jun  3 11:12:11 2013
From: tamiragamy at gmail.com (Tamir Agamy)
Date: Mon, 3 Jun 2013 13:12:11 +0300
Subject: [rabbitmq-discuss] Bindings
Message-ID: <CAM6Sp4ZswRQCXCW68fSZ9PDBZhiF2HVJP0j+qoORgqhf4dSW-g@mail.gmail.com>

Hello,

I am new to RabbitMQ and have a few questions about the subscribing process.

I have followed the tutorials and I'm having trouble understanding a few
things:
1. Where does the subscribing process begins, where does it end?
2. When binding a queue, what really happens? is the binding information
being forward via the
    server to the exchange, where it is entered to a binding list? or is
the information saved at the
    server and the exchange has to inquire the server whenever it gets a
message from the producer?

I would love some information on this manners.

With regards,
Tamir
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/f2ec88a6/attachment.htm>

From videlalvaro at gmail.com  Mon Jun  3 11:47:27 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 3 Jun 2013 12:47:27 +0200
Subject: [rabbitmq-discuss] Bindings
In-Reply-To: <CAM6Sp4ZswRQCXCW68fSZ9PDBZhiF2HVJP0j+qoORgqhf4dSW-g@mail.gmail.com>
References: <CAM6Sp4ZswRQCXCW68fSZ9PDBZhiF2HVJP0j+qoORgqhf4dSW-g@mail.gmail.com>
Message-ID: <CAMcAHLWzfdgxu9xcnX2vYCqO9V--=x2K5TKoRpZwuif97jmnPw@mail.gmail.com>

Hi,

The exchange "lives" inside the server.

A binding is a new entry in RabbitMQ's internal database, and yes, whenever
a message arrives, the exchange will consult that database to find the list
of queues that matches the routing rules imposed by the exchange type.

Regards,

Alvaro




On Mon, Jun 3, 2013 at 12:12 PM, Tamir Agamy <tamiragamy at gmail.com> wrote:

> Hello,
>
> I am new to RabbitMQ and have a few questions about the subscribing
> process.
>
> I have followed the tutorials and I'm having trouble understanding a few
> things:
> 1. Where does the subscribing process begins, where does it end?
> 2. When binding a queue, what really happens? is the binding information
> being forward via the
>     server to the exchange, where it is entered to a binding list? or is
> the information saved at the
>     server and the exchange has to inquire the server whenever it gets a
> message from the producer?
>
> I would love some information on this manners.
>
> With regards,
> Tamir
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/30ec226f/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jun  3 11:49:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 3 Jun 2013 14:49:15 +0400
Subject: [rabbitmq-discuss] Bindings
In-Reply-To: <CAM6Sp4ZswRQCXCW68fSZ9PDBZhiF2HVJP0j+qoORgqhf4dSW-g@mail.gmail.com>
References: <CAM6Sp4ZswRQCXCW68fSZ9PDBZhiF2HVJP0j+qoORgqhf4dSW-g@mail.gmail.com>
Message-ID: <CAE3HoVSu1Yi_uWTwa9w987V4mpgw-hkff1Axa-ZFkjiBorcbQg@mail.gmail.com>

2013/6/3 Tamir Agamy <tamiragamy at gmail.com>

> 1. Where does the subscribing process begins, where does it end?
>

When you cancel the consumer. If by "subscription" you mean "binding", when
you unbind a queue from an exchange.

Also, if you delete an exchange or a queue, all bindings are deleted as
well.


> 2. When binding a queue, what really happens? is the binding information
> being forward via the
>     server to the exchange, where it is entered to a binding list? or is
> the information saved at the
>     server and the exchange has to inquire the server whenever it gets a
> message from the producer?


Bindings are stored in a distributed database that all RabbitMQ cluster
nodes can access.

See rabbitmq.com/tutorials/amqp-concepts.html as well.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/a49531a5/attachment.htm>

From emile at rabbitmq.com  Mon Jun  3 11:53:22 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 03 Jun 2013 11:53:22 +0100
Subject: [rabbitmq-discuss] Bindings
In-Reply-To: <CAM6Sp4ZswRQCXCW68fSZ9PDBZhiF2HVJP0j+qoORgqhf4dSW-g@mail.gmail.com>
References: <CAM6Sp4ZswRQCXCW68fSZ9PDBZhiF2HVJP0j+qoORgqhf4dSW-g@mail.gmail.com>
Message-ID: <51AC75A2.7020106@rabbitmq.com>


Hi,


On 03/06/13 11:12, Tamir Agamy wrote:
> 1. Where does the subscribing process begins, where does it end?

Consumers logically start with the basic.consume AMQP method. They
disappear when then channel closes or when the subscription is cancelled.

> 2. When binding a queue, what really happens? is the binding information
> being forward via the
>     server to the exchange, where it is entered to a binding list? or is
> the information saved at the
>     server and the exchange has to inquire the server whenever it gets a
> message from the producer?

Exchanges don't really exist as independent entities in the broker. The
bindings are stored in an internal database. This database is queried
each time a message is received.


The introduction to AMQP concepts contains a section on bindings which
might be helpful:

http://www.rabbitmq.com/tutorials/amqp-concepts.html#bindings




-Emile







From tim at rabbitmq.com  Mon Jun  3 11:57:58 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 3 Jun 2013 11:57:58 +0100
Subject: [rabbitmq-discuss] Tag on RabbitMQ Lager
In-Reply-To: <20130603093127.GC713@kaka.it.su.se>
References: <20130603093127.GC713@kaka.it.su.se>
Message-ID: <15321801-82E3-4F3C-9983-6641188C0E83@rabbitmq.com>

Hi Simon,

I'll discuss moving that repository into the rabbitmq-public-umbrella and making it part of the standard release, at which point it will get tagged along with everything else.

Cheers,
Tim

On 3 Jun 2013, at 10:31, Simon Lundstr?m wrote:

> Hey Tim,
> 
> Hope you've had a great weekend!
> 
> Could you please create a tag on <https://github.com/hyperthunk/rabbitmq-lager>?
> 
> We're going to use it in our prod environment however we're going to
> only use it to use the lager_console_backend and pipe everything to
> syslog via logger(1) since we couldn't get lager_syslog to co-work with
> rabbitmq-lager.
> 
> Please feel free to reply to the mailinglist with this mail if you see
> it appropriate.
> 
> Br,
> - Simon
> 
> ____________________________________
> 
> Simon Lundstr?m
> Section for Infrastructure
> 
> IT Services
> Stockholm University
> SE-106 91 Stockholm, Sweden
> 
> www.su.se/it
> 
> ____________________________________


From tamiragamy at gmail.com  Mon Jun  3 12:39:56 2013
From: tamiragamy at gmail.com (Tamir Agamy)
Date: Mon, 3 Jun 2013 14:39:56 +0300
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CAM6Sp4bbNP0Mjcyqp521KXKPYspAf332Wp0b+8i9SWGw16SO+Q@mail.gmail.com>

Hello

Earlier today I asked this question:
When binding a queue, what really happens? is the binding information being
forward via the
server to the exchange, where it is entered to a binding list? or is the
information saved at the
server and the exchange has to inquire the server whenever it gets a
message from the producer?

and was answered (by Emile Joubert):
"Exchanges don't really exist as independent entities in the broker. The
bindings are stored in an internal database. This database is queried
each time a message is received."


So, f I understand correctly, then everytime the publisher sends a message
to the exchange, the exchange has to inquire the database in order to see
which queues (if any) are waiting to recieve the message.
If that is the case, then we're not really saving network transportation,
each message that the publisher produces will result in contacting the
server, even if there are no subscribers to this publisher.
Is that so?

With regards,
Tamir
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/3c711e3d/attachment.htm>

From videlalvaro at gmail.com  Mon Jun  3 12:47:41 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 3 Jun 2013 13:47:41 +0200
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CAM6Sp4bbNP0Mjcyqp521KXKPYspAf332Wp0b+8i9SWGw16SO+Q@mail.gmail.com>
References: <CAM6Sp4bbNP0Mjcyqp521KXKPYspAf332Wp0b+8i9SWGw16SO+Q@mail.gmail.com>
Message-ID: <CAMcAHLWRSnCM9fS57D9ns7D4XvpQ8LY3v897F_t+__NO11LMQA@mail.gmail.com>

The database consulted by the exchange lives in the same memory space as
RabbitMQ, it's an embedded database, so there is no network overhead.


On Mon, Jun 3, 2013 at 1:39 PM, Tamir Agamy <tamiragamy at gmail.com> wrote:

> Hello
>
> Earlier today I asked this question:
> When binding a queue, what really happens? is the binding information
> being forward via the
> server to the exchange, where it is entered to a binding list? or is the
> information saved at the
> server and the exchange has to inquire the server whenever it gets a
> message from the producer?
>
> and was answered (by Emile Joubert):
> "Exchanges don't really exist as independent entities in the broker. The
> bindings are stored in an internal database. This database is queried
> each time a message is received."
>
>
> So, f I understand correctly, then everytime the publisher sends a message
> to the exchange, the exchange has to inquire the database in order to see
> which queues (if any) are waiting to recieve the message.
> If that is the case, then we're not really saving network transportation,
> each message that the publisher produces will result in contacting the
> server, even if there are no subscribers to this publisher.
> Is that so?
>
> With regards,
> Tamir
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/149c0902/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jun  3 13:01:53 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 3 Jun 2013 16:01:53 +0400
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CAM6Sp4bbNP0Mjcyqp521KXKPYspAf332Wp0b+8i9SWGw16SO+Q@mail.gmail.com>
References: <CAM6Sp4bbNP0Mjcyqp521KXKPYspAf332Wp0b+8i9SWGw16SO+Q@mail.gmail.com>
Message-ID: <CAE3HoVS0QaDPDRtrXYf--kvFHaewhyUY78amtaCUCkkHQROC2g@mail.gmail.com>

2013/6/3 Tamir Agamy <tamiragamy at gmail.com>

> or is the information saved at the
> server and the exchange has to inquire the server whenever it gets a
> message from the producer?
>

Tamir,

"the exchange" and "the server" are not separate entities, neither they are
separate processes.

Exchanges are simply names for routing tables. For all intents and purposes
you can assume that routing happens inside the RabbitMQ node
your client publishes to.

Discovering all bindings is roughly equivalent to the following SQL query:

SELECT * FROM bindings WHERE vhost = ? AND exchange = ?;

Mnesia, the database RabbitMQ uses for metadata (including bindings)
replicates the data between nodes
as well as RAM and disk. The query is also a good candidate for indexing
and caching.

It doesn't get much better from the data locality and query efficiency
perspective and most exchanges
have few bindings.At the same time, it relieves all clients from having to
know the exact routing
topology, synchronize it, deal with network splits, etc.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/78ec477b/attachment.htm>

From matthias at rabbitmq.com  Mon Jun  3 13:04:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 03 Jun 2013 13:04:16 +0100
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CAMcAHLWRSnCM9fS57D9ns7D4XvpQ8LY3v897F_t+__NO11LMQA@mail.gmail.com>
References: <CAM6Sp4bbNP0Mjcyqp521KXKPYspAf332Wp0b+8i9SWGw16SO+Q@mail.gmail.com>
	<CAMcAHLWRSnCM9fS57D9ns7D4XvpQ8LY3v897F_t+__NO11LMQA@mail.gmail.com>
Message-ID: <51AC8640.8080801@rabbitmq.com>

On 03/06/13 12:47, Alvaro Videla wrote:
> The database consulted by the exchange lives in the same memory space as
> RabbitMQ, it's an embedded database, so there is no network overhead.

I think Tamir was hoping that client libraries wouldn't have to send 
messages over the network when there are no subscribers.

Tamir, that's not how any of the messaging protocols implemented by 
RabbitMQ work - publishing of a message always results in the message 
being sent from the client to the RabbitMQ broker.

However, you can set up local brokers - on the same machine or at least 
same network as your clients - and connect them up in a federation 
(http://www.rabbitmq.com/federation.html). Crucially, messages are only 
transmitted between federation nodes when there are queues with matching 
bindings.

The same is true of clustering (http://www.rabbitmq.com/clustering.html) 
- messages are only transmitted between clustered nodes when there are 
queues with matching bindings.

Matthias.

From MaslinskiR at valassis.com  Mon Jun  3 14:01:54 2013
From: MaslinskiR at valassis.com (Maslinski, Ray)
Date: Mon, 3 Jun 2013 13:01:54 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <51AC71B2.4050504@rabbitmq.com>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
	<5199FB29.70306@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>
	<51A8D0B9.7040200@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F43A4@VALVCSMBX001PH.val.vlss.local>
	<51AC71B2.4050504@rabbitmq.com>
Message-ID: <7F7BFE76D0F5234F9258D88C37C9EC6B15205E9A@VALVCSMBX002PH.val.vlss.local>

For this particular test, I was trying to gain some insight as to the behavior of the cluster while the partition was in effect, so the partition wasn't resolved until the test was completed or aborted.  My general expectation was that both sides of the partition would begin to process messages more or less normally once the cluster connection timed out and the slave promoted itself to master, possibly with some glitches such as dropped messages during the transition.  The slow trickle of messages delivered on one of the existing connections was unexpected, and seemed to be a bit of an anomaly when combined with the growing count of unacked messages shown on the console.

Ray Maslinski
Senior Software Developer, Engineering
Valassis / Digital Media
Cell: 585.330.2426
maslinskir at valassis.com
www.valassis.com

Creating the future of intelligent media delivery to drive your greatest success

_____________________________________________________________________________

This message may include proprietary or protected information. If you are not the intended?
recipient, please notify me, delete this message and do not further communicate the information?
contained herein without my express consent.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, June 03, 2013 6:37 AM
To: Maslinski, Ray
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures when recovering from cluster partition

Just to be clear - at what point in this test are you unblocking the connection so the partition can heal?

Cheers, Simon

On 31/05/13 20:04, Maslinski, Ray wrote:
> The net_ticktime is using the default value, and event sequence seems 
> consistent with the associated timeout.
>
> Roughly,
>
> Start test
>
> Block cluster connection at some point -> trace data shows that only 
> publish events are occurring after this happens
>
> After a bit more than a minute, RabbitMQ server log shows lost cluster 
> connection on both nodes, along with the death of the mirrors and 
> promotion of slave to master.
>
> Test continues and completes publish phase, since these appeared to be 
> progressing normally, with no errors visible to client
>
> Test then starts to verify that all messages were received by polling 
> the contents of a buffer used to store incoming messages.  In a normal 
> scenario without faults, this generally means that the first poll 
> finds all the messages expected to be present and test completes 
> successfully.  Otherwise, the poll rechecks for any missing messages 
> once per second, and gives up if 30 seconds elapse without any new 
> messages showing up (timer is reset if any messages arrived during 
> polling window).
>
> The slow trickle of messages occurs during the last phase, as one 
> appears to arrive every 14 seconds and the polling loop continues to 
> retry.  Trace data doesn't appear to log any deliver events during 
> this stage, but console shows a slow increment in the number of 
> unacknowledged messages that lines up with the delivery rate observed 
> by the client.
>
> Ray Maslinski Senior Software Developer, Engineering Valassis / 
> Digital Media Cell: 585.330.2426 maslinskir at valassis.com 
> www.valassis.com
>
> Creating the future of intelligent media delivery to drive your 
> greatest success
>
> ______________________________________________________________________
> _______
>
>  This message may include proprietary or protected information. If you 
> are not the intended recipient, please notify me, delete this message 
> and do not further communicate the information contained herein 
> without my express consent.
>
>
> -----Original Message----- From: Simon MacMullen 
> [mailto:simon at rabbitmq.com] Sent: Friday, May 31, 2013 12:33 PM To:
> Maslinski, Ray Cc: Discussions about RabbitMQ Subject: Re:
> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures 
> when recovering from cluster partition
>
> Hi. The behaviour you describe doesn't really match what I would 
> expect to see. In the beginning of a partition I would expect:
>
> 1) Partition starts
>
> 2) Things behave slowly for approximately net_ticktime (see
> http://www.rabbitmq.com/partitions.html#net_ticktime) as nodes attempt 
> to contact each other and time out
>
> 3) On each node, Erlang decides the other nodes are down. Things speed 
> up again, HA queues fail over. Split-brain has begun.
>
> It sounds like you were stuck in 2) for an extended period of time.
> Have you changed net_ticktime?
>
> Alternatively, when testing partitions I have see really odd behaviour 
> by blocking network traffic in one direction only with iptables. You 
> might want to check if you've done that by mistake.
>
> Cheers, Simon
>
> On 30/05/13 22:14, Maslinski, Ray wrote:
>> Follow-up question ...
>>
>> I tried some experiments to gain some understanding of how the 
>> cluster behaved with clients attached during a network partition 
>> event. Essentially, I repeated the previous tests described below for 
>> autohealing and automatic queue synchronization, but left the cluster 
>> communications port blocked while the client test completed. One 
>> oddity I noticed was that while the consumer connected to the slave 
>> appeared to receive an indication that something was amiss (client 
>> log showed a consumer cancel exception being handled by the Spring 
>> AMQP framework, and other monitoring logs appeared to show the client 
>> restarting a connection, which seems to be consistent with 
>> documentation), the consumer connected to the master seemed to remain 
>> oblivious to any possible issues.
>> That consumer continued to receive messages, but at an extremely slow 
>> rate (test published at 16/sec fixed rate, but the remaining consumer 
>> began to receive messages at the rate of about 1 every 14 seconds).
>>
>> Since the test client waits around for expected message deliveries 
>> with a resettable 30 second timeout, it continued to run for an 
>> extended period of time (longer than I waited around for).  In 
>> addition, the admin console showed a relatively small number of 
>> unacked messages on that server, with the unacked count increasing 
>> with each actual delivery (client should always be acknowledging in 
>> the test setup, and reported no errors).  Eventually unblocking the 
>> cluster port released a bunch of messages in a short interval (albeit 
>> with some lost, as described previously).
>>
>> I also saw  producer connections go into flow control during the 
>> outage and remain there during the slow consumer delivery (though the 
>> test had long since completed delivering all its messages).
>>
>> Does this sound like expected behavior during a partition?
>>
>> Ray Maslinski Senior Software Developer, Engineering Valassis / 
>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com 
>> www.valassis.com
>>
>> Creating the future of intelligent media delivery to drive your 
>> greatest success
>>
>> _____________________________________________________________________
>> _
>>
>>
_______
>>
>> This message may include proprietary or protected information. If you 
>> are not the intended recipient, please notify me, delete this message 
>> and do not further communicate the information contained herein 
>> without my express consent.
>>
>> -----Original Message----- From: Simon MacMullen 
>> [mailto:simon at rabbitmq.com] Sent: Monday, May 20, 2013 6:30 AM To:
>> Discussions about RabbitMQ Cc: Maslinski, Ray Subject: Re:
>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures 
>> when recovering from cluster partition
>>
>> On 17/05/13 20:38, Maslinski, Ray wrote:
>>> Hello,
>>
>> Hi!
>>
>>> To simulate a network partition failure, I've been using iptables to 
>>> temporarily block inbound and outbound access on one of the nodes to 
>>> the single port configured for cluster communications through 
>>> inet_dist_listen_min and inet_dist_listen_max settings (min = max). 
>>> Client access is not blocked during a simulated partition fault.
>>
>> Sounds reasonable.
>>
>>> I've observed two anomalies during testing that I wasn't expecting 
>>> based on the documentation I've read:
>>>
>>> -At a sufficiently high message rate, some number of messages will 
>>> be lost during the fault sequence, with the number lost tending to 
>>> increase with message rate.  No indication of a send error has been 
>>> observed by the client program. Based on results obtained from test 
>>> logs and an independent monitor listening on trace messages from 
>>> each node, it appears that as soon as the port is blocked, both 
>>> nodes continue to accept published messages, but (temporarily) stop 
>>> delivering messages until the cluster heartbeat failure is detected, 
>>> at which point the cluster is partitioned and the slave promotes 
>>> itself to become master. In the sequences I've looked at, the 
>>> messages that are lost all appear to be published to the original 
>>> master (and final master after a winner is selected during 
>>> autoheal). Neither the start nor the end of the lost message window 
>>> appear to line up with any events in the logs, other than the start 
>>> occurring sometime after the port connection is blocked but before 
>>> the cluster heartbeat failure is detected, and the end occurring 
>>> sometime after the detection of the cluster heartbeat failure and 
>>> before the detection of the partitioned cluster after the connection 
>>> is unblocked.  Is message loss to be expected in this scenario?
>>
>> I would expect to see message loss in a cluster heal scenario.
>>
>> It's important to remember that a cluster partition is still a 
>> substantial problem, and the healing process involves throwing state 
>> away. Autoheal mode just means you get through this process faster, 
>> and hopefully spend much less time accepting messages that will end 
>> up being lost.
>>
>> I would expect intuitively that only messages from the losing 
>> partitions would be lost. But I am not entirely surprised if messages 
>> from the winner are lost too; there is a period after the partitions 
>> have come back together but before autoheal kicks in during which we 
>> will have multiple masters for a queue, and behaviour can be 
>> unpredictable.
>>
>>> -Occasionally the autoheal loser node fails to rejoin the cluster 
>>> after restart.  I don't have a lot of data points on this one since 
>>> it's only happened a handful of times during overnight test 
>>> iterations.  During one failure, the autoheal winner showed the log 
>>> message below during recovery:
>>
>> Ah, that looks like a bug in autoheal. I think the stack trace you 
>> posted should contain enough information to fix it. Thanks.
>>
>> Cheers, Simon
>>
>> -- Simon MacMullen RabbitMQ, Pivotal
>>
>
>
> -- Simon MacMullen RabbitMQ, Pivotal
>


--
Simon MacMullen
RabbitMQ, Pivotal

From dburgan at peopleanswers.com  Mon Jun  3 15:54:52 2013
From: dburgan at peopleanswers.com (Darrell Burgan)
Date: Mon, 3 Jun 2013 09:54:52 -0500
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
In-Reply-To: <51AC6EEE.3000208@rabbitmq.com>
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
	<51AC6EEE.3000208@rabbitmq.com>
Message-ID: <CC2E9E0234D3E04B816F19533053E0F681CDD85CE5@AUSP01VMBX01.collaborationhost.net>

Hi Simon, well I'm certain I'm hitting the same server. What version of RabbitMQ are you using that is generating the correct results? I'm using 3.1.0.

As to user permissions, the user I am logged in as doing the API is same as the one I am looking at the RabbitMQ management console with. The user has administrator rights and full access to the default vhost /, which is the only vhost we have.

One other thing I didn't mention is that we have two RabbitMQ instances on two different machines clustered together. Does this have any bearing on statistics? Note I get the same incorrect results on both servers.

Is there some configuration item I might have missed? Here are the configuration files:

enabled_plugins:

	[rabbitmq_management].

rabbitmq.config:

	[
		{mnesia, [{dump_log_write_threshold, 100}]},
		{rabbit, [
			{cluster_nodes, ['rabbit at xxx, 'rabbit at yyy]},
			{tcp_listeners, [5672]}
		]}
	].

rabbitmq-env.conf:

	RABBITMQ_NODE_PORT=5672
	RABBITMQ_NODENAME=rabbit at xxx
	RABBITMQ_NODE_IP_ADDRESS=10.xxx.xxx.xxx
	RABBITMQ_MNESIA_BASE=/usr/local/rabbitmq/mnesia	

I did install the latest erlang from the RHEL EPEL repositories. I then installed RabbitMQ by downloading the RPM directly from rabbitmq.com and installing.

The "rabbitmqctl environment" command gives this:

	[{auth_backends,[rabbit_auth_backend_internal]},
	 {auth_mechanisms,['PLAIN','AMQPLAIN']},
	 {backing_queue_module,rabbit_variable_queue},
	 {cluster_nodes,[rabbit at xxx,rabbit at yyy]},
	 {cluster_partition_handling,ignore},
	 {collect_statistics,fine},
	 {collect_statistics_interval,5000},
	 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
	 {default_user,<<"guest">>},
	 {default_user_tags,[administrator]},
	 {default_vhost,<<"/">>},
	 {delegate_count,16},
	 {disk_free_limit,1000000000},
	 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
	 {error_logger,{file,"/var/log/rabbitmq/rabbit at xxx.log"}},
	 {frame_max,131072},
	 {heartbeat,600},
	 {hipe_compile,false},
	 {included_applications,[]},
	 {log_levels,[{connection,info}]},
	 {msg_store_file_size_limit,16777216},
	 {msg_store_index_module,rabbit_msg_store_ets_index},
	 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.0/sbin/../plugins"},
	 {plugins_expand_dir,"/u01/rabbitmq/mnesia/rabbit at xxx-plugins-expand"},
	 {queue_index_max_journal_entries,65536},
	 {reverse_dns_lookups,false},
	 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at xxx-sasl.log"}},
	 {server_properties,[]},
	 {ssl_cert_login_from,distinguished_name},
	 {ssl_listeners,[]},
	 {ssl_options,[]},
	 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
	 {tcp_listeners,[{"10.xxx.xxx.xxx",5672}]},
	 {trace_vhosts,[]},
	 {vm_memory_high_watermark,0.4}]

And "rabbitmqctl status" gives this:

	Status of node rabbit at xxx ...
	[{pid,5046},
	 {running_applications,
	     [{rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
	      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
	      {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"},
	      {mochiweb,"MochiMedia Web Server","1.4.1"},
	      {crypto,"CRYPTO version 2","2.0.4"},
	      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},
	      {rabbit,"RabbitMQ","3.1.0"},
	      {os_mon,"CPO  CXC 138 46","2.2.7"},
	      {xmerl,"XML parser","1.2.10"},
	      {inets,"INETS  CXC 138 49","5.7.1"},
	      {mnesia,"MNESIA  CXC 138 12","4.5"},
	      {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
	      {sasl,"SASL  CXC 138 11","2.1.10"},
	      {stdlib,"ERTS  CXC 138 10","1.17.5"},
	      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
	 {os,{unix,linux}},
	 {erlang_version,
	     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]\n"},
	 {memory,
	     [{total,46630064},
	      {connection_procs,8435640},
	      {queue_procs,333496},
	      {plugins,495808},
	      {other_proc,9938040},
	      {mnesia,92008},
	      {mgmt_db,9904},
	      {msg_index,36744},
	      {other_ets,1236848},
	      {binary,1712512},
	      {code,18720655},
	      {atom,1642329},
	      {other_system,3976080}]},
	 {vm_memory_high_watermark,0.4},
	 {vm_memory_limit,6732223283},
	 {disk_free_limit,1000000000},
	 {disk_free,121342373888},
	 {file_descriptors,
	     [{total_limit,3996},
	      {total_used,103},
	      {sockets_limit,3594},
	      {sockets_used,101}]},
	 {processes,[{limit,1048576},{used,1209}]},
	 {run_queue,0},
	 {uptime,712367}]
	...done.

I'm kind of at a loss. Is there a rabbitmqctl command I can run that returns the rate statistics (I didn't see it in rabbitmqctl report) ... ?

Thanks,
Darrell



-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, June 03, 2013 5:25 AM
To: Discussions about RabbitMQ
Cc: Darrell Burgan
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero

Hmm, not sure I can say much more than "works for me".

The numbers that are shown in the web UI are taken from the request http://xxx:15672/api/overview (albeit without the ?columns= parameter); there is only one source for these numbers.

One thing you might want to check is if you are using a different user for web UI vs nagios. Users that do not have the "administrator" or "monitoring" tags will only see message rates for vhosts they have access to - could you be seeing that?

Another possibility (and I know this might sound patronising, but we all make mistakes) - are you talking to the same server in each case?

Cheers, Simon

From dburgan at peopleanswers.com  Mon Jun  3 15:59:11 2013
From: dburgan at peopleanswers.com (Darrell Burgan)
Date: Mon, 3 Jun 2013 09:59:11 -0500
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
	<51AC6EEE.3000208@rabbitmq.com> 
Message-ID: <CC2E9E0234D3E04B816F19533053E0F681CDD85CE7@AUSP01VMBX01.collaborationhost.net>

Well I'll be. I just ran the query again in production and now I'm getting something:

http://xxx:15672/api/overview?columns=message_stats.publish_details.rate

Yields: {"message_stats":{"publish_details":{"rate":128.6}}}

I literally did not change anything. Bizarre. I must have done something different on my end, though, so let's chalk this up to operator error. I'll keep an eye on it though, and let you know if anything changes.

Thanks for your help!

Darrell




-----Original Message-----
From: Darrell Burgan 
Sent: Monday, June 03, 2013 9:55 AM
To: 'Simon MacMullen'; Discussions about RabbitMQ
Subject: RE: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero

Hi Simon, well I'm certain I'm hitting the same server. What version of RabbitMQ are you using that is generating the correct results? I'm using 3.1.0.

As to user permissions, the user I am logged in as doing the API is same as the one I am looking at the RabbitMQ management console with. The user has administrator rights and full access to the default vhost /, which is the only vhost we have.

One other thing I didn't mention is that we have two RabbitMQ instances on two different machines clustered together. Does this have any bearing on statistics? Note I get the same incorrect results on both servers.

Is there some configuration item I might have missed? Here are the configuration files:

enabled_plugins:

	[rabbitmq_management].

rabbitmq.config:

	[
		{mnesia, [{dump_log_write_threshold, 100}]},
		{rabbit, [
			{cluster_nodes, ['rabbit at xxx, 'rabbit at yyy]},
			{tcp_listeners, [5672]}
		]}
	].

rabbitmq-env.conf:

	RABBITMQ_NODE_PORT=5672
	RABBITMQ_NODENAME=rabbit at xxx
	RABBITMQ_NODE_IP_ADDRESS=10.xxx.xxx.xxx
	RABBITMQ_MNESIA_BASE=/usr/local/rabbitmq/mnesia	

I did install the latest erlang from the RHEL EPEL repositories. I then installed RabbitMQ by downloading the RPM directly from rabbitmq.com and installing.

The "rabbitmqctl environment" command gives this:

	[{auth_backends,[rabbit_auth_backend_internal]},
	 {auth_mechanisms,['PLAIN','AMQPLAIN']},
	 {backing_queue_module,rabbit_variable_queue},
	 {cluster_nodes,[rabbit at xxx,rabbit at yyy]},
	 {cluster_partition_handling,ignore},
	 {collect_statistics,fine},
	 {collect_statistics_interval,5000},
	 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
	 {default_user,<<"guest">>},
	 {default_user_tags,[administrator]},
	 {default_vhost,<<"/">>},
	 {delegate_count,16},
	 {disk_free_limit,1000000000},
	 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
	 {error_logger,{file,"/var/log/rabbitmq/rabbit at xxx.log"}},
	 {frame_max,131072},
	 {heartbeat,600},
	 {hipe_compile,false},
	 {included_applications,[]},
	 {log_levels,[{connection,info}]},
	 {msg_store_file_size_limit,16777216},
	 {msg_store_index_module,rabbit_msg_store_ets_index},
	 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.0/sbin/../plugins"},
	 {plugins_expand_dir,"/u01/rabbitmq/mnesia/rabbit at xxx-plugins-expand"},
	 {queue_index_max_journal_entries,65536},
	 {reverse_dns_lookups,false},
	 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at xxx-sasl.log"}},
	 {server_properties,[]},
	 {ssl_cert_login_from,distinguished_name},
	 {ssl_listeners,[]},
	 {ssl_options,[]},
	 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
	 {tcp_listeners,[{"10.xxx.xxx.xxx",5672}]},
	 {trace_vhosts,[]},
	 {vm_memory_high_watermark,0.4}]

And "rabbitmqctl status" gives this:

	Status of node rabbit at xxx ...
	[{pid,5046},
	 {running_applications,
	     [{rabbitmq_management,"RabbitMQ Management Console","3.1.0"},
	      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.0"},
	      {webmachine,"webmachine","1.9.1-rmq3.1.0-git52e62bc"},
	      {mochiweb,"MochiMedia Web Server","1.4.1"},
	      {crypto,"CRYPTO version 2","2.0.4"},
	      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.0"},
	      {rabbit,"RabbitMQ","3.1.0"},
	      {os_mon,"CPO  CXC 138 46","2.2.7"},
	      {xmerl,"XML parser","1.2.10"},
	      {inets,"INETS  CXC 138 49","5.7.1"},
	      {mnesia,"MNESIA  CXC 138 12","4.5"},
	      {amqp_client,"RabbitMQ AMQP Client","3.1.0"},
	      {sasl,"SASL  CXC 138 11","2.1.10"},
	      {stdlib,"ERTS  CXC 138 10","1.17.5"},
	      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
	 {os,{unix,linux}},
	 {erlang_version,
	     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]\n"},
	 {memory,
	     [{total,46630064},
	      {connection_procs,8435640},
	      {queue_procs,333496},
	      {plugins,495808},
	      {other_proc,9938040},
	      {mnesia,92008},
	      {mgmt_db,9904},
	      {msg_index,36744},
	      {other_ets,1236848},
	      {binary,1712512},
	      {code,18720655},
	      {atom,1642329},
	      {other_system,3976080}]},
	 {vm_memory_high_watermark,0.4},
	 {vm_memory_limit,6732223283},
	 {disk_free_limit,1000000000},
	 {disk_free,121342373888},
	 {file_descriptors,
	     [{total_limit,3996},
	      {total_used,103},
	      {sockets_limit,3594},
	      {sockets_used,101}]},
	 {processes,[{limit,1048576},{used,1209}]},
	 {run_queue,0},
	 {uptime,712367}]
	...done.

I'm kind of at a loss. Is there a rabbitmqctl command I can run that returns the rate statistics (I didn't see it in rabbitmqctl report) ... ?

Thanks,
Darrell



-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, June 03, 2013 5:25 AM
To: Discussions about RabbitMQ
Cc: Darrell Burgan
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero

Hmm, not sure I can say much more than "works for me".

The numbers that are shown in the web UI are taken from the request http://xxx:15672/api/overview (albeit without the ?columns= parameter); there is only one source for these numbers.

One thing you might want to check is if you are using a different user for web UI vs nagios. Users that do not have the "administrator" or "monitoring" tags will only see message rates for vhosts they have access to - could you be seeing that?

Another possibility (and I know this might sound patronising, but we all make mistakes) - are you talking to the same server in each case?

Cheers, Simon

From simon at rabbitmq.com  Mon Jun  3 16:07:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Jun 2013 16:07:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <7F7BFE76D0F5234F9258D88C37C9EC6B15205E9A@VALVCSMBX002PH.val.vlss.local>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
	<5199FB29.70306@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>
	<51A8D0B9.7040200@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F43A4@VALVCSMBX001PH.val.vlss.local>
	<51AC71B2.4050504@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B15205E9A@VALVCSMBX002PH.val.vlss.local>
Message-ID: <51ACB13F.9040505@rabbitmq.com>

Hmm. While the partition is in effect neither side should be aware that 
the other side is up at all - we assume if we lose contact with a node 
that it has crashed. So I'm quite surprised by the slow trickle you are 
seeing, since I'm sure people don't see that if part of a cluster just 
crashes.

So I am more suspicious that the iptables commands you are using are in 
fact not simulating a real partitioning of the cluster.

Can you post the iptables commands you are using and I will try to 
replicate?

Cheers, Simon

On 03/06/13 14:01, Maslinski, Ray wrote:
> For this particular test, I was trying to gain some insight as to the
> behavior of the cluster while the partition was in effect, so the
> partition wasn't resolved until the test was completed or aborted.
> My general expectation was that both sides of the partition would
> begin to process messages more or less normally once the cluster
> connection timed out and the slave promoted itself to master,
> possibly with some glitches such as dropped messages during the
> transition.  The slow trickle of messages delivered on one of the
> existing connections was unexpected, and seemed to be a bit of an
> anomaly when combined with the growing count of unacked messages
> shown on the console.
>
> Ray Maslinski Senior Software Developer, Engineering Valassis /
> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
> www.valassis.com
>
> Creating the future of intelligent media delivery to drive your
> greatest success
>
> _____________________________________________________________________________
>
>  This message may include proprietary or protected information. If
> you are not the intended recipient, please notify me, delete this
> message and do not further communicate the information contained
> herein without my express consent.
>
> -----Original Message----- From: Simon MacMullen
> [mailto:simon at rabbitmq.com] Sent: Monday, June 03, 2013 6:37 AM To:
> Maslinski, Ray Cc: Discussions about RabbitMQ Subject: Re:
> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures
> when recovering from cluster partition
>
> Just to be clear - at what point in this test are you unblocking the
> connection so the partition can heal?
>
> Cheers, Simon
>
> On 31/05/13 20:04, Maslinski, Ray wrote:
>> The net_ticktime is using the default value, and event sequence
>> seems consistent with the associated timeout.
>>
>> Roughly,
>>
>> Start test
>>
>> Block cluster connection at some point -> trace data shows that
>> only publish events are occurring after this happens
>>
>> After a bit more than a minute, RabbitMQ server log shows lost
>> cluster connection on both nodes, along with the death of the
>> mirrors and promotion of slave to master.
>>
>> Test continues and completes publish phase, since these appeared to
>> be progressing normally, with no errors visible to client
>>
>> Test then starts to verify that all messages were received by
>> polling the contents of a buffer used to store incoming messages.
>> In a normal scenario without faults, this generally means that the
>> first poll finds all the messages expected to be present and test
>> completes successfully.  Otherwise, the poll rechecks for any
>> missing messages once per second, and gives up if 30 seconds elapse
>> without any new messages showing up (timer is reset if any messages
>> arrived during polling window).
>>
>> The slow trickle of messages occurs during the last phase, as one
>> appears to arrive every 14 seconds and the polling loop continues
>> to retry.  Trace data doesn't appear to log any deliver events
>> during this stage, but console shows a slow increment in the number
>> of unacknowledged messages that lines up with the delivery rate
>> observed by the client.
>>
>> Ray Maslinski Senior Software Developer, Engineering Valassis /
>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
>> www.valassis.com
>>
>> Creating the future of intelligent media delivery to drive your
>> greatest success
>>
>> ______________________________________________________________________
>>
>>
_______
>>
>> This message may include proprietary or protected information. If
>> you are not the intended recipient, please notify me, delete this
>> message and do not further communicate the information contained
>> herein without my express consent.
>>
>>
>> -----Original Message----- From: Simon MacMullen
>> [mailto:simon at rabbitmq.com] Sent: Friday, May 31, 2013 12:33 PM
>> To: Maslinski, Ray Cc: Discussions about RabbitMQ Subject: Re:
>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
>> failures when recovering from cluster partition
>>
>> Hi. The behaviour you describe doesn't really match what I would
>> expect to see. In the beginning of a partition I would expect:
>>
>> 1) Partition starts
>>
>> 2) Things behave slowly for approximately net_ticktime (see
>> http://www.rabbitmq.com/partitions.html#net_ticktime) as nodes
>> attempt to contact each other and time out
>>
>> 3) On each node, Erlang decides the other nodes are down. Things
>> speed up again, HA queues fail over. Split-brain has begun.
>>
>> It sounds like you were stuck in 2) for an extended period of
>> time. Have you changed net_ticktime?
>>
>> Alternatively, when testing partitions I have see really odd
>> behaviour by blocking network traffic in one direction only with
>> iptables. You might want to check if you've done that by mistake.
>>
>> Cheers, Simon
>>
>> On 30/05/13 22:14, Maslinski, Ray wrote:
>>> Follow-up question ...
>>>
>>> I tried some experiments to gain some understanding of how the
>>> cluster behaved with clients attached during a network partition
>>> event. Essentially, I repeated the previous tests described below
>>> for autohealing and automatic queue synchronization, but left the
>>> cluster communications port blocked while the client test
>>> completed. One oddity I noticed was that while the consumer
>>> connected to the slave appeared to receive an indication that
>>> something was amiss (client log showed a consumer cancel
>>> exception being handled by the Spring AMQP framework, and other
>>> monitoring logs appeared to show the client restarting a
>>> connection, which seems to be consistent with documentation), the
>>> consumer connected to the master seemed to remain oblivious to
>>> any possible issues. That consumer continued to receive messages,
>>> but at an extremely slow rate (test published at 16/sec fixed
>>> rate, but the remaining consumer began to receive messages at the
>>> rate of about 1 every 14 seconds).
>>>
>>> Since the test client waits around for expected message
>>> deliveries with a resettable 30 second timeout, it continued to
>>> run for an extended period of time (longer than I waited around
>>> for).  In addition, the admin console showed a relatively small
>>> number of unacked messages on that server, with the unacked count
>>> increasing with each actual delivery (client should always be
>>> acknowledging in the test setup, and reported no errors).
>>> Eventually unblocking the cluster port released a bunch of
>>> messages in a short interval (albeit with some lost, as described
>>> previously).
>>>
>>> I also saw  producer connections go into flow control during the
>>> outage and remain there during the slow consumer delivery (though
>>> the test had long since completed delivering all its messages).
>>>
>>> Does this sound like expected behavior during a partition?
>>>
>>> Ray Maslinski Senior Software Developer, Engineering Valassis /
>>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
>>> www.valassis.com
>>>
>>> Creating the future of intelligent media delivery to drive your
>>> greatest success
>>>
>>> _____________________________________________________________________
>>>
>>>
_
>>>
>>>
> _______
>>>
>>> This message may include proprietary or protected information. If
>>> you are not the intended recipient, please notify me, delete this
>>> message and do not further communicate the information contained
>>> herein without my express consent.
>>>
>>> -----Original Message----- From: Simon MacMullen
>>> [mailto:simon at rabbitmq.com] Sent: Monday, May 20, 2013 6:30 AM
>>> To: Discussions about RabbitMQ Cc: Maslinski, Ray Subject: Re:
>>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
>>> failures when recovering from cluster partition
>>>
>>> On 17/05/13 20:38, Maslinski, Ray wrote:
>>>> Hello,
>>>
>>> Hi!
>>>
>>>> To simulate a network partition failure, I've been using
>>>> iptables to temporarily block inbound and outbound access on
>>>> one of the nodes to the single port configured for cluster
>>>> communications through inet_dist_listen_min and
>>>> inet_dist_listen_max settings (min = max). Client access is not
>>>> blocked during a simulated partition fault.
>>>
>>> Sounds reasonable.
>>>
>>>> I've observed two anomalies during testing that I wasn't
>>>> expecting based on the documentation I've read:
>>>>
>>>> -At a sufficiently high message rate, some number of messages
>>>> will be lost during the fault sequence, with the number lost
>>>> tending to increase with message rate.  No indication of a send
>>>> error has been observed by the client program. Based on results
>>>> obtained from test logs and an independent monitor listening on
>>>> trace messages from each node, it appears that as soon as the
>>>> port is blocked, both nodes continue to accept published
>>>> messages, but (temporarily) stop delivering messages until the
>>>> cluster heartbeat failure is detected, at which point the
>>>> cluster is partitioned and the slave promotes itself to become
>>>> master. In the sequences I've looked at, the messages that are
>>>> lost all appear to be published to the original master (and
>>>> final master after a winner is selected during autoheal).
>>>> Neither the start nor the end of the lost message window appear
>>>> to line up with any events in the logs, other than the start
>>>> occurring sometime after the port connection is blocked but
>>>> before the cluster heartbeat failure is detected, and the end
>>>> occurring sometime after the detection of the cluster heartbeat
>>>> failure and before the detection of the partitioned cluster
>>>> after the connection is unblocked.  Is message loss to be
>>>> expected in this scenario?
>>>
>>> I would expect to see message loss in a cluster heal scenario.
>>>
>>> It's important to remember that a cluster partition is still a
>>> substantial problem, and the healing process involves throwing
>>> state away. Autoheal mode just means you get through this process
>>> faster, and hopefully spend much less time accepting messages
>>> that will end up being lost.
>>>
>>> I would expect intuitively that only messages from the losing
>>> partitions would be lost. But I am not entirely surprised if
>>> messages from the winner are lost too; there is a period after
>>> the partitions have come back together but before autoheal kicks
>>> in during which we will have multiple masters for a queue, and
>>> behaviour can be unpredictable.
>>>
>>>> -Occasionally the autoheal loser node fails to rejoin the
>>>> cluster after restart.  I don't have a lot of data points on
>>>> this one since it's only happened a handful of times during
>>>> overnight test iterations.  During one failure, the autoheal
>>>> winner showed the log message below during recovery:
>>>
>>> Ah, that looks like a bug in autoheal. I think the stack trace
>>> you posted should contain enough information to fix it. Thanks.
>>>
>>> Cheers, Simon
>>>
>>> -- Simon MacMullen RabbitMQ, Pivotal
>>>
>>
>>
>> -- Simon MacMullen RabbitMQ, Pivotal
>>
>
>
> -- Simon MacMullen RabbitMQ, Pivotal
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From MaslinskiR at valassis.com  Mon Jun  3 16:17:19 2013
From: MaslinskiR at valassis.com (Maslinski, Ray)
Date: Mon, 3 Jun 2013 15:17:19 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <51ACB13F.9040505@rabbitmq.com>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
	<5199FB29.70306@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>
	<51A8D0B9.7040200@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F43A4@VALVCSMBX001PH.val.vlss.local>
	<51AC71B2.4050504@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B15205E9A@VALVCSMBX002PH.val.vlss.local>
	<51ACB13F.9040505@rabbitmq.com>
Message-ID: <7F7BFE76D0F5234F9258D88C37C9EC6B1520C8A0@VALVCSMBX002PH.val.vlss.local>

I've tried a few variants without noticing any apparent differences in behavior, here's what I currently have:

		sudo iptables -A INPUT -i eth0 -p tcp -s $address -j DROP
		sudo iptables -A OUTPUT -o eth0 -p tcp -d $address -j DROP

where $address is the ip address of the other node in the mirror.

The other variants included adding a specific port to only drop traffic on the cluster port between the two nodes (--dport $port to above commands), and dropping all traffic on the cluster port, regardless of ip address (adding the --dport option and removing the -s/-d options).

Ray Maslinski
Senior Software Developer, Engineering
Valassis / Digital Media
Cell: 585.330.2426
maslinskir at valassis.com
www.valassis.com

Creating the future of intelligent media delivery to drive your greatest success

_____________________________________________________________________________

This message may include proprietary or protected information. If you are not the intended?
recipient, please notify me, delete this message and do not further communicate the information?
contained herein without my express consent.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, June 03, 2013 11:08 AM
To: Maslinski, Ray
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures when recovering from cluster partition

Hmm. While the partition is in effect neither side should be aware that the other side is up at all - we assume if we lose contact with a node that it has crashed. So I'm quite surprised by the slow trickle you are seeing, since I'm sure people don't see that if part of a cluster just crashes.

So I am more suspicious that the iptables commands you are using are in fact not simulating a real partitioning of the cluster.

Can you post the iptables commands you are using and I will try to replicate?

Cheers, Simon

On 03/06/13 14:01, Maslinski, Ray wrote:
> For this particular test, I was trying to gain some insight as to the 
> behavior of the cluster while the partition was in effect, so the 
> partition wasn't resolved until the test was completed or aborted.
> My general expectation was that both sides of the partition would 
> begin to process messages more or less normally once the cluster 
> connection timed out and the slave promoted itself to master, possibly 
> with some glitches such as dropped messages during the transition.  
> The slow trickle of messages delivered on one of the existing 
> connections was unexpected, and seemed to be a bit of an anomaly when 
> combined with the growing count of unacked messages shown on the 
> console.
>
> Ray Maslinski Senior Software Developer, Engineering Valassis / 
> Digital Media Cell: 585.330.2426 maslinskir at valassis.com 
> www.valassis.com
>
> Creating the future of intelligent media delivery to drive your 
> greatest success
>
> ______________________________________________________________________
> _______
>
>  This message may include proprietary or protected information. If you 
> are not the intended recipient, please notify me, delete this message 
> and do not further communicate the information contained herein 
> without my express consent.
>
> -----Original Message----- From: Simon MacMullen 
> [mailto:simon at rabbitmq.com] Sent: Monday, June 03, 2013 6:37 AM To:
> Maslinski, Ray Cc: Discussions about RabbitMQ Subject: Re:
> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures 
> when recovering from cluster partition
>
> Just to be clear - at what point in this test are you unblocking the 
> connection so the partition can heal?
>
> Cheers, Simon
>
> On 31/05/13 20:04, Maslinski, Ray wrote:
>> The net_ticktime is using the default value, and event sequence seems 
>> consistent with the associated timeout.
>>
>> Roughly,
>>
>> Start test
>>
>> Block cluster connection at some point -> trace data shows that only 
>> publish events are occurring after this happens
>>
>> After a bit more than a minute, RabbitMQ server log shows lost 
>> cluster connection on both nodes, along with the death of the mirrors 
>> and promotion of slave to master.
>>
>> Test continues and completes publish phase, since these appeared to 
>> be progressing normally, with no errors visible to client
>>
>> Test then starts to verify that all messages were received by polling 
>> the contents of a buffer used to store incoming messages.
>> In a normal scenario without faults, this generally means that the 
>> first poll finds all the messages expected to be present and test 
>> completes successfully.  Otherwise, the poll rechecks for any missing 
>> messages once per second, and gives up if 30 seconds elapse without 
>> any new messages showing up (timer is reset if any messages arrived 
>> during polling window).
>>
>> The slow trickle of messages occurs during the last phase, as one 
>> appears to arrive every 14 seconds and the polling loop continues to 
>> retry.  Trace data doesn't appear to log any deliver events during 
>> this stage, but console shows a slow increment in the number of 
>> unacknowledged messages that lines up with the delivery rate observed 
>> by the client.
>>
>> Ray Maslinski Senior Software Developer, Engineering Valassis / 
>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com 
>> www.valassis.com
>>
>> Creating the future of intelligent media delivery to drive your 
>> greatest success
>>
>> _____________________________________________________________________
>> _
>>
>>
_______
>>
>> This message may include proprietary or protected information. If you 
>> are not the intended recipient, please notify me, delete this message 
>> and do not further communicate the information contained herein 
>> without my express consent.
>>
>>
>> -----Original Message----- From: Simon MacMullen 
>> [mailto:simon at rabbitmq.com] Sent: Friday, May 31, 2013 12:33 PM
>> To: Maslinski, Ray Cc: Discussions about RabbitMQ Subject: Re:
>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures 
>> when recovering from cluster partition
>>
>> Hi. The behaviour you describe doesn't really match what I would 
>> expect to see. In the beginning of a partition I would expect:
>>
>> 1) Partition starts
>>
>> 2) Things behave slowly for approximately net_ticktime (see
>> http://www.rabbitmq.com/partitions.html#net_ticktime) as nodes 
>> attempt to contact each other and time out
>>
>> 3) On each node, Erlang decides the other nodes are down. Things 
>> speed up again, HA queues fail over. Split-brain has begun.
>>
>> It sounds like you were stuck in 2) for an extended period of time. 
>> Have you changed net_ticktime?
>>
>> Alternatively, when testing partitions I have see really odd 
>> behaviour by blocking network traffic in one direction only with 
>> iptables. You might want to check if you've done that by mistake.
>>
>> Cheers, Simon
>>
>> On 30/05/13 22:14, Maslinski, Ray wrote:
>>> Follow-up question ...
>>>
>>> I tried some experiments to gain some understanding of how the 
>>> cluster behaved with clients attached during a network partition 
>>> event. Essentially, I repeated the previous tests described below 
>>> for autohealing and automatic queue synchronization, but left the 
>>> cluster communications port blocked while the client test completed. 
>>> One oddity I noticed was that while the consumer connected to the 
>>> slave appeared to receive an indication that something was amiss 
>>> (client log showed a consumer cancel exception being handled by the 
>>> Spring AMQP framework, and other monitoring logs appeared to show 
>>> the client restarting a connection, which seems to be consistent 
>>> with documentation), the consumer connected to the master seemed to 
>>> remain oblivious to any possible issues. That consumer continued to 
>>> receive messages, but at an extremely slow rate (test published at 
>>> 16/sec fixed rate, but the remaining consumer began to receive 
>>> messages at the rate of about 1 every 14 seconds).
>>>
>>> Since the test client waits around for expected message deliveries 
>>> with a resettable 30 second timeout, it continued to run for an 
>>> extended period of time (longer than I waited around for).  In 
>>> addition, the admin console showed a relatively small number of 
>>> unacked messages on that server, with the unacked count increasing 
>>> with each actual delivery (client should always be acknowledging in 
>>> the test setup, and reported no errors).
>>> Eventually unblocking the cluster port released a bunch of messages 
>>> in a short interval (albeit with some lost, as described 
>>> previously).
>>>
>>> I also saw  producer connections go into flow control during the 
>>> outage and remain there during the slow consumer delivery (though 
>>> the test had long since completed delivering all its messages).
>>>
>>> Does this sound like expected behavior during a partition?
>>>
>>> Ray Maslinski Senior Software Developer, Engineering Valassis / 
>>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com 
>>> www.valassis.com
>>>
>>> Creating the future of intelligent media delivery to drive your 
>>> greatest success
>>>
>>> ____________________________________________________________________
>>> _
>>>
>>>
_
>>>
>>>
> _______
>>>
>>> This message may include proprietary or protected information. If 
>>> you are not the intended recipient, please notify me, delete this 
>>> message and do not further communicate the information contained 
>>> herein without my express consent.
>>>
>>> -----Original Message----- From: Simon MacMullen 
>>> [mailto:simon at rabbitmq.com] Sent: Monday, May 20, 2013 6:30 AM
>>> To: Discussions about RabbitMQ Cc: Maslinski, Ray Subject: Re:
>>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal 
>>> failures when recovering from cluster partition
>>>
>>> On 17/05/13 20:38, Maslinski, Ray wrote:
>>>> Hello,
>>>
>>> Hi!
>>>
>>>> To simulate a network partition failure, I've been using iptables 
>>>> to temporarily block inbound and outbound access on one of the 
>>>> nodes to the single port configured for cluster communications 
>>>> through inet_dist_listen_min and inet_dist_listen_max settings (min 
>>>> = max). Client access is not blocked during a simulated partition 
>>>> fault.
>>>
>>> Sounds reasonable.
>>>
>>>> I've observed two anomalies during testing that I wasn't expecting 
>>>> based on the documentation I've read:
>>>>
>>>> -At a sufficiently high message rate, some number of messages will 
>>>> be lost during the fault sequence, with the number lost tending to 
>>>> increase with message rate.  No indication of a send error has been 
>>>> observed by the client program. Based on results obtained from test 
>>>> logs and an independent monitor listening on trace messages from 
>>>> each node, it appears that as soon as the port is blocked, both 
>>>> nodes continue to accept published messages, but (temporarily) stop 
>>>> delivering messages until the cluster heartbeat failure is 
>>>> detected, at which point the cluster is partitioned and the slave 
>>>> promotes itself to become master. In the sequences I've looked at, 
>>>> the messages that are lost all appear to be published to the 
>>>> original master (and final master after a winner is selected during 
>>>> autoheal).
>>>> Neither the start nor the end of the lost message window appear to 
>>>> line up with any events in the logs, other than the start occurring 
>>>> sometime after the port connection is blocked but before the 
>>>> cluster heartbeat failure is detected, and the end occurring 
>>>> sometime after the detection of the cluster heartbeat failure and 
>>>> before the detection of the partitioned cluster after the 
>>>> connection is unblocked.  Is message loss to be expected in this 
>>>> scenario?
>>>
>>> I would expect to see message loss in a cluster heal scenario.
>>>
>>> It's important to remember that a cluster partition is still a 
>>> substantial problem, and the healing process involves throwing state 
>>> away. Autoheal mode just means you get through this process faster, 
>>> and hopefully spend much less time accepting messages that will end 
>>> up being lost.
>>>
>>> I would expect intuitively that only messages from the losing 
>>> partitions would be lost. But I am not entirely surprised if 
>>> messages from the winner are lost too; there is a period after the 
>>> partitions have come back together but before autoheal kicks in 
>>> during which we will have multiple masters for a queue, and 
>>> behaviour can be unpredictable.
>>>
>>>> -Occasionally the autoheal loser node fails to rejoin the cluster 
>>>> after restart.  I don't have a lot of data points on this one since 
>>>> it's only happened a handful of times during overnight test 
>>>> iterations.  During one failure, the autoheal winner showed the log 
>>>> message below during recovery:
>>>
>>> Ah, that looks like a bug in autoheal. I think the stack trace you 
>>> posted should contain enough information to fix it. Thanks.
>>>
>>> Cheers, Simon
>>>
>>> -- Simon MacMullen RabbitMQ, Pivotal
>>>
>>
>>
>> -- Simon MacMullen RabbitMQ, Pivotal
>>
>
>
> -- Simon MacMullen RabbitMQ, Pivotal
>


--
Simon MacMullen
RabbitMQ, Pivotal

From Petr.Gotthard at Honeywell.com  Mon Jun  3 17:23:46 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Mon, 3 Jun 2013 16:23:46 +0000
Subject: [rabbitmq-discuss] AMQP 0-1 specification?
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D340126@FR44EX3005.global.ds.honeywell.com>

Hello,

Do you know if there is a way to obtain the ancient AMQP 0-1 specification? (Not 1.0, the very old 0-1.)


Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/bd23644b/attachment.htm>

From alan.antonuk at gmail.com  Mon Jun  3 18:39:18 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 3 Jun 2013 10:39:18 -0700
Subject: [rabbitmq-discuss] In RabbitMQ-C Getting
 AMQP_CHANNEL_CLOSE_METHOD without closing channel
In-Reply-To: <51AC67CC.10904@rabbitmq.com>
References: <1370241835237-27158.post@n5.nabble.com>
	<51AC67CC.10904@rabbitmq.com>
Message-ID: <CAAt2po+CCyQSPdqBne=Krs=JgiG21tneiFaCSeQC7CGzQefdww@mail.gmail.com>

In addition to Emile's suggestion when you get a AMQP_CHANNEL_CLOSE_METHOD,
cast the frame.properties.decoded to an amqp_channel_close_t*. You can then
examine the reply_text to get the error message from the broker. You may
need to use the class_id and method_id members might be useful in
determining what the error message is referring to.

Also a note about amqp_basic_publish, its return value will only indicate
the failure to pass the message to the broker (say the underlying socket
gets closed). If you publish to a non-existent exchange (which will cause a
channel exception) for example, the amqp_basic_publish won't indicate
failure. The failure will reported 'some time in the future' as an channel
exception in the form of a AMQP_CHANNEL_CLOSE_METHOD.

HTH
-Alan



On Mon, Jun 3, 2013 at 2:54 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 03/06/13 07:43, pawanksingh wrote:
> > I am Getting AMQP_CHANNEL_CLOSE_METHOD without closing any channel.
>
>
> This is likely due to a channel exception. In that case the broker
> logfile will also have an explanation of the problem.
>
>
>
> -Emile
>
>
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/6a351103/attachment.htm>

From leach_matthew at bah.com  Mon Jun  3 19:09:00 2013
From: leach_matthew at bah.com (Leach, Matthew [USA])
Date: Mon, 3 Jun 2013 18:09:00 +0000
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <92AF286C6A28E6468EECBF295DA296AE300F6E11@ASHBDAG1M3.resource.ds.bah.com>

I am new to rabbitmq and am having some issues getting everything installed.  I downloaded and untarred the rabbitmq-server-generic-unix-3.1.1.tar into a directory.  When I run the sbin command I get the following message

sbin/rabbitmq-server: bin/sh: bad interpreter: No such file or directory

I read somewhere that I needed erlang installed, not sure if I couldn't get past this point without it installed or not.

I also tried changing the rabbitmq-server and rabbitmq-env script( Change the #!bin/sh to #!/bin/xpg4/bin/sh ) to accomodate log and mnesia directory settings. And still got errors.  Any suggestions


Matthew Leach
Associate
Booz | Allen | Hamilton
______________________

office: 703.377.8791
mobile: 703.887.7065
email:  leach_matthew at bah.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/ae893ee3/attachment.htm>

From emile at rabbitmq.com  Mon Jun  3 20:27:37 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 03 Jun 2013 20:27:37 +0100
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <92AF286C6A28E6468EECBF295DA296AE300F6E11@ASHBDAG1M3.resource.ds.bah.com>
References: <92AF286C6A28E6468EECBF295DA296AE300F6E11@ASHBDAG1M3.resource.ds.bah.com>
Message-ID: <51ACEE29.3020201@rabbitmq.com>

On 03/06/13 19:09, Leach, Matthew [USA] wrote:

> I read somewhere that I needed erlang installed, not sure if I couldn?t
> get past this point without it installed or not. 

Yes, you will need to install Erlang. For Solaris instructions see
http://www.rabbitmq.com/install-solaris.html



-Emile






From videlalvaro at gmail.com  Mon Jun  3 20:28:30 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 3 Jun 2013 21:28:30 +0200
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <92AF286C6A28E6468EECBF295DA296AE300F6E11@ASHBDAG1M3.resource.ds.bah.com>
References: <92AF286C6A28E6468EECBF295DA296AE300F6E11@ASHBDAG1M3.resource.ds.bah.com>
Message-ID: <CAMcAHLU--VCKnnz2Jvf=PX9k8JYqrQDCL8gwj3qDCdsXs+8kig@mail.gmail.com>

You need to have Erlang installed for that to run.

Depending on your platform, there are several ways to install Erlang. I
find the packages provided here to be very easy to use:
https://www.erlang-solutions.com/downloads/download-erlang-otp

-Alvaro


On Mon, Jun 3, 2013 at 8:09 PM, Leach, Matthew [USA]
<leach_matthew at bah.com>wrote:

>  I am new to rabbitmq and am having some issues getting everything
> installed.  I downloaded and untarred the
> rabbitmq-server-generic-unix-3.1.1.tar into a directory.  When I run the
> sbin command I get the following message ****
>
> ** **
>
> sbin/rabbitmq-server: bin/sh: bad interpreter: No such file or directory**
> **
>
> ** **
>
> I read somewhere that I needed erlang installed, not sure if I couldn?t
> get past this point without it installed or not.  ****
>
> ** **
>
> I also tried changing the rabbitmq-server and rabbitmq-env script( Change
> the #!bin/sh to #!/bin/xpg4/bin/sh ) to accomodate log and mnesia
> directory settings. And still got errors.  Any suggestions****
>
> ** **
>
> ** **
>
> Matthew Leach****
>
> Associate****
>
> Booz | Allen | Hamilton ****
>
> ______________________****
>
>  ****
>
> office: 703.377.8791****
>
> mobile: 703.887.7065****
>
> email:  leach_matthew at bah.com****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130603/5b905f97/attachment.htm>

From simon at rabbitmq.com  Tue Jun  4 10:08:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Jun 2013 10:08:34 +0100
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <92AF286C6A28E6468EECBF295DA296AE300F6E11@ASHBDAG1M3.resource.ds.bah.com>
References: <92AF286C6A28E6468EECBF295DA296AE300F6E11@ASHBDAG1M3.resource.ds.bah.com>
Message-ID: <51ADAE92.2070208@rabbitmq.com>

On 03/06/13 19:09, Leach, Matthew [USA] wrote:
> sbin/rabbitmq-server: bin/sh: bad interpreter: No such file or directory

What Emile and Alvaro said about Erlang is correct. But note that this 
particular error would arise if you edited the first line of the 
rabbitmq-server script from

#!/bin/sh

to

#!bin/sh

So please be cautious when editing these scripts.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From tilak.chauhan at ymail.com  Tue Jun  4 13:17:04 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Tue, 4 Jun 2013 05:17:04 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ connection(s) Blocking !
In-Reply-To: <51A8CDEE.4040007@rabbitmq.com>
References: <1370001850389-27114.post@n5.nabble.com>
	<51A8CDEE.4040007@rabbitmq.com>
Message-ID: <1370348224821-27187.post@n5.nabble.com>

Hi Simon,

Thanks for your reply. But, still I don't know how to get rid of this
problem and now this issue appears at least once in a day and every time I
execute commands `swapoff -a` and then `swapon -a`  to clear swap memory.
This does not seem to be a right solution. Is there anything (command)  that
I can use to clear RMQ allocated memory. I have a shell script which run
every minute (through crontab) and I can use/modify this script to run
command(s) (to clear memory).

Thanks
T.luck




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-connection-s-Blocking-tp27114p27187.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Jun  4 13:35:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Jun 2013 13:35:30 +0100
Subject: [rabbitmq-discuss] [External]  Re:  (no subject)
In-Reply-To: <92AF286C6A28E6468EECBF295DA296AE300F71B5@ASHBDAG1M3.resource.ds.bah.com>
References: <92AF286C6A28E6468EECBF295DA296AE300F6E11@ASHBDAG1M3.resource.ds.bah.com>
	<51ADAE92.2070208@rabbitmq.com>
	<92AF286C6A28E6468EECBF295DA296AE300F71B5@ASHBDAG1M3.resource.ds.bah.com>
Message-ID: <51ADDF12.4010401@rabbitmq.com>

You might get better responses on how to build Erlang on 
erlang-questions: http://erlang.org/mailman/listinfo/erlang-questions

Having said that, I think configure is just looking for an executable 
"perl" on the path. So you might want to fix that.

Cheers, Simon

On 04/06/13 13:04, Leach, Matthew [USA] wrote:
> Wow, thanks for the quick responses.  I did get erlang installed but am running into the following error when I try to run ./configure in erlang directory
>
> I did install perl but not sure what is causing it to not be recognized
>
> Any help is much appreciated
>
> # ./configure
> Ignoring the --cache-file argument since it can cause the system to be erroneously configured
> Disabling caching
> checking build system type... i386-pc-solaris2.10
> checking host system type... i386-pc-solaris2.10
> checking for gcc... gcc
> checking for C compiler default output file name... a.out
> checking whether the C compiler works... yes
> checking whether we are cross compiling... no
> checking for suffix of executables...
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether gcc accepts -g... yes
> checking for gcc option to accept ANSI C... none needed
> checking for g++... g++
> checking whether we are using the GNU C++ compiler... yes
> checking whether g++ accepts -g... yes
> checking for ld... no
> checking for GNU make... yes (gmake)
> checking for a BSD-compatible install... /opt/rabbitmq/otp_src_R16B/erts/autoconf/install-sh -c
> checking whether ln -s works... yes
> checking for ranlib... :
> checking ERTS version... 5.10.1
> checking OTP release... R16B
> configure: creating ./config.status
> config.status: creating Makefile
> config.status: creating make/output.mk
> config.status: creating make/emd2exml
> configure: configuring in lib
> configure: running /bin/bash '/opt/rabbitmq/otp_src_R16B/lib/configure' --prefix=/usr/local  --cache-file=/dev/null --srcdir=/opt/rabbitmq/otp_src_R16B/lib
> configure: creating ./config.status
> configure: configuring in snmp/.
> configure: running /bin/bash '/opt/rabbitmq/otp_src_R16B/lib/snmp/./configure' --prefix=/usr/local  '--prefix=/usr/local' '--cache-file=/dev/null' '--srcdir=/opt/rabbitmq/otp_src_R16B/lib' --cache-file=/dev/null --srcdir=/opt/rabbitmq/otp_src_R16B/lib/snmp/.
> checking build system type... i386-pc-solaris2.10
> checking host system type... i386-pc-solaris2.10
> checking for perl... no_perl
> configure: error: Perl is required to generate v2 to v1 mib converter script
> configure: error: /bin/bash '/opt/rabbitmq/otp_src_R16B/lib/snmp/./configure' failed for snmp/.
> configure: error: /bin/bash '/opt/rabbitmq/otp_src_R16B/lib/configure' failed for lib
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Tuesday, June 04, 2013 5:09 AM
> To: Discussions about RabbitMQ
> Cc: Leach, Matthew [USA]
> Subject: [External] Re: [rabbitmq-discuss] (no subject)
>
> On 03/06/13 19:09, Leach, Matthew [USA] wrote:
>> sbin/rabbitmq-server: bin/sh: bad interpreter: No such file or
>> directory
>
> What Emile and Alvaro said about Erlang is correct. But note that this particular error would arise if you edited the first line of the rabbitmq-server script from
>
> #!/bin/sh
>
> to
>
> #!bin/sh
>
> So please be cautious when editing these scripts.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jun  4 15:50:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Jun 2013 15:50:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ connection(s) Blocking !
In-Reply-To: <1370348224821-27187.post@n5.nabble.com>
References: <1370001850389-27114.post@n5.nabble.com>
	<51A8CDEE.4040007@rabbitmq.com>
	<1370348224821-27187.post@n5.nabble.com>
Message-ID: <51ADFEA0.30504@rabbitmq.com>

You need to find out where the memory is going first - did you look at 
the link http://www.rabbitmq.com/memory-use.html in my previous mail?

If as you say the queues are already empty it would be very odd to find 
that RabbitMQ is using a lot of memory. So we need to get to the bottom 
of that.

Cheers, Simon

On 04/06/13 13:17, tluck wrote:
> Hi Simon,
>
> Thanks for your reply. But, still I don't know how to get rid of this
> problem and now this issue appears at least once in a day and every time I
> execute commands `swapoff -a` and then `swapon -a`  to clear swap memory.
> This does not seem to be a right solution. Is there anything (command)  that
> I can use to clear RMQ allocated memory. I have a shell script which run
> every minute (through crontab) and I can use/modify this script to run
> command(s) (to clear memory).
>
> Thanks
> T.luck
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-connection-s-Blocking-tp27114p27187.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jun  4 16:16:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Jun 2013 16:16:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
 failures when recovering from cluster partition
In-Reply-To: <7F7BFE76D0F5234F9258D88C37C9EC6B1520C8A0@VALVCSMBX002PH.val.vlss.local>
References: <7F7BFE76D0F5234F9258D88C37C9EC6B151C31EE@VALVCSMBX001PH.val.vlss.local>
	<5199FB29.70306@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F0BBA@VALVCSMBX001PH.val.vlss.local>
	<51A8D0B9.7040200@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B151F43A4@VALVCSMBX001PH.val.vlss.local>
	<51AC71B2.4050504@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B15205E9A@VALVCSMBX002PH.val.vlss.local>
	<51ACB13F.9040505@rabbitmq.com>
	<7F7BFE76D0F5234F9258D88C37C9EC6B1520C8A0@VALVCSMBX002PH.val.vlss.local>
Message-ID: <51AE04DB.9090200@rabbitmq.com>

Yeah, that's roughly what I'm doing, and I don't see this trickle effect 
- once each side of the cluster decides the other one has gone down then 
we see things running at full speed.

I assume you are seeing node down messages in the logs on both sides / 
rabbitmqctl and management showing the other nodes as down in each case?

Cheers, Simon

On 03/06/13 16:17, Maslinski, Ray wrote:
> I've tried a few variants without noticing any apparent differences in behavior, here's what I currently have:
>
> 		sudo iptables -A INPUT -i eth0 -p tcp -s $address -j DROP
> 		sudo iptables -A OUTPUT -o eth0 -p tcp -d $address -j DROP
>
> where $address is the ip address of the other node in the mirror.
>
> The other variants included adding a specific port to only drop traffic on the cluster port between the two nodes (--dport $port to above commands), and dropping all traffic on the cluster port, regardless of ip address (adding the --dport option and removing the -s/-d options).
>
> Ray Maslinski
> Senior Software Developer, Engineering
> Valassis / Digital Media
> Cell: 585.330.2426
> maslinskir at valassis.com
> www.valassis.com
>
> Creating the future of intelligent media delivery to drive your greatest success
>
> _____________________________________________________________________________
>
> This message may include proprietary or protected information. If you are not the intended
> recipient, please notify me, delete this message and do not further communicate the information
> contained herein without my express consent.
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Monday, June 03, 2013 11:08 AM
> To: Maslinski, Ray
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures when recovering from cluster partition
>
> Hmm. While the partition is in effect neither side should be aware that the other side is up at all - we assume if we lose contact with a node that it has crashed. So I'm quite surprised by the slow trickle you are seeing, since I'm sure people don't see that if part of a cluster just crashes.
>
> So I am more suspicious that the iptables commands you are using are in fact not simulating a real partitioning of the cluster.
>
> Can you post the iptables commands you are using and I will try to replicate?
>
> Cheers, Simon
>
> On 03/06/13 14:01, Maslinski, Ray wrote:
>> For this particular test, I was trying to gain some insight as to the
>> behavior of the cluster while the partition was in effect, so the
>> partition wasn't resolved until the test was completed or aborted.
>> My general expectation was that both sides of the partition would
>> begin to process messages more or less normally once the cluster
>> connection timed out and the slave promoted itself to master, possibly
>> with some glitches such as dropped messages during the transition.
>> The slow trickle of messages delivered on one of the existing
>> connections was unexpected, and seemed to be a bit of an anomaly when
>> combined with the growing count of unacked messages shown on the
>> console.
>>
>> Ray Maslinski Senior Software Developer, Engineering Valassis /
>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
>> www.valassis.com
>>
>> Creating the future of intelligent media delivery to drive your
>> greatest success
>>
>> ______________________________________________________________________
>> _______
>>
>>   This message may include proprietary or protected information. If you
>> are not the intended recipient, please notify me, delete this message
>> and do not further communicate the information contained herein
>> without my express consent.
>>
>> -----Original Message----- From: Simon MacMullen
>> [mailto:simon at rabbitmq.com] Sent: Monday, June 03, 2013 6:37 AM To:
>> Maslinski, Ray Cc: Discussions about RabbitMQ Subject: Re:
>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures
>> when recovering from cluster partition
>>
>> Just to be clear - at what point in this test are you unblocking the
>> connection so the partition can heal?
>>
>> Cheers, Simon
>>
>> On 31/05/13 20:04, Maslinski, Ray wrote:
>>> The net_ticktime is using the default value, and event sequence seems
>>> consistent with the associated timeout.
>>>
>>> Roughly,
>>>
>>> Start test
>>>
>>> Block cluster connection at some point -> trace data shows that only
>>> publish events are occurring after this happens
>>>
>>> After a bit more than a minute, RabbitMQ server log shows lost
>>> cluster connection on both nodes, along with the death of the mirrors
>>> and promotion of slave to master.
>>>
>>> Test continues and completes publish phase, since these appeared to
>>> be progressing normally, with no errors visible to client
>>>
>>> Test then starts to verify that all messages were received by polling
>>> the contents of a buffer used to store incoming messages.
>>> In a normal scenario without faults, this generally means that the
>>> first poll finds all the messages expected to be present and test
>>> completes successfully.  Otherwise, the poll rechecks for any missing
>>> messages once per second, and gives up if 30 seconds elapse without
>>> any new messages showing up (timer is reset if any messages arrived
>>> during polling window).
>>>
>>> The slow trickle of messages occurs during the last phase, as one
>>> appears to arrive every 14 seconds and the polling loop continues to
>>> retry.  Trace data doesn't appear to log any deliver events during
>>> this stage, but console shows a slow increment in the number of
>>> unacknowledged messages that lines up with the delivery rate observed
>>> by the client.
>>>
>>> Ray Maslinski Senior Software Developer, Engineering Valassis /
>>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
>>> www.valassis.com
>>>
>>> Creating the future of intelligent media delivery to drive your
>>> greatest success
>>>
>>> _____________________________________________________________________
>>> _
>>>
>>>
> _______
>>>
>>> This message may include proprietary or protected information. If you
>>> are not the intended recipient, please notify me, delete this message
>>> and do not further communicate the information contained herein
>>> without my express consent.
>>>
>>>
>>> -----Original Message----- From: Simon MacMullen
>>> [mailto:simon at rabbitmq.com] Sent: Friday, May 31, 2013 12:33 PM
>>> To: Maslinski, Ray Cc: Discussions about RabbitMQ Subject: Re:
>>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures
>>> when recovering from cluster partition
>>>
>>> Hi. The behaviour you describe doesn't really match what I would
>>> expect to see. In the beginning of a partition I would expect:
>>>
>>> 1) Partition starts
>>>
>>> 2) Things behave slowly for approximately net_ticktime (see
>>> http://www.rabbitmq.com/partitions.html#net_ticktime) as nodes
>>> attempt to contact each other and time out
>>>
>>> 3) On each node, Erlang decides the other nodes are down. Things
>>> speed up again, HA queues fail over. Split-brain has begun.
>>>
>>> It sounds like you were stuck in 2) for an extended period of time.
>>> Have you changed net_ticktime?
>>>
>>> Alternatively, when testing partitions I have see really odd
>>> behaviour by blocking network traffic in one direction only with
>>> iptables. You might want to check if you've done that by mistake.
>>>
>>> Cheers, Simon
>>>
>>> On 30/05/13 22:14, Maslinski, Ray wrote:
>>>> Follow-up question ...
>>>>
>>>> I tried some experiments to gain some understanding of how the
>>>> cluster behaved with clients attached during a network partition
>>>> event. Essentially, I repeated the previous tests described below
>>>> for autohealing and automatic queue synchronization, but left the
>>>> cluster communications port blocked while the client test completed.
>>>> One oddity I noticed was that while the consumer connected to the
>>>> slave appeared to receive an indication that something was amiss
>>>> (client log showed a consumer cancel exception being handled by the
>>>> Spring AMQP framework, and other monitoring logs appeared to show
>>>> the client restarting a connection, which seems to be consistent
>>>> with documentation), the consumer connected to the master seemed to
>>>> remain oblivious to any possible issues. That consumer continued to
>>>> receive messages, but at an extremely slow rate (test published at
>>>> 16/sec fixed rate, but the remaining consumer began to receive
>>>> messages at the rate of about 1 every 14 seconds).
>>>>
>>>> Since the test client waits around for expected message deliveries
>>>> with a resettable 30 second timeout, it continued to run for an
>>>> extended period of time (longer than I waited around for).  In
>>>> addition, the admin console showed a relatively small number of
>>>> unacked messages on that server, with the unacked count increasing
>>>> with each actual delivery (client should always be acknowledging in
>>>> the test setup, and reported no errors).
>>>> Eventually unblocking the cluster port released a bunch of messages
>>>> in a short interval (albeit with some lost, as described
>>>> previously).
>>>>
>>>> I also saw  producer connections go into flow control during the
>>>> outage and remain there during the slow consumer delivery (though
>>>> the test had long since completed delivering all its messages).
>>>>
>>>> Does this sound like expected behavior during a partition?
>>>>
>>>> Ray Maslinski Senior Software Developer, Engineering Valassis /
>>>> Digital Media Cell: 585.330.2426 maslinskir at valassis.com
>>>> www.valassis.com
>>>>
>>>> Creating the future of intelligent media delivery to drive your
>>>> greatest success
>>>>
>>>> ____________________________________________________________________
>>>> _
>>>>
>>>>
> _
>>>>
>>>>
>> _______
>>>>
>>>> This message may include proprietary or protected information. If
>>>> you are not the intended recipient, please notify me, delete this
>>>> message and do not further communicate the information contained
>>>> herein without my express consent.
>>>>
>>>> -----Original Message----- From: Simon MacMullen
>>>> [mailto:simon at rabbitmq.com] Sent: Monday, May 20, 2013 6:30 AM
>>>> To: Discussions about RabbitMQ Cc: Maslinski, Ray Subject: Re:
>>>> [rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal
>>>> failures when recovering from cluster partition
>>>>
>>>> On 17/05/13 20:38, Maslinski, Ray wrote:
>>>>> Hello,
>>>>
>>>> Hi!
>>>>
>>>>> To simulate a network partition failure, I've been using iptables
>>>>> to temporarily block inbound and outbound access on one of the
>>>>> nodes to the single port configured for cluster communications
>>>>> through inet_dist_listen_min and inet_dist_listen_max settings (min
>>>>> = max). Client access is not blocked during a simulated partition
>>>>> fault.
>>>>
>>>> Sounds reasonable.
>>>>
>>>>> I've observed two anomalies during testing that I wasn't expecting
>>>>> based on the documentation I've read:
>>>>>
>>>>> -At a sufficiently high message rate, some number of messages will
>>>>> be lost during the fault sequence, with the number lost tending to
>>>>> increase with message rate.  No indication of a send error has been
>>>>> observed by the client program. Based on results obtained from test
>>>>> logs and an independent monitor listening on trace messages from
>>>>> each node, it appears that as soon as the port is blocked, both
>>>>> nodes continue to accept published messages, but (temporarily) stop
>>>>> delivering messages until the cluster heartbeat failure is
>>>>> detected, at which point the cluster is partitioned and the slave
>>>>> promotes itself to become master. In the sequences I've looked at,
>>>>> the messages that are lost all appear to be published to the
>>>>> original master (and final master after a winner is selected during
>>>>> autoheal).
>>>>> Neither the start nor the end of the lost message window appear to
>>>>> line up with any events in the logs, other than the start occurring
>>>>> sometime after the port connection is blocked but before the
>>>>> cluster heartbeat failure is detected, and the end occurring
>>>>> sometime after the detection of the cluster heartbeat failure and
>>>>> before the detection of the partitioned cluster after the
>>>>> connection is unblocked.  Is message loss to be expected in this
>>>>> scenario?
>>>>
>>>> I would expect to see message loss in a cluster heal scenario.
>>>>
>>>> It's important to remember that a cluster partition is still a
>>>> substantial problem, and the healing process involves throwing state
>>>> away. Autoheal mode just means you get through this process faster,
>>>> and hopefully spend much less time accepting messages that will end
>>>> up being lost.
>>>>
>>>> I would expect intuitively that only messages from the losing
>>>> partitions would be lost. But I am not entirely surprised if
>>>> messages from the winner are lost too; there is a period after the
>>>> partitions have come back together but before autoheal kicks in
>>>> during which we will have multiple masters for a queue, and
>>>> behaviour can be unpredictable.
>>>>
>>>>> -Occasionally the autoheal loser node fails to rejoin the cluster
>>>>> after restart.  I don't have a lot of data points on this one since
>>>>> it's only happened a handful of times during overnight test
>>>>> iterations.  During one failure, the autoheal winner showed the log
>>>>> message below during recovery:
>>>>
>>>> Ah, that looks like a bug in autoheal. I think the stack trace you
>>>> posted should contain enough information to fix it. Thanks.
>>>>
>>>> Cheers, Simon
>>>>
>>>> -- Simon MacMullen RabbitMQ, Pivotal
>>>>
>>>
>>>
>>> -- Simon MacMullen RabbitMQ, Pivotal
>>>
>>
>>
>> -- Simon MacMullen RabbitMQ, Pivotal
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From bradpeabody at gmail.com  Tue Jun  4 18:08:36 2013
From: bradpeabody at gmail.com (Brad Peabody)
Date: Tue, 4 Jun 2013 10:08:36 -0700
Subject: [rabbitmq-discuss] contributor agreement
Message-ID: <66B0D4BE-4586-44D3-8E5E-E9FF06B8C691@gmail.com>

Hi (Tim),

Per this https://github.com/rabbitmq/rabbitmq-java-client/pull/7 I guess I need a Contributor Agreement to have my changes merged in.  Can someone send the file or a link or whatever it is my way?  Thanks.

Best, Brad

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130604/ecbbd656/attachment.htm>

From matthias at rabbitmq.com  Tue Jun  4 18:17:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 04 Jun 2013 18:17:34 +0100
Subject: [rabbitmq-discuss] AMQP 0-1 specification?
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D340126@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D340126@FR44EX3005.global.ds.honeywell.com>
Message-ID: <51AE212E.80805@rabbitmq.com>

Petr,

On 03/06/13 17:23, Gotthard, Petr wrote:
> Do you know if there is a way to obtain the ancient AMQP 0-1
> specification? (Not 1.0, the very old 0-1.)

I don't think AMQP 0-1 was ever released to the public.

Matthias.

From pavel.kogan at cortica.com  Tue Jun  4 18:42:32 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Tue, 4 Jun 2013 12:42:32 -0500
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CAABB5w8ehtDSmp7vYDO-KV0v2XRORC-B1+PKh3k5SRm4Mvv_pw@mail.gmail.com>

Hi all,

We started getting following error from time to time in number of our
client applications.

*A connection attempt failed because the connected party did not
properly **respond
after a period of time, or established connection failed because
connected** host
has failed to respond*

*   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)*

*   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()*

*   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()*

*   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()*

What is interesting is that client continue consuming messages but do no
processing. We use RabbitMQ Server 3.0.1, Erlang R14B04 and .Net client (I
am not sure about version but one of latest).

Did anyone meet this problem before?

Thanks,

   Pavel




*
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130604/4fa1a642/attachment.htm>

From pavel.kogan at cortica.com  Tue Jun  4 18:44:22 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Tue, 4 Jun 2013 12:44:22 -0500
Subject: [rabbitmq-discuss] Connection Attempt Failed
Message-ID: <CAABB5w-7Y7j8_EbTQBPd5s3iJHWj0KkySpJyMWyLPf857gmw-A@mail.gmail.com>

Hi all,

We started getting following error from time to time in number of our
client applications.

*A connection attempt failed because the connected party did not
properly **respond
after a period of time, or established connection failed because
connected** host
has failed to respond*

*   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)*

*   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()*

*   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()*

*   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()*

What is interesting is that client continue consuming messages but do no
processing. We use RabbitMQ Server 3.0.1, Erlang R14B04 and .Net client (I
am not sure about version but one of latest).

Did anyone meet this problem before?

Thanks,

   Pavel

P.S Sorry for duplicate mail. Forgot to add title to first one.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130604/bb7456af/attachment.htm>

From vijjivinay at gmail.com  Tue Jun  4 18:45:12 2013
From: vijjivinay at gmail.com (Vijay Lakshmi)
Date: Tue, 4 Jun 2013 23:15:12 +0530
Subject: [rabbitmq-discuss] Consuming multiple messages at a time
Message-ID: <CAHPrJT1v_1=yfr6qFmSesWy2uHgAf0RS3NdswZSwXT3oZcJx+Q@mail.gmail.com>

Hi,

We have an application where in for each client we create a Queue in
RabbitMQ.
(i.e. we create a binding with client id to a common exchange)
So, all messages that are published with binding key as client id will go
to that queue.

There is only single client which subscribes to this Queue.
The queue will get messages at the rate of 100 msgs/sec for example.

RabbitMQ is sending only 1 message at a time to the consumer. Even if we
set the prefetch count as higher value, the messages are delivered only one
by one.
The callback method in consumer can consume only single message.

void *handleDelivery*(java.lang.String consumerTag,
                    Envelope
<http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.1/rabbitmq-java-client-javadoc-3.1.1/com/rabbitmq/client/Envelope.html>
envelope,
                    AMQP.BasicProperties
<http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.1/rabbitmq-java-client-javadoc-3.1.1/com/rabbitmq/client/AMQP.BasicProperties.html>
properties,
                    byte[] body)
                    throws java.io.IOException

Is there a way in RabbitMQ where in we enable RabbitMQ to send mutiple
messages to consumer at a time. In my case there is only one consumer per
queue. So, by sending mutiple messages to consumer at a time will improve
my performance.

Can someone suggest how I can achieve this.
If rabbitMQ does not support, is there any other way of achieving this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130604/8b872944/attachment.htm>

From gstepken at googlemail.com  Tue Jun  4 21:17:17 2013
From: gstepken at googlemail.com (Guido Stepken)
Date: Tue, 4 Jun 2013 22:17:17 +0200
Subject: [rabbitmq-discuss] ERLANG design flaws cause performance problems?
Message-ID: <CANXOX8_EqyM8xbETRrRZcZhU91Oakw9MFEpKqV7Hv=B2Qk6EPQ@mail.gmail.com>

I was really surprised from that analysis about ERLANG internals:

http://www.unlimitednovelty.com/2011/07/trouble-with-erlang-or-erlang-is-ghetto.html

Are these resolved in the mean time?

Tnx in advance,

Have fun!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130604/fadc550c/attachment.htm>

From watson.timothy at gmail.com  Tue Jun  4 21:41:21 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 4 Jun 2013 21:41:21 +0100
Subject: [rabbitmq-discuss] ERLANG design flaws cause performance
	problems?
In-Reply-To: <CANXOX8_EqyM8xbETRrRZcZhU91Oakw9MFEpKqV7Hv=B2Qk6EPQ@mail.gmail.com>
References: <CANXOX8_EqyM8xbETRrRZcZhU91Oakw9MFEpKqV7Hv=B2Qk6EPQ@mail.gmail.com>
Message-ID: <A070BD92-3033-4BE7-AA5C-AE8EA8E8388A@rabbitmq.com>

Guido,

Tony is a smart guy and has some interesting opinions, but in general this kind of discussion belongs on erlang-questions not rabbitmq-discuss.

Tim

On 4 Jun 2013, at 21:17, Guido Stepken <gstepken at googlemail.com> wrote:

> I was really surprised from that analysis about ERLANG internals:
> 
> http://www.unlimitednovelty.com/2011/07/trouble-with-erlang-or-erlang-is-ghetto.html
> 
> Are these resolved in the mean time?
> 
> Tnx in advance,
> 
> Have fun!
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130604/acdc3a15/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun  4 21:40:57 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 5 Jun 2013 00:40:57 +0400
Subject: [rabbitmq-discuss] ERLANG design flaws cause performance
	problems?
In-Reply-To: <CANXOX8_EqyM8xbETRrRZcZhU91Oakw9MFEpKqV7Hv=B2Qk6EPQ@mail.gmail.com>
References: <CANXOX8_EqyM8xbETRrRZcZhU91Oakw9MFEpKqV7Hv=B2Qk6EPQ@mail.gmail.com>
Message-ID: <CAE3HoVRK5m8jJdcOzzaBm_CC+MngTBCyWnpd-zSCY9W9+4SEmw@mail.gmail.com>

2013/6/5 Guido Stepken <gstepken at googlemail.com>

>
> http://www.unlimitednovelty.com/2011/07/trouble-with-erlang-or-erlang-is-ghetto.html
>
> Are these resolved in the mean time?
>

A lot of that blog post is venting and is not backed by facts.

"Erlang sucks at managing memory" is
a meaningless statement unless it is backed by data and specifics about the
workload.

Oracle JVM with large heaps (> 8 GB in my experience) suffers from pauses
in seconds on old generation
collections. Can we say that "JVM sucks at managing memory"? I don't know.
For some workloads
this problem makes latency very unpredictable. For some apps it's not an
issue.

Erlang proceses do not share memory so its GC has significantly less work
to do and this
particular problem is not applicable to Erlang.

JIT is coming to the Erlang VM in one of the future releases [1]. Only time
will tell what kind of performance
gain for real world projects it may bring.

Be very suspicious of all "X is a ghetto" blog posts. They typically
provide next to no specific data
and tend to stir up the drama to make the author famous in the circles of
rockstar ninja developers.

1.
http://www.confreaks.com/videos/2039-erlangfactorysf2012-just-in-time-compiler-for-the-erlang-vm
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/a3d45db4/attachment.htm>

From jesper.louis.andersen at gmail.com  Tue Jun  4 21:46:40 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Tue, 4 Jun 2013 22:46:40 +0200
Subject: [rabbitmq-discuss] ERLANG design flaws cause performance
	problems?
In-Reply-To: <A070BD92-3033-4BE7-AA5C-AE8EA8E8388A@rabbitmq.com>
References: <CANXOX8_EqyM8xbETRrRZcZhU91Oakw9MFEpKqV7Hv=B2Qk6EPQ@mail.gmail.com>
	<A070BD92-3033-4BE7-AA5C-AE8EA8E8388A@rabbitmq.com>
Message-ID: <CAGrdgiVO8V0OUbT4ci_1kzZei7xCCZ2iyJJytu4fC3Ec+ZEzLA@mail.gmail.com>

And to make it clear: the problems Tony writes about are either subjective
to his opinion, has an obvious workaround or has been addressed already.


On Tue, Jun 4, 2013 at 10:41 PM, Tim Watson <watson.timothy at gmail.com>wrote:

> Guido,
>
> Tony is a smart guy and has some interesting opinions, but in general this
> kind of discussion belongs on erlang-questions not rabbitmq-discuss.
>
> Tim
>
> On 4 Jun 2013, at 21:17, Guido Stepken <gstepken at googlemail.com> wrote:
>
> I was really surprised from that analysis about ERLANG internals:
>
>
> http://www.unlimitednovelty.com/2011/07/trouble-with-erlang-or-erlang-is-ghetto.html
>
> Are these resolved in the mean time?
>
> Tnx in advance,
>
> Have fun!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130604/dfea4013/attachment.htm>

From emile at rabbitmq.com  Wed Jun  5 09:45:32 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 05 Jun 2013 09:45:32 +0100
Subject: [rabbitmq-discuss] Connection Attempt Failed
In-Reply-To: <CAABB5w-7Y7j8_EbTQBPd5s3iJHWj0KkySpJyMWyLPf857gmw-A@mail.gmail.com>
References: <CAABB5w-7Y7j8_EbTQBPd5s3iJHWj0KkySpJyMWyLPf857gmw-A@mail.gmail.com>
Message-ID: <51AEFAAC.80507@rabbitmq.com>

On 04/06/13 18:44, Pavel Kogan wrote:
> A connection attempt failed because the connected party did not 
> properly respond after a period of time, or established connection 
> failed because connected host has failed to respond


Was the connection attempt or an error reported in the broker logfile?
Does the connection ever show up in "rabbitmqctl list_connections"?
Using AMQP heartbeats may help, depending on when the error occurs.

That error indicates a possible problem on the network between the
client and broker. Check that your application works over the loopback
interface and then use a process of elimination to determine whether a
network device is responsible.



-Emile






From emile at rabbitmq.com  Wed Jun  5 10:10:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 05 Jun 2013 10:10:57 +0100
Subject: [rabbitmq-discuss] Consuming multiple messages at a time
In-Reply-To: <CAHPrJT1v_1=yfr6qFmSesWy2uHgAf0RS3NdswZSwXT3oZcJx+Q@mail.gmail.com>
References: <CAHPrJT1v_1=yfr6qFmSesWy2uHgAf0RS3NdswZSwXT3oZcJx+Q@mail.gmail.com>
Message-ID: <51AF00A1.90001@rabbitmq.com>


Hi,

On 04/06/13 18:45, Vijay Lakshmi wrote:
> Is there a way in RabbitMQ where in we enable RabbitMQ to send mutiple
> messages to consumer at a time. In my case there is only one consumer
> per queue. So, by sending mutiple messages to consumer at a time will
> improve my performance.

(I assume by performance you mean throughput and lower overhead rather
than latency.)

You can batch messages by combining multiple logical messages into one
message in the publisher. Consumers will then have to decompose this
message to retrieve individual logical messages. RabbitMQ does not offer
built-in support for this. Bear in mind that the broker deals with
batched rather than the individual component messages for purposes of
message acknowledgement, rejection, TTL, etc.

You should use a message composition/decomposition scheme that makes
sense in your application. Simple concatenation may be sufficient if you
record message boundaries in a header. If messages are in XML format
then you could wrap them in a container element.


-Emile









From emile at rabbitmq.com  Wed Jun  5 10:28:53 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 05 Jun 2013 10:28:53 +0100
Subject: [rabbitmq-discuss] Consuming multiple messages at a time
In-Reply-To: <CAHPrJT1v_1=yfr6qFmSesWy2uHgAf0RS3NdswZSwXT3oZcJx+Q@mail.gmail.com>
References: <CAHPrJT1v_1=yfr6qFmSesWy2uHgAf0RS3NdswZSwXT3oZcJx+Q@mail.gmail.com>
Message-ID: <51AF04D5.9060509@rabbitmq.com>



On 04/06/13 18:45, Vijay Lakshmi wrote:
> RabbitMQ is sending only 1 message at a time to the consumer. Even if we
> set the prefetch count as higher value, the messages are delivered only
> one by one.

Actually the broker may be sending multiple messages to the consumer,
even though the consumer only processes one message at a time. If you
set the prefetch-count to a large number then there should be minimal
latency between invocations of handleDelivery().






From krishna1256 at gmail.com  Wed Jun  5 10:46:37 2013
From: krishna1256 at gmail.com (saikrishna sripada)
Date: Wed, 5 Jun 2013 02:46:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Running RPC across two separate Virtual
	Machines?
In-Reply-To: <6bf7da22-7e56-410c-9ec1-784806a4990c@googlegroups.com>
References: <91825fcc-3afc-44f9-9858-ac8dc27dc8d2@googlegroups.com>
	<6bf7da22-7e56-410c-9ec1-784806a4990c@googlegroups.com>
Message-ID: <3cf4efe0-baf4-4e70-b248-63a8b22905e3@googlegroups.com>

Hi Eric,

Hope your problem is solved. can you please send me the steps ho you have 
set up your rabbitmq and how you are able to communicate between vms.

On Saturday, 9 March 2013 01:36:43 UTC+5:30, Eric Sender wrote:
>
> I got a reply from Emile which doesn't appear on this forum for some 
> reason? But I have a follow up question.
>
>
> *Here is her reply:*
> -------
>
> Hi Eric,
>
> On 08/03/13 07:24, Eric Sender wrote:
>
> I have RabbitMQ service working on both Guest OS's 
>
> You only need one broker. Both the RPC server and client must use the
> same broker.
>
>
> How should I set it up properly to have RabbitMQ talking to separate VMs?
>
> You must first make sure that the broker VM can accept connections. If
> you see a routing error then that VM might be using NAT. As soon as you
> have the VMs able to communicate the tutorial examples should work. You
> should consult the hypervisor documentation on how to set up networking.
>
>
>
> -Emile
> ------*My follow up question:*
>
> Is there a tutorial on how to set up the networking properly so RabbitMQ 
> can talk outside of its VM? I know the basics of networking, but I'm not 
> advanced enough for that level of it.
>
> Also, when you say "broker" you mean "server" right? Only one of the VMs 
> needs to run the rpc_server.py script?
>
>
>
> Thanks,
> Eric
>
>
>
> On Thursday, March 7, 2013 11:24:26 PM UTC-8, Eric Sender wrote:
>>
>> I have been going through the RabbitMQ tutorial step by step and making 
>> sure I can do all the basics. Rabbit seems very interesting and promising, 
>> but I am having some issues getting RabbitMQ to talk to other machines.
>>
>> My current set up is:
>>
>> Host OS: Windows 7 --- not relevant here, I am only running RabbitMQ on 
>> the Guest OS's
>> Guest OS 1 (VMWare Player): CentOS 6.3
>> Guest OS 2 (VirtualBox): CentOS 6.3
>>
>> I have RabbitMQ service working on both Guest OS's and I have Guest OS 1 
>> running rpc_server.py and Guest OS 2 running rpc_client.py. 
>>
>> But I am unsure how to get those separate VMs talking to each other with 
>> the rpc_server.py.
>>
>> I have tried editing the following line in rpc_client.py
>>
>> Line 7: self.connection = 
>> pika.BlockingConnection(pika.ConnectionParameters(host='192.168.1.84')) #changed 
>> from 'localhost'
>>
>> So that it reflects the IP address of the server VM, but it I get 
>> "socket.error: [Errno 113] No route to host"
>>
>> How should I set it up properly to have RabbitMQ talking to separate VMs?
>>
>>
>> Thanks
>> Eric
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/e4f4e62d/attachment.htm>

From emile at rabbitmq.com  Wed Jun  5 11:34:38 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 05 Jun 2013 11:34:38 +0100
Subject: [rabbitmq-discuss] Running RPC across two separate Virtual
	Machines?
In-Reply-To: <3cf4efe0-baf4-4e70-b248-63a8b22905e3@googlegroups.com>
References: <91825fcc-3afc-44f9-9858-ac8dc27dc8d2@googlegroups.com>
	<6bf7da22-7e56-410c-9ec1-784806a4990c@googlegroups.com>
	<3cf4efe0-baf4-4e70-b248-63a8b22905e3@googlegroups.com>
Message-ID: <51AF143E.5000803@rabbitmq.com>



On 05/06/13 10:46, saikrishna sripada wrote:
> Hope your problem is solved. can you please send me the steps ho you
> have set up your rabbitmq and how you are able to communicate between vms.

The key point was the the VM hosting the broker must be able to accept
connections. NAT won't work. The VM(s) hosting the RPC scripts can use NAT.



I don't think the following question appeared on the mailing list:
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

> On Saturday, 9 March 2013 01:36:43 UTC+5:30, Eric Sender wrote:
>     Is there a tutorial on how to set up the networking properly so
>     RabbitMQ can talk outside of its VM?

There may well be tutorials for setting up networking on your choice of
hypervisor, but this is not a RabbitMQ-specific topic.

>     Also, when you say "broker" you mean "server" right? Only one of the
>     VMs needs to run the rpc_server.py script?

"RPC Server" and "broker" are not the same thing. The RPC client and RPC
server communicate with the help of the broker. The tutorial requires
only one instance of the RPC server script to be running.





-Emile














From tim at rabbitmq.com  Wed Jun  5 13:00:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 5 Jun 2013 13:00:29 +0100
Subject: [rabbitmq-discuss] contributor agreement
In-Reply-To: <66B0D4BE-4586-44D3-8E5E-E9FF06B8C691@gmail.com>
References: <66B0D4BE-4586-44D3-8E5E-E9FF06B8C691@gmail.com>
Message-ID: <7D475279-136A-47DA-A030-8C26FDA15503@rabbitmq.com>

Hi Brad,

Please find a copy of the contributor agreement attached. If you could fill this out and email it back to me, that would be great.

Cheers!

Tim



On 4 Jun 2013, at 18:08, Brad Peabody wrote:

> Hi (Tim),
> 
> Per this https://github.com/rabbitmq/rabbitmq-java-client/pull/7 I guess I need a Contributor Agreement to have my changes merged in.  Can someone send the file or a link or whatever it is my way?  Thanks.
> 
> Best, Brad
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/148f3b08/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Contribution Agreement RABBIT (Corp. + Ind.) Pivotal.pdf
Type: application/pdf
Size: 97498 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/148f3b08/attachment.pdf>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/148f3b08/attachment-0001.htm>

From carl.hoerberg at gmail.com  Wed Jun  5 13:56:38 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 5 Jun 2013 05:56:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Node crash, then cluster collapse
Message-ID: <1370436998585-27206.post@n5.nabble.com>

On a three node cluster, one ec2 machine reboots unexpectedly, and when it
starts up again RabbitMQ fails to start. I've put all logs here:
https://gist.github.com/carlhoerberg/ff6c6bd4f7639bf4b2f5

When the troubled node is restarted manually again it's unable to join,
stopping at "adding mirrors", staying there forever. 

The other nodes now start to behave weird too, new queues can't be declared,
but existing queues seems to continue deliver messages. They also can't
respond to "rabbitmqctl status", or /api/overview. I'm forced to stop them
with "kill -9". Only when all nodes are stopped the cluster can be brought
up again normally. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Node-crash-then-cluster-collapse-tp27206.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Wed Jun  5 16:35:20 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 5 Jun 2013 08:35:20 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
In-Reply-To: <51AC6EEE.3000208@rabbitmq.com>
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
	<51AC6EEE.3000208@rabbitmq.com>
Message-ID: <1370446520040-27207.post@n5.nabble.com>

Is it possible that /api/overview?columns=message_stats.publish_details.rate
only returns the rate for that node in a cluster? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-1-0-HTTP-API-rates-are-always-zero-tp27154p27207.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Wed Jun  5 16:37:33 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 5 Jun 2013 08:37:33 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.1.1 HTTP API leaks information
Message-ID: <1370446653813-27208.post@n5.nabble.com>

With rabbitmq 3.1 the /api/overview does report the global message count and
stats to "management" users, which, at least previously, only could see
message counts and stats related to their vhost(s). 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-1-1-HTTP-API-leaks-information-tp27208.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Jun  5 16:50:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 05 Jun 2013 16:50:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
In-Reply-To: <1370446520040-27207.post@n5.nabble.com>
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
	<51AC6EEE.3000208@rabbitmq.com>
	<1370446520040-27207.post@n5.nabble.com>
Message-ID: <51AF5E55.2020603@rabbitmq.com>

On 05/06/13 16:35, carlhoerberg wrote:
> Is it possible that /api/overview?columns=message_stats.publish_details.rate
> only returns the rate for that node in a cluster?

No, that's cluster-wide.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From carl.hoerberg at gmail.com  Wed Jun  5 16:52:00 2013
From: carl.hoerberg at gmail.com (=?utf-8?Q?Carl_H=C3=B6rberg?=)
Date: Wed, 5 Jun 2013 23:52:00 +0800
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
In-Reply-To: <51AF5E55.2020603@rabbitmq.com>
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
	<51AC6EEE.3000208@rabbitmq.com>
	<1370446520040-27207.post@n5.nabble.com>
	<51AF5E55.2020603@rabbitmq.com>
Message-ID: <4148C097DBD8483D9214A544B3B8DC2A@gmail.com>

Well, for us it's reporting 0 on all nodes not receiving traffic =/ 



On Wednesday 5 June 2013 at 23:50, Simon MacMullen wrote:

> On 05/06/13 16:35, carlhoerberg wrote:
> > Is it possible that /api/overview?columns=message_stats.publish_details.rate
> > only returns the rate for that node in a cluster?
> 
> 
> 
> No, that's cluster-wide.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal




From simon at rabbitmq.com  Wed Jun  5 16:56:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 05 Jun 2013 16:56:26 +0100
Subject: [rabbitmq-discuss] 3.1.1 HTTP API leaks information
In-Reply-To: <1370446653813-27208.post@n5.nabble.com>
References: <1370446653813-27208.post@n5.nabble.com>
Message-ID: <51AF5FAA.1060702@rabbitmq.com>

On 05/06/13 16:37, carlhoerberg wrote:
> With rabbitmq 3.1 the /api/overview does report the global message count and
> stats to "management" users, which, at least previously, only could see
> message counts and stats related to their vhost(s).

Ah, yes, that's a bug in the new management database. Will be fixed in 
3.1.2.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From daniel at siftlogic.com  Wed Jun  5 17:00:45 2013
From: daniel at siftlogic.com (Daniel Luna)
Date: Wed, 5 Jun 2013 12:00:45 -0400
Subject: [rabbitmq-discuss] Possible process leak in RabbitMQ server
Message-ID: <CAMbH-owesAXQfpVsAsFSB+FFKe6c9NwmAh5JWePMtrT3FEOcWQ@mail.gmail.com>

Hi,

We are experiencing a growth of processes in the rabbitmq server for long
running connections.  I have no idea if we are doing something wrong or if
this is a bug in rabbitmq itself.

In an idle system we have about 30k connections to rabbitmq, using around
31k channels.

Sockets and file descriptors match more or less one-to-one to the
connections and so does the number of Erlang processes initally.  My
problem here is that the number of Erlang processes is steadily growing.

At the moment we have ~500k Erlang processes in our rabbitmq server with
47k connections using 54k channels.  As soon as the load on our system
lightens up the number of connections and channels will go down as
expected, but the number of processes will stay high.

Restarting the client will drop the process count, so this is something
related to keeping long living connections and/or channels around.

Oh, yeah, upgrading from 2.8.2 to 3.1.1 made no difference.

Connection counts are steady as are channel counts (i.e. they grow and
shrink as expected depending on load).  We use both a polling and a
subscribing pattern depending on the particular consumer.  I've seen a
system with all empty queues have this issue so it's not based on that
either.

I'm suspecting that there's a missing exit that leaves a dangling processes
for some sort of operation. It's something that's properly linked with the
connection (or channel) though since they go away on connection restart.

I'll research some more and see what I can dig up.

Help would be appreciated.

Cheers,

Daniel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/ced2d1dd/attachment.htm>

From simon at rabbitmq.com  Wed Jun  5 17:03:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 05 Jun 2013 17:03:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
In-Reply-To: <4148C097DBD8483D9214A544B3B8DC2A@gmail.com>
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
	<51AC6EEE.3000208@rabbitmq.com>
	<1370446520040-27207.post@n5.nabble.com>
	<51AF5E55.2020603@rabbitmq.com>
	<4148C097DBD8483D9214A544B3B8DC2A@gmail.com>
Message-ID: <51AF616C.3000100@rabbitmq.com>

On 05/06/13 16:52, Carl H?rberg wrote:
> Well, for us it's reporting 0 on all nodes not receiving traffic =/

Hmm, I really do not see that behaviour. Has your cluster experienced a 
partition?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From carl.hoerberg at gmail.com  Wed Jun  5 17:04:56 2013
From: carl.hoerberg at gmail.com (=?utf-8?Q?Carl_H=C3=B6rberg?=)
Date: Thu, 6 Jun 2013 00:04:56 +0800
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
In-Reply-To: <51AF616C.3000100@rabbitmq.com>
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
	<51AC6EEE.3000208@rabbitmq.com>
	<1370446520040-27207.post@n5.nabble.com>
	<51AF5E55.2020603@rabbitmq.com>
	<4148C097DBD8483D9214A544B3B8DC2A@gmail.com>
	<51AF616C.3000100@rabbitmq.com>
Message-ID: <D46666637E8647159C8C8B3BC6CAAED7@gmail.com>

nope. it also takes about 90 seconds to get an response from /api/overview..  



On Thursday 6 June 2013 at 00:03, Simon MacMullen wrote:

> On 05/06/13 16:52, Carl H?rberg wrote:
> > Well, for us it's reporting 0 on all nodes not receiving traffic =/
>  
>  
>  
> Hmm, I really do not see that behaviour. Has your cluster experienced a  
> partition?
>  
> Cheers, Simon
>  
> --  
> Simon MacMullen
> RabbitMQ, Pivotal




From carl.hoerberg at gmail.com  Wed Jun  5 17:11:05 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 5 Jun 2013 09:11:05 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
In-Reply-To: <51AF616C.3000100@rabbitmq.com>
References: <0fdd37d9-aa3c-4f90-b348-a522f1a4c45a@googlegroups.com>
	<51AC6EEE.3000208@rabbitmq.com>
	<1370446520040-27207.post@n5.nabble.com>
	<51AF5E55.2020603@rabbitmq.com>
	<4148C097DBD8483D9214A544B3B8DC2A@gmail.com>
	<51AF616C.3000100@rabbitmq.com>
Message-ID: <91AFACCCF4564BC6804FB01237F8EC2A@gmail.com>

I take that back, other nodes does report msg/rates, but they are always very low, compared to the "history" message/rate shown in the graph..  



On Thursday 6 June 2013 at 00:05, Simon MacMullen-2 [via RabbitMQ] wrote:

> On 05/06/13 16:52, Carl H?rberg wrote:  
> > Well, for us it's reporting 0 on all nodes not receiving traffic =/  
>  
>  
> Hmm, I really do not see that behaviour. Has your cluster experienced a  
> partition?  
>  
> Cheers, Simon  
>  
> --  
> Simon MacMullen  
> RabbitMQ, Pivotal  
> _______________________________________________  
> rabbitmq-discuss mailing list  
> [hidden email] (/user/SendEmail.jtp?type=node&node=27213&i=0)  
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
>  
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-1-0-HTTP-API-rates-are-always-zero-tp27154p27213.html  
> To unsubscribe from RabbitMQ 3.1.0 HTTP API rates are always zero, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=27154&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjcxNTR8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml)  







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-1-0-HTTP-API-rates-are-always-zero-tp27154p27215.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/83537d1f/attachment.htm>

From rtrlists at googlemail.com  Wed Jun  5 21:13:34 2013
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 5 Jun 2013 21:13:34 +0100
Subject: [rabbitmq-discuss] Consuming multiple messages at a time
In-Reply-To: <CAHPrJT1v_1=yfr6qFmSesWy2uHgAf0RS3NdswZSwXT3oZcJx+Q@mail.gmail.com>
References: <CAHPrJT1v_1=yfr6qFmSesWy2uHgAf0RS3NdswZSwXT3oZcJx+Q@mail.gmail.com>
Message-ID: <CAH+xwdCkMwHMOU2zf6OeseE7AmpuA5n-rFA3ECW0bJBVp8BFAw@mail.gmail.com>

Isn't this what the prefetch count is all about?
On Jun 4, 2013 6:48 PM, "Vijay Lakshmi" <vijjivinay at gmail.com> wrote:

> Hi,
>
> We have an application where in for each client we create a Queue in
> RabbitMQ.
> (i.e. we create a binding with client id to a common exchange)
> So, all messages that are published with binding key as client id will go
> to that queue.
>
> There is only single client which subscribes to this Queue.
> The queue will get messages at the rate of 100 msgs/sec for example.
>
> RabbitMQ is sending only 1 message at a time to the consumer. Even if we
> set the prefetch count as higher value, the messages are delivered only one
> by one.
> The callback method in consumer can consume only single message.
>
> void *handleDelivery*(java.lang.String consumerTag,
>                     Envelope <http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.1/rabbitmq-java-client-javadoc-3.1.1/com/rabbitmq/client/Envelope.html> envelope,
>                     AMQP.BasicProperties <http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.1/rabbitmq-java-client-javadoc-3.1.1/com/rabbitmq/client/AMQP.BasicProperties.html> properties,
>                     byte[] body)
>                     throws java.io.IOException
>
> Is there a way in RabbitMQ where in we enable RabbitMQ to send mutiple
> messages to consumer at a time. In my case there is only one consumer per
> queue. So, by sending mutiple messages to consumer at a time will improve
> my performance.
>
> Can someone suggest how I can achieve this.
> If rabbitMQ does not support, is there any other way of achieving this.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/215fb1a3/attachment.htm>

From pete at theemersons.org  Wed Jun  5 21:03:26 2013
From: pete at theemersons.org (Pete Emerson)
Date: Wed, 5 Jun 2013 13:03:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Acknowledging messages across the federation
Message-ID: <5c6a1892-e9c6-435e-95cc-59a2285efc1f@googlegroups.com>

I've got a federation consisting of two 2-node clusters, with federation 
going in both directions.

I took the worker tutorial 
( http://www.rabbitmq.com/tutorials/tutorial-two-python.html ) example and 
modified it to talk on a specific exchange, and the exchange type is 
'direct'.

When I send a message to my federated exchange, two workers (one in each 
cluster) gets the message.

What do I need to do in order to have only one worker get the message, 
instead of one per federation?

I thought that the acknowledgement 

    ch.basic_ack(delivery_tag = method.delivery_tag)


would go across the federation, but I seem to have done something wrong, 
either in configuration or code, and I have no idea which.

Thanks for help shedding light on the error of my ways!

In case full code is useful:

My complete new_task.py: http://pastebin.com/8WEhTTwV
My worker.py: http://pastebin.com/JbcsqSfm
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/e8c99648/attachment.htm>

From maitreya_vvm at yahoo.co.in  Thu Jun  6 06:35:56 2013
From: maitreya_vvm at yahoo.co.in (maitreya)
Date: Thu, 06 Jun 2013 13:35:56 +0800
Subject: [rabbitmq-discuss] Pika connection negotiation behavior
In-Reply-To: <514448FB.3060707@rabbitmq.com>
References: <514448FB.3060707@rabbitmq.com>
Message-ID: <51B01FBC.1030506@yahoo.co.in>

Hi Matthias,

I had a problem with the Pika connection negotiation behavior which is 
leading to a situation where the heartbeat interval has a maximum 
possible value of 600s. The problem i had is the following,

I am using pika 0.9.9 with RabbitMQ 3.0.3. Few of the consumers we have 
are long running, so I would want to have a long heartbeat_interval so 
that the connections are not removed from either side. But the network 
infrastructure will not allow long idle connections so I wanted to set 
the heartbeat interval to 3600s(assuming pika is single threaded and can 
analyze the heartbeat events only between requests). But when I check 
the Timeout value in the RMQ Management page, I see it set only to 600.

Any number i try in the range of (300-600) works but above 600, it 
somehow defaults to 600. I think I didnt have this problem with RMQ 2.8. 
I am using php-amqplib for other piece of code and it is able to set 
heartbeat_interval to 3600s with RabbitMQ 3.0.3. My usage of creating a 
conncetion is as follows:


and my thoughts on why there shouldnt be a maximum value for heatbeat 
interval is the following,

I think the heartbeat interval should be flexible enough for different 
type of workers. For example, we have a combination of long-running 
tasks and short-running tasks. The short running tasks range from 1 to 
10 seconds. The long running tasks can take anytime depending on the 
input video size. So, for long running tasks, if the heartbeat interval 
set is 10 minutes, the client will not respond to the server's heartbeat 
for a long time which will result in the server disconnecting the 
client. Now the problem for disabling the heartbeat is the network 
infrastructure (like EC2) will kill any connections which are idle for 
more than about a day(dont know the exact time). So if the heartbeat is 
disabled then the connections are gone for good. An application can have 
a variety of load patterns, mine being short bursts with long idle time. 
So I think the heartbeat should be flexible enough to support a variety 
of consumers and different network infrastructures.

Please let me know your thoughts on this so that there could be a 
possible change in the client's connection behavior

regards,
Maitreya

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/b9aa2593/attachment.htm>

From matthias at rabbitmq.com  Thu Jun  6 08:05:48 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 06 Jun 2013 08:05:48 +0100
Subject: [rabbitmq-discuss] Pika connection negotiation behavior
In-Reply-To: <51B01FBC.1030506@yahoo.co.in>
References: <514448FB.3060707@rabbitmq.com> <51B01FBC.1030506@yahoo.co.in>
Message-ID: <51B034CC.3070300@rabbitmq.com>

Maitreya,

On 06/06/13 06:35, maitreya wrote:
> I wanted to set the heartbeat interval to 3600s(assuming pika is
> single threaded and can analyze the heartbeat events only between
> requests).
> [...]
> I think the heartbeat interval should be flexible enough for different
> type of workers.

This is the crux of the problem.

The heartbeat interval needs to be tuned to the network conditions. The 
ideal setting is actually "as short as possible, without impacting 
performance", since that way we a) minimise the delay in detecting dead 
connections, and b) minimise the chances of the connection getting 
killed prematurely due to idleness.

Having to lengthen the interval artificially - e.g. so that 
single-threaded clients can process a whole message - conflicts with 
that. More generally, client libraries / applications should be 
responsive to incoming AMQP traffic. I don't know enough about pika and 
python threading to ascertain whether there is a convenient way to 
achieve that.

Having said that, as was noted in this thread earlier, there is nothing 
stopping clients from setting the interval to whatever they like. 
However, I'd caution against a default client library behaviour of 
"accept whatever the app says, regardless of the server setting" since 
that takes away any possibility for server-side adjustments.

And on that note...

you can adjust the server-suggested heartbeat interval from the default 
600s by setting the 'heartbeat' configuration variable in the server's 
rabbitmq.config, as documented at 
https://www.rabbitmq.com/configure.html#config-items


Regards,

Matthias.

From psdc1978 at gmail.com  Thu Jun  6 10:56:18 2013
From: psdc1978 at gmail.com (=?ISO-8859-1?Q?Pedro_S=E1_da_Costa?=)
Date: Thu, 6 Jun 2013 11:56:18 +0200
Subject: [rabbitmq-discuss] broadcast message and wait
Message-ID: <CAJ8VZfWCvE+W-af+2TYo16gNLyRAeLA-=mtJveJer9T=J3Lf2A@mail.gmail.com>

Hi,
I want to send the same message to all workers and wait that all replies.
How i do this?

-- 
Best regards,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/77aad45c/attachment.htm>

From watson.timothy at gmail.com  Thu Jun  6 11:04:37 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 6 Jun 2013 11:04:37 +0100
Subject: [rabbitmq-discuss] Node crash, then cluster collapse
In-Reply-To: <1370436998585-27206.post@n5.nabble.com>
References: <1370436998585-27206.post@n5.nabble.com>
Message-ID: <32727D52-5530-48CE-BDC4-F83A7768CDAE@rabbitmq.com>

Carl

On 5 Jun 2013, at 13:56, carlhoerberg <carl.hoerberg at gmail.com> wrote:
> On a three node cluster, one ec2 machine reboots unexpectedly, and when it
> starts up again RabbitMQ fails to start. I've put all logs here:
> https://gist.github.com/carlhoerberg/ff6c6bd4f7639bf4b2f5
> 

That seems to contain only the logs from one node, what about the others?

> When the troubled node is restarted manually again it's unable to join,
> stopping at "adding mirrors", staying there forever. 
> 
> The other nodes now start to behave weird too, new queues can't be declared,
> but existing queues seems to continue deliver messages. They also can't
> respond to "rabbitmqctl status", or /api/overview. I'm forced to stop them
> with "kill -9". Only when all nodes are stopped the cluster can be brought
> up again normally. 

If you kill -9 the nodes, it's a bit tricky to get live info for diagnosis, assuming there's nothing in the logs. If the logs are available, please post them. Next time this happens, jump on irc (the #rabbitmq channel on freenode) and  we can try a few things to diagnose what's going on. If you can arrange for me to have ssh access to these nodes whilst the symptoms are present, I'll be more likely to solve the issue quickly - we might be able to sign some kind of privacy agreement if necessary.

Also please post your full setup whenever possible, detailing which plugins you're using (if any) and what kind of ha setup you're using.

Cheers,
Tim

From watson.timothy at gmail.com  Thu Jun  6 11:07:05 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 6 Jun 2013 11:07:05 +0100
Subject: [rabbitmq-discuss] broadcast message and wait
In-Reply-To: <CAJ8VZfWCvE+W-af+2TYo16gNLyRAeLA-=mtJveJer9T=J3Lf2A@mail.gmail.com>
References: <CAJ8VZfWCvE+W-af+2TYo16gNLyRAeLA-=mtJveJer9T=J3Lf2A@mail.gmail.com>
Message-ID: <158B83F4-AD33-44B6-B169-3A17C289F0AB@rabbitmq.com>

On 6 Jun 2013, at 10:56, Pedro S? da
Costa <psdc1978 at gmail.com> wrote:

> Hi, 
> I want to send the same message to all workers and wait that all replies. How i do this?

You could use a fan out and set a reply to address in a header, then wait until you've seen the anticipated number of replies (or mark replies with a worker specific identifier) or timed out.

Cheers,
Tim

From simon at rabbitmq.com  Thu Jun  6 11:16:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Jun 2013 11:16:02 +0100
Subject: [rabbitmq-discuss] Followup to 'reply-to' header problem in
	STOMP
In-Reply-To: <E5AF4B1C-038B-4D66-BD4E-97F80F297114@cloudwatt.com>
References: <E5AF4B1C-038B-4D66-BD4E-97F80F297114@cloudwatt.com>
Message-ID: <51B06162.7090106@rabbitmq.com>

On 06/06/13 10:12, Marc Falzon wrote:
> Hello!
>
> Apologies for writing directly to you. I'm facing the same 'reply-to'
> header problem in STOMP described in this thread a couple weeks ago:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-May/027380.html
>
>  I tried upgrading to 3.1.1 but ? as I feared since the changelog
> doesn't mention this issue ? the regression bug is still present. Do
> you have any estimation on a fix?

Yes - the fix was just slightly too late to make it into 3.1.1. It will 
be in 3.1.2 which we are hoping to release next week.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jun  6 11:19:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Jun 2013 11:19:43 +0100
Subject: [rabbitmq-discuss] Acknowledging messages across the federation
In-Reply-To: <5c6a1892-e9c6-435e-95cc-59a2285efc1f@googlegroups.com>
References: <5c6a1892-e9c6-435e-95cc-59a2285efc1f@googlegroups.com>
Message-ID: <51B0623F.1050201@rabbitmq.com>

On 05/06/13 21:03, Pete Emerson wrote:
> When I send a message to my federated exchange, two workers (one in each
> cluster) gets the message.
>
> What do I need to do in order to have only one worker get the message,
> instead of one per federation?

Federation is currently a poor fit for worker queues since you can only 
federate exchanges; federating an exchange means that messages published 
to that exchange can be consumed in all locations.

You might be able to rig something up by federating the random or 
consistent hash exchanges, any exchange which will only route to one 
consumer.

We are working on implementing federated queues, which will hopefully be 
the correct solution for your problem.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From antony.pulicken at gmail.com  Thu Jun  6 11:20:31 2013
From: antony.pulicken at gmail.com (antony)
Date: Thu, 6 Jun 2013 03:20:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Consume message based on correlation Id
Message-ID: <1370514031491-27224.post@n5.nabble.com>

Hi,

Here's my scenario:

I have multiple instances of listeners waiting on one queue and each of them
have a unique id to correlate the message. The message published by the
publisher will have a correlation id and each listener should only pick the
message that matches the correlation id. 

I read that this is possible in case of RPC where in you will pass a call
back queue reference and correlation id while publishing the message. But my
scenario is different. 

Please let me know whether there is a straight forward solution for this.

Regards,
Antony.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Consume-message-based-on-correlation-Id-tp27224.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Thu Jun  6 11:24:56 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 6 Jun 2013 14:24:56 +0400
Subject: [rabbitmq-discuss] Consume message based on correlation Id
In-Reply-To: <1370514031491-27224.post@n5.nabble.com>
References: <1370514031491-27224.post@n5.nabble.com>
Message-ID: <CAE3HoVR3_sn_CF23kNxXk775wFyDLxCuabyFHRqj1wRQe==7wA@mail.gmail.com>

2013/6/6 antony <antony.pulicken at gmail.com>

> The message published by the
> publisher will have a correlation id and each listener should only pick the
> message that matches the correlation id.
>

Have you considered using one server-named queue per consumer and routing
keys instead of correlation-id (or in addition to it)?

Then each consumer will only get deliveries it should work on.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/f6212db7/attachment.htm>

From antony.pulicken at gmail.com  Thu Jun  6 12:57:27 2013
From: antony.pulicken at gmail.com (antony)
Date: Thu, 6 Jun 2013 04:57:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Consume message based on correlation Id
In-Reply-To: <CAE3HoVR3_sn_CF23kNxXk775wFyDLxCuabyFHRqj1wRQe==7wA@mail.gmail.com>
References: <1370514031491-27224.post@n5.nabble.com>
	<CAE3HoVR3_sn_CF23kNxXk775wFyDLxCuabyFHRqj1wRQe==7wA@mail.gmail.com>
Message-ID: <1370519847522-27227.post@n5.nabble.com>

Did you mean the temporary queues created/managed by the server ? I
considered it, but then we will end up creating a new queue for each request
in my scenario and that's when I started thinking about a less expensive
option. 


Regards,
Antony. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Consume-message-based-on-correlation-Id-tp27224p27227.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From antony.pulicken at gmail.com  Thu Jun  6 13:31:43 2013
From: antony.pulicken at gmail.com (antony)
Date: Thu, 6 Jun 2013 05:31:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Consume message based on correlation Id
In-Reply-To: <1370519847522-27227.post@n5.nabble.com>
References: <1370514031491-27224.post@n5.nabble.com>
	<CAE3HoVR3_sn_CF23kNxXk775wFyDLxCuabyFHRqj1wRQe==7wA@mail.gmail.com>
	<1370519847522-27227.post@n5.nabble.com>
Message-ID: <1370521903142-27228.post@n5.nabble.com>

To make it more clear, I'm looking at something that is equivalent to JMS
correlation ID. 

http://stackoverflow.com/questions/149037/jms-message-receiver-filtering-by-jmscorrelationid





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Consume-message-based-on-correlation-Id-tp27224p27228.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Thu Jun  6 13:55:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 6 Jun 2013 16:55:15 +0400
Subject: [rabbitmq-discuss] Consume message based on correlation Id
In-Reply-To: <1370519847522-27227.post@n5.nabble.com>
References: <1370514031491-27224.post@n5.nabble.com>
	<CAE3HoVR3_sn_CF23kNxXk775wFyDLxCuabyFHRqj1wRQe==7wA@mail.gmail.com>
	<1370519847522-27227.post@n5.nabble.com>
Message-ID: <CAE3HoVTmy+Xnk-zPucOVh+9b3jeA_jzQSC=+Yk31C8qAt4Sx6w@mail.gmail.com>

2013/6/6 antony <antony.pulicken at gmail.com>

> Did you mean the temporary queues created/managed by the server ? I
> considered it, but then we will end up creating a new queue for each
> request
> in my scenario and that's when I started thinking about a less expensive
> option.
>

Named, to be more precise. If you specify queue name as an empty string,
RabbitMQ
will generate a unique one and send it back with the queue.declare response.

If your queues are short lived and only contain a single response, create
them as non-durable.
It's unlikely to introduce a lot of overhead, although it will lead to more
network roundtrips but
will reduce the amount of messages your consumers have to requeue because
they have different
correlation ids.

Which I am guessing will reduce the overall amount of traffic.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/84a82ef6/attachment.htm>

From antony.pulicken at gmail.com  Thu Jun  6 14:05:30 2013
From: antony.pulicken at gmail.com (antony)
Date: Thu, 6 Jun 2013 06:05:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Consume message based on correlation Id
In-Reply-To: <CAE3HoVTmy+Xnk-zPucOVh+9b3jeA_jzQSC=+Yk31C8qAt4Sx6w@mail.gmail.com>
References: <1370514031491-27224.post@n5.nabble.com>
	<CAE3HoVR3_sn_CF23kNxXk775wFyDLxCuabyFHRqj1wRQe==7wA@mail.gmail.com>
	<1370519847522-27227.post@n5.nabble.com>
	<CAE3HoVTmy+Xnk-zPucOVh+9b3jeA_jzQSC=+Yk31C8qAt4Sx6w@mail.gmail.com>
Message-ID: <1370523930460-27230.post@n5.nabble.com>

Ok..got it.. ! Thanks MK!

I was actually looking for something that is equivalent to JMS correlation
ID.

http://stackoverflow.com/questions/149037/jms-message-receiver-filtering-by-jmscorrelationid



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Consume-message-based-on-correlation-Id-tp27224p27230.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Thu Jun  6 14:15:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 6 Jun 2013 17:15:15 +0400
Subject: [rabbitmq-discuss] Consume message based on correlation Id
In-Reply-To: <1370523930460-27230.post@n5.nabble.com>
References: <1370514031491-27224.post@n5.nabble.com>
	<CAE3HoVR3_sn_CF23kNxXk775wFyDLxCuabyFHRqj1wRQe==7wA@mail.gmail.com>
	<1370519847522-27227.post@n5.nabble.com>
	<CAE3HoVTmy+Xnk-zPucOVh+9b3jeA_jzQSC=+Yk31C8qAt4Sx6w@mail.gmail.com>
	<1370523930460-27230.post@n5.nabble.com>
Message-ID: <CAE3HoVRdHFyJZagOjyWiZSzu_tr2yRyrczRW2PyTK+AbYg6jQw@mail.gmail.com>

2013/6/6 antony <antony.pulicken at gmail.com>

> I was actually looking for something that is equivalent to JMS correlation
> ID.
>
>
> http://stackoverflow.com/questions/149037/jms-message-receiver-filtering-by-jmscorrelationid
>

Messaging "filtering" (routing) in RabbitMQ happens between queues, not
consumers.

I'm not a JMS user but it sounds like the solution with temporary queues
and routing keys
used for correlation provide roughly the same functionality.

I also suspect projects such as Spring messaging integration may provide a
higher level interface
that's closer to JMS.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/543d2271/attachment.htm>

From veluri.mamatha at gmail.com  Thu Jun  6 14:41:57 2013
From: veluri.mamatha at gmail.com (Veluri Mamatha)
Date: Thu, 6 Jun 2013 19:11:57 +0530
Subject: [rabbitmq-discuss] Is it possible to remove Erlang node
Message-ID: <CAB9r38wKx7d5WwqKGOQF0jy0MK-EhNzs8MOx6FWrR_TZLKkrHA@mail.gmail.com>

Hi,

I observed in windows two nodes with rabbit at hostname and rabbit at HOSTNAME
are getting created, which is causing issues in the process of clustering

Is there any way i can remove the node

Regards,
Mamatha.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/20bd77d4/attachment.htm>

From sean at monkeysnatchbanana.com  Thu Jun  6 14:45:06 2013
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu, 6 Jun 2013 09:45:06 -0400
Subject: [rabbitmq-discuss] rabbitmq memory usage
Message-ID: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>

I'm trying to understand memory usage in rabbitmq. Pointers to relevant
docs, salient comments etc greatly welcomed. We have a number of batch jobs
that are handled by one process putting information on a queue and then
storm spouts read the info off and process. In the case of one job, we put
about 5.9 million integers on a queue as individual messages and process.
When those 5.9 go on, rabbitmq usage jumps up by about a gig.

Currently with 5.6 million still in the queue, we have the following memory
usage on the node as determind by rabbitmqctl status:

 {memory,
     [{total,1178020816},
      {processes,131791280},
      {processes_used,130916744},
      {system,1046229536},
      {atom,1338193},
      {atom_used,1314590},
      {binary,12936792},
      {code,15696033},
      {ets,975434504}]},

Can anyone shed light on the high level of memory usage and what we could
do to cut down on it?

-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/e85f5fd6/attachment.htm>

From emile at rabbitmq.com  Thu Jun  6 14:59:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 06 Jun 2013 14:59:33 +0100
Subject: [rabbitmq-discuss] Is it possible to remove Erlang node
In-Reply-To: <CAB9r38wKx7d5WwqKGOQF0jy0MK-EhNzs8MOx6FWrR_TZLKkrHA@mail.gmail.com>
References: <CAB9r38wKx7d5WwqKGOQF0jy0MK-EhNzs8MOx6FWrR_TZLKkrHA@mail.gmail.com>
Message-ID: <51B095C5.6050607@rabbitmq.com>


Hi,


On 06/06/13 14:41, Veluri Mamatha wrote:
> I observed in windows two nodes with rabbit at hostname and rabbit at HOSTNAME
> are getting created, which is causing issues in the process of clustering
> 
> Is there any way i can remove the node

This can be an issue if you use CygWin, which normally uses lower-case
hostnames. To stop node "rabbit at HOSTNAME" use this command:

 rabbitmqctl -n rabbit at HOSTNAME stop

To remove a service see the "rabbitmq-service.bat remove" command:

 http://www.rabbitmq.com/man/rabbitmq-service.man.html




-Emile








From ceri at lshift.net  Thu Jun  6 15:03:04 2013
From: ceri at lshift.net (Ceri Storey)
Date: Thu, 06 Jun 2013 15:03:04 +0100
Subject: [rabbitmq-discuss] rabbitmq memory usage
In-Reply-To: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>
References: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>
Message-ID: <51B09698.5000209@lshift.net>

(06/06/13 14:45), Sean Allen wrote:
> I'm trying to understand memory usage in rabbitmq. Pointers to
> relevant docs, salient comments etc greatly welcomed. We have a number
> of batch jobs that are handled by one process putting information on a
> queue and then storm spouts read the info off and process. In the case
> of one job, we put about 5.9 million integers on a queue as individual
> messages and process. When those 5.9 go on, rabbitmq usage jumps up by
> about a gig.
>
> Currently with 5.6 million still in the queue, we have the following
> memory usage on the node as determind by rabbitmqctl status:
>
>  {memory,
>      [{total,1178020816},
>       {processes,131791280},
>       {processes_used,130916744},
>       {system,1046229536},
>       {atom,1338193},
>       {atom_used,1314590},
>       {binary,12936792},
>       {code,15696033},
>       {ets,975434504}]},
>
> Can anyone shed light on the high level of memory usage and what we
> could do to cut down on it?

I'm sure that one of the Rabbit team themselves can shed a bit more
light on this, but AIUI RabbitMQ uses ETS in-memory tables to index the
queues, so with some back of the envelope arithmetic your rabbit is
using approximately 175bytes per message. So on the face of it, that
might look a bit odd, but doesn't seem unreasonable.

Are you seeing any concrete issues because of this, or are you more
concerned about resource usage? Also, do you anticipate having to
process batches many factors larger than that?

From Petr.Gotthard at Honeywell.com  Thu Jun  6 15:23:04 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 6 Jun 2013 14:23:04 +0000
Subject: [rabbitmq-discuss] No rabbitmq_v3_1_1 tag in rabbitmq-stomp?
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D341A5F@FR44EX3005.global.ds.honeywell.com>

Sorry for bugging you again, but now it seems that there is no 3.1.1 tag in the STOMP plugin.

Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/f1330f40/attachment.htm>

From simon at rabbitmq.com  Thu Jun  6 15:38:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Jun 2013 15:38:39 +0100
Subject: [rabbitmq-discuss] rabbitmq memory usage
In-Reply-To: <51B09698.5000209@lshift.net>
References: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>
	<51B09698.5000209@lshift.net>
Message-ID: <51B09EEF.8010201@rabbitmq.com>

On 06/06/13 15:03, Ceri Storey wrote:
> I'm sure that one of the Rabbit team themselves can shed a bit more
> light on this, but AIUI RabbitMQ uses ETS in-memory tables to index the
> queues,

Minor correction / clarification: the in-memory cost is per-message in 
the message store, not queues per se. So a message which ends up in lots 
of queues incurs the cost once.

> so with some back of the envelope arithmetic your rabbit is
> using approximately 175bytes per message. So on the face of it, that
> might look a bit odd, but doesn't seem unreasonable.

That cost is about right.

Also, note that the OP did not specify the version of RabbitMQ used, but 
it looks like 2.x. 3.x will helpfully separate out the memory used by 
the message store index. See http://www.rabbitmq.com/memory-use.html

The rabbitmq-toke plugin offers an alternative message store index which 
does not have a per-message cost. Setting it up is a bit fiddly though, 
and it's less well tested.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Thu Jun  6 16:24:22 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 06 Jun 2013 16:24:22 +0100
Subject: [rabbitmq-discuss] No rabbitmq_v3_1_1 tag in rabbitmq-stomp?
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D341A5F@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2D341A5F@FR44EX3005.global.ds.honeywell.com>
Message-ID: <51B0A9A6.7080100@rabbitmq.com>

On 06/06/13 15:23, Gotthard, Petr wrote:
> Sorry for bugging you again, but now it seems that there is no 3.1.1 tag
> in the STOMP plugin.

Apologies for the inconvenience. There should be a tag now.



From carl.hoerberg at gmail.com  Thu Jun  6 16:28:11 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 6 Jun 2013 08:28:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Node crash, then cluster collapse
In-Reply-To: <32727D52-5530-48CE-BDC4-F83A7768CDAE@rabbitmq.com>
References: <1370436998585-27206.post@n5.nabble.com>
	<32727D52-5530-48CE-BDC4-F83A7768CDAE@rabbitmq.com>
Message-ID: <45A3DE3F324A49E08ECECFCFD87E3A4F@gmail.com>

Alright, thanks, I'll try to contact you on IRC next time this happens. I updated the gist with some logs from another node, the third node produced *a lot*, so those I have to email you. 


On Thursday 6 June 2013 at 18:07, Tim Watson-5 [via RabbitMQ] wrote:

> Carl 
> 
> On 5 Jun 2013, at 13:56, carlhoerberg <[hidden email] (/user/SendEmail.jtp?type=node&node=27221&i=0)> wrote: 
> > On a three node cluster, one ec2 machine reboots unexpectedly, and when it 
> > starts up again RabbitMQ fails to start. I've put all logs here: 
> > https://gist.github.com/carlhoerberg/ff6c6bd4f7639bf4b2f5
> > 
> 
> 
> That seems to contain only the logs from one node, what about the others? 
> 
> > When the troubled node is restarted manually again it's unable to join, 
> > stopping at "adding mirrors", staying there forever. 
> > 
> > The other nodes now start to behave weird too, new queues can't be declared, 
> > but existing queues seems to continue deliver messages. They also can't 
> > respond to "rabbitmqctl status", or /api/overview. I'm forced to stop them 
> > with "kill -9". Only when all nodes are stopped the cluster can be brought 
> > up again normally. 
> > 
> 
> 
> If you kill -9 the nodes, it's a bit tricky to get live info for diagnosis, assuming there's nothing in the logs. If the logs are available, please post them. Next time this happens, jump on irc (the #rabbitmq channel on freenode) and we can try a few things to diagnose what's going on. If you can arrange for me to have ssh access to these nodes whilst the symptoms are present, I'll be more likely to solve the issue quickly - we might be able to sign some kind of privacy agreement if necessary. 
> 
> Also please post your full setup whenever possible, detailing which plugins you're using (if any) and what kind of ha setup you're using. 
> 
> Cheers, 
> Tim 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=27221&i=1) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Node-crash-then-cluster-collapse-tp27206p27221.html 
> To unsubscribe from Node crash, then cluster collapse, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=27206&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjcyMDZ8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 
> 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Node-crash-then-cluster-collapse-tp27206p27239.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/e9b7dc95/attachment.htm>

From gmr at meetme.com  Thu Jun  6 16:34:09 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 6 Jun 2013 11:34:09 -0400
Subject: [rabbitmq-discuss] Pika connection negotiation behavior
In-Reply-To: <51B034CC.3070300@rabbitmq.com>
References: <514448FB.3060707@rabbitmq.com> <51B01FBC.1030506@yahoo.co.in>
	<51B034CC.3070300@rabbitmq.com>
Message-ID: <555E34501AF94D179B14F2B9E96153E5@meetme.com>



On Thursday, June 6, 2013 at 3:05 AM, Matthias Radestock wrote:

> Having to lengthen the interval artificially - e.g. so that
> single-threaded clients can process a whole message - conflicts with 
> that. More generally, client libraries / applications should be 
> responsive to incoming AMQP traffic. I don't know enough about pika and 
> python threading to ascertain whether there is a convenient way to 
> achieve that.

Currently it is single threaded. I have a few prototypes of running all connection management in a background thread, but this is tricky due to Pika supporting pluggable backend connection adapters. What's good for a blocking connection adapter in doing threaded connection communication is not good for asynchronous adapters such as Tornado and Twisted.

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/13c22c0c/attachment.htm>

From sean at monkeysnatchbanana.com  Thu Jun  6 16:36:24 2013
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu, 6 Jun 2013 11:36:24 -0400
Subject: [rabbitmq-discuss] rabbitmq memory usage
In-Reply-To: <51B09EEF.8010201@rabbitmq.com>
References: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>
	<51B09698.5000209@lshift.net> <51B09EEF.8010201@rabbitmq.com>
Message-ID: <CABm-Wmen8u-ApCRyAjrEkek0982t1N7X-XECpd3LYpwoOVEw8w@mail.gmail.com>

On Thu, Jun 6, 2013 at 10:38 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/06/13 15:03, Ceri Storey wrote:
>
>> I'm sure that one of the Rabbit team themselves can shed a bit more
>> light on this, but AIUI RabbitMQ uses ETS in-memory tables to index the
>> queues,
>>
>
> Minor correction / clarification: the in-memory cost is per-message in the
> message store, not queues per se. So a message which ends up in lots of
> queues incurs the cost once.
>
>
>  so with some back of the envelope arithmetic your rabbit is
>> using approximately 175bytes per message. So on the face of it, that
>> might look a bit odd, but doesn't seem unreasonable.
>>
>
> That cost is about right.
>

Is there a base per message size for an individual message?
If memory usage is a concern, would we be better batching many items into a
single message and splitting them apart later?


> Also, note that the OP did not specify the version of RabbitMQ used, but
> it looks like 2.x. 3.x will helpfully separate out the memory used by the
> message store index. See http://www.rabbitmq.com/**memory-use.html<http://www.rabbitmq.com/memory-use.html>
>
>
2.8.1 right now.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/779f71d3/attachment.htm>

From sean at monkeysnatchbanana.com  Thu Jun  6 16:37:33 2013
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu, 6 Jun 2013 11:37:33 -0400
Subject: [rabbitmq-discuss] rabbitmq memory usage
In-Reply-To: <51B09698.5000209@lshift.net>
References: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>
	<51B09698.5000209@lshift.net>
Message-ID: <CABm-WmfTWSOj=d5+6_i7zsqW1D223MZF_Lc_AwJxDxKQ0ObOUQ@mail.gmail.com>

On Thu, Jun 6, 2013 at 10:03 AM, Ceri Storey <ceri at lshift.net> wrote:

> (06/06/13 14:45), Sean Allen wrote:
> > I'm trying to understand memory usage in rabbitmq. Pointers to
> > relevant docs, salient comments etc greatly welcomed. We have a number
> > of batch jobs that are handled by one process putting information on a
> > queue and then storm spouts read the info off and process. In the case
> > of one job, we put about 5.9 million integers on a queue as individual
> > messages and process. When those 5.9 go on, rabbitmq usage jumps up by
> > about a gig.
> >
> > Currently with 5.6 million still in the queue, we have the following
> > memory usage on the node as determind by rabbitmqctl status:
> >
> >  {memory,
> >      [{total,1178020816},
> >       {processes,131791280},
> >       {processes_used,130916744},
> >       {system,1046229536},
> >       {atom,1338193},
> >       {atom_used,1314590},
> >       {binary,12936792},
> >       {code,15696033},
> >       {ets,975434504}]},
> >
> > Can anyone shed light on the high level of memory usage and what we
> > could do to cut down on it?
>
> I'm sure that one of the Rabbit team themselves can shed a bit more
> light on this, but AIUI RabbitMQ uses ETS in-memory tables to index the
> queues, so with some back of the envelope arithmetic your rabbit is
> using approximately 175bytes per message. So on the face of it, that
> might look a bit odd, but doesn't seem unreasonable.
>
> Are you seeing any concrete issues because of this, or are you more
> concerned about resource usage? Also, do you anticipate having to
> process batches many factors larger than that?
>

We are adding more batch processes and with 2 gigs per node, we are able to
push past that.
So yes, that are some concerns there.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/15cd8527/attachment.htm>

From pete at theemersons.org  Thu Jun  6 16:51:41 2013
From: pete at theemersons.org (Pete Emerson)
Date: Thu, 6 Jun 2013 08:51:41 -0700
Subject: [rabbitmq-discuss] Acknowledging messages across the federation
In-Reply-To: <51B0623F.1050201@rabbitmq.com>
References: <5c6a1892-e9c6-435e-95cc-59a2285efc1f@googlegroups.com>
	<51B0623F.1050201@rabbitmq.com>
Message-ID: <CAObhfnfid+UiKR5CnKmK=cwhLOovvwOQBFPENdLg69OJAiDY-Q@mail.gmail.com>

Whoops, replied back to Simon instead of the list.

I have a policy of "^amq\." with federation-upstream-set: all, isn't that
federating the random exchanges already?

I'm not clear what you mean by "any exchange which will only route to one
consumer". Are you suggesting that the code route the message to a desired
consumer, instead of taking advantage of rabbitmq itself?


On Thu, Jun 6, 2013 at 3:19 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 05/06/13 21:03, Pete Emerson wrote:
>
>> When I send a message to my federated exchange, two workers (one in each
>> cluster) gets the message.
>>
>> What do I need to do in order to have only one worker get the message,
>> instead of one per federation?
>>
>
> Federation is currently a poor fit for worker queues since you can only
> federate exchanges; federating an exchange means that messages published to
> that exchange can be consumed in all locations.
>
> You might be able to rig something up by federating the random or
> consistent hash exchanges, any exchange which will only route to one
> consumer.
>
> We are working on implementing federated queues, which will hopefully be
> the correct solution for your problem.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/3ee7b787/attachment.htm>

From simon at rabbitmq.com  Thu Jun  6 17:17:09 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Jun 2013 17:17:09 +0100
Subject: [rabbitmq-discuss] Acknowledging messages across the federation
In-Reply-To: <CAObhfnfid+UiKR5CnKmK=cwhLOovvwOQBFPENdLg69OJAiDY-Q@mail.gmail.com>
References: <5c6a1892-e9c6-435e-95cc-59a2285efc1f@googlegroups.com>
	<51B0623F.1050201@rabbitmq.com>
	<CAObhfnfid+UiKR5CnKmK=cwhLOovvwOQBFPENdLg69OJAiDY-Q@mail.gmail.com>
Message-ID: <51B0B605.6030703@rabbitmq.com>

On 06/06/13 16:51, Pete Emerson wrote:
> Whoops, replied back to Simon instead of the list.
>
> I have a policy of "^amq\." with federation-upstream-set: all, isn't
> that federating the random exchanges already?

That federates the built in exchanges. I was talking about using the 
random exchange: https://github.com/jbrisbin/random-exchange

> I'm not clear what you mean by "any exchange which will only route to
> one consumer". Are you suggesting that the code route the message to a
> desired consumer, instead of taking advantage of rabbitmq itself?

Sorry, I was typing too quickly. I meant "any exchange type which will 
only route to one queue". The random exchange and consistent hash 
exchanges are examples of such types.

If you federate such an exchange, you'll end up with each message only 
on one node in the federation. But in general federated exchanges are 
designed to make sure that every subscribing queue gets a copy of the 
message - and acknowledgements then only remove the message from the 
queue locally.

There isn't currently an easy answer for federated worker queues (that's 
why we're working on a federated queue implementation!)

Cheers, Simon

> On Thu, Jun 6, 2013 at 3:19 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 05/06/13 21:03, Pete Emerson wrote:
>
>         When I send a message to my federated exchange, two workers (one
>         in each
>         cluster) gets the message.
>
>         What do I need to do in order to have only one worker get the
>         message,
>         instead of one per federation?
>
>
>     Federation is currently a poor fit for worker queues since you can
>     only federate exchanges; federating an exchange means that messages
>     published to that exchange can be consumed in all locations.
>
>     You might be able to rig something up by federating the random or
>     consistent hash exchanges, any exchange which will only route to one
>     consumer.
>
>     We are working on implementing federated queues, which will
>     hopefully be the correct solution for your problem.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jun  6 17:56:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Jun 2013 17:56:01 +0100
Subject: [rabbitmq-discuss] rabbitmq memory usage
In-Reply-To: <CABm-Wmen8u-ApCRyAjrEkek0982t1N7X-XECpd3LYpwoOVEw8w@mail.gmail.com>
References: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>
	<51B09698.5000209@lshift.net> <51B09EEF.8010201@rabbitmq.com>
	<CABm-Wmen8u-ApCRyAjrEkek0982t1N7X-XECpd3LYpwoOVEw8w@mail.gmail.com>
Message-ID: <51B0BF21.3070207@rabbitmq.com>

On 06/06/13 16:36, Sean Allen wrote:
> Is there a base per message size for an individual message?

The memory cost is constant per-message. So it tends to be people with 
lots of tiny messages who run into it.

> If memory usage is a concern, would we be better batching many items
> into a single message and splitting them apart later?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ceri at lshift.net  Thu Jun  6 17:56:43 2013
From: ceri at lshift.net (Ceri Storey)
Date: Thu, 06 Jun 2013 17:56:43 +0100
Subject: [rabbitmq-discuss] rabbitmq memory usage
In-Reply-To: <CABm-WmfTWSOj=d5+6_i7zsqW1D223MZF_Lc_AwJxDxKQ0ObOUQ@mail.gmail.com>
References: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>
	<51B09698.5000209@lshift.net>
	<CABm-WmfTWSOj=d5+6_i7zsqW1D223MZF_Lc_AwJxDxKQ0ObOUQ@mail.gmail.com>
Message-ID: <51B0BF4B.5080909@lshift.net>

(06/06/13 16:37), Sean Allen wrote:
> On Thu, Jun 6, 2013 at 10:03 AM, Ceri Storey <ceri at lshift.net
> <mailto:ceri at lshift.net>> wrote:
>
>     (06/06/13 14:45), Sean Allen wrote:
>     > I'm trying to understand memory usage in rabbitmq. Pointers to
>     > relevant docs, salient comments etc greatly welcomed. We have a
>     number
>     > of batch jobs that are handled by one process putting
>     information on a
>     > queue and then storm spouts read the info off and process. In
>     the case
>     > of one job, we put about 5.9 million integers on a queue as
>     individual
>     > messages and process. When those 5.9 go on, rabbitmq usage jumps
>     up by
>     > about a gig.
>     >
>     > ....
>     I'm sure that one of the Rabbit team themselves can shed a bit more
>     light on this, but AIUI RabbitMQ uses ETS in-memory tables to
>     index the
>     queues, so with some back of the envelope arithmetic your rabbit is
>     using approximately 175bytes per message. So on the face of it, that
>     might look a bit odd, but doesn't seem unreasonable.
>
>     Are you seeing any concrete issues because of this, or are you more
>     concerned about resource usage? Also, do you anticipate having to
>     process batches many factors larger than that?
>
>
> We are adding more batch processes and with 2 gigs per node, we are
> able to push past that.
> So yes, that are some concerns there.
Okay--so the biggest risk that I can foresee for rabbit itself Rabbit
will start hitting it's high watermark for memory usage, and start
exerting back-pressure by not reading from the socket. Once the storm
AMQP spout has drained enough messages from the queue, Rabbit's memory
usage will drop, and start reading from publishers once again.

So, the question in my mind, would be how well the publishing
applications deals with the back pressure; if it will just wait blocking
on the socket, you should be fine. Assuming that the spout continuously
consumes messages, I don't /believe/ there would be a problem; but it'll
be worth checking that the heartbeat period is longer than it takes for
rabbit to unblock connections and process the buffered data. (Rabbit
logs to rabbit.log when it hits and clears the high water mark alarms).

I'd be tempted to stress test the whole setup, and see how far you can
push it before it breaks bearing in mind the above caveats.

Hopefully that's of some use, at least.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/26a019b4/attachment.htm>

From asko.soukka at iki.fi  Thu Jun  6 12:02:56 2013
From: asko.soukka at iki.fi (Asko Soukka)
Date: Thu, 6 Jun 2013 04:02:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
Message-ID: <9ea53a16-fb89-46a0-98a0-5e5c82b1302a@googlegroups.com>

Hi,

I just like to mention that we faced a similar situation today (with 
RabbitMQ 2.8.4 and Erlang R14B04).

We have a standalone RabbitMQ installation (no cluster) on RHEL5. Due to a 
some other problems, the server was forced to restart, and after the 
restart one of the durable queues (not exclusive) has been similarly 
missing and queue.declare is denied with not_found error:

connection <0.3.20>, channel 1 - error:
{amqp_error,not_found,"no queue '...' in vhost '/..'",
            'queue.declare'}

It looks like the queue is listed in rabbit_durable_queue.DCD, but I don't 
have enough erlang skills to confirm that. Can something be done with 
"rabbitmqctl eval" to confirm or fix this kind of "shadow" queue?

Best Regards,
Asko

keskiviikko, 3. huhtikuuta 2013 1.32.28 UTC+3 Jonathan Schwietert kirjoitti:
>
> Hi, I have a queue which was declared with BOTH durable and exclusive (on 
> accident) whose owner disconnected then reconnected and now receives: 
> "NOT_FOUND - no queue 'test.queue' in vhost '/test.vhost'". This queue is 
> no longer visible in any administrative application: web management, 
> rabbitmqadmin, or even rabbitmqctl (for list_queues).
>
> I believe it may still exist in the mnesia DB and thus is causing 
> subsequent queue.declare calls to fail as it had been declared exclusive. 
> This happens in the management plugin as well. I've also installed the 
> rabbitmqadmin and tried to delete the queue to which it replies: "*** Not 
> found: /queues/%2Ftest.vhost/test.queue" I cat'ed out the durable queue 
> mnesia file: "cat 
> /var/lib/rabbitmq/mnesia/rabbit\@test-broker/rabbit_durable_queue.DCD | 
> grep test.queue" and received "Binary file (standard input) matches"
>
> Unfortunately i'm unfamiliar with mnesia and unable to simply delete the 
> entry. Any suggestions? Would backing up the configuration; then calling 
> stop_app, then reset, then start_app; then reloading the configuration fix 
> it?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/db444adf/attachment.htm>

From rhythmicdevil at gmail.com  Thu Jun  6 13:11:01 2013
From: rhythmicdevil at gmail.com (rhythmicdevil at gmail.com)
Date: Thu, 6 Jun 2013 05:11:01 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server fails to start BOOT ERROR: FAILED
Message-ID: <daf154f0-68c4-4910-b780-0dde3144cb76@googlegroups.com>

Hello,
I am building a new development environment on Centos 6. I used Yum to 
install:

rabbitmq-server.noarch                   2.6.1-1.el6                    @epe

When I attempt to start rabbitmq-server I get the following error:

[root at dev-03 ~]# service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
_err}
rabbitmq-server.


I have reviewed the erlang crash dump file, but to be honest I dont know 
what I am looking at. I have also reviewed the startup_log and startup_err 
but I dont know how to fix what it says is wrong. I have pasted all three 
logs below this. Any help you can offer would be appreciated.

Thanks.




*/var/log/rabbitmq/startup_err*
 Erlang has closed

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})






*/var/log/rabbitmq/startup_log*
Activating RabbitMQ plugins ...
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.6.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at dev-03
app descriptor : 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : 5HkY+YAGF/CHSb94Qgq1IA==
log            : /var/log/rabbitmq/rabbit at dev-03.log
sasl log       : /var/log/rabbitmq/rabbit at dev-03-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at dev-03
erlang version : 5.8.5

-- rabbit boot start
starting file handle cache server                                     
...done
starting worker pool                                                 
 ...done
starting database                                                     
...done
starting codec correctness check                                     
 ...done
-- external infrastructure ready
starting statistics event manager                                     
...done
starting logging server                                               
...done
starting plugin registry                                             
 ...done
starting auth mechanism amqplain                                     
 ...done
starting auth mechanism cr-demo                                       
...done
starting auth mechanism plain                                         
...done
starting exchange type direct                                         
...done
starting exchange type fanout                                         
...done
starting exchange type headers                                       
 ...done
starting exchange type topic                                         
 ...done
-- kernel ready
starting node monitor                                                 
...done
starting cluster delegate                                             
...done
starting guid generator                                               
...done
starting alarm handler                                               
 ...done
starting memory monitor                                               
...done
-- core initialized
starting empty DB check                                               
...done
starting exchange, queue and binding recovery                         
...done
starting mirror queue slave sup                                       
...done
starting adding mirrors to queues                                     
...done
-- message delivery logic ready
starting error log relay                                             
 ...done
starting networking                                                   
...BOOT ERROR: FAILED
Reason: {badmatch,
            {error,
                {shutdown,
                    {child,undefined,'rabbit_tcp_listener_sup_:::5672',
                        {tcp_listener_sup,start_link,
                            [{0,0,0,0,0,0,0,0},
                             5672,
                             [inet6,binary,
                              {packet,raw},
                              {reuseaddr,true},
                              {backlog,128},
                              {nodelay,true},
                              {exit_on_close,false}],
                            
 {rabbit_networking,tcp_listener_started,[amqp]},
                            
 {rabbit_networking,tcp_listener_stopped,[amqp]},
                             {rabbit_networking,start_client,[]},
                             "TCP Listener"]},
                        transient,infinity,supervisor,
                        [tcp_listener_sup]}}}}
Stacktrace: [{rabbit_networking,start_listener0,4},
             {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4},
             {rabbit_networking,start_listener,4},
             {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
             {rabbit_networking,boot_tcp,0},
             {rabbit_networking,boot,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1}]
{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}





*/var/lib/rabbitmq/erl_crash.dump*
=erl_crash_dump:0.1
Thu Jun  6 07:55:16 2013
Slogan: Kernel pid terminated (application_controller) 
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[norm
al,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
System version: Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] 
[async-threads:30] [kernel-poll:true]
Compiled: Sat Mar  2 06:38:11 2013
Taints: 
Atoms: 16222
=memory
total: 22257176
processes: 8772592
processes_used: 8679992
system: 13484584
atom: 1119585
atom_used: 1112647
binary: 6552
code: 11053723
ets: 53736
=hash_table:atom_tab
size: 12853
used: 9224
objs: 16222
depth: 8
=index_table:atom_tab
size: 16384
limit: 1048576
entries: 16222
=hash_table:module_code
size: 397
used: 283
objs: 312
depth: 2
=index_table:module_code
size: 1024
limit: 65536
entries: 312
=hash_table:export_list
size: 4813
used: 3609
objs: 6537
depth: 7
=index_table:export_list
size: 7168
limit: 524288
entries: 6537
=hash_table:secondary_export_table
size: 97
used: 0
objs: 0
depth: 0
=hash_table:process_reg
size: 11
used: 3
objs: 3
depth: 1
=hash_table:fun_table
size: 1597
used: 1163
objs: 2061
depth: 6
=hash_table:node_table
size: 5
used: 1
objs: 1
depth: 1
=hash_table:dist_table
size: 5
used: 1
objs: 1
depth: 1
=allocated_areas
sys_misc: 83886
static: 1007616
atom_space: 229432 223214
atom_table: 234009
module_table: 11484
export_table: 95964
register_table: 180
fun_table: 12866
module_refs: 8192
loaded_code: 10104105
dist_table: 355
node_table: 179
bits_bufs_size: 0
bif_timer: 80056
link_lh: 0
proc: 76896 2016
atom_entry: 656144 655424
module_entry: 25776 25136
reg_proc: 4088 208
fun_entry: 167280 165760
db_tab: 14800 448
export_entry: 630504 630216
:



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/cefea005/attachment.htm>

From joost.reuzel at gmail.com  Thu Jun  6 13:30:57 2013
From: joost.reuzel at gmail.com (Joost Reuzel)
Date: Thu, 6 Jun 2013 05:30:57 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ read performance does not grow when we
 add more subscribers?
Message-ID: <7481994a-b15a-4d98-b982-0b60f9ad3fed@googlegroups.com>



We have been experimenting with RabbitMQ. During those experiments we have 
seen some strange behavior with respect to a worker queue.

One of the observations is that the read performance of a queue does not 
change when we add or remove processes that read from that queue. For 
example: when a single process handles messages at a rate of 800 msg/sec. 
Adding a second (similar) process has the result of both processes handling 
messages at a rate of 400 msg/sec each, with again 800 msg/sec as total. 
When we shutdown one of the processes, the msg rate of the other process 
increases to (you guessed) 800 msg/sec.

This is not what we expected. Why does the throughput not double when we 
add a second reader to a queue?

We are using the RabbitMQ .NET client (in combination with EasyNetQ 
Advanced API). We have the publisher confirms switched on, use a 
prefetch_count (Qos) of 50, Ack messages when they have been processed, and 
use durable exchanges, queues and messages.

We must be doing something wrong, any pointer in the right direction is 
very welcome...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/6125a944/attachment.htm>

From rhythmicdevil at gmail.com  Thu Jun  6 13:40:55 2013
From: rhythmicdevil at gmail.com (rhythmicdevil at gmail.com)
Date: Thu, 6 Jun 2013 05:40:55 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server fails to start BOOT ERROR:
	FAILED
In-Reply-To: <daf154f0-68c4-4910-b780-0dde3144cb76@googlegroups.com>
References: <daf154f0-68c4-4910-b780-0dde3144cb76@googlegroups.com>
Message-ID: <c121b42c-4e03-4667-a5c2-79bf3acf6f4e@googlegroups.com>

The solution was here: 
https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/BOOT$20ERROR/rabbitmq-discuss/1_HLF_IGah4/QXIGM-pFgx0J

On Thursday, June 6, 2013 8:11:01 AM UTC-4, rhythm... at gmail.com wrote:
>
> Hello,
> I am building a new development environment on Centos 6. I used Yum to 
> install:
>
> rabbitmq-server.noarch                   2.6.1-1.el6                   
>  @epe
>
> When I attempt to start rabbitmq-server I get the following error:
>
> [root at dev-03 ~]# service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
> _err}
> rabbitmq-server.
>
>
> I have reviewed the erlang crash dump file, but to be honest I dont know 
> what I am looking at. I have also reviewed the startup_log and startup_err 
> but I dont know how to fix what it says is wrong. I have pasted all three 
> logs below this. Any help you can offer would be appreciated.
>
> Thanks.
>
>
>
>
> */var/log/rabbitmq/startup_err*
>  Erlang has closed
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>
>
>
>
>
>
> */var/log/rabbitmq/startup_log*
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.6.1  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at dev-03
> app descriptor : 
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : 5HkY+YAGF/CHSb94Qgq1IA==
> log            : /var/log/rabbitmq/rabbit at dev-03.log
> sasl log       : /var/log/rabbitmq/rabbit at dev-03-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at dev-03
> erlang version : 5.8.5
>
> -- rabbit boot start
> starting file handle cache server                                     
> ...done
> starting worker pool                                                 
>  ...done
> starting database                                                     
> ...done
> starting codec correctness check                                     
>  ...done
> -- external infrastructure ready
> starting statistics event manager                                     
> ...done
> starting logging server                                               
> ...done
> starting plugin registry                                             
>  ...done
> starting auth mechanism amqplain                                     
>  ...done
> starting auth mechanism cr-demo                                       
> ...done
> starting auth mechanism plain                                         
> ...done
> starting exchange type direct                                         
> ...done
> starting exchange type fanout                                         
> ...done
> starting exchange type headers                                       
>  ...done
> starting exchange type topic                                         
>  ...done
> -- kernel ready
> starting node monitor                                                 
> ...done
> starting cluster delegate                                             
> ...done
> starting guid generator                                               
> ...done
> starting alarm handler                                               
>  ...done
> starting memory monitor                                               
> ...done
> -- core initialized
> starting empty DB check                                               
> ...done
> starting exchange, queue and binding recovery                         
> ...done
> starting mirror queue slave sup                                       
> ...done
> starting adding mirrors to queues                                     
> ...done
> -- message delivery logic ready
> starting error log relay                                             
>  ...done
> starting networking                                                   
> ...BOOT ERROR: FAILED
> Reason: {badmatch,
>             {error,
>                 {shutdown,
>                     {child,undefined,'rabbit_tcp_listener_sup_:::5672',
>                         {tcp_listener_sup,start_link,
>                             [{0,0,0,0,0,0,0,0},
>                              5672,
>                              [inet6,binary,
>                               {packet,raw},
>                               {reuseaddr,true},
>                               {backlog,128},
>                               {nodelay,true},
>                               {exit_on_close,false}],
>                             
>  {rabbit_networking,tcp_listener_started,[amqp]},
>                             
>  {rabbit_networking,tcp_listener_stopped,[amqp]},
>                              {rabbit_networking,start_client,[]},
>                              "TCP Listener"]},
>                         transient,infinity,supervisor,
>                         [tcp_listener_sup]}}}}
> Stacktrace: [{rabbit_networking,start_listener0,4},
>              {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4},
>              {rabbit_networking,start_listener,4},
>              {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
>              {rabbit_networking,boot_tcp,0},
>              {rabbit_networking,boot,0},
>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>              {rabbit,run_boot_step,1}]
> {"Kernel pid 
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>
>
>
>
>
> */var/lib/rabbitmq/erl_crash.dump*
> =erl_crash_dump:0.1
> Thu Jun  6 07:55:16 2013
> Slogan: Kernel pid terminated (application_controller) 
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[norm
> al,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
> System version: Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] 
> [async-threads:30] [kernel-poll:true]
> Compiled: Sat Mar  2 06:38:11 2013
> Taints: 
> Atoms: 16222
> =memory
> total: 22257176
> processes: 8772592
> processes_used: 8679992
> system: 13484584
> atom: 1119585
> atom_used: 1112647
> binary: 6552
> code: 11053723
> ets: 53736
> =hash_table:atom_tab
> size: 12853
> used: 9224
> objs: 16222
> depth: 8
> =index_table:atom_tab
> size: 16384
> limit: 1048576
> entries: 16222
> =hash_table:module_code
> size: 397
> used: 283
> objs: 312
> depth: 2
> =index_table:module_code
> size: 1024
> limit: 65536
> entries: 312
> =hash_table:export_list
> size: 4813
> used: 3609
> objs: 6537
> depth: 7
> =index_table:export_list
> size: 7168
> limit: 524288
> entries: 6537
> =hash_table:secondary_export_table
> size: 97
> used: 0
> objs: 0
> depth: 0
> =hash_table:process_reg
> size: 11
> used: 3
> objs: 3
> depth: 1
> =hash_table:fun_table
> size: 1597
> used: 1163
> objs: 2061
> depth: 6
> =hash_table:node_table
> size: 5
> used: 1
> objs: 1
> depth: 1
> =hash_table:dist_table
> size: 5
> used: 1
> objs: 1
> depth: 1
> =allocated_areas
> sys_misc: 83886
> static: 1007616
> atom_space: 229432 223214
> atom_table: 234009
> module_table: 11484
> export_table: 95964
> register_table: 180
> fun_table: 12866
> module_refs: 8192
> loaded_code: 10104105
> dist_table: 355
> node_table: 179
> bits_bufs_size: 0
> bif_timer: 80056
> link_lh: 0
> proc: 76896 2016
> atom_entry: 656144 655424
> module_entry: 25776 25136
> reg_proc: 4088 208
> fun_entry: 167280 165760
> db_tab: 14800 448
> export_entry: 630504 630216
> :
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/e20ea120/attachment.htm>

From joost.reuzel at gmail.com  Thu Jun  6 13:43:30 2013
From: joost.reuzel at gmail.com (Joost Reuzel)
Date: Thu, 6 Jun 2013 05:43:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Durability and consumer acknowledgement
	extremely slow
In-Reply-To: <5c6d72b4-ba54-495b-ab0e-2747dea619bd@googlegroups.com>
References: <5c6d72b4-ba54-495b-ab0e-2747dea619bd@googlegroups.com>
Message-ID: <64919f75-c730-4720-b008-b7fc665849bc@googlegroups.com>

We encountered perhaps the same issue. This time not on Amazon, but with 
simple VMWare instances. We are using the .NET client. This would imply 
indeed that it is some behavioral aspect of the node. It would be very 
helpful if someone can explain what is happening here.

Regards,
Joost


On Wednesday, April 24, 2013 6:26:42 PM UTC+2, Karl Rieb wrote:
>
> Hi,
>
> I am trying to improve the message throughput for a RabbitMQ queue in an 
> Amazon cloud instance and am noticing a *significant* drop in performance 
> when enabling acknowledgements for consumer of a durable queue (with 
> persisted messages).  The real problem is that the bottleneck appears to be 
> on the rabbit node and not with the consumers, so adding more consumers 
> does not improve the throughput (or help drain the queue any quicker).  As 
> a matter of fact, adding new consumers will just slow down existing 
> consumers so everyone ends up consuming at a slower rate, preventing 
> overall throughput from changing.
>
> Trying to do batch acknowledgements using the Multiple flag helps a bit 
> (8k msgs/s vs 5.5k msgs/s) but not much compared to the initial drop.  It 
> is only when I turn on *auto_ack* for the consumers that I see the 
> performance shoot *way *back up and when I start seeing a linear increase 
> in throughput as I add more consumers.
>
> Is this expected behavior?  Is there a way to configure the rabbit node so 
> it doesn't hit this bottleneck with acknowledgements?
>
> Here is the sample code I'm using to test the throughput:
>
> Publisher:
>
> #!/usr/bin/python
>
> import pika
>
> creds = pika.PlainCredentials('guest','guest')
> conn  = 
> pika.BlockingConnection(pika.ConnectionParameters(host='10.10.1.123', 
> credentials=creds))
> chan  = conn.channel()
>
> while True:
>     chan.basic_publish(exchange='simple_exchange', 
> routing_key='simple_queue', body='', 
> properties=pika.BasicProperties(delivery_mode=2))
>
>
> Consumer:
>
>  #!/usr/bin/python
>
> import pika
>
> def callback(chan, method, properties, body):
>     chan.basic_ack(delivery_tag=method.delivery_tag, multiple=False)
>
> creds = pika.PlainCredentials('guest','guest')
> conn  = 
> pika.BlockingConnection(pika.ConnectionParameters(host='10.10.1.123', 
> credentials=creds))
> chan  = conn.channel()
>
> chan.basic_consume(callback, queue='simple_queue', no_ack=False)
> chan.basic_qos(prefetch_count=1000)
> chan.start_consuming()
>
>
> I spawn multiple processes for the producers and multiple for the consumer 
> (so there is no python interpreter locking issues since each runs in its 
> own interpreter instance).  I'm using an an Amazon *c1.xlarge *(8 virtual 
> cores and "high" IO) Ubuntu 12.04 LTS instance with RabbitMQ version 
> 3.0.4-1 and an Amazon ephemeral disk (in production we would use an EBS 
> volume instead).  The queue is marked *Durable* and my messages all use *
> delivery_mode* 2 (persist).  
>
> Below are the performance numbers.  For each test I use 2 publishers 
> processes and 6 consumer processes (where 3 different machines host 2 
> consumers each).  The producers and consumers are all on *separate*machines from the rabbit node.  Throughput measurements were done using the 
> RabbitMQ management UI and linux utility top.  Python was compiled to pyc 
> files before running.
>
> *no_ack = True:*  
>     rate = 24,000/s 
>     single consumer CPU   =  65% 
>     single publisher CPU  =  80% (flow control enabled and being enforced)
>     (beam.smp) rabbit CPU = 400% (of 800%, 8 cores) -> 0.0%wa 11.5%sy
>
> *no_ack = False (manual acks per message):*
>     rate =  5,500/s
>     single consumer CPU   =  20%
>     single publisher CPU  =  20% (flow control enabled and being enforced)
>     (beam.smp) rabbit CPU = 300% (of 800%, 8 cores) -> 4.5%wa 10.0%sy
>     
> The most notable difference besides the throughput are the I/O waits when 
> ACKs are enabled (4.5% vs 0.0%).  This leads me to believe that the rabbit 
> node is being bottlenecked by performing I/O operations for ACK 
> bookkeeping.  The I/O doesn't appear to be a problem for persisting the 
> published messages since I'm *guessing* that rabbit is buffering those 
> and syncing them to disk in batches.  Does this mean the acknowledgements 
> are not also being buffered before synced with disk?  Can I configure the 
> rabbit node to change this behavior to help speed up the acknowledgements? 
>   I'm not using transactions in the example code above, so I don't need any 
> strict guarantees that ACKs were written to disk before returning.
>
> Thanks,
> Karl
>
> P.S. I wrote the same sample consumer code in Ruby to see if there was a 
> difference (in case there was a Python issue), but the numbers were about 
> the same.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/72b62762/attachment.htm>

From matthias at rabbitmq.com  Thu Jun  6 18:21:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 06 Jun 2013 18:21:40 +0100
Subject: [rabbitmq-discuss] rabbitmq-server fails to start BOOT ERROR:
 FAILED
In-Reply-To: <c121b42c-4e03-4667-a5c2-79bf3acf6f4e@googlegroups.com>
References: <daf154f0-68c4-4910-b780-0dde3144cb76@googlegroups.com>
	<c121b42c-4e03-4667-a5c2-79bf3acf6f4e@googlegroups.com>
Message-ID: <51B0C524.20802@rabbitmq.com>

On 06/06/13 13:40, rhythmicdevil at gmail.com wrote:
> The solution was here:
> https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/BOOT$20ERROR/rabbitmq-discuss/1_HLF_IGah4/QXIGM-pFgx0J

Indeed.

I note that you are running a very old version of rabbit. you should 
consider upgrading. Many things have changed and improved. Including the 
error messages ;) e.g. modern rabbits report

=ERROR REPORT==== 6-Jun-2013::18:09:59 ===
failed to start TCP Listener on [::]:5672 - eaddrinuse (address already 
in use)


Matthias.

From michael.s.klishin at gmail.com  Thu Jun  6 18:47:37 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 6 Jun 2013 21:47:37 +0400
Subject: [rabbitmq-discuss] rabbitmq memory usage
In-Reply-To: <CABm-Wmen8u-ApCRyAjrEkek0982t1N7X-XECpd3LYpwoOVEw8w@mail.gmail.com>
References: <CABm-Wme3wY=Le96RWvbHBRewWVLVy_s2MgoE921DB6X3XUtu6w@mail.gmail.com>
	<51B09698.5000209@lshift.net> <51B09EEF.8010201@rabbitmq.com>
	<CABm-Wmen8u-ApCRyAjrEkek0982t1N7X-XECpd3LYpwoOVEw8w@mail.gmail.com>
Message-ID: <CAE3HoVRaLYcQ9KaTV-MuFCX+QRfzsoYk-p7MsUNLMh4d9jOfNA@mail.gmail.com>

2013/6/6 Sean Allen <sean at monkeysnatchbanana.com>

> If memory usage is a concern, would we be better batching many items into
> a single message and splitting them apart later?


Sean,

Batching multiple items (esp. if they are tiny) should help reduce the
total RAM usage.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/c46f7570/attachment.htm>

From michael.s.klishin at gmail.com  Thu Jun  6 18:49:13 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 6 Jun 2013 21:49:13 +0400
Subject: [rabbitmq-discuss] RabbitMQ read performance does not grow when
 we add more subscribers?
In-Reply-To: <7481994a-b15a-4d98-b982-0b60f9ad3fed@googlegroups.com>
References: <7481994a-b15a-4d98-b982-0b60f9ad3fed@googlegroups.com>
Message-ID: <CAE3HoVTothtz62xiCp5u-eS6NbFErZJh-csMSVV01-Z9wZ79Gw@mail.gmail.com>

2013/6/6 Joost Reuzel <joost.reuzel at gmail.com>

> For example: when a single process handles messages at a rate of 800
> msg/sec. Adding a second (similar) process has the result of both processes
> handling messages at a rate of 400 msg/sec each, with again 800 msg/sec as
> total. When we shutdown one of the processes, the msg rate of the other
> process increases to (you guessed) 800 msg/sec.


Just to clarify, are they OS processes? Do they share a channel you use
basic.qos on?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/2509f32d/attachment.htm>

From matthias at rabbitmq.com  Thu Jun  6 19:10:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 06 Jun 2013 19:10:10 +0100
Subject: [rabbitmq-discuss] Durability and consumer acknowledgement
 extremely slow
In-Reply-To: <64919f75-c730-4720-b008-b7fc665849bc@googlegroups.com>
References: <5c6d72b4-ba54-495b-ab0e-2747dea619bd@googlegroups.com>
	<64919f75-c730-4720-b008-b7fc665849bc@googlegroups.com>
Message-ID: <51B0D082.8000205@rabbitmq.com>

Joost,

On 06/06/13 13:43, Joost Reuzel wrote:
> We encountered perhaps the same issue. This time not on Amazon, but with
> simple VMWare instances. We are using the .NET client. This would imply
> indeed that it is some behavioral aspect of the node. It would be very
> helpful if someone can explain what is happening here.

Simon answered the original question here: 
http://rabbitmq.1065348.n5.nabble.com/Durability-and-consumer-acknowledgement-extremely-slow-tp26194p26226.html

Matthias.

From Andrew.Ochsner at csgi.com  Thu Jun  6 20:56:43 2013
From: Andrew.Ochsner at csgi.com (Andy Ochsner)
Date: Thu, 6 Jun 2013 19:56:43 +0000
Subject: [rabbitmq-discuss] Consumer Cancellation Notifications with .NET
	client
Message-ID: <6BDEBB2F99BAAC43B7C4E73A4A45AA9403015F@omacsgiexch02.CSGICORP.COM>

Was discussing with hyperthunk on IRC and agreed to move it to the mailing list:

So we wrote a consumer in .NET using the provided client and are consuming off of a mirrored queue.  According to http://www.rabbitmq.com/ha.html we should be responding to Consumer Cancellation Notifications, but I'm not finding much on the site or net in general as to how to actually hook into that using the .NET client.  I thought that using the Unregistered event off of EventingBasicConsumer would do it (HandleBasicCancelOk) but according to hyperthunk that we need something else for the consumer side.  I can confirm that it does connect with the correct properties indicating it supports consumer_cancel_notify.

Do I ultimately just need to subclass and override HandleBasicCancel or OnCancel()?

Thanks


Andrew Ochsner  |  Intentional Architecture
T +01 402 431 7583
A 18020 Burt St, Omaha, NE  68022
E andrew.ochsner at csgi.com

[CSG International Logo]

________________________________
All emails in this message string and any attachments are the confidential information of CSG Systems International, Inc. (CSG), or its affiliates and subsidiaries, and may contain privileged and/or confidential material. If you are not an intended recipient, please delete it immediately and notify the sender; unintended recipients are not authorized to read or otherwise use the information contained herein.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/cb842c30/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1364 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/cb842c30/attachment.gif>

From peter at greenbutton.com  Thu Jun  6 23:15:43 2013
From: peter at greenbutton.com (Peter Soukalopoulos)
Date: Fri, 7 Jun 2013 10:15:43 +1200
Subject: [rabbitmq-discuss] Is it possible to retrieve the number of unacked
	messages on a queue?
Message-ID: <c6b49748d295c8663b6451430cf4d6a7@mail.gmail.com>

I?ve done a little searching via Google to retrieve the number of Unacked
messages via the RabbitMQ client API. Most threads say it?s not possible.



Does anyone have an explanation or, even better, a solution?



FYI I?m using C# .Net ? this code returns the number of Ready messages.



        public int GetApproximateCount(string queueName)

        {

            using (var connection = CreateConnection())

            using (var model = connection.CreateModel())

            {

                try

                {

                    var result = model.QueueDeclarePassive(queueName);

                    return (int)result.MessageCount;

                }

                catch (OperationInterruptedException)

                {

                    return 0;

                }

            }

        }



*Regards,*

*Peter*



*Peter** **Soukalopoulos*
*Development Team Leader | **GreenButton Limited *| www.greenbutton.com
Level 2, James Smith Building, 55 Cuba Street, Wellington, New Zealand
Mobile: +64 22 632 5023| DDI: +644 974 6602 |
peter.soukalopoulos at greenbutton.com | Skype: psoukal | HQ: +644 499 0424

[image: Description: GreenButton_words_small]               [image:
cid:image003.jpg at 01CC4E01.BA075BC0]

For best support, please respond to help at greenbutton.com and retain the
ticket number in the subject line.



This message contains confidential information, intended only for
the person(s) named above, which may also be privileged. Any use,
distribution, copying or disclosure by any other person is strictly
prohibited. In such case, you should delete this message and kindly notify
the sender via reply e-mail. Please advise immediately if you or your
employer does not consent to Internet e-mail for messages of this kind.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/9260c951/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 7433 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/9260c951/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 3761 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/9260c951/attachment.jpeg>

From jhalterman at gmail.com  Thu Jun  6 23:42:34 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Thu, 6 Jun 2013 15:42:34 -0700
Subject: [rabbitmq-discuss] Connection.createChannel() hangs using
	amqp-client 3.1.1
Message-ID: <CA+es_-xZSDZZXALRzFawHoYK9wZ54MzzjU7UP2d3Ko2K1G8duw@mail.gmail.com>

I hit on a scenario where connection.createChannel() may hang forever. The
scenario: obtain a channel and attempt to publish to a non-existent
exchange. The channel will be shutdown. Attempt to establish a new
(replacement) channel via Connection.createChannel(), which hangs forever.
A simple version of this scenario:

public Channel channelFor(final String tenantId) throws Exception {
  Channel channel = connection.createChannel();
  channel.addShutdownListener(new ShutdownListener() {
    public void shutdownCompleted(ShutdownSignalException e) {
      if (!e.isInitiatedByApplication())
        channelFor(tenantId);
    }
  });

  return channel;
}

Channel channel = channelFor("foo");
channel.basicPublish(someNonExistentExchange, ?


From peter at greenbutton.com  Fri Jun  7 03:28:10 2013
From: peter at greenbutton.com (Peter Soukalopoulos)
Date: Fri, 7 Jun 2013 14:28:10 +1200
Subject: [rabbitmq-discuss] Is it possible to retrieve the number of
	unacked messages on a queue?
In-Reply-To: c6b49748d295c8663b6451430cf4d6a7@mail.gmail.com
References: c6b49748d295c8663b6451430cf4d6a7@mail.gmail.com
Message-ID: <c8eb1c183a30137137c1b9d0b06c78f1@mail.gmail.com>

Found the solution using the RabbitMQ Management HTTP API
/api/queues/%F/queue which returns a JSON response including values for
messages_ready, messages_unacknowledged and messages.



{

    "memory": 18104,

   "idle_since": "2013-06-05 21:42:17",

    "exclusive_consumer_tag": "",

    "messages_ready": 2,

    "messages_unacknowledged": 0,

    "messages": 2,

    "consumers": 0,

    "slave_nodes": [],

    "backing_queue_status": {

        "q1": 0,

        "q2": 0,

        "delta": [

            "delta",

            "undefined",

            0,

            "undefined"

        ],

*..stuff deleted*

}



See
http://hg.rabbitmq.com/rabbitmq-management/raw-file/3646dee55e02/priv/www-api/help.html



*Regards,*

*Peter*



*Peter** **Soukalopoulos*
*Development Team Leader | **GreenButton Limited *| www.greenbutton.com
Level 2, James Smith Building, 55 Cuba Street, Wellington, New Zealand
Mobile: +64 22 632 5023| DDI: +644 974 6602 |
peter.soukalopoulos at greenbutton.com | Skype: psoukal | HQ: +644 499 0424

[image: Description: GreenButton_words_small]               [image:
cid:image003.jpg at 01CC4E01.BA075BC0]

For best support, please respond to help at greenbutton.com and retain the
ticket number in the subject line.



This message contains confidential information, intended only for
the person(s) named above, which may also be privileged. Any use,
distribution, copying or disclosure by any other person is strictly
prohibited. In such case, you should delete this message and kindly notify
the sender via reply e-mail. Please advise immediately if you or your
employer does not consent to Internet e-mail for messages of this kind.



*From:* Peter Soukalopoulos [mailto:peter at greenbutton.com]
*Sent:* Friday, 7 June 2013 10:16 a.m.
*To:* 'rabbitmq-discuss at lists.rabbitmq.com'
*Subject:* Is it possible to retrieve the number of unacked messages on a
queue?



I?ve done a little searching via Google to retrieve the number of Unacked
messages via the RabbitMQ client API. Most threads say it?s not possible.



Does anyone have an explanation or, even better, a solution?



FYI I?m using C# .Net ? this code returns the number of Ready messages.



        public int GetApproximateCount(string queueName)

        {

            using (var connection = CreateConnection())

            using (var model = connection.CreateModel())

            {

                try

                {

                    var result = model.QueueDeclarePassive(queueName);

                    return (int)result.MessageCount;

                }

                catch (OperationInterruptedException)

                {

                    return 0;

                }

            }

        }



*Regards,*

*Peter*



*Peter** **Soukalopoulos*
*Development Team Leader | **GreenButton Limited *| www.greenbutton.com
Level 2, James Smith Building, 55 Cuba Street, Wellington, New Zealand
Mobile: +64 22 632 5023| DDI: +644 974 6602 |
peter.soukalopoulos at greenbutton.com | Skype: psoukal | HQ: +644 499 0424

[image: Description: GreenButton_words_small]               [image:
cid:image003.jpg at 01CC4E01.BA075BC0]

For best support, please respond to help at greenbutton.com and retain the
ticket number in the subject line.



This message contains confidential information, intended only for
the person(s) named above, which may also be privileged. Any use,
distribution, copying or disclosure by any other person is strictly
prohibited. In such case, you should delete this message and kindly notify
the sender via reply e-mail. Please advise immediately if you or your
employer does not consent to Internet e-mail for messages of this kind.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/e0549b31/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 7433 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/e0549b31/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 3761 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/e0549b31/attachment.jpeg>

From aflaed at gmail.com  Fri Jun  7 07:58:52 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Thu, 6 Jun 2013 23:58:52 -0700 (PDT)
Subject: [rabbitmq-discuss] How to identify connection?
Message-ID: <ce281d24-55f6-40c4-9cbb-55edba0fd884@googlegroups.com>

Hello, is there way to get connection name in .NET API, because I need to 
identify connections?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/9baf7f0f/attachment.htm>

From emile at rabbitmq.com  Fri Jun  7 08:20:34 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Jun 2013 08:20:34 +0100
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <9ea53a16-fb89-46a0-98a0-5e5c82b1302a@googlegroups.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
	<9ea53a16-fb89-46a0-98a0-5e5c82b1302a@googlegroups.com>
Message-ID: <51B189C2.1030006@rabbitmq.com>

Hi,

On 06/06/13 12:02, Asko Soukka wrote:
> I just like to mention that we faced a similar situation today (with
> RabbitMQ 2.8.4 and Erlang R14B04).

That is rather old, and many bugs have been fixes since 2.8.4. Does the
same happen with the latest version of Rabbit?

> We have a standalone RabbitMQ installation (no cluster) on RHEL5. Due to
> a some other problems, the server was forced to restart, and after the
> restart one of the durable queues (not exclusive) has been similarly
> missing and queue.declare is denied with not_found error:

What were the other problems? Are you able to provide the Mnesia
directory for this broker? I will contact you off-list to arrange transfer.


Emile






From matthias at rabbitmq.com  Fri Jun  7 08:29:06 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Jun 2013 08:29:06 +0100
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <51B189C2.1030006@rabbitmq.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
	<9ea53a16-fb89-46a0-98a0-5e5c82b1302a@googlegroups.com>
	<51B189C2.1030006@rabbitmq.com>
Message-ID: <51B18BC2.7030104@rabbitmq.com>

On 07/06/13 08:20, Emile Joubert wrote:
> On 06/06/13 12:02, Asko Soukka wrote:
>> We have a standalone RabbitMQ installation (no cluster) on RHEL5. Due to
>> a some other problems, the server was forced to restart, and after the
>> restart one of the durable queues (not exclusive) has been similarly
>> missing and queue.declare is denied with not_found error:
>
> What were the other problems? Are you able to provide the Mnesia
> directory for this broker?

+ logs, please, from just before and after the restart.

Matthias

From emile at rabbitmq.com  Fri Jun  7 08:35:53 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Jun 2013 08:35:53 +0100
Subject: [rabbitmq-discuss] Consumer Cancellation Notifications with
 .NET client
In-Reply-To: <6BDEBB2F99BAAC43B7C4E73A4A45AA9403015F@omacsgiexch02.CSGICORP.COM>
References: <6BDEBB2F99BAAC43B7C4E73A4A45AA9403015F@omacsgiexch02.CSGICORP.COM>
Message-ID: <51B18D59.8090009@rabbitmq.com>

On 06/06/13 20:56, Andy Ochsner wrote:
> Do I ultimately just need to subclass and override HandleBasicCancel or
> OnCancel()?

You need to implement HandleBasicCancel().
See the example in class RabbitMQ.Client.Unit.TestConsumerCancelNotify.




-Emile




From emile at rabbitmq.com  Fri Jun  7 08:59:15 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Jun 2013 08:59:15 +0100
Subject: [rabbitmq-discuss] How to identify connection?
In-Reply-To: <ce281d24-55f6-40c4-9cbb-55edba0fd884@googlegroups.com>
References: <ce281d24-55f6-40c4-9cbb-55edba0fd884@googlegroups.com>
Message-ID: <51B192D3.7020506@rabbitmq.com>

On 07/06/13 07:58, ????? ??????? wrote:
> Hello, is there way to get connection name in .NET API, because I need
> to identify connections?


While not accessible directly from the API you can use the socket
details of the client to determine the connection on the server.

You can also get the connection from a consumer tag:
look up channel pid from consumer tag with "rabbitmqctl list_consumers"
look up connection from the channel pid with "rabbitmqctl list_channels"





-Emile






From tilak.chauhan at ymail.com  Fri Jun  7 09:18:57 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Fri, 7 Jun 2013 01:18:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
Message-ID: <1370593137420-27265.post@n5.nabble.com>

Hi,

I've multiple consumer servers which are responsible for picking up messages
from the queues and consuming/processing them. I've RMQ 3.1.0 installed on
all servers along with RMQ clustering configured. I'm using PHP RMQ library
to process all this. For past few days I have been getting some issues
related to the connection and processes. When I start a consumer script to
process messages then after few minutes/hours consumer stops to consume
messages from the queue and when I go to see all the running processes on
sever (using ps or htop command) then I can still see the consumer process
is running on the server. And, when I check connection status then I can
also see that in in running status. If the consumer process is still running
and the connection is also active/running then why consumer is not
processing messages ?

When I did some investigation on the server log then I found following
message in RMQ log file :

=ERROR REPORT==== 7-Jun-2013::08:10:08 ===
connection <0.5495.89>, channel 1 - soft error:
{amqp_error,precondition_failed,"unknown delivery tag 0",'basic.reject'}

=WARNING REPORT==== 7-Jun-2013::08:10:09 ===
closing AMQP connection <0.5495.89> (11.11.11.111:60528 ->
11.11.11.111:5672):
connection_closed_abruptly

=INFO REPORT==== 7-Jun-2013::08:10:10 ===
accepting AMQP connection <0.5509.89> (11.11.11.111:60530 ->
11.11.11.111:5672)

=ERROR REPORT==== 7-Jun-2013::08:10:10 ===
connection <0.5509.89>, channel 1 - soft error:
{amqp_error,precondition_failed,"unknown delivery tag 0",'basic.reject'}

=WARNING REPORT==== 7-Jun-2013::08:10:11 ===
closing AMQP connection <0.5509.89> (11.11.11.111:60530 ->
11.11.11.111:5672):
connection_closed_abruptly

=INFO REPORT==== 7-Jun-2013::08:10:12 ===
accepting AMQP connection <0.5523.89> (11.11.11.111:60532 ->
11.11.11.111:5672)

=ERROR REPORT==== 7-Jun-2013::08:10:12 ===
connection <0.5523.89>, channel 1 - soft error:
{amqp_error,precondition_failed,"unknown delivery tag 0",'basic.reject'}

=WARNING REPORT==== 7-Jun-2013::08:10:13 ===
closing AMQP connection <0.5523.89> (11.11.11.111:60532 ->
11.11.11.111:5672):
connection_closed_abruptly

=INFO REPORT==== 7-Jun-2013::08:10:14 ===
accepting AMQP connection <0.5537.89> (11.11.11.111:60534 ->
11.11.11.111:5672)

=ERROR REPORT==== 7-Jun-2013::08:10:14 ===
connection <0.5537.89>, channel 1 - soft error:
{amqp_error,precondition_failed,"unknown delivery tag 0",'basic.reject'}

=WARNING REPORT==== 7-Jun-2013::08:10:15 ===
closing AMQP connection <0.5537.89> (11.11.11.111:60534 ->
11.11.11.111:5672):
connection_closed_abruptly

Can anybody please give me an idea to get rid of this problem .. If a
connection is being closed automatically then why script is not getting
terminated (it is supposed to do so). Is there any way I can check whether
connection is active or closed ?


Thanks
T.luck 








 

 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Fri Jun  7 09:26:37 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 7 Jun 2013 12:26:37 +0400
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <1370593137420-27265.post@n5.nabble.com>
References: <1370593137420-27265.post@n5.nabble.com>
Message-ID: <CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>

2013/6/7 tluck <tilak.chauhan at ymail.com>

> And, when I check connection status then I can
> also see that in in running status. If the consumer process is still
> running
> and the connection is also active/running then why consumer is not
> processing messages ?
>

Something in your code rejects messages with unknown delivery tag. This
causes
the channel to be closed.

Can you post a fragment of your code that rejects messages and also be more
specific about which PHP library you use?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/2f5105dd/attachment.htm>

From tim at rabbitmq.com  Fri Jun  7 09:38:51 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Jun 2013 09:38:51 +0100
Subject: [rabbitmq-discuss] Connection.createChannel() hangs using
	amqp-client 3.1.1
In-Reply-To: <CA+es_-xZSDZZXALRzFawHoYK9wZ54MzzjU7UP2d3Ko2K1G8duw@mail.gmail.com>
References: <CA+es_-xZSDZZXALRzFawHoYK9wZ54MzzjU7UP2d3Ko2K1G8duw@mail.gmail.com>
Message-ID: <4535A616-BE88-4CD0-AE56-53363C5D11B5@rabbitmq.com>

Hi Jonathan,

On 6 Jun 2013, at 23:42, Jonathan Halterman wrote:
> I hit on a scenario where connection.createChannel() may hang forever. The scenario: obtain a channel and attempt to publish to a non-existent exchange. The channel will be shutdown. Attempt to establish a new (replacement) channel via Connection.createChannel(), which hangs forever. A simple version of this scenario:
> 

This should not be happening. Are you absolutely sure you're using version 3.1.1 of the java client library, since a similar bug (involving accidentally re-used channel ids) was fixed in a previous release: http://hg.rabbitmq.com/rabbitmq-java-client/rev/ea7d68c2154d

> From Tracer:
> 
> 1370554962786: <Tracer-0> ch#1 <- {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no exchange 'foo' in vhost '/', class-id=60, method-id=40), null, ""}
> 1370554962788: <Tracer-0> ch#1 -> {#method<channel.close-ok>(), null, ""}
> 1370554974891: <Tracer-0> ch#1 -> {#method<channel.open>(out-of-band=), null, ""}
> 1370554974970: <Tracer-0> ch#1 <- {#method<channel.open-ok>(channel-id=), null, ""}
> 

That last line seems very odd - I would've expected to a see a channel id in there, though truth be told I'm not overly familiar with the Tracer tool in the java client. 

> Any ideas why things are hanging?
> 

According to the last line of the trace you've supplied, a new channel was opened successfully, though there's no channel id present which is worrying. Please confirm that you are definitely using the right version (i.e., where did you obtain the amqp-client binary from) and we'll take a closer look.

Cheers,
Tim


From aflaed at gmail.com  Fri Jun  7 09:57:05 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Fri, 7 Jun 2013 12:57:05 +0400
Subject: [rabbitmq-discuss] How to identify connection?
In-Reply-To: <51B192D3.7020506@rabbitmq.com>
References: <ce281d24-55f6-40c4-9cbb-55edba0fd884@googlegroups.com>
	<51B192D3.7020506@rabbitmq.com>
Message-ID: <CANV4tdVvtpdGR==YDhoZ_jac4PP0hY8uyRWaavNFx=sz2+JKbw@mail.gmail.com>

I'm using RabbitMQ Management plugin to get connections, but, there is
another problem -- i have different computers, where I start connection, I
want to know, from which computer connection was started.
For example, on computer I can log connection ID, and then compare it in
management site.


2013/6/7 Emile Joubert <emile at rabbitmq.com>

> On 07/06/13 07:58, ????? ??????? wrote:
> > Hello, is there way to get connection name in .NET API, because I need
> > to identify connections?
>
>
> While not accessible directly from the API you can use the socket
> details of the client to determine the connection on the server.
>
> You can also get the connection from a consumer tag:
> look up channel pid from consumer tag with "rabbitmqctl list_consumers"
> look up connection from the channel pid with "rabbitmqctl list_channels"
>
>
>
>
>
> -Emile
>
>
>
>
>
>


-- 
? ?????????,
??????? ?????
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/31f7cfa9/attachment.htm>

From tim at rabbitmq.com  Fri Jun  7 09:57:43 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Jun 2013 09:57:43 +0100
Subject: [rabbitmq-discuss] Connection.createChannel() hangs using
	amqp-client 3.1.1
In-Reply-To: <4535A616-BE88-4CD0-AE56-53363C5D11B5@rabbitmq.com>
References: <CA+es_-xZSDZZXALRzFawHoYK9wZ54MzzjU7UP2d3Ko2K1G8duw@mail.gmail.com>
	<4535A616-BE88-4CD0-AE56-53363C5D11B5@rabbitmq.com>
Message-ID: <586A51A8-282D-4091-B849-A89CAC74F272@rabbitmq.com>

Hi Jonathan,

Ok, you can safely ignore what I've written below. What's actually going on (thanks to Matthias for pointing it out) is that the ShutdownListener callbacks run in the connection's thread, so the call to createChannel causes a deadlock since it blocks waiting for a response (whilst the connection's thread is stuck executing the listener). I'm going to add some notes to the API documentation explaining that, so future users don't get caught out in the same way.

The canonical approach to dealing with this is to have the shutdown listener callback signal your own (application) thread, from which you can manage recovery without risking deadlock in this fashion.

Cheers,
Tim

On 7 Jun 2013, at 09:38, Tim Watson wrote:

> Hi Jonathan,
> 
> On 6 Jun 2013, at 23:42, Jonathan Halterman wrote:
>> I hit on a scenario where connection.createChannel() may hang forever. The scenario: obtain a channel and attempt to publish to a non-existent exchange. The channel will be shutdown. Attempt to establish a new (replacement) channel via Connection.createChannel(), which hangs forever. A simple version of this scenario:
>> 
> 
> This should not be happening. Are you absolutely sure you're using version 3.1.1 of the java client library, since a similar bug (involving accidentally re-used channel ids) was fixed in a previous release: http://hg.rabbitmq.com/rabbitmq-java-client/rev/ea7d68c2154d
> 
>> From Tracer:
>> 
>> 1370554962786: <Tracer-0> ch#1 <- {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no exchange 'foo' in vhost '/', class-id=60, method-id=40), null, ""}
>> 1370554962788: <Tracer-0> ch#1 -> {#method<channel.close-ok>(), null, ""}
>> 1370554974891: <Tracer-0> ch#1 -> {#method<channel.open>(out-of-band=), null, ""}
>> 1370554974970: <Tracer-0> ch#1 <- {#method<channel.open-ok>(channel-id=), null, ""}
>> 
> 
> That last line seems very odd - I would've expected to a see a channel id in there, though truth be told I'm not overly familiar with the Tracer tool in the java client. 
> 
>> Any ideas why things are hanging?
>> 
> 
> According to the last line of the trace you've supplied, a new channel was opened successfully, though there's no channel id present which is worrying. Please confirm that you are definitely using the right version (i.e., where did you obtain the amqp-client binary from) and we'll take a closer look.
> 
> Cheers,
> Tim
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tilak.chauhan at ymail.com  Fri Jun  7 10:56:10 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Fri, 7 Jun 2013 02:56:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
Message-ID: <1370598970168-27270.post@n5.nabble.com>

Hi MK,


>> Can you post a fragment of your code that rejects messages and also be
>> more specific about which PHP library you use?

https://github.com/tnc/php-amqplib -- This is the php library I'm using.


Thanks,
T.luck

 





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265p27270.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tilak.chauhan at ymail.com  Fri Jun  7 11:13:42 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Fri, 7 Jun 2013 03:13:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
Message-ID: <1370600022350-27271.post@n5.nabble.com>

Hi MK,

>> Something in your code rejects messages with unknown delivery tag. This
>> causes
the channel to be closed.

Even if a channel is being closed then why script has not been terminated ?.
I'm using `basic_get` method to consume messages.

>> Can you post a fragment of your code that rejects messages and also be
>> more specific about which PHP library you use?

https://github.com/tnc/php-amqplib -- This is the php library I'm using.

Here is my code sample :

$connection = new AMQPConnection(HOST, PORT, USER, PASS, VHOST); 
$channel = $connection->channel(); 
$channel->queue_declare($queue, false, true, false, false); 
$channel->exchange_declare('myexchange', 'direct', true, true, false); 
$channel->queue_bind('myqueue', $exchange, $queue); 

while ($msg = $channel->basic_get($queue)) {
    consumerMessage($msg, $connection, $channel);
}

$channel->close(); 
$connection->close(); 

function consumerMessage($msg, $connection, $channel){ 
        $data = json_decode($msg->body, true);
        IF(thisConsumerIsNotAllowedToConsumeThisMessage){
            $channel->basic_ack($msg->delivery_info['delivery_tag']);
            return;
        }

	DoAllDataProcessing($data);
	$channel->basic_ack($msg->delivery_info['delivery_tag']);
	return;
} 


Thanks,
T.luck

 




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265p27271.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Fri Jun  7 11:20:06 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Jun 2013 11:20:06 +0100
Subject: [rabbitmq-discuss] Possible process leak in RabbitMQ server
In-Reply-To: <CAMbH-owesAXQfpVsAsFSB+FFKe6c9NwmAh5JWePMtrT3FEOcWQ@mail.gmail.com>
References: <CAMbH-owesAXQfpVsAsFSB+FFKe6c9NwmAh5JWePMtrT3FEOcWQ@mail.gmail.com>
Message-ID: <4BF5E4C0-D560-47C7-8643-2AF3D1780658@rabbitmq.com>

Hi Daniel,

On 5 Jun 2013, at 17:00, Daniel Luna wrote:
> We are experiencing a growth of processes in the rabbitmq server for long running connections.  I have no idea if we are doing something wrong or if this is a bug in rabbitmq itself.
> 
> In an idle system we have about 30k connections to rabbitmq, using around 31k channels.
> 
> Sockets and file descriptors match more or less one-to-one to the connections and so does the number of Erlang processes initally.  My problem here is that the number of Erlang processes is steadily growing.
> 

There should be quite a few more Erlang processes than there are connections + channels. For each connection, for example, there will be more than one process (i.e., a reader plus a writer). For each queue there will be a process, and so on.

> At the moment we have ~500k Erlang processes in our rabbitmq server with 47k connections using 54k channels.  As soon as the load on our system lightens up the number of connections and channels will go down as expected, but the number of processes will stay high.
> 

That figure doesn't necessarily look wrong, given the 47k connections require a reader and a writer process, plus all the channels, plus a process per queue, plus various other system processes, supervisors, mirror queue masters/coordinators/slaves, and so on. It might be a little high, but the key point is whether or not the process count goes down as the load lightens, which you're saying it doesn't.

Do note that processes associated with a client, i.e., related to connections and channels, won't necessarily die immediately upon client disconnect. It will depend on how the disconnect occurs, and various other factors.

> Restarting the client will drop the process count, so this is something related to keeping long living connections and/or channels around.
> 

Possibly. I'm not saying "nothing's wrong", but as you've mentioned below, a bit more research is a good idea.

> Oh, yeah, upgrading from 2.8.2 to 3.1.1 made no difference.
> 
> Connection counts are steady as are channel counts (i.e. they grow and shrink as expected depending on load).  We use both a polling and a subscribing pattern depending on the particular consumer.  I've seen a system with all empty queues have this issue so it's not based on that either.
> 
> I'm suspecting that there's a missing exit that leaves a dangling processes for some sort of operation. It's something that's properly linked with the connection (or channel) though since they go away on connection restart.
> 

That seems unlikely. Can you tell us a bit more about your system? Are you clustered? Are you running any plugins? How many queues are there? How are you counting the number of Erlang processes? Anything interesting in the logs? The output of `rabbitmqctl report' on each node would be useful. Which client libraries are you using? Are we talking just AMQP connections, or other things (such as STOMP, MQTT, etc) as well? 

> I'll research some more and see what I can dig up.
> 

Thanks for that. The more info the better.

> Help would be appreciated.
> 

If we're leaking processes, then we definitely want to know. I suspect not, but the more info you can provide the better.

Cheers,
Tim



From michael.s.klishin at gmail.com  Fri Jun  7 11:20:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 7 Jun 2013 14:20:11 +0400
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <1370600022350-27271.post@n5.nabble.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
	<1370600022350-27271.post@n5.nabble.com>
Message-ID: <CAE3HoVQmNa0KFUerT55=XhNG04EVkdCkFb169Bbn5w2CT+4WHQ@mail.gmail.com>

2013/6/7 tluck <tilak.chauhan at ymail.com>

> while ($msg = $channel->basic_get($queue)) {
>     consumerMessage($msg, $connection, $channel);
> }
>

I suspect this code uses automatic acknowledgement mode. In other words,
RabbitMQ considers the message acknowledged as soon as
it sends it out.

If you want to use explicit acks (it only makes sense if you want messages
to be requeued
in case your consumer crashes), you need to specify it as an extra argument
to basic.get.

Alternatively you can stop using explicit acks. In that case a consumer
that fails before the messages is
processed will cause the message to be lost.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/5672e132/attachment.htm>

From videlalvaro at gmail.com  Fri Jun  7 11:20:57 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 7 Jun 2013 12:20:57 +0200
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <1370600022350-27271.post@n5.nabble.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
	<1370600022350-27271.post@n5.nabble.com>
Message-ID: <CAMcAHLV8hzfGNpfY5akkz2U=ae00RYRpwa-mzY0Gc2jysPoB=g@mail.gmail.com>

Hi,

I have some questions:

1) Why are you using basic_get instead of basic_consume as shown here:
https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php#L66This
is much faster.

2) The "tnc" version of the library is not maintained anymore since 2 years
already. There are many bug fixes in this version of the library:
https://github.com/videlalvaro/php-amqplib/

3) As Michael pointed out, do you have any basic_reject calls in your code?

Regards,

Alvaro


On Fri, Jun 7, 2013 at 12:13 PM, tluck <tilak.chauhan at ymail.com> wrote:

> Hi MK,
>
> >> Something in your code rejects messages with unknown delivery tag. This
> >> causes
> the channel to be closed.
>
> Even if a channel is being closed then why script has not been terminated
> ?.
> I'm using `basic_get` method to consume messages.
>
> >> Can you post a fragment of your code that rejects messages and also be
> >> more specific about which PHP library you use?
>
> https://github.com/tnc/php-amqplib -- This is the php library I'm using.
>
> Here is my code sample :
>
> $connection = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
> $channel = $connection->channel();
> $channel->queue_declare($queue, false, true, false, false);
> $channel->exchange_declare('myexchange', 'direct', true, true, false);
> $channel->queue_bind('myqueue', $exchange, $queue);
>
> while ($msg = $channel->basic_get($queue)) {
>     consumerMessage($msg, $connection, $channel);
> }
>
> $channel->close();
> $connection->close();
>
> function consumerMessage($msg, $connection, $channel){
>         $data = json_decode($msg->body, true);
>         IF(thisConsumerIsNotAllowedToConsumeThisMessage){
>             $channel->basic_ack($msg->delivery_info['delivery_tag']);
>             return;
>         }
>
>         DoAllDataProcessing($data);
>         $channel->basic_ack($msg->delivery_info['delivery_tag']);
>         return;
> }
>
>
> Thanks,
> T.luck
>
>
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265p27271.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/98353cb0/attachment.htm>

From tilak.chauhan at ymail.com  Fri Jun  7 12:01:58 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Fri, 7 Jun 2013 04:01:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <CAMcAHLV8hzfGNpfY5akkz2U=ae00RYRpwa-mzY0Gc2jysPoB=g@mail.gmail.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
	<1370600022350-27271.post@n5.nabble.com>
	<CAMcAHLV8hzfGNpfY5akkz2U=ae00RYRpwa-mzY0Gc2jysPoB=g@mail.gmail.com>
Message-ID: <1370602918919-27275.post@n5.nabble.com>

Hi Alvaro,

Thanks for your reply.

>> 1) Why are you using basic_get instead of basic_consume as shown here:
>> https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php#L66
>> This is much faster.

For now performance is not a major issue for me, but accuracy is. 

>> 2) The "tnc" version of the library is not maintained anymore since 2
>> years already. There are many bug fixes in this version of the library:
>> https://github.com/videlalvaro/php-amqplib/

I'll try use it.

>> 3) As Michael pointed out, do you have any basic_reject calls in your
>> code?

Yes I'm using basic_reject and in my sample code (above) I did a mistake ...
here is the actual code :

IF(thisConsumerIsNotAllowedToConsumeThisMessage){
    $channel->basic_reject($msg->delivery_info['consumer_tag'], true);
    return;
}

Thanks,
Tilak



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265p27275.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tilak.chauhan at ymail.com  Fri Jun  7 13:29:57 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Fri, 7 Jun 2013 05:29:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <CAE3HoVQmNa0KFUerT55=XhNG04EVkdCkFb169Bbn5w2CT+4WHQ@mail.gmail.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
	<1370600022350-27271.post@n5.nabble.com>
	<CAE3HoVQmNa0KFUerT55=XhNG04EVkdCkFb169Bbn5w2CT+4WHQ@mail.gmail.com>
Message-ID: <1370608197521-27276.post@n5.nabble.com>

/>> 2013/6/7 tluck <[hidden email]>
while ($msg = $channel->basic_get($queue)) {
    consumerMessage($msg, $connection, $channel);
}

I suspect this code uses automatic acknowledgement mode. In other words,
RabbitMQ considers the message acknowledged as soon as
it sends it out.
/

I'm expecting there is no problem with my code because default value for
no_ack is false (If my understanding is right then system will wait for the
acknowledgement) and client library function something like this :

public function basic_get($queue="", $no_ack=false, $ticket=NULL) {
       
}

Thanks,
T.luck









--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265p27276.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From eric.berg at pardot.com  Fri Jun  7 15:34:54 2013
From: eric.berg at pardot.com (Eric Berg)
Date: Fri, 7 Jun 2013 10:34:54 -0400
Subject: [rabbitmq-discuss] Management console UI lists many consumers
Message-ID: <CACeek7GEiNcBn6WAJ6JthzF+O_3Od4xCNYsuC0=KFZUDWO2Dtw@mail.gmail.com>

Hi,
I am seeing an issue with our management plugin on our production cluster.
It is a 4 node cluster running RabbitMQ 3.1.1, Erlang R15B03 with the
management plugin enabled on all 4 nodes. We had many hundreds of consumers
running over night and shut all queueing down several hours ago and saw the
connection/channel count drop to 0 yet the consumer count is still stuck on
260 (pic attached).

- all 4 nodes show the same thing in the UI
- all 4 nodes indicate 0 when running rabbitmqctl list_consumers
- I cleared the cache in the web browser and tried multiple web browsers
and see the same thing

Has anyone seen this before? Its not a huge deal to us, but it is confusing
for sure. Thanks!

- Eric Berg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/20caa143/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitManyConsumers.png
Type: image/png
Size: 164417 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/20caa143/attachment.png>

From mrlabbe at gmail.com  Fri Jun  7 15:12:33 2013
From: mrlabbe at gmail.com (Marc Labbe)
Date: Fri, 7 Jun 2013 07:12:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Persistent queues
Message-ID: <17510a56-42cf-4173-ae3a-78d98d5489b4@googlegroups.com>

Hi guys,

following a discussion on the kafka user mailing list in which Alexis 
Richardson replied, I realized I might have been wrong about what I assumed 
for the messages storage in RabbitMQ. It won't change the decision I made 
to use Kafka but I'd like to set my own mind right in my conception of how 
RabbitMQ stores messages. I want to use Rabbit in other projects as well so 
I want to have the right picture in my mind.

The setup I used was based on what is described in 
http://www.rabbitmq.com/tutorials/tutorial-four-python.html. 

RabbitMQ
- RabbitMQ 3.0.x (not exactly sure what x was)
- 5 brokers (behind HA proxy)
- Messages posted to multiple topics (called it A, B, C) where the topic is 
used as the routing key by the exchange
- Queues and messages are persistent (+ replicated)

Consumers
- Consumer 1 subscribes to Topic A (near real-time) - Queue 1
- Consumer 2 subscribes to Topic B (near real-time)  - Queue 2
- Consumer 3 subscribes to A, B and C (offline, BI) - Queue 3

Published 10M messages (size varying between 500b to 2k)


From simon at rabbitmq.com  Fri Jun  7 15:54:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Jun 2013 15:54:07 +0100
Subject: [rabbitmq-discuss] Management console UI lists many consumers
In-Reply-To: <CACeek7GEiNcBn6WAJ6JthzF+O_3Od4xCNYsuC0=KFZUDWO2Dtw@mail.gmail.com>
References: <CACeek7GEiNcBn6WAJ6JthzF+O_3Od4xCNYsuC0=KFZUDWO2Dtw@mail.gmail.com>
Message-ID: <51B1F40F.9020501@rabbitmq.com>

On 07/06/13 15:34, Eric Berg wrote:
> Hi,
> I am seeing an issue with our management plugin on our production
> cluster. It is a 4 node cluster running RabbitMQ 3.1.1, Erlang R15B03
> with the management plugin enabled on all 4 nodes. We had many hundreds
> of consumers running over night and shut all queueing down several hours
> ago and saw the connection/channel count drop to 0 yet the consumer
> count is still stuck on 260 (pic attached).
>
> - all 4 nodes show the same thing in the UI
> - all 4 nodes indicate 0 when running rabbitmqctl list_consumers

One difference there is that the "consumers" count on the overview page 
shows consumers from all vhosts, while "rabbitmqctl list_consumers" 
shows only the default vhost - do you only have one vhost?

Other than that, it is possible that the list of consumers in the 
management database has got out of sync with reality. I'd be interested 
to know how to repeat that.

Actually, looking at the code I can guess some possibilities. I don't 
suppose you had a crashing cluster node did you?

> - I cleared the cache in the web browser and tried multiple web browsers
> and see the same thing
>
> Has anyone seen this before? Its not a huge deal to us, but it is
> confusing for sure. Thanks!

It's not a huge deal but I'd like to fix it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Andrew.Ochsner at csgi.com  Fri Jun  7 15:55:44 2013
From: Andrew.Ochsner at csgi.com (Andy Ochsner)
Date: Fri, 7 Jun 2013 14:55:44 +0000
Subject: [rabbitmq-discuss] Consumer Cancellation Notifications with
 .NET client
In-Reply-To: <51B18D59.8090009@rabbitmq.com>
References: <6BDEBB2F99BAAC43B7C4E73A4A45AA9403015F@omacsgiexch02.CSGICORP.COM>
	<51B18D59.8090009@rabbitmq.com>
Message-ID: <6BDEBB2F99BAAC43B7C4E73A4A45AA940314A1@omacsgiexch02.CSGICORP.COM>

Thanks!  Are there any plans to add an event to EventingBasicConsumer?

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Friday, June 07, 2013 2:36 AM
To: Discussions about RabbitMQ
Cc: Andy Ochsner
Subject: Re: [rabbitmq-discuss] Consumer Cancellation Notifications with .NET client

On 06/06/13 20:56, Andy Ochsner wrote:
> Do I ultimately just need to subclass and override HandleBasicCancel
> or OnCancel()?

You need to implement HandleBasicCancel().
See the example in class RabbitMQ.Client.Unit.TestConsumerCancelNotify.




-Emile




________________________________

All emails in this message string and any attachments are the confidential information of CSG Systems International, Inc. (CSG), or its affiliates and subsidiaries, and may contain privileged and/or confidential material. If you are not an intended recipient, please delete it immediately and notify the sender; unintended recipients are not authorized to read or otherwise use the information contained herein.

From simon at rabbitmq.com  Fri Jun  7 16:02:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Jun 2013 16:02:02 +0100
Subject: [rabbitmq-discuss] Persistent queues
In-Reply-To: <17510a56-42cf-4173-ae3a-78d98d5489b4@googlegroups.com>
References: <17510a56-42cf-4173-ae3a-78d98d5489b4@googlegroups.com>
Message-ID: <51B1F5EA.7080602@rabbitmq.com>

On 07/06/13 15:12, Marc Labbe wrote:
> Hi guys,

Hi.

> From what I (believe I) saw and read, I really expected Rabbit to route
> messages and physically save them to disk for each of the consumers to
> read (1 queue/consumer, 1msg copy/queue). The reason I expected that is
> because if messages are ack'ed by consumers 1 and 2, I expected their
> queue to be free of their messages while consumer 3 would still need
> them to be persisted until it has read them. That was possible a false
> assumption I should have verified with you guys. It would indeed be more
> optimal to store a single copy of the messages and only keep the
> metadata. *Is this correct?*

Yes. The message (properties and body) is persisted once for all queues; 
the metadata (location in queue and whether the message is out for 
delivery) is duplicated across all queues.

(Minor exception: dead-lettering a message creates a new copy, breaking 
this property.)

> Also, during a test where I continuously sent (a lot) of messages while
> my big consumer 3 was offline. The observation I made then is that
> _obviously:_
> - data was accumulating on disk
> - memory usage on all nodes went up. to the point where it eventually
> choked the brokers
>
> I assumed then that the increasing memory usage was because the queue
> and msg metadata was increasing in Mnesia. This was a decisive factor to
> me because I didn't want to be in a situation where my realtime
> consumers would be affected by a slow moving elephant. Is there way I
> could have avoided that situation I didn't see?

Technically queue contents are not held in Mnesia but that's a side issue.

The default message store index has a per-message in-memory cost of ~160 
bytes (again, not per queue). The message store index is pluggable and 
can be replaced, there's an implementation based on Tokyo Cabinet which 
has no memory cost per message. But it's not part of the default 
distribution of RabbitMQ making it rather fiddlier to install.

If you are prepared to lose the messages that are unconsumed by your 
elephant, http://www.rabbitmq.com/ttl.html might be another answer.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Fri Jun  7 16:11:38 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Jun 2013 16:11:38 +0100
Subject: [rabbitmq-discuss] Consumer Cancellation Notifications with
 .NET client
In-Reply-To: <6BDEBB2F99BAAC43B7C4E73A4A45AA940314A1@omacsgiexch02.CSGICORP.COM>
References: <6BDEBB2F99BAAC43B7C4E73A4A45AA9403015F@omacsgiexch02.CSGICORP.COM>
	<51B18D59.8090009@rabbitmq.com>
	<6BDEBB2F99BAAC43B7C4E73A4A45AA940314A1@omacsgiexch02.CSGICORP.COM>
Message-ID: <51B1F82A.1070503@rabbitmq.com>

On 07/06/13 15:55, Andy Ochsner wrote:
> Thanks!  Are there any plans to add an event to EventingBasicConsumer?

Yes there are plans, but I can't guarantee when that will happen.


From jhalterman at gmail.com  Fri Jun  7 16:47:57 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Fri, 7 Jun 2013 08:47:57 -0700
Subject: [rabbitmq-discuss] Connection.createChannel() hangs using
 amqp-client 3.1.1
In-Reply-To: <586A51A8-282D-4091-B849-A89CAC74F272@rabbitmq.com>
References: <CA+es_-xZSDZZXALRzFawHoYK9wZ54MzzjU7UP2d3Ko2K1G8duw@mail.gmail.com>
	<4535A616-BE88-4CD0-AE56-53363C5D11B5@rabbitmq.com>
	<586A51A8-282D-4091-B849-A89CAC74F272@rabbitmq.com>
Message-ID: <CA+es_-wUnWeB--QMAB6RcjPWe6zgZM=owsVq9Qsq4kTeCV7zWg@mail.gmail.com>

Hey Tim,

Sounds good. Thanks for the info.

- jonathan

On Fri, Jun 7, 2013 at 1:57 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Jonathan,
>
> Ok, you can safely ignore what I've written below. What's actually going
> on (thanks to Matthias for pointing it out) is that the ShutdownListener
> callbacks run in the connection's thread, so the call to createChannel
> causes a deadlock since it blocks waiting for a response (whilst the
> connection's thread is stuck executing the listener). I'm going to add some
> notes to the API documentation explaining that, so future users don't get
> caught out in the same way.
>
> The canonical approach to dealing with this is to have the shutdown
> listener callback signal your own (application) thread, from which you can
> manage recovery without risking deadlock in this fashion.
>
> Cheers,
> Tim
>
> On 7 Jun 2013, at 09:38, Tim Watson wrote:
>
> > Hi Jonathan,
> >
> > On 6 Jun 2013, at 23:42, Jonathan Halterman wrote:
> >> I hit on a scenario where connection.createChannel() may hang forever.
> The scenario: obtain a channel and attempt to publish to a non-existent
> exchange. The channel will be shutdown. Attempt to establish a new
> (replacement) channel via Connection.createChannel(), which hangs forever.
> A simple version of this scenario:
> >>
> >
> > This should not be happening. Are you absolutely sure you're using
> version 3.1.1 of the java client library, since a similar bug (involving
> accidentally re-used channel ids) was fixed in a previous release:
> http://hg.rabbitmq.com/rabbitmq-java-client/rev/ea7d68c2154d
> >
> >> From Tracer:
> >>
> >> 1370554962786: <Tracer-0> ch#1 <-
> {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no exchange
> 'foo' in vhost '/', class-id=60, method-id=40), null, ""}
> >> 1370554962788: <Tracer-0> ch#1 -> {#method<channel.close-ok>(), null,
> ""}
> >> 1370554974891: <Tracer-0> ch#1 -> {#method<channel.open>(out-of-band=),
> null, ""}
> >> 1370554974970: <Tracer-0> ch#1 <-
> {#method<channel.open-ok>(channel-id=), null, ""}
> >>
> >
> > That last line seems very odd - I would've expected to a see a channel
> id in there, though truth be told I'm not overly familiar with the Tracer
> tool in the java client.
> >
> >> Any ideas why things are hanging?
> >>
> >
> > According to the last line of the trace you've supplied, a new channel
> was opened successfully, though there's no channel id present which is
> worrying. Please confirm that you are definitely using the right version
> (i.e., where did you obtain the amqp-client binary from) and we'll take a
> closer look.
> >
> > Cheers,
> > Tim
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/3ce45d8b/attachment.htm>

From rasarmento at gmail.com  Fri Jun  7 17:51:51 2013
From: rasarmento at gmail.com (rasarmento)
Date: Fri, 7 Jun 2013 09:51:51 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
	upgrade to 3.1
In-Reply-To: <518A530A.3060602@rabbitmq.com>
References: <1367873173429-26461.post@n5.nabble.com>
	<1368019065431-26525.post@n5.nabble.com>
	<518A530A.3060602@rabbitmq.com>
Message-ID: <1370623911177-27284.post@n5.nabble.com>

I need a help. I am having problems like the one discribed at the begining of
the post and i dont know what to do!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/PHP-amqp-0-9-1-breaks-after-rabbitmq-server-upgrade-to-3-1-tp26461p27284.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Fri Jun  7 18:36:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Jun 2013 18:36:42 +0100
Subject: [rabbitmq-discuss] PHP amqp 0.9.1 breaks after rabbitmq server
 upgrade to 3.1
In-Reply-To: <1370623911177-27284.post@n5.nabble.com>
References: <1367873173429-26461.post@n5.nabble.com>
	<1368019065431-26525.post@n5.nabble.com>
	<518A530A.3060602@rabbitmq.com>
	<1370623911177-27284.post@n5.nabble.com>
Message-ID: <51B21A2A.5080207@rabbitmq.com>

On 07/06/13 17:51, rasarmento wrote:
> I need a help. I am having problems like the one discribed at the begining of
> the post and i dont know what to do!

The bug in question was fixed in RabbitMQ 3.1.1. If you are not running 
that then please upgrade.

If, otoh, you are already running 3.1.1 then the problem you are seeing 
is not the same as reported by the OP, in which case please supply more 
information for us to try to reproduce it.

Matthias.


From jbirdwell34 at gmail.com  Fri Jun  7 19:01:02 2013
From: jbirdwell34 at gmail.com (Josh Birdwell)
Date: Fri, 7 Jun 2013 13:01:02 -0500
Subject: [rabbitmq-discuss] Node.js & RabbitMQ
Message-ID: <CALbD4SheyhWeQGiH2i9P99Q=VN4j95C+wmnZSDc9mY02O8Q2hg@mail.gmail.com>

Hi,

How do you correctly close a connection?
Why is my exchange not being created?

var connection = amqp.createConnection({url: RABBITMQ_URL});

connection.on('ready', function(){
//console.log("Connection established");
connection.exchange('cloudrouter', {"type": "direct"}, function(exchange){
 console.log("Exchange created");
console.log("Another Message");
//exchange.publish('',"Hellow World");
 //console.log(" [x] Sent Hello World");
//amqp_hacks.safeEndConnection(connection);
});
});



-- 
Warmest Regards,

*Josh Birdwell*
STEM Advocate
Oklahoma City, Oklahoma
Mobile: (405) 388-0176
 <http://www.twitter.com/jbirdwell34> <http://www.facebook.com/rfidedgellc>
<http://www.linkedin.com/in/joshbirdwell> <http://www.rfidedge.org>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/05c97656/attachment.htm>

From matthias at rabbitmq.com  Fri Jun  7 19:52:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Jun 2013 19:52:10 +0100
Subject: [rabbitmq-discuss] Persistent queues
In-Reply-To: <17510a56-42cf-4173-ae3a-78d98d5489b4@googlegroups.com>
References: <17510a56-42cf-4173-ae3a-78d98d5489b4@googlegroups.com>
Message-ID: <51B22BDA.4000403@rabbitmq.com>

Marc,

just a few observations on your setup, to supplement the answers to your 
specific questions that Simon gave...

On 07/06/13 15:12, Marc Labbe wrote:
> RabbitMQ
> - RabbitMQ 3.0.x (not exactly sure what x was)
> - 5 brokers (behind HA proxy)
> - Messages posted to multiple topics (called it A, B, C) where the topic
> is used as the routing key by the exchange
> - Queues and messages are persistent (+ replicated)
>
> Consumers
> - Consumer 1 subscribes to Topic A (near real-time) - Queue 1
> - Consumer 2 subscribes to Topic B (near real-time)  - Queue 2
> - Consumer 3 subscribes to A, B and C (offline, BI) - Queue 3
>
> Published 10M messages (size varying between 500b to 2k)

So is that a cluster of five rabbit nodes, with ha-mode='all' set for 
all queues?

If so, note...

- RabbitMQ 3.1 has some significant bug fixes over 3.0, including to a 
memory leak in HA queues, and performance improvements (to HA queues and 
beyond); so you should really upgrade

- with five nodes, you probably ought to configure the ha-mode for the 
queues to be 'exactly' or 'nodes', to limit mirroring to a sub-set; 
unless you really want five replicas of your data.

- if there are really only three queues then you'll want to make sure 
their masters (and slaves) are not clumped together on just a few nodes. 
The 'nodes' policy is useful for that.

- with five nodes, you probably ought to configure all but two or three 
as ram nodes instead of disk nodes, to cut down on the number of 
synchronous disk operations performed for queue/exchange/binding 
creation/deletion. I guess this won't matter much in your case though, 
since it looks like the set of exchanges, queues and bindings is pretty 
static.

Regards,

Matthias.

From static.void.dev at gmail.com  Sat Jun  8 01:24:25 2013
From: static.void.dev at gmail.com (Mark)
Date: Fri, 7 Jun 2013 17:24:25 -0700
Subject: [rabbitmq-discuss] RabbitMQ for log data
Message-ID: <68355D3A-AB5A-4289-8ADF-0F14FA0951B6@gmail.com>

Is RabbitMQ a good fit for writing a bunch of log data into or would something like Kafka be better suited for this?

From lee.sylvester at gmail.com  Sat Jun  8 02:05:38 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Sat, 8 Jun 2013 13:05:38 +1200
Subject: [rabbitmq-discuss] Unable to start RabbitMQ
Message-ID: <3AB52236-A7BE-44F5-A9EF-0FE5CC397F21@gmail.com>

Hey guys,

So, I'm setting up a new server for testing.  I've everything I need installed except RabbitMQ.  When starting RabbitMQ, I get this output:

nodes in question: [rabbit at loadtestprimary]

hosts, their running nodes and ports:
- unable to connect to epmd on loadtestprimary: address (cannot connect to host/port)

current node details:
- node name: rabbitmqctl31053 at loadtestprimary
- home dir: /var/lib/rabbitmq
- cookie hash: KZPKpbSgtTz2dtPVpEXknw==


Does anyone have any idea's as to what I need to do to get RabbitMQ to connect and run?

Thanks,
Lee

From brett.r.cameron at gmail.com  Sat Jun  8 02:26:33 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sat, 8 Jun 2013 13:26:33 +1200
Subject: [rabbitmq-discuss] Unable to start RabbitMQ
In-Reply-To: <3AB52236-A7BE-44F5-A9EF-0FE5CC397F21@gmail.com>
References: <3AB52236-A7BE-44F5-A9EF-0FE5CC397F21@gmail.com>
Message-ID: <CALPqkip_NVjVGfO9rgEsVNk3uG6zu_hv==R3S9ps5BX5M=iTdQ@mail.gmail.com>

Lee,

Erlang seems to be complaining the it cannot connect to epmd (the endpoint
mapper daemon... the mechanism by which Erlang applications such as
RabbitMQ find one another) on host "loadtestprimary". The epmd process will
(should) be started automatically if necessary when Erlang (erl) is run and
by default it listens on port 4369. Is epmd running? What happens if you do
something like "telnet loadtestprimary 4369", etc?

Brett


On Sat, Jun 8, 2013 at 1:05 PM, Lee Sylvester <lee.sylvester at gmail.com>wrote:

> Hey guys,
>
> So, I'm setting up a new server for testing.  I've everything I need
> installed except RabbitMQ.  When starting RabbitMQ, I get this output:
>
> nodes in question: [rabbit at loadtestprimary]
>
> hosts, their running nodes and ports:
> - unable to connect to epmd on loadtestprimary: address (cannot connect to
> host/port)
>
> current node details:
> - node name: rabbitmqctl31053 at loadtestprimary
> - home dir: /var/lib/rabbitmq
> - cookie hash: KZPKpbSgtTz2dtPVpEXknw==
>
>
> Does anyone have any idea's as to what I need to do to get RabbitMQ to
> connect and run?
>
> Thanks,
> Lee
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130608/03f7aa4d/attachment.htm>

From lee.sylvester at gmail.com  Sat Jun  8 03:14:00 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Sat, 8 Jun 2013 14:14:00 +1200
Subject: [rabbitmq-discuss] Unable to start RabbitMQ
In-Reply-To: <CALPqkip_NVjVGfO9rgEsVNk3uG6zu_hv==R3S9ps5BX5M=iTdQ@mail.gmail.com>
References: <3AB52236-A7BE-44F5-A9EF-0FE5CC397F21@gmail.com>
	<CALPqkip_NVjVGfO9rgEsVNk3uG6zu_hv==R3S9ps5BX5M=iTdQ@mail.gmail.com>
Message-ID: <760A297C-98F8-4C21-A5D8-807D030B2193@gmail.com>

Hi Brett,

Thanks for that.  It would seem 4369 isn't open properly.  I'm trying to diagnose it, now.

Thanks,
Lee



On 8 Jun 2013, at 13:26, Brett Cameron <brett.r.cameron at gmail.com> wrote:

> Lee,
> 
> Erlang seems to be complaining the it cannot connect to epmd (the endpoint mapper daemon... the mechanism by which Erlang applications such as RabbitMQ find one another) on host "loadtestprimary". The epmd process will (should) be started automatically if necessary when Erlang (erl) is run and by default it listens on port 4369. Is epmd running? What happens if you do something like "telnet loadtestprimary 4369", etc?
> 
> Brett
> 
> 
> On Sat, Jun 8, 2013 at 1:05 PM, Lee Sylvester <lee.sylvester at gmail.com> wrote:
> Hey guys,
> 
> So, I'm setting up a new server for testing.  I've everything I need installed except RabbitMQ.  When starting RabbitMQ, I get this output:
> 
> nodes in question: [rabbit at loadtestprimary]
> 
> hosts, their running nodes and ports:
> - unable to connect to epmd on loadtestprimary: address (cannot connect to host/port)
> 
> current node details:
> - node name: rabbitmqctl31053 at loadtestprimary
> - home dir: /var/lib/rabbitmq
> - cookie hash: KZPKpbSgtTz2dtPVpEXknw==
> 
> 
> Does anyone have any idea's as to what I need to do to get RabbitMQ to connect and run?
> 
> Thanks,
> Lee
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130608/ad487285/attachment.htm>

From dave.lambley at gmail.com  Sat Jun  8 09:13:17 2013
From: dave.lambley at gmail.com (dave.lambley at gmail.com)
Date: Sat, 8 Jun 2013 08:13:17 +0000
Subject: [rabbitmq-discuss] RabbitMQ for log data
In-Reply-To: <68355D3A-AB5A-4289-8ADF-0F14FA0951B6@gmail.com>
References: <68355D3A-AB5A-4289-8ADF-0F14FA0951B6@gmail.com>
Message-ID: <1876813516-1370679199-cardhu_decombobulator_blackberry.rim.net-517649873-@b18.c8.bise7.blackberry>

Yes, it does this well. If you're wanting your application to log directly into it, it's worth adding some buffering such as with ZeroMQ to eliminate blocking.

Dave

-- 
Sent using from a tiny keypad.

-----Original Message-----
From: Mark <static.void.dev at gmail.com>
Sender: rabbitmq-discuss-bounces at lists.rabbitmq.com
Date: Fri, 7 Jun 2013 17:24:25 
To: Discussions about RabbitMQ<rabbitmq-discuss at lists.rabbitmq.com>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Subject: [rabbitmq-discuss] RabbitMQ for log data

Is RabbitMQ a good fit for writing a bunch of log data into or would something like Kafka be better suited for this?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From udibensenior at gmail.com  Sat Jun  8 11:02:00 2013
From: udibensenior at gmail.com (Udi Ben Senior)
Date: Sat, 8 Jun 2013 03:02:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to compile C Client for windows
Message-ID: <a24cfdfe-2940-41d1-a123-1e8b4d19fe52@googlegroups.com>



Hi,

I've been trying to build the c/c++ client library for windows but didn't 
succeed although following your instructions (see error below after running 
'bash-3.1$ etc/build-ms.sh').

I was wondering maybe you can help me with a compiled client version for 
windows. (i.e. lib, dll, h - for 32/64 bit)

Thanks,

Udi


Result of running  'bash-3.1$ etc/build-ms.sh':

checking if libtool supports shared libraries... yes

checking whether to build shared libraries... yes

checking whether to build static libraries... no

checking for cl.exe option to accept ISO C99... unsupported

checking for inline... __inline

checking if compiler accepts '-Wall'... yes

checking if compiler accepts '-Wextra'... no

checking if compiler accepts '-pedantic'... yes

checking if compiler accepts '-Wstrict-prototypes'... no

checking if compiler accepts '-Wcast-align'... no

checking if compiler accepts '-fno-common'... yes

checking if compiler accepts '-fvisibility=hidden'... yes

checking if linker accepts '-no-undefined'... yes

checking for library containing getaddrinfo... no

checking for socket in -lgetaddrinfo... no

configure: error: cannot find name resolution library (library with 
getaddrinfo

symbol)

bash-3.1$
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130608/f43d248b/attachment.htm>

From alan.antonuk at gmail.com  Sat Jun  8 19:47:01 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 8 Jun 2013 11:47:01 -0700
Subject: [rabbitmq-discuss] Unable to compile C Client for windows
In-Reply-To: <a24cfdfe-2940-41d1-a123-1e8b4d19fe52@googlegroups.com>
References: <a24cfdfe-2940-41d1-a123-1e8b4d19fe52@googlegroups.com>
Message-ID: <CAAt2poJW9GgGv=+1hMn2=5GkLSEJw=tc-zCyCE7A11PJcqJmcg@mail.gmail.com>

The autotools build is known not to work on Win32. You need to build
rabbitmq-c with CMake:

https://github.com/alanxz/rabbitmq-c#building-and-installing-using-cmake

-Alan


On Sat, Jun 8, 2013 at 3:02 AM, Udi Ben Senior <udibensenior at gmail.com>wrote:

> Hi,
>
> I've been trying to build the c/c++ client library for windows but didn't
> succeed although following your instructions (see error below after running
> 'bash-3.1$ etc/build-ms.sh').
>
> I was wondering maybe you can help me with a compiled client version for
> windows. (i.e. lib, dll, h - for 32/64 bit)
>
> Thanks,
>
> Udi
>
>
> Result of running  'bash-3.1$ etc/build-ms.sh':
>
> checking if libtool supports shared libraries... yes
>
> checking whether to build shared libraries... yes
>
> checking whether to build static libraries... no
>
> checking for cl.exe option to accept ISO C99... unsupported
>
> checking for inline... __inline
>
> checking if compiler accepts '-Wall'... yes
>
> checking if compiler accepts '-Wextra'... no
>
> checking if compiler accepts '-pedantic'... yes
>
> checking if compiler accepts '-Wstrict-prototypes'... no
>
> checking if compiler accepts '-Wcast-align'... no
>
> checking if compiler accepts '-fno-common'... yes
>
> checking if compiler accepts '-fvisibility=hidden'... yes
>
> checking if linker accepts '-no-undefined'... yes
>
> checking for library containing getaddrinfo... no
>
> checking for socket in -lgetaddrinfo... no
>
> configure: error: cannot find name resolution library (library with
> getaddrinfo
>
> symbol)
>
> bash-3.1$
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130608/975f5116/attachment.htm>

From static.void.dev at gmail.com  Sat Jun  8 20:10:50 2013
From: static.void.dev at gmail.com (Mark)
Date: Sat, 8 Jun 2013 12:10:50 -0700
Subject: [rabbitmq-discuss] RabbitMQ for log data
In-Reply-To: <1876813516-1370679199-cardhu_decombobulator_blackberry.rim.net-517649873-@b18.c8.bise7.blackberry>
References: <68355D3A-AB5A-4289-8ADF-0F14FA0951B6@gmail.com>
	<1876813516-1370679199-cardhu_decombobulator_blackberry.rim.net-517649873-@b18.c8.bise7.blackberry>
Message-ID: <233BBA26-FFF8-44B5-9CBD-DCA45212F9D2@gmail.com>

I'm guessing if I didn't want directly to it I would need to write some sort of producer to tail some logs and ship them over to Rabbit?

On Jun 8, 2013, at 1:13 AM, dave.lambley at gmail.com wrote:

> Yes, it does this well. If you're wanting your application to log directly into it, it's worth adding some buffering such as with ZeroMQ to eliminate blocking.
> 
> Dave
> 
> -- 
> Sent using from a tiny keypad.
> 
> -----Original Message-----
> From: Mark <static.void.dev at gmail.com>
> Sender: rabbitmq-discuss-bounces at lists.rabbitmq.com
> Date: Fri, 7 Jun 2013 17:24:25 
> To: Discussions about RabbitMQ<rabbitmq-discuss at lists.rabbitmq.com>
> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: [rabbitmq-discuss] RabbitMQ for log data
> 
> Is RabbitMQ a good fit for writing a bunch of log data into or would something like Kafka be better suited for this?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From vikram.vis at gmail.com  Sun Jun  9 02:23:55 2013
From: vikram.vis at gmail.com (Vikram Viswanathan)
Date: Sat, 08 Jun 2013 18:23:55 -0700
Subject: [rabbitmq-discuss] Is there a way to receive multiple message using
 a single synchronous call ?
In-Reply-To: <519E33A3.9010700@rabbitmq.com>
References: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
	<5190BF33.1010902@rabbitmq.com>
	<1369255851048-26944.post@n5.nabble.com>
	<519E33A3.9010700@rabbitmq.com>
Message-ID: <51B3D92B.5090803@gmail.com>



When I know that there are N messages( N could be a small value less 
than 10) in the queue, then I should be able to do something like 
channel.basic_get(String queue, boolean autoAck , int numberofMsg ). I 
don't want to make multiple requests to the server and  I don't want to 
register a handler to receive messages.

Is there a way ?

Thanks,
-Vikram

From nathanael.rensen at zetta.com.au  Sun Jun  9 06:03:42 2013
From: nathanael.rensen at zetta.com.au (Rensen, Nathanael)
Date: Sun, 9 Jun 2013 05:03:42 +0000
Subject: [rabbitmq-discuss] 3.1.1 - Errors during failover
Message-ID: <03CFB894A02BE24885082C694F789A7B13E0EBC6@PERMLS03.zettaserve.com>

While testing a fail-over scenario with RabbitMQ 3.1.1 I have repeatedly encountered errors, sometimes resulting in durable queues vanishing.

The cluster consists of two brokers using LVS / keepalived in order to connect clients to a functional broker. There are 10 mirrored queues, each of which has ha-sync-mode = automatic. A script is used to shut down one broker or the other in turn using 'service rabbitmq-server {start|stop}', such that there is always one broker running and leaving at least 30 seconds between each start / stop. I am expecting that this test should be able to run indefinitely without destabilising the cluster, however I have not been able to achieve more than a few dozen fail-overs without some error occurring. I'm hoping someone may have some insight or suggestions as to how to stabilise this environment.

I have included basic environment details below and attached logs from both brokers showing one example. In this case zg-dev-mq-003 was stopped at 11:32:21 and went through what appears to be a clean shutdown:

=INFO REPORT==== 9-Jun-2013::11:33:22 === Halting Erlang VM

zg-dev-mq-002 detected the other broker down and promoted itself to master. Then after accepting connections from clients it logged an error as shown below:

=INFO REPORT==== 9-Jun-2013::11:33:22 === rabbit on node 'rabbit at zg-dev-mq-003' down
=INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.427.0> (10.0.72.36:61434 -> 172.17.0.73:5672)
=INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.430.0> (10.0.72.36:61435 -> 172.17.0.73:5672)
=ERROR REPORT==== 9-Jun-2013::11:33:22 ===
** Generic server <0.418.0> terminating
** Last message in was {'$gen_cast',
                        {delete_and_terminate,
                         {badarg,
                          [{ets,insert_new,
                            [360523,
                             {{<<10,71,177,42,66,240,207,204,251,26,181,155,
                                 246,83,172,137>>,
                               <<120,196,170,245,109,158,126,84,92,250,21,193,
                                 123,113,128,48>>},
                              -1}],
                            []},
                           {rabbit_msg_store,client_update_flying,3,[]},
                           {rabbit_msg_store,'-remove/2-lc$^0/1-0-',2,[]},
                           {rabbit_msg_store,remove,2,[]},
                           {rabbit_variable_queue,
                            '-with_immutable_msg_store_state/3-fun-0-',2,[]},
                           {rabbit_variable_queue,with_msg_store_state,3,[]},
                           {rabbit_variable_queue,
                            with_immutable_msg_store_state,3,[]},
                           {rabbit_variable_queue,'-ack/2-lc$^0/1-0-',2,
                            []}]}}}
etc

Environment details (same for both brokers):

[root at zg-dev-mq-002]# uname -a
Linux zg-dev-mq-002.zettagrid.local 2.6.32-358.2.1.el6.x86_64 #1 SMP Wed Mar 13 00:26:49 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux

[root at zg-dev-mq-002]# cat /etc/centos-release
CentOS release 6.4 (Final)

[root at zg-dev-mq-002]# yum list installed | egrep 'rabbit|erlang'
esl-erlang.x86_64      R16B-2           @/esl-erlang-R16B-2.x86_64
esl-erlang-compat.noarch      R14B-1.el6       @/esl-erlang-compat-R14B-1.el6.noarch
rabbitmq-server.noarch 3.1.1-1          @/rabbitmq-server-3.1.1-1.noarch

Thanks very much,

Nathanael

________________________________

ZettaServe Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately if you have received this email by mistake and delete this email from your system. Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. ZettaServe Pty Ltd accepts no liability for any damage caused by any virus transmitted by this email.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: logs.zip
Type: application/x-zip-compressed
Size: 331237 bytes
Desc: logs.zip
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130609/34895bfb/attachment.bin>

From 314992959 at qq.com  Sun Jun  9 05:51:17 2013
From: 314992959 at qq.com (3k4b251)
Date: Sat, 8 Jun 2013 21:51:17 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c   connection block
Message-ID: <1370753477137-27297.post@n5.nabble.com>

I  create a connection : amqp_connection_state_t  conn;     And  I   create 
a   Thread  for   amqp_simple_wait_frame().       But  when   I   started 
this  Thread.   I   found   everything  block , like   
amqp_queue_declare(conn,quename.....);       what's  the  problem?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Sun Jun  9 18:35:59 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sun, 9 Jun 2013 10:35:59 -0700
Subject: [rabbitmq-discuss] rabbitmq-c connection block
In-Reply-To: <1370753477137-27297.post@n5.nabble.com>
References: <1370753477137-27297.post@n5.nabble.com>
Message-ID: <CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>

There could be a number of things going on.  Could you post a short program
that demonstrates your problem?


On Sat, Jun 8, 2013 at 9:51 PM, 3k4b251 <314992959 at qq.com> wrote:

> I  create a connection : amqp_connection_state_t  conn;     And  I   create
> a   Thread  for   amqp_simple_wait_frame().       But  when   I   started
> this  Thread.   I   found   everything  block , like
> amqp_queue_declare(conn,quename.....);       what's  the  problem?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130609/f67530e0/attachment.htm>

From bfry at fryhard.com  Mon Jun 10 06:32:39 2013
From: bfry at fryhard.com (Brendan Fry)
Date: Sun, 9 Jun 2013 22:32:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Restart Cluster after crash
Message-ID: <e4e37a80-c286-4c24-bf63-0916eaf8b3ec@googlegroups.com>

Hi,

We are trying to restart our RabbitMQ cluster after an unexpected 
environment failure. 

We are running:

   - rabbitmq_server-3.1.0 on Windows
   - erl5.10.1
   
Our cluster is configured like so:

   - web01, web02, web03, web04, web05, app05, app06

During earlier testing we were able to take down any and all of the nodes 
with a Windows restart and the cluster would recover. Though, after the 
unexpected crash that brought down the entire cluster the rabbit services 
will no longer start.

We receive the following error:

*C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-3.1.0\sbin>rabbitmq-server.bat*
*
*
*              RabbitMQ 3.1.0. Copyright (C) 2007-2013 VMware, Inc.*
*  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/*
*  ##  ##*
*  ##########  Logs: C:/RabbitMQ/log/rabbit at OTLABWEB02.log*
*  ######  ##        C:/RabbitMQ/log/rabbit at OTLABWEB02-sasl.log*
*  ##########*
*              Starting broker...*
*
*
*BOOT FAILED*
*===========*
*Timeout contacting cluster nodes: [rabbit at OTLABWEB05,rabbit at OTLABWEB04,*
*                                   rabbit at OTLABWEB03,rabbit at OTLABWEB01,*
*                                   rabbit at OTLABAPP06,rabbit at OTLABAPP05].*
*
*
*DIAGNOSTICS*
*===========*
*nodes in question: [rabbit at OTLABWEB05,rabbit at OTLABWEB04,rabbit at OTLABWEB03,*
*                    rabbit at OTLABWEB01,rabbit at OTLABAPP06,rabbit at OTLABAPP05]*
*
*
*hosts, their running nodes and ports:*
*- OTLABAPP05: []*
*- OTLABAPP06: []*
*- OTLABWEB01: []*
*- OTLABWEB03: []*
*- OTLABWEB04: []*
*- OTLABWEB05: []*
*
*
*current node details:*
*- node name: rabbit at OTLABWEB02*
*- home dir: U:\*
*- cookie hash: j9x9r680xF6JzFI7IVDLew==*
*
*
*BOOT FAILED*
*===========*
*Error description:*
*   {could_not_start,rabbit,*
*       {bad_return,*
*           {{rabbit,start,[normal,[]]},*
*            {'EXIT',*
*                {rabbit,failure_during_boot,*
*                    {error,*
*                        {timeout_waiting_for_tables,*
*                            
[rabbit_user,rabbit_user_permission,rabbit_vhost,*
*                             rabbit_durable_route,rabbit_durable_exchange,*
*                             rabbit_runtime_parameters,*
*                             rabbit_durable_queue]}}}}}}}*
*
*
*Log files (may contain more information):*
*   C:/RabbitMQ/log/rabbit at OTLABWEB02.log*
*   C:/RabbitMQ/log/rabbit at OTLABWEB02-sasl.log*
*
*
*{"init terminating in 
do_boot",{rabbit,failure_during_boot,{could_not_start,rabb*
*
it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot,{
*
*
error,{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vho
*
*
st,rabbit_durable_route,rabbit_durable_exchange,rabbit_runtime_parameters,rabbit
*
*_durable_queue]}}}}}}}}}*
*
*
*Crash dump was written to: erl_crash.dump*
*init terminating in do_boot ()*


I have attached the log files from web02.

Reading the groups and Googling we have managed to recreate the cluster 
before, but at the loss of the queues. We would like to retain our queues 
and the information they contained. We hope that this is easy to solve, 
since servers do unexpectedly go down. :(

Any help would be greatly appreciated.

Thanks
Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130609/55356de1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at OTLABWEB02.log
Type: application/octet-stream
Size: 1994 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130609/55356de1/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at OTLABWEB02-sasl.log
Type: application/octet-stream
Size: 965 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130609/55356de1/attachment-0001.obj>

From yairogen at gmail.com  Mon Jun 10 06:59:22 2013
From: yairogen at gmail.com (Yair Ogen)
Date: Sun, 9 Jun 2013 22:59:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ sharding supprot
Message-ID: <a5a8acb6-b024-49df-95f1-97ecd8e764a8@googlegroups.com>

Hi,

I've tested out the clustering and HA support (including replication 
policies) and was successful in achieving the following:

3 nodes in a cluster with full replication on all exchanges and queues. 
Publisher sends messages to node A. I see these messages in replicated 
queues on node A, B and C. That's good.

I started 2 consumers one reading from Node B and one from Node C. They 
read the messages in a  round-robin like fashion (i.e. once one consumer 
read the message the replicated message in other node was gone).

That's all very good. 

Problem is that this doesn't scale very well. Assume I have a very high 
load from publishers. Consumers can't read fast enough. Eventually - I'll 
run out of physical resources.

Does rabbitmq support any kind of sharding or message distribution based on 
a known key?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130609/7b86c2e5/attachment.htm>

From simon at rabbitmq.com  Mon Jun 10 10:31:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Jun 2013 10:31:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ sharding supprot
In-Reply-To: <a5a8acb6-b024-49df-95f1-97ecd8e764a8@googlegroups.com>
References: <a5a8acb6-b024-49df-95f1-97ecd8e764a8@googlegroups.com>
Message-ID: <51B59CDA.1030909@rabbitmq.com>

On 10/06/13 06:59, Yair Ogen wrote:
> Does rabbitmq support any kind of sharding or message distribution based
> on a known key?

See the Consistent Hash Exchange: 
https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From alexis at rabbitmq.com  Mon Jun 10 10:55:26 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 10 Jun 2013 10:55:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ for log data
In-Reply-To: <233BBA26-FFF8-44B5-9CBD-DCA45212F9D2@gmail.com>
References: <68355D3A-AB5A-4289-8ADF-0F14FA0951B6@gmail.com>
	<1876813516-1370679199-cardhu_decombobulator_blackberry.rim.net-517649873-@b18.c8.bise7.blackberry>
	<233BBA26-FFF8-44B5-9CBD-DCA45212F9D2@gmail.com>
Message-ID: <CACOPnveAX2ULamfdZp1eD0rfdu5B6HVCkjWAZQHDwvkKxe4zCg@mail.gmail.com>

Some examples...

https://www.google.co.uk/search?q=graylog2+rabbitmq&oq=graylog2+rabbitmq&aqs=chrome.0.57j0.6173j0&sourceid=chrome&ie=UTF-8



On Sat, Jun 8, 2013 at 8:10 PM, Mark <static.void.dev at gmail.com> wrote:
> I'm guessing if I didn't want directly to it I would need to write some sort of producer to tail some logs and ship them over to Rabbit?
>
> On Jun 8, 2013, at 1:13 AM, dave.lambley at gmail.com wrote:
>
>> Yes, it does this well. If you're wanting your application to log directly into it, it's worth adding some buffering such as with ZeroMQ to eliminate blocking.
>>
>> Dave
>>
>> --
>> Sent using from a tiny keypad.
>>
>> -----Original Message-----
>> From: Mark <static.void.dev at gmail.com>
>> Sender: rabbitmq-discuss-bounces at lists.rabbitmq.com
>> Date: Fri, 7 Jun 2013 17:24:25
>> To: Discussions about RabbitMQ<rabbitmq-discuss at lists.rabbitmq.com>
>> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Subject: [rabbitmq-discuss] RabbitMQ for log data
>>
>> Is RabbitMQ a good fit for writing a bunch of log data into or would something like Kafka be better suited for this?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Jun 10 11:04:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Jun 2013 11:04:48 +0100
Subject: [rabbitmq-discuss] 3.1.1 - Errors during failover
In-Reply-To: <03CFB894A02BE24885082C694F789A7B13E0EBC6@PERMLS03.zettaserve.com>
References: <03CFB894A02BE24885082C694F789A7B13E0EBC6@PERMLS03.zettaserve.com>
Message-ID: <51B5A4C0.8070903@rabbitmq.com>

Hi. Looking at the logs it seems like the message store on mq-002 
crashed / shut down unexpectedly, but there's no information about this 
in the log. Do you have the corresponding sasl log?

Cheers, Simon

On 09/06/13 06:03, Rensen, Nathanael wrote:
> While testing a fail-over scenario with RabbitMQ 3.1.1 I have repeatedly encountered errors, sometimes resulting in durable queues vanishing.
>
> The cluster consists of two brokers using LVS / keepalived in order to connect clients to a functional broker. There are 10 mirrored queues, each of which has ha-sync-mode = automatic. A script is used to shut down one broker or the other in turn using 'service rabbitmq-server {start|stop}', such that there is always one broker running and leaving at least 30 seconds between each start / stop. I am expecting that this test should be able to run indefinitely without destabilising the cluster, however I have not been able to achieve more than a few dozen fail-overs without some error occurring. I'm hoping someone may have some insight or suggestions as to how to stabilise this environment.
>
> I have included basic environment details below and attached logs from both brokers showing one example. In this case zg-dev-mq-003 was stopped at 11:32:21 and went through what appears to be a clean shutdown:
>
> =INFO REPORT==== 9-Jun-2013::11:33:22 === Halting Erlang VM
>
> zg-dev-mq-002 detected the other broker down and promoted itself to master. Then after accepting connections from clients it logged an error as shown below:
>
> =INFO REPORT==== 9-Jun-2013::11:33:22 === rabbit on node 'rabbit at zg-dev-mq-003' down
> =INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.427.0> (10.0.72.36:61434 -> 172.17.0.73:5672)
> =INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.430.0> (10.0.72.36:61435 -> 172.17.0.73:5672)
> =ERROR REPORT==== 9-Jun-2013::11:33:22 ===
> ** Generic server <0.418.0> terminating
> ** Last message in was {'$gen_cast',
>                          {delete_and_terminate,
>                           {badarg,
>                            [{ets,insert_new,
>                              [360523,
>                               {{<<10,71,177,42,66,240,207,204,251,26,181,155,
>                                   246,83,172,137>>,
>                                 <<120,196,170,245,109,158,126,84,92,250,21,193,
>                                   123,113,128,48>>},
>                                -1}],
>                              []},
>                             {rabbit_msg_store,client_update_flying,3,[]},
>                             {rabbit_msg_store,'-remove/2-lc$^0/1-0-',2,[]},
>                             {rabbit_msg_store,remove,2,[]},
>                             {rabbit_variable_queue,
>                              '-with_immutable_msg_store_state/3-fun-0-',2,[]},
>                             {rabbit_variable_queue,with_msg_store_state,3,[]},
>                             {rabbit_variable_queue,
>                              with_immutable_msg_store_state,3,[]},
>                             {rabbit_variable_queue,'-ack/2-lc$^0/1-0-',2,
>                              []}]}}}
> etc
>
> Environment details (same for both brokers):
>
> [root at zg-dev-mq-002]# uname -a
> Linux zg-dev-mq-002.zettagrid.local 2.6.32-358.2.1.el6.x86_64 #1 SMP Wed Mar 13 00:26:49 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
>
> [root at zg-dev-mq-002]# cat /etc/centos-release
> CentOS release 6.4 (Final)
>
> [root at zg-dev-mq-002]# yum list installed | egrep 'rabbit|erlang'
> esl-erlang.x86_64      R16B-2           @/esl-erlang-R16B-2.x86_64
> esl-erlang-compat.noarch      R14B-1.el6       @/esl-erlang-compat-R14B-1.el6.noarch
> rabbitmq-server.noarch 3.1.1-1          @/rabbitmq-server-3.1.1-1.noarch
>
> Thanks very much,
>
> Nathanael
>
> ________________________________
>
> ZettaServe Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately if you have received this email by mistake and delete this email from your system. Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. ZettaServe Pty Ltd accepts no liability for any damage caused by any virus transmitted by this email.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 10 11:05:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Jun 2013 11:05:32 +0100
Subject: [rabbitmq-discuss] Is there a way to receive multiple message
 using a single synchronous call ?
In-Reply-To: <51B3D92B.5090803@gmail.com>
References: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
	<5190BF33.1010902@rabbitmq.com>
	<1369255851048-26944.post@n5.nabble.com>
	<519E33A3.9010700@rabbitmq.com> <51B3D92B.5090803@gmail.com>
Message-ID: <51B5A4EC.4000203@rabbitmq.com>

On 09/06/13 02:23, Vikram Viswanathan wrote:
> When I know that there are N messages( N could be a small value less
> than 10) in the queue, then I should be able to do something like
> channel.basic_get(String queue, boolean autoAck , int numberofMsg ). I
> don't want to make multiple requests to the server and  I don't want to
> register a handler to receive messages.
>
> Is there a way ?

I'm afraid not, you can either receive one message with basic.get or 
multiple with basic.consume.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From nathanael.rensen at zetta.com.au  Mon Jun 10 11:32:02 2013
From: nathanael.rensen at zetta.com.au (Rensen, Nathanael)
Date: Mon, 10 Jun 2013 10:32:02 +0000
Subject: [rabbitmq-discuss] 3.1.1 - Errors during failover
Message-ID: <03CFB894A02BE24885082C694F789A7B13E0FC6D@PERMLS03.zettaserve.com>

I've attached the sasl log from mq-002. Sorry I didn't include that originally.

Thanks for taking a look.

Nathanael


Simon MacMullen wrote:

Hi. Looking at the logs it seems like the message store on mq-002 crashed / shut down unexpectedly, but there's no information about this in the log. Do you have the corresponding sasl log?

Cheers, Simon


On 09/06/13 06:03, Rensen, Nathanael wrote:
While testing a fail-over scenario with RabbitMQ 3.1.1 I have repeatedly encountered errors, sometimes resulting in durable queues vanishing.

The cluster consists of two brokers using LVS / keepalived in order to connect clients to a functional broker. There are 10 mirrored queues, each of which has ha-sync-mode = automatic. A script is used to shut down one broker or the other in turn using 'service rabbitmq-server {start|stop}', such that there is always one broker running and leaving at least 30 seconds between each start / stop. I am expecting that this test should be able to run indefinitely without destabilising the cluster, however I have not been able to achieve more than a few dozen fail-overs without some error occurring. I'm hoping someone may have some insight or suggestions as to how to stabilise this environment.

I have included basic environment details below and attached logs from both brokers showing one example. In this case zg-dev-mq-003 was stopped at 11:32:21 and went through what appears to be a clean shutdown:

=INFO REPORT==== 9-Jun-2013::11:33:22 === Halting Erlang VM

zg-dev-mq-002 detected the other broker down and promoted itself to master. Then after accepting connections from clients it logged an error as shown below:

=INFO REPORT==== 9-Jun-2013::11:33:22 === rabbit on node 'rabbit at zg-dev-mq-003' down
=INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.427.0> (10.0.72.36:61434 -> 172.17.0.73:5672)
=INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.430.0> (10.0.72.36:61435 -> 172.17.0.73:5672)
=ERROR REPORT==== 9-Jun-2013::11:33:22 ===
** Generic server <0.418.0> terminating
** Last message in was {'$gen_cast',
                         {delete_and_terminate,
                          {badarg,
                           [{ets,insert_new,
                             [360523,
                              {{<<10,71,177,42,66,240,207,204,251,26,181,155,
                                  246,83,172,137>>,
                                <<120,196,170,245,109,158,126,84,92,250,21,193,
                                  123,113,128,48>>},
                               -1}],
                             []},
                            {rabbit_msg_store,client_update_flying,3,[]},
                            {rabbit_msg_store,'-remove/2-lc$^0/1-0-',2,[]},
                            {rabbit_msg_store,remove,2,[]},
                            {rabbit_variable_queue,
                             '-with_immutable_msg_store_state/3-fun-0-',2,[]},
                            {rabbit_variable_queue,with_msg_store_state,3,[]},
                            {rabbit_variable_queue,
                             with_immutable_msg_store_state,3,[]},
                            {rabbit_variable_queue,'-ack/2-lc$^0/1-0-',2,
                             []}]}}}
etc

Environment details (same for both brokers):

[root at zg-dev-mq-002]# uname -a
Linux zg-dev-mq-002.zettagrid.local 2.6.32-358.2.1.el6.x86_64 #1 SMP Wed Mar 13 00:26:49 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux

[root at zg-dev-mq-002]# cat /etc/centos-release
CentOS release 6.4 (Final)

[root at zg-dev-mq-002]# yum list installed | egrep 'rabbit|erlang'
esl-erlang.x86_64      R16B-2           @/esl-erlang-R16B-2.x86_64
esl-erlang-compat.noarch      R14B-1.el6       @/esl-erlang-compat-R14B-1.el6.noarch
rabbitmq-server.noarch 3.1.1-1          @/rabbitmq-server-3.1.1-1.noarch

Thanks very much,

Nathanael

________________________________

ZettaServe Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately if you have received this email by mistake and delete this email from your system. Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. ZettaServe Pty Ltd accepts no liability for any damage caused by any virus transmitted by this email.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at zg-dev-mq-002-sasl.zip
Type: application/x-zip-compressed
Size: 7786 bytes
Desc: rabbit at zg-dev-mq-002-sasl.zip
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130610/6aae20b9/attachment.bin>

From reddylast at gmail.com  Mon Jun 10 12:30:12 2013
From: reddylast at gmail.com (reddylast)
Date: Mon, 10 Jun 2013 04:30:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection(s) internally being closed !
Message-ID: <1370863812380-27307.post@n5.nabble.com>

Hi,

If a consumer is consuming messages from a queue and suddenly someone
restarts rabbitmq sever (or internal network fails) then consumer stops
consuming messages and but it doesn't throw any exception. As the consumer
has already lost the connection so there is no way it can consume more
messages from queues. I don't understand why a consumer is not halting whole
process if it has lost the connection ? is there a way to do that ?


Thanks,
Readdy


   




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-s-internally-being-closed-tp27307.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From reddylast at gmail.com  Mon Jun 10 15:07:05 2013
From: reddylast at gmail.com (reddylast)
Date: Mon, 10 Jun 2013 07:07:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection(s) internally being closed !
In-Reply-To: <1370863812380-27307.post@n5.nabble.com>
References: <1370863812380-27307.post@n5.nabble.com>
Message-ID: <1370873225177-27308.post@n5.nabble.com>

Guys, does anyone know about this (above) ? If connection is internally
closed (because of rmq server restart) then why consumer is waiting for
messages to consume ? Is there anyway to stop script from waiting....

Thanks
Reddy



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-s-internally-being-closed-tp27307p27308.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Jun 10 15:15:37 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Jun 2013 15:15:37 +0100
Subject: [rabbitmq-discuss] Restart Cluster after crash
In-Reply-To: <e4e37a80-c286-4c24-bf63-0916eaf8b3ec@googlegroups.com>
References: <e4e37a80-c286-4c24-bf63-0916eaf8b3ec@googlegroups.com>
Message-ID: <51B5DF89.2000106@rabbitmq.com>

On 10/06/13 06:32, Brendan Fry wrote:
> During earlier testing we were able to take down any and all of the
> nodes with a Windows restart and the cluster would recover. Though,
> after the unexpected crash that brought down the entire cluster the
> rabbit services will no longer start.
>
> We receive the following error:
>
>     /C:\Program Files (x86)\RabbitMQ
>     Server\rabbitmq_server-3.1.0\sbin>rabbitmq-server.bat/
>     /
>     /
>     /              RabbitMQ 3.1.0. Copyright (C) 2007-2013 VMware, Inc./
>     /  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com//
>     /  ##  ##/
>     /  ##########  Logs: C:/RabbitMQ/log/rabbit at OTLABWEB02.log/
>     /  ######  ##        C:/RabbitMQ/log/rabbit at OTLABWEB02-sasl.log/
>     /  ##########/
>     /              Starting broker.../
>     /
>     /
>     /BOOT FAILED/
>     /===========/
>     /Timeout contacting cluster nodes:
>     [rabbit at OTLABWEB05,rabbit at OTLABWEB04,/
>     /
>       rabbit at OTLABWEB03,rabbit at OTLABWEB01,/
>     /
>       rabbit at OTLABAPP06,rabbit at OTLABAPP05]./

Hi. When starting a cluster from scratch, RabbitMQ will want the last 
node stopped to be the first node started (since the last node stopped 
may have seen changes that no other node saw).

So if your nodes were shut down correctly then you would just need to 
make sure you start the last node first (after that you can start them 
in any order). Starting any other node first will lead to an error 
message similar to the one you posted.

However, if all nodes were shut down abruptly and simultaneously then 
they can all decide that they were not the last one to shut down and 
display this error. In that case, make sure you start all the nodes 
simultaneously (well, within the 30 second timeout anyway).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From tilak.chauhan at ymail.com  Mon Jun 10 15:16:55 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Mon, 10 Jun 2013 07:16:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <CAMcAHLV8hzfGNpfY5akkz2U=ae00RYRpwa-mzY0Gc2jysPoB=g@mail.gmail.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
	<1370600022350-27271.post@n5.nabble.com>
	<CAMcAHLV8hzfGNpfY5akkz2U=ae00RYRpwa-mzY0Gc2jysPoB=g@mail.gmail.com>
Message-ID: <1370873815781-27309.post@n5.nabble.com>

Hi Alvaro,

/<< 2) The "tnc" version of the library is not maintained anymore since 2
years already. There are many bug fixes in this version of the library:
https://github.com/videlalvaro/php-amqplib//

I tried to install https://github.com/videlalvaro/php-amqplib library
following all the instruction given there. But when I'm trying run demo
scripts then I'm getting following error :

/
PHP Fatal error:  Class 'PhpAmqpLib\Connection\AMQPConnection' not
found..../

Any idea what could be the possible issue ?


Thanks
T.luck










--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265p27309.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Jun 10 15:19:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Jun 2013 15:19:22 +0100
Subject: [rabbitmq-discuss] 3.1.1 - Errors during failover
In-Reply-To: <03CFB894A02BE24885082C694F789A7B13E0FC6D@PERMLS03.zettaserve.com>
References: <03CFB894A02BE24885082C694F789A7B13E0FC6D@PERMLS03.zettaserve.com>
Message-ID: <51B5E06A.4030900@rabbitmq.com>

Hi thanks. This is definitely an odd looking error, can you tell us mre 
about what you're doing? Are you just starting / stopping nodes, or is 
there messaging activity going on at the same time (and if so, what?)

Cheers, Simon

On 10/06/13 11:32, Rensen, Nathanael wrote:
> I've attached the sasl log from mq-002. Sorry I didn't include that originally.
>
> Thanks for taking a look.
>
> Nathanael
>
>
> Simon MacMullen wrote:
>
> Hi. Looking at the logs it seems like the message store on mq-002 crashed / shut down unexpectedly, but there's no information about this in the log. Do you have the corresponding sasl log?
>
> Cheers, Simon
>
>
> On 09/06/13 06:03, Rensen, Nathanael wrote:
> While testing a fail-over scenario with RabbitMQ 3.1.1 I have repeatedly encountered errors, sometimes resulting in durable queues vanishing.
>
> The cluster consists of two brokers using LVS / keepalived in order to connect clients to a functional broker. There are 10 mirrored queues, each of which has ha-sync-mode = automatic. A script is used to shut down one broker or the other in turn using 'service rabbitmq-server {start|stop}', such that there is always one broker running and leaving at least 30 seconds between each start / stop. I am expecting that this test should be able to run indefinitely without destabilising the cluster, however I have not been able to achieve more than a few dozen fail-overs without some error occurring. I'm hoping someone may have some insight or suggestions as to how to stabilise this environment.
>
> I have included basic environment details below and attached logs from both brokers showing one example. In this case zg-dev-mq-003 was stopped at 11:32:21 and went through what appears to be a clean shutdown:
>
> =INFO REPORT==== 9-Jun-2013::11:33:22 === Halting Erlang VM
>
> zg-dev-mq-002 detected the other broker down and promoted itself to master. Then after accepting connections from clients it logged an error as shown below:
>
> =INFO REPORT==== 9-Jun-2013::11:33:22 === rabbit on node 'rabbit at zg-dev-mq-003' down
> =INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.427.0> (10.0.72.36:61434 -> 172.17.0.73:5672)
> =INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.430.0> (10.0.72.36:61435 -> 172.17.0.73:5672)
> =ERROR REPORT==== 9-Jun-2013::11:33:22 ===
> ** Generic server <0.418.0> terminating
> ** Last message in was {'$gen_cast',
>                           {delete_and_terminate,
>                            {badarg,
>                             [{ets,insert_new,
>                               [360523,
>                                {{<<10,71,177,42,66,240,207,204,251,26,181,155,
>                                    246,83,172,137>>,
>                                  <<120,196,170,245,109,158,126,84,92,250,21,193,
>                                    123,113,128,48>>},
>                                 -1}],
>                               []},
>                              {rabbit_msg_store,client_update_flying,3,[]},
>                              {rabbit_msg_store,'-remove/2-lc$^0/1-0-',2,[]},
>                              {rabbit_msg_store,remove,2,[]},
>                              {rabbit_variable_queue,
>                               '-with_immutable_msg_store_state/3-fun-0-',2,[]},
>                              {rabbit_variable_queue,with_msg_store_state,3,[]},
>                              {rabbit_variable_queue,
>                               with_immutable_msg_store_state,3,[]},
>                              {rabbit_variable_queue,'-ack/2-lc$^0/1-0-',2,
>                               []}]}}}
> etc
>
> Environment details (same for both brokers):
>
> [root at zg-dev-mq-002]# uname -a
> Linux zg-dev-mq-002.zettagrid.local 2.6.32-358.2.1.el6.x86_64 #1 SMP Wed Mar 13 00:26:49 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
>
> [root at zg-dev-mq-002]# cat /etc/centos-release
> CentOS release 6.4 (Final)
>
> [root at zg-dev-mq-002]# yum list installed | egrep 'rabbit|erlang'
> esl-erlang.x86_64      R16B-2           @/esl-erlang-R16B-2.x86_64
> esl-erlang-compat.noarch      R14B-1.el6       @/esl-erlang-compat-R14B-1.el6.noarch
> rabbitmq-server.noarch 3.1.1-1          @/rabbitmq-server-3.1.1-1.noarch
>
> Thanks very much,
>
> Nathanael
>
> ________________________________
>
> ZettaServe Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately if you have received this email by mistake and delete this email from your system. Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. ZettaServe Pty Ltd accepts no liability for any damage caused by any virus transmitted by this email.
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From watson.timothy at gmail.com  Mon Jun 10 15:27:22 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 10 Jun 2013 15:27:22 +0100
Subject: [rabbitmq-discuss] Connection(s) internally being closed !
In-Reply-To: <1370863812380-27307.post@n5.nabble.com>
References: <1370863812380-27307.post@n5.nabble.com>
Message-ID: <CA52E7E5-9F58-4A7E-864E-323320FB8C6C@rabbitmq.com>

It can take "quite a while" for the operati system to notice that a peer socket has disappeared. Consider turning on AMQP heartbeats to alleviate this delay somewhat.

Cheers,
Tim

On 10 Jun 2013, at 12:30, reddylast <reddylast at gmail.com> wrote:

> Hi,
> 
> If a consumer is consuming messages from a queue and suddenly someone
> restarts rabbitmq sever (or internal network fails) then consumer stops
> consuming messages and but it doesn't throw any exception. As the consumer
> has already lost the connection so there is no way it can consume more
> messages from queues. I don't understand why a consumer is not halting whole
> process if it has lost the connection ? is there a way to do that ?
> 
> 
> Thanks,
> Readdy
> 
> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-s-internally-being-closed-tp27307.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From nathanael.rensen at zetta.com.au  Mon Jun 10 16:26:27 2013
From: nathanael.rensen at zetta.com.au (Rensen, Nathanael)
Date: Mon, 10 Jun 2013 15:26:27 +0000
Subject: [rabbitmq-discuss] 3.1.1 - Errors during failover
In-Reply-To: <CAHd5nyz1E-AP3cxGbeOo=DK4iEpuqOU_6RqENqsOZmVxtqLZfA@mail.gmail.com>
References: <03CFB894A02BE24885082C694F789A7B13E0FC6D@PERMLS03.zettaserve.com>
	<51B5E06A.4030900@rabbitmq.com>
	<CAHd5nyz1E-AP3cxGbeOo=DK4iEpuqOU_6RqENqsOZmVxtqLZfA@mail.gmail.com>
Message-ID: <03CFB894A02BE24885082C694F789A7B13E0FF0C@PERMLS03.zettaserve.com>

Thanks for taking the time to look at those logs.

The purpose of the test is to confirm that the client application, server application, LVS and RMQ itself all perform properly during fail-over. There is certainly messaging activity during the test, although relatively modest by RMQ standards judging from the rates I see discussed on this forum.

Of the 10 queues, three queues were operating with a combined average rate of around 200 messages per second from client app to server app. The publish rate will burst to instantaneous peaks possibly exceeding 500 messages per second for a short time. A fourth queue is returning responses from server app to client app at somewhere around 300 to 400 messages per second. A fifth queue is used for application heartbeats from server to client at around 1 message every 2 seconds. The remaining 5 queues were idle during the test. The messages are in the range of hundreds of bytes to a couple of kilobytes. Each message has a per-message TTL configured - 10 seconds for the application heartbeats, 90 seconds otherwise.
--
When either client or server application detects a channel / connection shutdown it enters a reconnect cycle making two attempts to connect each second until it is able to re-establish connection and resume operation. Each application uses a single RMQ connection for consume and publish. All publishing happens on a single channel per app using publisher confirms.

I am able to reliably reproduce an error of some kind by running the test for long enough (a couple of dozen fail-overs is typically enough, although sometimes fewer than 10). I haven't paid sufficiently close attention to be able to say whether the error is always the same. However the symptoms are not always exactly the same. Usually after an error has occurred one or other broker will refuse to shutdown gracefully. Sometimes queues vanish and I will have to reconfigure them.

In order to gather a clean sample for the logs I posted I deleted /var/lib/rabbitmq/mnesia and reconfigured the cluster and queues from scratch. I then rebooted the nodes to ensure a clean starting point.

Thanks again,

Nathanael


Simon MacMullen wrote:

Hi thanks. This is definitely an odd looking error, can you tell us mre about what you're doing? Are you just starting / stopping nodes, or is there messaging activity going on at the same time (and if so, what?)

Cheers, Simon


On 10/06/13 11:32, Rensen, Nathanael wrote:
I've attached the sasl log from mq-002. Sorry I didn't include that originally.

Thanks for taking a look.

Nathanael

Simon MacMullen wrote:

Hi. Looking at the logs it seems like the message store on mq-002 crashed / shut down unexpectedly, but there's no information about this in the log. Do you have the corresponding sasl log?

Cheers, Simon


On 09/06/13 06:03, Rensen, Nathanael wrote:
While testing a fail-over scenario with RabbitMQ 3.1.1 I have repeatedly encountered errors, sometimes resulting in durable queues vanishing.

The cluster consists of two brokers using LVS / keepalived in order to connect clients to a functional broker. There are 10 mirrored queues, each of which has ha-sync-mode = automatic. A script is used to shut down one broker or the other in turn using 'service rabbitmq-server {start|stop}', such that there is always one broker running and leaving at least 30 seconds between each start / stop. I am expecting that this test should be able to run indefinitely without destabilising the cluster, however I have not been able to achieve more than a few dozen fail-overs without some error occurring. I'm hoping someone may have some insight or suggestions as to how to stabilise this environment.

I have included basic environment details below and attached logs from both brokers showing one example. In this case zg-dev-mq-003 was stopped at 11:32:21 and went through what appears to be a clean shutdown:

=INFO REPORT==== 9-Jun-2013::11:33:22 === Halting Erlang VM

zg-dev-mq-002 detected the other broker down and promoted itself to master. Then after accepting connections from clients it logged an error as shown below:

=INFO REPORT==== 9-Jun-2013::11:33:22 === rabbit on node 'rabbit at zg-dev-mq-003' down
=INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.427.0> (10.0.72.36:61434 -> 172.17.0.73:5672)
=INFO REPORT==== 9-Jun-2013::11:33:22 === accepting AMQP connection <0.430.0> (10.0.72.36:61435 -> 172.17.0.73:5672)
=ERROR REPORT==== 9-Jun-2013::11:33:22 ===
** Generic server <0.418.0> terminating
** Last message in was {'$gen_cast',
                          {delete_and_terminate,
                           {badarg,
                            [{ets,insert_new,
                              [360523,
                               {{<<10,71,177,42,66,240,207,204,251,26,181,155,
                                   246,83,172,137>>,
                                 <<120,196,170,245,109,158,126,84,92,250,21,193,
                                   123,113,128,48>>},
                                -1}],
                              []},
                             {rabbit_msg_store,client_update_flying,3,[]},
                             {rabbit_msg_store,'-remove/2-lc$^0/1-0-',2,[]},
                             {rabbit_msg_store,remove,2,[]},
                             {rabbit_variable_queue,
                              '-with_immutable_msg_store_state/3-fun-0-',2,[]},
                             {rabbit_variable_queue,with_msg_store_state,3,[]},
                             {rabbit_variable_queue,
                              with_immutable_msg_store_state,3,[]},
                             {rabbit_variable_queue,'-ack/2-lc$^0/1-0-',2,
                              []}]}}}
etc

Environment details (same for both brokers):

[root at zg-dev-mq-002]# uname -a
Linux zg-dev-mq-002.zettagrid.local 2.6.32-358.2.1.el6.x86_64 #1 SMP Wed Mar 13 00:26:49 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux

[root at zg-dev-mq-002]# cat /etc/centos-release
CentOS release 6.4 (Final)

[root at zg-dev-mq-002]# yum list installed | egrep 'rabbit|erlang'
esl-erlang.x86_64      R16B-2           @/esl-erlang-R16B-2.x86_64
esl-erlang-compat.noarch      R14B-1.el6       @/esl-erlang-compat-R14B-1.el6.noarch
rabbitmq-server.noarch 3.1.1-1          @/rabbitmq-server-3.1.1-1.noarch

Thanks very much,

Nathanael

________________________________

ZettaServe Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately if you have received this email by mistake and delete this email from your system. Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. ZettaServe Pty Ltd accepts no liability for any damage caused by any virus transmitted by this email.


From emile at rabbitmq.com  Mon Jun 10 16:29:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 10 Jun 2013 16:29:40 +0100
Subject: [rabbitmq-discuss] How to identify connection?
In-Reply-To: <CANV4tdVvtpdGR==YDhoZ_jac4PP0hY8uyRWaavNFx=sz2+JKbw@mail.gmail.com>
References: <ce281d24-55f6-40c4-9cbb-55edba0fd884@googlegroups.com>
	<51B192D3.7020506@rabbitmq.com>
	<CANV4tdVvtpdGR==YDhoZ_jac4PP0hY8uyRWaavNFx=sz2+JKbw@mail.gmail.com>
Message-ID: <51B5F0E4.4070608@rabbitmq.com>

On 07/06/13 09:57, ????? ??????? wrote:
> I'm using RabbitMQ Management plugin to get connections,


Connections can be listed using the management plugin also. See the
/api/connections endpoint.


> i have different computers, where I start connection, I want to know,
> from which computer connection was started. For example, on computer
> I can log connection ID, and then compare it in management site.


You should be able to work that out from the IP number reported by
rabbitmqctl or the management plugin.





-Emile







From mikeb at rabbitmq.com  Mon Jun 10 16:59:45 2013
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 10 Jun 2013 16:59:45 +0100
Subject: [rabbitmq-discuss] Node.js & RabbitMQ
In-Reply-To: <CALbD4SheyhWeQGiH2i9P99Q=VN4j95C+wmnZSDc9mY02O8Q2hg@mail.gmail.com>
References: <CALbD4SheyhWeQGiH2i9P99Q=VN4j95C+wmnZSDc9mY02O8Q2hg@mail.gmail.com>
Message-ID: <51B5F7F1.7060906@rabbitmq.com>

> How do you correctly close a connection?

The official way, `connection.end`, closes the underlying socket. This 
means no more bytes hither or thither, so you'll want to make sure 
everything you wanted done has been done first; this is the main purpose 
of the amqp_hacks.safeCloseConnection from the tutorials.

> Why is my exchange not being created?

What exactly is the problem you're seeing? If I take the code below, 
stick it in a file, and run it, it runs to completion and logs all the 
given output; further, I can see the exchange in the management web UI, 
which also registers the message going through as a blip in the message 
rate.

```
var amqp = require('amqp');
var RABBITMQ_URL = 'amqp://localhost';

var connection = amqp.createConnection({url: RABBITMQ_URL});

connection.on('ready', function(){
   console.log("Connection established");
   connection.exchange('cloudrouter', {"type": "direct"}, 
function(exchange){
     console.log("Exchange created");
     exchange.publish('',"Hello World");
     console.log(" [x] Sent Hello World");
     connection.end();
   });
});
```

If you run the code in a REPL line-by-line, by the way, it will likely 
*not* execute the ready event handler (so nothing will happen). By the 
time the prompt returns for the next line, all the I/O is done and that 
one-off event has fired.

-Michael

> var connection = amqp.createConnection({url: RABBITMQ_URL});
>
> connection.on('ready', function(){
> //console.log("Connection established");
> connection.exchange('cloudrouter', {"type": "direct"}, function(exchange){
> console.log("Exchange created");
> console.log("Another Message");
> //exchange.publish('',"Hellow World");
> //console.log(" [x] Sent Hello World");
> //amqp_hacks.safeEndConnection(connection);
> });
> });
>
>
>
> --
> Warmest Regards,
>
> *Josh Birdwell*
> STEM Advocate
> Oklahoma City, Oklahoma
> Mobile: (405) 388-0176
> <http://www.twitter.com/jbirdwell34>
> <http://www.facebook.com/rfidedgellc>
> <http://www.linkedin.com/in/joshbirdwell> <http://www.rfidedge.org>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From vikram.vis at gmail.com  Mon Jun 10 17:06:44 2013
From: vikram.vis at gmail.com (Vikram Viswanathan)
Date: Mon, 10 Jun 2013 09:06:44 -0700
Subject: [rabbitmq-discuss] Is there a way to receive multiple message
 using a single synchronous call ?
In-Reply-To: <51B5A4EC.4000203@rabbitmq.com>
References: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
	<5190BF33.1010902@rabbitmq.com>
	<1369255851048-26944.post@n5.nabble.com>
	<519E33A3.9010700@rabbitmq.com> <51B3D92B.5090803@gmail.com>
	<51B5A4EC.4000203@rabbitmq.com>
Message-ID: <51B5F994.5000100@gmail.com>


Thanks.

I have another question. If I use basic.consume, register a callback, 
then is there a way where I can can cancel the consumer after N message 
is received ?

I tried calling Channel.basicCancel(consumerTag) in the callback, but 
this cancels the consumer only after all messages in the queue is 
received. I understand that its difficult to cancel the consumer on its 
own callback, but if cancel the consumer in another thread then I afraid 
I will run into a bunch race conditions and I will not be able to get 
exactly the number of messages I want.

I am looking into this because I am implementing http long polling in 
server and the http requests are translated into ampq call to rabbitmq 
server. I do not want to make basic.get() with a timeout because this 
will cause my thread to block for the duration and cause scalability issue.

-Vikram


On 06/10/2013 03:05 AM, Simon MacMullen wrote:
> On 09/06/13 02:23, Vikram Viswanathan wrote:
>> When I know that there are N messages( N could be a small value less
>> than 10) in the queue, then I should be able to do something like
>> channel.basic_get(String queue, boolean autoAck , int numberofMsg ). I
>> don't want to make multiple requests to the server and  I don't want to
>> register a handler to receive messages.
>>
>> Is there a way ?
>
> I'm afraid not, you can either receive one message with basic.get or 
> multiple with basic.consume.
>
> Cheers, Simon
>
>


From stuff at moesel.net  Mon Jun 10 19:49:46 2013
From: stuff at moesel.net (Chris)
Date: Mon, 10 Jun 2013 14:49:46 -0400
Subject: [rabbitmq-discuss] "Zombie" RabbitMQ Processes
Message-ID: <CAHEpgBCdhOESzqZP9NKow9n2nKd_ps9sjEt4pHu=-9h_RLkrQA@mail.gmail.com>

Hi All,

I've received a few reports that when RabbitMQ 3.1.1 is first installed on
our RedHat servers (along with some of our other software and scripts),
sometimes it is unresponsive and you cannot restart  the process via the
service script.

The only way out seems to be something like "killall -u rabbitmq -9"
followed by "service rabbitmq start".

I don't see anything terribly distressing in the RabbitMQ logs, although I
do see lots of instances of:

=INFO REPORT==== 10-Jun-2013::21:21:02 ===
> accepting AMQP connection <0.30685.4> (172.23.197.126:45515 ->
> 172.23.197.126:5672)
>
> =WARNING REPORT==== 10-Jun-2013::21:21:02 ===
> closing AMQP connection <0.30685.4> (172.23.197.126:45515 ->
> 172.23.197.126:5672):
> connection_closed_abruptly


A few questions for you:

(1) Is there any way we can troubleshoot this further than just looking at
the logs in /var/log/rabbitmq?

(2) Should we be concerned about the connection_closed_abruptly warnings?
 Currenlty we connect to RabbitMQ using node-amqp and the Java client.  I *
think* we usually should be closing the connection on exit.

(3)  Can anyone suggest how we might be getting into this state?  Might it
be possible if we started RabbitMQ in a script and somehow killed it or
restarted it before it was finished initializing (just guessing here)?  So
far I cannot reproduce it, but we've had several reports of it.

Thanks!
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130610/e24ace95/attachment.htm>

From jay.danziger at fantex.com  Tue Jun 11 01:53:43 2013
From: jay.danziger at fantex.com (JayD)
Date: Mon, 10 Jun 2013 17:53:43 -0700 (PDT)
Subject: [rabbitmq-discuss] RPC response/reply for RabbitMQ - Timeouts
Message-ID: <49cec8df-9245-4db8-8cff-c9c2ca5da044@googlegroups.com>

All information is old that I have seen on this.  Is there yet a way to 
define a client side timeout on an rpc style call.  I find it hard to 
believe that one would have to leave the request hanging if the server is 
not up and running.

Does anyone have a good solution for this at this point in time?  On the 
client side I am using pika.

Any help would be greatly appreciated.

Jay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130610/b2f71834/attachment.htm>

From Justin.Plock at ge.com  Tue Jun 11 03:30:14 2013
From: Justin.Plock at ge.com (Plock, Justin (GE Corporate))
Date: Tue, 11 Jun 2013 02:30:14 +0000
Subject: [rabbitmq-discuss] Mirrored Queues Disappearing
Message-ID: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>

Here's our scenario:

We run a 3 node RabbitMQ cluster (version 3.1.1) on 3 separate virtual machines.  All of our queues/exchanges are set to durable.  We have a policy called "HA" set up with the pattern of "^(?!amq\.).*" that as ha-mode: all and ha-sync-mode: automatic.  We have "cluster_partition_handling" set to "pause_minority".  Every time we experience a network partition, which seems to more often than it should, after forcefully killing RabbitMQ and restarting it, we also have to rebuild our missing queues and exchange bindings.  The virtual hosts, users and exchanges seems to be preserved, but we often lose a lot of our queues.

Is there anything we can do to prevent this?

Thanks.

-Justin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3377 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/ce2056fd/attachment.bin>

From vmadhipatla at hotmail.com  Tue Jun 11 03:47:48 2013
From: vmadhipatla at hotmail.com (vmadhipatla)
Date: Mon, 10 Jun 2013 19:47:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Saving login information in check_user_login
Message-ID: <1370918868850-27319.post@n5.nabble.com>

Hi

Clients making connection to rabbitmq pass jasig CAS service ticket(Clients
authenticate through CAS and fetch the service ticket) as user name. We
wrote a authentication plugin and in check_user_login, we validate the
service ticket and find out the user name. We want this user name to be set
as part of the connection so that It can come back in the call to
check_vhost_access and check_resource_access. How to do this?
We want to make some authorization checks based on the actual user name
figured out in check_user_login in the check_resource_access. Any idea how
this can be done? We basically wants to save something in check_user_login
that needs to get passed back in check_resource_access when it gets called
during publish/subscribe. 

Thanks
Venkat



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Saving-login-information-in-check-user-login-tp27319.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tilak.chauhan at ymail.com  Tue Jun 11 09:50:19 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Tue, 11 Jun 2013 01:50:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <1370873815781-27309.post@n5.nabble.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
	<1370600022350-27271.post@n5.nabble.com>
	<CAMcAHLV8hzfGNpfY5akkz2U=ae00RYRpwa-mzY0Gc2jysPoB=g@mail.gmail.com>
	<1370873815781-27309.post@n5.nabble.com>
Message-ID: <1370940619703-27321.post@n5.nabble.com>

Guys,

any idea why I'm getting this error :

PHP Fatal error:  Class 'PhpAmqpLib\Connection\AMQPConnection' not found....

I tried this library with different php versions (5.3 +, I thought may be
namespace is problem) but couldn't make it working.

If anyone ever faced same issue ?

Thanks
T.luck







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265p27321.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Tue Jun 11 10:07:48 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 11 Jun 2013 13:07:48 +0400
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <1370940619703-27321.post@n5.nabble.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
	<1370600022350-27271.post@n5.nabble.com>
	<CAMcAHLV8hzfGNpfY5akkz2U=ae00RYRpwa-mzY0Gc2jysPoB=g@mail.gmail.com>
	<1370873815781-27309.post@n5.nabble.com>
	<1370940619703-27321.post@n5.nabble.com>
Message-ID: <CAE3HoVQ+4GhyGZkOmsymZntSZkzq-=3SXKxSxTxd=vfSY+n6sg@mail.gmail.com>

2013/6/11 tluck <tilak.chauhan at ymail.com>

> PHP Fatal error:  Class 'PhpAmqpLib\Connection\AMQPConnection' not found
>

Is there a longer stack trace? Can you please post it?


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/2bafe26c/attachment.htm>

From reddylast at gmail.com  Tue Jun 11 10:32:42 2013
From: reddylast at gmail.com (reddylast at gmail.com)
Date: Tue, 11 Jun 2013 02:32:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer never stops listening to queue
Message-ID: <71acf5dd-a20c-4d18-825f-35ad4c37ceb4@googlegroups.com>

Hi,

When a consumer is consuming messages from a queue and if suddenly I 
restart rabbitmq server (or system got some technical problem)  then the 
consumer stops to consume messages from queue (because it got disconnected)
  but it keep listening to the queue. In this way my consumer script keep 
running in background without doing anything. In such circumstances (where 
consumer got disconnected internally) consumer script  should get an 
exception or should stop running immediately because there is no benefit of 
it (as it doesn't get auto connected)..

Does anyone know how to get over this problem ? 

Thanks
Reddy 



   



 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/7b537c7a/attachment.htm>

From tim at rabbitmq.com  Tue Jun 11 10:35:42 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 11 Jun 2013 10:35:42 +0100
Subject: [rabbitmq-discuss] Consumer never stops listening to queue
In-Reply-To: <71acf5dd-a20c-4d18-825f-35ad4c37ceb4@googlegroups.com>
References: <71acf5dd-a20c-4d18-825f-35ad4c37ceb4@googlegroups.com>
Message-ID: <8A438F97-4D8F-40CF-B4A2-0F2EE1BD04F4@rabbitmq.com>

On 11 Jun 2013, at 10:32, reddylast at gmail.com wrote:
> Hi,
> 
> When a consumer is consuming messages from a queue and if suddenly I restart rabbitmq server (or system got some technical problem)  then the consumer stops to consume messages from queue (because it got disconnected)  but it keep listening to the queue. In this way my consumer script keep running in background without doing anything. In such circumstances (where consumer got disconnected internally) consumer script  should get an exception or should stop running immediately because there is no benefit of it (as it doesn't get auto connected)..
> 
> Does anyone know how to get over this problem ? 
> 

Turn on AMQP heartbeats.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/495f77ce/attachment.htm>

From simon at rabbitmq.com  Tue Jun 11 10:54:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Jun 2013 10:54:14 +0100
Subject: [rabbitmq-discuss] Mirrored Queues Disappearing
In-Reply-To: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>
References: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>
Message-ID: <51B6F3C6.1010706@rabbitmq.com>

Can you post some logs from around the time the queues disappear?

Cheers, Simon

On 11/06/13 03:30, Plock, Justin (GE Corporate) wrote:
> Here's our scenario:
>
> We run a 3 node RabbitMQ cluster (version 3.1.1) on 3 separate virtual machines.  All of our queues/exchanges are set to durable.  We have a policy called "HA" set up with the pattern of "^(?!amq\.).*" that as ha-mode: all and ha-sync-mode: automatic.  We have "cluster_partition_handling" set to "pause_minority".  Every time we experience a network partition, which seems to more often than it should, after forcefully killing RabbitMQ and restarting it, we also have to rebuild our missing queues and exchange bindings.  The virtual hosts, users and exchanges seems to be preserved, but we often lose a lot of our queues.
>
> Is there anything we can do to prevent this?
>
> Thanks.
>
> -Justin
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jun 11 10:59:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Jun 2013 10:59:46 +0100
Subject: [rabbitmq-discuss] Saving login information in check_user_login
In-Reply-To: <1370918868850-27319.post@n5.nabble.com>
References: <1370918868850-27319.post@n5.nabble.com>
Message-ID: <51B6F512.4030907@rabbitmq.com>

Sure, when you return a #user{} record from check_user_login the 
record's "impl" field is for your plugin's use - it will be preserved 
and handed back to you in check_vhost_access and check_resource_access.

Cheers, Simon

On 11/06/13 03:47, vmadhipatla wrote:
> Hi
>
> Clients making connection to rabbitmq pass jasig CAS service ticket(Clients
> authenticate through CAS and fetch the service ticket) as user name. We
> wrote a authentication plugin and in check_user_login, we validate the
> service ticket and find out the user name. We want this user name to be set
> as part of the connection so that It can come back in the call to
> check_vhost_access and check_resource_access. How to do this?
> We want to make some authorization checks based on the actual user name
> figured out in check_user_login in the check_resource_access. Any idea how
> this can be done? We basically wants to save something in check_user_login
> that needs to get passed back in check_resource_access when it gets called
> during publish/subscribe.
>
> Thanks
> Venkat
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Saving-login-information-in-check-user-login-tp27319.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Tue Jun 11 11:07:06 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 11 Jun 2013 11:07:06 +0100
Subject: [rabbitmq-discuss] "Zombie" RabbitMQ Processes
In-Reply-To: <CAHEpgBCdhOESzqZP9NKow9n2nKd_ps9sjEt4pHu=-9h_RLkrQA@mail.gmail.com>
References: <CAHEpgBCdhOESzqZP9NKow9n2nKd_ps9sjEt4pHu=-9h_RLkrQA@mail.gmail.com>
Message-ID: <51B6F6CA.9030500@rabbitmq.com>

Hi Chris,


On 10/06/13 19:49, Chris wrote:
> (1) Is there any way we can troubleshoot this further than just looking
> at the logs in /var/log/rabbitmq?


Check whether "rabbitmqctl report" works. Inspect the whole logfile, and
check the sasl logfile too. It is exceedingly rare for the broker to
crash or become unresponsive in a way that does not leave some evidence
behind. Check your OS logfile also.


> (2) Should we be concerned about the connection_closed_abruptly
> warnings?  Currenlty we connect to RabbitMQ using node-amqp and the Java
> client.  I /think/ we usually should be closing the connection on exit.


No, that is normally innocuous. You can turn the logging for that off
with the log_levels configuration option.


> (3)  Can anyone suggest how we might be getting into this state?  Might
> it be possible if we started RabbitMQ in a script and somehow killed it
> or restarted it before it was finished initializing (just guessing
> here)?  So far I cannot reproduce it, but we've had several reports of it.


It is hard to venture guesses without knowing what's wrong. A broker
that has run out of disk or memory can appear to be stuck. A very busy
broker can appear unresponsive. Some network problems can cause a broker
to appear stuck also.




-Emile






From simon at rabbitmq.com  Tue Jun 11 11:12:33 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Jun 2013 11:12:33 +0100
Subject: [rabbitmq-discuss] "Zombie" RabbitMQ Processes
In-Reply-To: <51B6F6CA.9030500@rabbitmq.com>
References: <CAHEpgBCdhOESzqZP9NKow9n2nKd_ps9sjEt4pHu=-9h_RLkrQA@mail.gmail.com>
	<51B6F6CA.9030500@rabbitmq.com>
Message-ID: <51B6F811.5090603@rabbitmq.com>

On 11/06/13 11:07, Emile Joubert wrote:
>> >(2) Should we be concerned about the connection_closed_abruptly
>> >warnings?  Currenlty we connect to RabbitMQ using node-amqp and the Java
>> >client.  I/think/  we usually should be closing the connection on exit.
>
> No, that is normally innocuous. You can turn the logging for that off
> with the log_levels configuration option.

To add to this: this warning is logged when a client disconnects without 
going through the AMQP connection-closing handshake. Really you should 
only see it if the network suddenly goes down, but some clients (I 
suspect node-amqp in your instance) just drop the connection whenever 
they are done.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jun 11 11:57:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Jun 2013 11:57:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ sharding supprot
In-Reply-To: <CAMWFgdizEphHvxR4Og-rNgBO5_eTNdshqXxbs85NwP_XFZfSVg@mail.gmail.com>
References: <a5a8acb6-b024-49df-95f1-97ecd8e764a8@googlegroups.com>
	<51B59CDA.1030909@rabbitmq.com>
	<CAMWFgdizEphHvxR4Og-rNgBO5_eTNdshqXxbs85NwP_XFZfSVg@mail.gmail.com>
Message-ID: <51B70294.1020205@rabbitmq.com>

It already is: http://www.rabbitmq.com/plugins.html

You just need to enable it with

   rabbitmq-plugins enable rabbitmq_consistent_hash_exchange

Cheers, Simon

On 11/06/13 11:54, Yair Ogen wrote:
> this looks great. will it make into rabbitmq as part of the product?
>
>
> On Mon, Jun 10, 2013 at 12:31 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 10/06/13 06:59, Yair Ogen wrote:
>
>         Does rabbitmq support any kind of sharding or message
>         distribution based
>         on a known key?
>
>
>     See the Consistent Hash Exchange:
>     https://github.com/rabbitmq/__rabbitmq-consistent-hash-__exchange
>     <https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange>
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From Justin.Plock at ge.com  Tue Jun 11 13:15:55 2013
From: Justin.Plock at ge.com (Plock, Justin (GE Corporate))
Date: Tue, 11 Jun 2013 12:15:55 +0000
Subject: [rabbitmq-discuss] Mirrored Queues Disappearing
In-Reply-To: <51B6F3C6.1010706@rabbitmq.com>
References: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>
	<51B6F3C6.1010706@rabbitmq.com>
Message-ID: <1137E219-F035-4359-8502-9C197B7160DD@ge.com>

Hi Simon,
  Here are logs from two of the machines around that time.  We're having authentication issues around the 3rd machine so I can't get the logs at this time.

https://gist.github.com/jplock/e373c6008a4ac415baef

Thanks.

-Justin


On Jun 11, 2013, at 5:54 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Can you post some logs from around the time the queues disappear?
> 
> Cheers, Simon
> 
> On 11/06/13 03:30, Plock, Justin (GE Corporate) wrote:
>> Here's our scenario:
>> 
>> We run a 3 node RabbitMQ cluster (version 3.1.1) on 3 separate virtual machines.  All of our queues/exchanges are set to durable.  We have a policy called "HA" set up with the pattern of "^(?!amq\.).*" that as ha-mode: all and ha-sync-mode: automatic.  We have "cluster_partition_handling" set to "pause_minority".  Every time we experience a network partition, which seems to more often than it should, after forcefully killing RabbitMQ and restarting it, we also have to rebuild our missing queues and exchange bindings.  The virtual hosts, users and exchanges seems to be preserved, but we often lose a lot of our queues.
>> 
>> Is there anything we can do to prevent this?
>> 
>> Thanks.
>> 
>> -Justin
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3377 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/680f4daa/attachment.bin>

From emile at rabbitmq.com  Tue Jun 11 14:09:20 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 11 Jun 2013 14:09:20 +0100
Subject: [rabbitmq-discuss] Mirrored Queues Disappearing
In-Reply-To: <1137E219-F035-4359-8502-9C197B7160DD@ge.com>
References: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>
	<51B6F3C6.1010706@rabbitmq.com>
	<1137E219-F035-4359-8502-9C197B7160DD@ge.com>
Message-ID: <51B72180.5020308@rabbitmq.com>


Hi,

On 11/06/13 13:15, Plock, Justin (GE Corporate) wrote:
>   Here are logs from two of the machines around that time


Thanks for making these available. This confirms that at least one queue
has crashed, but it doesn't indicate the reason. Are there any earlier
log entries than the ones posted? Is there anything of interest in the
regular (not sasl) logs?



-Emile






From Justin.Plock at ge.com  Tue Jun 11 15:02:39 2013
From: Justin.Plock at ge.com (Plock, Justin (GE Corporate))
Date: Tue, 11 Jun 2013 14:02:39 +0000
Subject: [rabbitmq-discuss] Mirrored Queues Disappearing
In-Reply-To: <51B72180.5020308@rabbitmq.com>
References: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>
	<51B6F3C6.1010706@rabbitmq.com>
	<1137E219-F035-4359-8502-9C197B7160DD@ge.com>
	<51B72180.5020308@rabbitmq.com>
Message-ID: <6BCB62FC-3640-42D5-8112-F46FEE1FB735@ge.com>

Unfortunately there seems to be a gap in our logging, maybe related to the issue.

rabbit at alpcismq822v.log
- from 11-Jun-2013::03:02:52
- to 11-Jun-2013::08:58:55 (now)

rabbit at alpcismq822v.log.1
- from 2-Jun-2013::03:02:52
- to 9-Jun-2013::03:02:06

Could a network partition may have caused this?  I guess I have two main questions:

1.) If my queues/exchange are set to HA, why do they continually get lost during network partitions?
2.) Would using autoheal handle this scenario better?

Thanks for your help.

-Justin


On Jun 11, 2013, at 9:09 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> 
> Hi,
> 
> On 11/06/13 13:15, Plock, Justin (GE Corporate) wrote:
>>  Here are logs from two of the machines around that time
> 
> 
> Thanks for making these available. This confirms that at least one queue
> has crashed, but it doesn't indicate the reason. Are there any earlier
> log entries than the ones posted? Is there anything of interest in the
> regular (not sasl) logs?
> 
> 
> 
> -Emile
> 
> 
> 
> 
> 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3377 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/e55761aa/attachment.bin>

From eoinmccarthy at fastmail.fm  Mon Jun 10 19:21:33 2013
From: eoinmccarthy at fastmail.fm (Eoin McCarthy)
Date: Mon, 10 Jun 2013 11:21:33 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ publisher confirms using the Erlang
	client
Message-ID: <95b7e3cf-4913-47e6-a3e1-9a503b92fafc@googlegroups.com>

Hi, 

Not sure if this is the best place to ask for help - but it's the forum 
mentioned on the Rabbit webpage - so I figured I'd give it a go. 

I'm a Rabbit newbie and using Erlang (which is also fairly new for me) to 
write my clients. That aside, my publisher code is writing messages to the 
specified queue. 
I can see the messages arriving in the queue via the Rabbit management 
console and an Erlang-based consumer is also picking up the messages are 
they arrive in the queue.  

However, I don't seem to be able to get publisher confirms working. I 
registered a confirm handler callback process and it's rigged to forward a 
message back to the parent process when it receives anything.
Gist is here: https://gist.github.com/eoinmc/5750876
It's not a real-world example - I'm just trying to figure out how to 
activate and see a publisher confirm using the Erlang client. So far with 
no success. 
The client docs are here: 
http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v3.0.4/doc/

Any suggestions (including pointing out of obvious mistakes) appreciated. 

Eoin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130610/744c90fc/attachment.htm>

From emile at rabbitmq.com  Tue Jun 11 15:35:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 11 Jun 2013 15:35:30 +0100
Subject: [rabbitmq-discuss] Mirrored Queues Disappearing
In-Reply-To: <6BCB62FC-3640-42D5-8112-F46FEE1FB735@ge.com>
References: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>
	<51B6F3C6.1010706@rabbitmq.com>
	<1137E219-F035-4359-8502-9C197B7160DD@ge.com>
	<51B72180.5020308@rabbitmq.com>
	<6BCB62FC-3640-42D5-8112-F46FEE1FB735@ge.com>
Message-ID: <51B735B2.4020803@rabbitmq.com>


Hi,

On 11/06/13 15:02, Plock, Justin (GE Corporate) wrote:
> Could a network partition may have caused this?  I guess I have two main questions:

It is possible that a partition could cause less logging on some nodes
and that could end up looking like a gap. Access to the logs may help,
even if there is a gap.

> 1.) If my queues/exchange are set to HA, why do they continually get lost during network partitions?

That shouldn't happen. From the sasl logfiles provided it is clear that
you are dealing with the effects of a bug. We are trying to replicate
the bug, and access to the logfiles will probably help. Please feel free
to contact me directly to arrange transfer, if that will help.

> 2.) Would using autoheal handle this scenario better?

If the root cause relates to partition healing then a different
partition strategy may fail to trigger the bug. Please let us know if
that is the case.


We will be grateful for any information that you can provide about how
to replicate it. How reliably can you replicate the bug? You mentioned
network partitions - do queues get lost each time a network partition
occurs? Does changing the partition handling strategy make any difference?





-Emile





From Justin.Plock at ge.com  Tue Jun 11 16:14:09 2013
From: Justin.Plock at ge.com (Plock, Justin (GE Corporate))
Date: Tue, 11 Jun 2013 15:14:09 +0000
Subject: [rabbitmq-discuss] Mirrored Queues Disappearing
In-Reply-To: <51B735B2.4020803@rabbitmq.com>
References: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>
	<51B6F3C6.1010706@rabbitmq.com>
	<1137E219-F035-4359-8502-9C197B7160DD@ge.com>
	<51B72180.5020308@rabbitmq.com>
	<6BCB62FC-3640-42D5-8112-F46FEE1FB735@ge.com>
	<51B735B2.4020803@rabbitmq.com>
Message-ID: <93D35D58-2528-47DD-A34F-2FEB2FF8756F@ge.com>

Hi Emile,
  I replied to you privately off list with a link to a Dropbox folder of the full logs.  Please let me know if you didn't get or can't access them.

Thanks

-Justin


On Jun 11, 2013, at 10:35 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> 
> Hi,
> 
> On 11/06/13 15:02, Plock, Justin (GE Corporate) wrote:
>> Could a network partition may have caused this?  I guess I have two main questions:
> 
> It is possible that a partition could cause less logging on some nodes
> and that could end up looking like a gap. Access to the logs may help,
> even if there is a gap.
> 
>> 1.) If my queues/exchange are set to HA, why do they continually get lost during network partitions?
> 
> That shouldn't happen. From the sasl logfiles provided it is clear that
> you are dealing with the effects of a bug. We are trying to replicate
> the bug, and access to the logfiles will probably help. Please feel free
> to contact me directly to arrange transfer, if that will help.
> 
>> 2.) Would using autoheal handle this scenario better?
> 
> If the root cause relates to partition healing then a different
> partition strategy may fail to trigger the bug. Please let us know if
> that is the case.
> 
> 
> We will be grateful for any information that you can provide about how
> to replicate it. How reliably can you replicate the bug? You mentioned
> network partitions - do queues get lost each time a network partition
> occurs? Does changing the partition handling strategy make any difference?
> 
> 
> 
> 
> 
> -Emile
> 
> 
> 
> 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3377 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/e1ab53fd/attachment.bin>

From tim at rabbitmq.com  Tue Jun 11 16:41:00 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 11 Jun 2013 16:41:00 +0100
Subject: [rabbitmq-discuss] RPC response/reply for RabbitMQ - Timeouts
In-Reply-To: <49cec8df-9245-4db8-8cff-c9c2ca5da044@googlegroups.com>
References: <49cec8df-9245-4db8-8cff-c9c2ca5da044@googlegroups.com>
Message-ID: <F8F09E63-72F5-4569-B489-D313BE2A6E6C@rabbitmq.com>

On 11 Jun 2013, at 01:53, JayD wrote:
> All information is old that I have seen on this.  Is there yet a way to define a client side timeout on an rpc style call.  I find it hard to believe that one would have to leave the request hanging if the server is not up and running.
> 
> Does anyone have a good solution for this at this point in time?  On the client side I am using pika.
> 

This kind of problem is generally solved using threads, or some kind of non-blocking I/O event loop. I have no idea how Pika does it - I think it depends on which kind of consumer you've set up - but I'd suggest you try asking on the pika mailing list - https://groups.google.com/forum/#!forum/pika-python.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/288b4c0e/attachment.htm>

From tim at rabbitmq.com  Tue Jun 11 16:46:45 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 11 Jun 2013 16:46:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ publisher confirms using the Erlang
	client
In-Reply-To: <95b7e3cf-4913-47e6-a3e1-9a503b92fafc@googlegroups.com>
References: <95b7e3cf-4913-47e6-a3e1-9a503b92fafc@googlegroups.com>
Message-ID: <C33E249F-9ACA-4EEC-8583-14AA755B5178@rabbitmq.com>

Hi,

You need to put the channel in confirm mode before publishing, like so:

  #'confirm.select_ok'{} = amqp_channel:call(Channel, #'confirm.select'{}), etc().....

Cheers,
Tim

On 10 Jun 2013, at 19:21, Eoin McCarthy wrote:

> Hi, 
> 
> Not sure if this is the best place to ask for help - but it's the forum mentioned on the Rabbit webpage - so I figured I'd give it a go. 
> 
> I'm a Rabbit newbie and using Erlang (which is also fairly new for me) to write my clients. That aside, my publisher code is writing messages to the specified queue. 
> I can see the messages arriving in the queue via the Rabbit management console and an Erlang-based consumer is also picking up the messages are they arrive in the queue.  
> 
> However, I don't seem to be able to get publisher confirms working. I registered a confirm handler callback process and it's rigged to forward a message back to the parent process when it receives anything.
> Gist is here: https://gist.github.com/eoinmc/5750876
> It's not a real-world example - I'm just trying to figure out how to activate and see a publisher confirm using the Erlang client. So far with no success. 
> The client docs are here: http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v3.0.4/doc/
> 
> Any suggestions (including pointing out of obvious mistakes) appreciated. 
> 
> Eoin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/d71b7d53/attachment.htm>

From Justin.Plock at ge.com  Tue Jun 11 16:54:32 2013
From: Justin.Plock at ge.com (Plock, Justin (GE Corporate))
Date: Tue, 11 Jun 2013 15:54:32 +0000
Subject: [rabbitmq-discuss] Mirrored Queues Disappearing
In-Reply-To: <51B735B2.4020803@rabbitmq.com>
References: <F250DB77-8174-46EE-9BA3-9FA0F58F4997@ge.com>
	<51B6F3C6.1010706@rabbitmq.com>
	<1137E219-F035-4359-8502-9C197B7160DD@ge.com>
	<51B72180.5020308@rabbitmq.com>
	<6BCB62FC-3640-42D5-8112-F46FEE1FB735@ge.com>,
	<51B735B2.4020803@rabbitmq.com>
Message-ID: <013EE652-8C88-4031-B5F8-A8346AC9CDD2@ge.com>

We unfortunately also run our logs at the warning level due to the amount of connection closing information our load balancer puts in there. 

That's what all of the connection closures you're probably seeing is from.

-Justin

On Jun 11, 2013, at 10:35, "Emile Joubert" <emile at rabbitmq.com> wrote:

> 
> Hi,
> 
> On 11/06/13 15:02, Plock, Justin (GE Corporate) wrote:
>> Could a network partition may have caused this?  I guess I have two main questions:
> 
> It is possible that a partition could cause less logging on some nodes
> and that could end up looking like a gap. Access to the logs may help,
> even if there is a gap.
> 
>> 1.) If my queues/exchange are set to HA, why do they continually get lost during network partitions?
> 
> That shouldn't happen. From the sasl logfiles provided it is clear that
> you are dealing with the effects of a bug. We are trying to replicate
> the bug, and access to the logfiles will probably help. Please feel free
> to contact me directly to arrange transfer, if that will help.
> 
>> 2.) Would using autoheal handle this scenario better?
> 
> If the root cause relates to partition healing then a different
> partition strategy may fail to trigger the bug. Please let us know if
> that is the case.
> 
> 
> We will be grateful for any information that you can provide about how
> to replicate it. How reliably can you replicate the bug? You mentioned
> network partitions - do queues get lost each time a network partition
> occurs? Does changing the partition handling strategy make any difference?
> 
> 
> 
> 
> 
> -Emile
> 
> 
> 
> 

From stuff at moesel.net  Tue Jun 11 17:31:10 2013
From: stuff at moesel.net (Chris)
Date: Tue, 11 Jun 2013 12:31:10 -0400
Subject: [rabbitmq-discuss] RPC response/reply for RabbitMQ - Timeouts
In-Reply-To: <F8F09E63-72F5-4569-B489-D313BE2A6E6C@rabbitmq.com>
References: <49cec8df-9245-4db8-8cff-c9c2ca5da044@googlegroups.com>
	<F8F09E63-72F5-4569-B489-D313BE2A6E6C@rabbitmq.com>
Message-ID: <CAHEpgBAuhS3h6aSguVMLiiY2h=N1Xaxkytnx9YZekcD9iJMYNQ@mail.gmail.com>

If you do figure out how to use client timeouts, you may also want to
consider using per-message TTL if you don't care about the message anymore
after a timeout.  This can save unnecessary processing of messages that no
longer have an interested participant.  On the other hand, if you want the
message processed, even after the client times out, then you better not do
this.

https://www.rabbitmq.com/ttl.html#per-message-ttl

-Chris


On Tue, Jun 11, 2013 at 11:41 AM, Tim Watson <tim at rabbitmq.com> wrote:

> On 11 Jun 2013, at 01:53, JayD wrote:
>
> All information is old that I have seen on this.  Is there yet a way to
> define a client side timeout on an rpc style call.  I find it hard to
> believe that one would have to leave the request hanging if the server is
> not up and running.
>
> Does anyone have a good solution for this at this point in time?  On the
> client side I am using pika.
>
>
> This kind of problem is generally solved using threads, or some kind of
> non-blocking I/O event loop. I have no idea how Pika does it - I think it
> depends on which kind of consumer you've set up - but I'd suggest you try
> asking on the pika mailing list -
> https://groups.google.com/forum/#!forum/pika-python.
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/5c01f8ff/attachment.htm>

From Michael.Laing at nytimes.com  Tue Jun 11 20:35:35 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Tue, 11 Jun 2013 15:35:35 -0400
Subject: [rabbitmq-discuss] RPC response/reply for RabbitMQ - Timeouts
In-Reply-To: <CAHEpgBAuhS3h6aSguVMLiiY2h=N1Xaxkytnx9YZekcD9iJMYNQ@mail.gmail.com>
Message-ID: <CDDCF256.9FC9%Michael.Laing@nytimes.com>

Just use pika's Connection.add_timeout method with a callback.

ml
From: Chris <stuff at moesel.net<mailto:stuff at moesel.net>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Tuesday, June 11, 2013 12:31 PM
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Cc: "rabbitmq-discuss at googlegroups.com<mailto:rabbitmq-discuss at googlegroups.com>" <rabbitmq-discuss at googlegroups.com<mailto:rabbitmq-discuss at googlegroups.com>>
Subject: Re: [rabbitmq-discuss] RPC response/reply for RabbitMQ - Timeouts

If you do figure out how to use client timeouts, you may also want to consider using per-message TTL if you don't care about the message anymore after a timeout.  This can save unnecessary processing of messages that no longer have an interested participant.  On the other hand, if you want the message processed, even after the client times out, then you better not do this.

https://www.rabbitmq.com/ttl.html#per-message-ttl

-Chris


On Tue, Jun 11, 2013 at 11:41 AM, Tim Watson <tim at rabbitmq.com<mailto:tim at rabbitmq.com>> wrote:
On 11 Jun 2013, at 01:53, JayD wrote:
All information is old that I have seen on this.  Is there yet a way to define a client side timeout on an rpc style call.  I find it hard to believe that one would have to leave the request hanging if the server is not up and running.

Does anyone have a good solution for this at this point in time?  On the client side I am using pika.


This kind of problem is generally solved using threads, or some kind of non-blocking I/O event loop. I have no idea how Pika does it - I think it depends on which kind of consumer you've set up - but I'd suggest you try asking on the pika mailing list - https://groups.google.com/forum/#!forum/pika-python<https://groups.google.com/forum/#%21forum/pika-python>.

Cheers,
Tim

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/b55089a6/attachment.htm>

From jazlalli at hotmail.com  Tue Jun 11 17:37:48 2013
From: jazlalli at hotmail.com (Jasdeep Lalli)
Date: Tue, 11 Jun 2013 09:37:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to start RabbitMQ service on Windows 7
Message-ID: <d035730a-b31a-4016-b3d1-2c2fed16db2b@googlegroups.com>

Hi

My local Rabbit installation stopped working, so I attempted a complete 
reinstall from scratch.  However, I've been unable to run the service since 
then.

When I attempt to restart the service via the services console, it changes 
status to Started, but about 10-15 seconds later, it's dead.  I deleted the 
DB before a restart but no luck.

The event viewer shows the following message when I attempt to start the 
service


RabbitMQ: Erlang machine stopped instantly (distribution name conflict?). 
The service is not restarted as OnFail is set to ignore.
The RabbitMQ service terminated with the following error: The process 
terminated unexpectedly.


The rabbit log has the following (also attached).  Can anyone tell what the 
problem is based on this information?  If there's more you'd like me to do, 
I'm more than happy to do so.


=INFO REPORT==== 11-Jun-2013::17:27:18 ===
Starting RabbitMQ 3.1.1 on Erlang R16B
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 11-Jun-2013::17:27:18 ===
node           : rabbit at MILAP004
home dir       : C:\Windows
config file(s) : (none)
cookie hash    : okag2j8Q/WLLzXbN96HMJg==
log            : 
C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004.log
sasl log       : 
C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004-sasl.log
database dir   : 
c:/Users/jasdeep/AppData/Roaming/RabbitMQ/db/rabbit at MILAP004-mnesia

=INFO REPORT==== 11-Jun-2013::17:27:20 ===
Limiting to approx 8092 file handles (7280 sockets)

=WARNING REPORT==== 11-Jun-2013::17:27:20 ===
Only 2048MB of 8139MB memory usable due to limited address space.

=INFO REPORT==== 11-Jun-2013::17:27:20 ===
Memory limit set to 819MB of 8139MB total.

=INFO REPORT==== 11-Jun-2013::17:27:20 ===
Disk free limit set to 1000MB

=INFO REPORT==== 11-Jun-2013::17:27:20 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 11-Jun-2013::17:27:20 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 11-Jun-2013::17:27:20 ===
started TCP Listener on [::]:5672

=ERROR REPORT==== 11-Jun-2013::17:27:20 ===
Error in process <0.212.0> on node 'rabbit at MILAP004' with exit value: 
{eacces,[{erlang,open_port,[{spawn,"inet_gethost 4 
"},[{packet,4},eof,binary]],[]},{inet_gethost_native,do_open_port,2,[{file,"inet_gethost_native.erl"},{line,400}]},{inet_gethost_native,server_init,2,[{file,"inet_gethost... 


=ERROR REPORT==== 11-Jun-2013::17:27:20 ===
** Generic server inet_gethost_native_sup terminating 
** Last message in was {'EXIT',<0.212.0>,
                           {eacces,
                               [{erlang,open_port,
                                    [{spawn,"inet_gethost 4 "},
                                     [{packet,4},eof,binary]],
                                    []},
                                {inet_gethost_native,do_open_port,2,
                                    [{file,"inet_gethost_native.erl"},
                                     {line,400}]},
                                {inet_gethost_native,server_init,2,
                                    [{file,"inet_gethost_native.erl"},
                                     {line,183}]}]}}
** When Server state == {state,inet_gethost_native,undefined,<0.212.0>,
                               {local,inet_gethost_native_sup}}
** Reason for termination == 
** {eacces,[{erlang,open_port,
                    [{spawn,"inet_gethost 4 "},[{packet,4},eof,binary]],
                    []},
            {inet_gethost_native,do_open_port,2,
                                 [{file,"inet_gethost_native.erl"},
                                  {line,400}]},
            {inet_gethost_native,server_init,2,
                                 [{file,"inet_gethost_native.erl"},
                                  {line,183}]}]}

=INFO REPORT==== 11-Jun-2013::17:27:20 ===
Error description:
   {case_clause,
       {error,
           {{shutdown,
                {failed_to_start_child,tcp_listener,
                    {could_not_start_server,inet_gethost_native}}},
            {child,undefined,'rabbit_tcp_listener_sup_:::5672',
                {tcp_listener_sup,start_link,
                    [{0,0,0,0,0,0,0,0},
                     5672,
                     [inet6,binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}],
                     {rabbit_networking,tcp_listener_started,[amqp]},
                     {rabbit_networking,tcp_listener_stopped,[amqp]},
                     {rabbit_networking,start_client,[]},
                     "TCP Listener"]},
                transient,infinity,supervisor,
                [tcp_listener_sup]}}}}

Log files (may contain more information):
   C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004.log
   C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004-sasl.log

Stack trace:
   [{rabbit_networking,start_listener0,4,[]},
    {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4,[]},
    {rabbit_networking,start_listener,4,[]},
    {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1,[]},
    {rabbit_networking,boot_tcp,0,[]},
    {rabbit_networking,boot,0,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]}]


=INFO REPORT==== 11-Jun-2013::17:27:21 ===
Error description:
   {could_not_start,rabbit,
    {bad_return,
     {{rabbit,start,[normal,[]]},
      {'EXIT',
       {rabbit,failure_during_boot,
        {case_clause,
         {error,
          {{shutdown,
            {failed_to_start_child,tcp_listener,
             {could_not_start_server,inet_gethost_native}}},
           {child,undefined,'rabbit_tcp_listener_sup_:::5672',
            {tcp_listener_sup,start_link,
             [{0,0,0,0,0,0,0,0},
              5672,
              [inet6,binary,
               {packet,raw},
               {reuseaddr,true},
               {backlog,128},
               {nodelay,true},
               {linger,{true,0}},
               {exit_on_close,false}],
              {rabbit_networking,tcp_listener_started,[amqp]},
              {rabbit_networking,tcp_listener_stopped,[amqp]},
              {rabbit_networking,start_client,[]},
              "TCP Listener"]},
            transient,infinity,supervisor,
            [tcp_listener_sup]}}}}}}}}}

Log files (may contain more information):
   C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004.log
   C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004-sasl.log


=ERROR REPORT==== 11-Jun-2013::17:27:21 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {info_msg,<0.30.0>,
                    {<0.2.0>,
                     "Error description:~n   ~p~n~nLog files (may contain 
more information):~n   ~s~n   ~s~n~n",
                     [{could_not_start,rabbit,
                       {bad_return,
                        {{rabbit,start,[normal,[]]},
                         {'EXIT',
                          {rabbit,failure_during_boot,
                           {case_clause,
                            {error,
                             {{shutdown,
                               {failed_to_start_child,tcp_listener,
                                
{could_not_start_server,inet_gethost_native}}},
                              {child,undefined,
                               'rabbit_tcp_listener_sup_:::5672',
                               {tcp_listener_sup,start_link,
                                [{0,0,0,0,0,0,0,0},
                                 5672,
                                 [inet6,binary,
                                  {packet,raw},
                                  {reuseaddr,true},
                                  {backlog,128},
                                  {nodelay,true},
                                  {linger,{true,0}},
                                  {exit_on_close,false}],
                                 {rabbit_networking,tcp_listener_started,
                                  [amqp]},
                                 {rabbit_networking,tcp_listener_stopped,
                                  [amqp]},
                                 {rabbit_networking,start_client,[]},
                                 "TCP Listener"]},
                               transient,infinity,supervisor,
                               [tcp_listener_sup]}}}}}}}}},
                      
"C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004.log",
                      
"C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004-sasl.log"]}}
** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
** Reason == {badarg,[{ets,lookup,
                           [rabbit_exchange,
                            {resource,<<"/">>,exchange,
                                      <<"amq.rabbitmq.log">>}],
                           []},
                      {rabbit_misc,dirty_read,1,[]},
                      {rabbit_basic,publish,1,[]},
                      {rabbit_error_logger,publish1,4,[]},
                      {rabbit_error_logger,handle_event,2,[]},
                      {gen_event,server_update,4,
                                 [{file,"gen_event.erl"},{line,504}]},
                      {gen_event,server_notify,4,
                                 [{file,"gen_event.erl"},{line,486}]},
                      {gen_event,handle_msg,5,
                                 [{file,"gen_event.erl"},{line,248}]}]}


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/b4cbf596/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at milap004.log
Type: application/octet-stream
Size: 26447 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/b4cbf596/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at milap004-sasl.log
Type: application/octet-stream
Size: 29670 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/b4cbf596/attachment-0001.obj>

From eric.coutu at gmail.com  Tue Jun 11 19:50:05 2013
From: eric.coutu at gmail.com (Eric Coutu)
Date: Tue, 11 Jun 2013 11:50:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering Problems
Message-ID: <da5f41c5-a9b1-4133-acee-af0de3607ab3@googlegroups.com>

I'm trying to set up clustering on AWS EC2 but I'm running into problems 
just getting the basic setup.

Setup:
-I have the appropriate ports open, and I can connect to them via. telnet
-I scp'd my erlang.cookie from one machine to the other, set owner to 
rabbitmq:rabbitmq and permissions to 0600
-rabbit1 and rabbit2 entry in both machines hosts file

When I try to do the basic join_cluster, I can't get a connection no matter 
what I try.


From robert.difalco at gmail.com  Tue Jun 11 20:06:19 2013
From: robert.difalco at gmail.com (Robert DiFalco)
Date: Tue, 11 Jun 2013 12:06:19 -0700 (PDT)
Subject: [rabbitmq-discuss] REST, RabbitMQ, and Scalability
Message-ID: <f86f7c66-7007-4f58-b810-eef7f805fcae@googlegroups.com>

I am writing a REST server in Java and am trying to come up with the best 
approach for scalability. The server is deployed on Heroku. I am new to 
RabbitMQ/AMQ so I need some advice.


From dave.lambley at gmail.com  Tue Jun 11 23:16:42 2013
From: dave.lambley at gmail.com (Dave Lambley)
Date: Tue, 11 Jun 2013 23:16:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ for log data
In-Reply-To: <233BBA26-FFF8-44B5-9CBD-DCA45212F9D2@gmail.com>
References: <68355D3A-AB5A-4289-8ADF-0F14FA0951B6@gmail.com>
	<1876813516-1370679199-cardhu_decombobulator_blackberry.rim.net-517649873-@b18.c8.bise7.blackberry>
	<233BBA26-FFF8-44B5-9CBD-DCA45212F9D2@gmail.com>
Message-ID: <CAKze8wtDrc3afXXoYK8oPeU3AoEF9LogNuoaycvQy8iX1a+oaQ@mail.gmail.com>

That's already been done by a couple of things, try Logstash (
http://logstash.net/ ), or Message::Passing (
https://metacpan.org/release/Message-Passing ) if you prefer considerably
lighter-weight Perl.

Dave


On 8 June 2013 20:10, Mark <static.void.dev at gmail.com> wrote:

> I'm guessing if I didn't want directly to it I would need to write some
> sort of producer to tail some logs and ship them over to Rabbit?
>
> On Jun 8, 2013, at 1:13 AM, dave.lambley at gmail.com wrote:
>
> > Yes, it does this well. If you're wanting your application to log
> directly into it, it's worth adding some buffering such as with ZeroMQ to
> eliminate blocking.
> >
> > Dave
> >
> > --
> > Sent using from a tiny keypad.
> >
> > -----Original Message-----
> > From: Mark <static.void.dev at gmail.com>
> > Sender: rabbitmq-discuss-bounces at lists.rabbitmq.com
> > Date: Fri, 7 Jun 2013 17:24:25
> > To: Discussions about RabbitMQ<rabbitmq-discuss at lists.rabbitmq.com>
> > Reply-To: Discussions about RabbitMQ <
> rabbitmq-discuss at lists.rabbitmq.com>
> > Subject: [rabbitmq-discuss] RabbitMQ for log data
> >
> > Is RabbitMQ a good fit for writing a bunch of log data into or would
> something like Kafka be better suited for this?
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/7cd60b8c/attachment.htm>

From jkuch at gopivotal.com  Tue Jun 11 23:22:43 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Tue, 11 Jun 2013 15:22:43 -0700
Subject: [rabbitmq-discuss] Unable to start RabbitMQ service on Windows 7
In-Reply-To: <d035730a-b31a-4016-b3d1-2c2fed16db2b@googlegroups.com>
References: <d035730a-b31a-4016-b3d1-2c2fed16db2b@googlegroups.com>
Message-ID: <CANOx8N=LG9o5x4P5oZFBoopFOF2DyfDRGQQZKJWJwSz9Z+YEng@mail.gmail.com>

Rabbit couldn't start listening on the AMQP port, 5672.  Have you got
firewall or similar issues preventing it from doing so?

On Tue, Jun 11, 2013 at 9:37 AM, Jasdeep Lalli <jazlalli at hotmail.com> wrote:

> Hi
>
> My local Rabbit installation stopped working, so I attempted a complete
> reinstall from scratch.  However, I've been unable to run the service since
> then.
>
> When I attempt to restart the service via the services console, it changes
> status to Started, but about 10-15 seconds later, it's dead.  I deleted the
> DB before a restart but no luck.
>
> The event viewer shows the following message when I attempt to start the
> service
>
>
> RabbitMQ: Erlang machine stopped instantly (distribution name conflict?).
> The service is not restarted as OnFail is set to ignore.
> The RabbitMQ service terminated with the following error: The process
> terminated unexpectedly.
>
>
> The rabbit log has the following (also attached).  Can anyone tell what
> the problem is based on this information?  If there's more you'd like me to
> do, I'm more than happy to do so.
>
>
> =INFO REPORT==== 11-Jun-2013::17:27:18 ===
> Starting RabbitMQ 3.1.1 on Erlang R16B
> Copyright (C) 2007-2013 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> =INFO REPORT==== 11-Jun-2013::17:27:18 ===
> node           : rabbit at MILAP004
> home dir       : C:\Windows
> config file(s) : (none)
> cookie hash    : okag2j8Q/WLLzXbN96HMJg==
> log            :
> C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004.log
> sasl log       :
> C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004-sasl.log
> database dir   :
> c:/Users/jasdeep/AppData/Roaming/RabbitMQ/db/rabbit at MILAP004-mnesia
>
> =INFO REPORT==== 11-Jun-2013::17:27:20 ===
> Limiting to approx 8092 file handles (7280 sockets)
>
> =WARNING REPORT==== 11-Jun-2013::17:27:20 ===
> Only 2048MB of 8139MB memory usable due to limited address space.
>
> =INFO REPORT==== 11-Jun-2013::17:27:20 ===
> Memory limit set to 819MB of 8139MB total.
>
> =INFO REPORT==== 11-Jun-2013::17:27:20 ===
> Disk free limit set to 1000MB
>
> =INFO REPORT==== 11-Jun-2013::17:27:20 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 11-Jun-2013::17:27:20 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 11-Jun-2013::17:27:20 ===
> started TCP Listener on [::]:5672
>
> =ERROR REPORT==== 11-Jun-2013::17:27:20 ===
> Error in process <0.212.0> on node 'rabbit at MILAP004' with exit value:
> {eacces,[{erlang,open_port,[{spawn,"inet_gethost 4
> "},[{packet,4},eof,binary]],[]},{inet_gethost_native,do_open_port,2,[{file,"inet_gethost_native.erl"},{line,400}]},{inet_gethost_native,server_init,2,[{file,"inet_gethost...
>
>
> =ERROR REPORT==== 11-Jun-2013::17:27:20 ===
> ** Generic server inet_gethost_native_sup terminating
> ** Last message in was {'EXIT',<0.212.0>,
>                            {eacces,
>                                [{erlang,open_port,
>                                     [{spawn,"inet_gethost 4 "},
>                                      [{packet,4},eof,binary]],
>                                     []},
>                                 {inet_gethost_native,do_open_port,2,
>                                     [{file,"inet_gethost_native.erl"},
>                                      {line,400}]},
>                                 {inet_gethost_native,server_init,2,
>                                     [{file,"inet_gethost_native.erl"},
>                                      {line,183}]}]}}
> ** When Server state == {state,inet_gethost_native,undefined,<0.212.0>,
>                                {local,inet_gethost_native_sup}}
> ** Reason for termination ==
> ** {eacces,[{erlang,open_port,
>                     [{spawn,"inet_gethost 4 "},[{packet,4},eof,binary]],
>                     []},
>             {inet_gethost_native,do_open_port,2,
>                                  [{file,"inet_gethost_native.erl"},
>                                   {line,400}]},
>             {inet_gethost_native,server_init,2,
>                                  [{file,"inet_gethost_native.erl"},
>                                   {line,183}]}]}
>
> =INFO REPORT==== 11-Jun-2013::17:27:20 ===
> Error description:
>    {case_clause,
>        {error,
>            {{shutdown,
>                 {failed_to_start_child,tcp_listener,
>                     {could_not_start_server,inet_gethost_native}}},
>             {child,undefined,'rabbit_tcp_listener_sup_:::5672',
>                 {tcp_listener_sup,start_link,
>                     [{0,0,0,0,0,0,0,0},
>                      5672,
>                      [inet6,binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}],
>                      {rabbit_networking,tcp_listener_started,[amqp]},
>                      {rabbit_networking,tcp_listener_stopped,[amqp]},
>                      {rabbit_networking,start_client,[]},
>                      "TCP Listener"]},
>                 transient,infinity,supervisor,
>                 [tcp_listener_sup]}}}}
>
> Log files (may contain more information):
>    C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004.log
>    C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004-sasl.log
>
> Stack trace:
>    [{rabbit_networking,start_listener0,4,[]},
>     {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4,[]},
>     {rabbit_networking,start_listener,4,[]},
>     {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1,[]},
>     {rabbit_networking,boot_tcp,0,[]},
>     {rabbit_networking,boot,0,[]},
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>     {rabbit,run_boot_step,1,[]}]
>
>
> =INFO REPORT==== 11-Jun-2013::17:27:21 ===
> Error description:
>    {could_not_start,rabbit,
>     {bad_return,
>      {{rabbit,start,[normal,[]]},
>       {'EXIT',
>        {rabbit,failure_during_boot,
>         {case_clause,
>          {error,
>           {{shutdown,
>             {failed_to_start_child,tcp_listener,
>              {could_not_start_server,inet_gethost_native}}},
>            {child,undefined,'rabbit_tcp_listener_sup_:::5672',
>             {tcp_listener_sup,start_link,
>              [{0,0,0,0,0,0,0,0},
>               5672,
>               [inet6,binary,
>                {packet,raw},
>                {reuseaddr,true},
>                {backlog,128},
>                {nodelay,true},
>                {linger,{true,0}},
>                {exit_on_close,false}],
>               {rabbit_networking,tcp_listener_started,[amqp]},
>               {rabbit_networking,tcp_listener_stopped,[amqp]},
>               {rabbit_networking,start_client,[]},
>               "TCP Listener"]},
>             transient,infinity,supervisor,
>             [tcp_listener_sup]}}}}}}}}}
>
> Log files (may contain more information):
>    C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004.log
>    C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004-sasl.log
>
>
> =ERROR REPORT==== 11-Jun-2013::17:27:21 ===
> ** gen_event handler rabbit_error_logger crashed.
> ** Was installed in error_logger
> ** Last event was: {info_msg,<0.30.0>,
>                     {<0.2.0>,
>                      "Error description:~n   ~p~n~nLog files (may contain
> more information):~n   ~s~n   ~s~n~n",
>                      [{could_not_start,rabbit,
>                        {bad_return,
>                         {{rabbit,start,[normal,[]]},
>                          {'EXIT',
>                           {rabbit,failure_during_boot,
>                            {case_clause,
>                             {error,
>                              {{shutdown,
>                                {failed_to_start_child,tcp_listener,
>
> {could_not_start_server,inet_gethost_native}}},
>                               {child,undefined,
>                                'rabbit_tcp_listener_sup_:::5672',
>                                {tcp_listener_sup,start_link,
>                                 [{0,0,0,0,0,0,0,0},
>                                  5672,
>                                  [inet6,binary,
>                                   {packet,raw},
>                                   {reuseaddr,true},
>                                   {backlog,128},
>                                   {nodelay,true},
>                                   {linger,{true,0}},
>                                   {exit_on_close,false}],
>                                  {rabbit_networking,tcp_listener_started,
>                                   [amqp]},
>                                  {rabbit_networking,tcp_listener_stopped,
>                                   [amqp]},
>                                  {rabbit_networking,start_client,[]},
>                                  "TCP Listener"]},
>                                transient,infinity,supervisor,
>                                [tcp_listener_sup]}}}}}}}}},
>
> "C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004.log",
>
> "C:/Users/jasdeep/AppData/Roaming/RabbitMQ/log/rabbit at MILAP004-sasl.log
> "]}}
> ** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
> ** Reason == {badarg,[{ets,lookup,
>                            [rabbit_exchange,
>                             {resource,<<"/">>,exchange,
>                                       <<"amq.rabbitmq.log">>}],
>                            []},
>                       {rabbit_misc,dirty_read,1,[]},
>                       {rabbit_basic,publish,1,[]},
>                       {rabbit_error_logger,publish1,4,[]},
>                       {rabbit_error_logger,handle_event,2,[]},
>                       {gen_event,server_update,4,
>                                  [{file,"gen_event.erl"},{line,504}]},
>                       {gen_event,server_notify,4,
>                                  [{file,"gen_event.erl"},{line,486}]},
>                       {gen_event,handle_msg,5,
>                                  [{file,"gen_event.erl"},{line,248}]}]}
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130611/742bb2d8/attachment.htm>

From monish.unni at gmail.com  Wed Jun 12 02:51:00 2013
From: monish.unni at gmail.com (cogitate)
Date: Tue, 11 Jun 2013 18:51:00 -0700 (PDT)
Subject: [rabbitmq-discuss] configure maxlength feature in 3.1.1
Message-ID: <1371001860209-27346.post@n5.nabble.com>

hi mathias:
thank you for adding this feature to 3.1.1 we were desperately in need of
this. 
earlier, we were making sync operations like queueDeclarePassive to figure
queue-length. 

however, according to doc : http://www.rabbitmq.com/maxlength.html
" Messages will be dropped or dead-lettered from the front of the queue to
make room for new messages once the limit is reached " and on testing find
this to be as documented (certified :) )

and, we'd like to reject any new messages, rather than drop off messages
that are sitting in front of the queue. 

is this configurable? if not, what are our alternatives?

thank you much,
-cogitate



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/configure-maxlength-feature-in-3-1-1-tp27346.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed Jun 12 08:32:52 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 12 Jun 2013 08:32:52 +0100
Subject: [rabbitmq-discuss] Clustering Problems
In-Reply-To: <da5f41c5-a9b1-4133-acee-af0de3607ab3@googlegroups.com>
References: <da5f41c5-a9b1-4133-acee-af0de3607ab3@googlegroups.com>
Message-ID: <09A75E20-3200-484A-A659-9F593A9F81FB@rabbitmq.com>

Eric,

On 11 Jun 2013, at 19:50, Eric Coutu wrote:
> I'm trying to set up clustering on AWS EC2 but I'm running into problems just getting the basic setup.
> 
> Setup:
> -I have the appropriate ports open, and I can connect to them via. telnet

Which ports have you opened? It's not just 5672 that is needed for clustering.

> 
> When I telnet to rabbit1:5672 there is an entry in rabbit1s log files, but when I join_cluster, nothing shows up.
> 

That doesn't make any sense. Presumably you mean "when I ssh to rabbit1" instead? Do both rabbit recognise one another's host names (via /etc/hosts or whatever)?

Running `rabbitmqctl status` on both nodes (locally) can you confirm that the cookie hashes are indeed the same?

Cheers,
Tim

From tilak.chauhan at ymail.com  Wed Jun 12 08:33:21 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Wed, 12 Jun 2013 00:33:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Script/Connection not getting terminated.
In-Reply-To: <CAE3HoVQ+4GhyGZkOmsymZntSZkzq-=3SXKxSxTxd=vfSY+n6sg@mail.gmail.com>
References: <1370593137420-27265.post@n5.nabble.com>
	<CAE3HoVTjLs5X8yRQxTGFTECBfj1uLnencKh_Dm5O6OdKgsV52A@mail.gmail.com>
	<1370600022350-27271.post@n5.nabble.com>
	<CAMcAHLV8hzfGNpfY5akkz2U=ae00RYRpwa-mzY0Gc2jysPoB=g@mail.gmail.com>
	<1370873815781-27309.post@n5.nabble.com>
	<1370940619703-27321.post@n5.nabble.com>
	<CAE3HoVQ+4GhyGZkOmsymZntSZkzq-=3SXKxSxTxd=vfSY+n6sg@mail.gmail.com>
Message-ID: <1371022401404-27347.post@n5.nabble.com>

Hi MK,

I've uploaded the complete code at 
https://dl.dropboxusercontent.com/u/57488576/php-amqplib.zip
<https://dl.dropboxusercontent.com/u/57488576/php-amqplib.zip>  . I followed
all the instruction given at https://github.com/videlalvaro/php-amqplib/,
but still couldn't make it working. Whenever I execute any demo script then
I get a error like  this -:

/PHP Fatal error:  Class 'PhpAmqpLib\Connection\AMQPConnection' not found in
/home/tluck/Desktop/rmq/php-amqplib/demo/amqp_publisher.php on line 10/

I've PHP 5.3.10 installed in my computer.

Thanks
T.luck






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Script-Connection-not-getting-terminated-tp27265p27347.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From brett.r.cameron at gmail.com  Wed Jun 12 09:30:51 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 12 Jun 2013 20:30:51 +1200
Subject: [rabbitmq-discuss] Clustering Problems
In-Reply-To: <09A75E20-3200-484A-A659-9F593A9F81FB@rabbitmq.com>
References: <da5f41c5-a9b1-4133-acee-af0de3607ab3@googlegroups.com>
	<09A75E20-3200-484A-A659-9F593A9F81FB@rabbitmq.com>
Message-ID: <CALPqkiosJ9Omu=BrRfZe5CAFFPc7EWrhk3SYdo5gHO6HQqK-Fg@mail.gmail.com>

Eric,

The following docs might help you to diagnose the problem:

http://www.rabbitmq.com/ec2.html
http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/


Regards,
Brett


On Wed, Jun 12, 2013 at 7:32 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Eric,
>
> On 11 Jun 2013, at 19:50, Eric Coutu wrote:
> > I'm trying to set up clustering on AWS EC2 but I'm running into problems
> just getting the basic setup.
> >
> > Setup:
> > -I have the appropriate ports open, and I can connect to them via. telnet
>
> Which ports have you opened? It's not just 5672 that is needed for
> clustering.
>
> >
> > When I telnet to rabbit1:5672 there is an entry in rabbit1s log files,
> but when I join_cluster, nothing shows up.
> >
>
> That doesn't make any sense. Presumably you mean "when I ssh to rabbit1"
> instead? Do both rabbit recognise one another's host names (via /etc/hosts
> or whatever)?
>
> Running `rabbitmqctl status` on both nodes (locally) can you confirm that
> the cookie hashes are indeed the same?
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/485a742d/attachment.htm>

From emile at rabbitmq.com  Wed Jun 12 09:43:00 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 12 Jun 2013 09:43:00 +0100
Subject: [rabbitmq-discuss] configure maxlength feature in 3.1.1
In-Reply-To: <1371001860209-27346.post@n5.nabble.com>
References: <1371001860209-27346.post@n5.nabble.com>
Message-ID: <51B83494.7090803@rabbitmq.com>

On 12/06/13 02:51, cogitate wrote:

> we'd like to reject any new messages, rather than drop off messages 
> that are sitting in front of the queue.
> 
> is this configurable? if not, what are our alternatives?

Unfortunately not, but this may be added in a future version if there is
sufficient demand. In the meantime an alternative option is to continue
using publishers to monitor queue length and only publish when the
available queue capacity allows.




-Emile






From emile at rabbitmq.com  Wed Jun 12 10:21:51 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 12 Jun 2013 10:21:51 +0100
Subject: [rabbitmq-discuss] Clustering Problems
In-Reply-To: <CALPqkiosJ9Omu=BrRfZe5CAFFPc7EWrhk3SYdo5gHO6HQqK-Fg@mail.gmail.com>
References: <da5f41c5-a9b1-4133-acee-af0de3607ab3@googlegroups.com>
	<09A75E20-3200-484A-A659-9F593A9F81FB@rabbitmq.com>
	<CALPqkiosJ9Omu=BrRfZe5CAFFPc7EWrhk3SYdo5gHO6HQqK-Fg@mail.gmail.com>
Message-ID: <51B83DAF.6000806@rabbitmq.com>

On 12/06/13 09:30, Brett Cameron wrote:
> http://www.rabbitmq.com/ec2.html
> http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/

Yes, and this:
http://www.rabbitmq.com/clustering.html#firewall





-Emile






From emile at rabbitmq.com  Wed Jun 12 10:45:08 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 12 Jun 2013 10:45:08 +0100
Subject: [rabbitmq-discuss] Unable to start RabbitMQ service on Windows 7
In-Reply-To: <CANOx8N=LG9o5x4P5oZFBoopFOF2DyfDRGQQZKJWJwSz9Z+YEng@mail.gmail.com>
References: <d035730a-b31a-4016-b3d1-2c2fed16db2b@googlegroups.com>
	<CANOx8N=LG9o5x4P5oZFBoopFOF2DyfDRGQQZKJWJwSz9Z+YEng@mail.gmail.com>
Message-ID: <51B84324.6020405@rabbitmq.com>


> {inet_gethost_native,do_open_port,2,[{file,"inet_gethost_native.erl"},
> {line,400}]},{inet_gethost_native,server_init,2,[{file,"inet_gethost...


In addition to Jerry's advice, check that your Erlang installation is ok
by running the interpreter on its own: "werl -sname foo"
Also make sure that name resolution works correctly on your server.




-Emile





From davidpriddle2000 at gmail.com  Wed Jun 12 11:07:25 2013
From: davidpriddle2000 at gmail.com (David Priddle)
Date: Wed, 12 Jun 2013 03:07:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection Problem with .NET Client v3.0.4
Message-ID: <e99b1e71-d7b3-4388-9162-7e446ce5361d@googlegroups.com>

 

We?ve been having occasional problems with connection errors using the 
Rabbit .NET Client v3.0.4. This manifests itself initially with the error:

Shutting down connection. Reason: AMQP close-reason, initiated by Peer, 
code=503, text="COMMAND_INVALID - second 'channel.open' seen", classId=20, 
methodId=10, cause=

We attempt to Dispose the connection object at this point to make sure 
we?ve released all resources, but get an ObjectDisposedException from the 
underlying NetworkStream. We then attempt to reconnect and start consuming 
again, but although the connection and channels appear to create 
successfully we don?t receive messages off the queue.

I believe the underlying connection we are using is in a bad state.

I?ve noticed some other discussions online about a problem where a 
duplicate channel number may be allocated. I see that the only difference 
between the .NET 3.1.1 client and the 3.0.4 client is a fix has been made 
to the way the IntAllocator class allocates integers. I assume that is this 
bug in the release notes:

.NET client

-------------

bug fixes

25558 fix a bug that could lead to duplicate channel IDs being allocated,causing a connection failure 

Do you have any more information about this bug? Do you think this fix 
would be relevant to the problems we are seeing? Is there any 

(I?m considering whether we should urgently patch our software to upgrade 
us onto 3.1.1 client.)

Best Regards,

David Priddle

 

 

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/efa27a6e/attachment.htm>

From emile at rabbitmq.com  Wed Jun 12 12:07:13 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 12 Jun 2013 12:07:13 +0100
Subject: [rabbitmq-discuss] Connection Problem with .NET Client v3.0.4
In-Reply-To: <e99b1e71-d7b3-4388-9162-7e446ce5361d@googlegroups.com>
References: <e99b1e71-d7b3-4388-9162-7e446ce5361d@googlegroups.com>
Message-ID: <51B85661.1070509@rabbitmq.com>


Hi,

On 12/06/13 11:07, David Priddle wrote:
> Do you have any more information about this bug? Do you think this fix
> would be relevant to the problems we are seeing? Is there any


Yes this bug is the likely cause if you have many concurrent channels
per connections. Upgrading should solve the problem.


-Emile





From eoinmccarthy at fastmail.fm  Wed Jun 12 12:34:44 2013
From: eoinmccarthy at fastmail.fm (Eoin McCarthy)
Date: Wed, 12 Jun 2013 04:34:44 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ publisher confirms using the Erlang
	client
In-Reply-To: <95b7e3cf-4913-47e6-a3e1-9a503b92fafc@googlegroups.com>
References: <95b7e3cf-4913-47e6-a3e1-9a503b92fafc@googlegroups.com>
Message-ID: <92c9705d-872c-45bd-8f26-bce4390d3bc1@googlegroups.com>


That worked. Thank you!

>Hi,
>
>You need to put the channel in confirm mode before publishing, like so:
>
>  #'confirm.select_ok'{} = amqp_channel:call(Channel, #'confirm.select'{}), etc().....
>
>Cheers,
>Tim


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/a1ebcc52/attachment.htm>

From yuva670 at gmail.com  Wed Jun 12 12:59:29 2013
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Wed, 12 Jun 2013 17:29:29 +0530
Subject: [rabbitmq-discuss] Clustering Linux and Windows machines
In-Reply-To: <5167D919.6010908@rabbitmq.com>
References: <CAPrynAVSvAtoySeqQJRYhdv9vPp-kSSSmdBCzpXSfVijz4tRWg@mail.gmail.com>
	<5167D919.6010908@rabbitmq.com>
Message-ID: <CAPrynAXxUsTOcPKY1D7sbvNB0kcTr045--w6iX3CH91wY6xN1Q@mail.gmail.com>

I solved the issue, it was the hostname detection problem. Is it that
rabbitmq relies on the hostnames to connect multiple nodes? What if the
nodes are on different networks?


-Mahesh


On Fri, Apr 12, 2013 at 3:21 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. Check http://www.rabbitmq.com/**clustering.html#firewall<http://www.rabbitmq.com/clustering.html#firewall>- I suspect one or both of the machines is firewalling inter-node
> communication.
>
> Also, any particular reason why you're installing 2.8.4? It's fairly old.
>
> Cheers, Simon
>
>
> On 12/04/13 10:18, Mahesh Viraktamath wrote:
>
>> Hi,
>>
>> I am trying to cluster rabbitmq nodes on a linux and windows machines. I
>> ran consumers connecting to each of these nodes and they connected fine.
>> The cookies are similar on both the machines.
>>
>> On windows, I installed the RabbitMQ and erlang using the installers -
>> 2.8.4 and R15B01 respectively, My linux machine runs rhel 5, so the same
>> versions were not available in the repository, so I installed erlang by
>> building from the source and verified the version. I installed RabbitMQ
>> using the precompiled generic unix bundle (2.8.4).
>>
>> To verify the installed versions, I enabled the management plugins and
>> checked there. Now, when I do a
>> "rabbitmqctl -n rabbit at 564654-host99 status", it says node down.
>>
>> Am I missing any step here given that the servers run different platforms?
>>
>>
>> Thanks,
>> Mahesh
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/819c6f49/attachment.htm>

From joe at javaranch.com  Wed Jun 12 16:29:06 2013
From: joe at javaranch.com (Joe7pack)
Date: Wed, 12 Jun 2013 08:29:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to connect from public IP address
Message-ID: <1371050945984-27357.post@n5.nabble.com>

I installed RabbitMQ on my Windows 7 system and it runs fine. I have a Java
RabbitMQ client running on the same server that also works fine when I
connect to my RabbitMQ server using my local IP address, 192.168.1.100. I
have a static IP assigned to me by my ISP and all ports are opened, they
tell me. If I do a telnet to 192.168.1.100 5672, I can see that my RabbitMQ
is listening there but if I telnet using my static public IP address and
port 5672, I get a message back from Telnet stating "Could not open
connection to the host, on port 5672: Connect failed.  I have a router that
forwards port 5672 to 192.168.1.100 and I don't believe there are any
firewalls in place that would block port 5672. Any idea what I'm missing?
TIA, Joe



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Unable-to-connect-from-public-IP-address-tp27357.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ward.mark at gmail.com  Wed Jun 12 17:25:10 2013
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 12 Jun 2013 09:25:10 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.1.1 High watermark permanent blocking
Message-ID: <1371054310711-27358.post@n5.nabble.com>

Hi,

I think I have found a problem with RabbitMQ 3.1.1 where during long periods
of entering and exiting high watermark memory flow control the server will
stop sending and receiving messages on all existing connections and new
connections.  Even when the queues have no messages in them the server is
stuck in a high watermark flow control state.  The memory high watermark is
still exceeded.  I have left the server and clients up for over 24 hours and
the state does not change.

The issue is repeatable. 

The same test works against RabbitMQ 2.8.7.  The RabbitMQ 2.8.7 will for
long periods enter and exit flow control but never enters a permanent state
like RabbitMQ 3.1.1.

I have tested RabbitMQ 3.1.1 on 
-Ubuntu Server 12.04 with all updates applied.  The Ubuntu server is setup
to pull in apt-get RabbitMQ from ?http://www.rabbitmq.com/debian/ testing
main? and erlang from ?http://binaries.erlang-solutions.com/debian precise
contrib?
-Windows 2012 Standard

Both the Ubuntu and Windows install of RabbitMQ 3.1.1 ran into the same
issue.  Both are repeatable.

The RabbitMQ 2.8.7 was performed on the same Windows 2012 server.  All
previous installations of RabbitMQ were removed and the /Roaming/RabbitMQ
directory was cleared out before the installation.

The RabbitMQ log files on the Ubuntu and Windows 2012 for the RabbitMQ 3.1.1
didn?t contain any error messages.  The only message was the memory alarm
log entries.  The -sasl.log didn?t contain any log messages.

My client is .NET using the 3.1.1 library pulled from nuget.  I ran into the
same problem using the .NET 3.0.4 library.

I am pretty confident that my client is not publishing on the subscribing
connection. 

I would like to help track down what might be going on with RabbitMQ 3.1.1. 
But I must request that describing how my client is working be taken offline
in a private conversation.

-Mark




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-1-1-High-watermark-permanent-blocking-tp27358.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From joe at javaranch.com  Wed Jun 12 17:45:59 2013
From: joe at javaranch.com (Joe Guzzardo)
Date: Wed, 12 Jun 2013 09:45:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to connect from public IP address
In-Reply-To: <1371050945984-27357.post@n5.nabble.com>
References: <1371050945984-27357.post@n5.nabble.com>
Message-ID: <1371055559417-27359.post@n5.nabble.com>

Turns out I had Windows firewall blocking port 5672. So I created a rule to
allow that port and walah, I can connect to my RabbitMQ server from the
outside world now. Thanks, Alex!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Unable-to-connect-from-public-IP-address-tp27357p27359.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ward.mark at gmail.com  Wed Jun 12 21:17:39 2013
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 12 Jun 2013 13:17:39 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.1.1 High watermark permanent blocking
In-Reply-To: <1371054310711-27358.post@n5.nabble.com>
References: <1371054310711-27358.post@n5.nabble.com>
Message-ID: <1371068259015-27360.post@n5.nabble.com>

I wanted to follow up with more evidence. 

If I restart the RabbitMQ 3.1.1 instance while my clients are connected.
Once the server is back online my clients will resume sending and the test
will complete the test with success.  My clients implement a reconnect when
connections are lost.  

When the server enters the locked state the clients do not report any
connection failures or other errors. The server restart eliminates the
memory high watermark.  All data makes it from the publisher to the
subscriber.  Messages that might were on the server are persisted and resume
sending.

This is also a repeatable test.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-1-1-High-watermark-permanent-blocking-tp27358p27360.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From s.sciarrati at gmail.com  Wed Jun 12 21:29:12 2013
From: s.sciarrati at gmail.com (Simone Sciarrati)
Date: Wed, 12 Jun 2013 22:29:12 +0200
Subject: [rabbitmq-discuss] 3.1.1 High watermark permanent blocking
In-Reply-To: <1371068259015-27360.post@n5.nabble.com>
References: <1371054310711-27358.post@n5.nabble.com>
	<1371068259015-27360.post@n5.nabble.com>
Message-ID: <CAOQTPw6jhMO3DdBNOKbFVO6y+YzGBEp99WXmgQ5EBsVtBvOoaA@mail.gmail.com>

Hi,

What happens if once the server is "locked" you raise the high watermark
limit (instead of restarting rabbitmq), will the client resume sending?

Simone
On 12 Jun 2013 22:18, "Mark Ward" <ward.mark at gmail.com> wrote:

> I wanted to follow up with more evidence.
>
> If I restart the RabbitMQ 3.1.1 instance while my clients are connected.
> Once the server is back online my clients will resume sending and the test
> will complete the test with success.  My clients implement a reconnect when
> connections are lost.
>
> When the server enters the locked state the clients do not report any
> connection failures or other errors. The server restart eliminates the
> memory high watermark.  All data makes it from the publisher to the
> subscriber.  Messages that might were on the server are persisted and
> resume
> sending.
>
> This is also a repeatable test.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/3-1-1-High-watermark-permanent-blocking-tp27358p27360.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/d29c9f11/attachment.htm>

From mcintoshj at gmail.com  Thu Jun 13 04:15:47 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 12 Jun 2013 22:15:47 -0500
Subject: [rabbitmq-discuss] REST, RabbitMQ, and Scalability
In-Reply-To: <f86f7c66-7007-4f58-b810-eef7f805fcae@googlegroups.com>
References: <f86f7c66-7007-4f58-b810-eef7f805fcae@googlegroups.com>
Message-ID: <CAD6m6fGE31V=yrQcPv4v9HQ=noiWFNkXZgs2DHEVsf_DsA3KQA@mail.gmail.com>

You can use RabbitMQ to do this - there's nothing that says you can't.
 Whether it's the right solution depends on the complexity of the overall
architecture, goals in that architecture, etc.  My initial thought was
"memcached" that both process and rest server publish and read from.  In
our case due to our requirements, we use a shoveled set of rabbit queues to
transmit data changes to an "enterprise system" in a different geographical
location the the source rabbit servers.  This enterprise system is where
the "source of truth" data is stored as well as for tracking information
and other data.  The AMQP consumers after updating the central database,
publishes changes back out to the various locations for high performance
read only use.  If we hadn't had the need to do distributed data publishes
from multiple locations, required support for networking
failures/interrupts, wanted high performance and minimal impact to send
such messages, we'd have just had local processes talking to local
replicated/clustered databases instead.  Our current architecture gives us
a distributed HA asynchronous processing system.  There are always, always
questions though - how durable is the job ids?  If a publishing fails and
your app fails, do you just rerun, etc. etc. etc.

Jason


On Tue, Jun 11, 2013 at 2:06 PM, Robert DiFalco <robert.difalco at gmail.com>wrote:

> I am writing a REST server in Java and am trying to come up with the best
> approach for scalability. The server is deployed on Heroku. I am new to
> RabbitMQ/AMQ so I need some advice.
>
> From an architectural point of view I want to have one or more REST dynos
> running that delegate all of their work to one or more worker dynos. The
> REST server dynos must be stateless.
>
> I have two basic patterns to support.
>
>
>    1. REST RPC. Basically, the client makes a call like GET /user/{id}. I
>    delegate this call to a worker dyno that does a database lookup in the USER
>    table for the specified ID and returns it. The REST interface then returns
>    this. This to me seems like basic RPC.
>    2. REST ASYNC. In this model the client may call my REST server with a
>    POST or a GET. Let's use the classic case of a long running task to format
>    a graphic. I will create a JOB ID, return it to the client in an URI. The
>    client calls the URI to poll the job until it is done and then eventually
>    gets redirected to a URI that has the result. In this case, when I get the
>    initial REST call I will generate a UID for it, submit it to the worker.
>    There are several ways I can do the polling and returning of the result. A
>    lot of that depends on how I decide to interact with the worker.  Is it
>    RPC? AKKA? AMQP?  Because there may be more than one REST service dyno, the
>    request to post the job may happen on one REST server and the polling
>    request may be routed to another. So it must be stateless.
>
>
> So here's my question. First, should I be using RabbitMQ for this or is
> there a better solution? If I am using RabbitMQ must I implement the RPC
> and ASYNC patterns myself directly on top of RabbitMQ or are there
> libraries out there that create a layer of abstraction on top of RabbitMQ
> so I can do both of these simply? If I'm going to use RabbitMQ I'm hoping
> to use CloudAMQP on Heroku.
>
> Thanks!
>
> Robert
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/d06805bb/attachment.htm>

From harel at thisisglow.com  Wed Jun 12 12:40:37 2013
From: harel at thisisglow.com (harel at thisisglow.com)
Date: Wed, 12 Jun 2013 04:40:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
In-Reply-To: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
References: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
Message-ID: <c32e9a23-055a-49cf-9ab2-963850a4c84f@googlegroups.com>

We're seeing this recently since upgrading to the 3.x version of rabbit. 
We are running about 25 queues and all is good for a while. But sometimes 
rabbit crashes hard with out of memory errors even if the queues are not 
noticeably larger or busier than usual. I have a 3.2GB crash dump which 
honestly I don't even know how to begin looking at. 
This is running on a 8 core 16GB  server. 
How do I approach this? is it a bug in rabbit or something I can do ?
Thanks ,
Harel

On Tuesday, April 16, 2013 5:53:06 PM UTC+1, Ilya Volodarsky wrote:
>
> We're having some strange memory problems in our rabbit that looks like 
> it's attributed to our queues. We're running Rabbit 3.0.1 in production, 
> here's the management plugin overview: http://cl.ly/image/0z25241k320Q
>
> As you can see, we have almost no messages queued, but the server is using 
> 5.7GB of active memory. Here's the memory breakdown of the same node: 
> http://cl.ly/image/03381l2M3v2p
>
> The broker claims to be using 4.8 GB to store the 4454 queues. That's 
> strange because most of the queues claim to be using 14kb - 23kb, which 
> AFAIK, is the in the correct range for an idle queue. An average of 20kb 
> per queue * 4500 queues = 90 MB, not 4800 MB (53 times bigger). 
>
> Here's the JSON description of a queue from the /queues call:
>
> {"memory":14624,"idle_since":"2013-04-15 
> 22:45:20","policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":4,"active_consumers":4,"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":0,"ram_msg_count":0,"ram_ack_count":0,"next_seq_id":0,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_ready_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_unacknowledged_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"name":"Ingestion.1899vw88el","vhost":"/segment","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at rabbit2"}
>
> A few things to note: we have 4 servers subscribing to every queue, and 
> because of the RMQ client (node-amqp) we're using, it creates a channel per 
> subscription. I realize that's not ideal and we'll be fixing the client to 
> make multiple subscriptions per channel, but either way, the broker reports 
> only 350 MB of the memory use coming from the connections vs. 4.8 GB for 
> queues. 
>
> The broker has also been up for 76 days without downtime, so maybe there's 
> some kind of memory leak? We're seeing the memory go up over time. 
>
> Thanks!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/54820f41/attachment.htm>

From harel at thisisglow.com  Wed Jun 12 12:40:37 2013
From: harel at thisisglow.com (harel at thisisglow.com)
Date: Wed, 12 Jun 2013 04:40:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
In-Reply-To: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
References: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
Message-ID: <c32e9a23-055a-49cf-9ab2-963850a4c84f@googlegroups.com>

We're seeing this recently since upgrading to the 3.x version of rabbit. 
We are running about 25 queues and all is good for a while. But sometimes 
rabbit crashes hard with out of memory errors even if the queues are not 
noticeably larger or busier than usual. I have a 3.2GB crash dump which 
honestly I don't even know how to begin looking at. 
This is running on a 8 core 16GB  server. 
How do I approach this? is it a bug in rabbit or something I can do ?
Thanks ,
Harel

On Tuesday, April 16, 2013 5:53:06 PM UTC+1, Ilya Volodarsky wrote:
>
> We're having some strange memory problems in our rabbit that looks like 
> it's attributed to our queues. We're running Rabbit 3.0.1 in production, 
> here's the management plugin overview: http://cl.ly/image/0z25241k320Q
>
> As you can see, we have almost no messages queued, but the server is using 
> 5.7GB of active memory. Here's the memory breakdown of the same node: 
> http://cl.ly/image/03381l2M3v2p
>
> The broker claims to be using 4.8 GB to store the 4454 queues. That's 
> strange because most of the queues claim to be using 14kb - 23kb, which 
> AFAIK, is the in the correct range for an idle queue. An average of 20kb 
> per queue * 4500 queues = 90 MB, not 4800 MB (53 times bigger). 
>
> Here's the JSON description of a queue from the /queues call:
>
> {"memory":14624,"idle_since":"2013-04-15 
> 22:45:20","policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":4,"active_consumers":4,"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":0,"ram_msg_count":0,"ram_ack_count":0,"next_seq_id":0,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_ready_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_unacknowledged_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"name":"Ingestion.1899vw88el","vhost":"/segment","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at rabbit2"}
>
> A few things to note: we have 4 servers subscribing to every queue, and 
> because of the RMQ client (node-amqp) we're using, it creates a channel per 
> subscription. I realize that's not ideal and we'll be fixing the client to 
> make multiple subscriptions per channel, but either way, the broker reports 
> only 350 MB of the memory use coming from the connections vs. 4.8 GB for 
> queues. 
>
> The broker has also been up for 76 days without downtime, so maybe there's 
> some kind of memory leak? We're seeing the memory go up over time. 
>
> Thanks!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/54820f41/attachment-0001.htm>

From joeguzzardo at gmail.com  Wed Jun 12 15:34:39 2013
From: joeguzzardo at gmail.com (Joe Guzzardo)
Date: Wed, 12 Jun 2013 07:34:39 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to connect to RabbitMQ thru public IP
	address
Message-ID: <3e00b6a4-fef0-4a96-8773-990c46c90235@googlegroups.com>

I installed RabbitMQ on my Windows 7 system and it runs fine. I have a Java 
RabbitMQ client running on the same server that also works fine when I 
connect to my RabbitMQ server using my local IP address, 192.168.1.100. I 
have a static IP assigned to me by my ISP and all ports are opened, they 
tell me. If I do a telnet to 192.168.1.100 5672, I can see that my RabbitMQ 
is listening there but if I telnet using my static public IP address and 
port 5672, I get a message back from Telnet stating "Could not open 
connection to the host, on port 5672: Connect failed.  Any idea what I'm 
missing? TIA, Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/b9136833/attachment.htm>

From maria.garcia.aguirregomez at gmail.com  Wed Jun 12 16:21:43 2013
From: maria.garcia.aguirregomez at gmail.com (Maria Garcia)
Date: Wed, 12 Jun 2013 08:21:43 -0700 (PDT)
Subject: [rabbitmq-discuss] XML in RabbitMQ with Stomp protocol
Message-ID: <8ee31807-64f5-4392-9a07-1d447fe980d9@googlegroups.com>


>
> Hi, 
>
> I am trying to send and receive a XML with a RabbitMQ + Stomp and a 
> browser client, I also use SockJS . First, I send and receive a simple text 
> message without problems, but when I send a XML, I lost my connection and I 
> don't know why. Any idea?
>
> Thanks in advance.
>
> Here my code, where d.body supposedly is my XML message:
 

> <script>
>       // Stomp.js  create WS connection
>      var ws = new SockJS('http://' + window.location.hostname + 
> ':15674/stomp');
>       var client = Stomp.over(ws);
>
>       client.heartbeat.outgoing = 0;
>       client.heartbeat.incoming = 0;
>        
>
>       var on_connect = function(x) {
>             
>
          id = client.subscribe("/exchange/nombreExchange", function(d) {
>                print_first(d.body);
>             });
>       };
>
>       var on_error =  function() {
>         console.log('error');
>       };
>       client.connect('guest', 'guest', on_connect, on_error, '/');
>
>
>     </script>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130612/96a93c52/attachment.htm>

From emile at rabbitmq.com  Thu Jun 13 09:06:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Jun 2013 09:06:50 +0100
Subject: [rabbitmq-discuss] unable to connect to RabbitMQ thru public IP
 address
In-Reply-To: <3e00b6a4-fef0-4a96-8773-990c46c90235@googlegroups.com>
References: <3e00b6a4-fef0-4a96-8773-990c46c90235@googlegroups.com>
Message-ID: <51B97D9A.2050805@rabbitmq.com>

On 12/06/13 15:34, Joe Guzzardo wrote:
> I installed RabbitMQ on my Windows 7 system and it runs fine. I have a
> Java RabbitMQ client running on the same server that also works fine
> when I connect to my RabbitMQ server using my local IP address,
> 192.168.1.100. I have a static IP assigned to me by my ISP and all ports
> are opened, they tell me. If I do a telnet to 192.168.1.100 5672, I can
> see that my RabbitMQ is listening there but if I telnet using my static
> public IP address and port 5672, I get a message back from Telnet
> stating "Could not open connection to the host, on port 5672: Connect
> failed.  Any idea what I'm missing? TIA, Joe

Your local IP address is in the private range so I assume you have a
router forwarding AMQP traffic from your static public to your local IP
address. Depending on how your network is set up you should try to
telnet to your static public address from outside your network. This is
not AMQP- or RabbitMQ-specific; the same will happen for HTTP or any
other port.

See the tcp_listeners configuration element in case you want to change
the interface that the broker listens on, though that should not be
necessary. When the broker starts up it will log this as follows:
"started TCP Listener on"




-Emile








From emile at rabbitmq.com  Thu Jun 13 09:37:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Jun 2013 09:37:47 +0100
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
In-Reply-To: <c32e9a23-055a-49cf-9ab2-963850a4c84f@googlegroups.com>
References: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
	<c32e9a23-055a-49cf-9ab2-963850a4c84f@googlegroups.com>
Message-ID: <51B984DB.4080408@rabbitmq.com>



Hi,

On 12/06/13 12:40, harel at thisisglow.com wrote:
> We're seeing this recently since upgrading to the 3.x version of rabbit. 

Can you reproduce the problem on the latest version?

> We are running about 25 queues and all is good for a while. But
> sometimes rabbit crashes hard with out of memory errors even if the
> queues are not noticeably larger or busier than usual.
The broker can run out of memory for other reasons, e.g. if you create a
very large number of channels. The output of "rabbitmqctl report" can
help to identify such cases. You can send the output to the list (or to
me privately if it is too large) if you need help interpreting it.

Recent versions of the management plugin can also show memory usage
breakdown in the node overview page.

If this does not pinpoint the cause then make sure there is no other
service on the same server as the broker that takes alot of RAM.

> I have a 3.2GB crash dump which honestly I don't even know how to
> begin looking at. 

Crash dump files rarely contain anything useful. Yours probably says
"Failure to allocate some bytes". The broker log and sasl log are
usually more useful. I would expect to see memory alarms in the broker log.



-Emile



From simon at rabbitmq.com  Thu Jun 13 10:43:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Jun 2013 10:43:22 +0100
Subject: [rabbitmq-discuss] 3.1.1 High watermark permanent blocking
In-Reply-To: <1371068259015-27360.post@n5.nabble.com>
References: <1371054310711-27358.post@n5.nabble.com>
	<1371068259015-27360.post@n5.nabble.com>
Message-ID: <51B9943A.2090907@rabbitmq.com>

Presumably when the server is permanently blocked the memory use 
actually *is* over the high watermark, right? (Just wanted to check 
since I don't think you explicitly said that).

In that case, what does RabbitMQ say the memory is used by? Please see 
http://www.rabbitmq.com/memory-use.html for how to get it to tell you.

Cheers, Simon

On 12/06/13 21:17, Mark Ward wrote:
> I wanted to follow up with more evidence.
>
> If I restart the RabbitMQ 3.1.1 instance while my clients are connected.
> Once the server is back online my clients will resume sending and the test
> will complete the test with success.  My clients implement a reconnect when
> connections are lost.
>
> When the server enters the locked state the clients do not report any
> connection failures or other errors. The server restart eliminates the
> memory high watermark.  All data makes it from the publisher to the
> subscriber.  Messages that might were on the server are persisted and resume
> sending.
>
> This is also a repeatable test.
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-1-1-High-watermark-permanent-blocking-tp27358p27360.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From lee.hambley at gmail.com  Thu Jun 13 12:36:04 2013
From: lee.hambley at gmail.com (Lee Hambley)
Date: Thu, 13 Jun 2013 04:36:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Mnesia Corruption Bug
Message-ID: <2fb2deb0-748b-46a0-b9b2-05b3688c9bf7@googlegroups.com>

Posting this to the list after some discussion on IRC with bob2351 on 
irc.freenode.net.

We have a *slightly* strange situation with using RabbitMQ, we start it 
under `runit`, and it effectively believes that it's running in the 
foreground. I have anecdotal evidence that this causes other problems, but 
at least not anything that hurts too often (i.e you lose "persistent 
messages" in this setup)

That all aside, attached ( https://gist.github.com/leehambley/5773039 ) is 
a stacktrace from a problematic box, we couldn't get it to recover (single 
node, single replica, etc, etc) - we simply deleted the mnesia database, 
which worked well enough.

Some information about our environment:

$ erl --version
Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8] 
[async-threads:0] [kernel-poll:false]
$ dpkg --list | grep rabbit
ii  rabbitmq-server     3.0.4-1     AMQP server written in Erlang
$ sudo RABBITMQ_NODENAME=ourproject rabbitmqctl status
Status of node ourproject at carla ...
[{pid,8055},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
      {rabbit,"RabbitMQ","3.0.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
      {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,33984216},
      {connection_procs,756760},
      {queue_procs,325576},
      {plugins,218728},
      {other_proc,9518440},
      {mnesia,93728},
      {mgmt_db,148472},
      {msg_index,71528},
      {other_ets,1145600},
      {binary,604208},
      {code,17266925},
      {atom,1550457},
      {other_system,2283794}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6656894566},
 {disk_free_limit,1000000000},
 {disk_free,11247643770880},
 {file_descriptors,
     [{total_limit,924},
      {total_used,23},
      {sockets_limit,829},
      {sockets_used,12}]},
 {processes,[{limit,1048576},{used,345}]},
 {run_queue,0},
 {uptime,2692}]
...done.


I believe this bug is already being tracked internally, and I post the 
report here in the hope that I'll have a place to attach a snapshot of an 
mnesia database the next time this happens to us, or that someone else 
might find this report and be able to contribute. Finally, selfishly, in 
the hope that I'll get notified when this gets fixed, and I upgrade, and 
sleep at night again.

- Lee Hambley
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130613/b70dd7e6/attachment.htm>

From simon at rabbitmq.com  Thu Jun 13 13:37:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Jun 2013 13:37:39 +0100
Subject: [rabbitmq-discuss] 3.1.1 - Errors during failover
In-Reply-To: <03CFB894A02BE24885082C694F789A7B13E0FF0C@PERMLS03.zettaserve.com>
References: <03CFB894A02BE24885082C694F789A7B13E0FC6D@PERMLS03.zettaserve.com>
	<51B5E06A.4030900@rabbitmq.com>
	<CAHd5nyz1E-AP3cxGbeOo=DK4iEpuqOU_6RqENqsOZmVxtqLZfA@mail.gmail.com>
	<03CFB894A02BE24885082C694F789A7B13E0FF0C@PERMLS03.zettaserve.com>
Message-ID: <51B9BD13.8060907@rabbitmq.com>

Hi. We've failed to reproduce this using a similar workload and also 
spent some time staring at the appropriate bits of code and not come up 
with anything.

So to try to narrow things down a bit:

1) Does the problem still occur if you disable automatic eager sync? 
(And don't eager sync manually either.)

2) Can you provide the Mnesia directory and logs from a machine which 
has just failed?

Cheers, Simon

On 10/06/13 16:26, Rensen, Nathanael wrote:
> Thanks for taking the time to look at those logs.
>
> The purpose of the test is to confirm that the client application,
> server application, LVS and RMQ itself all perform properly during
> fail-over. There is certainly messaging activity during the test,
> although relatively modest by RMQ standards judging from the rates I
> see discussed on this forum.
>
> Of the 10 queues, three queues were operating with a combined average
> rate of around 200 messages per second from client app to server app.
> The publish rate will burst to instantaneous peaks possibly exceeding
> 500 messages per second for a short time. A fourth queue is returning
> responses from server app to client app at somewhere around 300 to
> 400 messages per second. A fifth queue is used for application
> heartbeats from server to client at around 1 message every 2 seconds.
> The remaining 5 queues were idle during the test. The messages are in
> the range of hundreds of bytes to a couple of kilobytes. Each message
> has a per-message TTL configured - 10 seconds for the application
> heartbeats, 90 seconds otherwise. -- When either client or server
> application detects a channel / connection shutdown it enters a
> reconnect cycle making two attempts to connect each second until it
> is able to re-establish connection and resume operation. Each
> application uses a single RMQ connection for consume and publish. All
> publishing happens on a single channel per app using publisher
> confirms.
>
> I am able to reliably reproduce an error of some kind by running the
> test for long enough (a couple of dozen fail-overs is typically
> enough, although sometimes fewer than 10). I haven't paid
> sufficiently close attention to be able to say whether the error is
> always the same. However the symptoms are not always exactly the
> same. Usually after an error has occurred one or other broker will
> refuse to shutdown gracefully. Sometimes queues vanish and I will
> have to reconfigure them.
>
> In order to gather a clean sample for the logs I posted I deleted
> /var/lib/rabbitmq/mnesia and reconfigured the cluster and queues from
> scratch. I then rebooted the nodes to ensure a clean starting point.
>
> Thanks again,
>
> Nathanael
>
>
> Simon MacMullen wrote:
>
> Hi thanks. This is definitely an odd looking error, can you tell us
> mre about what you're doing? Are you just starting / stopping nodes,
> or is there messaging activity going on at the same time (and if so,
> what?)
>
> Cheers, Simon
>
>
> On 10/06/13 11:32, Rensen, Nathanael wrote: I've attached the sasl
> log from mq-002. Sorry I didn't include that originally.
>
> Thanks for taking a look.
>
> Nathanael
>
> Simon MacMullen wrote:
>
> Hi. Looking at the logs it seems like the message store on mq-002
> crashed / shut down unexpectedly, but there's no information about
> this in the log. Do you have the corresponding sasl log?
>
> Cheers, Simon
>
>
> On 09/06/13 06:03, Rensen, Nathanael wrote: While testing a fail-over
> scenario with RabbitMQ 3.1.1 I have repeatedly encountered errors,
> sometimes resulting in durable queues vanishing.
>
> The cluster consists of two brokers using LVS / keepalived in order
> to connect clients to a functional broker. There are 10 mirrored
> queues, each of which has ha-sync-mode = automatic. A script is used
> to shut down one broker or the other in turn using 'service
> rabbitmq-server {start|stop}', such that there is always one broker
> running and leaving at least 30 seconds between each start / stop. I
> am expecting that this test should be able to run indefinitely
> without destabilising the cluster, however I have not been able to
> achieve more than a few dozen fail-overs without some error
> occurring. I'm hoping someone may have some insight or suggestions as
> to how to stabilise this environment.
>
> I have included basic environment details below and attached logs
> from both brokers showing one example. In this case zg-dev-mq-003 was
> stopped at 11:32:21 and went through what appears to be a clean
> shutdown:
>
> =INFO REPORT==== 9-Jun-2013::11:33:22 === Halting Erlang VM
>
> zg-dev-mq-002 detected the other broker down and promoted itself to
> master. Then after accepting connections from clients it logged an
> error as shown below:
>
> =INFO REPORT==== 9-Jun-2013::11:33:22 === rabbit on node
> 'rabbit at zg-dev-mq-003' down =INFO REPORT==== 9-Jun-2013::11:33:22 ===
> accepting AMQP connection <0.427.0> (10.0.72.36:61434 ->
> 172.17.0.73:5672) =INFO REPORT==== 9-Jun-2013::11:33:22 === accepting
> AMQP connection <0.430.0> (10.0.72.36:61435 -> 172.17.0.73:5672)
> =ERROR REPORT==== 9-Jun-2013::11:33:22 === ** Generic server
> <0.418.0> terminating ** Last message in was {'$gen_cast',
> {delete_and_terminate, {badarg, [{ets,insert_new, [360523,
> {{<<10,71,177,42,66,240,207,204,251,26,181,155, 246,83,172,137>>,
> <<120,196,170,245,109,158,126,84,92,250,21,193, 123,113,128,48>>},
> -1}], []}, {rabbit_msg_store,client_update_flying,3,[]},
> {rabbit_msg_store,'-remove/2-lc$^0/1-0-',2,[]},
> {rabbit_msg_store,remove,2,[]}, {rabbit_variable_queue,
> '-with_immutable_msg_store_state/3-fun-0-',2,[]},
> {rabbit_variable_queue,with_msg_store_state,3,[]},
> {rabbit_variable_queue, with_immutable_msg_store_state,3,[]},
> {rabbit_variable_queue,'-ack/2-lc$^0/1-0-',2, []}]}}} etc
>
> Environment details (same for both brokers):
>
> [root at zg-dev-mq-002]# uname -a Linux zg-dev-mq-002.zettagrid.local
> 2.6.32-358.2.1.el6.x86_64 #1 SMP Wed Mar 13 00:26:49 UTC 2013 x86_64
> x86_64 x86_64 GNU/Linux
>
> [root at zg-dev-mq-002]# cat /etc/centos-release CentOS release 6.4
> (Final)
>
> [root at zg-dev-mq-002]# yum list installed | egrep 'rabbit|erlang'
> esl-erlang.x86_64      R16B-2           @/esl-erlang-R16B-2.x86_64
> esl-erlang-compat.noarch      R14B-1.el6
> @/esl-erlang-compat-R14B-1.el6.noarch rabbitmq-server.noarch 3.1.1-1
> @/rabbitmq-server-3.1.1-1.noarch
>
> Thanks very much,
>
> Nathanael
>
> ________________________________
>
> ZettaServe Disclaimer: This email and any files transmitted with it
> are confidential and intended solely for the use of the individual or
> entity to whom they are addressed. If you are not the named addressee
> you should not disseminate, distribute or copy this e-mail. Please
> notify the sender immediately if you have received this email by
> mistake and delete this email from your system. Computer viruses can
> be transmitted via email. The recipient should check this email and
> any attachments for the presence of viruses. ZettaServe Pty Ltd
> accepts no liability for any damage caused by any virus transmitted
> by this email.
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jun 13 13:49:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Jun 2013 13:49:42 +0100
Subject: [rabbitmq-discuss] Mnesia Corruption Bug
In-Reply-To: <2fb2deb0-748b-46a0-b9b2-05b3688c9bf7@googlegroups.com>
References: <2fb2deb0-748b-46a0-b9b2-05b3688c9bf7@googlegroups.com>
Message-ID: <51B9BFE6.4010300@rabbitmq.com>

Hi Lee. I would be interested to know how you got the machine into that 
state.

There is a bug with a similar stack trace that will be fixed in the next 
release - but I don't think it's the same bug. In your case we are 
seeing a message which has been published and delivered according to the 
queue index, but only published (and not delivered) according to the 
queue index's journal. As the journal should always record the same 
state or newer as the main index, this should be impossible.

So to eliminate obvious causes of weirdness first: are you usuing an 
unusual filesystem, or mounting the filesystem with unusual options?

Cheers, Simon

On 13/06/13 12:36, Lee Hambley wrote:
> Posting this to the list after some discussion on IRC with bob2351 on
> irc.freenode.net.
>
> We have a *slightly* strange situation with using RabbitMQ, we start it
> under `runit`, and it effectively believes that it's running in the
> foreground. I have anecdotal evidence that this causes other problems,
> but at least not anything that hurts too often (i.e you lose "persistent
> messages" in this setup)
>
> That all aside, attached ( https://gist.github.com/leehambley/5773039 )
> is a stacktrace from a problematic box, we couldn't get it to recover
> (single node, single replica, etc, etc) - we simply deleted the mnesia
> database, which worked well enough.
>
> Some information about our environment:
>
>     $ erl --version
>     Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8]
>     [async-threads:0] [kernel-poll:false]
>     $ dpkg --list | grep rabbit
>     ii  rabbitmq-server     3.0.4-1     AMQP server written in Erlang
>     $ sudo RABBITMQ_NODENAME=ourproject rabbitmqctl status
>     Status of node ourproject at carla ...
>     [{pid,8055},
>       {running_applications,
>           [{rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
>            {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
>            {rabbit,"RabbitMQ","3.0.4"},
>            {os_mon,"CPO  CXC 138 46","2.2.7"},
>            {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
>            {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
>            {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
>            {xmerl,"XML parser","1.2.10"},
>            {inets,"INETS  CXC 138 49","5.7.1"},
>            {mnesia,"MNESIA  CXC 138 12","4.5"},
>            {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
>            {sasl,"SASL  CXC 138 11","2.1.10"},
>            {stdlib,"ERTS  CXC 138 10","1.17.5"},
>            {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>       {os,{unix,linux}},
>       {erlang_version,
>           "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8]
>     [async-threads:30] [kernel-poll:true]\n"},
>       {memory,
>           [{total,33984216},
>            {connection_procs,756760},
>            {queue_procs,325576},
>            {plugins,218728},
>            {other_proc,9518440},
>            {mnesia,93728},
>            {mgmt_db,148472},
>            {msg_index,71528},
>            {other_ets,1145600},
>            {binary,604208},
>            {code,17266925},
>            {atom,1550457},
>            {other_system,2283794}]},
>       {vm_memory_high_watermark,0.4},
>       {vm_memory_limit,6656894566},
>       {disk_free_limit,1000000000},
>       {disk_free,11247643770880},
>       {file_descriptors,
>           [{total_limit,924},
>            {total_used,23},
>            {sockets_limit,829},
>            {sockets_used,12}]},
>       {processes,[{limit,1048576},{used,345}]},
>       {run_queue,0},
>       {uptime,2692}]
>     ...done.
>
>
> I believe this bug is already being tracked internally, and I post the
> report here in the hope that I'll have a place to attach a snapshot of
> an mnesia database the next time this happens to us, or that someone
> else might find this report and be able to contribute. Finally,
> selfishly, in the hope that I'll get notified when this gets fixed, and
> I upgrade, and sleep at night again.
>
> - Lee Hambley
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jun 13 15:08:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Jun 2013 15:08:39 +0100
Subject: [rabbitmq-discuss] Mnesia Corruption Bug
In-Reply-To: <CAN_+VLVnG8KVmVOOao2UzbnR9WOH_CnYLgvpMuj3UM7NjKOxDg@mail.gmail.com>
References: <2fb2deb0-748b-46a0-b9b2-05b3688c9bf7@googlegroups.com>
	<51B9BFE6.4010300@rabbitmq.com>
	<CAN_+VLVnG8KVmVOOao2UzbnR9WOH_CnYLgvpMuj3UM7NjKOxDg@mail.gmail.com>
Message-ID: <51B9D267.4060304@rabbitmq.com>

Hmm, do you still have the Mnesia directory that wouldn't boot? Are you 
able to reproduce this?

Cheers, Simon

On 13/06/13 14:00, Lee Hambley wrote:
> Hi Simon,
>
> Nothing strange of that sort, we use runit to manage the process (in out
> env we need unprivileged users to be able to restart selected services,
> using runit that's as simple as chowning a named pipe).
>
> In case it matters, on STOP runit sends TERM, waits 7s for the process
> to go away before resorting to sending KILL. ( the follow up KILL is our
> design, but in keeping with runit principles, the 7s timeout is internal
> to runit)
>
> We've no special file system configuration, these machines are i7 with
> raid spinning disks (not sure what configuration, probably 2 drives.
>
> The hardware is practically new <100h usage, and was burned in and
> stress tested at install time.
>
> Happy to post fstabs, raid logs etc if you tell me what you need (and in
> weird cases, how to get it).
>
> On Thursday, June 13, 2013, Simon MacMullen wrote:
>
>     Hi Lee. I would be interested to know how you got the machine into
>     that state.
>
>     There is a bug with a similar stack trace that will be fixed in the
>     next release - but I don't think it's the same bug. In your case we
>     are seeing a message which has been published and delivered
>     according to the queue index, but only published (and not delivered)
>     according to the queue index's journal. As the journal should always
>     record the same state or newer as the main index, this should be
>     impossible.
>
>     So to eliminate obvious causes of weirdness first: are you usuing an
>     unusual filesystem, or mounting the filesystem with unusual options?
>
>     Cheers, Simon
>
>     On 13/06/13 12:36, Lee Hambley wrote:
>
>         Posting this to the list after some discussion on IRC with
>         bob2351 on
>         irc.freenode.net <http://irc.freenode.net>.
>
>         We have a *slightly* strange situation with using RabbitMQ, we
>         start it
>         under `runit`, and it effectively believes that it's running in the
>         foreground. I have anecdotal evidence that this causes other
>         problems,
>         but at least not anything that hurts too often (i.e you lose
>         "persistent
>         messages" in this setup)
>
>         That all aside, attached (
>         https://gist.github.com/__leehambley/5773039
>         <https://gist.github.com/leehambley/5773039> )
>         is a stacktrace from a problematic box, we couldn't get it to
>         recover
>         (single node, single replica, etc, etc) - we simply deleted the
>         mnesia
>         database, which worked well enough.
>
>         Some information about our environment:
>
>              $ erl --version
>              Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8]
>              [async-threads:0] [kernel-poll:false]
>              $ dpkg --list | grep rabbit
>              ii  rabbitmq-server     3.0.4-1     AMQP server written in
>         Erlang
>              $ sudo RABBITMQ_NODENAME=ourproject rabbitmqctl status
>              Status of node ourproject at carla ...
>              [{pid,8055},
>                {running_applications,
>                    [{rabbitmq_management,"__RabbitMQ Management
>         Console","3.0.4"},
>                     {rabbitmq_management_agent,"__RabbitMQ Management
>         Agent","3.0.4"},
>                     {rabbit,"RabbitMQ","3.0.4"},
>                     {os_mon,"CPO  CXC 138 46","2.2.7"},
>                     {rabbitmq_web_dispatch,"__RabbitMQ Web
>         Dispatcher","3.0.4"},
>                     {webmachine,"webmachine","1.9.__1-rmq3.0.4-git52e62bc"},
>                     {mochiweb,"MochiMedia Web
>         Server","2.3.1-rmq3.0.4-__gitd541e9a"},
>                     {xmerl,"XML parser","1.2.10"},
>                     {inets,"INETS  CXC 138 49","5.7.1"},
>                     {mnesia,"MNESIA  CXC 138 12","4.5"},
>                     {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
>                     {sasl,"SASL  CXC 138 11","2.1.10"},
>                     {stdlib,"ERTS  CXC 138 10","1.17.5"},
>                     {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>                {os,{unix,linux}},
>                {erlang_version,
>                    "Erlang R14B04 (erts-5.8.5) [source] [64-bit]
>         [smp:8:8] [rq:8]
>              [async-threads:30] [kernel-poll:true]\n"},
>                {memory,
>                    [{total,33984216},
>                     {connection_procs,756760},
>                     {queue_procs,325576},
>                     {plugins,218728},
>                     {other_proc,9518440},
>                     {mnesia,93728},
>                     {mgmt_db,148472},
>                     {msg_index,71528},
>                     {other_ets,1145600},
>                     {binary,604208},
>                     {code,17266925},
>                     {atom,1550457},
>                     {other_system,2283794}]},
>                {vm_memory_high_watermark,0.4}__,
>                {vm_memory_limit,6656894566},
>                {disk_free_limit,1000000000},
>                {disk_free,11247643770880},
>                {file_descriptors,
>                    [{total_limit,924},
>                     {total_used,23},
>                     {sockets_limit,829},
>                     {sockets_used,12}]},
>                {processes,[{limit,1048576},{__used,345}]},
>                {run_queue,0},
>                {uptime,2692}]
>              ...done.
>
>
>         I believe this bug is already being tracked internally, and I
>         post the
>         report here in the hope that I'll have a place to attach a
>         snapshot of
>         an mnesia database the next time this happens to us, or that someone
>         else might find this report and be able to contribute. Finally,
>         selfishly, in the hope that I'll get notified when this gets
>         fixed, and
>         I upgrade, and sleep at night again.
>
>         - Lee Hambley
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>
>
> --
> Lee Hambley
> --
> http://lee.hambley.name/
> +49 (0) 170 298 5667
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From ward.mark at gmail.com  Thu Jun 13 15:58:05 2013
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 13 Jun 2013 07:58:05 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.1.1 High watermark permanent blocking
In-Reply-To: <51B9943A.2090907@rabbitmq.com>
References: <1371054310711-27358.post@n5.nabble.com>
	<1371068259015-27360.post@n5.nabble.com>
	<51B9943A.2090907@rabbitmq.com>
Message-ID: <1371135485778-27373.post@n5.nabble.com>

Hi Simon,

I have attached a ZIP file of two testing sessions.  Each contain status
output plus screen shots from the management gui.

When the permanent block the RabbitMQ is in a flow control state with
publish connections blocked and the subscriber indicated as "blocking"

-Mark
Blocking_Issue.zip
<http://rabbitmq.1065348.n5.nabble.com/file/n27373/Blocking_Issue.zip>  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-1-1-High-watermark-permanent-blocking-tp27358p27373.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ward.mark at gmail.com  Thu Jun 13 16:37:50 2013
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 13 Jun 2013 08:37:50 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.1.1 High watermark permanent blocking
In-Reply-To: <CAOQTPw6jhMO3DdBNOKbFVO6y+YzGBEp99WXmgQ5EBsVtBvOoaA@mail.gmail.com>
References: <1371054310711-27358.post@n5.nabble.com>
	<1371068259015-27360.post@n5.nabble.com>
	<CAOQTPw6jhMO3DdBNOKbFVO6y+YzGBEp99WXmgQ5EBsVtBvOoaA@mail.gmail.com>
Message-ID: <1371137870397-27374.post@n5.nabble.com>

Hi Simone,

I found the command to change the high watermark while the server is
running.  I used  rabbitmqctl set_vm_memory_high_watermark 80.  After
executing the command communication resumed. 
But I see I may have made a mistake in the command as the high water mark is
now set to 77.8 GB and the VM only has 1 GB! lol.

The maximum size of memory used reported in the web gui has been 1.7GB.

Data resume sending but eventually the server crashed.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-1-1-High-watermark-permanent-blocking-tp27358p27374.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Jun 13 16:42:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Jun 2013 16:42:07 +0100
Subject: [rabbitmq-discuss] 3.1.1 High watermark permanent blocking
In-Reply-To: <1371137870397-27374.post@n5.nabble.com>
References: <1371054310711-27358.post@n5.nabble.com>
	<1371068259015-27360.post@n5.nabble.com>
	<CAOQTPw6jhMO3DdBNOKbFVO6y+YzGBEp99WXmgQ5EBsVtBvOoaA@mail.gmail.com>
	<1371137870397-27374.post@n5.nabble.com>
Message-ID: <51B9E84F.1070106@rabbitmq.com>

Yes - the high watermark is a fraction of physical memory. Values > 1 
are... not recommended.

Cheers, Simon

On 13/06/13 16:37, Mark Ward wrote:
> Hi Simone,
>
> I found the command to change the high watermark while the server is
> running.  I used  rabbitmqctl set_vm_memory_high_watermark 80.  After
> executing the command communication resumed.
> But I see I may have made a mistake in the command as the high water mark is
> now set to 77.8 GB and the VM only has 1 GB! lol.
>
> The maximum size of memory used reported in the web gui has been 1.7GB.
>
> Data resume sending but eventually the server crashed.
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-1-1-High-watermark-permanent-blocking-tp27358p27374.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From dave at nexttolast.com  Thu Jun 13 18:39:54 2013
From: dave at nexttolast.com (David Goehrig)
Date: Thu, 13 Jun 2013 13:39:54 -0400
Subject: [rabbitmq-discuss] 10 consumers on a queue delivers 10x too many
	messages
Message-ID: <CAPhD6FFCuqp-_P5zk=5R3oJ7vhb+ib0ZorHYfZPZwMR8aWtU6g@mail.gmail.com>

Recently I've had 3 applications all start misbehaving in the same way.

I have a topic exchange called alerts that is bound to 4 queues via the
same routing key #

debug, hits, words, score

The alerts exchange is recieving 10 messages per second, which is the same
as the number published to that exchange by the nodes processing messages.
The exchange shows 40
messages per second total outbound.

Each of the 4 queues show 10 messages per second incoming and the queues
each have a 3 day
TTL on the messages, with the exception of debug which has a 5 minute.

Now debug queue as expected shows a pretty steady backlog hovering around
3000 message (which is correct) and with no consumers doesn't show any
weird behavior.

The other 3 queues each have 10 consumers bound to them and are showing an
average of 100 message per second being delivered to each consumer, with
each consumer recieving approximately 10 messages per second on average.
(the distribution doesn't look even though but more likely random).   These
queues report 10 messages per second incoming, but show 100 messages per
second outbound.

Looking over the report and the configs for each queue, nothing obvious
jumps out as to why the queues are behaving this way.  And until this week,
they've run perfectly fine for months.

Anyone have any idea how this could happen/

Dave

-- 
-=-=-=-=-=-=-=-=-=-=- http://blog.dloh.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130613/3629ac3d/attachment.htm>

From marty.wasznicky at neudesic.com  Thu Jun 13 19:02:49 2013
From: marty.wasznicky at neudesic.com (martywaz)
Date: Thu, 13 Jun 2013 11:02:49 -0700 (PDT)
Subject: [rabbitmq-discuss] BasicPublish in .NET using client 2.8.1.0 and
	transaction support
Message-ID: <d3b35a32-18c9-43ee-ac06-64e5872285e7@googlegroups.com>

When calling BasicPublish in .NET c#, is it required to explicitly make a 
call to DtxStart and TxCommit to ensure that the message published is 
within a transaction?

for example, our psudo code for creating a connection is this:

            var connectionFactory = new ConnectionFactory
            {
                HostName = this.hostName,
                Password = this.password,
                Port = this.port != -1 ? this.port : 
AmqpTcpEndpoint.UseDefaultPort,
                UserName = this.userName,
                Protocol = Protocols.FromConfiguration()
            };
            this.connection = connectionFactory.CreateConnection();
            this.connection.ConnectionShutdown += 
this.ConnectionOnConnectionShutdown;
            this.model = this.connection.CreateModel();

            if (this.properties.Durable)
            {
                this.model.ConfirmSelect();
            }

            this.model.BasicAcks += new 
BasicAckEventHandler(this.MessageAcknowledged);
            this.model.BasicNacks += this.MessageNotAcknowledged;
            this.model.BasicReturn += this.MessageReturned;
            this.model.FlowControl += this.FlowControlChanged;
            this.model.CallbackException += ReportCallbackException;

and psudo publish code looks like this:

                         this.model.BasicPublish(
                        this.exchangeName,
                        string.Empty,
                        this.properties.Durable,
                        this.properties.Immediate,
                        messageProperties,
                        body);

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130613/352e1749/attachment.htm>

From static.void.dev at gmail.com  Thu Jun 13 21:55:48 2013
From: static.void.dev at gmail.com (Mark)
Date: Thu, 13 Jun 2013 13:55:48 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Avro
Message-ID: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>

Anyone use Avro with RabbitMQ for event aggregation. Is so, would you mind sharing you experiences?

From jkuch at gopivotal.com  Thu Jun 13 22:04:06 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 13 Jun 2013 14:04:06 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Avro
In-Reply-To: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
References: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
Message-ID: <CANOx8Nk6kR0wFTKAZv1rT69G3aJWLSYu_zTBcTaOSdhUT_72mQ@mail.gmail.com>

We've certainly heard of people doing it...

On Thu, Jun 13, 2013 at 1:55 PM, Mark <static.void.dev at gmail.com> wrote:

> Anyone use Avro with RabbitMQ for event aggregation. Is so, would you mind
> sharing you experiences?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130613/c17b8308/attachment.htm>

From michael.s.klishin at gmail.com  Thu Jun 13 22:12:17 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 14 Jun 2013 01:12:17 +0400
Subject: [rabbitmq-discuss] RabbitMQ and Avro
In-Reply-To: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
References: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
Message-ID: <CAE3HoVSHeKs_=swz6h2-JSDbCHW+3E8sZQiepsSRR23mRFmALQ@mail.gmail.com>

2013/6/14 Mark <static.void.dev at gmail.com>

> Anyone use Avro with RabbitMQ for event aggregation. Is so, would you mind
> sharing you experiences?


Mark,

RabbitMQ is content agnostic so you can use any serialization library with
it.

For event aggregation, protocol buffers worked well for me. Protocol
buffers help enforce
schema to some extent. Because all events share some properties (e.g.
timestamp, type),
having some structure enforced by the message format is helpful in the long
term.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/65a9925a/attachment.htm>

From static.void.dev at gmail.com  Thu Jun 13 22:56:33 2013
From: static.void.dev at gmail.com (Mark)
Date: Thu, 13 Jun 2013 14:56:33 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Avro
In-Reply-To: <CAE3HoVSHeKs_=swz6h2-JSDbCHW+3E8sZQiepsSRR23mRFmALQ@mail.gmail.com>
References: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
	<CAE3HoVSHeKs_=swz6h2-JSDbCHW+3E8sZQiepsSRR23mRFmALQ@mail.gmail.com>
Message-ID: <833E7FEA-5B07-471C-B057-802B01B0361D@gmail.com>

Thanks Michael. Avro will also enforce a schema hence the whole reason I was asking over something more generic like JSON. The reason Im leaning towards Avro over PB is its tight integration with Hadoop. Some of these events will be shipped over for hadoop for further processing.

Just wanted to make sure I was going in the right direction.

On Jun 13, 2013, at 2:12 PM, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 
> 2013/6/14 Mark <static.void.dev at gmail.com>
> Anyone use Avro with RabbitMQ for event aggregation. Is so, would you mind sharing you experiences?
> 
> Mark,
> 
> RabbitMQ is content agnostic so you can use any serialization library with it.
> 
> For event aggregation, protocol buffers worked well for me. Protocol buffers help enforce
> schema to some extent. Because all events share some properties (e.g. timestamp, type),
> having some structure enforced by the message format is helpful in the long term.
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130613/86596287/attachment.htm>

From umutcan at gamegos.com  Fri Jun 14 08:46:55 2013
From: umutcan at gamegos.com (Umutcan)
Date: Fri, 14 Jun 2013 10:46:55 +0300
Subject: [rabbitmq-discuss] Getting High Memory Watermark Status
In-Reply-To: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
References: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
Message-ID: <51BACA6F.2050405@gamegos.com>

Hello,

I am trying to find a way to get high memory watermak alarm status via 
rabbitmqctl or another tool. I couldn't find it in the documents.

How can I get status of any alarm (socket descriptors, diskspace, memory 
etc.)?

Thanks,

Umutcan.

From brett.r.cameron at gmail.com  Fri Jun 14 08:57:34 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 14 Jun 2013 09:57:34 +0200
Subject: [rabbitmq-discuss] Getting High Memory Watermark Status
In-Reply-To: <51BACA6F.2050405@gamegos.com>
References: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
	<51BACA6F.2050405@gamegos.com>
Message-ID: <CALPqkirGUxwp1o7MvNeBUQXwNXrPVW7KEd6OhyHTqNCRgBUQcg@mail.gmail.com>

Entries written to the RabbitMQ log file are also published to the exchange
"amq.rabbitmq.log". If you create a couple of queues and bind them to this
exchange then you can consume the feed. Note that amq.rabbitmq.log is a
topic exchange, so you can filter out the specific event types that you
want (error, warning, ot info). See
http://videlalvaro.github.io/2010/09/haskell-and-rabbitmq.html for a simple
example in Haskell (but equally as simple with other client languages). I
guess that alarms probably fall into the "warning" category, but don't
quote me on it...

Brett

On Fri, Jun 14, 2013 at 9:46 AM, Umutcan <umutcan at gamegos.com> wrote:

> Hello,
>
> I am trying to find a way to get high memory watermak alarm status via
> rabbitmqctl or another tool. I couldn't find it in the documents.
>
> How can I get status of any alarm (socket descriptors, diskspace, memory
> etc.)?
>
> Thanks,
>
> Umutcan.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/aa3824c3/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jun 14 09:01:46 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 14 Jun 2013 12:01:46 +0400
Subject: [rabbitmq-discuss] Getting High Memory Watermark Status
In-Reply-To: <51BACA6F.2050405@gamegos.com>
References: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
	<51BACA6F.2050405@gamegos.com>
Message-ID: <CAE3HoVTAHf0Fw=M_1SoWU2OFN=nbSMDr8TbFF7VKrntRjhp7_g@mail.gmail.com>

2013/6/14 Umutcan <umutcan at gamegos.com>

> I am trying to find a way to get high memory watermak alarm status via
> rabbitmqctl or another tool. I couldn't find it in the documents.


RabbitMQ HTTP API [1] provides this and related information.

See /api/nodes/{name}.

1.
http://hg.rabbitmq.com/rabbitmq-management/raw-file/fbdc912fa1e5/priv/www/api/index.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/85de55c6/attachment.htm>

From jaspal13.007 at gmail.com  Fri Jun 14 07:38:11 2013
From: jaspal13.007 at gmail.com (Jaspal Singh)
Date: Thu, 13 Jun 2013 23:38:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Tutorial 1-hello world error
Message-ID: <e119a585-730b-4077-bf18-4fcd28b289fa@googlegroups.com>

Hello all,
I am new to Rabbitmq have just finished installation and was trying the 
first tutorial in python but I am getting the following error when I run 
./send.py in my ubunty terminal

jaspal at jaspal-HP-ProBook-4420s:~/rabbitmq tutorials/hello$ ./send.py
No handlers could be found for logger "pika.adapters.base_connection"
Traceback (most recent call last):
  File "./send.py", line 4, in <module>
    connection = 
pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
  File 
"/usr/local/lib/python2.7/dist-packages/pika/adapters/base_connection.py", 
line 61, in __init__
    super(BaseConnection, self).__init__(parameters, on_open_callback)
  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py", line 
513, in __init__
    self._connect()
  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py", line 
804, in _connect
    self._adapter_connect()
  File 
"/usr/local/lib/python2.7/dist-packages/pika/adapters/blocking_connection.py", 
line 146, in _adapter_connect
    self.process_data_events()
  File 
"/usr/local/lib/python2.7/dist-packages/pika/adapters/blocking_connection.py", 
line 88, in process_data_events
    if self._handle_read():
  File 
"/usr/local/lib/python2.7/dist-packages/pika/adapters/blocking_connection.py", 
line 184, in _handle_read
    super(BlockingConnection, self)._handle_read()
  File 
"/usr/local/lib/python2.7/dist-packages/pika/adapters/base_connection.py", 
line 300, in _handle_read
    return self._handle_error(error)
  File 
"/usr/local/lib/python2.7/dist-packages/pika/adapters/base_connection.py", 
line 264, in _handle_error
    self._handle_disconnect()
  File 
"/usr/local/lib/python2.7/dist-packages/pika/adapters/blocking_connection.py", 
line 181, in _handle_disconnect
    self._on_connection_closed(None, True)
  File 
"/usr/local/lib/python2.7/dist-packages/pika/adapters/blocking_connection.py", 
line 235, in _on_connection_closed
    raise exceptions.AMQPConnectionError(*self.closing)
pika.exceptions.AMQPConnectionError: (0, '')

Please help
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130613/17489c96/attachment.htm>

From togirish at gmail.com  Thu Jun 13 20:41:04 2013
From: togirish at gmail.com (Girish Gangadharan)
Date: Thu, 13 Jun 2013 12:41:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Mirrored queues behind a load balancer
Message-ID: <49b335bf-8c06-4d5e-8a33-070ea2df984a@googlegroups.com>

Hello,

I'm trying to set up HA infrastructure for our new project that uses 
RabbitMQ and MassTransit.

I've read and re-read the articles on HA and Mirrored Queues<http://www.rabbitmq.com/ha.html>several times. And I understand the theory behind it. 

However, I do have a few questions. I hope somebody can kindly answer them 
for me.

1. I just set up a cluster with 2 nodes. When I have a client talk to 
either of these nodes, the other node reflects those changes almost 
instantly. For example, if a publisher writes a message to an exchange that 
ends up in a specific queue bound to that exchange, it immediately shows up 
in the same queue on the other node. Likewise, if I manually create a queue 
on one node, it immediately shows up on the other node as well. 


No special policies have been set up, by the way. This is all just out of 
the box. 


And this is expected, I'd assume, since these both nodes are in a cluster. 
But then why does the article on Mirrored Queues say that *you have to 
explicitly set up mirrored queues by policy*?


"Queues have mirroring enabled via policy<http://www.rabbitmq.com/parameters.html#policies>. 
Policies can change at any time; it is valid to create a non-mirrored 
queue, and then make it mirrored at some later point (and vice versa)."


Am I missing something obvious here? 


2. Let's say I have a internal DNS entry that points to a load balancer, 
which in turn sends traffic to either of these nodes mentioned above (based 
on round-robin or whatever algorithm), and ask the clients (publishers and 
consumers) to talk to the DNS entry when it wants to write or read from the 
queues. So if one node goes down, the load balancer would automatically 
redirect all the traffic just to the node that is up and running. And the 
clients will not be affected. Would that work? Is that the recommended 
approach? 

3. Finally, I have a question about DR. Our DR server is on a separate WAN 
in a different state. I was thinking about using Shoveling technique to 
push messages from a logical broker sitting on a cluster in our local HA 
servers to a different logical broker to the DR server. In this case, a 
copy of the messages will keep getting pumped into the DR with no clients 
processing it. What will happen to those messages? Should I have a workflow 
to go purge them every day manually or via a script (after I make sure 
those messages aren't needed anymore since the clients have already process 
them from the main HA cluster). 

If the main HA cluster goes down and I have to bring the DR server into 
action, what happens to the messages that did get processed already by the 
clients? Should the clients have logic built in to ignore duplicates to 
handle this specific scenario?

Thanks in advance for your help,
Girish
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130613/7ad3674a/attachment.htm>

From umutcan at gamegos.com  Fri Jun 14 09:36:54 2013
From: umutcan at gamegos.com (Umutcan)
Date: Fri, 14 Jun 2013 11:36:54 +0300
Subject: [rabbitmq-discuss] Getting High Memory Watermark Status
In-Reply-To: <CAE3HoVTAHf0Fw=M_1SoWU2OFN=nbSMDr8TbFF7VKrntRjhp7_g@mail.gmail.com>
References: <9EEAF146-7161-407F-BC78-ECB43FADE625@gmail.com>
	<51BACA6F.2050405@gamegos.com>
	<CAE3HoVTAHf0Fw=M_1SoWU2OFN=nbSMDr8TbFF7VKrntRjhp7_g@mail.gmail.com>
Message-ID: <51BAD626.20706@gamegos.com>

On 06/14/2013 11:01 AM, Michael Klishin wrote:
> 2013/6/14 Umutcan <umutcan at gamegos.com <mailto:umutcan at gamegos.com>>
>
>     I am trying to find a way to get high memory watermak alarm status
>     via rabbitmqctl or another tool. I couldn't find it in the documents.
>
>
> RabbitMQ HTTP API [1] provides this and related information.
>
> See /api/nodes/{name}.
>
> 1. 
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/fbdc912fa1e5/priv/www/api/index.html

Thanks. This is what I am looking for.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/4c6e3bbe/attachment.htm>

From emile at rabbitmq.com  Fri Jun 14 10:03:37 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 14 Jun 2013 10:03:37 +0100
Subject: [rabbitmq-discuss] Mirrored queues behind a load balancer
In-Reply-To: <49b335bf-8c06-4d5e-8a33-070ea2df984a@googlegroups.com>
References: <49b335bf-8c06-4d5e-8a33-070ea2df984a@googlegroups.com>
Message-ID: <51BADC69.6020501@rabbitmq.com>


Hi,

On 13/06/13 20:41, Girish Gangadharan wrote:
> For example, if a publisher writes a message to an exchange that ends
> up in a specific queue bound to that exchange, it immediately shows
> up in the same queue on the other node.

There is only one queue on one node in this case. The cluster offers a
consistent view of all resources in the cluster and allows producers and
consumers to connect to any node. Messages are transparently routed
across the cluster.

> But then why does the article on Mirrored Queues say that *you have
> to explicitly set up mirrored queues by policy*?

If a queue exists on only one node and that node crashes then the queue
becomes unavailable. Mirrored queues provides resilience by maintaining
copies of the queue that can take over in case a node crashes. See
http://www.rabbitmq.com/ha.html

> So if one node goes down, the load balancer would automatically
> redirect all the traffic just to the node that is up and running. And
> the clients will not be affected. Would that work? Is that the 
> recommended approach?

That is a common approach. Another is to provide clients with reconnect
logic that allows them to select the alternative node when one node crashes.

> I was thinking about using Shoveling technique to push messages from
> a logical broker sitting on a cluster in our local HA servers to a
> different logical broker to the DR server. In this case, a copy of
> the messages will keep getting pumped into the DR with no clients
> processing it. What will happen to those messages?

Nothing will happen to them. They will accumulate in the DR server
unless you take action to remove them, or unless they expire.

> Should I have a workflow to go purge them every day manually or via a
> script (after I make sure those messages aren't needed anymore since
> the clients have already process them from the main HA cluster).

That depends on the specifics of your disaster scenario, your messaging
pattern and how you plan to switch over to your DR environment. Purging
queues after a day sounds reasonable.

> If the main HA cluster goes down and I have to bring the DR server into
> action, what happens to the messages that did get processed already by
> the clients? Should the clients have logic built in to ignore duplicates
> to handle this specific scenario?

Performing deduplication in clients is probably the simplest solution,
or you could mirror the effects of consumers removing messages from
queues in your DR environment.



-Emile





From 314992959 at qq.com  Fri Jun 14 10:19:42 2013
From: 314992959 at qq.com (3k4b251)
Date: Fri, 14 Jun 2013 02:19:42 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c connection block
In-Reply-To: <CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>
References: <1370753477137-27297.post@n5.nabble.com>
	<CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>
Message-ID: <1371201581693-27389.post@n5.nabble.com>

ok.  for example. 

this's  a  thread, we  receive  message from it.
   msg_receive(LPVOID  lpParameter){
       
      amqp_connection_state_t  conn =  (amqp_connection_state_t)lpParameter;

      amqp_frame_t    frame;      
     
      int result;

    result = amqp_simple_wait_frame(conn, &frame);     //block  here
     ......................... // omit  the process of  receive
     ........................ 
}

void main(){
      amqp_connection_state_t  conn  =amqp_new_connection();
     ...............................  // omit the process of  connect
     ...............................
     // I  start the  thread ,  and  it  block  in 
amqp_simple_wait_frame();
     _beginthread(msg_receive,0,this);
    
    //so  next  i  wan declare  a  queue
    amqp_queue_declare(conn,......);  //but  i  find  it  block.  so i can't 
do anything  after.


 amqp_exchange_declare(); amqp_basic_consume(); have the same  problem too. 
I  guess  every  function with  the  parameter  of conn  just block.  
what's  the problem?
    
     

}





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297p27389.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From 314992959 at qq.com  Fri Jun 14 11:18:05 2013
From: 314992959 at qq.com (3k4b251)
Date: Fri, 14 Jun 2013 03:18:05 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c close channel already but still get
 message from the channel
Message-ID: <1371205085350-27390.post@n5.nabble.com>

<http://rabbitmq.1065348.n5.nabble.com/file/n27390/list_queue.jpg> 

you can see  tha   I  get  four  messages  in the  queue -----fb_test_2
,so  I  will  use  function wait_simple_frame()  to  receive   msg in a
thread.


in  the void main(){};

Scene 1:
I  open  the  channel  1  :  amqp_channel_open(conn,1);
ask consumer   :amqp_basic_consume(conn,1...);
I get  the  message from  queue---fb_test_2

Scene 2:
I  did  nothing;
I  block   in the  wait_simple_frame()  and nothing receive;

Scene 3:
I  open the channel  1:  amqp_channel_open(conn,1);
I ask  consumer :  amqp_basic_consume(conn,1...);
then I close the channel immediately :  amqp_channel_close(conn,1); 
but what happens,  I  still  receive  the message... I don't  think  I
should receive them.  what' the problem?



  





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-close-channel-already-but-still-get-message-from-the-channel-tp27390.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From dmitry.andrianov at alertme.com  Fri Jun 14 14:48:37 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Fri, 14 Jun 2013 14:48:37 +0100
Subject: [rabbitmq-discuss] Pre-create queues and exchanges
Message-ID: <51BB1F35.7040909@alertme.com>

Hi guys.
What is the best practices on who should create all the queues and 
exchanges?
I see the three options:
1. consumer-app creates everything and it MUST be started before the 
producer-app
2. both consumer-app and producer-app create these objects on startup so 
it does not matter which one starts first.
3. queues and exchanges are put into the broker configuration so they 
are created automatically when broker starts.

It looks to me that #3 would be the best way. The apps do not need to 
have any code which initialises stuff, user accounts
applications use can be restricted etc.
But I cannot find the "official" way of doing it.
We tried using shovel plugin because it allows you to declare all these 
queues and exchanges to be created.
It kind of works but it feels a bit dodgy.

So what is the right way?

Thanks!

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From dmitry.andrianov at alertme.com  Fri Jun 14 17:43:17 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Fri, 14 Jun 2013 17:43:17 +0100
Subject: [rabbitmq-discuss] Java client and Qpid
Message-ID: <51BB4825.6070001@alertme.com>

Hi.

I have a Java application which acts a bit like Shovel plugin - it 
receives messages from one AMQP broker (Apache Qpid) and forwards them 
to another (RabbitMQ). As the RabbitMQ is the "main" broker, I'm using 
its Java library to connect to both.

And it is that Qpid to Rabbit Java client integration point that is 
giving me headache.
I'm not sure what exactly is going on but after some debugging it looks 
to me that scenario is like this:
1. The queue already has some messages at the moment I try to run 
basicConsume() on it (it is a durable queue)
2. ChannelN.basicConsume() begins its RPC call and waits for the reply
3. ChannelN.processAsync() gets invoked with the first message BEFORE 
the reply to that RPC is received
4. As there is no ConsumerTag yet in the _consumers map (it gets there 
when RPC completes), processAsync() throws "Unsolicited delivery" exception.

Unfortunately I do not know the protocol well enough to understand if 
Qpid violates it by sending me a message before sending reply to 
basicConsume request or not. Without reading the specs I would assume 
that this behaviour is a valid one and it is RabbitMQ Java client that 
needs to be more tolerant.

Could you please advise?

Thank you.


This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From alan.antonuk at gmail.com  Fri Jun 14 17:48:58 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 14 Jun 2013 09:48:58 -0700
Subject: [rabbitmq-discuss] rabbitmq-c connection block
In-Reply-To: <1371201581693-27389.post@n5.nabble.com>
References: <1370753477137-27297.post@n5.nabble.com>
	<CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>
	<1371201581693-27389.post@n5.nabble.com>
Message-ID: <CAAt2poJOd+n5nxeSRiLEq3hncEVUi-DJtiiaCzRFH5D3kOL93g@mail.gmail.com>

The amqp_connection_state_t object is not thread-safe: concurrent use of
the object from multiple threads will result in undefined behavior. You
must synchronize use of the amqp_connection_state_t object in your
application

-Alan


On Fri, Jun 14, 2013 at 2:19 AM, 3k4b251 <314992959 at qq.com> wrote:

> ok.  for example.
>
> this's  a  thread, we  receive  message from it.
>    msg_receive(LPVOID  lpParameter){
>
>       amqp_connection_state_t  conn =
>  (amqp_connection_state_t)lpParameter;
>
>       amqp_frame_t    frame;
>
>       int result;
>
>     result = amqp_simple_wait_frame(conn, &frame);     //block  here
>      ......................... // omit  the process of  receive
>      ........................
> }
>
> void main(){
>       amqp_connection_state_t  conn  =amqp_new_connection();
>      ...............................  // omit the process of  connect
>      ...............................
>      // I  start the  thread ,  and  it  block  in
> amqp_simple_wait_frame();
>      _beginthread(msg_receive,0,this);
>
>     //so  next  i  wan declare  a  queue
>     amqp_queue_declare(conn,......);  //but  i  find  it  block.  so i
> can't
> do anything  after.
>
>
>  amqp_exchange_declare(); amqp_basic_consume(); have the same  problem too.
> I  guess  every  function with  the  parameter  of conn  just block.
> what's  the problem?
>
>
>
> }
>
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297p27389.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/292fe766/attachment.htm>

From simon at rabbitmq.com  Fri Jun 14 17:52:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Jun 2013 17:52:15 +0100
Subject: [rabbitmq-discuss] Java client and Qpid
In-Reply-To: <51BB4825.6070001@alertme.com>
References: <51BB4825.6070001@alertme.com>
Message-ID: <51BB4A3F.4040505@rabbitmq.com>

On 14/06/13 17:43, Dmitry Andrianov wrote:
> Unfortunately I do not know the protocol well enough to understand if
>  Qpid violates it by sending me a message before sending reply to
> basicConsume request or not. Without reading the specs I would assume
>  that this behaviour is a valid one and it is RabbitMQ Java client
> that needs to be more tolerant.

 From the spec:

> Section 4.6, Content Synchronisation:
>
> In certain cases synchronous request-response methods have an impact
> on asynchronous content delivery on the same channel, including:
>
> * The Basic.Consume and Basic.Cancel methods, which start and stop
> the flow of messages from a message queue.

[Snip a couple of other cases]

> Guidelines for implementers:
>
> * The effects of the request-response MUST NOT be visible on the
> channel before the response method, and MUST be visible thereafter.

So I'm afraid it's QPid at fault. (Which version are you using? I
thought they had abandoned support for AMQP 0-9-1 some time ago.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 14 18:02:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Jun 2013 18:02:36 +0100
Subject: [rabbitmq-discuss] Pre-create queues and exchanges
In-Reply-To: <51BB1F35.7040909@alertme.com>
References: <51BB1F35.7040909@alertme.com>
Message-ID: <51BB4CAC.8060802@rabbitmq.com>

On 14/06/13 14:48, Dmitry Andrianov wrote:
> Hi guys.
> What is the best practices on who should create all the queues and
> exchanges?

Whichever works best for you :)

> I see the three options:
> 1. consumer-app creates everything and it MUST be started before the
> producer-app

That's probably not ideal.

> 2. both consumer-app and producer-app create these objects on startup so
> it does not matter which one starts first.

This is probably closest to "the spirit" of AMQP. I think the 
expectation is that producers and consumers should declare the things 
that they directly interact with. So for example for pub-sub a producer 
would only declare the exchange it would publish to, and then consumers 
declare exchange, queue and binding.

> 3. queues and exchanges are put into the broker configuration so they
> are created automatically when broker starts.

This keeps your apps free of the need to declare things - but it's only 
going to work if your configuration is quite static.

> It looks to me that #3 would be the best way. The apps do not need to
> have any code which initialises stuff, user accounts
> applications use can be restricted etc.
> But I cannot find the "official" way of doing it.
> We tried using shovel plugin because it allows you to declare all these
> queues and exchanges to be created.
> It kind of works but it feels a bit dodgy.

You can do that - or use 
http://www.rabbitmq.com/management.html#load-definitions

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 14 18:09:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Jun 2013 18:09:49 +0100
Subject: [rabbitmq-discuss] 10 consumers on a queue delivers 10x too
 many messages
In-Reply-To: <CAPhD6FFCuqp-_P5zk=5R3oJ7vhb+ib0ZorHYfZPZwMR8aWtU6g@mail.gmail.com>
References: <CAPhD6FFCuqp-_P5zk=5R3oJ7vhb+ib0ZorHYfZPZwMR8aWtU6g@mail.gmail.com>
Message-ID: <51BB4E5D.5010708@rabbitmq.com>

Hmm.

Are these numbers coming from the management plugin or are they as 
reported by your applications?

If they are coming from the management plugin, are you seeing any 
redelivered messages being reported?

If they are reported by your applications, what does the management 
plugin report? (And do the applications see the "redelivered" flag set?)

(Oh, and which version of RabbitMQ are you running?)

Cheers, Simon

On 13/06/13 18:39, David Goehrig wrote:
> Recently I've had 3 applications all start misbehaving in the same way.
>
> I have a topic exchange called alerts that is bound to 4 queues via the
> same routing key #
>
> debug, hits, words, score
>
> The alerts exchange is recieving 10 messages per second, which is the
> same as the number published to that exchange by the nodes processing
> messages.  The exchange shows 40
> messages per second total outbound.
>
> Each of the 4 queues show 10 messages per second incoming and the queues
> each have a 3 day
> TTL on the messages, with the exception of debug which has a 5 minute.
>
> Now debug queue as expected shows a pretty steady backlog hovering
> around 3000 message (which is correct) and with no consumers doesn't
> show any weird behavior.
>
> The other 3 queues each have 10 consumers bound to them and are showing
> an average of 100 message per second being delivered to each consumer,
> with each consumer recieving approximately 10 messages per second on
> average.  (the distribution doesn't look even though but more likely
> random).   These queues report 10 messages per second incoming, but show
> 100 messages per second outbound.
>
> Looking over the report and the configs for each queue, nothing obvious
> jumps out as to why the queues are behaving this way.  And until this
> week, they've run perfectly fine for months.
>
> Anyone have any idea how this could happen/
>
> Dave
>
> --
> -=-=-=-=-=-=-=-=-=-=- http://blog.dloh.org/
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 14 18:11:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Jun 2013 18:11:40 +0100
Subject: [rabbitmq-discuss] BasicPublish in .NET using client 2.8.1.0
 and transaction support
In-Reply-To: <d3b35a32-18c9-43ee-ac06-64e5872285e7@googlegroups.com>
References: <d3b35a32-18c9-43ee-ac06-64e5872285e7@googlegroups.com>
Message-ID: <51BB4ECC.1000409@rabbitmq.com>

On 13/06/13 19:02, martywaz wrote:
> When calling BasicPublish in .NET c#, is it required to explicitly make
> a call to DtxStart and TxCommit to ensure that the message published is
> within a transaction?

TxStart, not DtxStart; RabbitMQ does not support DTX. But yes, that's 
how you publish in transactions.

Cheers, Simon

>
> for example, our psudo code for creating a connection is this:
>
>              var connectionFactory = new ConnectionFactory
>              {
>                  HostName = this.hostName,
>                  Password = this.password,
>                  Port = this.port != -1 ? this.port :
> AmqpTcpEndpoint.UseDefaultPort,
>                  UserName = this.userName,
>                  Protocol = Protocols.FromConfiguration()
>              };
>              this.connection = connectionFactory.CreateConnection();
>              this.connection.ConnectionShutdown +=
> this.ConnectionOnConnectionShutdown;
>              this.model = this.connection.CreateModel();
>
>              if (this.properties.Durable)
>              {
>                  this.model.ConfirmSelect();
>              }
>
>              this.model.BasicAcks += new
> BasicAckEventHandler(this.MessageAcknowledged);
>              this.model.BasicNacks += this.MessageNotAcknowledged;
>              this.model.BasicReturn += this.MessageReturned;
>              this.model.FlowControl += this.FlowControlChanged;
>              this.model.CallbackException += ReportCallbackException;
>
> and psudo publish code looks like this:
>
>                           this.model.BasicPublish(
>                          this.exchangeName,
>                          string.Empty,
>                          this.properties.Durable,
>                          this.properties.Immediate,
>                          messageProperties,
>                          body);
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From alan.antonuk at gmail.com  Fri Jun 14 18:13:15 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 14 Jun 2013 10:13:15 -0700
Subject: [rabbitmq-discuss] rabbitmq-c close channel already but still
 get message from the channel
In-Reply-To: <1371205085350-27390.post@n5.nabble.com>
References: <1371205085350-27390.post@n5.nabble.com>
Message-ID: <CAAt2poLz1srVxQFGwXSp68nXGUu=sFMeS+MLi0NDH2j_7gcbLA@mail.gmail.com>

Inlined below.

-Alan

On Fri, Jun 14, 2013 at 3:18 AM, 3k4b251 <314992959 at qq.com> wrote:

> <http://rabbitmq.1065348.n5.nabble.com/file/n27390/list_queue.jpg>
>
> you can see  tha   I  get  four  messages  in the  queue -----fb_test_2
> ,so  I  will  use  function wait_simple_frame()  to  receive   msg in a
> thread.
>
>
> in  the void main(){};
>
> Scene 1:
> I  open  the  channel  1  :  amqp_channel_open(conn,1);
> ask consumer   :amqp_basic_consume(conn,1...);
> I get  the  message from  queue---fb_test_2
>
> Scene 2:
> I  did  nothing;
> I  block   in the  wait_simple_frame()  and nothing receive;
>
> Scene 3:
> I  open the channel  1:  amqp_channel_open(conn,1);
> I ask  consumer :  amqp_basic_consume(conn,1...);
> then I close the channel immediately :  amqp_channel_close(conn,1);
> but what happens,  I  still  receive  the message... I don't  think  I
> should receive them.  what' the problem?
>

You're seeing the result of the network buffering. As soon as the broker
received the basic.consume method, if there are messages in the queue, the
broker will start sending queued messages to the client. Even though you
immediately closed the channel, because it takes time to send the
channel.close method across the network, the broker will still have time to
send messages to the client before the channel is closed. You are seeing
messages that are sent before the broker closes the channel.

This is expected behavior.


>
>
>
>
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-close-channel-already-but-still-get-message-from-the-channel-tp27390.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/b1899e13/attachment.htm>

From dmitry.andrianov at alertme.com  Fri Jun 14 19:04:23 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Fri, 14 Jun 2013 19:04:23 +0100
Subject: [rabbitmq-discuss] Java client and Qpid
In-Reply-To: <51BB4A3F.4040505@rabbitmq.com>
References: <51BB4825.6070001@alertme.com> <51BB4A3F.4040505@rabbitmq.com>
Message-ID: <0E18BE7B-0B8A-47A7-BCC7-A3AC4031A700@alertme.com>

Simon,
many thanks for the prompt reply.

I use Qpid 0.20, Next week will try to create simple test case and run it against both 0.20 and the latest 0.22

If problem is reproducible - will raise issue on their bugtracker quoting you )

Thanks 


On 14 Jun 2013, at 17:52, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/06/13 17:43, Dmitry Andrianov wrote:
>> Unfortunately I do not know the protocol well enough to understand if
>> Qpid violates it by sending me a message before sending reply to
>> basicConsume request or not. Without reading the specs I would assume
>> that this behaviour is a valid one and it is RabbitMQ Java client
>> that needs to be more tolerant.
> 
> From the spec:
> 
>> Section 4.6, Content Synchronisation:
>> 
>> In certain cases synchronous request-response methods have an impact
>> on asynchronous content delivery on the same channel, including:
>> 
>> * The Basic.Consume and Basic.Cancel methods, which start and stop
>> the flow of messages from a message queue.
> 
> [Snip a couple of other cases]
> 
>> Guidelines for implementers:
>> 
>> * The effects of the request-response MUST NOT be visible on the
>> channel before the response method, and MUST be visible thereafter.
> 
> So I'm afraid it's QPid at fault. (Which version are you using? I
> thought they had abandoned support for AMQP 0-9-1 some time ago.)
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mklishin at gopivotal.com  Fri Jun 14 21:03:23 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 15 Jun 2013 00:03:23 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.rc1 is released
Message-ID: <0482243B-0AFB-44F8-86A0-00FBFDD533CA@gopivotal.com>

Bunny 0.9.0.rc1 is released  [1].

This release adds TLS support and makes Bunny feature complete.
Bunny 0.9 is now solid enough to label it an RC. Please give it a try and
report any issues you may find.

Release notes for RC1:
http://blog.rubyrabbitmq.info/blog/2013/06/14/bunny-0-dot-9-0-dot-rc1-is-released/

There will be a couple of minor additions before 0.9.0 final and the docs [2] will be
further improved. However, all the important features and design decisions for 0.9
are done and ready for more people to test drive.

1. https://rubygems.org/gems/bunny/versions/0.9.0.rc1
2. http://rubybunny.info

MK



From 314992959 at qq.com  Sat Jun 15 02:42:46 2013
From: 314992959 at qq.com (3k4b251)
Date: Fri, 14 Jun 2013 18:42:46 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c connection block
In-Reply-To: <CAAt2poJOd+n5nxeSRiLEq3hncEVUi-DJtiiaCzRFH5D3kOL93g@mail.gmail.com>
References: <1370753477137-27297.post@n5.nabble.com>
	<CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>
	<1371201581693-27389.post@n5.nabble.com>
	<CAAt2poJOd+n5nxeSRiLEq3hncEVUi-DJtiiaCzRFH5D3kOL93g@mail.gmail.com>
Message-ID: <1371260566585-27401.post@n5.nabble.com>

if  I synchronize use  it,  I think  i  will  block  my application there. 
what  should  I  do  to  keep  the  amqp_connection_state_t  safe  but  not 
block?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297p27401.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From 314992959 at qq.com  Sat Jun 15 02:57:55 2013
From: 314992959 at qq.com (3k4b251)
Date: Fri, 14 Jun 2013 18:57:55 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c close channel already but still
 get message from the channel
In-Reply-To: <CAAt2poLz1srVxQFGwXSp68nXGUu=sFMeS+MLi0NDH2j_7gcbLA@mail.gmail.com>
References: <1371205085350-27390.post@n5.nabble.com>
	<CAAt2poLz1srVxQFGwXSp68nXGUu=sFMeS+MLi0NDH2j_7gcbLA@mail.gmail.com>
Message-ID: <1371261475703-27402.post@n5.nabble.com>

you means the  broker  send messages  to client   as soon  as   use
basic.consume() ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-close-channel-already-but-still-get-message-from-the-channel-tp27390p27402.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Sat Jun 15 04:24:59 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 14 Jun 2013 20:24:59 -0700
Subject: [rabbitmq-discuss] rabbitmq-c close channel already but still
 get message from the channel
In-Reply-To: <1371261475703-27402.post@n5.nabble.com>
References: <1371205085350-27390.post@n5.nabble.com>
	<CAAt2poLz1srVxQFGwXSp68nXGUu=sFMeS+MLi0NDH2j_7gcbLA@mail.gmail.com>
	<1371261475703-27402.post@n5.nabble.com>
Message-ID: <CAAt2poKWthTHyLX3t3ske+049xy1v2+xggUb1JsQh_r58PYXTg@mail.gmail.com>

Yes.

Another way to look at is basic.consume starts asynchronous delivery of
messages from the broker to the client.


On Fri, Jun 14, 2013 at 6:57 PM, 3k4b251 <314992959 at qq.com> wrote:

> you means the  broker  send messages  to client   as soon  as   use
> basic.consume() ?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-close-channel-already-but-still-get-message-from-the-channel-tp27390p27402.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/d5c29feb/attachment.htm>

From alan.antonuk at gmail.com  Sat Jun 15 04:31:34 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 14 Jun 2013 20:31:34 -0700
Subject: [rabbitmq-discuss] rabbitmq-c connection block
In-Reply-To: <1371260566585-27401.post@n5.nabble.com>
References: <1370753477137-27297.post@n5.nabble.com>
	<CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>
	<1371201581693-27389.post@n5.nabble.com>
	<CAAt2poJOd+n5nxeSRiLEq3hncEVUi-DJtiiaCzRFH5D3kOL93g@mail.gmail.com>
	<1371260566585-27401.post@n5.nabble.com>
Message-ID: <CAAt2poJUeq=gQTQd5_-w=UoV8ZNyp2+h29tfvZUcrvf8kA5Epg@mail.gmail.com>

My suggestion is to not share the amqp_connection_state_t between threads.

-Alan


On Fri, Jun 14, 2013 at 6:42 PM, 3k4b251 <314992959 at qq.com> wrote:

> if  I synchronize use  it,  I think  i  will  block  my application there.
> what  should  I  do  to  keep  the  amqp_connection_state_t  safe  but  not
> block?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297p27401.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/fdcadd15/attachment.htm>

From 314992959 at qq.com  Sat Jun 15 05:06:56 2013
From: 314992959 at qq.com (3k4b251)
Date: Fri, 14 Jun 2013 21:06:56 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c connection block
In-Reply-To: <CAAt2poJUeq=gQTQd5_-w=UoV8ZNyp2+h29tfvZUcrvf8kA5Epg@mail.gmail.com>
References: <1370753477137-27297.post@n5.nabble.com>
	<CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>
	<1371201581693-27389.post@n5.nabble.com>
	<CAAt2poJOd+n5nxeSRiLEq3hncEVUi-DJtiiaCzRFH5D3kOL93g@mail.gmail.com>
	<1371260566585-27401.post@n5.nabble.com>
	<CAAt2poJUeq=gQTQd5_-w=UoV8ZNyp2+h29tfvZUcrvf8kA5Epg@mail.gmail.com>
Message-ID: <1371269216698-27407.post@n5.nabble.com>

but   the function  amqp_simple_wait_frame()  need   amqp_connection_state_t.   
if  I  do  not  use thead to handle  amqp_simple_wait_frame.....  I face the
block  of my program.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297p27407.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Sat Jun 15 06:05:41 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 14 Jun 2013 22:05:41 -0700
Subject: [rabbitmq-discuss] rabbitmq-c connection block
In-Reply-To: <1371269216698-27407.post@n5.nabble.com>
References: <1370753477137-27297.post@n5.nabble.com>
	<CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>
	<1371201581693-27389.post@n5.nabble.com>
	<CAAt2poJOd+n5nxeSRiLEq3hncEVUi-DJtiiaCzRFH5D3kOL93g@mail.gmail.com>
	<1371260566585-27401.post@n5.nabble.com>
	<CAAt2poJUeq=gQTQd5_-w=UoV8ZNyp2+h29tfvZUcrvf8kA5Epg@mail.gmail.com>
	<1371269216698-27407.post@n5.nabble.com>
Message-ID: <CAAt2po+ZFDDnTTM7JRfiPmK29-5nt6iT3gjnvyVh8fz9i58C3A@mail.gmail.com>

Ok, lets back up a bit: at a high level, what are you trying to accomplish?


On Fri, Jun 14, 2013 at 9:06 PM, 3k4b251 <314992959 at qq.com> wrote:

> but   the function  amqp_simple_wait_frame()  need
> amqp_connection_state_t.
> if  I  do  not  use thead to handle  amqp_simple_wait_frame.....  I face
> the
> block  of my program.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297p27407.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/c082f72b/attachment.htm>

From 314992959 at qq.com  Sat Jun 15 06:55:21 2013
From: 314992959 at qq.com (3k4b251)
Date: Fri, 14 Jun 2013 22:55:21 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c connection block
In-Reply-To: <CAAt2po+ZFDDnTTM7JRfiPmK29-5nt6iT3gjnvyVh8fz9i58C3A@mail.gmail.com>
References: <1370753477137-27297.post@n5.nabble.com>
	<CAAt2po+fjiB6VnUw7-bUhoHtdv_pp18TmhHHecqpp1d65Ve2DQ@mail.gmail.com>
	<1371201581693-27389.post@n5.nabble.com>
	<CAAt2poJOd+n5nxeSRiLEq3hncEVUi-DJtiiaCzRFH5D3kOL93g@mail.gmail.com>
	<1371260566585-27401.post@n5.nabble.com>
	<CAAt2poJUeq=gQTQd5_-w=UoV8ZNyp2+h29tfvZUcrvf8kA5Epg@mail.gmail.com>
	<1371269216698-27407.post@n5.nabble.com>
	<CAAt2po+ZFDDnTTM7JRfiPmK29-5nt6iT3gjnvyVh8fz9i58C3A@mail.gmail.com>
Message-ID: <1371275721609-27409.post@n5.nabble.com>

I  want  to  receive  messages  ,but  at the  same  time  I  want  to  
delcare  queues  or  apply  consumer... 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-connection-block-tp27297p27409.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From brett.r.cameron at gmail.com  Sat Jun 15 06:55:50 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sat, 15 Jun 2013 17:55:50 +1200
Subject: [rabbitmq-discuss] rabbitmq-c close channel already but still
 get message from the channel
In-Reply-To: <1371261475703-27402.post@n5.nabble.com>
References: <1371205085350-27390.post@n5.nabble.com>
	<CAAt2poLz1srVxQFGwXSp68nXGUu=sFMeS+MLi0NDH2j_7gcbLA@mail.gmail.com>
	<1371261475703-27402.post@n5.nabble.com>
Message-ID: <CALPqkiqG_gABgDJs2FwnSa_3je+jiNDFdpjmGmqDKykthnuMvQ@mail.gmail.com>

If you just want your client to "pull" one message at a time then you can
use amqp_basic_get() (AMQP basic.get) instead of doing the basic.consume
thing; however this is a generally less efficient (although somewhat
simpler to implement).

Brett


On Sat, Jun 15, 2013 at 1:57 PM, 3k4b251 <314992959 at qq.com> wrote:

> you means the  broker  send messages  to client   as soon  as   use
> basic.consume() ?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-close-channel-already-but-still-get-message-from-the-channel-tp27390p27402.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130615/ac6ad307/attachment.htm>

From 314992959 at qq.com  Sat Jun 15 07:01:48 2013
From: 314992959 at qq.com (3k4b251)
Date: Fri, 14 Jun 2013 23:01:48 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c close channel already but still
 get message from the channel
In-Reply-To: <CAAt2poKWthTHyLX3t3ske+049xy1v2+xggUb1JsQh_r58PYXTg@mail.gmail.com>
References: <1371205085350-27390.post@n5.nabble.com>
	<CAAt2poLz1srVxQFGwXSp68nXGUu=sFMeS+MLi0NDH2j_7gcbLA@mail.gmail.com>
	<1371261475703-27402.post@n5.nabble.com>
	<CAAt2poKWthTHyLX3t3ske+049xy1v2+xggUb1JsQh_r58PYXTg@mail.gmail.com>
Message-ID: <1371276108810-27411.post@n5.nabble.com>

that's  a  good  idea;   thank  you !



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-close-channel-already-but-still-get-message-from-the-channel-tp27390p27411.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From girish at giri.sh  Fri Jun 14 16:37:07 2013
From: girish at giri.sh (Girish Gangadharan)
Date: Fri, 14 Jun 2013 10:37:07 -0500
Subject: [rabbitmq-discuss] Mirrored queues behind a load balancer
In-Reply-To: <51BADC69.6020501@rabbitmq.com>
References: <49b335bf-8c06-4d5e-8a33-070ea2df984a@googlegroups.com>
	<51BADC69.6020501@rabbitmq.com>
Message-ID: <CAGT39YvSuJCUwQv8Bm+WEhkR3NncgXb5NP=1GQiitJKOnpyGiA@mail.gmail.com>

Thanks for your reply. Please see my response in red.

On Fri, Jun 14, 2013 at 4:03 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 13/06/13 20:41, Girish Gangadharan wrote:
> > For example, if a publisher writes a message to an exchange that ends
> > up in a specific queue bound to that exchange, it immediately shows
> > up in the same queue on the other node.
>
> There is only one queue on one node in this case. The cluster offers a
> consistent view of all resources in the cluster and allows producers and
> consumers to connect to any node. Messages are transparently routed
> across the cluster.
>

Does this mean that the queues actually exist only in one node to whose
exchange the message was originally written to? And the fact that I can see
them in the admin console of the other node is just to provide a consistent
view across the cluster? So any action that I do with the original queue on
the other nodes' admin consoles basically makes the changes to the queue on
the original node and not to the copy of that queue on the other nodes? In
fact, if I understand you correctly, there IS no copy of the queue on the
other nodes? Did I get that right?

Not sure I understand the consistent view explanation either? What are the
main benefits of having multiple nodes in a cluster if they can't really
share anything? I would think Mirrored Queues should be an automatic
by-product of clustering, thus offering HA out of the box. Can you explain
to me why somebody would create a cluster of nodes and NOT have mirrored
queues set up?


>
> > But then why does the article on Mirrored Queues say that *you have
> > to explicitly set up mirrored queues by policy*?
>
> If a queue exists on only one node and that node crashes then the queue
> becomes unavailable. Mirrored queues provides resilience by maintaining
> copies of the queue that can take over in case a node crashes. See
> http://www.rabbitmq.com/ha.html
>
> > So if one node goes down, the load balancer would automatically
> > redirect all the traffic just to the node that is up and running. And
> > the clients will not be affected. Would that work? Is that the
> > recommended approach?
>
> That is a common approach. Another is to provide clients with reconnect
> logic that allows them to select the alternative node when one node
> crashes.
>
> > I was thinking about using Shoveling technique to push messages from
> > a logical broker sitting on a cluster in our local HA servers to a
> > different logical broker to the DR server. In this case, a copy of
> > the messages will keep getting pumped into the DR with no clients
> > processing it. What will happen to those messages?
>
> Nothing will happen to them. They will accumulate in the DR server
> unless you take action to remove them, or unless they expire.
>
> > Should I have a workflow to go purge them every day manually or via a
> > script (after I make sure those messages aren't needed anymore since
> > the clients have already process them from the main HA cluster).
>
> That depends on the specifics of your disaster scenario, your messaging
> pattern and how you plan to switch over to your DR environment. Purging
> queues after a day sounds reasonable.
>
> > If the main HA cluster goes down and I have to bring the DR server into
> > action, what happens to the messages that did get processed already by
> > the clients? Should the clients have logic built in to ignore duplicates
> > to handle this specific scenario?
>
> Performing deduplication in clients is probably the simplest solution,
> or you could mirror the effects of consumers removing messages from
> queues in your DR environment.
>
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/0a4dc238/attachment.htm>

From johnzaborow at gmail.com  Fri Jun 14 17:33:20 2013
From: johnzaborow at gmail.com (John Zaborowski)
Date: Fri, 14 Jun 2013 09:33:20 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ service is not starting
Message-ID: <815ef770-4155-4ee5-8e93-7dada41d1518@googlegroups.com>

I cannot enable the management plug ins. which lead me down this rabbit 
hole to discover that the service crashes upon booting up. 

From tmehlinger at gmail.com  Sat Jun 15 03:09:21 2013
From: tmehlinger at gmail.com (Travis Mehlinger)
Date: Fri, 14 Jun 2013 19:09:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
Message-ID: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>

We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two bug 
fixes in 3.1.0 related to our RabbitMQ deployment:

   - 25524 fix memory leak in mirror queue slave with many short-lived 
   publishing channel
   - 25290 fix per-queue memory leak recording stats for mirror queue slaves

However, in our case, it seems that the management plugin may still have a 
memory leak. We have a monitoring agent that hits the REST API to gather 
information about the broker (number of queues, queue depth, etc.). With 
the monitoring agent running and making requests against the API, memory 
consumption steadily increased; when we stopped the agent, memory 
consumption in the management plugin leveled off.

Here a couple graphs detailing memory consumption in the broker (the 
figures are parsed from rabbitmqctl report). The first graph shows the ebb 
and flow of memory consumption in a number of components and the second 
shows just consumption by the management plugin. You can see pretty clearly 
where we stopped the monitoring agent at 1:20.

https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png
https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png

We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang 
R14B-04.1. There are typically around 200 queues, about 20 of which are 
mirrored. There are generally about 200 consumers. Messages are rarely 
queued and most queues typically sit idle.

I'll be happy to provide any further diagnostic information.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/308e884e/attachment.htm>

From michael.s.klishin at gmail.com  Sat Jun 15 15:26:29 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 15 Jun 2013 18:26:29 +0400
Subject: [rabbitmq-discuss] RabbitMQ service is not starting
In-Reply-To: <815ef770-4155-4ee5-8e93-7dada41d1518@googlegroups.com>
References: <815ef770-4155-4ee5-8e93-7dada41d1518@googlegroups.com>
Message-ID: <CAE3HoVTNn5B6eT_9VsUT8w7yzd+66sXZZncgGPRU4cEA0Mq4Zg@mail.gmail.com>

2013/6/14 John Zaborowski <johnzaborow at gmail.com>

> Error description:
>    {error,
>        {cannot_read_enabled_plugins_file,
>
>  "C:/Users/john.z/AppData/Roaming/RabbitMQ/enabled_plugins",eisdir}}
>

enabled_plugins is supposed to be a file but for some reason, on your
machine it is a directory.

Removing it and creating a file with "[]." (note the dot) should help.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130615/80f7bbd8/attachment.htm>

From francois at teksol.info  Sun Jun 16 16:00:52 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Sun, 16 Jun 2013 11:00:52 -0400
Subject: [rabbitmq-discuss] Number formatting in management console
Message-ID: <FF367CAF-0CB1-470B-90D7-5946F2793B24@teksol.info>

Hi!

It would be nice if the numbers on the management console were formatted to be more comprehensible. 1427251 is harder to read and comprehend than 1,427,251 or "~1.4M". Same goes for the graph axis.

Bye!
Fran?ois Beausoleil

-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ Management.jpg
Type: image/jpg
Size: 28598 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130616/fbc59c60/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130616/fbc59c60/attachment.bin>

From matthias at rabbitmq.com  Sun Jun 16 22:25:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 16 Jun 2013 22:25:34 +0100
Subject: [rabbitmq-discuss] Is there a way to receive multiple message
 using a single synchronous call ?
In-Reply-To: <51B5F994.5000100@gmail.com>
References: <17de8d3d-c8c8-475e-bafa-caffd93142f9@googlegroups.com>
	<5190BF33.1010902@rabbitmq.com>
	<1369255851048-26944.post@n5.nabble.com>
	<519E33A3.9010700@rabbitmq.com> <51B3D92B.5090803@gmail.com>
	<51B5A4EC.4000203@rabbitmq.com> <51B5F994.5000100@gmail.com>
Message-ID: <51BE2D4E.7010405@rabbitmq.com>

Vikram,

On 10/06/13 17:06, Vikram Viswanathan wrote:
> I have another question. If I use basic.consume, register a callback,
> then is there a way where I can can cancel the consumer after N message
> is received ?

1) Set the basic.qos prefetch to N.
2) Create the consumer with basic.consume.
3) As you receive the messages, do not acknowledge them one by one. 
Instead wait for them all to arrive.
4) Cancel the consumer with basic.cancel.
5) Send a single ack with the 'multiple' flag set.

> I tried calling Channel.basicCancel(consumerTag) in the callback, but
> this cancels the consumer only after all messages in the queue is
> received.

That would be because you didn't set the basic.qos prefetch first.

> I do not want to make basic.get() with a timeout because this
> will cause my thread to block for the duration

That wouldn't work anyway since basic.get will not wait for messages to 
arrive in the queue; it returns basic.get-empty instead when the queue 
is empty.


Regards,

Matthias.


From matthias at rabbitmq.com  Sun Jun 16 22:27:36 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 16 Jun 2013 22:27:36 +0100
Subject: [rabbitmq-discuss] Clustering Linux and Windows machines
In-Reply-To: <CAPrynAXxUsTOcPKY1D7sbvNB0kcTr045--w6iX3CH91wY6xN1Q@mail.gmail.com>
References: <CAPrynAVSvAtoySeqQJRYhdv9vPp-kSSSmdBCzpXSfVijz4tRWg@mail.gmail.com>
	<5167D919.6010908@rabbitmq.com>
	<CAPrynAXxUsTOcPKY1D7sbvNB0kcTr045--w6iX3CH91wY6xN1Q@mail.gmail.com>
Message-ID: <51BE2DC8.7060903@rabbitmq.com>

Mahesh,

On 12/06/13 12:59, Mahesh Viraktamath wrote:
> Is it that rabbitmq relies on the hostnames to connect multiple nodes?

Correct.

> What if the nodes are on different networks?

You shouldn't cluster across networks, due to 
http://www.rabbitmq.com/partitions.html


Regards,

Matthias.

From matthias at rabbitmq.com  Sun Jun 16 22:31:32 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 16 Jun 2013 22:31:32 +0100
Subject: [rabbitmq-discuss] XML in RabbitMQ with Stomp protocol
In-Reply-To: <8ee31807-64f5-4392-9a07-1d447fe980d9@googlegroups.com>
References: <8ee31807-64f5-4392-9a07-1d447fe980d9@googlegroups.com>
Message-ID: <51BE2EB4.6070302@rabbitmq.com>

On 12/06/13 16:21, Maria Garcia wrote:
>     I am trying to send and receive a XML with a RabbitMQ + Stomp and a
>     browser client, I also use SockJS . First, I send and receive a
>     simple text message without problems, but when I send a XML, I lost
>     my connection and I don't know why. Any idea?

Stomp shouldn't care about the message payload.

Check the server logs for any errors.

Matthias.

From matthias at rabbitmq.com  Sun Jun 16 22:47:54 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 16 Jun 2013 22:47:54 +0100
Subject: [rabbitmq-discuss] Tutorial 1-hello world error
In-Reply-To: <e119a585-730b-4077-bf18-4fcd28b289fa@googlegroups.com>
References: <e119a585-730b-4077-bf18-4fcd28b289fa@googlegroups.com>
Message-ID: <51BE328A.70907@rabbitmq.com>

On 14/06/13 07:38, Jaspal Singh wrote:
> I am new to Rabbitmq have just finished installation and was trying the
> first tutorial in python but I am getting the following error when I run
> ./send.py in my ubunty terminal
>
> jaspal at jaspal-HP-ProBook-4420s:~/rabbitmq tutorials/hello$ ./send.py
> [...]
> pika.exceptions.AMQPConnectionError: (0, '')

Check that your broker is running with 'rabbitmqctl status'. And check 
the broker log for any errors.

Matthias.

From mcintoshj at gmail.com  Mon Jun 17 05:24:14 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Sun, 16 Jun 2013 23:24:14 -0500
Subject: [rabbitmq-discuss] Mirrored queues behind a load balancer
In-Reply-To: <CAGT39YvSuJCUwQv8Bm+WEhkR3NncgXb5NP=1GQiitJKOnpyGiA@mail.gmail.com>
References: <49b335bf-8c06-4d5e-8a33-070ea2df984a@googlegroups.com>
	<51BADC69.6020501@rabbitmq.com>
	<CAGT39YvSuJCUwQv8Bm+WEhkR3NncgXb5NP=1GQiitJKOnpyGiA@mail.gmail.com>
Message-ID: <CAD6m6fE6xc4XH+r_JXYvGoayTxHaC00A-CgXM1qC0dUjMY7x1g@mail.gmail.com>

Queues exist (definition wise) on all nodes in a cluster.  Messages only
existing unless the queue is mirrored on a single node.  You can mirror a
queue's messages to N number of cluster nodes.  Admin console is an overall
view of the cluster, so you'll see all the available
nodes/queues/exchanges/etc.

One reason you'd NOT have queues have their messages automatically
replicated to other nodes is scaling.  If you had a cluster of 10 machines,
and all the machines mirrored, then your message would have to hit all 10
nodes before being acknowledged (publish confirm situation as I recall).
 You CAN instead say a queue must be mirrored on N number of nodes,
allowing a failover capacity of N.

Rabbit is also a Master-slave write system. Only ONE node in a cluster is
the "master".  Other nodes would be there for failover/scaling support.
 i.e. queues could be created on any one of the nodes in a cluster to
distribute load.  In the event of a failure on the master, a slave node
would take over the masters position.  When the old master comes on line,
it becomes a slave, but unless you have 3.1 and auto healing type stuff, it
would only get messages as of the time it has recovered, leaving an
indeterminate amount of time before it goes back into sync.

Further, if clients do auto queue creation, it can get even more
complex/diverse.  RabbitMQ makes messaging pretty simple but architecting
it right and true understanding is a much bigger issue.

Jason


On Fri, Jun 14, 2013 at 10:37 AM, Girish Gangadharan <girish at giri.sh> wrote:

> Thanks for your reply. Please see my response in red.
>
> On Fri, Jun 14, 2013 at 4:03 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>>
>> Hi,
>>
>> On 13/06/13 20:41, Girish Gangadharan wrote:
>> > For example, if a publisher writes a message to an exchange that ends
>> > up in a specific queue bound to that exchange, it immediately shows
>> > up in the same queue on the other node.
>>
>> There is only one queue on one node in this case. The cluster offers a
>> consistent view of all resources in the cluster and allows producers and
>> consumers to connect to any node. Messages are transparently routed
>> across the cluster.
>>
>
> Does this mean that the queues actually exist only in one node to whose
> exchange the message was originally written to? And the fact that I can see
> them in the admin console of the other node is just to provide a consistent
> view across the cluster? So any action that I do with the original queue on
> the other nodes' admin consoles basically makes the changes to the queue on
> the original node and not to the copy of that queue on the other nodes? In
> fact, if I understand you correctly, there IS no copy of the queue on the
> other nodes? Did I get that right?
>
> Not sure I understand the consistent view explanation either? What are the
> main benefits of having multiple nodes in a cluster if they can't really
> share anything? I would think Mirrored Queues should be an automatic
> by-product of clustering, thus offering HA out of the box. Can you explain
> to me why somebody would create a cluster of nodes and NOT have mirrored
> queues set up?
>
>
>>
>> > But then why does the article on Mirrored Queues say that *you have
>> > to explicitly set up mirrored queues by policy*?
>>
>> If a queue exists on only one node and that node crashes then the queue
>> becomes unavailable. Mirrored queues provides resilience by maintaining
>> copies of the queue that can take over in case a node crashes. See
>> http://www.rabbitmq.com/ha.html
>>
>> > So if one node goes down, the load balancer would automatically
>> > redirect all the traffic just to the node that is up and running. And
>> > the clients will not be affected. Would that work? Is that the
>> > recommended approach?
>>
>> That is a common approach. Another is to provide clients with reconnect
>> logic that allows them to select the alternative node when one node
>> crashes.
>>
>> > I was thinking about using Shoveling technique to push messages from
>> > a logical broker sitting on a cluster in our local HA servers to a
>> > different logical broker to the DR server. In this case, a copy of
>> > the messages will keep getting pumped into the DR with no clients
>> > processing it. What will happen to those messages?
>>
>> Nothing will happen to them. They will accumulate in the DR server
>> unless you take action to remove them, or unless they expire.
>>
>> > Should I have a workflow to go purge them every day manually or via a
>> > script (after I make sure those messages aren't needed anymore since
>> > the clients have already process them from the main HA cluster).
>>
>> That depends on the specifics of your disaster scenario, your messaging
>> pattern and how you plan to switch over to your DR environment. Purging
>> queues after a day sounds reasonable.
>>
>> > If the main HA cluster goes down and I have to bring the DR server into
>> > action, what happens to the messages that did get processed already by
>> > the clients? Should the clients have logic built in to ignore duplicates
>> > to handle this specific scenario?
>>
>> Performing deduplication in clients is probably the simplest solution,
>> or you could mirror the effects of consumers removing messages from
>> queues in your DR environment.
>>
>>
>>
>> -Emile
>>
>>
>>
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130616/fcc5c63d/attachment.htm>

From watson.timothy at gmail.com  Mon Jun 17 09:18:52 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 17 Jun 2013 09:18:52 +0100
Subject: [rabbitmq-discuss] Mirrored queues behind a load balancer
In-Reply-To: <CAD6m6fE6xc4XH+r_JXYvGoayTxHaC00A-CgXM1qC0dUjMY7x1g@mail.gmail.com>
References: <49b335bf-8c06-4d5e-8a33-070ea2df984a@googlegroups.com>
	<51BADC69.6020501@rabbitmq.com>
	<CAGT39YvSuJCUwQv8Bm+WEhkR3NncgXb5NP=1GQiitJKOnpyGiA@mail.gmail.com>
	<CAD6m6fE6xc4XH+r_JXYvGoayTxHaC00A-CgXM1qC0dUjMY7x1g@mail.gmail.com>
Message-ID: <1C1F9584-70B1-4957-AE7A-75D3F7C2F501@rabbitmq.com>

On 17 Jun 2013, at 05:24, Jason McIntosh <mcintoshj at gmail.com> wrote:

> Queues exist (definition wise) on all nodes in a cluster.  Messages only existing unless the queue is mirrored on a single node.  
[snip]
> One reason you'd NOT have queues have their messages automatically replicated to other nodes is scaling.  If you had a cluster of 10 machines, and all the machines mirrored, then your message would have to hit all 10 nodes before being acknowledged

And to clarify, another reason why we have a consistent view of schema (I.e., definitions) is so that clients can connect to *any* node to interact with the queue.

> Rabbit is also a Master-slave write system.
> Only ONE node in a cluster is the "master".  

Correction: rabbit HA is a master/slave system. Rabbit clustering is not and all nodes are considered equal.

From simon at rabbitmq.com  Mon Jun 17 10:41:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Jun 2013 10:41:52 +0100
Subject: [rabbitmq-discuss] Number formatting in management console
In-Reply-To: <FF367CAF-0CB1-470B-90D7-5946F2793B24@teksol.info>
References: <FF367CAF-0CB1-470B-90D7-5946F2793B24@teksol.info>
Message-ID: <51BED9E0.6010109@rabbitmq.com>

On 16/06/13 16:00, Fran?ois Beausoleil wrote:
> Hi!
>
> It would be nice if the numbers on the management console were
> formatted to be more comprehensible. 1427251 is harder to read and
> comprehend than 1,427,251 or "~1.4M". Same goes for the graph axis.

Yeah, good point. I'll file a bug...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matwey.kornilov at gmail.com  Mon Jun 17 11:24:53 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Mon, 17 Jun 2013 14:24:53 +0400
Subject: [rabbitmq-discuss] Queue with message dropping
Message-ID: <kpmo5g$e98$1@ger.gmane.org>


Hi,

Let me imagine that I have a queue and an exchange bound with each 
other. They implements pub/sub pattern, so the queue is private, only 
one consumer consumes from the given queue.

Let every message be somehow marked in headers with a special tag. I 
would like to get the following behaviour. If we have the message with 
the tag "Tag1" in the queue, and It is not consumed yet, and if there is 
new message with the tag "Tag1" coming from the exchange to the end of 
the queue, then I want the first message with the tag "Tag1" be 
unconditionally dropped from the queue and other messages left untouched.

The idea behind this is that I have a flow of events coming through the 
broker, and consumers have to act somehow on the events receive. But 
events may 'cancel' each other, and If I know that there is the most 
recent event, then I don't want to pay attention to obsoleted and 
unprocessed information, which may be still in message queue.



From emile at rabbitmq.com  Mon Jun 17 11:36:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 17 Jun 2013 11:36:30 +0100
Subject: [rabbitmq-discuss] Queue with message dropping
In-Reply-To: <kpmo5g$e98$1@ger.gmane.org>
References: <kpmo5g$e98$1@ger.gmane.org>
Message-ID: <51BEE6AE.2070702@rabbitmq.com>

On 17/06/13 11:24, Matwey V. Kornilov wrote:

> I don't want to pay attention to obsoleted and unprocessed
> information, which may be still in message queue.
sYou will need to route traffic for each tag to a separate queue and
consumers will need to consume from each queue. Then set the maximum
length of the queue to 1. This will force old messages out of the queue
to make room for new ones. See

http://www.rabbitmq.com/maxlength.html



-Emile





From matwey.kornilov at gmail.com  Mon Jun 17 11:40:24 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Mon, 17 Jun 2013 14:40:24 +0400
Subject: [rabbitmq-discuss] Queue with message dropping
In-Reply-To: <51BEE6AE.2070702@rabbitmq.com>
References: <kpmo5g$e98$1@ger.gmane.org> <51BEE6AE.2070702@rabbitmq.com>
Message-ID: <CAJs94EZjns_7N-5gd3GQNK3aDfd_9S40RmkbzQv=7_veUWJOYA@mail.gmail.com>

Many thanks. This is what I was looking for.


2013/6/17 Emile Joubert <emile at rabbitmq.com>:
> On 17/06/13 11:24, Matwey V. Kornilov wrote:
>
>> I don't want to pay attention to obsoleted and unprocessed
>> information, which may be still in message queue.
> sYou will need to route traffic for each tag to a separate queue and
> consumers will need to consume from each queue. Then set the maximum
> length of the queue to 1. This will force old messages out of the queue
> to make room for new ones. See
>
> http://www.rabbitmq.com/maxlength.html



--
With best regards,
Matwey V. Kornilov
http://0x2207.blogspot.com
xmpp:0x2207 at jabber.ru

From simon at rabbitmq.com  Mon Jun 17 12:39:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Jun 2013 12:39:14 +0100
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
Message-ID: <51BEF562.1090104@rabbitmq.com>

Hi. Thanks for the report.

My first guess is that garbage collection for the management DB process 
is happening too slowly. Can you invoke:

$ rabbitmqctl eval 
'P=global:whereis_name(rabbit_mgmt_db),M1=process_info(P, 
memory),garbage_collect(P),M2=process_info(P, 
memory),{M1,M2,rabbit_vm:memory()}.'

and post the results?

Cheers, Simon

On 15/06/13 03:09, Travis Mehlinger wrote:
> We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two bug
> fixes in 3.1.0 related to our RabbitMQ deployment:
>
>   * 25524 fix memory leak in mirror queue slave with many short-lived
>     publishing channel
>   * 25290 fix per-queue memory leak recording stats for mirror queue slaves
>
> However, in our case, it seems that the management plugin may still have
> a memory leak. We have a monitoring agent that hits the REST API to
> gather information about the broker (number of queues, queue depth,
> etc.). With the monitoring agent running and making requests against the
> API, memory consumption steadily increased; when we stopped the agent,
> memory consumption in the management plugin leveled off.
>
> Here a couple graphs detailing memory consumption in the broker (the
> figures are parsed from rabbitmqctl report). The first graph shows the
> ebb and flow of memory consumption in a number of components and the
> second shows just consumption by the management plugin. You can see
> pretty clearly where we stopped the monitoring agent at 1:20.
>
> https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png
> https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png
>
> We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang
> R14B-04.1. There are typically around 200 queues, about 20 of which are
> mirrored. There are generally about 200 consumers. Messages are rarely
> queued and most queues typically sit idle.
>
> I'll be happy to provide any further diagnostic information.
>
> Thanks!
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From johnzaborow at gmail.com  Mon Jun 17 15:31:34 2013
From: johnzaborow at gmail.com (John Zaborowski)
Date: Mon, 17 Jun 2013 07:31:34 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ service is not starting
In-Reply-To: <815ef770-4155-4ee5-8e93-7dada41d1518@googlegroups.com>
References: <815ef770-4155-4ee5-8e93-7dada41d1518@googlegroups.com>
Message-ID: <fe884130-acad-4855-a109-3c78a1f31160@googlegroups.com>


I did a full thorough uninstall with Revo clean up everything rebooted then 
reinstalled and everything worked. So probably had an initial bad install 
with some hidden file or something that was causing all sorts of grief. 

On Friday, June 14, 2013 12:33:20 PM UTC-4, John Zaborowski wrote:
>
> I cannot enable the management plug ins. which lead me down this rabbit 
> hole to discover that the service crashes upon booting up. 
> From what I can tell this is the cause...  
>
> =INFO REPORT==== 14-Jun-2013::11:18:01 ===
> Error description:
>    {error,
>        {cannot_read_enabled_plugins_file,
>           
>  "C:/Users/john.z/AppData/Roaming/RabbitMQ/enabled_plugins",eisdir}}
>
> Log files (may contain more information):
>    C:/Users/john.z/AppData/Roaming/RabbitMQ/log/rabbit at DEVLAP3.log
>    C:/Users/john.z/AppData/Roaming/RabbitMQ/log/rabbit at DEVLAP3-sasl.log
>
> Stack trace:
>    [{rabbit_plugins,read_enabled,1,[]},
>     {rabbit_plugins,prepare_plugins,3,[]},
>     {rabbit,'-boot/0-fun-1-',0,[]},
>     {rabbit,start_it,1,[]},
>     {init,start_it,1,[{file,"init.erl"},{line,1054}]},
>     {init,start_em,1,[{file,"init.erl"},{line,1034}]}]
>
>
> My enable_plugins folder is empty and there is nothing there to load which 
> I believe is the reason. I have uninstalled and re-installed the 
> application but I am getting the same problem. I don't know what to do 
> about this so I am asking for some assistance in getting this to start up. 
> We are attempting to utilize this tool to push messages across a couple 
> different servers of ours and I am trying to set this up for testing, but 
> unable to get anywhere and having a have time winding anything. 
>
> I am using Win 7 64bit. 
>
> Thanks in advance! 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130617/b5f47ae7/attachment.htm>

From tmehlinger at gmail.com  Mon Jun 17 15:45:58 2013
From: tmehlinger at gmail.com (Travis Mehlinger)
Date: Mon, 17 Jun 2013 09:45:58 -0500
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <51BEF562.1090104@rabbitmq.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
Message-ID: <CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>

Hi Simon,

Thanks for getting back to me. I'll need to restart our monitor and give it
some time to leak the memory. I'll let you know the results sometime later
today.

One thing I failed to mention in my initial report: whenever we restarted
one of our services, the queues they were using would get cleaned up (we
have them set to auto-delete) and redeclared. Whenever we did that, we
would see the memory consumption of the management DB fall off sharply
before starting to rise again.

Let me know if you'd like any further information in the meantime.

Best, Travis


On Mon, Jun 17, 2013 at 6:39 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. Thanks for the report.
>
> My first guess is that garbage collection for the management DB process is
> happening too slowly. Can you invoke:
>
> $ rabbitmqctl eval 'P=global:whereis_name(rabbit_**mgmt_db),M1=process_info(P,
> memory),garbage_collect(P),M2=**process_info(P, memory),{M1,M2,rabbit_vm:*
> *memory()}.'
>
> and post the results?
>
> Cheers, Simon
>
> On 15/06/13 03:09, Travis Mehlinger wrote:
>
>> We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two bug
>> fixes in 3.1.0 related to our RabbitMQ deployment:
>>
>>   * 25524 fix memory leak in mirror queue slave with many short-lived
>>     publishing channel
>>   * 25290 fix per-queue memory leak recording stats for mirror queue
>> slaves
>>
>> However, in our case, it seems that the management plugin may still have
>> a memory leak. We have a monitoring agent that hits the REST API to
>> gather information about the broker (number of queues, queue depth,
>> etc.). With the monitoring agent running and making requests against the
>> API, memory consumption steadily increased; when we stopped the agent,
>> memory consumption in the management plugin leveled off.
>>
>> Here a couple graphs detailing memory consumption in the broker (the
>> figures are parsed from rabbitmqctl report). The first graph shows the
>> ebb and flow of memory consumption in a number of components and the
>> second shows just consumption by the management plugin. You can see
>> pretty clearly where we stopped the monitoring agent at 1:20.
>>
>> https://dl.dropboxusercontent.**com/u/7022167/Screenshots/n-**
>> np6obt-m9f.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>
>> https://dl.dropboxusercontent.**com/u/7022167/Screenshots/**
>> an6dpup33xvx.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>
>>
>> We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang
>> R14B-04.1. There are typically around 200 queues, about 20 of which are
>> mirrored. There are generally about 200 consumers. Messages are rarely
>> queued and most queues typically sit idle.
>>
>> I'll be happy to provide any further diagnostic information.
>>
>> Thanks!
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130617/27642125/attachment.htm>

From steve at rabbitmq.com  Mon Jun 17 15:59:46 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 17 Jun 2013 15:59:46 +0100
Subject: [rabbitmq-discuss] XML in RabbitMQ with Stomp protocol
In-Reply-To: <51BE2EB4.6070302@rabbitmq.com>
References: <8ee31807-64f5-4392-9a07-1d447fe980d9@googlegroups.com>
	<51BE2EB4.6070302@rabbitmq.com>
Message-ID: <7CD03CEC-D165-47FD-9202-C4BD8766D1A3@rabbitmq.com>

Maria,
If you rely upon a null byte to terminate the STOMP payload then it may be that there are nulls in your XML. If you explicitly provide a length, then make sure that it is the byte length and not the character length.

If you get either of these wrong you may lose the connection due to a protocol violation.

Steve Powell  [Cell: +44-7815-838-558]
Links: Pivotal, SpringSource, VMware, Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, aesthetic;
   is understandable, unobtrusive, honest;
   is long-lasting, thorough, environmentally friendly;
   and is as little design as possible.
(c) Dieter Rams, amended 2003; 2009; 2012

On 16 Jun 2013, at 22:31, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 12/06/13 16:21, Maria Garcia wrote:
>>    I am trying to send and receive a XML with a RabbitMQ + Stomp and a
>>    browser client, I also use SockJS . First, I send and receive a
>>    simple text message without problems, but when I send a XML, I lost
>>    my connection and I don't know why. Any idea?
> 
> Stomp shouldn't care about the message payload.
> 
> Check the server logs for any errors.
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130617/3d0f2df7/attachment.htm>

From simon at rabbitmq.com  Mon Jun 17 16:32:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Jun 2013 16:32:28 +0100
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
Message-ID: <51BF2C0C.9030601@rabbitmq.com>

On 17/06/13 15:45, Travis Mehlinger wrote:
> Hi Simon,
>
> Thanks for getting back to me. I'll need to restart our monitor and give
> it some time to leak the memory. I'll let you know the results sometime
> later today.
>
> One thing I failed to mention in my initial report: whenever we
> restarted one of our services, the queues they were using would get
> cleaned up (we have them set to auto-delete) and redeclared. Whenever we
> did that, we would see the memory consumption of the management DB fall
> off sharply before starting to rise again.

That is presumably because the historical data the management plugin has 
been retaining for those queues got thrown away. If you don't want to 
retain this data at all, change the configuration as documented here:

http://www.rabbitmq.com/management.html#sample-retention

However, I (currently) don't believe it's this historical data you are 
seeing as "leaking" since making queries should not cause any more of it 
to be retained.

Cheers, Simon

> Let me know if you'd like any further information in the meantime.
>
> Best, Travis
>
>
> On Mon, Jun 17, 2013 at 6:39 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi. Thanks for the report.
>
>     My first guess is that garbage collection for the management DB
>     process is happening too slowly. Can you invoke:
>
>     $ rabbitmqctl eval
>     'P=global:whereis_name(rabbit___mgmt_db),M1=process_info(P,
>     memory),garbage_collect(P),M2=__process_info(P,
>     memory),{M1,M2,rabbit_vm:__memory()}.'
>
>     and post the results?
>
>     Cheers, Simon
>
>     On 15/06/13 03:09, Travis Mehlinger wrote:
>
>         We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing
>         two bug
>         fixes in 3.1.0 related to our RabbitMQ deployment:
>
>            * 25524 fix memory leak in mirror queue slave with many
>         short-lived
>              publishing channel
>            * 25290 fix per-queue memory leak recording stats for mirror
>         queue slaves
>
>         However, in our case, it seems that the management plugin may
>         still have
>         a memory leak. We have a monitoring agent that hits the REST API to
>         gather information about the broker (number of queues, queue depth,
>         etc.). With the monitoring agent running and making requests
>         against the
>         API, memory consumption steadily increased; when we stopped the
>         agent,
>         memory consumption in the management plugin leveled off.
>
>         Here a couple graphs detailing memory consumption in the broker (the
>         figures are parsed from rabbitmqctl report). The first graph
>         shows the
>         ebb and flow of memory consumption in a number of components and the
>         second shows just consumption by the management plugin. You can see
>         pretty clearly where we stopped the monitoring agent at 1:20.
>
>         https://dl.dropboxusercontent.__com/u/7022167/Screenshots/n-__np6obt-m9f.png
>         <https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>
>         https://dl.dropboxusercontent.__com/u/7022167/Screenshots/__an6dpup33xvx.png
>         <https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>
>
>         We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang
>         R14B-04.1. There are typically around 200 queues, about 20 of
>         which are
>         mirrored. There are generally about 200 consumers. Messages are
>         rarely
>         queued and most queues typically sit idle.
>
>         I'll be happy to provide any further diagnostic information.
>
>         Thanks!
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From mcintoshj at gmail.com  Mon Jun 17 16:37:10 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 17 Jun 2013 10:37:10 -0500
Subject: [rabbitmq-discuss] Pre-create queues and exchanges
In-Reply-To: <51BB4CAC.8060802@rabbitmq.com>
References: <51BB1F35.7040909@alertme.com>
	<51BB4CAC.8060802@rabbitmq.com>
Message-ID: <CAD6m6fEHX+jVK_OpNc0YkhtHmQf5X4wiXNmGPsJByEr37k+YJQ@mail.gmail.com>

We are doing ours statically through server automation scripts.  The
reasoning being we wanted more control over this, since we have remote
systems to shovel to a central location.  Due to the shoveling config (from
what I'm seeing there's no way to auto-shovel ALL queues, each has to be
defined), we limited the ability to create queues/exchanges/policies.  That
also puts more "conversation" and automation in the systems group on how
messaging gets routed, handled, failover, etc.  The option of using
federated instead of shovels might work though I've not investigated how
you could programatically create federated exchanges, know how to connect
to remote systems with out more information than most applications have.

If all of your publishers/consumers were hitting the same set of rabbit
nodes, I'd imagine it'd be a different situation than ours and having your
application create the exchanges, queues and binding to them would be more
workable.

Jason


On Fri, Jun 14, 2013 at 12:02 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 14/06/13 14:48, Dmitry Andrianov wrote:
>
>> Hi guys.
>> What is the best practices on who should create all the queues and
>> exchanges?
>>
>
> Whichever works best for you :)
>
>
>  I see the three options:
>> 1. consumer-app creates everything and it MUST be started before the
>> producer-app
>>
>
> That's probably not ideal.
>
>
>  2. both consumer-app and producer-app create these objects on startup so
>> it does not matter which one starts first.
>>
>
> This is probably closest to "the spirit" of AMQP. I think the expectation
> is that producers and consumers should declare the things that they
> directly interact with. So for example for pub-sub a producer would only
> declare the exchange it would publish to, and then consumers declare
> exchange, queue and binding.
>
>
>  3. queues and exchanges are put into the broker configuration so they
>> are created automatically when broker starts.
>>
>
> This keeps your apps free of the need to declare things - but it's only
> going to work if your configuration is quite static.
>
>
>  It looks to me that #3 would be the best way. The apps do not need to
>> have any code which initialises stuff, user accounts
>> applications use can be restricted etc.
>> But I cannot find the "official" way of doing it.
>> We tried using shovel plugin because it allows you to declare all these
>> queues and exchanges to be created.
>> It kind of works but it feels a bit dodgy.
>>
>
> You can do that - or use http://www.rabbitmq.com/**management.html#load-**
> definitions <http://www.rabbitmq.com/management.html#load-definitions>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130617/2a7f4191/attachment.htm>

From dmitry.andrianov at alertme.com  Mon Jun 17 18:28:59 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Mon, 17 Jun 2013 18:28:59 +0100
Subject: [rabbitmq-discuss] Java client and Qpid
In-Reply-To: <0E18BE7B-0B8A-47A7-BCC7-A3AC4031A700@alertme.com>
References: <51BB4825.6070001@alertme.com> <51BB4A3F.4040505@rabbitmq.com>
	<0E18BE7B-0B8A-47A7-BCC7-A3AC4031A700@alertme.com>
Message-ID: <79C99E18-D2E2-400B-B216-014A32829634@alertme.com>

JFYI, the simple test case I created fails with Qpid 0.20 but works ok with 0..22

Thanks!

On 14 Jun 2013, at 19:04, Dmitry Andrianov <dmitry.andrianov at alertme.com> wrote:

> Simon,
> many thanks for the prompt reply.
> 
> I use Qpid 0.20, Next week will try to create simple test case and run it against both 0.20 and the latest 0.22
> 
> If problem is reproducible - will raise issue on their bugtracker quoting you )
> 
> Thanks 
> 
> 
> On 14 Jun 2013, at 17:52, Simon MacMullen <simon at rabbitmq.com> wrote:
> 
>> On 14/06/13 17:43, Dmitry Andrianov wrote:
>>> Unfortunately I do not know the protocol well enough to understand if
>>> Qpid violates it by sending me a message before sending reply to
>>> basicConsume request or not. Without reading the specs I would assume
>>> that this behaviour is a valid one and it is RabbitMQ Java client
>>> that needs to be more tolerant.
>> 
>> From the spec:
>> 
>>> Section 4.6, Content Synchronisation:
>>> 
>>> In certain cases synchronous request-response methods have an impact
>>> on asynchronous content delivery on the same channel, including:
>>> 
>>> * The Basic.Consume and Basic.Cancel methods, which start and stop
>>> the flow of messages from a message queue.
>> 
>> [Snip a couple of other cases]
>> 
>>> Guidelines for implementers:
>>> 
>>> * The effects of the request-response MUST NOT be visible on the
>>> channel before the response method, and MUST be visible thereafter.
>> 
>> So I'm afraid it's QPid at fault. (Which version are you using? I
>> thought they had abandoned support for AMQP 0-9-1 some time ago.)
>> 
>> Cheers, Simon
>> 
>> -- 
>> Simon MacMullen
>> RabbitMQ, Pivotal
> This email is for the use of the intended recipient(s) only.
> If you have received this email in error, please notify the sender immediately and then delete it.
> If you are not the intended recipient, you must not use, disclose or distribute this email without the
> author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
> in this message or any attachments that are those of the individual sender..
> 
> AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
> Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From tmehlinger at gmail.com  Mon Jun 17 18:58:55 2013
From: tmehlinger at gmail.com (Travis Mehlinger)
Date: Mon, 17 Jun 2013 12:58:55 -0500
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <51BF2C0C.9030601@rabbitmq.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
Message-ID: <CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>

Hi Simon,

I flipped our monitor back on and let Rabbit consume some additional
memory. Invoking the garbage collector had no impact.

Let me know what further information you'd like to see and I'll be happy to
provide it.

Thanks, Travis


On Mon, Jun 17, 2013 at 10:32 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 17/06/13 15:45, Travis Mehlinger wrote:
>
>> Hi Simon,
>>
>> Thanks for getting back to me. I'll need to restart our monitor and give
>> it some time to leak the memory. I'll let you know the results sometime
>> later today.
>>
>> One thing I failed to mention in my initial report: whenever we
>> restarted one of our services, the queues they were using would get
>> cleaned up (we have them set to auto-delete) and redeclared. Whenever we
>> did that, we would see the memory consumption of the management DB fall
>> off sharply before starting to rise again.
>>
>
> That is presumably because the historical data the management plugin has
> been retaining for those queues got thrown away. If you don't want to
> retain this data at all, change the configuration as documented here:
>
> http://www.rabbitmq.com/**management.html#sample-**retention<http://www.rabbitmq.com/management.html#sample-retention>
>
> However, I (currently) don't believe it's this historical data you are
> seeing as "leaking" since making queries should not cause any more of it to
> be retained.
>
> Cheers, Simon
>
>  Let me know if you'd like any further information in the meantime.
>>
>> Best, Travis
>>
>>
>> On Mon, Jun 17, 2013 at 6:39 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Hi. Thanks for the report.
>>
>>     My first guess is that garbage collection for the management DB
>>     process is happening too slowly. Can you invoke:
>>
>>     $ rabbitmqctl eval
>>     'P=global:whereis_name(rabbit_**__mgmt_db),M1=process_info(P,
>>     memory),garbage_collect(P),M2=**__process_info(P,
>>     memory),{M1,M2,rabbit_vm:__**memory()}.'
>>
>>
>>     and post the results?
>>
>>     Cheers, Simon
>>
>>     On 15/06/13 03:09, Travis Mehlinger wrote:
>>
>>         We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing
>>         two bug
>>         fixes in 3.1.0 related to our RabbitMQ deployment:
>>
>>            * 25524 fix memory leak in mirror queue slave with many
>>         short-lived
>>              publishing channel
>>            * 25290 fix per-queue memory leak recording stats for mirror
>>         queue slaves
>>
>>         However, in our case, it seems that the management plugin may
>>         still have
>>         a memory leak. We have a monitoring agent that hits the REST API
>> to
>>         gather information about the broker (number of queues, queue
>> depth,
>>         etc.). With the monitoring agent running and making requests
>>         against the
>>         API, memory consumption steadily increased; when we stopped the
>>         agent,
>>         memory consumption in the management plugin leveled off.
>>
>>         Here a couple graphs detailing memory consumption in the broker
>> (the
>>         figures are parsed from rabbitmqctl report). The first graph
>>         shows the
>>         ebb and flow of memory consumption in a number of components and
>> the
>>         second shows just consumption by the management plugin. You can
>> see
>>         pretty clearly where we stopped the monitoring agent at 1:20.
>>
>>         https://dl.dropboxusercontent.**__com/u/7022167/Screenshots/n-**
>> __np6obt-m9f.png
>>         <https://dl.**dropboxusercontent.com/u/**
>> 7022167/Screenshots/n-np6obt-**m9f.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>
>> >
>>         https://dl.dropboxusercontent.**__com/u/7022167/Screenshots/__**
>> an6dpup33xvx.png
>>
>>         <https://dl.**dropboxusercontent.com/u/**7022167/Screenshots/**
>> an6dpup33xvx.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>
>> >
>>
>>         We have two clustered brokers, both running RabbitMQ 3.1.1 on
>> Erlang
>>         R14B-04.1. There are typically around 200 queues, about 20 of
>>         which are
>>         mirrored. There are generally about 200 consumers. Messages are
>>         rarely
>>         queued and most queues typically sit idle.
>>
>>         I'll be happy to provide any further diagnostic information.
>>
>>         Thanks!
>>
>>
>>         ______________________________**___________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, Pivotal
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130617/3955ebe9/attachment.htm>

From tmehlinger at gmail.com  Mon Jun 17 20:08:10 2013
From: tmehlinger at gmail.com (Travis Mehlinger)
Date: Mon, 17 Jun 2013 14:08:10 -0500
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
Message-ID: <CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>

Hi Simon,

I have more information for you. It turns out I hadn't fully understood the
interaction causing this to happen.

Aside from their regular communication, our services also declare a queue
bound on # to an exchange that we use for collecting stats the services
store internally. In addition to hitting the REST API for information about
the broker, the monitor also opens a connection/channel, declares an
anonymous queue for itself, then sends a message indicating to our services
that they should respond with their statistics. The services then send a
message with a routing key that will direct the response onto the queue
declared by the monitor. This happens every five seconds.

It appears that this is in fact responsible for memory consumption growing
out of control. If I disable that aspect of monitoring and leave the REST
API monitor up, memory consumption stays level.

The problem seems reminiscent of the issues described in this mailing list
thread:
http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Queues-memory-leak-td25813.html.
However, the queues we declare for stats collection are *not* mirrored.

Hope that helps narrow things down. :)

Best, Travis


On Mon, Jun 17, 2013 at 12:58 PM, Travis Mehlinger <tmehlinger at gmail.com>wrote:

> Hi Simon,
>
> I flipped our monitor back on and let Rabbit consume some additional
> memory. Invoking the garbage collector had no impact.
>
> Let me know what further information you'd like to see and I'll be happy
> to provide it.
>
> Thanks, Travis
>
>
> On Mon, Jun 17, 2013 at 10:32 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 17/06/13 15:45, Travis Mehlinger wrote:
>>
>>> Hi Simon,
>>>
>>> Thanks for getting back to me. I'll need to restart our monitor and give
>>> it some time to leak the memory. I'll let you know the results sometime
>>> later today.
>>>
>>> One thing I failed to mention in my initial report: whenever we
>>> restarted one of our services, the queues they were using would get
>>> cleaned up (we have them set to auto-delete) and redeclared. Whenever we
>>> did that, we would see the memory consumption of the management DB fall
>>> off sharply before starting to rise again.
>>>
>>
>> That is presumably because the historical data the management plugin has
>> been retaining for those queues got thrown away. If you don't want to
>> retain this data at all, change the configuration as documented here:
>>
>> http://www.rabbitmq.com/**management.html#sample-**retention<http://www.rabbitmq.com/management.html#sample-retention>
>>
>> However, I (currently) don't believe it's this historical data you are
>> seeing as "leaking" since making queries should not cause any more of it to
>> be retained.
>>
>> Cheers, Simon
>>
>>  Let me know if you'd like any further information in the meantime.
>>>
>>> Best, Travis
>>>
>>>
>>> On Mon, Jun 17, 2013 at 6:39 AM, Simon MacMullen <simon at rabbitmq.com
>>> <mailto:simon at rabbitmq.com>> wrote:
>>>
>>>     Hi. Thanks for the report.
>>>
>>>     My first guess is that garbage collection for the management DB
>>>     process is happening too slowly. Can you invoke:
>>>
>>>     $ rabbitmqctl eval
>>>     'P=global:whereis_name(rabbit_**__mgmt_db),M1=process_info(P,
>>>     memory),garbage_collect(P),M2=**__process_info(P,
>>>     memory),{M1,M2,rabbit_vm:__**memory()}.'
>>>
>>>
>>>     and post the results?
>>>
>>>     Cheers, Simon
>>>
>>>     On 15/06/13 03:09, Travis Mehlinger wrote:
>>>
>>>         We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing
>>>         two bug
>>>         fixes in 3.1.0 related to our RabbitMQ deployment:
>>>
>>>            * 25524 fix memory leak in mirror queue slave with many
>>>         short-lived
>>>              publishing channel
>>>            * 25290 fix per-queue memory leak recording stats for mirror
>>>         queue slaves
>>>
>>>         However, in our case, it seems that the management plugin may
>>>         still have
>>>         a memory leak. We have a monitoring agent that hits the REST API
>>> to
>>>         gather information about the broker (number of queues, queue
>>> depth,
>>>         etc.). With the monitoring agent running and making requests
>>>         against the
>>>         API, memory consumption steadily increased; when we stopped the
>>>         agent,
>>>         memory consumption in the management plugin leveled off.
>>>
>>>         Here a couple graphs detailing memory consumption in the broker
>>> (the
>>>         figures are parsed from rabbitmqctl report). The first graph
>>>         shows the
>>>         ebb and flow of memory consumption in a number of components and
>>> the
>>>         second shows just consumption by the management plugin. You can
>>> see
>>>         pretty clearly where we stopped the monitoring agent at 1:20.
>>>
>>>         https://dl.dropboxusercontent.**__com/u/7022167/Screenshots/n-**
>>> __np6obt-m9f.png
>>>         <https://dl.**dropboxusercontent.com/u/**
>>> 7022167/Screenshots/n-np6obt-**m9f.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>
>>> >
>>>         https://dl.dropboxusercontent.**__com/u/7022167/Screenshots/__**
>>> an6dpup33xvx.png
>>>
>>>         <https://dl.**dropboxusercontent.com/u/**7022167/Screenshots/**
>>> an6dpup33xvx.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>
>>> >
>>>
>>>         We have two clustered brokers, both running RabbitMQ 3.1.1 on
>>> Erlang
>>>         R14B-04.1. There are typically around 200 queues, about 20 of
>>>         which are
>>>         mirrored. There are generally about 200 consumers. Messages are
>>>         rarely
>>>         queued and most queues typically sit idle.
>>>
>>>         I'll be happy to provide any further diagnostic information.
>>>
>>>         Thanks!
>>>
>>>
>>>         ______________________________**___________________
>>>         rabbitmq-discuss mailing list
>>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>> >
>>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>>
>>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>> >
>>>
>>>
>>>
>>>     --
>>>     Simon MacMullen
>>>     RabbitMQ, Pivotal
>>>
>>>
>>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130617/91da6640/attachment.htm>

From jingchen.chi at gmail.com  Tue Jun 18 04:00:56 2013
From: jingchen.chi at gmail.com (JC)
Date: Mon, 17 Jun 2013 20:00:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq vs. Activemq
Message-ID: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>

Hi,

We are in the process of evaluating middleware and choosing which 
middleware we pick for a potentially large scale distributed 
application.    We did an evaluation between activemq and rabbitmq with 
different test cases. So far activemq has outperformed rabbitmq using the 
default out-of-box configuration especially on the latency side.   We use 
activemq openWire protocol vs. rabbit AMQP,  Here is one example result of 
the test we did on 1 publisher/1 consumer and we measure the latency from 
send to receive time.    Similar results we get from multiple consumers as 
well.  Any one has done the similar benchmark?  Could you please share your 
experience?  And if anyone knows the tips to boost rabbitmq performance, 
please let us know.   The rabbit test client is using fanout exchange and 
MINIMAL_BASIC to publish messages.

                     BrokerType Publishers Consumers SlowConsumers 
TgtMsgRate(mps) TgtMsgLimit AvgMsgSentRate(mps) AvgSentTime(ns) 
AvgMsgRcvRate(mps) MinLat(ns) MaxLat(ns) AvgLat(ns) MedLat(ns) 90%Lat(ns)  
Activemq at middlewarebench 1 1 0 25000 1000000 20776 5644 20776 99484 7959080 
259337 255760 316848  Rabbit at middlewarebench 1 1 0 25000 1000000 20749 5440 
20749 171994 46140955 870211 913283 988979  













 Activemq at middlewarebench 1 1 0 100000 1000000 62695 5347 62695 100634 
19872040 491588 359763 510862  Rabbit at middlewarebench 1 1 0 100000 1000000 
56850 6790 54512 315808 822398215 487403726 487170082 696265654  












 













 













 













 













 













 












 













 













 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130617/fe75b31a/attachment.htm>

From umutcan at gamegos.com  Tue Jun 18 08:55:24 2013
From: umutcan at gamegos.com (Umutcan)
Date: Tue, 18 Jun 2013 10:55:24 +0300
Subject: [rabbitmq-discuss] Rejecting Connection
In-Reply-To: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
References: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
Message-ID: <51C0126C.9020302@gamegos.com>

Hi,

I have a question about connection blocking. When memory alarm is true, 
RabbitMQ is blocking incoming connections. But I want it to reject 
connections, is it possible?

Thanks,

Umutcan.



From michael.s.klishin at gmail.com  Tue Jun 18 09:16:50 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 18 Jun 2013 12:16:50 +0400
Subject: [rabbitmq-discuss] Rejecting Connection
In-Reply-To: <51C0126C.9020302@gamegos.com>
References: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
	<51C0126C.9020302@gamegos.com>
Message-ID: <CAE3HoVQOr7Z-erPPew+-FGvsajnuhufUPiYswzADwXkBe-G2xQ@mail.gmail.com>

2013/6/18 Umutcan <umutcan at gamegos.com>

> When memory alarm is true, RabbitMQ is blocking incoming connections. But
> I want it to reject connections, is it possible?


Not at the moment.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/e062d6df/attachment.htm>

From matthias at rabbitmq.com  Tue Jun 18 09:27:11 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 18 Jun 2013 09:27:11 +0100
Subject: [rabbitmq-discuss] Rejecting Connection
In-Reply-To: <CAE3HoVQOr7Z-erPPew+-FGvsajnuhufUPiYswzADwXkBe-G2xQ@mail.gmail.com>
References: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
	<51C0126C.9020302@gamegos.com>
	<CAE3HoVQOr7Z-erPPew+-FGvsajnuhufUPiYswzADwXkBe-G2xQ@mail.gmail.com>
Message-ID: <51C019DF.9040707@rabbitmq.com>

On 18/06/13 09:16, Michael Klishin wrote:
> 2013/6/18 Umutcan <umutcan at gamegos.com <mailto:umutcan at gamegos.com>>
>
>     When memory alarm is true, RabbitMQ is blocking incoming
>     connections. But I want it to reject connections, is it possible?
>
>
> Not at the moment.

Bear in mind that RabbitMQ doesn't actually block incoming connections 
when the memory alarm is raised. Instead it only blocks connections 
which are publishing; it's perfectly ok for a client to connect and consume.

Also bear in mind that memory alarms are generally very transient, i.e. 
they shouldn't last more than a few seconds. Rejecting connections 
during that time seems a tad severe.

I'm curious what the use case is here.

Matthias.

From umutcan at gamegos.com  Tue Jun 18 09:36:06 2013
From: umutcan at gamegos.com (Umutcan)
Date: Tue, 18 Jun 2013 11:36:06 +0300
Subject: [rabbitmq-discuss] Rejecting Connection
In-Reply-To: <CAE3HoVQOr7Z-erPPew+-FGvsajnuhufUPiYswzADwXkBe-G2xQ@mail.gmail.com>
References: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
	<51C0126C.9020302@gamegos.com>
	<CAE3HoVQOr7Z-erPPew+-FGvsajnuhufUPiYswzADwXkBe-G2xQ@mail.gmail.com>
Message-ID: <51C01BF6.7030702@gamegos.com>

On 06/18/2013 11:16 AM, Michael Klishin wrote:
> 2013/6/18 Umutcan <umutcan at gamegos.com <mailto:umutcan at gamegos.com>>
>
>     When memory alarm is true, RabbitMQ is blocking incoming
>     connections. But I want it to reject connections, is it possible?
>
>
> Not at the moment.
>
OK. Then, is it possible to check if connection is blocked or not in 
order to close connection? I know I can use timeout but I do not prefer 
to use a timeout.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/ba6e00ca/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun 18 09:44:40 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 18 Jun 2013 12:44:40 +0400
Subject: [rabbitmq-discuss] Rejecting Connection
In-Reply-To: <51C01BF6.7030702@gamegos.com>
References: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
	<51C0126C.9020302@gamegos.com>
	<CAE3HoVQOr7Z-erPPew+-FGvsajnuhufUPiYswzADwXkBe-G2xQ@mail.gmail.com>
	<51C01BF6.7030702@gamegos.com>
Message-ID: <CAE3HoVTry=mk+CC=FUBwYDNueo+--QQdphH2tZg7GQ6Hw_Bm_A@mail.gmail.com>

2013/6/18 Umutcan <umutcan at gamegos.com>

> Then, is it possible to check if connection is blocked or not in order to
> close connection?


There is no easy way at the moment.

In one of the future versions, there will be a way to react to connection
blocking. Note that it will require client
libraries to be updated.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/31ce3261/attachment.htm>

From umutcan at gamegos.com  Tue Jun 18 09:51:25 2013
From: umutcan at gamegos.com (Umutcan)
Date: Tue, 18 Jun 2013 11:51:25 +0300
Subject: [rabbitmq-discuss] Rejecting Connection
In-Reply-To: <51C019DF.9040707@rabbitmq.com>
References: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
	<51C0126C.9020302@gamegos.com>
	<CAE3HoVQOr7Z-erPPew+-FGvsajnuhufUPiYswzADwXkBe-G2xQ@mail.gmail.com>
	<51C019DF.9040707@rabbitmq.com>
Message-ID: <51C01F8D.3070502@gamegos.com>

On 06/18/2013 11:27 AM, Matthias Radestock wrote:
> On 18/06/13 09:16, Michael Klishin wrote:
>> 2013/6/18 Umutcan <umutcan at gamegos.com <mailto:umutcan at gamegos.com>>
>>
>>     When memory alarm is true, RabbitMQ is blocking incoming
>>     connections. But I want it to reject connections, is it possible?
>>
>>
>> Not at the moment.
>
> Bear in mind that RabbitMQ doesn't actually block incoming connections 
> when the memory alarm is raised. Instead it only blocks connections 
> which are publishing; it's perfectly ok for a client to connect and 
> consume.
>
> Also bear in mind that memory alarms are generally very transient, 
> i.e. they shouldn't last more than a few seconds. Rejecting 
> connections during that time seems a tad severe.
>
> I'm curious what the use case is here.

I am sending data to a mysql database with my consumers. When everything 
is normal with database, memory use of the broker is low. But, sometimes 
mysql server fails (or some operations may be running) and the messages 
is begining to wait in the queue. If solving problem with the database 
takes too long time, memory use reaches the limit.  So, I want my 
publishers to stop publishing new messages when this happened.

From joseph.g.lambert at gmail.com  Tue Jun 18 08:17:18 2013
From: joseph.g.lambert at gmail.com (Joseph Lambert)
Date: Tue, 18 Jun 2013 00:17:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
Message-ID: <22748e2e-0dde-49cc-9a83-7d7649a78e77@googlegroups.com>

Hi, 

I just wanted to mention that we are seeing the same behavior, but we don't 
have any mirrored queues. We have had to disable the management interface 
and the memory usage gradually dropped.

We are using 3.1.1 on R13B04 on some machines, and a few others with Erlang 
R16B.

I looked into the code, and it creates some ets tables in the 
rabbit_mgmt_db module. The first snippet is memory usage with the 
management plugin:

 {memory,
     [{total,1417822136},
      {connection_procs,37788152},
      {queue_procs,6659896},
      {plugins,686592},
      {other_proc,11236576},
      {mnesia,855184},
      {mgmt_db,935311000},
      {msg_index,7976224},
      {other_ets,70559680},
      {binary,13529704},
      {code,19001963},
      {atom,1601817},
      {other_system,312615348}]},


This second snippet is after disabling the management plugin and restarting 
one of the nodes:
 

[{total,190412936},

{memory,
{connection_procs,34512200},
{queue_procs,8970352},
{plugins,0},
{other_proc,9246776},
{mnesia,794776},
{mgmt_db,0},
{msg_index,1650736},
{other_ets,6406656},
{binary,63363448},
{code,16232973},
{atom,594537},
{other_system,48640482}]}


You'll notice that the memory used by mgmt_db is not 0 and other_system is 
around 48MB, while before mgmt_db was over 935MB, and other_system over 
300MB. Unfortunately, I don't have any growth trends for the DB size as we 
have had to disable management on all nodes and we weren't tracking this 
memory usage.

I'm not very familiar with RabbitMQ, but if I have some time I will try and 
dig more deeply into it and run some tests.

- Joe

On Saturday, June 15, 2013 10:09:21 AM UTC+8, Travis Mehlinger wrote:
>
> We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two bug 
> fixes in 3.1.0 related to our RabbitMQ deployment:
>
>    - 25524 fix memory leak in mirror queue slave with many short-lived 
>    publishing channel
>    - 25290 fix per-queue memory leak recording stats for mirror queue 
>    slaves
>
> However, in our case, it seems that the management plugin may still have a 
> memory leak. We have a monitoring agent that hits the REST API to gather 
> information about the broker (number of queues, queue depth, etc.). With 
> the monitoring agent running and making requests against the API, memory 
> consumption steadily increased; when we stopped the agent, memory 
> consumption in the management plugin leveled off.
>
> Here a couple graphs detailing memory consumption in the broker (the 
> figures are parsed from rabbitmqctl report). The first graph shows the 
> ebb and flow of memory consumption in a number of components and the second 
> shows just consumption by the management plugin. You can see pretty clearly 
> where we stopped the monitoring agent at 1:20.
>
> https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png
> https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png
>
> We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang 
> R14B-04.1. There are typically around 200 queues, about 20 of which are 
> mirrored. There are generally about 200 consumers. Messages are rarely 
> queued and most queues typically sit idle.
>
> I'll be happy to provide any further diagnostic information.
>
> Thanks!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/7acfc056/attachment.htm>

From simon at rabbitmq.com  Tue Jun 18 10:45:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Jun 2013 10:45:04 +0100
Subject: [rabbitmq-discuss] Rabbitmq vs. Activemq
In-Reply-To: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
References: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
Message-ID: <51C02C20.2010804@rabbitmq.com>

If your primary concern is latency, testing with a maxed-out message 
rate (which it seems is what you are doing) will give very dubious 
results. Maxing out the message rate means that all internal buffers are 
full, and thus messages take a while to get through the broker.

The same is presumably true for ActiveMQ, but presumably it has smaller 
buffers.

This is even more true if your tests are able to publish messages faster 
than they consume (which I guess is what's happening in your last row) - 
if your test ends up enqueueing messages and then taking a while to 
dequeue them then I am not surprised you see high latency.

Dropping your message rate to even 90% of the maximum will give huge 
latency gains - see the final chart here:

http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/

Finally, I would be wary of constructing a synthetic benchmark and then 
using it to pick which product you go with, unless you determine that 
one product has acceptable performance and others do not. Factors such 
as reliability, ease of use, feature set and so on tend to be more 
important than a 10% difference in performance.

Hopefully I would still be saying that even if RabbitMQ were "winning" 
your tests :-)

Cheers, Simon

On 18/06/13 04:00, JC wrote:
> Hi,
>
> We are in the process of evaluating middleware and choosing which
> middleware we pick for a potentially large scale distributed
> application.    We did an evaluation between activemq and rabbitmq with
> different test cases. So far activemq has outperformed rabbitmq using
> the default out-of-box configuration especially on the latency side.
> We use activemq openWire protocol vs. rabbit AMQP,  Here is one example
> result of the test we did on 1 publisher/1 consumer and we measure the
> latency from send to receive time.    Similar results we get from
> multiple consumers as well.  Any one has done the similar benchmark?
> Could you please share your experience?  And if anyone knows the tips to
> boost rabbitmq performance, please let us know.   The rabbit test client
> is using fanout exchange and MINIMAL_BASIC to publish messages.
>
> BrokerType 	Publishers 	Consumers 	SlowConsumers 	TgtMsgRate(mps)
> TgtMsgLimit 	AvgMsgSentRate(mps) 	AvgSentTime(ns) 	AvgMsgRcvRate(mps)
> MinLat(ns) 	MaxLat(ns) 	AvgLat(ns) 	MedLat(ns) 	90%Lat(ns)
> Activemq at middlewarebench 	1 	1 	0 	25000 	1000000 	20776 	5644 	20776
> 99484 	7959080 	259337 	255760 	316848
> Rabbit at middlewarebench 	1 	1 	0 	25000 	1000000 	20749 	5440 	20749
> 171994 	46140955 	870211 	913283 	988979
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> Activemq at middlewarebench 	1 	1 	0 	100000 	1000000 	62695 	5347 	62695
> 100634 	19872040 	491588 	359763 	510862
> Rabbit at middlewarebench 	1 	1 	0 	100000 	1000000 	56850 	6790 	54512
> 315808 	822398215 	487403726 	487170082 	696265654
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
> 	
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jun 18 11:08:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Jun 2013 11:08:13 +0100
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <22748e2e-0dde-49cc-9a83-7d7649a78e77@googlegroups.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<22748e2e-0dde-49cc-9a83-7d7649a78e77@googlegroups.com>
Message-ID: <51C0318D.9040701@rabbitmq.com>

Some things to look at that may let you re-enable the management plugin:

The management DB keeps historical data for queues / connections etc. If 
you have a large number of these things then tweaking the retention 
policies may help:

http://www.rabbitmq.com/management.html#sample-retention

If that does not help then setting:

{rabbitmq_management, [{db_module, rabbit_mgmt_old_db}]}

in your config will revert to the 3.0.x DB implementation.

Cheers, Simon

On 18/06/13 08:17, Joseph Lambert wrote:
> Hi,
>
> I just wanted to mention that we are seeing the same behavior, but we
> don't have any mirrored queues. We have had to disable the management
> interface and the memory usage gradually dropped.
>
> We are using 3.1.1 on R13B04 on some machines, and a few others with
> Erlang R16B.
>
> I looked into the code, and it creates some ets tables in the
> rabbit_mgmt_db module. The first snippet is memory usage with the
> management plugin:
>
>       {memory,
>           [{total,1417822136},
>            {connection_procs,37788152},
>            {queue_procs,6659896},
>            {plugins,686592},
>            {other_proc,11236576},
>            {mnesia,855184},
>            {mgmt_db,935311000},
>            {msg_index,7976224},
>            {other_ets,70559680},
>            {binary,13529704},
>            {code,19001963},
>            {atom,1601817},
>            {other_system,312615348}]},
>
>
> This second snippet is after disabling the management plugin and
> restarting one of the nodes:
>
>     [{total,190412936},
>
>     {memory,
>     {connection_procs,34512200},
>     {queue_procs,8970352},
>     {plugins,0},
>     {other_proc,9246776},
>     {mnesia,794776},
>     {mgmt_db,0},
>     {msg_index,1650736},
>     {other_ets,6406656},
>     {binary,63363448},
>     {code,16232973},
>     {atom,594537},
>     {other_system,48640482}]}
>
>
> You'll notice that the memory used by mgmt_db is not 0 and other_system
> is around 48MB, while before mgmt_db was over 935MB, and other_system
> over 300MB. Unfortunately, I don't have any growth trends for the DB
> size as we have had to disable management on all nodes and we weren't
> tracking this memory usage.
>
> I'm not very familiar with RabbitMQ, but if I have some time I will try
> and dig more deeply into it and run some tests.
>
> - Joe
>
> On Saturday, June 15, 2013 10:09:21 AM UTC+8, Travis Mehlinger wrote:
>
>     We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two
>     bug fixes in 3.1.0 related to our RabbitMQ deployment:
>
>       * 25524 fix memory leak in mirror queue slave with many
>         short-lived publishing channel
>       * 25290 fix per-queue memory leak recording stats for mirror queue
>         slaves
>
>     However, in our case, it seems that the management plugin may still
>     have a memory leak. We have a monitoring agent that hits the REST
>     API to gather information about the broker (number of queues, queue
>     depth, etc.). With the monitoring agent running and making requests
>     against the API, memory consumption steadily increased; when we
>     stopped the agent, memory consumption in the management plugin
>     leveled off.
>
>     Here a couple graphs detailing memory consumption in the broker (the
>     figures are parsed from rabbitmqctl report). The first graph shows
>     the ebb and flow of memory consumption in a number of components and
>     the second shows just consumption by the management plugin. You can
>     see pretty clearly where we stopped the monitoring agent at 1:20.
>
>     https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png
>     <https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>
>     https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png
>     <https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>
>
>     We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang
>     R14B-04.1. There are typically around 200 queues, about 20 of which
>     are mirrored. There are generally about 200 consumers. Messages are
>     rarely queued and most queues typically sit idle.
>
>     I'll be happy to provide any further diagnostic information.
>
>     Thanks!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jun 18 11:23:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Jun 2013 11:23:49 +0100
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
Message-ID: <51C03535.8010604@rabbitmq.com>

Hi. So I assume your monitoring code is not actually leaking those 
queues - they are getting deleted I assume? How? (Are they autodelete, 
exclusive, x-expires, deleted manually?)

If so, can you run:

rabbitmqctl eval '[{ets:info(T,size), ets:info(T,memory)} || T <- 
lists:sort(ets:all()), rabbit_mgmt_db <- [ets:info(T, name)]].'

periodically? This will output a list of tuples showing the rows and 
bytes per table for each table in the mgmt DB. Do these increase?

Cheers, Simon

On 17/06/13 20:08, Travis Mehlinger wrote:
> Hi Simon,
>
> I have more information for you. It turns out I hadn't fully understood
> the interaction causing this to happen.
>
> Aside from their regular communication, our services also declare a
> queue bound on # to an exchange that we use for collecting stats the
> services store internally. In addition to hitting the REST API for
> information about the broker, the monitor also opens a
> connection/channel, declares an anonymous queue for itself, then sends a
> message indicating to our services that they should respond with their
> statistics. The services then send a message with a routing key that
> will direct the response onto the queue declared by the monitor. This
> happens every five seconds.
>
> It appears that this is in fact responsible for memory consumption
> growing out of control. If I disable that aspect of monitoring and leave
> the REST API monitor up, memory consumption stays level.
>
> The problem seems reminiscent of the issues described in this mailing
> list thread:
> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Queues-memory-leak-td25813.html.
> However, the queues we declare for stats collection are *not* mirrored.
>
> Hope that helps narrow things down. :)
>
> Best, Travis
>
>
> On Mon, Jun 17, 2013 at 12:58 PM, Travis Mehlinger <tmehlinger at gmail.com
> <mailto:tmehlinger at gmail.com>> wrote:
>
>     Hi Simon,
>
>     I flipped our monitor back on and let Rabbit consume some additional
>     memory. Invoking the garbage collector had no impact.
>
>     Let me know what further information you'd like to see and I'll be
>     happy to provide it.
>
>     Thanks, Travis
>
>
>     On Mon, Jun 17, 2013 at 10:32 AM, Simon MacMullen
>     <simon at rabbitmq.com <mailto:simon at rabbitmq.com>> wrote:
>
>         On 17/06/13 15:45, Travis Mehlinger wrote:
>
>             Hi Simon,
>
>             Thanks for getting back to me. I'll need to restart our
>             monitor and give
>             it some time to leak the memory. I'll let you know the
>             results sometime
>             later today.
>
>             One thing I failed to mention in my initial report: whenever we
>             restarted one of our services, the queues they were using
>             would get
>             cleaned up (we have them set to auto-delete) and redeclared.
>             Whenever we
>             did that, we would see the memory consumption of the
>             management DB fall
>             off sharply before starting to rise again.
>
>
>         That is presumably because the historical data the management
>         plugin has been retaining for those queues got thrown away. If
>         you don't want to retain this data at all, change the
>         configuration as documented here:
>
>         http://www.rabbitmq.com/__management.html#sample-__retention
>         <http://www.rabbitmq.com/management.html#sample-retention>
>
>         However, I (currently) don't believe it's this historical data
>         you are seeing as "leaking" since making queries should not
>         cause any more of it to be retained.
>
>         Cheers, Simon
>
>             Let me know if you'd like any further information in the
>             meantime.
>
>             Best, Travis
>
>
>             On Mon, Jun 17, 2013 at 6:39 AM, Simon MacMullen
>             <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>             <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>                  Hi. Thanks for the report.
>
>                  My first guess is that garbage collection for the
>             management DB
>                  process is happening too slowly. Can you invoke:
>
>                  $ rabbitmqctl eval
>
>             'P=global:whereis_name(rabbit_____mgmt_db),M1=process_info(P,
>                  memory),garbage_collect(P),M2=____process_info(P,
>                  memory),{M1,M2,rabbit_vm:____memory()}.'
>
>
>                  and post the results?
>
>                  Cheers, Simon
>
>                  On 15/06/13 03:09, Travis Mehlinger wrote:
>
>                      We recently upgraded RabbitMQ from 3.0.4 to 3.1.1
>             after noticing
>                      two bug
>                      fixes in 3.1.0 related to our RabbitMQ deployment:
>
>                         * 25524 fix memory leak in mirror queue slave
>             with many
>                      short-lived
>                           publishing channel
>                         * 25290 fix per-queue memory leak recording
>             stats for mirror
>                      queue slaves
>
>                      However, in our case, it seems that the management
>             plugin may
>                      still have
>                      a memory leak. We have a monitoring agent that hits
>             the REST API to
>                      gather information about the broker (number of
>             queues, queue depth,
>                      etc.). With the monitoring agent running and making
>             requests
>                      against the
>                      API, memory consumption steadily increased; when we
>             stopped the
>                      agent,
>                      memory consumption in the management plugin leveled
>             off.
>
>                      Here a couple graphs detailing memory consumption
>             in the broker (the
>                      figures are parsed from rabbitmqctl report). The
>             first graph
>                      shows the
>                      ebb and flow of memory consumption in a number of
>             components and the
>                      second shows just consumption by the management
>             plugin. You can see
>                      pretty clearly where we stopped the monitoring
>             agent at 1:20.
>
>             https://dl.dropboxusercontent.____com/u/7022167/Screenshots/n-____np6obt-m9f.png
>
>             <https://dl.__dropboxusercontent.com/u/__7022167/Screenshots/n-np6obt-__m9f.png
>             <https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>>
>             https://dl.dropboxusercontent.____com/u/7022167/Screenshots/____an6dpup33xvx.png
>
>
>             <https://dl.__dropboxusercontent.com/u/__7022167/Screenshots/__an6dpup33xvx.png
>             <https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>>
>
>                      We have two clustered brokers, both running
>             RabbitMQ 3.1.1 on Erlang
>                      R14B-04.1. There are typically around 200 queues,
>             about 20 of
>                      which are
>                      mirrored. There are generally about 200 consumers.
>             Messages are
>                      rarely
>                      queued and most queues typically sit idle.
>
>                      I'll be happy to provide any further diagnostic
>             information.
>
>                      Thanks!
>
>
>                      ___________________________________________________
>                      rabbitmq-discuss mailing list
>                      rabbitmq-discuss at lists.__rabbi__tmq.com
>             <http://rabbitmq.com>
>                      <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>             <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>             https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>             <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>
>
>             <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>             <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>
>
>
>
>                  --
>                  Simon MacMullen
>                  RabbitMQ, Pivotal
>
>
>
>
>         --
>         Simon MacMullen
>         RabbitMQ, Pivotal
>
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From 314992959 at qq.com  Tue Jun 18 12:33:32 2013
From: 314992959 at qq.com (3k4b251)
Date: Tue, 18 Jun 2013 04:33:32 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c   how many channels  I  need?
Message-ID: <1371555212267-27448.post@n5.nabble.com>

 If  I need to offer more than  ten thousand  consumer...... I like to create 
channel  for every  consumer, is that  right?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-many-channels-I-need-tp27448.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Tue Jun 18 12:38:51 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 18 Jun 2013 15:38:51 +0400
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <1371555212267-27448.post@n5.nabble.com>
References: <1371555212267-27448.post@n5.nabble.com>
Message-ID: <CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>

2013/6/18 3k4b251 <314992959 at qq.com>

> If  I need to offer more than  ten thousand  consumer...... I like to
> create
> channel  for every  consumer, is that  right?
>

You can use a single channel for any number of consumers. Keep in mind that
error handling
is per-channel and channels are fairly cheap in general, although tens of
thousands of channels
may add up to a noticeable amount of RAM on the server.

When in doubt, start with 1 channel.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/5662f941/attachment.htm>

From tim at rabbitmq.com  Tue Jun 18 12:44:09 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 18 Jun 2013 12:44:09 +0100
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
Message-ID: <E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>

On 18 Jun 2013, at 12:38, Michael Klishin wrote:
> 2013/6/18 3k4b251 <314992959 at qq.com>
> If  I need to offer more than  ten thousand  consumer...... I like to create
> channel  for every  consumer, is that  right?
> 
> You can use a single channel for any number of consumers. Keep in mind that error handling
> is per-channel and channels are fairly cheap in general, although tens of thousands of channels
> may add up to a noticeable amount of RAM on the server.
> 
> When in doubt, start with 1 channel.

And message ordering between threads sharing that channel doesn't matter, presumably?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/ae0dd02f/attachment.htm>

From 314992959 at qq.com  Tue Jun 18 12:44:11 2013
From: 314992959 at qq.com (3k4b251)
Date: Tue, 18 Jun 2013 04:44:11 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c  amq_channel_open(),
 amqp_channel_close() both need  too much memory
Message-ID: <1371555851162-27450.post@n5.nabble.com>

when   I   use    amq_channel_open() to  create  a channel ,  I  found  about
150k memory being   used.   but   next  I want to close the channel , I used
amq_channel_close(),I found abot 200k memory being used.  It seems  the
server  always need  memory  if  I use  channel .  I want to know  how  to
release the memory.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-amq-channel-open-amqp-channel-close-both-need-too-much-memory-tp27450.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From 314992959 at qq.com  Tue Jun 18 12:51:49 2013
From: 314992959 at qq.com (3k4b251)
Date: Tue, 18 Jun 2013 04:51:49 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
Message-ID: <1371556309616-27452.post@n5.nabble.com>

thank  for  your  reply.   But  I still  have one  question.  if   I  use 
only one channel for   many  consumers, when  I  get the  message  from 
amqp_simple_wait_frame() ,I know  the channel  of sender,but how can I know 
which  queue  this message from?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-many-channels-I-need-tp27448p27452.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Tue Jun 18 12:54:44 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 18 Jun 2013 15:54:44 +0400
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
Message-ID: <CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>

2013/6/18 Tim Watson <tim at rabbitmq.com>

> And message ordering between threads sharing that channel doesn't matter,
> presumably?


Good point.

Sharing channels between threads that publish is generally a bad idea: most
clients don't offer synchronization and frames may get interleaved in
an incorrect way. So for N publishers, you need N channels.

Sharing channels between threads that consume may be safe but it really
depends on whether you need message processing order guarantees
and if any of the consumers share a queue.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/93a1780f/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun 18 12:58:07 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 18 Jun 2013 15:58:07 +0400
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <1371556309616-27452.post@n5.nabble.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<1371556309616-27452.post@n5.nabble.com>
Message-ID: <CAE3HoVQ3SY1qzHKDo6KDV2vysfaWuk7ZY-VFiWL3vQpt1CccBg@mail.gmail.com>

2013/6/18 3k4b251 <314992959 at qq.com>

> I know  the channel  of sender,but how can I know
> which  queue  this message from
>

Every delivery has a consumer tag (identifier). The same tag will be
availalbe on the basic.consume-ok method
returned by basic.consume (sorry, I'm not sure what function/struct exactly
that translates in the C client).

If you keep a mapping of consumers to queues, you will be able to look up
queues by consumer tag.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/95db6c4b/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun 18 13:00:30 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 18 Jun 2013 16:00:30 +0400
Subject: [rabbitmq-discuss] rabbitmq-c amq_channel_open(),
 amqp_channel_close() both need too much memory
In-Reply-To: <1371555851162-27450.post@n5.nabble.com>
References: <1371555851162-27450.post@n5.nabble.com>
Message-ID: <CAE3HoVSB2MEG5UQFozoKVptm2U2ELYoLjCx=aYbtAdn8rsc79g@mail.gmail.com>

2013/6/18 3k4b251 <314992959 at qq.com>

>  It seems  the
> server  always need  memory  if  I use  channel .  I want to know  how  to
> release the memory.
>

Is this RabbitMQ or your client memory consumption?

RabbitMQ's runtime releases memory every so often, not necessarily
immediately after a channel was closed.

A more indicative example may be opening 500 channels, closing them and
then running a small "Hello, world" example
on a single channel for a couple of minutes. Then check RabbitMQ memory
usage again.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/05b0b48c/attachment.htm>

From stuff at moesel.net  Tue Jun 18 13:20:36 2013
From: stuff at moesel.net (Chris)
Date: Tue, 18 Jun 2013 08:20:36 -0400
Subject: [rabbitmq-discuss] Rabbitmq vs. Activemq
In-Reply-To: <51C02C20.2010804@rabbitmq.com>
References: <c4def933-ed64-4632-b130-d8c81df74b66@googlegroups.com>
	<51C02C20.2010804@rabbitmq.com>
Message-ID: <CAHEpgBB8x+Rqh070VvrP1ARtUqM_T1C_Hu60BieHJwfFzmzRLg@mail.gmail.com>

A couple of other things to consider:

1) Message durability: In my own informal tests (about 8 months ago), I
found that ActiveMQ took a very significant hit once you turned on message
persistence.  RabbitMQ also took a hit, but it was much less significant.

2) Clustering / High Availability: If you need to cluster the brokers for
HA or failover, there are significant differences here.  Last I checked,
ActiveMQ only supported active/passive configurations and they were fairly
difficult to configure, or required separate shared storage nodes.
 RabbitMQ supports active/active configurations, is easy to configure, and
requires no other external dependencies.  That said, I did find that
ActiveMQ clients have better support for automatic failover than most
RabbitMQ clients (so you have to implement it yourself in RabbitMQ clients
or find an add-on library for it).

Disclaimer: I did my research on ActiveMQ 5.7, so you may want to check if
ActiveMQ 5.8 addresses some of these problems...

-Chris

-Chris


On Tue, Jun 18, 2013 at 5:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> If your primary concern is latency, testing with a maxed-out message rate
> (which it seems is what you are doing) will give very dubious results.
> Maxing out the message rate means that all internal buffers are full, and
> thus messages take a while to get through the broker.
>
> The same is presumably true for ActiveMQ, but presumably it has smaller
> buffers.
>
> This is even more true if your tests are able to publish messages faster
> than they consume (which I guess is what's happening in your last row) - if
> your test ends up enqueueing messages and then taking a while to dequeue
> them then I am not surprised you see high latency.
>
> Dropping your message rate to even 90% of the maximum will give huge
> latency gains - see the final chart here:
>
> http://www.rabbitmq.com/blog/**2012/04/17/rabbitmq-**
> performance-measurements-part-**1/<http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/>
>
> Finally, I would be wary of constructing a synthetic benchmark and then
> using it to pick which product you go with, unless you determine that one
> product has acceptable performance and others do not. Factors such as
> reliability, ease of use, feature set and so on tend to be more important
> than a 10% difference in performance.
>
> Hopefully I would still be saying that even if RabbitMQ were "winning"
> your tests :-)
>
> Cheers, Simon
>
>
> On 18/06/13 04:00, JC wrote:
>
>> Hi,
>>
>> We are in the process of evaluating middleware and choosing which
>> middleware we pick for a potentially large scale distributed
>> application.    We did an evaluation between activemq and rabbitmq with
>> different test cases. So far activemq has outperformed rabbitmq using
>> the default out-of-box configuration especially on the latency side.
>> We use activemq openWire protocol vs. rabbit AMQP,  Here is one example
>> result of the test we did on 1 publisher/1 consumer and we measure the
>> latency from send to receive time.    Similar results we get from
>> multiple consumers as well.  Any one has done the similar benchmark?
>> Could you please share your experience?  And if anyone knows the tips to
>> boost rabbitmq performance, please let us know.   The rabbit test client
>> is using fanout exchange and MINIMAL_BASIC to publish messages.
>>
>> BrokerType      Publishers      Consumers       SlowConsumers
>> TgtMsgRate(mps)
>> TgtMsgLimit     AvgMsgSentRate(mps)     AvgSentTime(ns)
>> AvgMsgRcvRate(mps)
>> MinLat(ns)      MaxLat(ns)      AvgLat(ns)      MedLat(ns)      90%Lat(ns)
>> Activemq at middlewarebench        1       1       0       25000   1000000
>>         20776   5644    20776
>> 99484   7959080         259337  255760  316848
>> Rabbit at middlewarebench  1       1       0       25000   1000000
>> 20749   5440    20749
>> 171994  46140955        870211  913283  988979
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> Activemq at middlewarebench        1       1       0       100000  1000000
>>         62695   5347    62695
>> 100634  19872040        491588  359763  510862
>> Rabbit at middlewarebench  1       1       0       100000  1000000
>> 56850   6790    54512
>> 315808  822398215       487403726       487170082       696265654
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/6a5f19fd/attachment.htm>

From nuodbcloud at gmail.com  Tue Jun 18 11:26:33 2013
From: nuodbcloud at gmail.com (nuodb)
Date: Tue, 18 Jun 2013 03:26:33 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ sharding supprot
In-Reply-To: <a5a8acb6-b024-49df-95f1-97ecd8e764a8@googlegroups.com>
References: <a5a8acb6-b024-49df-95f1-97ecd8e764a8@googlegroups.com>
Message-ID: <1371551193575-27447.post@n5.nabble.com>

Deploy your data where and when its needed. A flexible deployment
architecture allows you to decouple storage and computational processing
resources to serve your customer and business needs anywhere in the world.
NuoDB enables  cloud database <http://www.nuodbcloud.com>   that will build
a global data management platform that's highly available with guaranteed
24/7 up-time, hot upgrades, built-in data redundancy and disaster recovery.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-sharding-supprot-tp27301p27447.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From leach_matthew at bah.com  Tue Jun 18 13:41:39 2013
From: leach_matthew at bah.com (Leach, Matthew [USA])
Date: Tue, 18 Jun 2013 12:41:39 +0000
Subject: [rabbitmq-discuss] rabbitmq start errors
Message-ID: <92AF286C6A28E6468EECBF295DA296AE300FD040@ASHBDAG1M3.resource.ds.bah.com>

I have installed erlang on my solaris 10 machine and when I type in erl I am taken to the erlang shell.  Since it is showing that erlang is installed properly I move onto rabbitmq.  When I go into the rabbitmq directory and type /sbin/rabbitmq-server I get the following error    sbin/rabbitmq-server: bad substitution      Any help is appreciated getting past this error

Matthew Leach
Associate
Booz | Allen | Hamilton
______________________

office: 703.377.8791
mobile: 703.887.7065
email:  leach_matthew at bah.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/f7f29ed2/attachment.htm>

From emile at rabbitmq.com  Tue Jun 18 16:08:24 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 18 Jun 2013 16:08:24 +0100
Subject: [rabbitmq-discuss] rabbitmq start errors
In-Reply-To: <92AF286C6A28E6468EECBF295DA296AE300FD040@ASHBDAG1M3.resource.ds.bah.com>
References: <92AF286C6A28E6468EECBF295DA296AE300FD040@ASHBDAG1M3.resource.ds.bah.com>
Message-ID: <51C077E8.9030000@rabbitmq.com>


Hi Matthew,

On 18/06/13 13:41, Leach, Matthew [USA] wrote:
> I have installed erlang on my solaris 10 machine and when I type in
> erl I am taken to the erlang shell.  Since it is showing that erlang
> is installed properly I move onto rabbitmq.

An even better check to see if Erlang is installed correctly is to run
"erl -sname foo".

> When I go into the rabbitmq directory and type /sbin/rabbitmq-server
> I get the following error sbin/rabbitmq-server: bad substitution Any
> help is appreciated getting past this error

As per my suggestion previously (3 June) see
http://www.rabbitmq.com/install-solaris.html




-Emile





From simon at rabbitmq.com  Tue Jun 18 16:09:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Jun 2013 16:09:12 +0100
Subject: [rabbitmq-discuss] rabbitmq start errors
In-Reply-To: <92AF286C6A28E6468EECBF295DA296AE300FD040@ASHBDAG1M3.resource.ds.bah.com>
References: <92AF286C6A28E6468EECBF295DA296AE300FD040@ASHBDAG1M3.resource.ds.bah.com>
Message-ID: <51C07818.5090908@rabbitmq.com>

Hi Matthew.

Last time you posted to this mailing list with a problem with the 
rabbitmq-server startup script it was because you had modified it and 
broken it.

Please be sure you have not modified the script.

Cheers, Simon

On 18/06/13 13:41, Leach, Matthew [USA] wrote:
> I have installed erlang on my solaris 10 machine and when I type in erl
> I am taken to the erlang shell.  Since it is showing that erlang is
> installed properly I move onto rabbitmq.  When I go into the rabbitmq
> directory and type /sbin/rabbitmq-server I get the following error
> sbin/rabbitmq-server: bad substitution      Any help is appreciated
> getting past this error
>
> Matthew Leach
>
> Associate
>
> Booz | Allen | Hamilton
>
> ______________________
>
> office: 703.377.8791
>
> mobile: 703.887.7065
>
> email:  leach_matthew at bah.com
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From tmehlinger at gmail.com  Tue Jun 18 16:11:29 2013
From: tmehlinger at gmail.com (Travis Mehlinger)
Date: Tue, 18 Jun 2013 10:11:29 -0500
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <51C03535.8010604@rabbitmq.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
	<51C03535.8010604@rabbitmq.com>
Message-ID: <CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>

Hi Simon,

We declare those queues as exclusive so they're getting cleaned up
automatically.

I ran the command you gave periodically over the course of the last two
hours. The row count and total size in the highlighted line are definitely
growing unchecked. All other values hovered closely around what you see in
the gist.

https://gist.github.com/tmehlinger/0c9a9a0d5fe1d31c8f6d#file-gistfile1-txt-L9

Thanks, Travis


On Tue, Jun 18, 2013 at 5:23 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. So I assume your monitoring code is not actually leaking those queues
> - they are getting deleted I assume? How? (Are they autodelete, exclusive,
> x-expires, deleted manually?)
>
> If so, can you run:
>
> rabbitmqctl eval '[{ets:info(T,size), ets:info(T,memory)} || T <-
> lists:sort(ets:all()), rabbit_mgmt_db <- [ets:info(T, name)]].'
>
> periodically? This will output a list of tuples showing the rows and bytes
> per table for each table in the mgmt DB. Do these increase?
>
> Cheers, Simon
>
>
> On 17/06/13 20:08, Travis Mehlinger wrote:
>
>> Hi Simon,
>>
>> I have more information for you. It turns out I hadn't fully understood
>> the interaction causing this to happen.
>>
>> Aside from their regular communication, our services also declare a
>> queue bound on # to an exchange that we use for collecting stats the
>> services store internally. In addition to hitting the REST API for
>> information about the broker, the monitor also opens a
>> connection/channel, declares an anonymous queue for itself, then sends a
>> message indicating to our services that they should respond with their
>> statistics. The services then send a message with a routing key that
>> will direct the response onto the queue declared by the monitor. This
>> happens every five seconds.
>>
>> It appears that this is in fact responsible for memory consumption
>> growing out of control. If I disable that aspect of monitoring and leave
>> the REST API monitor up, memory consumption stays level.
>>
>> The problem seems reminiscent of the issues described in this mailing
>> list thread:
>> http://rabbitmq.1065348.n5.**nabble.com/RabbitMQ-Queues-**
>> memory-leak-td25813.html<http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Queues-memory-leak-td25813.html>
>> .
>> However, the queues we declare for stats collection are *not* mirrored.
>>
>> Hope that helps narrow things down. :)
>>
>> Best, Travis
>>
>>
>> On Mon, Jun 17, 2013 at 12:58 PM, Travis Mehlinger <tmehlinger at gmail.com
>> <mailto:tmehlinger at gmail.com>> wrote:
>>
>>     Hi Simon,
>>
>>     I flipped our monitor back on and let Rabbit consume some additional
>>     memory. Invoking the garbage collector had no impact.
>>
>>     Let me know what further information you'd like to see and I'll be
>>     happy to provide it.
>>
>>     Thanks, Travis
>>
>>
>>     On Mon, Jun 17, 2013 at 10:32 AM, Simon MacMullen
>>     <simon at rabbitmq.com <mailto:simon at rabbitmq.com>> wrote:
>>
>>         On 17/06/13 15:45, Travis Mehlinger wrote:
>>
>>             Hi Simon,
>>
>>             Thanks for getting back to me. I'll need to restart our
>>             monitor and give
>>             it some time to leak the memory. I'll let you know the
>>             results sometime
>>             later today.
>>
>>             One thing I failed to mention in my initial report: whenever
>> we
>>             restarted one of our services, the queues they were using
>>             would get
>>             cleaned up (we have them set to auto-delete) and redeclared.
>>             Whenever we
>>             did that, we would see the memory consumption of the
>>             management DB fall
>>             off sharply before starting to rise again.
>>
>>
>>         That is presumably because the historical data the management
>>         plugin has been retaining for those queues got thrown away. If
>>         you don't want to retain this data at all, change the
>>         configuration as documented here:
>>
>>         http://www.rabbitmq.com/__**management.html#sample-__**retention<http://www.rabbitmq.com/__management.html#sample-__retention>
>>
>>         <http://www.rabbitmq.com/**management.html#sample-**retention<http://www.rabbitmq.com/management.html#sample-retention>
>> >
>>
>>         However, I (currently) don't believe it's this historical data
>>         you are seeing as "leaking" since making queries should not
>>         cause any more of it to be retained.
>>
>>         Cheers, Simon
>>
>>             Let me know if you'd like any further information in the
>>             meantime.
>>
>>             Best, Travis
>>
>>
>>             On Mon, Jun 17, 2013 at 6:39 AM, Simon MacMullen
>>             <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>>             <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>>
>> wrote:
>>
>>                  Hi. Thanks for the report.
>>
>>                  My first guess is that garbage collection for the
>>             management DB
>>                  process is happening too slowly. Can you invoke:
>>
>>                  $ rabbitmqctl eval
>>
>>             'P=global:whereis_name(rabbit_**____mgmt_db),M1=process_info(
>> **P,
>>                  memory),garbage_collect(P),M2=**____process_info(P,
>>                  memory),{M1,M2,rabbit_vm:____**memory()}.'
>>
>>
>>
>>                  and post the results?
>>
>>                  Cheers, Simon
>>
>>                  On 15/06/13 03:09, Travis Mehlinger wrote:
>>
>>                      We recently upgraded RabbitMQ from 3.0.4 to 3.1.1
>>             after noticing
>>                      two bug
>>                      fixes in 3.1.0 related to our RabbitMQ deployment:
>>
>>                         * 25524 fix memory leak in mirror queue slave
>>             with many
>>                      short-lived
>>                           publishing channel
>>                         * 25290 fix per-queue memory leak recording
>>             stats for mirror
>>                      queue slaves
>>
>>                      However, in our case, it seems that the management
>>             plugin may
>>                      still have
>>                      a memory leak. We have a monitoring agent that hits
>>             the REST API to
>>                      gather information about the broker (number of
>>             queues, queue depth,
>>                      etc.). With the monitoring agent running and making
>>             requests
>>                      against the
>>                      API, memory consumption steadily increased; when we
>>             stopped the
>>                      agent,
>>                      memory consumption in the management plugin leveled
>>             off.
>>
>>                      Here a couple graphs detailing memory consumption
>>             in the broker (the
>>                      figures are parsed from rabbitmqctl report). The
>>             first graph
>>                      shows the
>>                      ebb and flow of memory consumption in a number of
>>             components and the
>>                      second shows just consumption by the management
>>             plugin. You can see
>>                      pretty clearly where we stopped the monitoring
>>             agent at 1:20.
>>
>>             https://dl.dropboxusercontent.**
>> ____com/u/7022167/Screenshots/**n-____np6obt-m9f.png
>>
>>             <https://dl.__dropboxuserconte**nt.com/u/__7022167/**
>> Screenshots/n-np6obt-__m9f.png<http://dropboxusercontent.com/u/__7022167/Screenshots/n-np6obt-__m9f.png>
>>             <https://dl.**dropboxusercontent.com/u/**
>> 7022167/Screenshots/n-np6obt-**m9f.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>
>> >>
>>             https://dl.dropboxusercontent.**
>> ____com/u/7022167/Screenshots/**____an6dpup33xvx.png
>>
>>
>>             <https://dl.__dropboxuserconte**nt.com/u/__7022167/**
>> Screenshots/__an6dpup33xvx.png<http://dropboxusercontent.com/u/__7022167/Screenshots/__an6dpup33xvx.png>
>>
>>             <https://dl.**dropboxusercontent.com/u/**7022167/Screenshots/
>> **an6dpup33xvx.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>
>> >>
>>
>>                      We have two clustered brokers, both running
>>             RabbitMQ 3.1.1 on Erlang
>>                      R14B-04.1. There are typically around 200 queues,
>>             about 20 of
>>                      which are
>>                      mirrored. There are generally about 200 consumers.
>>             Messages are
>>                      rarely
>>                      queued and most queues typically sit idle.
>>
>>                      I'll be happy to provide any further diagnostic
>>             information.
>>
>>                      Thanks!
>>
>>
>>                      ______________________________**
>> _____________________
>>                      rabbitmq-discuss mailing list
>>                      rabbitmq-discuss at lists.__rabbi**__tmq.com<http://rabbi__tmq.com>
>>             <http://rabbitmq.com>
>>                      <mailto:rabbitmq-discuss at __lis**ts.rabbitmq.com<http://lists.rabbitmq.com>
>>             <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >>
>>             https://lists.rabbitmq.com/___**
>> _cgi-bin/mailman/listinfo/____**rabbitmq-discuss<https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>>             <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>> >
>>
>>
>>
>>             <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>             <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >>
>>
>>
>>
>>                  --
>>                  Simon MacMullen
>>                  RabbitMQ, Pivotal
>>
>>
>>
>>
>>         --
>>         Simon MacMullen
>>         RabbitMQ, Pivotal
>>
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/93d3bc72/attachment.htm>

From simon at rabbitmq.com  Tue Jun 18 16:47:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Jun 2013 16:47:08 +0100
Subject: [rabbitmq-discuss] |Spam| Re: Possible memory leak in the
 management plugin
In-Reply-To: <CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
	<51C03535.8010604@rabbitmq.com>
	<CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
Message-ID: <51C080FC.9090506@rabbitmq.com>

OK, that definitely looks like a leak. Could you also give me the output 
from:

rabbitmqctl eval '{[{T, ets:info(T,size), ets:info(T,memory)} || T <- 
lists:sort(ets:all()), rabbit_mgmt_db <- [ets:info(T, name)]], 
sys:get_status(global:whereis_name(rabbit_mgmt_db))}.'

to make sure I'm clear on which table is leaking.

Cheers, Simon

On 18/06/13 16:11, Travis Mehlinger wrote:
> Hi Simon,
>
> We declare those queues as exclusive so they're getting cleaned up
> automatically.
>
> I ran the command you gave periodically over the course of the last two
> hours. The row count and total size in the highlighted line are
> definitely growing unchecked. All other values hovered closely around
> what you see in the gist.
>
> https://gist.github.com/tmehlinger/0c9a9a0d5fe1d31c8f6d#file-gistfile1-txt-L9
>
> Thanks, Travis
>
>
> On Tue, Jun 18, 2013 at 5:23 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi. So I assume your monitoring code is not actually leaking those
>     queues - they are getting deleted I assume? How? (Are they
>     autodelete, exclusive, x-expires, deleted manually?)
>
>     If so, can you run:
>
>     rabbitmqctl eval '[{ets:info(T,size), ets:info(T,memory)} || T <-
>     lists:sort(ets:all()), rabbit_mgmt_db <- [ets:info(T, name)]].'
>
>     periodically? This will output a list of tuples showing the rows and
>     bytes per table for each table in the mgmt DB. Do these increase?
>
>     Cheers, Simon
>
>
>     On 17/06/13 20:08, Travis Mehlinger wrote:
>
>         Hi Simon,
>
>         I have more information for you. It turns out I hadn't fully
>         understood
>         the interaction causing this to happen.
>
>         Aside from their regular communication, our services also declare a
>         queue bound on # to an exchange that we use for collecting stats the
>         services store internally. In addition to hitting the REST API for
>         information about the broker, the monitor also opens a
>         connection/channel, declares an anonymous queue for itself, then
>         sends a
>         message indicating to our services that they should respond with
>         their
>         statistics. The services then send a message with a routing key that
>         will direct the response onto the queue declared by the monitor.
>         This
>         happens every five seconds.
>
>         It appears that this is in fact responsible for memory consumption
>         growing out of control. If I disable that aspect of monitoring
>         and leave
>         the REST API monitor up, memory consumption stays level.
>
>         The problem seems reminiscent of the issues described in this
>         mailing
>         list thread:
>         http://rabbitmq.1065348.n5.__nabble.com/RabbitMQ-Queues-__memory-leak-td25813.html
>         <http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Queues-memory-leak-td25813.html>.
>         However, the queues we declare for stats collection are *not*
>         mirrored.
>
>         Hope that helps narrow things down. :)
>
>         Best, Travis
>
>
>         On Mon, Jun 17, 2013 at 12:58 PM, Travis Mehlinger
>         <tmehlinger at gmail.com <mailto:tmehlinger at gmail.com>
>         <mailto:tmehlinger at gmail.com <mailto:tmehlinger at gmail.com>>> wrote:
>
>              Hi Simon,
>
>              I flipped our monitor back on and let Rabbit consume some
>         additional
>              memory. Invoking the garbage collector had no impact.
>
>              Let me know what further information you'd like to see and
>         I'll be
>              happy to provide it.
>
>              Thanks, Travis
>
>
>              On Mon, Jun 17, 2013 at 10:32 AM, Simon MacMullen
>              <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>                  On 17/06/13 15:45, Travis Mehlinger wrote:
>
>                      Hi Simon,
>
>                      Thanks for getting back to me. I'll need to restart our
>                      monitor and give
>                      it some time to leak the memory. I'll let you know the
>                      results sometime
>                      later today.
>
>                      One thing I failed to mention in my initial report:
>         whenever we
>                      restarted one of our services, the queues they were
>         using
>                      would get
>                      cleaned up (we have them set to auto-delete) and
>         redeclared.
>                      Whenever we
>                      did that, we would see the memory consumption of the
>                      management DB fall
>                      off sharply before starting to rise again.
>
>
>                  That is presumably because the historical data the
>         management
>                  plugin has been retaining for those queues got thrown
>         away. If
>                  you don't want to retain this data at all, change the
>                  configuration as documented here:
>
>         http://www.rabbitmq.com/____management.html#sample-____retention
>         <http://www.rabbitmq.com/__management.html#sample-__retention>
>
>
>         <http://www.rabbitmq.com/__management.html#sample-__retention
>         <http://www.rabbitmq.com/management.html#sample-retention>>
>
>                  However, I (currently) don't believe it's this
>         historical data
>                  you are seeing as "leaking" since making queries should not
>                  cause any more of it to be retained.
>
>                  Cheers, Simon
>
>                      Let me know if you'd like any further information
>         in the
>                      meantime.
>
>                      Best, Travis
>
>
>                      On Mon, Jun 17, 2013 at 6:39 AM, Simon MacMullen
>                      <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>                      <mailto:simon at rabbitmq.com
>         <mailto:simon at rabbitmq.com> <mailto:simon at rabbitmq.com
>         <mailto:simon at rabbitmq.com>>>> wrote:
>
>                           Hi. Thanks for the report.
>
>                           My first guess is that garbage collection for the
>                      management DB
>                           process is happening too slowly. Can you invoke:
>
>                           $ rabbitmqctl eval
>
>
>         'P=global:whereis_name(rabbit_______mgmt_db),M1=process_info(__P,
>
>           memory),garbage_collect(P),M2=______process_info(P,
>                           memory),{M1,M2,rabbit_vm:______memory()}.'
>
>
>
>                           and post the results?
>
>                           Cheers, Simon
>
>                           On 15/06/13 03:09, Travis Mehlinger wrote:
>
>                               We recently upgraded RabbitMQ from 3.0.4
>         to 3.1.1
>                      after noticing
>                               two bug
>                               fixes in 3.1.0 related to our RabbitMQ
>         deployment:
>
>                                  * 25524 fix memory leak in mirror queue
>         slave
>                      with many
>                               short-lived
>                                    publishing channel
>                                  * 25290 fix per-queue memory leak recording
>                      stats for mirror
>                               queue slaves
>
>                               However, in our case, it seems that the
>         management
>                      plugin may
>                               still have
>                               a memory leak. We have a monitoring agent
>         that hits
>                      the REST API to
>                               gather information about the broker (number of
>                      queues, queue depth,
>                               etc.). With the monitoring agent running
>         and making
>                      requests
>                               against the
>                               API, memory consumption steadily
>         increased; when we
>                      stopped the
>                               agent,
>                               memory consumption in the management
>         plugin leveled
>                      off.
>
>                               Here a couple graphs detailing memory
>         consumption
>                      in the broker (the
>                               figures are parsed from rabbitmqctl
>         report). The
>                      first graph
>                               shows the
>                               ebb and flow of memory consumption in a
>         number of
>                      components and the
>                               second shows just consumption by the
>         management
>                      plugin. You can see
>                               pretty clearly where we stopped the monitoring
>                      agent at 1:20.
>
>         https://dl.dropboxusercontent.______com/u/7022167/Screenshots/__n-____np6obt-m9f.png
>
>
>         <https://dl.__dropboxuserconte__nt.com/u/__7022167/__Screenshots/n-np6obt-__m9f.png
>         <http://dropboxusercontent.com/u/__7022167/Screenshots/n-np6obt-__m9f.png>
>
>         <https://dl.__dropboxusercontent.com/u/__7022167/Screenshots/n-np6obt-__m9f.png
>         <https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>>>
>         https://dl.dropboxusercontent.______com/u/7022167/Screenshots/______an6dpup33xvx.png
>
>
>
>         <https://dl.__dropboxuserconte__nt.com/u/__7022167/__Screenshots/__an6dpup33xvx.png
>         <http://dropboxusercontent.com/u/__7022167/Screenshots/__an6dpup33xvx.png>
>
>
>         <https://dl.__dropboxusercontent.com/u/__7022167/Screenshots/__an6dpup33xvx.png
>         <https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>>>
>
>                               We have two clustered brokers, both running
>                      RabbitMQ 3.1.1 on Erlang
>                               R14B-04.1. There are typically around 200
>         queues,
>                      about 20 of
>                               which are
>                               mirrored. There are generally about 200
>         consumers.
>                      Messages are
>                               rarely
>                               queued and most queues typically sit idle.
>
>                               I'll be happy to provide any further
>         diagnostic
>                      information.
>
>                               Thanks!
>
>
>
>           _____________________________________________________
>                               rabbitmq-discuss mailing list
>                               rabbitmq-discuss at lists.__rabbi____tmq.com
>         <http://rabbi__tmq.com>
>                      <http://rabbitmq.com>
>                               <mailto:rabbitmq-discuss@
>         <mailto:rabbitmq-discuss@>__lis__ts.rabbitmq.com
>         <http://lists.rabbitmq.com>
>                      <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>>
>         https://lists.rabbitmq.com/______cgi-bin/mailman/listinfo/______rabbitmq-discuss
>         <https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>
>         <https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>>
>
>
>
>
>         <https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>>
>
>
>
>                           --
>                           Simon MacMullen
>                           RabbitMQ, Pivotal
>
>
>
>
>                  --
>                  Simon MacMullen
>                  RabbitMQ, Pivotal
>
>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From alan.antonuk at gmail.com  Tue Jun 18 17:51:38 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 18 Jun 2013 09:51:38 -0700
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <CAE3HoVQ3SY1qzHKDo6KDV2vysfaWuk7ZY-VFiWL3vQpt1CccBg@mail.gmail.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<1371556309616-27452.post@n5.nabble.com>
	<CAE3HoVQ3SY1qzHKDo6KDV2vysfaWuk7ZY-VFiWL3vQpt1CccBg@mail.gmail.com>
Message-ID: <CAAt2poKqku11+6P+Y9vg=1U625w2CjvNhcEwkseHh-gEOWQefA@mail.gmail.com>

On Tue, Jun 18, 2013 at 4:58 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/6/18 3k4b251 <314992959 at qq.com>
>
>> I know  the channel  of sender,but how can I know
>> which  queue  this message from
>>
>
> Every delivery has a consumer tag (identifier). The same tag will be
> availalbe on the basic.consume-ok method
> returned by basic.consume (sorry, I'm not sure what function/struct
> exactly that translates in the C client).
>

The structs you'd care about in rabbitmq-c are:

amqp_basic_consume_ok_t (
https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp_framing.h#L394
)

amqp_basic_deliver_t (
https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp_framing.h#L427
)

The amqp_basic_deliver_t method is the first method delivered in this
message reading loop:
https://github.com/alanxz/rabbitmq-c/blob/master/examples/amqp_consumer.c#L81

You can do the following to get an amqp_basic_delivery_t object from the
frame:

amqp_basic_deliver_t *delivery = (amqp_basic_deliver_t
*)frame.method.decoded;



> If you keep a mapping of consumers to queues, you will be able to look up
> queues by consumer tag.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/982e87d0/attachment.htm>

From alan.antonuk at gmail.com  Tue Jun 18 17:58:32 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 18 Jun 2013 09:58:32 -0700
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
	<CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>
Message-ID: <CAAt2poL5q_=fLAOMxKFFNzP_=oZCcuj=Lfuuu0C-aR2+rsRUJg@mail.gmail.com>

On Tue, Jun 18, 2013 at 4:54 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> 2013/6/18 Tim Watson <tim at rabbitmq.com>
>
>> And message ordering between threads sharing that channel doesn't matter,
>> presumably?
>
>
> Good point.
>
> Sharing channels between threads that publish is generally a bad idea:
> most clients don't offer synchronization and frames may get interleaved in
> an incorrect way. So for N publishers, you need N channels.
>
> Sharing channels between threads that consume may be safe but it really
> depends on whether you need message processing order guarantees
> and if any of the consumers share a queue.
>

rabbitmq-c doesn't synchronize use of any part of the connection. Using a
rabbitmq-c object from multiple threads requires external synchronization.
Additionally if you want to consume messages in one thread while executing
other AMQP methods in another using the same connection there is some
knowledge of the AMQP protocol required in order not to transmit a method
at inappropriate moment between frames.

-- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/57aea305/attachment.htm>

From girish at giri.sh  Tue Jun 18 19:00:36 2013
From: girish at giri.sh (Girish Gangadharan)
Date: Tue, 18 Jun 2013 13:00:36 -0500
Subject: [rabbitmq-discuss] Mirrored queues behind a load balancer
In-Reply-To: <1C1F9584-70B1-4957-AE7A-75D3F7C2F501@rabbitmq.com>
References: <49b335bf-8c06-4d5e-8a33-070ea2df984a@googlegroups.com>
	<51BADC69.6020501@rabbitmq.com>
	<CAGT39YvSuJCUwQv8Bm+WEhkR3NncgXb5NP=1GQiitJKOnpyGiA@mail.gmail.com>
	<CAD6m6fE6xc4XH+r_JXYvGoayTxHaC00A-CgXM1qC0dUjMY7x1g@mail.gmail.com>
	<1C1F9584-70B1-4957-AE7A-75D3F7C2F501@rabbitmq.com>
Message-ID: <CAGT39Yui8yX-CE=v0PYkX+Z5R_d-50mTPraO7zCbkEk84CBMEQ@mail.gmail.com>

Thank you.

On Mon, Jun 17, 2013 at 3:18 AM, Tim Watson <watson.timothy at gmail.com>wrote:

> On 17 Jun 2013, at 05:24, Jason McIntosh <mcintoshj at gmail.com> wrote:
>
> > Queues exist (definition wise) on all nodes in a cluster.  Messages only
> existing unless the queue is mirrored on a single node.
> [snip]
> > One reason you'd NOT have queues have their messages automatically
> replicated to other nodes is scaling.  If you had a cluster of 10 machines,
> and all the machines mirrored, then your message would have to hit all 10
> nodes before being acknowledged
>
> And to clarify, another reason why we have a consistent view of schema
> (I.e., definitions) is so that clients can connect to *any* node to
> interact with the queue.
>
> > Rabbit is also a Master-slave write system.
> > Only ONE node in a cluster is the "master".
>
> Correction: rabbit HA is a master/slave system. Rabbit clustering is not
> and all nodes are considered equal.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/eef99b3f/attachment.htm>

From girish at giri.sh  Tue Jun 18 19:00:26 2013
From: girish at giri.sh (Girish Gangadharan)
Date: Tue, 18 Jun 2013 13:00:26 -0500
Subject: [rabbitmq-discuss] Mirrored queues behind a load balancer
In-Reply-To: <CAD6m6fE6xc4XH+r_JXYvGoayTxHaC00A-CgXM1qC0dUjMY7x1g@mail.gmail.com>
References: <49b335bf-8c06-4d5e-8a33-070ea2df984a@googlegroups.com>
	<51BADC69.6020501@rabbitmq.com>
	<CAGT39YvSuJCUwQv8Bm+WEhkR3NncgXb5NP=1GQiitJKOnpyGiA@mail.gmail.com>
	<CAD6m6fE6xc4XH+r_JXYvGoayTxHaC00A-CgXM1qC0dUjMY7x1g@mail.gmail.com>
Message-ID: <CAGT39YvDdjrCKB3tMNCADi8bgCijfhcnP-dPNfsdmujh+-UfxQ@mail.gmail.com>

Thank you.

On Sun, Jun 16, 2013 at 11:24 PM, Jason McIntosh <mcintoshj at gmail.com>wrote:

> Queues exist (definition wise) on all nodes in a cluster.  Messages only
> existing unless the queue is mirrored on a single node.  You can mirror a
> queue's messages to N number of cluster nodes.  Admin console is an overall
> view of the cluster, so you'll see all the available
> nodes/queues/exchanges/etc.
>
> One reason you'd NOT have queues have their messages automatically
> replicated to other nodes is scaling.  If you had a cluster of 10 machines,
> and all the machines mirrored, then your message would have to hit all 10
> nodes before being acknowledged (publish confirm situation as I recall).
>  You CAN instead say a queue must be mirrored on N number of nodes,
> allowing a failover capacity of N.
>
> Rabbit is also a Master-slave write system. Only ONE node in a cluster is
> the "master".  Other nodes would be there for failover/scaling support.
>  i.e. queues could be created on any one of the nodes in a cluster to
> distribute load.  In the event of a failure on the master, a slave node
> would take over the masters position.  When the old master comes on line,
> it becomes a slave, but unless you have 3.1 and auto healing type stuff, it
> would only get messages as of the time it has recovered, leaving an
> indeterminate amount of time before it goes back into sync.
>
> Further, if clients do auto queue creation, it can get even more
> complex/diverse.  RabbitMQ makes messaging pretty simple but architecting
> it right and true understanding is a much bigger issue.
>
> Jason
>
>
> On Fri, Jun 14, 2013 at 10:37 AM, Girish Gangadharan <girish at giri.sh>wrote:
>
>> Thanks for your reply. Please see my response in red.
>>
>> On Fri, Jun 14, 2013 at 4:03 AM, Emile Joubert <emile at rabbitmq.com>wrote:
>>
>>>
>>> Hi,
>>>
>>> On 13/06/13 20:41, Girish Gangadharan wrote:
>>> > For example, if a publisher writes a message to an exchange that ends
>>> > up in a specific queue bound to that exchange, it immediately shows
>>> > up in the same queue on the other node.
>>>
>>> There is only one queue on one node in this case. The cluster offers a
>>> consistent view of all resources in the cluster and allows producers and
>>> consumers to connect to any node. Messages are transparently routed
>>> across the cluster.
>>>
>>
>> Does this mean that the queues actually exist only in one node to whose
>> exchange the message was originally written to? And the fact that I can see
>> them in the admin console of the other node is just to provide a consistent
>> view across the cluster? So any action that I do with the original queue on
>> the other nodes' admin consoles basically makes the changes to the queue on
>> the original node and not to the copy of that queue on the other nodes? In
>> fact, if I understand you correctly, there IS no copy of the queue on the
>> other nodes? Did I get that right?
>>
>> Not sure I understand the consistent view explanation either? What are
>> the main benefits of having multiple nodes in a cluster if they can't
>> really share anything? I would think Mirrored Queues should be an automatic
>> by-product of clustering, thus offering HA out of the box. Can you explain
>> to me why somebody would create a cluster of nodes and NOT have mirrored
>> queues set up?
>>
>>
>>>
>>> > But then why does the article on Mirrored Queues say that *you have
>>> > to explicitly set up mirrored queues by policy*?
>>>
>>> If a queue exists on only one node and that node crashes then the queue
>>> becomes unavailable. Mirrored queues provides resilience by maintaining
>>> copies of the queue that can take over in case a node crashes. See
>>> http://www.rabbitmq.com/ha.html
>>>
>>> > So if one node goes down, the load balancer would automatically
>>> > redirect all the traffic just to the node that is up and running. And
>>> > the clients will not be affected. Would that work? Is that the
>>> > recommended approach?
>>>
>>> That is a common approach. Another is to provide clients with reconnect
>>> logic that allows them to select the alternative node when one node
>>> crashes.
>>>
>>> > I was thinking about using Shoveling technique to push messages from
>>> > a logical broker sitting on a cluster in our local HA servers to a
>>> > different logical broker to the DR server. In this case, a copy of
>>> > the messages will keep getting pumped into the DR with no clients
>>> > processing it. What will happen to those messages?
>>>
>>> Nothing will happen to them. They will accumulate in the DR server
>>> unless you take action to remove them, or unless they expire.
>>>
>>> > Should I have a workflow to go purge them every day manually or via a
>>> > script (after I make sure those messages aren't needed anymore since
>>> > the clients have already process them from the main HA cluster).
>>>
>>> That depends on the specifics of your disaster scenario, your messaging
>>> pattern and how you plan to switch over to your DR environment. Purging
>>> queues after a day sounds reasonable.
>>>
>>> > If the main HA cluster goes down and I have to bring the DR server into
>>> > action, what happens to the messages that did get processed already by
>>> > the clients? Should the clients have logic built in to ignore
>>> duplicates
>>> > to handle this specific scenario?
>>>
>>> Performing deduplication in clients is probably the simplest solution,
>>> or you could mirror the effects of consumers removing messages from
>>> queues in your DR environment.
>>>
>>>
>>>
>>> -Emile
>>>
>>>
>>>
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Jason McIntosh
> http://mcintosh.poetshome.com/blog/
> 573-424-7612
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/057111d3/attachment.htm>

From CLefevre at Transparent.com  Tue Jun 18 21:16:07 2013
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 18 Jun 2013 20:16:07 +0000
Subject: [rabbitmq-discuss] Using a local system account to run the RMQ
 Windows Service, where does Mnesia store it's data?
Message-ID: <5798631D5F355D4C99FDF23580295AF81A0A0A4E@TLMAIL1.Transparent.local>

We are using a Windows 2008 Server R2 for our RabbitMQ server.  With RabbitMQ 3.0.4 running as a service, under the local system account. This service, to be in a cluster needed the .erlang.cookie to be in the C:\Windows directory.

With that said, where would the MNESIA database files be located?

Currently I can only see them under my account on the server, however, those do not seem to be the correct files? I ask as we are trying to integrate with Hyperic HQ, and we can't seem to find the proper MNESIA DB files that would yield the proper monitoring/statistics.

I can't seem to find any way to show the file locations via Rabbitmqctl.bat or the Rabbit Management Plugin.

Thank you for your time,
-Christopher Lefevre

The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/b0d18fed/attachment.htm>

From matthias at rabbitmq.com  Tue Jun 18 22:52:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 18 Jun 2013 22:52:51 +0100
Subject: [rabbitmq-discuss] Using a local system account to run the RMQ
 Windows Service, where does Mnesia store it's data?
In-Reply-To: <5798631D5F355D4C99FDF23580295AF81A0A0A4E@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF81A0A0A4E@TLMAIL1.Transparent.local>
Message-ID: <51C0D6B3.3000609@rabbitmq.com>

On 18/06/13 21:16, Christopher Lefevre wrote:
> I can?t seem to find any way to show the file locations via
> Rabbitmqctl.bat or the Rabbit Management Plugin.

Check the beginning of rabbit's log file.

Matthias.

From tmehlinger at gmail.com  Tue Jun 18 23:23:24 2013
From: tmehlinger at gmail.com (Travis Mehlinger)
Date: Tue, 18 Jun 2013 17:23:24 -0500
Subject: [rabbitmq-discuss] |Spam| Re: Possible memory leak in the
 management plugin
In-Reply-To: <51C080FC.9090506@rabbitmq.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
	<51C03535.8010604@rabbitmq.com>
	<CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
	<51C080FC.9090506@rabbitmq.com>
Message-ID: <CACCscvz4fc3eC37aUUOBN2qZtswCBCfLZLF4NMagwGiALGzebg@mail.gmail.com>

Hi Simon,

Sure thing, here you go:
https://gist.github.com/tmehlinger/158bb003fe3d64618a4e

Best, Travis


On Tue, Jun 18, 2013 at 10:47 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> OK, that definitely looks like a leak. Could you also give me the output
> from:
>
> rabbitmqctl eval '{[{T, ets:info(T,size), ets:info(T,memory)} || T <-
> lists:sort(ets:all()), rabbit_mgmt_db <- [ets:info(T, name)]],
> sys:get_status(global:whereis_**name(rabbit_mgmt_db))}.'
>
> to make sure I'm clear on which table is leaking.
>
> Cheers, Simon
>
> On 18/06/13 16:11, Travis Mehlinger wrote:
>
>> Hi Simon,
>>
>> We declare those queues as exclusive so they're getting cleaned up
>> automatically.
>>
>> I ran the command you gave periodically over the course of the last two
>> hours. The row count and total size in the highlighted line are
>> definitely growing unchecked. All other values hovered closely around
>> what you see in the gist.
>>
>> https://gist.github.com/**tmehlinger/**0c9a9a0d5fe1d31c8f6d#file-**
>> gistfile1-txt-L9<https://gist.github.com/tmehlinger/0c9a9a0d5fe1d31c8f6d#file-gistfile1-txt-L9>
>>
>> Thanks, Travis
>>
>>
>> On Tue, Jun 18, 2013 at 5:23 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Hi. So I assume your monitoring code is not actually leaking those
>>     queues - they are getting deleted I assume? How? (Are they
>>     autodelete, exclusive, x-expires, deleted manually?)
>>
>>     If so, can you run:
>>
>>     rabbitmqctl eval '[{ets:info(T,size), ets:info(T,memory)} || T <-
>>     lists:sort(ets:all()), rabbit_mgmt_db <- [ets:info(T, name)]].'
>>
>>     periodically? This will output a list of tuples showing the rows and
>>     bytes per table for each table in the mgmt DB. Do these increase?
>>
>>     Cheers, Simon
>>
>>
>>     On 17/06/13 20:08, Travis Mehlinger wrote:
>>
>>         Hi Simon,
>>
>>         I have more information for you. It turns out I hadn't fully
>>         understood
>>         the interaction causing this to happen.
>>
>>         Aside from their regular communication, our services also declare
>> a
>>         queue bound on # to an exchange that we use for collecting stats
>> the
>>         services store internally. In addition to hitting the REST API for
>>         information about the broker, the monitor also opens a
>>         connection/channel, declares an anonymous queue for itself, then
>>         sends a
>>         message indicating to our services that they should respond with
>>         their
>>         statistics. The services then send a message with a routing key
>> that
>>         will direct the response onto the queue declared by the monitor.
>>         This
>>         happens every five seconds.
>>
>>         It appears that this is in fact responsible for memory consumption
>>         growing out of control. If I disable that aspect of monitoring
>>         and leave
>>         the REST API monitor up, memory consumption stays level.
>>
>>         The problem seems reminiscent of the issues described in this
>>         mailing
>>         list thread:
>>         http://rabbitmq.1065348.n5.__n**abble.com/RabbitMQ-Queues-__**
>> memory-leak-td25813.html<http://nabble.com/RabbitMQ-Queues-__memory-leak-td25813.html>
>>         <http://rabbitmq.1065348.n5.**nabble.com/RabbitMQ-Queues-**
>> memory-leak-td25813.html<http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Queues-memory-leak-td25813.html>
>> >.
>>         However, the queues we declare for stats collection are *not*
>>         mirrored.
>>
>>         Hope that helps narrow things down. :)
>>
>>         Best, Travis
>>
>>
>>         On Mon, Jun 17, 2013 at 12:58 PM, Travis Mehlinger
>>         <tmehlinger at gmail.com <mailto:tmehlinger at gmail.com>
>>         <mailto:tmehlinger at gmail.com <mailto:tmehlinger at gmail.com>>**>
>> wrote:
>>
>>              Hi Simon,
>>
>>              I flipped our monitor back on and let Rabbit consume some
>>         additional
>>              memory. Invoking the garbage collector had no impact.
>>
>>              Let me know what further information you'd like to see and
>>         I'll be
>>              happy to provide it.
>>
>>              Thanks, Travis
>>
>>
>>              On Mon, Jun 17, 2013 at 10:32 AM, Simon MacMullen
>>              <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>
>>                  On 17/06/13 15:45, Travis Mehlinger wrote:
>>
>>                      Hi Simon,
>>
>>                      Thanks for getting back to me. I'll need to restart
>> our
>>                      monitor and give
>>                      it some time to leak the memory. I'll let you know
>> the
>>                      results sometime
>>                      later today.
>>
>>                      One thing I failed to mention in my initial report:
>>         whenever we
>>                      restarted one of our services, the queues they were
>>         using
>>                      would get
>>                      cleaned up (we have them set to auto-delete) and
>>         redeclared.
>>                      Whenever we
>>                      did that, we would see the memory consumption of the
>>                      management DB fall
>>                      off sharply before starting to rise again.
>>
>>
>>                  That is presumably because the historical data the
>>         management
>>                  plugin has been retaining for those queues got thrown
>>         away. If
>>                  you don't want to retain this data at all, change the
>>                  configuration as documented here:
>>
>>         http://www.rabbitmq.com/____**management.html#sample-____**
>> retention<http://www.rabbitmq.com/____management.html#sample-____retention>
>>         <http://www.rabbitmq.com/__**management.html#sample-__**retention<http://www.rabbitmq.com/__management.html#sample-__retention>
>> >
>>
>>
>>         <http://www.rabbitmq.com/__**management.html#sample-__**retention<http://www.rabbitmq.com/__management.html#sample-__retention>
>>         <http://www.rabbitmq.com/**management.html#sample-**retention<http://www.rabbitmq.com/management.html#sample-retention>
>> >>
>>
>>                  However, I (currently) don't believe it's this
>>         historical data
>>                  you are seeing as "leaking" since making queries should
>> not
>>                  cause any more of it to be retained.
>>
>>                  Cheers, Simon
>>
>>                      Let me know if you'd like any further information
>>         in the
>>                      meantime.
>>
>>                      Best, Travis
>>
>>
>>                      On Mon, Jun 17, 2013 at 6:39 AM, Simon MacMullen
>>                      <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>>                      <mailto:simon at rabbitmq.com
>>         <mailto:simon at rabbitmq.com> <mailto:simon at rabbitmq.com
>>         <mailto:simon at rabbitmq.com>>>> wrote:
>>
>>                           Hi. Thanks for the report.
>>
>>                           My first guess is that garbage collection for
>> the
>>                      management DB
>>                           process is happening too slowly. Can you invoke:
>>
>>                           $ rabbitmqctl eval
>>
>>
>>         'P=global:whereis_name(rabbit_**______mgmt_db),M1=process_**
>> info(__P,
>>
>>           memory),garbage_collect(P),M2=**______process_info(P,
>>                           memory),{M1,M2,rabbit_vm:_____**_memory()}.'
>>
>>
>>
>>                           and post the results?
>>
>>                           Cheers, Simon
>>
>>                           On 15/06/13 03:09, Travis Mehlinger wrote:
>>
>>                               We recently upgraded RabbitMQ from 3.0.4
>>         to 3.1.1
>>                      after noticing
>>                               two bug
>>                               fixes in 3.1.0 related to our RabbitMQ
>>         deployment:
>>
>>                                  * 25524 fix memory leak in mirror queue
>>         slave
>>                      with many
>>                               short-lived
>>                                    publishing channel
>>                                  * 25290 fix per-queue memory leak
>> recording
>>                      stats for mirror
>>                               queue slaves
>>
>>                               However, in our case, it seems that the
>>         management
>>                      plugin may
>>                               still have
>>                               a memory leak. We have a monitoring agent
>>         that hits
>>                      the REST API to
>>                               gather information about the broker (number
>> of
>>                      queues, queue depth,
>>                               etc.). With the monitoring agent running
>>         and making
>>                      requests
>>                               against the
>>                               API, memory consumption steadily
>>         increased; when we
>>                      stopped the
>>                               agent,
>>                               memory consumption in the management
>>         plugin leveled
>>                      off.
>>
>>                               Here a couple graphs detailing memory
>>         consumption
>>                      in the broker (the
>>                               figures are parsed from rabbitmqctl
>>         report). The
>>                      first graph
>>                               shows the
>>                               ebb and flow of memory consumption in a
>>         number of
>>                      components and the
>>                               second shows just consumption by the
>>         management
>>                      plugin. You can see
>>                               pretty clearly where we stopped the
>> monitoring
>>                      agent at 1:20.
>>
>>         https://dl.dropboxusercontent.**______com/u/7022167/**
>> Screenshots/__n-____np6obt-**m9f.png
>>
>>
>>         <https://dl.__dropboxuserconte**__nt.com/u/__7022167/__**
>> Screenshots/n-np6obt-__m9f.png<http://dropboxuserconte__nt.com/u/__7022167/__Screenshots/n-np6obt-__m9f.png>
>>         <http://dropboxusercontent.**com/u/__7022167/Screenshots/n-**
>> np6obt-__m9f.png<http://dropboxusercontent.com/u/__7022167/Screenshots/n-np6obt-__m9f.png>
>> >
>>
>>         <https://dl.__dropboxuserconte**nt.com/u/__7022167/**
>> Screenshots/n-np6obt-__m9f.png<http://dropboxusercontent.com/u/__7022167/Screenshots/n-np6obt-__m9f.png>
>>         <https://dl.**dropboxusercontent.com/u/**
>> 7022167/Screenshots/n-np6obt-**m9f.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png>
>> >>>
>>         https://dl.dropboxusercontent.**______com/u/7022167/**
>> Screenshots/______**an6dpup33xvx.png
>>
>>
>>
>>         <https://dl.__dropboxuserconte**__nt.com/u/__7022167/__**
>> Screenshots/__an6dpup33xvx.png<http://dropboxuserconte__nt.com/u/__7022167/__Screenshots/__an6dpup33xvx.png>
>>         <http://dropboxusercontent.**com/u/__7022167/Screenshots/__**
>> an6dpup33xvx.png<http://dropboxusercontent.com/u/__7022167/Screenshots/__an6dpup33xvx.png>
>> >
>>
>>
>>         <https://dl.__dropboxuserconte**nt.com/u/__7022167/**
>> Screenshots/__an6dpup33xvx.png<http://dropboxusercontent.com/u/__7022167/Screenshots/__an6dpup33xvx.png>
>>         <https://dl.**dropboxusercontent.com/u/**7022167/Screenshots/**
>> an6dpup33xvx.png<https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png>
>> >>>
>>
>>                               We have two clustered brokers, both running
>>                      RabbitMQ 3.1.1 on Erlang
>>                               R14B-04.1. There are typically around 200
>>         queues,
>>                      about 20 of
>>                               which are
>>                               mirrored. There are generally about 200
>>         consumers.
>>                      Messages are
>>                               rarely
>>                               queued and most queues typically sit idle.
>>
>>                               I'll be happy to provide any further
>>         diagnostic
>>                      information.
>>
>>                               Thanks!
>>
>>
>>
>>           ______________________________**_______________________
>>                               rabbitmq-discuss mailing list
>>                               rabbitmq-discuss at lists.__rabbi**____tmq.com<http://rabbi____tmq.com>
>>         <http://rabbi__tmq.com>
>>                      <http://rabbitmq.com>
>>                               <mailto:rabbitmq-discuss@
>>         <mailto:rabbitmq-discuss@>__li**s__ts.rabbitmq.com<http://lis__ts.rabbitmq.com>
>>         <http://lists.rabbitmq.com>
>>                      <mailto:rabbitmq-discuss at __lis**ts.rabbitmq.com<http://lists.rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >>>
>>         https://lists.rabbitmq.com/___**___cgi-bin/mailman/listinfo/__**
>> ____rabbitmq-discuss<https://lists.rabbitmq.com/______cgi-bin/mailman/listinfo/______rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/__**__cgi-bin/mailman/listinfo/___**
>> _rabbitmq-discuss<https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>> >
>>
>>         <https://lists.rabbitmq.com/__**__cgi-bin/mailman/listinfo/___**
>> _rabbitmq-discuss<https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>> >>
>>
>>
>>
>>
>>         <https://lists.rabbitmq.com/__**__cgi-bin/mailman/listinfo/___**
>> _rabbitmq-discuss<https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>> >
>>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >>>
>>
>>
>>
>>                           --
>>                           Simon MacMullen
>>                           RabbitMQ, Pivotal
>>
>>
>>
>>
>>                  --
>>                  Simon MacMullen
>>                  RabbitMQ, Pivotal
>>
>>
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, Pivotal
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/04ecfd56/attachment.htm>

From 314992959 at qq.com  Wed Jun 19 02:28:26 2013
From: 314992959 at qq.com (3k4b251)
Date: Tue, 18 Jun 2013 18:28:26 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <CAAt2poKqku11+6P+Y9vg=1U625w2CjvNhcEwkseHh-gEOWQefA@mail.gmail.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<1371556309616-27452.post@n5.nabble.com>
	<CAE3HoVQ3SY1qzHKDo6KDV2vysfaWuk7ZY-VFiWL3vQpt1CccBg@mail.gmail.com>
	<CAAt2poKqku11+6P+Y9vg=1U625w2CjvNhcEwkseHh-gEOWQefA@mail.gmail.com>
Message-ID: <1371605306823-27469.post@n5.nabble.com>

I  read  the  "amqpcpp-master"   example.  I  find  It  Create  Channel  for  
every  queue.   should  I  follow  that?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-many-channels-I-need-tp27448p27469.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From 314992959 at qq.com  Wed Jun 19 03:53:46 2013
From: 314992959 at qq.com (3k4b251)
Date: Tue, 18 Jun 2013 19:53:46 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c      how  can  I  close  consumer?
Message-ID: <1371610426795-27470.post@n5.nabble.com>

I  USE  amqp_basic_consume(....)   to     create  consumer ,  but  I  don't 
konw   how  to  close  the consumer.... 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-can-I-close-consumer-tp27470.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Wed Jun 19 04:57:51 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 18 Jun 2013 20:57:51 -0700
Subject: [rabbitmq-discuss] rabbitmq-c how can I close consumer?
In-Reply-To: <1371610426795-27470.post@n5.nabble.com>
References: <1371610426795-27470.post@n5.nabble.com>
Message-ID: <CAAt2poKeF_KdRQ2bh2JQd0nML4ov2ippkbiu9HYvWUEd5SUX+Q@mail.gmail.com>

The function you want is amqp_basic_cancel(...):

https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp_framing.h#L621


On Tue, Jun 18, 2013 at 7:53 PM, 3k4b251 <314992959 at qq.com> wrote:

> I  USE  amqp_basic_consume(....)   to     create  consumer ,  but  I  don't
> konw   how  to  close  the consumer....
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-can-I-close-consumer-tp27470.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/8d38d2bc/attachment.htm>

From alan.antonuk at gmail.com  Wed Jun 19 05:02:30 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 18 Jun 2013 21:02:30 -0700
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <1371605306823-27469.post@n5.nabble.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<1371556309616-27452.post@n5.nabble.com>
	<CAE3HoVQ3SY1qzHKDo6KDV2vysfaWuk7ZY-VFiWL3vQpt1CccBg@mail.gmail.com>
	<CAAt2poKqku11+6P+Y9vg=1U625w2CjvNhcEwkseHh-gEOWQefA@mail.gmail.com>
	<1371605306823-27469.post@n5.nabble.com>
Message-ID: <CAAt2poLxggttrTRL58cBEhhp0dmA8sQmrY66OajELr_=sdO7dw@mail.gmail.com>

As Michael mentioned: you can either create a channel per consumer or put
all your consumers on the same channel. Note that if a channel exception
occurs it will kill all of the consumers that are on that channel.


On Tue, Jun 18, 2013 at 6:28 PM, 3k4b251 <314992959 at qq.com> wrote:

> I  read  the  "amqpcpp-master"   example.  I  find  It  Create  Channel
>  for
> every  queue.   should  I  follow  that?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-many-channels-I-need-tp27448p27469.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/e465ea34/attachment.htm>

From houxuehua49 at gmail.com  Wed Jun 19 06:16:41 2013
From: houxuehua49 at gmail.com (Xuehua Hou)
Date: Tue, 18 Jun 2013 22:16:41 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster memory alarm blocks producer too long
Message-ID: <6585d4ed-400d-451f-8dc4-511900bf4e45@googlegroups.com>

Hi,
I'm testing rabbitmq cluster.
The problem same as 
https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/memory$20cluster/rabbitmq-discuss/85g_ScoeeJM/jMspuiJHD7sJ 
still exists.
I can reproduce the issue.

I runned rabbitmq-server-3.1.1 on two centos6 machines, the erlang version 
is R16B.
The two machines are 4 core and 8G ram.
I used mirrored durable queue for HA.
Two nodes are disc.

Reproduce step: 
1.start four producers  and publish a lot of messages(more than 1000000).
2.start four consumers 
Producers and consumers running more than one hour, memory alarm will go 
off.
The master memory slow down quickly,
But the slave node stay in memory alarm state too long(more than 10 min).

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/10d133da/attachment.htm>

From 314992959 at qq.com  Wed Jun 19 08:01:23 2013
From: 314992959 at qq.com (3k4b251)
Date: Wed, 19 Jun 2013 00:01:23 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <CAAt2poL5q_=fLAOMxKFFNzP_=oZCcuj=Lfuuu0C-aR2+rsRUJg@mail.gmail.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
	<CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>
	<CAAt2poL5q_=fLAOMxKFFNzP_=oZCcuj=Lfuuu0C-aR2+rsRUJg@mail.gmail.com>
Message-ID: <1371625283484-27474.post@n5.nabble.com>

Thank you !   you  help  me soo much !   and  I  still  face  the problem  of 
memory use.       I  need  to  send a  message  to   a  queue ,  before 
that,  I'd  like  to declare  the queue  to  make  sure  the queue  already
there ,just like  amqp_queue_declare(....) ,and  then  i call 
amqp_basic_consume(....) ,  but  when  I use  this  function
:amqp_queue_declare(....)  , the memory grow up  fast.   what  can  I do  to
avoid  this statement?   



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-many-channels-I-need-tp27448p27474.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From iliyaisd at gmail.com  Wed Jun 19 07:40:50 2013
From: iliyaisd at gmail.com (Iliya Isd)
Date: Tue, 18 Jun 2013 23:40:50 -0700 (PDT)
Subject: [rabbitmq-discuss] set/getTimeout in RabbitMQ for PHP
Message-ID: <d67b7628-5823-436d-8bfb-a195e346227b@googlegroups.com>

Hello! Having the next problem, maybe somebody has issued that. 
I'm trying to use the next function: 
http://php.net/manual/ru/amqpconnection.settimeout.php 
but nothing changes. Timeout isn't working. Thereby there's no way to avoid 
hanging up the site when trying to send message to rabbitMQ... 
Any ideas? 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130618/b7411b3a/attachment.htm>

From jonas at merchii.com  Wed Jun 19 08:23:20 2013
From: jonas at merchii.com (Jonas Grimfelt)
Date: Wed, 19 Jun 2013 09:23:20 +0200
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <1371625283484-27474.post@n5.nabble.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
	<CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>
	<CAAt2poL5q_=fLAOMxKFFNzP_=oZCcuj=Lfuuu0C-aR2+rsRUJg@mail.gmail.com>
	<1371625283484-27474.post@n5.nabble.com>
Message-ID: <CACAFn4un2fpCGcXRCt_H24L7fyC07vquOPM+8xsJh-J4MY7NqA@mail.gmail.com>

Please remove operations at merchii.com from this discussion.
Den 19 jun 2013 09:03 skrev "3k4b251" <314992959 at qq.com>:

> Thank you !   you  help  me soo much !   and  I  still  face  the problem
>  of
> memory use.       I  need  to  send a  message  to   a  queue ,  before
> that,  I'd  like  to declare  the queue  to  make  sure  the queue  already
> there ,just like  amqp_queue_declare(....) ,and  then  i call
> amqp_basic_consume(....) ,  but  when  I use  this  function
> :amqp_queue_declare(....)  , the memory grow up  fast.   what  can  I do
>  to
> avoid  this statement?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-many-channels-I-need-tp27448p27474.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/db9052d6/attachment.htm>

From pompermaier at okkam.it  Wed Jun 19 10:41:14 2013
From: pompermaier at okkam.it (Flavio Pompermaier)
Date: Wed, 19 Jun 2013 02:41:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Work Queues design
Message-ID: <51781122-733f-45ea-a5ad-96301f1435db@googlegroups.com>

Hi to everybody,
I'm new to RabbitMQ but from what I see it could be the solution for a 
buffer implementation in one of my project.
In my scenario there will be a big queue of tasks (i.e. document indexing) 
that should be served as fast as possible,

Looking at the tutorial I think that what I need is somehow similar to the 
Work queues (http://www.rabbitmq.com/tutorials/tutorial-two-python.html) 
plus fair dispatching.
However, the aforementioned constraint "served as fast as possible" is not 
clear how to design a correct size of workers, in a scalable way..
In every example, a worker is a standalone java process, whereas I would 
like to manage workers more like a pool and take the first available one..

So, I think that I can summarize my questions as:

1) What is the best RabbitMQ architecture to solve my problems?
2) If my poolable solution is correct, how can I set up a pool? How do I 
decide the best size of the pool?
3) What if I discover that my server is overloaded and I want to distribute 
the load? How can I avoid to store all the queues message in just one 
server (if I want persistable queues)?

Best regards,
Flavio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/c1a41136/attachment.htm>

From tim at rabbitmq.com  Wed Jun 19 10:51:44 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Jun 2013 10:51:44 +0100
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <1371625283484-27474.post@n5.nabble.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
	<CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>
	<CAAt2poL5q_=fLAOMxKFFNzP_=oZCcuj=Lfuuu0C-aR2+rsRUJg@mail.gmail.com>
	<1371625283484-27474.post@n5.nabble.com>
Message-ID: <327E941D-32A0-4CF4-A724-80E8725AAAA8@rabbitmq.com>

On 19 Jun 2013, at 08:01, 3k4b251 wrote:

> Thank you !   you  help  me soo much !   and  I  still  face  the problem  of 
> memory use.       I  need  to  send a  message  to   a  queue ,  before 
> that,  I'd  like  to declare  the queue  to  make  sure  the queue  already
> there ,just like  amqp_queue_declare(....) ,and  then  i call 
> amqp_basic_consume(....) ,  but  when  I use  this  function
> :amqp_queue_declare(....)  , the memory grow up  fast.

Have you spent any time trying to understand why memory use grows in the face of this function call? Is that memory growth constant (due to allocations), or transient due to buffering and so on?

>   what  can  I do  to
> avoid  this statement?   
> 

If you pre-declare queues/exchanges on the broker then calling amqp_<object>_declare isn't strictly necessary, though of course if the object turns out to be missing (on the broker) you'll have to deal with the channel error (i.e., release the existing channel objects, open a new channel, call amqp_queue_declare and so on).

From tim at rabbitmq.com  Wed Jun 19 10:58:58 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Jun 2013 10:58:58 +0100
Subject: [rabbitmq-discuss] Work Queues design
In-Reply-To: <51781122-733f-45ea-a5ad-96301f1435db@googlegroups.com>
References: <51781122-733f-45ea-a5ad-96301f1435db@googlegroups.com>
Message-ID: <034B5828-127A-4E77-B4EB-24546AE5B146@rabbitmq.com>

On 19 Jun 2013, at 10:41, Flavio Pompermaier wrote:

> Hi to everybody,
> I'm new to RabbitMQ but from what I see it could be the solution for a buffer implementation in one of my project.
> In my scenario there will be a big queue of tasks (i.e. document indexing) that should be served as fast as possible,
> 
> Looking at the tutorial I think that what I need is somehow similar to the Work queues (http://www.rabbitmq.com/tutorials/tutorial-two-python.html) plus fair dispatching.
> However, the aforementioned constraint "served as fast as possible" is not clear how to design a correct size of workers, in a scalable way..
> In every example, a worker is a standalone java process, whereas I would like to manage workers more like a pool and take the first available one..
> 

You can open multiple channels on a single connection (i.e., an application running in the JVM can open many connections and many channels per connection - each channel usually being assigned to a thread). As for "take the first available one", that's exactly what the "fair dispatch" section in the tutorial describes.

> 2) If my poolable solution is correct, how can I set up a pool? How do I decide the best size of the pool?

That's totally application specific, depending on how many messages you're expecting to process and so on. You can `re-size' the pool any time you like by adding more consumers - the prefetch-count will ensure that rabbit doesn't send any one consumer more than the specified number of un-acked messages. 

> 3) What if I discover that my server is overloaded and I want to distribute the load?

Add more consumers, as I said above. 

> How can I avoid to store all the queues message in just one server (if I want persistable queues)?

You can set up a cluster and use HA to mirror (i.e., replicate) the queue contents across multiple nodes. See www.rabbitmq.com/ha.html for details. Of course, with HA you'll store all the queue's messages on all of the (mirrored) nodes. If you were thinking of 'sharding' the data across multiple nodes, then we don't offer a solution for that out of the box, though you could probably cook one up yourself using federation (see www.rabbitmq.com/federation.html).

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/506424f8/attachment.htm>

From simon at rabbitmq.com  Wed Jun 19 11:01:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Jun 2013 11:01:13 +0100
Subject: [rabbitmq-discuss] cluster memory alarm blocks producer too long
In-Reply-To: <6585d4ed-400d-451f-8dc4-511900bf4e45@googlegroups.com>
References: <6585d4ed-400d-451f-8dc4-511900bf4e45@googlegroups.com>
Message-ID: <51C18169.7080108@rabbitmq.com>

What does "rabbitmqctl status" / management node details page say the 
memory is used by?

Cheers, Simon

On 19/06/13 06:16, Xuehua Hou wrote:
> Hi,
> I'm testing rabbitmq cluster.
> The problem same as
> https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/memory$20cluster/rabbitmq-discuss/85g_ScoeeJM/jMspuiJHD7sJ
> still exists.
> I can reproduce the issue.
>
> I runned rabbitmq-server-3.1.1 on two centos6 machines, the erlang
> version is R16B.
> The two machines are 4 core and 8G ram.
> I used mirrored durable queue for HA.
> Two nodes are disc.
>
> Reproduce step:
> 1.start four producers  and publish a lot of messages(more than 1000000).
> 2.start four consumers
> Producers and consumers running more than one hour, memory alarm will go
> off.
> The master memory slow down quickly,
> But the slave node stay in memory alarm state too long(more than 10 min).
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From 314992959 at qq.com  Wed Jun 19 11:38:47 2013
From: 314992959 at qq.com (3k4b251)
Date: Wed, 19 Jun 2013 03:38:47 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <327E941D-32A0-4CF4-A724-80E8725AAAA8@rabbitmq.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
	<CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>
	<CAAt2poL5q_=fLAOMxKFFNzP_=oZCcuj=Lfuuu0C-aR2+rsRUJg@mail.gmail.com>
	<1371625283484-27474.post@n5.nabble.com>
	<327E941D-32A0-4CF4-A724-80E8725AAAA8@rabbitmq.com>
Message-ID: <1371638327887-27481.post@n5.nabble.com>

thank  you!    like  you say,  i  not  very  skillful  at  rabbitmq-c.     I
test  it  ,  I  found  that  if  I  use  the function 
amqp_maybe_release_buffers()  after  amqp_queue_declare(),  the memory  stop 
grow up .
but the function  amqp_basic_consume()  still  have high use  of  memory..?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-many-channels-I-need-tp27448p27481.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Jun 19 12:13:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Jun 2013 12:13:56 +0100
Subject: [rabbitmq-discuss] |Spam| Re: Possible memory leak in the
 management plugin
In-Reply-To: <CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
	<51C03535.8010604@rabbitmq.com>
	<CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
Message-ID: <51C19274.3060202@rabbitmq.com>

On 18/06/13 16:11, Travis Mehlinger wrote:
> We declare those queues as exclusive so they're getting cleaned up
> automatically.

I have found a plausible candidate for the leak. But it's dependent on 
having a long lived channel which declares and deletes lots of 
short-lived queues. We keep some information on the deleted queues until 
the channel is closed. Could your monitoring tool be doing that? 
Obviously it would have to be deleting queues explicitly, not relying on 
them being exclusive.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From tim at rabbitmq.com  Wed Jun 19 12:25:49 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Jun 2013 12:25:49 +0100
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <1371638327887-27481.post@n5.nabble.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
	<CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>
	<CAAt2poL5q_=fLAOMxKFFNzP_=oZCcuj=Lfuuu0C-aR2+rsRUJg@mail.gmail.com>
	<1371625283484-27474.post@n5.nabble.com>
	<327E941D-32A0-4CF4-A724-80E8725AAAA8@rabbitmq.com>
	<1371638327887-27481.post@n5.nabble.com>
Message-ID: <C5BBDF06-95A2-44BC-A9B2-EBCA487FF489@rabbitmq.com>

On 19 Jun 2013, at 11:38, 3k4b251 wrote:
> thank  you!    like  you say,  i  not  very  skillful  at  rabbitmq-c.     I
> test  it  ,  I  found  that  if  I  use  the function 
> amqp_maybe_release_buffers()  after  amqp_queue_declare(),  the memory  stop 
> grow up .
> but the function  amqp_basic_consume()  still  have high use  of  memory..?
> 

Probably because it's (a) allocating data to manage the consumer/channel, (b) allocating buffers to handle the incoming data and (c) bringing data in from the kernel (via syscalls such as recv and so on) to user space so as to present it to your application. What exactly were you expecting to see once your application started consuming data from the queues? Of course it's going to use memory!? Are you actually seeing memory use that is unexpected here? Is that because it is (a) higher than you would expect to see, or (b) not getting released when you think it should? One of those two (latter) things might indicate a problem (either in your code or in some library you might be calling) but generally speaking "doing stuff" requires memory, so saying "still have high use of memory" isn't much to go on.

From emile at rabbitmq.com  Wed Jun 19 13:12:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 19 Jun 2013 13:12:18 +0100
Subject: [rabbitmq-discuss] Mnesia Corruption Bug
In-Reply-To: <2fb2deb0-748b-46a0-b9b2-05b3688c9bf7@googlegroups.com>
References: <2fb2deb0-748b-46a0-b9b2-05b3688c9bf7@googlegroups.com>
Message-ID: <51C1A022.9020306@rabbitmq.com>


Hi Lee,

On 13/06/13 12:36, Lee Hambley wrote:
> That all aside, attached ( https://gist.github.com/leehambley/5773039 )
> is a stacktrace from a problematic box, we couldn't get it to recover
> (single node, single replica, etc, etc) - we simply deleted the mnesia
> database, which worked well enough.

We've managed to reproduce this problem, but only by copying an older
copy of an Mnesia directory over a newer copy of itself without clearing
all the files first. Is it possible that the same happened on your side?
The solution in that case is to clear the mnesia directory before
restoring. The integrity of the broker will be compromised if the Mnesia
directory is modified, so avoid doing that.


-Emile





From CLefevre at Transparent.com  Wed Jun 19 14:25:03 2013
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Wed, 19 Jun 2013 13:25:03 +0000
Subject: [rabbitmq-discuss] Using a local system account to run the RMQ
 Windows Service, where does Mnesia store it's data?
In-Reply-To: <51C0D6B3.3000609@rabbitmq.com>
References: <5798631D5F355D4C99FDF23580295AF81A0A0A4E@TLMAIL1.Transparent.local>
	<51C0D6B3.3000609@rabbitmq.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF81A0A0B6B@TLMAIL1.Transparent.local>

I actually found it in rabbitmqctl environment

However, the issue I think is related to Hyperic, which appears to only work with Rabbit 2.x, Vs. Rabbit 3.0.x that we're currently using.

Thank you for your time,
-Christopher Lefevre

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Tuesday, June 18, 2013 5:53 PM
To: Discussions about RabbitMQ
Cc: Christopher Lefevre
Subject: Re: [rabbitmq-discuss] Using a local system account to run the RMQ Windows Service, where does Mnesia store it's data?

On 18/06/13 21:16, Christopher Lefevre wrote:
> I can't seem to find any way to show the file locations via
> Rabbitmqctl.bat or the Rabbit Management Plugin.

Check the beginning of rabbit's log file.

Matthias.
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.

From oliviermis.pro at gmail.com  Wed Jun 19 14:49:32 2013
From: oliviermis.pro at gmail.com (Olivier Mis)
Date: Wed, 19 Jun 2013 15:49:32 +0200
Subject: [rabbitmq-discuss] RabbitMQ error (clustering)
Message-ID: <CANUtqwCtTGtktpq8D4BknkFs-xyN28n+NhCKv8vktE890eG7WA@mail.gmail.com>

Hello,
I'm having problem clustering 3.1.1 rabbitmq-servers, when entering
rabbitmqctl join_cluster rabbit at sn-fr110-9660, I get an error :

Error: {undef,[{rabbit_mnesia,join_cluster,['rabbit at sn-fr110-9660',disc]},
{rpc,'-handle_call_call/6-fun-0-',5}]}


Following the documentation, cookies had been copied, and are the same
between both servers.

we did rabbitmqctl eval 'rabbit_mnesia:module_info().'
output :
http://dpaste.com/1253618/
http://dpaste.com/1253630/

Thanks for help !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/6f3259e0/attachment.htm>

From tmehlinger at gmail.com  Wed Jun 19 15:30:49 2013
From: tmehlinger at gmail.com (Travis Mehlinger)
Date: Wed, 19 Jun 2013 09:30:49 -0500
Subject: [rabbitmq-discuss] |Spam| Re: Possible memory leak in the
 management plugin
In-Reply-To: <51C19274.3060202@rabbitmq.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
	<51C03535.8010604@rabbitmq.com>
	<CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
	<51C19274.3060202@rabbitmq.com>
Message-ID: <CACCscvzm+p=vR0=d3_yFzmbidb+SGnEws9zW5q1cmHGVZXe+eg@mail.gmail.com>

Hi Simon,

We aren't doing anything like that. Whenever one of our services starts
(which are based on Kombu, if that helps), it plucks a connection from its
internal pool, creates a channel on that connection, then binds on its
request queue, which hangs around until the service stops. The only thing
that deviates from this pattern is our monitor, which connects and
disconnects fairly rapidly, and uses exclusive queues.

That said, it's entirely possible that we have something floating around
that I don't know about that fits the behavior you described. I'll keep
digging and see what I can turn up. In the meantime, let me know if there's
any more information I can collect from Rabbit.

Thanks, Travis


On Wed, Jun 19, 2013 at 6:13 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 18/06/13 16:11, Travis Mehlinger wrote:
>
>> We declare those queues as exclusive so they're getting cleaned up
>> automatically.
>>
>
> I have found a plausible candidate for the leak. But it's dependent on
> having a long lived channel which declares and deletes lots of short-lived
> queues. We keep some information on the deleted queues until the channel is
> closed. Could your monitoring tool be doing that? Obviously it would have
> to be deleting queues explicitly, not relying on them being exclusive.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/7df496db/attachment.htm>

From michael.w.bonar at gmail.com  Wed Jun 19 15:23:29 2013
From: michael.w.bonar at gmail.com (Michael Bonar)
Date: Wed, 19 Jun 2013 07:23:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to start management console RabbitMQ 3.1.1
Message-ID: <f7cce1f1-fffa-471d-b71b-edf7868df1c6@googlegroups.com>

Hi there,
 
I enabled the plugin, but the server fails to start with amqp_client 
error.  I disable the management console, and it still fails.  Looks like 
it is unable to remove the console plugin.
 
BOOT FAILED
===========
Error description:
   {error,{"no such file or directory","amqp_client.app"}}
Log files (may contain more information):
   //...snip...Application Data/RabbitMQ/log/rabbit at mymachine.log
   //...snip.../Application Data/RabbitMQ/log/rabbit at mymachine-sas
l.log
Stack trace:
   [{app_utils,load_applications,2,[]},
    {app_utils,load_applications,1,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[{file,"init.erl"},{line,1054}]},
    {init,start_em,1,[{file,"init.erl"},{line,1034}]}]
{"init terminating in do_boot",{rabbit,failure_during_boot,{error,{"no such 
file
 or directory","amqp_client.app"}}}}
Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.1.1\sbin>
 
Erlang version R16B erts-5.10.1 64 bit.
 
Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/f1607f84/attachment.htm>

From simon at rabbitmq.com  Wed Jun 19 15:57:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Jun 2013 15:57:45 +0100
Subject: [rabbitmq-discuss] |Spam| Re: Possible memory leak in the
 management plugin
In-Reply-To: <CACCscvzm+p=vR0=d3_yFzmbidb+SGnEws9zW5q1cmHGVZXe+eg@mail.gmail.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
	<51C03535.8010604@rabbitmq.com>
	<CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
	<51C19274.3060202@rabbitmq.com>
	<CACCscvzm+p=vR0=d3_yFzmbidb+SGnEws9zW5q1cmHGVZXe+eg@mail.gmail.com>
Message-ID: <51C1C6E9.9000109@rabbitmq.com>

Thanks.

Could you run

rabbitmqctl eval 
'{_,_,_,[_,_,_,_,[_,_,{_,[{_,S}]}]]}=sys:get_status(global:whereis_name(rabbit_mgmt_db)),T=element(5,S),ets:foldl(fun(E,_)->io:format("~p~n~n",[E])end,[],T).'

please? This will dump the entire leaky table to standard output, so you 
would want to redirect it to a file.

If you could also accompany that with "rabbitmqctl report" so I can see 
what actually exists at that time then I can at least see what is leaking.

Cheers, Simon

On 19/06/13 15:30, Travis Mehlinger wrote:
> Hi Simon,
>
> We aren't doing anything like that. Whenever one of our services starts
> (which are based on Kombu, if that helps), it plucks a connection from
> its internal pool, creates a channel on that connection, then binds on
> its request queue, which hangs around until the service stops. The only
> thing that deviates from this pattern is our monitor, which connects and
> disconnects fairly rapidly, and uses exclusive queues.
>
> That said, it's entirely possible that we have something floating around
> that I don't know about that fits the behavior you described. I'll keep
> digging and see what I can turn up. In the meantime, let me know if
> there's any more information I can collect from Rabbit.
>
> Thanks, Travis
>
>
> On Wed, Jun 19, 2013 at 6:13 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 18/06/13 16:11, Travis Mehlinger wrote:
>
>         We declare those queues as exclusive so they're getting cleaned up
>         automatically.
>
>
>     I have found a plausible candidate for the leak. But it's dependent
>     on having a long lived channel which declares and deletes lots of
>     short-lived queues. We keep some information on the deleted queues
>     until the channel is closed. Could your monitoring tool be doing
>     that? Obviously it would have to be deleting queues explicitly, not
>     relying on them being exclusive.
>
>     Cheers, Simon
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From andi.constantin at mediasat.ro  Wed Jun 19 14:34:40 2013
From: andi.constantin at mediasat.ro (andiconstantin)
Date: Wed, 19 Jun 2013 06:34:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering on different interface
Message-ID: <1371648880448-27486.post@n5.nabble.com>

Hi!

I have 2 rabbit servers, rabbit1 and rabbit2.
For rabbit1 I have two interfaces 192.168.1.x1 and 10.10.10.x1 and for
rabbit2 i have 192.168.1.x2 and 10.10.10.x2.
I can make the cluster on the 192.168.1.X interfaces but i cannot make-it on
the 10.10.10.X interfaces.
The 10.10.10.X intarfaces are directly connected and i wanna use them
because they do not depend on a switch.
I have all the addresses in /etc/hosts with different names.
I also added listeners in /etc/rabbitmq/rabbitmq.config

[
  {rabbit, [
    {tcp_listeners,[{"192.168.1.x1",5672},
    {"10.10.10.x1",5672}]}
]}

Any ideas ?
Thanks.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Clustering-on-different-interface-tp27486.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed Jun 19 16:20:30 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Jun 2013 16:20:30 +0100
Subject: [rabbitmq-discuss] Clustering on different interface
In-Reply-To: <1371648880448-27486.post@n5.nabble.com>
References: <1371648880448-27486.post@n5.nabble.com>
Message-ID: <3DD81063-F2A2-468E-9511-A96580F5A347@rabbitmq.com>

On 19 Jun 2013, at 14:34, andiconstantin wrote:

> Hi!
> 
> I have 2 rabbit servers, rabbit1 and rabbit2.
> For rabbit1 I have two interfaces 192.168.1.x1 and 10.10.10.x1 and for
> rabbit2 i have 192.168.1.x2 and 10.10.10.x2.
> I can make the cluster on the 192.168.1.X interfaces but i cannot make-it on
> the 10.10.10.X interfaces.
> The 10.10.10.X intarfaces are directly connected and i wanna use them
> because they do not depend on a switch.
> I have all the addresses in /etc/hosts with different names.
> I also added listeners in /etc/rabbitmq/rabbitmq.config
> 
> [
>  {rabbit, [
>    {tcp_listeners,[{"192.168.1.x1",5672},
>    {"10.10.10.x1",5672}]}
> ]}
> 

I think you're getting confused between TCP listeners (which listen for AMQP connections) and clustering, which does not use the tcp_listeners configuration element but works via the Erlang Port Mapper Daemon - see http://www.erlang.org/doc/man/epmd.html.

Cheers,
Tim

From simon at rabbitmq.com  Wed Jun 19 16:34:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Jun 2013 16:34:14 +0100
Subject: [rabbitmq-discuss] |Spam| Re: Possible memory leak in the
 management plugin
In-Reply-To: <51C1C6E9.9000109@rabbitmq.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
	<51C03535.8010604@rabbitmq.com>
	<CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
	<51C19274.3060202@rabbitmq.com>
	<CACCscvzm+p=vR0=d3_yFzmbidb+SGnEws9zW5q1cmHGVZXe+eg@mail.gmail.com>
	<51C1C6E9.9000109@rabbitmq.com>
Message-ID: <51C1CF76.20600@rabbitmq.com>

Also, I have a patched version of the management plugin which fixes the 
leak I found today:

http://www.rabbitmq.com/releases/plugins/v3.1.1/rabbitmq_management-3.1.1-leakfix1.ez

(see http://www.rabbitmq.com/plugins.html#installing-plugins for where 
to put it, it replaces rabbitmq_management-3.1.1.ez)

If you are able to test this version, that would also be great.

Cheers, Simon

On 19/06/13 15:57, Simon MacMullen wrote:
> Thanks.
>
> Could you run
>
> rabbitmqctl eval
> '{_,_,_,[_,_,_,_,[_,_,{_,[{_,S}]}]]}=sys:get_status(global:whereis_name(rabbit_mgmt_db)),T=element(5,S),ets:foldl(fun(E,_)->io:format("~p~n~n",[E])end,[],T).'
>
>
> please? This will dump the entire leaky table to standard output, so you
> would want to redirect it to a file.
>
> If you could also accompany that with "rabbitmqctl report" so I can see
> what actually exists at that time then I can at least see what is leaking.
>
> Cheers, Simon
>
> On 19/06/13 15:30, Travis Mehlinger wrote:
>> Hi Simon,
>>
>> We aren't doing anything like that. Whenever one of our services starts
>> (which are based on Kombu, if that helps), it plucks a connection from
>> its internal pool, creates a channel on that connection, then binds on
>> its request queue, which hangs around until the service stops. The only
>> thing that deviates from this pattern is our monitor, which connects and
>> disconnects fairly rapidly, and uses exclusive queues.
>>
>> That said, it's entirely possible that we have something floating around
>> that I don't know about that fits the behavior you described. I'll keep
>> digging and see what I can turn up. In the meantime, let me know if
>> there's any more information I can collect from Rabbit.
>>
>> Thanks, Travis
>>
>>
>> On Wed, Jun 19, 2013 at 6:13 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     On 18/06/13 16:11, Travis Mehlinger wrote:
>>
>>         We declare those queues as exclusive so they're getting
>> cleaned up
>>         automatically.
>>
>>
>>     I have found a plausible candidate for the leak. But it's dependent
>>     on having a long lived channel which declares and deletes lots of
>>     short-lived queues. We keep some information on the deleted queues
>>     until the channel is closed. Could your monitoring tool be doing
>>     that? Obviously it would have to be deleting queues explicitly, not
>>     relying on them being exclusive.
>>
>>     Cheers, Simon
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, Pivotal
>>
>>
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From tim at rabbitmq.com  Wed Jun 19 16:44:37 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Jun 2013 16:44:37 +0100
Subject: [rabbitmq-discuss] Clustering on different interface
In-Reply-To: <3DD81063-F2A2-468E-9511-A96580F5A347@rabbitmq.com>
References: <1371648880448-27486.post@n5.nabble.com>
	<3DD81063-F2A2-468E-9511-A96580F5A347@rabbitmq.com>
Message-ID: <7D715885-694A-47F2-BA1D-7C338CD54A85@rabbitmq.com>

Just to follow up, since it's been suggested that what you were asking is how to make *clustering* listen on 10.10.10.x1, you'll need to add the following to your config file instead:

[
  {rabbit, [{tcp_listeners, [{"192.168.1.x1", 5672}]}]},
  {kernel, [{inet_dist_use_interface, {10,10,10,1}}]}
].

On 19 Jun 2013, at 16:20, Tim Watson wrote:

> On 19 Jun 2013, at 14:34, andiconstantin wrote:
> 
>> Hi!
>> 
>> I have 2 rabbit servers, rabbit1 and rabbit2.
>> For rabbit1 I have two interfaces 192.168.1.x1 and 10.10.10.x1 and for
>> rabbit2 i have 192.168.1.x2 and 10.10.10.x2.
>> I can make the cluster on the 192.168.1.X interfaces but i cannot make-it on
>> the 10.10.10.X interfaces.
>> The 10.10.10.X intarfaces are directly connected and i wanna use them
>> because they do not depend on a switch.
>> I have all the addresses in /etc/hosts with different names.
>> I also added listeners in /etc/rabbitmq/rabbitmq.config
>> 
>> [
>> {rabbit, [
>>   {tcp_listeners,[{"192.168.1.x1",5672},
>>   {"10.10.10.x1",5672}]}
>> ]}
>> 
> 
> I think you're getting confused between TCP listeners (which listen for AMQP connections) and clustering, which does not use the tcp_listeners configuration element but works via the Erlang Port Mapper Daemon - see http://www.erlang.org/doc/man/epmd.html.
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Wed Jun 19 16:59:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 19 Jun 2013 16:59:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ error (clustering)
In-Reply-To: <CANUtqwCtTGtktpq8D4BknkFs-xyN28n+NhCKv8vktE890eG7WA@mail.gmail.com>
References: <CANUtqwCtTGtktpq8D4BknkFs-xyN28n+NhCKv8vktE890eG7WA@mail.gmail.com>
Message-ID: <51C1D57D.3070707@rabbitmq.com>


Hi,


On 19/06/13 14:49, Olivier Mis wrote:
> Error: {undef,[{rabbit_mnesia,join_cluster,['rabbit at sn-fr110-9660',disc]},
> {rpc,'-handle_call_call/6-fun-0-',5}]}

This could happen if you performed a possibly incomplete upgrade from a
version older than 3.0.0 to a version newer than 2.8.7 on some nodes.
Make sure all nodes run the same version and that there are no old beam
files in the ebin directory.


-Emile





From jonas at merchii.com  Wed Jun 19 17:08:28 2013
From: jonas at merchii.com (Jonas Grimfelt)
Date: Wed, 19 Jun 2013 18:08:28 +0200
Subject: [rabbitmq-discuss] RabbitMQ error (clustering)
In-Reply-To: <51C1D57D.3070707@rabbitmq.com>
References: <CANUtqwCtTGtktpq8D4BknkFs-xyN28n+NhCKv8vktE890eG7WA@mail.gmail.com>
	<51C1D57D.3070707@rabbitmq.com>
Message-ID: <9528BD6EB9344E398FDFED07FC8C6152@merchii.com>

Tried to unsubscribe "operations at merchii.com" from this mailinglist but don't seem to work - could you please remove "operations at merchii.com" from this list/thread?


Jonas Grimfelt
Merchii

Phone: +46 76 610 72 30
E-mail: jonas at merchii.com
Web: merchii.com


On Wednesday, June 19, 2013 at 5:59 PM, Emile Joubert wrote:

> 
> Hi,
> 
> 
> On 19/06/13 14:49, Olivier Mis wrote:
> > Error: {undef,[{rabbit_mnesia,join_cluster,['rabbit at sn-fr110-9660',disc]},
> > {rpc,'-handle_call_call/6-fun-0-',5}]}
> 
> 
> 
> This could happen if you performed a possibly incomplete upgrade from a
> version older than 3.0.0 to a version newer than 2.8.7 on some nodes.
> Make sure all nodes run the same version and that there are no old beam
> files in the ebin directory.
> 
> 
> -Emile
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From k.madnani84 at gmail.com  Wed Jun 19 17:46:17 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Wed, 19 Jun 2013 09:46:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
Message-ID: <1371660377336-27496.post@n5.nabble.com>

Hi,

My problem is i try to join a a fresh rabbitMq installation on a host in an
existing cluster but am getting this error message:
Clustering node 'CLUSTER1 at zldv0435' with 'CLUSTER1 at zldv0432' ...
Error: cannot_discover_cluster: The nodes provided are either offline or not
running 


I am using these steps 
rabbitmqctl stop_app
rabbitmqctl join_cluster  CLUSTER1 at zldv0432
rabbitmqctl start_app

I digged through various forums and based upon that i checked that my
.erlang.cookie value is same on both the nodes.I can telnet from one host to
another on epmd port.I am also able to ping from one host to another.

Only difference i see is that the cookie hash generated in start up logs in
2 host CLUSTER1 at zldv0435 & CLUSTER1 at zldv0432 is different.
Could that be a reason,If yes can anyone tell me how does this cookie hash
gets generated and why it is different even though my .erlang.cookie is same

Start Up Logs:

node           : CLUSTER1 at zldv0432
app descriptor : /opt/app/rabbitmq/sbin/../ebin/rabbit.app
home dir       : /opt/app/rabbitmq/data
config file(s) : /opt/app/rabbitmq/etc/rabbitmq.config
cookie hash    : g5OrZEjtM9jYarol6Np04g==
log            : /opt/app/rabbitmq/log/CLUSTER1.log
sasl log       : /opt/app/rabbitmq/log/CLUSTER1-sasl.log
database dir   : /opt/app/rabbitmq/data/mnesia/CLUSTER1


node           : CLUSTER1 at zldv0435
app descriptor : /opt/app/rabbitmq/sbin/../ebin/rabbit.app
home dir       : /opt/app/rabbitmq/data
config file(s) : /opt/app/rabbitmq/etc/rabbitmq.config
cookie hash    : 5f3VqMPJCjwtB8BTP16a3g==
log            : /opt/app/rabbitmq/log/CLUSTER1.log
sasl log       : /opt/app/rabbitmq/log/CLUSTER1-sasl.log
database dir   : /opt/app/rabbitmq/data/mnesia/CLUSTER1





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed Jun 19 18:24:09 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Jun 2013 18:24:09 +0100
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
	provided are either offline or not running
In-Reply-To: <1371660377336-27496.post@n5.nabble.com>
References: <1371660377336-27496.post@n5.nabble.com>
Message-ID: <3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>

On 19 Jun 2013, at 17:46, k.madnani84 wrote:
> Only difference i see is that the cookie hash generated in start up logs in
> 2 host CLUSTER1 at zldv0435 & CLUSTER1 at zldv0432 is different.

Where are you putting your .erlang.cookie and how did you install the broker? Different hashes mean different cookies. These usually reside in /home/rabbitmq/ IIRC.

Cheers,
Tim

From alan.antonuk at gmail.com  Wed Jun 19 18:43:11 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 19 Jun 2013 10:43:11 -0700
Subject: [rabbitmq-discuss] rabbitmq-c how many channels I need?
In-Reply-To: <C5BBDF06-95A2-44BC-A9B2-EBCA487FF489@rabbitmq.com>
References: <1371555212267-27448.post@n5.nabble.com>
	<CAE3HoVQiDV-B9UpbRGuNL0=WOM1z1TmydrxiatLW-F1YC7BRqQ@mail.gmail.com>
	<E19E734D-100E-4B09-9C89-46BEA324DABA@rabbitmq.com>
	<CAE3HoVTtcBLBAPu7y+7KDKb9M0NjdFLA4NyNxywEgG0UVfyf1A@mail.gmail.com>
	<CAAt2poL5q_=fLAOMxKFFNzP_=oZCcuj=Lfuuu0C-aR2+rsRUJg@mail.gmail.com>
	<1371625283484-27474.post@n5.nabble.com>
	<327E941D-32A0-4CF4-A724-80E8725AAAA8@rabbitmq.com>
	<1371638327887-27481.post@n5.nabble.com>
	<C5BBDF06-95A2-44BC-A9B2-EBCA487FF489@rabbitmq.com>
Message-ID: <CAAt2poL+AS79gLQVCMeSxUowsZEx6twKy5JQ2YWoBc9KKhF1hw@mail.gmail.com>

rabbitmq-c uses a connection-wide memory pool that is recycled when you
call amqp_maybe_release_buffers(). When you call this function, some memory
is returned to the OS, but most of the memory is marked as unused and will
be reused by rabbitmq-c at some point in the future.

A couple rules of thumb for dealing with memory when using rabbitmq-c:

1. Anytime you call amqp_maybe_release_buffers(), any pointer returned from
rabbitmq-c before that call becomes invalid. Any use will lead to undefined
behavior.

2. For RPC-style methods (amqp_queue_declare, amqp_exchange_declare,
amqp_basic_consume, anything that returns an amqp_*_ok_t *). You should
call amqp_maybe_release_buffers() immediately after you've finishing using
whatever that method returns: e.g.,:

amqp_queue_purge_ok_t *purge = amqp_queue_purge(connection, channel,
amqp_cstring_bytes("myqueue");
/* You should check to make sure purge != NULL, as that indicates failure */
int messages_purged = purge->message_count;
amqp_maybe_release_buffers(connection); /* NOTE: at this point, the purge
object is no longer valid */

3. When consuming messages you should call amqp_maybe_release_buffers()
after you've finished with each amqp_frame_t returned from
amqp_simple_wait_frame().

I cannot get any more specific than that without more information from you
(as Tim noted above).

Hope that helps
-Alan



On Wed, Jun 19, 2013 at 4:25 AM, Tim Watson <tim at rabbitmq.com> wrote:

> On 19 Jun 2013, at 11:38, 3k4b251 wrote:
> > thank  you!    like  you say,  i  not  very  skillful  at  rabbitmq-c.
>   I
> > test  it  ,  I  found  that  if  I  use  the function
> > amqp_maybe_release_buffers()  after  amqp_queue_declare(),  the memory
>  stop
> > grow up .
> > but the function  amqp_basic_consume()  still  have high use  of
>  memory..?
> >
>
> Probably because it's (a) allocating data to manage the consumer/channel,
> (b) allocating buffers to handle the incoming data and (c) bringing data in
> from the kernel (via syscalls such as recv and so on) to user space so as
> to present it to your application. What exactly were you expecting to see
> once your application started consuming data from the queues? Of course
> it's going to use memory!? Are you actually seeing memory use that is
> unexpected here? Is that because it is (a) higher than you would expect to
> see, or (b) not getting released when you think it should? One of those two
> (latter) things might indicate a problem (either in your code or in some
> library you might be calling) but generally speaking "doing stuff" requires
> memory, so saying "still have high use of memory" isn't much to go on.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/1450fb98/attachment.htm>

From k.madnani84 at gmail.com  Wed Jun 19 18:49:01 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Wed, 19 Jun 2013 10:49:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
Message-ID: <1371664141326-27499.post@n5.nabble.com>

Where are you putting your .erlang.cookie and how did you install the broker?

RE:I usually put in the user created folder data under the base
directory.Does the path location also needs to be the same in order to have
same cookie hash value?
For example here are the exact locations:
CLUSTER1 at zldv0435 : /opt/app/d1c1d20/rabbitmq/data/.erlang.cookie
CLUSTER1 at zldv0432 : /opt/app/workload/rabbitmq/data/.erlang.cookie

The installation involves extracting  the binaries for unix,configuring
rabbitmq.config file,setting the user,starting rabbitmq etc.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27499.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From yuva670 at gmail.com  Wed Jun 19 18:56:49 2013
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Wed, 19 Jun 2013 23:26:49 +0530
Subject: [rabbitmq-discuss] Lot of amq.gen-XXXXXX created
Message-ID: <CAPrynAUuur_9aT4w4s0WGSX37A0gxNU=FKZW5ykQaOPJcDPyXg@mail.gmail.com>

Hi,

I am using RabbitMQ with java consumers to process documents. Once in a
while, I see a lot of "amq.gen-xxxxx" queues in the management console and
one of the consumer stops consuming from a queue, are these two things
related or is there anything wrong with my RabbitMQ setup.


Thanks in advance,
Mahesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/81e4003e/attachment.htm>

From ty at sarna.org  Wed Jun 19 19:30:32 2013
From: ty at sarna.org (Ty Sarna)
Date: Wed, 19 Jun 2013 14:30:32 -0400
Subject: [rabbitmq-discuss] Causing publisher confirmations nacks for
	testing?
Message-ID: <690984D0-B11A-42E9-8BC0-D64C32432C83@sarna.org>

I'm working with publisher confirmations, and I'd like to verify that my
nack-handling logic is correct. Is there some way I can make RabbitMQ
nack on demand, for testing purposes?

Thanks

From michael.dyer at digitaleragroup.com  Wed Jun 19 19:51:42 2013
From: michael.dyer at digitaleragroup.com (austinnichols)
Date: Wed, 19 Jun 2013 11:51:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Error deleting vhost
Message-ID: <afaedb27-74fb-4fb3-86b0-9d05723c0c5f@googlegroups.com>

Using RMQ 3.0.2 / Erlang R14B04

I'm having difficulty deleting a specific vhost.  When attempting to delete 
I receive the message below.  Other vhosts do not appear to have this same 
issue.

Would appreciate any guidance on where to start troubleshooting ...


Delete this vhost

HTTP APICommand LineUpdate  
Last update: 2013-06-19 14:41:20

Got response code 500 with body
Internal Server Error

The server encountered an error while processing this request:
{throw,
    {error,
        {{badmatch,
             {error_string,
                 "Validation failed\n\nname not recognised: undefined\n"}},
         [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
          {rabbit_vhost,internal_delete,1},
          {rabbit_vhost,'-delete/1-fun-0-',1},
          {mnesia_tm,apply_fun,3},
          {mnesia_tm,execute_transaction,5},
          {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
          {worker_pool_worker,handle_call,3},
          {gen_server2,handle_msg,2}]}},
    [{rabbit_misc,execute_mnesia_transaction,1},
     {rabbit_mgmt_wm_vhost,delete_resource,2},
     {webmachine_resource,resource_call,3},
     {webmachine_resource,do,3},
     {webmachine_decision_core,resource_call,1},
     {webmachine_decision_core,decision,1},
     {webmachine_decision_core,handle_request,2},
     {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
mochiweb+webmachine web server
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/a872bf2b/attachment.htm>

From michael.w.bonar at gmail.com  Wed Jun 19 20:41:50 2013
From: michael.w.bonar at gmail.com (Michael Bonar)
Date: Wed, 19 Jun 2013 12:41:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to start management console RabbitMQ
	3.1.1
In-Reply-To: <f7cce1f1-fffa-471d-b71b-edf7868df1c6@googlegroups.com>
References: <f7cce1f1-fffa-471d-b71b-edf7868df1c6@googlegroups.com>
Message-ID: <7377eed0-3fda-4bbf-8a70-5df5236f1dc1@googlegroups.com>

I think I may see the problem.  Pluggins get expanded into the Application 
Data folder in Windows.  On this machine they have that folder redirected 
to a network share.  So, the server is having problems finding that 
location.
 
I can't see a way to tell rabbitmq-plugins to expand to a different folder.
 
Mike
 

On Wednesday, June 19, 2013 8:23:29 AM UTC-6, Michael Bonar wrote:

> Hi there,
>  
> I enabled the plugin, but the server fails to start with amqp_client 
> error.  I disable the management console, and it still fails.  Looks like 
> it is unable to remove the console plugin.
>  
> BOOT FAILED
> ===========
> Error description:
>    {error,{"no such file or directory","amqp_client.app"}}
> Log files (may contain more information):
>    //...snip...Application Data/RabbitMQ/log/rabbit at mymachine.log
>    //...snip.../Application Data/RabbitMQ/log/rabbit at mymachine-sas
> l.log
> Stack trace:
>    [{app_utils,load_applications,2,[]},
>     {app_utils,load_applications,1,[]},
>     {rabbit,'-boot/0-fun-1-',0,[]},
>     {rabbit,start_it,1,[]},
>     {init,start_it,1,[{file,"init.erl"},{line,1054}]},
>     {init,start_em,1,[{file,"init.erl"},{line,1034}]}]
> {"init terminating in do_boot",{rabbit,failure_during_boot,{error,{"no 
> such file
>  or directory","amqp_client.app"}}}}
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.1.1\sbin>
>  
> Erlang version R16B erts-5.10.1 64 bit.
>  
> Mike
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/8073fe7c/attachment.htm>

From michael.dyer at digitaleragroup.com  Wed Jun 19 21:24:50 2013
From: michael.dyer at digitaleragroup.com (austinnichols)
Date: Wed, 19 Jun 2013 13:24:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Error deleting vhost
In-Reply-To: <afaedb27-74fb-4fb3-86b0-9d05723c0c5f@googlegroups.com>
References: <afaedb27-74fb-4fb3-86b0-9d05723c0c5f@googlegroups.com>
Message-ID: <57ad1e90-5686-4848-ad98-b84742d97572@googlegroups.com>

OK - I was able to figure this one out.  The solution wasn't easy, but may 
help someone in the future.

I believe the core problem was a partially/mis-configured federation setup. 

I exported my config to json, stopped RMQ then deleted (renamed .bad) the 
mnesia folder.  

When I restarted I re-imported my config and found that I had the same 
problem as before.  OK - it's something in the config...

I then went through the config json and CAREFULLY removed any references to 
my 'bad' vhost.  There were a few problem areas:

1.  Parameters node - several entries pertained to federation and when I 
went through the admin gui I couldn't remove the settings.  Deleted from 
the .json
2.  There were a couple of admin users with rights to the vHost that 
remained after the vhost was deleted.

I cleared out mnesia again, restarted, imported my json and I'm now up and 
running.

I was also having a problem turning on tracing (rabbitmqctl trace_on -p 
myVhost) which would hang on this specific vhost.  Once I uploaded my clean 
config I was able to enable trace without issues.



On Wednesday, June 19, 2013 2:51:42 PM UTC-4, austinnichols wrote:
>
> Using RMQ 3.0.2 / Erlang R14B04
>
> I'm having difficulty deleting a specific vhost.  When attempting to 
> delete I receive the message below.  Other vhosts do not appear to have 
> this same issue.
>
> Would appreciate any guidance on where to start troubleshooting ...
>
>
> Delete this vhost
>
> HTTP APICommand LineUpdate  
> Last update: 2013-06-19 14:41:20
>
> Got response code 500 with body
> Internal Server Error
>
> The server encountered an error while processing this request:
> {throw,
>     {error,
>         {{badmatch,
>              {error_string,
>                  "Validation failed\n\nname not recognised: undefined\n"}},
>          [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>           {rabbit_vhost,internal_delete,1},
>           {rabbit_vhost,'-delete/1-fun-0-',1},
>           {mnesia_tm,apply_fun,3},
>           {mnesia_tm,execute_transaction,5},
>           {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>           {worker_pool_worker,handle_call,3},
>           {gen_server2,handle_msg,2}]}},
>     [{rabbit_misc,execute_mnesia_transaction,1},
>      {rabbit_mgmt_wm_vhost,delete_resource,2},
>      {webmachine_resource,resource_call,3},
>      {webmachine_resource,do,3},
>      {webmachine_decision_core,resource_call,1},
>      {webmachine_decision_core,decision,1},
>      {webmachine_decision_core,handle_request,2},
>      {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
> mochiweb+webmachine web server
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/f2259ca8/attachment.htm>

From michael.dyer at digitaleragroup.com  Wed Jun 19 21:24:50 2013
From: michael.dyer at digitaleragroup.com (austinnichols)
Date: Wed, 19 Jun 2013 13:24:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Error deleting vhost
In-Reply-To: <afaedb27-74fb-4fb3-86b0-9d05723c0c5f@googlegroups.com>
References: <afaedb27-74fb-4fb3-86b0-9d05723c0c5f@googlegroups.com>
Message-ID: <57ad1e90-5686-4848-ad98-b84742d97572@googlegroups.com>

OK - I was able to figure this one out.  The solution wasn't easy, but may 
help someone in the future.

I believe the core problem was a partially/mis-configured federation setup. 

I exported my config to json, stopped RMQ then deleted (renamed .bad) the 
mnesia folder.  

When I restarted I re-imported my config and found that I had the same 
problem as before.  OK - it's something in the config...

I then went through the config json and CAREFULLY removed any references to 
my 'bad' vhost.  There were a few problem areas:

1.  Parameters node - several entries pertained to federation and when I 
went through the admin gui I couldn't remove the settings.  Deleted from 
the .json
2.  There were a couple of admin users with rights to the vHost that 
remained after the vhost was deleted.

I cleared out mnesia again, restarted, imported my json and I'm now up and 
running.

I was also having a problem turning on tracing (rabbitmqctl trace_on -p 
myVhost) which would hang on this specific vhost.  Once I uploaded my clean 
config I was able to enable trace without issues.



On Wednesday, June 19, 2013 2:51:42 PM UTC-4, austinnichols wrote:
>
> Using RMQ 3.0.2 / Erlang R14B04
>
> I'm having difficulty deleting a specific vhost.  When attempting to 
> delete I receive the message below.  Other vhosts do not appear to have 
> this same issue.
>
> Would appreciate any guidance on where to start troubleshooting ...
>
>
> Delete this vhost
>
> HTTP APICommand LineUpdate  
> Last update: 2013-06-19 14:41:20
>
> Got response code 500 with body
> Internal Server Error
>
> The server encountered an error while processing this request:
> {throw,
>     {error,
>         {{badmatch,
>              {error_string,
>                  "Validation failed\n\nname not recognised: undefined\n"}},
>          [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>           {rabbit_vhost,internal_delete,1},
>           {rabbit_vhost,'-delete/1-fun-0-',1},
>           {mnesia_tm,apply_fun,3},
>           {mnesia_tm,execute_transaction,5},
>           {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>           {worker_pool_worker,handle_call,3},
>           {gen_server2,handle_msg,2}]}},
>     [{rabbit_misc,execute_mnesia_transaction,1},
>      {rabbit_mgmt_wm_vhost,delete_resource,2},
>      {webmachine_resource,resource_call,3},
>      {webmachine_resource,do,3},
>      {webmachine_decision_core,resource_call,1},
>      {webmachine_decision_core,decision,1},
>      {webmachine_decision_core,handle_request,2},
>      {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
> mochiweb+webmachine web server
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/f2259ca8/attachment-0001.htm>

From sschneider at gopivotal.com  Wed Jun 19 21:17:33 2013
From: sschneider at gopivotal.com (Stacey Schneider)
Date: Wed, 19 Jun 2013 16:17:33 -0400
Subject: [rabbitmq-discuss] RabbitMQ Plugin for New Relic Now Available
Message-ID: <47F9AFDB9D724FD3BCB0BDD560CBAD3D@gopivotal.com>

A RabbitMQ plugin for New Relic, the SaaS-based monitoring and management platform, has been open sourced to the RabbitMQ Community today. 

Using New Relic and the RabbitMQ management plugin, RabbitMQ users will be able to see the traces and transactions for RabbitMQ message servers right alongside other app servers, databases, caches, networking, clouds services, and other elements of your architecture. Troubleshooting any component that produces or consumes RabbitMQ messages (via AMQP or otherwise) is going to get faster and easier with this plugin. - See more at: http://blog.gopivotal.com/news-2/pivotal-contributes-open-source-plugins-for-new-relics-pluggable-monitoring-and-management-platform-rabbitmq-and-web-server#sthash.JWxA5Nvb.dpuf

This was part of a much bigger announcement with New Relic, releasing a new pluggable platform that over 45 of the most popular web technologies were added to their library of supported plugins. Other notable plugins include those from Amazon Web Services, MySQL, Hadoop and Pivotal's distribution of Apache HTTP Server, called Web Server.

For more on this release see: http://ow.ly/mbRsP  

-- 
Stacey Schneider
Pivotal 

Follow us on twitter! @gopivotal (http://twitter.com/gopivotal)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/98bde269/attachment.htm>

From tmehlinger at gmail.com  Thu Jun 20 01:32:57 2013
From: tmehlinger at gmail.com (Travis Mehlinger)
Date: Wed, 19 Jun 2013 19:32:57 -0500
Subject: [rabbitmq-discuss] |Spam| Re: Possible memory leak in the
 management plugin
In-Reply-To: <51C1CF76.20600@rabbitmq.com>
References: <8a1af6ed-c599-42a3-85c3-c5dc22a99bd8@googlegroups.com>
	<51BEF562.1090104@rabbitmq.com>
	<CACCscvxaBN0MS9pvOWT-fNCgG3YYaj36DawTF74iMWG4cGQGkA@mail.gmail.com>
	<51BF2C0C.9030601@rabbitmq.com>
	<CACCscvyem7mFzNBHzqvWWGZgnJEUn3jg7ot9uWK5Q7A2-pS3nA@mail.gmail.com>
	<CACCscvw1HiPiqxUgjPyvXJR8t_WQc=HG-EhfKe8vJ8dEq0tdTQ@mail.gmail.com>
	<51C03535.8010604@rabbitmq.com>
	<CACCscvwBPwnAkj=Zphxnp2FwoSCOW_Z1b7zpqDXDUBTUg-5YVQ@mail.gmail.com>
	<51C19274.3060202@rabbitmq.com>
	<CACCscvzm+p=vR0=d3_yFzmbidb+SGnEws9zW5q1cmHGVZXe+eg@mail.gmail.com>
	<51C1C6E9.9000109@rabbitmq.com> <51C1CF76.20600@rabbitmq.com>
Message-ID: <CACCscvzKubvsiGWNXBgkb651UUPKY=Eey0HZwVMr4VBrUrVAQg@mail.gmail.com>

I won't be able to test it in the same production environment but should be
able to reproduce the behavior in a test environment. I'm travelling
tomorrow afternoon, so if you don't hear from me by end of business UK time
tomorrow, I'll definitely have something for you Monday.

Thanks so much for all your help. :)

Best, Travis


On Wed, Jun 19, 2013 at 10:34 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Also, I have a patched version of the management plugin which fixes the
> leak I found today:
>
> http://www.rabbitmq.com/**releases/plugins/v3.1.1/**
> rabbitmq_management-3.1.1-**leakfix1.ez<http://www.rabbitmq.com/releases/plugins/v3.1.1/rabbitmq_management-3.1.1-leakfix1.ez>
>
> (see http://www.rabbitmq.com/**plugins.html#installing-**plugins<http://www.rabbitmq.com/plugins.html#installing-plugins>for where to put it, it replaces rabbitmq_management-3.1.1.ez)
>
> If you are able to test this version, that would also be great.
>
> Cheers, Simon
>
> On 19/06/13 15:57, Simon MacMullen wrote:
>
>> Thanks.
>>
>> Could you run
>>
>> rabbitmqctl eval
>> '{_,_,_,[_,_,_,_,[_,_,{_,[{_,**S}]}]]}=sys:get_status(global:**
>> whereis_name(rabbit_mgmt_db)),**T=element(5,S),ets:foldl(fun(**
>> E,_)->io:format("~p~n~n",[E])**end,[],T).'
>>
>>
>> please? This will dump the entire leaky table to standard output, so you
>> would want to redirect it to a file.
>>
>> If you could also accompany that with "rabbitmqctl report" so I can see
>> what actually exists at that time then I can at least see what is leaking.
>>
>> Cheers, Simon
>>
>> On 19/06/13 15:30, Travis Mehlinger wrote:
>>
>>> Hi Simon,
>>>
>>> We aren't doing anything like that. Whenever one of our services starts
>>> (which are based on Kombu, if that helps), it plucks a connection from
>>> its internal pool, creates a channel on that connection, then binds on
>>> its request queue, which hangs around until the service stops. The only
>>> thing that deviates from this pattern is our monitor, which connects and
>>> disconnects fairly rapidly, and uses exclusive queues.
>>>
>>> That said, it's entirely possible that we have something floating around
>>> that I don't know about that fits the behavior you described. I'll keep
>>> digging and see what I can turn up. In the meantime, let me know if
>>> there's any more information I can collect from Rabbit.
>>>
>>> Thanks, Travis
>>>
>>>
>>> On Wed, Jun 19, 2013 at 6:13 AM, Simon MacMullen <simon at rabbitmq.com
>>> <mailto:simon at rabbitmq.com>> wrote:
>>>
>>>     On 18/06/13 16:11, Travis Mehlinger wrote:
>>>
>>>         We declare those queues as exclusive so they're getting
>>> cleaned up
>>>         automatically.
>>>
>>>
>>>     I have found a plausible candidate for the leak. But it's dependent
>>>     on having a long lived channel which declares and deletes lots of
>>>     short-lived queues. We keep some information on the deleted queues
>>>     until the channel is closed. Could your monitoring tool be doing
>>>     that? Obviously it would have to be deleting queues explicitly, not
>>>     relying on them being exclusive.
>>>
>>>     Cheers, Simon
>>>
>>>
>>>     --
>>>     Simon MacMullen
>>>     RabbitMQ, Pivotal
>>>
>>>
>>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/7db18ab3/attachment.htm>

From houxuehua49 at gmail.com  Thu Jun 20 04:52:52 2013
From: houxuehua49 at gmail.com (richmonkey)
Date: Wed, 19 Jun 2013 20:52:52 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster memory alarm blocks producer too long
In-Reply-To: <51C18169.7080108@rabbitmq.com>
References: <6585d4ed-400d-451f-8dc4-511900bf4e45@googlegroups.com>
	<51C18169.7080108@rabbitmq.com>
Message-ID: <1371700372306-27507.post@n5.nabble.com>

slave?
[{pid,27573},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.1.1"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.1"},
      {webmachine,"webmachine","1.9.1-rmq3.1.1-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.1-gitd541e9a"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.1"},
      {rabbit,"RabbitMQ","3.1.1"},
      {os_mon,"CPO  CXC 138 46","2.2.11"},
      {inets,"INETS  CXC 138 49","5.9.4"},
      {mnesia,"MNESIA  CXC 138 12","4.8"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.1"},
      {xmerl,"XML parser","1.3.3"},
      {sasl,"SASL  CXC 138 11","2.3.1"},
      {stdlib,"ERTS  CXC 138 10","1.19.1"},
      {kernel,"ERTS  CXC 138 10","2.16.1"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R16B (erts-5.10.1) [source] [64-bit] [smp:4:4]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,3345436680},
      {connection_procs,5584},
      {queue_procs,2660479408},
      {plugins,361792},
      {other_proc,11007455},
      {mnesia,74240},
      {mgmt_db,10160},
      {msg_index,169223920},
      {other_ets,42476072},
      {binary,432199928},
      {code,19644401},
      {atom,703377},
      {other_system,9250343}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,3301285888},
 {disk_free_limit,1000000000},
 {disk_free,20246790144},
 {file_descriptors,
     [{total_limit,65436},
      {total_used,4},
      {sockets_limit,58890},
      {sockets_used,1}]},
 {processes,[{limit,1048576},{used,193}]},
 {run_queue,1},
 {uptime,5269}]

master:
[{pid,11220},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.1.1"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.1.1"},
      {webmachine,"webmachine","1.9.1-rmq3.1.1-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.1.1-gitd541e9a"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.1.1"},
      {rabbit,"RabbitMQ","3.1.1"},
      {ssl,"Erlang/OTP SSL application","5.2.1"},
      {public_key,"Public key infrastructure","0.18"},
      {crypto,"CRYPTO version 2","2.3"},
      {os_mon,"CPO  CXC 138 46","2.2.11"},
      {inets,"INETS  CXC 138 49","5.9.4"},
      {mnesia,"MNESIA  CXC 138 12","4.8"},
      {amqp_client,"RabbitMQ AMQP Client","3.1.1"},
      {xmerl,"XML parser","1.3.3"},
      {sasl,"SASL  CXC 138 11","2.3.1"},
      {stdlib,"ERTS  CXC 138 10","1.19.1"},
      {kernel,"ERTS  CXC 138 10","2.16.1"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R16B (erts-5.10.1) [source] [64-bit] [smp:4:4]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,1523362624},
      {connection_procs,303152},
      {queue_procs,1318303888},
      {plugins,562952},
      {other_proc,9732878},
      {mnesia,74240},
      {mgmt_db,615936},
      {msg_index,5185368},
      {other_ets,25073312},
      {binary,131634160},
      {code,21691510},
      {atom,793505},
      {other_system,9391723}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,3301285888},
 {disk_free_limit,1000000000},
 {disk_free,19787100160},
 {file_descriptors,
     [{total_limit,65436},
      {total_used,13},
      {sockets_limit,58890},
      {sockets_used,10}]},
 {processes,[{limit,1048576},{used,273}]},
 {run_queue,0},
 {uptime,169619}]



 rabbitmqctl list_connections  last_blocked_age last_blocked_by state:
Listing connections ...
332.078634	resource	blocked
332.283796	resource	blocked
332.368896	resource	blocked
332.479393	resource	blocked
infinity	none	blocking
infinity	none	blocking
infinity	none	blocking
infinity	none	blocking
...done.






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/cluster-memory-alarm-blocks-producer-too-long-tp27473p27507.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Thu Jun 20 05:54:35 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 20 Jun 2013 08:54:35 +0400
Subject: [rabbitmq-discuss] Lot of amq.gen-XXXXXX created
In-Reply-To: <CAPrynAUuur_9aT4w4s0WGSX37A0gxNU=FKZW5ykQaOPJcDPyXg@mail.gmail.com>
References: <CAPrynAUuur_9aT4w4s0WGSX37A0gxNU=FKZW5ykQaOPJcDPyXg@mail.gmail.com>
Message-ID: <582C8B62-27D3-4D32-AE5E-A956CA571AB7@gopivotal.com>

Mahesh Viraktamath:

> are these two things related or is there anything wrong with my RabbitMQ setup

Very unlikely.

Queued named amq.gen-* are server-named queues. They are created
by apps just like any other queues. You need to find out what application 
creates them and why.

MK

From watson.timothy at gmail.com  Thu Jun 20 09:10:26 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 20 Jun 2013 09:10:26 +0100
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
	provided are either offline or not running
In-Reply-To: <1371664141326-27499.post@n5.nabble.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
Message-ID: <2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>

Erlang will load the cookie from $HOME/.erlang.cookie so if you don't put it there the runtime will assign a random cookie and create the file itself.

In this context, HOME variable belongs to the user running the program, i.e., rabbitmq.

Cheers
Tim

On 19 Jun 2013, at 18:49, "k.madnani84" <k.madnani84 at gmail.com> wrote:

> Where are you putting your .erlang.cookie and how did you install the broker?
> 
> RE:I usually put in the user created folder data under the base
> directory.Does the path location also needs to be the same in order to have
> same cookie hash value?
> For example here are the exact locations:
> CLUSTER1 at zldv0435 : /opt/app/d1c1d20/rabbitmq/data/.erlang.cookie
> CLUSTER1 at zldv0432 : /opt/app/workload/rabbitmq/data/.erlang.cookie
> 
> The installation involves extracting  the binaries for unix,configuring
> rabbitmq.config file,setting the user,starting rabbitmq etc.
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27499.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From doug at hacks.perl.sh  Thu Jun 20 09:42:55 2013
From: doug at hacks.perl.sh (Doug)
Date: Thu, 20 Jun 2013 16:42:55 +0800
Subject: [rabbitmq-discuss] RabbitMQ cluster can't startup
Message-ID: <CAJxbUuUBMbDYHNZate-4jZDDUQBtWwYB7i8dFYHJERg5wTsu=Q@mail.gmail.com>

Hello,

We have 3 nodes as a cluster.
But today due to a power off all 3 hosts are down.
After the hosts get up we startup the rabbitmq on each server.
But they can't get started. the startup_log says as below.
Can you help? Thanks.


node           : rabbit at default74
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : gK39sZ9ArVpWGzGJIi4ZrQ==
log            : /var/log/rabbitmq/rabbit at default74.log
sasl log       : /var/log/rabbitmq/rabbit at default74-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at default74
erlang version : 5.9.1

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...

BOOT FAILED
===========

Timeout contacting cluster nodes: [rabbit at default73,rabbit at default72].

DIAGNOSTICS
===========

nodes in question: [rabbit at default73,rabbit at default72]

hosts, their running nodes and ports:
- default72: [{ns_1,21100}]
- default73: [{ns_1,21100}]

current node details:
- node name: rabbit at default74
- home dir: /var/lib/rabbitmq
- cookie hash: gK39sZ9ArVpWGzGJIi4ZrQ==




BOOT FAILED
===========

Error description:
   {could_not_start,rabbit,
       {bad_return,
           {{rabbit,start,[normal,[]]},
            {'EXIT',
                {rabbit,failure_during_boot,
                    {error,
                        {timeout_waiting_for_tables,
                            [rabbit_user,rabbit_user_permission,rabbit_vhost,
                             rabbit_durable_route,rabbit_durable_exchange,
                             rabbit_runtime_parameters,
                             rabbit_durable_queue]}}}}}}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at default74.log
   /var/log/rabbitmq/rabbit at default74-sasl.log

{"init terminating in
do_boot",{rabbit,failure_during_boot,{could_not_start,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot,{error,{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_durable_route,rabbit_durable_exchange,rabbit_runtime_parameters,rabbit_durable_queue]}}}}}}}}}

From emile at rabbitmq.com  Thu Jun 20 09:57:53 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 20 Jun 2013 09:57:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ cluster can't startup
In-Reply-To: <CAJxbUuUBMbDYHNZate-4jZDDUQBtWwYB7i8dFYHJERg5wTsu=Q@mail.gmail.com>
References: <CAJxbUuUBMbDYHNZate-4jZDDUQBtWwYB7i8dFYHJERg5wTsu=Q@mail.gmail.com>
Message-ID: <51C2C411.8060107@rabbitmq.com>

On 20/06/13 09:42, Doug wrote:
> Timeout contacting cluster nodes: [rabbit at default73,rabbit at default72].
Can you confirm that network connectivity between all three nodes has
been restored? They claim not to be able to communicate.


-Emile





From taihock at gmail.com  Thu Jun 20 10:03:28 2013
From: taihock at gmail.com (thomas)
Date: Thu, 20 Jun 2013 02:03:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Active-Active HA failover downtime
Message-ID: <1371719008745-27512.post@n5.nabble.com>

Hi,

I have currently set up 3 rabbitmq servers, namely rabbit at A, rabbit at b and
rabbit at C in a mirroring HA cluster.
I have performed some test to find out the downtime. The client application
connects to haproxy which will then direct the traffic to an alive rabbitmq
server. I am using autoheal for cluster_partition_handling. My net_ticktime
is 2 seconds.

Here's what I have tried:
1) client application publishing 10000 messages continuously to rabbit at A,
all 3 rabbitmq servers were up at that point of time, then I bring down the
network connection of a rabbit at B and this results in the sending of messages
stopping for about 15 seconds before continuing.

2) client application publishing 10000 messages continuously to rabbit at A,
all 3 rabbitmq servers were up at that point of time, then I bring down the
network connection of a rabbit at A and this results in the sending of messages
stopping for about 15 seconds before continuing, which is about the same for
the previous case.

I have look through the log and it shows that 2 seconds after i bring down
one node for the above 2 cases the node is detected as dead which is
correct. However, the promotion for slave or "saw death of mirror happens
about 15 seconds after a node is taken down in both cases.


I would like to find out the followings:
1) Is it normal for a disruption of 15 seconds when the slave is brought
down or should there be no disruption at all?
2) Is there suppose to be downtime when the master is down because from my
understanding it seems that  active-active will prevent that.
3) What are some of the configuration that could possibly be configured
wrongly if my 2 test cases were not suppose to behave that way?

Thanks.

Cheers,
Thomas



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Active-Active-HA-failover-downtime-tp27512.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Thu Jun 20 10:04:55 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 20 Jun 2013 10:04:55 +0100
Subject: [rabbitmq-discuss] Unable to start management console RabbitMQ
 3.1.1
In-Reply-To: <7377eed0-3fda-4bbf-8a70-5df5236f1dc1@googlegroups.com>
References: <f7cce1f1-fffa-471d-b71b-edf7868df1c6@googlegroups.com>
	<7377eed0-3fda-4bbf-8a70-5df5236f1dc1@googlegroups.com>
Message-ID: <51C2C5B7.6090509@rabbitmq.com>


Hi Michael,

On 19/06/13 20:41, Michael Bonar wrote:
> I can't see a way to tell rabbitmq-plugins to expand to a different folder.

Try setting %RABBITMQ_PLUGINS_EXPAND_DIR%



-Emile



From emile at rabbitmq.com  Thu Jun 20 10:14:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 20 Jun 2013 10:14:25 +0100
Subject: [rabbitmq-discuss] Causing publisher confirmations nacks for
 testing?
In-Reply-To: <690984D0-B11A-42E9-8BC0-D64C32432C83@sarna.org>
References: <690984D0-B11A-42E9-8BC0-D64C32432C83@sarna.org>
Message-ID: <51C2C7F1.5000106@rabbitmq.com>


Hi,

On 19/06/13 19:30, Ty Sarna wrote:
> I'm working with publisher confirmations, and I'd like to verify that my
> nack-handling logic is correct. Is there some way I can make RabbitMQ
> nack on demand, for testing purposes?

No, I don't think there is a simple way of prompting the broker to send
a basic.nack. But there is very little value in handling basic.nack
specially because the integrity of a broker that ever did send a
basic.nack would probably be compromised.


-Emile





From matthias at rabbitmq.com  Thu Jun 20 10:27:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 20 Jun 2013 10:27:58 +0100
Subject: [rabbitmq-discuss] Unable to start management console RabbitMQ
 3.1.1
In-Reply-To: <51C2C5B7.6090509@rabbitmq.com>
References: <f7cce1f1-fffa-471d-b71b-edf7868df1c6@googlegroups.com>
	<7377eed0-3fda-4bbf-8a70-5df5236f1dc1@googlegroups.com>
	<51C2C5B7.6090509@rabbitmq.com>
Message-ID: <51C2CB1E.3000905@rabbitmq.com>

On 20/06/13 10:04, Emile Joubert wrote:
> On 19/06/13 20:41, Michael Bonar wrote:
>> I can't see a way to tell rabbitmq-plugins to expand to a different folder.
>
> Try setting %RABBITMQ_PLUGINS_EXPAND_DIR%

(as per http://www.rabbitmq.com/relocate.html)

though you may want to set RABBITMQ_MNESIA_BASE instead, to place the 
message store (as well as the expanded plug-ins) on a local disk.

Matthias.

From tim at rabbitmq.com  Thu Jun 20 10:28:50 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 20 Jun 2013 10:28:50 +0100
Subject: [rabbitmq-discuss] Causing publisher confirmations nacks for
	testing?
In-Reply-To: <51C2C7F1.5000106@rabbitmq.com>
References: <690984D0-B11A-42E9-8BC0-D64C32432C83@sarna.org>
	<51C2C7F1.5000106@rabbitmq.com>
Message-ID: <9C1C3C32-F8EB-4121-8102-E1F6E5B766AF@rabbitmq.com>

Would the broker not send basic.nack on a channel in confirm mode if the message was un-routable?

On 20 Jun 2013, at 10:14, Emile Joubert wrote:

> 
> Hi,
> 
> On 19/06/13 19:30, Ty Sarna wrote:
>> I'm working with publisher confirmations, and I'd like to verify that my
>> nack-handling logic is correct. Is there some way I can make RabbitMQ
>> nack on demand, for testing purposes?
> 
> No, I don't think there is a simple way of prompting the broker to send
> a basic.nack. But there is very little value in handling basic.nack
> specially because the integrity of a broker that ever did send a
> basic.nack would probably be compromised.
> 
> 
> -Emile
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Thu Jun 20 10:32:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 20 Jun 2013 10:32:29 +0100
Subject: [rabbitmq-discuss] Causing publisher confirmations nacks for
	testing?
In-Reply-To: <9C1C3C32-F8EB-4121-8102-E1F6E5B766AF@rabbitmq.com>
References: <690984D0-B11A-42E9-8BC0-D64C32432C83@sarna.org>
	<51C2C7F1.5000106@rabbitmq.com>
	<9C1C3C32-F8EB-4121-8102-E1F6E5B766AF@rabbitmq.com>
Message-ID: <240394C1-67CA-4B23-9352-732A8C1F6D6C@rabbitmq.com>

On 20 Jun 2013, at 10:28, Tim Watson wrote:
> Would the broker not send basic.nack on a channel in confirm mode if the message was un-routable?
> 

Oh please ignore me, that's not the case!

Tim

> On 20 Jun 2013, at 10:14, Emile Joubert wrote:
> 
>> 
>> Hi,
>> 
>> On 19/06/13 19:30, Ty Sarna wrote:
>>> I'm working with publisher confirmations, and I'd like to verify that my
>>> nack-handling logic is correct. Is there some way I can make RabbitMQ
>>> nack on demand, for testing purposes?
>> 
>> No, I don't think there is a simple way of prompting the broker to send
>> a basic.nack. But there is very little value in handling basic.nack
>> specially because the integrity of a broker that ever did send a
>> basic.nack would probably be compromised.
>> 
>> 
>> -Emile
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Jun 20 10:44:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Jun 2013 10:44:26 +0100
Subject: [rabbitmq-discuss] Error deleting vhost
In-Reply-To: <57ad1e90-5686-4848-ad98-b84742d97572@googlegroups.com>
References: <afaedb27-74fb-4fb3-86b0-9d05723c0c5f@googlegroups.com>
	<57ad1e90-5686-4848-ad98-b84742d97572@googlegroups.com>
Message-ID: <51C2CEFA.7000704@rabbitmq.com>

Hi. There are a couple of bugs in config json vs policies and parameters 
vs vhosts. Some have been fixed already, and some will be fixed in the 
next release.

Cheers, Simon

On 19/06/13 21:24, austinnichols wrote:
> OK - I was able to figure this one out.  The solution wasn't easy, but
> may help someone in the future.
>
> I believe the core problem was a partially/mis-configured federation setup.
>
> I exported my config to json, stopped RMQ then deleted (renamed .bad)
> the mnesia folder.
>
> When I restarted I re-imported my config and found that I had the same
> problem as before.  OK - it's something in the config...
>
> I then went through the config json and CAREFULLY removed any references
> to my 'bad' vhost.  There were a few problem areas:
>
> 1.  Parameters node - several entries pertained to federation and when I
> went through the admin gui I couldn't remove the settings.  Deleted from
> the .json
> 2.  There were a couple of admin users with rights to the vHost that
> remained after the vhost was deleted.
>
> I cleared out mnesia again, restarted, imported my json and I'm now up
> and running.
>
> I was also having a problem turning on tracing (rabbitmqctl trace_on -p
> myVhost) which would hang on this specific vhost.  Once I uploaded my
> clean config I was able to enable trace without issues.
>
>
>
> On Wednesday, June 19, 2013 2:51:42 PM UTC-4, austinnichols wrote:
>
>     Using RMQ 3.0.2 / Erlang R14B04
>
>     I'm having difficulty deleting a specific vhost.  When attempting to
>     delete I receive the message below.  Other vhosts do not appear to
>     have this same issue.
>
>     Would appreciate any guidance on where to start troubleshooting ...
>
>
>     Delete this vhost
>
>     HTTP APICommand LineUpdate
>     Last update: 2013-06-19 14:41:20
>
>     Got response code 500 with body
>     Internal Server Error
>
>     The server encountered an error while processing this request:
>     {throw,
>          {error,
>              {{badmatch,
>                   {error_string,
>                       "Validation failed\n\nname not recognised:
>     undefined\n"}},
>               [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>                {rabbit_vhost,internal_delete,1},
>                {rabbit_vhost,'-delete/1-fun-0-',1},
>                {mnesia_tm,apply_fun,3},
>                {mnesia_tm,execute_transaction,5},
>                {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>                {worker_pool_worker,handle_call,3},
>                {gen_server2,handle_msg,2}]}},
>          [{rabbit_misc,execute_mnesia_transaction,1},
>           {rabbit_mgmt_wm_vhost,delete_resource,2},
>           {webmachine_resource,resource_call,3},
>           {webmachine_resource,do,3},
>           {webmachine_decision_core,resource_call,1},
>           {webmachine_decision_core,decision,1},
>           {webmachine_decision_core,handle_request,2},
>           {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
>     mochiweb+webmachine web server
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From umutcan at gamegos.com  Thu Jun 20 13:24:24 2013
From: umutcan at gamegos.com (Umutcan)
Date: Thu, 20 Jun 2013 15:24:24 +0300
Subject: [rabbitmq-discuss] PHP AMQP Extension Connection Timeout
In-Reply-To: <51C2CEFA.7000704@rabbitmq.com>
References: <afaedb27-74fb-4fb3-86b0-9d05723c0c5f@googlegroups.com>
	<57ad1e90-5686-4848-ad98-b84742d97572@googlegroups.com>
	<51C2CEFA.7000704@rabbitmq.com>
Message-ID: <51C2F478.9070103@gamegos.com>

Hi,

I am using AMQP extension of PHP in order to publish messages. I want my 
application to run whether it publish messages or not. So it must not 
wait too long to send messages to RabbitMQ server. setTimeout() method 
is working fine when server is running even if any of the alarms is 
true. But, it is not working if RabbitMQ server is stopped. Publisher 
can connect to the machine that hosts the server due to security 
settings,  but connection hangs for a long time until it throws an 
exception which gives an socket error message.

How can I solve this problem? Is there any idea?

Umutcan Onal

From michael.s.klishin at gmail.com  Thu Jun 20 13:42:29 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 20 Jun 2013 16:42:29 +0400
Subject: [rabbitmq-discuss] PHP AMQP Extension Connection Timeout
In-Reply-To: <51C2F478.9070103@gamegos.com>
References: <afaedb27-74fb-4fb3-86b0-9d05723c0c5f@googlegroups.com>
	<57ad1e90-5686-4848-ad98-b84742d97572@googlegroups.com>
	<51C2CEFA.7000704@rabbitmq.com> <51C2F478.9070103@gamegos.com>
Message-ID: <CAE3HoVSQ3wROJQOmFdk2Nf3uK6u6NCCRffVuKsLPUW829kvxoA@mail.gmail.com>

2013/6/20 Umutcan <umutcan at gamegos.com>

> But, it is not working if RabbitMQ server is stopped. Publisher can
> connect to the machine that hosts the server due to security settings,  but
> connection hangs for a long time until it throws an exception which gives
> an socket error message.


Clients should make socket timeouts configurable. If the PHP client you're
using does not,
file an issue with it.

Alternatively, try to see if you can obtain a reference to the socket and
set socket options on it
yourself.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130620/109252e8/attachment.htm>

From David.Legg at smithelectric.com  Thu Jun 20 14:57:50 2013
From: David.Legg at smithelectric.com (David Legg)
Date: Thu, 20 Jun 2013 08:57:50 -0500
Subject: [rabbitmq-discuss] Using Shovel to Copy Messages for Testing
Message-ID: <CDE8C8EE.9775%david.legg@smithelectric.com>

Hi All,

I'd like to get everyone's opinion on how best to do something.

At the moment I have a requirement to copy messages verbatim from a queue on a RabbitMQ server to another, primarily for testing and troubleshooting purposes. The messages on the original RabbitMQ server must remain intact and copied before any other consumer running on the queue deals with and acknowledges them. I'm looking at the Shovel plugin at the moment to do this, but can anyone see any pitfalls?

Thanks in advance,

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130620/b1136570/attachment.htm>

From k.madnani84 at gmail.com  Thu Jun 20 15:26:21 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Thu, 20 Jun 2013 07:26:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
Message-ID: <1371738381944-27522.post@n5.nabble.com>

I checked out the HOME directory and i see that the location specified for
HOME directory of user rabbitmq is /opt/app/rabbitmq/data and thats where am
placing my .erlang.cookie file:

$ egrep -i "^rabbitmq" /etc/passwd
rabbitmq:x:209530:276:Sponsor
,SHELL=/bin/ksh:/opt/app/rabbitmq/data:/bin/nologin

What other reason could be for this issue?




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27522.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ty at sarna.org  Thu Jun 20 15:44:53 2013
From: ty at sarna.org (Ty Sarna)
Date: Thu, 20 Jun 2013 10:44:53 -0400
Subject: [rabbitmq-discuss] Causing publisher confirmations nacks for
	testing?
In-Reply-To: <51C2C7F1.5000106@rabbitmq.com>
References: <690984D0-B11A-42E9-8BC0-D64C32432C83@sarna.org>
	<51C2C7F1.5000106@rabbitmq.com>
Message-ID: <B982D8E3-96D6-4564-87EF-0FE50E6426C8@sarna.org>

On Jun 20, 2013, at 5:14 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> On 19/06/13 19:30, Ty Sarna wrote:
>> I'm working with publisher confirmations, and I'd like to verify that my
>> nack-handling logic is correct. Is there some way I can make RabbitMQ
>> nack on demand, for testing purposes?
> 
> No, I don't think there is a simple way of prompting the broker to send
> a basic.nack. But there is very little value in handling basic.nack
> specially because the integrity of a broker that ever did send a
> basic.nack would probably be compromised.

As I understand it, in the publisher confirmations case the broker nacks with basic.return+basic.ack rather than basic.nack. And, I do need *some* special handling for that case, otherwise there's no point in using confirmations at all.

If the broker only fails to ack in cases where it's completely hosed the handling can be as simple as considering the connection dead, disconnecting, and retrying this and all subsequent messages when/if we reconnect. Even so, it would be nice to test that logic.

-Ty

From michael.s.klishin at gmail.com  Thu Jun 20 15:49:54 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 20 Jun 2013 18:49:54 +0400
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <1371738381944-27522.post@n5.nabble.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
Message-ID: <CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>

2013/6/20 k.madnani84 <k.madnani84 at gmail.com>

> What other reason could be for this issue?


Does the cookie file have correct owner and permissions?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130620/0f52587d/attachment.htm>

From k.madnani84 at gmail.com  Thu Jun 20 16:00:05 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Thu, 20 Jun 2013 08:00:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
Message-ID: <1371740405967-27525.post@n5.nabble.com>

It has a read permission for the user rabbitmQ.What permissions are expected
on it?

-r--------  1 rabbitmq rabbitmq   22 Jun 19 11:58 .erlang.cookie




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27525.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Jun 20 17:23:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Jun 2013 17:23:13 +0100
Subject: [rabbitmq-discuss] Erlang R16B01 and SSL
Message-ID: <51C32C71.7060501@rabbitmq.com>

Please be cautious before upgrading to R16B01. If you have SSL enabled 
RabbitMQ will fail to start with an error message like:


BOOT FAILED
===========

Error description:
    {error,{cannot_start_application,public_key,{not_started,asn1}}}


We'll be fixing this (along with a bunch of other stuff) in RabbitMQ 
3.1.2, due imminently.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Thu Jun 20 18:05:03 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 20 Jun 2013 21:05:03 +0400
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <1371740405967-27525.post@n5.nabble.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
Message-ID: <CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>

2013/6/20 k.madnani84 <k.madnani84 at gmail.com>

> -r--------  1 rabbitmq rabbitmq   22 Jun 19 11:58 .erlang.cookie


This looks good.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130620/3c9a6866/attachment.htm>

From k.madnani84 at gmail.com  Thu Jun 20 18:25:43 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Thu, 20 Jun 2013 10:25:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
	<CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
Message-ID: <1371749143163-27528.post@n5.nabble.com>

Thanks Michael!!!
Do you have any idea,If anything else which i am missing.
I tried to manually stop the servers and restart them after putting the
values in rabbitmq.config file(2nd approach) but still the two nodes dont
get clustered.Cookie hash value in start up logs is still different.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27528.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From oliviermis.pro at gmail.com  Thu Jun 20 18:48:53 2013
From: oliviermis.pro at gmail.com (Olivier Mis)
Date: Thu, 20 Jun 2013 19:48:53 +0200
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
	provided are either offline or not running
In-Reply-To: <1371749143163-27528.post@n5.nabble.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
	<CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
	<1371749143163-27528.post@n5.nabble.com>
Message-ID: <06A0347F-8B7A-41BA-A9DA-50F8B9794CAA@gmail.com>

Just an idea like that... I didnt check the messages below but, did you modify /etc/hosts ?

Envoy? de mon iPhone

Le 20 juin 2013 ? 19:25, "k.madnani84" <k.madnani84 at gmail.com> a ?crit :

> Thanks Michael!!!
> Do you have any idea,If anything else which i am missing.
> I tried to manually stop the servers and restart them after putting the
> values in rabbitmq.config file(2nd approach) but still the two nodes dont
> get clustered.Cookie hash value in start up logs is still different.
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27528.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From k.madnani84 at gmail.com  Thu Jun 20 18:58:00 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Thu, 20 Jun 2013 10:58:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <06A0347F-8B7A-41BA-A9DA-50F8B9794CAA@gmail.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
	<CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
	<1371749143163-27528.post@n5.nabble.com>
	<06A0347F-8B7A-41BA-A9DA-50F8B9794CAA@gmail.com>
Message-ID: <1371751080473-27530.post@n5.nabble.com>

What modifications do we need in /etc/hosts and should it be in all the
nodes?
I was under the impression if i am able to ping the other node and telnet on
epmd port,thats enough to confirm the connectivity,which i am able to do?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27530.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From oliviermis.pro at gmail.com  Thu Jun 20 19:12:21 2013
From: oliviermis.pro at gmail.com (Olivier Mis)
Date: Thu, 20 Jun 2013 20:12:21 +0200
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
	provided are either offline or not running
In-Reply-To: <1371751080473-27530.post@n5.nabble.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
	<CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
	<1371749143163-27528.post@n5.nabble.com>
	<06A0347F-8B7A-41BA-A9DA-50F8B9794CAA@gmail.com>
	<1371751080473-27530.post@n5.nabble.com>
Message-ID: <65CA80B5-440C-4714-BA30-24AE188D3174@gmail.com>

Maybe I'm not right, but it is one thing what made me that error. 

In RabbitMQ u call them by their hostnames, not by their IP ?

In all nodes, you write hostnames and IPs of every server, like that

hostname IP
hostname IP

Envoy? de mon iPhone

Le 20 juin 2013 ? 19:58, "k.madnani84" <k.madnani84 at gmail.com> a ?crit :

> What modifications do we need in /etc/hosts and should it be in all the
> nodes?
> I was under the impression if i am able to ping the other node and telnet on
> epmd port,thats enough to confirm the connectivity,which i am able to do?
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27530.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tim at rabbitmq.com  Fri Jun 21 07:54:47 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 21 Jun 2013 07:54:47 +0100
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
	provided are either offline or not running
In-Reply-To: <1371751080473-27530.post@n5.nabble.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
	<CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
	<1371749143163-27528.post@n5.nabble.com>
	<06A0347F-8B7A-41BA-A9DA-50F8B9794CAA@gmail.com>
	<1371751080473-27530.post@n5.nabble.com>
Message-ID: <CAAF2BFC-CD7E-47EF-AE80-AC6E21493498@rabbitmq.com>

On 20 Jun 2013, at 18:58, k.madnani84 wrote:
> What modifications do we need in /etc/hosts and should it be in all the
> nodes?
> I was under the impression if i am able to ping the other node and telnet on
> epmd port,thats enough to confirm the connectivity,which i am able to do?
> 

If your nodes are using the hostname in their node names, then both machines need to be able to resolve one another's host name via DNS. For example, if when you start the broker (or run `rabbitmqctl status` against an existing broker) you see that the node name is "rabbit at host1" then any other nodes that wish to cluster with this broker will need to be able to `ping host1` - pinging the IP address isn't enough, since Erlang will use DNS to attempt external host discovery.

When you run `rabbitmqctl join_cluster CLUSTER1 at zldv0432` the local node needs to be able to resolve zldv0432, and a common way to make that happen is editing the hosts file on each machine.

Cheers,
Tim

From hudson.9999 at gmail.com  Fri Jun 21 09:39:33 2013
From: hudson.9999 at gmail.com (Hudson Jiang)
Date: Fri, 21 Jun 2013 01:39:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Simultaneous Scalability and HA
Message-ID: <434df67e-9239-4827-9c1a-aa86eda9ab35@googlegroups.com>

As per the document RabbitMQ in Action, to achieve scalability, we need to 
use RabbitMQ cluster, and there're below statements: 

why doesn?t RabbitMQ replicate queue contents and state across all nodes by 
default?
There are two reasons:
1 Storage space?If every cluster node had a full copy of every queue, 
adding nodes
wouldn?t give you more storage capacity. For example, if one node could 
store
1 GB of messages, adding two more nodes would just give you two more copies
of the same 1 GB of messages.
2 Performance?Publishing messages would require replicating those messages 
to
every cluster node. For durable messages, that would require triggering disk
activity on all nodes for every message. Your network and disk load would
increase every time you added a node, keeping the performance of the cluster
the same (or possibly worse).

However, for achieving HA, the suggested approach is the built-in 
active-active option for queues: mirrored queues. And it's recommended to 
use: 
queue_args = {"x-ha-policy" : "all" }

Is above cluster approach for scalability conflicted with the mirrored 
queues approach for HA (do I misunderstand anything)? How can I achieve 
both of them simultaneously?


Best regards, 
Hudson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130621/39f4efc1/attachment.htm>

From mklishin at gopivotal.com  Fri Jun 21 10:35:02 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 21 Jun 2013 13:35:02 +0400
Subject: [rabbitmq-discuss] Simultaneous Scalability and HA
In-Reply-To: <434df67e-9239-4827-9c1a-aa86eda9ab35@googlegroups.com>
References: <434df67e-9239-4827-9c1a-aa86eda9ab35@googlegroups.com>
Message-ID: <389C6B43-EFA3-4E0A-9E5C-4CEABFC0F6D5@gopivotal.com>

Hudson Jiang:

> Is above cluster approach for scalability conflicted with the mirrored queues approach for HA (do I misunderstand anything)? How can I achieve both of them simultaneously?

"Scalability" is different things to different people but lets assume it means
"increasing overall system throughput by adding more cluster nodes".

Replicating data to more nodes for availability indeed may be at odds
with the max total throughput requirement, and more so as cluster size grows.

Identify where you absolutely need mirroring and where
throughput is more important. Not all queues are created equal.

MK

From tim at rabbitmq.com  Fri Jun 21 11:17:46 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 21 Jun 2013 11:17:46 +0100
Subject: [rabbitmq-discuss] Simultaneous Scalability and HA
In-Reply-To: <434df67e-9239-4827-9c1a-aa86eda9ab35@googlegroups.com>
References: <434df67e-9239-4827-9c1a-aa86eda9ab35@googlegroups.com>
Message-ID: <5F673FAD-E0F5-42F3-AEE7-C3EFA27FCBA5@rabbitmq.com>

On 21 Jun 2013, at 09:39, Hudson Jiang wrote:
> However, for achieving HA, the suggested approach is the built-in active-active option for queues: mirrored queues. And it's recommended to use: 
> queue_args = {"x-ha-policy" : "all" }
> 

Where does it say the "all" policy is the recommend one? Look at it like this: mirror queues (i.e., HA in RabbitMQ) buys you resilience to node failure, which might increase availability. But it doesn't buy you anything in terms of "distributing load", since HA actually adds load (as a result of replication) to the system.

> Is above cluster approach for scalability conflicted with the mirrored queues approach for HA (do I misunderstand anything)? How can I achieve both of them simultaneously?
> 

Clustering provides a consistent view of all the (clustered) brokers from each node, which means you can connect to any node and interact with objects (i.e., publish to exchanges or consume from queues) on any node in the cluster.

Mirroring / HA provides replication of contents for 1 queue, that you've chosen to mirror, and you can maintain the queue's state across however many replicas you see fit by setting the appropriate policy. If you mirrored all queues across all nodes, you'd find that hurts performance. If you mirror no queues, you might loose data if one of your nodes crashes.

Now, to Michael's point: what do *you* want to do here? Scalability is an almost meaningless term used in isolation. Are you trying to achieve:

* higher levels of throughput than a single node can manage?
* higher levels of availability/resilience just in case one or more nodes crash?
* ability to add more capacity (e.g., # clients, volume of work/throughput, etc) to a live system?
* etc??

Note that the "A" in HA stands for "Availability" not "throughput" or "performance", though we think that acceptable levels of throughput and performance are achievable with mirror queues, considering the compromises necessary to guarantee consistency and avoid data loss.

Other options for utilising clusters include load balancing in front of the cluster, using federation or the shovel plugin instead of clustering to distribute messages between nodes (or data centres).

Cheers,
Tim

From matthias at rabbitmq.com  Fri Jun 21 11:36:43 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 21 Jun 2013 11:36:43 +0100
Subject: [rabbitmq-discuss] Simultaneous Scalability and HA
In-Reply-To: <5F673FAD-E0F5-42F3-AEE7-C3EFA27FCBA5@rabbitmq.com>
References: <434df67e-9239-4827-9c1a-aa86eda9ab35@googlegroups.com>
	<5F673FAD-E0F5-42F3-AEE7-C3EFA27FCBA5@rabbitmq.com>
Message-ID: <51C42CBB.6010800@rabbitmq.com>

On 21/06/13 11:17, Tim Watson wrote:
> Mirroring / HA provides replication of contents for 1 queue, that
> you've chosen to mirror, and *you can maintain the queue's state
> across however many replicas you see fit*

That is the crucial bit.

If you want HA *and* increased scalability then create a cluster with >2 
nodes and configure your HA policy to mirror queues across a subset of them.

The 'exactly' and 'nodes' policies allow you to do that. See 
http://www.rabbitmq.com/ha.html#genesis.

NB: RabbitMQ in Action predates the introduction of server-configured 
policies; the x-ha-policy queue parameter does nothing in modern 
rabbits. See the above docs for the new way of configuring HA.

Regards,

Matthias.

From simon at rabbitmq.com  Fri Jun 21 11:41:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Jun 2013 11:41:53 +0100
Subject: [rabbitmq-discuss] Simultaneous Scalability and HA
In-Reply-To: <51C42CBB.6010800@rabbitmq.com>
References: <434df67e-9239-4827-9c1a-aa86eda9ab35@googlegroups.com>
	<5F673FAD-E0F5-42F3-AEE7-C3EFA27FCBA5@rabbitmq.com>
	<51C42CBB.6010800@rabbitmq.com>
Message-ID: <51C42DF1.6000302@rabbitmq.com>

On 21/06/13 11:36, Matthias Radestock wrote:
> NB: RabbitMQ in Action predates the introduction of server-configured
> policies; the x-ha-policy queue parameter does nothing in modern
> rabbits. See the above docs for the new way of configuring HA.

Which is probably why it recommends "all" mode. Prior to 3.0.0, 
"exactly" mode didn't exist, and "nodes" mode meant you baked knowledge 
of your cluster into your queues, which tended to be very awkward.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Fri Jun 21 11:43:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 21 Jun 2013 11:43:12 +0100
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <CAAF2BFC-CD7E-47EF-AE80-AC6E21493498@rabbitmq.com>
References: <1371660377336-27496.post@n5.nabble.com>
	<3B6719DC-1421-46D3-B21A-51A32F49A5C5@rabbitmq.com>
	<1371664141326-27499.post@n5.nabble.com>
	<2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
	<CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
	<1371749143163-27528.post@n5.nabble.com>
	<06A0347F-8B7A-41BA-A9DA-50F8B9794CAA@gmail.com>
	<1371751080473-27530.post@n5.nabble.com>
	<CAAF2BFC-CD7E-47EF-AE80-AC6E21493498@rabbitmq.com>
Message-ID: <51C42E40.700@rabbitmq.com>

On 21/06/13 07:54, Tim Watson wrote:
> On 20 Jun 2013, at 18:58, k.madnani84 wrote:
>> What modifications do we need in /etc/hosts and should it be in all
>> the nodes? I was under the impression if i am able to ping the
>> other node and telnet on epmd port,thats enough to confirm the
>> connectivity,which i am able to do?
>>
>
> If your nodes are using the hostname in their node names, then both
> machines need to be able to resolve one another's host name via DNS.

That's all a red herring. The OP says that "Cookie hash value in start 
up logs is different". That will prevent clustering from working, 
regardless of network setup.

To the OP...

The startup logs you posted, and subsequent observations by yourself, 
state that the home dir is /opt/app/rabbitmq/data on both nodes. Please 
double-check that you indeed have a .erlang.cookie file in there and 
that its contents are the same on both nodes (simply 'cat' the file).

Matthias.

From k.madnani84 at gmail.com  Fri Jun 21 16:30:52 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Fri, 21 Jun 2013 08:30:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <51C42E40.700@rabbitmq.com>
References: <2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
	<CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
	<1371749143163-27528.post@n5.nabble.com>
	<06A0347F-8B7A-41BA-A9DA-50F8B9794CAA@gmail.com>
	<1371751080473-27530.post@n5.nabble.com>
	<CAAF2BFC-CD7E-47EF-AE80-AC6E21493498@rabbitmq.com>
	<51C42E40.700@rabbitmq.com>
Message-ID: <1371828652524-27539.post@n5.nabble.com>

I checked the cookie value multiple times.In fact i tried multiple deinstall
and install but the output is same.

I also came across in few forums that the cookie value gets overriden by the
setcookie option of rabbitmq-server.Will it be good idea to use that,If yes
what changes do we need to make in order to use it in rabbitmqctl &
rabbitmq-server as the RabbitMq documentation doesnt mentions much about it.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27539.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mnelson at steele-forge.com  Fri Jun 21 18:44:05 2013
From: mnelson at steele-forge.com (Morgan Nelson)
Date: Fri, 21 Jun 2013 12:44:05 -0500
Subject: [rabbitmq-discuss] Rabbit 3.1.1 crash question
Message-ID: <CAFAX_jw5FGSbXnXm6rGzJZPWZaw4pUMaOROOFRpzp3yB1Ep7Sw@mail.gmail.com>

All,

    I'm having a crash in RabbitMQ about every 36 hours or so.  I have a
gist at https://gist.github.com/korishev/5832748 with a (very large) set of
crash and supervisor reports.

    Some relevant details:

    RabbitMQ 3.1.1
    Erlang R14B04
    Ubuntu 12.04LTS with 3.2.0-32-virtual #51-Ubuntu SMP Wed Sep 26
21:53:42 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
    Bunny Gem (0.8.0)

    The box running RabbitMQ is an EC2 instance, m2.2xlarge

    Current:
        Queues:  718
        Consumers:  1717
        Message rates:  varies from ~750/s to ~1200/s spiking to ~1500/s

    We get a set of these messages, then the RabbitMQ memory starts
climbing, 90% of the time there is a second process spawned that starts
adding pressure to the system, we get a lot of "publishing off/on" messages
and then the world stops until we restart RabbitMQ.

     Thanks!
-- 

Morgan Nelson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130621/c208a3d5/attachment.htm>

From michael.dyer at digitaleragroup.com  Fri Jun 21 20:56:20 2013
From: michael.dyer at digitaleragroup.com (austinnichols)
Date: Fri, 21 Jun 2013 12:56:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Request: Enable/Disable Firehose via Management
	API
Message-ID: <c4df24f5-f9b9-4095-810c-79283bc53a7c@googlegroups.com>

It sure would be nice to get trace_on/off as part of the management API...

Who do I need to buy a beer for?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130621/54eb8422/attachment.htm>

From matthias at rabbitmq.com  Fri Jun 21 23:33:56 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 21 Jun 2013 23:33:56 +0100
Subject: [rabbitmq-discuss] Rabbit 3.1.1 crash question
In-Reply-To: <CAFAX_jw5FGSbXnXm6rGzJZPWZaw4pUMaOROOFRpzp3yB1Ep7Sw@mail.gmail.com>
References: <CAFAX_jw5FGSbXnXm6rGzJZPWZaw4pUMaOROOFRpzp3yB1Ep7Sw@mail.gmail.com>
Message-ID: <51C4D4D4.6050509@rabbitmq.com>

Morgan,

On 21/06/13 18:44, Morgan Nelson wrote:
>      I'm having a crash in RabbitMQ about every 36 hours or so.  I have
> a gist at https://gist.github.com/korishev/5832748 with a (very large)
> set of crash and supervisor reports.

That's a bug. It's quite difficult to trigger, so I'm not surprised it's 
taking a while for your broker to run into it.

AFAICT the bug will only surface on a channel with basic.qos prefetch, 
when there is a sequence of several basic.consume and basic.cancel 
commands involving the same queue. And there are several other 
conditions that need to be met, and the timing needs to be just right.

A workaround until we fix this would be closing channels after 
basic.cancel and using a fresh channel for every basic.consume.

Thanks for reporting this!

Regards,

Matthias.

From mnelson at steele-forge.com  Sat Jun 22 03:30:27 2013
From: mnelson at steele-forge.com (Morgan Nelson)
Date: Fri, 21 Jun 2013 21:30:27 -0500
Subject: [rabbitmq-discuss] Rabbit 3.1.1 crash question
In-Reply-To: <51C4D4D4.6050509@rabbitmq.com>
References: <CAFAX_jw5FGSbXnXm6rGzJZPWZaw4pUMaOROOFRpzp3yB1Ep7Sw@mail.gmail.com>
	<51C4D4D4.6050509@rabbitmq.com>
Message-ID: <CAFAX_jwm6FPifT-2a4Tg5LR9hZiJi77Lhaa+M88CzoZkBqUXWw@mail.gmail.com>

Matthias,

    Thanks for the reply, I'll forward it on to the rest of my team.  We'll
implement the workaround ASAP.

    In the mean time, is there anything I/we can do to help resolve this
issue?

Morgan Nelson


On Fri, Jun 21, 2013 at 5:33 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Morgan,
>
>
> On 21/06/13 18:44, Morgan Nelson wrote:
>
>>      I'm having a crash in RabbitMQ about every 36 hours or so.  I have
>> a gist at https://gist.github.com/**korishev/5832748<https://gist.github.com/korishev/5832748>with a (very large)
>> set of crash and supervisor reports.
>>
>
> That's a bug. It's quite difficult to trigger, so I'm not surprised it's
> taking a while for your broker to run into it.
>
> AFAICT the bug will only surface on a channel with basic.qos prefetch,
> when there is a sequence of several basic.consume and basic.cancel commands
> involving the same queue. And there are several other conditions that need
> to be met, and the timing needs to be just right.
>
> A workaround until we fix this would be closing channels after
> basic.cancel and using a fresh channel for every basic.consume.
>
> Thanks for reporting this!
>
> Regards,
>
> Matthias.
>



-- 
Morgan Nelson
Software Acolyte
(214) 392-6483
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130621/ada9295e/attachment.htm>

From matthias at rabbitmq.com  Sat Jun 22 09:26:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 22 Jun 2013 09:26:10 +0100
Subject: [rabbitmq-discuss] Rabbit 3.1.1 crash question
In-Reply-To: <CAFAX_jwm6FPifT-2a4Tg5LR9hZiJi77Lhaa+M88CzoZkBqUXWw@mail.gmail.com>
References: <CAFAX_jw5FGSbXnXm6rGzJZPWZaw4pUMaOROOFRpzp3yB1Ep7Sw@mail.gmail.com>
	<51C4D4D4.6050509@rabbitmq.com>
	<CAFAX_jwm6FPifT-2a4Tg5LR9hZiJi77Lhaa+M88CzoZkBqUXWw@mail.gmail.com>
Message-ID: <51C55FA2.9070407@rabbitmq.com>

Morgan,

On 22/06/13 03:30, Morgan Nelson wrote:
>      In the mean time, is there anything I/we can do to help resolve
> this issue?

The fix is a two line change, which I committed last night 
(http://hg.rabbitmq.com/rabbitmq-server/rev/a19209f57363). Hopefully 
this will make it into the upcoming 3.1.2 release.

Matthias.

From matthewetaft at gmail.com  Sat Jun 22 15:32:11 2013
From: matthewetaft at gmail.com (Matthew Taft)
Date: Sat, 22 Jun 2013 07:32:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Getting many messages,
 ack() failing if total messages not equal a 10 increment
Message-ID: <faba7352-9c2e-4d87-ab8f-8fa8370941bd@googlegroups.com>

Hi everyone,

Hoping someone can help me with this problem.  After going through a few 
tutorials, I've pieced together some code the produce and consume messages. 
 I'm using kombu.  I'lll past the code below.  But the idea is to be able 
to send many messages to the queue, possibly hundreds, then have a periodic 
task that wakes up and consumes all messages.  Right now I haven't set up 
the periodic task.  It's just a simply python file.  When passed "produce," 
it produces some random messages.  When passed "consume," it consumes them.

I've found that when the total messages is in increments of 10 (90, 100, 
510, etc.), all messages get processed correctly and the qsize value shows 
there are 0 messages remaining.  However -- and this is better explained by 
example - if the queue contains 78 messages, after processing all of them, 
the queue reports 8 remaining, but the consumer can no longer get them 
(times out).  Any time the total qsize at the start is anything other than 
a 10 increment (129, 523, 234, etc.), the part beyond the latest 10 
increment is left remaining (9, 3, 4, etc.). 

I've added some print statements to confirm that each message is actually 
consumed correctly, and the ack() is being called for each one.  However, I 
noticed that the qsize value is only being updated every 10 messages. 
 Here's the log for some of them to give you a better idea. The first 
number is the counter.  It's shown three times for each message because I'm 
printing before the get, after the get, then after the ack().  Notice the 
qsize value only updates every 10 messages:

--------------------------------------------------------------------------------
Total Messages: 78
--------------------------------------------------------------------------------
Counter | Status
0: amount before queue.get: 78
0: amount after queue.get, before ack(): 78
0: amount after queue.get, after ack(): 78
1: amount before queue.get: 78
1: amount after queue.get, before ack(): 78
1: amount after queue.get, after ack(): 78
2: amount before queue.get: 78
2: amount after queue.get, before ack(): 78
2: amount after queue.get, after ack(): 78
3: amount before queue.get: 78
3: amount after queue.get, before ack(): 78
3: amount after queue.get, after ack(): 78
4: amount before queue.get: 78
4: amount after queue.get, before ack(): 78
4: amount after queue.get, after ack(): 78
5: amount before queue.get: 78
5: amount after queue.get, before ack(): 78
5: amount after queue.get, after ack(): 78
6: amount before queue.get: 78
6: amount after queue.get, before ack(): 78
6: amount after queue.get, after ack(): 78
7: amount before queue.get: 78
7: amount after queue.get, before ack(): 78
7: amount after queue.get, after ack(): 78
8: amount before queue.get: 78
8: amount after queue.get, before ack(): 78
8: amount after queue.get, after ack(): 78
9: amount before queue.get: 78
9: amount after queue.get, before ack(): 68
9: amount after queue.get, after ack(): 68

Is it just some configuration I have to set?  Or is there something wrong 
in the code?  Here's the code in full:

import sys
from contextlib import closing
from django.conf import settings
from django.dispatch import Signal
from django.dispatch import receiver
from kombu import BrokerConnection
from Queue import Empty

# Test Stuff:
queue_name = "my.messages"
test_messages_to_produce = 78
consumer_batch_size = 100
consumer_timeout = 5


class UserMessenger(object):
    """
    Class for producing and consuming messages
    """
    def __init__(self, connection, queue_name, serializer="json", 
compression=None):
        self.queue = connection.SimpleQueue(queue_name)
        self.serializer = serializer
        self.compression = compression

    def produce_message(self, context={}):
        self.queue.put(context,
                       serializer=self.serializer,
                       compression=self.compression)

    def consume_messages(self, callback, messages_to_get=1, timeout=1):
        for i in range(messages_to_get):
            try:
                before_get = self.get_message_count()
                message = self.queue.get(block=True, timeout=timeout)
                callback(message.payload)

                after_get_before_ack = self.get_message_count()
                message.ack() # remove message from queue
                after_get_after_ack = self.get_message_count()

                deserialized = message.payload
                user_id = deserialized["user_id"]
                print("%d: amount before queue.get: %d" % (user_id, 
before_get))
                print("%d: amount after queue.get, before ack(): %d" % 
(user_id, after_get_before_ack))
                print("%d: amount after queue.get, after ack(): %d" % 
(user_id, after_get_after_ack))
            except Empty as e:
                break;

    def get_message_count(self):
        return self.queue.qsize()

    def purge_messages(self):
        self.queue.clear()

    def close(self):
        self.queue.close()


def produce():
    with BrokerConnection(settings.BROKER_URL) as connection:
        with closing(UserMessenger(connection, queue_name)) as messenger:

            #Just produce some random messages for now:
            for i in range(test_messages_to_produce):
                context = {
                    "user_id": i,
                    "changed_fields": {
                        'first_name': {
                            'before':'albert',
                            'after':'Albert'
                     }}}

                messenger.produce_message(context)


def consume():
    messages = []

    def consume_message_callback(message):
        """
        This callback passed to the messenger consume_messages method, 
which calls it for each message.
        Just append to messages for now.
        """
        if message is not None:
            messages.append(message)


    with BrokerConnection(settings.BROKER_URL) as connection:
        with closing(UserMessenger(connection, queue_name)) as messenger:
            messages_count = messenger.get_message_count()

            # Debug: How many total?
            print "-" * 80; print "Total Messages: %d" % messages_count; 
print "-" * 80

            for i in range(0, messages_count, consumer_batch_size):
                messenger.consume_messages(
                            consume_message_callback,
                            messages_to_get = consumer_batch_size,
                            timeout = consumer_timeout,
                        )

            # Debug: Print the results.
            print "Should be done now.  Let's see what we have:"
            for message in messages:
                print message

def purge():
    """
    Delete messages (for debugging)
    """
    with BrokerConnection(settings.BROKER_URL) as connection:
        with closing(UserMessenger(connection, queue_name)) as messenger:
            messenger.purge_messages()

def status():
    """
    Get messages on queue (for debugging)
    """
    with BrokerConnection(settings.BROKER_URL) as connection:
        with closing(UserMessenger(connection, queue_name)) as messenger:
            print("Remaining messages: %d" % messenger.queue.qsize())


if __name__ == "__main__":
    if sys.argv[0].startswith("python"):
        option_index = 2
    else:
        option_index = 1
    option = sys.argv[option_index]

    if option == "produce":
        produce()
    elif option == "consume":
        consume()
    elif option == "purge":
        purge()
    elif option == "status":
        status()
    else:
        print "Unknown option '%s'; exiting ..." % option
        sys.exit(1)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130622/79132aca/attachment.htm>

From gmr at meetme.com  Mon Jun 24 06:14:02 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Mon, 24 Jun 2013 01:14:02 -0400
Subject: [rabbitmq-discuss] RabbitMQ in Depth
Message-ID: <87F5D82788134717BF8B6B426EA23946@meetme.com>

Hi all,  

I wanted to drop a quick note to let everyone know that my book in progress, RabbitMQ in Depth is available in rough form in the Manning Early Access Program. In addition, it is today?s Manning Deal of the Day. If you?re interested in knowing more about RabbitMQ or just helping me out, you can purchase the book today for 50% of using the code dotd0624au at www.manning.com/roy/.  

I apologize in advance if I have offended anyone using the list this way and won?t make a habit of it.

Cheers,

Gavin  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/cb358b42/attachment.htm>

From alexis at rabbitmq.com  Mon Jun 24 06:20:23 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 24 Jun 2013 06:20:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ in Depth
In-Reply-To: <87F5D82788134717BF8B6B426EA23946@meetme.com>
References: <87F5D82788134717BF8B6B426EA23946@meetme.com>
Message-ID: <CACOPnvfD7TQ7kqJDa=aUtW2wNvo-XUf5ziFjQRY6y45GZRkwAw@mail.gmail.com>

Cool.  Thanks Gavin :-)

On Mon, Jun 24, 2013 at 6:14 AM, Gavin M. Roy <gmr at meetme.com> wrote:
> Hi all,
>
> I wanted to drop a quick note to let everyone know that my book in progress,
> RabbitMQ in Depth is available in rough form in the Manning Early Access
> Program. In addition, it is today?s Manning Deal of the Day. If you?re
> interested in knowing more about RabbitMQ or just helping me out, you can
> purchase the book today for 50% of using the code dotd0624au at
> www.manning.com/roy/.
>
> I apologize in advance if I have offended anyone using the list this way and
> won?t make a habit of it.
>
> Cheers,
>
> Gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bfry at fryhard.com  Mon Jun 24 06:41:34 2013
From: bfry at fryhard.com (Brendan Fry)
Date: Sun, 23 Jun 2013 22:41:34 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ reliance on Java Virtual Machine
Message-ID: <5d2a82d9-461f-4cec-aa03-a2673e6d67fc@googlegroups.com>

Hi,

With the help of the guys at MassTransit Project<http://masstransit-project.com/>we have created a system that leverages the power of RabbitMQ to create an 
ESB in our staging environment. We are now in the processes of final 
testing and have hit a small snag.

One of the key decision makers in the company is worried about deploying 
RabbitMQ onto our production servers due to its reliance on Erlang and 
possible reliance on Java. (we are a predominantly Microsoft house).

So my questions are twofold.

   - Does RabbitMQ rely on Java? 
      - With VMWare's purchase 
      <http://www.vmware.com/company/news/releases/spring-rabbitmq.html>of 
      RabbitMQ are there future plans to only ship a vFabric 
      <http://pubs.vmware.com/vfabric5/index.jsp?topic=/com.vmware.vfabric.rabbitmq.2.4/install.html>like 
      version of RabbitMQ that would require Java or are the plans to remain Java 
      free for the forseable future?
   - What security risks (if any) are there when running Erlang and 
   RabbitMQ on a Windows server

Thanks in advance for the help.
Brendan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130623/99dc06c7/attachment.htm>

From alexis at rabbitmq.com  Mon Jun 24 07:42:09 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 24 Jun 2013 07:42:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ reliance on Java Virtual Machine
In-Reply-To: <5d2a82d9-461f-4cec-aa03-a2673e6d67fc@googlegroups.com>
References: <5d2a82d9-461f-4cec-aa03-a2673e6d67fc@googlegroups.com>
Message-ID: <CACOPnvdtBPbTwwjR7-Yz7+SsVkeJ27-fJTWEiiOVs32Qb9q-Jg@mail.gmail.com>

Brendan,

Rabbit does not rely on Java and there are no plans to change this.
There are JVM based clients of course, but those are not required for
.NET-only use cases.

I'll leave the security qn for someone else to answer.

alexis



On Mon, Jun 24, 2013 at 6:41 AM, Brendan Fry <bfry at fryhard.com> wrote:
> Hi,
>
> With the help of the guys at MassTransit Project we have created a system
> that leverages the power of RabbitMQ to create an ESB in our staging
> environment. We are now in the processes of final testing and have hit a
> small snag.
>
> One of the key decision makers in the company is worried about deploying
> RabbitMQ onto our production servers due to its reliance on Erlang and
> possible reliance on Java. (we are a predominantly Microsoft house).
>
> So my questions are twofold.
>
> Does RabbitMQ rely on Java?
>
> With VMWare's purchase of RabbitMQ are there future plans to only ship a
> vFabric like version of RabbitMQ that would require Java or are the plans to
> remain Java free for the forseable future?
>
> What security risks (if any) are there when running Erlang and RabbitMQ on a
> Windows server
>
> Thanks in advance for the help.
> Brendan
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bfry at fryhard.com  Mon Jun 24 08:08:31 2013
From: bfry at fryhard.com (Brendan Fry)
Date: Mon, 24 Jun 2013 00:08:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ reliance on Java Virtual Machine
In-Reply-To: <CACOPnvdtBPbTwwjR7-Yz7+SsVkeJ27-fJTWEiiOVs32Qb9q-Jg@mail.gmail.com>
References: <5d2a82d9-461f-4cec-aa03-a2673e6d67fc@googlegroups.com>
	<CACOPnvdtBPbTwwjR7-Yz7+SsVkeJ27-fJTWEiiOVs32Qb9q-Jg@mail.gmail.com>
Message-ID: <dc0f6e3b-e459-4d09-9e99-34b29fa24eeb@googlegroups.com>

Thanks for the info Alexis.

We know about JVM based clients, so are just trying to ease the minds of 
the decision makers before we *accidentally* bring down the live 
environment with a Java update. :P

Looking forward to the discussions about Erlang security on Windows, since 
it is something that we know very little about.

Cheers
Brendan

On Monday, 24 June 2013 08:42:09 UTC+2, Alexis Richardson wrote:
>
> Brendan, 
>
> Rabbit does not rely on Java and there are no plans to change this. 
> There are JVM based clients of course, but those are not required for 
> .NET-only use cases. 
>
> I'll leave the security qn for someone else to answer. 
>
> alexis 
>
>
>
> On Mon, Jun 24, 2013 at 6:41 AM, Brendan Fry <bf... at fryhard.com<javascript:>> 
> wrote: 
> > Hi, 
> > 
> > With the help of the guys at MassTransit Project we have created a 
> system 
> > that leverages the power of RabbitMQ to create an ESB in our staging 
> > environment. We are now in the processes of final testing and have hit a 
> > small snag. 
> > 
> > One of the key decision makers in the company is worried about deploying 
> > RabbitMQ onto our production servers due to its reliance on Erlang and 
> > possible reliance on Java. (we are a predominantly Microsoft house). 
> > 
> > So my questions are twofold. 
> > 
> > Does RabbitMQ rely on Java? 
> > 
> > With VMWare's purchase of RabbitMQ are there future plans to only ship a 
> > vFabric like version of RabbitMQ that would require Java or are the 
> plans to 
> > remain Java free for the forseable future? 
> > 
> > What security risks (if any) are there when running Erlang and RabbitMQ 
> on a 
> > Windows server 
> > 
> > Thanks in advance for the help. 
> > Brendan 
> > 
> > 
> > 
> > _______________________________________________ 
> > rabbitmq-discuss mailing list 
> > rabbitmq... at lists.rabbitmq.com <javascript:> 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
> > 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/cca8a02a/attachment.htm>

From bfry at fryhard.com  Mon Jun 24 08:08:31 2013
From: bfry at fryhard.com (Brendan Fry)
Date: Mon, 24 Jun 2013 00:08:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ reliance on Java Virtual Machine
In-Reply-To: <CACOPnvdtBPbTwwjR7-Yz7+SsVkeJ27-fJTWEiiOVs32Qb9q-Jg@mail.gmail.com>
References: <5d2a82d9-461f-4cec-aa03-a2673e6d67fc@googlegroups.com>
	<CACOPnvdtBPbTwwjR7-Yz7+SsVkeJ27-fJTWEiiOVs32Qb9q-Jg@mail.gmail.com>
Message-ID: <dc0f6e3b-e459-4d09-9e99-34b29fa24eeb@googlegroups.com>

Thanks for the info Alexis.

We know about JVM based clients, so are just trying to ease the minds of 
the decision makers before we *accidentally* bring down the live 
environment with a Java update. :P

Looking forward to the discussions about Erlang security on Windows, since 
it is something that we know very little about.

Cheers
Brendan

On Monday, 24 June 2013 08:42:09 UTC+2, Alexis Richardson wrote:
>
> Brendan, 
>
> Rabbit does not rely on Java and there are no plans to change this. 
> There are JVM based clients of course, but those are not required for 
> .NET-only use cases. 
>
> I'll leave the security qn for someone else to answer. 
>
> alexis 
>
>
>
> On Mon, Jun 24, 2013 at 6:41 AM, Brendan Fry <bf... at fryhard.com<javascript:>> 
> wrote: 
> > Hi, 
> > 
> > With the help of the guys at MassTransit Project we have created a 
> system 
> > that leverages the power of RabbitMQ to create an ESB in our staging 
> > environment. We are now in the processes of final testing and have hit a 
> > small snag. 
> > 
> > One of the key decision makers in the company is worried about deploying 
> > RabbitMQ onto our production servers due to its reliance on Erlang and 
> > possible reliance on Java. (we are a predominantly Microsoft house). 
> > 
> > So my questions are twofold. 
> > 
> > Does RabbitMQ rely on Java? 
> > 
> > With VMWare's purchase of RabbitMQ are there future plans to only ship a 
> > vFabric like version of RabbitMQ that would require Java or are the 
> plans to 
> > remain Java free for the forseable future? 
> > 
> > What security risks (if any) are there when running Erlang and RabbitMQ 
> on a 
> > Windows server 
> > 
> > Thanks in advance for the help. 
> > Brendan 
> > 
> > 
> > 
> > _______________________________________________ 
> > rabbitmq-discuss mailing list 
> > rabbitmq... at lists.rabbitmq.com <javascript:> 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
> > 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/cca8a02a/attachment-0001.htm>

From David.Legg at smithelectric.com  Mon Jun 24 09:49:06 2013
From: David.Legg at smithelectric.com (David Legg)
Date: Mon, 24 Jun 2013 03:49:06 -0500
Subject: [rabbitmq-discuss] Multiple Bindings to the Default Exchange
In-Reply-To: <CDE8C8EE.9775%david.legg@smithelectric.com>
Message-ID: <CDEDC540.982D%david.legg@smithelectric.com>

OK, so no opinions there.

Things are somewhat complicated because there are external publishers which I cannot change that publish to the default queue with the queue name as the routing key. If they were publishing to the direct exchange I could bind another queue with the same routing key and route messages to two queues. Is there any possible way of doing this with the default exchange as I haven't found one so far?


From: David Legg <david.legg at smithelectric.com<mailto:david.legg at smithelectric.com>>
Date: Thursday, 20 June 2013 14:57
To: "rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>" <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Using Shovel to Copy Messages for Testing

Hi All,

I'd like to get everyone's opinion on how best to do something.

At the moment I have a requirement to copy messages verbatim from a queue on a RabbitMQ server to another, primarily for testing and troubleshooting purposes. The messages on the original RabbitMQ server must remain intact and copied before any other consumer running on the queue deals with and acknowledges them. I'm looking at the Shovel plugin at the moment to do this, but can anyone see any pitfalls?

Thanks in advance,

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/805dd9f1/attachment.htm>

From ankit.ag2010 at gmail.com  Mon Jun 24 07:12:52 2013
From: ankit.ag2010 at gmail.com (Ankit Agarwal)
Date: Sun, 23 Jun 2013 23:12:52 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
Message-ID: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>


 I have recently upgraded logstash version from 2.8.4.It was performing 
very well with my setup.

 I am using logstash to ship logs to RabbitMQ.

 After upgrading to 3.1.1.I have started facing closed connection issues on 
logstash.

Logstash throws these errors:-

{:message=>"AMQP connection error (during connect), will reconnect", 
:exception=>#<Bunny::ServerDownError: Connection refused - Connection 
refused>, 
:backtrace=>["jar:file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/gems/bunny-0.8.0/lib/qrack/client.rb:226:in 
`socket'", 
"jar:file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/gems/bunny-0.8.0/lib/qrack/client.rb:222:in 
`socket'", 
"jar:file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/gems/bunny-0.8.0/lib/bunny/client.rb:295:in 
`start_session'", 
"file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/amqp.rb:94:in 
`connect'", 
"file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/amqp.rb:140:in 
`receive_raw'", 
"file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/amqp.rb:136:in 
`receive_raw'", 
"file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/amqp.rb:121:in 
`receive'", 
"file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/base.rb:55:in 
`handle'", 
"file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/agent.rb:758:in 
`run_output'", 
"file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/agent.rb:379:in 
`start_output'"], :level=>:error}

On the rabbitmq side i m getting these errors:-


=ERROR REPORT==== 24-Jun-2013::11:27:51 ===
AMQP connection <0.26481.237> (running), channel 1 - error:
{amqp_error,frame_error,
            "type 3, all octets = <<>>: {frame_too_large,1020815,131064}",
            none}

=ERROR REPORT==== 24-Jun-2013::11:27:54 ===
closing AMQP connection <0.26481.237> (172.16.0.60:53224 -> 
172.16.0.63:5672):
fatal_frame_error

As the AMQP connections are closing i need to restart logstash.All the 
reports for the day are hampering.

Please help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130623/fe93e52e/attachment.htm>

From dahalls at gmail.com  Mon Jun 24 08:29:20 2013
From: dahalls at gmail.com (David Halls)
Date: Mon, 24 Jun 2013 00:29:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Source to benchmark tests
Message-ID: <e1a13daa-0244-470a-a1fd-4e0a0488933c@googlegroups.com>

Hi-

In this article: 
http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routing-part-2/, 
a benchmark test for topic routing is mentioned. The article implies the 
test isn't a RabbitMQ system test, but drives the topic routing component.

I was wondering whether the source to this benchmark is available somewhere?

Reason for asking is I've converted the trie algorithm to Node.js (
https://github.com/davedoesdev/qlobber) and would like a good standalone 
benchmark to compare it against other routing algorithms.

Many thanks

David


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/93ee30b8/attachment.htm>

From emile at rabbitmq.com  Mon Jun 24 10:03:12 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 24 Jun 2013 10:03:12 +0100
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
Message-ID: <51C80B50.2090104@rabbitmq.com>


Hi,

On 24/06/13 07:12, Ankit Agarwal wrote:
> {frame_too_large,1020815,131064}",

The error is that the frame is too large. See the "frame_max"
configuration item in http://www.rabbitmq.com/configure.html. Either set
it too a larger value or to 0 for unlimited.

The maximum frame size was not strictly enforced before v3.0.0, which is
why the issue appeared after upgrading. See item 24991 in
http://www.rabbitmq.com/release-notes/README-3.0.0.txt


-Emile



From michael.s.klishin at gmail.com  Mon Jun 24 10:30:57 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 24 Jun 2013 13:30:57 +0400
Subject: [rabbitmq-discuss] Multiple Bindings to the Default Exchange
In-Reply-To: <CDEDC540.982D%david.legg@smithelectric.com>
References: <CDE8C8EE.9775%david.legg@smithelectric.com>
	<CDEDC540.982D%david.legg@smithelectric.com>
Message-ID: <CAE3HoVSq+1KPXSZAO_UC9M5Q05P57Wy5XBLbFqphyU4Or8nKiQ@mail.gmail.com>

2013/6/24 David Legg <David.Legg at smithelectric.com>

> If they were publishing to the direct exchange I could bind another queue
> with the same routing key and route messages to two queues. Is there any
> possible way of doing this with the default exchange as I haven't found one
> so far?


The default exchange is a direct exchange.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/01187107/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jun 24 10:33:36 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 24 Jun 2013 13:33:36 +0400
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <51C80B50.2090104@rabbitmq.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
	<51C80B50.2090104@rabbitmq.com>
Message-ID: <CAE3HoVRYpDu=wP_FCo8_sKx5A--wKORgkSJLi-wwtQ7aVfF+Ow@mail.gmail.com>

2013/6/24 Emile Joubert <emile at rabbitmq.com>

> The error is that the frame is too large. See the "frame_max"
> configuration item in http://www.rabbitmq.com/configure.html. Either set
> it too a larger value or to 0 for unlimited.
>

Bunny 0.8 does not implement payload framing, so you cannot publish
messages over 128K in size over it.

Unfortunately, Logstash hits a JRuby bug with Bunny 0.9 (IO#select
implementation starts consuming 15-25% of CPU
after a few minutes), so they can't use the newer version.

What they need to do is to use HotBunnies (http://hotbunnies.info).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/c20b5357/attachment.htm>

From David.Legg at smithelectric.com  Mon Jun 24 10:43:15 2013
From: David.Legg at smithelectric.com (David Legg)
Date: Mon, 24 Jun 2013 04:43:15 -0500
Subject: [rabbitmq-discuss] Multiple Bindings to the Default Exchange
In-Reply-To: <CAE3HoVSq+1KPXSZAO_UC9M5Q05P57Wy5XBLbFqphyU4Or8nKiQ@mail.gmail.com>
Message-ID: <CDEDD2BE.9840%david.legg@smithelectric.com>

Yes, I know it's direct. What I want is to bind the same routing key to it in the same way as other exchanges and distribute to multiple queues.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/d62fb810/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jun 24 11:04:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 24 Jun 2013 14:04:18 +0400
Subject: [rabbitmq-discuss] Multiple Bindings to the Default Exchange
In-Reply-To: <CDEDD2BE.9840%david.legg@smithelectric.com>
References: <CAE3HoVSq+1KPXSZAO_UC9M5Q05P57Wy5XBLbFqphyU4Or8nKiQ@mail.gmail.com>
	<CDEDD2BE.9840%david.legg@smithelectric.com>
Message-ID: <CAE3HoVShoaTS_YMYyuK-ue300ocXZscwLWFgG1ROB0CroQk+kw@mail.gmail.com>

2013/6/24 David Legg <David.Legg at smithelectric.com>

> What I want is to bind the same routing key to it in the same way as other
> exchanges and distribute to multiple queues


You should be able to do anything you can do with a direct exchange.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/cd1c81cf/attachment.htm>

From simon at rabbitmq.com  Mon Jun 24 11:06:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 24 Jun 2013 11:06:58 +0100
Subject: [rabbitmq-discuss] Request: Enable/Disable Firehose via
 Management API
In-Reply-To: <c4df24f5-f9b9-4095-810c-79283bc53a7c@googlegroups.com>
References: <c4df24f5-f9b9-4095-810c-79283bc53a7c@googlegroups.com>
Message-ID: <51C81A42.8070209@rabbitmq.com>

On 21/06/13 20:56, austinnichols wrote:
> It sure would be nice to get trace_on/off as part of the management API...

Oh wow, I really thought it was already there. I'll file a bug.

As a workaround you could force it on by installing rabbitmq_tracing, 
and then using the rabbitmq_tracing HTTP API to set up logging for a 
pattern that will never match.

Cheers, Simon

> Who do I need to buy a beer for?

Me. Thanks!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 24 11:11:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 24 Jun 2013 11:11:46 +0100
Subject: [rabbitmq-discuss] Multiple Bindings to the Default Exchange
In-Reply-To: <CAE3HoVShoaTS_YMYyuK-ue300ocXZscwLWFgG1ROB0CroQk+kw@mail.gmail.com>
References: <CAE3HoVSq+1KPXSZAO_UC9M5Q05P57Wy5XBLbFqphyU4Or8nKiQ@mail.gmail.com>
	<CDEDD2BE.9840%david.legg@smithelectric.com>
	<CAE3HoVShoaTS_YMYyuK-ue300ocXZscwLWFgG1ROB0CroQk+kw@mail.gmail.com>
Message-ID: <51C81B62.4060407@rabbitmq.com>

On 24/06/13 11:04, Michael Klishin wrote:
> 2013/6/24 David Legg <David.Legg at smithelectric.com
> <mailto:David.Legg at smithelectric.com>>
>
>     What I want is to bind the same routing key to it in the same way as
>     other exchanges and distribute to multiple queues
>
>
> You should be able to do anything you can do with a direct exchange.

That's not correct if the direct exchange in question is the default 
exchange - the default exchange is quite a lot more magical than other 
direct exchanges. Really it can be thought of as a way to express 
"publish to queue" in an API which assumes publishing to exchanges.

So to the OP, I'm afraid you can't do that.

The best you can do would be use the firehose 
http://www.rabbitmq.com/firehose.html to grab the messages as they are 
published. But that will rewrite message headers (not bodies). Other 
than that you'd need to modify the publisher.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jun 24 12:13:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 24 Jun 2013 12:13:41 +0100
Subject: [rabbitmq-discuss] Source to benchmark tests
In-Reply-To: <e1a13daa-0244-470a-a1fd-4e0a0488933c@googlegroups.com>
References: <e1a13daa-0244-470a-a1fd-4e0a0488933c@googlegroups.com>
Message-ID: <51C829E5.5010102@rabbitmq.com>

On 24/06/13 08:29, David Halls wrote:
> Hi-
>
> In this article:
> http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routing-part-2/,
> a benchmark test for topic routing is mentioned. The article implies the
> test isn't a RabbitMQ system test, but drives the topic routing component.
>
> I was wondering whether the source to this benchmark is available somewhere?

I'm not sure it is, I'm afraid. I think it may have been lost.

Cheers, Simon

> Reason for asking is I've converted the trie algorithm to Node.js
> (https://github.com/davedoesdev/qlobber) and would like a good
> standalone benchmark to compare it against other routing algorithms.
>
> Many thanks
>
> David
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From tim at rabbitmq.com  Mon Jun 24 13:55:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 24 Jun 2013 13:55:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.2 release
Message-ID: <E22521DC-DCFC-459A-8BBC-28898400DE99@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ
3.1.2.

This release fixes a number of bugs.

See the attached release notes for more details.

Binary and source distributions of the new release can be found in the
usual place at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.

Regards,
        The RabbitMQ Team

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/680c8691/attachment.htm>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-3.1.2.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/680c8691/attachment.txt>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/680c8691/attachment-0001.htm>

From David.Legg at smithelectric.com  Mon Jun 24 14:35:06 2013
From: David.Legg at smithelectric.com (David Legg)
Date: Mon, 24 Jun 2013 08:35:06 -0500
Subject: [rabbitmq-discuss] Multiple Bindings to the Default Exchange
In-Reply-To: <51C81B62.4060407@rabbitmq.com>
Message-ID: <CDEDEBF4.984D%david.legg@smithelectric.com>

Yer, I thought so. Thanks Simon.


Yes, it is the default exchange I'm talking about. You can't just
arbitrarily bind a queue to the default exchange with a routing key like
you can with others. Alas, changing the publishers is not going to be
possible right now.

Firehose looks like the only way I'll be able to approach this.


On 24/06/2013 11:11, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>That's not correct if the direct exchange in question is the default
>exchange - the default exchange is quite a lot more magical than other
>direct exchanges. Really it can be thought of as a way to express
>"publish to queue" in an API which assumes publishing to exchanges.
>
>So to the OP, I'm afraid you can't do that.
>
>The best you can do would be use the firehose
>http://www.rabbitmq.com/firehose.html to grab the messages as they are
>published. But that will rewrite message headers (not bodies). Other
>than that you'd need to modify the publisher.
>
>Cheers, Simon
>
>-- 
>Simon MacMullen
>RabbitMQ, Pivotal


From simon at rabbitmq.com  Mon Jun 24 15:20:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 24 Jun 2013 15:20:07 +0100
Subject: [rabbitmq-discuss] Simultaneous Scalability and HA
In-Reply-To: <CA+RG7Xk4RUPhg7yw2HwTHQCXJcHh4VRfrkBdtPwdxM6FVEzDdA@mail.gmail.com>
References: <434df67e-9239-4827-9c1a-aa86eda9ab35@googlegroups.com>
	<5F673FAD-E0F5-42F3-AEE7-C3EFA27FCBA5@rabbitmq.com>
	<51C42CBB.6010800@rabbitmq.com> <51C42DF1.6000302@rabbitmq.com>
	<CA+RG7Xk4RUPhg7yw2HwTHQCXJcHh4VRfrkBdtPwdxM6FVEzDdA@mail.gmail.com>
Message-ID: <51C85597.8090009@rabbitmq.com>

As Matthias suggested, the "exactly" or "nodes" policies are likely to 
be what you're looking for.

Cheers, Simon

On 24/06/13 06:38, Hudson Jiang wrote:
> Hi Simon,
>
> I really appreciate your reply! However, I still cannot get how should I
> configure my RabbitMQ brokers to achieve both scalability and HA. Could
> you elaborate?
>
>
> Best regards,
> Hudson
>
>
>
> On Fri, Jun 21, 2013 at 6:41 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 21/06/13 11:36, Matthias Radestock wrote:
>
>         NB: RabbitMQ in Action predates the introduction of
>         server-configured
>         policies; the x-ha-policy queue parameter does nothing in modern
>         rabbits. See the above docs for the new way of configuring HA.
>
>
>     Which is probably why it recommends "all" mode. Prior to 3.0.0,
>     "exactly" mode didn't exist, and "nodes" mode meant you baked
>     knowledge of your cluster into your queues, which tended to be very
>     awkward.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From maze at reik.se  Mon Jun 24 16:36:09 2013
From: maze at reik.se (Matthias Reik)
Date: Mon, 24 Jun 2013 17:36:09 +0200
Subject: [rabbitmq-discuss] Multiple Bindings to the Default Exchange
In-Reply-To: <CDEDEBF4.984D%david.legg@smithelectric.com>
References: <CDEDEBF4.984D%david.legg@smithelectric.com>
Message-ID: <51C86769.6040903@reik.se>

Sticking out my head here, but ...

... if you can't change your publishers, can you change your consumers?
If so, can't you reroute your messages from the default exchange to 
another exchange
and do the processing then against that other exchange?

Cheers
Maze


On 2013-06-24 15:35 , David Legg wrote:
> Yer, I thought so. Thanks Simon.
>
>
> Yes, it is the default exchange I'm talking about. You can't just
> arbitrarily bind a queue to the default exchange with a routing key like
> you can with others. Alas, changing the publishers is not going to be
> possible right now.
>
> Firehose looks like the only way I'll be able to approach this.
>
>
> On 24/06/2013 11:11, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>> That's not correct if the direct exchange in question is the default
>> exchange - the default exchange is quite a lot more magical than other
>> direct exchanges. Really it can be thought of as a way to express
>> "publish to queue" in an API which assumes publishing to exchanges.
>>
>> So to the OP, I'm afraid you can't do that.
>>
>> The best you can do would be use the firehose
>> http://www.rabbitmq.com/firehose.html to grab the messages as they are
>> published. But that will rewrite message headers (not bodies). Other
>> than that you'd need to modify the publisher.
>>
>> Cheers, Simon
>>
>> -- 
>> Simon MacMullen
>> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From vashi.priyanki at gmail.com  Mon Jun 24 16:55:30 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Mon, 24 Jun 2013 17:55:30 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
Message-ID: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>

Hi there,

I am doing a performance study of RabbitMQ-3.1.1 and this is my first time
to do such a performance study with any messaging broker :))-

1) I have thoroughly gone through rabbitMQ in action' and learnt important
concepts.

2) Tried single node broker to get a feel of how it is working and then set
up a four node cluster (with two disk and two RAM type of node). Also
configured HAproxy TCP Load balancer so that I can just provide single port
to connect to the Cluster.

3) I am simulating producer and consumers through Python scripts ( using
Python-pika library methods to connect to server , publish subscribe etc.)

4) My scripts are working fine but where I am stuck is no matter what I do
my throughout is always 300 msg/sec.

5) I have defines durable exchanges and queues

My final requirement is to run atleast 10 to 15 producer and 60 to 70
consumer simultaneously and I want to start with linear increase in number
of producer and consumer so that I can make conclusions about  throughout,
fault handling, processor utilization etc. etc but I am seriously stuck now
after trying to start in initial steps only. This group's help would be
really appreciated.

I have started with following different scenarios but no matter what I do
my throughput is more or less remaining same (300 msg/sec) except for
Scenario-1

Scenario-1
-1 producer and No consumer and no queue binded to exchange
-Producer is running in infinite loop and publishing to one fanout exchange
- publisher/confirm disabled
-Publisher rate - 6200 msg/sec ( checked through web management plugin)

Tried scenario-1 with also fanout type of exchange and it's the same
publish rate
I know that Scenario-1 is not really useful, since there are no queues and
ultimately messages will be dropped but as a part of debugging process I
tried this and I see above mentioned results.

Scenario-2
-1 producer and 1 consumer
-Producer is running in infinite loop and publishing to one direct exchange
-A consumer has it's own dedicated queue and listening to above exchange
- publisher/confirm and consumer ack are disabled
Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec
and deliver rate - 300 msg/sec)

Tried Scenario-2 also with fanout type of exchange and enabling publisher
confirm and consumer ack
Still the same throughput as 300 msg/sec

Scenario-3
-1 producer and 4 consumer
-Producer is running in infinite loop and publishing to four direct exchange
-A consumer has it's own dedicated queue and listening to respective
exchange
- publisher/confirm and consumer ack are disabled
Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec
and deliver rate - 300 msg/sec)

Tried Scenario-3 also with fanout type of exchange and enabling publisher
confirm and consumer ack
Still the same throughput as 300 msg/sec

Tried configuring prefetch_count parameters also to 100 but it still gives
me same throughput of 300 msg/sec.
I am honestly going crazy with this.

After seeing this behavior, I am seriously suspecting that there is some
serious limitation with my simulated producers and consumers.
Has anyone else has tried Python-pika client and any idea on throughput
with this version of rabbit ?
Did anyone have rough idea about throughout with rabbitMQ-3.1.1 ?

I can also share my python scripts if required but I would really
appreciate some light on this situation
Also what points to take care, in order to improve throughput ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/9f4f74d9/attachment.htm>

From mnelson at steele-forge.com  Mon Jun 24 18:20:17 2013
From: mnelson at steele-forge.com (Morgan Nelson)
Date: Mon, 24 Jun 2013 12:20:17 -0500
Subject: [rabbitmq-discuss] Rabbit 3.1.1 crash question
In-Reply-To: <51C55FA2.9070407@rabbitmq.com>
References: <CAFAX_jw5FGSbXnXm6rGzJZPWZaw4pUMaOROOFRpzp3yB1Ep7Sw@mail.gmail.com>
	<51C4D4D4.6050509@rabbitmq.com>
	<CAFAX_jwm6FPifT-2a4Tg5LR9hZiJi77Lhaa+M88CzoZkBqUXWw@mail.gmail.com>
	<51C55FA2.9070407@rabbitmq.com>
Message-ID: <CAFAX_jya=w6VgP5kyNWC5sepiyntBJgvjoB_aw=PNvfRbbQOLw@mail.gmail.com>

Matthias,

    I see the 3.1.2 release came out this morning, and that this fix made
it it.  Thanks for the super quick turn-around on this, we'll be pushing to
production as soon as our QA approves, and will have full load on it by
tomorrow.

    I'll let you know if we see anything odd, but I don't expect to.
 Thanks again!

Morgan


On Sat, Jun 22, 2013 at 3:26 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Morgan,
>
>
> On 22/06/13 03:30, Morgan Nelson wrote:
>
>>      In the mean time, is there anything I/we can do to help resolve
>> this issue?
>>
>
> The fix is a two line change, which I committed last night (
> http://hg.rabbitmq.com/**rabbitmq-server/rev/**a19209f57363<http://hg.rabbitmq.com/rabbitmq-server/rev/a19209f57363>).
> Hopefully this will make it into the upcoming 3.1.2 release.
>
> Matthias.
>



-- 
Morgan Nelson
Software Acolyte
(214) 392-6483
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/9b126e78/attachment.htm>

From mnelson at steele-forge.com  Tue Jun 25 02:48:08 2013
From: mnelson at steele-forge.com (Morgan Nelson)
Date: Mon, 24 Jun 2013 20:48:08 -0500
Subject: [rabbitmq-discuss] Rabbit 3.1.1 crash question
In-Reply-To: <CAFAX_jya=w6VgP5kyNWC5sepiyntBJgvjoB_aw=PNvfRbbQOLw@mail.gmail.com>
References: <CAFAX_jw5FGSbXnXm6rGzJZPWZaw4pUMaOROOFRpzp3yB1Ep7Sw@mail.gmail.com>
	<51C4D4D4.6050509@rabbitmq.com>
	<CAFAX_jwm6FPifT-2a4Tg5LR9hZiJi77Lhaa+M88CzoZkBqUXWw@mail.gmail.com>
	<51C55FA2.9070407@rabbitmq.com>
	<CAFAX_jya=w6VgP5kyNWC5sepiyntBJgvjoB_aw=PNvfRbbQOLw@mail.gmail.com>
Message-ID: <CAFAX_jwA1dkkcQSr3dUeUm-xg4pqTEzbMHxjGvppbx-s4NtJ3g@mail.gmail.com>

So we've had 3.1.2 in production for several hours now, and when I look at
our throughput in the management module, the messages per second number
seems a little high.  Like two orders of magnitude high.  Here's a screen
shot:


https://www.evernote.com/shard/s11/sh/c24edac3-bc98-414b-8ce8-21bae937c4c7/1cb4d01dd79c22c7a5d648eb86ee108c/deep/0/Screenshot%206/24/13%208:19%20PM.png

When I looked at the throughput late last Friday afternoon, it was showing
between 750 and 1200 publishes a second, the above image is showing between
50,000 and 150,000 publishes per second, with acks at between 100,000 and
250,000 per second.  This doesn't seem right.

Now, I don't have any screenshots from before 3.1.2 showing messages *per
second* so it _might_ be right, but I'd like another set of eyes on this,
please.


Morgan


On Mon, Jun 24, 2013 at 12:20 PM, Morgan Nelson <mnelson at steele-forge.com>wrote:

> Matthias,
>
>     I see the 3.1.2 release came out this morning, and that this fix made
> it it.  Thanks for the super quick turn-around on this, we'll be pushing to
> production as soon as our QA approves, and will have full load on it by
> tomorrow.
>
>     I'll let you know if we see anything odd, but I don't expect to.
>  Thanks again!
>
> Morgan
>
>
> On Sat, Jun 22, 2013 at 3:26 AM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> Morgan,
>>
>>
>> On 22/06/13 03:30, Morgan Nelson wrote:
>>
>>>      In the mean time, is there anything I/we can do to help resolve
>>> this issue?
>>>
>>
>> The fix is a two line change, which I committed last night (
>> http://hg.rabbitmq.com/**rabbitmq-server/rev/**a19209f57363<http://hg.rabbitmq.com/rabbitmq-server/rev/a19209f57363>).
>> Hopefully this will make it into the upcoming 3.1.2 release.
>>
>> Matthias.
>>
>
>
>
> --
> Morgan Nelson
> Software Acolyte
> (214) 392-6483
>



-- 
Morgan Nelson
Software Acolyte
(214) 392-6483
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/ba64a226/attachment.htm>

From arunprakashl at gmail.com  Mon Jun 24 20:46:25 2013
From: arunprakashl at gmail.com (tenyks)
Date: Mon, 24 Jun 2013 12:46:25 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmqctl status hangs until I kill all
 erlang/erts-5.8.5/bin/beam processes
Message-ID: <5cecd298-5fb0-4d25-8689-10fe0653cc6d@googlegroups.com>

Hi,

Sometimes I notice on my rabbitmq node that 'rabbitmqctl status' hangs 
without any response. When I do a ps aux | grep erl, I find multiple 
instances of the beam process running. Once I kill all these beam 
processes, and start rabbitmq, it starts up properly. This behavior seems 
to be transient. Has anyone noticed this or know the root cause ?



rabbitmq 13641  0.0  0.4  31236  9328 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13641 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13642  0.0  0.4  31236  9212 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13642 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13644  0.0  0.4  31236  8536 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13644 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13645  0.0  0.4  31236  8880 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13645 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13646  0.0  0.4  31236  9328 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13646 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13648  0.0  0.4  31236  9192 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13648 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13649  0.0  0.4  31236  9324 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13649 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13650  0.0  0.4  31236  9336 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13650 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13651  0.0  0.4  31236  9092 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13651 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid

rabbitmq 13653  0.0  0.4  31236  8548 ?        Ss   18:55   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang -progname 
erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../ebin -noshell -noinput 
-hidden -name rabbitmqctl13653 -s rabbit_control_main -nodename 
rabbit at mqnode -extra wait /var/run/rabbitmq/pid
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/4ac52934/attachment.htm>

From lrodriguez1995 at yahoo.com  Tue Jun 25 01:50:02 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Mon, 24 Jun 2013 17:50:02 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq clustering issues
Message-ID: <1372121402.97283.YahooMailNeo@web141103.mail.bf1.yahoo.com>

Hi all,
I am a newbie trying rabbitmq.
my setup is the following:
running a windows host with three virtual machines running centos 5.9 and have them in a host only network.
I have rabbitmq server 3.0.3 installed in all three vm's along with erlang (named the nodes rabbit1 at localhost,rabbit2 at localhost,rabbit3 at localhost)
I also have added an init.d script (pic 4) that starts rabbitmq when the node starts.
After reading the tutorials, I was able to make the three separate vm's work. (created a java application to test them and works fine). The problems started when I tried to cluster the three nodes.
I understand you need to make sure your chosen erlang cookie is copied to all the nodes that will be in the cluster so I made sure of that as well.
I get the expected results when I do?rabbitmq-server -detached ,rabbitmqctl cluster_status.(shown in the second picture) on the three nodes
but when I try to join a cluster, I get: Error: Cannot discover cluster."the nodes provided are either offline or not running". (same thing for the other two)
I am not exactly sure what I'm missing (I also have no idea how to change the status of my node in the Rabbitmq_management from disc to connected)
Pleease help!!!
I have added more pics to hopefuly make it easier to pinpoint what I'm doing wrong.
Any help will be greatly appreciated..:)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/9a371116/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 1.png
Type: image/png
Size: 17491 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/9a371116/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2.png
Type: image/png
Size: 164991 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/9a371116/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 3.png
Type: image/png
Size: 182018 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/9a371116/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 4.png
Type: image/png
Size: 211884 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/9a371116/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 5.png
Type: image/png
Size: 81891 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130624/9a371116/attachment-0004.png>

From jeremy at fluxlabs.net  Tue Jun 25 07:23:03 2013
From: jeremy at fluxlabs.net (Jeremy McSpadden)
Date: Tue, 25 Jun 2013 06:23:03 +0000
Subject: [rabbitmq-discuss] rabbitmq clustering issues
In-Reply-To: <1372121402.97283.YahooMailNeo@web141103.mail.bf1.yahoo.com>
References: <1372121402.97283.YahooMailNeo@web141103.mail.bf1.yahoo.com>
Message-ID: <C9FA8E55-4D37-4B14-9C9C-1B6885D3F9BA@fluxlabs.net>

Add rabbit1,2,3 to hosts file and set IPs accordingly.

--
Jeremy McSpadden
Flux Labs, Inc | http://www.fluxlabs.net<http://www.fluxlabs.net/> | Endless Solutions
Office : 850-250-5590x101<tel:850-250-5590;101> | Cell : 850-890-2543<tel:850-890-2543> | Fax : 850-254-2955<tel:850-254-2955>

On Jun 25, 2013, at 1:18 AM, "Luis Rodriguez" <lrodriguez1995 at yahoo.com<mailto:lrodriguez1995 at yahoo.com>> wrote:

Hi all,
I am a newbie trying rabbitmq.
my setup is the following:
running a windows host with three virtual machines running centos 5.9 and have them in a host only network.
I have rabbitmq server 3.0.3 installed in all three vm's along with erlang (named the nodes rabbit1 at localhost,rabbit2 at localhost,rabbit3 at localhost)
I also have added an init.d script (pic 4) that starts rabbitmq when the node starts.
After reading the tutorials, I was able to make the three separate vm's work. (created a java application to test them and works fine). The problems started when I tried to cluster the three nodes.
I understand you need to make sure your chosen erlang cookie is copied to all the nodes that will be in the cluster so I made sure of that as well.
I get the expected results when I do rabbitmq-server -detached ,rabbitmqctl cluster_status.(shown in the second picture) on the three nodes
but when I try to join a cluster, I get: Error: Cannot discover cluster."the nodes provided are either offline or not running". (same thing for the other two)
I am not exactly sure what I'm missing (I also have no idea how to change the status of my node in the Rabbitmq_management from disc to connected)
Pleease help!!!
I have added more pics to hopefuly make it easier to pinpoint what I'm doing wrong.
Any help will be greatly appreciated..:)


<1.png>
<2.png>
<3.png>
<4.png>
<5.png>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/2da1fabc/attachment.htm>

From taihock at gmail.com  Tue Jun 25 07:28:00 2013
From: taihock at gmail.com (thomas)
Date: Mon, 24 Jun 2013 23:28:00 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ's Mirroring results in weird behavior
	when slave goes down
Message-ID: <1372141680170-27572.post@n5.nabble.com>

I have set up 3 cluster nodes namely rabbit at A, rabbit at B, rabbit at C all running
on erlang 16B and rabbitmq 3.1.1. I set net_ticktime to 2 so as to detect
node failure faster.

I have did some test on it and found that there seems to be a weird behavior
when setting policy for mirroring.
For the purpose of testing, I modified the code for the java tutorial 1
hello world to send out 200,000 messages instead of 1 and also the queue is
created using the management console and not created in the code. Each time
it sends a message it will print out the current number starting from 1 til
199,999

Below is what I did:

1)For my 1st test, I only added a queue for the sending of messages which I
call it "test". Throughout this test rabbit at A is the master. Halfway into
sending the messages i will cut off the network connection for rabbit at B. The
observation is that there is no disruption to the master. The result is
consistent for 10 tries.

2)For my 2nd test, it is almost identical to the 1st test except that i am
using mirroring using the following command:

rabbitmqctl set_policy HA '^(?!amq\.).*' '{"ha-mode": "all"}'"

The observation is different from that of the 1st test. Shortly after I cut
off the network connection from rabbit at B, rabbit at A which is the master
handling the client's messages comes to a pause for over 15 seconds and the
pause is consistent for 10 tries. The client gets stuck in basic publish
when rabbit at A comes to a pause.



I am quite puzzled about this behavior and would like to find out if that is
the intended behavior for rabbit's mirroring feature? Does anyone else
encounter such behavior when using mirroring? 

I have attached my code for sending messages. Thanks.
send.txt <http://rabbitmq.1065348.n5.nabble.com/file/n27572/send.txt>  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-s-Mirroring-results-in-weird-behavior-when-slave-goes-down-tp27572.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From vashi.priyanki at gmail.com  Tue Jun 25 08:44:00 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Tue, 25 Jun 2013 00:44:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
 single node as well as cluster
Message-ID: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>

Hi there,

I am doing a performance study of RabbitMQ-3.1.1 and this is my first time 
to do such a performance study with any messaging broker :))-

1) I have thoroughly gone through rabbitMQ in action' and learnt important 
concepts. 

2) Tried single node broker to get a feel of how it is working and then set 
up a four node cluster (with two disk and two RAM type of node). Also 
configured HAproxy TCP Load balancer so that I can just provide single port 
to connect to the Cluster.

3) I am simulating producer and consumers through Python scripts ( using 
Python-pika library methods to connect to server , publish subscribe etc.)

4) My scripts are working fine but where I am stuck is no matter what I do 
my throughout is always 300 msg/sec. 

5) I have defines durable exchanges and queues

My final requirement is to run atleast 10 to 15 producer and 60 to 70 
consumer simultaneously and I want to start with linear increase in number 
of producer and consumer so that I can make conclusions about  throughout, 
fault handling, processor utilization etc. etc but I am seriously stuck now 
after trying to start in initial steps only. This group's help would be 
really appreciated. 

I have started with following different scenarios but no matter what I do 
my throughput is more or less remaining same (300 msg/sec) except for 
Scenario-1

Scenario-1
-1 producer and No consumer and no queue binded to exchange
-Producer is running in infinite loop and publishing to one fanout exchange
- publisher/confirm disabled
-Publisher rate - 6200 msg/sec ( checked through web management plugin)

Tried scenario-1 with also fanout type of exchange and it's the same 
publish rate
I know that Scenario-1 is not really useful, since there are no queues and 
ultimately messages will be dropped but as a part of debugging process I 
tried this and I see above mentioned results.

Scenario-2
-1 producer and 1 consumer 
-Producer is running in infinite loop and publishing to one direct exchange
-A consumer has it's own dedicated queue and listening to above exchange 
- publisher/confirm and consumer ack are disabled
Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec 
and deliver rate - 300 msg/sec)

Tried Scenario-2 also with fanout type of exchange and enabling publisher 
confirm and consumer ack
Still the same throughput as 300 msg/sec

Scenario-3
-1 producer and 4 consumer 
-Producer is running in infinite loop and publishing to four direct exchange
-A consumer has it's own dedicated queue and listening to respective 
exchange 
- publisher/confirm and consumer ack are disabled
Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec 
and deliver rate - 300 msg/sec)

Tried Scenario-3 also with fanout type of exchange and enabling publisher 
confirm and consumer ack
Still the same throughput as 300 msg/sec

Tried configuring prefetch_count parameters also to 100 but it still gives 
me same throughput of 300 msg/sec.
I am honestly going crazy with this.

After seeing this behavior, I am seriously suspecting that there is some 
serious limitation with my simulated producers and consumers.
Has anyone else has tried Python-pika client and any idea on throughput 
with this version of rabbit ? 
Did anyone have rough idea about throughout with rabbitMQ-3.1.1 ?

I can also share my python scripts if required but I would really 
appreciate some light on this situation
Also what points to take care, in order to improve throughput ?

Best Regards,
Priyanki
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/cfa3ab92/attachment.htm>

From watson.timothy at gmail.com  Tue Jun 25 09:38:47 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 25 Jun 2013 09:38:47 +0100
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
	single node as well as cluster
In-Reply-To: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
Message-ID: <1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>

What does your publishing code look like? The figures below are expected in that the consumer can keep pace with the producer - it could hardly be expected to consume faster than messages are arriving in the queue(s). So the slowness is very likely on the producing side.

Are you using persistent messages and either publisher confirms or transactions? If so, how often are you waiting on confirms/commits?

With the official clients we typically see avg rates of 50 - 60Khz with non-persistent messages. Persistence slows things down a tad, as do confirms (and more so transactions) but even with persistent messages and confirms, rates >= 5Khz are expected. It /sounds/ like you might be publishing persistent messages with confirms enabled and waiting for a confirm (ack) from the broker for each message. That  involves disk I/O on the server for each message plus network latency, effectively making publishing synchronous (and very slow by comparison).

Cheers,
Tim

On 25 Jun 2013, at 08:44, Priyanki Vashi <vashi.priyanki at gmail.com> wrote:

> Hi there,
> 
> I am doing a performance study of RabbitMQ-3.1.1 and this is my first time to do such a performance study with any messaging broker :))-
> 
> 1) I have thoroughly gone through rabbitMQ in action' and learnt important concepts. 
> 
> 2) Tried single node broker to get a feel of how it is working and then set up a four node cluster (with two disk and two RAM type of node). Also configured HAproxy TCP Load balancer so that I can just provide single port to connect to the Cluster.
> 
> 3) I am simulating producer and consumers through Python scripts ( using Python-pika library methods to connect to server , publish subscribe etc.)
> 
> 4) My scripts are working fine but where I am stuck is no matter what I do my throughout is always 300 msg/sec. 
> 
> 5) I have defines durable exchanges and queues
> 
> My final requirement is to run atleast 10 to 15 producer and 60 to 70 consumer simultaneously and I want to start with linear increase in number of producer and consumer so that I can make conclusions about  throughout, fault handling, processor utilization etc. etc but I am seriously stuck now after trying to start in initial steps only. This group's help would be really appreciated. 
> 
> I have started with following different scenarios but no matter what I do my throughput is more or less remaining same (300 msg/sec) except for Scenario-1
> 
> Scenario-1
> -1 producer and No consumer and no queue binded to exchange
> -Producer is running in infinite loop and publishing to one fanout exchange
> - publisher/confirm disabled
> -Publisher rate - 6200 msg/sec ( checked through web management plugin)
> 
> Tried scenario-1 with also fanout type of exchange and it's the same publish rate
> I know that Scenario-1 is not really useful, since there are no queues and ultimately messages will be dropped but as a part of debugging process I tried this and I see above mentioned results.
> 
> Scenario-2
> -1 producer and 1 consumer 
> -Producer is running in infinite loop and publishing to one direct exchange
> -A consumer has it's own dedicated queue and listening to above exchange 
> - publisher/confirm and consumer ack are disabled
> Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec and deliver rate - 300 msg/sec)
> 
> Tried Scenario-2 also with fanout type of exchange and enabling publisher confirm and consumer ack
> Still the same throughput as 300 msg/sec
> 
> Scenario-3
> -1 producer and 4 consumer 
> -Producer is running in infinite loop and publishing to four direct exchange
> -A consumer has it's own dedicated queue and listening to respective exchange 
> - publisher/confirm and consumer ack are disabled
> Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec and deliver rate - 300 msg/sec)
> 
> Tried Scenario-3 also with fanout type of exchange and enabling publisher confirm and consumer ack
> Still the same throughput as 300 msg/sec
> 
> Tried configuring prefetch_count parameters also to 100 but it still gives me same throughput of 300 msg/sec.
> I am honestly going crazy with this.
> 
> After seeing this behavior, I am seriously suspecting that there is some serious limitation with my simulated producers and consumers.
> Has anyone else has tried Python-pika client and any idea on throughput with this version of rabbit ? 
> Did anyone have rough idea about throughout with rabbitMQ-3.1.1 ?
> 
> I can also share my python scripts if required but I would really appreciate some light on this situation
> Also what points to take care, in order to improve throughput ?
> 
> Best Regards,
> Priyanki
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/2c92c1a4/attachment.htm>

From simon at rabbitmq.com  Tue Jun 25 10:29:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Jun 2013 10:29:58 +0100
Subject: [rabbitmq-discuss] Rabbit 3.1.1 crash question
In-Reply-To: <CAFAX_jwA1dkkcQSr3dUeUm-xg4pqTEzbMHxjGvppbx-s4NtJ3g@mail.gmail.com>
References: <CAFAX_jw5FGSbXnXm6rGzJZPWZaw4pUMaOROOFRpzp3yB1Ep7Sw@mail.gmail.com>
	<51C4D4D4.6050509@rabbitmq.com>
	<CAFAX_jwm6FPifT-2a4Tg5LR9hZiJi77Lhaa+M88CzoZkBqUXWw@mail.gmail.com>
	<51C55FA2.9070407@rabbitmq.com>
	<CAFAX_jya=w6VgP5kyNWC5sepiyntBJgvjoB_aw=PNvfRbbQOLw@mail.gmail.com>
	<CAFAX_jwA1dkkcQSr3dUeUm-xg4pqTEzbMHxjGvppbx-s4NtJ3g@mail.gmail.com>
Message-ID: <51C96316.5020708@rabbitmq.com>

Hmm. What do the numbers per channel / exchange / queue look like - do 
they match your expectations?

Cheers, Simon

On 25/06/13 02:48, Morgan Nelson wrote:
> So we've had 3.1.2 in production for several hours now, and when I look
> at our throughput in the management module, the messages per second
> number seems a little high.  Like two orders of magnitude high.  Here's
> a screen shot:
>
> https://www.evernote.com/shard/s11/sh/c24edac3-bc98-414b-8ce8-21bae937c4c7/1cb4d01dd79c22c7a5d648eb86ee108c/deep/0/Screenshot%206/24/13%208:19%20PM.png
>
> When I looked at the throughput late last Friday afternoon, it was
> showing between 750 and 1200 publishes a second, the above image is
> showing between 50,000 and 150,000 publishes per second, with acks at
> between 100,000 and 250,000 per second.  This doesn't seem right.
>
> Now, I don't have any screenshots from before 3.1.2 showing messages
> *per second* so it _might_ be right, but I'd like another set of eyes on
> this, please.
>
>
> Morgan
>
>
> On Mon, Jun 24, 2013 at 12:20 PM, Morgan Nelson
> <mnelson at steele-forge.com <mailto:mnelson at steele-forge.com>> wrote:
>
>     Matthias,
>
>          I see the 3.1.2 release came out this morning, and that this
>     fix made it it.  Thanks for the super quick turn-around on this,
>     we'll be pushing to production as soon as our QA approves, and will
>     have full load on it by tomorrow.
>
>          I'll let you know if we see anything odd, but I don't expect
>     to.  Thanks again!
>
>     Morgan
>
>
>     On Sat, Jun 22, 2013 at 3:26 AM, Matthias Radestock
>     <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>
>         Morgan,
>
>
>         On 22/06/13 03:30, Morgan Nelson wrote:
>
>                   In the mean time, is there anything I/we can do to
>             help resolve
>             this issue?
>
>
>         The fix is a two line change, which I committed last night
>         (http://hg.rabbitmq.com/__rabbitmq-server/rev/__a19209f57363
>         <http://hg.rabbitmq.com/rabbitmq-server/rev/a19209f57363>).
>         Hopefully this will make it into the upcoming 3.1.2 release.
>
>         Matthias.
>
>
>
>
>     --
>     Morgan Nelson
>     Software Acolyte
>     (214) 392-6483
>
>
>
>
> --
> Morgan Nelson
> Software Acolyte
> (214) 392-6483
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From oleksandr.petrov at gmail.com  Tue Jun 25 10:57:15 2013
From: oleksandr.petrov at gmail.com (Alex P)
Date: Tue, 25 Jun 2013 02:57:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Counters in minutes instead of seconds in
 Managements Console (3.1.2)?
Message-ID: <49660109-e00b-44b7-83b8-b90fbd7ed0c5@googlegroups.com>

Hi, 

Counters, pretty much everywhere in Management Console, seem to be around 
60 times larger than they used to be right before 
3.1.2 update (were upgrading from 3.1.1). 

It may be just some misconfiguration issue, but it looks like "2414/s" 
should actually say "2414/min" in most places. Weird, but 
rates jumped x60, while consumers work at same pace (from app logs).

Does anyone else experience same issue? 
Any ideas?

Thanks 

Alex

http://clojurewerkz.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/2768b15a/attachment-0001.htm>

From rohit.yadav at wingify.com  Tue Jun 25 11:01:22 2013
From: rohit.yadav at wingify.com (Rohit Yadav)
Date: Tue, 25 Jun 2013 15:31:22 +0530
Subject: [rabbitmq-discuss] RabbitMQ/web-management-plugin 3.1.2 upgrade
	issue
Message-ID: <CAMF++H_KN7ogWSidQB5CgERGcRuYEP_rSvAk9Uf6TiQwyMWYTw@mail.gmail.com>

Hi,

I've just upgrade my RabbitMQ setup to 3.1.2 on Debian 7 using the apt
release channel and after the upgrade from the web-management plugin I see
it's now showing 10 times the rates than it used to show before. Is this a
bug or somehow the plugin is showing fine grained stats?

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/5ad7795c/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun 25 11:02:39 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 25 Jun 2013 14:02:39 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.1.0.pre1 is released
Message-ID: <CAE3HoVQmCK9ayBd=7Uyqsqya_9eddjiYV-4GSiirOBOAnV2CHg@mail.gmail.com>

amqp gem 1.1.0.pre1 is released to rubygems.org [1].

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/06/25/amqp-gem-1-dot-1-0-dot-pre1-is-released/

1. https://rubygems.org/gems/amqp/versions/1.1.0.pre1
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/39654881/attachment.htm>

From rohit.yadav at wingify.com  Tue Jun 25 11:03:33 2013
From: rohit.yadav at wingify.com (Rohit Yadav)
Date: Tue, 25 Jun 2013 15:33:33 +0530
Subject: [rabbitmq-discuss] Counters in minutes instead of seconds in
 Managements Console (3.1.2)?
In-Reply-To: <49660109-e00b-44b7-83b8-b90fbd7ed0c5@googlegroups.com>
References: <49660109-e00b-44b7-83b8-b90fbd7ed0c5@googlegroups.com>
Message-ID: <CAMF++H8cGkN1=_VejsT_XOWaEq0TFv7gjj_iV7iP8YO6c5Q0KQ@mail.gmail.com>

Ditto, same behaviour in my case, just sent an email on the ML. Looks like
a bug in the plugin, because I verified there was no issue with data
accuracy. I tried restarting it, still same issue.

Regards.


On Tue, Jun 25, 2013 at 3:27 PM, Alex P <oleksandr.petrov at gmail.com> wrote:

> Hi,
>
> Counters, pretty much everywhere in Management Console, seem to be around
> 60 times larger than they used to be right before
> 3.1.2 update (were upgrading from 3.1.1).
>
> It may be just some misconfiguration issue, but it looks like "2414/s"
> should actually say "2414/min" in most places. Weird, but
> rates jumped x60, while consumers work at same pace (from app logs).
>
> Does anyone else experience same issue?
> Any ideas?
>
> Thanks
>
> Alex
>
> http://clojurewerkz.org/
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/8d1824b8/attachment.htm>

From simon at rabbitmq.com  Tue Jun 25 11:08:17 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Jun 2013 11:08:17 +0100
Subject: [rabbitmq-discuss] Counters in minutes instead of seconds in
 Managements Console (3.1.2)?
In-Reply-To: <49660109-e00b-44b7-83b8-b90fbd7ed0c5@googlegroups.com>
References: <49660109-e00b-44b7-83b8-b90fbd7ed0c5@googlegroups.com>
Message-ID: <51C96C11.8070801@rabbitmq.com>

On 25/06/13 10:57, Alex P wrote:
> Does anyone else experience same issue?
> Any ideas?

Damn. Yes. Looking into it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ashok.anand at gmail.com  Tue Jun 25 11:31:18 2013
From: ashok.anand at gmail.com (Ashok Anand)
Date: Tue, 25 Jun 2013 16:01:18 +0530
Subject: [rabbitmq-discuss] rabbitmq-plugin tools not available in stable
	release - rabbitmq
Message-ID: <CALQsBOUJA9X2yQ4kMnh4MDLVOhrTANj6Eb8ZvpFD2twMuENs=g@mail.gmail.com>

Hi,

I wanted to use rabbitmq stable version (assuming testing is not stable?).
So, on ubuntu, I used

deb http://www.rabbitmq.com/debian/ stable main

instead of

deb http://www.rabbitmq.com/debian/ testing main

This does help in installing stable version, but it does not seem to
come with rabbitmq-packages,
e.g., rabbimtq-plugins was not installed.

Is there any plan to include these management tools also in stable version?

Thanks,
Ashok
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/44afd731/attachment.htm>

From tim at rabbitmq.com  Tue Jun 25 11:37:31 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 25 Jun 2013 11:37:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ/web-management-plugin 3.1.2 upgrade
	issue
In-Reply-To: <CAMF++H_KN7ogWSidQB5CgERGcRuYEP_rSvAk9Uf6TiQwyMWYTw@mail.gmail.com>
References: <CAMF++H_KN7ogWSidQB5CgERGcRuYEP_rSvAk9Uf6TiQwyMWYTw@mail.gmail.com>
Message-ID: <BFBCF8AD-A24E-4844-A81C-13D75BCC22D5@rabbitmq.com>

Rohit,

Yes, we think there's a bug and we're looking into it. And announcement will make it onto the mailing list once we've figured out what's up and have a timeline for the fix.

Cheers,
Tim

On 25 Jun 2013, at 11:01, Rohit Yadav wrote:

> Hi,
> 
> I've just upgrade my RabbitMQ setup to 3.1.2 on Debian 7 using the apt release channel and after the upgrade from the web-management plugin I see it's now showing 10 times the rates than it used to show before. Is this a bug or somehow the plugin is showing fine grained stats?
> 
> Regards.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue Jun 25 11:43:41 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 25 Jun 2013 11:43:41 +0100
Subject: [rabbitmq-discuss] rabbitmq-plugin tools not available in
	stable release - rabbitmq
In-Reply-To: <CALQsBOUJA9X2yQ4kMnh4MDLVOhrTANj6Eb8ZvpFD2twMuENs=g@mail.gmail.com>
References: <CALQsBOUJA9X2yQ4kMnh4MDLVOhrTANj6Eb8ZvpFD2twMuENs=g@mail.gmail.com>
Message-ID: <B091DF88-53CF-4392-ADFA-9EB3AA437C96@rabbitmq.com>

Hi,

We only have a testing distribution for debian, so you must be picking up some ancient release accidentally. The question of stable distro hasn't come up all that often, so it's not really been under discussion recently, but we'll chat about it around the team and have a think about the issue.

HTH for now!

Cheers,
Tim

On 25 Jun 2013, at 11:31, Ashok Anand wrote:

> Hi, 
> 
> I wanted to use rabbitmq stable version (assuming testing is not stable?).
> So, on ubuntu, I used
> 
> deb http://www.rabbitmq.com/debian/ stable main
> 
> 
> instead of 
> 
> deb http://www.rabbitmq.com/debian/ testing main
> 
> This does help in installing stable version, but it does not seem to come with rabbitmq-packages, 
> 
> e.g., rabbimtq-plugins was not installed. 
> 
> Is there any plan to include these management tools also in stable version?
> 
> Thanks,
> Ashok
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/5a5dd7e3/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun 25 11:45:59 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 25 Jun 2013 14:45:59 +0400
Subject: [rabbitmq-discuss] rabbitmq-plugin tools not available in
 stable release - rabbitmq
In-Reply-To: <CALQsBOUJA9X2yQ4kMnh4MDLVOhrTANj6Eb8ZvpFD2twMuENs=g@mail.gmail.com>
References: <CALQsBOUJA9X2yQ4kMnh4MDLVOhrTANj6Eb8ZvpFD2twMuENs=g@mail.gmail.com>
Message-ID: <CAE3HoVQWMC1ggO42=81sy6JxqsjAqtPj0Z3C+g5=B-Ur8oxM6w@mail.gmail.com>

2013/6/25 Ashok Anand <ashok.anand at gmail.com>

> Is there any plan to include these management tools also in stable version?


Ashok,

My guess is that "stable" and "testing" channels follow Debian naming
conventions.

"testing" is stable enough for most (a lot of people run Debian testing).
Ubuntu is based on
Debian unstable (not even testing). Debian stable often comes with really
old versions.

rabbitmq-plugins was introduced in 2.6 or 2.7. Please check what version
you run
and consider using "testing" if you're on Ubuntu.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/408a820f/attachment.htm>

From tim at rabbitmq.com  Tue Jun 25 11:48:51 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 25 Jun 2013 11:48:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ's Mirroring results in weird
	behavior when slave goes down
In-Reply-To: <1372141680170-27572.post@n5.nabble.com>
References: <1372141680170-27572.post@n5.nabble.com>
Message-ID: <A888D5A8-3C9F-49D4-82D2-130A4BB0BA66@rabbitmq.com>

Thomas,

On 25 Jun 2013, at 07:28, thomas wrote:

> I have set up 3 cluster nodes namely rabbit at A, rabbit at B, rabbit at C all running
> on erlang 16B and rabbitmq 3.1.1. I set net_ticktime to 2 so as to detect
> node failure faster.
> 

That's a bit excessive I think. Let me quote Erlang's net_kernel man page for a moment:

<quote>
net_ticktime = TickTime
Specifies the net_kernel tick time. TickTime is given in seconds. Once every TickTime/4 second, all connected nodes are ticked (if anything else has been written to a node) and if nothing has been received from another node within the last four (4) tick times that node is considered to be down. This ensures that nodes which are not responding, for reasons such as hardware errors, are considered to be down.

The time T, in which a node that is not responding is detected, is calculated as: MinT < T < MaxT where:

MinT = TickTime - TickTime / 4
MaxT = TickTime + TickTime / 4
TickTime is by default 60 (seconds). Thus, 45 < T < 75 seconds.

Note: All communicating nodes should have the same TickTime value specified.

Note: Normally, a terminating node is detected immediately.

</quote>

So, you're increasing the requirement for nodes to ping one another every 2 / 4 seconds, i.e., every 500 milliseconds. You're also sending 200k messages to a node and expecting HA to distribute those messages across all your nodes, which happens over the same distribution channel as that TickTime message. So I suspect you're not doing yourself any favours here. I'd suggest that *if you must* change net_ticktime (and personally I would leave it alone if I were you) then you should set it to maybe 45 seconds, but not to 2 seconds - that's almost guaranteed to end up in weird behaviour.

> 2)For my 2nd test, it is almost identical to the 1st test except that i am
> using mirroring using the following command:
> 
> rabbitmqctl set_policy HA '^(?!amq\.).*' '{"ha-mode": "all"}'"
> 
> The observation is different from that of the 1st test. Shortly after I cut
> off the network connection from rabbit at B, rabbit at A which is the master
> handling the client's messages comes to a pause for over 15 seconds and the
> pause is consistent for 10 tries. The client gets stuck in basic publish
> when rabbit at A comes to a pause.
> 
> 
> 
> I am quite puzzled about this behavior and would like to find out if that is
> the intended behavior for rabbit's mirroring feature? Does anyone else
> encounter such behavior when using mirroring? 
> 

What version of rabbit are you using? Do you have a cluster auto-recovery (i.e., autoheal) set up, and if so, which mode are you using? Some delay (which blocks publishers temporarily) is possible during failover, but also if you've got autoheal set up, then node can be restarted and waiting (for node restarts) can occur. Remember that a cluster partition is a serious problem, which rabbitmq clusters are /not/ tolerant of. If you're expecting partitions, you should consider using the federation or shovel plugins instead. Automatic cluster partition recovery is there to help, but isn't a panacea.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/1eb29152/attachment.htm>

From tim at rabbitmq.com  Tue Jun 25 11:54:51 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 25 Jun 2013 11:54:51 +0100
Subject: [rabbitmq-discuss] rabbitmq-plugin tools not available in
	stable release - rabbitmq
In-Reply-To: <CAE3HoVQWMC1ggO42=81sy6JxqsjAqtPj0Z3C+g5=B-Ur8oxM6w@mail.gmail.com>
References: <CALQsBOUJA9X2yQ4kMnh4MDLVOhrTANj6Eb8ZvpFD2twMuENs=g@mail.gmail.com>
	<CAE3HoVQWMC1ggO42=81sy6JxqsjAqtPj0Z3C+g5=B-Ur8oxM6w@mail.gmail.com>
Message-ID: <B0A6EF39-9214-4A11-B04C-9316F88F3E46@rabbitmq.com>

And the docs explain just that (from http://www.rabbitmq.com/install-debian.html):

<quote>
Please note that the word testing in this line refers to the state of our release of RabbitMQ, not any particular Debian distribution. You can use it with Debian stable, testing or unstable, as well as with Ubuntu. We describe the release as "testing" to emphasise that we release somewhat frequently.
</quote>

Hopefully that makes sense now. :)

Cheers,
Tim

On 25 Jun 2013, at 11:45, Michael Klishin wrote:

> 
> 2013/6/25 Ashok Anand <ashok.anand at gmail.com>
> Is there any plan to include these management tools also in stable version?
> 
> Ashok,
> 
> My guess is that "stable" and "testing" channels follow Debian naming conventions.
> 
> "testing" is stable enough for most (a lot of people run Debian testing). Ubuntu is based on
> Debian unstable (not even testing). Debian stable often comes with really old versions.
> 
> rabbitmq-plugins was introduced in 2.6 or 2.7. Please check what version you run
> and consider using "testing" if you're on Ubuntu.
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/4580cc74/attachment.htm>

From emile at rabbitmq.com  Tue Jun 25 12:06:23 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 25 Jun 2013 12:06:23 +0100
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
Message-ID: <51C979AF.6070001@rabbitmq.com>



Hi,

On 24/06/13 16:55, Priyanki Vashi wrote:
> Also configured HAproxy TCP Load balancer so that I can just provide
> single port to connect to the Cluster.

A mirrored queue will be slower than a queue on a single server of the
same spec.

> -1 producer and No consumer and no queue binded to exchange

In this case the broker throws messages away without queueing so it
should be extremely fast.

> Also what points to take care, in order to improve throughput ?

There are several factors that could have a bearing on the overall
throughput. Here is a similar question I answered  recently:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-March/026132.html

The numbers you quote are very low. For comparison, measure the network
and IO bandwidth by piping traffic across the network to disk (e.g.
using netcat) to determine what performance your servers are capable of.



-Emile












From watson.timothy at gmail.com  Tue Jun 25 12:09:28 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 25 Jun 2013 12:09:28 +0100
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
	single node as well as cluster
In-Reply-To: <1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
References: <adcebf85-d49a-420f-836b-1f9f3b0b7b8b@googlegroups.com>
	<1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A@rabbitmq.com>
Message-ID: <B01B7CE4-BD21-4B43-816A-6162C3A91690@rabbitmq.com>

Reposting

On 25 Jun 2013, at 09:38, Tim Watson <tim at rabbitmq.com> wrote:

> What does your publishing code look like? The figures below are expected in that the consumer can keep pace with the producer - it could hardly be expected to consume faster than messages are arriving in the queue(s). So the slowness is very likely on the producing side.
> 
> Are you using persistent messages and either publisher confirms or transactions? If so, how often are you waiting on confirms/commits?
> 
> With the official clients we typically see avg rates of 50 - 60Khz with non-persistent messages. Persistence slows things down a tad, as do confirms (and more so transactions) but even with persistent messages and confirms, rates >= 5Khz are expected. It /sounds/ like you might be publishing persistent messages with confirms enabled and waiting for a confirm (ack) from the broker for each message. That  involves disk I/O on the server for each message plus network latency, effectively making publishing synchronous (and very slow by comparison).
> 
> Cheers,
> Tim
> 
> On 25 Jun 2013, at 08:44, Priyanki Vashi <vashi.priyanki at gmail.com> wrote:
> 
>> Hi there,
>> 
>> I am doing a performance study of RabbitMQ-3.1.1 and this is my first time to do such a performance study with any messaging broker :))-
>> 
>> 1) I have thoroughly gone through rabbitMQ in action' and learnt important concepts. 
>> 
>> 2) Tried single node broker to get a feel of how it is working and then set up a four node cluster (with two disk and two RAM type of node). Also configured HAproxy TCP Load balancer so that I can just provide single port to connect to the Cluster.
>> 
>> 3) I am simulating producer and consumers through Python scripts ( using Python-pika library methods to connect to server , publish subscribe etc.)
>> 
>> 4) My scripts are working fine but where I am stuck is no matter what I do my throughout is always 300 msg/sec. 
>> 
>> 5) I have defines durable exchanges and queues
>> 
>> My final requirement is to run atleast 10 to 15 producer and 60 to 70 consumer simultaneously and I want to start with linear increase in number of producer and consumer so that I can make conclusions about  throughout, fault handling, processor utilization etc. etc but I am seriously stuck now after trying to start in initial steps only. This group's help would be really appreciated. 
>> 
>> I have started with following different scenarios but no matter what I do my throughput is more or less remaining same (300 msg/sec) except for Scenario-1
>> 
>> Scenario-1
>> -1 producer and No consumer and no queue binded to exchange
>> -Producer is running in infinite loop and publishing to one fanout exchange
>> - publisher/confirm disabled
>> -Publisher rate - 6200 msg/sec ( checked through web management plugin)
>> 
>> Tried scenario-1 with also fanout type of exchange and it's the same publish rate
>> I know that Scenario-1 is not really useful, since there are no queues and ultimately messages will be dropped but as a part of debugging process I tried this and I see above mentioned results.
>> 
>> Scenario-2
>> -1 producer and 1 consumer 
>> -Producer is running in infinite loop and publishing to one direct exchange
>> -A consumer has it's own dedicated queue and listening to above exchange 
>> - publisher/confirm and consumer ack are disabled
>> Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec and deliver rate - 300 msg/sec)
>> 
>> Tried Scenario-2 also with fanout type of exchange and enabling publisher confirm and consumer ack
>> Still the same throughput as 300 msg/sec
>> 
>> Scenario-3
>> -1 producer and 4 consumer 
>> -Producer is running in infinite loop and publishing to four direct exchange
>> -A consumer has it's own dedicated queue and listening to respective exchange 
>> - publisher/confirm and consumer ack are disabled
>> Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec and deliver rate - 300 msg/sec)
>> 
>> Tried Scenario-3 also with fanout type of exchange and enabling publisher confirm and consumer ack
>> Still the same throughput as 300 msg/sec
>> 
>> Tried configuring prefetch_count parameters also to 100 but it still gives me same throughput of 300 msg/sec.
>> I am honestly going crazy with this.
>> 
>> After seeing this behavior, I am seriously suspecting that there is some serious limitation with my simulated producers and consumers.
>> Has anyone else has tried Python-pika client and any idea on throughput with this version of rabbit ? 
>> Did anyone have rough idea about throughout with rabbitMQ-3.1.1 ?
>> 
>> I can also share my python scripts if required but I would really appreciate some light on this situation
>> Also what points to take care, in order to improve throughput ?
>> 
>> Best Regards,
>> Priyanki
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/9df8fcac/attachment.htm>

From emile at rabbitmq.com  Tue Jun 25 12:22:51 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 25 Jun 2013 12:22:51 +0100
Subject: [rabbitmq-discuss] rabbitmqctl status hangs until I kill all
 erlang/erts-5.8.5/bin/beam processes
In-Reply-To: <5cecd298-5fb0-4d25-8689-10fe0653cc6d@googlegroups.com>
References: <5cecd298-5fb0-4d25-8689-10fe0653cc6d@googlegroups.com>
Message-ID: <51C97D8B.6050409@rabbitmq.com>


Hi,

On 24/06/13 20:46, tenyks wrote:
> rabbitmq 13641  0.0  0.4  31236  9328 ?        Ss   18:55   0:00

According to the START field all these processes were started within a
minute of each other, all executing "rabbitmqctl wait". "rabbitmqctl
wait" should not be called in a loop - it already contains a loop that
performs a check every second.

If you started the broker using one of the supplied packages then please
let us know the version and the kind of package.



-Emile

From antony.pulicken at gmail.com  Tue Jun 25 12:56:53 2013
From: antony.pulicken at gmail.com (antony)
Date: Tue, 25 Jun 2013 04:56:53 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Consumer timeout
Message-ID: <1372161413983-27590.post@n5.nabble.com>

Hi,

This is my scenario:

I have multiple instances of listeners waiting on different temp queues. In
some of the cases, there won't be any messages published to these temp
queues and I want these listeners to timeout so that it can free up the
connections.  

I guess in Java, we can achieve this by using the overloaded method in the
QueueingConsumer class that takes timeout as a parameter as shown below:


/QueueingConsumer.Delivery delivery = null;
long timeout = 2 * 60 * 1000; // 2 minutes in milliseconds
delivery = queuingConsumer.nextDelivery(*timeout*);
if (delivery == null) {
  // shut down your consumer here - no events arrived
  // before the timeout was reached
}
else {
  // process the delivered message here
}/


1) Does RabbitMQ C client also has a similar feature ? 

2) Are there better approaches to handle this timeouts ?

Please let me know.

Thanks and Regards,
Antony.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Consumer-timeout-tp27590.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From vashi.priyanki at gmail.com  Tue Jun 25 13:38:50 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Tue, 25 Jun 2013 14:38:50 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <51C979AF.6070001@rabbitmq.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
Message-ID: <CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>

Hi Emile ,

Thank you for your reply. I had also looked at the link you shared in the
reply.
I understand that throughout is a function of different parameters and it
would behave based on configuration of these parameters.

But since I am doing a detailed performance study, my goal will be to try
different parameter configuration and see the difference in throughout ,
processor load etc. etc so that I finally propose a suitable configuration.
My requirement is to atleast have 10,000 msg/sec. For maintaining this
throughput requirement with zero message loss and 100% availability of
broker, I started with 4 node cluster with durable queues and exchanges.
Since I knew that persistent messages would trigger disk activity, first I
want to try with non-persistent messages and see what is throghput,
processor utilization etc. etc.

I have very high end server with 20 CPUs and 120 GB of RAM so I think
resources wise it's not the bottleneck.

And as Tim pointed out before, I am also suspecting that bottleneck might
be in the way I am using publisher/confirm and consumer ack. I have shared
my scripts also now.

Did u and Tim received my scripts ?
It would really help me if you guys can have quick look at attached scripts
and guide me if the way I am using publisher confirm and consumer ack is
efficient and correct or not for securing message deliveries both by
rabbitMQ server and then by consumer/s.

I also have configured prefetch count value but still I don't see any
difference in my throughout bcoz may be bottleneck is in my producer.

Also, I tried to simulate four producers (each opening up it's own TCP
connection to server , each have it's own channel and exchange) but I still
don't get higher throughput than 300 msg/sec. I have a single python
script, which starts four producers and it's only one process.

Here I am suspecting that since it's just a single process, it still behave
the same as single producer. If I run the same script again ,y throughout
doubles which is 600 msg/sec and I see that there are two processes each
connected with one producer script.

I can see through web interface of rabbitMQ that my automatic producer
script works since connection, channel gets updated accordingly.

I also wanted to know what is internal mechanism within basic_publish and
basic_consume.
I learnt that basic_consume is better choice than basic_get since server
will directly send messages to listening consumer without consumer polling
it.

I hope, I have explained myself well and in detail manner for you guys to
able to help/guide me.

Thanks !
//Priyanki.


On Tue, Jun 25, 2013 at 1:06 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
>
> Hi,
>
> On 24/06/13 16:55, Priyanki Vashi wrote:
> > Also configured HAproxy TCP Load balancer so that I can just provide
> > single port to connect to the Cluster.
>
> A mirrored queue will be slower than a queue on a single server of the
> same spec.
>
> > -1 producer and No consumer and no queue binded to exchange
>
> In this case the broker throws messages away without queueing so it
> should be extremely fast.
>
> > Also what points to take care, in order to improve throughput ?
>
> There are several factors that could have a bearing on the overall
> throughput. Here is a similar question I answered  recently:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-March/026132.html
>
> The numbers you quote are very low. For comparison, measure the network
> and IO bandwidth by piping traffic across the network to disk (e.g.
> using netcat) to determine what performance your servers are capable of.
>
>
>
> -Emile
>
>
>
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/60c88792/attachment.htm>

From emile at rabbitmq.com  Tue Jun 25 13:59:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 25 Jun 2013 13:59:50 +0100
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
Message-ID: <51C99446.4000908@rabbitmq.com>


Hi,

On 25/06/13 13:38, Priyanki Vashi wrote:

> I have very high end server with 20 CPUs and 120 GB of RAM so I think
> resources wise it's not the bottleneck.

And what about the network speed? I would still try an independent
bandwidth test from network to disk to give you a comparison reference.

The numbers you quoted are about 2 orders of magnitude lower than I
would expect for that hardware. Bear in mind that the queue process is
typically the most CPU-intensive process. A queue on a single server can
occupy at most one CPU, so will benefit more from a faster CPU than from
many CPUs.

> Did u and Tim received my scripts ?

Not yet, but hopefully someone who knows more about the Pika client than
me will be able to comment.

> I learnt that basic_consume is better choice than basic_get since server
> will directly send messages to listening consumer without consumer
> polling it. 

Yes, and the asynchronous choice is typically faster.


If you are still stuck with very low throughput then I would recommend
you try the MulticastMain utility, included in the RabbitMQ Java client.
It includes support for many of the options that you want to compare,



-Emile




From vashi.priyanki at gmail.com  Tue Jun 25 14:07:40 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Tue, 25 Jun 2013 15:07:40 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <51C99446.4000908@rabbitmq.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
Message-ID: <CA+0nT8ArWeP5QLyCrq8QS=-9baP+ahNARFEBhEq4L_Rqs=YUFQ@mail.gmail.com>

Hi ,

By mistake I had attached a wrong producer in my previous  zip file so
attaching the correct one now.
Sorry for that but I have so many different files, which I have tried.

So resending the zip files again with correct producer and consumer (I
believe)

//P




On Tue, Jun 25, 2013 at 2:59 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 25/06/13 13:38, Priyanki Vashi wrote:
>
> > I have very high end server with 20 CPUs and 120 GB of RAM so I think
> > resources wise it's not the bottleneck.
>
> And what about the network speed? I would still try an independent
> bandwidth test from network to disk to give you a comparison reference.
>
> The numbers you quoted are about 2 orders of magnitude lower than I
> would expect for that hardware. Bear in mind that the queue process is
> typically the most CPU-intensive process. A queue on a single server can
> occupy at most one CPU, so will benefit more from a faster CPU than from
> many CPUs.
>
> > Did u and Tim received my scripts ?
>
> Not yet, but hopefully someone who knows more about the Pika client than
> me will be able to comment.
>
> > I learnt that basic_consume is better choice than basic_get since server
> > will directly send messages to listening consumer without consumer
> > polling it.
>
> Yes, and the asynchronous choice is typically faster.
>
>
> If you are still stuck with very low throughput then I would recommend
> you try the MulticastMain utility, included in the RabbitMQ Java client.
> It includes support for many of the options that you want to compare,
>
>
>
> -Emile
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/f1e850ae/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Producer_Consumer_Scripts_latest.zip
Type: application/zip
Size: 6584 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/f1e850ae/attachment.zip>

From simon at rabbitmq.com  Tue Jun 25 14:16:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Jun 2013 14:16:12 +0100
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <CA+0nT8ArWeP5QLyCrq8QS=-9baP+ahNARFEBhEq4L_Rqs=YUFQ@mail.gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CA+0nT8ArWeP5QLyCrq8QS=-9baP+ahNARFEBhEq4L_Rqs=YUFQ@mail.gmail.com>
Message-ID: <51C9981C.7020600@rabbitmq.com>

Just from quickly scanning your script I notice that you are invoking:

         self.channel.confirm_delivery()

on every publish.

As far as I can see from the pika source code this will send 
confirm.select. That's a synchronous method, so you're incurring a 
network round trip per publish. That's almost certainly where all your 
performance is going. You're also not passing in a callback, so it's not 
really accomplishing anything client-side.

Cheers, Simon

On 25/06/13 14:07, Priyanki Vashi wrote:
> Hi ,
>
> By mistake I had attached a wrong producer in my previous  zip file so
> attaching the correct one now.
> Sorry for that but I have so many different files, which I have tried.
> So resending the zip files again with correct producer and consumer (I
> believe)
>
> //P
>
>
>
>
> On Tue, Jun 25, 2013 at 2:59 PM, Emile Joubert <emile at rabbitmq.com
> <mailto:emile at rabbitmq.com>> wrote:
>
>
>     Hi,
>
>     On 25/06/13 13:38, Priyanki Vashi wrote:
>
>      > I have very high end server with 20 CPUs and 120 GB of RAM so I think
>      > resources wise it's not the bottleneck.
>
>     And what about the network speed? I would still try an independent
>     bandwidth test from network to disk to give you a comparison reference.
>
>     The numbers you quoted are about 2 orders of magnitude lower than I
>     would expect for that hardware. Bear in mind that the queue process is
>     typically the most CPU-intensive process. A queue on a single server can
>     occupy at most one CPU, so will benefit more from a faster CPU than from
>     many CPUs.
>
>      > Did u and Tim received my scripts ?
>
>     Not yet, but hopefully someone who knows more about the Pika client than
>     me will be able to comment.
>
>      > I learnt that basic_consume is better choice than basic_get since
>     server
>      > will directly send messages to listening consumer without consumer
>      > polling it.
>
>     Yes, and the asynchronous choice is typically faster.
>
>
>     If you are still stuck with very low throughput then I would recommend
>     you try the MulticastMain utility, included in the RabbitMQ Java client.
>     It includes support for many of the options that you want to compare,
>
>
>
>     -Emile
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Tue Jun 25 14:24:14 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 25 Jun 2013 09:24:14 -0400
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <51C99446.4000908@rabbitmq.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
Message-ID: <CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>

I know a lot about the pika client but I don't see any code.

On my old mac laptop, using the pika tornado adapter (or the libev adapter
not yet released), I can publish ~20K msgs/sec (4KBytes each), saturating
my network adapter. My servers are small, and process msgs more slowly, so
network buffers fill up, and TCP backpressure is exerted, but everything
completes as expected.

Other pika async adapters run at about 3K msgs/sec in similar runs on my
mac; I don't work at all with the pika BlockingConnection so you are on
your own if you are using that.

ml


On Tue, Jun 25, 2013 at 8:59 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 25/06/13 13:38, Priyanki Vashi wrote:
>
> > I have very high end server with 20 CPUs and 120 GB of RAM so I think
> > resources wise it's not the bottleneck.
>
> And what about the network speed? I would still try an independent
> bandwidth test from network to disk to give you a comparison reference.
>
> The numbers you quoted are about 2 orders of magnitude lower than I
> would expect for that hardware. Bear in mind that the queue process is
> typically the most CPU-intensive process. A queue on a single server can
> occupy at most one CPU, so will benefit more from a faster CPU than from
> many CPUs.
>
> > Did u and Tim received my scripts ?
>
> Not yet, but hopefully someone who knows more about the Pika client than
> me will be able to comment.
>
> > I learnt that basic_consume is better choice than basic_get since server
> > will directly send messages to listening consumer without consumer
> > polling it.
>
> Yes, and the asynchronous choice is typically faster.
>
>
> If you are still stuck with very low throughput then I would recommend
> you try the MulticastMain utility, included in the RabbitMQ Java client.
> It includes support for many of the options that you want to compare,
>
>
>
> -Emile
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/cc3c436c/attachment.htm>

From faycal.noushi at gmail.com  Tue Jun 25 14:38:10 2013
From: faycal.noushi at gmail.com (photon)
Date: Tue, 25 Jun 2013 06:38:10 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ won't start after the disk went full
Message-ID: <1372167490328-27596.post@n5.nabble.com>

Hi all,

 I have an issue concerning RabbitMQ. Once my disk got full, RabbitMQ became
unusable. This didn't change even after i made the disk usage drop
dramatically. 
Here are the logs :

[root at host rabbitmq]# service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
_err}
rabbitmq-server.

startup_log


BOOT FAILED
===========

Error description:
   {error,corrupt_cluster_status_files,[]}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at noc1.log
   /var/log/rabbitmq/rabbit at noc1-sasl.log

Stack trace:
   [{rabbit_node_monitor,'-prepare_cluster_status_files/0-fun-0-',1},
    {rabbit_node_monitor,prepare_cluster_status_files,0},
    {rabbit,'-boot/0-fun-1-',0},
    {rabbit,start_it,1},
    {init,start_it,1},
    {init,start_em,1}]

{"init terminating in
do_boot",{rabbit,failure_during_boot,{error,corrupt_cluster_status_files,[]}}}
[60G[[0;31mFAILED[0;39m]

=INFO REPORT==== 25-Jun-2013::09:10:49 ===
Disk free space insufficient. Free bytes:645095424 Limit:1000000000

=WARNING REPORT==== 25-Jun-2013::09:10:49 ===
disk resource limit alarm set on node rabbit at noc1

=INFO REPORT==== 25-Jun-2013::10:12:39 ===
Error description:
   {error,corrupt_cluster_status_files,[]}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at noc1.log
   /var/log/rabbitmq/rabbit at noc1-sasl.log

Stack trace:
   [{rabbit_node_monitor,'-prepare_cluster_status_files/0-fun-0-',1},
    {rabbit_node_monitor,prepare_cluster_status_files,0},
    {rabbit,'-boot/0-fun-1-',0},
    {rabbit,start_it,1},
    {init,start_it,1},
    {init,start_em,1}]


=INFO REPORT==== 25-Jun-2013::12:05:39 ===
Error description:
   {error,corrupt_cluster_status_files,[]}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at noc1.log
   /var/log/rabbitmq/rabbit at noc1-sasl.log

Stack trace:
   [{rabbit_node_monitor,'-prepare_cluster_status_files/0-fun-0-',1},
    {rabbit_node_monitor,prepare_cluster_status_files,0},
    {rabbit,'-boot/0-fun-1-',0},
    {rabbit,start_it,1},
    {init,start_it,1},
    {init,start_em,1}]

Thanks for your help, guys.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-won-t-start-after-the-disk-went-full-tp27596.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From vashi.priyanki at gmail.com  Tue Jun 25 14:50:05 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Tue, 25 Jun 2013 15:50:05 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
Message-ID: <CA+0nT8Cw2B3Rjez3UffP+F+Wa-js3GE0+6saBe_ghUVryBv+xg@mail.gmail.com>

Hi Michel ,

Resending the code again. Not sure why you don't see but I have sent it
around 1 hr ago.

Also a good advise on efficient publisher confirm and consumer ack would be
highly appreciated.

//P





On Tue, Jun 25, 2013 at 3:24 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> I know a lot about the pika client but I don't see any code.
>
> On my old mac laptop, using the pika tornado adapter (or the libev adapter
> not yet released), I can publish ~20K msgs/sec (4KBytes each), saturating
> my network adapter. My servers are small, and process msgs more slowly, so
> network buffers fill up, and TCP backpressure is exerted, but everything
> completes as expected.
>
> Other pika async adapters run at about 3K msgs/sec in similar runs on my
> mac; I don't work at all with the pika BlockingConnection so you are on
> your own if you are using that.
>
> ml
>
>
> On Tue, Jun 25, 2013 at 8:59 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>>
>> Hi,
>>
>> On 25/06/13 13:38, Priyanki Vashi wrote:
>>
>> > I have very high end server with 20 CPUs and 120 GB of RAM so I think
>> > resources wise it's not the bottleneck.
>>
>> And what about the network speed? I would still try an independent
>> bandwidth test from network to disk to give you a comparison reference.
>>
>> The numbers you quoted are about 2 orders of magnitude lower than I
>> would expect for that hardware. Bear in mind that the queue process is
>> typically the most CPU-intensive process. A queue on a single server can
>> occupy at most one CPU, so will benefit more from a faster CPU than from
>> many CPUs.
>>
>> > Did u and Tim received my scripts ?
>>
>> Not yet, but hopefully someone who knows more about the Pika client than
>> me will be able to comment.
>>
>> > I learnt that basic_consume is better choice than basic_get since server
>> > will directly send messages to listening consumer without consumer
>> > polling it.
>>
>> Yes, and the asynchronous choice is typically faster.
>>
>>
>> If you are still stuck with very low throughput then I would recommend
>> you try the MulticastMain utility, included in the RabbitMQ Java client.
>> It includes support for many of the options that you want to compare,
>>
>>
>>
>> -Emile
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/2f557337/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Producer_Consumer_Scripts_latest.zip
Type: application/zip
Size: 6584 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/2f557337/attachment.zip>

From vashi.priyanki at gmail.com  Tue Jun 25 15:13:06 2013
From: vashi.priyanki at gmail.com (PRIYANKI VASHI)
Date: Tue, 25 Jun 2013 16:13:06 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
Message-ID: <E1C88E54-1CDC-4820-AA3D-09AF61A2EEF8@gmail.com>

Yes I use blocking connection. 

I am comparitively new to python as well so Can please u explain the difference between blockin connection n tornedo adaptor connection ?

Can u share some example with tornedo type connection ?

Sent from my iPhone

On 25 jun 2013, at 15:24, "Laing, Michael" <michael.laing at nytimes.com> wrote:

> I know a lot about the pika client but I don't see any code.
> 
> On my old mac laptop, using the pika tornado adapter (or the libev adapter not yet released), I can publish ~20K msgs/sec (4KBytes each), saturating my network adapter. My servers are small, and process msgs more slowly, so network buffers fill up, and TCP backpressure is exerted, but everything completes as expected.
> 
> Other pika async adapters run at about 3K msgs/sec in similar runs on my mac; I don't work at all with the pika BlockingConnection so you are on your own if you are using that.
> 
> ml
> 
> 
> On Tue, Jun 25, 2013 at 8:59 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>> 
>> Hi,
>> 
>> On 25/06/13 13:38, Priyanki Vashi wrote:
>> 
>> > I have very high end server with 20 CPUs and 120 GB of RAM so I think
>> > resources wise it's not the bottleneck.
>> 
>> And what about the network speed? I would still try an independent
>> bandwidth test from network to disk to give you a comparison reference.
>> 
>> The numbers you quoted are about 2 orders of magnitude lower than I
>> would expect for that hardware. Bear in mind that the queue process is
>> typically the most CPU-intensive process. A queue on a single server can
>> occupy at most one CPU, so will benefit more from a faster CPU than from
>> many CPUs.
>> 
>> > Did u and Tim received my scripts ?
>> 
>> Not yet, but hopefully someone who knows more about the Pika client than
>> me will be able to comment.
>> 
>> > I learnt that basic_consume is better choice than basic_get since server
>> > will directly send messages to listening consumer without consumer
>> > polling it.
>> 
>> Yes, and the asynchronous choice is typically faster.
>> 
>> 
>> If you are still stuck with very low throughput then I would recommend
>> you try the MulticastMain utility, included in the RabbitMQ Java client.
>> It includes support for many of the options that you want to compare,
>> 
>> 
>> 
>> -Emile
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/37dbba03/attachment.htm>

From michael.laing at nytimes.com  Tue Jun 25 15:48:30 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 25 Jun 2013 10:48:30 -0400
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <E1C88E54-1CDC-4820-AA3D-09AF61A2EEF8@gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
	<E1C88E54-1CDC-4820-AA3D-09AF61A2EEF8@gmail.com>
Message-ID: <CAKgmDnE1fzsZbOhVZXqKS_Pf+x9dgTUUb=5txR=LiMUUPYzR1A@mail.gmail.com>

Read this carefully: https://pika.readthedocs.org

In particular, look at the 'Asynchronous publisher example' and get it to
work - then try modifying it to publish as fast possible, remove asynch
confirms, etc.

Then install tornado and try using the TornadoConnection instead of the
SelectConnection employed in the example.

ml


On Tue, Jun 25, 2013 at 10:13 AM, PRIYANKI VASHI
<vashi.priyanki at gmail.com>wrote:

> Yes I use blocking connection.
>
> I am comparitively new to python as well so Can please u explain the
> difference between blockin connection n tornedo adaptor connection ?
>
> Can u share some example with tornedo type connection ?
>
> Sent from my iPhone
>
> On 25 jun 2013, at 15:24, "Laing, Michael" <michael.laing at nytimes.com>
> wrote:
>
> I know a lot about the pika client but I don't see any code.
>
> On my old mac laptop, using the pika tornado adapter (or the libev adapter
> not yet released), I can publish ~20K msgs/sec (4KBytes each), saturating
> my network adapter. My servers are small, and process msgs more slowly, so
> network buffers fill up, and TCP backpressure is exerted, but everything
> completes as expected.
>
> Other pika async adapters run at about 3K msgs/sec in similar runs on my
> mac; I don't work at all with the pika BlockingConnection so you are on
> your own if you are using that.
>
> ml
>
>
> On Tue, Jun 25, 2013 at 8:59 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>>
>> Hi,
>>
>> On 25/06/13 13:38, Priyanki Vashi wrote:
>>
>> > I have very high end server with 20 CPUs and 120 GB of RAM so I think
>> > resources wise it's not the bottleneck.
>>
>> And what about the network speed? I would still try an independent
>> bandwidth test from network to disk to give you a comparison reference.
>>
>> The numbers you quoted are about 2 orders of magnitude lower than I
>> would expect for that hardware. Bear in mind that the queue process is
>> typically the most CPU-intensive process. A queue on a single server can
>> occupy at most one CPU, so will benefit more from a faster CPU than from
>> many CPUs.
>>
>> > Did u and Tim received my scripts ?
>>
>> Not yet, but hopefully someone who knows more about the Pika client than
>> me will be able to comment.
>>
>> > I learnt that basic_consume is better choice than basic_get since server
>> > will directly send messages to listening consumer without consumer
>> > polling it.
>>
>> Yes, and the asynchronous choice is typically faster.
>>
>>
>> If you are still stuck with very low throughput then I would recommend
>> you try the MulticastMain utility, included in the RabbitMQ Java client.
>> It includes support for many of the options that you want to compare,
>>
>>
>>
>> -Emile
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/df305182/attachment.htm>

From vashi.priyanki at gmail.com  Tue Jun 25 16:30:06 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Tue, 25 Jun 2013 17:30:06 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <CAKgmDnE1fzsZbOhVZXqKS_Pf+x9dgTUUb=5txR=LiMUUPYzR1A@mail.gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
	<E1C88E54-1CDC-4820-AA3D-09AF61A2EEF8@gmail.com>
	<CAKgmDnE1fzsZbOhVZXqKS_Pf+x9dgTUUb=5txR=LiMUUPYzR1A@mail.gmail.com>
Message-ID: <CA+0nT8CSwpg=1=o6QTz+WD0WJzkHEXDhdAFCQLMNCMB3WsA+mw@mail.gmail.com>

Hi Micheal ,

Thanks for u r quick reply.
I have already worked on scripts quite a lot that I have shared here quite
so it would help me if you can just have a look at them and give
suggestions based on them.

In the beginning, I had also gone through the pika link, which you sent me
but I could not grasp the basic concept.

What is the concept of blocking connection ?
What difference really it will make over other type of connection ?

Some theory on this would be helpful.

Thanks !


//P


On Tue, Jun 25, 2013 at 4:48 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> Read this carefully: https://pika.readthedocs.org
>
> In particular, look at the 'Asynchronous publisher example' and get it to
> work - then try modifying it to publish as fast possible, remove asynch
> confirms, etc.
>
> Then install tornado and try using the TornadoConnection instead of the
> SelectConnection employed in the example.
>
> ml
>
>
> On Tue, Jun 25, 2013 at 10:13 AM, PRIYANKI VASHI <vashi.priyanki at gmail.com
> > wrote:
>
>> Yes I use blocking connection.
>>
>> I am comparitively new to python as well so Can please u explain the
>> difference between blockin connection n tornedo adaptor connection ?
>>
>> Can u share some example with tornedo type connection ?
>>
>> Sent from my iPhone
>>
>> On 25 jun 2013, at 15:24, "Laing, Michael" <michael.laing at nytimes.com>
>> wrote:
>>
>> I know a lot about the pika client but I don't see any code.
>>
>> On my old mac laptop, using the pika tornado adapter (or the libev
>> adapter not yet released), I can publish ~20K msgs/sec (4KBytes each),
>> saturating my network adapter. My servers are small, and process msgs more
>> slowly, so network buffers fill up, and TCP backpressure is exerted, but
>> everything completes as expected.
>>
>> Other pika async adapters run at about 3K msgs/sec in similar runs on my
>> mac; I don't work at all with the pika BlockingConnection so you are on
>> your own if you are using that.
>>
>> ml
>>
>>
>> On Tue, Jun 25, 2013 at 8:59 AM, Emile Joubert <emile at rabbitmq.com>wrote:
>>
>>>
>>> Hi,
>>>
>>> On 25/06/13 13:38, Priyanki Vashi wrote:
>>>
>>> > I have very high end server with 20 CPUs and 120 GB of RAM so I think
>>> > resources wise it's not the bottleneck.
>>>
>>> And what about the network speed? I would still try an independent
>>> bandwidth test from network to disk to give you a comparison reference.
>>>
>>> The numbers you quoted are about 2 orders of magnitude lower than I
>>> would expect for that hardware. Bear in mind that the queue process is
>>> typically the most CPU-intensive process. A queue on a single server can
>>> occupy at most one CPU, so will benefit more from a faster CPU than from
>>> many CPUs.
>>>
>>> > Did u and Tim received my scripts ?
>>>
>>> Not yet, but hopefully someone who knows more about the Pika client than
>>> me will be able to comment.
>>>
>>> > I learnt that basic_consume is better choice than basic_get since
>>> server
>>> > will directly send messages to listening consumer without consumer
>>> > polling it.
>>>
>>> Yes, and the asynchronous choice is typically faster.
>>>
>>>
>>> If you are still stuck with very low throughput then I would recommend
>>> you try the MulticastMain utility, included in the RabbitMQ Java client.
>>> It includes support for many of the options that you want to compare,
>>>
>>>
>>>
>>> -Emile
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/1743d4e4/attachment.htm>

From vashi.priyanki at gmail.com  Tue Jun 25 16:55:39 2013
From: vashi.priyanki at gmail.com (PRIYANKI VASHI)
Date: Tue, 25 Jun 2013 17:55:39 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <51C9981C.7020600@rabbitmq.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CA+0nT8ArWeP5QLyCrq8QS=-9baP+ahNARFEBhEq4L_Rqs=YUFQ@mail.gmail.com>
	<51C9981C.7020600@rabbitmq.com>
Message-ID: <2DE2E2E1-5727-4709-9656-1B3099A6E032@gmail.com>

Hi Simon, 

When u say I am using confirm delivery, isn't that the way one confirm message has reached to rabbitmq server ?

This is what I understood as publisher confirm usage. 
Am i wrong in my understanding ?

Also if i want to make sure there is zero message loss both when i publish to server (using above method) as well as by explicitly making sure consumer ack method ?

If the way i do is not correct then what is the correct way to ensure zero message loss ? 

I apologize if i am asking too many questions here and if troubling u but i am little bit behind to understand  what is that i m doing wrong ?
also how it is correctly done?
And once i have this understanding then its easy to make changes in my scripts. 

Thanks !

P





Sent from my iPhone

On 25 jun 2013, at 15:16, Simon MacMullen <simon at rabbitmq.com> wrote:

> Just from quickly scanning your script I notice that you are invoking:
> 
>        self.channel.confirm_delivery()
> 
> on every publish.
> 
> As far as I can see from the pika source code this will send confirm.select. That's a synchronous method, so you're incurring a network round trip per publish. That's almost certainly where all your performance is going. You're also not passing in a callback, so it's not really accomplishing anything client-side.
> 
> Cheers, Simon
> 
> On 25/06/13 14:07, Priyanki Vashi wrote:
>> Hi ,
>> 
>> By mistake I had attached a wrong producer in my previous  zip file so
>> attaching the correct one now.
>> Sorry for that but I have so many different files, which I have tried.
>> So resending the zip files again with correct producer and consumer (I
>> believe)
>> 
>> //P
>> 
>> 
>> 
>> 
>> On Tue, Jun 25, 2013 at 2:59 PM, Emile Joubert <emile at rabbitmq.com
>> <mailto:emile at rabbitmq.com>> wrote:
>> 
>> 
>>    Hi,
>> 
>>    On 25/06/13 13:38, Priyanki Vashi wrote:
>> 
>>     > I have very high end server with 20 CPUs and 120 GB of RAM so I think
>>     > resources wise it's not the bottleneck.
>> 
>>    And what about the network speed? I would still try an independent
>>    bandwidth test from network to disk to give you a comparison reference.
>> 
>>    The numbers you quoted are about 2 orders of magnitude lower than I
>>    would expect for that hardware. Bear in mind that the queue process is
>>    typically the most CPU-intensive process. A queue on a single server can
>>    occupy at most one CPU, so will benefit more from a faster CPU than from
>>    many CPUs.
>> 
>>     > Did u and Tim received my scripts ?
>> 
>>    Not yet, but hopefully someone who knows more about the Pika client than
>>    me will be able to comment.
>> 
>>     > I learnt that basic_consume is better choice than basic_get since
>>    server
>>     > will directly send messages to listening consumer without consumer
>>     > polling it.
>> 
>>    Yes, and the asynchronous choice is typically faster.
>> 
>> 
>>    If you are still stuck with very low throughput then I would recommend
>>    you try the MulticastMain utility, included in the RabbitMQ Java client.
>>    It includes support for many of the options that you want to compare,
>> 
>> 
>> 
>>    -Emile
>> 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Tue Jun 25 17:13:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 25 Jun 2013 20:13:15 +0400
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <2DE2E2E1-5727-4709-9656-1B3099A6E032@gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CA+0nT8ArWeP5QLyCrq8QS=-9baP+ahNARFEBhEq4L_Rqs=YUFQ@mail.gmail.com>
	<51C9981C.7020600@rabbitmq.com>
	<2DE2E2E1-5727-4709-9656-1B3099A6E032@gmail.com>
Message-ID: <CAE3HoVR7PjwgwVfnXbvzQo2=1FEqgYg6RtErRoH+KsQoRWmtTw@mail.gmail.com>

2013/6/25 PRIYANKI VASHI <vashi.priyanki at gmail.com>

> When u say I am using confirm delivery, isn't that the way one confirm
> message has reached to rabbitmq server ?
>
> This is what I understood as publisher confirm usage.
> Am i wrong in my understanding ?
>

Your understanding is correct but you don't need to enable confirmations
using confirm.select for every message.
It needs to be done once per channel, before you publish.

Doing so for every published messages is just a waste of bandwidth and time
(if confirm.select in your client
blocks).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/82db2979/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun 25 17:20:52 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 25 Jun 2013 20:20:52 +0400
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <CA+0nT8CSwpg=1=o6QTz+WD0WJzkHEXDhdAFCQLMNCMB3WsA+mw@mail.gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
	<E1C88E54-1CDC-4820-AA3D-09AF61A2EEF8@gmail.com>
	<CAKgmDnE1fzsZbOhVZXqKS_Pf+x9dgTUUb=5txR=LiMUUPYzR1A@mail.gmail.com>
	<CA+0nT8CSwpg=1=o6QTz+WD0WJzkHEXDhdAFCQLMNCMB3WsA+mw@mail.gmail.com>
Message-ID: <CAE3HoVS7Pc=XKwQ8fJut3GDw3sT-oNaoGfFw31C6jqYkKcbEsw@mail.gmail.com>

2013/6/25 Priyanki Vashi <vashi.priyanki at gmail.com>

> What is the concept of blocking connection ?
> What difference really it will make over other type of connection ?
>
> Some theory on this would be helpful.
>

Blocking I/O-based connection assumes the caller blocks (waits) until the
response arrives.

With a non-blocking implementation, the caller does not wait, which means
your program can write
continuously but also that responses that arrive at a later point are
handled differently, often
forcing developers to use less familiar APIs and manage program state
differently.

Pika offers you to choose from multiple connection implementations. Michael
suggests you to start with the most straightforward one and when you have
that working,
switch to a non-blocking implementation (e.g. Tornado-based) which often
yields higher
throughput.

http://en.wikipedia.org/wiki/Asynchronous_I/O
http://www.sal.ksu.edu/faculty/tim/ossg/Device/blocking.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/87b7be99/attachment.htm>

From vashi.priyanki at gmail.com  Tue Jun 25 17:39:42 2013
From: vashi.priyanki at gmail.com (PRIYANKI VASHI)
Date: Tue, 25 Jun 2013 18:39:42 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <CAE3HoVS7Pc=XKwQ8fJut3GDw3sT-oNaoGfFw31C6jqYkKcbEsw@mail.gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
	<E1C88E54-1CDC-4820-AA3D-09AF61A2EEF8@gmail.com>
	<CAKgmDnE1fzsZbOhVZXqKS_Pf+x9dgTUUb=5txR=LiMUUPYzR1A@mail.gmail.com>
	<CA+0nT8CSwpg=1=o6QTz+WD0WJzkHEXDhdAFCQLMNCMB3WsA+mw@mail.gmail.com>
	<CAE3HoVS7Pc=XKwQ8fJut3GDw3sT-oNaoGfFw31C6jqYkKcbEsw@mail.gmail.com>
Message-ID: <850295BD-5EE1-4F7E-AE56-F2B60C44A999@gmail.com>

Hi , 

Thanks Micheal and everyone else. 
I got some good insight now on my problems. 

Will try to do some changes based on them and see how it goes. 

Will write back. 

//P

Sent from my iPhone

On 25 jun 2013, at 18:20, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 
> 2013/6/25 Priyanki Vashi <vashi.priyanki at gmail.com>
>> What is the concept of blocking connection ? 
>> What difference really it will make over other type of connection ?
>> 
>> Some theory on this would be helpful.
> 
> 
> Blocking I/O-based connection assumes the caller blocks (waits) until the response arrives.
> 
> With a non-blocking implementation, the caller does not wait, which means your program can write
> continuously but also that responses that arrive at a later point are handled differently, often
> forcing developers to use less familiar APIs and manage program state differently.
> 
> Pika offers you to choose from multiple connection implementations. Michael
> suggests you to start with the most straightforward one and when you have that working,
> switch to a non-blocking implementation (e.g. Tornado-based) which often yields higher
> throughput.
> 
> http://en.wikipedia.org/wiki/Asynchronous_I/O
> http://www.sal.ksu.edu/faculty/tim/ossg/Device/blocking.html
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/f3b6812e/attachment.htm>

From nathan at nkbrown.us  Tue Jun 25 18:22:06 2013
From: nathan at nkbrown.us (Nathan Brown)
Date: Tue, 25 Jun 2013 10:22:06 -0700
Subject: [rabbitmq-discuss] Porting .NET client to WinRT API (Windows 8).
In-Reply-To: <CAE3HoVSsz-XAxjKqv4SPmzMm70fb5jenc305jUvWFy6GL4z1dA@mail.gmail.com>
References: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>
	<518CC1C5.1060008@rabbitmq.com>
	<CAFCmQSofOfwN5B2rdRsALXYfcv-EvcUOYBGorY7xZNyBjBhp9w@mail.gmail.com>
	<CAE3HoVSsz-XAxjKqv4SPmzMm70fb5jenc305jUvWFy6GL4z1dA@mail.gmail.com>
Message-ID: <CAFCmQSov3BcicqMDTveo+gvyVaNePma669nBt_JffyP6FRhvdg@mail.gmail.com>

I've submitted the contributor agreement, and I hope the submitted changes
can now be reviewed and considered for main-line inclusion.

Emile mentioned that this is now under "bug25552", should I re-base my code
to the most recent .net client release and set the branch name to match?

Also, there are really the separate changes that could be made
independently:

   - Corrected test to pull correct value types from
dictionary.<https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/commits/25988f1d5bea8ad86aed536edd4d4fe1826ac43f>
   - Move from non-generic dictionary (.net 1.1) to generic dictionary,
   required, but independent of the next change.  This is my "depreciate1_1"
   branch<https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/commits/branch/depreciate1_1>
   .
   - Add Windows 8/RT code to handle differences in threads and sockets.
   - Threads are removed in favor of Tasks, and sockets have been removed
   in favor of StreamSockts

*



On Sat, May 11, 2013 at 2:05 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/5/12 Nathan Brown <nathan at nkbrown.us>
>
>>  I'm also not familiar with setting up and testing SSL in RabbitMQ.
>
>
> Take a look at http://rabbitmq.com/ssl.html
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/bbdd611e/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun 25 18:25:43 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 25 Jun 2013 21:25:43 +0400
Subject: [rabbitmq-discuss] Porting .NET client to WinRT API (Windows 8).
In-Reply-To: <CAFCmQSov3BcicqMDTveo+gvyVaNePma669nBt_JffyP6FRhvdg@mail.gmail.com>
References: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>
	<518CC1C5.1060008@rabbitmq.com>
	<CAFCmQSofOfwN5B2rdRsALXYfcv-EvcUOYBGorY7xZNyBjBhp9w@mail.gmail.com>
	<CAE3HoVSsz-XAxjKqv4SPmzMm70fb5jenc305jUvWFy6GL4z1dA@mail.gmail.com>
	<CAFCmQSov3BcicqMDTveo+gvyVaNePma669nBt_JffyP6FRhvdg@mail.gmail.com>
Message-ID: <CAE3HoVQ16KxMOccMtazR-BRXx1ktzVLH+Jp--a5rYV980=FqkA@mail.gmail.com>

2013/6/25 Nathan Brown <nathan at nkbrown.us>

> Emile mentioned that this is now under "bug25552", should I re-base my
> code to the most recent .net client release and set the branch name to
> match?


Nathan,

If possible, please rebase it to the tip of the .NET client repo. It would
make merging easier ;)
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/6db1e0dc/attachment.htm>

From nathan at nkbrown.us  Tue Jun 25 18:29:28 2013
From: nathan at nkbrown.us (Nathan Brown)
Date: Tue, 25 Jun 2013 10:29:28 -0700
Subject: [rabbitmq-discuss] Porting .NET client to WinRT API (Windows 8).
In-Reply-To: <CAFCmQSov3BcicqMDTveo+gvyVaNePma669nBt_JffyP6FRhvdg@mail.gmail.com>
References: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>
	<518CC1C5.1060008@rabbitmq.com>
	<CAFCmQSofOfwN5B2rdRsALXYfcv-EvcUOYBGorY7xZNyBjBhp9w@mail.gmail.com>
	<CAE3HoVSsz-XAxjKqv4SPmzMm70fb5jenc305jUvWFy6GL4z1dA@mail.gmail.com>
	<CAFCmQSov3BcicqMDTveo+gvyVaNePma669nBt_JffyP6FRhvdg@mail.gmail.com>
Message-ID: <CAFCmQSqjtDJ4tRXUv70uqsNh5zWqjKrmrJoM3noN88sUQKm_7w@mail.gmail.com>

Accidentally sent the message before I finished.

My questions were:

Is there any feedback on the code I've submitted so far?

For the Windows 8 changes; How should I deal with the split in the
codebase?  Should I use conditional compilation like #ifdef NETFX_CORE, or
use copies of the files that change and links for the ones that don't?  I
personally think that conditional compilation for most changes and only
separate files for the ones that change a lot (like SSL handling) is the
best option.

Thanks,

Nathan


On Tue, Jun 25, 2013 at 10:22 AM, Nathan Brown <nathan at nkbrown.us> wrote:

> I've submitted the contributor agreement, and I hope the submitted changes
> can now be reviewed and considered for main-line inclusion.
>
> Emile mentioned that this is now under "bug25552", should I re-base my
> code to the most recent .net client release and set the branch name to
> match?
>
> Also, there are really the separate changes that could be made
> independently:
>
>    - Corrected test to pull correct value types from dictionary.<https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/commits/25988f1d5bea8ad86aed536edd4d4fe1826ac43f>
>    - Move from non-generic dictionary (.net 1.1) to generic dictionary,
>    required, but independent of the next change.  This is my "depreciate1_1"
>    branch<https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/commits/branch/depreciate1_1>
>    .
>    - Add Windows 8/RT code to handle differences in threads and sockets.
>    - Threads are removed in favor of Tasks, and sockets have been removed
>    in favor of StreamSockts
>
> *
>
>
>
> On Sat, May 11, 2013 at 2:05 PM, Michael Klishin <
> michael.s.klishin at gmail.com> wrote:
>
>> 2013/5/12 Nathan Brown <nathan at nkbrown.us>
>>
>>>  I'm also not familiar with setting up and testing SSL in RabbitMQ.
>>
>>
>> Take a look at http://rabbitmq.com/ssl.html
>> --
>> MK
>>
>> http://github.com/michaelklishin
>> http://twitter.com/michaelklishin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/f2aaecda/attachment.htm>

From lrodriguez1995 at yahoo.com  Tue Jun 25 18:38:47 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Tue, 25 Jun 2013 10:38:47 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq Error:{cannot_discover_cluster,
	"the nodes provided are either offline or not running"}
Message-ID: <1372181927.22674.YahooMailNeo@web141104.mail.bf1.yahoo.com>

Hi all,
I am a newbie trying to figure out how clustering works.
I am running a windows host machine along with three vm's with centos 5.9 , rabbitmq-server-3.0.3, and erlang installed on all three nodes. (host only network, named them rabbit1 at localhost, rabbit2 at localhost, rabbit3 at localhost)

I was able to get all the nodes working (without any clustering), but so far all my clustering attempts have been unsuccessful.
(I am able to ping between nodes fine)
The only thing I have changed has been the addition of an init script (attached pic) to ensure rabbitmq starts automatically.

After reading the tutorials, I copied and pasted the erland cookie (I'd like to think I did it the correct way) to all the nodes(2 pics attached). the cookie hash however, doesn't change regardless of how many times I stop (rabbitmqctl stop) and start.. I don't really know what I'm missing.
In addition, I am able to run? rabbitmq-server -detached, rabbitmqctl cluster_status fine (and I do get the expected results) however, when I do rabbitctl join_cluster I get:

rabbitmq Error:{cannot_discover_cluster,"the nodes provided are either offline or not running"} ..and the rabbitmq management console always show a disc status as well..

please help....

any will be much appreciated.....
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/02f3070d/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2.png
Type: image/png
Size: 164991 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/02f3070d/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 4.png
Type: image/png
Size: 211884 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/02f3070d/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 6.png
Type: image/png
Size: 234155 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/02f3070d/attachment-0005.png>

From richard at raseley.com  Tue Jun 25 20:39:15 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 25 Jun 2013 12:39:15 -0700
Subject: [rabbitmq-discuss] Determining Required Erlang Version for Upgrade
Message-ID: <CAO=6ox_tTVUHNnd4VwPr2zO+iGnjb1Kr5fYT0OEadj-urYRiAA@mail.gmail.com>

I am in the process of drafting a plan to upgrade several 3.0.x instances
to 3.1.2. I cannot seem to find in the release notes the specific version
of Erlang that is required for the new versions.

Would someone please direct me to a version requirement matrix (assuming
one exists)?

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/196f9e67/attachment.htm>

From alan.antonuk at gmail.com  Wed Jun 26 01:36:48 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 25 Jun 2013 17:36:48 -0700
Subject: [rabbitmq-discuss] RabbitMQ Consumer timeout
In-Reply-To: <1372161413983-27590.post@n5.nabble.com>
References: <1372161413983-27590.post@n5.nabble.com>
Message-ID: <CAAt2poJAP5z0-gsdNFaNaH0qzR_FLcxwK_tQEA_tmb=d2CoZiA@mail.gmail.com>

Antony;

rabbitmq-c has very recently added an API that allows for specifying a
timeout when waiting for frames from the broker (see
https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L495 ).
 With this API is possible to implement something with a similar effect.

I will warn you that this is only in the development branch and thus hasn't
received the same amount of testing that tagged versions have, but I would
encourage you to try it out and report back any issues that come up.

-Alan


On Tue, Jun 25, 2013 at 4:56 AM, antony <antony.pulicken at gmail.com> wrote:

> Hi,
>
> This is my scenario:
>
> I have multiple instances of listeners waiting on different temp queues. In
> some of the cases, there won't be any messages published to these temp
> queues and I want these listeners to timeout so that it can free up the
> connections.
>
> I guess in Java, we can achieve this by using the overloaded method in the
> QueueingConsumer class that takes timeout as a parameter as shown below:
>
>
> /QueueingConsumer.Delivery delivery = null;
> long timeout = 2 * 60 * 1000; // 2 minutes in milliseconds
> delivery = queuingConsumer.nextDelivery(*timeout*);
> if (delivery == null) {
>   // shut down your consumer here - no events arrived
>   // before the timeout was reached
> }
> else {
>   // process the delivered message here
> }/
>
>
> 1) Does RabbitMQ C client also has a similar feature ?
>
> 2) Are there better approaches to handle this timeouts ?
>
> Please let me know.
>
> Thanks and Regards,
> Antony.
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Consumer-timeout-tp27590.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/3468600c/attachment.htm>

From taihock at gmail.com  Wed Jun 26 06:24:26 2013
From: taihock at gmail.com (thomas)
Date: Tue, 25 Jun 2013 22:24:26 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ's Mirroring results in weird
 behavior when slave goes down
In-Reply-To: <A888D5A8-3C9F-49D4-82D2-130A4BB0BA66@rabbitmq.com>
References: <1372141680170-27572.post@n5.nabble.com>
	<A888D5A8-3C9F-49D4-82D2-130A4BB0BA66@rabbitmq.com>
Message-ID: <1372224266044-27611.post@n5.nabble.com>

Hi Tim, 

Thanks for the reply. I am using rabbitmq 3.1.1 with autoheal for
cluster_partition_handling.

My test is just to find out the behavior of rabbitmq master should its slave
goes down. For my case, initially I will have rabbit at A, rabbit at B and
rabbit at C running. Then I will send out messages from client to rabbit at A
which is the master throughout the test. Soon after the client started to
send out messages, I will bring down a slave which in my case is rabbit at B by
closing its network connection.

I have changed the net_ticktime to 60 and carry out the same test using the
same code but this time round i increases the number of messages to 500,000
so as to better observe the behavior of sending messages for more than a
minute.

My observation is still similar to that of my previous test where
net_ticktime is 2.
Approximately 10 seconds after I shut down the network connection of
rabbit at B, the sending of messages to rabbit at A comes to a pause for close to
a minute and then continues as per normal.

Trying the same test but with no mirroring does not have any disruption.

By the way, I have try out the same test for rabbitmq mirroring except that
there will be a delay of 10ms between sending every message and there was no
disruption.


From michael.s.klishin at gmail.com  Wed Jun 26 09:19:53 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 26 Jun 2013 12:19:53 +0400
Subject: [rabbitmq-discuss] Determining Required Erlang Version for
	Upgrade
In-Reply-To: <CAO=6ox_tTVUHNnd4VwPr2zO+iGnjb1Kr5fYT0OEadj-urYRiAA@mail.gmail.com>
References: <CAO=6ox_tTVUHNnd4VwPr2zO+iGnjb1Kr5fYT0OEadj-urYRiAA@mail.gmail.com>
Message-ID: <CAE3HoVQG8o6uiMGCU2RmasAv3qVObSF9EdN-+YKqe6-Scjd+-w@mail.gmail.com>

2013/6/25 Richard Raseley <richard at raseley.com>

> I am in the process of drafting a plan to upgrade several 3.0.x instances
> to 3.1.2. I cannot seem to find in the release notes the specific version
> of Erlang that is required for the new versions.


Richard,

I don't think the version requirement changed between 3.0.x and 3.1.x.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/45de3926/attachment.htm>

From emile at rabbitmq.com  Wed Jun 26 10:22:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Jun 2013 10:22:40 +0100
Subject: [rabbitmq-discuss] rabbitmq Error:{cannot_discover_cluster,
 "the nodes provided are either offline or not running"}
In-Reply-To: <1372181927.22674.YahooMailNeo@web141104.mail.bf1.yahoo.com>
References: <1372181927.22674.YahooMailNeo@web141104.mail.bf1.yahoo.com>
Message-ID: <51CAB2E0.9010805@rabbitmq.com>


Hi

On 25/06/13 18:38, Luis Rodriguez wrote:
> I am running a windows host machine along with three vm's with centos
> 5.9 , rabbitmq-server-3.0.3, and erlang installed on all three nodes.

Make sure all nodes are using the same version of Erlang.

> (I am able to ping between nodes fine)

A number of TCP ports need to be open between cluster nodes, which ping
doesn't guarantee. See

 http://www.rabbitmq.com/clustering.html#firewall

> the cookie hash however, doesn't change regardless of how many times
> I stop (rabbitmqctl stop) and start.. I don't really know what I'm
> missing.

If you change the .erlang.cookie and the cookie hash doesn't change then
you are probably copying to the wrong directory. You can discover a
running node's own idea of where its home directory is by executing

rabbitmqctl eval 'init:get_argument(home).'

Also take note that the cookie and the cookie hash will not be the same.
The hash is displayed in diagnostic output instead of the cookie as a
security precaution. If you have all the cookies synchronised correctly
then the hashes will also be the same.

> when I do rabbitctl join_cluster I get: rabbitmq
> Error:{cannot_discover_cluster,"the nodes provided are either offline
> or not running"}

As per the troubleshooting guide

 http://www.rabbitmq.com/troubleshooting.html

if that message is accompanied by a broker logfile entry "Connection
attempt from disallowed node" then the erlang cookies are not set up
correctly. Otherwise the problem is network related.



-Emile







From emile at rabbitmq.com  Wed Jun 26 10:25:52 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Jun 2013 10:25:52 +0100
Subject: [rabbitmq-discuss] Determining Required Erlang Version for
	Upgrade
In-Reply-To: <CAO=6ox_tTVUHNnd4VwPr2zO+iGnjb1Kr5fYT0OEadj-urYRiAA@mail.gmail.com>
References: <CAO=6ox_tTVUHNnd4VwPr2zO+iGnjb1Kr5fYT0OEadj-urYRiAA@mail.gmail.com>
Message-ID: <51CAB3A0.8070707@rabbitmq.com>


Hi Richard,

On 25/06/13 20:39, Richard Raseley wrote:

> Would someone please direct me to a version requirement matrix (assuming
> one exists)?

See http://www.rabbitmq.com/which-erlang.html



-Emile







From emile at rabbitmq.com  Wed Jun 26 10:35:45 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Jun 2013 10:35:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ won't start after the disk went full
In-Reply-To: <1372167490328-27596.post@n5.nabble.com>
References: <1372167490328-27596.post@n5.nabble.com>
Message-ID: <51CAB5F1.20202@rabbitmq.com>


Hi,

On 25/06/13 14:38, photon wrote:

>  I have an issue concerning RabbitMQ. Once my disk got full, RabbitMQ became
> unusable. This didn't change even after i made the disk usage drop
> dramatically. 

You either need to free up more space or lower the disk_free_limit. See
the configuration guide:

 http://www.rabbitmq.com/configure.html

> Error description:
>    {error,corrupt_cluster_status_files,[]}

This is a separate problem and can be solved either by removing the
entire Mnesia directory or by removing the cluster_nodes.config file in
the Mnesia directory and reclustering if necessary.

> =INFO REPORT==== 25-Jun-2013::09:10:49 ===
> Disk free space insufficient. Free bytes:645095424 Limit:1000000000


This shows that there is insufficient free disk space. The broker will
not accept any messages until there is enough free disk space. See

 http://www.rabbitmq.com/memory.html#diskfreesup



-Emile










From tim at rabbitmq.com  Wed Jun 26 11:38:36 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 26 Jun 2013 11:38:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ's Mirroring results in weird
	behavior when slave goes down
In-Reply-To: <1372224266044-27611.post@n5.nabble.com>
References: <1372141680170-27572.post@n5.nabble.com>
	<A888D5A8-3C9F-49D4-82D2-130A4BB0BA66@rabbitmq.com>
	<1372224266044-27611.post@n5.nabble.com>
Message-ID: <2F050250-E7F1-4543-B3C3-239885F7C9CB@rabbitmq.com>

Hi Thomas,

Here are my thoughts (inline below). I'm not the greatest clustering/HA expert, but from what I can gather, I think what you're seeing might be a result of the combination of a network partition and the `autoheal' mode.

On 26 Jun 2013, at 06:24, thomas wrote:

> Hi Tim, 
> 
> Thanks for the reply. I am using rabbitmq 3.1.1 with autoheal for
> cluster_partition_handling.
> 
> My test is just to find out the behavior of rabbitmq master should its slave
> goes down.

This is clearly documented on the website - RabbitMQ clusters /do not/ handle network partitions well. Things will probably go wrong. If the only issue you're running into is a busy producer getting blocked then that's great - the worst cases could have involved lost messages and all sorts.

Now, the intention with HA is *not* to go belly up in the face of disappearing slaves - quite the opposite. Quite why the master is suddenly blocking the producer I'm not sure - I'll discuss this with the rest of the team but it doesn't sound quite right to me.

> Approximately 10 seconds after I shut down the network connection of
> rabbit at B, the sending of messages to rabbit at A comes to a pause for close to
> a minute and then continues as per normal.
> 

Just to be clear, in a RabbitMQ cluster there is no concept of a master node - only mirror queues introduce the master/slave concept, and then only for queues that are mirrored. Each mirrored queue's master can end up on different nodes, depending on which you were connect to when it was declared.

> Trying the same test but with no mirroring does not have any disruption.
> 

That is not surprising, since the queue you're connected to isn't trying to replicate to any other nodes.

> By the way, I have try out the same test for rabbitmq mirroring except that
> there will be a delay of 10ms between sending every message and there was no
> disruption.
> 

Can you share your test code? I'm surprised there is such a big difference, but still... If you've got a decent automated test that consistently replicates this failure mode and you're able to share it, we might be able to use it to make improvements to partition handling in the future. If not code, a test script (and description of how you're disabling the network link) with precise steps would do.

> From my observation it can be seen that RabbitMQ server will exhibit weird
> behavior under stress condition when a slave goes down. I presume this weird
> behavior will only surface under stress condition.
> 

As I've stated before, clustering is not designed to handle network partitions. In previous versions of rabbit, when a partition occurred it was up to a system administrator to handle it. This usually involved stopping some (or all) of the nodes and restarting them. The 'autoheal' feature simply attempts to replicate what a sysadmin might do, and therefore (whilst cluster nodes are restarting) there can be delays. The intention is not to block the master (or producers), but depending on how the cluster partition is handled, that might be one of the potential side effects.

We will certainly take a look to see if this is avoidable - I can't comment on that right now - and being able to repeat the tests could help with that too.

> Is there a rough estimate for the maximum load that a RabbitMQ server can
> take per second for mirroring? Thanks. 
> 

I'm not sure whether mirroring is really the problem here. Mirrored queues can handle plenty of load, although there /is/ some performance slow down due to replication (and esp. so if you're using publisher confirms) but there is a not a specific limit - this is hardware/resource and use-case dependent. I suspect the problem /you/ have could be a combination of network partition and cluster partition resolution (i.e., autoheal) mode.

Based on http://www.rabbitmq.com/partitions.html, what I'd suggest is that you change 'autoheal' to 'ignore' and try your test again. That will either confirm or eliminate my suspicion quickly enough. 

Cheers,
Tim


From ashok.anand at gmail.com  Wed Jun 26 11:45:46 2013
From: ashok.anand at gmail.com (Ashok Anand)
Date: Wed, 26 Jun 2013 16:15:46 +0530
Subject: [rabbitmq-discuss] clarification on secure and unsecure
	communication
Message-ID: <CALQsBOUAbmSWpBmYXKJrDTziBXDf90BRC57OiXtpZAiGjw9P5A@mail.gmail.com>

I have a clarification question. Can we have a configuration where producer
is connected to rabbitmq-server on unsecure channel (since they are both
behind firewall), and the consumer is connected to rabbitmq on secure
channel (agent is outside). Producer will be communicating at port 5672,
while consumer will be connecting over secure channel at port 5671. I am
assuming this should be feasible, since the storing and retrieval of
messages from the queue is decoupled with the ports or the way
(secure/unsecure) that is used to communicate, is that right?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/ecf0ecd9/attachment.htm>

From michael.s.klishin at gmail.com  Wed Jun 26 11:48:41 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 26 Jun 2013 14:48:41 +0400
Subject: [rabbitmq-discuss] clarification on secure and unsecure
	communication
In-Reply-To: <CALQsBOUAbmSWpBmYXKJrDTziBXDf90BRC57OiXtpZAiGjw9P5A@mail.gmail.com>
References: <CALQsBOUAbmSWpBmYXKJrDTziBXDf90BRC57OiXtpZAiGjw9P5A@mail.gmail.com>
Message-ID: <CAE3HoVRi7ChiYGTbgg6itBXzC8yq0TBtY0YEAEnfgAD=94nwvg@mail.gmail.com>

2013/6/26 Ashok Anand <ashok.anand at gmail.com>

> Can we have a configuration where producer is connected to rabbitmq-server
> on unsecure channel (since they are both behind firewall), and the consumer
> is connected to rabbitmq on secure channel (agent is outside). Producer
> will be communicating at port 5672, while consumer will be connecting over
> secure channel at port 5671. I am assuming this should be feasible, since
> the storing and retrieval of messages from the queue is decoupled with the
> ports or the way (secure/unsecure) that is used to communicate, is that
> right?


Ashok,

Yes, that will work just fine.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/4bf43167/attachment.htm>

From tim at rabbitmq.com  Wed Jun 26 13:08:19 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 26 Jun 2013 13:08:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.3 release
Message-ID: <201DB900-6CE7-4A7A-9D26-E11881C9D352@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ
3.1.3.

This release fixes a bug in the federation plugin that lead to incorrect
accumulated stats being reported.

See the attached release notes for more details.

Binary and source distributions of the new release can be found in the
usual place at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.

Regards,
        The RabbitMQ Team



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/fb4ae51b/attachment.htm>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-3.1.3.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/fb4ae51b/attachment.txt>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/fb4ae51b/attachment-0001.htm>

From rohit.yadav at wingify.com  Wed Jun 26 14:06:53 2013
From: rohit.yadav at wingify.com (Rohit Yadav)
Date: Wed, 26 Jun 2013 18:36:53 +0530
Subject: [rabbitmq-discuss] RabbitMQ 3.1.3 release
In-Reply-To: <201DB900-6CE7-4A7A-9D26-E11881C9D352@rabbitmq.com>
References: <201DB900-6CE7-4A7A-9D26-E11881C9D352@rabbitmq.com>
Message-ID: <CAMF++H9FOp7uRNBH+Cpmv330YPRj=bEgePqejttMg33LkXQaHg@mail.gmail.com>

Thanks Tim and the RabbitMQ team.

Cheers.


On Wed, Jun 26, 2013 at 5:38 PM, Tim Watson <tim at rabbitmq.com> wrote:

> The RabbitMQ team is pleased to announce the release of RabbitMQ
> 3.1.3.
>
> This release fixes a bug in the federation plugin that lead to incorrect
> accumulated stats being reported.
>
> See the attached release notes for more details.
>
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
>
> Regards,
>         The RabbitMQ Team
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/ff528c31/attachment.htm>

From lrodriguez1995 at yahoo.com  Wed Jun 26 14:22:55 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Wed, 26 Jun 2013 06:22:55 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq networking error:: telnet result:
	servname not supported for ai_socktype.
Message-ID: <1372252975.56139.YahooMailNeo@web141103.mail.bf1.yahoo.com>

Hi all,
I am a newbie having network connection issues while trying to setup rabbitmq in cluster mode
my setup is 3 centos vm's with rabbitmq-server-3.0.3 and erlang installed on them (host only network).
I am able to ping the three nodes and the initial testing works on single nodes but I cannot seem to communicate between nodes when I try to join a cluster.

> when I do rabbitctl join_cluster I get: rabbitmq
> Error:{cannot_discover_cluster,"the nodes provided are either offline
> or not running"}

My erland cookies are synchronized correctly but still facing this issue..
I disabled the firewalls of the three vm's and tried telnet.

my diagnostics show:
-localhost {rabbit1,12345}? 
and rabbit2:
-localhost{rabbit2,67890}

while inside rabbit1 I did:
# telnet rabbit2 [67890]

rabbit2 /[67890] : servname not supported for ai_socktype.

some tutorials show that I need to insert that port
 inside my etc/services? but I am kind of worried I'll break something else..
how do I proceed about this ?

thanks in advance...

Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/06bd0a53/attachment.htm>

From emile at rabbitmq.com  Wed Jun 26 14:29:42 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Jun 2013 14:29:42 +0100
Subject: [rabbitmq-discuss] rabbitmq networking error:: telnet result:
 servname not supported for ai_socktype.
In-Reply-To: <1372252975.56139.YahooMailNeo@web141103.mail.bf1.yahoo.com>
References: <1372252975.56139.YahooMailNeo@web141103.mail.bf1.yahoo.com>
Message-ID: <51CAECC6.3040200@rabbitmq.com>


Hi Luis,

On 26/06/13 14:22, Luis Rodriguez wrote:

> while inside rabbit1 I did:
> # telnet rabbit2 [67890]

Are you sure the brackets are necessary?

> rabbit2 /[67890] : servname not supported for ai_socktype.

Make sure the hostnames of all the hosts resolve on all the hosts. You
may need entries in /etc/resolv.conf to achieve that.

> some tutorials show that I need to insert that port inside my
> etc/services

The random port numbers used by the Erlang distribution framework change
each time the Erlang VM starts, so there is no value in recording them.
You could record the EPMD port or AMQP, but this is not required to set
up clustering.


-Emile






From simon at rabbitmq.com  Wed Jun 26 14:31:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Jun 2013 14:31:13 +0100
Subject: [rabbitmq-discuss] rabbitmq networking error:: telnet result:
 servname not supported for ai_socktype.
In-Reply-To: <1372252975.56139.YahooMailNeo@web141103.mail.bf1.yahoo.com>
References: <1372252975.56139.YahooMailNeo@web141103.mail.bf1.yahoo.com>
Message-ID: <51CAED21.1070408@rabbitmq.com>

On 26/06/13 14:22, Luis Rodriguez wrote:
> while inside rabbit1 I did:
> # telnet rabbit2 [67890]
>
> rabbit2 /[67890] : servname not supported for ai_socktype.

This is really a telnet question rather than a RabbitMQ one.

I don't know where you got those square brackets from, but they are not 
needed and are the cause of your error message.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From lrodriguez1995 at yahoo.com  Wed Jun 26 16:05:25 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Wed, 26 Jun 2013 08:05:25 -0700 (PDT)
Subject: [rabbitmq-discuss] networking issue when trying to cluster rabbitmq
	nodes
Message-ID: <1372259125.30009.YahooMailNeo@web141101.mail.bf1.yahoo.com>

Hi all,
I am as new as it can get when it comes to rabbitmq.
I am running three vm's with centos 5.9 , rabbitmq-server-3.0.3, 
and erlang installed on all three nodes. (host only network, named them 
rabbit1 at localhost, rabbit2 at localhost, rabbit3 at localhost)

I was able to get all the nodes working (without any clustering), but so far all my clustering attempts have been unsuccessful.
I am able to ping the three nodes and the initial testing works on 
single nodes but I cannot seem to communicate between nodes when I try 
to join a cluster.
I have double checked that my erlang cookies are synchronized..

In addition, I am able to run? rabbitmq-server -detached, rabbitmqctl cluster_status fine (and I do get the expected results) however, when I do rabbitctl join_cluster I get:
rabbitmq Error:{cannot_discover_cluster,"the nodes provided are either offline 
or not running"} ..and the rabbitmq management console always show a 
disc status as well..
I have disabled the firewall on the three vm's..
I have also tried telneting between them and the results were the following:

from rabbit1 to rabbit 3 -> connected
from rabbit1 to rabbit2 -> connected

from rabbit 2 to rabbit3 -> connection timed out
from rabbit 2 to rabbit 1 ->  connection refused

from rabbit3 to rabbit 2 -> connected
from rabbit 3 to rabbit1 -> connection refused

my etc/hosts are correctly setup
There is nothing however, when I tried opening  /etc/resolv.conf (using gedit resolv.conf)
not really sure if? I might need entries, I'm not really sure the how to :(?? (do I
 need to write them the same way I have them in the etc/hosts ????? ex: 
for rabbit3:? xxx.xxx.xx.xx rabbit1? , xxx.xxx.xx.xx
 rabbit2? )

thanks in advance :)

Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/8b2dfdfb/attachment.htm>

From emile at rabbitmq.com  Wed Jun 26 16:16:15 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Jun 2013 16:16:15 +0100
Subject: [rabbitmq-discuss] networking issue when trying to cluster
 rabbitmq nodes
In-Reply-To: <1372259125.30009.YahooMailNeo@web141101.mail.bf1.yahoo.com>
References: <1372259125.30009.YahooMailNeo@web141101.mail.bf1.yahoo.com>
Message-ID: <51CB05BF.2030404@rabbitmq.com>



Hi Luis,

On 26/06/13 16:05, Luis Rodriguez wrote:
> I have disabled the firewall on the three vm's..

Is there anything else that might be preventing access? Are any other
applications on these nodes able to communicate? Clustering will not
work unless TCP/IP networking is in place.

> from rabbit 2 to rabbit3 -> connection timed out
> from rabbit 2 to rabbit 1 -> connection refused

> from rabbit 3 to rabbit1 -> connection refused

You don't say which port you used but the EPMD and AMQP ports at least
should be open and the failing connections above need to succeed before
clustering will work.

> There is nothing however, when I tried opening /etc/resolv.conf (using
> gedit resolv.conf)


You would perhaps need to edit this to set up hostname resolution, e.g.
to set up a different resolver or search domain. If you are confident
that name resolution is working correctly then you don't need to edit this.




-Emile






From vashi.priyanki at gmail.com  Wed Jun 26 18:45:35 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Wed, 26 Jun 2013 10:45:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Queries on processes connected to RabbitMQ node
Message-ID: <e55cd3d3-e21e-4801-8321-f511327baf55@googlegroups.com>


Hi there ,

Can anyone throw some light on different processes, which get started when 
I run ./rabbitmq-server start. 

As an example I am putting details of different processes, which gets 
started. I have four node cluster and following is for two of the node 
started on port 5672 & 5675. Each node is showing total of 6 processes and 
then there is epmd daemon process. Same way I have rest of the two nodes 
and each having 6 processes connected to it. 
If I understand correctly out of this 6 process, one is parent process and 
rest 5 are child process as we can see from pid and ppid. Is it correct way 
to interpret this ? 


I want to understand this thoroughly, bcoz 

1) First thing, I wanted to tie every single node of my cluster to the 
specific CPU using linux 'taskset -c cpu -p pid' command. I have total of 
20 cpus so this how I want to control resources to understand how it scales 
with respect to CPU and what load every CPU would be under when I do stress 
testing with multiple producer and consumer.

2) Secondly I am also interested to measure the load on each CPU as a part 
of stress testings. So what is the suitable method to measure CPU load. I 
googled on this on internet and found either by using script or manually 
reading %cpu for every processes and addind them together to get total 
utilization of CPU. Is this correct way one can understand CPU utilization 
or ? 

3) Third thing was, Is the epmd -daemon is the First parent process, which 
is in the end of the list and probably started when I started my very first 
node. Though I am not sure since I did not track processes after every node 
starting. It's not very clear to me what is the importance of this process 
? 

4) Also, in rabbitmq management plugin there is a field called 'Erlang 
Processes', which shows numbers in the range of 120-130 for every node of 
my cluster. Is this really the number of Erlang process started by every 
node ?
    Even if there is no messages sent and received, this is the number. 
Will it increase with increase on load while running multiple producer and 
consumer ? 
    how does it map to the processes listed below for every node. What 
happens in theory if I kill this manually. (Since I don't want to disturb 
current setup so not trying and asking in the forum)

5) Lastly, is the below list covers all the processes, when rabbitmq node 
is started or I should grep on something else as well ? 

Thank you and hope so I can get some insight on my questions !

Best Regards,
Priyanki. 


I have four node cluster and when I grep on rabbitmq I see following set of 
processes connected with each node. As an example just pasted only two 
nodes printout.

root       7014      1  0 jun08 ?        00:00:00 /bin/sh 
/usr/sbin/rabbitmq-server
root       7021   7014  0 jun08 ?        00:00:00 su rabbitmq -s /bin/sh -c 
/usr/lib/rabbitmq/bin/rabbitmq-server 
rabbitmq   7030   7021  0 jun08 ?        00:00:00 sh -c 
/usr/lib/rabbitmq/bin/rabbitmq-server 
rabbitmq   7031   7030  3 jun08 ?        13:57:12 
/usr/lib/erlang/erts-5.10.1/bin/beam.smp -W w -K true -A30 -P 1048576 -- 
-root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/../ebin -noshell -noinput 
-s rabbit boot -sname rabbit8 -boot start_sasl -kernel 
inet_default_connect_options [{nodelay,true}] -rabbit tcp_listeners 
[{"auto",5675}] -sasl errlog_type error -sasl sasl_error_logger false 
-rabbit error_logger {file,"/var/log/rabbitmq/rabbit8.log"} -rabbit 
sasl_error_logger {file,"/var/log/rabbitmq/rabbit8-sasl.log"} -rabbit 
enabled_plugins_file "/etc/rabbitmq/enabled_plugins" -rabbit plugins_dir 
"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/../plugins" -rabbit 
plugins_expand_dir "/var/lib/rabbitmq/mnesia/rabbit8-plugins-expand" 
-os_mon start_cpu_sup false -os_mon start_disksup false -os_mon 
start_memsup false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit8" 
-rabbitmq_management listener [{port,15675}]
rabbitmq   7152   7031  0 jun08 ?        00:00:00 inet_gethost 4
rabbitmq   7153   7152  0 jun08 ?        00:00:00 inet_gethost 4
root       9570      1  0 jun08 ?        00:00:00 /bin/sh 
/usr/sbin/rabbitmq-server
root       9577   9570  0 jun08 ?        00:00:00 su rabbitmq -s /bin/sh -c 
/usr/lib/rabbitmq/bin/rabbitmq-server 
rabbitmq   9586   9577  0 jun08 ?        00:00:00 sh -c 
/usr/lib/rabbitmq/bin/rabbitmq-server 
rabbitmq   9587   9586  3 jun08 ?        14:54:43 
/usr/lib/erlang/erts-5.10.1/bin/beam.smp -W w -K true -A30 -P 1048576 -- 
-root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/../ebin -noshell -noinput 
-s rabbit boot -sname rabbit5 -boot start_sasl -kernel 
inet_default_connect_options [{nodelay,true}] -rabbit tcp_listeners 
[{"auto",5672}] -sasl errlog_type error -sasl sasl_error_logger false 
-rabbit error_logger {file,"/var/log/rabbitmq/rabbit5.log"} -rabbit 
sasl_error_logger {file,"/var/log/rabbitmq/rabbit5-sasl.log"} -rabbit 
enabled_plugins_file "/etc/rabbitmq/enabled_plugins" -rabbit plugins_dir 
"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/../plugins" -rabbit 
plugins_expand_dir "/var/lib/rabbitmq/mnesia/rabbit5-plugins-expand" 
-os_mon start_cpu_sup false -os_mon start_disksup false -os_mon 
start_memsup false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit5" 
-rabbitmq_management listener [{port,15672}]
rabbitmq   9708   9587  0 jun08 ?        00:00:00 inet_gethost 4
rabbitmq   9709   9708  0 jun08 ?        00:00:00 inet_gethost 4
root      71464  68985  0 03:14 pts/14   00:00:00 grep --color=auto rabbitmq
rabbitmq 228340      1  0 jun07 ?        00:00:11 
/usr/lib/erlang/erts-5.10.1/bin/epmd -daemon

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/7b512194/attachment.htm>

From vashi.priyanki at gmail.com  Wed Jun 26 18:52:19 2013
From: vashi.priyanki at gmail.com (Priyanki Vashi)
Date: Wed, 26 Jun 2013 19:52:19 +0200
Subject: [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1
In-Reply-To: <850295BD-5EE1-4F7E-AE56-F2B60C44A999@gmail.com>
References: <CA+0nT8DALYiz=pKDXe3sS6C2b=4yB0sjgNZ+0+rkCdH6iSOcbw@mail.gmail.com>
	<51C979AF.6070001@rabbitmq.com>
	<CA+0nT8Dpi-MB-Bp06mt60pitS9KPMnWyW=ZMsAWMT79rW9k8JA@mail.gmail.com>
	<51C99446.4000908@rabbitmq.com>
	<CAKgmDnGywrTd-Qk5r98GCHcH6CMxmW6vtcY-cPGnjXV8Mn+CZg@mail.gmail.com>
	<E1C88E54-1CDC-4820-AA3D-09AF61A2EEF8@gmail.com>
	<CAKgmDnE1fzsZbOhVZXqKS_Pf+x9dgTUUb=5txR=LiMUUPYzR1A@mail.gmail.com>
	<CA+0nT8CSwpg=1=o6QTz+WD0WJzkHEXDhdAFCQLMNCMB3WsA+mw@mail.gmail.com>
	<CAE3HoVS7Pc=XKwQ8fJut3GDw3sT-oNaoGfFw31C6jqYkKcbEsw@mail.gmail.com>
	<850295BD-5EE1-4F7E-AE56-F2B60C44A999@gmail.com>
Message-ID: <CA+0nT8B+JdePR20=m5MhRJjhT+kwhCfzMGr-kWBJm1KMLJnFCw@mail.gmail.com>

Hi again,

When I changed the connection from blocking to non-blocking (using select
connection method) my throughput has increased hugely.
Also correctly configured publisher confirm as per yesterday's suggestions.

I am yet to try different things but from the initial tests on high end
server now I can see I can publish 8000 msg/Sec with single publisher and
no consumer.
On my macbook I get 1800 msg/sec throughput with single producer and single
consumer.

Thank you all again. It was very helpful for my work. I will not try to
simulate multiple producers/consumers using this improvements and see what
throughout I get.

//P


On Tue, Jun 25, 2013 at 6:39 PM, PRIYANKI VASHI <vashi.priyanki at gmail.com>wrote:

> Hi ,
>
> Thanks Micheal and everyone else.
> I got some good insight now on my problems.
>
> Will try to do some changes based on them and see how it goes.
>
> Will write back.
>
> //P
>
> Sent from my iPhone
>
> On 25 jun 2013, at 18:20, Michael Klishin <michael.s.klishin at gmail.com>
> wrote:
>
>
> 2013/6/25 Priyanki Vashi <vashi.priyanki at gmail.com>
>
>> What is the concept of blocking connection ?
>> What difference really it will make over other type of connection ?
>>
>> Some theory on this would be helpful.
>>
>
> Blocking I/O-based connection assumes the caller blocks (waits) until the
> response arrives.
>
> With a non-blocking implementation, the caller does not wait, which means
> your program can write
> continuously but also that responses that arrive at a later point are
> handled differently, often
> forcing developers to use less familiar APIs and manage program state
> differently.
>
> Pika offers you to choose from multiple connection implementations. Michael
> suggests you to start with the most straightforward one and when you have
> that working,
> switch to a non-blocking implementation (e.g. Tornado-based) which often
> yields higher
> throughput.
>
> http://en.wikipedia.org/wiki/Asynchronous_I/O
> http://www.sal.ksu.edu/faculty/tim/ossg/Device/blocking.html
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
>
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/158629eb/attachment.htm>

From richard at raseley.com  Wed Jun 26 19:03:32 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 26 Jun 2013 11:03:32 -0700
Subject: [rabbitmq-discuss] Determining Required Erlang Version for
	Upgrade
In-Reply-To: <51CAB3A0.8070707@rabbitmq.com>
References: <CAO=6ox_tTVUHNnd4VwPr2zO+iGnjb1Kr5fYT0OEadj-urYRiAA@mail.gmail.com>
	<51CAB3A0.8070707@rabbitmq.com>
Message-ID: <CAO=6ox8JgkGHu23Mb_0dhoHgytKcfGqjefAHgMVa4QvJo=cqRg@mail.gmail.com>

Emile,

Thanks so much for that information.

Regards,

Richard


On Wed, Jun 26, 2013 at 2:25 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Richard,
>
> On 25/06/13 20:39, Richard Raseley wrote:
>
> > Would someone please direct me to a version requirement matrix (assuming
> > one exists)?
>
> See http://www.rabbitmq.com/which-erlang.html
>
>
>
> -Emile
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/93afd7b0/attachment.htm>

From lrodriguez1995 at yahoo.com  Wed Jun 26 19:14:24 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Wed, 26 Jun 2013 11:14:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Error:{cannot_discover_cluster,
	"the nodes provided are either offline or not running"}
Message-ID: <1372270464.92337.YahooMailNeo@web141106.mail.bf1.yahoo.com>

Hi all,
I am a newbie having network connection issues while trying to setup rabbitmq in cluster mode
my setup is 3 centos vm's with rabbitmq-server-3.0.3 and erlang installed on them (host only network).(named them rabbit1 at localhost, rabbit2 at localhost, rabbit3 at localhost)
I am able to ping the three nodes and the initial testing works on single nodes but I cannot seem to communicate between nodes when I try to join a cluster.
I disabled the firewalls for all three.
In addition, I am able to telnet between them without any issues ( finally got this working)
the etc/hosts file is working fine as well

the erlang cookies are synchronized on all three nodes(double verified)

> when I do (rabbitmqctl join_cluster rabbit1)? I get:
rabbitmq Error:{cannot_discover_cluster,"the nodes provided are either offlineor not running"}

Not really sure what I'm missing here?
please Help...



Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/3da2888b/attachment.htm>

From michael.s.klishin at gmail.com  Wed Jun 26 19:30:10 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 26 Jun 2013 22:30:10 +0400
Subject: [rabbitmq-discuss] Queries on processes connected to RabbitMQ
	node
In-Reply-To: <e55cd3d3-e21e-4801-8321-f511327baf55@googlegroups.com>
References: <e55cd3d3-e21e-4801-8321-f511327baf55@googlegroups.com>
Message-ID: <CAE3HoVTT=70tE=mGLj_MHn0LPX4dywfHrBakYn3Q5advLzduXg@mail.gmail.com>

2013/6/26 Priyanki Vashi <vashi.priyanki at gmail.com>

Some of what ps presents as probably kernel threads but you should not
worry about it.

1) First thing, I wanted to tie every single node of my cluster to the
> specific CPU using linux 'taskset -c cpu -p pid' command. I have total of
> 20 cpus so this how I want to control resources to understand how it scales
> with respect to CPU and what load every CPU would be under when I do stress
> testing with multiple producer and consumer.
>
>
I doubt manual CPU pinning will yield better results than just relying on
the Erlang runtime scheduler to do its job.
It's probably the most advanced component of the runtime.

It is a very good idea to run Erlang R16B if you have 20 CPUs.


> 2) Secondly I am also interested to measure the load on each CPU as a part
> of stress testings. So what is the suitable method to measure CPU load. I
> googled on this on internet and found either by using script or manually
> reading %cpu for every processes and addind them together to get total
> utilization of CPU. Is this correct way one can understand CPU utilization
> or ?
>
>
Monitor CPU load periodically over the course of your entire test (ideally,
tens of minutes or hours).


> 3) Third thing was, Is the epmd -daemon is the First parent process, which
> is in the end of the list and probably started when I started my very first
> node. Though I am not sure since I did not track processes after every node
> starting. It's not very clear to me what is the importance of this process
> ?
>
>
epmd is Erlang Port Mapper Daemon. It's a process Erlang nodes use to
communicate with each other. In simpler
terms, distributed Erlang features (which RabbitMQ uses) cannot operate if
epmd is not running.

You can read more about it in the docs:
http://www.erlang.org/doc/man/epmd.html


> 4) Also, in rabbitmq management plugin there is a field called 'Erlang
> Processes', which shows numbers in the range of 120-130 for every node of
> my cluster. Is this really the number of Erlang process started by every
> node ?
>     Even if there is no messages sent and received, this is the number.
> Will it increase with increase on load while running multiple producer and
> consumer ?
>     how does it map to the processes listed below for every node. What
> happens in theory if I kill this manually. (Since I don't want to disturb
> current setup so not trying and asking in the forum)
>
>
Quite possible. Erlang processes are extremely lightweight, you can spawn a
million of them, deliver a message
to each and tear them down in less than a second on reasonably modern
hardware. So Erlang services often
have hundreds or thousands of processes, or even more. It varies depending
on the number of concurrent
connections/clients, consumers, channels, queues and so on, in other words,
your workload.

They have nothing to do with [fairly expensive in terms of resources] OS
thread or OS processes.


> 5) Lastly, is the below list covers all the processes, when rabbitmq node
> is started or I should grep on something else as well ?
>

epmd and beam (which is the name of the modern Erlang VM) are two key OS
processes that use kernel
threads for various purposes.

I'd suggest making sure those two function without issues, trying to kill
"inessential" OS processes or threads
will likely compromise RabbitMQ integrity.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/6fbdacb9/attachment.htm>

From jochenzeischka at gmail.com  Wed Jun 26 15:36:02 2013
From: jochenzeischka at gmail.com (Jochen Zeischka)
Date: Wed, 26 Jun 2013 07:36:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Feature request: move messages using management
	UI
Message-ID: <34f5d415-8f39-465c-9138-3d0e09ef069d@googlegroups.com>

At our company, we've written a tool to move messages from their 
dead-letter queues back to the original queue.

Would it make sense to be able to do so from the management UI? 
The feature I'm looking for is the ability to move messages from one queue 
to another queue.

Kind regards!

Jochen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/3d0601f3/attachment.htm>

From tbain98 at gmail.com  Wed Jun 26 17:50:38 2013
From: tbain98 at gmail.com (tbain98 at gmail.com)
Date: Wed, 26 Jun 2013 09:50:38 -0700 (PDT)
Subject: [rabbitmq-discuss] TCP vs. SSL configuration
Message-ID: <567bd7a8-b428-4663-85a4-3932ac7d9a18@googlegroups.com>

I'm new to RabbitMQ, and am a bit confused by some of the documentation 
surrounding TCP vs. SSL configuration.

I'm trying to set up a broker for which only authenticated SSL-based 
connections will be allowed, so I do not want the TCP listener running.  
That seems easy to do for rabbitmq-env.conf, but the documentation<http://www.rabbitmq.com/configure.html>seems to indicate that RABBITMQ_NODE_PORT is a required property (or at 
least, it seems to be required if you're setting up clustering on a single 
machine <http://www.rabbitmq.com/clustering.html#single-machine>, which I'm 
not doing yet but want the option to do in the future) and that if it's not 
provided, a default will be used.

Is it possible to configure an SSL-only broker (just one node on a single 
machine), and if so, what if anything do you set RABBITMQ_NODE_PORT to?  
(Just "RABBITMQ_NODE_PORT=" ?)  And (separate question) is it possible to 
configure a single-machine cluster with multiple nodes, where each node is 
SSL-only, and again, what do you set RABBITMQ_NODE_PORT to for each node?

Thanks for the help...
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/4e464b1c/attachment.htm>

From rohit.yadav at wingify.com  Wed Jun 26 23:57:26 2013
From: rohit.yadav at wingify.com (Rohit Yadav)
Date: Thu, 27 Jun 2013 04:27:26 +0530
Subject: [rabbitmq-discuss] RabbitMQ publisher confirms behaviour
Message-ID: <CAMF++H8Of4FNg5cEKounhQxVqNixe5LaEfSfjot4McgUHapKEg@mail.gmail.com>

Hi,

I want to understand how publisher confirms [1] work internally and
asynchronously. The async publisher example [2] _deliveries is a list of
message number which were published and when they are confirmed, these
numbers are removed from _deliveries.

What happens when a durable message is published with publisher confirms
and the producer is stopped, i.e. we don't know if a confirm was received.
In such a case if the message reaches the broker but the broker fails to
send confirms back, is the message dropped? When I stop the consumer I wait
to receive any leftover confirms and I see that even after say 60s the
_deliveries is not empty. How may I make sure messages which were sent
confirm asynchronously and if I should wait for sometime before closing the
channel how may I determine the wait time period?

How does confirms work internally at the broker level, as in the latest
RabbitMQ server.

[1] http://www.rabbitmq.com/confirms.html
[2]
https://pika.readthedocs.org/en/latest/examples/asynchronous_publisher_example.html

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/bae83ee6/attachment.htm>

From taihock at gmail.com  Thu Jun 27 02:18:53 2013
From: taihock at gmail.com (thomas)
Date: Wed, 26 Jun 2013 18:18:53 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ's Mirroring results in weird
 behavior when slave goes down
In-Reply-To: <2F050250-E7F1-4543-B3C3-239885F7C9CB@rabbitmq.com>
References: <1372141680170-27572.post@n5.nabble.com>
	<A888D5A8-3C9F-49D4-82D2-130A4BB0BA66@rabbitmq.com>
	<1372224266044-27611.post@n5.nabble.com>
	<2F050250-E7F1-4543-B3C3-239885F7C9CB@rabbitmq.com>
Message-ID: <1372295933370-27633.post@n5.nabble.com>

Hi Tim, 

I have tried using ignore instead of autoheal for cluster_partition_handling
but the pause still persist, but the pause begins approximately 20 seconds
after bringing down the mirror node. 

Below is the code for my sender:
send.txt <http://rabbitmq.1065348.n5.nabble.com/file/n27633/send.txt>  

My rabbitmq server is running on Ubuntu 12.04 with erlang 16B.

The following steps are what I did:
1) I begin with all rabbitmq servers down.
2) I started rabbitmq server in the following sequence: rabbit at A , rabbit at B,
rabbit at C
3) I started my client to begin sending messages
4) I shut down the network connection for rabbti at B using ifconfig
<interface> down
5) I observe the output from the client 

Please kindly let me know if you experience the same problem as I can't be
sure if there could be any problem on my side which I doubt so. Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-s-Mirroring-results-in-weird-behavior-when-slave-goes-down-tp27572p27633.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Thu Jun 27 07:52:01 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Jun 2013 07:52:01 +0100
Subject: [rabbitmq-discuss] cluster memory alarm blocks producer too long
In-Reply-To: <1371700372306-27507.post@n5.nabble.com>
References: <6585d4ed-400d-451f-8dc4-511900bf4e45@googlegroups.com>
	<51C18169.7080108@rabbitmq.com>
	<1371700372306-27507.post@n5.nabble.com>
Message-ID: <51CBE111.5060905@rabbitmq.com>

On 20/06/13 04:52, richmonkey wrote:
> slave?
>   {memory,
>       [{total,3345436680},
>        {queue_procs,2660479408},
>  {vm_memory_limit,3301285888},
> master:
>   {memory,
>       [{total,1523362624},
>        {queue_procs,1318303888},
>   {vm_memory_limit,3301285888},

So the memory is being used by the queues, which is to be expected. It 
is also not surprising to, generally, see higher memory consumption at 
the slave, due to the way mirrored queues are implemented. However, just 
like the master, the slave should be paging messages to disk to free up 
memory. The slave may have to page a bit more than the master, but not 
to the degree that would cause the massive difference in memory alarm 
behaviour.

Please post

1) the output of 'rabbitmqctl report' when the slave has been in the 
memory alarm state for a while

2) code that may allow us to reproduce the problem


Regards,

Matthias.

From matthias at rabbitmq.com  Thu Jun 27 08:13:43 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Jun 2013 08:13:43 +0100
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <1371828652524-27539.post@n5.nabble.com>
References: <2D85327D-767E-4F1E-81E5-9E5DBA9BC061@rabbitmq.com>
	<1371738381944-27522.post@n5.nabble.com>
	<CAE3HoVQ37SfqcpV8wJXBvZCaCX7shw4FAG-NEUsv9ZX5WrDdmg@mail.gmail.com>
	<1371740405967-27525.post@n5.nabble.com>
	<CAE3HoVTz_MBf-8ZBCBHg6M81AZieExV2AFK3i+10z+3b4MJuSw@mail.gmail.com>
	<1371749143163-27528.post@n5.nabble.com>
	<06A0347F-8B7A-41BA-A9DA-50F8B9794CAA@gmail.com>
	<1371751080473-27530.post@n5.nabble.com>
	<CAAF2BFC-CD7E-47EF-AE80-AC6E21493498@rabbitmq.com>
	<51C42E40.700@rabbitmq.com>
	<1371828652524-27539.post@n5.nabble.com>
Message-ID: <51CBE627.6040809@rabbitmq.com>

On 21/06/13 16:30, k.madnani84 wrote:
> I checked the cookie value multiple times.In fact i tried multiple deinstall
> and install but the output is same.

Please check again. In particular...

1) make sure you have a completely standard install of rabbitmq, i.e. no 
modified startup scripts, etc

2) start both nodes

3) from each node, post the startup message from the regular rabbit log, 
*not* the startup log, including the time stamp (make sure it's the most 
recent startup message and not an earlier one). It should look something 
like this:

=INFO REPORT==== 22-Jun-2013::01:06:34 ===
Starting RabbitMQ 3.1.1 on Erlang R16B
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 22-Jun-2013::01:06:34 ===
node           : rabbit at i
home dir       : /home/matthias
config file(s) : (none)
cookie hash    : EBfKWfDVqK1tXqxqZfOGkw==
log            : /tmp/rabbit at i.log
sasl log       : /tmp/rabbit at i-sasl.log
database dir   : /tmp/rabbitmq-rabbit-mnesia

4) from each node, take the value of the 'home dir' from the startup 
message and post the output of

cat <the-home-dir>/.erlang.cookie


If it turns out that the files are indeed identical and yet the reported 
hashes are different, then something seriously odd is going on. If so, 
could you give us access to these machines so we can investigate?


Regards,

Matthias.

From matthias at rabbitmq.com  Thu Jun 27 08:21:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Jun 2013 08:21:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ reliance on Java Virtual Machine
In-Reply-To: <dc0f6e3b-e459-4d09-9e99-34b29fa24eeb@googlegroups.com>
References: <5d2a82d9-461f-4cec-aa03-a2673e6d67fc@googlegroups.com>
	<CACOPnvdtBPbTwwjR7-Yz7+SsVkeJ27-fJTWEiiOVs32Qb9q-Jg@mail.gmail.com>
	<dc0f6e3b-e459-4d09-9e99-34b29fa24eeb@googlegroups.com>
Message-ID: <51CBE7EC.2000108@rabbitmq.com>

Brendan,

On 24/06/13 08:08, Brendan Fry wrote:
> Looking forward to the discussions about Erlang security on Windows,
> since it is something that we know very little about.

Neither do we.

However, there are many production deployments of RabbitMQ on Windows, 
so perhaps some of these users could post about their experience?

Also, for questions around Erlang (rather than RabbitMQ) security, 
erlang-questions is probably your best bet.

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Jun 27 08:30:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Jun 2013 08:30:21 +0100
Subject: [rabbitmq-discuss] rabbitmq clustering issues
In-Reply-To: <1372121402.97283.YahooMailNeo@web141103.mail.bf1.yahoo.com>
References: <1372121402.97283.YahooMailNeo@web141103.mail.bf1.yahoo.com>
Message-ID: <51CBEA0D.1020507@rabbitmq.com>

On 25/06/13 01:50, Luis Rodriguez wrote:
> running a windows host with three virtual machines running centos 5.9
>  and have them in a host only network. I have rabbitmq server 3.0.3
> installed in all three vm's along with erlang (named the nodes
> rabbit1 at localhost,rabbit2 at localhost,rabbit3 at localhost)

There is your problem. If all three nodes have a host name of
'localhost', how are they going to find each other?

The host name component of the node name must correspond to the host
name of each of your VMs. And these host names must be resolvable on all 
VMs.

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Jun 27 08:36:32 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Jun 2013 08:36:32 +0100
Subject: [rabbitmq-discuss] Queries on processes connected to RabbitMQ
 node
In-Reply-To: <CAE3HoVTT=70tE=mGLj_MHn0LPX4dywfHrBakYn3Q5advLzduXg@mail.gmail.com>
References: <e55cd3d3-e21e-4801-8321-f511327baf55@googlegroups.com>
	<CAE3HoVTT=70tE=mGLj_MHn0LPX4dywfHrBakYn3Q5advLzduXg@mail.gmail.com>
Message-ID: <51CBEB80.1010401@rabbitmq.com>

On 26/06/13 19:30, Michael Klishin wrote:
> 2013/6/26 Priyanki Vashi <vashi.priyanki at gmail.com
>     1) First thing, I wanted to tie every single node of my cluster to
>     the specific CPU using linux 'taskset -c cpu -p pid' command. I have
>     total of 20 cpus so this how I want to control resources to
>     understand how it scales with respect to CPU and what load every CPU
>     would be under when I do stress testing with multiple producer and
>     consumer.
>
> I doubt manual CPU pinning will yield better results than just relying
> on the Erlang runtime scheduler to do its job.

Indeed. The Erlang VM will happily use all the cores it can get. So on 
your 20-core machine, you'll want to run a single rabbit, not a cluster 
of 20.

Matthias.

From videlalvaro at gmail.com  Thu Jun 27 08:40:07 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 27 Jun 2013 09:40:07 +0200
Subject: [rabbitmq-discuss] set/getTimeout in RabbitMQ for PHP
In-Reply-To: <d67b7628-5823-436d-8bfb-a195e346227b@googlegroups.com>
References: <d67b7628-5823-436d-8bfb-a195e346227b@googlegroups.com>
Message-ID: <CAMcAHLXAisK-ou6PDNZLSqsq5YDd8sfizDRMtLbtsdXziDo06w@mail.gmail.com>

Hi,

I've never used this library. Maybe there's a bug there. Have you tried
contacted the library authors?

In any case, there's also http://github.com/videlalvaro/php-amqplib which
supports timeouts on the "wait" method:
https://github.com/videlalvaro/php-amqplib/blob/master/PhpAmqpLib/Channel/AbstractChannel.php#L174

Regards,

Alvaro



On Wed, Jun 19, 2013 at 8:40 AM, Iliya Isd <iliyaisd at gmail.com> wrote:

> Hello! Having the next problem, maybe somebody has issued that.
> I'm trying to use the next function:
> http://php.net/manual/ru/amqpconnection.settimeout.php
> but nothing changes. Timeout isn't working. Thereby there's no way to
> avoid hanging up the site when trying to send message to rabbitMQ...
> Any ideas?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/b21a7ad1/attachment.htm>

From watson.timothy at gmail.com  Thu Jun 27 09:06:17 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 27 Jun 2013 09:06:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.1.3 release
In-Reply-To: <201DB900-6CE7-4A7A-9D26-E11881C9D352@rabbitmq.com>
References: <201DB900-6CE7-4A7A-9D26-E11881C9D352@rabbitmq.com>
Message-ID: <00F7761B-7D6E-4CA2-B60F-28D4FE470AD1@rabbitmq.com>

Quick correction: the 3.1.3 release fixes a bug in the management plugin, not the federation plugin. Sorry for any confusion!

Tim

On 26 Jun 2013, at 13:08, Tim Watson <tim at rabbitmq.com> wrote:

> The RabbitMQ team is pleased to announce the release of RabbitMQ
> 3.1.3.
> 
> This release fixes a bug in the federation plugin that lead to incorrect
> accumulated stats being reported.
> 
> See the attached release notes for more details.
> 
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
> 
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
> 
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
> 
> Regards,
>         The RabbitMQ Team
> 
> <README-3.1.3.txt>
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/c68ccd2a/attachment.htm>

From umutcan at gamegos.com  Thu Jun 27 09:27:30 2013
From: umutcan at gamegos.com (Umutcan)
Date: Thu, 27 Jun 2013 11:27:30 +0300
Subject: [rabbitmq-discuss] set/getTimeout in RabbitMQ for PHP
In-Reply-To: <CAMcAHLXAisK-ou6PDNZLSqsq5YDd8sfizDRMtLbtsdXziDo06w@mail.gmail.com>
References: <d67b7628-5823-436d-8bfb-a195e346227b@googlegroups.com>
	<CAMcAHLXAisK-ou6PDNZLSqsq5YDd8sfizDRMtLbtsdXziDo06w@mail.gmail.com>
Message-ID: <51CBF772.4070701@gamegos.com>

Hi,

There is setTimeout(),setReadTimeout(),setWriteTimeout(). setTimeout is 
deprecated in the latest version.

These timeouts does not work if you are having problems in connection 
time. They all works after client is connected. There is an issue about 
this: https://github.com/pdezwart/php-amqp/issues/63

Regards,
Umutcan
On 06/27/2013 10:40 AM, Alvaro Videla wrote:
> Hi,
>
> I've never used this library. Maybe there's a bug there. Have you 
> tried contacted the library authors?
>
> In any case, there's also http://github.com/videlalvaro/php-amqplib 
> which supports timeouts on the "wait" method: 
> https://github.com/videlalvaro/php-amqplib/blob/master/PhpAmqpLib/Channel/AbstractChannel.php#L174
>
> Regards,
>
> Alvaro
>
>
>
> On Wed, Jun 19, 2013 at 8:40 AM, Iliya Isd <iliyaisd at gmail.com 
> <mailto:iliyaisd at gmail.com>> wrote:
>
>     Hello! Having the next problem, maybe somebody has issued that.
>     I'm trying to use the next function:
>     http://php.net/manual/ru/amqpconnection.settimeout.php
>     but nothing changes. Timeout isn't working. Thereby there's no way
>     to avoid hanging up the site when trying to send message to
>     rabbitMQ...
>     Any ideas?
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/2eec5400/attachment.htm>

From simon at rabbitmq.com  Thu Jun 27 10:31:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Jun 2013 10:31:25 +0100
Subject: [rabbitmq-discuss] TCP vs. SSL configuration
In-Reply-To: <567bd7a8-b428-4663-85a4-3932ac7d9a18@googlegroups.com>
References: <567bd7a8-b428-4663-85a4-3932ac7d9a18@googlegroups.com>
Message-ID: <51CC066D.4060809@rabbitmq.com>

You can't disable the TCP listener via environment variables and hence 
rabbitmq-env.conf. But you can via the main configuration file - see 
tcp_listeners under http://www.rabbitmq.com/configure.html#config-items 
- just set it to [].

Cheers, Simon

On 26/06/13 17:50, tbain98 at gmail.com wrote:
> I'm new to RabbitMQ, and am a bit confused by some of the documentation
> surrounding TCP vs. SSL configuration.
>
> I'm trying to set up a broker for which only authenticated SSL-based
> connections will be allowed, so I do not want the TCP listener running.
> That seems easy to do for rabbitmq-env.conf, but the documentation
> <http://www.rabbitmq.com/configure.html> seems to indicate that
> RABBITMQ_NODE_PORT is a required property (or at least, it seems to be
> required if you're setting up clustering on a single machine
> <http://www.rabbitmq.com/clustering.html#single-machine>, which I'm not
> doing yet but want the option to do in the future) and that if it's not
> provided, a default will be used.
>
> Is it possible to configure an SSL-only broker (just one node on a
> single machine), and if so, what if anything do you set
> RABBITMQ_NODE_PORT to?  (Just "RABBITMQ_NODE_PORT=" ?)  And (separate
> question) is it possible to configure a single-machine cluster with
> multiple nodes, where each node is SSL-only, and again, what do you set
> RABBITMQ_NODE_PORT to for each node?
>
> Thanks for the help...
> Tim
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Thu Jun 27 10:39:14 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Jun 2013 10:39:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ publisher confirms behaviour
In-Reply-To: <CAMF++H8Of4FNg5cEKounhQxVqNixe5LaEfSfjot4McgUHapKEg@mail.gmail.com>
References: <CAMF++H8Of4FNg5cEKounhQxVqNixe5LaEfSfjot4McgUHapKEg@mail.gmail.com>
Message-ID: <51CC0842.2060302@rabbitmq.com>


Hi,

On 26/06/13 23:57, Rohit Yadav wrote:

> What happens when a durable message is published with publisher confirms
> and the producer is stopped, i.e. we don't know if a confirm was
> received. In such a case if the message reaches the broker but the
> broker fails to send confirms back, is the message dropped? 

No, messages that have reached the broker won't get dropped because a
publisher stops. Messages may still be dropped for unrelated reasons
(e.g. TTL exceeded).

> When I stop the consumer I wait to receive any leftover confirms and
> I see that even after say 60s the _deliveries is not empty.

I'm uncertain what your expectation is. The presence of a consumer won't
necessarily have much affect on publisher confirms. If the publisher
channel has closed then that could be a reason why no further
confirmations are received.

> How may I make sure messages which were sent confirm asynchronously
> and if I should wait for sometime before closing the channel how may
> I determine the wait time period?

It is not possible to place an upper bound on the waiting time.



-Emile



From simon at rabbitmq.com  Thu Jun 27 10:39:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Jun 2013 10:39:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ publisher confirms behaviour
In-Reply-To: <CAMF++H8Of4FNg5cEKounhQxVqNixe5LaEfSfjot4McgUHapKEg@mail.gmail.com>
References: <CAMF++H8Of4FNg5cEKounhQxVqNixe5LaEfSfjot4McgUHapKEg@mail.gmail.com>
Message-ID: <51CC084A.7000506@rabbitmq.com>

On 26/06/13 23:57, Rohit Yadav wrote:
> What happens when a durable message is published with publisher confirms
> and the producer is stopped, i.e. we don't know if a confirm was
> received. In such a case if the message reaches the broker but the
> broker fails to send confirms back, is the message dropped?

No.

> When I stop
> the consumer I wait to receive any leftover confirms and I see that even
> after say 60s the _deliveries is not empty. How may I make sure messages
> which were sent confirm asynchronously and if I should wait for sometime
> before closing the channel how may I determine the wait time period?

You should get confirms back quickly. The confirm is *not* an indication 
that the message has been consumed, it means the broker has taken 
responsibility for the message.

> How does confirms work internally at the broker level, as in the latest
> RabbitMQ server.

See http://www.rabbitmq.com/confirms.html#when

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jun 27 10:49:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Jun 2013 10:49:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ publisher confirms behaviour
In-Reply-To: <51CC0842.2060302@rabbitmq.com>
References: <CAMF++H8Of4FNg5cEKounhQxVqNixe5LaEfSfjot4McgUHapKEg@mail.gmail.com>
	<51CC0842.2060302@rabbitmq.com>
Message-ID: <51CC0A98.4080401@rabbitmq.com>

On 27/06/13 10:39, Emile Joubert wrote:
> It is not possible to place an upper bound on the waiting time.

But just to reassure the OP, it should in general be quite low - in 
practice I would expect less than one second inside the broker.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Thu Jun 27 11:10:49 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 27 Jun 2013 14:10:49 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.rc2 is released
Message-ID: <CAE3HoVRSmeS8b2WPT1yNsxkXKZwQk+WX6Mzg+bCO5KzGRPnRkA@mail.gmail.com>

Bunny 0.9.0.rc2 is released to rubygems.org.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/06/27/bunny-0-dot-9-0-dot-rc2-is-released/

This may be the last Bunny 0.9 preview release. If you use Bunny 0.8 or
earlier
0.9 versions, please help us test this RC!
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/dc63ca98/attachment.htm>

From riccardi at systran.fr  Thu Jun 27 13:18:08 2013
From: riccardi at systran.fr (Thomas Riccardi)
Date: Thu, 27 Jun 2013 14:18:08 +0200
Subject: [rabbitmq-discuss] HiPE compilation error with rabbitmq 3.1.3 and
 erlang R16B01: Cannot find ssl_record.beam file.
Message-ID: <1372335488.2476.90.camel@CLM3X4J.systran.local>

Hi,

Since the release of erlang R16B01 the rabbitmq HiPE compilation is
broken:
<HiPE (v 3.10.2)> Error: [hipe:417]: Cannot find ssl_record.beam file.
<HiPE (v 3.10.2)> Error: [hipe:417]: Cannot find ssl_connection.beam
file.

Tested on ubuntu 12.04 with esl-erlang_16.b.1-1~ubuntu~precise_amd64.deb
from https://www.erlang-solutions.com/downloads/download-erlang-otp and
rabbitmq .deb (v3.1.1, 3.1.2 and 3.1.3).

Joined files:
startup_log from /var/log/rabbitmq
ssl.ls: ls -la in /usr/lib/erlang/lib/ssl-5.3/ebin

ssl_record.beam and ssl_connection.beam are now prefixed with tls
instead of ssl...

It works with esl-erlang_16.b-2~ubuntu~precise_amd64.deb (R16B).

-------------- next part --------------
HiPE compiling:  |------------------------------------------------------|
                 |#<HiPE (v 3.10.2)> EXITED with reason {cant_find_beam_file,ssl_record} @hipe:418

=ERROR REPORT==== 27-Jun-2013::09:24:05 ===
<HiPE (v 3.10.2)> Error: [hipe:417]: Cannot find ssl_record.beam file.
=ERROR REPORT==== 27-Jun-2013::09:24:05 ===
Error in process <0.47.0> on node 'rabbit at ip-10-83-163-82' with exit value: {{hipe,418,{cant_find_beam_file,ssl_record}},[{hipe,beam_file,1,[{file,"hipe.erl"},{line,418}]},{hipe,c,2,[{file,"hipe.erl"},{line,312}]},{rabbit,'-hipe_compile/
0-lc$^1/1-1-',1,[]},{rabbit,'-hipe_compile/0-lc$^1/1-1-',1,[]}]}

#<HiPE (v 3.10.2)> EXITED with reason {cant_find_beam_file,ssl_connection} @hipe:418

=ERROR REPORT==== 27-Jun-2013::09:24:05 ===
<HiPE (v 3.10.2)> Error: [hipe:417]: Cannot find ssl_connection.beam file.

BOOT FAILED
===========

Error description:
   {{hipe,418,{cant_find_beam_file,ssl_connection}},
    [{hipe,beam_file,1,[{file,"hipe.erl"},{line,418}]},
     {hipe,c,2,[{file,"hipe.erl"},{line,312}]},
     {rabbit,'-hipe_compile/0-lc$^1/1-1-',1,[]},
     {rabbit,'-hipe_compile/0-lc$^1/1-1-',1,[]}]}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at ip-10-83-163-82.log
   /var/log/rabbitmq/rabbit at ip-10-83-163-82-sasl.log

Stack trace:
   [{rabbit,'-hipe_compile/0-lc$^2/1-2-',1,[]},
    {rabbit,hipe_compile,0,[]},
    {rabbit,maybe_hipe_compile,0,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[]},
    {init,start_em,1,[]}]

=INFO REPORT==== 27-Jun-2013::09:24:05 ===
Error description:
   {{hipe,418,{cant_find_beam_file,ssl_connection}},
    [{hipe,beam_file,1,[{file,"hipe.erl"},{line,418}]},
     {hipe,c,2,[{file,"hipe.erl"},{line,312}]},
     {rabbit,'-hipe_compile/0-lc$^1/1-1-',1,[]},
     {rabbit,'-hipe_compile/0-lc$^1/1-1-',1,[]}]}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at ip-10-83-163-82.log
   /var/log/rabbitmq/rabbit at ip-10-83-163-82-sasl.log

Stack trace:
   [{rabbit,'-hipe_compile/0-lc$^2/1-2-',1,[]},
    {rabbit,hipe_compile,0,[]},
    {rabbit,maybe_hipe_compile,0,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[]},
    {init,start_em,1,[]}]

{"init terminating in do_boot",{rabbit,failure_during_boot,{{hipe,418,{cant_find_beam_file,ssl_connection}},[{hipe,beam_file,1,[{file,"hipe.erl"},{line,418}]},{hipe,c,2,[{file,"hipe.erl"},{line,312}]},{rabbit,'-hipe_compile/0-lc$^1/1-1-',1,[]},{rabbit,'-hipe_compile/0-lc$^1/1-1-',1,[]}]}}}
-------------- next part --------------
ubuntu at ip-10-195-147-127:/usr/lib/erlang/lib/ssl-5.3/ebin$ ls -la
total 604
drwxr-xr-x 2 root root   4096 Jun 27 10:00 .
drwxr-xr-x 5 root root   4096 Jun 27 10:00 ..
-rw-r--r-- 1 root root    708 Jun 18 18:02 dtls.beam
-rw-r--r-- 1 root root    736 Jun 18 18:02 dtls_connection.beam
-rw-r--r-- 1 root root    736 Jun 18 18:02 dtls_handshake.beam
-rw-r--r-- 1 root root    728 Jun 18 18:02 dtls_record.beam
-rw-r--r-- 1 root root  11432 Jun 18 18:02 inet_tls_dist.beam
-rw-r--r-- 1 root root   3540 Jun 18 18:02 ssl_alert.beam
-rw-r--r-- 1 root root   1039 Jun 18 18:02 ssl.app
-rw-r--r-- 1 root root   1028 Jun 18 18:02 ssl_app.beam
-rw-r--r-- 1 root root    517 Jun 18 18:02 ssl.appup
-rw-r--r-- 1 root root  16488 Jun 18 18:02 ssl.beam
-rw-r--r-- 1 root root  15892 Jun 18 18:02 ssl_certificate.beam
-rw-r--r-- 1 root root  53536 Jun 18 18:02 ssl_cipher.beam
-rw-r--r-- 1 root root   1888 Jun 18 18:02 ssl_connection_sup.beam
-rw-r--r-- 1 root root   2360 Jun 18 18:02 ssl_dist_sup.beam
-rw-r--r-- 1 root root  23132 Jun 18 18:02 ssl_manager.beam
-rw-r--r-- 1 root root  16064 Jun 18 18:02 ssl_pkix_db.beam
-rw-r--r-- 1 root root  13588 Jun 18 18:02 ssl_session.beam
-rw-r--r-- 1 root root  11260 Jun 18 18:02 ssl_session_cache_api.beam
-rw-r--r-- 1 root root  10624 Jun 18 18:02 ssl_session_cache.beam
-rw-r--r-- 1 root root   9092 Jun 18 18:02 ssl_socket.beam
-rw-r--r-- 1 root root  24116 Jun 18 18:02 ssl_srp_primes.beam
-rw-r--r-- 1 root root   1248 Jun 18 18:02 ssl_ssl2.beam
-rw-r--r-- 1 root root  13464 Jun 18 18:02 ssl_ssl3.beam
-rw-r--r-- 1 root root   2712 Jun 18 18:02 ssl_sup.beam
-rw-r--r-- 1 root root  20216 Jun 18 18:02 ssl_tls1.beam
-rw-r--r-- 1 root root  15320 Jun 18 18:02 ssl_tls_dist_proxy.beam
-rw-r--r-- 1 root root  45616 Jun 18 18:02 tls.beam
-rw-r--r-- 1 root root 121812 Jun 18 18:02 tls_connection.beam
-rw-r--r-- 1 root root  76572 Jun 18 18:02 tls_handshake.beam
-rw-r--r-- 1 root root  31460 Jun 18 18:02 tls_record.beam

From emile at rabbitmq.com  Thu Jun 27 13:28:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Jun 2013 13:28:18 +0100
Subject: [rabbitmq-discuss] HiPE compilation error with rabbitmq 3.1.3
 and erlang R16B01: Cannot find ssl_record.beam file.
In-Reply-To: <1372335488.2476.90.camel@CLM3X4J.systran.local>
References: <1372335488.2476.90.camel@CLM3X4J.systran.local>
Message-ID: <51CC2FE2.9060009@rabbitmq.com>


Hi Thomas,

On 27/06/13 13:18, Thomas Riccardi wrote:
> ssl_record.beam and ssl_connection.beam are now prefixed with tls
> instead of ssl...

That's a bug, thanks for reporting it. As you point out, some modules
were renamed in R16B01 and the broker still references the old names.
The workaround is to use an older version of Erlang or not to use HiPE
until we release a fix.


-Emile






From jesper.louis.andersen at gmail.com  Thu Jun 27 13:28:14 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Thu, 27 Jun 2013 14:28:14 +0200
Subject: [rabbitmq-discuss] HiPE compilation error with rabbitmq 3.1.3
 and erlang R16B01: Cannot find ssl_record.beam file.
In-Reply-To: <1372335488.2476.90.camel@CLM3X4J.systran.local>
References: <1372335488.2476.90.camel@CLM3X4J.systran.local>
Message-ID: <CAGrdgiUazP_DU7Dw4Zog6qVk3r5DNvq6ziLxSH2hL+sKs15zTg@mail.gmail.com>

On Thu, Jun 27, 2013 at 2:18 PM, Thomas Riccardi <riccardi at systran.fr>wrote:

> Since the release of erlang R16B01 the rabbitmq HiPE compilation is
> broken:
> <HiPE (v 3.10.2)> Error: [hipe:417]: Cannot find ssl_record.beam file.
> <HiPE (v 3.10.2)> Error: [hipe:417]: Cannot find ssl_connection.beam
> file.
>

Have you measured wether or not HiPE gives a performance boost in RabbitMQ?
Chances are that performance will actually suffer, unless you have compiled
all of your stdlib in Erlang/OTP with HiPE as well.

If it *does* give a performance boost, I am interested in as to why as well
:)


-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/06fec3cd/attachment.htm>

From riccardi at systran.fr  Thu Jun 27 13:39:55 2013
From: riccardi at systran.fr (Thomas Riccardi)
Date: Thu, 27 Jun 2013 14:39:55 +0200
Subject: [rabbitmq-discuss] HiPE compilation error with rabbitmq 3.1.3
 and erlang R16B01: Cannot find ssl_record.beam file.
In-Reply-To: <CAGrdgiUazP_DU7Dw4Zog6qVk3r5DNvq6ziLxSH2hL+sKs15zTg@mail.gmail.com>
References: <1372335488.2476.90.camel@CLM3X4J.systran.local>
	<CAGrdgiUazP_DU7Dw4Zog6qVk3r5DNvq6ziLxSH2hL+sKs15zTg@mail.gmail.com>
Message-ID: <1372336795.2476.93.camel@CLM3X4J.systran.local>

On jeu., 2013-06-27 at 14:28 +0200, Jesper Louis Andersen wrote: 
> 
> On Thu, Jun 27, 2013 at 2:18 PM, Thomas Riccardi <riccardi at systran.fr>
> wrote:
>         Since the release of erlang R16B01 the rabbitmq HiPE
>         compilation is
>         broken:
>         <HiPE (v 3.10.2)> Error: [hipe:417]: Cannot find
>         ssl_record.beam file.
>         <HiPE (v 3.10.2)> Error: [hipe:417]: Cannot find
>         ssl_connection.beam
>         file. 
> 
> Have you measured wether or not HiPE gives a performance boost in
> RabbitMQ? Chances are that performance will actually suffer, unless
> you have compiled all of your stdlib in Erlang/OTP with HiPE as well.
> 
> 
> If it *does* give a performance boost, I am interested in as to why as
> well :)
> 
> 
> 
> -- 
> J.

I tested with sh ./runjava.sh com.rabbitmq.examples.MulticastMain -z 30
(on a c1.xlarge amazon aws machine)

* With HiPE:
sending rate avg: 18613 msg/s
recving rate avg: 17703 msg/s
* Without HiPE:
sending rate avg: 14018 msg/s
recving rate avg: 12995 msg/s

So the performance gain is here with the official esl-erlang.deb.


From emile at rabbitmq.com  Thu Jun 27 13:45:14 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Jun 2013 13:45:14 +0100
Subject: [rabbitmq-discuss] HiPE compilation error with rabbitmq 3.1.3
 and erlang R16B01: Cannot find ssl_record.beam file.
In-Reply-To: <CAGrdgiUazP_DU7Dw4Zog6qVk3r5DNvq6ziLxSH2hL+sKs15zTg@mail.gmail.com>
References: <1372335488.2476.90.camel@CLM3X4J.systran.local>
	<CAGrdgiUazP_DU7Dw4Zog6qVk3r5DNvq6ziLxSH2hL+sKs15zTg@mail.gmail.com>
Message-ID: <51CC33DA.5060708@rabbitmq.com>


On 27/06/13 13:28, Jesper Louis Andersen wrote:
> Have you measured wether or not HiPE gives a performance boost in
> RabbitMQ? Chances are that performance will actually suffer, unless you
> have compiled all of your stdlib in Erlang/OTP with HiPE as well.

I've seen throughput improvements up to 50% for some cases. HiPE is
enabled selectively only for the broker modules that benefit from it.
Unfortunately it often causes segfaults in the VM, so not enabled by
default.



-Emile




From tbain at alumni.duke.edu  Thu Jun 27 14:33:30 2013
From: tbain at alumni.duke.edu (Tim Bain)
Date: Thu, 27 Jun 2013 09:33:30 -0400
Subject: [rabbitmq-discuss] TCP vs. SSL configuration
In-Reply-To: <51CC066D.4060809@rabbitmq.com>
References: <567bd7a8-b428-4663-85a4-3932ac7d9a18@googlegroups.com>
	<51CC066D.4060809@rabbitmq.com>
Message-ID: <CAPVVMa_45MYDuc1y0ev2NjFQ-xp2_KSUPReouVqTjPdqecH-ww@mail.gmail.com>

So if TCP is disabled via the section you referenced in rabbitmq.config,
then what goes in the environment variable RABBITMQ_NODE_PORT?  Is that
value simply ignored if TCP is disabled (so you can set the environment
variable to anything, or just leave it unset)?  Do you set it to the SSL
port?  Something else?

And if you have a set of N nodes in a cluster on a single machine, do you
still need to have a different value of RABBITMQ_NODE_PORT for each
instance?  (Do you just make it match the SSL port each node is using?)

Thanks,
Tim


On Thu, Jun 27, 2013 at 5:31 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> You can't disable the TCP listener via environment variables and hence
> rabbitmq-env.conf. But you can via the main configuration file - see
> tcp_listeners under http://www.rabbitmq.com/**configure.html#config-items<http://www.rabbitmq.com/configure.html#config-items>- just set it to [].
>
> Cheers, Simon
>
> On 26/06/13 17:50, tbain98 at gmail.com wrote:
>
>> I'm new to RabbitMQ, and am a bit confused by some of the documentation
>> surrounding TCP vs. SSL configuration.
>>
>> I'm trying to set up a broker for which only authenticated SSL-based
>> connections will be allowed, so I do not want the TCP listener running.
>> That seems easy to do for rabbitmq-env.conf, but the documentation
>> <http://www.rabbitmq.com/**configure.html<http://www.rabbitmq.com/configure.html>>
>> seems to indicate that
>> RABBITMQ_NODE_PORT is a required property (or at least, it seems to be
>> required if you're setting up clustering on a single machine
>> <http://www.rabbitmq.com/**clustering.html#single-machine<http://www.rabbitmq.com/clustering.html#single-machine>
>> **>, which I'm not
>> doing yet but want the option to do in the future) and that if it's not
>> provided, a default will be used.
>>
>> Is it possible to configure an SSL-only broker (just one node on a
>> single machine), and if so, what if anything do you set
>> RABBITMQ_NODE_PORT to?  (Just "RABBITMQ_NODE_PORT=" ?)  And (separate
>> question) is it possible to configure a single-machine cluster with
>> multiple nodes, where each node is SSL-only, and again, what do you set
>> RABBITMQ_NODE_PORT to for each node?
>>
>> Thanks for the help...
>> Tim
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/59bb7a03/attachment.htm>

From simon at rabbitmq.com  Thu Jun 27 14:49:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Jun 2013 14:49:23 +0100
Subject: [rabbitmq-discuss] TCP vs. SSL configuration
In-Reply-To: <CAPVVMa_45MYDuc1y0ev2NjFQ-xp2_KSUPReouVqTjPdqecH-ww@mail.gmail.com>
References: <567bd7a8-b428-4663-85a4-3932ac7d9a18@googlegroups.com>
	<51CC066D.4060809@rabbitmq.com>
	<CAPVVMa_45MYDuc1y0ev2NjFQ-xp2_KSUPReouVqTjPdqecH-ww@mail.gmail.com>
Message-ID: <51CC42E3.5090303@rabbitmq.com>

Just leave RABBITMQ_NODE_PORT blank. The "real" setting is the one in 
the config file, the environment variables provide a way to override 
that, if they are set.

If you want multiple brokers on one machine, each with SSL only, you'll 
need to set up one config file per broker, and then point to that using 
RABBITMQ_CONFIG_FILE (see http://www.rabbitmq.com/relocate.html).

Cheers, Simon

On 27/06/13 14:33, Tim Bain wrote:
> So if TCP is disabled via the section you referenced in rabbitmq.config,
> then what goes in the environment variable RABBITMQ_NODE_PORT?  Is that
> value simply ignored if TCP is disabled (so you can set the environment
> variable to anything, or just leave it unset)?  Do you set it to the SSL
> port?  Something else?
>
> And if you have a set of N nodes in a cluster on a single machine, do
> you still need to have a different value of RABBITMQ_NODE_PORT for each
> instance?  (Do you just make it match the SSL port each node is using?)
>
> Thanks,
> Tim
>
>
> On Thu, Jun 27, 2013 at 5:31 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     You can't disable the TCP listener via environment variables and
>     hence rabbitmq-env.conf. But you can via the main configuration file
>     - see tcp_listeners under
>     http://www.rabbitmq.com/__configure.html#config-items
>     <http://www.rabbitmq.com/configure.html#config-items> - just set it
>     to [].
>
>     Cheers, Simon
>
>     On 26/06/13 17:50, tbain98 at gmail.com <mailto:tbain98 at gmail.com> wrote:
>
>         I'm new to RabbitMQ, and am a bit confused by some of the
>         documentation
>         surrounding TCP vs. SSL configuration.
>
>         I'm trying to set up a broker for which only authenticated SSL-based
>         connections will be allowed, so I do not want the TCP listener
>         running.
>         That seems easy to do for rabbitmq-env.conf, but the documentation
>         <http://www.rabbitmq.com/__configure.html
>         <http://www.rabbitmq.com/configure.html>> seems to indicate that
>         RABBITMQ_NODE_PORT is a required property (or at least, it seems
>         to be
>         required if you're setting up clustering on a single machine
>         <http://www.rabbitmq.com/__clustering.html#single-machine
>         <http://www.rabbitmq.com/clustering.html#single-machine>__>,
>         which I'm not
>         doing yet but want the option to do in the future) and that if
>         it's not
>         provided, a default will be used.
>
>         Is it possible to configure an SSL-only broker (just one node on a
>         single machine), and if so, what if anything do you set
>         RABBITMQ_NODE_PORT to?  (Just "RABBITMQ_NODE_PORT=" ?)  And
>         (separate
>         question) is it possible to configure a single-machine cluster with
>         multiple nodes, where each node is SSL-only, and again, what do
>         you set
>         RABBITMQ_NODE_PORT to for each node?
>
>         Thanks for the help...
>         Tim
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From tbain at alumni.duke.edu  Thu Jun 27 14:52:49 2013
From: tbain at alumni.duke.edu (Tim Bain)
Date: Thu, 27 Jun 2013 09:52:49 -0400
Subject: [rabbitmq-discuss] TCP vs. SSL configuration
In-Reply-To: <51CC42E3.5090303@rabbitmq.com>
References: <567bd7a8-b428-4663-85a4-3932ac7d9a18@googlegroups.com>
	<51CC066D.4060809@rabbitmq.com>
	<CAPVVMa_45MYDuc1y0ev2NjFQ-xp2_KSUPReouVqTjPdqecH-ww@mail.gmail.com>
	<51CC42E3.5090303@rabbitmq.com>
Message-ID: <CAPVVMa-9CZKJF2Cx_OoQPrrt+h6z4MsgeYL5zGFWzFc2OP3JVQ@mail.gmail.com>

OK, leaving the value blank in a single-node single-machine broker makes
sense.

The documentation at
http://www.rabbitmq.com/clustering.html#single-machinesays that for a
clustered broker with multiple nodes on a single machine,
"You must ensure that for each invocation you set the environment variables
RABBITMQ_NODENAME and RABBITMQ_NODE_PORT to suitable values."  Should that
really say that RABBITMQ_NODENAME is required in all cases, and
RABBITMQ_NODE_PORT is required if TCP is enabled but not required if it's
not?


On Thu, Jun 27, 2013 at 9:49 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Just leave RABBITMQ_NODE_PORT blank. The "real" setting is the one in the
> config file, the environment variables provide a way to override that, if
> they are set.
>
> If you want multiple brokers on one machine, each with SSL only, you'll
> need to set up one config file per broker, and then point to that using
> RABBITMQ_CONFIG_FILE (see http://www.rabbitmq.com/**relocate.html<http://www.rabbitmq.com/relocate.html>
> ).
>
> Cheers, Simon
>
>
> On 27/06/13 14:33, Tim Bain wrote:
>
>> So if TCP is disabled via the section you referenced in rabbitmq.config,
>> then what goes in the environment variable RABBITMQ_NODE_PORT?  Is that
>> value simply ignored if TCP is disabled (so you can set the environment
>> variable to anything, or just leave it unset)?  Do you set it to the SSL
>> port?  Something else?
>>
>> And if you have a set of N nodes in a cluster on a single machine, do
>> you still need to have a different value of RABBITMQ_NODE_PORT for each
>> instance?  (Do you just make it match the SSL port each node is using?)
>>
>> Thanks,
>> Tim
>>
>>
>> On Thu, Jun 27, 2013 at 5:31 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     You can't disable the TCP listener via environment variables and
>>     hence rabbitmq-env.conf. But you can via the main configuration file
>>     - see tcp_listeners under
>>     http://www.rabbitmq.com/__**configure.html#config-items<http://www.rabbitmq.com/__configure.html#config-items>
>>
>>     <http://www.rabbitmq.com/**configure.html#config-items<http://www.rabbitmq.com/configure.html#config-items>>
>> - just set it
>>     to [].
>>
>>     Cheers, Simon
>>
>>     On 26/06/13 17:50, tbain98 at gmail.com <mailto:tbain98 at gmail.com>
>> wrote:
>>
>>         I'm new to RabbitMQ, and am a bit confused by some of the
>>         documentation
>>         surrounding TCP vs. SSL configuration.
>>
>>         I'm trying to set up a broker for which only authenticated
>> SSL-based
>>         connections will be allowed, so I do not want the TCP listener
>>         running.
>>         That seems easy to do for rabbitmq-env.conf, but the documentation
>>         <http://www.rabbitmq.com/__**configure.html<http://www.rabbitmq.com/__configure.html>
>>
>>         <http://www.rabbitmq.com/**configure.html<http://www.rabbitmq.com/configure.html>>>
>> seems to indicate that
>>         RABBITMQ_NODE_PORT is a required property (or at least, it seems
>>         to be
>>         required if you're setting up clustering on a single machine
>>         <http://www.rabbitmq.com/__**clustering.html#single-machine<http://www.rabbitmq.com/__clustering.html#single-machine>
>>         <http://www.rabbitmq.com/**clustering.html#single-machine<http://www.rabbitmq.com/clustering.html#single-machine>
>> **>__>,
>>
>>         which I'm not
>>         doing yet but want the option to do in the future) and that if
>>         it's not
>>         provided, a default will be used.
>>
>>         Is it possible to configure an SSL-only broker (just one node on a
>>         single machine), and if so, what if anything do you set
>>         RABBITMQ_NODE_PORT to?  (Just "RABBITMQ_NODE_PORT=" ?)  And
>>         (separate
>>         question) is it possible to configure a single-machine cluster
>> with
>>         multiple nodes, where each node is SSL-only, and again, what do
>>         you set
>>         RABBITMQ_NODE_PORT to for each node?
>>
>>         Thanks for the help...
>>         Tim
>>
>>
>>         ______________________________**___________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, Pivotal
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/0eff2c4e/attachment.htm>

From matthias at rabbitmq.com  Thu Jun 27 14:58:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Jun 2013 14:58:23 +0100
Subject: [rabbitmq-discuss] TCP vs. SSL configuration
In-Reply-To: <51CC42E3.5090303@rabbitmq.com>
References: <567bd7a8-b428-4663-85a4-3932ac7d9a18@googlegroups.com>
	<51CC066D.4060809@rabbitmq.com>
	<CAPVVMa_45MYDuc1y0ev2NjFQ-xp2_KSUPReouVqTjPdqecH-ww@mail.gmail.com>
	<51CC42E3.5090303@rabbitmq.com>
Message-ID: <51CC44FF.9090902@rabbitmq.com>

On 27/06/13 14:49, Simon MacMullen wrote:
> Just leave RABBITMQ_NODE_PORT blank. The "real" setting is the one in
> the config file, the environment variables provide a way to override
> that, if they are set.
>
> If you want multiple brokers on one machine, each with SSL only, you'll
> need to set up one config file per broker, and then point to that using
> RABBITMQ_CONFIG_FILE (see http://www.rabbitmq.com/relocate.html).

...or set RABBITMQ_SERVER_START_ARGS to "-rabbit ssl_listeners [<port>]" 
on the invocation of rabbitmq-server.

Matthias.

From steve at digitalnothing.com  Thu Jun 27 16:13:44 2013
From: steve at digitalnothing.com (Steve V)
Date: Thu, 27 Jun 2013 08:13:44 -0700 (PDT)
Subject: [rabbitmq-discuss] LDAP authentication without authorization
Message-ID: <e15c15f4-9a25-4c6f-b8c5-7a612614d6bb@googlegroups.com>

Is it possible to only do authentication through LDAP, and setup 
authorization on my own within Rabbit?

Thanks,
Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/c469038a/attachment.htm>

From lrodriguez1995 at yahoo.com  Thu Jun 27 17:36:41 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Thu, 27 Jun 2013 09:36:41 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq clustering: ensuring failover and high
	availability
Message-ID: <1372351001.15808.YahooMailNeo@web141104.mail.bf1.yahoo.com>

Hi all,

I? am trying to get High availability (active/active) and failover working on a clustered setup (3 vm's using Centos. I joined rabbit3 and rabbit2 to rabbit1)

After reading the tutorials, I understand that " Mirrored queues replicate their contents across all configured cluster nodes"
I am using a java application in my desktop to send messages to the vm's to test these instances.

I'm really not sure how to change the settings for this to happen. (be able to display a message to all three nodes, and if 1 node goes down, it would still display the message to the remaining nodes in the cluster)
Please help...





Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/cb4a5894/attachment.htm>

From lrodriguez1995 at yahoo.com  Thu Jun 27 17:40:13 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Thu, 27 Jun 2013 09:40:13 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq clustering issues
In-Reply-To: <51CBEA0D.1020507@rabbitmq.com>
References: <1372121402.97283.YahooMailNeo@web141103.mail.bf1.yahoo.com>
	<51CBEA0D.1020507@rabbitmq.com>
Message-ID: <1372351213.62746.YahooMailNeo@web141105.mail.bf1.yahoo.com>

You were right.
All I had to do was go into every node and change the domain names? accordingly.
After this, the clustering worked.

Thanks a bunch.



________________________________
 From: Matthias Radestock <matthias at rabbitmq.com>
To: Luis Rodriguez <lrodriguez1995 at yahoo.com>; Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Thursday, June 27, 2013 3:30 AM
Subject: Re: [rabbitmq-discuss] rabbitmq clustering issues
 

On 25/06/13 01:50, Luis Rodriguez wrote:
> running a windows host with three virtual machines running centos 5.9
>? and have them in a host only network. I have rabbitmq server 3.0.3
> installed in all three vm's along with erlang (named the nodes
> rabbit1 at localhost,rabbit2 at localhost,rabbit3 at localhost)

There is your problem. If all three nodes have a host name of
'localhost', how are they going to find each other?

The host name component of the node name must correspond to the host
name of each of your VMs. And these host names must be resolvable on all 
VMs.

Regards,

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/9343e7a0/attachment.htm>

From stuff at moesel.net  Thu Jun 27 18:10:38 2013
From: stuff at moesel.net (Chris)
Date: Thu, 27 Jun 2013 13:10:38 -0400
Subject: [rabbitmq-discuss] rabbitmq clustering: ensuring failover and
 high availability
In-Reply-To: <1372351001.15808.YahooMailNeo@web141104.mail.bf1.yahoo.com>
References: <1372351001.15808.YahooMailNeo@web141104.mail.bf1.yahoo.com>
Message-ID: <CAHEpgBDte9nP5jESNP51QGTsN7vWO_5NM7iBxc5YL0p8s_0s7A@mail.gmail.com>

Hi Luis,

Mirrored queues are configured via policies on the server.  Clients don't
have to do anything special to take advantage of them.

Have you seen the documentation that specifically discusses mirrored queues?

http://www.rabbitmq.com/ha.html

This provides lots more information as well as examples on how to setup the
policies.  If you want all queues mirrored on all servers, then I think
you're looking for something like this:

rabbitmqctl set_policy ha-all ".*" '{"ha-mode":"all"}'

-Chris



On Thu, Jun 27, 2013 at 12:36 PM, Luis Rodriguez
<lrodriguez1995 at yahoo.com>wrote:

> Hi all,
>
> I  am trying to get High availability (active/active) and failover working
> on a clustered setup (3 vm's using Centos. I joined rabbit3 and rabbit2 to
> rabbit1)
> After reading the tutorials, I understand that " Mirrored queues
> replicate their contents across all configured cluster nodes"
> I am using a java application in my desktop to send messages to the vm's
> to test these instances.
> I'm really not sure how to change the settings for this to happen. (be
> able to display a message to all three nodes, and if 1 node goes down, it
> would still display the message to the remaining nodes in the cluster)
> Please help...
>
>
>
>
>
> Luis
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/60192cf2/attachment.htm>

From travis.jensen at gmail.com  Thu Jun 27 17:51:30 2013
From: travis.jensen at gmail.com (Travis Jensen)
Date: Thu, 27 Jun 2013 09:51:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: unable to connect to node
	rabbit@localhost: nodedown
Message-ID: <6855b72f-30e1-48e1-96ce-3b5fd6358a96@googlegroups.com>


So I had rabbitmq working fine on my laptop, then had to reboot somewhere 
else where my hostname wouldn't resolve and it failed to start. As annoying 
as that was, I figured I would just wait until I got back to my DNS and 
then restart it.  Wrong.

So, after searching and futzing for an hour, I decided I needed to upgrade 
anyway, so I uninstalled 3.0.4, cleaned up all the old configuration files, 
db directories and such, and installed 3.1.0 (note: Using OS X 10.7.5, 
Erlang R15B03 and Homebrew). 

Now, I continue to see the same behavior:

$ rabbitmqctl add_user test test_pass
Creating user "test" ...
Error: unable to connect to node rabbit at localhost: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at localhost]

hosts, their running nodes and ports:
- localhost: []

current node details:
- node name: nonode at nohost
- home dir: /Users/travis
- cookie hash: 92vmrXD/iLl+OKWxh4sEhQ==

This is how things looked on startup:

$ rabbitmq-server

              RabbitMQ 3.1.0. Copyright (C) 2007-2013 VMware, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /usr/local/var/log/rabbitmq/rabbit at localhost.log
  ######  ##        /usr/local/var/log/rabbitmq/rabbit at localhost-sasl.log
  ##########
              Starting broker... completed with 7 plugins.

And the logs seem pretty nominal. Note that the *rabbitmqctl* connection 
never shows up, but I can telnet in to port 5672 and see a failed 
connection show up. Unsurprisingly, the issue seems to revolve around the *node: 
nonode at nohost* that I've highlighted in the logs below.  This behavior 
persists even if I explicitly set *RABBITMQ_NODENAME=rabbit at localhost* when 
I run rabbitmq-server.

=INFO REPORT==== 27-Jun-2013::10:32:02 ===
Starting RabbitMQ 3.1.0 on Erlang R15B03
Copyright (C) 2007-2013 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 27-Jun-2013::10:32:02 ===
*node           : nonode at nohost*
home dir       : /Users/travis
cookie hash    : 92vmrXD/iLl+OKWxh4sEhQ==
log            : /usr/local/var/log/rabbitmq/rabbit at localhost.log
sasl log       : /usr/local/var/log/rabbitmq/rabbit at localhost-sasl.log
database dir   : /usr/local/var/lib/rabbitmq/mnesia/rabbit at localhost

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Limiting to approx 156 file handles (138 sockets)

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Memory limit set to 1439MB of 3597MB total.

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Disk free limit set to 1000MB

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 27-Jun-2013::10:32:03 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Adding vhost '/'

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Creating user 'guest'

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Setting user tags for user 'guest' to [administrator]

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Setting permissions for 'guest' in '/' to '.*', '.*', '.*'

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
started TCP Listener on 127.0.0.1:5672

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Management plugin started. Port: 15672

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Statistics database started.

=INFO REPORT==== 27-Jun-2013::10:32:03 ===
Server startup complete; 7 plugins started.
 * amqp_client
 * mochiweb
 * rabbitmq_management
 * rabbitmq_management_agent
 * rabbitmq_management_visualiser
 * rabbitmq_web_dispatch
 * webmachine

My rabbitmq-env.conf file is pretty simple (the Homebrew default, in fact):

CONFIG_FILE=/usr/local/etc/rabbitmq/rabbitmq
NODE_IP_ADDRESS=127.0.0.1
NODENAME=rabbit at localhost

And, after going through my previous rabbitmq.config file to remove 
everything that either was a default or no longer existed as a 
configuration option, my configuration file looks like:

[].

Just to make sure I don't have any weird environment variables I didn't 
remember persisting, I ran a *set | grep -i rabbit* and got an empty set.  
I also removed *~/.erlang.cookie*, to make sure it wasn't messing things up.

So I've reached the end of what Google and the docs have been able to tell 
me. Help is most graciously appreciated.

tj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/5be6bfce/attachment.htm>

From michael.laing at nytimes.com  Thu Jun 27 18:53:41 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 27 Jun 2013 13:53:41 -0400
Subject: [rabbitmq-discuss] Error: unable to connect to node
 rabbit@localhost: nodedown
In-Reply-To: <6855b72f-30e1-48e1-96ce-3b5fd6358a96@googlegroups.com>
References: <6855b72f-30e1-48e1-96ce-3b5fd6358a96@googlegroups.com>
Message-ID: <CAKgmDnH14Zd78OfG-nXCoka-_0TiWRh4uZ3C85SHQLwbq7aTxw@mail.gmail.com>

What does /etc/hosts look like? Can 'localhost' resolve?


On Thu, Jun 27, 2013 at 12:51 PM, Travis Jensen <travis.jensen at gmail.com>wrote:

>
> So I had rabbitmq working fine on my laptop, then had to reboot somewhere
> else where my hostname wouldn't resolve and it failed to start. As annoying
> as that was, I figured I would just wait until I got back to my DNS and
> then restart it.  Wrong.
>
> So, after searching and futzing for an hour, I decided I needed to upgrade
> anyway, so I uninstalled 3.0.4, cleaned up all the old configuration files,
> db directories and such, and installed 3.1.0 (note: Using OS X 10.7.5,
> Erlang R15B03 and Homebrew).
>
> Now, I continue to see the same behavior:
>
> $ rabbitmqctl add_user test test_pass
> Creating user "test" ...
> Error: unable to connect to node rabbit at localhost: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at localhost]
>
> hosts, their running nodes and ports:
> - localhost: []
>
> current node details:
> - node name: nonode at nohost
> - home dir: /Users/travis
> - cookie hash: 92vmrXD/iLl+OKWxh4sEhQ==
>
> This is how things looked on startup:
>
> $ rabbitmq-server
>
>               RabbitMQ 3.1.0. Copyright (C) 2007-2013 VMware, Inc.
>   ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>   ##  ##
>   ##########  Logs: /usr/local/var/log/rabbitmq/rabbit at localhost.log
>   ######  ##        /usr/local/var/log/rabbitmq/rabbit at localhost-sasl.log
>   ##########
>               Starting broker... completed with 7 plugins.
>
> And the logs seem pretty nominal. Note that the *rabbitmqctl* connection
> never shows up, but I can telnet in to port 5672 and see a failed
> connection show up. Unsurprisingly, the issue seems to revolve around the
> *node: nonode at nohost* that I've highlighted in the logs below.  This
> behavior persists even if I explicitly set *
> RABBITMQ_NODENAME=rabbit at localhost* when I run rabbitmq-server.
>
> =INFO REPORT==== 27-Jun-2013::10:32:02 ===
> Starting RabbitMQ 3.1.0 on Erlang R15B03
> Copyright (C) 2007-2013 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> =INFO REPORT==== 27-Jun-2013::10:32:02 ===
> *node           : nonode at nohost*
> home dir       : /Users/travis
> cookie hash    : 92vmrXD/iLl+OKWxh4sEhQ==
> log            : /usr/local/var/log/rabbitmq/rabbit at localhost.log
> sasl log       : /usr/local/var/log/rabbitmq/rabbit at localhost-sasl.log
> database dir   : /usr/local/var/lib/rabbitmq/mnesia/rabbit at localhost
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Limiting to approx 156 file handles (138 sockets)
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Memory limit set to 1439MB of 3597MB total.
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Disk free limit set to 1000MB
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =WARNING REPORT==== 27-Jun-2013::10:32:03 ===
> msg_store_persistent: rebuilding indices from scratch
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Adding vhost '/'
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Creating user 'guest'
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Setting user tags for user 'guest' to [administrator]
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Setting permissions for 'guest' in '/' to '.*', '.*', '.*'
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> started TCP Listener on 127.0.0.1:5672
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Management plugin started. Port: 15672
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Statistics database started.
>
> =INFO REPORT==== 27-Jun-2013::10:32:03 ===
> Server startup complete; 7 plugins started.
>  * amqp_client
>  * mochiweb
>  * rabbitmq_management
>  * rabbitmq_management_agent
>  * rabbitmq_management_visualiser
>  * rabbitmq_web_dispatch
>  * webmachine
>
> My rabbitmq-env.conf file is pretty simple (the Homebrew default, in fact):
>
> CONFIG_FILE=/usr/local/etc/rabbitmq/rabbitmq
> NODE_IP_ADDRESS=127.0.0.1
> NODENAME=rabbit at localhost
>
> And, after going through my previous rabbitmq.config file to remove
> everything that either was a default or no longer existed as a
> configuration option, my configuration file looks like:
>
> [].
>
> Just to make sure I don't have any weird environment variables I didn't
> remember persisting, I ran a *set | grep -i rabbit* and got an empty
> set.  I also removed *~/.erlang.cookie*, to make sure it wasn't messing
> things up.
>
> So I've reached the end of what Google and the docs have been able to tell
> me. Help is most graciously appreciated.
>
> tj
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/f3b7ea8a/attachment.htm>

From pzgyuanf at gmail.com  Thu Jun 27 18:46:47 2013
From: pzgyuanf at gmail.com (pprun)
Date: Fri, 28 Jun 2013 01:46:47 +0800
Subject: [rabbitmq-discuss] [Java-client] How to catch the error or
 exception while call basic operation?
Message-ID: <kqhtr1$4th$2@ger.gmane.org>

Hi all,

I have code call channel.basicPublish(exchangeName, routingKey, props, 
message.getBytes());,  without firstly declare the exchange.

Although the method return normally, but server log the error, as below:

=ERROR REPORT==== 28-Jun-2013::01:35:50 ===
connection <0.853.0>, channel 1 - soft error:
{amqp_error,not_found,
             "no exchange 
'com.abc.mq.ex.d2ac3c5c-1caf-4c73-bbdf-2024a0e5c092' in vhost '/'",
             'basic.publish'}


My question is how to catch the error/exception, so clients know there's 
failure?

Thanks,
Pprun


From rahul at xaptum.com  Fri Jun 28 02:00:29 2013
From: rahul at xaptum.com (Rahul Sharma)
Date: Thu, 27 Jun 2013 20:00:29 -0500
Subject: [rabbitmq-discuss] IOException
Message-ID: <CAM274ZPr2_FmTpuOzrqeLDwNuzsNypjqmUW=RYzhvY9JqmCdFg@mail.gmail.com>

Hi ,

I am new bee to RabbitMQ,

I was trying to read the messages posted on rabbit MQ but i am getting the
following error

=====================

CM :com.xaptum.message.api.ConnectionManager at 602f892f
Inside getConnectionFactory
outside getConnectionFactory

ConnectionFactory :com.rabbitmq.client.ConnectionFactory at 5fd1358f
Connection Error: java.io.IOException
java.io.IOException
    at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
    at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
    at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
    at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
    at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
    at
com.xaptum.message.api.ConnectionManager.getConnection(ConnectionManager.java:129)
    at
com.xaptum.message.api.ConnectionManager.createConnection(ConnectionManager.java:64)
    at com.xaptum.message.api.MainTest.main(MainTest.java:9)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
reason: java.net.SocketTimeoutException: Timeout during Connection
negotiation
    at
com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
    at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
    at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
    at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
    ... 5 more
Caused by: java.net.SocketTimeoutException: Timeout during Connection
negotiation
    at
com.rabbitmq.client.impl.AMQConnection.handleSocketTimeout(AMQConnection.java:566)
    at
com.rabbitmq.client.impl.AMQConnection.access$500(AMQConnection.java:59)
    at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:541)
Secondcom.rabbitmq.client.ConnectionFactory at 5fd1358f
Check :false
java.lang.NullPointerException
Error in closeChannelnull
    at
com.xaptum.message.api.ConnectionManager.readMessage(ConnectionManager.java:83)
    at com.xaptum.message.api.MainTest.main(MainTest.java:13)
=============


Can some one please guide me.

Regards,
Rahul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/8288bf6d/attachment.htm>

From rahul at xaptum.com  Fri Jun 28 02:18:53 2013
From: rahul at xaptum.com (Rahul Sharma)
Date: Thu, 27 Jun 2013 18:18:53 -0700 (PDT)
Subject: [rabbitmq-discuss] IO Exception
Message-ID: <d2168537-9015-4e5d-af07-36888f55369e@googlegroups.com>

Hi there,

I was attempting to read messages from my rabbitMQ server , initially it 
worked fine, but suddenly it started throwing IOException:

================================
java.io.IOException
    at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
    at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
    at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
    at 
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
    at 
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
    at 
com.xaptum.message.api.ConnectionManager.getConnection(ConnectionManager.java:131)
    at 
com.xaptum.message.api.ConnectionManager.createConnection(ConnectionManager.java:64)
    at com.xaptum.message.api.MainTest.main(MainTest.java:9)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; 
reason: java.net.SocketTimeoutException: Timeout during Connection 
negotiation
    at 
com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
    at 
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
    at 
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
    at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
    ... 5 more
Caused by: java.net.SocketTimeoutException: Timeout during Connection 
negotiation
    at 
com.rabbitmq.client.impl.AMQConnection.handleSocketTimeout(AMQConnection.java:566)
    at 
com.rabbitmq.client.impl.AMQConnection.access$500(AMQConnection.java:59)
    at 
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:541)
Secondcom.rabbitmq.client.ConnectionFactory at 2013706e
======================


any help is appreciated.

Regards,
Rahul

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/e274b0f4/attachment.htm>

From 314992959 at qq.com  Fri Jun 28 03:58:58 2013
From: 314992959 at qq.com (3k4b251)
Date: Thu, 27 Jun 2013 19:58:58 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-c should I start a thread for
 amqp_simple_wait_frame() to get mesage?
Message-ID: <1372388338889-27666.post@n5.nabble.com>

amqp_simple_wait_frame()  is  a  bloking  function. I  think  I should  start
a  thread for  it.  But  if  I follow this,  I  need  to share  connection 
between   threads, alanxz  told  me  that's  not  safe,I   also  found   it 
made   other  functions  block. what should I do  for this?  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-should-I-start-a-thread-for-amqp-simple-wait-frame-to-get-mesage-tp27666.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From k.madnani84 at gmail.com  Fri Jun 28 05:33:17 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Thu, 27 Jun 2013 21:33:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: cannot_discover_cluster: The nodes
 provided are either offline or not running
In-Reply-To: <1371660377336-27496.post@n5.nabble.com>
References: <1371660377336-27496.post@n5.nabble.com>
Message-ID: <1372393996140-27667.post@n5.nabble.com>

Thanks Matthias for the reply.
Well i figured out what the problem was,actually there was an extra space
getting added to my cookie.once i recognized it things started working fine.

Thanks to everyone in this thread who cooperated with me to help resolve the
issue.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-cannot-discover-cluster-The-nodes-provided-are-either-offline-or-not-running-tp27496p27667.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ankit.ag2010 at gmail.com  Fri Jun 28 07:40:18 2013
From: ankit.ag2010 at gmail.com (Ankit Agarwal)
Date: Thu, 27 Jun 2013 23:40:18 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
Message-ID: <76a2be8c-e710-4c91-93f6-a5e9a3758974@googlegroups.com>

I created a rabbitmq.config file in /etc/rabbitmq/ to set the frame_max size

[
    {rabbit, [{frame_max ,0 }]}
  ].

But its not reading from the file.

Please help

On Monday, June 24, 2013 11:42:52 AM UTC+5:30, Ankit Agarwal wrote:
>
>
>  I have recently upgraded logstash version from 2.8.4.It was performing 
> very well with my setup.
>
>  I am using logstash to ship logs to RabbitMQ.
>
>  After upgrading to 3.1.1.I have started facing closed connection issues 
> on logstash.
>
> Logstash throws these errors:-
>
> {:message=>"AMQP connection error (during connect), will reconnect", 
> :exception=>#<Bunny::ServerDownError: Connection refused - Connection 
> refused>, 
> :backtrace=>["jar:file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/gems/bunny-0.8.0/lib/qrack/client.rb:226:in 
> `socket'", 
> "jar:file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/gems/bunny-0.8.0/lib/qrack/client.rb:222:in 
> `socket'", 
> "jar:file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/gems/bunny-0.8.0/lib/bunny/client.rb:295:in 
> `start_session'", 
> "file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/amqp.rb:94:in 
> `connect'", 
> "file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/amqp.rb:140:in 
> `receive_raw'", 
> "file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/amqp.rb:136:in 
> `receive_raw'", 
> "file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/amqp.rb:121:in 
> `receive'", 
> "file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/outputs/base.rb:55:in 
> `handle'", 
> "file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/agent.rb:758:in 
> `run_output'", 
> "file:/home/hs18web/logstash/logstash-1.1.9-monolithic.jar!/logstash/agent.rb:379:in 
> `start_output'"], :level=>:error}
>
> On the rabbitmq side i m getting these errors:-
>
>
> =ERROR REPORT==== 24-Jun-2013::11:27:51 ===
> AMQP connection <0.26481.237> (running), channel 1 - error:
> {amqp_error,frame_error,
>             "type 3, all octets = <<>>: {frame_too_large,1020815,131064}",
>             none}
>
> =ERROR REPORT==== 24-Jun-2013::11:27:54 ===
> closing AMQP connection <0.26481.237> (172.16.0.60:53224 -> 
> 172.16.0.63:5672):
> fatal_frame_error
>
> As the AMQP connections are closing i need to restart logstash.All the 
> reports for the day are hampering.
>
> Please help.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130627/8223f16c/attachment.htm>

From ankit.ag2010 at gmail.com  Fri Jun 28 07:59:00 2013
From: ankit.ag2010 at gmail.com (Ankit Agarwal)
Date: Fri, 28 Jun 2013 12:29:00 +0530
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <51C80B50.2090104@rabbitmq.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
	<51C80B50.2090104@rabbitmq.com>
Message-ID: <CALyoCeMg0su9hzSaERZrazxMpmOJ7KyBF=V=VA4gubUytUBYHA@mail.gmail.com>

I created a rabbitmq.config file in /etc/rabbitmq/ to set the frame_max size

[
    {rabbit, [{frame_max ,0 }]}
  ].

But its not reading from the file.

Please help


On Mon, Jun 24, 2013 at 2:33 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 24/06/13 07:12, Ankit Agarwal wrote:
> > {frame_too_large,1020815,131064}",
>
> The error is that the frame is too large. See the "frame_max"
> configuration item in http://www.rabbitmq.com/configure.html. Either set
> it too a larger value or to 0 for unlimited.
>
> The maximum frame size was not strictly enforced before v3.0.0, which is
> why the issue appeared after upgrading. See item 24991 in
> http://www.rabbitmq.com/release-notes/README-3.0.0.txt
>
>
> -Emile
>
>
>


-- 
Regards,

Ankit Agarwal
Ph-9591788686
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130628/c56ce55d/attachment.htm>

From simlu at su.se  Fri Jun 28 08:51:34 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Fri, 28 Jun 2013 09:51:34 +0200
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
 or Shibboleth integration
In-Reply-To: <1349893961236-22477.post@n5.nabble.com>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
	<20121010134540.GV10330@data.it.su.se>
	<5075A1EA.5020507@rabbitmq.com>
	<1349893961236-22477.post@n5.nabble.com>
Message-ID: <20130628075134.GF17349@kaka.it.su.se>

On Wed, 2012-10-10 at 11:32:41 -0700, Prabodh Upreti wrote:
> hello
> 
> Could you please explain how you have configured Shibboleth with rabbit.
> Sounds like I need to do the same with CAS.  I don't want to go the route of
> creating a plugin. thank you

Actually, I solved this with a hackish solution. As I stated before we
use Shibboleth but it should work with CAS.

Important: We use one admin account which all admins use.
While you can make it work with several accounts and create a mapping of
SSO users <=> RabbitMQ users that would involve alot of pain I'd recon
(unless you'd store the RabbitMQ username as a attribute in your SSO..
Well, ok. It might work, but don't bother IMO).


I'll describe the general idea so you can create your own solution:
* Setup an webserver (Apache in our case) with your authentication
module installed (Shibboleth in our case).
* Do an HTTP rewrite to /autologin if a cookie, e.g. tried_shib=1, isn't set.
* On /autologin run an CGI-script (Perl in our case, doesn't matter
which language) which does:
** Reads the your "rabbitmqadmin.conf" file and get the default username
and password.
** Checks if the user should be autologgedin or not (e.g. via a group
membership, affiliation etc)
** Set the cookie named "auth" to the base64 encoded value of
"username:password" and set the cookie in your HTTP rewrite, e.g.
tried_shib=1 in our case and expire it after 3 minutes (so that users
can retry to login if they accidentally log out e.g.).
** HTTP redirect to /
* (Remember to disable your authentication module on "/api".)

Hope you can make it work.

Br,
- Simon

P.S. I added Shibboleth to the subject for SEO reasons

____________________________________

Simon Lundstr?m
Section for Infrastructure

IT Services
Stockholm University
SE-106 91 Stockholm, Sweden

www.su.se/it

____________________________________

From watson.timothy at gmail.com  Fri Jun 28 09:06:56 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 28 Jun 2013 09:06:56 +0100
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <CALyoCeMg0su9hzSaERZrazxMpmOJ7KyBF=V=VA4gubUytUBYHA@mail.gmail.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
	<51C80B50.2090104@rabbitmq.com>
	<CALyoCeMg0su9hzSaERZrazxMpmOJ7KyBF=V=VA4gubUytUBYHA@mail.gmail.com>
Message-ID: <249AB275-3EF3-450F-B016-7D30BDB9D9ED@rabbitmq.com>

On 28 Jun 2013, at 07:59, Ankit Agarwal <ankit.ag2010 at gmail.com> wrote:

> I created a rabbitmq.config file in /etc/rabbitmq/ to set the frame_max size
> 
> [
>     {rabbit, [{frame_max ,0 }]}
>   ].
> 
> But its not reading from the file.
> 

Be more specific when asking questions please. Do you mean it is not altering the errors you mentioned before (due to frame size limits) or are you getting an error when starting the broker? You have restarted the broker to apply this configuration change yes?

Cheers
Tim

From simon at rabbitmq.com  Fri Jun 28 11:01:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Jun 2013 11:01:41 +0100
Subject: [rabbitmq-discuss] IO Exception
In-Reply-To: <d2168537-9015-4e5d-af07-36888f55369e@googlegroups.com>
References: <d2168537-9015-4e5d-af07-36888f55369e@googlegroups.com>
Message-ID: <51CD5F05.9070008@rabbitmq.com>

On 28/06/13 02:18, Rahul Sharma wrote:
> Caused by: java.net.SocketTimeoutException: Timeout during Connection
> negotiation

Presumably some firewall is dropping packets now. Or the network is 
misconfigured somehow.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 28 11:02:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Jun 2013 11:02:36 +0100
Subject: [rabbitmq-discuss] TCP vs. SSL configuration
In-Reply-To: <CAPVVMa-9CZKJF2Cx_OoQPrrt+h6z4MsgeYL5zGFWzFc2OP3JVQ@mail.gmail.com>
References: <567bd7a8-b428-4663-85a4-3932ac7d9a18@googlegroups.com>
	<51CC066D.4060809@rabbitmq.com>
	<CAPVVMa_45MYDuc1y0ev2NjFQ-xp2_KSUPReouVqTjPdqecH-ww@mail.gmail.com>
	<51CC42E3.5090303@rabbitmq.com>
	<CAPVVMa-9CZKJF2Cx_OoQPrrt+h6z4MsgeYL5zGFWzFc2OP3JVQ@mail.gmail.com>
Message-ID: <51CD5F3C.602@rabbitmq.com>

Yes. Or it could be rephrased to mention the config file. Hmm.

Cheers, Simon

On 27/06/13 14:52, Tim Bain wrote:
> OK, leaving the value blank in a single-node single-machine broker makes
> sense.
>
> The documentation at
> http://www.rabbitmq.com/clustering.html#single-machine says that for a
> clustered broker with multiple nodes on a single machine, "You must
> ensure that for each invocation you set the environment variables
> RABBITMQ_NODENAME and RABBITMQ_NODE_PORT to suitable values."  Should
> that really say that RABBITMQ_NODENAME is required in all cases, and
> RABBITMQ_NODE_PORT is required if TCP is enabled but not required if
> it's not?
>
>
> On Thu, Jun 27, 2013 at 9:49 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Just leave RABBITMQ_NODE_PORT blank. The "real" setting is the one
>     in the config file, the environment variables provide a way to
>     override that, if they are set.
>
>     If you want multiple brokers on one machine, each with SSL only,
>     you'll need to set up one config file per broker, and then point to
>     that using RABBITMQ_CONFIG_FILE (see
>     http://www.rabbitmq.com/__relocate.html
>     <http://www.rabbitmq.com/relocate.html>).
>
>     Cheers, Simon
>
>
>     On 27/06/13 14:33, Tim Bain wrote:
>
>         So if TCP is disabled via the section you referenced in
>         rabbitmq.config,
>         then what goes in the environment variable RABBITMQ_NODE_PORT?
>           Is that
>         value simply ignored if TCP is disabled (so you can set the
>         environment
>         variable to anything, or just leave it unset)?  Do you set it to
>         the SSL
>         port?  Something else?
>
>         And if you have a set of N nodes in a cluster on a single
>         machine, do
>         you still need to have a different value of RABBITMQ_NODE_PORT
>         for each
>         instance?  (Do you just make it match the SSL port each node is
>         using?)
>
>         Thanks,
>         Tim
>
>
>         On Thu, Jun 27, 2013 at 5:31 AM, Simon MacMullen
>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>              You can't disable the TCP listener via environment
>         variables and
>              hence rabbitmq-env.conf. But you can via the main
>         configuration file
>              - see tcp_listeners under
>         http://www.rabbitmq.com/____configure.html#config-items
>         <http://www.rabbitmq.com/__configure.html#config-items>
>
>              <http://www.rabbitmq.com/__configure.html#config-items
>         <http://www.rabbitmq.com/configure.html#config-items>> - just set it
>              to [].
>
>              Cheers, Simon
>
>              On 26/06/13 17:50, tbain98 at gmail.com
>         <mailto:tbain98 at gmail.com> <mailto:tbain98 at gmail.com
>         <mailto:tbain98 at gmail.com>> wrote:
>
>                  I'm new to RabbitMQ, and am a bit confused by some of the
>                  documentation
>                  surrounding TCP vs. SSL configuration.
>
>                  I'm trying to set up a broker for which only
>         authenticated SSL-based
>                  connections will be allowed, so I do not want the TCP
>         listener
>                  running.
>                  That seems easy to do for rabbitmq-env.conf, but the
>         documentation
>                  <http://www.rabbitmq.com/____configure.html
>         <http://www.rabbitmq.com/__configure.html>
>
>                  <http://www.rabbitmq.com/__configure.html
>         <http://www.rabbitmq.com/configure.html>>> seems to indicate that
>                  RABBITMQ_NODE_PORT is a required property (or at least,
>         it seems
>                  to be
>                  required if you're setting up clustering on a single
>         machine
>
>         <http://www.rabbitmq.com/____clustering.html#single-machine
>         <http://www.rabbitmq.com/__clustering.html#single-machine>
>
>         <http://www.rabbitmq.com/__clustering.html#single-machine
>         <http://www.rabbitmq.com/clustering.html#single-machine>__>__>,
>
>                  which I'm not
>                  doing yet but want the option to do in the future) and
>         that if
>                  it's not
>                  provided, a default will be used.
>
>                  Is it possible to configure an SSL-only broker (just
>         one node on a
>                  single machine), and if so, what if anything do you set
>                  RABBITMQ_NODE_PORT to?  (Just "RABBITMQ_NODE_PORT=" ?)  And
>                  (separate
>                  question) is it possible to configure a single-machine
>         cluster with
>                  multiple nodes, where each node is SSL-only, and again,
>         what do
>                  you set
>                  RABBITMQ_NODE_PORT to for each node?
>
>                  Thanks for the help...
>                  Tim
>
>
>                  ___________________________________________________
>                  rabbitmq-discuss mailing list
>                  rabbitmq-discuss at lists.__rabbi__tmq.com
>         <http://rabbitmq.com>
>                  <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>
>
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>
>
>
>
>              --
>              Simon MacMullen
>              RabbitMQ, Pivotal
>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jun 28 11:05:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Jun 2013 11:05:41 +0100
Subject: [rabbitmq-discuss] Feature request: move messages using
 management UI
In-Reply-To: <34f5d415-8f39-465c-9138-3d0e09ef069d@googlegroups.com>
References: <34f5d415-8f39-465c-9138-3d0e09ef069d@googlegroups.com>
Message-ID: <51CD5FF5.5030401@rabbitmq.com>

Yeah, that makes some sense. I'll file a bug.

Cheers, Simon

On 26/06/13 15:36, Jochen Zeischka wrote:
> At our company, we've written a tool to move messages from their
> dead-letter queues back to the original queue.
>
> Would it make sense to be able to do so from the management UI?
> The feature I'm looking for is the ability to move messages from one
> queue to another queue.
>
> Kind regards!
>
> Jochen
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Fri Jun 28 11:09:14 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 28 Jun 2013 14:09:14 +0400
Subject: [rabbitmq-discuss] IOException
In-Reply-To: <CAM274ZPr2_FmTpuOzrqeLDwNuzsNypjqmUW=RYzhvY9JqmCdFg@mail.gmail.com>
References: <CAM274ZPr2_FmTpuOzrqeLDwNuzsNypjqmUW=RYzhvY9JqmCdFg@mail.gmail.com>
Message-ID: <41C4F500-7C1F-4A5B-9DCC-970BE58664B6@gopivotal.com>

Rahul Sharma:

> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.net.SocketTimeoutException: Timeout during Connection negotiation

Here's the reason, you have a socket timeout during connection.

It may be a firewall configuration issue.

MK

From michael.laing at nytimes.com  Fri Jun 28 11:35:14 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Fri, 28 Jun 2013 06:35:14 -0400
Subject: [rabbitmq-discuss] Feature request: move messages using
 management UI
In-Reply-To: <51CD5FF5.5030401@rabbitmq.com>
References: <34f5d415-8f39-465c-9138-3d0e09ef069d@googlegroups.com>
	<51CD5FF5.5030401@rabbitmq.com>
Message-ID: <CAKgmDnFca=acn0Kq9DGuU59qUnM+PSQ390LgQjOLP9-tC_xvqw@mail.gmail.com>

+1 on this. I can see a lot of usage scenarios for both copy and move, esp.
in testing, but other scenarios too.

Best regards,
Michael


On Fri, Jun 28, 2013 at 6:05 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Yeah, that makes some sense. I'll file a bug.
>
> Cheers, Simon
>
>
> On 26/06/13 15:36, Jochen Zeischka wrote:
>
>> At our company, we've written a tool to move messages from their
>> dead-letter queues back to the original queue.
>>
>> Would it make sense to be able to do so from the management UI?
>> The feature I'm looking for is the ability to move messages from one
>> queue to another queue.
>>
>> Kind regards!
>>
>> Jochen
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130628/b76d7753/attachment.htm>

From ask at rabbitmq.com  Fri Jun 28 12:28:05 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Fri, 28 Jun 2013 12:28:05 +0100
Subject: [rabbitmq-discuss] Getting many messages,
	ack() failing if total messages not equal a 10 increment
In-Reply-To: <faba7352-9c2e-4d87-ab8f-8fa8370941bd@googlegroups.com>
References: <faba7352-9c2e-4d87-ab8f-8fa8370941bd@googlegroups.com>
Message-ID: <76DAD01F-1549-42E0-B09C-D10B78B9BA3E@rabbitmq.com>


On Jun 22, 2013, at 3:32 PM, Matthew Taft <matthewetaft at gmail.com> wrote:

> Hi everyone,
> 
> Hoping someone can help me with this problem.  After going through a few tutorials, I've pieced together some code the produce and consume messages.  I'm using kombu.  I'lll past the code below.  But the idea is to be able to send many messages to the queue, possibly hundreds, then have a periodic task that wakes up and consumes all messages.  Right now I haven't set up the periodic task.  It's just a simply python file.  When passed "produce," it produces some random messages.  When passed "consume," it consumes them.
> 
> I've found that when the total messages is in increments of 10 (90, 100, 510, etc.), all messages get processed correctly and the qsize value shows there are 0 messages remaining.  However -- and this is better explained by example - if the queue contains 78 messages, after processing all of them, the queue reports 8 remaining, but the consumer can no longer get them (times out).  Any time the total qsize at the start is anything other than a 10 increment (129, 523, 234, etc.), the part beyond the latest 10 increment is left remaining (9, 3, 4, etc.). 
> 
> I've added some print statements to confirm that each message is actually consumed correctly, and the ack() is being called for each one.  However, I noticed that the qsize value is only being updated every 10 messages.  Here's the log for some of them to give you a better idea. The first number is the counter.  It's shown three times for each message because I'm printing before the get, after the get, then after the ack().  Notice the qsize value only updates every 10 messages:
> 
> Is it just some configuration I have to set?  Or is there something wrong in the code?  Here's the code in full:
> 

Welcome Matthew!

It reports correctly for me here:

from kombu import Connection

def get(q):
   for i in range(1000):
       print(len(q))
       m = q.get()
       m.ack()

def put(q):
   for i in range(1000):
       q.put('hello')

if __name__ = '__main__'
   conn = Connection('amqp://')
   q = conn.SimpleQueue('squ')
   q.channel.basic_qos(prefetch_count=1)
   put(q)
   get(q)


If you change the prefetch count it may skip numbers, but it always decreases.


Maybe you have a left-over consumer still running that you did not terminate correctly?
Take a look at the consumer count by running the command:

 rabbitmqctl list_queues -p $your_vhost name consumers



From lrodriguez1995 at yahoo.com  Fri Jun 28 13:29:40 2013
From: lrodriguez1995 at yahoo.com (Luis Rodriguez)
Date: Fri, 28 Jun 2013 05:29:40 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq broadcasting a message to different
	clients without an exchange
Message-ID: <1372422580.81462.YahooMailNeo@web141101.mail.bf1.yahoo.com>

Hi all,

I have 3 vm's running in a cluster (disc only), (only one queue). the three are set to high availability.
after reading how to use the exchange (fanout) I was wondering if it could be possible to broadcast a message simultaneously to all? the nodes and have the clients echo...
I only have been able to do this for 1 individual node at a time..(and since I have ha-all , then if 1 node goes down, the remaining nodes would still echo)..
Thanks in advance..



Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130628/e3b1a9f4/attachment.htm>

From daniel at siftlogic.com  Fri Jun 28 15:38:34 2013
From: daniel at siftlogic.com (Daniel Luna)
Date: Fri, 28 Jun 2013 10:38:34 -0400
Subject: [rabbitmq-discuss] HiPE compilation error with rabbitmq 3.1.3
 and erlang R16B01: Cannot find ssl_record.beam file.
In-Reply-To: <51CC33DA.5060708@rabbitmq.com>
References: <1372335488.2476.90.camel@CLM3X4J.systran.local>
	<CAGrdgiUazP_DU7Dw4Zog6qVk3r5DNvq6ziLxSH2hL+sKs15zTg@mail.gmail.com>
	<51CC33DA.5060708@rabbitmq.com>
Message-ID: <CAMbH-oz5z5jyG2EAu__LOaV7cD25iXK1Vbk_XjwnaU0+H1f+0A@mail.gmail.com>

On Thu, Jun 27, 2013 at 8:45 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> I've seen throughput improvements up to 50% for some cases. HiPE is
> enabled selectively only for the broker modules that benefit from it.
> Unfortunately it often causes segfaults in the VM, so not enabled by
> default.
>

Are any of these crashes reproducible?  Do you know which modules are the
cause of the crashes.

I know that the HiPE team (as small as it may be nowadays) would love to
get bug reports regarding anything that's broken.

Cheers,

Daniel (former HiPE team member and the person that ported HiPE to x86_64
so probably the one to blame)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130628/0f67d9e1/attachment.htm>

From mklishin at gopivotal.com  Fri Jun 28 15:57:27 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 28 Jun 2013 18:57:27 +0400
Subject: [rabbitmq-discuss] rabbitmq broadcasting a message to different
	clients without an exchange
In-Reply-To: <1372422580.81462.YahooMailNeo@web141101.mail.bf1.yahoo.com>
References: <1372422580.81462.YahooMailNeo@web141101.mail.bf1.yahoo.com>
Message-ID: <AE024091-2DA6-45C3-AF21-61122EDFD0D0@gopivotal.com>

Luis Rodriguez:

> after reading how to use the exchange (fanout) I was wondering if it could be possible to broadcast a message simultaneously to all  the nodes and have the clients echo

Luis,

Can you be more specific?

Exchanges route messages to queues, not nodes. Contents of mirrored queues
is replicated but when you consume a message from a mirrored queue, all
copies are gone.

You can have N queues bound to a fanout and then your clients can connect
to any nodes to consume from them. When a node goes down or becomes
unavailable, clients should reconnect to another node and continue
consuming from the same queue.

MK

From nathan at nkbrown.us  Fri Jun 28 17:03:46 2013
From: nathan at nkbrown.us (Nathan Brown)
Date: Fri, 28 Jun 2013 09:03:46 -0700
Subject: [rabbitmq-discuss] Porting .NET client to WinRT API (Windows 8).
In-Reply-To: <CAFCmQSqjtDJ4tRXUv70uqsNh5zWqjKrmrJoM3noN88sUQKm_7w@mail.gmail.com>
References: <CAFCmQSrAL8Rj_UmwdiFw407m2SVF5b2uR9Wp_SSVHLX_jLOsZg@mail.gmail.com>
	<518CC1C5.1060008@rabbitmq.com>
	<CAFCmQSofOfwN5B2rdRsALXYfcv-EvcUOYBGorY7xZNyBjBhp9w@mail.gmail.com>
	<CAE3HoVSsz-XAxjKqv4SPmzMm70fb5jenc305jUvWFy6GL4z1dA@mail.gmail.com>
	<CAFCmQSov3BcicqMDTveo+gvyVaNePma669nBt_JffyP6FRhvdg@mail.gmail.com>
	<CAFCmQSqjtDJ4tRXUv70uqsNh5zWqjKrmrJoM3noN88sUQKm_7w@mail.gmail.com>
Message-ID: <CAFCmQSo1w_w08XWO5bP_YEC7MkARHQYn3noJtVJEE8rX872pAQ@mail.gmail.com>

I have pushed my changes to RabbitMQ client for .NET for it to work in a
Windows 8 Store / WinRT environment.  It includes a basic Windows Store
application that connects to the specified amqp URL and subscribes to
messages.  By pressing a button, messages can be sent to the RabbitMQ
server and will then be received by the subscription and displayed in a
list.

The unit tests had to be copied and ported to MSTest because NUnit doesn't
deploy to an app container and some of the WinRT APIs require that.
 Specifically getting the protocol from application configuration.

I added a Subscription.NextAsync() and modified the SharedQueue to handle a
Task based DequeueAsync efficiently.  This allows the main GUI loop to wait
for a message without a separate thread.  These changes will only be
compiled in if the project is a Windows Store App (which defines
NETFX_CORE).

The SSL code is un-tested and probably broken.  The reason for the change
is that the WinRT StreamSocket API handles the SSL internally and doesn't
let the client code do as much as with the previous Socket implementation.
 If someone with experience with SSL can take a look and test it, that
would be great.

Please take a look here:
https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/commits/branch/WinStore

It doesn't appear that the NuGet package creation is in this repository, so
I was unable to make any changes to that.

Let me know of any feedback you have.

Thanks,

Nathan Brown



On Tue, Jun 25, 2013 at 10:29 AM, Nathan Brown <nathan at nkbrown.us> wrote:

> Accidentally sent the message before I finished.
>
> My questions were:
>
> Is there any feedback on the code I've submitted so far?
>
> For the Windows 8 changes; How should I deal with the split in the
> codebase?  Should I use conditional compilation like #ifdef NETFX_CORE, or
> use copies of the files that change and links for the ones that don't?  I
> personally think that conditional compilation for most changes and only
> separate files for the ones that change a lot (like SSL handling) is the
> best option.
>
> Thanks,
>
> Nathan
>
>
> On Tue, Jun 25, 2013 at 10:22 AM, Nathan Brown <nathan at nkbrown.us> wrote:
>
>> I've submitted the contributor agreement, and I hope the submitted
>> changes can now be reviewed and considered for main-line inclusion.
>>
>> Emile mentioned that this is now under "bug25552", should I re-base my
>> code to the most recent .net client release and set the branch name to
>> match?
>>
>> Also, there are really the separate changes that could be made
>> independently:
>>
>>    - Corrected test to pull correct value types from dictionary.<https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/commits/25988f1d5bea8ad86aed536edd4d4fe1826ac43f>
>>    - Move from non-generic dictionary (.net 1.1) to generic dictionary,
>>    required, but independent of the next change.  This is my "depreciate1_1"
>>    branch<https://bitbucket.org/nathanbrown/rabbitmq-dotnet-client/commits/branch/depreciate1_1>
>>    .
>>    - Add Windows 8/RT code to handle differences in threads and sockets.
>>    - Threads are removed in favor of Tasks, and sockets have been
>>    removed in favor of StreamSockts
>>
>> *
>>
>>
>>
>> On Sat, May 11, 2013 at 2:05 PM, Michael Klishin <
>> michael.s.klishin at gmail.com> wrote:
>>
>>> 2013/5/12 Nathan Brown <nathan at nkbrown.us>
>>>
>>>>  I'm also not familiar with setting up and testing SSL in RabbitMQ.
>>>
>>>
>>> Take a look at http://rabbitmq.com/ssl.html
>>> --
>>> MK
>>>
>>> http://github.com/michaelklishin
>>> http://twitter.com/michaelklishin
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130628/b4c7fefb/attachment.htm>

From skipatrol at gmail.com  Fri Jun 28 23:46:39 2013
From: skipatrol at gmail.com (Donovan Levinson)
Date: Fri, 28 Jun 2013 16:46:39 -0600
Subject: [rabbitmq-discuss] RabbitMQ Server TCP buffer and network tweaks
Message-ID: <CAMFSz2A57pgsLfQ7zqSJ8esF36bf4OhZ4OkH4JYKGL7q=k9n6w@mail.gmail.com>

Dear AMQPers,

I am setting two AMQP message brokers on LAN running the latest RabbitMQ
Server 3.1.3.  They will be part of a high-availability cluster with full
mirroring.  The cluster will receive about 430 messages per second (or
280KB/s incoming data as shown by VM statistics).  Each server process will
run on its own dedicated VM with 4 CPUs and 8GB of RAM.

I am wondering if I should make any considerations to increase the TCP
buffer size, or other OS-level Linux network configurations that could help
optimize performance, or if it's recommended to go with the OS defaults?


Thanks,
Donovan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130628/34690528/attachment.htm>

From skipatrol at gmail.com  Sat Jun 29 00:03:50 2013
From: skipatrol at gmail.com (Donovan Levinson)
Date: Fri, 28 Jun 2013 16:03:50 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Server TCP buffer and network tweaks
Message-ID: <93fb9bd2-eda9-4ccf-85b5-b68dbfd6f0eb@googlegroups.com>

Dear AMQPers,

I am setting two AMQP message brokers on a LAN running the latest RabbitMQ 
Server 3.1.3.  They will be part of a high-availability cluster with full 
mirroring.  The cluster will receive about 430 messages per second (or 
280KB/s incoming data as shown by VM statistics).  Each server process will 
run on its own dedicated VM with 4 CPUs and 8GB of RAM.  Some of the 
publishers are on high-latency WAN connections, while the consumers are 
primarily located on the LAN.

I am considering the following changes:

echo 'net.core.wmem_max=1048576' >> /etc/sysctl.conf
echo 'net.core.rmem_max=1048576' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_rmem= 10240 87380 1048576' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_wmem= 10240 87380 1048576' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_window_scaling = 1' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_timestamps = 1' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_sack = 1' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_no_metrics_save = 1' >> /etc/sysctl.conf
echo 'net.core.netdev_max_backlog = 5000' >> /etc/sysctl.conf

Please let me know your thoughts on whether I should apply these or other 
Linux network tweaks, or if it's recommended to go with the OS defaults?


Thanks,
Donovan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130628/212f8e9e/attachment.htm>

From michael.s.klishin at gmail.com  Sat Jun 29 00:18:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 29 Jun 2013 03:18:15 +0400
Subject: [rabbitmq-discuss] RabbitMQ Server TCP buffer and network tweaks
In-Reply-To: <CAMFSz2A57pgsLfQ7zqSJ8esF36bf4OhZ4OkH4JYKGL7q=k9n6w@mail.gmail.com>
References: <CAMFSz2A57pgsLfQ7zqSJ8esF36bf4OhZ4OkH4JYKGL7q=k9n6w@mail.gmail.com>
Message-ID: <CAE3HoVS0Yp_5G7GJ7d2zg6+c_2SZKe=3Vwdytsk=kx-DyTgz4A@mail.gmail.com>

2013/6/29 Donovan Levinson <skipatrol at gmail.com>

> I am wondering if I should make any considerations to increase the TCP
> buffer size, or other OS-level Linux network configurations that could help
> optimize performance, or if it's recommended to go with the OS defaults?


Donovan,

That sounds like plenty of capacity for a few hundreds messages or KBs per
second, even without
any TCP stack tuning. I believe you should be able to go up an order of
magnitude without
having to worry about your network configuration.

Many clients disable Nagle's algorithm, that is often enough.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130629/1430c0dd/attachment.htm>

From monish.unni at gmail.com  Sat Jun 29 04:15:54 2013
From: monish.unni at gmail.com (cogitate)
Date: Fri, 28 Jun 2013 20:15:54 -0700 (PDT)
Subject: [rabbitmq-discuss] c amqp consumer frame header issue
Message-ID: <1372475754640-27685.post@n5.nabble.com>

hi alan (antonuk):
this particular logic for C consumers (experimental, from github) for
rabbitmq aborts when pika based consumer, rabbitmq-java based consumer are
able to drain the queue.
from your github repo:
 https://github.com/alanxz/rabbitmq-c

it fails at this point:
 if (frame.frame_type != AMQP_FRAME_HEADER) {
      fprintf(stderr, "Expected header!");
      abort();
    }

i'm not sure why? 


#include <stdio.h>
#include <string.h>

#include <stdint.h>
#include <amqp.h>
#include <amqp_framing.h>

#include <assert.h>

#include "utils.h"

#define SUMMARY_EVERY_US 1000000

static void run(amqp_connection_state_t conn)
{
  uint64_t start_time = now_microseconds();
  int received = 0;
  int previous_received = 0;
  uint64_t previous_report_time = start_time;
  uint64_t next_summary_time = start_time + SUMMARY_EVERY_US;

  amqp_frame_t frame;
  int result;
  size_t body_received;
  size_t body_target;

  uint64_t now;

  while (1) {
    now = now_microseconds();
    if (now > next_summary_time) {
      int countOverInterval = received - previous_received;
      double intervalRate = countOverInterval / ((now -
previous_report_time) / 1000000.0);
      printf("%d ms: Received %d - %d since last report (%d Hz)\n",
         (int)(now - start_time) / 1000, received, countOverInterval, (int)
intervalRate);

      previous_received = received;
      previous_report_time = now;
      next_summary_time += SUMMARY_EVERY_US;
    }

    amqp_maybe_release_buffers(conn);
    result = amqp_simple_wait_frame(conn, &frame);
    if (result < 0)
      return;

    if (frame.frame_type != AMQP_FRAME_METHOD)
      continue;

    if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
      continue;

    result = amqp_simple_wait_frame(conn, &frame);
    if (result < 0)
      return;

    if (frame.frame_type != AMQP_FRAME_HEADER) {
      fprintf(stderr, "Expected header!");
      abort();
    }




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/c-amqp-consumer-frame-header-issue-tp27685.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Sat Jun 29 07:54:34 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 28 Jun 2013 23:54:34 -0700
Subject: [rabbitmq-discuss] c amqp consumer frame header issue
In-Reply-To: <1372475754640-27685.post@n5.nabble.com>
References: <1372475754640-27685.post@n5.nabble.com>
Message-ID: <CAAt2poKQN_-zRE1YpSM7MhFTuvTpEUNCh8GF9jUHtQU=-9=wfg@mail.gmail.com>

Its hard to say whats going on without knowing a bit more about whats going
on in the rest of your program.

It fails at frame.frame_type != AMQP_FRAME_HEADER, what is the value of
frame.frame_type when it fails?



On Fri, Jun 28, 2013 at 8:15 PM, cogitate <monish.unni at gmail.com> wrote:

> hi alan (antonuk):
> this particular logic for C consumers (experimental, from github) for
> rabbitmq aborts when pika based consumer, rabbitmq-java based consumer are
> able to drain the queue.
> from your github repo:
>  https://github.com/alanxz/rabbitmq-c
>
> it fails at this point:
>  if (frame.frame_type != AMQP_FRAME_HEADER) {
>       fprintf(stderr, "Expected header!");
>       abort();
>     }
>
> i'm not sure why?
>
>
> #include <stdio.h>
> #include <string.h>
>
> #include <stdint.h>
> #include <amqp.h>
> #include <amqp_framing.h>
>
> #include <assert.h>
>
> #include "utils.h"
>
> #define SUMMARY_EVERY_US 1000000
>
> static void run(amqp_connection_state_t conn)
> {
>   uint64_t start_time = now_microseconds();
>   int received = 0;
>   int previous_received = 0;
>   uint64_t previous_report_time = start_time;
>   uint64_t next_summary_time = start_time + SUMMARY_EVERY_US;
>
>   amqp_frame_t frame;
>   int result;
>   size_t body_received;
>   size_t body_target;
>
>   uint64_t now;
>
>   while (1) {
>     now = now_microseconds();
>     if (now > next_summary_time) {
>       int countOverInterval = received - previous_received;
>       double intervalRate = countOverInterval / ((now -
> previous_report_time) / 1000000.0);
>       printf("%d ms: Received %d - %d since last report (%d Hz)\n",
>          (int)(now - start_time) / 1000, received, countOverInterval, (int)
> intervalRate);
>
>       previous_received = received;
>       previous_report_time = now;
>       next_summary_time += SUMMARY_EVERY_US;
>     }
>
>     amqp_maybe_release_buffers(conn);
>     result = amqp_simple_wait_frame(conn, &frame);
>     if (result < 0)
>       return;
>
>     if (frame.frame_type != AMQP_FRAME_METHOD)
>       continue;
>
>     if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
>       continue;
>
>     result = amqp_simple_wait_frame(conn, &frame);
>     if (result < 0)
>       return;
>
>     if (frame.frame_type != AMQP_FRAME_HEADER) {
>       fprintf(stderr, "Expected header!");
>       abort();
>     }
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/c-amqp-consumer-frame-header-issue-tp27685.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130628/ec011e39/attachment.htm>

From alan.antonuk at gmail.com  Sat Jun 29 08:09:22 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 29 Jun 2013 00:09:22 -0700
Subject: [rabbitmq-discuss] rabbitmq-c should I start a thread for
 amqp_simple_wait_frame() to get mesage?
In-Reply-To: <1372388338889-27666.post@n5.nabble.com>
References: <1372388338889-27666.post@n5.nabble.com>
Message-ID: <CAAt2po+r76=haqsCsfy1NFR1PLA2gLqZ9qteormgB2hno=g=hA@mail.gmail.com>

Could you describe at a high level what you're trying to do such that you
think you need to use a rabbitmq-c connection from multiple threads?

An example high-level use case might be to declare a queue, then start
consuming messages from that queue using a consumer.

A high level description can help us better understand what your needs are
and give you some suggestions on how to use rabbitmq-c.

-Alan


On Thu, Jun 27, 2013 at 7:58 PM, 3k4b251 <314992959 at qq.com> wrote:

> amqp_simple_wait_frame()  is  a  bloking  function. I  think  I should
>  start
> a  thread for  it.  But  if  I follow this,  I  need  to share  connection
> between   threads, alanxz  told  me  that's  not  safe,I   also  found   it
> made   other  functions  block. what should I do  for this?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-should-I-start-a-thread-for-amqp-simple-wait-frame-to-get-mesage-tp27666.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130629/427194c4/attachment.htm>

From ankit.ag2010 at gmail.com  Sat Jun 29 18:44:51 2013
From: ankit.ag2010 at gmail.com (Ankit Agarwal)
Date: Sat, 29 Jun 2013 10:44:51 -0700 (PDT)
Subject: [rabbitmq-discuss] not able to fix the frame size as 0
Message-ID: <96a37ce7-a87c-479c-ab72-f1df4cc9d755@googlegroups.com>

I created a rabbitmq.config file in /etc/rabbitmq/ to set the frame_max size

[
    {rabbit, [{frame_max ,0 }]}
  ].

But its not reading from the file.


Please help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130629/d94faad8/attachment.htm>

From matthias at rabbitmq.com  Sat Jun 29 19:17:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 29 Jun 2013 19:17:57 +0100
Subject: [rabbitmq-discuss] not able to fix the frame size as 0
In-Reply-To: <96a37ce7-a87c-479c-ab72-f1df4cc9d755@googlegroups.com>
References: <96a37ce7-a87c-479c-ab72-f1df4cc9d755@googlegroups.com>
Message-ID: <51CF24D5.7060605@rabbitmq.com>

On 29/06/13 18:44, Ankit Agarwal wrote:
> I created a rabbitmq.config file in /etc/rabbitmq/ to set the frame_max size
>
> [
>      {rabbit, [{frame_max ,0 }]}
>    ].
>
> But its not reading from the file.

See Tim's reply to that same question yesterday: 
http://rabbitmq.1065348.n5.nabble.com/AMQP-connections-closing-very-frequently-tp27552p27671.html

Matthias.

From ankit.ag2010 at gmail.com  Sat Jun 29 20:01:59 2013
From: ankit.ag2010 at gmail.com (ankitag2010)
Date: Sat, 29 Jun 2013 12:01:59 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <249AB275-3EF3-450F-B016-7D30BDB9D9ED@rabbitmq.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
	<51C80B50.2090104@rabbitmq.com>
	<CALyoCeMg0su9hzSaERZrazxMpmOJ7KyBF=V=VA4gubUytUBYHA@mail.gmail.com>
	<249AB275-3EF3-450F-B016-7D30BDB9D9ED@rabbitmq.com>
Message-ID: <1372532519918-27690.post@n5.nabble.com>

Hi 

Sorry for the incomplete info.

I am getting the above error of exceeding the max_frame_size.So the
connections are disconnected.

As i was suggested that after version 3.0.0 a limit to frame_max was set to
128kb.I tried to change the frame_max to 0 using the following configuration
in rabbitmq.config file :

[
     {rabbit, [{frame_max ,0 }]}
   ].


and restarted the server using:-

sudo /sbin/services rabbitmq-server stop
sudo /sbin/services rabbitmq-server start
 

As mentioned here http://www.rabbitmq.com/configure.html :-

*Verify Configuration*

The active configuration can be verified in the broker log, e.g. the active
configuration file:

config file(s) : /etc/rabbitmq/rabbitmq.config

There was no such entry in my broker logs,but the server started
successfully.

To test that even the file is being read,i removed the full-stop "." from
the file.The server didn't start complaining about the missing full-stop.

Another way of checking the frame_max size :-

> rabbitmqctl list_connections  frame_max
131072

But here also its showing as 131072.
Rabbitmq version-3.1.1
OS-CentOS release 6.2 (Final)

Please let me know if you need anything else.






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/AMQP-connections-closing-very-frequently-tp27552p27690.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Sat Jun 29 21:16:50 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 29 Jun 2013 21:16:50 +0100
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <1372532519918-27690.post@n5.nabble.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
	<51C80B50.2090104@rabbitmq.com>
	<CALyoCeMg0su9hzSaERZrazxMpmOJ7KyBF=V=VA4gubUytUBYHA@mail.gmail.com>
	<249AB275-3EF3-450F-B016-7D30BDB9D9ED@rabbitmq.com>
	<1372532519918-27690.post@n5.nabble.com>
Message-ID: <51CF40B2.8010403@rabbitmq.com>

On 29/06/13 20:01, ankitag2010 wrote:
> As mentioned here http://www.rabbitmq.com/configure.html :-
>
> *Verify Configuration*
>
> The active configuration can be verified in the broker log, e.g. the active
> configuration file:
>
> config file(s) : /etc/rabbitmq/rabbitmq.config
>
> There was no such entry in my broker logs,but the server started
> successfully.

Did you instead see an entry stating

config file(s) : (none)

?

> Please let me know if you need anything else.

To track down the problem, locate the 'rabbitmq-server' script in your 
rabbit installation. It should be in the 'scripts' sub-directory of 
wherever rabbit gets installed, and look like 
https://github.com/rabbitmq/rabbitmq-server/blob/master/scripts/rabbitmq-server. 
Edit the RABBITMQ_CONFIG_ARG line (at 
https://github.com/rabbitmq/rabbitmq-server/blob/master/scripts/rabbitmq-server#L96) 
to hardcode the value to

RABBITMQ_CONFIG_ARG="-config /etc/rabbitmq/rabbitmq"

and restart the broker. This *should* either pick up your config file or 
complain in the startup log.


Regards,

Matthias.

From monish.unni at gmail.com  Sun Jun 30 02:04:55 2013
From: monish.unni at gmail.com (cogitate)
Date: Sat, 29 Jun 2013 18:04:55 -0700 (PDT)
Subject: [rabbitmq-discuss] c amqp consumer frame header issue
In-Reply-To: <CAAt2poKQN_-zRE1YpSM7MhFTuvTpEUNCh8GF9jUHtQU=-9=wfg@mail.gmail.com>
References: <1372475754640-27685.post@n5.nabble.com>
	<CAAt2poKQN_-zRE1YpSM7MhFTuvTpEUNCh8GF9jUHtQU=-9=wfg@mail.gmail.com>
Message-ID: <1372554295198-27692.post@n5.nabble.com>

hi alan:
right now, i am not running the program with those conditions =>
[1] when no routing_key is found and the message is sent to bounded AE and a
consumer of AE tries to get the message.
[2] when due message-ttl the message ends up at DLX consumer.

however, just for your reference, it seems this is what pika is doing (see
below), and it just seems that it doesn't expect the frames to be in any
certain order like the C consumer (if , else if , else if...)

i'll however, try and reproduce the conditions in the meanwhile.


def decode_frame(data_in):
    """
    Receives raw socket data and attempts to turn it into a frame.
    Returns bytes used to make the frame and the frame
    """
    # Look to see if it's a protocol header frame
    try:
        if data_in[0:4] == 'AMQP':
            major, minor, revision = struct.unpack_from('BBB', data_in, 5)
            return 8, ProtocolHeader(major, minor, revision)
    except IndexError:
        # We didn't get a full frame
        return 0, None
    except struct.error:
        # We didn't get a full frame
        return 0, None

    # Get the Frame Type, Channel Number and Frame Size
    try:
        frame_type, channel_number, frame_size = \
            struct.unpack('>BHL', data_in[0:7])
    except struct.error:
        # We didn't get a full frame
        return 0, None

    # Get the frame data
    frame_end = spec.FRAME_HEADER_SIZE +\
                frame_size +\
                spec.FRAME_END_SIZE

    # We don't have all of the frame yet
    if frame_end > len(data_in):
        return 0, None

    # The Frame termination chr is wrong
    if data_in[frame_end - 1] != chr(spec.FRAME_END):
        raise exceptions.InvalidFrameError("Invalid FRAME_END marker")

    # Get the raw frame data
    frame_data = data_in[spec.FRAME_HEADER_SIZE:frame_end - 1]

    if frame_type == spec.FRAME_METHOD:

        # Get the Method ID from the frame data
        method_id = struct.unpack_from('>I', frame_data)[0]

        # Get a Method object for this method_id
        method = spec.methods[method_id]()

        # Decode the content
        method.decode(frame_data, 4)

        # Return the amount of data consumed and the Method object
        return frame_end, Method(channel_number, method)

    elif frame_type == spec.FRAME_HEADER:

        # Return the header class and body size
        class_id, weight, body_size = struct.unpack_from('>HHQ', frame_data)

        # Get the Properties type
        properties = spec.props[class_id]()

        # Decode the properties
        out = properties.decode(frame_data[12:])

        # Return a Header frame
        return frame_end, Header(channel_number, body_size, properties)

    elif frame_type == spec.FRAME_BODY:

        # Return the amount of data consumed and the Body frame w/ data
        return frame_end, Body(channel_number, frame_data)

    elif frame_type == spec.FRAME_HEARTBEAT:

        # Return the amount of data and a Heartbeat frame
        return frame_end, Heartbeat()

    raise exceptions.InvalidFrameError("Unknown frame type: %i" %
frame_type)




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/c-amqp-consumer-frame-header-issue-tp27685p27692.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ankit.ag2010 at gmail.com  Sun Jun 30 05:07:47 2013
From: ankit.ag2010 at gmail.com (ankitag2010)
Date: Sat, 29 Jun 2013 21:07:47 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <1372532519918-27690.post@n5.nabble.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
	<51C80B50.2090104@rabbitmq.com>
	<CALyoCeMg0su9hzSaERZrazxMpmOJ7KyBF=V=VA4gubUytUBYHA@mail.gmail.com>
	<249AB275-3EF3-450F-B016-7D30BDB9D9ED@rabbitmq.com>
	<1372532519918-27690.post@n5.nabble.com>
Message-ID: <1372565267881-27693.post@n5.nabble.com>

No entry stating 

" config file(s) : (none) "

in the broker logs.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/AMQP-connections-closing-very-frequently-tp27552p27693.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ankit.ag2010 at gmail.com  Sun Jun 30 06:11:13 2013
From: ankit.ag2010 at gmail.com (ankitag2010)
Date: Sat, 29 Jun 2013 22:11:13 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <1372565267881-27693.post@n5.nabble.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
	<51C80B50.2090104@rabbitmq.com>
	<CALyoCeMg0su9hzSaERZrazxMpmOJ7KyBF=V=VA4gubUytUBYHA@mail.gmail.com>
	<249AB275-3EF3-450F-B016-7D30BDB9D9ED@rabbitmq.com>
	<1372532519918-27690.post@n5.nabble.com>
	<1372565267881-27693.post@n5.nabble.com>
Message-ID: <1372569073924-27694.post@n5.nabble.com>

Couldn't find the file at the path you had mentioned.

But found the similar file @
/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/rabbitmq-server

But couldn't resolve the issue by hard coding the RABBITMQ_CONFIG_ARG.

Another look at the erlang process:-


rabbitmq 21883 21880  0 09:34 ?        00:00:04
/usr/lib64/erlang/erts-5.8.5/bin/beam.smp -W w -K true -A30 -P 1048576 --
-root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/../ebin -noshell -noinput
-s rabbit boot -sname rabbit at test04 -boot start_sasl *-config
/etc/rabbitmq/rabbitmq* -kernel inet_default_connect_options
[{nodelay,true}] -sasl errlog_type error -sasl sasl_error_logger false
-rabbit error_logger {file,"/var/log/rabbitmq/rabbit at test.log"} -rabbit
sasl_error_logger {file,"/var/log/rabbitmq/rabbit at test04-sasl.log"} -rabbit
enabled_plugins_file "/etc/rabbitmq/enabled_plugins" -rabbit plugins_dir
"/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/../plugins" -rabbit
plugins_expand_dir "/var/lib/rabbitmq/mnesia/rabbit at test-plugins-expand"
-os_mon start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup
false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at test"




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/AMQP-connections-closing-very-frequently-tp27552p27694.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Sun Jun 30 08:14:05 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sun, 30 Jun 2013 00:14:05 -0700
Subject: [rabbitmq-discuss] c amqp consumer frame header issue
In-Reply-To: <1372554295198-27692.post@n5.nabble.com>
References: <1372475754640-27685.post@n5.nabble.com>
	<CAAt2poKQN_-zRE1YpSM7MhFTuvTpEUNCh8GF9jUHtQU=-9=wfg@mail.gmail.com>
	<1372554295198-27692.post@n5.nabble.com>
Message-ID: <CAAt2poL6Zt8jau2w_FFOXcPe1WxYTQ_3n+F8zynrJhQT2bh0Wg@mail.gmail.com>

When a message is delivered over AMQP to a client with a consumer the
client will receive the following frames this order:

- a method frame containing the basic.deliver method
- a header frame containing the properties structure
- one or more body frames containing the message data

Note that this happens in the context of a single channel. AMQP multiplexes
multiple channels over a single connection. My understanding of AMQP is
that as a client, once you receive a basic.deliver method on a channel, the
next 2 or more frames will be a header frame and one or more body frames,
with no other frames in between unless there's some kind of channel
exception, in which case you'll receive a channel.close and the message is
aborted being received.

Why does this matter? Because amqp_simple_wait_frame() returns the next
frame *for the connection*. Thus if you have more than one consumer running
on different channels, the logic for reading messages from the broker
becomes a little more involved in that you need to separate out frames
based on their channel, then construct the messages from there.
(Unfortunately the rabbitmq-c examples don't cover this scenario)

This is why I asked for a bit more context as to what your program was
doing outside of the code you provided. (I'm still don't have all the
details necessary to understand what you're doing e.g., describe what
amqp_* commands you're issuing before you get to the message reader loop).

-Alan


On Sat, Jun 29, 2013 at 6:04 PM, cogitate <monish.unni at gmail.com> wrote:

> hi alan:
> right now, i am not running the program with those conditions =>
> [1] when no routing_key is found and the message is sent to bounded AE and
> a
> consumer of AE tries to get the message.
> [2] when due message-ttl the message ends up at DLX consumer.
>
> however, just for your reference, it seems this is what pika is doing (see
> below), and it just seems that it doesn't expect the frames to be in any
> certain order like the C consumer (if , else if , else if...)
>
> i'll however, try and reproduce the conditions in the meanwhile.
>
>
> def decode_frame(data_in):
>     """
>     Receives raw socket data and attempts to turn it into a frame.
>     Returns bytes used to make the frame and the frame
>     """
>     # Look to see if it's a protocol header frame
>     try:
>         if data_in[0:4] == 'AMQP':
>             major, minor, revision = struct.unpack_from('BBB', data_in, 5)
>             return 8, ProtocolHeader(major, minor, revision)
>     except IndexError:
>         # We didn't get a full frame
>         return 0, None
>     except struct.error:
>         # We didn't get a full frame
>         return 0, None
>
>     # Get the Frame Type, Channel Number and Frame Size
>     try:
>         frame_type, channel_number, frame_size = \
>             struct.unpack('>BHL', data_in[0:7])
>     except struct.error:
>         # We didn't get a full frame
>         return 0, None
>
>     # Get the frame data
>     frame_end = spec.FRAME_HEADER_SIZE +\
>                 frame_size +\
>                 spec.FRAME_END_SIZE
>
>     # We don't have all of the frame yet
>     if frame_end > len(data_in):
>         return 0, None
>
>     # The Frame termination chr is wrong
>     if data_in[frame_end - 1] != chr(spec.FRAME_END):
>         raise exceptions.InvalidFrameError("Invalid FRAME_END marker")
>
>     # Get the raw frame data
>     frame_data = data_in[spec.FRAME_HEADER_SIZE:frame_end - 1]
>
>     if frame_type == spec.FRAME_METHOD:
>
>         # Get the Method ID from the frame data
>         method_id = struct.unpack_from('>I', frame_data)[0]
>
>         # Get a Method object for this method_id
>         method = spec.methods[method_id]()
>
>         # Decode the content
>         method.decode(frame_data, 4)
>
>         # Return the amount of data consumed and the Method object
>         return frame_end, Method(channel_number, method)
>
>     elif frame_type == spec.FRAME_HEADER:
>
>         # Return the header class and body size
>         class_id, weight, body_size = struct.unpack_from('>HHQ',
> frame_data)
>
>         # Get the Properties type
>         properties = spec.props[class_id]()
>
>         # Decode the properties
>         out = properties.decode(frame_data[12:])
>
>         # Return a Header frame
>         return frame_end, Header(channel_number, body_size, properties)
>
>     elif frame_type == spec.FRAME_BODY:
>
>         # Return the amount of data consumed and the Body frame w/ data
>         return frame_end, Body(channel_number, frame_data)
>
>     elif frame_type == spec.FRAME_HEARTBEAT:
>
>         # Return the amount of data and a Heartbeat frame
>         return frame_end, Heartbeat()
>
>     raise exceptions.InvalidFrameError("Unknown frame type: %i" %
> frame_type)
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/c-amqp-consumer-frame-header-issue-tp27685p27692.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130630/bb388481/attachment.htm>

From matthias at rabbitmq.com  Sun Jun 30 08:21:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 30 Jun 2013 08:21:34 +0100
Subject: [rabbitmq-discuss] c amqp consumer frame header issue
In-Reply-To: <CAAt2poL6Zt8jau2w_FFOXcPe1WxYTQ_3n+F8zynrJhQT2bh0Wg@mail.gmail.com>
References: <1372475754640-27685.post@n5.nabble.com>
	<CAAt2poKQN_-zRE1YpSM7MhFTuvTpEUNCh8GF9jUHtQU=-9=wfg@mail.gmail.com>
	<1372554295198-27692.post@n5.nabble.com>
	<CAAt2poL6Zt8jau2w_FFOXcPe1WxYTQ_3n+F8zynrJhQT2bh0Wg@mail.gmail.com>
Message-ID: <51CFDC7E.7020200@rabbitmq.com>

On 30/06/13 08:14, Alan Antonuk wrote:
> My understanding of AMQP is that as a client, once you receive a
> basic.deliver method on a channel, the next 2 or more frames will be
> a header frame and one or more body frames, with no other frames in
> between unless there's some kind of channel exception, in which case
> you'll receive a channel.close and the message is aborted being
> received.

You understanding is correct.


Matthias.

From matthias at rabbitmq.com  Sun Jun 30 08:32:35 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 30 Jun 2013 08:32:35 +0100
Subject: [rabbitmq-discuss] AMQP connections closing very frequently
In-Reply-To: <1372569073924-27694.post@n5.nabble.com>
References: <8c0d3987-774e-4a4a-8054-b6b7c8a67e47@googlegroups.com>
	<51C80B50.2090104@rabbitmq.com>
	<CALyoCeMg0su9hzSaERZrazxMpmOJ7KyBF=V=VA4gubUytUBYHA@mail.gmail.com>
	<249AB275-3EF3-450F-B016-7D30BDB9D9ED@rabbitmq.com>
	<1372532519918-27690.post@n5.nabble.com>
	<1372565267881-27693.post@n5.nabble.com>
	<1372569073924-27694.post@n5.nabble.com>
Message-ID: <51CFDF13.1070800@rabbitmq.com>

On 30/06/13 06:11, ankitag2010 wrote:
> But couldn't resolve the issue by hard coding the RABBITMQ_CONFIG_ARG.
>
> Another look at the erlang process:-
>
>
> rabbitmq 21883 21880  0 09:34 ?        00:00:04
> /usr/lib64/erlang/erts-5.8.5/bin/beam.smp -W w -K true -A30 -P 1048576 --
> -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa
> /usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/../ebin -noshell -noinput
> -s rabbit boot -sname rabbit at test04 -boot start_sasl *-config
> /etc/rabbitmq/rabbitmq* -kernel inet_default_connect_options
> [{nodelay,true}] -sasl errlog_type error -sasl sasl_error_logger false
> -rabbit error_logger {file,"/var/log/rabbitmq/rabbit at test.log"} -rabbit
> sasl_error_logger {file,"/var/log/rabbitmq/rabbit at test04-sasl.log"} -rabbit
> enabled_plugins_file "/etc/rabbitmq/enabled_plugins" -rabbit plugins_dir
> "/usr/lib/rabbitmq/lib/rabbitmq_server-3.1.1/sbin/../plugins" -rabbit
> plugins_expand_dir "/var/lib/rabbitmq/mnesia/rabbit at test-plugins-expand"
> -os_mon start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup
> false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at test"

Those '*' are just highlights you inserted when posting, rather than 
what's actually on the command line, right?

If so, that all looks ok.

The only oddness I can see is that the error log and sasl log file names 
refer to different node names - rabbit at test vs rabbit at test04. How does 
that difference arise? And are you sure that you are looking at the 
correct log file when checking that the config file has been read?

And what happens if you hard code the RABBITMQ_CONFIG_ARG to something 
invalid, e.g. "-config /etc/rabbitmq/invalid"?


Matthias.

From matthias at rabbitmq.com  Sun Jun 30 11:59:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 30 Jun 2013 11:59:34 +0100
Subject: [rabbitmq-discuss] [Java-client] How to catch the error or
 exception while call basic operation?
In-Reply-To: <kqhtr1$4th$2@ger.gmane.org>
References: <kqhtr1$4th$2@ger.gmane.org>
Message-ID: <51D00F96.6010506@rabbitmq.com>

On 27/06/13 18:46, pprun wrote:
> I have code call channel.basicPublish(exchangeName, routingKey, props,
> message.getBytes());,  without firstly declare the exchange.
>
> Although the method return normally, but server log the error, as below:
>
> =ERROR REPORT==== 28-Jun-2013::01:35:50 ===
> connection <0.853.0>, channel 1 - soft error:
> {amqp_error,not_found,
>              "no exchange
> 'com.abc.mq.ex.d2ac3c5c-1caf-4c73-bbdf-2024a0e5c092' in vhost '/'",
>              'basic.publish'}
>
>
> My question is how to catch the error/exception, so clients know there's
> failure?

See 
http://rabbitmq.1065348.n5.nabble.com/Cathing-broker-shut-down-in-a-consumer-tp24159p24210.html


Matthias.

