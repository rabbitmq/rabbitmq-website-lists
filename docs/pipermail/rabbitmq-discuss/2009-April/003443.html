<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consuming a Rollbacked Message
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Consuming%20a%20Rollbacked%20Message&In-Reply-To=49F44E85.1050704%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003442.html">
   <LINK REL="Next"  HREF="003447.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consuming a Rollbacked Message</H1>
    <B>Amin Abbaspour</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Consuming%20a%20Rollbacked%20Message&In-Reply-To=49F44E85.1050704%40lshift.net"
       TITLE="[rabbitmq-discuss] Consuming a Rollbacked Message">abbaspour_amin at yahoo.com
       </A><BR>
    <I>Sun Apr 26 13:30:48 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003442.html">[rabbitmq-discuss] Consuming a Rollbacked Message
</A></li>
        <LI>Next message: <A HREF="003447.html">[rabbitmq-discuss] Consuming a Rollbacked Message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3443">[ date ]</a>
              <a href="thread.html#3443">[ thread ]</a>
              <a href="subject.html#3443">[ subject ]</a>
              <a href="author.html#3443">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Dear Tony,

I noticed your point. I wish this information what somewhere on site, since there is very little reflected about transactions in rabbitmq documents. 

For example I did not know before your mail that transactions are for acks and publish and not for deliver. This looks really odd for most of us whom have used to transactional consumers.

Then what is your proposed solution for this case? I don't like the reconnect model and is basic.recover the last alternative? How should I call it? periodically? I see basic.recover in docs but dono how to use it. 

Kind Regards and thanks for your help,
Amin Abbaspour

--- On Sun, 4/26/09, Tony Garnock-Jones &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>&gt; wrote:

&gt;<i> From: Tony Garnock-Jones &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>&gt;
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Consuming a Rollbacked Message
</I>&gt;<i> To: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">abbaspour_amin at yahoo.com</A>
</I>&gt;<i> Cc: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Date: Sunday, April 26, 2009, 2:07 PM
</I>&gt;<i> Hi Amin,
</I>&gt;<i> 
</I>&gt;<i> Amin Abbaspour wrote:
</I>&gt;<i> &gt; What I can? Is there something wrong with my rollback
</I>&gt;<i> or ACK
</I>&gt;<i> &gt; mechanism? should I do something more than a simple
</I>&gt;<i> txRollback()?
</I>&gt;<i> 
</I>&gt;<i> TX-class transactions introduce grouping and limited
</I>&gt;<i> atomicity for *publishes* and *acknowledgements*. This means
</I>&gt;<i> that the scope of a transaction is only those basic.publish
</I>&gt;<i> and basic.ack operations that the client has performed
</I>&gt;<i> within the transaction. In particular, basic.delivers are
</I>&gt;<i> not included in a transaction -- so it would be wrong for
</I>&gt;<i> the server to resend them on a rollback!
</I>&gt;<i> 
</I>&gt;<i> A rollback, then, does not release any messages to other
</I>&gt;<i> consumers, or cause them to be redelivered to this one; it
</I>&gt;<i> is assumed by the server that since the client has seen the
</I>&gt;<i> messages, and has clearly not crashed (since the connection
</I>&gt;<i> is still open and healthy), there is no need to resend them.
</I>&gt;<i> The server can trust the client in this case to continue
</I>&gt;<i> thinking about which messages to acknowledge, and will wait
</I>&gt;<i> for subsequent basic.acks followed by tx.commit.
</I>&gt;<i> 
</I>&gt;<i> If the client has forgotten what it has seen, it can use
</I>&gt;<i> the basic.recover operation to get its pending deliveries
</I>&gt;<i> resent. Alternatively, it can close and reopen the channel
</I>&gt;<i> (though this has other consequences).
</I>&gt;<i> 
</I>&gt;<i> This is a confusing area of the spec: not only did we
</I>&gt;<i> initially get our implementation wrong, other
</I>&gt;<i> implementations did too, and in fact the 0-8 spec does not
</I>&gt;<i> fully specify the behaviour of rollbacks or basic.recover
</I>&gt;<i> operations. Furthermore, there is a legitimate, if subtle,
</I>&gt;<i> design question here: seen one way, the current behaviour --
</I>&gt;<i> transactional acks -- is correct; seen another, the
</I>&gt;<i> alternative -- transactional deliveries -- is correct. (If
</I>&gt;<i> you're interested, the former seems natural in a
</I>&gt;<i> hub-and-spoke design for AMQP, but the latter starts to look
</I>&gt;<i> oddly sensible in a fully peer-to-peer, internet-scale
</I>&gt;<i> design...)
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i>   Tony
</I>

      


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003442.html">[rabbitmq-discuss] Consuming a Rollbacked Message
</A></li>
	<LI>Next message: <A HREF="003447.html">[rabbitmq-discuss] Consuming a Rollbacked Message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3443">[ date ]</a>
              <a href="thread.html#3443">[ thread ]</a>
              <a href="subject.html#3443">[ subject ]</a>
              <a href="author.html#3443">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
