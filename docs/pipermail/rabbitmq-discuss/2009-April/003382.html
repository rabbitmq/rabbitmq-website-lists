<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] basic design question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20basic%20design%20question&In-Reply-To=49EE5905.3000308%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003381.html">
   <LINK REL="Next"  HREF="003383.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] basic design question</H1>
    <B>Isaac Cambron</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20basic%20design%20question&In-Reply-To=49EE5905.3000308%40lshift.net"
       TITLE="[rabbitmq-discuss] basic design question">icambron at gmail.com
       </A><BR>
    <I>Wed Apr 22 03:19:37 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003381.html">[rabbitmq-discuss] basic design question
</A></li>
        <LI>Next message: <A HREF="003383.html">[rabbitmq-discuss] basic design question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3382">[ date ]</a>
              <a href="thread.html#3382">[ thread ]</a>
              <a href="subject.html#3382">[ subject ]</a>
              <a href="author.html#3382">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,

Thanks, that's very helpful. A couple of follow-up questions:

1. What snapshot should I use? I tried out the default revision (not sure
what that tracks) and it didn't queue like I expected; the first consumer to
subscribe got all the tasks, even if more subscribers were added before the
acks. I can't get the tip to run at all (crashes on startup). Presumably I
need something in between?

2. It's not clear to me what all of the other available qos parameters mean.
It appears (and again, wasn't able to try this on the tip revision) that
only BasicQos(0, n, false) is supported. This sounds like it's what I want
anyway (with, obv, n=1); is that right?

If what I have was expected to work, I can provide source code, or the crash
dump if that's unexpected too.

Thanks,
Isaac

On Tue, Apr 21, 2009 at 7:38 PM, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt;wrote:

&gt;<i> Isaac,
</I>&gt;<i>
</I>&gt;<i> Isaac Cambron wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I have a client that will publish a bunch of tasks to execute - tasks A,
</I>&gt;&gt;<i> B, C, D, E. I have a pool of machines that, individually, know how to do
</I>&gt;&gt;<i> some subset of the tasks. For example, let's say that machine 1 can do A, B,
</I>&gt;&gt;<i> and C, and machine 2 can do C, D, and E. A machine can only do one task at a
</I>&gt;&gt;<i> time, and I only want one machine to do any particular task. Tasks can wait
</I>&gt;&gt;<i> indefinitely until there's a free machine capable of executing it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm not sure what pieces go where. Do I create one queue per task? (If so,
</I>&gt;&gt;<i> how will I make the machines only respond to one message from any queue at a
</I>&gt;&gt;<i> time?)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That, in combination with a basic.qos prefetch count of 1, should work.
</I>&gt;<i>
</I>&gt;<i> More specifically ...
</I>&gt;<i>
</I>&gt;<i> - create a direct exchange to which tasks get published, using the task
</I>&gt;<i> type as the routing key
</I>&gt;<i>
</I>&gt;<i> - create one queue per task type and bind it to the direct exchange with
</I>&gt;<i> the tasks type as the binding key
</I>&gt;<i>
</I>&gt;<i> - let each worker machine open a channel, set the basic.qos prefetch count
</I>&gt;<i> to 1, and then subscribe to (basic.consume) each of the queues corresponding
</I>&gt;<i> to task types supported by that worker.
</I>&gt;<i>
</I>&gt;<i> - when a worker is done with a task it basic.ack's the message
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The prefetch count limits the number of tasks a worker will be sent before
</I>&gt;<i> ack'ing them. Note that the basic.qos functionality required to do that has
</I>&gt;<i> not made it into an official release yet; you'll have to use  a recent
</I>&gt;<i> snapshot of the RabbitMQ source. Your example is actually a pretty
</I>&gt;<i> interesting use case for basic.qos, exploiting some of the more advanced
</I>&gt;<i> aspects of that feature, so I'd love to hear how it works out for you.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090421/d25ecf76/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090421/d25ecf76/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003381.html">[rabbitmq-discuss] basic design question
</A></li>
	<LI>Next message: <A HREF="003383.html">[rabbitmq-discuss] basic design question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3382">[ date ]</a>
              <a href="thread.html#3382">[ thread ]</a>
              <a href="subject.html#3382">[ subject ]</a>
              <a href="author.html#3382">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
