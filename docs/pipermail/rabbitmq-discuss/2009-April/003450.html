<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] millions of unack'd messages in a day --	disk store instead of ram?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20millions%20of%20unack%27d%20messages%20in%20a%20day%20--%0A%09disk%20store%20instead%20of%20ram%3F&In-Reply-To=dbd9700a0904270700p28222476vdf1f44e9d9ae7d04%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003449.html">
   <LINK REL="Next"  HREF="003454.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] millions of unack'd messages in a day --	disk store instead of ram?</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20millions%20of%20unack%27d%20messages%20in%20a%20day%20--%0A%09disk%20store%20instead%20of%20ram%3F&In-Reply-To=dbd9700a0904270700p28222476vdf1f44e9d9ae7d04%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] millions of unack'd messages in a day --	disk store instead of ram?">alexis.richardson at gmail.com
       </A><BR>
    <I>Mon Apr 27 15:04:01 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003449.html">[rabbitmq-discuss] millions of unack'd messages in a day -- disk	store instead of ram?
</A></li>
        <LI>Next message: <A HREF="003454.html">[rabbitmq-discuss] millions of unack'd messages in a day --	disk store instead of ram?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3450">[ date ]</a>
              <a href="thread.html#3450">[ thread ]</a>
              <a href="subject.html#3450">[ subject ]</a>
              <a href="author.html#3450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Brian

Your question is timely.  We are working on a feature in which
persistent messages are stored only on disk, instead of concurrently
on disk and in ram.  If you peruse the archives you will see some info
about this (eg timelines).

You may find this blog post relevant:
<A HREF="http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory">http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory</A>

What disk store do you use on Amazon?  Is it S3 or EBS?

alexis



On Mon, Apr 27, 2009 at 3:00 PM, Brian Whitman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">brian at echonest.com</A>&gt; wrote:
&gt;<i> We run rabbitMQ on Amazon EC2 &quot;small&quot; servers (1.7GB ram.) The rabbitMQ
</I>&gt;<i> install is out of the box, simply installing from the debian package. We
</I>&gt;<i> access rabbit through a python AMQP interface (py-amqplib) and wrapper
</I>&gt;<i> client that we set up like
</I>&gt;<i> this:&#160;<A HREF="http://github.com/bwhitman/py-amqplib-wrapper/tree/master">http://github.com/bwhitman/py-amqplib-wrapper/tree/master</A>
</I>&gt;<i> Our use is probably non-normative: we keep millions of messages around most
</I>&gt;<i> of the day. An average message stays in a queue for up to 12 hours, and we
</I>&gt;<i> have a dozen or so queues that each reach about 1 million messages at peak.
</I>&gt;<i> We quickly determined that a single EC2 small node can support up to about
</I>&gt;<i> 1-2m un-ack'd messages before it runs out of ram. And when it runs out of
</I>&gt;<i> ram the rabbit instance stops responding. To get around this we boot more
</I>&gt;<i> rabbit nodes and we&#160;shard via a consistent hash that routes messages based
</I>&gt;<i> on their ID. This gets us more message capacity but gets expensive and has
</I>&gt;<i> more moving parts that can break.
</I>&gt;<i> I am wondering if there is a better way. I would gladly take a message
</I>&gt;<i> consume speed hit to be able to have the rabbit store backed by disk instead
</I>&gt;<i> of keeping it live in ram as it seems to. Is this possible? How do people
</I>&gt;<i> set up simple message queues that can store millions of messages for long
</I>&gt;<i> periods of time?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003449.html">[rabbitmq-discuss] millions of unack'd messages in a day -- disk	store instead of ram?
</A></li>
	<LI>Next message: <A HREF="003454.html">[rabbitmq-discuss] millions of unack'd messages in a day --	disk store instead of ram?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3450">[ date ]</a>
              <a href="thread.html#3450">[ thread ]</a>
              <a href="subject.html#3450">[ subject ]</a>
              <a href="author.html#3450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
