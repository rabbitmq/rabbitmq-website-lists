<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Routing via user id
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Routing%20via%20user%20id&In-Reply-To=%3CCAKgmDnEteSTQjDW%3D1A%2BFcpUmkwsHo97jZ-JXj18EmgR00Bpwag%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037157.html">
   <LINK REL="Next"  HREF="037159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Routing via user id</H1>
    <B>Laing, Michael</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Routing%20via%20user%20id&In-Reply-To=%3CCAKgmDnEteSTQjDW%3D1A%2BFcpUmkwsHo97jZ-JXj18EmgR00Bpwag%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Routing via user id">michael.laing at nytimes.com
       </A><BR>
    <I>Sun Jul 13 23:47:19 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037157.html">[rabbitmq-discuss] Routing via user id
</A></li>
        <LI>Next message: <A HREF="037159.html">[rabbitmq-discuss] Routing via user id
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37158">[ date ]</a>
              <a href="thread.html#37158">[ thread ]</a>
              <a href="subject.html#37158">[ subject ]</a>
              <a href="author.html#37158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You should look at the 'consistent-hash-exchange':
<A HREF="http://www.rabbitmq.com/plugins.html">http://www.rabbitmq.com/plugins.html</A>

By either using the user id as the routing key or by setting a header to
the user id, messages w a particular user id will always get routed to the
same queue.

Hopefully your input is nicely distributed across the user id space. If
not, there is more work required.

ml


On Sun, Jul 13, 2014 at 11:41 AM, Sean Joyce &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">seanmjoyce at gmail.com</A>&gt; wrote:

&gt;<i> I have a scenario where one producer publishes a stream of messages to an
</I>&gt;<i> exchange. The exchange has 10 queues (there is an upper limit to the amount
</I>&gt;<i> of parallel work that can be done - e.g. Database bottleneck) that it
</I>&gt;<i> routes messages to. The messages can really go to any queue with one
</I>&gt;<i> exception: only one message with a given user id can be processed at a
</I>&gt;<i> time.
</I>&gt;<i>
</I>&gt;<i> All messages with that user id should be routed to the same queue. If
</I>&gt;<i> there was no database bottleneck I would create a new queue for each user
</I>&gt;<i> id but I can really only process ten messages at a time.
</I>&gt;<i>
</I>&gt;<i> I had thought of partitioning the user ids across ten queues but there is
</I>&gt;<i> no guarantee the incoming messages would be evenly distributed even with
</I>&gt;<i> different user ids. Thus I could have queues 1,4 and 8 with a backlog while
</I>&gt;<i> the rest are idle resources.
</I>&gt;<i>
</I>&gt;<i> Any tips on a defined pattern that solves this type of problem so that any
</I>&gt;<i> message for a given user id can go to any queue but messages with the same
</I>&gt;<i> user id always go to the same queue?
</I>&gt;<i>
</I>&gt;<i> -Sean
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list has moved to
</I>&gt;<i> <A HREF="https://groups.google.com/forum/#!forum/rabbitmq-users,">https://groups.google.com/forum/#!forum/rabbitmq-users,</A>
</I>&gt;<i> please subscribe to the new list!
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140713/3df07766/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140713/3df07766/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037157.html">[rabbitmq-discuss] Routing via user id
</A></li>
	<LI>Next message: <A HREF="037159.html">[rabbitmq-discuss] Routing via user id
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37158">[ date ]</a>
              <a href="thread.html#37158">[ thread ]</a>
              <a href="subject.html#37158">[ subject ]</a>
              <a href="author.html#37158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
