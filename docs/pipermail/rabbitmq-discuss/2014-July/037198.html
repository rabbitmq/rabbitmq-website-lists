<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] consumer received message from a queue it's not bound to? [c# rabbitmq-client, iis, servicestack]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20consumer%20received%20message%20from%20a%20queue%20it%27s%0A%20not%20bound%20to%3F%20%5Bc%23%20rabbitmq-client%2C%20iis%2C%20servicestack%5D&In-Reply-To=%3Cf991be1e-5982-4208-9cbf-70dd47c91777%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037201.html">
   <LINK REL="Next"  HREF="037203.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] consumer received message from a queue it's not bound to? [c# rabbitmq-client, iis, servicestack]</H1>
    <B>Mariusz Wojcik</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20consumer%20received%20message%20from%20a%20queue%20it%27s%0A%20not%20bound%20to%3F%20%5Bc%23%20rabbitmq-client%2C%20iis%2C%20servicestack%5D&In-Reply-To=%3Cf991be1e-5982-4208-9cbf-70dd47c91777%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] consumer received message from a queue it's not bound to? [c# rabbitmq-client, iis, servicestack]">mariusz.wojcik at hotmail.co.uk
       </A><BR>
    <I>Thu Jul 17 09:29:09 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037201.html">[rabbitmq-discuss] Is ERLANG OTP 17.1 compatible with RabbitMQ 3.3.4
</A></li>
        <LI>Next message: <A HREF="037203.html">[rabbitmq-discuss] channel-cache-size
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37198">[ date ]</a>
              <a href="thread.html#37198">[ thread ]</a>
              <a href="subject.html#37198">[ subject ]</a>
              <a href="author.html#37198">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Steve,

    This probably happens because both queues are bound to the exchange to 
receive a message. The reason for that may be an exchange type (fan-out for 
example will send message to any bound queue) or routing-key. Looking at 
your example, the routing-key used to bind queues is empty. Hence each 
message post with empty routing key will be delivered to both queues. You 
can run simple test to verify that. Just make sure all your queues are set 
up and then publish a message but do not run any consumers. Login to 
management portal to check to which queue the message has been routed to.

You can find more information about routing-key at 
[<A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.bind.routing-key">http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.bind.routing-key</A>](<A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.bind.routing-key">http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.bind.routing-key</A>)

Cheers,

Mariusz


On Wednesday, 16 July 2014 21:45:04 UTC+1, Steve Schoon wrote:
&gt;<i>
</I>&gt;<i> Here is my strange problem that I can't figure out how to fix:
</I>&gt;<i>
</I>&gt;<i>    - consumer 1 write message 'a' to 'work-queue'
</I>&gt;<i>    - worker starts processing job 'a' (this takes a few minutes)
</I>&gt;<i>    - consumer 1 subscribes to 'queue-a' and try to consume 1 msg
</I>&gt;<i>    - consumer 2 subscribes to 'queue-b' and tries to consume 1 msg
</I>&gt;<i>    - worker completes processing job 'a'
</I>&gt;<i>    - worker writes 'a-is-done' message to 'queue-a'
</I>&gt;<i>    - ** CONSUMER 2 RECEIVES THE 'a-is-done' WRITTEN TO 'queue-a' EVEN 
</I>&gt;<i>    THOUGH IT'S CONSUMING FROM 'queue-b'
</I>&gt;<i>    - consumer 1 receives the expected message from 'queue-a'
</I>&gt;<i>    - worker starts processing job 'b'
</I>&gt;<i>    - worker completes processing job 'b'
</I>&gt;<i>    - worker writes 'b-is-done' message to 'queue-'b
</I>&gt;<i>    
</I>&gt;<i> 'worker' is a console application that does the following in a forever 
</I>&gt;<i> loop:
</I>&gt;<i>
</I>&gt;<i>    - reads 1 message from 'work-queue', 
</I>&gt;<i>    - does some processing
</I>&gt;<i>    - write 1 message to 'queue-X' where 'X' is part of the message it 
</I>&gt;<i>    read from 'work-queue'
</I>&gt;<i>    
</I>&gt;<i>
</I>&gt;<i> 'consumer1' and 'consumer2' are requests being handled by a a 
</I>&gt;<i> ServiceStack-based webservice running under IIS 7.5.  The code looks like 
</I>&gt;<i> this:
</I>&gt;<i>
</I>&gt;<i> string queueName = request.QueueName;
</I>&gt;<i> BasicDeliverEventArgs result = null;
</I>&gt;<i> var connectionFactory = new ConnectionFactory();
</I>&gt;<i> connectionFactory.Endpoint = new AmqpTcpEndpoint(&quot;myhostname&quot;);
</I>&gt;<i> connectionFactory.UserName = &quot;user&quot;;
</I>&gt;<i> connectionFactory.Password = &quot;pass&quot;;
</I>&gt;<i> using (IConnection connection = connectionFactory.CreateConnection())
</I>&gt;<i> {
</I>&gt;<i> using (IModel channel = connection.CreateModel())
</I>&gt;<i> {
</I>&gt;<i> channel.ExchangeDeclare(&quot;myexchange&quot;, ExchangeType.Direct, true);
</I>&gt;<i> channel.QueueDeclare(queueName, false, false, true, null);
</I>&gt;<i> channel.QueueBind(queueName, &quot;myexchange&quot;, &quot;&quot;);
</I>&gt;<i> using (Subscription sub = new Subscription(channel, &quot;queue-a&quot;, false))
</I>&gt;<i> {
</I>&gt;<i> bool rc = sub.Next(60 * 5 * 1000, out result);
</I>&gt;<i> if (rc == false &amp;&amp; result == null)
</I>&gt;<i> {
</I>&gt;<i>  throw new Exception(&quot;whatever&quot;);
</I>&gt;<i> }
</I>&gt;<i> sub.Ack(result);
</I>&gt;<i> }
</I>&gt;<i> }
</I>&gt;<i> }
</I>&gt;<i> string msg = Encoding.UTF8.GetString(result.Body);
</I>&gt;<i>
</I>&gt;<i> How is is possible that when subscribed to 'queue-a', that a message is 
</I>&gt;<i> received that we placed into 'queue-b'?
</I>&gt;<i>
</I>&gt;<i> Hope this makes sense....thanks for any thoughts/suggestions.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Steve Schoon
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140717/1aaa5bf1/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140717/1aaa5bf1/attachment.html</A>&gt;
</PRE>












































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037201.html">[rabbitmq-discuss] Is ERLANG OTP 17.1 compatible with RabbitMQ 3.3.4
</A></li>
	<LI>Next message: <A HREF="037203.html">[rabbitmq-discuss] channel-cache-size
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37198">[ date ]</a>
              <a href="thread.html#37198">[ thread ]</a>
              <a href="subject.html#37198">[ subject ]</a>
              <a href="author.html#37198">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
