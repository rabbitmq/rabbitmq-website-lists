<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Implement guaranteed delivery with ReturnListener and ConfirmListener
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Implement%20guaranteed%20delivery%20with%0A%20ReturnListener%20and%20ConfirmListener&In-Reply-To=%3C1405360899082-36795.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037165.html">
   <LINK REL="Next"  HREF="037169.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Implement guaranteed delivery with ReturnListener and ConfirmListener</H1>
    <B>ArnavJoshi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Implement%20guaranteed%20delivery%20with%0A%20ReturnListener%20and%20ConfirmListener&In-Reply-To=%3C1405360899082-36795.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Implement guaranteed delivery with ReturnListener and ConfirmListener">arnav.joshi at mathworks.com
       </A><BR>
    <I>Mon Jul 14 19:01:39 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037165.html">[rabbitmq-discuss] Priority queue doesn't seem to work as	expected
</A></li>
        <LI>Next message: <A HREF="037169.html">[rabbitmq-discuss] Implement guaranteed delivery with ReturnListener and ConfirmListener
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37168">[ date ]</a>
              <a href="thread.html#37168">[ thread ]</a>
              <a href="subject.html#37168">[ subject ]</a>
              <a href="author.html#37168">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We are trying to prototype guaranteed delivery of messages. RabbitMQ with
basic publishing or mandatory\immediate flags only guarantees routing a
message up to the broker with some asynchronous acknowledgements back to the
publisher. It does not promise a reliable delivery of messages. With
consumer crashes and broker restarts, the messages can be lost specifically
if it is not declared as persistent. 
 
We planned to implement both the ReturnListener and ConfirmListener
interfaces.

a.	To be notified of failed deliveries when basicPublish is called with
&#8220;mandatory&#8221; flag
b.	To get publisher confirms on whether messages have been consumed
successfully (acks), or whether they are lost/not persisted (nack).

For testing purposes, we are checking for the confirms for messages which
are being written to undeclared/unbound/currently unavailable queues. We
observe that although the ReturnListener method throws a 312 (NO_ROUTE)
error code, the ConfirmListener still calls the &#8216;handleAck&#8217; method, and not
the &#8216;handleNack&#8217; method as we would expect.

If this implementation is by design &#8211; could you suggest a way in which we
can implement guaranteed delivery, i.e.:

1.	Confirm that the message has not only reached the broker, but has been
processed by one or more queues.
2.	Throw a nack, or generate an exception when the message cannot be routed
and that the message has been persisted to disk
3.	Making blocking calls to our publishes in the ReturnListener
implementation when we are trying to write to such queues?

Follow up question: If a queue process being killed is the only criterion
for ConfirmListener.handleNack being called &#8211; shouldn&#8217;t an
undeclared/currently unavailable queue result in handleNack being called.
Our suspicion is that the message which cannot be routed to a currently
unavailable queue is handled like an unroutable message, which is confirmed
immediately after basic.return but is also &#8216;ACK&#8217;ed, which seems
counter-intuitive.

Thanks,
Arnav Joshi




--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Implement-guaranteed-delivery-with-ReturnListener-and-ConfirmListener-tp36795.html">http://rabbitmq.1065348.n5.nabble.com/Implement-guaranteed-delivery-with-ReturnListener-and-ConfirmListener-tp36795.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037165.html">[rabbitmq-discuss] Priority queue doesn't seem to work as	expected
</A></li>
	<LI>Next message: <A HREF="037169.html">[rabbitmq-discuss] Implement guaranteed delivery with ReturnListener and ConfirmListener
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37168">[ date ]</a>
              <a href="thread.html#37168">[ thread ]</a>
              <a href="subject.html#37168">[ subject ]</a>
              <a href="author.html#37168">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
