<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] exclusive queues and dead lettering
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20exclusive%20queues%20and%20dead%20lettering&In-Reply-To=%3C74daeee0-9d18-473b-ba9b-6ef61e299a14%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037277.html">
   <LINK REL="Next"  HREF="037278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] exclusive queues and dead lettering</H1>
    <B>Emiel Bruijntjes</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20exclusive%20queues%20and%20dead%20lettering&In-Reply-To=%3C74daeee0-9d18-473b-ba9b-6ef61e299a14%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] exclusive queues and dead lettering">emiel.bruijntjes at gmail.com
       </A><BR>
    <I>Tue Jul 29 10:07:33 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037277.html">[rabbitmq-discuss] ANN Bunny 1.4.0 is released
</A></li>
        <LI>Next message: <A HREF="037278.html">[rabbitmq-discuss] Side by side support for 2.8.6 / 3.3.0?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37306">[ date ]</a>
              <a href="thread.html#37306">[ thread ]</a>
              <a href="subject.html#37306">[ subject ]</a>
              <a href="author.html#37306">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

We'd like to use exclusive queues, but we do not want to lose any messages 
in case our consumer crashes. I thought the dead-letter mechanism would be 
a good solution for this: when our application unexpectedly crashes, all 
the exclusive queues that are used by the application will then 
automatically be removed (which is good), and the messages in these queues 
are dead-lettered to a special dead-letter queue where they can later be 
picked up and be further processed.

However, it turns out that dead-lettering does not work that way. When the 
application is killed, the queues are indeed removed, but the messages in 
these queues are lost as well. They are not dead-lettered.

Another (possibly related) issue: according to the online documentation 
(<A HREF="https://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.delete">https://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.delete</A>) the 
queue.delete function should do the following:

&quot;This method deletes a queue. When a queue is deleted any pending messages 
are sent to a dead-letter queue if this is defined in the server 
configuration, and all consumers on the queue are cancelled.&quot;

This does not seem to happen. When I explicitly remove an exclusive 
(possibly true for non-exclusive queues as well) queue, the pending 
messages are not sent to the dead letter queue or dead letter exchange, but 
they are lost.

A work-around for our software that I now can think of is using 
non-exclusive queues, so that the queues will not be removed when the 
application crashes or gets killed. For this work-around we will have to 
find out which queues were active at the time the previous program crashed, 
so that they can be picked up by the restarted process. There is as far as 
I know no AMQP call to retrieve all active queues, or is there?

To summarize:

1. The documentation of the queue.delete function says that pending 
messages are dead-lettered, but they are (as far as I know) not.

2. An exclusive queue that gets deleted because of a broken connection does 
not dead-letter its messages (although it would be very convenient if it 
did)

3. Is there any way how we can find out which queues are still active, so 
that a restarted process can recover from an earlier crash or kill?

Thanks,

Emiel Bruijntjes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140729/2770b637/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140729/2770b637/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037277.html">[rabbitmq-discuss] ANN Bunny 1.4.0 is released
</A></li>
	<LI>Next message: <A HREF="037278.html">[rabbitmq-discuss] Side by side support for 2.8.6 / 3.3.0?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37306">[ date ]</a>
              <a href="thread.html#37306">[ thread ]</a>
              <a href="subject.html#37306">[ subject ]</a>
              <a href="author.html#37306">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
