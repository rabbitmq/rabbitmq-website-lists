<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [ Listen event when queue destroy from client ]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5B%20Listen%20event%20when%20queue%20destroy%20from%0A%20client%20%5D&In-Reply-To=%3CetPan.53ba991a.12200854.1fb1%40mercurio.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037093.html">
   <LINK REL="Next"  HREF="037095.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [ Listen event when queue destroy from client ]</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5B%20Listen%20event%20when%20queue%20destroy%20from%0A%20client%20%5D&In-Reply-To=%3CetPan.53ba991a.12200854.1fb1%40mercurio.local%3E"
       TITLE="[rabbitmq-discuss] [ Listen event when queue destroy from client ]">mklishin at gopivotal.com
       </A><BR>
    <I>Mon Jul  7 13:56:33 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037093.html">[rabbitmq-discuss] [ Listen event when queue destroy from	client ]
</A></li>
        <LI>Next message: <A HREF="037095.html">[rabbitmq-discuss] [ Listen event when queue destroy from	client ]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37094">[ date ]</a>
              <a href="thread.html#37094">[ thread ]</a>
              <a href="subject.html#37094">[ subject ]</a>
              <a href="author.html#37094">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 7 July 2014 at 16:46:36, Hitesh Dobariya (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">hitesh at artoonsolutions.com</A>) wrote:
&gt;<i> &gt; 1) Amqp.js : This is the server in nodejs. when user connect to  
</I>&gt;<i> server. server will generate the queue, and tell client to listen  
</I>&gt;<i> to that queue in passive mode. in short client don't have access  
</I>&gt;<i> for create queue. if i will listen from both side then queue will  
</I>&gt;<i> not destroy automatically becuase my server (amqp.js) file's  
</I>&gt;<i> queue consuming it. so i want that when client (queue.js) killed  
</I>&gt;<i> or close. at that time server will notify that queue is destroyed,  
</I>&gt;<i> and i will get all data like routing key when it destroy.
</I>
I think it's worth clarifying a few things. You do not consume in passive mode:
queue.declare is what takes the passive argument. If you want the server to generate
queue name and send it to the client for whatever reason, the use of
passive declare is fine.

&gt;<i>  
</I>&gt;<i> Whereas amq.rabbitmq.event is the exchange, that will monitor  
</I>&gt;<i> all the the events.
</I>&gt;<i> connection.queue(&quot;eventListener&quot;, { exclusive: true } , function(q){  
</I>&gt;<i> q.bind(&quot;amq.rabbitmq.event&quot;,&quot;&quot;);
</I>&gt;<i>  
</I>&gt;<i> //i want to listen all events here when queue destroy when client  
</I>&gt;<i> app killed.
</I>&gt;<i> q.subscribe(function (message, headers, deliveryInfo, messageObject)  
</I>&gt;<i> {
</I>&gt;<i> console.log(JSON.stringify(headers));
</I>&gt;<i> })
</I>&gt;<i> });
</I>
Two things that stand out: you bind using an empty routing key and not
&quot;#&quot;. Perhaps that's just a typo.

If a client is &quot;destroyed&quot; (I assume it means it has disconnected, hibernated,
otherwise lost connection), only exclusive or auto-delete queues that had consumers
will be deleted. But then amq.rabbitmq.event will not have a message published
because it only tracks explicit queue.delete calls (I'm pretty sure this is the case but
Simon can correct me).

&gt;<i>  
</I>&gt;<i> Above code will generate queue that will listen all the event  
</I>&gt;<i> like exchange create, exchange delete, binding, queue created,  
</I>&gt;<i> queue delete, etc..
</I>&gt;<i> I read in the documentation of the amqp-event plugin that it will  
</I>&gt;<i> deliver all the event which are happing to all exchanges on the  
</I>&gt;<i> rabbitmq server.
</I>
Yes but this will not include queues deleted due to TTL, disconnect of
an exclusive queue owner, etc.

&gt;<i> 2) queue.js : it is the simple client that have only read access  
</I>&gt;<i> to queue in passive mode only. if any event goes to this client  
</I>&gt;<i> like queue delete then it's not helpful to me.
</I>
&gt;<i> My main purpose is to listen event and get message when queue.js  
</I>&gt;<i> will be killed or application killed in android.
</I>
So your problem is effectively a presence one. This brings us back to
square one:

&#171;If your problem is primarily client presence detection, there's presence exchange:&#160;
<A HREF="https://github.com/tonyg/presence-exchange.&#187;">https://github.com/tonyg/presence-exchange.&#187;</A>

&#160;Note that RabbitMQ is not the optimal solution for tracking client presence.
Consider using a tool such as ZooKeeper or Redis.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037093.html">[rabbitmq-discuss] [ Listen event when queue destroy from	client ]
</A></li>
	<LI>Next message: <A HREF="037095.html">[rabbitmq-discuss] [ Listen event when queue destroy from	client ]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37094">[ date ]</a>
              <a href="thread.html#37094">[ thread ]</a>
              <a href="subject.html#37094">[ subject ]</a>
              <a href="author.html#37094">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
