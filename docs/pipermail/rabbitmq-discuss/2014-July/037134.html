<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ waits forever for PID file during	startup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20waits%20forever%20for%20PID%20file%20during%0A%09startup&In-Reply-To=%3CCAHuDZ5pxuvDXjcEnYf4-8fdjHFY%3DfknmRW%3DUV26sofmDdZiV2Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037129.html">
   <LINK REL="Next"  HREF="037154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ waits forever for PID file during	startup</H1>
    <B>Cesar Munoz</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20waits%20forever%20for%20PID%20file%20during%0A%09startup&In-Reply-To=%3CCAHuDZ5pxuvDXjcEnYf4-8fdjHFY%3DfknmRW%3DUV26sofmDdZiV2Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ waits forever for PID file during	startup">cesar.munoz at ammeon.com
       </A><BR>
    <I>Thu Jul 10 15:02:53 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037129.html">[rabbitmq-discuss] Updated RabbitMQ Monitoring for Zabbix
</A></li>
        <LI>Next message: <A HREF="037154.html">[rabbitmq-discuss] RabbitMQ waits forever for PID file during startup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37134">[ date ]</a>
              <a href="thread.html#37134">[ thread ]</a>
              <a href="subject.html#37134">[ subject ]</a>
              <a href="author.html#37134">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon,

so we have tried to find the problem with the initial installation, but no
luck yet. It is very difficult to track it, as it is totally
non-deterministic!
In the meantime, we installed the latest version of RabbitMQ, which
includes de set -e fix, but the same issue still happened. Given the output
of ps auxf

<A HREF="https://gist.github.com/anonymous/62239513b154179a8a4e">https://gist.github.com/anonymous/62239513b154179a8a4e</A>

it looks like

/bin/sh /etc/init.d/rabbitmq-server start

and

/bin/sh /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid

were running concurrently. Is there any chance that this fact created some
sort of race condition between these 2 processes that would make the set -e
fix not work?

Cheers,
Cesar.



On 6 June 2014 11:55, Cesar Munoz &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cesar.munoz at ammeon.com</A>&gt; wrote:

&gt;<i> Hi Simon,
</I>&gt;<i>
</I>&gt;<i> the ulimits for rabbitmq user are pretty much the same, the only
</I>&gt;<i> difference is that max user processes is set to 1024 instead of 2066207.
</I>&gt;<i>
</I>&gt;<i> About the system itself, it is true that there has to be something strange
</I>&gt;<i> going on if a shell redirection can fail, but I'm checking the
</I>&gt;<i> configuration and I don't see anything specially awkward.
</I>&gt;<i>
</I>&gt;<i> We are using Red Hat 6.4, and these are the parameters that we set in the
</I>&gt;<i> sysctl.conf:
</I>&gt;<i> <A HREF="http://pastebin.com/SfJBwrna">http://pastebin.com/SfJBwrna</A>
</I>&gt;<i>
</I>&gt;<i> The rest of the parameters in the kickstart file are pretty much the
</I>&gt;<i> standard ones.
</I>&gt;<i> This is an intermittent issue (we are testing how often it happens, so far
</I>&gt;<i> we got 3 failures in 13 installations), so it is harder to track it!
</I>&gt;<i> Either way, restarting the service works, so it looks like whatever causes
</I>&gt;<i> the problem disappears after a while. I've been trying to find what could
</I>&gt;<i> make this non-deterministic, but so far I haven't noticed anything unusual.
</I>&gt;<i>
</I>&gt;<i> Thanks again!
</I>&gt;<i> Cesar.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 6 June 2014 11:27, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On 06/06/2014 10:49AM, Cesar Munoz wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi Simon,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> the set -e looks like a very good idea, at least the process will return
</I>&gt;&gt;&gt;<i> the failure straight away!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sure!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  These are the ulimits:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at ms1</A> ~]# ulimit -a
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Those are the ulimits which apply to root - maybe they are different for
</I>&gt;&gt;<i> the &quot;rabbitmq&quot; user?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But more to the point: we're failing to do something very very simple
</I>&gt;&gt;<i> here, there has to be something weird about this system if echo or shell
</I>&gt;&gt;<i> redirection can fail with an error message about memory allocation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So have you configured anything unusual about this system?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers, Simon
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Simon MacMullen
</I>&gt;&gt;<i> RabbitMQ, Pivotal
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
-- 
This email and any files transmitted with it are confidential and intended 
solely for the use of the individual or entity to whom they are addressed. 
If you have received this email in error please notify the system manager. 
This message contains confidential information and is intended only for the 
individual named. If you are not the named addressee you should not 
disseminate, distribute or copy this e-mail.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/193fc455/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/193fc455/attachment.html</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037129.html">[rabbitmq-discuss] Updated RabbitMQ Monitoring for Zabbix
</A></li>
	<LI>Next message: <A HREF="037154.html">[rabbitmq-discuss] RabbitMQ waits forever for PID file during startup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37134">[ date ]</a>
              <a href="thread.html#37134">[ thread ]</a>
              <a href="subject.html#37134">[ subject ]</a>
              <a href="author.html#37134">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
