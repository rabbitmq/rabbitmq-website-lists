<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Possible bug in Priority Queue plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20bug%20in%20Priority%20Queue%20plugin&In-Reply-To=%3CD7C993D2A9A4464F8C0E64FEFABA9E426BB38D68%40WAL-MBS02.global.avidww.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037122.html">
   <LINK REL="Next"  HREF="037114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Possible bug in Priority Queue plugin</H1>
    <B>Steven Blanc</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20bug%20in%20Priority%20Queue%20plugin&In-Reply-To=%3CD7C993D2A9A4464F8C0E64FEFABA9E426BB38D68%40WAL-MBS02.global.avidww.com%3E"
       TITLE="[rabbitmq-discuss] Possible bug in Priority Queue plugin">steven.blanc at avid.com
       </A><BR>
    <I>Thu Jul 10 19:02:57 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037122.html">[rabbitmq-discuss] Possible bug in Priority Queue plugin
</A></li>
        <LI>Next message: <A HREF="037114.html">[rabbitmq-discuss] Docs on rabbitmq install for OS X - /etc/hosts	file change
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37146">[ date ]</a>
              <a href="thread.html#37146">[ thread ]</a>
              <a href="subject.html#37146">[ subject ]</a>
              <a href="author.html#37146">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

Nope, I did mean BasicConsume/BasicConsumeMessage.  
I could have done this with BasicGet but I used BasicConsume followed by a looping BasicConsumeMessage.  In SimpleAmqpClient BasicConsumeMessage will wait for a message from the broker, where BasicGet will simply return false if no message is present. 

Here is the gist of my consumer.  The producer has no sleep and will pile up its messages (with BasicPublish) much quicker than this is supposed to consume them, thus allowing messages with low priority to build up for the occasional high priority message to arrive and be inserted above them.

    channel-&gt;BasicConsume(queue_name, consumerTag, true, false, false, /*prefetch*/1);

    for(int i = 0; i &lt; repetitions; i++)
    {
        Envelope::ptr_t myEnvelope = channel-&gt;BasicConsumeMessage(consumerTag);
	  BasicMessage::ptr_t msg_out = myEnvelope-&gt;Message();

        // ACK the message
        channel-&gt;BasicAck(myEnvelope);        

        sleep(1);
    }


-----Original Message-----
From: Michael Klishin [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>] 
Sent: Wednesday, July 09, 2014 8:07 AM
To: Steven Blanc; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] Possible bug in Priority Queue plugin

&#160;On 9 July 2014 at 16:03:16, Steven Blanc (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steven.blanc at avid.com</A>) wrote:
&gt;<i> &gt; I am making sure messages back up in the queue by producing with  
</I>&gt;<i> no
</I>&gt;<i> delay and consuming with a 1 second delay between calls to BasicConumeMessage.  
</I>
Just to clarify: do you mean basic.get? basic.consume creates a &quot;push&quot; subscription (RabbitMQ will
push messages to the client), so it doesn't need to be run multiple times.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037122.html">[rabbitmq-discuss] Possible bug in Priority Queue plugin
</A></li>
	<LI>Next message: <A HREF="037114.html">[rabbitmq-discuss] Docs on rabbitmq install for OS X - /etc/hosts	file change
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37146">[ date ]</a>
              <a href="thread.html#37146">[ thread ]</a>
              <a href="subject.html#37146">[ subject ]</a>
              <a href="author.html#37146">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
