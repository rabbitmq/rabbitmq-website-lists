<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Connection is always in &quot;flow&quot; State.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Connection%20is%20always%20in%20%22flow%22%20State.&In-Reply-To=%3CCAD6m6fFv62LrEyKFQT1rCWJpwZ7d64FDCKmBhJDihqzjAUXBqg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037142.html">
   <LINK REL="Next"  HREF="037100.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Connection is always in &quot;flow&quot; State.</H1>
    <B>Jason McIntosh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Connection%20is%20always%20in%20%22flow%22%20State.&In-Reply-To=%3CCAD6m6fFv62LrEyKFQT1rCWJpwZ7d64FDCKmBhJDihqzjAUXBqg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Connection is always in &quot;flow&quot; State.">mcintoshj at gmail.com
       </A><BR>
    <I>Thu Jul 10 16:45:08 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037142.html">[rabbitmq-discuss] Connection is always in &quot;flow&quot; State.
</A></li>
        <LI>Next message: <A HREF="037100.html">[rabbitmq-discuss] Connection is always in &quot;flow&quot; State.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37144">[ date ]</a>
              <a href="thread.html#37144">[ thread ]</a>
              <a href="subject.html#37144">[ subject ]</a>
              <a href="author.html#37144">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yep glad for the clarification and that's the behavior I'd actually want
thinking about this.  :)  It's like a file load - all IO, no CPU.  SO we
use consumers to do the CPU processing - which is inherently slower in a
ETL concept.  We're basically using RabbitMQ for distributed ETL work (go
distributed computing).  Since file loads are intermittent, you wouldn't
want to slow down file loads.

Thanks for the clarification and that makes it MUCH more clear!
Jason


On Thu, Jul 10, 2014 at 10:41 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;
wrote:

&gt;<i> On 10/07/2014 4:23PM, Jason McIntosh wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Interesting on the 3.3 change.  SO I gotta ask about this situation on
</I>&gt;&gt;<i> that (though it sounds off hand that'll fix the behavior I've seen on
</I>&gt;&gt;<i> 3.2.4).  If a consumer is consumer at 80 msgs/second, but incoming rates
</I>&gt;&gt;<i> are able to publish at 5k a second and the server CPU's/disks/etc.
</I>&gt;&gt;<i> aren't being touched, will rabbit then put back pressure on the
</I>&gt;&gt;<i> publishing rate forcing it down to 72 msgs/second (~10% less than
</I>&gt;&gt;<i> consumes)?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> No, no, no!
</I>&gt;<i>
</I>&gt;<i> (And this is why writing documentation is hard! At least for me.)
</I>&gt;<i>
</I>&gt;<i> I somewhat oversimplified. What really happens is that the queue will
</I>&gt;<i> choose to do work that relates to consumers rather than publishers as long
</I>&gt;<i> as:
</I>&gt;<i>
</I>&gt;<i> 1) The queue is running flat out; it never has any idle time.
</I>&gt;<i> 2) The queue actually has work to do that pertains to consuming.
</I>&gt;<i> 3) Messages are being consumed at less than 110% of the rate they're being
</I>&gt;<i> published.
</I>&gt;<i>
</I>&gt;<i> In the case you describe above, 2) will be false 99% of the time, at which
</I>&gt;<i> point the queue will accept publishes as fast as it can.
</I>&gt;<i>
</I>&gt;<i> In other words, when I said &quot;if consumers and producers are both going as
</I>&gt;<i> fast as they can&quot; I meant if the limiting factor is the queue itself, not
</I>&gt;<i> whatever work they're doing.
</I>&gt;<i>
</I>&gt;<i> I hope that is clearer this time round.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  I'd assume then that'd propagate up to the publisher if
</I>&gt;&gt;<i> there's a chain of rabbit servers all running 3.3 - e.g. the code
</I>&gt;&gt;<i> publish to rabbit which shovels to the remote rabbit where the code
</I>&gt;&gt;<i> consumer runs.  In this case the code publisher would get back pressure
</I>&gt;&gt;<i> that'd reduce it's publish rate to ~72msgs/second?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Which would be a disaster. It's meant to be a queuing system, after all :-)
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>


-- 
Jason McIntosh
<A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/9d4026bb/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/9d4026bb/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037142.html">[rabbitmq-discuss] Connection is always in &quot;flow&quot; State.
</A></li>
	<LI>Next message: <A HREF="037100.html">[rabbitmq-discuss] Connection is always in &quot;flow&quot; State.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37144">[ date ]</a>
              <a href="thread.html#37144">[ thread ]</a>
              <a href="subject.html#37144">[ subject ]</a>
              <a href="author.html#37144">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
