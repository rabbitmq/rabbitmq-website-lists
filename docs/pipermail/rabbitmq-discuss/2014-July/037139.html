<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Introducing%20the%20RabbitMQ%20Sharding%20Plugin&In-Reply-To=%3CCAD6m6fFJk51HtjkzV%2B32P1QTO9XKizxZHhevjUokjfCZ4%2BSrHw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037138.html">
   <LINK REL="Next"  HREF="037143.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin</H1>
    <B>Jason McIntosh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Introducing%20the%20RabbitMQ%20Sharding%20Plugin&In-Reply-To=%3CCAD6m6fFJk51HtjkzV%2B32P1QTO9XKizxZHhevjUokjfCZ4%2BSrHw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin">mcintoshj at gmail.com
       </A><BR>
    <I>Thu Jul 10 16:00:42 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037138.html">[rabbitmq-discuss] rabbitmq cluster startup problem
</A></li>
        <LI>Next message: <A HREF="037143.html">[rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37139">[ date ]</a>
              <a href="thread.html#37139">[ thread ]</a>
              <a href="subject.html#37139">[ subject ]</a>
              <a href="author.html#37139">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Since I just saw this crop up again on the list, thought I'd ask again on
this plugin as it looks danged handy.  With geographically distributed data
centers, we're using RabbitMQ to replicate data and information to remote
data centers.  But with the WAN latency, we hit an issue where a single
queue would seemingly get backlogged trying to shovel messages across the
WAN.  SO we used x-consistent-hashes to basically do something like this:
Publish to a fanout exchange &quot;bob&quot;
bob is bound to &quot;bob.multi&quot;
bob.multi is an x-consistent-hash bound to 8 queues, &quot;bobs.data.1&quot; through
&quot;bobs.data.8&quot;.  We then shovel &quot;bobs.data.1&quot; through 8 to a remote system
that has a single exchange &quot;bob&quot; with a single queue &quot;bobs.data&quot;.  We have
the shovel config over ride the routing key and exchange on the publish
side so things land in one spot.  If I didn't have to script this logic out
I'd be more than happy to switch to using the &quot;shard&quot; exchange.  And the
goal on the remote side is to have a single consumer (java process)
connected to queue &quot;bobs.data&quot; on the remote side, and a single publisher
publishing to &quot;bob&quot; on the publish side.  I THINK I may have misunderstood
the earlier comment where we'd need 1 consumer per shard thing.

Jason




On Thu, Apr 10, 2014 at 3:10 PM, Alvaro Videla &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt;
wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> On Thu, Apr 10, 2014 at 10:07 PM, Jason McIntosh &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mcintoshj at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;   The one thing I didn't see in the post was how many consumers you'd
</I>&gt;<i> need.
</I>&gt;<i> &gt; It sounds like you'd need at least N consumers where N is the number of
</I>&gt;<i> &gt; nodes in the shard?  With the shoveling config, we'd need to dynamically
</I>&gt;<i> &gt; grow consumers to adapt to the cluster size it sounds like.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Yes, at the moment you would need 1 consumer per shard. So if the
</I>&gt;<i> shard-per-node value is 4, then you'd need 4 consumers per node in the
</I>&gt;<i> cluster.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Alvaro
</I>&gt;<i>
</I>


-- 
Jason McIntosh
<A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/5c8eb401/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/5c8eb401/attachment.html</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037138.html">[rabbitmq-discuss] rabbitmq cluster startup problem
</A></li>
	<LI>Next message: <A HREF="037143.html">[rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37139">[ date ]</a>
              <a href="thread.html#37139">[ thread ]</a>
              <a href="subject.html#37139">[ subject ]</a>
              <a href="author.html#37139">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
