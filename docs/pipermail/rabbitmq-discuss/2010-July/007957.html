<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%201.7.0%20close%20the%20cnx%20when%20consumer%0A%20don%27t%20ack%20deliveries%20during%2030s&In-Reply-To=%3C4C3D83BB.5070107%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007942.html">
   <LINK REL="Next"  HREF="007966.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%201.7.0%20close%20the%20cnx%20when%20consumer%0A%20don%27t%20ack%20deliveries%20during%2030s&In-Reply-To=%3C4C3D83BB.5070107%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s">simon at rabbitmq.com
       </A><BR>
    <I>Wed Jul 14 10:30:35 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007942.html">[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
</A></li>
        <LI>Next message: <A HREF="007966.html">[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7957">[ date ]</a>
              <a href="thread.html#7957">[ thread ]</a>
              <a href="subject.html#7957">[ subject ]</a>
              <a href="author.html#7957">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/07/10 16:00, Vincent Barat wrote:
&lt;snip&gt;
&gt;<i> But from time to time, the database blocks during 30s to 1minute and
</I>&gt;<i> thus I don't acknowledge during the same time.
</I>&gt;<i>
</I>&gt;<i> It seems that the RabbitMQ server closes the connection. Is there a
</I>&gt;<i> timeout (or a setting) I can use to fix this issue ?
</I>
Hi Vincent. Not acking for 30s certainly should not close the 
connection. When the server closes a connection due to client error it 
sends an error message; you should see this as an IOException in the 
Java client. Check the ShutdownSignalException inside the IOException to 
get the error code / message. Alternatively you could look in the server 
logs, sometimes there's more detail there.

One way this could be happening is:

* You have heartbeating turned on (I think some of the client version 
have this turned on by default). Heartbeating makes the server 
periodically check the client is still alive and responding.

* You block the connection main loop, say by implementing your own 
Consumer rather than using QueueingConsumer, and doing something slow / 
expensive in Consumer.handleDelivery().

Does this sound plausible? If not I would look for error messages as above.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007942.html">[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
</A></li>
	<LI>Next message: <A HREF="007966.html">[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7957">[ date ]</a>
              <a href="thread.html#7957">[ thread ]</a>
              <a href="subject.html#7957">[ subject ]</a>
              <a href="author.html#7957">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
