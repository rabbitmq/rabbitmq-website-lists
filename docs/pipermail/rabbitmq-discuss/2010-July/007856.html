<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Possible memory leak?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%3F&In-Reply-To=%3C4C2FA30C.10100%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007855.html">
   <LINK REL="Next"  HREF="007847.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Possible memory leak?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%3F&In-Reply-To=%3C4C2FA30C.10100%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Possible memory leak?">matthias at rabbitmq.com
       </A><BR>
    <I>Sat Jul  3 21:52:28 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007855.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
        <LI>Next message: <A HREF="007847.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7856">[ date ]</a>
              <a href="thread.html#7856">[ thread ]</a>
              <a href="subject.html#7856">[ subject ]</a>
              <a href="author.html#7856">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

David King wrote:
&gt;&gt;<i> If you just let it run, what happens?
</I>&gt;<i> 
</I>&gt;<i> I don't know. I guess we can see, but my guess is that it will wake
</I>&gt;<i> me up at two in the morning to fix the site. That's what usually
</I>&gt;<i> happens when rabbit crashes, anyway.
</I>
As long as you are running rabbit 1.8.0, and given the usage pattern you 
describe, it is unlikely that rabbit would actually crash, though it may 
refuse to accept messages from producers (which, I guess, would still be 
a problem). It would be informative to find out whether it actually 
reaches that point.

What memory limit does rabbit think it has? Check the rabbit log for an 
info report along the lines of

=INFO REPORT==== 29-Oct-2009::15:43:27 ===
Memory limit set to 2048MB.

Also, are there any memory alarms in the logs? Look for entries like

=INFO REPORT==== 3-Jul-2010::21:28:31 ===
     alarm_handler: {set,{vm_memory_high_watermark,[]}}


As Marek mentioned your graphs would seem to indicate that rabbit is 
consuming a few gigs of memory right after startup. That doesn't look 
right. A healthy rabbit should eat much less memory than that. For 
example, the rabbit on my development machine starts with a 80MB virtual 
memory footprint, 25 of which is resident.

I am assuming the graph shows the memory usage of the entire machine. 
You said that the memory &quot;does belong to beam.smp&quot;, but do you have a 
graph, or even just some data points for only that process?


If the above doesn't yield any clues, perhaps you could grant one of the 
rabbit engineers temporary access to the machine so they can delve into 
the innards of rabbit to figure out where the memory is going? This 
shouldn't affect the operation of your service.

&gt;&gt;<i> What's the average and max message size in your set up?
</I>&gt;<i> 
</I>&gt;<i> They're just IDs, so they'll be between 5 and 10 bytes each.
</I>
Are any of the messages published as persistent? Another reason to 
upgrade to 1.8.0 is that there only messages published as persistent 
that go to durable queues actually hit the persister - a change we made 
partially as a result of the investigation into your previous problems.

&gt;&gt;<i> How are you measuring the queue length? With 'rabbitmqctl
</I>&gt;&gt;<i> list_queues'?
</I>
How frequently do you run rabbitmqctl?


Regards,

Matthias.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007855.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
	<LI>Next message: <A HREF="007847.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7856">[ date ]</a>
              <a href="thread.html#7856">[ thread ]</a>
              <a href="subject.html#7856">[ subject ]</a>
              <a href="author.html#7856">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
