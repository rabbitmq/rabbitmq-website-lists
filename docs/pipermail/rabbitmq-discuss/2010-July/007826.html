<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Possible memory leak?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%3F&In-Reply-To=%3CAANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007820.html">
   <LINK REL="Next"  HREF="007830.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Possible memory leak?</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%3F&In-Reply-To=%3CAANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Possible memory leak?">majek04 at gmail.com
       </A><BR>
    <I>Thu Jul  1 12:12:42 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007820.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
        <LI>Next message: <A HREF="007830.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7826">[ date ]</a>
              <a href="thread.html#7826">[ thread ]</a>
              <a href="subject.html#7826">[ subject ]</a>
              <a href="author.html#7826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

On Thu, Jul 1, 2010 at 06:31, David King &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dking at ketralnis.com</A>&gt; wrote:
&gt;<i> I have an EC2 node running rabbitmq 1.7.2. Take a look at its memory over the last month &lt;<A HREF="http://i.imgur.com/LMf02.png">http://i.imgur.com/LMf02.png</A>&gt;. Looks like a possible memory leak?
</I>
In this graph, have you restarted RabbitMQ around Saturday? Or had
this sharp edge happened without your intervention?

&gt;<i> It only has 13 queues which generally sit at 0 (this is a change from the last time we restarted it, obvious from that graph, where we had one queue that would sit at ~70k because it was largely duplicates: we no longer do that), but are medium-traffic (maybe a few tens of new items per second, tops, its CPU over the same period: &lt;<A HREF="http://i.imgur.com/BFhMK.png">http://i.imgur.com/BFhMK.png</A>&gt;), so it's not particularly loaded, and it's not clear where all of that memory is going (although it does belong to beam.smp, so it's not some other process). rabbitmq is the only thing this node does.
</I>&gt;<i>
</I>&gt;<i> We can restart once a month, but this might be a bigger deal for higher-traffic users than us
</I>
It won't hurt if you upgraded to the newest RabbitMQ release - 1.8.0.

There might be several causes of the behaviour you described. First,
your specific usage patterns might not play well with garbage
collection. For example, we force full garbage collection run when the
queue is unused for more than 10 seconds. If your queue is constantly
pinged - you're left to Erlang default garbage collection.  That works
well most of the time, but sometimes it's not optimal.

Second thing, currently the broker keeps all currently handled
messages in memory. If your RabbitMQ instance handle 70K messages,
they are all stored in RAM. If that's the case, you could consider
running our experimental code branch, which tries to page out messages
to disk and save RAM.

Cheers,
  Marek Majkowski
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007820.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
	<LI>Next message: <A HREF="007830.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7826">[ date ]</a>
              <a href="thread.html#7826">[ thread ]</a>
              <a href="subject.html#7826">[ subject ]</a>
              <a href="author.html#7826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
