<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] =INFO REPORT==== 21-Jul-2010::11:09:35 === Limiting to approx 10, 000, 000 file handles (should hold things for a while?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%3DINFO%20REPORT%3D%3D%3D%3D%2021-Jul-2010%3A%3A11%3A09%3A35%20%3D%3D%3D%0A%20Limiting%20to%20approx%2010%2C%20000%2C%0A%20000%20file%20handles%20%28should%20hold%20things%20for%20a%20while%3F%29&In-Reply-To=%3C20100721095423.GL24186%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008088.html">
   <LINK REL="Next"  HREF="008101.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] =INFO REPORT==== 21-Jul-2010::11:09:35 === Limiting to approx 10, 000, 000 file handles (should hold things for a while?)</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%3DINFO%20REPORT%3D%3D%3D%3D%2021-Jul-2010%3A%3A11%3A09%3A35%20%3D%3D%3D%0A%20Limiting%20to%20approx%2010%2C%20000%2C%0A%20000%20file%20handles%20%28should%20hold%20things%20for%20a%20while%3F%29&In-Reply-To=%3C20100721095423.GL24186%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] =INFO REPORT==== 21-Jul-2010::11:09:35 === Limiting to approx 10, 000, 000 file handles (should hold things for a while?)">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Jul 21 10:54:24 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008088.html">[rabbitmq-discuss] =INFO REPORT==== 21-Jul-2010::11:09:35 ===	Limiting to approx 10, 000,	000 file handles (should hold things for a while?)
</A></li>
        <LI>Next message: <A HREF="008101.html">[rabbitmq-discuss] building bug21673 with erlang R13B4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8094">[ date ]</a>
              <a href="thread.html#8094">[ thread ]</a>
              <a href="subject.html#8094">[ subject ]</a>
              <a href="author.html#8094">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi John,

On Wed, Jul 21, 2010 at 11:19:48AM +0200, John Apps wrote:
&gt;<i> Just noticed this in the RabbiqMQ log of 1.8.1:
</I>&gt;<i> 
</I>&gt;<i> =INFO REPORT==== 21-Jul-2010::11:09:35 ===
</I>&gt;<i> Limiting to approx 10000000 file handles
</I>&gt;<i> 
</I>&gt;<i> One assumes this does not take much memory? It is presumably possible to
</I>&gt;<i> limit this value, or increase it?
</I>
Yes, it can be changed. You need to set a file_handles_high_watermark
entry in rabbitmq.config:

[{rabbit, [{file_handles_high_watermark, X}]}].

The value is autodetected and is simply held as a number - there are no
memory implications. Under unices, ulimit -n is used. Under Windows,
there seems to be a limit around 16M. Eg see
<A HREF="http://blogs.technet.com/markrussinovich/archive/2009/09/29/3283844.aspx">http://blogs.technet.com/markrussinovich/archive/2009/09/29/3283844.aspx</A>
but we knock that down to 10M.

The point of detecting and limiting file descriptor use is that the
Erlang VM blows up quite badly if some core process within it tries to
read a file and finds it can't. Thus we do what we can to try and
monitor Rabbit's use of file descriptors and to ensure there are always
some left over for the VM to use when it needs. A long blog post on this
topic is at
<A HREF="http://www.lshift.net/blog/2010/03/23/the-fine-art-of-holding-a-file-descriptor">http://www.lshift.net/blog/2010/03/23/the-fine-art-of-holding-a-file-descriptor</A>

Best wishes,

Matthew
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008088.html">[rabbitmq-discuss] =INFO REPORT==== 21-Jul-2010::11:09:35 ===	Limiting to approx 10, 000,	000 file handles (should hold things for a while?)
</A></li>
	<LI>Next message: <A HREF="008101.html">[rabbitmq-discuss] building bug21673 with erlang R13B4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8094">[ date ]</a>
              <a href="thread.html#8094">[ thread ]</a>
              <a href="subject.html#8094">[ subject ]</a>
              <a href="author.html#8094">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
