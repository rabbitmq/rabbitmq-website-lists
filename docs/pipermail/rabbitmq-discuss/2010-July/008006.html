<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq with one producer no consumer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq%20with%20one%20producer%20no%20consumer&In-Reply-To=%3CAANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008003.html">
   <LINK REL="Next"  HREF="008032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq with one producer no consumer</H1>
    <B>Ovidiu Deac</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq%20with%20one%20producer%20no%20consumer&In-Reply-To=%3CAANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq with one producer no consumer">ovidiudeac at gmail.com
       </A><BR>
    <I>Thu Jul 15 23:42:06 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008003.html">[rabbitmq-discuss] rabbitmq with one producer no consumer
</A></li>
        <LI>Next message: <A HREF="008032.html">[rabbitmq-discuss] rabbitmq with one producer no consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8006">[ date ]</a>
              <a href="thread.html#8006">[ thread ]</a>
              <a href="subject.html#8006">[ subject ]</a>
              <a href="author.html#8006">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>With almost 4GB RAM available it can keep 1.3milion messages in one queue. I

On Thu, Jul 15, 2010 at 11:30 PM, Darius Damalakas
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">darius.damalakas at gmail.com</A>&gt; wrote:
&gt;<i> Thanks for telling the story.
</I>&gt;<i>
</I>&gt;<i> By the way, how much messages can now RabbitMQ handle easily?
</I>&gt;<i>
</I>&gt;<i> 2010/7/15 Ovidiu Deac &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ovidiudeac at gmail.com</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There is one thing though which is wrong: if a memory limit is given
</I>&gt;&gt;<i> rabbitmq should manage its memory such that it can continue working
</I>&gt;&gt;<i> properly but doesn't accept any more messages. If the memory limit is
</I>&gt;&gt;<i> above a certain level the queues should be closed and all the messages
</I>&gt;&gt;<i> published become unroutable.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This way it would accept connections which extract messages and thus
</I>&gt;&gt;<i> would free that memory.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Jul 15, 2010 at 10:51 PM, Ovidiu Deac &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ovidiudeac at gmail.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt; I found the problem: the memory limit was the default one which is 1.6
</I>&gt;&gt;<i> &gt; i.e. 40% out of 4GB. It seems the OS installed is 32bits and this is
</I>&gt;&gt;<i> &gt; why erlang doesn't see the full 6GB RAM.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Of course the system didn't work if it ran out of memory.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; As soon as I changed vm_memory_high_watermark to 0.98 by putting
</I>&gt;&gt;<i> &gt; [{rabbit, [{vm_memory_high_watermark, 0.98}]}].
</I>&gt;&gt;<i> &gt; ... in /etc/rabbitmq/rabbitmq.config the problem was fixed
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Thanks for the help.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; ovidiu
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; On Thu, Jul 15, 2010 at 8:50 PM, Scott Brooks &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott at beamdog.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt; 200k messages, @ 300 bytes a piece is nothing.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; I just ran a test and everything is fine for me.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Can you re-do the test? &#160;Also what are the specs on the server you are
</I>&gt;&gt;<i> &gt;&gt; running the test on?
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Scott
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; On Thu, Jul 15, 2010 at 11:33 AM, Ovidiu Deac &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ovidiudeac at gmail.com</A>&gt;
</I>&gt;&gt;<i> &gt;&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt;&gt; First of all thanks for the answers. Second I'll explain the situation
</I>&gt;&gt;<i> &gt;&gt;&gt; a little better.
</I>&gt;&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt; The big picture is like this: we receive orders from outside and they
</I>&gt;&gt;<i> &gt;&gt;&gt; are put in rabbit by our &quot;gateway&quot; and then routed by rabbit to the
</I>&gt;&gt;<i> &gt;&gt;&gt; processing modules. The whole business is about handling those
</I>&gt;&gt;<i> &gt;&gt;&gt; messages and if we are unable to receive messages from outside is very
</I>&gt;&gt;<i> &gt;&gt;&gt; bad so basically our gateway should be up all the time.
</I>&gt;&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt; Normally all the orders coming in should be handled smoothly BUT if
</I>&gt;&gt;<i> &gt;&gt;&gt; something happens to the consumers and they have a downtime the
</I>&gt;&gt;<i> &gt;&gt;&gt; producer has no way to stop the incoming messages. Also we always want
</I>&gt;&gt;<i> &gt;&gt;&gt; to be able to accept messages because we are payed for each incoming
</I>&gt;&gt;<i> &gt;&gt;&gt; message.
</I>&gt;&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt; Normally the system admin should handle the problem and restart the
</I>&gt;&gt;<i> &gt;&gt;&gt; consumers. As I was saying before, we are testing for the worst case
</I>&gt;&gt;<i> &gt;&gt;&gt; scenario, to see what the limits of RabbitMQ are. We want to see how
</I>&gt;&gt;<i> &gt;&gt;&gt; can we extend these limits to increase the time we have until the
</I>&gt;&gt;<i> &gt;&gt;&gt; queues get full.
</I>&gt;&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt; From our calculations if rabbitmq could hold 500k messages up to
</I>&gt;&gt;<i> &gt;&gt;&gt; 300bytes each we would be pretty safe as that would give us enough
</I>&gt;&gt;<i> &gt;&gt;&gt; time to react. The 200k limit is a little tight.
</I>&gt;&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt; ovidiu
</I>&gt;&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; @Ovidiu:
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; BUT, are you really sure you want what you are asking for? If I
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; understand
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; you correctly you want to allow outside producers (not under your
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; control)
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; to send persistant messages directly into your RabbitMQ and not have
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; those
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; producers back off?
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; Personally, I think that is not achievable. At some point your server
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; ii&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; _______________________________________________
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt; s
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; going to reject messages, and your producers must be able to deal
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; with that,
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; if, as you say, no messages are allowed to be lost.
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt; Robby
</I>&gt;&gt;<i> &gt;&gt;&gt; _______________________________________________
</I>&gt;&gt;<i> &gt;&gt;&gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Link&#279;jimai, Best Regards
</I>&gt;<i>
</I>&gt;<i> Darius Damalakas
</I>&gt;<i>
</I></PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008003.html">[rabbitmq-discuss] rabbitmq with one producer no consumer
</A></li>
	<LI>Next message: <A HREF="008032.html">[rabbitmq-discuss] rabbitmq with one producer no consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8006">[ date ]</a>
              <a href="thread.html#8006">[ thread ]</a>
              <a href="subject.html#8006">[ subject ]</a>
              <a href="author.html#8006">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
