<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] configuring beam and rabbit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20configuring%20beam%20and%20rabbit&In-Reply-To=%3CAANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007958.html">
   <LINK REL="Next"  HREF="007992.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] configuring beam and rabbit</H1>
    <B>Aaron Westendorf</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20configuring%20beam%20and%20rabbit&In-Reply-To=%3CAANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] configuring beam and rabbit">aaron at agoragames.com
       </A><BR>
    <I>Tue Jul 13 17:08:27 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007958.html">[rabbitmq-discuss] How to check if an exchange exists
</A></li>
        <LI>Next message: <A HREF="007992.html">[rabbitmq-discuss] configuring beam and rabbit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7947">[ date ]</a>
              <a href="thread.html#7947">[ thread ]</a>
              <a href="subject.html#7947">[ subject ]</a>
              <a href="author.html#7947">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I missed some changes to the rabbitmq-server script that occurred
sometime between 1.5.0 and 1.7.0.

In older versions, the script included the following line at the top:

  [ -f /etc/rabbitmq/rabbitmq.conf ] &amp;&amp; . /etc/rabbitmq/rabbitmq.conf

The file could be used to define any of the bash options, but
documentation and/or posts had suggested that this was how one would
disable smp, for example:

  RABBITMQ_SERVER_ERL_ARGS=&quot;-smp disable&quot;

One could also alter the rest of the standard kernel options and set
socket buffers through this mechanism.  It appears that this file now
is loaded from /&lt;erlang_path&gt;/lib/&lt;rabbit&gt;/scripts/rabbitmq-env which
is included in both rabbitmq-server and rabbitmq-multi, and that this
environment variable is still the correct way to affect kernel polling
and thread and process count.

This causes a lot of confusion with the new config file,
/etc/rabbitmq/rabbitmq.config, which seems to be the place where all
of the application configuration should go.  I feel like I've heard
that this includes socket buffers, but I don't recall.  The only
documentation I can find on the file relates to setting
&quot;vm_memory_high_watermark&quot;, which seems to be specific to rabbit and
not the same as the old &quot;-os_mon system_memory_high_watermark&quot; setting
that was embedded in the rabbitmq-server script.  Is there a complete
reference on the format of this file and what options are available?
Can the cluster configuration be merged into this file?

I'm an erlang noob, but have worked with rabbit enough and read
through the scripts to guess that the following content for
rabbitmq.config would work as expected:

[
  {rabbit, [
    {vm_memory_high_watermark, 0},
    {cluster_config, [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host1</A>, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host2</A>]},
  ]},
  {kernel, [
    {inet_default_listen_options,
[{nodelay,true},{sndbuf,32768},{recbuf,32768}] },
    {inet_default_connect_options, [{nodelay,true}] }
  ]},
  {os_mon, [
    {start_cpu_sup, false},
  ]}
].


Please let me know if my understanding of the current configuration is
correct.  I need to fix some of our defaults, re-arrange some files
and I'll probably write up a blog post to summarize our setup.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aaron at agoragames.com</A>
www.agoragames.com
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007958.html">[rabbitmq-discuss] How to check if an exchange exists
</A></li>
	<LI>Next message: <A HREF="007992.html">[rabbitmq-discuss] configuring beam and rabbit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7947">[ date ]</a>
              <a href="thread.html#7947">[ thread ]</a>
              <a href="subject.html#7947">[ subject ]</a>
              <a href="author.html#7947">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
