<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Ruby%20AMQP%20client%20not%201.8.0%20friendly&In-Reply-To=%3CB925298E-AFD1-4E81-859D-F70D5E52CFDA%40npcinternational.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007817.html">
   <LINK REL="Next"  HREF="007833.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly</H1>
    <B>Jon Brisbin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Ruby%20AMQP%20client%20not%201.8.0%20friendly&In-Reply-To=%3CB925298E-AFD1-4E81-859D-F70D5E52CFDA%40npcinternational.com%3E"
       TITLE="[rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly">jon.brisbin at npcinternational.com
       </A><BR>
    <I>Thu Jul  1 14:11:01 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007817.html">[rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
</A></li>
        <LI>Next message: <A HREF="007833.html">[rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7831">[ date ]</a>
              <a href="thread.html#7831">[ thread ]</a>
              <a href="subject.html#7831">[ subject ]</a>
              <a href="author.html#7831">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Test program trying to get 4 messages in a queue.

The queue:

vcloud.deployment.events	xportal.war		[]


The test code:

#!/opt/ruby-enterprise-1.8.7-2010.02/bin/ruby

require &quot;rubygems&quot;
require &quot;mq&quot;

em_thread = Thread.new { EM.run }
AMQP.start(:host =&gt; &quot;mq2.cloud.npci.com&quot;, 
           :port =&gt; 5672, 
           :user =&gt; &quot;cloud&quot;, 
           :pass =&gt; &quot;vcloud&quot;, 
           :vhost =&gt; &quot;cloud&quot;) do
  puts &quot;Before subscribe&quot;
  MQ.queue(&quot;xportal.war&quot;).bind(&quot;vcloud.deployment.events&quot;).subscribe(:ack =&gt; true) do |headers, body|
    md5sum = headers.properties[:correlation_id]
    artifact = body
    
    puts &quot;MD5: #{md5sum}&quot;
  end                   
  puts &quot;After subscribe&quot;
end                    

em_thread.join()                                      

+-( ~/scratch ):&gt; ./mq_test.rb 
Before subscribe
After subscribe
/opt/ruby-enterprise-1.8.7-2010.02/lib/ruby/gems/1.8/gems/amqp-0.6.7/lib/mq.rb:225:in `process_frame': PRECONDITION_FAILED - parameters for queue 'xportal.war' in vhost 'cloud' not equivalent in AMQP::Protocol::Queue::Declare on 1 (MQ::Error)
	from ./mq_test.rb:22:in `join'
	from ./mq_test.rb:22


The server log:

=INFO REPORT==== 1-Jul-2010::08:04:36 ===
accepted TCP connection on 0.0.0.0:5672 from 172.16.0.131:63535

=INFO REPORT==== 1-Jul-2010::08:04:36 ===
starting TCP connection &lt;0.793.0&gt; from 172.16.0.131:63535

=ERROR REPORT==== 1-Jul-2010::08:04:36 ===
connection &lt;0.793.0&gt; (running), channel 1 - error:
{amqp_error,precondition_failed,
            &quot;parameters for queue 'xportal.war' in vhost 'cloud' not equivalent&quot;,
            'queue.declare'}

=WARNING REPORT==== 1-Jul-2010::08:04:36 ===
exception on TCP connection &lt;0.793.0&gt; from 172.16.0.131:63535
connection_closed_abruptly

=INFO REPORT==== 1-Jul-2010::08:04:36 ===
closing TCP connection &lt;0.793.0&gt; from 172.16.0.131:63535


Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Jun 30, 2010, at 8:57 PM, Tony Garnock-Jones wrote:

&gt;<i> Jon Brisbin wrote:
</I>&gt;&gt;<i> Upgraded my RabbitMQ server the other day to 1.8.0. Java stuff works fine,
</I>&gt;&gt;<i> of course, because I just bumped the version number in Maven. But Ruby AMQP
</I>&gt;&gt;<i> gem (v. 0.6.7) is now complaining. Downloaded the amqp-0.9.1.json file and
</I>&gt;&gt;<i> re-generated the spec.rb file, which made errors go away, but now it looks
</I>&gt;&gt;<i> like queue subscriptions don't work.
</I>&gt;<i> 
</I>&gt;<i> What kind of complaining is it doing with the stock 0.6.7 gem? What error
</I>&gt;<i> messages are you seeing, and which operation is failing? Is there anything in
</I>&gt;<i> the RabbitMQ server logs?
</I>&gt;<i> 
</I>&gt;<i> (Note BTW also that the 1.8.0 release of RabbitMQ is an AMQP *0-8* release, not
</I>&gt;<i> a 0-9-1 release.)
</I>&gt;<i> 
</I>&gt;<i> Tony
</I>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007817.html">[rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
</A></li>
	<LI>Next message: <A HREF="007833.html">[rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7831">[ date ]</a>
              <a href="thread.html#7831">[ thread ]</a>
              <a href="subject.html#7831">[ subject ]</a>
              <a href="author.html#7831">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
