<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] C client and thread safety
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20C%20client%20and%20thread%20safety&In-Reply-To=%3CAANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007848.html">
   <LINK REL="Next"  HREF="007843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] C client and thread safety</H1>
    <B>Jim Irrer</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20C%20client%20and%20thread%20safety&In-Reply-To=%3CAANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] C client and thread safety">irrer at umich.edu
       </A><BR>
    <I>Thu Jul  1 21:29:16 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007848.html">[rabbitmq-discuss] chaining gateways via Java client?
</A></li>
        <LI>Next message: <A HREF="007843.html">[rabbitmq-discuss] C client and thread safety
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7840">[ date ]</a>
              <a href="thread.html#7840">[ thread ]</a>
              <a href="subject.html#7840">[ subject ]</a>
              <a href="author.html#7840">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings -

Firstly, I remain impressed with Rabbit as a group that can make solid,
useful
software.

I'm working with the RabbitMQ C client, and had a few questions
about thread safety.  In particular:

Must a socket returned by amqp_open_socket be exclusively
associated with one connection, or can it be used for multiple
connections?

Must a socket returned by amqp_open_socket be exclusively
used by one thread, or can it be used by multiple threads?

Must a connection returned by amqp_new_connection be exclusively
used to read from or write to one channel/queue, or is using multiple ok,
even in a multi-threaded environment.

If any of these can be used by multiple threads, is there a performance
advantage in reusing the same socket or connection, or is using multiple
ones better?

It looks like channels (created with amqp_channel_open) are identified by
(small?)
integers chosen by the application and are associated with the connection.
This
means that it is the responsibility of the application to choose unique
numbers,
properly close them, etc..   It would seem cleaner to pass a connection as a
single parameter to amqp_channel_open and have it return a pointer to a
channel,
and the list of channels would be maintained in the connection.

Also, it looks like amqp_new_connection uses 'calloc' to allocate
memory for a connection, but amqp_connection_close does not do
a 'free' to avoid the memory leak.  Maybe that was intentional, but if
not it should be changed.

Thanks,

- Jim

Jim Irrer     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/52dfe08d/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/52dfe08d/attachment.htm</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007848.html">[rabbitmq-discuss] chaining gateways via Java client?
</A></li>
	<LI>Next message: <A HREF="007843.html">[rabbitmq-discuss] C client and thread safety
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7840">[ date ]</a>
              <a href="thread.html#7840">[ thread ]</a>
              <a href="subject.html#7840">[ subject ]</a>
              <a href="author.html#7840">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
