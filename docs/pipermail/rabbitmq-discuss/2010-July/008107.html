<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ production setup questions around	clustering
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20production%20setup%20questions%20around%0A%09clustering&In-Reply-To=%3CAANLkTimibWt-4ALmI_Ux8DWT7GgO6PVEBLuLJ4GlKjrS%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008106.html">
   <LINK REL="Next"  HREF="008121.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ production setup questions around	clustering</H1>
    <B>Aaron Westendorf</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20production%20setup%20questions%20around%0A%09clustering&In-Reply-To=%3CAANLkTimibWt-4ALmI_Ux8DWT7GgO6PVEBLuLJ4GlKjrS%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ production setup questions around	clustering">aaron at agoragames.com
       </A><BR>
    <I>Wed Jul 21 22:02:46 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008106.html">[rabbitmq-discuss] RabbitMQ production setup questions around	clustering
</A></li>
        <LI>Next message: <A HREF="008121.html">[rabbitmq-discuss] RabbitMQ production setup questions around clustering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8107">[ date ]</a>
              <a href="thread.html#8107">[ thread ]</a>
              <a href="subject.html#8107">[ subject ]</a>
              <a href="author.html#8107">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dave,

I intend to write up a blog post on our cluster setup which will
hopefully address some of your questions.  You're trying to set up
your cluster much the way we originally did, but it's not quite the
way Rabbit or AMQP operate.

Think of it as the postal service, where exchanges are your
street-corner deposit boxes and office tellers, and the postal service
is the cluster itself.  Your address is your routing scheme, and that
routing key will deliver a message to your postal box.  The box/queue
is the ultimate endpoint, it lives in a discrete location, and you
have to go to your local post office and consume the mail out of it.

Your load balancer will be of little use for consumers, as your
consumers must be connecting to the node on which your queues reside.
Load balancing can be used for your producers though, in cases where
they are easily separated.

I've heard redirect is removed from later specifications.  Regardless,
I recommend turning the &quot;insist&quot; flag on and avoiding redirects
altogether, because they're inconsistent with the way AMQP clustering
works.

I hope that gives you a good start.

-Aaron


On Wed, Jul 21, 2010 at 4:43 PM, Dave Greggory &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">davegreggory at yahoo.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> We are setting up a RabbitMQ cluster as our message broker for servicing our
</I>&gt;<i> guaranteed delivery needs. We will have a local data store on our producers for
</I>&gt;<i> guaranteeing delivery, but we don't want to resort to that except as a last
</I>&gt;<i> ditch effort in cases of catastrophic failures. I would like to better
</I>&gt;<i> understand how the cluster setup in RabbitMQ works.
</I>&gt;<i>
</I>&gt;<i> Our setup:
</I>&gt;<i> 2 rabbitmq nodes clustered together sitting behind a hardware load balancer.
</I>&gt;<i> Upon initial release, our message volume will not be that high, but it will grow
</I>&gt;<i> real fast once we offload more work to the message broker from our current
</I>&gt;<i> non-messaging based infrastructure. Since the initial volume is not very high,
</I>&gt;<i> we do not intend to use the load balancer for actual load balancing but to
</I>&gt;<i> always send connections to a specific rabbitmq node in the cluster. If RabbitMQ
</I>&gt;<i> does not respond or the port is not open, it will automatically switch to the
</I>&gt;<i> second node for new connections.
</I>&gt;<i>
</I>&gt;<i> Questions:
</I>&gt;<i> 1. Are there any case studies for setting up clustering in RabbitMQ?
</I>&gt;<i> 2. When a queue is declared (by one of our producers), is the queue always
</I>&gt;<i> created on the rabbitmq node the producer client has a connection to or is the
</I>&gt;<i> queue created on a randomly selected node within the cluster?
</I>&gt;<i> 3. If the queue is durable and the messages sent to it are marked persistent,
</I>&gt;<i> will these messages always be persisted to disk and be available after a restart
</I>&gt;<i> of the node that has that queue, regardless of whether the node is a disk node
</I>&gt;<i> or RAM node? (This line &quot;Should you do this, and suffer &#160; &#160; &#160; &#160; &#160; a power
</I>&gt;<i> failure to the entire cluster, the entire state of &#160; &#160; &#160; &#160; &#160; the cluster,
</I>&gt;<i> including all messages, will be lost. &#160; &#160; &#160; &#160; &quot; in
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A> is confusing)
</I>&gt;<i> 4. Should I configure both my nodes as disk nodes or will one disk node be
</I>&gt;<i> sufficient? In other words, if only 1 disk node was there in the cluster and its
</I>&gt;<i> hard drive went bust, what can I recover from the RAM node? If nothing can be
</I>&gt;<i> recovered from the RAM node, is it mainly for increasing the number of
</I>&gt;<i> connections without taking any hits to disk throughput?
</I>&gt;<i> 5. Are connections redirects actually supported by the current version? The FAQ
</I>&gt;<i> and Clustering documents on site are contradictory of each other. (FAQ says
</I>&gt;<i> &quot;Future releases will support live failover using, for &#160; &#160; &#160; &#160;instance, a
</I>&gt;<i> combination of the &quot;known hosts&quot; field in connection.open-ok and the
</I>&gt;<i> connection.redirect message.&quot;)
</I>&gt;<i> 6. If redirects are supported, when all connections are being sent to a specific
</I>&gt;<i> rabbitmq node in the cluster by the loadbalancer, will that rabbitmq node still
</I>&gt;<i> send a redirect request to the client if it's getting too taxed? If so, then is
</I>&gt;<i> it possible to limit redirects to only the disk nodes within the cluster so that
</I>&gt;<i> we don't lose any data?
</I>&gt;<i>
</I>&gt;<i> 7. Will the connections be redirected solely based on RabbitMQ node's ability to
</I>&gt;<i> serve it or is it more round-robin?
</I>&gt;<i> 8. Is there a way to ensure that the cluster configuration is correct because
</I>&gt;<i> 'disc/RAM' is not reported correctly by rabbitmqctl (as per
</I>&gt;<i> <A HREF="http://old.nabble.com/Rabbitmq-v.-1.8.1---Bug-report---Could-not-start-a-node-as-RAM-node-in-cluster-ts29211668.html">http://old.nabble.com/Rabbitmq-v.-1.8.1---Bug-report---Could-not-start-a-node-as-RAM-node-in-cluster-ts29211668.html</A>)?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks so much,
</I>&gt;<i> Dave
</I>


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aaron at agoragames.com</A>
www.agoragames.com
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008106.html">[rabbitmq-discuss] RabbitMQ production setup questions around	clustering
</A></li>
	<LI>Next message: <A HREF="008121.html">[rabbitmq-discuss] RabbitMQ production setup questions around clustering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8107">[ date ]</a>
              <a href="thread.html#8107">[ thread ]</a>
              <a href="subject.html#8107">[ subject ]</a>
              <a href="author.html#8107">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
