<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitKernel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitKernel&In-Reply-To=%3CD0D75CBE-A939-4A2C-A79C-9A5046C145E5%40npcinternational.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008223.html">
   <LINK REL="Next"  HREF="008226.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitKernel</H1>
    <B>Jon Brisbin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitKernel&In-Reply-To=%3CD0D75CBE-A939-4A2C-A79C-9A5046C145E5%40npcinternational.com%3E"
       TITLE="[rabbitmq-discuss] RabbitKernel">jon.brisbin at npcinternational.com
       </A><BR>
    <I>Fri Jul 30 21:31:42 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008223.html">[rabbitmq-discuss] RabbitKernel
</A></li>
        <LI>Next message: <A HREF="008226.html">[rabbitmq-discuss] RabbitKernel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8225">[ date ]</a>
              <a href="thread.html#8225">[ thread ]</a>
              <a href="subject.html#8225">[ subject ]</a>
              <a href="author.html#8225">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I can see several advantages:

In addition to the management and resource efficiency of consolidating to a central (to that VM anyway) postoffice, it seems more scalable, can support higher throughput because of the dedicated dispatching (which is a pattern I use anyway inside the code where I do messaging), vastly reduces resource usage in those other components where all of this functionality is duplicated at current, and seems it will make testing easier because I can dispense with actual message sending/receiving in the test versions of modules without affecting application code.

It should also be easier to manage services I would otherwise have to start with a bash script like the cache, the store updater, the distributed ClassLoader, and suchlike...

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Jul 30, 2010, at 3:16 PM, Alexis Richardson wrote:

&gt;<i> Jon
</I>&gt;<i> 
</I>&gt;<i> Thank-you!  Now can you elaborate on what the middle tier 'gets you'
</I>&gt;<i> please?  Is it just a convenient hosting layer or does it control
</I>&gt;<i> something that can't be in the other two tiers?
</I>&gt;<i> 
</I>&gt;<i> alexis
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Fri, Jul 30, 2010 at 9:09 PM, Jon Brisbin
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jon.brisbin at npcinternational.com</A>&gt; wrote:
</I>&gt;&gt;<i> I've attached a PDF of a 5-minute diagram that shows some use cases for me.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On the right:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Top is a tcServer instance that needs to load an object from the distributed cache.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Middle is a cron job that needs access to modules running in NetKernel on that machine for maintenance functions.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Bottom is the AS/400 that needs to update the PostgreSQL server at a store as the result of a database trigger.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Flow for tcServer code requesting object from distributed cache:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 1. Use Scala/Akka (or some IPC mechanism) to block on a remote Actor which checks local cache module but doesn't find the object. It shells out to the AMQP module, which is solely responsible for sending and receiving messages.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 2. Sends a message to the cloud, asking for the object.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 3. Remote AMQP module gets a cache request message and dispatches it to the cache module, which returns an object. The remote AMQP module then replies to the requestor, handing back the Protobuf'd object.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 4. Requesting AMQP module maybe stores object in local cache and hands object back to Akka module, which replies to the tcServer code that originally requested the object.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Flow for AS/400 wanting to update a store:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 1. AS/400 trigger fires, dumping a message into RabbitMQ.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 2. AMQP module sees it and delegates to Store Updater Module.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 3. Store Updater Module sees this is a fire-and-forget update, so returns immediately and proceeds to update a store database in Birmingham, Alabama (or Portland, Oregon for that matter) asynchronously.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Jon Brisbin
</I>&gt;&gt;<i> Portal Webmaster
</I>&gt;&gt;<i> NPC International, Inc.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Jul 30, 2010, at 1:34 PM, Alexis Richardson wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Jon
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Interesting indeed!  At the risk of being both laconic and glib... do
</I>&gt;&gt;&gt;<i> you have a diagram showing what you propose to achieve?  I think that
</I>&gt;&gt;&gt;<i> would bring this to life...
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> alexis
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Fri, Jul 30, 2010 at 5:01 PM, Jon Brisbin
</I>&gt;&gt;&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jon.brisbin at npcinternational.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently).
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource &quot;callbacks&quot; would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> There seems to be a &quot;best practice&quot; way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's &quot;whiteboard&quot; pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Jon Brisbin
</I>&gt;&gt;&gt;&gt;<i> Portal Webmaster
</I>&gt;&gt;&gt;&gt;<i> NPC International, Inc.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> On Jul 29, 2010, at 4:34 PM, David Wragg wrote:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Hi Jon,
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Jon Brisbin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jon.brisbin at npcinternational.com</A>&gt; writes:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Has anyone worked with RabbitMQ inside NetKernel?
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://www.1060research.com/netkernel/">http://www.1060research.com/netkernel/</A>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> I know enough about OSGI to make myself dangerous. I've worked some
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> with Apache's ESB, so when I came across NetKernel, I thought I'd at
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> least explore it a little to see if it would make our cloud
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> infrastructure easier to manage. I'd love to have some AMQP
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> integration in NetKernel to play with, so I wondered if anyone has
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> already worked on something or if there are plans to do so?
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> I don't think we've heard of RabbitMQ and NetKernel being used together.
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> I wonder how you would combine the resource oriented computing paradigm
</I>&gt;&gt;&gt;&gt;&gt;<i> of NetKernel with a messaging approach?  Or were you thinking of using
</I>&gt;&gt;&gt;&gt;&gt;<i> AMQP as a transport for Netkernel?
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Dvid
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;&gt;&gt;<i> David Wragg
</I>&gt;&gt;&gt;&gt;&gt;<i> Staff Engineer, RabbitMQ
</I>&gt;&gt;&gt;&gt;&gt;<i> SpringSource, a division of VMware
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008223.html">[rabbitmq-discuss] RabbitKernel
</A></li>
	<LI>Next message: <A HREF="008226.html">[rabbitmq-discuss] RabbitKernel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8225">[ date ]</a>
              <a href="thread.html#8225">[ thread ]</a>
              <a href="subject.html#8225">[ subject ]</a>
              <a href="author.html#8225">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
