<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Synchronous confirmation of delivery to the	queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Synchronous%20confirmation%20of%20delivery%20to%20the%0A%09queue&In-Reply-To=%3C%21%26%21AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAMDP3iijxWhNsuta5Up8u38BAAAAAA%3D%3D%40oryo.lt%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007858.html">
   <LINK REL="Next"  HREF="007861.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Synchronous confirmation of delivery to the	queue</H1>
    <B>Andrius Norkaitis</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Synchronous%20confirmation%20of%20delivery%20to%20the%0A%09queue&In-Reply-To=%3C%21%26%21AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAMDP3iijxWhNsuta5Up8u38BAAAAAA%3D%3D%40oryo.lt%3E"
       TITLE="[rabbitmq-discuss] Synchronous confirmation of delivery to the	queue">andrius.norkaitis at oryo.lt
       </A><BR>
    <I>Mon Jul  5 21:39:54 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007858.html">[rabbitmq-discuss] Synchronous confirmation of delivery to the queue
</A></li>
        <LI>Next message: <A HREF="007861.html">[rabbitmq-discuss] Synchronous confirmation of delivery to the queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7860">[ date ]</a>
              <a href="thread.html#7860">[ thread ]</a>
              <a href="subject.html#7860">[ subject ]</a>
              <a href="author.html#7860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Matthew.

I tried it, but BasicPublish and TxCommit completes event if there are no
queues to route.

public bool Publish() {
          try{
	ch.TxSelect();
	bool Mandatory = true; Immediate = false;
	ch.BasicPublish(&quot;direct&quot;, routingKey,Mandatory, Immediate,
basicProperties, body);
	ch.TxCommit();
	return true;
          }
	catch { return false; }
}

I always get TRUE event I there is no consumer/query available.
How to detect that message wasn't published to the queue in same method
calling BasicPublish? I need to return bool flag after trying to publish.

If it is possible only in asynchronous matter using BasicReturn event then I
think I have two options:
1. Lock thread after calling BasicPublish for limited time or while
BasicReturn is returned. (Theading is hard .. Is it good way?)
2. Because I use autodelete query I can check is query available by calling:

bool isConsumerAvailable = false;
try{
ch.QueueDelete(routingKey, true, true, false);
} catch 
{
//if there is no query I get exception code=404, text=&quot;NOT_FOUND&quot;
isConsumerAvailable = true;
}

What do you think?

-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>
[mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Matthew
Sackman
Sent: Monday, July 05, 2010 12:42 PM
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Synchronous confirmation of delivery to the
queue

Hi,

On Mon, Jul 05, 2010 at 11:05:00AM +0300, Andrius Norkaitis wrote:
&gt;<i> I have publisher which send message to consumer (using direct exchange 
</I>&gt;<i> and non-durable, autodelete queue) and it needs instant confirmation 
</I>&gt;<i> that the message is routed to the query. I can't use asynchronous 
</I>&gt;<i> IModel.BasicReturn event because I need to know is message routed to 
</I>&gt;<i> query instantly after I call publish method. I think it may be done 
</I>&gt;<i> using autodelete queue, mandatory and immediate message flags, and 
</I>&gt;<i> transactions. If subscriber is offline there would be no query to 
</I>&gt;<i> deliver the message so publisher should get exception after it calls
</I>publish method.

The immediate is pretty meaningless in the context of a transaction, and we
largely reinterpret it as mandatory. I suspect you just want to use
mandatory and a transaction.

However note that if you're doing a commit per publish, performance will be
rather slower. This may not affect your application, depending on its needs.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007858.html">[rabbitmq-discuss] Synchronous confirmation of delivery to the queue
</A></li>
	<LI>Next message: <A HREF="007861.html">[rabbitmq-discuss] Synchronous confirmation of delivery to the queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7860">[ date ]</a>
              <a href="thread.html#7860">[ thread ]</a>
              <a href="subject.html#7860">[ subject ]</a>
              <a href="author.html#7860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
