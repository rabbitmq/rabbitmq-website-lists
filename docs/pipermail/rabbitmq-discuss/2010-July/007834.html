<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Integrating Pika into Tornado
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Integrating%20Pika%20into%20Tornado&In-Reply-To=%3CAANLkTik9H-erbYqIZxv7mCRJXY6s6Qwb3p-HmPh2ygA8%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007825.html">
   <LINK REL="Next"  HREF="007850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Integrating Pika into Tornado</H1>
    <B>Andrea Corbellini</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Integrating%20Pika%20into%20Tornado&In-Reply-To=%3CAANLkTik9H-erbYqIZxv7mCRJXY6s6Qwb3p-HmPh2ygA8%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Integrating Pika into Tornado">corbellini.andrea at gmail.com
       </A><BR>
    <I>Thu Jul  1 15:10:35 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007825.html">[rabbitmq-discuss] In queue statistics,	what does 'count' 	represent?
</A></li>
        <LI>Next message: <A HREF="007850.html">[rabbitmq-discuss] Integrating Pika into Tornado
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7834">[ date ]</a>
              <a href="thread.html#7834">[ thread ]</a>
              <a href="subject.html#7834">[ subject ]</a>
              <a href="author.html#7834">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everybody,

Recently I've started to work on a project to make Pika work with the
Tornado web server, and I would like receive some feedback from you
before proposing something for merging. The approach I've used
consists of making Pika more event-based. Since code is better that
words, I've attached what I've done so far (there's also a test
script). As you will see, I haven't touched Pika itself yet, instead
I've written a quick and dirty hack based on the library, rewriting
just the relevant parts.

There are two main steps that needs to be done in order to have
something ready to land into the development mainline. First of all,
the `Connection` and `ChannelHandler` classes should be partially
rewritten in order to make them event-oriented. Then, the asyncore and
the blocking adapters needs to be rewritten in order to make them work
with the new code.

The first step is easy: I've already done most of the work. The only
thing that should be done is to replace the calls to
IOStream.read_bytes() and IOStream.write() with two new functions that
should be overridden by the various adapters. Also, it'd be useful to
add a `callback` argument to methods such as `send_frame`,
`wait_for_open` and so on.

The second step instead requires a bit more work. The things to do
are: make the current adapters more event-based and let them use the
two new functions.

So, basically, the current flow:

connect -&gt; drain_events() -&gt; handle frame

will be changed in order to become:

connect -&gt; [wait for data] -&gt; callback1 -&gt; [wait for data] -&gt; callback2 -&gt; ...

where &quot;[wait for data]&quot; depends on the adapter (e.g.: the Tornado's
adapter will use IOLoop, the blocking adapter will read directly from
the socket).


So, that's my propose. I'd happy to answer any of your questions and
to receive any feedback from you.

Thanks,
Andrea
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tamqp.tar.gz
Type: application/x-gzip
Size: 7237 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/b4e22fe7/attachment.bin">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/b4e22fe7/attachment.bin</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007825.html">[rabbitmq-discuss] In queue statistics,	what does 'count' 	represent?
</A></li>
	<LI>Next message: <A HREF="007850.html">[rabbitmq-discuss] Integrating Pika into Tornado
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7834">[ date ]</a>
              <a href="thread.html#7834">[ thread ]</a>
              <a href="subject.html#7834">[ subject ]</a>
              <a href="author.html#7834">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
