<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] QueueingConsumer basicPublish safety
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20QueueingConsumer%20basicPublish%20safety&In-Reply-To=%3C4C52D450.2030003%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008210.html">
   <LINK REL="Next"  HREF="008197.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] QueueingConsumer basicPublish safety</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20QueueingConsumer%20basicPublish%20safety&In-Reply-To=%3C4C52D450.2030003%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] QueueingConsumer basicPublish safety">emile at rabbitmq.com
       </A><BR>
    <I>Fri Jul 30 14:32:00 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008210.html">[rabbitmq-discuss] QueueingConsumer basicPublish safety
</A></li>
        <LI>Next message: <A HREF="008197.html">[rabbitmq-discuss] Very simply example showing request/reply	communication (C/C++, COBOL, C#)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8217">[ date ]</a>
              <a href="thread.html#8217">[ thread ]</a>
              <a href="subject.html#8217">[ subject ]</a>
              <a href="author.html#8217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tsuraan,

On 29/07/10 17:11, tsuraan wrote:
&gt;&gt;<i> Channel.flow has been asserted and therefore the basic.publish call has
</I>&gt;&gt;<i> blocked. We are aware that our API documentation is incorrect in
</I>&gt;&gt;<i> claiming that basic.publish is safe to use in the given context. This
</I>&gt;&gt;<i> will be updated.
</I>&gt;<i> 
</I>&gt;<i> So this probably only happens when rabbit thinks it's overloaded?
</I>
Correct

&gt;&gt;<i> You need to enable consumption of messages while publishers are
</I>&gt;&gt;<i> potentially blocked. This will allow memory pressure on the broker to be
</I>&gt;&gt;<i> relieved and publishers to resume eventually. In your example
</I>&gt;&gt;<i> consumption and publication happens in the same thread and therefore
</I>&gt;&gt;<i> your application gets completely stuck as soon as publication blocks.
</I>&gt;<i> 
</I>&gt;<i> So is it safe to publish messages on a channel when some other thread
</I>&gt;<i> is consuming on that channel?  If I acquire a lock on the channel in a
</I>&gt;<i> different thread, and the channel blocks in basicPublish, will that
</I>&gt;<i> still allow new messages to be delivered to the consumer?
</I>
In general, channels should not be shared by multiple threads, which is
what you are proposing. In your case it makes sense to publish and
consume on different channels to prevent this.

Even so, the channel.flow event from the broker that blocks the producer
only affects messages travelling in one direction. AMQP permits the
broker to deliver messages to consumer on the same channel.

&gt;&gt;<i> You could also consider using separate channels for publishing and
</I>&gt;&gt;<i> consuming messages.
</I>&gt;<i> I'm currently doing acks and publishes in a transaction, but I'm not
</I>&gt;<i> sure if that's entirely necessary.  It's certainly convenient and
</I>&gt;<i> safe, but I don't know that I really need to do it.  Are acks
</I>&gt;<i> guaranteed not to block the way that publishes do?  I obviously can't
</I>&gt;<i> send my acks on a different channel :)
</I>
Acks are guaranteed not to block.



Regards

Emile
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008210.html">[rabbitmq-discuss] QueueingConsumer basicPublish safety
</A></li>
	<LI>Next message: <A HREF="008197.html">[rabbitmq-discuss] Very simply example showing request/reply	communication (C/C++, COBOL, C#)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8217">[ date ]</a>
              <a href="thread.html#8217">[ thread ]</a>
              <a href="subject.html#8217">[ subject ]</a>
              <a href="author.html#8217">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
