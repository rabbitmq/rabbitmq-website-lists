<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Possible memory leak?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%3F&In-Reply-To=%3C4C2CF92B.7020008%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007838.html">
   <LINK REL="Next"  HREF="007855.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Possible memory leak?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%3F&In-Reply-To=%3C4C2CF92B.7020008%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Possible memory leak?">matthias at rabbitmq.com
       </A><BR>
    <I>Thu Jul  1 21:23:07 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007838.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
        <LI>Next message: <A HREF="007855.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7839">[ date ]</a>
              <a href="thread.html#7839">[ thread ]</a>
              <a href="subject.html#7839">[ subject ]</a>
              <a href="author.html#7839">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

David King wrote:
&gt;&gt;<i> this sharp edge happened without your intervention?
</I>&gt;<i> 
</I>&gt;<i> Yes, that's when I last restarted rabbit. We have to take our site
</I>&gt;<i> down to do so, and that's not desirable.
</I>
If you just let it run, what happens?

&gt;<i> According to that graph I'm going to have to restart the node soon
</I>&gt;<i> anyway, so I'll try that, but if it doesn't fix a known leak that's
</I>&gt;<i> unlikely to help, right? As for Erlang, we're running R13B-4.
</I>
We have seen a few instances of peculiar interaction between the rabbit 
code and the Erlang VM when it comes to memory usage. Even minor and 
unrelated changes can alter the memory consumption pattern 
significantly. It is for that reason, and in order to make it easier for 
us to investigate the problem further, that we recommend running the 
latest release of Rabbit. As for Erlang/OTP, R13B-4 is recent enough.

&gt;&gt;<i> your specific usage patterns might not play well with
</I>&gt;&gt;<i> garbage collection. For example, we force full garbage collection
</I>&gt;&gt;<i> run when the queue is unused for more than 10 seconds. If your
</I>&gt;&gt;<i> queue is constantly pinged - you're left to Erlang default garbage
</I>&gt;&gt;<i> collection.  That works well most of the time, but sometimes it's
</I>&gt;&gt;<i> not optimal.
</I>&gt;<i> 
</I>&gt;<i> That's possible, but Erlang's default garbage collector is a
</I>&gt;<i> stop-the-world (per-process) collector, so it's shouldn't be *that*
</I>&gt;<i> dependent on load, it just just introduce pauses per-queue (which
</I>&gt;<i> would actually be fine for our use-case)
</I>
The default Erlang gc performs garbage collections after a certain 
number of reductions, and that number is so high that a queue process 
which does work infrequently may not perform a gc for a very long time 
indeed. That's particularly noticeable when the message sizes are large. 
What's the average and max message size in your set up?

&gt;<i> So to be clear, we have 13
</I>&gt;<i> queues that all sit at 0 backlog basically all of the time. Certainly
</I>&gt;<i> no queues that grow at the same rate our memory does. 
</I>
How are you measuring the queue length? With 'rabbitmqctl list_queues'?

Are any of the other items which can be listed with rabbitmqctl - 
exchanges, bindings, connections, channels, consumers - growing?

Also, have you installed any plug-ins?


Regards,

Matthias.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007838.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
	<LI>Next message: <A HREF="007855.html">[rabbitmq-discuss] Possible memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7839">[ date ]</a>
              <a href="thread.html#7839">[ thread ]</a>
              <a href="subject.html#7839">[ subject ]</a>
              <a href="author.html#7839">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
