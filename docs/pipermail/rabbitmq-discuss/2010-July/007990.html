<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%201.7.0%20close%20the%20cnx%20when%20consumer%0A%20don%27t%20ack%20deliveries%20during%2030s&In-Reply-To=%3C4C3F2493.1080003%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007989.html">
   <LINK REL="Next"  HREF="008000.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%201.7.0%20close%20the%20cnx%20when%20consumer%0A%20don%27t%20ack%20deliveries%20during%2030s&In-Reply-To=%3C4C3F2493.1080003%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s">simon at rabbitmq.com
       </A><BR>
    <I>Thu Jul 15 16:09:07 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007989.html">[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
</A></li>
        <LI>Next message: <A HREF="008000.html">[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7990">[ date ]</a>
              <a href="thread.html#7990">[ thread ]</a>
              <a href="subject.html#7990">[ subject ]</a>
              <a href="author.html#7990">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/07/10 15:35, Vincent Barat wrote:
&gt;<i> I got my fix: here is what I do:
</I>&gt;<i>
</I>&gt;<i> 1- I use basicQos() to be sure that the server will not send &quot;too many&quot;
</I>&gt;<i> messages (actually, I have checked that basicQos() does not offers a
</I>&gt;<i> guarantee on the number of un-acknoledged messages sent, since I
</I>&gt;<i> actually receive much more than the parameter I give, but it seems at
</I>&gt;<i> least to limit the amount of messages, maybe there is a bug here ?).
</I>
Hi Vincent. I don't think there's a bug in our handling of basic.qos - 
it's been around for a while and a lot of people are using it successfully.

I notice that in onNewChannel():

   @Override
   protected void onNewChannel(Channel channel) throws IOException
   {
     super.onNewChannel(channel);

     /*
      * Configure the channel to send not more than a given amount of 
unacknowledged messages. This
      * avoid at the same time to buffer too many messages (which could 
exhaust memory) and to block
      * in handleDelivery() (which could brake the connection).
      */
     channel.basicQos(capacity);
   }

You invoke channel.basicQos() after super.onNewChannel(). Does 
super.onNewChannel() invoke channel.basicConsume() by any chance? If it 
does so then the server can start sending an unlimited  number of 
messages as soon as it receives this message - it'll only start limiting 
the number it sends out after receiving basic.qos. Therefore it's 
usually better to send basic.qos before basic.consume.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007989.html">[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
</A></li>
	<LI>Next message: <A HREF="008000.html">[rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't ack deliveries during 30s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7990">[ date ]</a>
              <a href="thread.html#7990">[ thread ]</a>
              <a href="subject.html#7990">[ subject ]</a>
              <a href="author.html#7990">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
