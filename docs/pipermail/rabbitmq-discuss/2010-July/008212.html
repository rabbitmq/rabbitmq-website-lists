<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] versioned routing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20versioned%20routing&In-Reply-To=%3CAANLkTinsfhczf1oD6RWJLwX9YqSLz9jKAG0%2BXMQ_7Akw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008211.html">
   <LINK REL="Next"  HREF="008214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] versioned routing</H1>
    <B>Aaron Westendorf</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20versioned%20routing&In-Reply-To=%3CAANLkTinsfhczf1oD6RWJLwX9YqSLz9jKAG0%2BXMQ_7Akw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] versioned routing">aaron at agoragames.com
       </A><BR>
    <I>Thu Jul 29 20:23:42 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008211.html">[rabbitmq-discuss] versioned routing
</A></li>
        <LI>Next message: <A HREF="008214.html">[rabbitmq-discuss] versioned routing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8212">[ date ]</a>
              <a href="thread.html#8212">[ thread ]</a>
              <a href="subject.html#8212">[ subject ]</a>
              <a href="author.html#8212">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Santi,

We have a similar requirement, and it seems you have most of the
pieces in place to implement a similar solution.

Topic exchanges will round robbin between consumers so no need to
worry there.  Seeing as you have the version already stored in your
session, you can continue to maintain both old and new sessions so
long as consumers and bindings remain in place for both.

So you have a hypervisor that can maintain consumers for all your
deployed versions.  In your case, LoginService might consume from the
queue &quot;ls.1_0_0&quot; which is bound to your publishing exchange with a
routing key of the same name.  Your new version would run alongside
using queue name and binding &quot;ls.1_0_1&quot;.  If a user does not have a
session yet, then something in front of AMQP will have to determine
based on URL, host, whitelist, etc which routing key to use.

I would caution against using dotted version notation in your routing
key, mostly to keep sane as your routing scheme expands in complexity
and you have numerous bindings.

Hope that helps.

-Aaron


On Thu, Jul 29, 2010 at 1:38 PM, Santi Manninen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">santikschzt at gmail.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I've been trying to figure out a way to single out service versions
</I>&gt;<i> for front end users.
</I>&gt;<i> Here is the current, simplified scenario:
</I>&gt;<i>
</I>&gt;<i> - Web users with sessions issue requests to a front end server, which
</I>&gt;<i> just routes their messages
</I>&gt;<i> - Messages are routed to queues called 'LoginService' and 'PingService'
</I>&gt;<i>
</I>&gt;<i> I have a number of LoginService and PingService instances, each bound
</I>&gt;<i> to the same queue, so messages are distributed with round-robin and I
</I>&gt;<i> can add/remove them based on demand. Wonderful.
</I>&gt;<i>
</I>&gt;<i> PingService currently runs 1.0. Now, I'd like to add a completely new
</I>&gt;<i> version of PingService, 1.0.1, with spiffy new features, and have
</I>&gt;<i> 'selected users' (through Sessions given from LoginService) use the
</I>&gt;<i> new version and try it out, so I can monitor and test that the new
</I>&gt;<i> version of PingService works correctly before moving more, or all
</I>&gt;<i> users into the new version, and deploying 1.0.1 onto more servers.
</I>&gt;<i>
</I>&gt;<i> We talked about doing this with |Blaze|| on the IRC channel (thanks!)
</I>&gt;<i> but we didn't really come up with an elegant solution yet.
</I>&gt;<i>
</I>&gt;<i> - Bind the PingService queues with the version name in the queue name,
</I>&gt;<i> and have the front end route messages to PingService, based on the
</I>&gt;<i> version defined in the Session. Many problems with this. Old users
</I>&gt;<i> with active sessions bound to the previous version (which was just
</I>&gt;<i> built 15 minutes ago, perhaps!) will lose service once the new version
</I>&gt;<i> is completely rolled out, and a failover from basicReturn in the
</I>&gt;<i> client would have to be implemented.
</I>&gt;<i> - Use topic exchanges for each version, eg. 1.0.1.topic, and a
</I>&gt;<i> catch-all with *.topic. I think round-robin is lost here?
</I>&gt;<i>
</I>&gt;<i> That's the gist of it. Your help is appreciated. Thanks!
</I>&gt;<i>
</I>&gt;<i> Santi
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aaron at agoragames.com</A>
www.agoragames.com
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008211.html">[rabbitmq-discuss] versioned routing
</A></li>
	<LI>Next message: <A HREF="008214.html">[rabbitmq-discuss] versioned routing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8212">[ date ]</a>
              <a href="thread.html#8212">[ thread ]</a>
              <a href="subject.html#8212">[ subject ]</a>
              <a href="author.html#8212">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
