<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] interoperability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20interoperability&In-Reply-To=a21e8c210801110721p331ba3d1jf3da6970206da9f1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000423.html">
   <LINK REL="Next"  HREF="000429.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] interoperability</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20interoperability&In-Reply-To=a21e8c210801110721p331ba3d1jf3da6970206da9f1%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] interoperability">alexis.richardson at cohesiveft.com
       </A><BR>
    <I>Fri Jan 11 15:29:11 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000423.html">[rabbitmq-discuss] Administering Rabbit exchanges and queues
</A></li>
        <LI>Next message: <A HREF="000429.html">[rabbitmq-discuss] Administering Rabbit exchanges and queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#428">[ date ]</a>
              <a href="thread.html#428">[ thread ]</a>
              <a href="subject.html#428">[ subject ]</a>
              <a href="author.html#428">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rupert

On Jan 11, 2008 3:21 PM, Rupert Smith &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rupertlssmith at googlemail.com</A>&gt; wrote:
&gt;<i> Thanks Alexis,
</I>&gt;<i>
</I>&gt;<i> The numbers now make sense to me with all the details.
</I>
No worries, happy to help.


&gt;<i> One thing I am curious about... How well did RabbitMQ scale across the 16
</I>&gt;<i> cores? In theory Erlang HIPE scheduler should scale well (and at no extra
</I>&gt;<i> effort to the programmer too) did it live up to it?
</I>
It seems to scale pretty well and certainly without any effort on our parts.

&gt;<i>From my fading memory, we did about 45k AMQP messages (300 byte/msg),
</I>per second per core for the first couple of cores then the rate drops
a little adding 30k per core thereafter.  But one month later we ran
the tests on faster cores which got better numbers and scaled a bit
better.

Bear in mind that this was only a first round of testing with Intel.
We had done similar testing on our own back in June.  In both cases we
did not have quite enough time to do everything we wanted to.  Perhaps
this is the way of all tests.

In other words - YMMV.

alexis



&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 11/01/2008, Alexis Richardson &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at cohesiveft.com</A>&gt; wrote:
</I>&gt;<i> &gt; Hello Qpid folks,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've noticed some traffic recently on interoperability and testing,
</I>&gt;<i> &gt; and relatedly on performance.  There appears to be a lot of confusion
</I>&gt;<i> &gt; on this point.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1.  We very much want to see seamless interoperabilty for all brokers
</I>&gt;<i> &gt; of any given spec.  This is good for AMQP.
</I>&gt;<i> &gt; 2.  This should include all Python tests if possible, unless clearly
</I>&gt;<i> &gt; marked otherwise for a good reason.
</I>&gt;<i> &gt; 3.  People will then be able to make like for like performance
</I>&gt;<i> &gt; comparisons, because tests will work with any broker on 'swap in and
</I>&gt;<i> &gt; out' basis.  This is also good for AMQP.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On this last point (3) it is worth noting that writing
</I>&gt;<i> &gt; business-relevant tests is hard.  It's one thing to pipe millions of
</I>&gt;<i> &gt; one byte messages through a socket, and another to implement a real
</I>&gt;<i> &gt; use case.  We reported an OPRA case in December which has the merit of
</I>&gt;<i> &gt; being 'real world'.  Make of this what you will.  The case was written
</I>&gt;<i> &gt; up by Intel in a press release - they did the tests - you can see the
</I>&gt;<i> &gt; link below.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Also included below are the full details of what these numbers mean,
</I>&gt;<i> &gt; as posted to the RabbitMQ mailing list verbatim.  Feel free to read
</I>&gt;<i> &gt; and comment here or on the RabbitMQ list.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Make no mistake, brokers (like CPU) will get faster and faster
</I>&gt;<i> &gt; especially once this stuff is implemented in hardware.  For software
</I>&gt;<i> &gt; that is well written and can scale, the limiting factor is how many
</I>&gt;<i> &gt; messages you can process per core.  Provided AMQP implementations
</I>&gt;<i> &gt; interoperate to the standard, the only thing that customers will need
</I>&gt;<i> &gt; to do is to pick and choose which implementation suits their use case
</I>&gt;<i> &gt; the best, e.g. for reliability, scalability, ease of use, or raw
</I>&gt;<i> &gt; speed.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Best wishes
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; alexis
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; RabbitMQ
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---------- Forwarded message ----------
</I>&gt;<i> &gt; From: Alexis Richardson &lt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at cohesiveft.com</A>&gt;
</I>&gt;<i> &gt; Date: Dec 1, 2007 10:26 AM
</I>&gt;<i> &gt; Subject: rabbitmq performance
</I>&gt;<i> &gt; To: RabbitMQ Discuss &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi everyone,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Recently we did some load testing of RabbitMQ, working with Intel.
</I>&gt;<i> &gt; Their press release is reported here:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; <A HREF="http://www.intelfasterfs.com/trading/articles/071128-intellowlatency.aspx">http://www.intelfasterfs.com/trading/articles/071128-intellowlatency.aspx</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The use case was a simulated OPRA data feed using combination of:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - Pantor FAST client (essentially a codec) combined with an AMQP
</I>&gt;<i> &gt; client written in C (yes we are hoping to get this into the community)
</I>&gt;<i> &gt; - RabbitMQ AMQP broker version 1.2 on the server
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Please don't read too much into the latency numbers here: the timed
</I>&gt;<i> &gt; path included two network hops as well as message processing at the
</I>&gt;<i> &gt; broker; also, somewhat annoyingly, the numbers are averaged over
</I>&gt;<i> &gt; multiple scenarios.  We wanted to look at throughput because OPRA
</I>&gt;<i> &gt; feeds are heading to 1 million ticks per second and it's a good load
</I>&gt;<i> &gt; testing case.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We shall publish more info soon but the numbers are as follows:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. Ingress of about 1.3 million OPRA messages per second
</I>&gt;<i> &gt; 2. Replicated out to four clients at once (unicast pub/sub not multicast)
</I>&gt;<i> &gt; 3. So simultaneously, egress of about 5 million OPRA messages per second
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The broker cluster was on one multicore box with 16 cores.  The network
</I>&gt;<i> &gt; was a full TCP/IP stack, and a standard 1GigE network (= the bottleneck).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The set up was:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1 Client Box --&gt; 1 Server Box --&gt; 1 Client Box
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We used Intel's 16 core Caneland box for the server and the FAST/AMQP
</I>&gt;<i> &gt; client was delivered by Pantor, working with us.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; How come the numbers are so high?  Well, one reason is that we used
</I>&gt;<i> &gt; FAST, which is a codec.  Each OPRA message was FAST-compressed
</I>&gt;<i> &gt; and batched into a block or 'datagram' of 16 compressed OPRA messages.
</I>&gt;<i> &gt; This is gradually becoming normal practice in the world of market data
</I>&gt;<i> &gt; feeds because the loads are high and people do not have enough
</I>&gt;<i> &gt; bandwidth to cope.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So in our test, each datagram contained 16 OPRA messages, and was
</I>&gt;<i> &gt; sent as one 256 byte AMQP message.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So the throughput can also be seen as:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. Ingress of 80,000 AMQP messages per second (256b per message)
</I>&gt;<i> &gt; 2. Replicated out to four clients at once (unicast pub/sub)
</I>&gt;<i> &gt; 3. So simultaneously, egress of 320,000 AMQP messages per second (256b
</I>&gt;<i> &gt; per message)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I.e the real load is about 400,000 mps.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; There are several ways to get these numbers higher:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - tune RabbitMQ for speed
</I>&gt;<i> &gt; - use multicast
</I>&gt;<i> &gt; - use Infiniband
</I>&gt;<i> &gt; - use faster cores
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We just did some more tests using Intel's 45nm cores which look
</I>&gt;<i> &gt; promising in this regard.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The point is: for most use cases you can get good performance using
</I>&gt;<i> &gt; COTS hardware.  This means you can spend your valuable project
</I>&gt;<i> &gt; investment dollars on making the user experience better instead of
</I>&gt;<i> &gt; messing about with deep tech.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We think scalability, stability and ease of use are more important than
</I>&gt;<i> &gt; raw speed.  If you try to run RabbitMQ and do not see what you
</I>&gt;<i> &gt; expect along any of these metrics, please let us know and we'll help you.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; alexis
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Alexis Richardson
</I>&gt;<i> &gt; +44 20 7617 7339 (UK)
</I>&gt;<i> &gt; +44 77 9865 2911 (cell)
</I>&gt;<i> &gt; +1 650 206 2517 (US)
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000423.html">[rabbitmq-discuss] Administering Rabbit exchanges and queues
</A></li>
	<LI>Next message: <A HREF="000429.html">[rabbitmq-discuss] Administering Rabbit exchanges and queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#428">[ date ]</a>
              <a href="thread.html#428">[ thread ]</a>
              <a href="subject.html#428">[ subject ]</a>
              <a href="author.html#428">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
