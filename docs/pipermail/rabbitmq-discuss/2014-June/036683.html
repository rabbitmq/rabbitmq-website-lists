<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] TypeError: Cannot read property 'ram_msg_count'	of undefined
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20TypeError%3A%20Cannot%20read%20property%20%27ram_msg_count%27%0A%09of%20undefined&In-Reply-To=%3C6DA47758DD70A84CAB1C2A6629FEC4D387927DA0%40sho-p-excmbx-02.sentry.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036686.html">
   <LINK REL="Next"  HREF="036699.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] TypeError: Cannot read property 'ram_msg_count'	of undefined</H1>
    <B>Miller Andrew</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20TypeError%3A%20Cannot%20read%20property%20%27ram_msg_count%27%0A%09of%20undefined&In-Reply-To=%3C6DA47758DD70A84CAB1C2A6629FEC4D387927DA0%40sho-p-excmbx-02.sentry.com%3E"
       TITLE="[rabbitmq-discuss] TypeError: Cannot read property 'ram_msg_count'	of undefined">Andrew.Miller at sentry.com
       </A><BR>
    <I>Tue Jun 17 22:01:34 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036686.html">[rabbitmq-discuss] Question about Scheduled Message Delivery
</A></li>
        <LI>Next message: <A HREF="036699.html">[rabbitmq-discuss] TypeError: Cannot read property 'ram_msg_count' of undefined
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36683">[ date ]</a>
              <a href="thread.html#36683">[ thread ]</a>
              <a href="subject.html#36683">[ subject ]</a>
              <a href="author.html#36683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

We have a two-node RabbitMQ cluster running on RabbitMQ 3.2.2, Erlang R16B03-1 on Windows servers.  We've had multiple issues over the past few days:
Sunday, 6/15/2014 - Network partition because of some planned network upgrade; restarted both nodes in sequence
Monday, 6/16/2014 - Rouge client created 5000+ concurrent connections to Rabbit; restarted both nodes in sequence and eventually tracked down and killed client

This question is primarily about the problem that occurred on Monday.  After the first node was restarted, the following messages were logged:

=INFO REPORT==== 16-Jun-2014::17:00:47 ===
Starting RabbitMQ 3.2.2 on Erlang R16B03-1
Copyright (C) 2007-2013 GoPivotal, Inc.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

...

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
Discarding message {'$gen_call',{&lt;0.254.0&gt;,#Ref&lt;0.0.0.1304&gt;},{add_on_right,{56,&lt;0.254.0&gt;}}} from &lt;0.254.0&gt; to &lt;0.16165.62&gt; in an old incarnation (1) of this node (2)

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
Discarding message {'$gen_call',{&lt;0.256.0&gt;,#Ref&lt;0.0.0.1311&gt;},{add_on_right,{56,&lt;0.256.0&gt;}}} from &lt;0.256.0&gt; to &lt;0.16138.62&gt; in an old incarnation (1) of this node (2)

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
Discarding message {'$gen_call',{&lt;0.258.0&gt;,#Ref&lt;0.0.0.1511&gt;},{add_on_right,{56,&lt;0.258.0&gt;}}} from &lt;0.258.0&gt; to &lt;0.16190.62&gt; in an old incarnation (1) of this node (2)

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
Discarding message {'$gen_call',{&lt;0.260.0&gt;,#Ref&lt;0.0.0.1536&gt;},{add_on_right,{29,&lt;0.260.0&gt;}}} from &lt;0.260.0&gt; to &lt;0.16200.62&gt; in an old incarnation (1) of this node (2)

=INFO REPORT==== 16-Jun-2014::17:00:49 ===
Adding mirror of queue 'SalesCenter.BPBilling_AccountDelinquent' in vhost 'eventing' on node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at SHO-P-EVGAPP-02</A>': &lt;5578.16037.65&gt;

=ERROR REPORT==== 16-Jun-2014::17:00:49 ===
** Generic server &lt;0.250.0&gt; terminating
** Last message in was {init,&lt;0.185.0&gt;}
** When Server state == {q,{amqqueue,
                               {resource,&lt;&lt;&quot;eventing&quot;&gt;&gt;,queue,
                                   &lt;&lt;&quot;SalesCenter.AMS_ErrorsAndOmissions30DayExpiration&quot;&gt;&gt;},
                               true,false,none,
                               [{&lt;&lt;&quot;x-dead-letter-exchange&quot;&gt;&gt;,longstr,
                                 &lt;&lt;&quot;EnterpriseEventDeadLetter&quot;&gt;&gt;},
                                {&lt;&lt;&quot;x-dead-letter-routing-key&quot;&gt;&gt;,longstr,
                                 &lt;&lt;&quot;SalesCenter.AMS_ErrorsAndOmissions30DayExpiration&quot;&gt;&gt;}],
                               &lt;0.250.0&gt;,[],[],
                               [{vhost,&lt;&lt;&quot;eventing&quot;&gt;&gt;},
                                {name,&lt;&lt;&quot;ha-all&quot;&gt;&gt;},
                                {pattern,&lt;&lt;&quot;^.*&quot;&gt;&gt;},
                                {'apply-to',&lt;&lt;&quot;queues&quot;&gt;&gt;},
                                {definition,
                                    [{&lt;&lt;&quot;ha-mode&quot;&gt;&gt;,&lt;&lt;&quot;all&quot;&gt;&gt;},
                                     {&lt;&lt;&quot;ha-sync-mode&quot;&gt;&gt;,&lt;&lt;&quot;automatic&quot;&gt;&gt;}]},
                                {priority,0}],
                               [],[]},
                           none,false,undefined,undefined,
                           {queue,[],[],0},
                           undefined,undefined,undefined,undefined,
                           {state,fine,5000,undefined},
                           {0,nil},
                           undefined,undefined,undefined,
                           {state,
                               {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                               delegate},
                           undefined,undefined,undefined,0,running}
** Reason for termination ==
** {{function_clause,
        [{rabbit_mirror_queue_slave,terminate,
             [{{badmatch,true},
               [{rabbit_queue_index,init,2,[]},
                {rabbit_variable_queue,init,5,[]},
                {rabbit_mirror_queue_slave,handle_go,1,[]},
                {rabbit_mirror_queue_slave,handle_call,3,[]},
                {gen_server2,handle_msg,2,[]},
                {proc_lib,init_p_do_apply,3,
                    [{file,&quot;proc_lib.erl&quot;},{line,239}]}]},
              {not_started,
                  {amqqueue,
                      {resource,&lt;&lt;&quot;eventing&quot;&gt;&gt;,queue,
                          &lt;&lt;&quot;SalesCenter.AMS_ErrorsAndOmissions30DayExpiration&quot;&gt;&gt;},
                      true,false,none,
                      [{&lt;&lt;&quot;x-dead-letter-exchange&quot;&gt;&gt;,longstr,
                        &lt;&lt;&quot;EnterpriseEventDeadLetter&quot;&gt;&gt;},
                       {&lt;&lt;&quot;x-dead-letter-routing-key&quot;&gt;&gt;,longstr,
                        &lt;&lt;&quot;SalesCenter.AMS_ErrorsAndOmissions30DayExpiration&quot;&gt;&gt;}],
                      &lt;0.250.0&gt;,[],[],
                      [{vhost,&lt;&lt;&quot;eventing&quot;&gt;&gt;},
                       {name,&lt;&lt;&quot;ha-all&quot;&gt;&gt;},
                       {pattern,&lt;&lt;&quot;^.*&quot;&gt;&gt;},
                       {'apply-to',&lt;&lt;&quot;queues&quot;&gt;&gt;},
                       {definition,
                           [{&lt;&lt;&quot;ha-mode&quot;&gt;&gt;,&lt;&lt;&quot;all&quot;&gt;&gt;},
                            {&lt;&lt;&quot;ha-sync-mode&quot;&gt;&gt;,&lt;&lt;&quot;automatic&quot;&gt;&gt;}]},
                       {priority,0}],
                      [{&lt;0.256.0&gt;,&lt;0.250.0&gt;}],
                      []}}],
             []},
        {gen_server2,terminate,3,[]},
         {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]},
    {gen_server2,call,[&lt;5578.15838.65&gt;,go,infinity]}}

After this, when going to the queue page (/#/queues/eventing/SalesCenter.AMS_ErrorsAndOmissions30DayExpiration) in the management console, I get TypeError: Cannot read property 'ram_msg_count' of undefined.  On the list of queues, this queue is listed as &quot;Active&quot; (most queues are listed as &quot;Idle&quot;) and the Read/Unacked/Total messages for this queue shows question marks. The only way we were able to resolve was to stop the cluster entirely and start it back up.

Any thoughts on what went wrong, or how to avoid it in the future?

Thanks,
Andrew Miller

This e-mail is confidential.  If you are not the intended recipient, you must not disclose or use the information contained in it. If you have received this e-mail in error, please tell us immediately by return e-mail and delete the document. No recipient may use the information in this e-mail in violation of any civil or criminal statute. Sentry disclaims all liability for any unauthorized uses of this e-mail or its contents. Sentry accepts no liability or responsibility for any damage caused by any virus transmitted with this e-mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/b18e501e/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140617/b18e501e/attachment.html</A>&gt;
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036686.html">[rabbitmq-discuss] Question about Scheduled Message Delivery
</A></li>
	<LI>Next message: <A HREF="036699.html">[rabbitmq-discuss] TypeError: Cannot read property 'ram_msg_count' of undefined
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36683">[ date ]</a>
              <a href="thread.html#36683">[ thread ]</a>
              <a href="subject.html#36683">[ subject ]</a>
              <a href="author.html#36683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
