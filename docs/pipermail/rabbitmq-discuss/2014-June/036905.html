<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] TTL on Consumers in PHP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20TTL%20on%20Consumers%20in%20PHP&In-Reply-To=%3CCAMcAHLWH4On4YWL9cWAMD3veQ-RCcLuJHrbjoj8b%3DnZVRNGvUw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036901.html">
   <LINK REL="Next"  HREF="036881.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] TTL on Consumers in PHP</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20TTL%20on%20Consumers%20in%20PHP&In-Reply-To=%3CCAMcAHLWH4On4YWL9cWAMD3veQ-RCcLuJHrbjoj8b%3DnZVRNGvUw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] TTL on Consumers in PHP">videlalvaro at gmail.com
       </A><BR>
    <I>Wed Jun 25 15:52:46 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036901.html">[rabbitmq-discuss] TTL on Consumers in PHP
</A></li>
        <LI>Next message: <A HREF="036881.html">[rabbitmq-discuss] Debugging problems with federation plug in.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36905">[ date ]</a>
              <a href="thread.html#36905">[ thread ]</a>
              <a href="subject.html#36905">[ subject ]</a>
              <a href="author.html#36905">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sean,

As you probably know, the code in the php library is blocking, so unless an
external event comes, there's no way to escape form the while loop that's
reading from the channel. The wait method supports a timeout tho.

Regards,

Alvaro




On Wed, Jun 25, 2014 at 3:16 PM, Sean Joyce &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sean.joyce at patientco.com</A>&gt;
wrote:

&gt;<i> Michael -
</I>&gt;<i>
</I>&gt;<i> Apologies for asking you to be pedantic, but I'm still a little hazy on
</I>&gt;<i> how I would implement my desired behavior.
</I>&gt;<i>
</I>&gt;<i> I actually have the 'quit' functionality embedded in my callback, though I
</I>&gt;<i> stripped it out for my example for simplicity. With or without though, when
</I>&gt;<i> I run my consumer, my code hits the '$this-&gt;channel-&gt;wait();' line and
</I>&gt;<i> doesn't exit until an external event (new message) enters the queue. My
</I>&gt;<i> preference is that a Consumer itself knows when it has sat idle long enough
</I>&gt;<i> to terminate itself rather than having an external process monitor it.
</I>&gt;<i>
</I>&gt;<i> Should this be done by subclassing AMQPChannel? Like I said, I'm still a
</I>&gt;<i> little hazy.
</I>&gt;<i>
</I>&gt;<i> -Sean
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Jun 24, 2014 at 11:31 PM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On 25 June 2014 at 00:43:15, Sean Joyce (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sean.joyce at patientco.com</A>) wrote:
</I>&gt;&gt;<i> &gt; &gt; I've been trying to figure out where to call basic_cancel in
</I>&gt;&gt;<i> &gt; this code, but not finding the right solution. Any tips on how
</I>&gt;&gt;<i> &gt; to refactor and get what I want?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; public function consume() {
</I>&gt;&gt;<i> &gt; $callback = function($msg) {
</I>&gt;&gt;<i> &gt; $pMsg = new ProcessorMessage();
</I>&gt;&gt;<i> &gt; $pMsg-&gt;onMessage($msg-&gt;body);
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> $msg-&gt;delivery_info['channel']-&gt;basic_ack($msg-&gt;delivery_info['delivery_tag']);
</I>&gt;&gt;<i> &gt; };
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; $this-&gt;channel-&gt;basic_qos(null, 1, null);
</I>&gt;&gt;<i> &gt; $this-&gt;channel-&gt;basic_consume($queue_name, '', false,
</I>&gt;&gt;<i> &gt; false, false, false, $callback);
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; while(count($this-&gt;channel-&gt;callbacks)) {
</I>&gt;&gt;<i> &gt; $this-&gt;channel-&gt;wait();
</I>&gt;&gt;<i> &gt; }
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sean,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Take a look at the following 2 examples:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer_non_blocking.php">https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer_non_blocking.php</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php#L52-54">https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php#L52-54</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> MK
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Staff Software Engineer, Pivotal/RabbitMQ
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> *Sean M. Joyce*
</I>&gt;<i> Director of Product Engineering | Patientco
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sean.joyce at patientco.com</A>
</I>&gt;<i> 888.747.2455 x412
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;<A HREF="http://info.patientco.com/himss">http://info.patientco.com/himss</A>&gt;
</I>&gt;<i> &lt;<A HREF="http://info.patientco.com/happy-providers">http://info.patientco.com/happy-providers</A>&gt;
</I>&gt;<i>
</I>&gt;<i> As a friendly reminder, never send Protected Health Information (PHI) via
</I>&gt;<i> email.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> CONFIDENTIALITY NOTICE:  The information contained in this email message
</I>&gt;<i> may be privileged, confidential, and protected from disclosure.
</I>&gt;<i> Any unauthorized use, printing, copying, disclosure, dissemination of or
</I>&gt;<i> reliance upon this communication by persons other than the intended
</I>&gt;<i> recipient may be subject to legal restriction or sanction. If you are not
</I>&gt;<i> the intended recipient, you are hereby notified that you are not authorized
</I>&gt;<i> to read, print, retain, copy, or disseminate this message, any part of it,
</I>&gt;<i> or any attachments.  If you think that you have received this email
</I>&gt;<i> message in error, please reply to the sender and delete this email and
</I>&gt;<i> any attachments and all copies thereof from your system without reading the
</I>&gt;<i> content and destroy any printouts of the e-mail or attachments promptly.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/c122ee5e/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140625/c122ee5e/attachment.html</A>&gt;
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036901.html">[rabbitmq-discuss] TTL on Consumers in PHP
</A></li>
	<LI>Next message: <A HREF="036881.html">[rabbitmq-discuss] Debugging problems with federation plug in.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36905">[ date ]</a>
              <a href="thread.html#36905">[ thread ]</a>
              <a href="subject.html#36905">[ subject ]</a>
              <a href="author.html#36905">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
