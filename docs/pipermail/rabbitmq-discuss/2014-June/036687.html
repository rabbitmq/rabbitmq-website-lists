<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] web-stomp SSL config causing SASL crash?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20web-stomp%20SSL%20config%20causing%20SASL%20crash%3F&In-Reply-To=%3Cloom.20140618T023106-104%40post.gmane.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036699.html">
   <LINK REL="Next"  HREF="036689.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] web-stomp SSL config causing SASL crash?</H1>
    <B>kz</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20web-stomp%20SSL%20config%20causing%20SASL%20crash%3F&In-Reply-To=%3Cloom.20140618T023106-104%40post.gmane.org%3E"
       TITLE="[rabbitmq-discuss] web-stomp SSL config causing SASL crash?">kirk at stork.name
       </A><BR>
    <I>Wed Jun 18 01:51:40 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036699.html">[rabbitmq-discuss] TypeError: Cannot read property 'ram_msg_count' of undefined
</A></li>
        <LI>Next message: <A HREF="036689.html">[rabbitmq-discuss] web-stomp SSL config causing SASL crash?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36687">[ date ]</a>
              <a href="thread.html#36687">[ thread ]</a>
              <a href="subject.html#36687">[ subject ]</a>
              <a href="author.html#36687">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So I've followed the instructions for setting up SSL listener for web-stomp.

eg:

[
{rabbit, [{loopback_users, []}]},
{rabbitmq_web_stomp, [
  {ssl_config, [
    {port, 15671},
    {backlog, 1024},
    {cacertfile, &quot;/etc/rabbitmq/certs/cacerts.pem&quot;},
    {certfile, &quot;/etc/rabbitmq/certs/server.pem&quot;},
    {keyfile, &quot;/etc/rabbitmq/certs/serverkey.pem&quot;},
    {password, &quot;changeme&quot;}
    ]}]}
].


This results in the log stating there's an HTTPS listener on port 15671 -- 
check.

But local requests to that port result in an openssl error 111, and remote 
requests result in an  openssl error 61.

The certificate is a wildcard cert that is issued by a commercial vendor.  I've
 installed their 
intermediate certs in the cacerts.pem mentioned above.

My key file is signed with -des and functions when testing with openssl 
s_server and s_client

(however, that test does indicate error 19 (some certificate in the chain is 
self-signed).  This is 
false, but the warning is issued nonetheless.

The only log that indicates an error has occurred is the sasl log.

eg:

=CRASH REPORT==== 18-Jun-2014::00:22:07 ===
  crasher:
    initial call: supervisor:cowboy_acceptors_sup/1
    pid: &lt;0.352.0&gt;
    registered_name: []
    exception exit: {{case_clause,{error,{not_started,asn1}}},
                     [{cowboy_ssl_transport,require,1,[]},
                      {cowboy_ssl_transport,listen,1,[]},
                      {cowboy_acceptors_sup,init,1,[]},
                      {supervisor,init,1,[{file,&quot;supervisor.erl&quot;},{line,239}]},
                      {gen_server,init_it,6,
                                  [{file,&quot;gen_server.erl&quot;},{line,304}]},
                      {proc_lib,init_p_do_apply,3,
                                [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}
      in function  gen_server:init_it/6 (gen_server.erl, line 328)
    ancestors: [&lt;0.349.0&gt;,cowboy_sup,&lt;0.57.0&gt;]
    messages: []
    links: [&lt;0.349.0&gt;]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 610
    stack_size: 27
    reductions: 169
  neighbours:
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at ip-10-221-13-201</A>:/var/log/rabbitmq#


Now, I'm not trying to challenge web requests with a certificate, and anyway 
this error shows up 
before any requests are made.

The other aspects of RabbitMQ appear to be operating normally.  AMQP 
connections  can be made, and the web interface can be reached over 
http on the normal port.  If I don't 
configure SSL for  web-stomp, then non-ssl http requests to the stomp
endpoint work as expected.

So my questions:

1. Is there ANY OTHER place in the setup that I have to configure 
certificates in addition to the  web-stomp plugin config?

2. Is the self-signed warning an indication that I need to place the ENTIRE
 certificate chain of trust 
into my cacerts file? (currently I only put the vendor's intermediate certs, 
per their instructions)

3. Can firewall rules cause this kind of startup error? (I'm running on AWS 
and I've only opened the 
ports I need for RabbitMQ and the web-related plugins for RabbitMQ.


This is ubuntu trusty 64 bit with Erlang R16B03 (erts-5.10.4) and 
 rabbitmq-server_3.3.3-1_all.deb 
package.






</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036699.html">[rabbitmq-discuss] TypeError: Cannot read property 'ram_msg_count' of undefined
</A></li>
	<LI>Next message: <A HREF="036689.html">[rabbitmq-discuss] web-stomp SSL config causing SASL crash?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36687">[ date ]</a>
              <a href="thread.html#36687">[ thread ]</a>
              <a href="subject.html#36687">[ subject ]</a>
              <a href="author.html#36687">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
