<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] SocketException when invoking	model.BasicPublish
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20SocketException%20when%20invoking%0A%09model.BasicPublish&In-Reply-To=%3CCAJGQrQBjqa0uL23qduuVR4TvGk2FbhEmt9fc%2Bsqkn%3D2C1vsRqQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036731.html">
   <LINK REL="Next"  HREF="036775.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] SocketException when invoking	model.BasicPublish</H1>
    <B>Scott McFadden</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20SocketException%20when%20invoking%0A%09model.BasicPublish&In-Reply-To=%3CCAJGQrQBjqa0uL23qduuVR4TvGk2FbhEmt9fc%2Bsqkn%3D2C1vsRqQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] SocketException when invoking	model.BasicPublish">scott.kendall.mcfadden at gmail.com
       </A><BR>
    <I>Fri Jun 20 03:39:57 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036731.html">[rabbitmq-discuss] SocketException when invoking model.BasicPublish
</A></li>
        <LI>Next message: <A HREF="036775.html">[rabbitmq-discuss] SocketException when invoking model.BasicPublish
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36774">[ date ]</a>
              <a href="thread.html#36774">[ thread ]</a>
              <a href="subject.html#36774">[ subject ]</a>
              <a href="author.html#36774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Michael, per your suggestion I put the open connection logic in the
class initializer (it only happens once right after construction).  Getting
the connection works fine.  However basic publish still encounters an
error.  However, the error is slightly different this time around.  I
invoked the java tracing proxy so you can see the wire data.

Client side error when invoking basic publish:

System.ArgumentNullException: String reference not set to an instance of a
String.
Parameter name: s
   at System.Text.Encoding.GetBytes(String s)
   at RabbitMQ.Client.Impl.WireFormatting.WriteShortstr(NetworkBinaryWriter
writer, String val)
   at RabbitMQ.Client.Impl.ContentHeaderPropertyWriter.WriteShortstr(String
val)
   at
RabbitMQ.Client.Framing.v0_9_1.BasicProperties.WritePropertiesTo(ContentHeaderPropertyWriter
writer)
   at RabbitMQ.Client.Impl.ContentHeaderBase.WriteTo(NetworkBinaryWriter
writer, UInt64 bodySize)
   at RabbitMQ.Client.Impl.Command.Transmit(Int32 channelNumber,
ConnectionBase connection)
   at RabbitMQ.Client.Impl.SessionBase.Transmit(Command cmd)
   at RabbitMQ.Client.Impl.ModelBase.ModelSend(MethodBase method,
ContentHeaderBase header, Byte[] body)
   at
RabbitMQ.Client.Framing.Impl.v0_9_1.Model._Private_BasicPublish(String
exchange, String routingKey, Boolean mandatory, Boolean immediate,
IBasicProperties basicProperties, Byte[] body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, Boolean mandatory, Boolean immediate, IBasicProperties
basicProperties, Byte[] body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, Boolean mandatory, IBasicProperties basicProperties, Byte[]
body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, IBasicProperties basicProperties, Byte[] body)


Tracer output:

Usage: Tracer [&lt;listenport&gt; [&lt;connecthost&gt; [&lt;connectport&gt;]]]
   Serially traces connections on the &lt;listenport&gt;, logging
   frames received and passing them to the connect host and port.
Invoked as: Tracer 5672 devtest01 5672
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
com.rabbitmq.tools.Tracer.SUPPRESS_COMMAND_BODIES = false
1403231368956: &lt;Tracer-0&gt; ch#0 &lt;-
{#method&lt;connection.start&gt;(version-major=0, v
rsion-minor=9, server-properties={product=RabbitMQ,
cluster_name=<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at DEVTEST</A>
1.criticaltech.com, information=Licensed under the MPL.  See
<A HREF="http://www.rabbitm">http://www.rabbitm</A>
.com/, platform=Erlang/OTP, capabilities={exchange_exchange_bindings=true,
auth
ntication_failure_close=true, consumer_priorities=true,
consumer_cancel_notify=
rue, basic.nack=true, publisher_confirms=true, connection.blocked=true},
copyri
ht=Copyright (C) 2007-2013 GoPivotal, Inc., version=3.3.0},
mechanisms=AMQPLAIN
PLAIN, locales=en_US), null, &quot;&quot;}
1403231368956: &lt;Tracer-0&gt; ch#0 -&gt;
{#method&lt;connection.start-ok&gt;(client-properti
s={product=RabbitMQ, platform=.NET, information=Licensed under the MPL.
 See ht
<A HREF="p://www.rabbitmq.com/,">p://www.rabbitmq.com/,</A> copyright=Copyright (C) 2007-2013 GoPivotal, Inc.,
capab
lities={exchange_exchange_bindings=true, authentication_failure_close=true,
con
umer_cancel_notify=true, basic.nack=true, publisher_confirms=true,
connection.b
ocked=true}, version=3.3.0.0}, mechanism=PLAIN, response= logmanager
rfc1945, l
cale=en_US), null, &quot;&quot;}
1403231369155: &lt;Tracer-0&gt; ch#0 &lt;- {#method&lt;connection.tune&gt;(channel-max=0,
fram
-max=131072, heartbeat=580), null, &quot;&quot;}
1403231369159: &lt;Tracer-0&gt; ch#0 -&gt;
{#method&lt;connection.tune-ok&gt;(channel-max=0, f
ame-max=131072, heartbeat=580), null, &quot;&quot;}
1403231369161: &lt;Tracer-0&gt; ch#0 -&gt; {#method&lt;connection.open&gt;(virtual-host=/,
cap
bilities=, insist=false), null, &quot;&quot;}
1403231369374: &lt;Tracer-0&gt; ch#0 &lt;-
{#method&lt;connection.open-ok&gt;(known-hosts=), n
ll, &quot;&quot;}
1403231383444: &lt;Tracer-0&gt; ch#1 -&gt; {#method&lt;channel.open&gt;(out-of-band=),
null, &quot;
}
1403231383668: &lt;Tracer-0&gt; ch#1 &lt;- {#method&lt;channel.open-ok&gt;(channel-id=),
null,
&quot;&quot;}
Exception in thread &quot;Thread-2&quot; com.rabbitmq.client.UnexpectedFrameError:
Receiv
d frame: Frame(type=1, channel=1, 18 bytes of payload), expected type
2Stopped.

        at
com.rabbitmq.client.impl.CommandAssembler.consumeHeaderFrame(Command
ssembler.java:106)
        at
com.rabbitmq.client.impl.CommandAssembler.handleFrame(CommandAssembl
r.java:159)
        at
com.rabbitmq.client.impl.AMQCommand.handleFrame(AMQCommand.java:87)
        at
com.rabbitmq.tools.Tracer$DirectionHandler.doFrame(Tracer.java:331)
        at com.rabbitmq.tools.Tracer$DirectionHandler.run(Tracer.java:343)
        at java.lang.Thread.run(Unknown Source)


Server output

=INFO REPORT==== 19-Jun-2014::21:29:29 ===
accepting AMQP connection &lt;0.646.0&gt; (172.17.9.14:57049 -&gt; 172.17.9.24:5672)

=ERROR REPORT==== 19-Jun-2014::21:29:47 ===
AMQP connection &lt;0.646.0&gt; (running), channel 1 - error:
{amqp_error,unexpected_frame,
            &quot;expected content header for class 60, got non content header
frame instead&quot;,
            'basic.publish'}

=INFO REPORT==== 19-Jun-2014::21:29:47 ===
closing AMQP connection &lt;0.646.0&gt; (172.17.9.14:57049 -&gt; 172.17.9.24:5672)


This client code use to work before we had to restore an old VM snapshot of
the RabitMQ server.  We had to re-install / re-configure our RabbitMQ on
the vm image.  Not sure what I have done to foul it up.

Please advise.


thanks

Scott McFadden




On Wed, Jun 18, 2014 at 10:05 PM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;
wrote:

&gt;<i>  On 19 June 2014 at 07:02:17, Scott McFadden (
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.kendall.mcfadden at gmail.com</A>) wrote:
</I>&gt;<i> &gt; &gt; It makes me think I screwed up the server side configuration
</I>&gt;<i> &gt; when reinstalling.
</I>&gt;<i>
</I>&gt;<i> There is no configuration that can affect framing/frame interleaving in
</I>&gt;<i> the client.
</I>&gt;<i> This is also the kind of issues that we'd see reported constantly if it
</I>&gt;<i> was a client
</I>&gt;<i> issue. Finally, it happens on a brand new connection.
</I>&gt;<i>
</I>&gt;<i> I'd recommend doing two things:
</I>&gt;<i>
</I>&gt;<i>  * Running a tracer proxy in front of RabbitMQ [1] to see what's being
</I>&gt;<i> sent on the wire
</I>&gt;<i>  * Open a connection on app start if you can instead of opening a new one
</I>&gt;<i> per channel
</I>&gt;<i>
</I>&gt;<i> If the latter does not change anything, please post the output of the
</I>&gt;<i> tracer.
</I>&gt;<i>
</I>&gt;<i> 1. <A HREF="http://www.rabbitmq.com/java-tools.html,">http://www.rabbitmq.com/java-tools.html,</A> see Tracer
</I>&gt;<i> --
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> Software Engineer, Pivotal/RabbitMQ
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/b927aeec/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140619/b927aeec/attachment.html</A>&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036731.html">[rabbitmq-discuss] SocketException when invoking model.BasicPublish
</A></li>
	<LI>Next message: <A HREF="036775.html">[rabbitmq-discuss] SocketException when invoking model.BasicPublish
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36774">[ date ]</a>
              <a href="thread.html#36774">[ thread ]</a>
              <a href="subject.html#36774">[ subject ]</a>
              <a href="author.html#36774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
