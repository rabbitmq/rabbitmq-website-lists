<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] MQTT And RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20MQTT%20And%20RabbitMQ&In-Reply-To=%3CCAPwMmOCL5_MmW%2BRocZNHX4R0EzByE_C%3DL30Qb%3DoK1dPRaXOh_A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036478.html">
   <LINK REL="Next"  HREF="036484.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] MQTT And RabbitMQ</H1>
    <B>Mark Wolfe</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20MQTT%20And%20RabbitMQ&In-Reply-To=%3CCAPwMmOCL5_MmW%2BRocZNHX4R0EzByE_C%3DL30Qb%3DoK1dPRaXOh_A%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] MQTT And RabbitMQ">mark at wolfe.id.au
       </A><BR>
    <I>Thu Jun  5 11:59:01 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036478.html">[rabbitmq-discuss] &#9733; Read your message before it gets deleted!
</A></li>
        <LI>Next message: <A HREF="036484.html">[rabbitmq-discuss] MQTT And RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36483">[ date ]</a>
              <a href="thread.html#36483">[ thread ]</a>
              <a href="subject.html#36483">[ subject ]</a>
              <a href="author.html#36483">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gday All

Just wanted to see if others are having similar issues with RabbitMQ and
MQTT.

Firstly we are seeing a lot of errors around duplicate client-ids, after
debugging this a few times it seemed there were orphaned or somehow
retained connections which aren't showing in the standard rabbitmq session
list.

These connections are somehow leading to the newer connection being kicked
off, like a routine is kicking off the oldest connection for a given
client, where there is only one..

We are also getting these traces from time to time (see below).

I saw there is some pretty significant work going on around the MQTT
plugin, is this related to any of the symptoms I described?

Lastly as you can see in the trace we are running an SSL proxy in front of
RabbitMQ.

=ERROR REPORT==== 7-May-2014::14:11:25 ===
** Generic server &lt;0.710.30&gt; terminating
** Last message in was {inet_async,#Port&lt;0.567958&gt;,12806,

 {ok,&lt;&lt;16,69,0,6,77,81,73,115,100,112,3,194,0,30,0,
                                 20,52,57,51,45,54,66,67,66,50,66,68,67,49,

 53,65,48,56,67,56,68,0,7,115,116,114,101,97,
                                 109,115,0,24,72,97,118,106,101,114,104,111,
                                 70,114,97,110,74,111,103,114,121,111,99,78,
                                 111,110,115,55&gt;&gt;}}
** When Server state == {state,#Port&lt;0.567958&gt;,
                            &quot;127.0.0.1:34267 -&gt; 127.0.0.1:2883
&quot;,true,running,
                            {none,&lt;0.731.30&gt;},
                            &lt;0.711.30&gt;,false,none,
                            {proc_state,#Port&lt;0.567958&gt;,
                                {dict,4,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},

{{[[&quot;$bkt/c884c1f687e7a3227666d1...&quot;,1]],
                                      [],[],[],[],[],[],
                                      [[&quot;$bkt/c884c1f687e7a32...&quot;,1]],
                                      [],[],[],
                                      [[&quot;$bkt/c884c1f687e...&quot;,1]],
                                      [],
                                      [[&quot;$bkt/c884c1f68...&quot;,0]],
                                      [],[]}}},
                                {&lt;&lt;&quot;amq.ctag-6D0VFf1CiAX92MduztwyMQ&quot;&gt;&gt;,
                                 &lt;&lt;&quot;amq.ctag-xsYcdvDhFzF7PROcEpeYgA&quot;&gt;&gt;},
                                {0,nil},
                                {0,nil},
                                undefined,2,&quot;493-6BCB2BDC15A08C8D&quot;,true,
                                undefined,
                                {&lt;0.721.30&gt;,undefined},
                                &lt;0.715.30&gt;,&lt;&lt;&quot;amq.topic&quot;&gt;&gt;}}
** Reason for termination ==
** {function_clause,
       [{rabbit_mqtt_processor,process_login,
            [&lt;&lt;&quot;useraccounthere&quot;&gt;&gt;,&lt;&lt;&quot;XXXXXXX&quot;&gt;&gt;,3,
             {proc_state,#Port&lt;0.567958&gt;,
                 {dict,4,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[[&quot;$bkt/c884...&quot;,1]],
                       [],[],[],[],[],[],
                       [[&quot;$blo...&quot;,1]],
                       [],[],[],
                       [[&quot;...&quot;,1]],
                       [],
                       [[&quot;...&quot;,0]],
                       [],[]}}},
                 {&lt;&lt;&quot;amq.ctag-6D0VFf1CiAX92MduztwyMQ&quot;&gt;&gt;,
                  &lt;&lt;&quot;amq.ctag-xsYcdvDhFzF7PROcEpeYgA&quot;&gt;&gt;},
                 {0,nil},
                 {0,nil},
                 undefined,2,&quot;493-6BCB2BDC15A08C8D&quot;,true,undefined,
                 {&lt;0.721.30&gt;,undefined},
                 &lt;0.715.30&gt;,&lt;&lt;&quot;amq.topic&quot;&gt;&gt;}],
            []},
        {rabbit_mqtt_processor,process_request,3,[]},
        {rabbit_mqtt_reader,process_received_bytes,2,[]},
        {gen_server2,handle_msg,2,[]},
        {proc_lib,wake_up,3,[{file,&quot;proc_lib.erl&quot;},{line,237}]}]}

=ERROR REPORT==== 7-May-2014::14:11:25 ===
** Generic server &lt;0.715.30&gt; terminating
** Last message in was {'EXIT',&lt;0.710.30&gt;,
                        {function_clause,
                         [{rabbit_mqtt_processor,process_login,
                           [&lt;&lt;&quot;useraccounthere&quot;&gt;&gt;,&lt;&lt;&quot;XXXXXXX&quot;&gt;&gt;,3,
                            {proc_state,#Port&lt;0.567958&gt;,
                             {dict,4,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[[&quot;$b...&quot;,1]],
                                [],[],[],[],[],[],
                                [[&quot;...&quot;,1]],
                                [],[],[],
                                [[&quot;...&quot;,'...']],
                                [],
                                [['...']],
                                [],[]}}},
                             {&lt;&lt;&quot;amq.ctag-6D0VFf1CiAX92MduztwyMQ&quot;&gt;&gt;,
                              &lt;&lt;&quot;amq.ctag-xsYcdvDhFzF7PROcEpeYgA&quot;&gt;&gt;},
                             {0,nil},
                             {0,nil},
                             undefined,2,&quot;493-6BCB2BDC15A08C8D&quot;,true,
                             undefined,
                             {&lt;0.721.30&gt;,undefined},
                             &lt;0.715.30&gt;,&lt;&lt;&quot;amq.topic&quot;&gt;&gt;}],
                           []},
                          {rabbit_mqtt_processor,process_request,3,[]},
                          {rabbit_mqtt_reader,process_received_bytes,2,[]},
                          {gen_server2,handle_msg,2,[]},
                          {proc_lib,wake_up,3,
                           [{file,&quot;proc_lib.erl&quot;},{line,237}]}]}}
** When Server state == {state,amqp_direct_connection,
                         {<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">state,rabbit at somehostsomewhere</A>,
                          {user,&lt;&lt;&quot;useraccounthere&quot;&gt;&gt;,
                           [whatever],
                           rabbit_auth_backend_internal,
                           {internal_user,&lt;&lt;&quot;useraccounthere&quot;&gt;&gt;,

&lt;&lt;161,99,227,145,114,48,147,95,100,75,53,57,61,183,
                              253,109,128,232,30,86&gt;&gt;,
                            [whatever]}},
                          &lt;&lt;&quot;/&quot;&gt;&gt;,
                          {amqp_params_direct,&lt;&lt;&quot;useraccounthere&quot;&gt;&gt;,
                           &lt;&lt;&quot;XXXXXXX&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                           <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at somehostsomewhere</A>,
                           {amqp_adapter_info,
                            {0,0,0,0,0,65535,32512,1},
                            2883,
                            {0,0,0,0,0,65535,32512,1},
                            34267,&lt;&lt;&quot;127.0.0.1:34267 -&gt; 127.0.0.1:2883&quot;&gt;&gt;,
                            {'MQTT',&quot;3&quot;},
                            [{ssl,false}]},
                           []},
                          {amqp_adapter_info,
                           {0,0,0,0,0,65535,32512,1},
                           2883,
                           {0,0,0,0,0,65535,32512,1},
                           34267,&lt;&lt;&quot;127.0.0.1:34267 -&gt; 127.0.0.1:2883&quot;&gt;&gt;,
                           {'MQTT',&quot;3&quot;},
                           [{ssl,false}]},
                          &lt;0.718.30&gt;,undefined},
                         &lt;0.717.30&gt;,
                         {amqp_params_direct,&lt;&lt;&quot;useraccounthere&quot;&gt;&gt;,
                          &lt;&lt;&quot;XXXXXXX&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                          <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at somehostsomewhere</A>,
                          {amqp_adapter_info,
                           {0,0,0,0,0,65535,32512,1},
                           2883,
                           {0,0,0,0,0,65535,32512,1},
                           34267,&lt;&lt;&quot;127.0.0.1:34267 -&gt; 127.0.0.1:2883&quot;&gt;&gt;,
                           {'MQTT',&quot;3&quot;},
                           [{ssl,false}]},
                          []},
                         0,
                         [{&lt;&lt;&quot;capabilities&quot;&gt;&gt;,table,
                           [{&lt;&lt;&quot;publisher_confirms&quot;&gt;&gt;,bool,true},
                            {&lt;&lt;&quot;exchange_exchange_bindings&quot;&gt;&gt;,bool,true},
                            {&lt;&lt;&quot;basic.nack&quot;&gt;&gt;,bool,true},
                            {&lt;&lt;&quot;consumer_cancel_notify&quot;&gt;&gt;,bool,true},
                            {&lt;&lt;&quot;connection.blocked&quot;&gt;&gt;,bool,true},
                            {&lt;&lt;&quot;consumer_priorities&quot;&gt;&gt;,bool,true},

{&lt;&lt;&quot;authentication_failure_close&quot;&gt;&gt;,bool,true}]},

{&lt;&lt;&quot;cluster_name&quot;&gt;&gt;,longstr,&lt;&lt;&quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at somehostsomewhere</A>&quot;&gt;&gt;},
                          {&lt;&lt;&quot;copyright&quot;&gt;&gt;,longstr,
                           &lt;&lt;&quot;Copyright (C) 2007-2013 GoPivotal, Inc.&quot;&gt;&gt;},
                          {&lt;&lt;&quot;information&quot;&gt;&gt;,longstr,
                           &lt;&lt;&quot;Licensed under the MPL.  See
<A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>&quot;&gt;&gt;},
                          {&lt;&lt;&quot;platform&quot;&gt;&gt;,longstr,&lt;&lt;&quot;Erlang/OTP&quot;&gt;&gt;},
                          {&lt;&lt;&quot;product&quot;&gt;&gt;,longstr,&lt;&lt;&quot;RabbitMQ&quot;&gt;&gt;},
                          {&lt;&lt;&quot;version&quot;&gt;&gt;,longstr,&lt;&lt;&quot;3.3.0&quot;&gt;&gt;}],
                         none,false}
** Reason for termination ==
** {unexpected_msg,
       {'EXIT',&lt;0.710.30&gt;,
           {function_clause,
               [{rabbit_mqtt_processor,process_login,
                    [&lt;&lt;&quot;useraccounthere&quot;&gt;&gt;,&lt;&lt;&quot;XXXXXXX&quot;&gt;&gt;,3,
                     {proc_state,#Port&lt;0.567958&gt;,
                         {dict,4,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[[&quot;...&quot;,1]],
                               [],[],[],[],[],[],
                               [['...']],
                               [],[],[],
                               ['...'],
                               [],
                               ['...'],
                               [],[]}}},
                         {&lt;&lt;&quot;amq.ctag-6D0VFf1CiAX92MduztwyMQ&quot;&gt;&gt;,
                          &lt;&lt;&quot;amq.ctag-xsYcdvDhFzF7PROcEpeYgA&quot;&gt;&gt;},
                         {0,nil},
                         {0,nil},
                         undefined,2,&quot;493-6BCB2BDC15A08C8D&quot;,true,undefined,
                         {&lt;0.721.30&gt;,undefined},
                         &lt;0.715.30&gt;,&lt;&lt;&quot;amq.topic&quot;&gt;&gt;}],
                    []},
                {rabbit_mqtt_processor,process_request,3,[]},
                {rabbit_mqtt_reader,process_received_bytes,2,[]},
                {gen_server2,handle_msg,2,[]},
                {proc_lib,wake_up,3,[{file,&quot;proc_lib.erl&quot;},{line,237}]}]}}}

=WARNING REPORT==== 7-May-2014::14:11:25 ===
MQTT disconnect from &quot;493-6BCB2BDC15A08C8D&quot;


-- 
Regards,

Mark Wolfe

--
I am not young enough to know everything.
--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/166bcbed/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140605/166bcbed/attachment.html</A>&gt;
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036478.html">[rabbitmq-discuss] &#9733; Read your message before it gets deleted!
</A></li>
	<LI>Next message: <A HREF="036484.html">[rabbitmq-discuss] MQTT And RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36483">[ date ]</a>
              <a href="thread.html#36483">[ thread ]</a>
              <a href="subject.html#36483">[ subject ]</a>
              <a href="author.html#36483">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
