<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] can't restart rabbit cluster after power	outage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20can%27t%20restart%20rabbit%20cluster%20after%20power%0A%09outage&In-Reply-To=%3C53A7E0F1.5030800%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036808.html">
   <LINK REL="Next"  HREF="036809.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] can't restart rabbit cluster after power	outage</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20can%27t%20restart%20rabbit%20cluster%20after%20power%0A%09outage&In-Reply-To=%3C53A7E0F1.5030800%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] can't restart rabbit cluster after power	outage">simon at rabbitmq.com
       </A><BR>
    <I>Mon Jun 23 09:10:25 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036808.html">[rabbitmq-discuss] can't restart rabbit cluster after power	outage
</A></li>
        <LI>Next message: <A HREF="036809.html">[rabbitmq-discuss] Cannot Log In to Management UI After Importing	Broker Definitions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36822">[ date ]</a>
              <a href="thread.html#36822">[ thread ]</a>
              <a href="subject.html#36822">[ subject ]</a>
              <a href="author.html#36822">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/06/2014 19:00, Ben Hsu wrote:
&gt;<i> That's interesting. It looks like an older version of rabbitmq
</I>&gt;<i>        {rabbit,&quot;RabbitMQ&quot;,&quot;3.0.0&quot;},
</I>
&gt;<i> Now thats interesting! Having an erlang node up without having to start
</I>&gt;<i> up rabbit sounds very useful. I tried doing forgetting the cluster node
</I>&gt;<i> and got this:
</I>&gt;<i>
</I>&gt;<i> sudo rabbitmqctl forget_cluster_node --offline <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node3</A>
</I>&gt;<i>
</I>&gt;<i> Error: not_last_node_to_go_down: The node you are trying to remove from
</I>&gt;<i> was not the last to go down (excluding the node you are removing).
</I>&gt;<i> Please use the the last node to go down to remove nodes when the cluster
</I>&gt;<i> is offline.
</I>
Ah. Yes, that used to be a constraint for forget_cluster_node; it was 
removed in 3.1.4.

&gt;<i> I got the same error when I tried the same command with each of the
</I>&gt;<i> other nodes. So it looks like rabbit has no idea which node was the last
</I>&gt;<i> to die. Is it possible to ask rabbit for this information, possibly by
</I>&gt;<i> groveling around mnesia with &quot;rabbitmqctl eval&quot;?
</I>
I think on 3.0.0 you might be able to get away with:

1) Start with NODE_ONLY
2) rabbitmqctl eval 'application:start(mnesia).'
3) rabbitmqctl eval 'rabbit_table:force_load().'
4) rabbitmqctl eval 'rabbit_table:wait_for_replicated().'
5) rabbitmqctl eval 'application:stop(mnesia).'

Then stop, remove NODE_ONLY and start again. That won't have removed 
node3 from the cluster so you'll need to do that with 
forget_cluster_node separately afterwards - but you can do that online 
once node1 and node2 are running.

&gt;<i> I'm also okay with a drastic solution like &quot;blow away the mnesia
</I>&gt;<i> database and recover the data in some other way&quot;. Part of the reason I'm
</I>&gt;<i> asking all these questions is because I want to learn more about rabbitmq
</I>
There's no real way to recover from deleting the database other than to 
start from scratch.

Cheers, Simon
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036808.html">[rabbitmq-discuss] can't restart rabbit cluster after power	outage
</A></li>
	<LI>Next message: <A HREF="036809.html">[rabbitmq-discuss] Cannot Log In to Management UI After Importing	Broker Definitions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36822">[ date ]</a>
              <a href="thread.html#36822">[ thread ]</a>
              <a href="subject.html#36822">[ subject ]</a>
              <a href="author.html#36822">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
