<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Workpool memory leak on 3.3.1?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Workpool%20memory%20leak%20on%203.3.1%3F&In-Reply-To=%3C1401720019012-35984.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036430.html">
   <LINK REL="Next"  HREF="036397.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Workpool memory leak on 3.3.1?</H1>
    <B>gui.balde</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Workpool%20memory%20leak%20on%203.3.1%3F&In-Reply-To=%3C1401720019012-35984.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Workpool memory leak on 3.3.1?">gperes at daitangroup.com
       </A><BR>
    <I>Mon Jun  2 15:40:19 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036430.html">[rabbitmq-discuss] Basic_Consume
</A></li>
        <LI>Next message: <A HREF="036397.html">[rabbitmq-discuss] Workpool memory leak on 3.3.1?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36396">[ date ]</a>
              <a href="thread.html#36396">[ thread ]</a>
              <a href="subject.html#36396">[ subject ]</a>
              <a href="author.html#36396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good morning,

I know this was a known issue back with 2.7.1

We've been profiling one of our modules running on an ec2 instance consuming
from a rabbit queue.
The message consumer simply queues the delivered object as a task to be
consumed by an internal thread, no hassle.
This internal thread takes each item from the internal queue and goes over
the wire to the database. This takes time due to net i/o and transactions.
This makes our consumer a slow consumer ;)

In this scenario we expected to see messages queueing up on &quot;rabbitmqctl
list_queues&quot;, but instead, we see none. What we see is the workPool (inside
com.rabbitmq.client.impl.ConsumerWorkService) filling up to 780MB of items
in the 'pool' HashMap. Which then leads to an OutOfMemoryError when under a
heavy load.

We currently have 90 consumers synchronizing that one internal queue I
referred to.

Does anyone see any problems here?

Thanks in advance.

Guilherme.




--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Workpool-memory-leak-on-3-3-1-tp35984.html">http://rabbitmq.1065348.n5.nabble.com/Workpool-memory-leak-on-3-3-1-tp35984.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036430.html">[rabbitmq-discuss] Basic_Consume
</A></li>
	<LI>Next message: <A HREF="036397.html">[rabbitmq-discuss] Workpool memory leak on 3.3.1?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36396">[ date ]</a>
              <a href="thread.html#36396">[ thread ]</a>
              <a href="subject.html#36396">[ subject ]</a>
              <a href="author.html#36396">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
