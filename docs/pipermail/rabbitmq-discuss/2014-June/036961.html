<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] federation Issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20federation%20Issues&In-Reply-To=%3C6DB033025329784B9280ABD9516177FCA2D0B4DE%40USEPX2PMXMBX12.corp.altegrity.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036960.html">
   <LINK REL="Next"  HREF="036962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] federation Issues</H1>
    <B>Ganann, Kale</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20federation%20Issues&In-Reply-To=%3C6DB033025329784B9280ABD9516177FCA2D0B4DE%40USEPX2PMXMBX12.corp.altegrity.com%3E"
       TITLE="[rabbitmq-discuss] federation Issues">KGanann at kroll.com
       </A><BR>
    <I>Fri Jun 27 17:23:21 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036960.html">[rabbitmq-discuss] federation Issues
</A></li>
        <LI>Next message: <A HREF="036962.html">[rabbitmq-discuss] federation Issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36961">[ date ]</a>
              <a href="thread.html#36961">[ thread ]</a>
              <a href="subject.html#36961">[ subject ]</a>
              <a href="author.html#36961">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update - we renamed the cluster to something meaningful and deleted all the dynamic objects so there were absolutely no artifacts left over.  We've got three vHosts with queues bound to e.fed.topic and the same routing key.  If I publish to the e.fed.topic on fed with that key, all three get it.  If I publish on vHost a, vHost b sometimes gets it, but not everytime, vHost c does not.  Similarly, we can publish to b, and sometimes a gets it, c does not.  Nothing published to c shows up anywhere else.

Thanks,
Kale


-----Original Message-----
From: rabbitmq-discuss [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Ganann, Kale
Sent: Friday, June 27, 2014 9:11 AM
To: 'Simon MacMullen'; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] federation Issues

To your first question:

In production, federation links (specifically, x-federation-upstream under exchnages) show as: vHost | federation: e.fed.topic -&gt; sharedfederationid:fed:e.fed.topic B, for example.  The sharedfederationid is used in the old parameters section as an explicit identity for a local user, hence, a user token.  I believe below you're calling this local_username, sorry for the confusion.  The dynamically created queues look much the same.

Now in dev, where we did the upgrade, a similar link would show as: vHost | federation: e.fed.topic -&gt; ClusterName:fed:e.fed.topic B.  From what you're saying below, this is due to the change in the authentication manner - the local_username no longer need be applied.  There were some artifacts of the old federation style links, and when we've had fed problems in the past, they were resolved by deleting the x-federation-upstreams in fed and the affected vHost, as well as the related queues.  On deleting the dynamic queues, they would recreate and recreate the x-federation-upstreams, and everything would work.  That isn't happening this time.  If I publish to the e.fed.topic exchange in one vHost, it should publish to the queues in other vHosts that are bound to e.fed.topic with the same routing key, but right now the messages are vanishing - I'm having no luck tracing them.

All link statuses are Running.  Fed has an upstream to each vHost, and each vHost has an upstream to fed.

If I change the cluster name, will I have to delete all the dynamic streams again to get them to use the new name?

Thanks,
Kale


-----Original Message-----
From: Simon MacMullen [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>]
Sent: Friday, June 27, 2014 6:11 AM
To: Legacy list about RabbitMQ; Ganann, Kale
Subject: Re: [rabbitmq-discuss] federation Issues

On 27/06/14 00:27, Ganann, Kale wrote:
&gt;<i> We just upgraded from 3.2.1 to 3.3.4 and federation died on us.  
</I>&gt;<i> Looking at the cluster, it appears some... overenthusiastic dev 
</I>&gt;<i> renamed the cluster
</I>
That should not be a problem.

 From 3.2.x to 3.3.x we changed from having the federation plugin give the cluster a name through the local_nodename parameter, to having a broker-wide cluster name that can be used by the federation plugin.

But the cluster name doesn't matter that much. It's used to name the queues which federation uses internally, and it shows up in transmitted bindings and messages so the plugin (and sysadmins) know where message have been. But it's not something you should have to get &quot;correct&quot; for things to work - there's no correct value.

&gt;<i> and now when federation creates new linkages, it creates them as 
</I>&gt;<i> clustername:vHost:queue, rather than usertoken:vHost:queue.
</I>
I really do not understand any of this.

What do you mean by &quot;linkages&quot;? Bindings? Federation links (as shown in the status)? Something else?

Also, what do you mean by usertoken?

&gt;<i> Also, on
</I>&gt;<i> the federation upstreams, the parameter field seems to have vanished, 
</I>&gt;<i> so I can't update the user tokens for specific vHosts.
</I>
I guess you are saying something about the local_username or local_nodename fields here? local_username is gone, there is no need to configure it at all any more. local_nodename is replaced by the cluster name.

&gt;<i> I've been going
</I>&gt;<i> through the patch notes - is this intentional, or is something else 
</I>&gt;<i> going on?
</I>
The removal of local_username and local_nodename was intentional.

&gt;<i> And can I just remove the cluster name?
</I>
Clusters always have a name.

&gt;<i>  I've tried deleting
</I>&gt;<i> the old dynamically created fed stuff so that it gets recreated, but 
</I>&gt;<i> the new stuff just doesn't seem to work.  Any help is appreciated.
</I>
What does the link status look like?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal
This communication contains information that is confidential, proprietary in nature, and may also be attorney-client privileged and/or work product privileged. It is for the exclusive use of the intended recipient(s). If you are not the intended recipient(s) or the person responsible for delivering it to the intended recipient(s), please note that any form of dissemination, distribution or copying of this communication is strictly prohibited and may be unlawful. If you have received this communication in error, please immediately notify the sender by replying to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees or agents accept liability for any errors, omissions or damages caused by delays of receipt or by any virus infection in this message or its attachments, or which may otherwise arise as a result of this e-mail transmission.

_______________________________________________
rabbitmq-discuss mailing list has moved to <A HREF="https://groups.google.com/forum/#!forum/rabbitmq-users,">https://groups.google.com/forum/#!forum/rabbitmq-users,</A>
please subscribe to the new list!

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036960.html">[rabbitmq-discuss] federation Issues
</A></li>
	<LI>Next message: <A HREF="036962.html">[rabbitmq-discuss] federation Issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36961">[ date ]</a>
              <a href="thread.html#36961">[ thread ]</a>
              <a href="subject.html#36961">[ subject ]</a>
              <a href="author.html#36961">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
