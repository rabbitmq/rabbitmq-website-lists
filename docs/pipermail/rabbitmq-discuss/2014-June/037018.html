<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster hung on node death
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20hung%20on%20node%20death&In-Reply-To=%3CCAH8FpAQTTzgp76_31nn%2BGtYOt4tLMmWaZTTEYGOwSMKXH5RwDw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037003.html">
   <LINK REL="Next"  HREF="036964.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster hung on node death</H1>
    <B>Daniel Burke</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20hung%20on%20node%20death&In-Reply-To=%3CCAH8FpAQTTzgp76_31nn%2BGtYOt4tLMmWaZTTEYGOwSMKXH5RwDw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Cluster hung on node death">particlesquirrel at gmail.com
       </A><BR>
    <I>Mon Jun 30 12:11:18 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="037003.html">[rabbitmq-discuss] Cluster hung on node death
</A></li>
        <LI>Next message: <A HREF="036964.html">[rabbitmq-discuss] rabbitmq crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37018">[ date ]</a>
              <a href="thread.html#37018">[ thread ]</a>
              <a href="subject.html#37018">[ subject ]</a>
              <a href="author.html#37018">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We did not change netticktime, and the other nodes in the cluster were
frozen for about an hour by the time networking was active again on the
node that crashed.

Frustratingly there was nothing in the logs, but I think that's because of
the bug fixed in 3.3.3 and we went live with 3.3.2 :(  we started upgrading
on Friday to fix that...

Dan.
On Jun 30, 2014 6:23 AM, &quot;Simon MacMullen&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 27/06/14 20:55, Daniel Burke wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Today we had the physical machine of a dedicated node kernel panic
</I>&gt;&gt;<i> (linux centos 6)... when that happened the other two nodes in the
</I>&gt;&gt;<i> cluster seemed to choke, and not respond at all.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;rabbitmqctl cluster_status&quot; on either of the other nodes would hang.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The web management UI didn't respond.  I could get a login page to come
</I>&gt;&gt;<i> up but after that it would go back to not responding.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The management UI and &quot;rabbitmqctl cluster_status&quot; can hang for a short
</I>&gt;<i> while, while the live nodes attempt to contact the crashed node but haven't
</I>&gt;<i> got an answer from it. Once the live nodes decide that the dead node is in
</I>&gt;<i> fact dead, the UI and rabbitmqctl will become responsive again. This time
</I>&gt;<i> period is defined by net_ticktime (see <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
</I>&gt;<i> nettick.html).
</I>&gt;<i>
</I>&gt;<i> * Have you changed this setting?
</I>&gt;<i> * Did messages about the node being down get logged by the other nodes?
</I>&gt;<i> When?
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>  When the crashed machine came back up, without starting rabbitmq on it,
</I>&gt;&gt;<i> once networking was responding, the other two nodes seemed to free up
</I>&gt;&gt;<i> and start operating normally again.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> After the rest of the cluster was operating normally again, we brought
</I>&gt;&gt;<i> down the crashed machine to do a memtest, and we didn't experience the
</I>&gt;&gt;<i> cluster freeze again (rabbitmq was not ever started back up on the
</I>&gt;&gt;<i> failed node).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This cluster (we went live with multiple clusters yesterday), is running
</I>&gt;&gt;<i> 3 physical dedicated machines.  All of them are on centos 6.  RabbitMQ v
</I>&gt;&gt;<i> 3.3.2.  All nodes are disc nodes.  All queues are durable and mirrored.
</I>&gt;&gt;<i>   This cluster has one queue, plus 1000's of dynamic shovels (which of
</I>&gt;&gt;<i> course includes their own queues on this cluster) connecting to queues
</I>&gt;&gt;<i> on 3 other clusters with similar setups.  Each node has about 7gig of
</I>&gt;&gt;<i> disk free on the relevant partition, and 48gig of ram with the
</I>&gt;&gt;<i> high_water_mark set to 0.9, but even at diminished capacity right now,
</I>&gt;&gt;<i> the most ram used is 1.2gig on one node and 600meg on the other (these
</I>&gt;&gt;<i> boxes were way over built with short-term growth in mind).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sadly, there was nothing in the logs.  We realized this might be related
</I>&gt;&gt;<i> to the logging bug fixed in 3.3.3, so we just upgraded our dev
</I>&gt;&gt;<i> environment to start the process to deal with that.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any thoughts on what the cause of this freeze up could have been?  And
</I>&gt;&gt;<i> how to mitigate it?  Or any troubleshooting / information gathering we
</I>&gt;&gt;<i> could do if it happens again?  It's a scary thing now to have happen on
</I>&gt;&gt;<i> a friday afternoon.  We were counting on three node clusters getting us
</I>&gt;&gt;<i> through if there was an outage of a node during the weekend... but now
</I>&gt;&gt;<i> we're all afraid to go home for the weekend!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks!
</I>&gt;&gt;<i> Dan.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list has moved to <A HREF="https://groups.google.com/">https://groups.google.com/</A>
</I>&gt;&gt;<i> forum/#!forum/rabbitmq-users,
</I>&gt;&gt;<i> please subscribe to the new list!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/a90ea39f/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/a90ea39f/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037003.html">[rabbitmq-discuss] Cluster hung on node death
</A></li>
	<LI>Next message: <A HREF="036964.html">[rabbitmq-discuss] rabbitmq crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37018">[ date ]</a>
              <a href="thread.html#37018">[ thread ]</a>
              <a href="subject.html#37018">[ subject ]</a>
              <a href="author.html#37018">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
