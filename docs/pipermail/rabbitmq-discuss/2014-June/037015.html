<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Core down when invoking amqp_destroy_connection() of rabbitmq-c-0.5.0 stable version
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Core%20down%20when%20invoking%0A%20amqp_destroy_connection%28%29%20of%20rabbitmq-c-0.5.0%20stable%20version&In-Reply-To=%3CCAAt2poKiwzgR4GztG85%3DdseCqBrwYYVn6vYVcRwEeCb8RJjzfQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036988.html">
   <LINK REL="Next"  HREF="036993.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Core down when invoking amqp_destroy_connection() of rabbitmq-c-0.5.0 stable version</H1>
    <B>Alan Antonuk</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Core%20down%20when%20invoking%0A%20amqp_destroy_connection%28%29%20of%20rabbitmq-c-0.5.0%20stable%20version&In-Reply-To=%3CCAAt2poKiwzgR4GztG85%3DdseCqBrwYYVn6vYVcRwEeCb8RJjzfQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Core down when invoking amqp_destroy_connection() of rabbitmq-c-0.5.0 stable version">alan.antonuk at gmail.com
       </A><BR>
    <I>Mon Jun 30 16:52:44 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036988.html">[rabbitmq-discuss] Core down when invoking	amqp_destroy_connection() of rabbitmq-c-0.5.0 stable version
</A></li>
        <LI>Next message: <A HREF="036993.html">[rabbitmq-discuss] Disable PUT or GET from publisher/consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37015">[ date ]</a>
              <a href="thread.html#37015">[ thread ]</a>
              <a href="subject.html#37015">[ subject ]</a>
              <a href="author.html#37015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Looks like something has incorrectly written to the amqp_pool_t memory pool
(probably contained in the amqp_connection_state_t object). Without further
information about the program I cannot help you much further.

-Alan


On Mon, Jun 30, 2014 at 2:16 AM, &#26928;&#39118; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">1006798382 at qq.com</A>&gt; wrote:

&gt;<i> It looks like the pool num_blocks (=1342177400) &#8205;and blocklist(0x7fb850000bb0)
</I>&gt;<i> members of pages&#8205; is incorrect.
</I>&gt;<i> refer to,
</I>&gt;<i> $7 = {pagesize = 132577, pages = {num_blocks = 1342177400, blocklist =
</I>&gt;<i> 0x7fb850000bb0}, large_blocks = {num_blocks = 0, blocklist = 0x0},
</I>&gt;<i> next_page = 0, alloc_block = 0x0, alloc_used = 0}&#8205;
</I>&gt;<i>
</I>&gt;<i> platform: Centos 6.3 x86_64bits
</I>&gt;<i>
</I>&gt;<i> std output:
</I>&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">push at zwjf-jpush-conn09-247115</A> conn_v1]$ *** glibc detected ***
</I>&gt;<i> /opt/push/bin/conn/conn_v1/tcp_interface_srv_v1: free(): invalid pointer:
</I>&gt;<i> 0x00007fb8500214f8 ***
</I>&gt;<i> ======= Backtrace: =========
</I>&gt;<i> /lib64/libc.so.6[0x35dd676166]
</I>&gt;<i> /opt/push/lib64/librabbitmq.so.1(+0xf45d)[0x7fb8804a145d]
</I>&gt;<i> /opt/push/lib64/librabbitmq.so.1(empty_amqp_pool+0x28)[0x7fb8804a150a]
</I>&gt;<i> /opt/push/lib64/librabbitmq.so.1(amqp_destroy_connection+0x53)
</I>&gt;<i> [0x7fb8804a082f]&#8205;
</I>&gt;<i>
</I>&gt;<i> more detail:
</I>&gt;<i> #4 0x00007fb8804a145d in empty_blocklist (x=0x7fb850000e20) at
</I>&gt;<i> /home/push/source/jim/jpush-server/server/external/src/rabbitmq-c-0.5.0/librabbitmq/amqp_mem.c:79
</I>&gt;<i> 79 free(x-&gt;blocklist[i]);
</I>&gt;<i> (gdb) l
</I>&gt;<i> 74 static void empty_blocklist(amqp_pool_blocklist_t *x)
</I>&gt;<i> 75 {
</I>&gt;<i> 76 int i;
</I>&gt;<i> 77
</I>&gt;<i> 78 for (i = 0; i &lt; x-&gt;num_blocks; i++) { 79 free(x-&gt;blocklist[i]); 80 }
</I>&gt;<i> 81 if (x-&gt;blocklist != NULL) { 82 free(x-&gt;blocklist); 83 }
</I>&gt;<i> (gdb) p *x
</I>&gt;<i> $5 = {num_blocks = 1342177400, blocklist = 0x7fb850000bb0}
</I>&gt;<i> (gdb) f 5
</I>&gt;<i> #5 0x00007fb8804a150a in empty_amqp_pool (pool=0x7fb850000e18) at
</I>&gt;<i> /home/push/source/jim/jpush-server/server/external/src/rabbitmq-c-0.5.0/librabbitmq/amqp_mem.c:99
</I>&gt;<i> 99 empty_blocklist(&amp;pool-&gt;pages);
</I>&gt;<i> (gdb) l
</I>&gt;<i> 94 }
</I>&gt;<i> 95
</I>&gt;<i> 96 void empty_amqp_pool(amqp_pool_t *pool)
</I>&gt;<i> 97 { 98 recycle_amqp_pool(pool); 99 empty_blocklist(&amp;pool-&gt;pages); 100 }
</I>&gt;<i> 101
</I>&gt;<i> 102 /* Returns 1 on success, 0 on failure */
</I>&gt;<i> 103 static int record_pool_block(amqp_pool_blocklist_t *x, void *block)
</I>&gt;<i> (gdb) p pool-&gt;pages
</I>&gt;<i> $6 = {num_blocks = 1342177400, blocklist = 0x7fb850000bb0}
</I>&gt;<i> (gdb) p *pool
</I>&gt;<i> $7 = {pagesize = 132577, pages = {num_blocks = 1342177400, blocklist =
</I>&gt;<i> 0x7fb850000bb0}, large_blocks = {num_blocks = 0, blocklist = 0x0},
</I>&gt;<i> next_page = 0, alloc_block = 0x0, alloc_used = 0}
</I>&gt;<i> (gdb)&#8205;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list has moved to
</I>&gt;<i> <A HREF="https://groups.google.com/forum/#!forum/rabbitmq-users,">https://groups.google.com/forum/#!forum/rabbitmq-users,</A>
</I>&gt;<i> please subscribe to the new list!
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/3d4cd1d3/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140630/3d4cd1d3/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036988.html">[rabbitmq-discuss] Core down when invoking	amqp_destroy_connection() of rabbitmq-c-0.5.0 stable version
</A></li>
	<LI>Next message: <A HREF="036993.html">[rabbitmq-discuss] Disable PUT or GET from publisher/consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37015">[ date ]</a>
              <a href="thread.html#37015">[ thread ]</a>
              <a href="subject.html#37015">[ subject ]</a>
              <a href="author.html#37015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
