From carl.hoerberg at gmail.com  Sun Dec  1 05:57:06 2013
From: carl.hoerberg at gmail.com (=?utf-8?Q?Carl_H=C3=B6rberg?=)
Date: Sun, 1 Dec 2013 12:57:06 +0700
Subject: [rabbitmq-discuss] Access www.rabbitmq.com from GCE europe-west1
In-Reply-To: <851AAE32BA144D1DB8902B271B355D6D@gmail.com>
References: <1385803142304-31738.post@n5.nabble.com>
 <529A1196.6050300@rabbitmq.com>
 <851AAE32BA144D1DB8902B271B355D6D@gmail.com>
Message-ID: <D8D0B07EE3A34BFFAA65AF49B86A78E7@gmail.com>

We configured an apt-mirror on S3 to circumvent it: http://rabbitmq.apt.cloudamqp.com/

btw, would be nice if all old versions of rabbitmq was stored in the apt repo too, so that you could specify which version to install (even old ones).   


On Saturday 30 November 2013 at 23:27, Carl H?rberg wrote:

> yes, it resolves correctly
>  
>  
>  
> On Saturday 30 November 2013 at 23:25, Simon MacMullen wrote:
>  
> > We don't do any range blocking. But the machine has recently moved as  
> > Michael said. Are you picking up the correct IP address? (192.240.153.117)
> >  
> > If so I will have a word with our new hosting provider...
> >  
> > Cheers, Simon
> >  
> > On 30/11/2013 9:19AM, carlhoerberg wrote:
> > > Can't access www.rabbitmq.com (http://www.rabbitmq.com) (to download rabbitmq) from Google Compute
> > > Engines instances provisioned in the eu-west1 region (both zone a and b).
> > > Works fine from GCE us-central1 though. The http (and https) connection
> > > times out. Do you do some kind of ip range blocking? Example IPs:
> > > 23.251.128.15
> > > 23.251.128.129
> > > 23.251.128.43
> > >  
> > >  
> > >  
> > > --
> > > View this message in context: http://rabbitmq.1065348.n5.nabble.com/Access-www-rabbitmq-com-from-GCE-europe-west1-tp31738.html
> > > Sent from the RabbitMQ mailing list archive at Nabble.com (http://Nabble.com).
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >  
> >  
> >  
> >  
> >  
> > --  
> > Simon MacMullen
> > RabbitMQ, Pivotal
>  




From 314992959 at qq.com  Mon Dec  2 03:27:14 2013
From: 314992959 at qq.com (3k4b251)
Date: Sun, 1 Dec 2013 19:27:14 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c how to set arguments to queue after
 the queue careted?
Message-ID: <1385954834161-31747.post@n5.nabble.com>

  I know  that   we   can  set   arguments   like   'ttl'    when  we    use 
amqp_queue_declare()  to  create a  queue.
  I create a  queue  without   arugments  'ttl',  sometimes  later ,  I need 
It  to   have  arugments 'ttl',  how can  I  add   the  arguments to queue ,
and   how  to remove? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-to-set-arguments-to-queue-after-the-queue-careted-tp31747.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Dec  2 07:12:24 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 2 Dec 2013 11:12:24 +0400
Subject: [rabbitmq-discuss] rabbitmq-c how to set arguments to queue
	after the queue careted?
In-Reply-To: <1385954834161-31747.post@n5.nabble.com>
References: <1385954834161-31747.post@n5.nabble.com>
Message-ID: <F363D04D-7E18-4508-8FFF-FB456888C618@rabbitmq.com>

On 2 Dec 2013, at 07:27, 3k4b251 <314992959 at qq.com> wrote:

>  I create a  queue  without   arugments  'ttl',  sometimes  later ,  I need 
> It  to   have  arugments 'ttl',  how can  I  add   the  arguments to queue ,
> and   how  to remove? 

You need to remove the queue using amqp_queue_delete, then
re-declare it.

MK

Software Engineer, Pivotal/RabbitMQ



From 314992959 at qq.com  Mon Dec  2 07:16:22 2013
From: 314992959 at qq.com (3k4b251)
Date: Sun, 1 Dec 2013 23:16:22 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c how to set arguments to queue
 after the queue careted?
In-Reply-To: <F363D04D-7E18-4508-8FFF-FB456888C618@rabbitmq.com>
References: <1385954834161-31747.post@n5.nabble.com>
 <F363D04D-7E18-4508-8FFF-FB456888C618@rabbitmq.com>
Message-ID: <1385968582244-31749.post@n5.nabble.com>

can    server's  'policy'   command   help  me  to  do  this ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-to-set-arguments-to-queue-after-the-queue-careted-tp31747p31749.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From maitreya_vvm at yahoo.co.in  Mon Dec  2 10:25:30 2013
From: maitreya_vvm at yahoo.co.in (vadlamani maitreya)
Date: Mon, 2 Dec 2013 18:25:30 +0800 (SGT)
Subject: [rabbitmq-discuss] Pika Client starts consuming before calling
	start_consuming
In-Reply-To: <CAKgmDnFgnz6bRfm+1=K+NHj39e4BHmW5JsX4FEU-wM6Sc1NO1A@mail.gmail.com>
References: <1385447109.17717.YahooMailNeo@web192503.mail.sg3.yahoo.com>
 <CAKgmDnFgnz6bRfm+1=K+NHj39e4BHmW5JsX4FEU-wM6Sc1NO1A@mail.gmail.com>
Message-ID: <1385979930.53880.YahooMailNeo@web192506.mail.sg3.yahoo.com>

Hi Michael,

Thankyou for the response. The application we built infact supports only two priorities, ondemand and batch. The problem here is once the ondemand message is in queue, it must be processed irrespective of any number of batch messages. That is the reason for this weird logic we had to employ. For this usecase, I dont think the rate limiting and prefetch count variations would actual work. But I will try to play with the asynch connections for sure.

regards,
Maitreya






On Tuesday, 26 November 2013 8:32 PM, "Laing, Michael" <michael.laing at nytimes.com> wrote:
 
You say you want a scalable solution. Therefore with pika you should use a high-performance asynch connector, i.e. tornado in pika 9.13. So start there and follow the examples of using asynch connections - forget the blocking connection.

Then you could try this:


To do a simple priority queue I set up 2 queues and bind to both. Usually I have one queue that gets big bursts of messages and another, the priority one that only gets a few at a time. In this case I just set prefetch_count to 1 for both queues and let them interleave. I use acks always.


To give more 'preference' to the priority queue in the above case you can increase its prefetch_count, increasing the likelihood that a priority message will be ready when the event loop rolls around.

For even more preference you can 'rate limit' the non-priority queue. I do this by registering a short timeout after processing each non-priority message which does the ack in its callback.

There are much more complicated ways to do this. I prefer simple.

Good luck,

Michael

P.S. You can subscribe to a queue that is not currently bound to anything. Once subscribed, you can bind the queue one or more times and catch each bind_ok callback to know you are consuming. I'm not sure this is actually useful in your case.



On Tue, Nov 26, 2013 at 1:25 AM, vadlamani maitreya <maitreya_vvm at yahoo.co.in> wrote:

Hello Everyone,
>
>I have a small problem with RMQ and pika client and would like to ask guyz here for some help. The situation is as below,
>
>I am using RabbitMQ with the pika clients in a scalable solution. The solution requires messaging with two priorities. So every worker (through pika client) gets messages from the HighPriority Queue first and then goes to the Low Priority queue if there are no messages left in the HP Queue. I decide to scale the number of workers according to the number of ready messages and the number of consumers attached to the queue. So the following is the workflow i follow to achieve the above.
>
>1) Register using? basic_consume on the queue.
>2) Do basic_get from HP Queue
>3)If no messages in HP Queue do a basic_get from LP Queue.
>
>I donot execute start_consuming() so
 the basic_consume is just for the number of consumers count in the RMQ server.
>
>This logic works perfectly fine with the standard Java Client. But when i try to do the same with the Pika Client, the moment the basic_consume is called the data events are processed and the callback function is executed on the incoming message, eventhough the start_consuming() function is not called.
>
>So, a couple of questions here,
>
>1. Is there a way to register as a consumer to a queue without actually starting to consume from the queue (even a hack into the code is fine)
>2. Is it bug that basic_consume() starts consuming without actually calling start_consuming() (the actual blocking function), and should i raise an issue in github regarding this ?
>
>Last but not the least, the version of the rabbitMQ server is 3.1.2 and the pika client, i have tried both 0.9.6 and 0.9.13 with the above scenario.
>
>Thankyou
 everyone,
>Maitreya
>
>
>
>
>
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/b24e1c52/attachment.html>

From simon at rabbitmq.com  Mon Dec  2 10:38:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Dec 2013 10:38:45 +0000
Subject: [rabbitmq-discuss] |Spam| Re: Access www.rabbitmq.com from GCE
 europe-west1
In-Reply-To: <851AAE32BA144D1DB8902B271B355D6D@gmail.com>
References: <1385803142304-31738.post@n5.nabble.com>
 <529A1196.6050300@rabbitmq.com> <851AAE32BA144D1DB8902B271B355D6D@gmail.com>
Message-ID: <529C6335.2010505@rabbitmq.com>

OK. I'm chasing up with our hosting provider.

Cheers, Simon

On 30/11/13 16:27, Carl H?rberg wrote:
> yes, it resolves correctly
>
>
>
> On Saturday 30 November 2013 at 23:25, Simon MacMullen wrote:
>
>> We don't do any range blocking. But the machine has recently moved as
>> Michael said. Are you picking up the correct IP address? (192.240.153.117)
>>
>> If so I will have a word with our new hosting provider...
>>
>> Cheers, Simon
>>
>> On 30/11/2013 9:19AM, carlhoerberg wrote:
>>> Can't access www.rabbitmq.com (http://www.rabbitmq.com) (to download rabbitmq) from Google Compute
>>> Engines instances provisioned in the eu-west1 region (both zone a and b).
>>> Works fine from GCE us-central1 though. The http (and https) connection
>>> times out. Do you do some kind of ip range blocking? Example IPs:
>>> 23.251.128.15
>>> 23.251.128.129
>>> 23.251.128.43
>>>
>>>
>>>
>>> --
>>> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Access-www-rabbitmq-com-from-GCE-europe-west1-tp31738.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com (http://Nabble.com).
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Mon Dec  2 11:56:03 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Mon, 2 Dec 2013 06:56:03 -0500
Subject: [rabbitmq-discuss] Pika Client starts consuming before calling
	start_consuming
In-Reply-To: <1385979930.53880.YahooMailNeo@web192506.mail.sg3.yahoo.com>
References: <1385447109.17717.YahooMailNeo@web192503.mail.sg3.yahoo.com>
 <CAKgmDnFgnz6bRfm+1=K+NHj39e4BHmW5JsX4FEU-wM6Sc1NO1A@mail.gmail.com>
 <1385979930.53880.YahooMailNeo@web192506.mail.sg3.yahoo.com>
Message-ID: <CAKgmDnHC3T-YJ_=vcsR_=m5ceCB=bZzyVwgXU-0JNYA4VqAxrg@mail.gmail.com>

Then you could add a mutex in addition to rate limiting and prefetch
twiddling to insure that batch messages are not processed as long as high
priority messages are available for processing.

Good luck,

Michael


On Mon, Dec 2, 2013 at 5:25 AM, vadlamani maitreya <maitreya_vvm at yahoo.co.in
> wrote:

> Hi Michael,
>
> Thankyou for the response. The application we built infact supports only
> two priorities, ondemand and batch. The problem here is once the ondemand
> message is in queue, it must be processed irrespective of any number of
> batch messages. That is the reason for this weird logic we had to employ.
> For this usecase, I dont think the rate limiting and prefetch count
> variations would actual work. But I will try to play with the asynch
> connections for sure.
>
> regards,
> Maitreya
>
>
>
>
>
>   On Tuesday, 26 November 2013 8:32 PM, "Laing, Michael" <
> michael.laing at nytimes.com> wrote:
>  You say you want a scalable solution. Therefore with pika you should use
> a high-performance asynch connector, i.e. tornado in pika 9.13. So start
> there and follow the examples of using asynch connections - forget the
> blocking connection.
>
> Then you could try this:
>
> To do a simple priority queue I set up 2 queues and bind to both. Usually
> I have one queue that gets big bursts of messages and another, the priority
> one that only gets a few at a time. In this case I just set prefetch_count
> to 1 for both queues and let them interleave. I use acks always.
>
> To give more 'preference' to the priority queue in the above case you can
> increase its prefetch_count, increasing the likelihood that a priority
> message will be ready when the event loop rolls around.
>
> For even more preference you can 'rate limit' the non-priority queue. I do
> this by registering a short timeout after processing each non-priority
> message which does the ack in its callback.
>
> There are much more complicated ways to do this. I prefer simple.
>
> Good luck,
>
> Michael
>
> P.S. You can subscribe to a queue that is not currently bound to anything.
> Once subscribed, you can bind the queue one or more times and catch each
> bind_ok callback to know you are consuming. I'm not sure this is actually
> useful in your case.
>
>
> On Tue, Nov 26, 2013 at 1:25 AM, vadlamani maitreya <
> maitreya_vvm at yahoo.co.in> wrote:
>
> Hello Everyone,
>
> I have a small problem with RMQ and pika client and would like to ask guyz
> here for some help. The situation is as below,
>
> I am using RabbitMQ with the pika clients in a scalable solution. The
> solution requires messaging with two priorities. So every worker (through
> pika client) gets messages from the HighPriority Queue first and then goes
> to the Low Priority queue if there are no messages left in the HP Queue. I
> decide to scale the number of workers according to the number of ready
> messages and the number of consumers attached to the queue. So the
> following is the workflow i follow to achieve the above.
>
> 1) Register using  basic_consume on the queue.
> 2) Do basic_get from HP Queue
> 3)If no messages in HP Queue do a basic_get from LP Queue.
>
> I donot execute start_consuming() so the basic_consume is just for the
> number of consumers count in the RMQ server.
>
> This logic works perfectly fine with the standard Java Client. But when i
> try to do the same with the Pika Client, the moment the basic_consume is
> called the data events are processed and the callback function is executed
> on the incoming message, eventhough the start_consuming() function is not
> called.
>
> So, a couple of questions here,
>
> 1. Is there a way to register as a consumer to a queue without actually
> starting to consume from the queue (even a hack into the code is fine)
> 2. Is it bug that basic_consume() starts consuming without actually
> calling start_consuming() (the actual blocking function), and should i
> raise an issue in github regarding this ?
>
> Last but not the least, the version of the rabbitMQ server is 3.1.2 and
> the pika client, i have tried both 0.9.6 and 0.9.13 with the above scenario.
>
> Thankyou everyone,
> Maitreya
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/f4eebd62/attachment.html>

From marcos.torres at gmail.com  Mon Dec  2 14:02:42 2013
From: marcos.torres at gmail.com (Marcos Torres)
Date: Mon, 2 Dec 2013 12:02:42 -0200
Subject: [rabbitmq-discuss] Help trying to figure it out a Connection
	Shutdown
Message-ID: <CAP4Ah2DxHQ+phnpga46JvubRT51_1ud0iBqwT_F=-hvuMU3+MA@mail.gmail.com>

Hi there,

I'm having some problems with a connection shutdown.

This is the scenario:

1 connection
200+ channels open from the connection mentioned above.

- Some of  those connections are created by a publisher and are closed
after finished publishing.
- The rest are consumer channels, and I have a timeout (using Rx) that
closed a channels after the channel is idle after 300 secs.

This is working so far, but from time my connection closes unexpectedly:

Connection shutdown.* Reason: End of stream. Args: Initiator : Library
ReplyCode : 0  ReplyText : End of stream  ClassId : 0  MethodId : 0  Cause
:    Message : Heartbeat missing with heartbeat == 600 seconds  Data : ...
InnerException : null  TargetSite : null  StackTrace : null  HelpLink :
null  Source : null  HResult : -2147024858  *

I'm using the .NET libraries and RabbitMQ 3.1.0, Erlang R16B

would love to minimize this and know which ones are the best strategies
when creating a connection that must last a lot of time.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/979cfb2f/attachment.html>

From sekhar434145 at gmail.com  Mon Dec  2 14:43:00 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Mon, 2 Dec 2013 20:13:00 +0530
Subject: [rabbitmq-discuss] How to send response back in case of synchronous
	and asynchronous scenarios?
Message-ID: <CAH75Yb4xDHF5q0J8cX3n59x+69mfrhnG1oduGbqjcTPtHdgnNw@mail.gmail.com>

*Synchronous and asynchronous messages request and response -*

1.*Synchronous case - *
I am producing messages (10 requests) to single queue("TestQueue") and at
the consumer end we are able to consume the message from that queue. Code
is as below -

Producer -
amqpTemplate.convertAndSend();

Consumer -
amqpTemplate.receiveAndConvert()

Here, producer expects response for each request, so how can we send
response back to that particular request?

*2 - Asynchronous case - *

Producer -
recordList = (List<Record>)rabbitTemplate.convertSendAndReceive(msg);

Consumer -
Implementing SimpleMessageListenerContainer, where POJO will be listening
to the queue as below -
public List<Record> handleMessage(String msg) {
// something
}

in this case we are getting response and as my understanding this is an
asynchronous approach right? So, here, I am confusing how to send response
back in case synchronous and asynchronous cases? Can anyone please help me
on this.  Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/2f69b5c9/attachment.html>

From emile at rabbitmq.com  Mon Dec  2 15:33:39 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Dec 2013 15:33:39 +0000
Subject: [rabbitmq-discuss] Help trying to figure it out a Connection
 Shutdown
In-Reply-To: <CAP4Ah2DxHQ+phnpga46JvubRT51_1ud0iBqwT_F=-hvuMU3+MA@mail.gmail.com>
References: <CAP4Ah2DxHQ+phnpga46JvubRT51_1ud0iBqwT_F=-hvuMU3+MA@mail.gmail.com>
Message-ID: <529CA853.1090401@rabbitmq.com>


Hi,

On 02/12/13 14:02, Marcos Torres wrote:

> would love to minimize thisand know which ones are the best strategies
> when creating a connection that must last a lot of time.

You should use AMQP heartbeats for connections that will last a long
time, but it looks like you are already doing that. The error message
indicates that no reply to a heartbeat message was received in the
required time. Check in the broker log when the broker thought that
connection terminated. This could happen as a result of a firewall,
load-balancer or network device that maintains a connection for longer
than necessary after the peer has disconnected.



-Emile

From marcos.torres at gmail.com  Mon Dec  2 15:36:47 2013
From: marcos.torres at gmail.com (Marcos Torres)
Date: Mon, 2 Dec 2013 13:36:47 -0200
Subject: [rabbitmq-discuss] Help trying to figure it out a Connection
	Shutdown
In-Reply-To: <529CA853.1090401@rabbitmq.com>
References: <CAP4Ah2DxHQ+phnpga46JvubRT51_1ud0iBqwT_F=-hvuMU3+MA@mail.gmail.com>
 <529CA853.1090401@rabbitmq.com>
Message-ID: <CAP4Ah2CZYybdwp7JLCOJJH_27i58ZBsb4VwEzF+FNptBtgX7qw@mail.gmail.com>

Sorry but I don't fully undestand the heartbeat thing. I'm not setting a
value right now (600 I believe is the default one). Should I increase or
decresea the heartbeat setting when creating the connection?

Thanks!


On Mon, Dec 2, 2013 at 12:33 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 02/12/13 14:02, Marcos Torres wrote:
>
> > would love to minimize thisand know which ones are the best strategies
> > when creating a connection that must last a lot of time.
>
> You should use AMQP heartbeats for connections that will last a long
> time, but it looks like you are already doing that. The error message
> indicates that no reply to a heartbeat message was received in the
> required time. Check in the broker log when the broker thought that
> connection terminated. This could happen as a result of a firewall,
> load-balancer or network device that maintains a connection for longer
> than necessary after the peer has disconnected.
>
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/7b149981/attachment.html>

From emile at rabbitmq.com  Mon Dec  2 15:55:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Dec 2013 15:55:33 +0000
Subject: [rabbitmq-discuss] Help trying to figure it out a Connection
 Shutdown
In-Reply-To: <CAP4Ah2CZYybdwp7JLCOJJH_27i58ZBsb4VwEzF+FNptBtgX7qw@mail.gmail.com>
References: <CAP4Ah2DxHQ+phnpga46JvubRT51_1ud0iBqwT_F=-hvuMU3+MA@mail.gmail.com>
 <529CA853.1090401@rabbitmq.com>
 <CAP4Ah2CZYybdwp7JLCOJJH_27i58ZBsb4VwEzF+FNptBtgX7qw@mail.gmail.com>
Message-ID: <529CAD75.7090904@rabbitmq.com>


On 02/12/13 15:36, Marcos Torres wrote:
> Sorry but I don't fully undestand the heartbeat thing. I'm not setting a
> value right now (600 I believe is the default one). Should I increase or
> decresea the heartbeat setting when creating the connection?

I would suggest lowering the value below the firewall idle connection
timeout. If the firewall uses 10 minutes then set the heartbeat interval
to a slightly lower value, or upgrade to v3.2.1 where the default is 580
seconds.



-Emile


From emile at rabbitmq.com  Mon Dec  2 16:13:34 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Dec 2013 16:13:34 +0000
Subject: [rabbitmq-discuss] How to send response back in case of
 synchronous and asynchronous scenarios?
In-Reply-To: <CAH75Yb4xDHF5q0J8cX3n59x+69mfrhnG1oduGbqjcTPtHdgnNw@mail.gmail.com>
References: <CAH75Yb4xDHF5q0J8cX3n59x+69mfrhnG1oduGbqjcTPtHdgnNw@mail.gmail.com>
Message-ID: <529CB1AE.6090401@rabbitmq.com>

On 02/12/13 14:43, Rajasekhar P wrote:

> Here, producer expects response for each request, so how can we send
> response back to that particular request?

By convention the return queue is entered in the reply-to property of
the message.

> in this case we are getting response and as my understanding this is an
> asynchronous approach right?

handleMessage() is used for asynchronous consumption, yes.

> So, here, I am confusing how to send response back in case
> synchronous and asynchronous cases?

Messages are normally sent asynchronously using publish(). You can make
that a synchronous operation by publishing in a transaction.


Also see the RPC tutorial:
http://www.rabbitmq.com/tutorials/tutorial-six-java.html




-Emile









From breischl at gmail.com  Mon Dec  2 16:18:01 2013
From: breischl at gmail.com (Brian Reischl)
Date: Mon, 2 Dec 2013 08:18:01 -0800 (PST)
Subject: [rabbitmq-discuss] Exclusive queue with no connections still alive
	& locked
Message-ID: <c503eeb4-8840-438a-b05f-bb1d638d653f@googlegroups.com>

I have run into a situation that seems like it should be impossible, 
assuming I understand everything correctly. 

I have created an Exclusive, AutoDelete queue with a client-specified name. 
The queue is undeletable - delete attempts fail with "405 RESOURCE_LOCKED - 
cannot obtain exclusive access to locked queue". However, there there are 
no connections at all to the server. When I go to the Connections tab in 
the admin UI, it says "... no connections ..." The Queue properties in 
Admin UI says "Exclusive Owner: *unknown*" and "Status: Active". There are 
no publishers or consumers listed. So shouldn't the queue have been deleted 
already, since it is Exclusive? 

This is on my dev machine, so it's not a huge problem. I'm wondering if 
this is a bug in the server code, or merely in my understanding of it. I'm 
using RabbitMQ 3.1.3, Erlang R16B01. 

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/51dc2d5b/attachment.html>

From breischl at gmail.com  Mon Dec  2 16:24:07 2013
From: breischl at gmail.com (Brian Reischl)
Date: Mon, 2 Dec 2013 08:24:07 -0800 (PST)
Subject: [rabbitmq-discuss] Configuration strategy
In-Reply-To: <32ad3a77-a339-4055-8a00-8089de403ef1@googlegroups.com>
References: <32ad3a77-a339-4055-8a00-8089de403ef1@googlegroups.com>
Message-ID: <cf933d18-5c81-464c-ba4d-0fb67227b866@googlegroups.com>

You could create all the exchanges, queues and bindings from the admin UI, 
or using some dedicated configurator program or script. Then the actual 
applications could use the Passive forms of the exchange & queue 
declaration functions, which don't require them to know anything beyond the 
names of the queues or exchanges they want to use. 

But I'm certainly no expert, so there may be other options out there. 

On Wednesday, November 27, 2013 2:41:53 PM UTC-7, Adrien Brault wrote:
>
> Hey,
>
> I've read the getting started tutorials and am bothered with one aspect: 
> publishers and consumers configures rabbitmq. I understand that those 
> configuration requests are idempotent, however it seems weird to let the 
> application(s) configure rabbitmq.
>
> I don't think a publisher should be aware of the exchange type, and a 
> consumer should not be aware of bindings. Though I understand that some 
> pattern requires the application to create exchanges/queues/binding (like 
> RPC).
>
> Is there a tool to have some configuration file for the server ?
> My goal would be that publishers only know what kind of message to send to 
> a specific exchange, and consumer know what kind of message to get from a 
> specific queue.
>
> What do you think ? How do you handle the queue/exchange creation and 
> binding logic in big application(s) ?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/a6806f3b/attachment.html>

From breischl at gmail.com  Mon Dec  2 16:25:31 2013
From: breischl at gmail.com (Brian Reischl)
Date: Mon, 2 Dec 2013 08:25:31 -0800 (PST)
Subject: [rabbitmq-discuss] Policy for dead letter exchange routing back
	to queue
In-Reply-To: <db9961bb-e832-4a77-a42b-d3cd400a2362@googlegroups.com>
References: <db9961bb-e832-4a77-a42b-d3cd400a2362@googlegroups.com>
Message-ID: <d99760dc-e1e1-4528-8cf5-15a20e1b2c27@googlegroups.com>

If you're just trying to put the message back on the queue, then why not 
Reject with Requeue=true instead of using dead letter exchanges? 

On Wednesday, November 27, 2013 8:25:57 AM UTC-7, Nicholas Stuart wrote:
>
> I've successfully set up a dead letter exchange policy where the 
> dead-letter-exchange is blank, which will return the message to the 
> original queue. However this only happens if the message was published to 
> the default exchange, or with a routing key of the queue name.
>
> If I set up a fanout or topic exchange, my message is dropped(rightfully 
> so). Is there any way, in the RabbitMQ policy, that I can specify a routing 
> key policy that will always point back to the queue the message was 
> consumed off of?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/41fa7c28/attachment.html>

From simon at rabbitmq.com  Mon Dec  2 16:30:50 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Dec 2013 16:30:50 +0000
Subject: [rabbitmq-discuss] Exclusive queue with no connections still
 alive & locked
In-Reply-To: <c503eeb4-8840-438a-b05f-bb1d638d653f@googlegroups.com>
References: <c503eeb4-8840-438a-b05f-bb1d638d653f@googlegroups.com>
Message-ID: <529CB5BA.3040402@rabbitmq.com>

The queue can take a while to delete itself, especially if it contains 
lots of persistent messages. But the connection goes away immediately. I 
think that's what you're seeing.

In particular the combination "Exclusive Owner: unknown" and "Status: 
Active" makes some sense, as the queue can still be working. You should 
never see the combination "Exclusive Owner: unknown" and "Status: Idle".

Cheers, Simon

On 02/12/13 16:18, Brian Reischl wrote:
> I have run into a situation that seems like it should be impossible,
> assuming I understand everything correctly.
>
> I have created an Exclusive, AutoDelete queue with a client-specified
> name. The queue is undeletable - delete attempts fail with "405
> RESOURCE_LOCKED - cannot obtain exclusive access to locked
> queue". However, there there are no connections at all to the server.
> When I go to the Connections tab in the admin UI, it says "... no
> connections ..." The Queue properties in Admin UI says "Exclusive Owner:
> *unknown*" and "Status: Active". There are no publishers or consumers
> listed. So shouldn't the queue have been deleted already, since it is
> Exclusive?
>
> This is on my dev machine, so it's not a huge problem. I'm wondering if
> this is a bug in the server code, or merely in my understanding of it.
> I'm using RabbitMQ 3.1.3, Erlang R16B01.
>
> Thanks!
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Mon Dec  2 16:33:07 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Dec 2013 16:33:07 +0000
Subject: [rabbitmq-discuss] rabbitmq-c how to set arguments to queue
 after the queue careted?
In-Reply-To: <1385968582244-31749.post@n5.nabble.com>
References: <1385954834161-31747.post@n5.nabble.com>
 <F363D04D-7E18-4508-8FFF-FB456888C618@rabbitmq.com>
 <1385968582244-31749.post@n5.nabble.com>
Message-ID: <529CB643.2070406@rabbitmq.com>



On 02/12/13 07:16, 3k4b251 wrote:
> can    server's  'policy'   command   help  me  to  do  this ?

Policies cannot be used to set queue arguments generally, but you can
set the per-queue message TTL. See the documentation about policy
targets and TTL:

http://www.rabbitmq.com/parameters.html#policies
http://www.rabbitmq.com/ttl.html#per-queue-message-ttl


-Emile



From breischl at gmail.com  Mon Dec  2 16:38:59 2013
From: breischl at gmail.com (Brian Reischl)
Date: Mon, 2 Dec 2013 09:38:59 -0700
Subject: [rabbitmq-discuss] Exclusive queue with no connections still
 alive & locked
In-Reply-To: <529CB5BA.3040402@rabbitmq.com>
References: <c503eeb4-8840-438a-b05f-bb1d638d653f@googlegroups.com>
 <529CB5BA.3040402@rabbitmq.com>
Message-ID: <CAK4+xQYozo4kD6fmrP6VaO9V9tWmGMAoc=DwOOq9VBEPHxTmVg@mail.gmail.com>

Simon,
  Thanks for the info. I'm not sure that was the case here. I don't believe
that any messages had been published to the queue at all, and I'm fairly
sure the queue has existed since last week Wednesday. Perhaps the
connection got hung up in some sort of zombie state?

  In any case, restarting the server seems to have cleared up whatever the
issue was.


On Mon, Dec 2, 2013 at 9:30 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> The queue can take a while to delete itself, especially if it contains
> lots of persistent messages. But the connection goes away immediately. I
> think that's what you're seeing.
>
> In particular the combination "Exclusive Owner: unknown" and "Status:
> Active" makes some sense, as the queue can still be working. You should
> never see the combination "Exclusive Owner: unknown" and "Status: Idle".
>
> Cheers, Simon
>
> On 02/12/13 16:18, Brian Reischl wrote:
>
>> I have run into a situation that seems like it should be impossible,
>> assuming I understand everything correctly.
>>
>> I have created an Exclusive, AutoDelete queue with a client-specified
>> name. The queue is undeletable - delete attempts fail with "405
>> RESOURCE_LOCKED - cannot obtain exclusive access to locked
>> queue". However, there there are no connections at all to the server.
>> When I go to the Connections tab in the admin UI, it says "... no
>> connections ..." The Queue properties in Admin UI says "Exclusive Owner:
>> *unknown*" and "Status: Active". There are no publishers or consumers
>> listed. So shouldn't the queue have been deleted already, since it is
>> Exclusive?
>>
>> This is on my dev machine, so it's not a huge problem. I'm wondering if
>> this is a bug in the server code, or merely in my understanding of it.
>> I'm using RabbitMQ 3.1.3, Erlang R16B01.
>>
>> Thanks!
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/8a67230c/attachment.html>

From nicholasastuart at gmail.com  Mon Dec  2 17:57:29 2013
From: nicholasastuart at gmail.com (Nicholas Stuart)
Date: Mon, 2 Dec 2013 09:57:29 -0800 (PST)
Subject: [rabbitmq-discuss] Policy for dead letter exchange routing back
	to queue
In-Reply-To: <d99760dc-e1e1-4528-8cf5-15a20e1b2c27@googlegroups.com>
References: <db9961bb-e832-4a77-a42b-d3cd400a2362@googlegroups.com>
 <d99760dc-e1e1-4528-8cf5-15a20e1b2c27@googlegroups.com>
Message-ID: <7264f03a-1e8d-4cad-8343-b3178c504695@googlegroups.com>

I forgot that detail in my question. I want a count of how many times it 
has been requeued/failed. x-death provides this to me, but if I set 
requeue=true, I don't get any details like that. 

On Monday, December 2, 2013 10:25:31 AM UTC-6, Brian Reischl wrote:
>
> If you're just trying to put the message back on the queue, then why not 
> Reject with Requeue=true instead of using dead letter exchanges? 
>
> On Wednesday, November 27, 2013 8:25:57 AM UTC-7, Nicholas Stuart wrote:
>>
>> I've successfully set up a dead letter exchange policy where the 
>> dead-letter-exchange is blank, which will return the message to the 
>> original queue. However this only happens if the message was published to 
>> the default exchange, or with a routing key of the queue name.
>>
>> If I set up a fanout or topic exchange, my message is dropped(rightfully 
>> so). Is there any way, in the RabbitMQ policy, that I can specify a routing 
>> key policy that will always point back to the queue the message was 
>> consumed off of?
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/5e07b038/attachment.html>

From nicholasastuart at gmail.com  Mon Dec  2 18:00:30 2013
From: nicholasastuart at gmail.com (Nicholas Stuart)
Date: Mon, 2 Dec 2013 10:00:30 -0800 (PST)
Subject: [rabbitmq-discuss] Atomic nature of sending a message to an
 exchange with multiple bindings of queues
Message-ID: <ef96acae-3479-4fa7-9337-ba83bb5252ef@googlegroups.com>

I could not find any documentation, but I was wondering if routing is 
atomic. An example would be a fanout exchange, where multiple queue's 
around bound to it. If I send a message to that exchange, and something 
happens to the broker, is the publish to those queues guaranteed to be all 
or nothing? 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/a03d044d/attachment.html>

From cwstorm at gmail.com  Mon Dec  2 19:10:22 2013
From: cwstorm at gmail.com (cw storm)
Date: Mon, 2 Dec 2013 14:10:22 -0500
Subject: [rabbitmq-discuss] Noticed way too many open connections
Message-ID: <CAETr1H_vqhnQy8dn3Vh+p7Fv_4ie4g5eYdPWJLPe58EqeHyxzw@mail.gmail.com>

One day, I've noticed that there were about 700+ open connections on the
rabbit mq server.  We couldn't understand as to why and how that happen.
 As far as I know, the client supposedly always perform an open and close
connection once it's successfully complete.  Obviously, somehow the close
connection did not get executed in the client consumer service which lead
me to believe resulted in the open connections.  I'm thinking of adding
setConnectionTimeOut to the open connection service so that if that
connection/channel did not close properly, the rabbit mq server will close
it after the timeout has been reach.  Please let me know if this is best
practice or not.

Thanks,
Phil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/a2d764de/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec  2 19:20:03 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 2 Dec 2013 23:20:03 +0400
Subject: [rabbitmq-discuss] Noticed way too many open connections
In-Reply-To: <CAETr1H_vqhnQy8dn3Vh+p7Fv_4ie4g5eYdPWJLPe58EqeHyxzw@mail.gmail.com>
References: <CAETr1H_vqhnQy8dn3Vh+p7Fv_4ie4g5eYdPWJLPe58EqeHyxzw@mail.gmail.com>
Message-ID: <CAE3HoVRTtFtEDqyR=N3ZW+mcSbdxEd+dQO7QNhQpVdiVdPr_og@mail.gmail.com>

2013/12/2 cw storm <cwstorm at gmail.com>

>  I'm thinking of adding setConnectionTimeOut to the open connection
> service so that if that connection/channel did not close properly, the
> rabbit mq server will close it after the timeout has been reach.  Please
> let me know if this is best practice or not.


setConnectionTimeOut configures a value that's passed to Socket#connect.
What you want to set is heartbeat timeout
(say, to 30-60 seconds). Note that both server and client do not
immediately detect when their peer is unreachable
due to how TCP works (TCP connections will sit there in TIME_WAIT state for
some time). Heartbeats
enable such situations to be detected earlier.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/6c088ddc/attachment.html>

From cwstorm at gmail.com  Mon Dec  2 21:10:37 2013
From: cwstorm at gmail.com (cw storm)
Date: Mon, 2 Dec 2013 16:10:37 -0500
Subject: [rabbitmq-discuss] Noticed way too many open connections
In-Reply-To: <CAE3HoVRTtFtEDqyR=N3ZW+mcSbdxEd+dQO7QNhQpVdiVdPr_og@mail.gmail.com>
References: <CAETr1H_vqhnQy8dn3Vh+p7Fv_4ie4g5eYdPWJLPe58EqeHyxzw@mail.gmail.com>
 <CAE3HoVRTtFtEDqyR=N3ZW+mcSbdxEd+dQO7QNhQpVdiVdPr_og@mail.gmail.com>
Message-ID: <CAETr1H-bAaZPEUL85JHx_8sHdUHQhNXkTWXWZBvsw57MQcNajA@mail.gmail.com>

Thanks Michael.  So if I set heartbeat timeout, if the specific
conn/channel hasn't been closed for a specified time, then the rabbit
server will close that connection/channel, right?  Is there any harm in
putting this in the code?  I want to make sure that this is good practice
and such.

-Phil


On Mon, Dec 2, 2013 at 2:20 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

>
> 2013/12/2 cw storm <cwstorm at gmail.com>
>
>>  I'm thinking of adding setConnectionTimeOut to the open connection
>> service so that if that connection/channel did not close properly, the
>> rabbit mq server will close it after the timeout has been reach.  Please
>> let me know if this is best practice or not.
>
>
> setConnectionTimeOut configures a value that's passed to Socket#connect.
> What you want to set is heartbeat timeout
> (say, to 30-60 seconds). Note that both server and client do not
> immediately detect when their peer is unreachable
> due to how TCP works (TCP connections will sit there in TIME_WAIT state
> for some time). Heartbeats
> enable such situations to be detected earlier.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/2c697574/attachment.html>

From cwstorm at gmail.com  Mon Dec  2 21:13:43 2013
From: cwstorm at gmail.com (cw storm)
Date: Mon, 2 Dec 2013 16:13:43 -0500
Subject: [rabbitmq-discuss] How to check for unack message and how long it's
	been idle
Message-ID: <CAETr1H-Z+V55b4MSO9wEr_fhwmqGBF-zy2t=NMuJqj-jNM9ZGw@mail.gmail.com>

I would like to code for unack message(s) and check to see how long it's
been idle.  Basically, the information that you would see in the management
console (#channels/...)  If the message has been idle for a certain amount
of time, I would like to "recover" or "requeue" it so it can be back to
ready status to be consume again.  Is this possible?

-Phil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/ddaf9cb1/attachment.html>

From mahi.rabbitmq at gmail.com  Mon Dec  2 21:49:55 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Mon, 2 Dec 2013 13:49:55 -0800
Subject: [rabbitmq-discuss] queue properties
In-Reply-To: <529716B0.30108@rabbitmq.com>
References: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>
 <838F5DE4-2822-436C-80AB-96F5472005CF@rabbitmq.com>
 <52947169.8080808@rabbitmq.com>
 <CAGOpLV52oa1eT3FhVw-WOmsH8h_KA8kr2HF06ar9Y8QNVivz3Q@mail.gmail.com>
 <529716B0.30108@rabbitmq.com>
Message-ID: <CAGOpLV7OALc3a-mgRLwvBEyPz98Wqdk_6a1q6c=6AAYsU3sZWQ@mail.gmail.com>

Hi ,

My RabbitMQ server is up and running since from 5 days is there any way to
check how many messages consumed from queues.

Thanks


On Thu, Nov 28, 2013 at 2:10 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 27/11/13 19:14, mahi e wrote:
>
>> how can we get messages rates in queues
>>
>
> Look in message_stats.publish_details.rate, message_stats.deliver_details.rate,
> etc.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/59b26e47/attachment.html>

From mklishin at gopivotal.com  Mon Dec  2 21:59:38 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 3 Dec 2013 01:59:38 +0400
Subject: [rabbitmq-discuss] Noticed way too many open connections
In-Reply-To: <CAETr1H-bAaZPEUL85JHx_8sHdUHQhNXkTWXWZBvsw57MQcNajA@mail.gmail.com>
References: <CAETr1H_vqhnQy8dn3Vh+p7Fv_4ie4g5eYdPWJLPe58EqeHyxzw@mail.gmail.com>
 <CAE3HoVRTtFtEDqyR=N3ZW+mcSbdxEd+dQO7QNhQpVdiVdPr_og@mail.gmail.com>
 <CAETr1H-bAaZPEUL85JHx_8sHdUHQhNXkTWXWZBvsw57MQcNajA@mail.gmail.com>
Message-ID: <8784ACF7-7710-47ED-B982-542EC29B66BF@rabbitmq.com>


On 3 Dec 2013, at 01:10, cw storm <cwstorm at gmail.com> wrote:

> So if I set heartbeat timeout, if the specific conn/channel hasn't been closed for a specified time, then the rabbit server will close that connection/channel, right?  Is there any harm in putting this in the code?  I want to make sure that this is good practice and such.

Hearbeats allow RabbitMQ and compliant clients detect peer disappearance quicker
(than via TCP connection closure). It only affects connections.

There is no harm in using heartbeats, just make sure that the value is not too high
or two low. Lower values means quicker connection loss detection but increase network traffic
and slightly increase server load per connection.
Heartbeat frames will be sent at roughly half the interval (so, if the timeout is set to
100 seconds, a little bit of data will be sent every ~50 seconds from both ends). After
two missed heartbeats (full interval duration), RabbitMQ will consider the connection closed.

Unless you have hundreds of connections, any value between 60 and 180 should be fine.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Mon Dec  2 22:01:27 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 3 Dec 2013 02:01:27 +0400
Subject: [rabbitmq-discuss] How to check for unack message and how long
	it's been idle
In-Reply-To: <CAETr1H-Z+V55b4MSO9wEr_fhwmqGBF-zy2t=NMuJqj-jNM9ZGw@mail.gmail.com>
References: <CAETr1H-Z+V55b4MSO9wEr_fhwmqGBF-zy2t=NMuJqj-jNM9ZGw@mail.gmail.com>
Message-ID: <8CF223B4-BF64-42FC-AEAE-C166155EA886@rabbitmq.com>


On 3 Dec 2013, at 01:13, cw storm <cwstorm at gmail.com> wrote:

>  If the message has been idle for a certain amount of time, I would like to "recover" or "requeue" it so it can be back to ready status to be consume again.  Is this possible?

If by ?idle? you mean ?how long ago a message was delivered?, then no, there is no way to track this
for individual messages.

You can, however, set the timestamp property when messages are published and/or track delivery time in
your consumers. This may be sufficient for detecting messages that take too long to process.

MK

Software Engineer, Pivotal/RabbitMQ



From cwstorm at gmail.com  Mon Dec  2 22:13:59 2013
From: cwstorm at gmail.com (cw storm)
Date: Mon, 2 Dec 2013 17:13:59 -0500
Subject: [rabbitmq-discuss] Noticed way too many open connections
In-Reply-To: <8784ACF7-7710-47ED-B982-542EC29B66BF@rabbitmq.com>
References: <CAETr1H_vqhnQy8dn3Vh+p7Fv_4ie4g5eYdPWJLPe58EqeHyxzw@mail.gmail.com>
 <CAE3HoVRTtFtEDqyR=N3ZW+mcSbdxEd+dQO7QNhQpVdiVdPr_og@mail.gmail.com>
 <CAETr1H-bAaZPEUL85JHx_8sHdUHQhNXkTWXWZBvsw57MQcNajA@mail.gmail.com>
 <8784ACF7-7710-47ED-B982-542EC29B66BF@rabbitmq.com>
Message-ID: <CAETr1H_GoHUCxNKC0diuruHdQuFVmFD92ORCjj1jt8E6HNMtEw@mail.gmail.com>

We will have approximately 300 open active connections due to the shovel
configurations setup.  These are the IN/OUT queues setup.  I have a
consumer service on the client side that'll open the conn/channel, get
messages from the queue,  ack it, and then close the connection.  If the
client fail to issue the close connection service, RabbitMQ should close
that specific channel/connection if I set the "setRequestedHeartBeat" in
the open connection service, right?


On Mon, Dec 2, 2013 at 4:59 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> On 3 Dec 2013, at 01:10, cw storm <cwstorm at gmail.com> wrote:
>
> > So if I set heartbeat timeout, if the specific conn/channel hasn't been
> closed for a specified time, then the rabbit server will close that
> connection/channel, right?  Is there any harm in putting this in the code?
>  I want to make sure that this is good practice and such.
>
> Hearbeats allow RabbitMQ and compliant clients detect peer disappearance
> quicker
> (than via TCP connection closure). It only affects connections.
>
> There is no harm in using heartbeats, just make sure that the value is not
> too high
> or two low. Lower values means quicker connection loss detection but
> increase network traffic
> and slightly increase server load per connection.
> Heartbeat frames will be sent at roughly half the interval (so, if the
> timeout is set to
> 100 seconds, a little bit of data will be sent every ~50 seconds from both
> ends). After
> two missed heartbeats (full interval duration), RabbitMQ will consider the
> connection closed.
>
> Unless you have hundreds of connections, any value between 60 and 180
> should be fine.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/ee624a19/attachment.html>

From mklishin at gopivotal.com  Mon Dec  2 22:21:57 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 3 Dec 2013 02:21:57 +0400
Subject: [rabbitmq-discuss] Noticed way too many open connections
In-Reply-To: <CAETr1H_GoHUCxNKC0diuruHdQuFVmFD92ORCjj1jt8E6HNMtEw@mail.gmail.com>
References: <CAETr1H_vqhnQy8dn3Vh+p7Fv_4ie4g5eYdPWJLPe58EqeHyxzw@mail.gmail.com>
 <CAE3HoVRTtFtEDqyR=N3ZW+mcSbdxEd+dQO7QNhQpVdiVdPr_og@mail.gmail.com>
 <CAETr1H-bAaZPEUL85JHx_8sHdUHQhNXkTWXWZBvsw57MQcNajA@mail.gmail.com>
 <8784ACF7-7710-47ED-B982-542EC29B66BF@rabbitmq.com>
 <CAETr1H_GoHUCxNKC0diuruHdQuFVmFD92ORCjj1jt8E6HNMtEw@mail.gmail.com>
Message-ID: <42D2DFA7-C94D-4CF0-ABC0-F2B6398DBAE1@rabbitmq.com>

On 3 Dec 2013, at 02:13, cw storm <cwstorm at gmail.com> wrote:

> If the client fail to issue the close connection service, RabbitMQ should close that specific channel/connection if I set the "setRequestedHeartBeat" in the open connection service, right?

Correct, after [timeout you configure] seconds.

NB: heartbeats do not apply to channels. When a connection
is closed, all channels on it are considered to be closed.

MK

Software Engineer, Pivotal/RabbitMQ



From mahi.rabbitmq at gmail.com  Mon Dec  2 23:17:27 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Mon, 2 Dec 2013 15:17:27 -0800
Subject: [rabbitmq-discuss] RabbitMQ questions
Message-ID: <CAGOpLV7GJW=MfNDqfNn3pr9gJ0xAT8wmQu2X4vDAvDZWTa9Jcw@mail.gmail.com>

Hi


Need to understand the meaning of each of the parameters below  that are
provided by rabbitmqadmin


|        name         | backing_queue_status.avg_ingress_rate |
messages_details.rate | backing_queue_status.avg_egress_rate | consumers |
exclusive_consumer_tag | messages | messages_ready |
messages_ready_details.rate | messages_unacknowledged |
messages_unacknowledged_details.rate |
backing_queue_status.avg_ack_egress_rate |
backing_queue_status.avg_ack_ingress_rate |
backing_queue_status.avg_egress_rate |
backing_queue_status.avg_ingress_rate | backing_queue_status.delta |
backing_queue_status.len | backing_queue_status.next_seq_id |
backing_queue_status.persistent_count | backing_queue_status.q1 |
backing_queue_status.q2 | backing_queue_status.q3 | backing_queue_status.q4
| backing_queue_status.ram_ack_count | backing_queue_status.ram_msg_count |
messages | memory |



IE:

messages: is it the current number of messages in the queue

memory: is it the current amount of memory in use by the queue (does it not
account for messages that have been paged out to disk? we see that memory
decreases even if messages have not been consumed. Does it page out to disk
even if messages are not set to persistent? When does it page out to disk?)



How do we identify how much memory+disk space messages in a certain queue
are consuming?



When consumers are active and messages are flowing in/out of the queue
almost instantaneously how can we tell how many messages have gone through
the queue. IE number of messages through a certain queue since Rabbit was
started or number of messages through a queue in the last 10minutes or such?



Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/2f53a484/attachment.html>

From cwstorm at gmail.com  Tue Dec  3 02:06:02 2013
From: cwstorm at gmail.com (cw storm)
Date: Mon, 2 Dec 2013 21:06:02 -0500
Subject: [rabbitmq-discuss] Noticed way too many open connections
In-Reply-To: <42D2DFA7-C94D-4CF0-ABC0-F2B6398DBAE1@rabbitmq.com>
References: <CAETr1H_vqhnQy8dn3Vh+p7Fv_4ie4g5eYdPWJLPe58EqeHyxzw@mail.gmail.com>
 <CAE3HoVRTtFtEDqyR=N3ZW+mcSbdxEd+dQO7QNhQpVdiVdPr_og@mail.gmail.com>
 <CAETr1H-bAaZPEUL85JHx_8sHdUHQhNXkTWXWZBvsw57MQcNajA@mail.gmail.com>
 <8784ACF7-7710-47ED-B982-542EC29B66BF@rabbitmq.com>
 <CAETr1H_GoHUCxNKC0diuruHdQuFVmFD92ORCjj1jt8E6HNMtEw@mail.gmail.com>
 <42D2DFA7-C94D-4CF0-ABC0-F2B6398DBAE1@rabbitmq.com>
Message-ID: <CAETr1H-MTkALEKnOax54e5FFNKt0ruC0gnswTvTQa4WVGeyFBA@mail.gmail.com>

Thanks for the timely response Michael.  I hope this does work.

-Phil


On Mon, Dec 2, 2013 at 5:21 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 3 Dec 2013, at 02:13, cw storm <cwstorm at gmail.com> wrote:
>
> > If the client fail to issue the close connection service, RabbitMQ
> should close that specific channel/connection if I set the
> "setRequestedHeartBeat" in the open connection service, right?
>
> Correct, after [timeout you configure] seconds.
>
> NB: heartbeats do not apply to channels. When a connection
> is closed, all channels on it are considered to be closed.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131202/4485682c/attachment.html>

From 314992959 at qq.com  Tue Dec  3 07:54:25 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 2 Dec 2013 23:54:25 -0800 (PST)
Subject: [rabbitmq-discuss] how the  bug  25827 going ?
Message-ID: <1386057265607-31778.post@n5.nabble.com>

I  try  to  create  more  than  100000 queues  in  one  rabbtimq server ?   
It  seems   very  hard  to   start up.    took  too  much  time  and   seems 
never   success?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/how-the-bug-25827-going-tp31778.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Tue Dec  3 08:18:19 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 3 Dec 2013 08:18:19 +0000
Subject: [rabbitmq-discuss] Atomic nature of sending a message to an
	exchange with multiple bindings of queues
In-Reply-To: <ef96acae-3479-4fa7-9337-ba83bb5252ef@googlegroups.com>
References: <ef96acae-3479-4fa7-9337-ba83bb5252ef@googlegroups.com>
Message-ID: <F22DEF6A-7410-4CF1-B105-D8243007AC68@rabbitmq.com>

There are no atomicity guarantees around exchanges publishing to queues in the AMQP specification, nor does RabbitMQ make any specific claims about this. If you want your clients to know when messages have been successfully routed, then consider using publisher confirms (http://www.rabbitmq.com/confirms.html), or transactions. Note that RabbitMQ provides limited atomicity guarantees even under transactional use - see http://www.rabbitmq.com/semantics.html for further details.

Cheers,
Tim 

On 2 Dec 2013, at 18:00, Nicholas Stuart wrote:

> I could not find any documentation, but I was wondering if routing is atomic. An example would be a fanout exchange, where multiple queue's around bound to it. If I send a message to that exchange, and something happens to the broker, is the publish to those queues guaranteed to be all or nothing? 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue Dec  3 08:23:36 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 3 Dec 2013 08:23:36 +0000
Subject: [rabbitmq-discuss] how the  bug  25827 going ?
In-Reply-To: <1386057265607-31778.post@n5.nabble.com>
References: <1386057265607-31778.post@n5.nabble.com>
Message-ID: <39B915BA-99CA-45B5-AED3-7508539EDE72@rabbitmq.com>

We have a fix and it should be included in a future release. Not sure when that will be, but will try and remember to post back when it becomes available in the nightly builds.

Cheers,
Tim

On 3 Dec 2013, at 07:54, 3k4b251 wrote:

> I  try  to  create  more  than  100000 queues  in  one  rabbtimq server ?   
> It  seems   very  hard  to   start up.    took  too  much  time  and   seems 
> never   success?
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/how-the-bug-25827-going-tp31778.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From pa at zid.nu  Tue Dec  3 09:46:56 2013
From: pa at zid.nu (pann)
Date: Tue, 3 Dec 2013 01:46:56 -0800 (PST)
Subject: [rabbitmq-discuss] durable queues on fanout exchange not durable
Message-ID: <1386064016660-31781.post@n5.nabble.com>

Hi,

I am having trouble getting my queues durable on my fanout exchange.
What I am trying to accomplish is the following:

* One producer, submitting messages to the exchange. The producer is not
aware of how many subscribers there will be.
* Multiple subscribers that creates their on queues. These queues should be
durable. If a subscriber needs to be restarted, the queue should survive in
order not to lose the messages.

The problem is that the queues do not survive the restart unless they are
also declared on the producer side. However that is not possible since the
producer is not aware of how many consumers there will be.

The queues are created on the consumer side like this:
$ch->queue_declare($queue, false, true, false, false);
$ch->exchange_declare($exchange, 'fanout', false, true, false);
$ch->queue_bind($queue, $exchange);

and I only declare the exchange on the producer side:
$ch->exchange_declare($exchange, 'fanout', false, true, false);

I am probably missing something rather simple, but I have not been able to
find the answer by googling the problem.

/PA






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/durable-queues-on-fanout-exchange-not-durable-tp31781.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From woodslee at 126.com  Tue Dec  3 10:02:04 2013
From: woodslee at 126.com (woodslee)
Date: Tue, 3 Dec 2013 18:02:04 +0800
Subject: [rabbitmq-discuss] durable queues on fanout exchange not durable
References: <1386064016660-31781.post@n5.nabble.com>
Message-ID: <DM__131203175522_21085036523@smtp.126.com>

Hi pann

I think this is impossible.
If you declared a durable queue, whatever in producer or comsumer,once it is declared, it will be persistent in disk,and even you need not declare it later anymore.
I think you can view the state of the queue in rabbitMQ web UI. If it is durable, the flag will be the letter of "D"

----- Original Message ----- 
From: pann 
To: rabbitmq-discuss 
Sent: 2013-12-03, 17:46:56
Subject: [rabbitmq-discuss] durable queues on fanout exchange not durable


Hi,

I am having trouble getting my queues durable on my fanout exchange.
What I am trying to accomplish is the following:

* One producer, submitting messages to the exchange. The producer is not
aware of how many subscribers there will be.
* Multiple subscribers that creates their on queues. These queues should be
durable. If a subscriber needs to be restarted, the queue should survive in
order not to lose the messages.

The problem is that the queues do not survive the restart unless they are
also declared on the producer side. However that is not possible since the
producer is not aware of how many consumers there will be.

The queues are created on the consumer side like this:
$ch->queue_declare($queue, false, true, false, false);
$ch->exchange_declare($exchange, 'fanout', false, true, false);
$ch->queue_bind($queue, $exchange);

and I only declare the exchange on the producer side:
$ch->exchange_declare($exchange, 'fanout', false, true, false);

I am probably missing something rather simple, but I have not been able to
find the answer by googling the problem.

/PA






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/durable-queues-on-fanout-exchange-not-durable-tp31781.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/ab286b4e/attachment.html>

From luis.rascao at gmail.com  Tue Dec  3 11:19:45 2013
From: luis.rascao at gmail.com (=?UTF-8?Q?Luis_Rasc=C3=A3o?=)
Date: Tue, 3 Dec 2013 03:19:45 -0800 (PST)
Subject: [rabbitmq-discuss] Message distribution policy
Message-ID: <c6c76ab6-6d9f-4fa5-8bfe-a37dc87da450@googlegroups.com>

Hi all,
Supose you have 3 processes consuming messages from a queue, i guess by 
default the messages will be distributed to the consumers in a round-robin 
fashion (p1, p2, p3, p1, etc). Is there a way to change this distribution 
policy so that always the first free process handles the message? For 
example if p1 is always available then it would handle all the queued 
messages.
thanks in advance
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/53e97f6c/attachment.html>

From simon at rabbitmq.com  Tue Dec  3 11:23:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Dec 2013 11:23:28 +0000
Subject: [rabbitmq-discuss] Message distribution policy
In-Reply-To: <c6c76ab6-6d9f-4fa5-8bfe-a37dc87da450@googlegroups.com>
References: <c6c76ab6-6d9f-4fa5-8bfe-a37dc87da450@googlegroups.com>
Message-ID: <529DBF30.5010801@rabbitmq.com>

Is this what you are looking for?

http://www.rabbitmq.com/consumer-priority.html

Cheers, Simon

On 03/12/13 11:19, Luis Rasc?o wrote:
> Hi all,
> Supose you have 3 processes consuming messages from a queue, i guess by
> default the messages will be distributed to the consumers in a
> round-robin fashion (p1, p2, p3, p1, etc). Is there a way to change this
> distribution policy so that always the first free process handles the
> message? For example if p1 is always available then it would handle all
> the queued messages.
> thanks in advance
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From luis.rascao at gmail.com  Tue Dec  3 11:27:45 2013
From: luis.rascao at gmail.com (=?ISO-8859-1?Q?Luis_Rasc=E3o?=)
Date: Tue, 3 Dec 2013 11:27:45 +0000
Subject: [rabbitmq-discuss] Message distribution policy
In-Reply-To: <529DBF30.5010801@rabbitmq.com>
References: <c6c76ab6-6d9f-4fa5-8bfe-a37dc87da450@googlegroups.com>
 <529DBF30.5010801@rabbitmq.com>
Message-ID: <CAGFUVW_e2mqb6Bx+3EO_XcnpNSupBrWkfxvVG18rLuC79mUSeQ@mail.gmail.com>

If i understood correctly multiple consumers with the same high priority
will receive the messages in round-robin.
This is easier if the processes were different binaries, they are in fact
the same binary, to use priorities i would have to attribute higher
priorities as i launch the multiple instances of the binary, is there some
other way?



On Tue, Dec 3, 2013 at 11:23 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Is this what you are looking for?
>
> http://www.rabbitmq.com/consumer-priority.html
>
> Cheers, Simon
>
> On 03/12/13 11:19, Luis Rasc?o wrote:
>
>> Hi all,
>> Supose you have 3 processes consuming messages from a queue, i guess by
>> default the messages will be distributed to the consumers in a
>> round-robin fashion (p1, p2, p3, p1, etc). Is there a way to change this
>> distribution policy so that always the first free process handles the
>> message? For example if p1 is always available then it would handle all
>> the queued messages.
>> thanks in advance
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/e89c4bba/attachment.html>

From simon at rabbitmq.com  Tue Dec  3 11:31:20 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Dec 2013 11:31:20 +0000
Subject: [rabbitmq-discuss] Message distribution policy
In-Reply-To: <CAGFUVW_e2mqb6Bx+3EO_XcnpNSupBrWkfxvVG18rLuC79mUSeQ@mail.gmail.com>
References: <c6c76ab6-6d9f-4fa5-8bfe-a37dc87da450@googlegroups.com>
 <529DBF30.5010801@rabbitmq.com>
 <CAGFUVW_e2mqb6Bx+3EO_XcnpNSupBrWkfxvVG18rLuC79mUSeQ@mail.gmail.com>
Message-ID: <529DC108.30605@rabbitmq.com>

These are not OS priorities - the priority is set by an argument to the 
basic.consume method. Multiple consumers within the same OS process can 
have different priorities.

Cheers, Simon

On 03/12/13 11:27, Luis Rasc?o wrote:
> If i understood correctly multiple consumers with the same high priority
> will receive the messages in round-robin.
> This is easier if the processes were different binaries, they are in
> fact the same binary, to use priorities i would have to attribute higher
> priorities as i launch the multiple instances of the binary, is there
> some other way?
>
>
>
> On Tue, Dec 3, 2013 at 11:23 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Is this what you are looking for?
>
>     http://www.rabbitmq.com/__consumer-priority.html
>     <http://www.rabbitmq.com/consumer-priority.html>
>
>     Cheers, Simon
>
>     On 03/12/13 11:19, Luis Rasc?o wrote:
>
>         Hi all,
>         Supose you have 3 processes consuming messages from a queue, i
>         guess by
>         default the messages will be distributed to the consumers in a
>         round-robin fashion (p1, p2, p3, p1, etc). Is there a way to
>         change this
>         distribution policy so that always the first free process
>         handles the
>         message? For example if p1 is always available then it would
>         handle all
>         the queued messages.
>         thanks in advance
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From luis.rascao at gmail.com  Tue Dec  3 11:35:07 2013
From: luis.rascao at gmail.com (=?ISO-8859-1?Q?Luis_Rasc=E3o?=)
Date: Tue, 3 Dec 2013 11:35:07 +0000
Subject: [rabbitmq-discuss] Message distribution policy
In-Reply-To: <529DC108.30605@rabbitmq.com>
References: <c6c76ab6-6d9f-4fa5-8bfe-a37dc87da450@googlegroups.com>
 <529DBF30.5010801@rabbitmq.com>
 <CAGFUVW_e2mqb6Bx+3EO_XcnpNSupBrWkfxvVG18rLuC79mUSeQ@mail.gmail.com>
 <529DC108.30605@rabbitmq.com>
Message-ID: <CAGFUVW8Pdf_Lr9wE2teM7Fh=e6D9htBhfVgRL+UXSbd8F=BUqA@mail.gmail.com>

I was referring to the rabbit priorities, in my scenario i have a process
consumer.exe that connects to rabbit and consumes messages from a queue,
suppose i launch this process 5 times, i end up with 5 consumers for the
queue, if i specify the same priority for all of them they will end up
receiving the messages in round robin, because that's the way rabbit
distributes them.
What i'm looking for is a way to tell rabbit to forget about round robin
and just send the message to the first process in it's list that's
available for processing


On Tue, Dec 3, 2013 at 11:31 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> These are not OS priorities - the priority is set by an argument to the
> basic.consume method. Multiple consumers within the same OS process can
> have different priorities.
>
> Cheers, Simon
>
>
> On 03/12/13 11:27, Luis Rasc?o wrote:
>
>> If i understood correctly multiple consumers with the same high priority
>> will receive the messages in round-robin.
>> This is easier if the processes were different binaries, they are in
>> fact the same binary, to use priorities i would have to attribute higher
>> priorities as i launch the multiple instances of the binary, is there
>> some other way?
>>
>>
>>
>> On Tue, Dec 3, 2013 at 11:23 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Is this what you are looking for?
>>
>>     http://www.rabbitmq.com/__consumer-priority.html
>>
>>     <http://www.rabbitmq.com/consumer-priority.html>
>>
>>     Cheers, Simon
>>
>>     On 03/12/13 11:19, Luis Rasc?o wrote:
>>
>>         Hi all,
>>         Supose you have 3 processes consuming messages from a queue, i
>>         guess by
>>         default the messages will be distributed to the consumers in a
>>         round-robin fashion (p1, p2, p3, p1, etc). Is there a way to
>>         change this
>>         distribution policy so that always the first free process
>>         handles the
>>         message? For example if p1 is always available then it would
>>         handle all
>>         the queued messages.
>>         thanks in advance
>>
>>
>>         _________________________________________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbitmq.com
>>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__
>> rabbitmq-discuss
>>
>>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/
>> rabbitmq-discuss>
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, Pivotal
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/52a1815e/attachment.html>

From woodslee at 126.com  Tue Dec  3 11:43:50 2013
From: woodslee at 126.com (woodslee)
Date: Tue, 3 Dec 2013 19:43:50 +0800
Subject: [rabbitmq-discuss] How messages route in a cluster
Message-ID: <DM__131203192900_40158665256@smtp.126.com>

Hi all:

I have a cluster with tree node:
rabbit at host1 rabbit at host2 rabbit at host3
   
there is a queue named Q1 locate in rabbit at host3,
when i published a message to queue Q1, I have connected to rabbit at host1,
now, i want to know the detail of how this message is routed to Q1.

here is my guess:

first, message arrived in rabbit at host1, and because rabbit at host1 know the 
location where the Q1 is, and the message will be send to rabbit at host3 by rabbit at host1.

but,if i use publish confirm, the confirm infomation is sent from:
1. rabbit at host3 send the confirm to rabbit at host1, and rabbit at host1 send confirm to the publisher.
2. rabbit at host3 send the confirm to the publisher directly.

Is this right?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/b13e2ca5/attachment.html>

From simon at rabbitmq.com  Tue Dec  3 12:02:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Dec 2013 12:02:44 +0000
Subject: [rabbitmq-discuss] How messages route in a cluster
In-Reply-To: <DM__131203192900_40158665256@smtp.126.com>
References: <DM__131203192900_40158665256@smtp.126.com>
Message-ID: <529DC864.50107@rabbitmq.com>

On 03/12/13 11:43, woodslee wrote:
> first, message arrived in rabbit at host1, and
> because rabbit at host1 know the
> location where the Q1 is, and the message will be send to rabbit at host3
> by rabbit at host1 .

Yes.

> but,if i use publish confirm, the confirm infomation is sent from:
> 1. rabbit at host3 send the confirm to rabbit at host1
> , and rabbit at host1 send  confirm to the publisher.

Yes.

> 2. rabbit at host3 send the confirm to the publisher
> directly.

No - the publisher is not connected to rabbit at host3 so there's no way we 
could do this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Dec  3 12:04:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Dec 2013 12:04:54 +0000
Subject: [rabbitmq-discuss] Message distribution policy
In-Reply-To: <CAGFUVW8Pdf_Lr9wE2teM7Fh=e6D9htBhfVgRL+UXSbd8F=BUqA@mail.gmail.com>
References: <c6c76ab6-6d9f-4fa5-8bfe-a37dc87da450@googlegroups.com>
 <529DBF30.5010801@rabbitmq.com>
 <CAGFUVW_e2mqb6Bx+3EO_XcnpNSupBrWkfxvVG18rLuC79mUSeQ@mail.gmail.com>
 <529DC108.30605@rabbitmq.com>
 <CAGFUVW8Pdf_Lr9wE2teM7Fh=e6D9htBhfVgRL+UXSbd8F=BUqA@mail.gmail.com>
Message-ID: <529DC8E6.7000608@rabbitmq.com>

You'd need to configure the consumer processes to take the consumer 
priority they should use from a command line parameter or similar then.

It's not really possible to say "the first process in it's list that's 
available for processing" since the consumers are not considered to be 
in any order (except priority order) within RabbitMQ.

Cheers, Simon

On 03/12/13 11:35, Luis Rasc?o wrote:
> I was referring to the rabbit priorities, in my scenario i have a
> process consumer.exe that connects to rabbit and consumes messages from
> a queue, suppose i launch this process 5 times, i end up with 5
> consumers for the queue, if i specify the same priority for all of them
> they will end up receiving the messages in round robin, because that's
> the way rabbit distributes them.
> What i'm looking for is a way to tell rabbit to forget about round robin
> and just send the message to the first process in it's list that's
> available for processing
>
>
> On Tue, Dec 3, 2013 at 11:31 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     These are not OS priorities - the priority is set by an argument to
>     the basic.consume method. Multiple consumers within the same OS
>     process can have different priorities.
>
>     Cheers, Simon
>
>
>     On 03/12/13 11:27, Luis Rasc?o wrote:
>
>         If i understood correctly multiple consumers with the same high
>         priority
>         will receive the messages in round-robin.
>         This is easier if the processes were different binaries, they are in
>         fact the same binary, to use priorities i would have to
>         attribute higher
>         priorities as i launch the multiple instances of the binary, is
>         there
>         some other way?
>
>
>
>         On Tue, Dec 3, 2013 at 11:23 AM, Simon MacMullen
>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>              Is this what you are looking for?
>
>         http://www.rabbitmq.com/____consumer-priority.html
>         <http://www.rabbitmq.com/__consumer-priority.html>
>
>              <http://www.rabbitmq.com/__consumer-priority.html
>         <http://www.rabbitmq.com/consumer-priority.html>>
>
>              Cheers, Simon
>
>              On 03/12/13 11:19, Luis Rasc?o wrote:
>
>                  Hi all,
>                  Supose you have 3 processes consuming messages from a
>         queue, i
>                  guess by
>                  default the messages will be distributed to the
>         consumers in a
>                  round-robin fashion (p1, p2, p3, p1, etc). Is there a
>         way to
>                  change this
>                  distribution policy so that always the first free process
>                  handles the
>                  message? For example if p1 is always available then it
>         would
>                  handle all
>                  the queued messages.
>                  thanks in advance
>
>
>                  ___________________________________________________
>                  rabbitmq-discuss mailing list
>                  rabbitmq-discuss at lists.__rabbi__tmq.com
>         <http://rabbitmq.com>
>                  <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>
>
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>
>
>
>
>              --
>              Simon MacMullen
>              RabbitMQ, Pivotal
>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From luis.rascao at gmail.com  Tue Dec  3 12:14:46 2013
From: luis.rascao at gmail.com (=?ISO-8859-1?Q?Luis_Rasc=E3o?=)
Date: Tue, 3 Dec 2013 12:14:46 +0000
Subject: [rabbitmq-discuss] Message distribution policy
In-Reply-To: <529DC8E6.7000608@rabbitmq.com>
References: <c6c76ab6-6d9f-4fa5-8bfe-a37dc87da450@googlegroups.com>
 <529DBF30.5010801@rabbitmq.com>
 <CAGFUVW_e2mqb6Bx+3EO_XcnpNSupBrWkfxvVG18rLuC79mUSeQ@mail.gmail.com>
 <529DC108.30605@rabbitmq.com>
 <CAGFUVW8Pdf_Lr9wE2teM7Fh=e6D9htBhfVgRL+UXSbd8F=BUqA@mail.gmail.com>
 <529DC8E6.7000608@rabbitmq.com>
Message-ID: <CAGFUVW93QaTwXduXv2yteztKa4_tV2BM64dVFygVt7Y5b5D0xw@mail.gmail.com>

Got it, thanks for the clarifications!
On Dec 3, 2013 12:05 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

> You'd need to configure the consumer processes to take the consumer
> priority they should use from a command line parameter or similar then.
>
> It's not really possible to say "the first process in it's list that's
> available for processing" since the consumers are not considered to be in
> any order (except priority order) within RabbitMQ.
>
> Cheers, Simon
>
> On 03/12/13 11:35, Luis Rasc?o wrote:
>
>> I was referring to the rabbit priorities, in my scenario i have a
>> process consumer.exe that connects to rabbit and consumes messages from
>> a queue, suppose i launch this process 5 times, i end up with 5
>> consumers for the queue, if i specify the same priority for all of them
>> they will end up receiving the messages in round robin, because that's
>> the way rabbit distributes them.
>> What i'm looking for is a way to tell rabbit to forget about round robin
>> and just send the message to the first process in it's list that's
>> available for processing
>>
>>
>> On Tue, Dec 3, 2013 at 11:31 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     These are not OS priorities - the priority is set by an argument to
>>     the basic.consume method. Multiple consumers within the same OS
>>     process can have different priorities.
>>
>>     Cheers, Simon
>>
>>
>>     On 03/12/13 11:27, Luis Rasc?o wrote:
>>
>>         If i understood correctly multiple consumers with the same high
>>         priority
>>         will receive the messages in round-robin.
>>         This is easier if the processes were different binaries, they are
>> in
>>         fact the same binary, to use priorities i would have to
>>         attribute higher
>>         priorities as i launch the multiple instances of the binary, is
>>         there
>>         some other way?
>>
>>
>>
>>         On Tue, Dec 3, 2013 at 11:23 AM, Simon MacMullen
>>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>
>>              Is this what you are looking for?
>>
>>         http://www.rabbitmq.com/____consumer-priority.html
>>         <http://www.rabbitmq.com/__consumer-priority.html>
>>
>>              <http://www.rabbitmq.com/__consumer-priority.html
>>         <http://www.rabbitmq.com/consumer-priority.html>>
>>
>>              Cheers, Simon
>>
>>              On 03/12/13 11:19, Luis Rasc?o wrote:
>>
>>                  Hi all,
>>                  Supose you have 3 processes consuming messages from a
>>         queue, i
>>                  guess by
>>                  default the messages will be distributed to the
>>         consumers in a
>>                  round-robin fashion (p1, p2, p3, p1, etc). Is there a
>>         way to
>>                  change this
>>                  distribution policy so that always the first free process
>>                  handles the
>>                  message? For example if p1 is always available then it
>>         would
>>                  handle all
>>                  the queued messages.
>>                  thanks in advance
>>
>>
>>                  ___________________________________________________
>>                  rabbitmq-discuss mailing list
>>                  rabbitmq-discuss at lists.__rabbi__tmq.com
>>         <http://rabbitmq.com>
>>                  <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>         https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____
>> rabbitmq-discuss
>>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__
>> rabbitmq-discuss>
>>
>>
>>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__
>> rabbitmq-discuss
>>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/
>> rabbitmq-discuss>>
>>
>>
>>
>>              --
>>              Simon MacMullen
>>              RabbitMQ, Pivotal
>>
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, Pivotal
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/72c6f5e3/attachment.html>

From CLefevre at Transparent.com  Tue Dec  3 15:33:26 2013
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 3 Dec 2013 15:33:26 +0000
Subject: [rabbitmq-discuss] RabbitMQ Admin Monitoring not showing live
	numbers?
Message-ID: <5798631D5F355D4C99FDF23580295AF81A137A42@TLMAIL1.Transparent.local>

We have been using RabbitMQ for a couple of years at this point, but only recently started looking into the RabbitMQ Admin monitoring. We've looked at the queues to see when something has died completely and there are several thousand messages stuck in queue, but the actual throughput of a Queue we weren't looking at previously.

In one of our recent integration tests, we are sending through a large number of messages ( 100's to 1000's ) per minute, and with 20 consumers, all of the data is being properly routed and processed. However, the monitor for the queue is showing 0 messages Queued ( Which is not surprising, as they are taken off immediately? ) but also the transfer rates, and messages per second are also all showing 0.

We can see the consumers active on the queue, and it is the only queue that we are using for that test.

For reference we're using the latest version of RabbitMQ 3.2.1, with the rabbitMQ Client jar for Java.

Thank you for your time,
-Christopher Lefevre
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.

From dmcintyre at gopivotal.com  Tue Dec  3 16:01:04 2013
From: dmcintyre at gopivotal.com (Duncan McIntyre)
Date: Tue, 3 Dec 2013 16:01:04 +0000
Subject: [rabbitmq-discuss] Cannot federate exchanges in the default vhost
Message-ID: <CAAaVn2DMic2g6tiJ6BHRQ71baBWyCDEuVDuAoC7iL-c0kYYCvA@mail.gmail.com>

If I declare an upstream on '/', the downstream cannot connect (see below).
It works fine if the upstream connects to a named vhost.

Any ideas?


Using RabbitMQ 3.1.5

root at ubuntu-A:/opt/tcserver-2.8.2#  rabbitmqctl set_parameter
federation-upstream f1 '{"uri":"amqp://freddy:freddy at ubuntu-C/"}'


root at ubuntu-C:/home/mcintyred/netsim/netsim-amqp-node/target# tail -10
/var/log/rabbitmq/rabbit\@ubuntu-C.log

=ERROR REPORT==== 3-Dec-2013::07:59:34 ===
closing AMQP connection <0.11206.0> (172.16.192.100:33242 ->
172.16.192.102:5672):
{handshake_error,opening,0,
                 {amqp_error,access_refused,
                             "access to vhost '' refused for user 'freddy'",
                             'connection.open'}}



----
Duncan McIntyre
Senior Consultant
dmcintyre at gopivotal.com
+44 7917 580 118
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/d39c4c9f/attachment.html>

From videlalvaro at gmail.com  Tue Dec  3 16:26:36 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 3 Dec 2013 17:26:36 +0100
Subject: [rabbitmq-discuss] durable queues on fanout exchange not durable
In-Reply-To: <DM__131203175522_21085036523@smtp.126.com>
References: <1386064016660-31781.post@n5.nabble.com>
 <DM__131203175522_21085036523@smtp.126.com>
Message-ID: <CAMcAHLV5gxD0L7K9y7GTZq_WTmnpMX_KkuV7U9H=Q6gcMybjJQ@mail.gmail.com>

Hi,

It seems you are using php-amqplib, if that's the case, the way you
are declaring the queues seems to be correct.

To debug this I would start by running a script that just declares the
queue as durable and the query RabbitMQ via the command line to check
the queue properties.

For example, I've just ran the following script, which creates a
durable queue called messages:

https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php

And then I've got this result:

$ ./sbin/rabbitmqctl list_queues name durable
Listing queues ...
msgs true
...done.

Note that queue durability is not related to exchange durability.

Regards,

Alvaro

On Tue, Dec 3, 2013 at 11:02 AM, woodslee <woodslee at 126.com> wrote:
> Hi pann
>
> I think this is impossible.
> If you declared a durable queue, whatever in producer or comsumer,once it is
> declared, it will be persistent in disk,and even you need not declare it
> later anymore.
> I think you can view the state of the queue in rabbitMQ web UI. If it is
> durable, the flag will be the letter of "D"
>
> ----- Original Message -----
>
> From: pann
> To: rabbitmq-discuss
> Sent: 2013-12-03, 17:46:56
> Subject: [rabbitmq-discuss] durable queues on fanout exchange not durable
>
> Hi,
>
> I am having trouble getting my queues durable on my fanout exchange.
> What I am trying to accomplish is the following:
>
> * One producer, submitting messages to the exchange. The producer is not
> aware of how many subscribers there will be.
> * Multiple subscribers that creates their on queues. These queues should be
> durable. If a subscriber needs to be restarted, the queue should survive in
> order not to lose the messages.
>
> The problem is that the queues do not survive the restart unless they are
> also declared on the producer side. However that is not possible since the
> producer is not aware of how many consumers there will be.
>
> The queues are created on the consumer side like this:
> $ch->queue_declare($queue, false, true, false, false);
> $ch->exchange_declare($exchange, 'fanout', false, true, false);
> $ch->queue_bind($queue, $exchange);
>
> and I only declare the exchange on the producer side:
> $ch->exchange_declare($exchange, 'fanout', false, true, false);
>
> I am probably missing something rather simple, but I have not been able to
> find the answer by googling the problem.
>
> /PA
>
>
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/durable-queues-on-fanout-exchange-not-durable-tp31781.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Tue Dec  3 16:29:37 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 3 Dec 2013 17:29:37 +0100
Subject: [rabbitmq-discuss] Cannot federate exchanges in the default
	vhost
In-Reply-To: <CAAaVn2DMic2g6tiJ6BHRQ71baBWyCDEuVDuAoC7iL-c0kYYCvA@mail.gmail.com>
References: <CAAaVn2DMic2g6tiJ6BHRQ71baBWyCDEuVDuAoC7iL-c0kYYCvA@mail.gmail.com>
Message-ID: <CAMcAHLXyC6v5JYCMbF1PG7psJA15EKkJWcYJQ1w1_hyQBSsuHQ@mail.gmail.com>

Hi,

Have you checked that the user "freddy" has access to the vhost you
are trying to access?

Regards,

Alvaro

On Tue, Dec 3, 2013 at 5:01 PM, Duncan McIntyre <dmcintyre at gopivotal.com> wrote:
> If I declare an upstream on '/', the downstream cannot connect (see below).
> It works fine if the upstream connects to a named vhost.
>
> Any ideas?
>
>
> Using RabbitMQ 3.1.5
>
> root at ubuntu-A:/opt/tcserver-2.8.2#  rabbitmqctl set_parameter
> federation-upstream f1 '{"uri":"amqp://freddy:freddy at ubuntu-C/"}'
>
>
> root at ubuntu-C:/home/mcintyred/netsim/netsim-amqp-node/target# tail -10
> /var/log/rabbitmq/rabbit\@ubuntu-C.log
>
> =ERROR REPORT==== 3-Dec-2013::07:59:34 ===
> closing AMQP connection <0.11206.0> (172.16.192.100:33242 ->
> 172.16.192.102:5672):
> {handshake_error,opening,0,
>                  {amqp_error,access_refused,
>                              "access to vhost '' refused for user 'freddy'",
>                              'connection.open'}}
>
>
>
> ----
> Duncan McIntyre
> Senior Consultant
> dmcintyre at gopivotal.com
> +44 7917 580 118
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jonathan.ruttenberg59 at gmail.com  Tue Dec  3 15:43:07 2013
From: jonathan.ruttenberg59 at gmail.com (Jonathan Ruttenberg)
Date: Tue, 3 Dec 2013 07:43:07 -0800 (PST)
Subject: [rabbitmq-discuss] Using Management HTTP API to get Message Rates
Message-ID: <cb770014-664a-4298-8992-db9023168a5b@googlegroups.com>

The "Queues" tab of the RabbitMQ Management UI will show Message Rates 
(Publish, Deliver, Redelivered, Acknowledge in msg/s)  in the Overview 
section.

It is not clear to me whether the same information is available in the 
Management HTTP API.
Can anyone advise on what is possible?


Thanks.

--Jon

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/b9a6d48f/attachment.html>

From michael.s.klishin at gmail.com  Tue Dec  3 16:43:55 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 3 Dec 2013 20:43:55 +0400
Subject: [rabbitmq-discuss] Cannot federate exchanges in the default
	vhost
In-Reply-To: <CAAaVn2DMic2g6tiJ6BHRQ71baBWyCDEuVDuAoC7iL-c0kYYCvA@mail.gmail.com>
References: <CAAaVn2DMic2g6tiJ6BHRQ71baBWyCDEuVDuAoC7iL-c0kYYCvA@mail.gmail.com>
Message-ID: <CAE3HoVSr6yXVzG7WSZ+Xuv10tdBops_iuS1Z_9mAGDXV9Q0-5Q@mail.gmail.com>

2013/12/3 Duncan McIntyre <dmcintyre at gopivotal.com>

> closing AMQP connection <0.11206.0> (172.16.192.100:33242 ->
> 172.16.192.102:5672):
> {handshake_error,opening,0,
>                  {amqp_error,access_refused,
>                              "access to vhost '' refused for user
> 'freddy'",
>                              'connection.open'}}
>

freddy doesn't have permissions set up for vhost "/".
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/a9c93206/attachment.html>

From dmcintyre at gopivotal.com  Tue Dec  3 16:46:55 2013
From: dmcintyre at gopivotal.com (Duncan McIntyre)
Date: Tue, 3 Dec 2013 16:46:55 +0000
Subject: [rabbitmq-discuss] Cannot federate exchanges in the default
	vhost
In-Reply-To: <CAMcAHLXyC6v5JYCMbF1PG7psJA15EKkJWcYJQ1w1_hyQBSsuHQ@mail.gmail.com>
References: <CAAaVn2DMic2g6tiJ6BHRQ71baBWyCDEuVDuAoC7iL-c0kYYCvA@mail.gmail.com>
 <CAMcAHLXyC6v5JYCMbF1PG7psJA15EKkJWcYJQ1w1_hyQBSsuHQ@mail.gmail.com>
Message-ID: <CAAaVn2DLnNeOrs6sttavFgxn=haHBCGsvOFvRAxmGCbk_CBtLg@mail.gmail.com>

Hi Alvaro,

Yes, in fact I created 'freddy' especially in case there was anything
unexpected about using 'guest'.

It's odd that the error message on the upstream says the vhost is called
''. I tried adding an extra slash to the federation-upstream connection
details, but that is rejected as invalid.

Duncan


On Tue, Dec 3, 2013 at 4:29 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi,
>
> Have you checked that the user "freddy" has access to the vhost you
> are trying to access?
>
> Regards,
>
> Alvaro
>
> On Tue, Dec 3, 2013 at 5:01 PM, Duncan McIntyre <dmcintyre at gopivotal.com>
> wrote:
> > If I declare an upstream on '/', the downstream cannot connect (see
> below).
> > It works fine if the upstream connects to a named vhost.
> >
> > Any ideas?
> >
> >
> > Using RabbitMQ 3.1.5
> >
> > root at ubuntu-A:/opt/tcserver-2.8.2#  rabbitmqctl set_parameter
> > federation-upstream f1 '{"uri":"amqp://freddy:freddy at ubuntu-C/"}'
> >
> >
> > root at ubuntu-C:/home/mcintyred/netsim/netsim-amqp-node/target# tail -10
> > /var/log/rabbitmq/rabbit\@ubuntu-C.log
> >
> > =ERROR REPORT==== 3-Dec-2013::07:59:34 ===
> > closing AMQP connection <0.11206.0> (172.16.192.100:33242 ->
> > 172.16.192.102:5672):
> > {handshake_error,opening,0,
> >                  {amqp_error,access_refused,
> >                              "access to vhost '' refused for user
> 'freddy'",
> >                              'connection.open'}}
> >
> >
> >
> > ----
> > Duncan McIntyre
> > Senior Consultant
> > dmcintyre at gopivotal.com
> > +44 7917 580 118
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
----
Duncan McIntyre
Senior Consultant
dmcintyre at gopivotal.com
+44 7917 580 118
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/2f1e7a64/attachment.html>

From dmcintyre at gopivotal.com  Tue Dec  3 16:50:16 2013
From: dmcintyre at gopivotal.com (Duncan McIntyre)
Date: Tue, 3 Dec 2013 16:50:16 +0000
Subject: [rabbitmq-discuss] Cannot federate exchanges in the default
	vhost
In-Reply-To: <CAE3HoVSr6yXVzG7WSZ+Xuv10tdBops_iuS1Z_9mAGDXV9Q0-5Q@mail.gmail.com>
References: <CAAaVn2DMic2g6tiJ6BHRQ71baBWyCDEuVDuAoC7iL-c0kYYCvA@mail.gmail.com>
 <CAE3HoVSr6yXVzG7WSZ+Xuv10tdBops_iuS1Z_9mAGDXV9Q0-5Q@mail.gmail.com>
Message-ID: <CAAaVn2CTrR2ffz5pPSE=dj8J=s2MV5W+qcaw4FftnGLADFTwRA@mail.gmail.com>

Freddy can do anything!

root at ubuntu-C:/home/mcintyred/netsim/netsim-amqp-node/target# rabbitmqctl
list_user_permissions freddy
Listing permissions for user "freddy" ...
/ .* .* .*
...done.


On Tue, Dec 3, 2013 at 4:43 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

>
> 2013/12/3 Duncan McIntyre <dmcintyre at gopivotal.com>
>
>> closing AMQP connection <0.11206.0> (172.16.192.100:33242 ->
>> 172.16.192.102:5672):
>> {handshake_error,opening,0,
>>                  {amqp_error,access_refused,
>>                              "access to vhost '' refused for user
>> 'freddy'",
>>                              'connection.open'}}
>>
>
> freddy doesn't have permissions set up for vhost "/".
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
----
Duncan McIntyre
Senior Consultant
dmcintyre at gopivotal.com
+44 7917 580 118
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/aaf00721/attachment.html>

From simon at rabbitmq.com  Tue Dec  3 16:50:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Dec 2013 16:50:30 +0000
Subject: [rabbitmq-discuss] Cannot federate exchanges in the default
	vhost
In-Reply-To: <CAAaVn2DLnNeOrs6sttavFgxn=haHBCGsvOFvRAxmGCbk_CBtLg@mail.gmail.com>
References: <CAAaVn2DMic2g6tiJ6BHRQ71baBWyCDEuVDuAoC7iL-c0kYYCvA@mail.gmail.com>
 <CAMcAHLXyC6v5JYCMbF1PG7psJA15EKkJWcYJQ1w1_hyQBSsuHQ@mail.gmail.com>
 <CAAaVn2DLnNeOrs6sttavFgxn=haHBCGsvOFvRAxmGCbk_CBtLg@mail.gmail.com>
Message-ID: <529E0BD6.6000404@rabbitmq.com>

On 03/12/13 16:46, Duncan McIntyre wrote:
> It's odd that the error message on the upstream says the vhost is called
> ''. I tried adding an extra slash to the federation-upstream connection
> details, but that is rejected as invalid.

amqp://server     -> default vhost, usually "/"
amqp://server/    -> vhost called "" - probably not what you want
amqp://server//   -> invalid URL
amqp://server/%2f -> explicitly use vhost "/"

The combination of the default vhost being called "/" in the AMQP spec 
and the rules for formatting URLs are not exactly what I'd call a 
marriage made in heaven :-(

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Tue Dec  3 16:55:36 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 3 Dec 2013 20:55:36 +0400
Subject: [rabbitmq-discuss] Using Management HTTP API to get Message
	Rates
In-Reply-To: <cb770014-664a-4298-8992-db9023168a5b@googlegroups.com>
References: <cb770014-664a-4298-8992-db9023168a5b@googlegroups.com>
Message-ID: <9993324A-6B29-4B81-A0AB-424D20C24C61@rabbitmq.com>

On 3 Dec 2013, at 19:43, Jonathan Ruttenberg <jonathan.ruttenberg59 at gmail.com> wrote:

> The "Queues" tab of the RabbitMQ Management UI will show Message Rates (Publish, Deliver, Redelivered, Acknowledge in msg/s)  in the Overview section.
> 
> It is not clear to me whether the same information is available in the Management HTTP API.
> Can anyone advise on what is possible?

GET /api/queues

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Tue Dec  3 17:26:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Dec 2013 17:26:39 +0000
Subject: [rabbitmq-discuss] RabbitMQ Admin Monitoring not showing live
 numbers?
In-Reply-To: <5798631D5F355D4C99FDF23580295AF81A137A42@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF81A137A42@TLMAIL1.Transparent.local>
Message-ID: <529E144F.5050006@rabbitmq.com>

On 03/12/13 15:33, Christopher Lefevre wrote:
> In one of our recent integration tests, we are sending through a
> large number of messages ( 100's to 1000's ) per minute, and with 20
> consumers, all of the data is being properly routed and processed.
> However, the monitor for the queue is showing 0 messages Queued (
> Which is not surprising, as they are taken off immediately? )

Yes.

> but
> also the transfer rates, and messages per second are also all showing
> 0.
>
> We can see the consumers active on the queue, and it is the only
> queue that we are using for that test.

Hmm.

Does the queue show as "active" or "idle"? What does the overview page 
look like? (Does it show any message rates?)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dubois.sebastien66 at gmail.com  Tue Dec  3 18:03:54 2013
From: dubois.sebastien66 at gmail.com (Sebastien Dubois)
Date: Tue, 3 Dec 2013 10:03:54 -0800 (PST)
Subject: [rabbitmq-discuss] How to use Web-stomp with ssl?
Message-ID: <68f97bfa-2b56-4249-916f-d4aa1bad48b6@googlegroups.com>


Hi all,

  We have a JavaScript application that also uses the the Stomp and 
Web-Stomp plugins to connect client browsers to a notification channel, so 
that we can get asynchronous messages from the RabbitMQ broker.  This works 
fine when our site uses an usecured connection (http).

  We are now trying to update the application to use secured (https/ssl) 
connections and we are having problems because it seems that the web-stomp 
plugin does not support SSL.  I tried to look all over the web for info 
about this, but all I could find was a modified version of web-stomp that 
seems to include SSL support at 
https://gist.github.com/berico-rclayton/5475365.  However when I build the 
web-stomp plugin module using the info in the site mentioned above using 
Erlang R15B01, it doesn't seem to work, for either secured on unsecured 
connections.

  Is there any way to use web-stomp/SockJS with SSL? Otherwise is there any 
other way we can support websockets connections to a RabbitMQ broker in a 
secured context (i.e. when using it in a JS application that points to an 
https server)?

Thanks in advance,
Sebastien
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/70601904/attachment.html>

From bchmura at nurturhealth.com  Tue Dec  3 21:54:06 2013
From: bchmura at nurturhealth.com (Bill Chmura)
Date: Tue, 3 Dec 2013 21:54:06 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local network
Message-ID: <25870F6AB6D0E34489AD94C19EA928DB01F14844@OFLEXMB06P.centene.com>

Hi,

We are experiencing a frequent partitioning problem on our network with our RabbitMQ cluster.  We've not been able to iron it out and are running out of time before this needs to move into production.

I'll just focus on our DEV environment as it is just a scaled down version of the other environments.

Running on ESXi virtual machines (4GB Ram, 4 Cores dedicated)
Windows2008 R2 SP1 64-Bit
RabbitMQ 3.2.0
Erlang R16B02

There are two web servers and one app server in the above config.   These are all connected to the same network.  Each servers is running its own node - clustering is done through the rabbit config file.

Devweb01 - Ram
Devweb02 - Ram
DevApp01 - Disk

The problem is that every once in a while it starts partitioning off nodes, with nothing really correlating with it happening... not big traffic on the network, no disruptions we can find, etc.  We have gone through and made sure there were no VM settings that allowed items to "go to sleep" or anything aside from a "high performance setting"  (versus power savings).

Here is what we are seeing in the logs... which to me looks like a network interruption, but nothing else indicated that the machine was having issues.  We have a load balancer that flags systems with problems, we have a zenoss node monitoring the servers, we checked the ESXi charts and logs, we looked through windows system logs... nothing seems to have been amiss.

In one partitioning event we saw this in the WebApp server log:

=INFO REPORT==== 27-Nov-2013::18:11:07 ===
rabbit on node 'rabbit at NURWEB-DEVWEB01' down

=ERROR REPORT==== 27-Nov-2013::18:11:10 ===
Mnesia('rabbit at NURWEB-DEVAPP01'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-DEVWEB01'}


And in the DevWeb01 machine mentioned's logs we saw this - it also mentions it lost connections to both of the other boxes.

=INFO REPORT==== 27-Nov-2013::18:10:53 ===
rabbit on node 'rabbit at NURWEB-DEVAPP01' down

=ERROR REPORT==== 27-Nov-2013::18:10:53 ===
Mnesia('rabbit at NURWEB-DEVWEB01'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-DEVAPP01'}

=ERROR REPORT==== 27-Nov-2013::18:10:59 ===
Mnesia('rabbit at NURWEB-DEVWEB01'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-DEVWEB02'}

=INFO REPORT==== 27-Nov-2013::18:11:00 ===
only running disc node went down

=INFO REPORT==== 27-Nov-2013::18:11:01 ===
rabbit on node 'rabbit at NURWEB-DEVWEB02' down

=INFO REPORT==== 27-Nov-2013::18:11:04 ===
only running disc node went down


And web02 only mentions the web01 going down

=INFO REPORT==== 27-Nov-2013::18:11:09 ===
rabbit on node 'rabbit at NURWEB-DEVWEB01' down

=ERROR REPORT==== 27-Nov-2013::18:11:11 ===
Mnesia('rabbit at NURWEB-DEVWEB02'): ** ERROR ** mnes

None of the rabbit installs are actually down during this...

We've seen the same thing on our qa and production boxes - which are the same configurations, just with more nodes.  Not many though 8 nodes on production.

Any ideas would be really appreciated!  I've recently added a net_ticktime to my dev servers to set that at 120 (double I believe) to see if that helps.


Bill




This email and all attachments are confidential and intended solely 
for the use of the individual or entity to which they are addressed. 
If you have received this email in error please notify the sender 
by replying to this message. If you are not the intended recipient, 
please delete this message and all attachments immediately.  Do not 
copy, disclose, use or act upon the information contained. Please 
note that any views or opinions presented in this email are solely 
those of the author and do not necessarily represent those of the 
company. Finally, the recipient should check this email and any 
attachments for the presence of viruses. While every attempt is made 
to verify that the contents are safe, the company accepts no liability 
for any damage caused by any virus transmitted by this email.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/db144b95/attachment.html>

From ayip at recondynamics.com  Tue Dec  3 22:38:43 2013
From: ayip at recondynamics.com (Adrian Yip)
Date: Tue, 3 Dec 2013 14:38:43 -0800
Subject: [rabbitmq-discuss] MQTT Plugin - missed and received in wrong order
	with QoS=0
Message-ID: <186598c3d2d4531a1f83b53edc97b67f@mail.gmail.com>

Hi,



I am testing a Mosquitto client publishing 100s of messages to RabbitMQ
exchange via the MQTT plugin with different QoS levels and I am seeing
issues with messages being received out of order and also what appears to
be the TCP socket going down (seeing TCP FINs in tshark).  This is all done
on localhost inside an Ubuntu VM



This happens when the inter-message delay is reduced to < 0.07s with QoS =
0 and < 0.5s with QoS = 1.  (RabbitMQ 3.2.1, Erlang R14B04) (Pika 0.9.13)
(mosquito 1.2.2)



The client consumer simply expects to see msgs received in order and prints
an error if the msg id # is not +1 from the previous.  If I send in a
similar manner via AMQP using pika client, there is no issue with messages
being received out of order or seeing any socket disconnects (FINs)



The problem gets worse with QoS=1 seeing the connection failing and the
publisher stops receiving confirmations.



In the example below 200 message are published with 0s delay between them
at QoS=0.  All the messages are received up to 51, then 52 is missed, then
every 10 messages are received and one skipped.  At the end of the log, it
shows receiving the skipped messages being output in reversed order?
received 112, 102, 92, 82?all the way to 52?



I?ve set the client.max_inflight_messages_set(0) in the mosquito client and
the mqtt rabbitmq plugin config is set with prefetch=0 for infinite
messaging which I think only applies for QoS=1.  Also in the mosquito
client, I?ve trigger the mosquito client thread to run to process the
publish cfm from the broker plugin.



Any insights would be appreciated.  Seems like an issue with mqtt plugin as
when I look at tcpdumps of the traces the mqtt messages are aggregated
together into tcp messages with the low delays and with higher delays they
are separated into individual tcp messages.



I?ve included the example invocation, output and code below.



Adrian





*Mosquitto MQTT Publisher:*



*Example?send 200 messages with 0 delay at QoS=0*



*% python mqtt_publisher_json.py 200 0 0*



Sending JSON msg 1 via MQTT



?



Sending JSON msg 198 via MQTT

Sending JSON msg 199 via MQTT

Sending JSON msg 200 via MQTT





*AMQP Consumer using PIKA*



*Receive messages published on the mqtt topic exchange*



% python amqp_receive_mqtt_json.py

[x] 'mqtt_json_routing_key':{u'id': 1}

[x] 'mqtt_json_routing_key':{u'id': 2}

[x] 'mqtt_json_routing_key':{u'id': 3}

?all messages received here

[x] 'mqtt_json_routing_key':{u'id': 50}

[x] 'mqtt_json_routing_key':{u'id': 51}

[x] 'mqtt_json_routing_key':{u'id': 53}  <- Got 53 instead of 52

*Missing 52*

[x] 'mqtt_json_routing_key':{u'id': 54}  <- now receive 54?61 in order

[x] 'mqtt_json_routing_key':{u'id': 55}

[x] 'mqtt_json_routing_key':{u'id': 56}

[x] 'mqtt_json_routing_key':{u'id': 57}

[x] 'mqtt_json_routing_key':{u'id': 58}

[x] 'mqtt_json_routing_key':{u'id': 59}

[x] 'mqtt_json_routing_key':{u'id': 60}

[x] 'mqtt_json_routing_key':{u'id': 61}

[x] 'mqtt_json_routing_key':{u'id': 63}  <- Got 63 instead of 62

*Missing 62*

[x] 'mqtt_json_routing_key':{u'id': 64}

[x] 'mqtt_json_routing_key':{u'id': 65}

[x] 'mqtt_json_routing_key':{u'id': 66}

[x] 'mqtt_json_routing_key':{u'id': 67}

[x] 'mqtt_json_routing_key':{u'id': 68}

[x] 'mqtt_json_routing_key':{u'id': 69}

[x] 'mqtt_json_routing_key':{u'id': 70}

[x] 'mqtt_json_routing_key':{u'id': 71}

[x] 'mqtt_json_routing_key':{u'id': 73}  <- etc?

*Missing 72*

[x] 'mqtt_json_routing_key':{u'id': 74}

[x] 'mqtt_json_routing_key':{u'id': 75}

[x] 'mqtt_json_routing_key':{u'id': 76}

[x] 'mqtt_json_routing_key':{u'id': 77}

[x] 'mqtt_json_routing_key':{u'id': 78}

[x] 'mqtt_json_routing_key':{u'id': 79}

[x] 'mqtt_json_routing_key':{u'id': 80}

[x] 'mqtt_json_routing_key':{u'id': 81}

[x] 'mqtt_json_routing_key':{u'id': 83}

*Missing 82*

[x] 'mqtt_json_routing_key':{u'id': 84}

[x] 'mqtt_json_routing_key':{u'id': 85}

[x] 'mqtt_json_routing_key':{u'id': 86}

[x] 'mqtt_json_routing_key':{u'id': 87}

[x] 'mqtt_json_routing_key':{u'id': 88}

[x] 'mqtt_json_routing_key':{u'id': 89}

[x] 'mqtt_json_routing_key':{u'id': 90}

[x] 'mqtt_json_routing_key':{u'id': 91}

[x] 'mqtt_json_routing_key':{u'id': 93}

*Missing 92*

[x] 'mqtt_json_routing_key':{u'id': 94}

[x] 'mqtt_json_routing_key':{u'id': 95}

[x] 'mqtt_json_routing_key':{u'id': 96}

[x] 'mqtt_json_routing_key':{u'id': 97}

[x] 'mqtt_json_routing_key':{u'id': 98}

[x] 'mqtt_json_routing_key':{u'id': 99}

[x] 'mqtt_json_routing_key':{u'id': 100}

[x] 'mqtt_json_routing_key':{u'id': 101}

 [x] 'mqtt_json_routing_key':{u'id': 103}

*Missing 102*

[x] 'mqtt_json_routing_key':{u'id': 104}

[x] 'mqtt_json_routing_key':{u'id': 105}

[x] 'mqtt_json_routing_key':{u'id': 106}

[x] 'mqtt_json_routing_key':{u'id': 107}

[x] 'mqtt_json_routing_key':{u'id': 108}

[x] 'mqtt_json_routing_key':{u'id': 109}

[x] 'mqtt_json_routing_key':{u'id': 110}

[x] 'mqtt_json_routing_key':{u'id': 111}

[x] 'mqtt_json_routing_key':{u'id': 113}

*Missing 112*

[x] 'mqtt_json_routing_key':{u'id': 114}

[x] 'mqtt_json_routing_key':{u'id': 115}



?all messages received in order here?



[x] 'mqtt_json_routing_key':{u'id': 199}

[x] 'mqtt_json_routing_key':{u'id': 200}   *<- last message sent*

* [x] 'mqtt_json_routing_key':{u'id': 112}   <- Now here come all the
skipped messages in reverse order.*

Missing 201

* [x] 'mqtt_json_routing_key':{u'id': 102}*

Missing 113

* [x] 'mqtt_json_routing_key':{u'id': 92}*

Missing 103

* [x] 'mqtt_json_routing_key':{u'id': 82}*

Missing 93

* [x] 'mqtt_json_routing_key':{u'id': 72}*

Missing 83

* [x] 'mqtt_json_routing_key':{u'id': 62}*

Missing 73

* [x] 'mqtt_json_routing_key':{u'id': 52}*

Missing 63



*mqtt_publisher_json.py:*



# Example of mosquitto json publisher

import mosquitto

import sys

import time

import random

import json



def on_connect(mosq, obj, rc):

    if rc == 0:

        print("on_connect ok...")

    else:

        print("on_connect failed rc=",rc)





def on_publish(mosq,obj,mid):

    print("Message published: ", mid)



def on_disconnect(mosq, obj, rc):

    print("Disconnected...")



def on_log(mosq,userdata,level,buf):

    print("on_log:",userdata,level,buf)





if len(sys.argv) != 4:

    print "Usage: cnt sleep_s qos"

    exit(-1)

cnt = int(sys.argv[1])

sleep_s = float(sys.argv[2])

qos = int(sys.argv[3])



client = mosquitto.Mosquitto("test-client%d" % random.randint(1,100))

print client._client_id

client.on_connect = on_connect

client.on_disconnect = on_disconnect

#client.on_log = on_log

#client.on_publish = on_publish



client.max_inflight_messages_set(0)

client.connect("localhost",port=1884)



# Start mosquitto thread to deal with inflight acks

client.loop_start()



# Transmit a bunch of messages space sleep_s apart

i = 1

while i <=  cnt:

    print "Sending JSON msg %d via MQTT" % i

    msg = {}

    #msg["msg"] = "JSON msg#%d via MQTT" % i

    msg["id"] = i



    try :

        rc = client.publish("mqtt_json_routing_key",json.dumps(msg),qos=qos)

    except :

        print "Unexpected publish error: ",sys.exc_info()[0]

    i = i + 1



    time.sleep(sleep_s)



# Some delay for last message to go out

wait_s = 2

print "Waiting %d seconds for last message out..." % wait_s

time.sleep(wait_s)



# Stop the threaded Mosquitto client

client.loop_stop()



# Now disconnect

try:

    client.disconnect()

except:

    print "Unexpected disconnect error: ",sys.exc_info()[0]



*amqp_receive_mqtt_json.py*



# Usage: python amqp_receive_mqtt_json [debug]

#

#  [0/1 - debug enable/disable - default enable]

#

#  Consumer to receive AMQP messages from mqtt-json-queue from mqtt.topic
exchange

#  code expectes a json 'id' field in the message body and will report if
the 'id'

#  is not +1 from previous

#

prev_id = 0

debug = 1



def callback(ch, method, properties, body):

    global prev_id, debug



    ch.basic_ack(delivery_tag=method.delivery_tag)

    msgBody = json.loads(body)

    if debug != 0:

        print " [x] %r:%r" % (method.routing_key,msgBody,)

    if prev_id + 1 != int(msgBody['id']):

        print "Missing %d" % (prev_id + 1)

    prev_id = msgBody['id']

    return



if len(sys.argv) > 1:

    debug = int(sys.argv[1])



while True:

    try:



        connection = pika.BlockingConnection(pika.ConnectionParameters(

                host='localhost'))

        channel = connection.channel()



        channel.exchange_declare(exchange='mqtt.topic',

                                 type='topic')



        result = channel.queue_declare("mqtt-json-queue")

        queue_name = result.method.queue



        # topic here is what the mqtt plugin posts to

        channel.queue_bind(exchange='mqtt.topic',

                           queue=queue_name,

                           routing_key="mqtt_json_routing_key")



        print ' [*] Waiting for logs. To exit press CTRL+C'



        channel.basic_consume(callback,

                              queue=queue_name

                              )



        channel.start_consuming()



    except Exception, e:

        traceback.print_exc()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/8bae20b3/attachment.html>

From Gregory.GENTLING at us.thalesgroup.com  Wed Dec  4 01:52:24 2013
From: Gregory.GENTLING at us.thalesgroup.com (GENTLING Gregory)
Date: Tue, 3 Dec 2013 17:52:24 -0800
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other node
 we see a very slow dequeue of messages
Message-ID: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>

Classification: Open
When rabbitmq is clustered with one other node we see a very slow dequeue of messages. The scenario is simple, Node A and Node B in the cluster. They are clustered with the auto_heal option and default netticktime. Steps to repeat are:


(These are all local connections)

(1)    Connect client A1 to Node A

a.       Client A1 creates a topic exchange

b.      Client A1 is a publisher with 1msg/sec

(2)    Connect client A2 to Node A

a.       Client A1 listens for the messages in the exchange

(3)    Connect client B to Node B   (this is important, the issue does not occur unless you have this remote client)

a.       Client B listens for the messages in the exchange

(4)    Pull the plug on Node B (you will not see the issue with a graceful shutdown), alternately you can just use "route" to now make Node B not routable from Node A

a.       If you kill rabbitmq, you will not see the issue

(5)    Wait for netticktime (or until you see NodeB being removed from the cluster in Node A's log)

(6)    Client A2 no longer receives messages at 1msg/sec, it will fall considerably behind but recover in about 10 mins.

We have two setups with slightly different network setups (two pairs of Node A and B). One we see this issue on, the other we do not, so this is not an issue that can be always reproduced.

Other issues observed in this state:

*         rabbitmqctl cluster_status/list_queues/list_connections/list_exchanges all hang, rabbitmq status does not hang

*         declareQueue, declareExchange, declareExchangePassive all hang

*         disabling auto_heal does not help

*         tested with both Erlang 5.9 and 5.10.3

*         tested with both RabbitMq 3.1.5 and 3.1.3, same issue in both

*         don't see this issue with direct exchange

*         nothing in vmstat out of the ordinary, CPU is not pegged, system is not thrashing


Things we have ruled out:

*         Iptables, tested with no rules

*         Selinux, tested in permissive

*         Java drivers


Same thing as described here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-June/027674.html

Thank you,

Greg Gentling
Principal Software Architecture - Avant CommonApps
Thales Avionics, Inc.
In-Flight Entertainment and Connectivity
Irvine, CA 92618
949-595-4943


[@@OPEN@@]

This email was classified by GENTLING Gregory on Tuesday, December 03, 2013 5:52:25 PM.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/129aa6f9/attachment.html>

From bizcenternet at gmail.com  Wed Dec  4 04:00:10 2013
From: bizcenternet at gmail.com (pierre)
Date: Tue, 3 Dec 2013 20:00:10 -0800 (PST)
Subject: [rabbitmq-discuss] Connection alwalys is blocked!
Message-ID: <1386129610563-31807.post@n5.nabble.com>

Hi:
   Forgive my poor english.
   When publishing rate is up to 600(one connection, one channel),
connection state will be flow(publish rate recently restrict by server). 
    In cluster and ha environment, publishing rate is slower...

     / <http://www.rabbitmq.com/memory.html> A per-connection mechanism that
prevents messages being published faster than they can be routed to queues.
    A global mechanism that prevents any messages from being published when
the memory usage exceeds a configured threshold or free disk space drops
below a configured threshold./ 

    It looks like that a per-connection mechanism can not be configured or
disabled.

    Is there any better solution to imporve throughtput? How do id disable
the flow-control?





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-alwalys-is-blocked-tp31807.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From cjimison at gmail.com  Wed Dec  4 06:06:52 2013
From: cjimison at gmail.com (Chris Jimison)
Date: Tue, 3 Dec 2013 22:06:52 -0800
Subject: [rabbitmq-discuss] Erlang Client RPC issues
Message-ID: <15ED1DE2-F1B1-4976-AEE8-A2D4557488D9@gmail.com>

Hey all,

I am running an Erlang server and I want to make an RPC call to another server that may or may not be running.

I am running the following code:

* Connection is a valid amqp connection

    Client = amqp_rpc_client:start(Connection, <<?info_queue?>>),
    Reply = amqp_rpc_client:call(Client, <<"info">>),
    amqp_rpc_client:stop(Client),

Two questions:

1) I noticed in the amqp_rpc_client.erl that it is not handling #?basic.return?{} messages.  I added a call to:
 
amqp_channel:register_return_handler(Channel, self()),

in the init function and a handle_info call:

handle_info({#'basic.return'{}, Content}, State = #state{continuations = Conts, channel = _Channel}) ->
    #amqp_msg{props = #'P_basic'{correlation_id = Id}, payload = _Payload} = Content,
    From = dict:fetch(Id, Conts),
    gen_server:reply(From, basic_return),
    {noreply, State};


and that seems to work well.  I am very new to RabbitMQ and I am not really sure if this is going to break something very badly.  Is there a reason amqp_rpc_client is not a return_handler?


2) When I call amqp_rpc_client:stop I am getting error messages (with our without my changes) about:

{error,{consumer_died,normal}}

It seams to me that when the Channel created in amqp_rpc_client is shutdown, the amqp_direct_consumer is getting the ?DOWN? message and returning {error, {consumer_died, Info}, C};

Does this sound correct that calling stop on an amqp_rpc_client should be generating so many errors?  Is there some cleaner way I should be stopping the amqp_rpc_client?

I tried moving the amqp_channel:close call into the handle_call(stop, _From, State) function and that did clean things up a bit.  But I am still getting a:

gen_server <0.19536.1> terminated with reason: {error,{consumer_died,normal}}


Thanks for any insights and help!

Environment:

Mac OS X: 10.9
RabbitMQ server 3.2.1
rabbitmq-erlang-client github fork, based on the rabbitmq_v3_2_1 git tag


- Chris

From carl.hoerberg at gmail.com  Wed Dec  4 09:01:42 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 4 Dec 2013 01:01:42 -0800 (PST)
Subject: [rabbitmq-discuss] Silent crashes, and "killed by ABRT signal"
Message-ID: <1386147702522-31809.post@n5.nabble.com>

Have a cluster where nodes often crash without any warning, and leaves no
logs, but a erl_crash.dump. Would that be interesting for you to analyze? 

In other cases I see "killed by ABRT signal" in syslog and no erl_crash.dump
or signs in the logs. Any idea what can cause that?

Erlang R16B02 and RabbitMQ 3.2.1



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Silent-crashes-and-killed-by-ABRT-signal-tp31809.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From guilherme.labigalini at gmail.com  Wed Dec  4 09:10:08 2013
From: guilherme.labigalini at gmail.com (Guilherme Labigalini)
Date: Wed, 4 Dec 2013 07:10:08 -0200
Subject: [rabbitmq-discuss] how the bug 25827 going ?
In-Reply-To: <39B915BA-99CA-45B5-AED3-7508539EDE72@rabbitmq.com>
References: <1386057265607-31778.post@n5.nabble.com>
 <39B915BA-99CA-45B5-AED3-7508539EDE72@rabbitmq.com>
Message-ID: <CAFrXCmKjAuW+6i+h2DkU_ZzTP5Fj3C8Qkn5nXV0ezXFH1tjSNA@mail.gmail.com>

Hi Tim,

What are the side effects of this defect? Rabbit will not start the number
of messages in the mnesia db is too large?

Thanks


On Tue, Dec 3, 2013 at 6:23 AM, Tim Watson <tim at rabbitmq.com> wrote:

> We have a fix and it should be included in a future release. Not sure when
> that will be, but will try and remember to post back when it becomes
> available in the nightly builds.
>
> Cheers,
> Tim
>
> On 3 Dec 2013, at 07:54, 3k4b251 wrote:
>
> > I  try  to  create  more  than  100000 queues  in  one  rabbtimq server ?
> > It  seems   very  hard  to   start up.    took  too  much  time  and
> seems
> > never   success?
> >
> >
> >
> > --
> > View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/how-the-bug-25827-going-tp31778.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/7a6ea512/attachment.html>

From emile at rabbitmq.com  Wed Dec  4 09:18:26 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Dec 2013 09:18:26 +0000
Subject: [rabbitmq-discuss] Silent crashes, and "killed by ABRT signal"
In-Reply-To: <1386147702522-31809.post@n5.nabble.com>
References: <1386147702522-31809.post@n5.nabble.com>
Message-ID: <529EF362.30004@rabbitmq.com>


Hi Carl,

On 04/12/13 09:01, carlhoerberg wrote:
> Have a cluster where nodes often crash without any warning, and leaves no
> logs, but a erl_crash.dump. Would that be interesting for you to analyze? 

We would be interested in helping you solve the problem. There should be
no reason for spontaneous crashes. The erl_crash.dump file is seldom
useful - what is the slogan? Was anything logged by the OS? Can you
replicate the problem or guide us to replicate the problem?

> In other cases I see "killed by ABRT signal" in syslog and no erl_crash.dump
> or signs in the logs. Any idea what can cause that?

Presumably the Erlang VM received an abort signal. Turn on tracing of
signals to find the source of the signal.




-Emile



From watson.timothy at gmail.com  Wed Dec  4 09:32:03 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 4 Dec 2013 09:32:03 +0000
Subject: [rabbitmq-discuss] how the bug 25827 going ?
In-Reply-To: <CAFrXCmKjAuW+6i+h2DkU_ZzTP5Fj3C8Qkn5nXV0ezXFH1tjSNA@mail.gmail.com>
References: <1386057265607-31778.post@n5.nabble.com>
 <39B915BA-99CA-45B5-AED3-7508539EDE72@rabbitmq.com>
 <CAFrXCmKjAuW+6i+h2DkU_ZzTP5Fj3C8Qkn5nXV0ezXFH1tjSNA@mail.gmail.com>
Message-ID: <5C870297-FA6C-4304-9F57-9A99B1C5E9BB@rabbitmq.com>

It will start, but boot up and shutdown take a very long time.

Cheers,
Tim

On 4 Dec 2013, at 09:10, Guilherme Labigalini <guilherme.labigalini at gmail.com> wrote:

> Hi Tim,
> 
> What are the side effects of this defect? Rabbit will not start the number of messages in the mnesia db is too large?
> 
> Thanks
> 
> 
> On Tue, Dec 3, 2013 at 6:23 AM, Tim Watson <tim at rabbitmq.com> wrote:
> We have a fix and it should be included in a future release. Not sure when that will be, but will try and remember to post back when it becomes available in the nightly builds.
> 
> Cheers,
> Tim
> 
> On 3 Dec 2013, at 07:54, 3k4b251 wrote:
> 
> > I  try  to  create  more  than  100000 queues  in  one  rabbtimq server ?
> > It  seems   very  hard  to   start up.    took  too  much  time  and   seems
> > never   success?
> >
> >
> >
> > --
> > View this message in context: http://rabbitmq.1065348.n5.nabble.com/how-the-bug-25827-going-tp31778.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/27a52de6/attachment.html>

From carl.hoerberg at gmail.com  Wed Dec  4 09:44:35 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 4 Dec 2013 01:44:35 -0800 (PST)
Subject: [rabbitmq-discuss] Silent crashes, and "killed by ABRT signal"
In-Reply-To: <529EF362.30004@rabbitmq.com>
References: <1386147702522-31809.post@n5.nabble.com>
 <529EF362.30004@rabbitmq.com>
Message-ID: <1386150275477-31813.post@n5.nabble.com>

No, can't replicate it, and nothing in the system logs either (syslog or
dmesg). 

How would I do that? As I understand, strace only trace which signals are
received, not who issued them. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Silent-crashes-and-killed-by-ABRT-signal-tp31809p31813.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From woodslee at 126.com  Wed Dec  4 09:46:44 2013
From: woodslee at 126.com (woodslee)
Date: Wed, 4 Dec 2013 17:46:44 +0800
Subject: [rabbitmq-discuss] What will happen when message is published to a
	slave of a mirrored queue?
Message-ID: <DM__131204173919_94205872554@smtp.feinno.com>

Hi All:

I just reading the HA document about mirrored queue, the document in 
http://www.rabbitmq.com/ha.html
say that
"All actions other than publishes go only to the master, and the master then broadcasts the effect of the actions to the slaves"

And when a message is published to a slave of the mirrored queue, how did other slave queue and the master get the message?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/3f00b678/attachment.html>

From mklishin at gopivotal.com  Wed Dec  4 09:50:06 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Dec 2013 13:50:06 +0400
Subject: [rabbitmq-discuss] What will happen when message is published
	to a slave of a mirrored queue?
In-Reply-To: <DM__131204173919_94205872554@smtp.feinno.com>
References: <DM__131204173919_94205872554@smtp.feinno.com>
Message-ID: <D988FF01-BBAB-4975-8C51-98CD87B409DB@rabbitmq.com>

On 4 Dec 2013, at 13:46, woodslee <woodslee at 126.com> wrote:

> And when a message is published to a slave of the mirrored queue, how did other slave queue and the master get the message?

Messages are published to exchanges, that route them to queue masters, regardless
of what node the publisher is connected to.

MK

Software Engineer, Pivotal/RabbitMQ



From carl.hoerberg at gmail.com  Wed Dec  4 09:53:41 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 4 Dec 2013 01:53:41 -0800 (PST)
Subject: [rabbitmq-discuss] Silent crashes, and "killed by ABRT signal"
In-Reply-To: <1386150275477-31813.post@n5.nabble.com>
References: <1386147702522-31809.post@n5.nabble.com>
 <529EF362.30004@rabbitmq.com> <1386150275477-31813.post@n5.nabble.com>
Message-ID: <1386150821294-31816.post@n5.nabble.com>

On another server, with memory threshold 0.4 we just got: 

Dec  4 09:46:27 ip-10-34-235-83 kernel: [7494719.282354] TCP: Possible SYN
flooding on port 5672. Sending cookies.  Check SNMP counters.
Dec  4 09:47:39 ip-10-34-235-83 kernel: [7494791.746025] beam invoked
oom-killer: gfp_mask=0x201da, order=0, oom_adj=0, oom_score_adj=0
Dec  4 09:47:39 ip-10-34-235-83 kernel: [7494791.746032] beam cpuset=/
mems_allowed=0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746036] Pid: 8403, comm:
beam Not tainted 3.2.0-55-virtual #85-Ubuntu
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746039] Call Trace:
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746051] 
[<ffffffff81119e11>] dump_header+0x91/0xe0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746056] 
[<ffffffff8111a195>] oom_kill_process+0x85/0xb0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746060] 
[<ffffffff8111a53a>] out_of_memory+0xfa/0x220
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746064] 
[<ffffffff8111ff13>] __alloc_pages_nodemask+0x8c3/0x8e0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746073] 
[<ffffffff81157046>] alloc_pages_current+0xb6/0x120
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746079] 
[<ffffffff81116d37>] __page_cache_alloc+0xb7/0xd0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746083] 
[<ffffffff81118d02>] filemap_fault+0x212/0x3c0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746087] 
[<ffffffff811393e2>] __do_fault+0x72/0x550
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746091] 
[<ffffffff8113ca9a>] handle_pte_fault+0xfa/0x200
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746098] 
[<ffffffff810063ee>] ? xen_pmd_val+0xe/0x10
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746102] 
[<ffffffff81005369>] ? __raw_callee_save_xen_pmd_val+0x11/0x1e
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746106] 
[<ffffffff8113dd79>] handle_mm_fault+0x269/0x370
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746111] 
[<ffffffff8100a58d>] ? xen_force_evtchn_callback+0xd/0x10
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746119] 
[<ffffffff8165db04>] do_page_fault+0x184/0x550
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746126] 
[<ffffffff811bb74c>] ? ep_poll+0x1cc/0x380
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746131] 
[<ffffffff8103dd05>] ? pvclock_clocksource_read+0x55/0xf0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746136] 
[<ffffffff8165a735>] page_fault+0x25/0x30
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746139] Mem-Info:
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746141] Node 0 DMA per-cpu:
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746145] CPU    0: hi:    0,
btch:   1 usd:   0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746147] Node 0 DMA32
per-cpu:
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746150] CPU    0: hi:  186,
btch:  31 usd: 126
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746155] active_anon:133427
inactive_anon:39 isolated_anon:0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746156]  active_file:9
inactive_file:37 isolated_file:0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746157]  unevictable:0
dirty:0 writeback:0 unstable:0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746158]  free:1373
slab_reclaimable:2875 slab_unreclaimable:5196
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746160]  mapped:26 shmem:48
pagetables:717 bounce:0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746162] Node 0 DMA
free:2424kB min:72kB low:88kB high:108kB active_anon:9328kB
inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB
isolated(anon):0kB isolated(file):0kB present:14524kB mlocked:0kB dirty:0kB
writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:844kB
slab_unreclaimable:2016kB kernel_stack:0kB pagetables:24kB unstable:0kB
bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746174] lowmem_reserve[]: 0
597 597 597
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746179] Node 0 DMA32
free:3068kB min:3088kB low:3860kB high:4632kB active_anon:524380kB
inactive_anon:156kB active_file:36kB inactive_file:148kB unevictable:0kB
isolated(anon):0kB isolated(file):0kB present:611856kB mlocked:0kB dirty:0kB
writeback:0kB mapped:104kB shmem:192kB slab_reclaimable:10656kB
slab_unreclaimable:18768kB kernel_stack:936kB pagetables:2844kB unstable:0kB
bounce:0kB writeback_tmp:0kB pages_scanned:1210 all_unreclaimable? yes
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746191] lowmem_reserve[]: 0
0 0 0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746195] Node 0 DMA: 230*4kB
76*8kB 0*16kB 0*32kB 0*64kB 1*128kB 1*256kB 1*512kB 0*1024kB 0*2048kB
0*4096kB = 2424kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746207] Node 0 DMA32:
751*4kB 6*8kB 1*16kB 0*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB
0*4096kB = 3068kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746219] 106 total pagecache
pages
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746221] 0 pages in swap
cache
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746223] Swap cache stats:
add 0, delete 0, find 0/0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746225] Free swap  = 0kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746227] Total swap = 0kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748046] 159472 pages RAM
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748047] 8388 pages reserved
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748049] 148 pages shared
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748051] 149339 pages
non-shared
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748052] [ pid ]   uid  tgid
total_vm      rss cpu oom_adj oom_score_adj name
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748061] [  264]     0   264    
4342       48   0       0             0 upstart-udev-br
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748065] [  268]     0   268    
5368      110   0     -17         -1000 udevd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748069] [  353]     0   353    
5367      106   0     -17         -1000 udevd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748072] [  354]     0   354    
5367      105   0     -17         -1000 udevd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748076] [  420]     0   420    
3798       48   0       0             0 upstart-socket-
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748079] [  641]   101   641   
63430      113   0       0             0 rsyslogd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748083] [  644]   102   644    
5981       90   0       0             0 dbus-daemon
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748087] [  723]     0   723    
3234       43   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748091] [  728]     0   728    
3234       42   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748094] [  736]     0   736    
3234       42   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748098] [  739]     0   739    
3234       41   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748102] [  744]     0   744    
3234       40   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748105] [  754]     0   754    
1083       37   0       0             0 acpid
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748108] [  755]     0   755    
4779       53   0       0             0 cron
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748112] [  756]     0   756    
4228       40   0       0             0 atd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748116] [  771]   103   771   
46919      305   0       0             0 whoopsie
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748119] [  788]     0   788    
3234       42   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748123] [ 1057]     0  1057    
1817      125   0       0             0 dhclient3
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748126] [ 1076]     0  1076   
12509      152   0     -17         -1000 sshd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748131] [ 8056]   106  8056    
1855       46   0       0             0 epmd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748135] [ 8393]   106  8393    
1101       25   0       0             0 rabbitmq-server
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748138] [ 8403]   106  8403  
307082   131187   0       0             0 beam
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748142] [ 8507]   106  8507    
1846       21   0       0             0 inet_gethost
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748145] [ 8508]   106  8508    
2371       33   0       0             0 inet_gethost
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748172] Out of memory: Kill
process 8403 (beam) score 870 or sacrifice child
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.748189] Killed process 8507
(inet_gethost) total-vm:7384kB, anon-rss:84kB, file-rss:0kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222260] rs:main Q:Reg
invoked oom-killer: gfp_mask=0x201da, order=0, oom_adj=0, oom_score_adj=0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222267] rs:main Q:Reg
cpuset=/ mems_allowed=0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222282] Pid: 648, comm:
rs:main Q:Reg Not tainted 3.2.0-55-virtual #85-Ubuntu
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222285] Call Trace:
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222297] 
[<ffffffff81119e11>] dump_header+0x91/0xe0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222301] 
[<ffffffff8111a195>] oom_kill_process+0x85/0xb0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222304] 
[<ffffffff8111a53a>] out_of_memory+0xfa/0x220
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222309] 
[<ffffffff8111ff13>] __alloc_pages_nodemask+0x8c3/0x8e0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222318] 
[<ffffffff81157046>] alloc_pages_current+0xb6/0x120
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222324] 
[<ffffffff81116d37>] __page_cache_alloc+0xb7/0xd0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222327] 
[<ffffffff81118d02>] filemap_fault+0x212/0x3c0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222332] 
[<ffffffff811393e2>] __do_fault+0x72/0x550
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222336] 
[<ffffffff8113ca9a>] handle_pte_fault+0xfa/0x200
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222343] 
[<ffffffff810063ee>] ? xen_pmd_val+0xe/0x10
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222347] 
[<ffffffff81005369>] ? __raw_callee_save_xen_pmd_val+0x11/0x1e
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222351] 
[<ffffffff8113dd79>] handle_mm_fault+0x269/0x370
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222359] 
[<ffffffff8165db04>] do_page_fault+0x184/0x550
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222365] 
[<ffffffff8103dd05>] ? pvclock_clocksource_read+0x55/0xf0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222370] 
[<ffffffff8100a810>] ? xen_clocksource_read+0x20/0x30
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222374] 
[<ffffffff8100a8f9>] ? xen_clocksource_get_cycles+0x9/0x10
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222380] 
[<ffffffff810948e7>] ? getnstimeofday+0x57/0xe0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222384] 
[<ffffffff8165a735>] page_fault+0x25/0x30
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222387] Mem-Info:
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222390] Node 0 DMA per-cpu:
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222393] CPU    0: hi:    0,
btch:   1 usd:   0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222395] Node 0 DMA32
per-cpu:
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222398] CPU    0: hi:  186,
btch:  31 usd: 121
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222408] active_anon:133387
inactive_anon:39 isolated_anon:0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222409]  active_file:63
inactive_file:98 isolated_file:0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222410]  unevictable:0
dirty:0 writeback:0 unstable:0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222411]  free:1353
slab_reclaimable:2875 slab_unreclaimable:5193
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222412]  mapped:67 shmem:48
pagetables:698 bounce:0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222415] Node 0 DMA
free:2424kB min:72kB low:88kB high:108kB active_anon:9328kB
inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB
isolated(anon):0kB isolated(file):0kB present:14524kB mlocked:0kB dirty:0kB
writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:844kB
slab_unreclaimable:2016kB kernel_stack:0kB pagetables:24kB unstable:0kB
bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222427] lowmem_reserve[]: 0
597 597 597
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222432] Node 0 DMA32
free:2988kB min:3088kB low:3860kB high:4632kB active_anon:524220kB
inactive_anon:156kB active_file:252kB inactive_file:392kB unevictable:0kB
isolated(anon):0kB isolated(file):0kB present:611856kB mlocked:0kB dirty:0kB
writeback:0kB mapped:268kB shmem:192kB slab_reclaimable:10656kB
slab_unreclaimable:18756kB kernel_stack:928kB pagetables:2768kB unstable:0kB
bounce:0kB writeback_tmp:0kB pages_scanned:1367 all_unreclaimable? yes
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222451] lowmem_reserve[]: 0
0 0 0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222456] Node 0 DMA: 230*4kB
76*8kB 0*16kB 0*32kB 0*64kB 1*128kB 1*256kB 1*512kB 0*1024kB 0*2048kB
0*4096kB = 2424kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222468] Node 0 DMA32:
727*4kB 8*8kB 1*16kB 0*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB
0*4096kB = 2988kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222480] 205 total pagecache
pages
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222482] 0 pages in swap
cache
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222484] Swap cache stats:
add 0, delete 0, find 0/0
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222486] Free swap  = 0kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.222488] Total swap = 0kB
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224375] 159472 pages RAM
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224377] 8388 pages reserved
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224379] 184 pages shared
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224380] 149331 pages
non-shared
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224382] [ pid ]   uid  tgid
total_vm      rss cpu oom_adj oom_score_adj name
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224388] [  264]     0   264    
4342       48   0       0             0 upstart-udev-br
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224393] [  268]     0   268    
5368      110   0     -17         -1000 udevd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224396] [  353]     0   353    
5367      106   0     -17         -1000 udevd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224400] [  354]     0   354    
5367      105   0     -17         -1000 udevd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224404] [  420]     0   420    
3798       48   0       0             0 upstart-socket-
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224407] [  641]   101   641   
63430      147   0       0             0 rsyslogd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224411] [  644]   102   644    
5981       90   0       0             0 dbus-daemon
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224414] [  723]     0   723    
3234       43   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224418] [  728]     0   728    
3234       42   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224421] [  736]     0   736    
3234       42   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224425] [  739]     0   739    
3234       41   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224428] [  744]     0   744    
3234       40   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224431] [  754]     0   754    
1083       37   0       0             0 acpid
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224435] [  755]     0   755    
4779       53   0       0             0 cron
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224438] [  756]     0   756    
4228       40   0       0             0 atd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224442] [  771]   103   771   
46919      305   0       0             0 whoopsie
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224445] [  788]     0   788    
3234       42   0       0             0 getty
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224449] [ 1057]     0  1057    
1817      125   0       0             0 dhclient3
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224452] [ 1076]     0  1076   
12509      152   0     -17         -1000 sshd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224457] [ 8056]   106  8056    
1855       46   0       0             0 epmd
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224460] [ 8393]   106  8393    
1101       25   0       0             0 rabbitmq-server
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224464] [ 8403]   106  8403  
307082   131187   0       0             0 beam
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224468] Out of memory: Kill
process 8403 (beam) score 870 or sacrifice child
Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224485] Killed process 8403
(beam) total-vm:1228328kB, anon-rss:524748kB, file-rss:0kB
Dec  4 09:49:22 ip-10-34-235-83 kernel: [7494894.351834] TCP: Possible SYN
flooding on port 5672. Sending cookies.  Check SNMP counters.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Silent-crashes-and-killed-by-ABRT-signal-tp31809p31816.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Wed Dec  4 10:00:08 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Dec 2013 10:00:08 +0000
Subject: [rabbitmq-discuss] Silent crashes, and "killed by ABRT signal"
In-Reply-To: <1386150275477-31813.post@n5.nabble.com>
References: <1386147702522-31809.post@n5.nabble.com>
 <529EF362.30004@rabbitmq.com> <1386150275477-31813.post@n5.nabble.com>
Message-ID: <529EFD28.7020507@rabbitmq.com>


Hi Carl,

On 04/12/13 09:44, carlhoerberg wrote:
> No, can't replicate it, and nothing in the system logs either (syslog or
> dmesg). 

In that case keep a log of when this happens and check whether it
correlates with any other events in your environment. Please get back in
touch when more information becomes available.

> How would I do that? As I understand, strace only trace which signals are
> received, not who issued them. 


I'm afraid you will have to refer to your OS documentation or support
channels for information on debugging signals. It is possible to
determine signal sources on Solaris, and it may be possible on your OS too.



-Emile


From emile at rabbitmq.com  Wed Dec  4 10:22:19 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Dec 2013 10:22:19 +0000
Subject: [rabbitmq-discuss] Silent crashes, and "killed by ABRT signal"
In-Reply-To: <1386150821294-31816.post@n5.nabble.com>
References: <1386147702522-31809.post@n5.nabble.com>
 <529EF362.30004@rabbitmq.com> <1386150275477-31813.post@n5.nabble.com>
 <1386150821294-31816.post@n5.nabble.com>
Message-ID: <529F025B.6000004@rabbitmq.com>


It looks like the out-of-memory killer killed the Erlang VM because the
OS was under memory pressure.

On 04/12/13 09:53, carlhoerberg wrote:

> Dec  4 09:47:39 ip-10-34-235-83 kernel: [7494791.746025] beam invoked
> oom-killer: gfp_mask=0x201da, order=0, oom_adj=0, oom_score_adj=0

> Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746225] Free swap  = 0kB
> Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494791.746227] Total swap = 0kB

Not having any swapspace won't help.

> Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224468] Out of memory: Kill
> process 8403 (beam) score 870 or sacrifice child
> Dec  4 09:47:40 ip-10-34-235-83 kernel: [7494792.224485] Killed process 8403
> (beam) total-vm:1228328kB, anon-rss:524748kB, file-rss:0kB
> Dec  4 09:49:22 ip-10-34-235-83 kernel: [7494894.351834] TCP: Possible SYN
> flooding on port 5672. Sending cookies.  Check SNMP counters.

It is possible to configure how the kernel deals with low memory in
overcommited situations. You should also configure some swapspace. If
you have any other services on the same OS that use alot of RAM then try
moving them to a different server.



-Emile

From simon at rabbitmq.com  Wed Dec  4 10:30:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Dec 2013 10:30:01 +0000
Subject: [rabbitmq-discuss] how the bug 25827 going ?
In-Reply-To: <5C870297-FA6C-4304-9F57-9A99B1C5E9BB@rabbitmq.com>
References: <1386057265607-31778.post@n5.nabble.com>
 <39B915BA-99CA-45B5-AED3-7508539EDE72@rabbitmq.com>
 <CAFrXCmKjAuW+6i+h2DkU_ZzTP5Fj3C8Qkn5nXV0ezXFH1tjSNA@mail.gmail.com>
 <5C870297-FA6C-4304-9F57-9A99B1C5E9BB@rabbitmq.com>
Message-ID: <529F0429.60304@rabbitmq.com>

Guilherme: this bug is also not related to how many *messages* there 
are, but how many queues.

Cheers, Simon

On 04/12/13 09:32, Tim Watson wrote:
> It will start, but boot up and shutdown take a very long time.
>
> Cheers,
> Tim
>
> On 4 Dec 2013, at 09:10, Guilherme Labigalini
> <guilherme.labigalini at gmail.com <mailto:guilherme.labigalini at gmail.com>>
> wrote:
>
>> Hi Tim,
>>
>> What are the side effects of this defect? Rabbit will not start the
>> number of messages in the mnesia db is too large?
>>
>> Thanks
>>
>>
>> On Tue, Dec 3, 2013 at 6:23 AM, Tim Watson <tim at rabbitmq.com
>> <mailto:tim at rabbitmq.com>> wrote:
>>
>>     We have a fix and it should be included in a future release. Not
>>     sure when that will be, but will try and remember to post back
>>     when it becomes available in the nightly builds.
>>
>>     Cheers,
>>     Tim
>>
>>     On 3 Dec 2013, at 07:54, 3k4b251 wrote:
>>
>>     > I  try  to  create  more  than  100000 queues  in  one  rabbtimq
>>     server ?
>>     > It  seems   very  hard  to   start up.    took  too  much  time
>>      and   seems
>>     > never   success?
>>     >
>>     >
>>     >
>>     > --
>>     > View this message in context:
>>     http://rabbitmq.1065348.n5.nabble.com/how-the-bug-25827-going-tp31778.html
>>     > Sent from the RabbitMQ mailing list archive at Nabble.com
>>     <http://Nabble.com>.
>>     > _______________________________________________
>>     > rabbitmq-discuss mailing list
>>     > rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From carl.hoerberg at gmail.com  Wed Dec  4 10:38:02 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 4 Dec 2013 02:38:02 -0800 (PST)
Subject: [rabbitmq-discuss] Silent crashes, and "killed by ABRT signal"
In-Reply-To: <529EFD28.7020507@rabbitmq.com>
References: <1386147702522-31809.post@n5.nabble.com>
 <529EF362.30004@rabbitmq.com> <1386150275477-31813.post@n5.nabble.com>
 <529EFD28.7020507@rabbitmq.com>
Message-ID: <1386153482640-31820.post@n5.nabble.com>

the OOM seems to been a DOS attack, thousands of connections was made to the
server, thousands of "handshake_timeout" was logged by rabbitmq:

=ERROR REPORT==== 4-Dec-2013::09:54:49 ===
closing AMQP connection <0.13858.5> (10.35.138.99:38772 ->
10.34.235.83:5672):
{handshake_timeout,handshake}



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Silent-crashes-and-killed-by-ABRT-signal-tp31809p31820.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From phil.lazarou at gmail.com  Wed Dec  4 10:39:04 2013
From: phil.lazarou at gmail.com (Phil Lazarou)
Date: Wed, 4 Dec 2013 10:39:04 +0000
Subject: [rabbitmq-discuss] RabbitMQ: Joining a cluster - help required to
 understand rabbitmq commands: start_app / stop_app
Message-ID: <CANvV6UxDszhncF9KOwTj-zv7NrmdhoOj8aCCvFOgdZXFzdZM3A@mail.gmail.com>

Hi ,

I've inherited a system from a departing user and it seems to work, but
there are intermittent problems and I feel that if I understood what was
going on, then I could help support it better.

Please note this is a complicated system using elastic cloud instances and
load balancers, but the principle is that when a new instance starts, it
needs to join the rabbit cluster. I do appreciate that asking for help when
trying to debug my system may be a "hiding to nothing" but I just want to
try and understand the joining cluster aspect.

Whenever a new server instance starts a custom bash script (written by my
company) runs. Here is the rabbit part of the script:

1: echo "CONFIGURING RABBIT CLUSTER"
2: echo "Stopping Rabbit on localhost"
3: while [[ -z $RABBIT_HOST ]]; do
4:    echo `date` "Trying to find Rabbit Host to cluster"
5:    sudo rabbitmqctl start_app
6:    sleep $WAIT_TIME
7:    sudo rabbitmqctl stop_app
8:    RABBIT_HOST=`curl -s -u guest:guest
$PRIVATE_LOAD_BALANCER_HOSTNAME:15672/api/nodes | /home/ubuntu/bin/jq -r
'map(select(.running and .type == "disc")) | .[0].name'`
9:    if [ -n $RABBIT_HOST ]; then
10:        echo `date` "Found Rabbit Host"
11:   fi
12: done
13:
14: echo `date` ": Joining Rabbit with cluster on " $RABBIT_HOST
15: sudo rabbitmqctl join_cluster $RABBIT_HOST
16: echo "Starting Rabbit on localhost"
17: sudo rabbitmqctl start_app

Here are my questions:

Line 2 : why do we want to "stop rabbit"? I feel this comment is very
misleading, since RabbitMQ as an entity will not stop. What would "stopping
rabbit" achieve?

Lines 5-7 : I can see that the rabbit command start_app is executed,
followed by a wait then a stop_app. Why? What does this achieve? Why start
then stop? Can these steps just be missed out?

Line 8: curl (and other tools) are used to query the load balancer try and
assign a value to the variable RABBIT_HOST. I get this, since we want to
cluster this instance to the load balancer.

Line 12: If this is successful, the while-do loop ends and the command to
join the cluster is issued.

Line 15: We join the cluster. Fine, although can we only join a cluster
after "stop_app" has run?

Line 17: We run start_app again! Why???

I really don't understand this whole stop_app / start_app business. Can
anyone shed any light onto what this is trying to achieve?

Thanks,
Phil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/a9970771/attachment.html>

From carl.hoerberg at gmail.com  Wed Dec  4 10:40:01 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 4 Dec 2013 02:40:01 -0800 (PST)
Subject: [rabbitmq-discuss] Silent crashes, and "killed by ABRT signal"
In-Reply-To: <1386153482640-31820.post@n5.nabble.com>
References: <1386147702522-31809.post@n5.nabble.com>
 <529EF362.30004@rabbitmq.com> <1386150275477-31813.post@n5.nabble.com>
 <529EFD28.7020507@rabbitmq.com> <1386153482640-31820.post@n5.nabble.com>
Message-ID: <1386153601717-31821.post@n5.nabble.com>

Adding a iptables ratelimit. Lowering the ulimit might have helped too, was
set to 16K.. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Silent-crashes-and-killed-by-ABRT-signal-tp31809p31821.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Dec  4 11:34:29 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Dec 2013 11:34:29 +0000
Subject: [rabbitmq-discuss] Connection alwalys is blocked!
In-Reply-To: <1386129610563-31807.post@n5.nabble.com>
References: <1386129610563-31807.post@n5.nabble.com>
Message-ID: <529F1345.2060603@rabbitmq.com>

Ultimately, if flow control is restricting you to 600 messages/s then 
that's the maximum rate that something (probably the disk - these are 
persistent messages?) can handle.

The reason you can't turn flow control off is that it wouldn't lead to a 
good outcome - you'd be able to publish messages to the server faster 
for a short while, but these messages would queue up internally 
(probably waiting to get on disk) and memory use would go through the 
roof. It's possible for memory to run out quite quickly in this sort of 
scenario, and you'd not be aware anything was wrong since the messages 
wouldn't count as in the queues yet.

Flow control is the messenger. Don't shoot it.

Cheers, Simon

On 04/12/13 04:00, pierre wrote:
> Hi:
>     Forgive my poor english.
>     When publishing rate is up to 600(one connection, one channel),
> connection state will be flow(publish rate recently restrict by server).
>      In cluster and ha environment, publishing rate is slower...
>
>       / <http://www.rabbitmq.com/memory.html> A per-connection mechanism that
> prevents messages being published faster than they can be routed to queues.
>      A global mechanism that prevents any messages from being published when
> the memory usage exceeds a configured threshold or free disk space drops
> below a configured threshold./
>
>      It looks like that a per-connection mechanism can not be configured or
> disabled.
>
>      Is there any better solution to imporve throughtput? How do id disable
> the flow-control?
>
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-alwalys-is-blocked-tp31807.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Dec  4 11:41:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Dec 2013 11:41:13 +0000
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
 node we see a very slow dequeue of messages
In-Reply-To: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
Message-ID: <529F14D9.8060203@rabbitmq.com>

The issue is that you are getting into a situation where node B is down, 
but node A is not aware of this (probably because from a TCP level it's 
not aware that the connection has been closed). Node A therefore has to 
wait a considerable time (the net_ticktime) trying to send packets to 
node B before giving up and treating the node as down.

If node A can tell at the TCP level that the connection to node B has 
gone down, then you won't have this wait, it'll just mark the node as 
down immediately and carry on.

To some extent you can tweak this behaviour by reducing net_ticktime - 
but a short net_ticktime makes it plausible that a node will be 
considered down when it isn't.

See http://www.rabbitmq.com/partitions.html for more.

Cheers, Simon

On 04/12/13 01:52, GENTLING Gregory wrote:
> Classification: Open
>
> When rabbitmq is clustered with one other node we see a very slow
> dequeue of messages. The scenario is simple, Node A and Node B in the
> cluster. They are clustered with the auto_heal option and default
> netticktime. Steps to repeat are:
>
> (These are all local connections)
>
> (1)Connect client A1 to Node A
>
> a.Client A1 creates a topic exchange
>
> b.Client A1 is a publisher with 1msg/sec
>
> (2)Connect client A2 to Node A
>
> a.Client A1 listens for the messages in the exchange
>
> (3)Connect client B to Node B   (this is important, the issue does not
> occur unless you have this remote client)
>
> a.Client B listens for the messages in the exchange
>
> (4)Pull the plug on Node B (you will not see the issue with a graceful
> shutdown), alternately you can just use ?route? to now make Node B not
> routable from Node A
>
> a.If you kill rabbitmq, you will not see the issue
>
> (5)Wait for netticktime (or until you see NodeB being removed from the
> cluster in Node A?s log)
>
> (6)Client A2 no longer receives messages at 1msg/sec, it will fall
> considerably behind but recover in about 10 mins.
>
> We have two setups with slightly different network setups (two pairs of
> Node A and B). One we see this issue on, the other we do not, so this is
> not an issue that can be always reproduced.
>
> Other issues observed in this state:
>
> ?rabbitmqctl cluster_status/list_queues/list_connections/list_exchanges
> all hang, rabbitmq status does not hang
>
> ?declareQueue, declareExchange, declareExchangePassive all hang
>
> ?disabling auto_heal does not help
>
> ?tested with both Erlang 5.9 and 5.10.3
>
> ?tested with both RabbitMq 3.1.5 and 3.1.3, same issue in both
>
> ?don?t see this issue with direct exchange
>
> ?nothing in vmstat out of the ordinary, CPU is not pegged, system is not
> thrashing
>
> Things we have ruled out:
>
> ?Iptables, tested with no rules
>
> ?Selinux, tested in permissive
>
> ?Java drivers
>
> Same thing as described here:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-June/027674.html
>
> Thank you,
>
> *Greg Gentling*
>
> Principal Software Architecture - Avant CommonApps
>
> Thales Avionics, Inc.
>
> In-Flight Entertainment and Connectivity
>
> Irvine, CA 92618
>
> 949-595-4943
>
> [@@OPEN@@]
>
> This email was classified by GENTLING Gregoryon Tuesday, December 03,
> 2013 5:52:25 PM.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Dec  4 11:45:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Dec 2013 11:45:43 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local
	network
In-Reply-To: <25870F6AB6D0E34489AD94C19EA928DB01F14844@OFLEXMB06P.centene.com>
References: <25870F6AB6D0E34489AD94C19EA928DB01F14844@OFLEXMB06P.centene.com>
Message-ID: <529F15E7.40700@rabbitmq.com>

Hi.

Could the clocks be jumping? If the clock jumped forward by a minute or 
so then the Erlang VM could maybe determine that there hasn't been any 
response from another node for a minute, which would be enough to 
trigger the node down condition.

Is there anything else in the logs for the time period just before the 
node down message?

As an aside, you might not want to have a single disk node in a cluster, 
that's a single point of failure.

Cheers, Simon

On 03/12/13 21:54, Bill Chmura wrote:
> Hi,
>
> We are experiencing a frequent partitioning problem on our network with
> our RabbitMQ cluster.  We?ve not been able to iron it out and are
> running out of time before this needs to move into production.
>
> I?ll just focus on our DEV environment as it is just a scaled down
> version of the other environments.
>
> Running on ESXi virtual machines (4GB Ram, 4 Cores dedicated)
>
> Windows2008 R2 SP1 64-Bit
>
> RabbitMQ 3.2.0
>
> Erlang R16B02
>
> There are two web servers and one app server in the above config.
> These are all connected to the same network.  Each servers is running
> its own node ? clustering is done through the rabbit config file.
>
> Devweb01 ? Ram
>
> Devweb02 ? Ram
>
> DevApp01 - Disk
>
> The problem is that every once in a while it starts partitioning off
> nodes, with nothing really correlating with it happening? not big
> traffic on the network, no disruptions we can find, etc.  We have gone
> through and made sure there were no VM settings that allowed items to
> ?go to sleep? or anything aside from a ?high performance setting?
> (versus power savings).
>
> Here is what we are seeing in the logs? which to me looks like a network
> interruption, but nothing else indicated that the machine was having
> issues.  We have a load balancer that flags systems with problems, we
> have a zenoss node monitoring the servers, we checked the ESXi charts
> and logs, we looked through windows system logs? nothing seems to have
> been amiss.
>
> *In one partitioning event we saw this in the WebApp server log:*
>
> =INFO REPORT==== 27-Nov-2013::18:11:07 ===
>
> rabbit on node 'rabbit at NURWEB-DEVWEB01' down
>
> =ERROR REPORT==== 27-Nov-2013::18:11:10 ===
>
> Mnesia('rabbit at NURWEB-DEVAPP01'): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network,
> 'rabbit at NURWEB-DEVWEB01'}
>
> *And in the DevWeb01 machine mentioned?s logs we saw this ? it also
> mentions it lost connections to both of the other boxes.*
>
> =INFO REPORT==== 27-Nov-2013::18:10:53 ===
>
> rabbit on node 'rabbit at NURWEB-DEVAPP01' down
>
> =ERROR REPORT==== 27-Nov-2013::18:10:53 ===
>
> Mnesia('rabbit at NURWEB-DEVWEB01'): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network,
> 'rabbit at NURWEB-DEVAPP01'}
>
> =ERROR REPORT==== 27-Nov-2013::18:10:59 ===
>
> Mnesia('rabbit at NURWEB-DEVWEB01'): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network,
> 'rabbit at NURWEB-DEVWEB02'}
>
> =INFO REPORT==== 27-Nov-2013::18:11:00 ===
>
> only running disc node went down
>
> =INFO REPORT==== 27-Nov-2013::18:11:01 ===
>
> rabbit on node 'rabbit at NURWEB-DEVWEB02' down
>
> =INFO REPORT==== 27-Nov-2013::18:11:04 ===
>
> only running disc node went down
>
> *And web02 only mentions the web01 going down*
>
> =INFO REPORT==== 27-Nov-2013::18:11:09 ===
>
> rabbit on node 'rabbit at NURWEB-DEVWEB01' down
>
> =ERROR REPORT==== 27-Nov-2013::18:11:11 ===
>
> Mnesia('rabbit at NURWEB-DEVWEB02'): ** ERROR ** mnes
>
> None of the rabbit installs are actually down during this?
>
> We?ve seen the same thing on our qa and production boxes ? which are the
> same configurations, just with more nodes.  Not many though 8 nodes on
> production.
>
> Any ideas would be really appreciated!  I?ve recently added a
> net_ticktime to my dev servers to set that at 120 (double I believe) to
> see if that helps.
>
> *Bill *
>
> /
>
> /
>
>
> This email and all attachments are confidential and intended solely
> for the use of the individual or entity to which they are addressed.
> If you have received this email in error please notify the sender
> by replying to this message. If you are not the intended recipient,
> please delete this message and all attachments immediately.  Do not
> copy, disclose, use or act upon the information contained. Please
> note that any views or opinions presented in this email are solely
> those of the author and do not necessarily represent those of the
> company. Finally, the recipient should check this email and any
> attachments for the presence of viruses. While every attempt is made
> to verify that the contents are safe, the company accepts no liability
> for any damage caused by any virus transmitted by this email.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From JHoge at bn.com  Wed Dec  4 13:09:39 2013
From: JHoge at bn.com (John Hoge)
Date: Wed, 4 Dec 2013 08:09:39 -0500
Subject: [rabbitmq-discuss] Tutorial vendor Files?
In-Reply-To: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A78@WCEXCPMS01.hq.bn-corp.com>

Hello RabbitMQ list,

I'm just starting out and want to work through the PHP tutorial, 
but I cannot find the "vendor" folder anywhere in the RMQ install: 
"" require_once __DIR__ . '/vendor/autoload.php'; ""

Does anyone know where to find that folder?

Thanks for considering my question, I really apocopate it.

best, 
John
-------------------------------------------------------------------------
This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
only for the use of the addressee(s) named herein.  If you are not an intended recipient,
please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
the message completely from your computer system.

From bizcenternet at gmail.com  Wed Dec  4 13:33:04 2013
From: bizcenternet at gmail.com (pierre)
Date: Wed, 4 Dec 2013 05:33:04 -0800 (PST)
Subject: [rabbitmq-discuss] Connection alwalys is blocked!
In-Reply-To: <529F1345.2060603@rabbitmq.com>
References: <1386129610563-31807.post@n5.nabble.com>
 <529F1345.2060603@rabbitmq.com>
Message-ID: <1386163984914-31828.post@n5.nabble.com>

Thanks.

1. Messages are persistent
2. Memory is 8G and disk is 100G(vm_memory_high_watermark, 0.6). Usages are
below 1%.

/that's the maximum rate that something (probably the disk - these are
persistent messages?) can handle. /, this hits me.






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-alwalys-is-blocked-tp31807p31828.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Wed Dec  4 13:59:58 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Dec 2013 17:59:58 +0400
Subject: [rabbitmq-discuss] Tutorial vendor Files?
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A78@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A78@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <401683CF-71EC-41D1-841E-7D0C15CAFBFC@rabbitmq.com>


On 4 Dec 2013, at 17:09, John Hoge <JHoge at bn.com> wrote:

> I'm just starting out and want to work through the PHP tutorial, 
> but I cannot find the "vendor" folder anywhere in the RMQ install: 
> "" require_once __DIR__ . '/vendor/autoload.php'; ""
> 
> Does anyone know where to find that folder?
> 
> Thanks for considering my question, I really apocopate it.

It assumes you manage dependencies with Composer, see
http://getcomposer.org/doc/00-intro.md

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Dec  4 14:00:26 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 4 Dec 2013 18:00:26 +0400
Subject: [rabbitmq-discuss] Connection alwalys is blocked!
In-Reply-To: <1386163984914-31828.post@n5.nabble.com>
References: <1386129610563-31807.post@n5.nabble.com>
 <529F1345.2060603@rabbitmq.com> <1386163984914-31828.post@n5.nabble.com>
Message-ID: <A4CA1AB2-0FA0-4512-9398-282FE1E43AC3@rabbitmq.com>


On 4 Dec 2013, at 17:33, pierre <bizcenternet at gmail.com> wrote:

> 1. Messages are persistent
> 2. Memory is 8G and disk is 100G(vm_memory_high_watermark, 0.6). Usages are
> below 1%.
> 
> /that's the maximum rate that something (probably the disk - these are
> persistent messages?) can handle. /, this hits me.

Pierre,

What?s the average message size, in KB?

MK

Software Engineer, Pivotal/RabbitMQ



From bchmura at nurturhealth.com  Wed Dec  4 14:06:11 2013
From: bchmura at nurturhealth.com (Bill Chmura)
Date: Wed, 4 Dec 2013 14:06:11 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local
 network
In-Reply-To: <529F15E7.40700@rabbitmq.com>
References: <25870F6AB6D0E34489AD94C19EA928DB01F14844@OFLEXMB06P.centene.com>
 <529F15E7.40700@rabbitmq.com>
Message-ID: <25870F6AB6D0E34489AD94C19EA928DB01F1679E@OFLEXMB06P.centene.com>

Hi Simon,

That was an interesting thought I had not considered, but I do not think that is the case.  They are all part of the same domain and from what I gather all the servers sync up to a domain controller and the domain controllers nominate one amongst themselves.  Also, the time seems close enough within a tick that they notice each other being gone...  I'm sending off to one of my sever guys to see if there is any chance of the VM playing catchup or something suddenly with the time anyway, checking the logs and stuff for adjustments.

For the second disk node, I hear you.  In production there are multiple everything's including app-servers which is what will be running the disk nodes.   We are also going to set up the mirroring but until the underlying infrastructure is solid I don't want to add complexity

I am going to update our other platforms with the new net-tick settings and see if any of them fail.






Regards,

Bill Chmura  
-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, December 04, 2013 6:46 AM
To: Discussions about RabbitMQ
Cc: Bill Chmura
Subject: Re: [rabbitmq-discuss] Recurring partitioning problem on local network

Hi.

Could the clocks be jumping? If the clock jumped forward by a minute or so then the Erlang VM could maybe determine that there hasn't been any response from another node for a minute, which would be enough to trigger the node down condition.

Is there anything else in the logs for the time period just before the node down message?

As an aside, you might not want to have a single disk node in a cluster, that's a single point of failure.

Cheers, Simon

On 03/12/13 21:54, Bill Chmura wrote:
> Hi,
>
> We are experiencing a frequent partitioning problem on our network 
> with our RabbitMQ cluster.  We've not been able to iron it out and are 
> running out of time before this needs to move into production.
>
> I'll just focus on our DEV environment as it is just a scaled down 
> version of the other environments.
>
> Running on ESXi virtual machines (4GB Ram, 4 Cores dedicated)
>
> Windows2008 R2 SP1 64-Bit
>
> RabbitMQ 3.2.0
>
> Erlang R16B02
>
> There are two web servers and one app server in the above config.
> These are all connected to the same network.  Each servers is running 
> its own node - clustering is done through the rabbit config file.
>
> Devweb01 - Ram
>
> Devweb02 - Ram
>
> DevApp01 - Disk
>
> The problem is that every once in a while it starts partitioning off 
> nodes, with nothing really correlating with it happening... not big 
> traffic on the network, no disruptions we can find, etc.  We have gone 
> through and made sure there were no VM settings that allowed items to 
> "go to sleep" or anything aside from a "high performance setting"
> (versus power savings).
>
> Here is what we are seeing in the logs... which to me looks like a 
> network interruption, but nothing else indicated that the machine was 
> having issues.  We have a load balancer that flags systems with 
> problems, we have a zenoss node monitoring the servers, we checked the 
> ESXi charts and logs, we looked through windows system logs... nothing 
> seems to have been amiss.
>
> *In one partitioning event we saw this in the WebApp server log:*
>
> =INFO REPORT==== 27-Nov-2013::18:11:07 ===
>
> rabbit on node 'rabbit at NURWEB-DEVWEB01' down
>
> =ERROR REPORT==== 27-Nov-2013::18:11:10 ===
>
> Mnesia('rabbit at NURWEB-DEVAPP01'): ** ERROR ** mnesia_event got 
> {inconsistent_database, running_partitioned_network, 
> 'rabbit at NURWEB-DEVWEB01'}
>
> *And in the DevWeb01 machine mentioned's logs we saw this - it also 
> mentions it lost connections to both of the other boxes.*
>
> =INFO REPORT==== 27-Nov-2013::18:10:53 ===
>
> rabbit on node 'rabbit at NURWEB-DEVAPP01' down
>
> =ERROR REPORT==== 27-Nov-2013::18:10:53 ===
>
> Mnesia('rabbit at NURWEB-DEVWEB01'): ** ERROR ** mnesia_event got 
> {inconsistent_database, running_partitioned_network, 
> 'rabbit at NURWEB-DEVAPP01'}
>
> =ERROR REPORT==== 27-Nov-2013::18:10:59 ===
>
> Mnesia('rabbit at NURWEB-DEVWEB01'): ** ERROR ** mnesia_event got 
> {inconsistent_database, running_partitioned_network, 
> 'rabbit at NURWEB-DEVWEB02'}
>
> =INFO REPORT==== 27-Nov-2013::18:11:00 ===
>
> only running disc node went down
>
> =INFO REPORT==== 27-Nov-2013::18:11:01 ===
>
> rabbit on node 'rabbit at NURWEB-DEVWEB02' down
>
> =INFO REPORT==== 27-Nov-2013::18:11:04 ===
>
> only running disc node went down
>
> *And web02 only mentions the web01 going down*
>
> =INFO REPORT==== 27-Nov-2013::18:11:09 ===
>
> rabbit on node 'rabbit at NURWEB-DEVWEB01' down
>
> =ERROR REPORT==== 27-Nov-2013::18:11:11 ===
>
> Mnesia('rabbit at NURWEB-DEVWEB02'): ** ERROR ** mnes
>
> None of the rabbit installs are actually down during this...
>
> We've seen the same thing on our qa and production boxes - which are 
> the same configurations, just with more nodes.  Not many though 8 
> nodes on production.
>
> Any ideas would be really appreciated!  I've recently added a 
> net_ticktime to my dev servers to set that at 120 (double I believe) 
> to see if that helps.
>
> *Bill *
>
> /
>
> /
>
>
> This email and all attachments are confidential and intended solely 
> for the use of the individual or entity to which they are addressed.
> If you have received this email in error please notify the sender by 
> replying to this message. If you are not the intended recipient, 
> please delete this message and all attachments immediately.  Do not 
> copy, disclose, use or act upon the information contained. Please note 
> that any views or opinions presented in this email are solely those of 
> the author and do not necessarily represent those of the company. 
> Finally, the recipient should check this email and any attachments for 
> the presence of viruses. While every attempt is made to verify that 
> the contents are safe, the company accepts no liability for any damage 
> caused by any virus transmitted by this email.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal

This email and all attachments are confidential and intended solely 
for the use of the individual or entity to which they are addressed. 
If you have received this email in error please notify the sender 
by replying to this message. If you are not the intended recipient, 
please delete this message and all attachments immediately.  Do not 
copy, disclose, use or act upon the information contained. Please 
note that any views or opinions presented in this email are solely 
those of the author and do not necessarily represent those of the 
company. Finally, the recipient should check this email and any 
attachments for the presence of viruses. While every attempt is made 
to verify that the contents are safe, the company accepts no liability 
for any damage caused by any virus transmitted by this email.


From alain.odea at gmail.com  Wed Dec  4 14:18:49 2013
From: alain.odea at gmail.com (Alain O'Dea)
Date: Wed, 4 Dec 2013 14:18:49 +0000
Subject: [rabbitmq-discuss] Java Client: Establishing Connections is
	unterruptible
Message-ID: <CAM6cUzB+-VCMfY9NV5yMotu97XvWACn+E+qt_tHMJx4vHT-r4g@mail.gmail.com>

In the Java Client it uses BlockingCell#uninterruptibleGet to perform
connection.  That method catches and buries InterruptedException as
shown at (BlockingCell:91):
https://github.com/rabbitmq/rabbitmq-java-client/blob/d9b22339ea9b3e0cd28a2dcf790b3162748828b4/src/com/rabbitmq/utility/BlockingCell.java#L91

This prevents normal interruption from functioning. It essentially
blocks normal kill signals or in-process interrupts. This prevented
Verafin from interrupting a Thread that was in the middle of opening a
Connection to RabbitMQ and forced Verafin to come up with an ugly
workaround.

Why is the InterruptedException caught and buried?

Thanks,
Alain

From bizcenternet at gmail.com  Wed Dec  4 15:01:47 2013
From: bizcenternet at gmail.com (pierre)
Date: Wed, 4 Dec 2013 07:01:47 -0800 (PST)
Subject: [rabbitmq-discuss] Connection alwalys is blocked!
In-Reply-To: <A4CA1AB2-0FA0-4512-9398-282FE1E43AC3@rabbitmq.com>
References: <1386129610563-31807.post@n5.nabble.com>
 <529F1345.2060603@rabbitmq.com> <1386163984914-31828.post@n5.nabble.com>
 <A4CA1AB2-0FA0-4512-9398-282FE1E43AC3@rabbitmq.com>
Message-ID: <1386169307772-31833.post@n5.nabble.com>

thanks a lot!

Average size of messages is about 1024bytes(maximum is 3896bytes). All
messages are persistent.
My test machines are virtual machines.

Is possible that persisting messages into disk is very slow?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connection-alwalys-is-blocked-tp31807p31833.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From k.madnani84 at gmail.com  Wed Dec  4 15:12:45 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Wed, 4 Dec 2013 07:12:45 -0800 (PST)
Subject: [rabbitmq-discuss] Usage of dot in the nodename in a cluster.
Message-ID: <1386169965364-31834.post@n5.nabble.com>

Hi,

Cant we use a dot in the name of a Nodename in a cluster.Something like this
in rabbitmq-env.conf file:
NODENAME=my.rmq.test

Because when am using such a name i see error in the log files as Invalid
node name.





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Usage-of-dot-in-the-nodename-in-a-cluster-tp31834.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Wed Dec  4 15:18:34 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Dec 2013 15:18:34 +0000
Subject: [rabbitmq-discuss] MQTT Plugin - missed and received in wrong
 order with QoS=0
In-Reply-To: <186598c3d2d4531a1f83b53edc97b67f@mail.gmail.com>
References: <186598c3d2d4531a1f83b53edc97b67f@mail.gmail.com>
Message-ID: <529F47CA.6070801@rabbitmq.com>


Hi Adrian,

On 03/12/13 22:38, Adrian Yip wrote:

> I am testing a Mosquitto client publishing 100s of messages to RabbitMQ
> exchange via the MQTT plugin with different QoS levels and I am seeing
> issues 


Thanks for taking the trouble to report this. When I run your script
with QoS 1 I see an error in the broker logfile like this:

   {function_clause,[{gb_trees,take_smallest1,[nil]},
                     {gb_trees,take_smallest,1},

This issue has been solved and will appear in the next release and
nightly builds.




-Emile




From emile at rabbitmq.com  Wed Dec  4 15:33:00 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Dec 2013 15:33:00 +0000
Subject: [rabbitmq-discuss] Usage of dot in the nodename in a cluster.
In-Reply-To: <1386169965364-31834.post@n5.nabble.com>
References: <1386169965364-31834.post@n5.nabble.com>
Message-ID: <529F4B2C.2060009@rabbitmq.com>

On 04/12/13 15:12, k.madnani84 wrote:
> Cant we use a dot in the name of a Nodename in a cluster.Something like this
> in rabbitmq-env.conf file:
> NODENAME=my.rmq.test


No, unfortunately you cannot use dots. This restriction is inherited
from Erlang. You can use dashes and underscores though:
my-rmq-test
my_rmq_test




-Emile




From sp345s at att.com  Wed Dec  4 15:49:35 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Wed, 4 Dec 2013 15:49:35 +0000
Subject: [rabbitmq-discuss] priority
Message-ID: <59BF56992750434F89F8EBE141E64B1D0183723F@GAALPA1MSGUSR9C.ITServices.sbc.com>

Does rabbitmq provide feature to set the priority of the message we send to exchanges.... And do we need to do anything different at consumer side to get high priority messages first..??

Can we use x-priority property to achieve it ?

Appreciate all the help..
Thanks,
Sagar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/c62d431d/attachment.html>

From sp345s at att.com  Wed Dec  4 16:06:28 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Wed, 4 Dec 2013 16:06:28 +0000
Subject: [rabbitmq-discuss] message persistence and file store
Message-ID: <59BF56992750434F89F8EBE141E64B1D01837264@GAALPA1MSGUSR9C.ITServices.sbc.com>


We have a topic exchange and have 3 binding's to 3 durable queues ... Just wanted to understand if there will be 3 copies of messages meaning  3 times the size of the message is getting stored on the disk ??

Also does rabbitmq use file storage on the disk to store the message?? Where can we change the storage size of the file store etc.. ??

Also does copying this file store across similar configured nodes help to show/consume the messages stuck in the file store on the new node ...(in case we don't want to use federation plugin and just want to transfer the file stores to our failover env. .. will the rabbitmq able to start off using the copied filestore ??)

Thanks for all the support..
Sagar

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/e3ef10ea/attachment.html>

From dmcintyre at gopivotal.com  Wed Dec  4 16:16:23 2013
From: dmcintyre at gopivotal.com (Duncan McIntyre)
Date: Wed, 4 Dec 2013 16:16:23 +0000
Subject: [rabbitmq-discuss] Consistent Hashing Exchange to Exchange Bindings
Message-ID: <CAAaVn2D+d3=oCqWay_=rbWhqwLt0XUnX_7cpqvVXV-+1B08r5g@mail.gmail.com>

I just tried using E2E bindings with the CHE, but it doesn't work (can't
route).

Are there any plans to make this work?

How hard would it be to implement (e.g. for an Erlang novice like me)?

Duncan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/1b76a7df/attachment.html>

From emile at rabbitmq.com  Wed Dec  4 16:20:37 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Dec 2013 16:20:37 +0000
Subject: [rabbitmq-discuss] message persistence and file store
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D01837264@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D01837264@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <529F5655.3010104@rabbitmq.com>


Hi,

On 04/12/13 16:06, PATAR, SAGAR wrote:

> We have a topic exchange and have 3 binding?s to 3 durable queues ? Just
> wanted to understand if there will be 3 copies of messages meaning  3
> times the size of the message is getting stored on the disk ??

Storage is shared across queues, so only one copy of the message will
appear on disk.

> Also does rabbitmq use file storage on the disk to store the message??
> Where can we change the storage size of the file store etc.. ??

The location pointed to by RABBITMQ_MNESIA_BASE is used. If you want to
place a limit on the storage then assign a separate disk drive or
partition to the broker.

> Also does copying this file store across similar configured nodes help
> to show/consume the messages stuck in the file store on the new node
> ?(in case we don?t want to use federation plugin and just want to
> transfer the file stores to our failover env. .. will the rabbitmq able
> to start off using the copied filestore ??)
This will only work if the entire directory is copied when the broker is
shut down, and the destination node must have the same nodename as the
source node.




-Emile





From reineke at apt-solutions.de  Wed Dec  4 16:24:16 2013
From: reineke at apt-solutions.de (Tom Reineke)
Date: Wed, 4 Dec 2013 16:24:16 +0000
Subject: [rabbitmq-discuss]
	https://groups.google.com/forum/#!topic/rabbitmq-discuss/5QHpOoMYBo8
Message-ID: <3362CF7800DADA45BA467DBEB733CD89665B76A7@MX01.owis.de>


Hi there,

is there anybody who could help me with my problem described under
https://groups.google.com/forum/#!topic/rabbitmq-discuss/5QHpOoMYBo8 ?

I'd be very grateful for any hints.

Best regards
Tom


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/6a00ba16/attachment.html>

From emile at rabbitmq.com  Wed Dec  4 16:24:36 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Dec 2013 16:24:36 +0000
Subject: [rabbitmq-discuss] priority
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0183723F@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0183723F@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <529F5744.2060407@rabbitmq.com>


Hi,

On 04/12/13 15:49, PATAR, SAGAR wrote:
> Does rabbitmq provide feature to set the priority of the message we send
> to exchanges?. And do we need to do anything different at consumer side
> to get high priority messages first..??
> 
> Can we use x-priority property to achieve it ?

The broker does not implement message priorities, but they can be
emulated by using separate queues for each priority. Consumers should
then consume from the highest priority queues first.




-Emile



From ayip at recondynamics.com  Wed Dec  4 16:19:03 2013
From: ayip at recondynamics.com (Adrian Yip)
Date: Wed, 4 Dec 2013 16:19:03 +0000 (UTC)
Subject: [rabbitmq-discuss] MQTT Plugin - missed and received in wrong
	order with QoS=0
References: <186598c3d2d4531a1f83b53edc97b67f@mail.gmail.com>
 <529F47CA.6070801@rabbitmq.com>
Message-ID: <loom.20131204T171349-18@post.gmane.org>

Emile Joubert <emile at ...> writes:

> 
> 
> Hi Adrian,
> 
> On 03/12/13 22:38, Adrian Yip wrote:
> 
> > I am testing a Mosquitto client publishing 100s of messages to RabbitMQ
> > exchange via the MQTT plugin with different QoS levels and I am seeing
> > issues 
> 
> Thanks for taking the trouble to report this. When I run your script
> with QoS 1 I see an error in the broker logfile like this:
> 
>    {function_clause,[{gb_trees,take_smallest1,[nil]},
>                      {gb_trees,take_smallest,1},
> 
> This issue has been solved and will appear in the next release and
> nightly builds.
> 
> -Emile
> 
> 

Thanks Emile for the update on the QoS=1 issue.

Were you able to reproduce the QoS=0 issue  Did you run both the publisher
and receiver scripts and observe all the messages received in order. 
Perhaps increase the total # of messages sent. 

Regards,

Adrian




From emile at rabbitmq.com  Wed Dec  4 16:28:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Dec 2013 16:28:47 +0000
Subject: [rabbitmq-discuss] MQTT Plugin - missed and received in wrong
 order with QoS=0
In-Reply-To: <loom.20131204T171349-18@post.gmane.org>
References: <186598c3d2d4531a1f83b53edc97b67f@mail.gmail.com>
 <529F47CA.6070801@rabbitmq.com> <loom.20131204T171349-18@post.gmane.org>
Message-ID: <529F583F.3040702@rabbitmq.com>


Hi Adrian,

On 04/12/13 16:19, Adrian Yip wrote:

> Were you able to reproduce the QoS=0 issue  Did you run both the publisher
> and receiver scripts and observe all the messages received in order. 
> Perhaps increase the total # of messages sent. 

I only observed errors with QoS=1, running with both publisher and
receiver and increasing the number of messages to thousands.
Perhaps you can illustrate the problem using selected output from a
network trace.


-Emile




From yan.jiang at openbet.com  Wed Dec  4 12:18:10 2013
From: yan.jiang at openbet.com (PoorRabbit)
Date: Wed, 4 Dec 2013 04:18:10 -0800 (PST)
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <E466802B-CBF2-4D83-99B7-4EF939C86380@rabbitmq.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
 <52779549.2070002@rabbitmq.com>
 <OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
 <5278C489.4010900@rabbitmq.com>
 <OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>
 <OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>
 <OF627FBA8D.62B60BDF-ONC1257C1B.002E1829-C1257C1B.002E5511@schneider-electric.com>
 <527A102E.2080608@rabbitmq.com>
 <OFE9A43A30.8BAAC17D-ONC1257C1B.003690F6-C1257C1B.0037901D@schneider-electric.com>
 <E466802B-CBF2-4D83-99B7-4EF939C86380@rabbitmq.com>
Message-ID: <1386159490167-31826.post@n5.nabble.com>

I had trouble connecting to RabbitMQ using c# client library with SSL enabled
too. But the exception I received is different, anyhow they are all to do
with certificate verification. Below is the code snippet:

            ConnectionFactory cf = new ConnectionFactory();

            cf.Uri = "amqp://user:pass at hostname:port/vhost";
            cf.Ssl.ServerName = System.Net.Dns.GetHostName();
            cf.Ssl.Enabled = true;

            using (IConnection conn = cf.CreateConnection())
            {
            }

<http://rabbitmq.1065348.n5.nabble.com/file/n31826/RabbitMQException.png> 

Eventually, I solved the problem by changing ssl settings to accept all
types of policy errors listed in SSLOption :-), as below:

            cf.Ssl.ServerName = System.Net.Dns.GetHostName();
            cf.Ssl.Enabled = true;
            cf.Ssl.AcceptablePolicyErrors =
System.Net.Security.SslPolicyErrors.RemoteCertificateChainErrors
                                            |
System.Net.Security.SslPolicyErrors.RemoteCertificateNameMismatch
                                            |
System.Net.Security.SslPolicyErrors.RemoteCertificateNotAvailable;

Took me half day to figure out. &*()(_(_^%%$

Hope it helps somebody struggling to get c# RabbitMQ client working.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/C-client-connect-using-SSL-tp31134p31826.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From andy.grunwald at gmail.com  Wed Dec  4 14:23:08 2013
From: andy.grunwald at gmail.com (Andy G.)
Date: Wed, 4 Dec 2013 06:23:08 -0800 (PST)
Subject: [rabbitmq-discuss] Supported RabbitMQ versions
Message-ID: <ce6af4be-d1d2-4e07-9724-3dee9db69b54@googlegroups.com>

Hey everybody,

i`d like to ask if there are some official statements regarding supported 
RabbitMQ versions?
Which versions are supported by the team?
Is there a defined Release / Support cycle?

e.g. How long is the RabbitMQ 3.0.* branch supported?
Which kind of fixes (security, bugs) will be introduced into 3.1.* and for 
how long?

In my opinion this are useful information to take decisions about upgrading 
existing clusters.

I asked this questions on twittter [1] already.

Thanks!

Best regards,
Andy

[1] https://twitter.com/andygrunwald/status/408235366114525184
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/9ccd39d9/attachment.html>

From tom.reineke at googlemail.com  Wed Dec  4 15:26:47 2013
From: tom.reineke at googlemail.com (Tom Reineke)
Date: Wed, 4 Dec 2013 07:26:47 -0800 (PST)
Subject: [rabbitmq-discuss] Basic question on message delivery problem
Message-ID: <444284d5-d750-4a17-b1fc-e56b2326ef7d@googlegroups.com>

Hi,

I seem to have a very basic problem when setting up RabbitMQ and would be 
grateful for any help. Ich have the following class:

public class RabbitTest {

private final static ConnectionFactory factory = new ConnectionFactory();
        private final static String MAIL_QUEUE_NAME = "mailQueue";
        private static Connection connection;
        private static Channel channel;
        private static QueueingConsumer consumer;

public static void main(final String[] args) throws IOException, 
KeyManagementException, NoSuchAlgorithmException,  URISyntaxException, 
InterruptedException {
        factory = new ConnectionFactory();
factory.setHost("localhost");
        connection = factory.newConnection();
        channel = connection.createChannel();
        channel.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
        consumer = new QueueingConsumer(channel);
        channel.basicConsume(MAIL_QUEUE_NAME, false, consumer);
        new Thread() {
            @Override
            public void run() {
                while (true) {
                    try {
                        // The processor stops here until something
                        // is in the queue. It does not continue with the 
next
                        final QueueingConsumer.Delivery delivery = consumer
                                .nextDelivery();
                        final String message = new 
String(delivery.getBody());
                        if (!StringUtils.isEmpty(message)) {
                            System.out.println("########## message 
#############");
                            System.out.println(message);
                        }
                    } catch (final Exception e) {

                    }
                }
            }
        }.start();

        for (int i = 0; i < 10; i++) {
            createMailTask("message " + i);
        }

        Thread.sleep(10000);
        channel.close();
        connection.close();
    }

    public static void createMailTask(final String amqpMessage)
            throws IOException {
        final Channel ch = connection.createChannel();
        ch.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
        ch.basicPublish("", MAIL_QUEUE_NAME,
                MessageProperties.PERSISTENT_TEXT_PLAIN, 
amqpMessage.getBytes());
        ch.close();
    }
}

I would have assumed that I get a log output for each of the 10 messages; 
instead I only get:

[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 2
[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 5
[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 8

Can you tell me where the problem is in my code?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/0e9514b7/attachment.html>

From tom.reineke at googlemail.com  Wed Dec  4 15:29:03 2013
From: tom.reineke at googlemail.com (Tom Reineke)
Date: Wed, 4 Dec 2013 16:29:03 +0100
Subject: [rabbitmq-discuss]
	https://groups.google.com/forum/#!topic/rabbitmq-discuss/5QHpOoMYBo8
Message-ID: <006301cef105$90c6c800$b2545800$@googlemail.com>

Hi there,

 

is there anybody who could help me with my problem described under 

 <https://groups.google.com/forum/#!topic/rabbitmq-discuss/5QHpOoMYBo8>
https://groups.google.com/forum/#!topic/rabbitmq-discuss/5QHpOoMYBo8 ?

 

I'd be very grateful for any hints.

 

Best regards

Tom

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/c1ffff53/attachment.html>

From simon at rabbitmq.com  Wed Dec  4 16:42:03 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Dec 2013 16:42:03 +0000
Subject: [rabbitmq-discuss] Basic question on message delivery problem
In-Reply-To: <444284d5-d750-4a17-b1fc-e56b2326ef7d@googlegroups.com>
References: <444284d5-d750-4a17-b1fc-e56b2326ef7d@googlegroups.com>
Message-ID: <529F5B5B.4010109@rabbitmq.com>

On 04/12/2013 15:26, Tom Reineke wrote:
> I would have assumed that I get a log output for each of the 10
> messages; instead I only get:
>
> [Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
> [Thread-0] INFO de.apt.utils.APTMailUtil - message 2
> [Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
> [Thread-0] INFO de.apt.utils.APTMailUtil - message 5
> [Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
> [Thread-0] INFO de.apt.utils.APTMailUtil - message 8
>
> Can you tell me where the problem is in my code?

Your code works fine for me.

I would check you haven't got any other instances of the consumer code 
running though - if you did each instance would get a round-robin set of 
the messages, leading to exactly what you're seeing.

"rabbitmqctl list_queues name consumers" should help.

Cheers, Simon

From simon at rabbitmq.com  Wed Dec  4 16:52:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Dec 2013 16:52:52 +0000
Subject: [rabbitmq-discuss] Supported RabbitMQ versions
In-Reply-To: <ce6af4be-d1d2-4e07-9724-3dee9db69b54@googlegroups.com>
References: <ce6af4be-d1d2-4e07-9724-3dee9db69b54@googlegroups.com>
Message-ID: <529F5DE4.3060800@rabbitmq.com>

On 04/12/2013 14:23, Andy G. wrote:
> Hey everybody,
>
> i`d like to ask if there are some official statements regarding
> supported RabbitMQ versions?
> Which versions are supported by the team?

Depends on whether you mean commercial support or support via this 
mailing list. For commercial support there is some complicated formula I 
can never remember. For this list, we'll tell you if we think you're 
running too old a version (which will largely depend on what sort of 
problems you're having). If you have a basic question about how routing 
works I don't care what version you're running, but if you run into a 
known fixed bug we'll probably just tell you to upgrade. And if you run 
into a bug we think we might have fixed, we'll probably tell you to 
upgrade too.

> Is there a defined Release / Support cycle?

We aim to make approximately two feature releases (i.e. 3.x.0) per year.

We aim to make a bugfix release (i.e. 3.2.x) approximately once per month.

No guarantees though, but that's the pattern we've roughly hit for the 
last couple of years.

> e.g. How long is the RabbitMQ 3.0.* branch supported?
> Which kind of fixes (security, bugs) will be introduced into 3.1.* and
> for how long?

The idea is that the stable branch just includes bug fixes (which 
includes security fixes obviously). However, some bug fixes won't go on 
the stable branch - anything which looks big and complex enough that it 
could be as destabilising as a new feature.

So far we have only introduced bug fixes for the "current" feature 
release - i.e. currently we are planning a 3.2.2 and 3.2.3 and so on, 
but I doubt there will ever be a 3.1.6 or 3.0.5 or 2.8.8.

That might change if there is a *lot* of demand. But we are a small 
team, so the demand would have to be substantial.

Cheers, Simon

From dmitry.andrianov at alertme.com  Wed Dec  4 16:53:49 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Wed, 04 Dec 2013 16:53:49 +0000
Subject: [rabbitmq-discuss] Message validation plugin
Message-ID: <529F5E1D.6020108@alertme.com>

Hi, guys.
If we need to create a Ravvit plugin doing some custom message 
validation (like rejecting a message if particular header is missing or 
another header is present) - what would be the best starting point? 
Which existing plugin should we be looking at?

Also, while we are there - is it possible (and is it ok) to do things 
like creation of an exchange and setting up exchange-to-exchange binding 
in auth backend plugin? If it is not - what would be the best approach 
to perform couple of these actions each time new client connects?

Many thanks!
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From jkuch at gopivotal.com  Wed Dec  4 17:45:24 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Wed, 4 Dec 2013 09:45:24 -0800
Subject: [rabbitmq-discuss] Message validation plugin
In-Reply-To: <529F5E1D.6020108@alertme.com>
References: <529F5E1D.6020108@alertme.com>
Message-ID: <CANOx8NmqHanznJG9mdbeabZyJUvvJJYJozE+p-Q_gwT0gKcbJg@mail.gmail.com>

>
> Also, while we are there - is it possible (and is it ok) to do things like
> creation of an exchange and setting up exchange-to-exchange binding in auth
> backend plugin? If it is not - what would be the best approach to perform
> couple of these actions each time new client connects?
>

Indeed, this is reasonable and we've done it for an internal VMware
RabbitMQ use case.  You can perform the operations you want using the
Erlang AMQP client in its internal/direct mode.  You'll want to think
carefully about what you're doing so you don't introduce security
pathologies you don't want and when in doubt, favor being as restrictive as
possible.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/92e9fe64/attachment.html>

From simon at rabbitmq.com  Wed Dec  4 17:52:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Dec 2013 17:52:31 +0000
Subject: [rabbitmq-discuss] Message validation plugin
In-Reply-To: <529F5E1D.6020108@alertme.com>
References: <529F5E1D.6020108@alertme.com>
Message-ID: <529F6BDF.4060700@rabbitmq.com>

On 04/12/2013 16:53, Dmitry Andrianov wrote:
> Hi, guys.
> If we need to create a Ravvit plugin doing some custom message
> validation (like rejecting a message if particular header is missing or
> another header is present) - what would be the best starting point?
> Which existing plugin should we be looking at?

An exchange decorator could do that as long as "rejecting the message" 
could take the form of closing the channel with an error.

A decorator gets attached to all exchanges, whereas an exchange tpye 
plugin obviously only applies to exchanges of a certain type.

The only exchange decorator at the moment is

http://hg.rabbitmq.com/rabbitmq-federation/file/85a819bbc3cc/src/rabbit_federation_exchange.erl

although note that its route/2 callback doesn't get invoked as it 
returns noroute from active_for/1.

You could do this with an exchange type also, delegating to the "actual" 
exchnage type you want and refusing to route if whatever validation fails.

> Also, while we are there - is it possible (and is it ok) to do things
> like creation of an exchange and setting up exchange-to-exchange binding
> in auth backend plugin? If it is not - what would be the best approach
> to perform couple of these actions each time new client connects?

It's not awful; it's not what it's designed for but it would work. You 
could write a plugin which subscribes to the rabbit_event handler, like 
the mgmt db does, but that's async.

Cheers, Simon

> Many thanks!
> This email is for the use of the intended recipient(s) only.
> If you have received this email in error, please notify the sender
> immediately and then delete it.
> If you are not the intended recipient, you must not use, disclose or
> distribute this email without the
> author's prior permission. AlertMe.com Ltd. is not responsible for any
> personal views expressed
> in this message or any attachments that are those of the individual sender.
>
> AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
> Registered in England, Company number 578 2908, VAT registration number
> GB 895 9914 42.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From michael.s.klishin at gmail.com  Wed Dec  4 17:57:13 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 4 Dec 2013 21:57:13 +0400
Subject: [rabbitmq-discuss] priority
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0183723F@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0183723F@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <CAE3HoVQ6gYafCfn4m1M_mzsSH8c6QL9N1O4vCrS9_4T9G64=jw@mail.gmail.com>

2013/12/4 PATAR, SAGAR <sp345s at att.com>

> Does rabbitmq provide feature to set the priority of the message we send
> to exchanges?. And do we need to do anything different at consumer side to
> get high priority messages first..??
>

See http://www.rabbitmq.com/consumer-priority.html.


>
>
> Can we use x-priority property to achieve it ?
>

The "priority" property is not used by RabbitMQ itself, applications choose
how to
interpret it.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/ec7ac02f/attachment.html>

From matthias at rabbitmq.com  Wed Dec  4 17:59:39 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 04 Dec 2013 17:59:39 +0000
Subject: [rabbitmq-discuss] Message validation plugin
In-Reply-To: <529F5E1D.6020108@alertme.com>
References: <529F5E1D.6020108@alertme.com>
Message-ID: <529F6D8B.1010507@rabbitmq.com>

On 04/12/13 16:53, Dmitry Andrianov wrote:
> If we need to create a Ravvit plugin doing some custom message
> validation (like rejecting a message if particular header is missing or
> another header is present) - what would be the best starting point?

The first question you need to ask yourself is whether you actually need 
this to be a plugin. Could the validation be performed by a rabbitmq 
client instead that reads from a queue that is bound to, say, a fanout 
exchange to which all publishers publish, and then re-sends messages to 
their ultimate destination(s)?

Regards,

Matthias.

From michael.s.klishin at gmail.com  Wed Dec  4 17:59:37 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 4 Dec 2013 21:59:37 +0400
Subject: [rabbitmq-discuss] Consistent Hashing Exchange to Exchange
	Bindings
In-Reply-To: <CAAaVn2D+d3=oCqWay_=rbWhqwLt0XUnX_7cpqvVXV-+1B08r5g@mail.gmail.com>
References: <CAAaVn2D+d3=oCqWay_=rbWhqwLt0XUnX_7cpqvVXV-+1B08r5g@mail.gmail.com>
Message-ID: <CAE3HoVSMtCjbDSGGK2GQOH3d3rdu8GguQQ6j32Otw8Xxn+eXpw@mail.gmail.com>

2013/12/4 Duncan McIntyre <dmcintyre at gopivotal.com>

> I just tried using E2E bindings with the CHE, but it doesn't work (can't
> route).
>
> Are there any plans to make this work?
>

It should work as long as routing keys are correct.

Can you provide some code that demonstrates the behavior you're seeing?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/8d8722f4/attachment.html>

From JHoge at bn.com  Wed Dec  4 18:27:09 2013
From: JHoge at bn.com (John Hoge)
Date: Wed, 4 Dec 2013 13:27:09 -0500
Subject: [rabbitmq-discuss] PHP Tutorial - vendor Files? [resend]
In-Reply-To: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>

Hello RabbitMQ list,

I'm just starting out and want to work through the PHP tutorial, 
but I cannot find the "vendor" folder anywhere in the RMQ install: 
"" require_once __DIR__ . '/vendor/autoload.php'; ""

Does anyone know where to find that folder?

Thanks for considering my question, I really apocopate it.

best, 
John
[resending, didn't make it to list first time]
-------------------------------------------------------------------------
This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
only for the use of the addressee(s) named herein.  If you are not an intended recipient,
please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
the message completely from your computer system.

From james.eddy at us.thalesgroup.com  Wed Dec  4 18:39:15 2013
From: james.eddy at us.thalesgroup.com (James)
Date: Wed, 4 Dec 2013 18:39:15 +0000 (UTC)
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
	node we see a very slow dequeue of messages
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
Message-ID: <loom.20131204T185517-818@post.gmane.org>

Simon MacMullen <simon at ...> writes:
> 
> The issue is that you are getting into a situation where node B is down, 
> but node A is not aware of this (probably because from a TCP level it's 
> not aware that the connection has been closed). Node A therefore has to 
> wait a considerable time (the net_ticktime) trying to send packets to 
> node B before giving up and treating the node as down.
> 
> If node A can tell at the TCP level that the connection to node B has 
> gone down, then you won't have this wait, it'll just mark the node as 
> down immediately and carry on.
> 
> To some extent you can tweak this behaviour by reducing net_ticktime - 
> but a short net_ticktime makes it plausible that a node will be 
> considered down when it isn't.
> 
> See http://www.rabbitmq.com/partitions.html for more.
> 
> Cheers, Simon
 
 

Hi Simon,

The issue is not that RabbitMQ does not detect a node down in a timely 
fashion, it does what I expect. The behavior in question is what happens 
after RabbitMQ removes the node due to net_ticktime expiration. If I set 
net_ticktime to 20 seconds, 20 seconds goes by, Node B is removed, and then 
the slow message delivery occurs. Likewise, set it to 10 mins, after 10 
mins, Node B is removed and the slowness occurs. Five to ten minutes after 
Node B is removed, the server catches up. So we are seeing degraded 
performance *after* Node B is removed from the cluster for up to 10 minutes. 
So much so, that even with a light load of 1MSG/sec after about 5 minutes 
the consumer falls behind by over 100MSGs. net_ticktime only effects when we 
will see the server become degraded, but not how long.

Thanks,
James


From jonathan.s.oliver42 at gmail.com  Wed Dec  4 18:48:35 2013
From: jonathan.s.oliver42 at gmail.com (Jonathan Oliver)
Date: Wed, 4 Dec 2013 10:48:35 -0800 (PST)
Subject: [rabbitmq-discuss] .NET Client - Subscription Bug
Message-ID: <e8366d22-960a-4647-b7e7-17491f231c5e@googlegroups.com>

One thing I've noticed about the high-level "Subscription" implementation 
is that when the underlying model (channel) is disposed/closed, the 
instance of the subscription remains blissfully unaware of closed/aborted 
state of the model.  Is this expected behavior, or should the subscription 
throw some kind of AlreadyClosedException or perhaps 
OperationInterruptedException, etc.?

I have attached a small sample application that uses the client and shows 
both behaviors--the current behavior, and how the behavior might be 
different.

This bug isn't critical because it can easily be worked around, but it can 
be problematic for those working with the Subscription pattern.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/e9e08ab9/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: subscription-behavior.cs
Type: text/x-csharp
Size: 1804 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/e9e08ab9/attachment.bin>

From michael.s.klishin at gmail.com  Wed Dec  4 19:25:27 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 4 Dec 2013 23:25:27 +0400
Subject: [rabbitmq-discuss] PHP Tutorial - vendor Files? [resend]
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <CAE3HoVQMBZP4QsQ24oGtyCsUgSE77Q+v1Z=7Lp_ynL0xoU3fmg@mail.gmail.com>

2013/12/4 John Hoge <JHoge at bn.com>

> I'm just starting out and want to work through the PHP tutorial,
> but I cannot find the "vendor" folder anywhere in the RMQ install:
> "" require_once __DIR__ . '/vendor/autoload.php'; ""
>
> Does anyone know where to find that folder?
>
> Thanks for considering my question, I really apocopate it.
>
> best,
> John
> [resending, didn't make it to list first time]
>

It did make it to the list. See http://markmail.org/thread/4bvjdscnrbbp4ipr.


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/048275e9/attachment.html>

From JHoge at bn.com  Wed Dec  4 19:53:17 2013
From: JHoge at bn.com (John Hoge)
Date: Wed, 4 Dec 2013 14:53:17 -0500
Subject: [rabbitmq-discuss] PHP Tutorial - vendor Files? [resend]
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0AA1@WCEXCPMS01.hq.bn-corp.com>

 Thank you Michael!
I did install composer but it did not create an autoload file, 
am working on getting that to work, then hopefully on to the tutorial.

best
jh



-----Original Message-----
From: John Hoge 
Sent: Wednesday, December 04, 2013 1:27 PM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: PHP Tutorial - vendor Files? [resend]

Hello RabbitMQ list,

I'm just starting out and want to work through the PHP tutorial, 
but I cannot find the "vendor" folder anywhere in the RMQ install: 
"" require_once __DIR__ . '/vendor/autoload.php'; ""

Does anyone know where to find that folder?

Thanks for considering my question, I really apocopate it.

best, 
John
[resending, didn't make it to list first time]
-------------------------------------------------------------------------
This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
only for the use of the addressee(s) named herein.  If you are not an intended recipient,
please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
the message completely from your computer system.

From JHoge at bn.com  Wed Dec  4 19:55:55 2013
From: JHoge at bn.com (John Hoge)
Date: Wed, 4 Dec 2013 14:55:55 -0500
Subject: [rabbitmq-discuss] Tutorial vendor Files?
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A78@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A78@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0AA2@WCEXCPMS01.hq.bn-corp.com>

 Thanks again Michael.
When I didn't see an email come in and it wasn't on the Google Groups list I thought it didn't make it, 
I didn't see it till I got to Mark Mail.

best,
jh

-----Original Message-----
From: John Hoge 
Sent: Wednesday, December 04, 2013 8:10 AM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: Tutorial vendor Files?

Hello RabbitMQ list,

I'm just starting out and want to work through the PHP tutorial, 
but I cannot find the "vendor" folder anywhere in the RMQ install: 
"" require_once __DIR__ . '/vendor/autoload.php'; ""

Does anyone know where to find that folder?

Thanks for considering my question, I really apocopate it.

best, 
John
-------------------------------------------------------------------------
This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
only for the use of the addressee(s) named herein.  If you are not an intended recipient,
please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
the message completely from your computer system.

From videlalvaro at gmail.com  Wed Dec  4 21:30:23 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 4 Dec 2013 22:30:23 +0100
Subject: [rabbitmq-discuss] PHP Tutorial - vendor Files? [resend]
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0AA1@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0AA1@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <CAMcAHLUssY0mY1vEjb4CZTD-pg+-aV0WGd_pZ0t1_MDcesUfXg@mail.gmail.com>

Hi John,

You need to run "composer.phar install" inside the PHP project where
you have the composer.json file.

That's explained on tutorial #1
http://www.rabbitmq.com/tutorials/tutorial-one-php.html

Regards,

Alvaro


On Wed, Dec 4, 2013 at 8:53 PM, John Hoge <JHoge at bn.com> wrote:
>  Thank you Michael!
> I did install composer but it did not create an autoload file,
> am working on getting that to work, then hopefully on to the tutorial.
>
> best
> jh
>
>
>
> -----Original Message-----
> From: John Hoge
> Sent: Wednesday, December 04, 2013 1:27 PM
> To: 'rabbitmq-discuss at lists.rabbitmq.com'
> Subject: PHP Tutorial - vendor Files? [resend]
>
> Hello RabbitMQ list,
>
> I'm just starting out and want to work through the PHP tutorial,
> but I cannot find the "vendor" folder anywhere in the RMQ install:
> "" require_once __DIR__ . '/vendor/autoload.php'; ""
>
> Does anyone know where to find that folder?
>
> Thanks for considering my question, I really apocopate it.
>
> best,
> John
> [resending, didn't make it to list first time]
> -------------------------------------------------------------------------
> This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
> PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
> only for the use of the addressee(s) named herein.  If you are not an intended recipient,
> please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
> the message completely from your computer system.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From shridharan.m at gmail.com  Wed Dec  4 23:11:16 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Wed, 4 Dec 2013 15:11:16 -0800
Subject: [rabbitmq-discuss] cpu & network usage
Message-ID: <CAPK6OesJC-rs5PC9D8KfeXPW8WAMUJApwAHCyxbEOuYC5EG24Q@mail.gmail.com>

Hello there,

     As a performance optimization on our rabbit mq cluster (of 2 nodes), I
removed following from a high volume non-durable queue

   1. AMQP_MANDATORY flag during publish and
   2. AMQP_AUTOACK during consume.

 As a result the number of messages on that queue went down from 150 to 15
which is fantastic and expected. But this also increased overall cpu usage
from 22% to 32% with an increased network traffic from 30k packets/sec to
40k packets/sec. The ingress & egress rate stayed the same before and after
the change i.e. around 300 msgs/sec.

  So, my question is why would network traffic increase when I make all
calls asynchronous when the ingress & egress rate is same ?

More info about the cluster:
shri at mq1:~$ sudo rabbitmqctl status
Status of node rabbit at mq1 ...
[{pid,11689},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.0.2"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},
      {rabbit,"RabbitMQ","3.0.2"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},
      {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {amqp_client,"RabbitMQ AMQP Client","3.0.2"},
      {xmerl,"XML parser","1.2.3"},
      {inets,"INETS  CXC 138 49","5.2"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:12:12] [rq:12]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,469535752},
      {connection_procs,17995944},
      {queue_procs,11675696},
      {plugins,230048},
      {other_proc,126014264},
      {mnesia,18446743803509563784},
      {mgmt_db,12530864},
      {msg_index,1934440},
      {other_ets,-18446743803280937440},
      {binary,5524296},
      {code,18395964},
      {atom,3440321},
      {other_system,43167571}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,5047128883},
 {disk_free_limit,1000000000},
 {disk_free,482189381632},
 {file_descriptors,
     [{total_limit,65436},
      {total_used,309},
      {sockets_limit,58890},
      {sockets_used,298}]},
 {processes,[{limit,1048576},{used,2992}]},
 {run_queue,7},
 {uptime,23771203}]
...done.


Thank you,
Shri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131204/15110bbd/attachment.html>

From woodslee at 126.com  Thu Dec  5 01:47:18 2013
From: woodslee at 126.com (woodslee)
Date: Thu, 5 Dec 2013 09:47:18 +0800
Subject: [rabbitmq-discuss] Basic question on message delivery problem
References: <444284d5-d750-4a17-b1fc-e56b2326ef7d@googlegroups.com>
Message-ID: <DM__131205094708_22526122743@smtp.feinno.com>

Hi Tom

I run the test in my computer, and I got all the messages form 0 to 9.
but i comment the statement 

if (!StringUtils.isEmpty(message)) 

Is the static method "isEmpty"  wrong?


----- Original Message ----- 
From: Tom Reineke 
To: rabbitmq-discuss 
Sent: 2013-12-04, 23:26:47
Subject: [rabbitmq-discuss] Basic question on message delivery problem


Hi, 


I seem to have a very basic problem when setting up RabbitMQ and would be grateful for any help. Ich have the following class:


public class RabbitTest {


private final static ConnectionFactory factory = new ConnectionFactory();
        private final static String MAIL_QUEUE_NAME = "mailQueue";
        private static Connection connection;
        private static Channel channel;
        private static QueueingConsumer consumer;


public static void main(final String[] args) throws IOException, KeyManagementException, NoSuchAlgorithmException,  URISyntaxException, InterruptedException {
        factory = new ConnectionFactory();
factory.setHost("localhost");
        connection = factory.newConnection();
        channel = connection.createChannel();
        channel.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
        consumer = new QueueingConsumer(channel);
        channel.basicConsume(MAIL_QUEUE_NAME, false, consumer);
        new Thread() {
            @Override
            public void run() {
                while (true) {
                    try {
                        // The processor stops here until something
                        // is in the queue. It does not continue with the next
                        final QueueingConsumer.Delivery delivery = consumer
                                .nextDelivery();
                        final String message = new String(delivery.getBody());
                        if (!StringUtils.isEmpty(message)) {
                            System.out.println("########## message #############");
                            System.out.println(message);
                        }
                    } catch (final Exception e) {


                    }
                }
            }
        }.start();


        for (int i = 0; i < 10; i++) {
            createMailTask("message " + i);
        }


        Thread.sleep(10000);
        channel.close();
        connection.close();
    }


    public static void createMailTask(final String amqpMessage)
            throws IOException {
        final Channel ch = connection.createChannel();
        ch.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
        ch.basicPublish("", MAIL_QUEUE_NAME,
                MessageProperties.PERSISTENT_TEXT_PLAIN, amqpMessage.getBytes());
        ch.close();
    }
}


I would have assumed that I get a log output for each of the 10 messages; instead I only get:


[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 2
[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 5
[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 8


Can you tell me where the problem is in my code?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/839c9771/attachment.html>

From reineke at apt-solutions.de  Thu Dec  5 07:42:58 2013
From: reineke at apt-solutions.de (Tom Reineke)
Date: Thu, 5 Dec 2013 07:42:58 +0000
Subject: [rabbitmq-discuss] Basic question on message delivery problem
In-Reply-To: <DM__131205094708_22526122743@smtp.feinno.com>
References: <444284d5-d750-4a17-b1fc-e56b2326ef7d@googlegroups.com>,
 <DM__131205094708_22526122743@smtp.feinno.com>
Message-ID: <EA99B8A8-69AA-4AFC-8C8E-BE66B9C78565@apt-solutions.de>

Thank you very much for your feedback, Simon and woodslee. I now have an idea what the problem might be. For both localhost and dev-environment we use the same rabbitmq-cloud service. This might explain, why I got only every second message in the first place. As I extracted the relevant code to a main-method I obviously created yet another consumer, which is why now only every third message was displayed.
I'm going to try this out. Thanks a lot!

Von meinem iPhone gesendet

Am 05.12.2013 um 02:48 schrieb "woodslee" <woodslee at 126.com<mailto:woodslee at 126.com>>:

Hi Tom

I run the test in my computer, and I got all the messages form 0 to 9.
but i comment the statement

if (!StringUtils.isEmpty(message))

Is the static method "isEmpty"  wrong?


----- Original Message -----
From: Tom Reineke<mailto:tom.reineke at googlemail.com>
To: rabbitmq-discuss<mailto:rabbitmq-discuss at googlegroups.com>
Sent: 2013-12-04, 23:26:47
Subject: [rabbitmq-discuss] Basic question on message delivery problem

Hi,

I seem to have a very basic problem when setting up RabbitMQ and would be grateful for any help. Ich have the following class:

public class RabbitTest {

private final static ConnectionFactory factory = new ConnectionFactory();
        private final static String MAIL_QUEUE_NAME = "mailQueue";
        private static Connection connection;
        private static Channel channel;
        private static QueueingConsumer consumer;

public static void main(final String[] args) throws IOException, KeyManagementException, NoSuchAlgorithmException,  URISyntaxException, InterruptedException {
        factory = new ConnectionFactory();
factory.setHost("localhost");
        connection = factory.newConnection();
        channel = connection.createChannel();
        channel.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
        consumer = new QueueingConsumer(channel);
        channel.basicConsume(MAIL_QUEUE_NAME, false, consumer);
        new Thread() {
            @Override
            public void run() {
                while (true) {
                    try {
                        // The processor stops here until something
                        // is in the queue. It does not continue with the next
                        final QueueingConsumer.Delivery delivery = consumer
                                .nextDelivery();
                        final String message = new String(delivery.getBody());
                        if (!StringUtils.isEmpty(message)) {
                            System.out.println("########## message #############");
                            System.out.println(message);
                        }
                    } catch (final Exception e) {

                    }
                }
            }
        }.start();

        for (int i = 0; i < 10; i++) {
            createMailTask("message " + i);
        }

        Thread.sleep(10000);
        channel.close();
        connection.close();
    }

    public static void createMailTask(final String amqpMessage)
            throws IOException {
        final Channel ch = connection.createChannel();
        ch.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
        ch.basicPublish("", MAIL_QUEUE_NAME,
                MessageProperties.PERSISTENT_TEXT_PLAIN, amqpMessage.getBytes());
        ch.close();
    }
}

I would have assumed that I get a log output for each of the 10 messages; instead I only get:

[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 2
[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 5
[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 8

Can you tell me where the problem is in my code?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/c679e8d5/attachment.html>

From lishulin at feinno.com  Thu Dec  5 01:37:53 2013
From: lishulin at feinno.com (lishulin)
Date: Thu, 5 Dec 2013 09:37:53 +0800
Subject: [rabbitmq-discuss] Basic question on message delivery problem
References: <444284d5-d750-4a17-b1fc-e56b2326ef7d@googlegroups.com>
Message-ID: <DM__131205093434_15284738622@smtp.feinno.com>

Hi Tom

I run the test in my computer, and I got all the messages form 0 to 9.
but i comment the statement 

if (!StringUtils.isEmpty(message)) 

Is the static method "isEmpty"  wrong?


----- Original Message ----- 
From: Tom Reineke 
To: rabbitmq-discuss 
Sent: 2013-12-04, 23:26:47
Subject: [rabbitmq-discuss] Basic question on message delivery problem


Hi,


I seem to have a very basic problem when setting up RabbitMQ and would be grateful for any help. Ich have the following class:


public class RabbitTest {


private final static ConnectionFactory factory = new ConnectionFactory();
        private final static String MAIL_QUEUE_NAME = "mailQueue";
        private static Connection connection;
        private static Channel channel;
        private static QueueingConsumer consumer;


public static void main(final String[] args) throws IOException, KeyManagementException, NoSuchAlgorithmException,  URISyntaxException, InterruptedException {
        factory = new ConnectionFactory();
factory.setHost("localhost");
        connection = factory.newConnection();
        channel = connection.createChannel();
        channel.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
        consumer = new QueueingConsumer(channel);
        channel.basicConsume(MAIL_QUEUE_NAME, false, consumer);
        new Thread() {
            @Override
            public void run() {
                while (true) {
                    try {
                        // The processor stops here until something
                        // is in the queue. It does not continue with the next
                        final QueueingConsumer.Delivery delivery = consumer
                                .nextDelivery();
                        final String message = new String(delivery.getBody());
                        if (!StringUtils.isEmpty(message)) {
                            System.out.println("########## message #############");
                            System.out.println(message);
                        }
                    } catch (final Exception e) {


                    }
                }
            }
        }.start();


        for (int i = 0; i < 10; i++) {
            createMailTask("message " + i);
        }


        Thread.sleep(10000);
        channel.close();
        connection.close();
    }


    public static void createMailTask(final String amqpMessage)
            throws IOException {
        final Channel ch = connection.createChannel();
        ch.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
        ch.basicPublish("", MAIL_QUEUE_NAME,
                MessageProperties.PERSISTENT_TEXT_PLAIN, amqpMessage.getBytes());
        ch.close();
    }
}


I would have assumed that I get a log output for each of the 10 messages; instead I only get:


[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 2
[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 5
[Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
[Thread-0] INFO de.apt.utils.APTMailUtil - message 8


Can you tell me where the problem is in my code?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/047e5ed1/attachment.html>

From 550568651 at qq.com  Thu Dec  5 09:17:18 2013
From: 550568651 at qq.com (=?gb18030?B?1Pi+rdO109A=?=)
Date: Thu, 5 Dec 2013 17:17:18 +0800
Subject: [rabbitmq-discuss] Welcome to the "rabbitmq-discuss" mailing
	list (Digest mode)
In-Reply-To: <mailman.0.1386234797.28934.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.0.1386234797.28934.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <tencent_53458596270107EA798B4DDD@qq.com>

how to start rabbitmq_services in a class of java ,a method of main
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/fecf4af3/attachment.html>

From simon at rabbitmq.com  Thu Dec  5 09:52:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Dec 2013 09:52:08 +0000
Subject: [rabbitmq-discuss] cpu & network usage
In-Reply-To: <CAPK6OesJC-rs5PC9D8KfeXPW8WAMUJApwAHCyxbEOuYC5EG24Q@mail.gmail.com>
References: <CAPK6OesJC-rs5PC9D8KfeXPW8WAMUJApwAHCyxbEOuYC5EG24Q@mail.gmail.com>
Message-ID: <52A04CC8.4010607@rabbitmq.com>

Are you saying you turned *off* auto-ack - i.e. you turned 
acknowledgements on? If so, that would account for greater network and 
CPU use.

Cheers, Simon

On 04/12/2013 23:11, shridharan muthu wrote:
> Hello there,
>       As a performance optimization on our rabbit mq cluster (of 2
> nodes), I removed following from a high volume non-durable queue
>
>  1. AMQP_MANDATORY flag during publish and
>  2. AMQP_AUTOACK during consume.
>
>   As a result the number of messages on that queue went down from 150 to
> 15 which is fantastic and expected. But this also increased overall cpu
> usage from 22% to 32% with an increased network traffic from 30k
> packets/sec to 40k packets/sec. The ingress & egress rate stayed the
> same before and after the change i.e. around 300 msgs/sec.
>
>    So, my question is why would network traffic increase when I make all
> calls asynchronous when the ingress & egress rate is same ?
>
> More info about the cluster:
> shri at mq1:~$ sudo rabbitmqctl status
> Status of node rabbit at mq1 ...
> [{pid,11689},
>   {running_applications,
>       [{rabbitmq_management,"RabbitMQ Management Console","3.0.2"},
>        {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},
>        {rabbit,"RabbitMQ","3.0.2"},
>        {os_mon,"CPO  CXC 138 46","2.2.4"},
>        {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},
>        {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},
>        {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},
>        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>        {amqp_client,"RabbitMQ AMQP Client","3.0.2"},
>        {xmerl,"XML parser","1.2.3"},
>        {inets,"INETS  CXC 138 49","5.2"},
>        {sasl,"SASL  CXC 138 11","2.1.8"},
>        {stdlib,"ERTS  CXC 138 10","1.16.4"},
>        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>   {os,{unix,linux}},
>   {erlang_version,
>       "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:12:12] [rq:12]
> [async-threads:30] [hipe] [kernel-poll:true]\n"},
>   {memory,
>       [{total,469535752},
>        {connection_procs,17995944},
>        {queue_procs,11675696},
>        {plugins,230048},
>        {other_proc,126014264},
>        {mnesia,18446743803509563784},
>        {mgmt_db,12530864},
>        {msg_index,1934440},
>        {other_ets,-18446743803280937440},
>        {binary,5524296},
>        {code,18395964},
>        {atom,3440321},
>        {other_system,43167571}]},
>   {vm_memory_high_watermark,0.4},
>   {vm_memory_limit,5047128883},
>   {disk_free_limit,1000000000},
>   {disk_free,482189381632},
>   {file_descriptors,
>       [{total_limit,65436},
>        {total_used,309},
>        {sockets_limit,58890},
>        {sockets_used,298}]},
>   {processes,[{limit,1048576},{used,2992}]},
>   {run_queue,7},
>   {uptime,23771203}]
> ...done.
>
>
> Thank you,
> Shri
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From mklishin at gopivotal.com  Thu Dec  5 10:08:44 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 5 Dec 2013 14:08:44 +0400
Subject: [rabbitmq-discuss] ANN March Hare 2.0 is released
Message-ID: <30C2808D-EBC1-4E85-AC7D-499AAAE5E2B1@rabbitmq.com>

March Hare (n?e Hot Bunnies) 2.0 is released [1] to rubygems.org.

This is a major release that introduces several significant improvements but also
has some breaking API changes.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/12/05/march-hare-2-dot-0-0-is-released/

1. http://rubygems.org/gems/march_hare/versions/2.0.0-java

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Thu Dec  5 11:03:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Dec 2013 11:03:24 +0000
Subject: [rabbitmq-discuss] Connection alwalys is blocked!
In-Reply-To: <1386169307772-31833.post@n5.nabble.com>
References: <1386129610563-31807.post@n5.nabble.com>
 <529F1345.2060603@rabbitmq.com> <1386163984914-31828.post@n5.nabble.com>
 <A4CA1AB2-0FA0-4512-9398-282FE1E43AC3@rabbitmq.com>
 <1386169307772-31833.post@n5.nabble.com>
Message-ID: <52A05D7C.4030801@rabbitmq.com>

On 04/12/2013 15:01, pierre wrote:
> Is possible that persisting messages into disk is very slow?

Well.

I don't believe that the persistence mechanism in RabbitMQ is "very 
slow" by the standards of persistence mechanisms.

But of course disk is "very slow" compared to RAM.

600 msg/s is not a good rate though, you should be able to get an order 
of magnitude improvement. But it will all come down to how fast your 
disk is.

Cheers, Simon

From haster2010 at gmail.com  Thu Dec  5 11:22:41 2013
From: haster2010 at gmail.com (Yury A)
Date: Thu, 5 Dec 2013 03:22:41 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq_c Sometimes I get
	AMQP_STATUS_TIMER_FAILURE error on Win32
Message-ID: <51c7d89c-4c11-44ce-a8f7-9c97b00de078@googlegroups.com>

Hi there!

Sometimes I get error  AMQP_STATUS_TIMER_FAILURE then I try to read 
something from RabbitMQ.
As I understand the problem is in functions QueryPerformanceFrequency 
and QueryPerformanceCounter:
one of them returns false.

Does anyone know what is the root of problem? Why this functions may fail?
Rabbitmq_c library doesn't get extended info about error  by calling 
GetLastError so I can't found real reason of that problem


P.S.
I use rabbitmq_c v 0.4.1 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/5a49fc08/attachment.html>

From simon at rabbitmq.com  Thu Dec  5 12:03:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Dec 2013 12:03:39 +0000
Subject: [rabbitmq-discuss] Erlang Client RPC issues
In-Reply-To: <15ED1DE2-F1B1-4976-AEE8-A2D4557488D9@gmail.com>
References: <15ED1DE2-F1B1-4976-AEE8-A2D4557488D9@gmail.com>
Message-ID: <52A06B9B.2030701@rabbitmq.com>

On 04/12/2013 06:06, Chris Jimison wrote:
> 1) I noticed in the amqp_rpc_client.erl that it is not handling
> #?basic.return?{} messages.  I added a call to:
>
> amqp_channel:register_return_handler(Channel, self()),
>
> in the init function and a handle_info call:
>
> handle_info({#'basic.return'{}, Content}, State = #state{continuations = Conts, channel = _Channel}) ->
>      #amqp_msg{props = #'P_basic'{correlation_id = Id}, payload = _Payload} = Content,
>      From = dict:fetch(Id, Conts),
>      gen_server:reply(From, basic_return),
>      {noreply, State};
>
>
> and that seems to work well. I am very new to RabbitMQ and I am not
> really sure if this is going to break something very badly. Is there a
> reason amqp_rpc_client is not a return_handler?

No, that seems reasonable, looks like an oversight.

> 2) When I call amqp_rpc_client:stop I am getting error messages
> (with our without my changes) about:
>
> {error,{consumer_died,normal}}
>
> It seams to me that when the Channel created in amqp_rpc_client is
> shutdown, the amqp_direct_consumer is getting the ?DOWN? message and
> returning {error, {consumer_died, Info}, C};

Hmm, this looks like a bug in amqp_direct_consumer. You can work around 
this by using amqp_selective_consumer instead:

diff -r 2678f7a61de4 src/amqp_rpc_client.erl
--- a/src/amqp_rpc_client.erl	Fri Nov 29 13:52:43 2013 +0000
+++ b/src/amqp_rpc_client.erl	Thu Dec 05 12:02:56 2013 +0000
@@ -93,7 +93,7 @@

  %% Registers this RPC client instance as a consumer to handle rpc 
responses
  setup_consumer(#state{channel = Channel, reply_queue = Q}) ->
-    amqp_channel:call(Channel, #'basic.consume'{queue = Q}).
+    amqp_channel:subscribe(Channel, #'basic.consume'{queue = Q}, self()).

  %% Publishes to the broker, stores the From address against
  %% the correlation id and increments the correlationid for
@@ -124,8 +124,7 @@
  %% Sets up a reply queue and consumer within an existing channel
  %% @private
  init([Connection, RoutingKey]) ->
-    {ok, Channel} = amqp_connection:open_channel(
-                        Connection, {amqp_direct_consumer, [self()]}),
+    {ok, Channel} = amqp_connection:open_channel(Connection),
      InitialState = #state{channel     = Channel,
                            exchange    = <<>>,
                            routing_key = RoutingKey},

> Does this sound correct that calling stop on an amqp_rpc_client
> should
> be generating so many errors? Is there some cleaner way I should be
> stopping the amqp_rpc_client?

No, this is wrong. I'll file bugs to look at these issues.

Cheers, Simon


From jan.kaliszewski at nask.pl  Thu Dec  5 13:53:45 2013
From: jan.kaliszewski at nask.pl (Jan Kaliszewski)
Date: Thu, 5 Dec 2013 14:53:45 +0100
Subject: [rabbitmq-discuss] OpenLDAP-based auth with 'other_bind' option: no
	DN attribute?
Message-ID: <20131205145345.53ac312c@krasoola.nask.waw.pl>

Hello,

First, I'd like to express my gratitude to the authors of RabbitMQ for
producing such a useful piece of software!

Now, the problem I encountered (and the solution, or workaround, I
found)...

I am trying to configure RabbitMQ for passwordless (SSL client
certificate-based) and OpenLDAP-based authentication (with the
rabbitmq_auth_mechanism_ssl and rabbitmq_auth_backend_ldap plugins
enabled).

I carefully read the https://www.rabbitmq.com/ldap.html and
http://www.rabbitmq.com/ssl.html tutorials and created the following
rabbitmq.config:

[ 
  {rabbit, [
    {auth_backends, [rabbit_auth_backend_ldap]},
    {ssl_listeners, [{"127.0.0.1", 5671},
                     {"rabbit.example.com", 5671}
    ]},
    {ssl_options, [
      {cacertfile, "/etc/rabbitmq/certs/cacert-all.pem"},
      {certfile, "/etc/rabbitmq/certs/cert-server.pem"},
      {keyfile, "/etc/rabbitmq/certs/key-server.pem"},
      {verify, verify_peer},
      {fail_if_no_peer_cert, true}
    ]},
    {auth_mechanisms, ['EXTERNAL']},
    {ssl_cert_login_from, common_name}
  ]},
  {rabbitmq_auth_backend_ldap, [
    {servers,               ["localhost"]},
    {dn_lookup_attribute,   "myLoginName"},
    {dn_lookup_base,        "dc=example,dc=com"},
    {other_bind, {
      "myLoginName=rabbit-component,ou=it-components,dc=example,dc=com",
      "my-secret-password"}},
    {use_ssl,               true},
    {port,                  636},
    {log,                   true},
    {resource_access_query,
      {equals,
        {string, "${user_dn}"},
        {string, "myLoginName=bob,ou=our-users,dc=example,dc=com"}
      }
    }
  ]}
].


The expected sequence of events is as the following:

1. A client connects and shows its TLS/SSL client certificate and the
   RabbitMQ server verifies it (see `ssl_options` above).

2. RabbitMQ binds to OpenLDAP server using fixed rabbit-specific
   credentials (see `other_bind` above).

3. The common name (CN) from the certificate becomes the ${username}
   (see `ssl_cert_login_from` above). RabbitMQ searches in OpenLDAP
   for entry whose myLoginName is equal to the ${username} (see
   `dn_lookup_attribute` and `dn_lookup_base`).

4. The entry's becomes the ${user_dn}. Then RabbitMQ can check ACLs
   (`resource_access_query` etc.)...


Everything works fine, except point #4.  A fragment from logs:

 ** {{badmatch,undefined},
     [{rabbit_auth_backend_ldap,username_to_dn,3,[]},
      {rabbit_auth_backend_ldap,do_login,4,[]},
      {rabbit_auth_backend_ldap,with_ldap,3,[]},
      {rabbit_auth_backend_ldap,handle_call,3,[]},
      {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,588}]},
      {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}


I investigated the problem and learned that the list of entries
returned from the search triggered in the following function is empty
(no entries are returned).

From rabbitmq-auth-backend-ldap/src/rabbit_auth_backend_ldap.erl:

 username_to_dn(Username, LDAP, Attr) ->
     Filled = fill_user_dn_pattern(Username),
     case eldap:search(LDAP,
                       [{base, env(dn_lookup_base)},
                        {filter, eldap:equalityMatch(Attr, Filled)},
                        {attributes, ["distinguishedName"]}]) of
         {ok, #eldap_search_result{entries = [#eldap_entry{attributes = A}]}} ->
             [DN] = pget("distinguishedName", A),
             DN;
         {ok, #eldap_search_result{entries = Entries}} ->
             rabbit_log:warning("Searching for DN for ~s, got back ~p~n",
                                [Filled, Entries]), Filled;
         {error, _} = E ->
             exit(E) end.


It seems that 'distinguishedName' (DN) is not treated (by OpenLDAP?) as
a real LDAP attribute.

When I patched that function by replacing the lines:

         {ok, #eldap_search_result{entries = [#eldap_entry{attributes = A}]}} ->
             [DN] = pget("distinguishedName", A),
with:
         {ok, #eldap_search_result{entries = [#eldap_entry{object_name = DN}]}} ->

...everything started working.


Am I missing something or is it the only way to make the stuff work, at
least with OpenLDAP 2.4.31?

I tried all that stuff both with RabbitMQ (+ plugins):
* in version 2.8.4, and
* in version 3.2.1.


Cheers,
*j

-- 
Jan Kaliszewski <jan.kaliszewski at nask.pl>

From tom.reineke at googlemail.com  Thu Dec  5 11:02:14 2013
From: tom.reineke at googlemail.com (Tom Reineke)
Date: Thu, 5 Dec 2013 03:02:14 -0800 (PST)
Subject: [rabbitmq-discuss] Basic question on message delivery problem
In-Reply-To: <444284d5-d750-4a17-b1fc-e56b2326ef7d@googlegroups.com>
References: <444284d5-d750-4a17-b1fc-e56b2326ef7d@googlegroups.com>
Message-ID: <ae86205d-1bf3-4257-bc12-961631b2cecd@googlegroups.com>



Thanks to the feedback of Simon and woodslee I found out what the problem 
was. For both localhost and dev-environment we use the same rabbitmq-cloud 
service and therefore I received only every second message in the first 
place. As I extracted the relevant code to a main-method (as you can see 
above) I obviously created yet another consumer, which is why now only 
every third message was displayed. The solution was to create a different 
mail queue for each environment.

Am Mittwoch, 4. Dezember 2013 16:26:47 UTC+1 schrieb Tom Reineke:
>
> Hi,
>
> I seem to have a very basic problem when setting up RabbitMQ and would be 
> grateful for any help. Ich have the following class:
>
> public class RabbitTest {
>
> private final static ConnectionFactory factory = new ConnectionFactory();
>         private final static String MAIL_QUEUE_NAME = "mailQueue";
>         private static Connection connection;
>         private static Channel channel;
>         private static QueueingConsumer consumer;
>
> public static void main(final String[] args) throws IOException, 
> KeyManagementException, NoSuchAlgorithmException,  URISyntaxException, 
> InterruptedException {
>         factory = new ConnectionFactory();
> factory.setHost("localhost");
>         connection = factory.newConnection();
>         channel = connection.createChannel();
>         channel.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
>         consumer = new QueueingConsumer(channel);
>         channel.basicConsume(MAIL_QUEUE_NAME, false, consumer);
>         new Thread() {
>             @Override
>             public void run() {
>                 while (true) {
>                     try {
>                         // The processor stops here until something
>                         // is in the queue. It does not continue with the 
> next
>                         final QueueingConsumer.Delivery delivery = consumer
>                                 .nextDelivery();
>                         final String message = new 
> String(delivery.getBody());
>                         if (!StringUtils.isEmpty(message)) {
>                             System.out.println("########## message 
> #############");
>                             System.out.println(message);
>                         }
>                     } catch (final Exception e) {
>
>                     }
>                 }
>             }
>         }.start();
>
>         for (int i = 0; i < 10; i++) {
>             createMailTask("message " + i);
>         }
>
>         Thread.sleep(10000);
>         channel.close();
>         connection.close();
>     }
>
>     public static void createMailTask(final String amqpMessage)
>             throws IOException {
>         final Channel ch = connection.createChannel();
>         ch.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);
>         ch.basicPublish("", MAIL_QUEUE_NAME,
>                 MessageProperties.PERSISTENT_TEXT_PLAIN, 
> amqpMessage.getBytes());
>         ch.close();
>     }
> }
>
> I would have assumed that I get a log output for each of the 10 messages; 
> instead I only get:
>
> [Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
> [Thread-0] INFO de.apt.utils.APTMailUtil - message 2
> [Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
> [Thread-0] INFO de.apt.utils.APTMailUtil - message 5
> [Thread-0] INFO de.apt.utils.APTMailUtil - ########## message #############
> [Thread-0] INFO de.apt.utils.APTMailUtil - message 8
>
> Can you tell me where the problem is in my code?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/eea7c047/attachment.html>

From dgritsko at gmail.com  Thu Dec  5 14:14:44 2013
From: dgritsko at gmail.com (Dan Gritsko)
Date: Thu, 5 Dec 2013 09:14:44 -0500
Subject: [rabbitmq-discuss] Memory usage for Durable Queues and Persistent
	Messages
Message-ID: <CALXutY+68TXtZK=zecoXEXeY9O7tr_5rkGLrkfjYYT3g8crMDA@mail.gmail.com>

Hi all,


I have a three-node cluster containing a durable queue that is mirrored
across all three nodes. Persistent messages are being published to an
exchange routed to this queue (delivery mode = 2). I have intentionally
disabled all consumers of this queue in order to see how memory and disk
usage are affected. I'd expect the memory usage to remain fairly low, while
the disk usage increases (since all the messages for this queue should be
persisted to disk).



However, after letting several hundred thousand messages accumulate in this
queue, I was surprised to notice that the memory usage on the primary node
for this queue is significantly higher (roughly 3x) than the other two
nodes in the cluster. Shouldn't the memory usage be roughly equivalent,
since the queue is mirrored across all three nodes in the cluster?



Additionally, when I view the "Memory details" for the primary node for
this queue, the majority of the memory is occupied by the "Binaries"
category of the breakdown. The documentation page states that "In-memory
message bodies show up" in this category. But shouldn't the message bodies
all be on the disk, and not in memory and affecting the report in this way?


Any clarification regarding these issues would be greatly appreciated.
Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/b855f807/attachment.html>

From shridharan.m at gmail.com  Thu Dec  5 15:22:58 2013
From: shridharan.m at gmail.com (shridharan.m)
Date: Thu, 05 Dec 2013 07:22:58 -0800
Subject: [rabbitmq-discuss] cpu & network usage
Message-ID: <cjvs5l8lq0jutui6gwchtwdd.1386252876957@email.android.com>

Hello Simon,?
? ? ?Oops. I meant to say I removed acks.?

Shri


Simon MacMullen <simon at rabbitmq.com> wrote:Are you saying you turned *off* auto-ack - i.e. you turned 
acknowledgements on? If so, that would account for greater network and 
CPU use.

Cheers, Simon

On 04/12/2013 23:11, shridharan muthu wrote:
> Hello there,
>?????? As a performance optimization on our rabbit mq cluster (of 2
> nodes), I removed following from a high volume non-durable queue
>
>? 1. AMQP_MANDATORY flag during publish and
>? 2. AMQP_AUTOACK during consume.
>
>?? As a result the number of messages on that queue went down from 150 to
> 15 which is fantastic and expected. But this also increased overall cpu
> usage from 22% to 32% with an increased network traffic from 30k
> packets/sec to 40k packets/sec. The ingress & egress rate stayed the
> same before and after the change i.e. around 300 msgs/sec.
>
>??? So, my question is why would network traffic increase when I make all
> calls asynchronous when the ingress & egress rate is same ?
>
> More info about the cluster:
> shri at mq1:~$ sudo rabbitmqctl status
> Status of node rabbit at mq1 ...
> [{pid,11689},
>?? {running_applications,
>?????? [{rabbitmq_management,"RabbitMQ Management Console","3.0.2"},
>??????? {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},
>??????? {rabbit,"RabbitMQ","3.0.2"},
>??????? {os_mon,"CPO? CXC 138 46","2.2.4"},
>??????? {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},
>??????? {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},
>??????? {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},
>??????? {mnesia,"MNESIA? CXC 138 12","4.4.12"},
>??????? {amqp_client,"RabbitMQ AMQP Client","3.0.2"},
>??????? {xmerl,"XML parser","1.2.3"},
>??????? {inets,"INETS? CXC 138 49","5.2"},
>??????? {sasl,"SASL? CXC 138 11","2.1.8"},
>??????? {stdlib,"ERTS? CXC 138 10","1.16.4"},
>??????? {kernel,"ERTS? CXC 138 10","2.13.4"}]},
>?? {os,{unix,linux}},
>?? {erlang_version,
>?????? "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:12:12] [rq:12]
> [async-threads:30] [hipe] [kernel-poll:true]\n"},
>?? {memory,
>?????? [{total,469535752},
>??????? {connection_procs,17995944},
>??????? {queue_procs,11675696},
>??????? {plugins,230048},
>??????? {other_proc,126014264},
>??????? {mnesia,18446743803509563784},
>??????? {mgmt_db,12530864},
>??????? {msg_index,1934440},
>??????? {other_ets,-18446743803280937440},
>??????? {binary,5524296},
>??????? {code,18395964},
>??????? {atom,3440321},
>??????? {other_system,43167571}]},
>?? {vm_memory_high_watermark,0.4},
>?? {vm_memory_limit,5047128883},
>?? {disk_free_limit,1000000000},
>?? {disk_free,482189381632},
>?? {file_descriptors,
>?????? [{total_limit,65436},
>??????? {total_used,309},
>??????? {sockets_limit,58890},
>??????? {sockets_used,298}]},
>?? {processes,[{limit,1048576},{used,2992}]},
>?? {run_queue,7},
>?? {uptime,23771203}]
> ...done.
>
>
> Thank you,
> Shri
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/4b810520/attachment.html>

From simon at rabbitmq.com  Thu Dec  5 15:43:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Dec 2013 15:43:54 +0000
Subject: [rabbitmq-discuss] Memory usage for Durable Queues and
 Persistent Messages
In-Reply-To: <CALXutY+68TXtZK=zecoXEXeY9O7tr_5rkGLrkfjYYT3g8crMDA@mail.gmail.com>
References: <CALXutY+68TXtZK=zecoXEXeY9O7tr_5rkGLrkfjYYT3g8crMDA@mail.gmail.com>
Message-ID: <52A09F3A.6030504@rabbitmq.com>

On 05/12/2013 14:14, Dan Gritsko wrote:
> Additionally, when I view the "Memory details" for the primary node for
> this queue, the majority of the memory is occupied by the "Binaries"
> category of the breakdown. The documentation page states that "In-memory
> message bodies show up" in this category. But shouldn't the message
> bodies all be on the disk, and not in memory and affecting the report in
> this way?
>

Marking a message "persistent" means it will be on disk. But it doesn't 
guarantee it will not be in memory. After all, if it's in memory too it 
can be delivered more quickly. RabbitMQ will keep messages (persistent 
or not) in memory until it starts to come under memory pressure, at 
which point it will start to evict them.

See http://www.rabbitmq.com/memory.html#memsup-paging

So the differences in memory use can probably be explained that the 
nodes had come under different amounts of memory pressure and thus some 
had paged out and some had not.

Cheers, Simon


From JHoge at bn.com  Thu Dec  5 15:44:21 2013
From: JHoge at bn.com (John Hoge)
Date: Thu, 5 Dec 2013 10:44:21 -0500
Subject: [rabbitmq-discuss] PHP Tutorial - vendor Files? [resend]
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0AAE@WCEXCPMS01.hq.bn-corp.com>

Thanks Alvaro.
Yeah saw that too, but it's not working on my XP machine, still trouble shooting this part.
The phar file won't run from the project directory, composer itself does, 
but composer is just not creating an autoload file, even though openssl is enabled.

thanks guys, I appreciate the help,
jh

-----Original Message-----
From: John Hoge 
Sent: Wednesday, December 04, 2013 1:27 PM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: PHP Tutorial - vendor Files? [resend]

Hello RabbitMQ list,

I'm just starting out and want to work through the PHP tutorial, 
but I cannot find the "vendor" folder anywhere in the RMQ install: 
"" require_once __DIR__ . '/vendor/autoload.php'; ""

Does anyone know where to find that folder?

Thanks for considering my question, I really apocopate it.

best, 
John
[resending, didn't make it to list first time]
-------------------------------------------------------------------------
This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
only for the use of the addressee(s) named herein.  If you are not an intended recipient,
please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
the message completely from your computer system.

From videlalvaro at gmail.com  Thu Dec  5 15:54:05 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 5 Dec 2013 16:54:05 +0100
Subject: [rabbitmq-discuss] PHP Tutorial - vendor Files? [resend]
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0AAE@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A9D@WCEXCPMS01.hq.bn-corp.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0AAE@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <CAMcAHLXJSGME9hY8VDUeZhBM2B44m9ET02wK=0rT9cYDwqvmjA@mail.gmail.com>

Make sure you have composer properly installed for windows since the phar
file is composer specific.

On Thursday, December 5, 2013, John Hoge wrote:

> Thanks Alvaro.
> Yeah saw that too, but it's not working on my XP machine, still trouble
> shooting this part.
> The phar file won't run from the project directory, composer itself does,
> but composer is just not creating an autoload file, even though openssl is
> enabled.
>
> thanks guys, I appreciate the help,
> jh
>
> -----Original Message-----
> From: John Hoge
> Sent: Wednesday, December 04, 2013 1:27 PM
> To: 'rabbitmq-discuss at lists.rabbitmq.com <javascript:;>'
> Subject: PHP Tutorial - vendor Files? [resend]
>
> Hello RabbitMQ list,
>
> I'm just starting out and want to work through the PHP tutorial,
> but I cannot find the "vendor" folder anywhere in the RMQ install:
> "" require_once __DIR__ . '/vendor/autoload.php'; ""
>
> Does anyone know where to find that folder?
>
> Thanks for considering my question, I really apocopate it.
>
> best,
> John
> [resending, didn't make it to list first time]
> -------------------------------------------------------------------------
> This electronic mail message contains information that (a) is or may be
> CONFIDENTIAL,
> PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and
> (b) is intended
> only for the use of the addressee(s) named herein.  If you are not an
> intended recipient,
> please send an email immediately to postmaster at bn.com <javascript:;>  and
> take the steps necessary to delete
> the message completely from your computer system.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com <javascript:;>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/27a8aea4/attachment.html>

From emile at rabbitmq.com  Thu Dec  5 16:20:54 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 05 Dec 2013 16:20:54 +0000
Subject: [rabbitmq-discuss] .NET Client - Subscription Bug
In-Reply-To: <e8366d22-960a-4647-b7e7-17491f231c5e@googlegroups.com>
References: <e8366d22-960a-4647-b7e7-17491f231c5e@googlegroups.com>
Message-ID: <52A0A7E6.2000802@rabbitmq.com>


Hi Jonathan,

On 04/12/13 18:48, Jonathan Oliver wrote:

> This bug isn't critical because it can easily be worked around, but it
> can be problematic for those working with the Subscription pattern.

Thanks for your feedback. I agree that channel failures should propagate
to the subscription. A possible interim solution while we correct that
is to register a model shutdown eventhandler.



-Emile




From alan.antonuk at gmail.com  Thu Dec  5 16:40:58 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 5 Dec 2013 08:40:58 -0800
Subject: [rabbitmq-discuss] rabbitmq_c Sometimes I get
 AMQP_STATUS_TIMER_FAILURE error on Win32
In-Reply-To: <51c7d89c-4c11-44ce-a8f7-9c97b00de078@googlegroups.com>
References: <51c7d89c-4c11-44ce-a8f7-9c97b00de078@googlegroups.com>
Message-ID: <CAAt2poJa76O6W9hhO9A1NSB6Q1g6bxPf1E2UcmdNOX0XQWZBwg@mail.gmail.com>

I recently merged in a fix for timeouts on Win32 related to handling the
return from QueryPerformanceCounter() (see:
https://github.com/alanxz/rabbitmq-c/pull/153).

Try building from the master branch and see if this fixes your problem.

-Alan


On Thu, Dec 5, 2013 at 3:22 AM, Yury A <haster2010 at gmail.com> wrote:

> Hi there!
>
> Sometimes I get error  AMQP_STATUS_TIMER_FAILURE then I try to read
> something from RabbitMQ.
> As I understand the problem is in functions QueryPerformanceFrequency
> and QueryPerformanceCounter:
> one of them returns false.
>
> Does anyone know what is the root of problem? Why this functions may fail?
> Rabbitmq_c library doesn't get extended info about error  by calling
> GetLastError so I can't found real reason of that problem
>
>
> P.S.
> I use rabbitmq_c v 0.4.1
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/4430f025/attachment.html>

From emile at rabbitmq.com  Thu Dec  5 16:56:28 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 05 Dec 2013 16:56:28 +0000
Subject: [rabbitmq-discuss] Java Client: Establishing Connections is
	unterruptible
In-Reply-To: <CAM6cUzB+-VCMfY9NV5yMotu97XvWACn+E+qt_tHMJx4vHT-r4g@mail.gmail.com>
References: <CAM6cUzB+-VCMfY9NV5yMotu97XvWACn+E+qt_tHMJx4vHT-r4g@mail.gmail.com>
Message-ID: <52A0B03C.4090703@rabbitmq.com>




On 04/12/13 14:18, Alain O'Dea wrote:

> This prevents normal interruption from functioning. It essentially
> blocks normal kill signals or in-process interrupts. This prevented
> Verafin from interrupting a Thread that was in the middle of opening a
> Connection to RabbitMQ and forced Verafin to come up with an ugly
> workaround.
> 
> Why is the InterruptedException caught and buried?

InterruptedException s are used internally within the implementation of
BlockingCell. Can you explain what Verafin tries to accomplish? What do
you mean by "normal interruption"? Perhaps there is another way of doing
the same thing.



-Emile




From emile at rabbitmq.com  Thu Dec  5 17:03:35 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 05 Dec 2013 17:03:35 +0000
Subject: [rabbitmq-discuss] RabbitMQ: Joining a cluster - help required
 to understand rabbitmq commands: start_app / stop_app
In-Reply-To: <CANvV6UxDszhncF9KOwTj-zv7NrmdhoOj8aCCvFOgdZXFzdZM3A@mail.gmail.com>
References: <CANvV6UxDszhncF9KOwTj-zv7NrmdhoOj8aCCvFOgdZXFzdZM3A@mail.gmail.com>
Message-ID: <52A0B1E7.2070702@rabbitmq.com>

On 04/12/13 10:39, Phil Lazarou wrote:

> Here are my questions:

"stop_app" gets the broker in a state where the database can be
configured but where the broker doesn't process messages.
Most of your questions should be answered on this page:
http://www.rabbitmq.com/clustering.html

If any questions remain or if anything is unclear then please do ask again.




-Emile




From Gregory.GENTLING at us.thalesgroup.com  Thu Dec  5 19:00:11 2013
From: Gregory.GENTLING at us.thalesgroup.com (GENTLING Gregory)
Date: Thu, 5 Dec 2013 11:00:11 -0800
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
 node we see a very slow dequeue of messages
In-Reply-To: <529F14D9.8060203@rabbitmq.com>
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
Message-ID: <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>

Classification: Thales Group Internal

Hi Simon,

The issue is not that RabbitMQ does not detect a node down in a timely fashion, it does what I expect. The behavior in question is what happens after RabbitMQ removes the node due to net_ticktime expiration. If I set net_ticktime to 20 seconds, 20 seconds goes by, Node B is removed, and then the slow message delivery occurs. Likewise, set it to 10 mins, after 10 mins, Node B is removed and the slowness occurs. Five to ten minutes after Node B is removed, the server catches up. So we are seeing degraded performance *after* Node B is removed from the cluster for up to 10 minutes. 
So much so, that even with a light load of 1MSG/sec after about 5 minutes the consumer falls behind by over 100MSGs. net_ticktime only effects when we will see the server become degraded, but not how long.

Thanks,

Greg & James

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: Wednesday, December 04, 2013 3:41 AM
To: Discussions about RabbitMQ
Cc: GENTLING Gregory
Subject: Re: [rabbitmq-discuss] When rabbitmq is clustered with one other node we see a very slow dequeue of messages

The issue is that you are getting into a situation where node B is down, but node A is not aware of this (probably because from a TCP level it's not aware that the connection has been closed). Node A therefore has to wait a considerable time (the net_ticktime) trying to send packets to node B before giving up and treating the node as down.

If node A can tell at the TCP level that the connection to node B has gone down, then you won't have this wait, it'll just mark the node as down immediately and carry on.

To some extent you can tweak this behaviour by reducing net_ticktime - but a short net_ticktime makes it plausible that a node will be considered down when it isn't.

See http://www.rabbitmq.com/partitions.html for more.

Cheers, Simon

On 04/12/13 01:52, GENTLING Gregory wrote:
> Classification: Open
>
> When rabbitmq is clustered with one other node we see a very slow 
> dequeue of messages. The scenario is simple, Node A and Node B in the 
> cluster. They are clustered with the auto_heal option and default 
> netticktime. Steps to repeat are:
>
> (These are all local connections)
>
> (1)Connect client A1 to Node A
>
> a.Client A1 creates a topic exchange
>
> b.Client A1 is a publisher with 1msg/sec
>
> (2)Connect client A2 to Node A
>
> a.Client A1 listens for the messages in the exchange
>
> (3)Connect client B to Node B   (this is important, the issue does not
> occur unless you have this remote client)
>
> a.Client B listens for the messages in the exchange
>
> (4)Pull the plug on Node B (you will not see the issue with a graceful 
> shutdown), alternately you can just use "route" to now make Node B not 
> routable from Node A
>
> a.If you kill rabbitmq, you will not see the issue
>
> (5)Wait for netticktime (or until you see NodeB being removed from the 
> cluster in Node A's log)
>
> (6)Client A2 no longer receives messages at 1msg/sec, it will fall 
> considerably behind but recover in about 10 mins.
>
> We have two setups with slightly different network setups (two pairs 
> of Node A and B). One we see this issue on, the other we do not, so 
> this is not an issue that can be always reproduced.
>
> Other issues observed in this state:
>
> *rabbitmqctl
> cluster_status/list_queues/list_connections/list_exchanges
> all hang, rabbitmq status does not hang
>
> *declareQueue, declareExchange, declareExchangePassive all hang
>
> *disabling auto_heal does not help
>
> *tested with both Erlang 5.9 and 5.10.3
>
> *tested with both RabbitMq 3.1.5 and 3.1.3, same issue in both
>
> *don't see this issue with direct exchange
>
> *nothing in vmstat out of the ordinary, CPU is not pegged, system is 
> not thrashing
>
> Things we have ruled out:
>
> *Iptables, tested with no rules
>
> *Selinux, tested in permissive
>
> *Java drivers
>
> Same thing as described here:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-June/027674.
> html
>
> Thank you,
>
> *Greg Gentling*
>
> Principal Software Architecture - Avant CommonApps
>
> Thales Avionics, Inc.
>
> In-Flight Entertainment and Connectivity
>
> Irvine, CA 92618
>
> 949-595-4943
>
> [@@OPEN@@]
>
> This email was classified by GENTLING Gregoryon Tuesday, December 03,
> 2013 5:52:25 PM.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal

[@@THALES GROUP INTERNAL@@]
 
This email was classified by GENTLING Gregory on Thursday, December 05, 2013 11:00:11 AM.

From sean at monkeysnatchbanana.com  Thu Dec  5 19:23:56 2013
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu, 5 Dec 2013 14:23:56 -0500
Subject: [rabbitmq-discuss] exporting policies...
Message-ID: <CABm-Wmct4v8qOGp+5g=+cJE2hnCDXomWuRYb5fGS6-Urw-yRNw@mail.gmail.com>

rabbitmqadmin export rabbit.config

exports queues, exchanges and users but not policies.
how can i programatically export our policy definitions?

-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/3e04dcf5/attachment.html>

From sean at monkeysnatchbanana.com  Thu Dec  5 19:40:53 2013
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu, 5 Dec 2013 14:40:53 -0500
Subject: [rabbitmq-discuss] exporting policies...
In-Reply-To: <CABm-Wmct4v8qOGp+5g=+cJE2hnCDXomWuRYb5fGS6-Urw-yRNw@mail.gmail.com>
References: <CABm-Wmct4v8qOGp+5g=+cJE2hnCDXomWuRYb5fGS6-Urw-yRNw@mail.gmail.com>
Message-ID: <CABm-WmcWX9LrkTvHAmkyYqrjccSfAVSqbj5MPOa1hEHhtcsheA@mail.gmail.com>

nevermind. the person who set up our cluster messed w/ rabbitmqadmin and it
wasnt exporting.

nothing to see here. move along.


On Thu, Dec 5, 2013 at 2:23 PM, Sean Allen <sean at monkeysnatchbanana.com>wrote:

> rabbitmqadmin export rabbit.config
>
> exports queues, exchanges and users but not policies.
> how can i programatically export our policy definitions?
>
> --
>
> Ce n'est pas une signature
>



-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/1f467bde/attachment.html>

From cjimison at gmail.com  Thu Dec  5 20:13:28 2013
From: cjimison at gmail.com (Chris Jimison)
Date: Thu, 5 Dec 2013 12:13:28 -0800
Subject: [rabbitmq-discuss] Erlang Client RPC issues
In-Reply-To: <52A06B9B.2030701@rabbitmq.com>
References: <15ED1DE2-F1B1-4976-AEE8-A2D4557488D9@gmail.com>
 <52A06B9B.2030701@rabbitmq.com>
Message-ID: <D4D45E60-61B5-449A-8884-3C63101D8FEF@gmail.com>

This worked great.  Thanks Simon for your help!

-Chris

On Dec 5, 2013, at 4:03 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/12/2013 06:06, Chris Jimison wrote:
>> 1) I noticed in the amqp_rpc_client.erl that it is not handling
>> #?basic.return?{} messages.  I added a call to:
>> 
>> amqp_channel:register_return_handler(Channel, self()),
>> 
>> in the init function and a handle_info call:
>> 
>> handle_info({#'basic.return'{}, Content}, State = #state{continuations = Conts, channel = _Channel}) ->
>>     #amqp_msg{props = #'P_basic'{correlation_id = Id}, payload = _Payload} = Content,
>>     From = dict:fetch(Id, Conts),
>>     gen_server:reply(From, basic_return),
>>     {noreply, State};
>> 
>> 
>> and that seems to work well. I am very new to RabbitMQ and I am not
>> really sure if this is going to break something very badly. Is there a
>> reason amqp_rpc_client is not a return_handler?
> 
> No, that seems reasonable, looks like an oversight.
> 
>> 2) When I call amqp_rpc_client:stop I am getting error messages
>> (with our without my changes) about:
>> 
>> {error,{consumer_died,normal}}
>> 
>> It seams to me that when the Channel created in amqp_rpc_client is
>> shutdown, the amqp_direct_consumer is getting the ?DOWN? message and
>> returning {error, {consumer_died, Info}, C};
> 
> Hmm, this looks like a bug in amqp_direct_consumer. You can work around this by using amqp_selective_consumer instead:
> 
> diff -r 2678f7a61de4 src/amqp_rpc_client.erl
> --- a/src/amqp_rpc_client.erl	Fri Nov 29 13:52:43 2013 +0000
> +++ b/src/amqp_rpc_client.erl	Thu Dec 05 12:02:56 2013 +0000
> @@ -93,7 +93,7 @@
> 
> %% Registers this RPC client instance as a consumer to handle rpc responses
> setup_consumer(#state{channel = Channel, reply_queue = Q}) ->
> -    amqp_channel:call(Channel, #'basic.consume'{queue = Q}).
> +    amqp_channel:subscribe(Channel, #'basic.consume'{queue = Q}, self()).
> 
> %% Publishes to the broker, stores the From address against
> %% the correlation id and increments the correlationid for
> @@ -124,8 +124,7 @@
> %% Sets up a reply queue and consumer within an existing channel
> %% @private
> init([Connection, RoutingKey]) ->
> -    {ok, Channel} = amqp_connection:open_channel(
> -                        Connection, {amqp_direct_consumer, [self()]}),
> +    {ok, Channel} = amqp_connection:open_channel(Connection),
>     InitialState = #state{channel     = Channel,
>                           exchange    = <<>>,
>                           routing_key = RoutingKey},
> 
>> Does this sound correct that calling stop on an amqp_rpc_client
>> should
>> be generating so many errors? Is there some cleaner way I should be
>> stopping the amqp_rpc_client?
> 
> No, this is wrong. I'll file bugs to look at these issues.
> 
> Cheers, Simon
> 


From rashim_a at yahoo.com  Thu Dec  5 20:34:42 2013
From: rashim_a at yahoo.com (Anand)
Date: Thu, 5 Dec 2013 12:34:42 -0800 (PST)
Subject: [rabbitmq-discuss] Periodic SSL connection timeout issues
Message-ID: <9966f3ca-0fcf-45dd-b68f-13804d145e30@googlegroups.com>

 

Hi,

 

We are facing periodic SSL connection timeout issues. Every 20-30 minutes 
we see Rabbit MQ SSL connection errors. Here are the sample logs:

 

=INFO REPORT==== 27-Nov-2013::20:22:13 ===

accepting AMQP connection <0.12604.35> (127.0.0.1:54924 -> 127.0.0.1:5671)

 

...

 

=INFO REPORT==== 27-Nov-2013::20:22:13 ===

accepting AMQP connection <0.12608.35> (127.0.0.1:54925 -> 127.0.0.1:5671)

 

...

 

=ERROR REPORT==== 27-Nov-2013::20:22:18 ===

error on AMQP connection <0.12604.35>: {ssl_upgrade_error,timeout} (unknown 
POSIX error)

 

=ERROR REPORT==== 27-Nov-2013::20:22:18 ===

error on AMQP connection <0.12608.35>: {ssl_upgrade_error,timeout} (unknown 
POSIX error)

 

Other than these periodic errors, everything works fine - the Rabbit MQ 
server accepts connections successfully most of the times.

 

Could you please help us figure out the root cause of this problem and any 
workarounds if any?

 

We are using the .NET client library to talk to the Rabbit MQ server and 
have enabled SSLs on the connections. We are using version 3.1.3 for the 
Rabbit MQ server as well as the client library. These connections were 
initiated from the same server hosting the Rabbit MQ server and use a built 
in Rabbit MQ account.

 

Regards,

Anand

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/22e7dbd3/attachment.html>

From wayne.brantley at gmail.com  Thu Dec  5 18:17:17 2013
From: wayne.brantley at gmail.com (Wayne Brantley)
Date: Thu, 5 Dec 2013 10:17:17 -0800 (PST)
Subject: [rabbitmq-discuss] Option for surviving connection failure feature
	suggestion
Message-ID: <e1669d74-68d0-4484-a847-7b7d350bd4b0@googlegroups.com>

Disclaimer:  I am new to RabbitMQ.  :-)

When processing long running messages, if the connection drops or gets 
interrupted - the message will be handed to another consumer.
Meanwhile, the original consumer is still doing the work.

I would propose a new option on a queue.

If the connection is dropped, that would not make the message available to 
another consumer.
The message would have a 'processing timeout'.  Only after that time has 
expired would the message become available to other consumers.

There would be several different options that could be set on the message 
for how to determine to deliver the message to another consumer.

1)  You could have an 'absolute processing timeout'.  
    -  RabbitMQ would keep track of how long the consumer has had the 
message.
    -  The client could send 'keep alive' acknowledgements to reset the the 
time RabbitMQ is tracking to zero.
    -  All that matters is has the message been processing longer than the 
timeout value.  (where timeout can be reset by client).  A dropped 
connection would not matter. 

2)  You could have a 'broken connection timeout'
    -  RabbitMQ would keep track of how long the consumer has had the 
message, AFTER the connection is dropped.
    -  The client would NOT ever need to send 'keep alive' acknowledgements.
    -  If a consumer connection is re-established - the consumer should 
somehow indicate they are still working on the message.
    -  Potentially - when the consumer is working on the message, they send 
'keep alive' every so often.  This way if the connection broke and was 
reconnected, the next time a 'keep alive' is sent, it would let RabbitMQ 
know you are still working on the message.

The above options would probably have default values at the queue level, 
and each message could override (for example if you know the message takes 
a long time to process.)

This makes it where any intermittent connection from consumer to publisher 
would not necessarily mean the consumer 'failed' and the message should be 
passed to another consumer.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/95630e1e/attachment.html>

From zsolt.erl at gmail.com  Thu Dec  5 18:28:00 2013
From: zsolt.erl at gmail.com (Zsolt Keszthelyi)
Date: Thu, 5 Dec 2013 13:28:00 -0500
Subject: [rabbitmq-discuss] RabbitMq on ESXi
In-Reply-To: <52986F5C.8050404@rabbitmq.com>
References: <98ab0559-0b72-45ac-975e-77a160a0c94d@googlegroups.com>
 <52986F5C.8050404@rabbitmq.com>
Message-ID: <CALSGTf=rKpYzp6M0XkiGDGh=Cqow2K0bUHSPrWPty5LPED7Amw@mail.gmail.com>

Simon,

Thanks for the suggestions.

I did read all the relevant documentation and I agree with you that
changing nettick would just mask the problem.

The nodes are not being suspended but something still causes mnesia
partitioning.
The only thing I can think of on the application level is if there are so
many messages between nodes that the nettick doesn't get through. Not
likely though.

I will upgrade to the latest version and try to diagnose problems on the
vmware level.


Thanks,

Zsolt


On Fri, Nov 29, 2013 at 5:41 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Well, first of all lots of people are running clusters on virtual machines
> perfectly happily, so it should be possible!
>
> If you are seeing running_partitioned_network events on your cluster,
> that's quite alarming, that would imply (assuming your network is reliable)
> that nodes are being suspended by the hypervisor for at least a minute or
> so - which sounds excessive. Unless you are suspending the nodes yourself
> (in which case I suggest you don't do that). But I've not seen ESX do that
> in my limited experience with it.
>
> You could increase net_ticktime (http://www.rabbitmq.com/nettick.html) to
> cover this up, but it feels like a band aid at this point.
>
> You should probably read http://www.rabbitmq.com/partitions.html if you
> haven't already done so.
>
> Finally, you mention mirrored queues. Note that we have fixed a large
> number of bugs in the mirrored queue implementation since 2.8.2 (and quite
> a few since 3.0.1) so upgrading is likely to be a good idea.
>
> Cheers, Simon
>
> On 27/11/2013 20:23, zsolt.erl at gmail.com wrote:
>
>> Hi,
>>
>> I'm trying to find out if there are any recommendations for running
>> RabbitMq on VMWare ESXi? (eg. clustering, queue mirroring)
>>
>> I have several 4 node clusters running on ESXi4/5 guests. The guests are
>> Ubuntu 10.04 VMs.
>> Erlang version: R15B. RabbitMq versions: 2.8.2 and 3.0.1 .
>>
>> The clusters seem to randomly crash every once in a while (about once
>> every 2 months).
>> Sometimes the whole cluster crashes, sometimes only a couple nodes and
>> the others either work or become unreachable.
>> Logs only show that the nodes lost connection.
>> I'm running 4 node clusters with 1 disk node and about 100 queues
>> mirrored across 2-3 nodes.
>> The same thing was happening when I was running a cluster with 4 disk
>> nodes.
>>
>> Are there any recommended best practices in regards to Virtual Machine
>> settings, VMWare network settings or OS settings that could
>> prevent these random crashes?
>> Would federation be a better solution then clustering in a virtual
>> environment? Or should I just run them on physical hardware?
>>
>>
>> I realize there's not enough data here to find out what is happening
>> exactly but I'm just trying to see if anybody came across similar
>> problems and were able to handle it?
>>
>>
>>
>> Thanks,
>>
>> Zsolt
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/72b28d33/attachment.html>

From wayne.brantley at gmail.com  Thu Dec  5 18:30:11 2013
From: wayne.brantley at gmail.com (Wayne Brantley)
Date: Thu, 5 Dec 2013 10:30:11 -0800 (PST)
Subject: [rabbitmq-discuss] Option/Extension to insert a message into a
 queue at certain intervals.
Message-ID: <130c4896-f1ef-4607-85a4-06b1aa7581da@googlegroups.com>


Love to be able to create a message that is automatically added to a 
certain queue every X minutes/seconds/milliseconds/etc, every day at 3pm, 
Tuesdays at noon, etc.
Option to NOT insert the message in the queue, if there is already one in 
the queue.  (indicating all consumers are currently busy)

This is sort of a 'scheduler' type of feature.  This really opens up many 
possibilities.

Using this you could create a simple scheduling implementation using 
RabbitMQ.  This would make sure that messages were put into the queue at 
the given times, but only if that message is not already in the queue.

Additionally outside of a scheduling implementation, just say you need to 
perform a certain task.
That task typically takes 15 seconds....however, sometimes it could take 60 
seconds.
You have multiple consumers that can work on these tasks.

You could set a message to go into a queue every 30 seconds.  That way the 
process is always being done no matter how long each consumer takes.

Without the above feature, you basically need another application whose job 
it is to create messages at certain intervals and put them into queues.
I just think this would be a great 'service' that could be provided, and 
people are always looking for a way to use RabbitMQ to do scheduled events 
(and have created systems of multiple queues and used the deadletter 
feature to do this kind of thing).

Thoughts?



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/b3e9bc6b/attachment.html>

From rashim.anand at hds.com  Thu Dec  5 20:26:21 2013
From: rashim.anand at hds.com (Rashim Anand)
Date: Thu, 5 Dec 2013 20:26:21 +0000
Subject: [rabbitmq-discuss] Periodic SSL connection timeouts
Message-ID: <B72607244032BD4489DBA663C1FD87EF7F704AFD@USINDEM103.corp.hds.com>

Hi,

We are facing periodic SSL connection timeout issues. Every 20-30 minutes we see Rabbit MQ SSL connection errors. Here are the sample logs:

=INFO REPORT==== 27-Nov-2013::20:22:13 ===
accepting AMQP connection <0.12604.35> (127.0.0.1:54924 -> 127.0.0.1:5671)

...

=INFO REPORT==== 27-Nov-2013::20:22:13 ===
accepting AMQP connection <0.12608.35> (127.0.0.1:54925 -> 127.0.0.1:5671)

...

=ERROR REPORT==== 27-Nov-2013::20:22:18 ===
error on AMQP connection <0.12604.35>: {ssl_upgrade_error,timeout} (unknown POSIX error)

=ERROR REPORT==== 27-Nov-2013::20:22:18 ===
error on AMQP connection <0.12608.35>: {ssl_upgrade_error,timeout} (unknown POSIX error)

Other than these periodic errors, everything works fine - the Rabbit MQ server accepts connections successfully most of the times.

Could you please help us figure out the root cause of this problem and any workarounds if any?

We are using the .NET client library to talk to the Rabbit MQ server and have enabled SSLs on the connections. We are using version 3.1.3 for the Rabbit MQ server as well as the client library. These connections were initiated from the same server hosting the Rabbit MQ server and use a built in Rabbit MQ account.

Regards,
Rashim Anand


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/0aa97ed4/attachment.html>

From mklishin at gopivotal.com  Thu Dec  5 22:19:54 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 6 Dec 2013 02:19:54 +0400
Subject: [rabbitmq-discuss] Option/Extension to insert a message into a
	queue at certain intervals.
In-Reply-To: <130c4896-f1ef-4607-85a4-06b1aa7581da@googlegroups.com>
References: <130c4896-f1ef-4607-85a4-06b1aa7581da@googlegroups.com>
Message-ID: <3D0593B9-EB6D-45FE-973A-7FB296F98B8E@rabbitmq.com>


On 5 Dec 2013, at 22:30, Wayne Brantley <wayne.brantley at gmail.com> wrote:

> Without the above feature, you basically need another application whose job it is to create messages at certain intervals and put them into queues.
> I just think this would be a great 'service' that could be provided, and people are always looking for a way to use RabbitMQ to do scheduled events (and have created systems of multiple queues and used the deadletter feature to do this kind of thing).
> 
> Thoughts?

If I understand you correctly, you are proposing two features and not one:

1. Scheduled publishing
2. Consumer coordination

I can see how #1 can be quite useful. I believe it can be accomplished using a plugin (and I?ve had some interest
in writing one for a while).

#2 can be very application-specific. Please just use Redis, etcd, ZooKeeper or similar to cover
that part.

MK

Software Engineer, Pivotal/RabbitMQ



From james.eddy at us.thalesgroup.com  Fri Dec  6 01:12:14 2013
From: james.eddy at us.thalesgroup.com (James)
Date: Fri, 6 Dec 2013 01:12:14 +0000 (UTC)
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
	node we see a very slow dequeue of messages
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
Message-ID: <loom.20131206T020729-16@post.gmane.org>

Here's an example of the slowness with Mnesia debug on:
The "Got mnesia down" occurs when nettick expires.


 [x][DefaultConsumer] Received 'hi-155' ..
 [x][DefaultConsumer] Received 'hi-156' ..
 [x][DefaultConsumer] Received 'hi-157' ..
 [x][DefaultConsumer] Received 'hi-158' ..
Mnesia(rabbit at NODEA): Logging mnesia_down rabbit at NODEB
Mnesia(rabbit at NODEA): Got mnesia_down from rabbit at NODEB, reconfiguring...

# At this point the message delivery to the consumer becomes very slow.

 [x][DefaultConsumer] Received 'hi-159' ..
 [x][DefaultConsumer] Received 'hi-160' ..


Thanks,
James


From panyuntao at gmail.com  Fri Dec  6 03:12:15 2013
From: panyuntao at gmail.com (=?GB2312?B?xcsg1MbMzg==?=)
Date: Fri, 6 Dec 2013 11:12:15 +0800
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
Message-ID: <5423892F-AAB1-4FEC-81A5-51EC287AE6E9@gmail.com>

Hi~,

 RabbitMQ cluster how can supported SSL ?

From mklishin at gopivotal.com  Fri Dec  6 03:31:13 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 6 Dec 2013 07:31:13 +0400
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <5423892F-AAB1-4FEC-81A5-51EC287AE6E9@gmail.com>
References: <5423892F-AAB1-4FEC-81A5-51EC287AE6E9@gmail.com>
Message-ID: <326E27BC-200E-409A-A680-0FE369B17F7B@rabbitmq.com>

On 6 Dec 2013, at 07:12, ? ?? <panyuntao at gmail.com> wrote:

> RabbitMQ cluster how can supported SSL ?

Distributed Erlang supports TLS connections between nodes, see
http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.

See http://www.rabbitmq.com/configure.html#define-environment-variables on how to
customize `erl` arguments used by RabbitMQ.

MK

Software Engineer, Pivotal/RabbitMQ



From wayne.brantley at gmail.com  Fri Dec  6 04:28:08 2013
From: wayne.brantley at gmail.com (Wayne Brantley)
Date: Thu, 5 Dec 2013 23:28:08 -0500
Subject: [rabbitmq-discuss] Option/Extension to insert a message into a
 queue at certain intervals.
In-Reply-To: <3D0593B9-EB6D-45FE-973A-7FB296F98B8E@rabbitmq.com>
References: <130c4896-f1ef-4607-85a4-06b1aa7581da@googlegroups.com>
 <3D0593B9-EB6D-45FE-973A-7FB296F98B8E@rabbitmq.com>
Message-ID: <CAGueSQFNwh4Upxj6fhNoML-MDQDeWzgV7s=aga8PxfeFsS778A@mail.gmail.com>

On Thu, Dec 5, 2013 at 5:19 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> two


Michael,
   Yes and no.   They are the same feature.  Scheduled publishing is the
feature.  Just one of the 'options' when scheduling the publishing of a
message is whether it should push a new message when the message it is
pushing is still waiting in the queue.  (This is futher expanded by a
'maximum number of pending messages' it should publish.

For example, if you wanted it to put a message in every X seconds.
   if no consumers were processing at this moment - the queue would grow
quickly...and I might want to limit it to "do not push message if more than
X of the type of message we are scheduling" is in the queue.

So, this is one in the same feature - just with the 'max messages'
option...this plug-in would be a BIG win for lots of people.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/4a24b4a3/attachment.html>

From brent.ryan at gmail.com  Fri Dec  6 02:07:47 2013
From: brent.ryan at gmail.com (Brent Ryan)
Date: Thu, 5 Dec 2013 18:07:47 -0800 (PST)
Subject: [rabbitmq-discuss] consumption of messages of a HA clustered disc
	queue
Message-ID: <44a3a023-b3f9-4316-912a-d9538b6f1aaf@googlegroups.com>

If I have a 2 node HA rabbitmq disc node cluster that we're using 
confirms/acks that live behind a load balancer...  What happens when I 
consume messages from this cluster from multiple consumers and/or threads? 
 Is it possible for multiple threads to consume the same message since it's 
sitting behind a load balancer?  In other words, does the consumption of a 
message from an HA queue mark a message on all nodes in the cluster as 
"consumed in processing" before returning or will we hit issues with 
multiple threads possibly consuming the same message through the load 
balancer?


Thanks,
Brent
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131205/6cbc592d/attachment.html>

From simon at rabbitmq.com  Fri Dec  6 09:16:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Dec 2013 09:16:45 +0000
Subject: [rabbitmq-discuss] consumption of messages of a HA clustered
 disc queue
In-Reply-To: <44a3a023-b3f9-4316-912a-d9538b6f1aaf@googlegroups.com>
References: <44a3a023-b3f9-4316-912a-d9538b6f1aaf@googlegroups.com>
Message-ID: <52A195FD.303@rabbitmq.com>

"In normal operation, for each mirrored-queue, there is one master and 
several slaves, each on a different node. The slaves apply the 
operations that occur to the master in exactly the same order as the 
master and thus maintain the same state. All actions other than 
publishes go only to the master, and the master then broadcasts the 
effect of the actions to the slaves. Thus clients consuming from a 
mirrored queue are in fact consuming from the master."
   -- http://www.rabbitmq.com/ha.html

So no, clients cannot accidentally consume the same message from 
different nodes.

Cheers, Simon

On 06/12/2013 2:07AM, Brent Ryan wrote:
> If I have a 2 node HA rabbitmq disc node cluster that we're using
> confirms/acks that live behind a load balancer...  What happens when I
> consume messages from this cluster from multiple consumers and/or
> threads?  Is it possible for multiple threads to consume the same
> message since it's sitting behind a load balancer?  In other words, does
> the consumption of a message from an HA queue mark a message on all
> nodes in the cluster as "consumed in processing" before returning or
> will we hit issues with multiple threads possibly consuming the same
> message through the load balancer?
>
>
> Thanks,
> Brent
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Fri Dec  6 09:30:53 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 06 Dec 2013 09:30:53 +0000
Subject: [rabbitmq-discuss] Periodic SSL connection timeouts
In-Reply-To: <B72607244032BD4489DBA663C1FD87EF7F704AFD@USINDEM103.corp.hds.com>
References: <B72607244032BD4489DBA663C1FD87EF7F704AFD@USINDEM103.corp.hds.com>
Message-ID: <52A1994D.9010907@rabbitmq.com>


Hi,

On 05/12/13 20:26, Rashim Anand wrote:

> We are facing periodic SSL connection timeout issues. Every 20-30
> minutes we see Rabbit MQ SSL connection errors.


> =ERROR REPORT==== 27-Nov-2013::20:22:18 ===
> 
> error on AMQP connection <0.12608.35>: {ssl_upgrade_error,timeout}
> (unknown POSIX error)

This is not enough information to diagnose the problem. Are there any
other events in your environment that occur at the same frequency as the
error? Can you replicate this problem using any of the methods described
in the SSL troubleshooting tips?

http://www.rabbitmq.com/troubleshooting-ssl.html




-Emile

From emile at rabbitmq.com  Fri Dec  6 12:16:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 06 Dec 2013 12:16:18 +0000
Subject: [rabbitmq-discuss] How to use Web-stomp with ssl?
In-Reply-To: <68f97bfa-2b56-4249-916f-d4aa1bad48b6@googlegroups.com>
References: <68f97bfa-2b56-4249-916f-d4aa1bad48b6@googlegroups.com>
Message-ID: <52A1C012.7030007@rabbitmq.com>


Hi,

On 03/12/13 18:03, Sebastien Dubois wrote:
> However when I build the web-stomp plugin module using the info in
> the site mentioned above using Erlang R15B01, it doesn't seem to
> work, for either secured on unsecured connections.

Can you elaborate? What is the error? Note that that configuration
relies on a patched version of the web STOMP plugin. It should also be
possible to secure the endpoint with an external solution such as stunnel.


-Emile




From simon at rabbitmq.com  Fri Dec  6 12:21:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Dec 2013 12:21:04 +0000
Subject: [rabbitmq-discuss] OpenLDAP-based auth with 'other_bind'
 option: no DN attribute?
In-Reply-To: <20131205145345.53ac312c@krasoola.nask.waw.pl>
References: <20131205145345.53ac312c@krasoola.nask.waw.pl>
Message-ID: <52A1C130.8010004@rabbitmq.com>

On 05/12/2013 13:53, Jan Kaliszewski wrote:
> It seems that 'distinguishedName' (DN) is not treated (by OpenLDAP?) as
> a real LDAP attribute.

First of all, thanks for the detailed investigation.

> When I patched that function by replacing the lines:
>
>           {ok, #eldap_search_result{entries = [#eldap_entry{attributes = A}]}} ->
>               [DN] = pget("distinguishedName", A),
> with:
>           {ok, #eldap_search_result{entries = [#eldap_entry{object_name = DN}]}} ->
>
> ...everything started working.
>
>
> Am I missing something or is it the only way to make the stuff work, at
> least with OpenLDAP 2.4.31?

Yes, I've been able to replicate this. Most of the LDAP plugin was 
developed against OpenLDAP, but the dn_lookup_attribute / dn_lookup_base 
feature was added to address the common idiom of logging in with a 
non-DN username in Active Directory, and I guess I never tested it 
against OpenLDAP. So I'll file a bug for this (your fix looks correct, 
but I want to make sure it doesn't break against AD).

Out of curiosity, is there a reason why you don't set 
ssl_cert_login_from to distinguished_name and skip this lookup step? Or 
do the DNs in the certs not match the DNs in LDAP?

Cheers, Simon

From david.sjoen at westcon.no  Fri Dec  6 12:39:50 2013
From: david.sjoen at westcon.no (=?iso-8859-1?Q?Sj=F8en=2C_David_A=2E?=)
Date: Fri, 6 Dec 2013 12:39:50 +0000
Subject: [rabbitmq-discuss] Error message when setting up RabbitMQ in Windows
Message-ID: <FBE48D007BB4A04F8B480F6016725AAF84D30D3E@Exchange.westcon.int>

Hi!

We have asked a customer to install RabbitMQ on their computers, and we have no remote access possibility, so this is a bit tricky... When they run one of the following commands (I don't know which, it's a batch file), they get an error message:

Commands:
call rabbitmq-service install
call rabbitmq-plugins.bat enable rabbitmq_management

Output:
           RabbitMQ service is already present - only updating service parameters
            {error_logger,{{2013,12,4},{17,37,37}},"Error when reading c:/Windows/.erlang.cookie: eacces",[]}
            {error_logger,{{2013,12,4},{17,37,37}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{"Error when reading c:/Windows/.erlang.cookie: eacces",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,328}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,27},{reductions,646}],[]]}
            {error_logger,{{2013,12,4},{17,37,37}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Error when reading c:/Windows/.erlang.cookie: eacces",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
            {error_logger,{{2013,12,4},{17,37,37}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,{shutdown,{failed_to_start_child,auth,{"Error when reading c:/Windows/.erlang.cookie: eacces",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}}}},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
            {error_logger,{{2013,12,4},{17,37,37}},crash_report,[[{initial_call,{application_master,init,['Argument__1','Argument__2','Argument__3','Argument__4']}},{pid,<0.9.0>},{registered_name,[]},{error_info,{exit,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,auth,{"Error when reading c:/Windows/.erlang.cookie: eacces",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}}}}},{kernel,start,[normal,[]]}},[{application_master,init,4,[{file,"application_master.erl"},{line,133}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},{ancestors,[<0.8.0>]},{messages,[{'EXIT',<0.10.0>,normal}]},{links,[<0.8.0>,<0.7.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,27},{reductions,149}],[]]}
            {error_logger,{{2013,12,4},{17,37,37}},std_info,[{application,kernel},{exited,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,auth,{"Error when reading c:/Windows/.erlang.cookie: eacces",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}}}}},{kernel,start,[normal,[]]}}},{type,permanent}]}
            {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,auth,{\"Error when reading c:/Windows/.erlang.cookie: eacces\",[{auth,init_cookie,0,[{file,\"auth.erl\"},{line,285}]},{auth,init,1,[{file,\"auth.erl\"},{line,139}]},{gen_server,init_it,6,[{file,\"gen_server.erl\"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,239}]}]}}}}},{kernel,start,[normal,[]]}}}"}
            
            Crash dump was written to: erl_crash.dump
            Kernel pid terminated (application_controller) ({application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,auth,{"Error when reading c:/Windows/.erl
            
Is this a permissions problem with .erlang.cookie? What permissions should it have in Windows?

Best regards,

David A. Sj?en
Senior Engineer (Software Development)

Westcon Power & Automation AS
NO-4262 Avaldsnes
Norway
Office: +47 47 46 80 00
Mobile: +47?920 10?580
http://www.westcon.no/




From mklishin at gopivotal.com  Fri Dec  6 12:43:19 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 6 Dec 2013 16:43:19 +0400
Subject: [rabbitmq-discuss] Error message when setting up RabbitMQ in
	Windows
In-Reply-To: <FBE48D007BB4A04F8B480F6016725AAF84D30D3E@Exchange.westcon.int>
References: <FBE48D007BB4A04F8B480F6016725AAF84D30D3E@Exchange.westcon.int>
Message-ID: <598DED35-044D-4F76-A83A-7982D4DC698E@rabbitmq.com>


On 6 Dec 2013, at 16:39, Sj?en, David A. <david.sjoen at westcon.no> wrote:

> Is this a permissions problem with .erlang.cookie? What permissions should it have in Windows?

Yes. See

https://www.rabbitmq.com/install-windows-manual.html
http://www.rabbitmq.com/windows-quirks.html

MK

Software Engineer, Pivotal/RabbitMQ



From jan.kaliszewski at nask.pl  Fri Dec  6 13:32:00 2013
From: jan.kaliszewski at nask.pl (Jan Kaliszewski)
Date: Fri, 6 Dec 2013 14:32:00 +0100
Subject: [rabbitmq-discuss] OpenLDAP-based auth with 'other_bind'
 option: no DN attribute?
In-Reply-To: <52A1C130.8010004@rabbitmq.com>
References: <20131205145345.53ac312c@krasoola.nask.waw.pl>
 <52A1C130.8010004@rabbitmq.com>
Message-ID: <20131206143200.1910e281@krasoola.nask.waw.pl>

2013-12-06 12:21, Simon MacMullen <simon at rabbitmq.com> dixit:

[...]
> Yes, I've been able to replicate this. Most of the LDAP plugin was 
> developed against OpenLDAP, but the dn_lookup_attribute /
> dn_lookup_base feature was added to address the common idiom of
> logging in with a non-DN username in Active Directory, and I guess I
> never tested it against OpenLDAP. So I'll file a bug for this (your
> fix looks correct, but I want to make sure it doesn't break against
> AD).

Awesome, thanks!

> Out of curiosity, is there a reason why you don't set 
> ssl_cert_login_from to distinguished_name and skip this lookup step?
> Or do the DNs in the certs not match the DNs in LDAP?

That's true: unfortunately they do not.

Cheers,
*j

-- 
Jan Kaliszewski <jan.kaliszewski at nask.pl>

From JHoge at bn.com  Fri Dec  6 13:57:15 2013
From: JHoge at bn.com (John Hoge)
Date: Fri, 6 Dec 2013 08:57:15 -0500
Subject: [rabbitmq-discuss] Tutorial vendor Files?
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A78@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0A78@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0AD0@WCEXCPMS01.hq.bn-corp.com>

 Thank you again.
It took some re-installing but composer is working right again and did finally make the auto load file.
For other WAMP users, if you upgrade check for multiple php.ini files, it looks like that is what happened to me.

thanks
jh

-----Original Message-----
From: John Hoge 
Sent: Wednesday, December 04, 2013 8:10 AM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: Tutorial vendor Files?

Hello RabbitMQ list,

I'm just starting out and want to work through the PHP tutorial, 
but I cannot find the "vendor" folder anywhere in the RMQ install: 
"" require_once __DIR__ . '/vendor/autoload.php'; ""

Does anyone know where to find that folder?

Thanks for considering my question, I really apocopate it.

best, 
John
-------------------------------------------------------------------------
This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
only for the use of the addressee(s) named herein.  If you are not an intended recipient,
please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
the message completely from your computer system.

From sp345s at att.com  Fri Dec  6 17:15:22 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Fri, 6 Dec 2013 17:15:22 +0000
Subject: [rabbitmq-discuss] publisher-confirms timeout and CorrelationData
Message-ID: <59BF56992750434F89F8EBE141E64B1D0183767C@GAALPA1MSGUSR9C.ITServices.sbc.com>


I have the publisher-confirms stuff working but have couple of issue ..

1)  When I use an username with no access to publish to a particular exchange ... After send the system seems to be waiting for the response and never times out .. I have configured the  requested-heartbeat but doesn't seems to have any affect ..

2)  With Valid user access the confirmation shows null correlationData ... not sure why??



I am attaching the spring context file , the java file and the log ..

--Code--
private RabbitTemplate amqpTemplate = null;
amqpTemplate.send(jndiName, bindingKey, amqpMsg, new CorrelationData(message.getSrcTxId()));

--log--
06 Dec 2013 11:48:03,282 AMQP Connection 127.0.0.1:5672 - Sending confirm PendingConfirm [correlationData=null]

Appreciate all the help. Thank you..
Sagar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/26e3f4b5/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp-rabbit-context.xml
Type: text/xml
Size: 1109 bytes
Desc: amqp-rabbit-context.xml
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/26e3f4b5/attachment.xml>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: AmqpMessageSenderImpl.java
Type: application/octet-stream
Size: 4038 bytes
Desc: AmqpMessageSenderImpl.java
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/26e3f4b5/attachment.obj>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: log.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/26e3f4b5/attachment.txt>

From grussell at gopivotal.com  Fri Dec  6 17:46:34 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 6 Dec 2013 12:46:34 -0500
Subject: [rabbitmq-discuss] publisher-confirms timeout and
	CorrelationData
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0183767C@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0183767C@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <CADtU9_s1vSDNQ_-RLXZCXWH7KaLhjkZuasn0q2bFUJpO9BXEKA@mail.gmail.com>

The only possible way to get null correlation data is if you pass in null
(or use one of the send() methods that doesn't have a CorrelationData
parameter) - like the one you have commented out in the version of your
class that you attached.


On Fri, Dec 6, 2013 at 12:15 PM, PATAR, SAGAR <sp345s at att.com> wrote:

>
>
> I have the publisher-confirms stuff working but have couple of issue ..
>
> 1)  When I use an username with no access to publish to a particular
> exchange ? After send the system seems to be waiting for the response and
> never times out .. I have configured the  requested-heartbeat but doesn?t
> seems to have any affect ..
>
> 2)  With Valid user access the confirmation shows null correlationData ?
> not sure why??
>
>
>
> I am attaching the spring context file , the java file and the log ..
>
>
>
> --Code--
>
> *private* RabbitTemplate amqpTemplate = *null*;
>
> amqpTemplate.send(jndiName, bindingKey, amqpMsg, *new*CorrelationData(message.getSrcTxId()));
>
>
>
>
> --log--
>
> 06 Dec 2013 11:48:03,282 AMQP Connection 127.0.0.1:5672 - Sending confirm
> PendingConfirm [correlationData=null]
>
>
>
> Appreciate all the help. Thank you..
>
> Sagar
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/8b845b77/attachment.html>

From sp345s at att.com  Fri Dec  6 18:22:15 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Fri, 6 Dec 2013 18:22:15 +0000
Subject: [rabbitmq-discuss] SSL Client using spring
Message-ID: <59BF56992750434F89F8EBE141E64B1D018376AE@GAALPA1MSGUSR9C.ITServices.sbc.com>

I don't see any option to use SSL and pass the cert / keystore using spring amqp ... Can you pl. help me with some examples ...
I was able to get it working using a simple java class ..but cant see options with spring amqp

Thanks,
Sagar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/9a9c327f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp-rabbit-context.xml
Type: text/xml
Size: 1109 bytes
Desc: amqp-rabbit-context.xml
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/9a9c327f/attachment.xml>

From grussell at gopivotal.com  Fri Dec  6 18:30:29 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 6 Dec 2013 13:30:29 -0500
Subject: [rabbitmq-discuss] SSL Client using spring
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D018376AE@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018376AE@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <CADtU9_v=1WqHLnSZ-4C-KYN0n_a7Guu8TivEka-pQf8B9Xu=mg@mail.gmail.com>

Wire up your rabbit connection factory as you wish, and then provide a
reference to it to the spring connection factory...

<rabbit:connection-factory id="connectionFactory"
connection-factory="rabbitFactory" ... />


On Fri, Dec 6, 2013 at 1:22 PM, PATAR, SAGAR <sp345s at att.com> wrote:

>  I don?t see any option to use SSL and pass the cert / keystore using
> spring amqp ? Can you pl. help me with some examples ?
>
> I was able to get it working using a simple java class ..but cant see
> options with spring amqp
>
>
>
> Thanks,
>
> Sagar
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/20b1a182/attachment.html>

From james.eddy at us.thalesgroup.com  Fri Dec  6 21:29:45 2013
From: james.eddy at us.thalesgroup.com (James)
Date: Fri, 6 Dec 2013 21:29:45 +0000 (UTC)
Subject: [rabbitmq-discuss]
	=?utf-8?q?When_rabbitmq_is_clustered_with_one_?=
	=?utf-8?q?other=09node_we_see_a_very_slow_dequeue_of_messages?=
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
 <loom.20131206T020729-16@post.gmane.org>
Message-ID: <loom.20131206T221755-465@post.gmane.org>

James <james.eddy at ...> writes:

> We have two setups with slightly different network setups (two pairs of 
Node A and B). One we see this issue on, the other we do not, so this is not 
an issue that can be always reproduced.

I see now why this is not always reproducible. On one of our setups there 
was no queueBind to the exchange on the failed server (Node B).

So this issue becomes always reproducible (in our environment) when it meets 
the following conditions.

(1) NODE_A and NODE_B in a cluster
(2) CLIENT_A0 connects to NODE_A creates topic exchange EXCHANGE_X, and 
publishes 1MSG/sec
(3) CLIENT_A1 connects to NODE_A creates and binds queue to EXCHANGE_X, 
CLIENT_A1 now is dequeueing messages at the rate of ~ 1MSG/sec
(4) CLIENT_B connects to NODE_B binds queue to EXCHANGE_X, CLIENT_B1 also is 
now dequeueing messages at the rate of ~ 1MSG/sec
(5) Pull the cable from NODE_A to NODE_B (anything that does not allow the 
tcp connection drop to be detected, making net_ticktime come into play. 
Making NODE_B not routable from NODE_A will work, or iptables DROP will 
work).

Result: CLIENT_A0 continues to publish at 1MSG/sec, after net_ticktime 
CLIENT_A1 is dequeueing much less then 1MSG/sec and falls behind.


* Note: "connects" is a localhost connection for this test

Thanks,
James



From goyalk at vmware.com  Fri Dec  6 23:06:51 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Fri, 6 Dec 2013 15:06:51 -0800 (PST)
Subject: [rabbitmq-discuss] Setting message-expiry on a queue using
	rabbitmqadmin
Message-ID: <b9c02e2b.000017e4.0000013f@KAPILPC.vmware.com>

Is it possible? Can you please provide an example of how to do this?

 

Thanks

Kapil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/cedd5219/attachment.html>

From michael.s.klishin at gmail.com  Sat Dec  7 00:32:31 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 7 Dec 2013 04:32:31 +0400
Subject: [rabbitmq-discuss] Setting message-expiry on a queue using
	rabbitmqadmin
In-Reply-To: <b9c02e2b.000017e4.0000013f@KAPILPC.vmware.com>
References: <b9c02e2b.000017e4.0000013f@KAPILPC.vmware.com>
Message-ID: <CAE3HoVS0FZED1O7_mEXjgsxrJV35GYarUj2Pr_ACiD+QvVHQdw@mail.gmail.com>

2013/12/7 Kapil Goyal <goyalk at vmware.com>

> Is it possible? Can you please provide an example of how to do this?


You can use a policy, see

https://www.rabbitmq.com/parameters.html
http://www.rabbitmq.com/maxlength.html

The latter demonstrates how to use another arguments-based feature with
policies.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131207/8ae72134/attachment.html>

From dubois.sebastien66 at gmail.com  Sat Dec  7 02:50:19 2013
From: dubois.sebastien66 at gmail.com (Sebastien Dubois)
Date: Fri, 6 Dec 2013 21:50:19 -0500
Subject: [rabbitmq-discuss] How to use Web-stomp with ssl?
In-Reply-To: <52A1C012.7030007@rabbitmq.com>
References: <68f97bfa-2b56-4249-916f-d4aa1bad48b6@googlegroups.com>
 <52A1C012.7030007@rabbitmq.com>
Message-ID: <CAFovD-rzXjn55zty43CtaSgeXB6dtC5SQ1ai28TzzWrD98kY2g@mail.gmail.com>

Hi,

  Actually, we were able to make it work on RabbirMQ 3.2.1 by manually
porting the code changes from
https://github.com/rabbitmq/rabbitmq-web-stomp/pull/3 over to the 3.2.1
rabbit-web-stomp plugin.

  However that begs the question:  Is there a plan to integrate SSL support
into the rabbit-web-stomp plugin?  This would be benefical to many,
including our team.  We can use a custom-build plugin like this for now,
but this is not a workable long-term solution for us.

BR,
/Sebastien


On Fri, Dec 6, 2013 at 7:16 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 03/12/13 18:03, Sebastien Dubois wrote:
> > However when I build the web-stomp plugin module using the info in
> > the site mentioned above using Erlang R15B01, it doesn't seem to
> > work, for either secured on unsecured connections.
>
> Can you elaborate? What is the error? Note that that configuration
> relies on a patched version of the web STOMP plugin. It should also be
> possible to secure the endpoint with an external solution such as stunnel.
>
>
> -Emile
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131206/9d0eb5a4/attachment.html>

From pradeeptob at gmail.com  Mon Dec  9 01:29:59 2013
From: pradeeptob at gmail.com (Pradeepto Bhattacharya)
Date: Mon, 9 Dec 2013 06:59:59 +0530
Subject: [rabbitmq-discuss] Running Rabbitmq on AWS EC2 and changing
	hostnames
Message-ID: <CAE1See_SM64vva5ONcCLDYYkqV9jKVbNNBK7w8haL3tfgEYxPA@mail.gmail.com>

Hi,

I am still very new to Rabbitmq.

For my project, I have to run Rabbitmq on an AWS EC2 instance.
Everything works great until, I Stop/Start my instance for some
reason. I have read [1] but that doesn't help because setting the
hostname to a fixed string is not an option for my project as it is
expected that someone can change it later again.

My application doesn't work properly after the stop/start routine. I
am running an CentOS 6.4 based instance.

I have tried modifiying the init script ( /etc/init.d/rabbitmq-server
) to something like this -

        "RABBITMQ_MNESIA_DIR=/var/lib/rabbitmq/mnesia/myapplication \
        RABBITMQ_PLUGINS_EXPAND_DIR=/var/lib/rabbitmq/mnesia/myapplication-plugins-expand
\
        RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON \
            > "${INIT_LOG_DIR}/startup_log" \
            2> "${INIT_LOG_DIR}/startup_err" \
            0<&- &
        $CONTROL wait $PID_FILE >/dev/null 2>&1"

Note that I have added RABBITMQ_MNESIA_DIR and
RABBITMQ_PLUGINS_EXPAND_DIR at the beginning. The reason, I did this
because I noticed that those directories used the internal ip for the
EC2 instance and thus changed everytime the instance stopped and
started.

Is this the right way to get this done? What would be solution when
hostnames/nodenames keep changing for instances that run rabbitmq? I
have tried many things but in vain and almost at my wits end right
now.

Thank you in advance.

[1] http://www.rabbitmq.com/ec2.html

Regards,

Pradeepto
-- 
Pradeepto Kumar Bhattacharya
KDE e.V. Board of Director | Proud KDE Contributor
The KDE Project : http://www.kde.org

From emile at rabbitmq.com  Mon Dec  9 09:27:15 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Dec 2013 09:27:15 +0000
Subject: [rabbitmq-discuss] Running Rabbitmq on AWS EC2 and changing
	hostnames
In-Reply-To: <CAE1See_SM64vva5ONcCLDYYkqV9jKVbNNBK7w8haL3tfgEYxPA@mail.gmail.com>
References: <CAE1See_SM64vva5ONcCLDYYkqV9jKVbNNBK7w8haL3tfgEYxPA@mail.gmail.com>
Message-ID: <52A58CF3.8080502@rabbitmq.com>


Hi,

On 09/12/13 01:29, Pradeepto Bhattacharya wrote:
> I have read [1] but that doesn't help because setting the
> hostname to a fixed string is not an option for my project as it is
> expected that someone can change it later again.

If the address will change then you can set the part of the nodename
after the @ to "localhost" or setup your own name resolution that
assigns a stable name.




-Emile



From pradeeptob at gmail.com  Mon Dec  9 10:11:04 2013
From: pradeeptob at gmail.com (Pradeepto Bhattacharya)
Date: Mon, 9 Dec 2013 15:41:04 +0530
Subject: [rabbitmq-discuss] Running Rabbitmq on AWS EC2 and changing
	hostnames
In-Reply-To: <52A58CF3.8080502@rabbitmq.com>
References: <CAE1See_SM64vva5ONcCLDYYkqV9jKVbNNBK7w8haL3tfgEYxPA@mail.gmail.com>
 <52A58CF3.8080502@rabbitmq.com>
Message-ID: <CAE1See8mW=Y9tffRwj9=h8KNtz+azm+qgd3BQi_u46wGh=uMfg@mail.gmail.com>

Hi Emile

Thank you for your reply. After I posted my question on this list,
this is what I had tried :

I followed the following steps :
1. Create a config file at the following path : /etc/rabbitmq/rabbitmq-env.conf
2. Add the following entry
NODENAME=rabbit-grokbox at localhost
3. Restart instance or rabbitmq-server

I removed the stuff I had done earlier, namely the init scripts are as
they before I touched them. This did the trick and my application
worked no matter how many times I stopped/started my instance. But I
am not sure if this is the right way and will there be any issues
because of this.

Would this be recommended? Any known problems you foresee because of
the config file entry?

Regards,

Pradeepto
-- 
Pradeepto Kumar Bhattacharya
KDE e.V. Board of Director | Proud KDE Contributor
The KDE Project : http://www.kde.org

From haster2004 at yandex.ru  Mon Dec  9 10:12:00 2013
From: haster2004 at yandex.ru (Haster)
Date: Mon, 9 Dec 2013 02:12:00 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq_c Sometimes I get
 AMQP_STATUS_TIMER_FAILURE error on Win32
In-Reply-To: <CAAt2poJa76O6W9hhO9A1NSB6Q1g6bxPf1E2UcmdNOX0XQWZBwg@mail.gmail.com>
References: <51c7d89c-4c11-44ce-a8f7-9c97b00de078@googlegroups.com>
 <CAAt2poJa76O6W9hhO9A1NSB6Q1g6bxPf1E2UcmdNOX0XQWZBwg@mail.gmail.com>
Message-ID: <1386583920356-31919.post@n5.nabble.com>

Alan, thanks a lot!
I will try this patch



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-Sometimes-I-get-AMQP-STATUS-TIMER-FAILURE-error-on-Win32-tp31871p31919.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Dec  9 10:43:34 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Dec 2013 10:43:34 +0000
Subject: [rabbitmq-discuss] Running Rabbitmq on AWS EC2 and changing
	hostnames
In-Reply-To: <CAE1See8mW=Y9tffRwj9=h8KNtz+azm+qgd3BQi_u46wGh=uMfg@mail.gmail.com>
References: <CAE1See_SM64vva5ONcCLDYYkqV9jKVbNNBK7w8haL3tfgEYxPA@mail.gmail.com>
 <52A58CF3.8080502@rabbitmq.com>
 <CAE1See8mW=Y9tffRwj9=h8KNtz+azm+qgd3BQi_u46wGh=uMfg@mail.gmail.com>
Message-ID: <52A59ED6.5020104@rabbitmq.com>

On 09/12/13 10:11, Pradeepto Bhattacharya wrote:
> Would this be recommended? Any known problems you foresee because of
> the config file entry?

I can foresee problems with clustering, but if you only need a single
node then that doesn't matter.


-Emile





From pradeeptob at gmail.com  Mon Dec  9 10:48:10 2013
From: pradeeptob at gmail.com (Pradeepto Bhattacharya)
Date: Mon, 9 Dec 2013 16:18:10 +0530
Subject: [rabbitmq-discuss] Running Rabbitmq on AWS EC2 and changing
	hostnames
In-Reply-To: <52A59ED6.5020104@rabbitmq.com>
References: <CAE1See_SM64vva5ONcCLDYYkqV9jKVbNNBK7w8haL3tfgEYxPA@mail.gmail.com>
 <52A58CF3.8080502@rabbitmq.com>
 <CAE1See8mW=Y9tffRwj9=h8KNtz+azm+qgd3BQi_u46wGh=uMfg@mail.gmail.com>
 <52A59ED6.5020104@rabbitmq.com>
Message-ID: <CAE1See-9sjuj+7cTg8exZgR=NpKw1w4fZ9TnFUZRoK720qDbvQ@mail.gmail.com>

On Mon, Dec 9, 2013 at 4:13 PM, Emile Joubert <emile at rabbitmq.com> wrote:
> I can foresee problems with clustering, but if you only need a single
> node then that doesn't matter.

Thanks, that is what I am only concerned with. Is there a better way
around this issue?

Regards,

Pradeepto
-- 
Pradeepto Kumar Bhattacharya
KDE e.V. Board of Director | Proud KDE Contributor
The KDE Project : http://www.kde.org

From mklishin at gopivotal.com  Mon Dec  9 10:51:58 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 9 Dec 2013 14:51:58 +0400
Subject: [rabbitmq-discuss] Running Rabbitmq on AWS EC2 and changing
	hostnames
In-Reply-To: <CAE1See-9sjuj+7cTg8exZgR=NpKw1w4fZ9TnFUZRoK720qDbvQ@mail.gmail.com>
References: <CAE1See_SM64vva5ONcCLDYYkqV9jKVbNNBK7w8haL3tfgEYxPA@mail.gmail.com>
 <52A58CF3.8080502@rabbitmq.com>
 <CAE1See8mW=Y9tffRwj9=h8KNtz+azm+qgd3BQi_u46wGh=uMfg@mail.gmail.com>
 <52A59ED6.5020104@rabbitmq.com>
 <CAE1See-9sjuj+7cTg8exZgR=NpKw1w4fZ9TnFUZRoK720qDbvQ@mail.gmail.com>
Message-ID: <359D6B68-59F3-47E4-99CA-171BF4C929B9@rabbitmq.com>

On 9 Dec 2013, at 14:48, Pradeepto Bhattacharya <pradeeptob at gmail.com> wrote:

> Thanks, that is what I am only concerned with. Is there a better way
> around this issue?

Use DNS (e.g. Route 53) instead of hardcoding localhost.

MK

Software Engineer, Pivotal/RabbitMQ



From emile at rabbitmq.com  Mon Dec  9 11:28:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Dec 2013 11:28:02 +0000
Subject: [rabbitmq-discuss] How to use Web-stomp with ssl?
In-Reply-To: <CAFovD-rzXjn55zty43CtaSgeXB6dtC5SQ1ai28TzzWrD98kY2g@mail.gmail.com>
References: <68f97bfa-2b56-4249-916f-d4aa1bad48b6@googlegroups.com>
 <52A1C012.7030007@rabbitmq.com>
 <CAFovD-rzXjn55zty43CtaSgeXB6dtC5SQ1ai28TzzWrD98kY2g@mail.gmail.com>
Message-ID: <52A5A942.209@rabbitmq.com>


Hi,

On 07/12/13 02:50, Sebastien Dubois wrote:
> Actually, we were able to make it work on RabbirMQ 3.2.1 by manually 
> porting the code changes from
> https://github.com/rabbitmq/rabbitmq-web-stomp/pull/3 over to the 
> 3.2.1 rabbit-web-stomp plugin.
> 
> However that begs the question: Is there a plan to integrate SSL 
> support into the rabbit-web-stomp plugin? This would be benefical to 
> many, including our team. We can use a custom-build plugin like this 
> for now, but this is not a workable long-term solution for us.

I agree that needing to apply patches is not ideal. The pull request you
refer to is under review at the moment so that should not be necessary
for much longer.



-Emile



From sam.j.mf1+nabble at gmail.com  Mon Dec  9 12:02:24 2013
From: sam.j.mf1+nabble at gmail.com (Sam Mitchell Finnigan)
Date: Mon, 9 Dec 2013 04:02:24 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ's WebSocket broken
In-Reply-To: <65ccc7a1-8e27-44b9-8db3-a8201d85b1bc@googlegroups.com>
References: <47e4346c-7cec-4f09-bb10-9e7917274958@googlegroups.com>
 <65ccc7a1-8e27-44b9-8db3-a8201d85b1bc@googlegroups.com>
Message-ID: <1386590544122-31925.post@n5.nabble.com>

Hi Julian,

I just ran into this today- I'm currently working around it by falling back
to javascript websockets ( https://github.com/sockjs
<https://github.com/sockjs>  ) if Chrome's native WS negotiation fails.

Cheers,
-Sam  


Julian Lyndon-Smith-2 wrote
> Hey,
> 
> did you ever get a solution to this problem ? I've got the same and it's 
> driving me nuts :(
> 
> thanks
> 
> Julian
> 
> _______________________________________________
> rabbitmq-discuss mailing list

> rabbitmq-discuss at .rabbitmq

> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-s-WebSocket-broken-tp30408p31925.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tiziana.stoesselli at gmail.com  Mon Dec  9 15:50:04 2013
From: tiziana.stoesselli at gmail.com (Tiziana Stoesselli)
Date: Mon, 9 Dec 2013 07:50:04 -0800 (PST)
Subject: [rabbitmq-discuss] rabbit,failure_during_boot
Message-ID: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>

Anyone can help me?

Activating RabbitMQ plugins ...
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.8.4  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : Name at zenossoc
app descriptor : 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.8.4/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : otG5wqMg04+qfhmRCVkglQ==
log            : /var/log/rabbitmq/Name.log
sasl log       : /var/log/rabbitmq/Name-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/Name
erlang version : 5.8.5

-- rabbit boot start
starting file handle cache server                                     
...done
starting worker pool                                                  
...done
starting database                                                     
...done
starting database sync                                                
...done
starting codec correctness check                                      
...done
-- external infrastructure ready
starting plugin registry                                              
...done
starting auth mechanism cr-demo                                       
...done
starting auth mechanism amqplain                                      
...done
starting auth mechanism plain                                         
...done
starting statistics event manager                                     
...done
starting logging server                                               
...done
starting exchange type direct                                         
...done
starting exchange type fanout                                         
...done
starting exchange type headers                                        
...done
starting exchange type topic                                          
...done
-- kernel ready
starting alarm handler                                                
...done
starting node monitor                                                 
...done
starting cluster delegate                                             
...done
starting guid generator                                               
...done
starting memory monitor                                               
...done
-- core initialized
starting empty DB check                                               
...done
starting exchange, queue and binding recovery                         ...

BOOT FAILED
===========

Error description:
   {badmatch,
       {error,
           {{{function_clause,
                 [{rabbit_queue_index,parse_pub_record_body,
                      [<<0,0,0,0,0,0,0,0>>]},
                  {rabbit_queue_index,load_journal_entries,1},
                  {rabbit_queue_index,recover_journal,1},
                  {rabbit_queue_index,scan_segments,3},
                  {rabbit_queue_index,queue_index_walker_reader,2},
                  {rabbit_queue_index,'-queue_index_walker/1-fun-0-',2},
                  {worker_pool_worker,handle_cast,2},
                  {gen_server2,handle_msg,2}]},
             {gen_server2,call,[<0.184.0>,out,infinity]}},
            {child,undefined,msg_store_persistent,
                {rabbit_msg_store,start_link,
                    
[msg_store_persistent,"/var/lib/rabbitmq/mnesia/Name",[],
                     {#Fun<rabbit_queue_index.2.89252852>,
                      {start,
                          [{resource,<<"/zenoss">>,queue,
                               <<"zenoss.queues.zep.heartbeats">>},
                           {resource,<<"/zenoss">>,queue,
                               <<"zenoss.queues.zep.migrated.archive">>},
                           {resource,<<"/zenoss">>,queue,
                               <<"zenoss.queues.zep.zenevents">>},
                           {resource,<<"/zenoss">>,queue,<<"celery">>},
                           {resource,<<"/zenoss">>,queue,
                               <<"zenoss.queues.zep.modelchange">>},
                           {resource,<<"/zenoss">>,queue,
                               <<"zenoss.queues.zep.rawevents">>},
                           {resource,<<"/zenoss">>,queue,
                               <<"zenoss.queues.zep.migrated.summary">>},
                           {resource,<<"/zenoss">>,queue,
                               <<"zenoss.queues.zep.signal">>}]}}]},
                transient,4294967295,worker,
                [rabbit_msg_store]}}}}

Log files (may contain more information):
   /var/log/rabbitmq/Name.log
   /var/log/rabbitmq/Name-sasl.log

Stack trace:
   [{rabbit_variable_queue,start_msg_store,2},
    {rabbit_amqqueue,start,0},
    {rabbit,recover,0},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
    {rabbit,run_boot_step,1},
    {rabbit,'-start/2-lc$^0/1-0-',1},
    {rabbit,start,2},
    {application_master,start_it_old,4}]

{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131209/1bab3380/attachment.html>

From james.gardner at noaa.gov  Mon Dec  9 17:42:45 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Mon, 09 Dec 2013 11:42:45 -0600
Subject: [rabbitmq-discuss] Best way to ping server from client
Message-ID: <52A60115.3010902@noaa.gov>


Hi,

I need to know the best way to 'ping' an AMQP server from a client (I'm 
using PhpAmqpLib). We have encountered some situations where the client 
doesn't realize the server has 'gone away', and hangs for far too long, 
sometimes indefinitely. Regardless of whether this is a problem with the 
client library, if I wanted to test the connection by issuing the most 
benign, inexpensive request, what might that be? Perhaps there is a 
channel method I can call repeatedly at regular intervals without 
causing errors, like QOS, or something else? This would be during a consume.
Thanks,

James Gardner, NWS NIDS


From videlalvaro at gmail.com  Mon Dec  9 17:49:55 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 9 Dec 2013 18:49:55 +0100
Subject: [rabbitmq-discuss] Best way to ping server from client
In-Reply-To: <52A60115.3010902@noaa.gov>
References: <52A60115.3010902@noaa.gov>
Message-ID: <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>

Hi James,

I've thought about implementing some of the hearbeats exposed by
RabbitMQ but is not so easy considering PHP's single thread view of
the world. I could try to approximate timeouts for example, but not
sure about what errors that could bring.

As a complete hack and trying to answer your question, there's the
access_request method which in RabbitMQ won't do much: See
https://github.com/videlalvaro/php-amqplib/blob/master/PhpAmqpLib/Channel/AMQPChannel.php#L233
and http://hg.rabbitmq.com/rabbitmq-server/file/3e9ad0a5795e/src/rabbit_channel.erl#l646

Regards,

Alvaro

On Mon, Dec 9, 2013 at 6:42 PM, James Gardner <james.gardner at noaa.gov> wrote:
>
> Hi,
>
> I need to know the best way to 'ping' an AMQP server from a client (I'm
> using PhpAmqpLib). We have encountered some situations where the client
> doesn't realize the server has 'gone away', and hangs for far too long,
> sometimes indefinitely. Regardless of whether this is a problem with the
> client library, if I wanted to test the connection by issuing the most
> benign, inexpensive request, what might that be? Perhaps there is a channel
> method I can call repeatedly at regular intervals without causing errors,
> like QOS, or something else? This would be during a consume.
> Thanks,
>
> James Gardner, NWS NIDS
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From bchmura at nurturhealth.com  Mon Dec  9 22:20:11 2013
From: bchmura at nurturhealth.com (Bill Chmura)
Date: Mon, 9 Dec 2013 22:20:11 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local
	network
Message-ID: <25870F6AB6D0E34489AD94C19EA928DB01F2232D@OFLEXMB06P.centene.com>

Hello,

Even after upping the net_tick_time to 120 we still have had issues with the cluster partioning.  Although today we came up with evidence that this is tied to our deployment process to our production systems.  Hence I am back to thinking this is a network or I/O problem.

Is there anything we can watch specifically when we do the deploy to catch what is going on in the erlang / rabbit world?  As I mentioned before we are not seeing anything overt in our monitoring or performance charts.  We plan on re-looking at it as we re-enact the deployment over and over again.   Our focus will be pretty much on the network and NIC I/O and virtual interfaces, etc.  Previous checks of the deployment stage showed overall network usage spiked to about 30% so it seemed unlikely, but....

Can someone confirm for me that I understand these events correctly?  I would really appreciate it

=INFO REPORT==== 9-Dec-2013::05:43:41 ===
rabbit on node 'rabbit at NURWEB-QAAPP01' down

// The above indicates the net_ticktime expired without a good response?


=ERROR REPORT==== 9-Dec-2013::05:43:41 ===
Mnesia('rabbit at NURWEB-QAWEB01'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-QAAPP01'}

// This means it got back in touch with QAAPP01 and neither had gotten good results from the net_ticktime specified "pings".  So it partitioned itself off.  So close to it being down though?


=ERROR REPORT==== 9-Dec-2013::05:43:41 ===
** Generic server <0.323.0> terminating
** Last message in was {mnesia_locker,'rabbit at NURWEB-QAAPP01',granted}
** When Server state == {state,<0.321.0>,<0.322.0>,rabbit_mgmt_sup,
                            [{rabbit_mgmt_db,
                                 {rabbit_mgmt_db,start_link,[]},
                                 permanent,4294967295,worker,
                                 [rabbit_mgmt_db]}]}
** Reason for termination ==
** {unexpected_info,{mnesia_locker,'rabbit at NURWEB-QAAPP01',granted}}

// This (above) I have seen rarely, but it seems related - any ideas aside from the node crashed?


=INFO REPORT==== 9-Dec-2013::05:43:43 ===
only running disc node went down

// Above indicates the cluster as it is now no longer has QAAPP01 which is the disk node.

=ERROR REPORT==== 9-Dec-2013::05:45:35 ===
Mnesia('rabbit at NURWEB-QAWEB01'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-QAWEB02'}

// The above indicates that it just portioned itself off from another of the cluster


Any help would be very much appreciated - especially confirming that I understand the above events will help with the troubleshooting process.



Regards,

Bill Chmura    Director, IT Development Services

From: Bill Chmura
Sent: Tuesday, December 03, 2013 4:54 PM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: Recurring partitioning problem on local network

Hi,

We are experiencing a frequent partitioning problem on our network with our RabbitMQ cluster.  We've not been able to iron it out and are running out of time before this needs to move into production.

I'll just focus on our DEV environment as it is just a scaled down version of the other environments.

Running on ESXi virtual machines (4GB Ram, 4 Cores dedicated)
Windows2008 R2 SP1 64-Bit
RabbitMQ 3.2.0
Erlang R16B02

There are two web servers and one app server in the above config.   These are all connected to the same network.  Each servers is running its own node - clustering is done through the rabbit config file.

Devweb01 - Ram
Devweb02 - Ram
DevApp01 - Disk

The problem is that every once in a while it starts partitioning off nodes, with nothing really correlating with it happening... not big traffic on the network, no disruptions we can find, etc.  We have gone through and made sure there were no VM settings that allowed items to "go to sleep" or anything aside from a "high performance setting"  (versus power savings).

Here is what we are seeing in the logs... which to me looks like a network interruption, but nothing else indicated that the machine was having issues.  We have a load balancer that flags systems with problems, we have a zenoss node monitoring the servers, we checked the ESXi charts and logs, we looked through windows system logs... nothing seems to have been amiss.

In one partitioning event we saw this in the WebApp server log:

=INFO REPORT==== 27-Nov-2013::18:11:07 ===
rabbit on node 'rabbit at NURWEB-DEVWEB01' down

=ERROR REPORT==== 27-Nov-2013::18:11:10 ===
Mnesia('rabbit at NURWEB-DEVAPP01'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-DEVWEB01'}


And in the DevWeb01 machine mentioned's logs we saw this - it also mentions it lost connections to both of the other boxes.

=INFO REPORT==== 27-Nov-2013::18:10:53 ===
rabbit on node 'rabbit at NURWEB-DEVAPP01' down

=ERROR REPORT==== 27-Nov-2013::18:10:53 ===
Mnesia('rabbit at NURWEB-DEVWEB01'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-DEVAPP01'}

=ERROR REPORT==== 27-Nov-2013::18:10:59 ===
Mnesia('rabbit at NURWEB-DEVWEB01'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-DEVWEB02'}

=INFO REPORT==== 27-Nov-2013::18:11:00 ===
only running disc node went down

=INFO REPORT==== 27-Nov-2013::18:11:01 ===
rabbit on node 'rabbit at NURWEB-DEVWEB02' down

=INFO REPORT==== 27-Nov-2013::18:11:04 ===
only running disc node went down


And web02 only mentions the web01 going down

=INFO REPORT==== 27-Nov-2013::18:11:09 ===
rabbit on node 'rabbit at NURWEB-DEVWEB01' down

=ERROR REPORT==== 27-Nov-2013::18:11:11 ===
Mnesia('rabbit at NURWEB-DEVWEB02'): ** ERROR ** mnes

None of the rabbit installs are actually down during this...

We've seen the same thing on our qa and production boxes - which are the same configurations, just with more nodes.  Not many though 8 nodes on production.

Any ideas would be really appreciated!  I've recently added a net_ticktime to my dev servers to set that at 120 (double I believe) to see if that helps.


Bill



This email and all attachments are confidential and intended solely 
for the use of the individual or entity to which they are addressed. 
If you have received this email in error please notify the sender 
by replying to this message. If you are not the intended recipient, 
please delete this message and all attachments immediately.  Do not 
copy, disclose, use or act upon the information contained. Please 
note that any views or opinions presented in this email are solely 
those of the author and do not necessarily represent those of the 
company. Finally, the recipient should check this email and any 
attachments for the presence of viruses. While every attempt is made 
to verify that the contents are safe, the company accepts no liability 
for any damage caused by any virus transmitted by this email.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131209/cd381fa1/attachment.html>

From mpietrek at skytap.com  Mon Dec  9 22:42:18 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 9 Dec 2013 14:42:18 -0800
Subject: [rabbitmq-discuss] Best practices for cluster upgrades with
	uninterrupted service
Message-ID: <CACLE7iwJr0PFCWuzOtnR9YQ1NoHjsqUMQjGfrYPeWgM_G5_h5Q@mail.gmail.com>

Hey all RabbitMQ devs and experts,

I?m looking for a validation of an approach, or a better suggestion on how
to accomplish.

The big picture is that we want to improve how we upgrade our clusters
without interruptions in service. I know RabbitMQ supports running mixed
versions within a cluster, but for us, upgrade may also mean bringing down
a node for reconfiguration, an Erlang upgrade, or any other number of
scenarios.

Today we do controlled switchover of load from one RabbitMQ cluster to
another, and then switch it back. We use two clusters (a master and an
alternate). Both clusters are identically configured with two RabbitMQ
instances, i.e ?master? is node1,node2, and ?alternate? is node3,node4.

All queues are mirrored. We direct traffic to the master or alternate via a
VIP.

Today our upgrade process looks like this:

--------

* master is operation normally, and pointed to by the VIP.

* Shut down both alternate nodes, upgrade them in whatever manner is
necessary. Newer version, more ram, whatever.

* Start up alternate cluster, then create the same set of queues on it as
the master has.

* Redirect the VIP to point to the alternate.

* Clients see a connection drop because of the VIP change, but are tolerant
and auto-reconnect.

* Copy all queue contents from the master?s queues to the alternate?s
same-named queues.

* Shut down the master nodes and upgrade them.

* Perform similar steps as above to move the VIP and messages back to the
master.

--------

While this generally works, there are small but important problems with it.
One problem is that some of our queues are created/deleted. I have seen
scenarios where unfortunate timing can cause a queue to not be on the right
cluster at the right moment.

Looking at newer RabbitMQ features, in particular policy based mirroring
control, I?m thinking something like this would be better:

-------

* Have node1/node2 running along normally, with the VIP pointing at it.

* Start up node3/node4 in the same cluster

* Use policy to make all queues mirrored by all four nodes. Use synch_queue
as necessary to force synchronization in a reasonable time frame.

* When all queues are synched, remove node1/node2 from the cluster and
upgrade them.

* Because our VIP is managed by keepalived, either node3 or node4 will
obtain the VIP when node1/node2 are removed.

--------

The advantage of this is that it eliminates queue location timing windows
and we don?t have to manually copy messages around. The only downside I?m
aware of is that it won?t work when upgrading major/minor versions. That
is, it should be fine from 3.4.3 to 3.4.7, but not 3.4 to 3.5. In that
case, we'd use our original upgrade logic.

Thoughts? Suggestions? Better ideas?

Thanks,


Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131209/52688274/attachment.html>

From ed.tyrrill at emc.com  Tue Dec 10 01:32:10 2013
From: ed.tyrrill at emc.com (Tyrrill, Ed)
Date: Mon, 9 Dec 2013 20:32:10 -0500
Subject: [rabbitmq-discuss] rabbitmqctl stop hangs
Message-ID: <CECBAF1A.59099%ed.tyrrill@emc.com>

Hi All,

We are using rabbitmq-server rpms on linux.  Recently we upgraded from 3.1.1-1 to 3.2.0-1, and we are seeing intermittent hangs when stopping rabbitmq.  Here is the ps output:

root     31052 31051  0 Dec06 ?        00:00:00 /bin/sh /sbin/service rabbitmq-server stop
root     31055 31052  0 Dec06 ?        00:00:00 /bin/sh /etc/init.d/rabbitmq-server stop
root     31100 31055  0 Dec06 ?        00:00:00 /bin/sh /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
root     31111 31100  0 Dec06 ?        00:00:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "stop" "/var/run/rabbitmq/pid"
rabbitmq 31112 31111  0 Dec06 ?        00:24:10 /usr/lib64/erlang/erts-5.10.3/bin/beam.smp -- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.0/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl31112 -boot start_clean -s rabbit_control_main -nodename rabbit at vm-ave29 -extra stop /var/run/rabbitmq/pid

The CPU time column on the erlang process does slowly go up.  I don't know if it plays a factor, but this broker has shovels defined to a remote broker, and the remote broker was down at the time of this stop.

Is this a known issue?  We've been seeing this a couple times a week (over > 100 brokers), and I need to get a fix for this.

Thanks,
Ed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131209/d8c66798/attachment.html>

From mklishin at gopivotal.com  Tue Dec 10 08:22:40 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 10 Dec 2013 12:22:40 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.1.6 is released
Message-ID: <2A39DDE3-52A4-4EE2-9C5E-E671EB3141A5@gopivotal.com>

amqp gem 1.1.6 [1] is released with some improvements for
apps that need a lot of short-lived channels.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/12/10/amqp-gem-1-dot-1-6-is-released/

1. https://rubygems.org/gems/amqp/versions/1.1.6
--
MK

Software Engineer, Pivotal/RabbitMQ


From deus.verus at gmail.com  Tue Dec 10 02:58:16 2013
From: deus.verus at gmail.com (Bicubic)
Date: Mon, 9 Dec 2013 18:58:16 -0800 (PST)
Subject: [rabbitmq-discuss] .net client foreground threads
Message-ID: <ba0b2e08-f045-4fec-a28e-a774ed0027c1@googlegroups.com>

Hi, I saw a previous question about the .net client using foreground 
threads posted 
on https://groups.google.com/forum/#!topic/rabbitmq-discuss/Zng9pflgIiQ 

My issue is that I have connections and threads lingering after abnormal 
program termination when there was no opportunity to explicitly close 
connections. I intended to capture this case with DomainUnload or 
ProcessExit events, however they don't fire exactly because rabbitmq is 
holding foreground threads. How should I deal with this? I don't care about 
losing messages after my application enters this state, I need a fast clean 
shutdown. 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131209/dc154f32/attachment.html>

From simon at rabbitmq.com  Tue Dec 10 09:39:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Dec 2013 09:39:08 +0000
Subject: [rabbitmq-discuss] rabbit,failure_during_boot
In-Reply-To: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>
References: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>
Message-ID: <52A6E13C.9020702@rabbitmq.com>

On 09/12/2013 15:50, Tiziana Stoesselli wrote:
>                   [{rabbit_queue_index,parse_pub_record_body,
>                        [<<0,0,0,0,0,0,0,0>>]},
>                    {rabbit_queue_index,load_journal_entries,1},

The queue index has ended up with a whole load of zeroes appended to it.

We've seen this happen a few times, usually associated with OS crashes 
or power loss or similar.

We changed the queue index file format to be more resilient to this sort 
of corruption in 3.2.0. I'm not sure if there's anything you can do 
though if you've already got a corrupt file with an older version of 
RabbitMQ apart from reset the node and start again.

Cheers, Simon


From tim at rabbitmq.com  Tue Dec 10 09:49:27 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 10 Dec 2013 09:49:27 +0000
Subject: [rabbitmq-discuss] rabbitmqctl stop hangs
In-Reply-To: <CECBAF1A.59099%ed.tyrrill@emc.com>
References: <CECBAF1A.59099%ed.tyrrill@emc.com>
Message-ID: <329C6A8B-BE65-41F3-BD5D-5944042F169B@rabbitmq.com>

There ought to be further information in the log files from the brokers in question during the stop operation. Can you post that, or put it somewhere accessible please? Why do you have both `rabbitmq-server stop' and `rabbitmqctl stop' running at the same time? Are those pointing to different rabbits? 

On 10 Dec 2013, at 01:32, Tyrrill, Ed wrote:

> Hi All,
> 
> We are using rabbitmq-server rpms on linux.  Recently we upgraded from 3.1.1-1 to 3.2.0-1, and we are seeing intermittent hangs when stopping rabbitmq.  Here is the ps output:
> 
> root     31052 31051  0 Dec06 ?        00:00:00 /bin/sh /sbin/service rabbitmq-server stop
> root     31055 31052  0 Dec06 ?        00:00:00 /bin/sh /etc/init.d/rabbitmq-server stop
> root     31100 31055  0 Dec06 ?        00:00:00 /bin/sh /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
> root     31111 31100  0 Dec06 ?        00:00:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "stop" "/var/run/rabbitmq/pid"
> rabbitmq 31112 31111  0 Dec06 ?        00:24:10 /usr/lib64/erlang/erts-5.10.3/bin/beam.smp -- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.0/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl31112 -boot start_clean -s rabbit_control_main -nodename rabbit at vm-ave29 -extra stop /var/run/rabbitmq/pid
> 
> The CPU time column on the erlang process does slowly go up.  I don't know if it plays a factor, but this broker has shovels defined to a remote broker, and the remote broker was down at the time of this stop.
> 

How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly. If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.

> Is this a known issue?  We've been seeing this a couple times a week (over > 100 brokers), and I need to get a fix for this.
> 

We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/6dec21bb/attachment.html>

From emile at rabbitmq.com  Tue Dec 10 10:46:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Dec 2013 10:46:18 +0000
Subject: [rabbitmq-discuss] .net client foreground threads
In-Reply-To: <ba0b2e08-f045-4fec-a28e-a774ed0027c1@googlegroups.com>
References: <ba0b2e08-f045-4fec-a28e-a774ed0027c1@googlegroups.com>
Message-ID: <52A6F0FA.4010500@rabbitmq.com>


Hi,


On 10/12/13 02:58, Bicubic wrote:

> My issue is that I have connections and threads lingering after abnormal
> program termination when there was no opportunity to explicitly close
> connections.

Sockets have the linger option set by default when closing. I assume
that's not the what you are referring to.

> I intended to capture this case with DomainUnload or ProcessExit
> events, however they don't fire exactly because rabbitmq is holding
> foreground threads. How should I deal with this? I don't care about
> losing messages after my application enters this state, I need a fast
> clean shutdown.


The library should not prevent your application from exiting if all
connections are shut down. Can you identify the foreground threads that
cause a problem, or supply a stacktrace?





-Emile




From watson.timothy at gmail.com  Tue Dec 10 11:12:04 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 10 Dec 2013 11:12:04 +0000
Subject: [rabbitmq-discuss] rabbitmqctl stop hangs
In-Reply-To: <329C6A8B-BE65-41F3-BD5D-5944042F169B@rabbitmq.com>
References: <CECBAF1A.59099%ed.tyrrill@emc.com>
 <329C6A8B-BE65-41F3-BD5D-5944042F169B@rabbitmq.com>
Message-ID: <0959C428-8D1A-4021-80C4-D357E32F091A@rabbitmq.com>

Erm...

On 10 Dec 2013, at 09:49, Tim Watson <tim at rabbitmq.com> wrote:

> Why do you have both `rabbitmq-server stop' and `rabbitmqctl stop' running at the same time? Are those pointing to different rabbits? 

Oh ignore that question - Matthias and Simon point out that the server stop calls the ctrl stop. Sorry for the confusion - I should finish my morning coffee before writing emails! :)

All the points about checking the log files stand though - if you can dig into those it'll help us understand what's going on.

Cheers,
Tim

From simon at rabbitmq.com  Tue Dec 10 15:33:17 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Dec 2013 15:33:17 +0000
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
 node we see a very slow dequeue of messages
In-Reply-To: <loom.20131206T221755-465@post.gmane.org>
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
 <loom.20131206T020729-16@post.gmane.org>
 <loom.20131206T221755-465@post.gmane.org>
Message-ID: <52A7343D.4020003@rabbitmq.com>

On 06/12/13 21:29, James wrote:
> Result: CLIENT_A0 continues to publish at 1MSG/sec, after net_ticktime
> CLIENT_A1 is dequeueing much less then 1MSG/sec and falls behind.

Thanks for a detailed description of the issue. Just to let you know 
that I've reproduced this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Dec 10 16:02:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Dec 2013 16:02:42 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local
	network
In-Reply-To: <25870F6AB6D0E34489AD94C19EA928DB01F2232D@OFLEXMB06P.centene.com>
References: <25870F6AB6D0E34489AD94C19EA928DB01F2232D@OFLEXMB06P.centene.com>
Message-ID: <52A73B22.3060801@rabbitmq.com>

On 09/12/13 22:20, Bill Chmura wrote:
> Can someone confirm for me that I understand these events correctly?  I
> would really appreciate it
>
> =INFO REPORT==== 9-Dec-2013::05:43:41 ===
>
> rabbit on node 'rabbit at NURWEB-QAAPP01' down
>
> // The above indicates the net_ticktime expired without a good response?

Either that or the Erlang VM got positive confirmation that the node was 
down - you'll see this message in the logs when deliberately shutting 
down the node for example, without waiting for net_ticktime.

> =ERROR REPORT==== 9-Dec-2013::05:43:41 ===
>
> Mnesia('rabbit at NURWEB-QAWEB01'): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network,
> 'rabbit at NURWEB-QAAPP01'}
>
> // This means it got back in touch with QAAPP01 and neither had gotten
> good results from the net_ticktime specified ?pings?.  So it partitioned
> itself off.

It got back in touch and both nodes thought the other one had been down 
- i.e. that a network partition has occurred. So this is notification of 
something that has already happened, not a decision being made.

>  So close to it being down though?

Agreed, that's suspicious.

> =ERROR REPORT==== 9-Dec-2013::05:43:41 ===
>
> ** Generic server <0.323.0> terminating
>
> ** Last message in was {mnesia_locker,'rabbit at NURWEB-QAAPP01',granted}
>
> ** When Server state == {state,<0.321.0>,<0.322.0>,rabbit_mgmt_sup,
>
>                              [{rabbit_mgmt_db,
>
>                                   {rabbit_mgmt_db,start_link,[]},
>
>                                   permanent,4294967295,worker,
>
>                                   [rabbit_mgmt_db]}]}
>
> ** Reason for termination ==
>
> ** {unexpected_info,{mnesia_locker,'rabbit at NURWEB-QAAPP01',granted}}
>
> // This (above) I have seen rarely, but it seems related ? any ideas
> aside from the node crashed?

We've not seen many reports of this, but it seems to be associated with 
a node being down for a very short time.

> =INFO REPORT==== 9-Dec-2013::05:43:43 ===
>
> only running disc node went down
>
> // Above indicates the cluster as it is now no longer has QAAPP01 which
> is the disk node.

Yes, this is to suggest that the cluster is in a dangerous state; if a 
cluster consisting only of RAM nodes is shut down you will experience 
data loss.

(As an aside: you might want to have more disc nodes to prevent this!)

> =ERROR REPORT==== 9-Dec-2013::05:45:35 ===
>
> Mnesia('rabbit at NURWEB-QAWEB01'): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network,
> 'rabbit at NURWEB-QAWEB02'}
>
> // The above indicates that it just portioned itself off from another of
> the cluster

Same as above.

> Any help would be very much appreciated ? especially confirming that I
> understand the above events will help with the troubleshooting process.

So the fact that the node comes back almost as soon as it is seen as 
down is quite dubious to me. If you are able to run a patched version of 
the server it might be interesting to log why nodes are considered to be 
down (whether it actually is net_ticktime).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sp345s at att.com  Tue Dec 10 16:41:23 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Tue, 10 Dec 2013 16:41:23 +0000
Subject: [rabbitmq-discuss] SSL Client using spring
In-Reply-To: <CADtU9_v=1WqHLnSZ-4C-KYN0n_a7Guu8TivEka-pQf8B9Xu=mg@mail.gmail.com>
References: <59BF56992750434F89F8EBE141E64B1D018376AE@GAALPA1MSGUSR9C.ITServices.sbc.com>
 <CADtU9_v=1WqHLnSZ-4C-KYN0n_a7Guu8TivEka-pQf8B9Xu=mg@mail.gmail.com>
Message-ID: <59BF56992750434F89F8EBE141E64B1D018377EA@GAALPA1MSGUSR9C.ITServices.sbc.com>

Thanks Gary ..

I tried as you suggested below by wiring my CF to the spring ...It still doesn't work ..

I was able to get it working with a simple java but not through spring ...

Pl. find the log and the context file attached ..

Appreciate all the help..
Thanks,
Sagar

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Friday, December 06, 2013 1:30 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] SSL Client using spring

Wire up your rabbit connection factory as you wish, and then provide a reference to it to the spring connection factory...

<rabbit:connection-factory id="connectionFactory" connection-factory="rabbitFactory" ... />

On Fri, Dec 6, 2013 at 1:22 PM, PATAR, SAGAR <sp345s at att.com<mailto:sp345s at att.com>> wrote:
I don't see any option to use SSL and pass the cert / keystore using spring amqp ... Can you pl. help me with some examples ...
I was able to get it working using a simple java class ..but cant see options with spring amqp

Thanks,
Sagar

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/f46a8d18/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: demoMessageSender.log
Type: application/octet-stream
Size: 46304 bytes
Desc: demoMessageSender.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/f46a8d18/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: DLCoreConnectionFactory.java
Type: application/octet-stream
Size: 2961 bytes
Desc: DLCoreConnectionFactory.java
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/f46a8d18/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SslWithCertSend.java
Type: application/octet-stream
Size: 1934 bytes
Desc: SslWithCertSend.java
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/f46a8d18/attachment-0002.obj>

From bchmura at nurturhealth.com  Tue Dec 10 16:56:06 2013
From: bchmura at nurturhealth.com (Bill Chmura)
Date: Tue, 10 Dec 2013 16:56:06 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local
 network
In-Reply-To: <52A73B22.3060801@rabbitmq.com>
References: <25870F6AB6D0E34489AD94C19EA928DB01F2232D@OFLEXMB06P.centene.com>
 <52A73B22.3060801@rabbitmq.com>
Message-ID: <25870F6AB6D0E34489AD94C19EA928DB01F22E1F@OFLEXMB06P.centene.com>

I think we are willing to do anything :)

Right now we are aiming to run without clustering for the short term - we need to be up and stable.

What do you mean by a patched version?  Are there instructions?

We are also doing that other testing to try and replicate the issue... should have been this morning, but we've had a weather delay



-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Tuesday, December 10, 2013 11:03 AM
To: Discussions about RabbitMQ
Cc: Bill Chmura
Subject: Re: [rabbitmq-discuss] Recurring partitioning problem on local network

On 09/12/13 22:20, Bill Chmura wrote:
> Can someone confirm for me that I understand these events correctly?  
> I would really appreciate it
>
> =INFO REPORT==== 9-Dec-2013::05:43:41 ===
>
> rabbit on node 'rabbit at NURWEB-QAAPP01' down
>
> // The above indicates the net_ticktime expired without a good response?

Either that or the Erlang VM got positive confirmation that the node was down - you'll see this message in the logs when deliberately shutting down the node for example, without waiting for net_ticktime.

> =ERROR REPORT==== 9-Dec-2013::05:43:41 ===
>
> Mnesia('rabbit at NURWEB-QAWEB01'): ** ERROR ** mnesia_event got 
> {inconsistent_database, running_partitioned_network, 
> 'rabbit at NURWEB-QAAPP01'}
>
> // This means it got back in touch with QAAPP01 and neither had gotten 
> good results from the net_ticktime specified "pings".  So it 
> partitioned itself off.

It got back in touch and both nodes thought the other one had been down
- i.e. that a network partition has occurred. So this is notification of something that has already happened, not a decision being made.

>  So close to it being down though?

Agreed, that's suspicious.

> =ERROR REPORT==== 9-Dec-2013::05:43:41 ===
>
> ** Generic server <0.323.0> terminating
>
> ** Last message in was {mnesia_locker,'rabbit at NURWEB-QAAPP01',granted}
>
> ** When Server state == {state,<0.321.0>,<0.322.0>,rabbit_mgmt_sup,
>
>                              [{rabbit_mgmt_db,
>
>                                   {rabbit_mgmt_db,start_link,[]},
>
>                                   permanent,4294967295,worker,
>
>                                   [rabbit_mgmt_db]}]}
>
> ** Reason for termination ==
>
> ** {unexpected_info,{mnesia_locker,'rabbit at NURWEB-QAAPP01',granted}}
>
> // This (above) I have seen rarely, but it seems related - any ideas 
> aside from the node crashed?

We've not seen many reports of this, but it seems to be associated with a node being down for a very short time.

> =INFO REPORT==== 9-Dec-2013::05:43:43 ===
>
> only running disc node went down
>
> // Above indicates the cluster as it is now no longer has QAAPP01 
> which is the disk node.

Yes, this is to suggest that the cluster is in a dangerous state; if a cluster consisting only of RAM nodes is shut down you will experience data loss.

(As an aside: you might want to have more disc nodes to prevent this!)

> =ERROR REPORT==== 9-Dec-2013::05:45:35 ===
>
> Mnesia('rabbit at NURWEB-QAWEB01'): ** ERROR ** mnesia_event got 
> {inconsistent_database, running_partitioned_network, 
> 'rabbit at NURWEB-QAWEB02'}
>
> // The above indicates that it just portioned itself off from another 
> of the cluster

Same as above.

> Any help would be very much appreciated - especially confirming that I 
> understand the above events will help with the troubleshooting process.

So the fact that the node comes back almost as soon as it is seen as down is quite dubious to me. If you are able to run a patched version of the server it might be interesting to log why nodes are considered to be down (whether it actually is net_ticktime).

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

This email and all attachments are confidential and intended solely 
for the use of the individual or entity to which they are addressed. 
If you have received this email in error please notify the sender 
by replying to this message. If you are not the intended recipient, 
please delete this message and all attachments immediately.  Do not 
copy, disclose, use or act upon the information contained. Please 
note that any views or opinions presented in this email are solely 
those of the author and do not necessarily represent those of the 
company. Finally, the recipient should check this email and any 
attachments for the presence of viruses. While every attempt is made 
to verify that the contents are safe, the company accepts no liability 
for any damage caused by any virus transmitted by this email.


From grussell at gopivotal.com  Tue Dec 10 17:04:59 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Tue, 10 Dec 2013 12:04:59 -0500
Subject: [rabbitmq-discuss] SSL Client using spring
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D018377EA@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018376AE@GAALPA1MSGUSR9C.ITServices.sbc.com>
 <CADtU9_v=1WqHLnSZ-4C-KYN0n_a7Guu8TivEka-pQf8B9Xu=mg@mail.gmail.com>
 <59BF56992750434F89F8EBE141E64B1D018377EA@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <CADtU9_vNCGnZCPZpLQyNYO=8DW2kJhL17PnLSC64U1WwuHhadg@mail.gmail.com>

You didn't show your wiring, but clearly you can see from the stack trace
that the Spring factory is delegating to the rabbit client factory, and
it's using SSL...

Caused by: java.net.ConnectException: Connection refused: connect
at java.net.PlainSocketImpl.socketConnect(Native Method)
at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:351)
at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:213)
at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:200)
at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
at java.net.Socket.connect(Socket.java:529)
at com.sun.net.ssl.internal.ssl.SSLSocketImpl
.connect(SSLSocketImpl.java:564)
at
com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:445)
at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:504)
at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:545)
at
org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:181)

... so there must be something wrong with your configuration.



On Tue, Dec 10, 2013 at 11:41 AM, PATAR, SAGAR <sp345s at att.com> wrote:

>  Thanks Gary ..
>
>
>
> I tried as you suggested below by wiring my CF to the spring ?It still
> doesn?t work ..
>
>
>
> I was able to get it working with a simple java but not through spring ?
>
>
>
> Pl. find the log and the context file attached ..
>
>
>
> Appreciate all the help..
>
> Thanks,
>
> Sagar
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Gary Russell
> *Sent:* Friday, December 06, 2013 1:30 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] SSL Client using spring
>
>
>
> Wire up your rabbit connection factory as you wish, and then provide a
> reference to it to the spring connection factory...
>
>
>
> <rabbit:connection-factory id="connectionFactory"
> connection-factory="rabbitFactory" ... />
>
>
>
> On Fri, Dec 6, 2013 at 1:22 PM, PATAR, SAGAR <sp345s at att.com> wrote:
>
> I don?t see any option to use SSL and pass the cert / keystore using
> spring amqp ? Can you pl. help me with some examples ?
>
> I was able to get it working using a simple java class ..but cant see
> options with spring amqp
>
>
>
> Thanks,
>
> Sagar
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/5b63d110/attachment.html>

From simon at rabbitmq.com  Tue Dec 10 17:08:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Dec 2013 17:08:32 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local
	network
In-Reply-To: <25870F6AB6D0E34489AD94C19EA928DB01F22E1F@OFLEXMB06P.centene.com>
References: <25870F6AB6D0E34489AD94C19EA928DB01F2232D@OFLEXMB06P.centene.com>
 <52A73B22.3060801@rabbitmq.com>
 <25870F6AB6D0E34489AD94C19EA928DB01F22E1F@OFLEXMB06P.centene.com>
Message-ID: <52A74A90.2020508@rabbitmq.com>

On 10/12/13 16:56, Bill Chmura wrote:
> What do you mean by a patched version?  Are there instructions?

I've attached a modified rabbit_node_monitor.beam which can replace the 
one in your RabbitMQ installation's ebin directory. This version has 
been modified to additionally log messages on node down like this:

> =INFO REPORT==== 10-Dec-2013::16:32:02 ===
> node hare at smacmullen down: connection_closed

giving the reason why the runtime considers the other node to be down. 
(This feature will make its way into a future release eventually). I am 
curious as to whether you are really seeing net_ticktime-related 
timeouts or something else, and it would be good to get some data on that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_node_monitor.beam
Type: application/octet-stream
Size: 16472 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/b79a16bd/attachment.obj>

From nicholasastuart at gmail.com  Tue Dec 10 18:17:13 2013
From: nicholasastuart at gmail.com (Nicholas Stuart)
Date: Tue, 10 Dec 2013 10:17:13 -0800 (PST)
Subject: [rabbitmq-discuss] Network partition detected,
 did not recover gracefully even though cluster_partition_handling =
 autoheal
Message-ID: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>

I received a message regarding my cluster state saying "Network partition 
detected". I went to check my RabbitMQ logs and I can see a bunch of error 
reports like this:

=ERROR REPORT==== 7-Dec-2013::08:46:18 ===
** Generic server <0.507.0> terminating
** Last message in was {'DOWN',#Ref<0.0.0.74464>,process,<7022.1390.0>,
                               noconnection}
** When Server state == {state,
                            {0,<0.507.0>},
                            {{7,<7022.1390.0>},#Ref<0.0.0.74464>},
                            {{0,<7021.456.0>},#Ref<0.0.0.69498>},
                            {resource,<<"UAT_ENT">>,queue,
                                <<"queue.1">>},
                            rabbit_mirror_queue_coordinator,
                            {8,
                             [{{0,<7021.456.0>},
                               {view_member,
                                   {0,<7021.456.0>},
                                   [],
                                   {0,<0.507.0>},
                                   {7,<7022.1390.0>}}},
                              {{0,<0.507.0>},
                               {view_member,
                                   {0,<0.507.0>},
                                   [],
                                   {7,<7022.1390.0>},
                                   {0,<7021.456.0>}}},
                              {{7,<7022.1390.0>},
                               {view_member,
                                   {7,<7022.1390.0>},
                                   [],
                                   {0,<7021.456.0>},
                                   {0,<0.507.0>}}}]},
                            43,
                            [{{0,<7021.456.0>},{member,{[],[]},0,0}},
                             {{0,<0.507.0>},{member,{[],[]},43,43}},
                             {{7,<7022.1390.0>},{member,{[],[]},0,0}}],
                            [<0.506.0>],
                            {[],[]},
                            [],undefined,
                            #Fun<rabbit_misc.execute_mnesia_transaction.1>}
** Reason for termination == 
** {function_clause,[{orddict,fetch,
                              [{0,<0.507.0>},[]],
                              [{file,"orddict.erl"},{line,72}]},
                     {gm,check_neighbours,1,[]},
                     {gm,handle_info,2,[]},
                     {gen_server2,handle_msg,2,[]},
                    
 {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}

After restarting the troubled node, which fixed the network partition 
message, I see the following message in my logs many times:

Discarding message {'$gen_call',{<0.26793.8>,#Ref<0.0.1.31326>},stat} from 
<0.26793.8> to <0.433.0> in an old incarnation (3) of this node (2)

I'm not sure why it failed, but I did have some network failure indicated 
in other systems, so I assume it was that. My issue is that the network 
never tried to rescue itself afterwards, even though in my rabbitmq.conf I 
have cluster_partition_handling set to autoheal. It is my understanding 
that setting it to autoheal will cause the nodes to fix its network 
partition, is this assumption incorrect?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/b3a15dd9/attachment.html>

From ed.tyrrill at emc.com  Tue Dec 10 18:48:22 2013
From: ed.tyrrill at emc.com (Tyrrill, Ed)
Date: Tue, 10 Dec 2013 13:48:22 -0500
Subject: [rabbitmq-discuss] rabbitmqctl stop hangs
In-Reply-To: <329C6A8B-BE65-41F3-BD5D-5944042F169B@rabbitmq.com>
Message-ID: <CECCA110.5916A%ed.tyrrill@emc.com>

Hi Tim,

Thanks for your quick response.  From the end of the log it looks like the shovel plugin was trying to establish the connection to the remote broker, which was down at the time, at the same time stop was run:

=ERROR REPORT==== 6-Dec-2013::13:51:36 ===
** Generic server <0.8762.19> terminating
** Last message in was {'EXIT',<0.8759.19>,
                           {{badmatch,{error,etimedout}},
                            [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
                             {rabbit_shovel_worker,handle_cast,2,[]},
                             {gen_server2,handle_msg,2,[]},
                             {proc_lib,init_p_do_apply,3,
                                 [{file,"proc_lib.erl"},{line,239}]}]}}
** When Server state == {state,amqp_direct_connection,
                         {state,'rabbit at vm-ave29',
                          {user,<<"guest">>,
                           [administrator],
                           rabbit_auth_backend_internal,
                           {internal_user,<<"guest">>,
                            <<193,148,73,243,245,222,154,143,19,215,47,234,93,
                              175,56,125,17,151,61,97>>,
                            [administrator]}},
                          <<"/">>,
                          {amqp_params_direct,<<"guest">>,none,<<"/">>,
                           'rabbit at vm-ave29',none,[]},
                          {amqp_adapter_info,unknown,unknown,unknown,unknown,
                           <<"<'rabbit at vm-ave29'.3.8762.19>">>,
                           {'Direct',{0,9,1}},
                           []},
                          <0.8765.19>,undefined},
                         <0.8764.19>,
                         {amqp_params_direct,<<"guest">>,none,<<"/">>,
                          'rabbit at vm-ave29',none,[]},
                         0,
                         [{<<"capabilities">>,table,
                           [{<<"publisher_confirms">>,bool,true},
                            {<<"exchange_exchange_bindings">>,bool,true},
                            {<<"basic.nack">>,bool,true},
                            {<<"consumer_cancel_notify">>,bool,true},
                            {<<"connection.blocked">>,bool,true},
                            {<<"consumer_priorities">>,bool,true},
                            {<<"authentication_failure_close">>,bool,true}]},
                          {<<"copyright">>,longstr,
                           <<"Copyright (C) 2007-2013 GoPivotal, Inc.">>},
                          {<<"information">>,longstr,
                           <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>},
                          {<<"platform">>,longstr,<<"Erlang/OTP">>},
                          {<<"product">>,longstr,<<"RabbitMQ">>},
                          {<<"version">>,longstr,<<"3.2.0">>}],
                         none,false}
** Reason for termination ==
** {unexpected_msg,
       {'EXIT',<0.8759.19>,
           {{badmatch,{error,etimedout}},
            [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
             {rabbit_shovel_worker,handle_cast,2,[]},
             {gen_server2,handle_msg,2,[]},
             {proc_lib,init_p_do_apply,3,
                 [{file,"proc_lib.erl"},{line,239}]}]}}}

=INFO REPORT==== 6-Dec-2013::13:51:36 ===
stopped TCP Listener on 127.0.0.1:5672

=INFO REPORT==== 6-Dec-2013::13:51:36 ===
Halting Erlang VM




From: Tim Watson <tim at rabbitmq.com<mailto:tim at rabbitmq.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Tuesday, December 10, 2013 1:49 AM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] rabbitmqctl stop hangs

There ought to be further information in the log files from the brokers in question during the stop operation. Can you post that, or put it somewhere accessible please? Why do you have both `rabbitmq-server stop' and `rabbitmqctl stop' running at the same time? Are those pointing to different rabbits?

On 10 Dec 2013, at 01:32, Tyrrill, Ed wrote:

Hi All,

We are using rabbitmq-server rpms on linux.  Recently we upgraded from 3.1.1-1 to 3.2.0-1, and we are seeing intermittent hangs when stopping rabbitmq.  Here is the ps output:

root     31052 31051  0 Dec06 ?        00:00:00 /bin/sh /sbin/service rabbitmq-server stop
root     31055 31052  0 Dec06 ?        00:00:00 /bin/sh /etc/init.d/rabbitmq-server stop
root     31100 31055  0 Dec06 ?        00:00:00 /bin/sh /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
root     31111 31100  0 Dec06 ?        00:00:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "stop" "/var/run/rabbitmq/pid"
rabbitmq 31112 31111  0 Dec06 ?        00:24:10 /usr/lib64/erlang/erts-5.10.3/bin/beam.smp -- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.0/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl31112 -boot start_clean -s rabbit_control_main -nodename rabbit at vm-ave29 -extra stop /var/run/rabbitmq/pid

The CPU time column on the erlang process does slowly go up.  I don't know if it plays a factor, but this broker has shovels defined to a remote broker, and the remote broker was down at the time of this stop.


How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly. If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.

Is this a known issue?  We've been seeing this a couple times a week (over > 100 brokers), and I need to get a fix for this.


We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/98ddbd1e/attachment.html>

From gabriel.dausque at gdfsueztrading.com  Tue Dec 10 19:12:01 2013
From: gabriel.dausque at gdfsueztrading.com (gabriel.dausque at gdfsueztrading.com)
Date: Tue, 10 Dec 2013 20:12:01 +0100
Subject: [rabbitmq-discuss] using rabbitmq with active directory without
	sending password.
Message-ID: <5364289F36AB9D48904552794BA271CA2897E6E93A@XC203447.MELINDA.LOCAL>

Hello,

Because of new recommendation asked by our Security officer, we must add secure authentication to access rabbitmq.

To do that, we are experiencing the usage of ldap plugin with a .Net client in front of it, but I I'm quite surprise to be forced to send the windows user password to the rabbitmq server in order for it to check the identity of the user  as it seems to be a very bad security practice to ask for the already authenticated user its password and reuse it, and also my security officer will not validate that kind of solution.

Is there a way to only check that the user is already authenticated without explicit login/password using ldap authentication ?

Best regards

Gabriel DAUSQUE
Expert SI Meteor FPR
Tel : 01 56 65 66 68
Mail : gabriel.dausque at gdfsueztrading.com

___________________________________________________________________ 

This message (including any attachments) and its content are confidential, meant solely for the addressees. 
The views expressed in this message are those of its author and do not necessarily represent the opinion of GDF SUEZ Trading. 
If you are not the intended recipient please notify the sender immediately and destroy this e-mail. 
Any unauthorised copying, use, disclosure or distribution of the content of this e-mail is strictly forbidden. 
GDF SUEZ Trading shall not be liable for the message if altered, changed or falsified or computer virus contained. 
___________________________________________________________________ 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/91aa58ad/attachment.html>

From ty at sarna.org  Tue Dec 10 19:17:09 2013
From: ty at sarna.org (Ty Sarna)
Date: Tue, 10 Dec 2013 14:17:09 -0500
Subject: [rabbitmq-discuss] RabbitMQ and SMB mount problems?
Message-ID: <B1615705-2345-4490-A468-C16180C7FA44@sarna.org>

I'm using 3.1.5 on Windows 2008, and I have a variety of problems when I
try to run from a SMB share. For various reasons this is necessary (eg,
using RMQ as part of automated tests in builds, which happen on shares),
and it just doesn't seem to work. 

All the problems seem to boil down to filename rename failing. With
rabbitmq-plugins, enabling or disabling a plugin seems to succeed, but
leaves an enabled_plugins.tmp file with the edits, as the rename silently
fails. On a local drive, it works fine.

Similarly, while trying to start up the server itself, it fails
to rename cluster_nodes.config.tmp into place, but in this case there
is some error checking and the startup actually fails. If I manually
rename it and try again, it fails on nodes_running_at_shutdown.tmp.
That one I can't resolve manually.

Is this a known issue? Are there any workarounds aside from running
on local storage only (which, as mentioned, isn't practical in many
important cases)?

Thanks.

From prabodh.upreti at vce.com  Tue Dec 10 20:39:39 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Tue, 10 Dec 2013 12:39:39 -0800 (PST)
Subject: [rabbitmq-discuss] shutdown log file time stamp
Message-ID: <1386707979432-31952.post@n5.nabble.com>

Hello

We are running rabbit 2.8.6 on centos 6.3.

Just noticed that the shutdown log does not have a times stamp when the
services is shutdown.  Is there a way display that time stamp?  Thank you in
advance.

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/shutdown-log-file-time-stamp-tp31952.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From k.madnani84 at gmail.com  Tue Dec 10 20:54:19 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Tue, 10 Dec 2013 12:54:19 -0800 (PST)
Subject: [rabbitmq-discuss] Load Balancing the ssl support in RabbitMQ.
Message-ID: <1386708859004-31953.post@n5.nabble.com>

Hi,

I usually load balance my RabbitMQ Nodes with HAProxy and everything works
perfectly fine as mentioned in RabbitMQ In Action.

I need to enhance my configuration and provide ssl support in rabbitMQ.Will
the configuration for HAProxy remain same with only change in the
Hostname:sslPort in server section.

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Load-Balancing-the-ssl-support-in-RabbitMQ-tp31953.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Dec 10 21:08:15 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 11 Dec 2013 01:08:15 +0400
Subject: [rabbitmq-discuss] Load Balancing the ssl support in RabbitMQ.
In-Reply-To: <1386708859004-31953.post@n5.nabble.com>
References: <1386708859004-31953.post@n5.nabble.com>
Message-ID: <B8F5DE73-E7CA-40A0-8E0B-FFC596900A7D@rabbitmq.com>

On 11 Dec 2013, at 00:54, k.madnani84 <k.madnani84 at gmail.com> wrote:

> I need to enhance my configuration and provide ssl support in rabbitMQ.Will
> the configuration for HAProxy remain same with only change in the
> Hostname:sslPort in server section.

It depends whether you want connections from HAproxy to RabbitMQ be non-encrypted
(SSL termination) or not (SSL pass through).

SSL termination with HAproxy is definitely possible but will require version 1.5 (marked as development).
Brief research suggests that SSL pass through with HAproxy is at least not widely used and/or documented.

MK

Software Engineer, Pivotal/RabbitMQ



From ed.tyrrill at emc.com  Tue Dec 10 23:40:23 2013
From: ed.tyrrill at emc.com (Tyrrill, Ed)
Date: Tue, 10 Dec 2013 18:40:23 -0500
Subject: [rabbitmq-discuss] rabbitmqctl stop hangs
In-Reply-To: <CECCA110.5916A%ed.tyrrill@emc.com>
Message-ID: <CECCDE5C.59227%ed.tyrrill@emc.com>

Hi Tim,

I realized I did not address all of your questions.

>  How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly.

I have one I server I left untouched that hung four days ago, and is still hung

> If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.

The destination of the shovel was down at the time so only the source side is relevant.  I noticed that the shutdown_log file has the time 13:46, with the message "Stopping and halting node 'rabbit at vm-ave29' ?", and shutdown_err is empty.  The "Halting Erlang VM" message in rabbit at vm-ave29.log is then coming five minutes later at 13:51.  The messages in rabbit at vm-ave29-sasl.log all seem related to shovel connect attempts.  Also note that the RabbitMQ erlang process is still running.

> We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?

Five durable queues.

Thanks,
Ed

From: <Tyrrill>, Edward Tyrrill <ed.tyrrill at emc.com<mailto:ed.tyrrill at emc.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Tuesday, December 10, 2013 10:48 AM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] rabbitmqctl stop hangs

Hi Tim,

Thanks for your quick response.  From the end of the log it looks like the shovel plugin was trying to establish the connection to the remote broker, which was down at the time, at the same time stop was run:

=ERROR REPORT==== 6-Dec-2013::13:51:36 ===
** Generic server <0.8762.19> terminating
** Last message in was {'EXIT',<0.8759.19>,
                           {{badmatch,{error,etimedout}},
                            [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
                             {rabbit_shovel_worker,handle_cast,2,[]},
                             {gen_server2,handle_msg,2,[]},
                             {proc_lib,init_p_do_apply,3,
                                 [{file,"proc_lib.erl"},{line,239}]}]}}
** When Server state == {state,amqp_direct_connection,
                         {state,'rabbit at vm-ave29',
                          {user,<<"guest">>,
                           [administrator],
                           rabbit_auth_backend_internal,
                           {internal_user,<<"guest">>,
                            <<193,148,73,243,245,222,154,143,19,215,47,234,93,
                              175,56,125,17,151,61,97>>,
                            [administrator]}},
                          <<"/">>,
                          {amqp_params_direct,<<"guest">>,none,<<"/">>,
                           'rabbit at vm-ave29',none,[]},
                          {amqp_adapter_info,unknown,unknown,unknown,unknown,
                           <<"<'rabbit at vm-ave29'.3.8762.19<mailto:'rabbit at vm-ave29'.3.8762.19>>">>,
                           {'Direct',{0,9,1}},
                           []},
                          <0.8765.19>,undefined},
                         <0.8764.19>,
                         {amqp_params_direct,<<"guest">>,none,<<"/">>,
                          'rabbit at vm-ave29',none,[]},
                         0,
                         [{<<"capabilities">>,table,
                           [{<<"publisher_confirms">>,bool,true},
                            {<<"exchange_exchange_bindings">>,bool,true},
                            {<<"basic.nack">>,bool,true},
                            {<<"consumer_cancel_notify">>,bool,true},
                            {<<"connection.blocked">>,bool,true},
                            {<<"consumer_priorities">>,bool,true},
                            {<<"authentication_failure_close">>,bool,true}]},
                          {<<"copyright">>,longstr,
                           <<"Copyright (C) 2007-2013 GoPivotal, Inc.">>},
                          {<<"information">>,longstr,
                           <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>},
                          {<<"platform">>,longstr,<<"Erlang/OTP">>},
                          {<<"product">>,longstr,<<"RabbitMQ">>},
                          {<<"version">>,longstr,<<"3.2.0">>}],
                         none,false}
** Reason for termination ==
** {unexpected_msg,
       {'EXIT',<0.8759.19>,
           {{badmatch,{error,etimedout}},
            [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
             {rabbit_shovel_worker,handle_cast,2,[]},
             {gen_server2,handle_msg,2,[]},
             {proc_lib,init_p_do_apply,3,
                 [{file,"proc_lib.erl"},{line,239}]}]}}}

=INFO REPORT==== 6-Dec-2013::13:51:36 ===
stopped TCP Listener on 127.0.0.1:5672

=INFO REPORT==== 6-Dec-2013::13:51:36 ===
Halting Erlang VM




From: Tim Watson <tim at rabbitmq.com<mailto:tim at rabbitmq.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Tuesday, December 10, 2013 1:49 AM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] rabbitmqctl stop hangs

There ought to be further information in the log files from the brokers in question during the stop operation. Can you post that, or put it somewhere accessible please? Why do you have both `rabbitmq-server stop' and `rabbitmqctl stop' running at the same time? Are those pointing to different rabbits?

On 10 Dec 2013, at 01:32, Tyrrill, Ed wrote:

Hi All,

We are using rabbitmq-server rpms on linux.  Recently we upgraded from 3.1.1-1 to 3.2.0-1, and we are seeing intermittent hangs when stopping rabbitmq.  Here is the ps output:

root     31052 31051  0 Dec06 ?        00:00:00 /bin/sh /sbin/service rabbitmq-server stop
root     31055 31052  0 Dec06 ?        00:00:00 /bin/sh /etc/init.d/rabbitmq-server stop
root     31100 31055  0 Dec06 ?        00:00:00 /bin/sh /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
root     31111 31100  0 Dec06 ?        00:00:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "stop" "/var/run/rabbitmq/pid"
rabbitmq 31112 31111  0 Dec06 ?        00:24:10 /usr/lib64/erlang/erts-5.10.3/bin/beam.smp -- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.0/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl31112 -boot start_clean -s rabbit_control_main -nodename rabbit at vm-ave29 -extra stop /var/run/rabbitmq/pid

The CPU time column on the erlang process does slowly go up.  I don't know if it plays a factor, but this broker has shovels defined to a remote broker, and the remote broker was down at the time of this stop.


How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly. If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.

Is this a known issue?  We've been seeing this a couple times a week (over > 100 brokers), and I need to get a fix for this.


We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/2efd233a/attachment.html>

From james.eddy at us.thalesgroup.com  Wed Dec 11 00:43:53 2013
From: james.eddy at us.thalesgroup.com (James)
Date: Wed, 11 Dec 2013 00:43:53 +0000 (UTC)
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
	node we see a very slow dequeue of messages
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
 <loom.20131206T020729-16@post.gmane.org>
 <loom.20131206T221755-465@post.gmane.org> <52A7343D.4020003@rabbitmq.com>
Message-ID: <loom.20131211T013716-730@post.gmane.org>

Simon MacMullen <simon at ...> writes:

> 
> On 06/12/13 21:29, James wrote:
> > Result: CLIENT_A0 continues to publish at 1MSG/sec, after net_ticktime
> > CLIENT_A1 is dequeueing much less then 1MSG/sec and falls behind.
> 
> Thanks for a detailed description of the issue. Just to let you know 
> that I've reproduced this.
> 
> Cheers, Simon
> 

Hi Simon. Thanks for the update.

Where you also able to observe the other issues that occur in this state? 
Such as:
* rabbitmqctl cluster_status/list_queues/list_connections/list_exchanges all 
hang, rabbitmq status does not hang
* declareQueue, declarePassiveQueue, declareExchange, declareExchangePassive 
all hang


One last thing I wanted to add to this. When I run this on average hardware 
(4 core 2GHZ, x86, 8GB ram) the issue is still seen, but not as noticeable. 
When I run this on much more modest hardware (PPC 2core 1GHZ 1GB RAM) The 
issue is several of orders of magnitude worse, but otherwise this lower end 
hardware is sufficient for the message load.

Thanks,
James




From bchmura at nurturhealth.com  Wed Dec 11 03:19:39 2013
From: bchmura at nurturhealth.com (Bill Chmura)
Date: Wed, 11 Dec 2013 03:19:39 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local
 network
In-Reply-To: <52A74A90.2020508@rabbitmq.com>
References: <25870F6AB6D0E34489AD94C19EA928DB01F2232D@OFLEXMB06P.centene.com>
 <52A73B22.3060801@rabbitmq.com>
 <25870F6AB6D0E34489AD94C19EA928DB01F22E1F@OFLEXMB06P.centene.com>
 <52A74A90.2020508@rabbitmq.com>
Message-ID: <25870F6AB6D0E34489AD94C19EA928DB01F2481C@OFLEXMB06P.centene.com>

One of our sets went down today

Both nodes basically have this, just naming the other node:

=INFO REPORT==== 10-Dec-2013::18:29:24 ===
rabbit on node 'rabbit at NURWEB-QAWEB01' down

=ERROR REPORT==== 10-Dec-2013::18:29:35 ===
Mnesia('rabbit at NURWEB-QAWEB02'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-QAWEB01'}

=INFO REPORT==== 10-Dec-2013::18:29:47 ===
node 'rabbit at NURWEB-QAWEB01' down: connection_closed

Not much more info with the patched base file... does this help at all?

I tried searching and got a lot on connection closed abruptly... but it did not sound right.



-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Tuesday, December 10, 2013 12:09 PM
To: Bill Chmura
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Recurring partitioning problem on local network

On 10/12/13 16:56, Bill Chmura wrote:
> What do you mean by a patched version?  Are there instructions?

I've attached a modified rabbit_node_monitor.beam which can replace the one in your RabbitMQ installation's ebin directory. This version has been modified to additionally log messages on node down like this:

> =INFO REPORT==== 10-Dec-2013::16:32:02 === node hare at smacmullen down: 
> connection_closed

giving the reason why the runtime considers the other node to be down. 
(This feature will make its way into a future release eventually). I am curious as to whether you are really seeing net_ticktime-related timeouts or something else, and it would be good to get some data on that.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

This email and all attachments are confidential and intended solely 
for the use of the individual or entity to which they are addressed. 
If you have received this email in error please notify the sender 
by replying to this message. If you are not the intended recipient, 
please delete this message and all attachments immediately.  Do not 
copy, disclose, use or act upon the information contained. Please 
note that any views or opinions presented in this email are solely 
those of the author and do not necessarily represent those of the 
company. Finally, the recipient should check this email and any 
attachments for the presence of viruses. While every attempt is made 
to verify that the contents are safe, the company accepts no liability 
for any damage caused by any virus transmitted by this email.


From sukhjeet.singh1 at kindlebit.com  Wed Dec 11 06:23:53 2013
From: sukhjeet.singh1 at kindlebit.com (Sukhjeet)
Date: Wed, 11 Dec 2013 11:53:53 +0530
Subject: [rabbitmq-discuss] RabbitMq[Functionality with multiple users]
Message-ID: <52A804F9.8000900@kindlebit.com>

Hello Team,
                           I am working out with rabbit-mq from some 
days. It is a very nice application and I am trying to incorporating 
this app into my Asp.net MVC 4.0 Web app for providing a facility
                           of mailing system.  I have gone through the 
tutorials and certain examples for C#.

Requirement: Sir, my requirement is to provide a mail like system in the 
web app using Rabbit-Mq. For Example: If I have one user logged in to my 
application and sends a message to another
                         online user , I need to send the message to 
that user. I am using a very basic code given on Rabbit-mq web site but 
I am not getting an idea on how rabbit-mq will server this.As for   now 
I when I click on send message , a message is stored in the queue and 
then when I click on recieve message button on same page, the particular 
message is shown. That is just a template that I have designed.

Can you please help me for my practical situation and I will be really 
thankful to you.

I am using below Code for my template. Please send me the code to 
implement this or just guide me a path by which I can achieve this.


This is a view page::
   public ActionResult Index()
         {
             MessageService ObjMessageService = new MessageService();
             var model = new MessagingModel();
             model.MessageList = ObjMessageService.GetMessageDetails();
             return View(model);
         }



Below function works when "SendMessage" button is pressed
         public ActionResult SendMessage(MessagingModel ObjModel)
         {
             string Message = string.Empty;
             try
             {

                 //var factory = new ConnectionFactory() { HostName = 
"localhost" };
                 //using (var connection = factory.CreateConnection())
                 //using (var channel = connection.CreateModel())
                 //{
                 //    channel.ExchangeDeclare("logs", "fanout");
                 //    var message = ObjModel.Message;
                 //    var body = Encoding.UTF8.GetBytes(message);
                 //    channel.BasicPublish("logs", "", null, body);

                 //}

                 var factory = new ConnectionFactory() { HostName = 
"localhost" };
                 using (var connection = factory.CreateConnection())
                 {
                     using (var channel = connection.CreateModel())
                     {
                         Message = ObjModel.Message;
                         channel.QueueDeclare("MessageQueue", true, 
false, false, null);
                         var body = 
Encoding.UTF8.GetBytes(ObjModel.Message);
                         //Save Message To dateBase

                         MessageService ObjMessageService = new 
MessageService();
                         int displayOrder = 
ObjMessageService.GetDisplayOrder();
                         if (displayOrder > 0)
                         {
                             int NewOrder = displayOrder + 1;
                             tblMessageDetail ObjTBL = new 
tblMessageDetail();
                             ObjTBL.Message = ObjModel.Message;
                             ObjTBL.Sent_Date = DateTime.Now;
                             ObjTBL.IsReceived = false;
                             ObjTBL.DisplayOrder = NewOrder;
                             int Result = 
ObjMessageService.SaveSentMessage(ObjTBL);
                             if (Result == 1)
                             {
                                 channel.BasicPublish("", 
"MessageQueue", null, body);
                             }
                         }

                     }
                 }
             }
             catch
             {
                 Message = "An Error has been occurred while sending 
messages.";
             }
             return Json(new { MSG = Message });
         }


and   Below message works for receive message::
      [HttpPost]
         public JsonResult RecieveMessage()
         {
             string Message = string.Empty;
             try
             {
                 //var factory = new ConnectionFactory() { HostName = 
"localhost" };
                 //using (var connection = factory.CreateConnection())
                 //{
                 //    using (var channel = connection.CreateModel())
                 //    {
                 //        channel.ExchangeDeclare("logs", "fanout");
                 //        var queueName = channel.QueueDeclare();
                 //        channel.QueueBind(queueName, "logs", "");
                 //        var consumer = new 
QueueingBasicConsumer(channel);
                 //        var ResultBody = 
channel.BasicConsume(queueName, true, consumer);
                 //        Message = 
Encoding.UTF8.GetString(ResultBody.ToArray()));
                 //    }
                 //}

                 var factory = new ConnectionFactory();
                 using (var connection = factory.CreateConnection())
                 {
                     using (var channel = connection.CreateModel())
                     {
                         channel.QueueDeclare("MessageQueue", true, 
false, false, null);
                         bool noAck = true;
                         BasicGetResult result = 
channel.BasicGet("MessageQueue", noAck);
                         if (result == null)
                         {
                             Message = "No Messages Found.";
                         }
                         else
                         {
                             IBasicProperties props = 
result.BasicProperties;
                             byte[] Body = result.Body;
                             Message = Encoding.Default.GetString(Body);
                         }
                     }
                 }
             }
             catch
             {
                 Message = "An Error has been occurred while receiving 
messages.";
             }
             return Json(new { MSG = Message });
         }

I have attached a  image of the page which can may be give you an Idea 
of the template that I have designed::
Actually the table just shows the sent messages which I save in databse 
when I click on send message button.








CaptureMessaging.PNG




---
This email is free from viruses and malware because avast! Antivirus protection is active.
http://www.avast.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 30775 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: CaptureMessaging.PNG
Type: image/png
Size: 30775 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment-0001.png>

From woodslee at 126.com  Wed Dec 11 07:14:15 2013
From: woodslee at 126.com (woodslee)
Date: Wed, 11 Dec 2013 15:14:15 +0800
Subject: [rabbitmq-discuss] Is there some method to setting how long a
	message is not acknowlegment will be requeued?
Message-ID: <DM__131211150610_13308055014@smtp.126.com>


Hi All:

I have a question about message acknowlegement.
Is there some method or parameters to setting how long a message is not acknowlegment will be
think of deliveried unsuccessful, and will be requeued and deliveried again?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/cca5ba75/attachment.html>

From michael.s.klishin at gmail.com  Wed Dec 11 08:00:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 Dec 2013 12:00:15 +0400
Subject: [rabbitmq-discuss] Is there some method to setting how long a
 message is not acknowlegment will be requeued?
In-Reply-To: <DM__131211150610_13308055014@smtp.126.com>
References: <DM__131211150610_13308055014@smtp.126.com>
Message-ID: <CAE3HoVTee5aO-s_LvuT_L-Sp1DVNA0TwdzbLRYHmT+0P49v8NQ@mail.gmail.com>

2013/12/11 woodslee <woodslee at 126.com>

> I have a question about message acknowlegement.
> Is there some method or parameters to setting how long a message is not
> acknowlegment will be
> think of deliveried unsuccessful, and will be requeued and deliveried
> again?
>

There is no.

You can have such a timeout in the app that consumes messages, though.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/333d3fce/attachment.html>

From woodslee at 126.com  Wed Dec 11 08:34:07 2013
From: woodslee at 126.com (woodslee)
Date: Wed, 11 Dec 2013 16:34:07 +0800
Subject: [rabbitmq-discuss] Is there some method to setting how long
	amessage is not acknowlegment will be requeued?
References: <DM__131211150610_13308055014@smtp.126.com>
 <CAE3HoVTee5aO-s_LvuT_L-Sp1DVNA0TwdzbLRYHmT+0P49v8NQ@mail.gmail.com>
Message-ID: <DM__131211163400_08208730675@smtp.feinno.com>

Hi MK:

Suppose that no connection interruption and the consumer connected to rabbitMQ 
for a very long time, and the consumer reply no aknowlegement of all the message it have got.
In this situation, rabbitMQ will keep all the message that have no acknowlegement in memory,
and the rabbitMQ server will be reached the watermark soon and blocking the message publishing,
Is this right?


----- Original Message ----- 
From: Michael Klishin 
To: Discussions about RabbitMQ 
Sent: 2013-12-11, 16:00:15
Subject: Re: [rabbitmq-discuss] Is there some method to setting how long amessage is not acknowlegment will be requeued?


2013/12/11 woodslee <woodslee at 126.com>

I have a question about message acknowlegement.
Is there some method or parameters to setting how long a message is not acknowlegment will be
think of deliveried unsuccessful, and will be requeued and deliveried again?

There is no.


You can have such a timeout in the app that consumes messages, though.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/24689adf/attachment.html>

From watson.timothy at gmail.com  Wed Dec 11 09:18:55 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 11 Dec 2013 09:18:55 +0000
Subject: [rabbitmq-discuss] rabbitmqctl stop hangs
In-Reply-To: <CECCDE5C.59227%ed.tyrrill@emc.com>
References: <CECCDE5C.59227%ed.tyrrill@emc.com>
Message-ID: <78349D35-543C-40EB-86B8-D37A4833FAB1@rabbitmq.com>

Thanks for the analysis Ed, this sounds like a bug - ill take a walk through the code this morning and confirm that. If the shovel is "stuck" trying to establish a connection, that might well be an explanation. It's surprising that the supervision tree (for shovel workers) doesn't handle this scenario, but it may need to be reconfigured to handle delayed startup or the workers may need to be re-worked to handle startup differently.

I'll post back when I've validated those issues and let you know what my findings are.

Cheers,
Tim

On 10 Dec 2013, at 23:40, "Tyrrill, Ed" <ed.tyrrill at emc.com> wrote:

> Hi Tim,
> 
> I realized I did not address all of your questions.
> 
> >  How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly.
> 
> I have one I server I left untouched that hung four days ago, and is still hung
> 
> > If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.
> 
> The destination of the shovel was down at the time so only the source side is relevant.  I noticed that the shutdown_log file has the time 13:46, with the message "Stopping and halting node 'rabbit at vm-ave29' ?", and shutdown_err is empty.  The "Halting Erlang VM" message in rabbit at vm-ave29.log is then coming five minutes later at 13:51.  The messages in rabbit at vm-ave29-sasl.log all seem related to shovel connect attempts.  Also note that the RabbitMQ erlang process is still running.
> 
> > We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?
> 
> Five durable queues.
> 
> Thanks,
> Ed
> 
> From: <Tyrrill>, Edward Tyrrill <ed.tyrrill at emc.com>
> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Date: Tuesday, December 10, 2013 10:48 AM
> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] rabbitmqctl stop hangs
> 
> Hi Tim,
> 
> Thanks for your quick response.  From the end of the log it looks like the shovel plugin was trying to establish the connection to the remote broker, which was down at the time, at the same time stop was run:
> 
> =ERROR REPORT==== 6-Dec-2013::13:51:36 ===
> ** Generic server <0.8762.19> terminating 
> ** Last message in was {'EXIT',<0.8759.19>,
>                            {{badmatch,{error,etimedout}},
>                             [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
>                              {rabbit_shovel_worker,handle_cast,2,[]},
>                              {gen_server2,handle_msg,2,[]},
>                              {proc_lib,init_p_do_apply,3,
>                                  [{file,"proc_lib.erl"},{line,239}]}]}}
> ** When Server state == {state,amqp_direct_connection,
>                          {state,'rabbit at vm-ave29',
>                           {user,<<"guest">>,
>                            [administrator],
>                            rabbit_auth_backend_internal,
>                            {internal_user,<<"guest">>,
>                             <<193,148,73,243,245,222,154,143,19,215,47,234,93,
>                               175,56,125,17,151,61,97>>,
>                             [administrator]}},
>                           <<"/">>,
>                           {amqp_params_direct,<<"guest">>,none,<<"/">>,
>                            'rabbit at vm-ave29',none,[]},
>                           {amqp_adapter_info,unknown,unknown,unknown,unknown,
>                            <<"<'rabbit at vm-ave29'.3.8762.19>">>,
>                            {'Direct',{0,9,1}},
>                            []},
>                           <0.8765.19>,undefined},
>                          <0.8764.19>,
>                          {amqp_params_direct,<<"guest">>,none,<<"/">>,
>                           'rabbit at vm-ave29',none,[]},
>                          0,
>                          [{<<"capabilities">>,table,
>                            [{<<"publisher_confirms">>,bool,true},
>                             {<<"exchange_exchange_bindings">>,bool,true},
>                             {<<"basic.nack">>,bool,true},
>                             {<<"consumer_cancel_notify">>,bool,true},
>                             {<<"connection.blocked">>,bool,true},
>                             {<<"consumer_priorities">>,bool,true},
>                             {<<"authentication_failure_close">>,bool,true}]},
>                           {<<"copyright">>,longstr,
>                            <<"Copyright (C) 2007-2013 GoPivotal, Inc.">>},
>                           {<<"information">>,longstr,
>                            <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>},
>                           {<<"platform">>,longstr,<<"Erlang/OTP">>},
>                           {<<"product">>,longstr,<<"RabbitMQ">>},
>                           {<<"version">>,longstr,<<"3.2.0">>}],
>                          none,false}
> ** Reason for termination == 
> ** {unexpected_msg,
>        {'EXIT',<0.8759.19>,
>            {{badmatch,{error,etimedout}},
>             [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
>              {rabbit_shovel_worker,handle_cast,2,[]},
>              {gen_server2,handle_msg,2,[]},
>              {proc_lib,init_p_do_apply,3,
>                  [{file,"proc_lib.erl"},{line,239}]}]}}}
> 
> =INFO REPORT==== 6-Dec-2013::13:51:36 ===
> stopped TCP Listener on 127.0.0.1:5672
> 
> =INFO REPORT==== 6-Dec-2013::13:51:36 ===
> Halting Erlang VM
> 
> 
> 
> 
> From: Tim Watson <tim at rabbitmq.com>
> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Date: Tuesday, December 10, 2013 1:49 AM
> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] rabbitmqctl stop hangs
> 
> There ought to be further information in the log files from the brokers in question during the stop operation. Can you post that, or put it somewhere accessible please? Why do you have both `rabbitmq-server stop' and `rabbitmqctl stop' running at the same time? Are those pointing to different rabbits? 
> 
> On 10 Dec 2013, at 01:32, Tyrrill, Ed wrote:
> 
>> Hi All,
>> 
>> We are using rabbitmq-server rpms on linux.  Recently we upgraded from 3.1.1-1 to 3.2.0-1, and we are seeing intermittent hangs when stopping rabbitmq.  Here is the ps output:
>> 
>> root     31052 31051  0 Dec06 ?        00:00:00 /bin/sh /sbin/service rabbitmq-server stop
>> root     31055 31052  0 Dec06 ?        00:00:00 /bin/sh /etc/init.d/rabbitmq-server stop
>> root     31100 31055  0 Dec06 ?        00:00:00 /bin/sh /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
>> root     31111 31100  0 Dec06 ?        00:00:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "stop" "/var/run/rabbitmq/pid"
>> rabbitmq 31112 31111  0 Dec06 ?        00:24:10 /usr/lib64/erlang/erts-5.10.3/bin/beam.smp -- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.0/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl31112 -boot start_clean -s rabbit_control_main -nodename rabbit at vm-ave29 -extra stop /var/run/rabbitmq/pid
>> 
>> The CPU time column on the erlang process does slowly go up.  I don't know if it plays a factor, but this broker has shovels defined to a remote broker, and the remote broker was down at the time of this stop.
>> 
> 
> How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly. If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.
> 
>> Is this a known issue?  We've been seeing this a couple times a week (over > 100 brokers), and I need to get a fix for this.
>> 
> 
> We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?
> 
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/9771d725/attachment.html>

From noel.mcgrath at gmail.com  Wed Dec 11 09:44:02 2013
From: noel.mcgrath at gmail.com (noel)
Date: Wed, 11 Dec 2013 01:44:02 -0800 (PST)
Subject: [rabbitmq-discuss] Logging configuration changes
Message-ID: <1386755041994-31963.post@n5.nabble.com>

Is it possible to see changes to configuration that occur on the broker e.g.
user1 deleted queue1? Im hoping RabbitMQ logs these changes somewhere?

I can see a log file created @ /var/log/rabbitmq/ but it only logs the
actions I take from the Admin tab in the browser UI via the
rabbitmq-management API e.g. create user. There is no log entries for adding
a queue when I do this

Looking for this, to monitoring changes occuring

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Logging-configuration-changes-tp31963.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Dec 11 10:12:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Dec 2013 10:12:41 +0000
Subject: [rabbitmq-discuss] shutdown log file time stamp
In-Reply-To: <1386707979432-31952.post@n5.nabble.com>
References: <1386707979432-31952.post@n5.nabble.com>
Message-ID: <52A83A99.2060108@rabbitmq.com>

On 10/12/13 20:39, Prabodh Upreti wrote:
> Just noticed that the shutdown log does not have a times stamp when the
> services is shutdown.  Is there a way display that time stamp?  Thank you in
> advance.

No.

Note that the shutdown log is just a capture of stdout from the command 
that shuts down the server - normally it should not contain anything 
interesting. You could check its timestamp though I think.

There *are* messages logged to the main log file when the server shuts 
down, and those have timestamps. In 2.8.4 these should say "Stopping 
Rabbit" when the shutdown commences, and "Halting Erlang VM" when 
shutdown is complete, both logged with INFO severity.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Dec 11 10:19:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Dec 2013 10:19:08 +0000
Subject: [rabbitmq-discuss] Recurring partitioning problem on local
	network
In-Reply-To: <25870F6AB6D0E34489AD94C19EA928DB01F2481C@OFLEXMB06P.centene.com>
References: <25870F6AB6D0E34489AD94C19EA928DB01F2232D@OFLEXMB06P.centene.com>
 <52A73B22.3060801@rabbitmq.com>
 <25870F6AB6D0E34489AD94C19EA928DB01F22E1F@OFLEXMB06P.centene.com>
 <52A74A90.2020508@rabbitmq.com>
 <25870F6AB6D0E34489AD94C19EA928DB01F2481C@OFLEXMB06P.centene.com>
Message-ID: <52A83C1C.5000605@rabbitmq.com>

On 11/12/13 03:19, Bill Chmura wrote:
> One of our sets went down today
>
> Both nodes basically have this, just naming the other node:
>
> =INFO REPORT==== 10-Dec-2013::18:29:24 ===
> rabbit on node 'rabbit at NURWEB-QAWEB01' down
>
> =ERROR REPORT==== 10-Dec-2013::18:29:35 ===
> Mnesia('rabbit at NURWEB-QAWEB02'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, 'rabbit at NURWEB-QAWEB01'}
>
> =INFO REPORT==== 10-Dec-2013::18:29:47 ===
> node 'rabbit at NURWEB-QAWEB01' down: connection_closed
>
> Not much more info with the patched base file... does this help at all?

Somewhat, yes. The interesting bit is the "connection_closed" part. This 
means that the net_ticktime-based timeout is not happening - something 
is closing the TCP connection between the two hosts. That would explain 
why it comes back again immediately.

Do you have some sort of firewall or other network infrastructure that 
could be forcible closing this connection?

> I tried searching and got a lot on connection closed abruptly... but it did not sound right.

No, that's a different thing: we log "connection closed abruptly" when 
AMQP connections go away without going through the AMQP close handshake.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From joshua__lim at hotmail.com  Wed Dec 11 10:26:07 2013
From: joshua__lim at hotmail.com (Joshua Lim)
Date: Wed, 11 Dec 2013 10:26:07 +0000
Subject: [rabbitmq-discuss] How to create a rabbitmq cluster using existing
 application without losing existing data?
Message-ID: <BLU176-W2953CD322AC2DEF9139C6CADDD0@phx.gbl>

Hi,
I'm trying to find out if it is possible to create a rabbitmq cluster for an existing production instance with data on it.  The reason is because I'm starting with only 1 server for the start and would like to expand to a 2 server cluster only in the future.  I'm currently using RabbitMQ 3.2.1 on Erlang R16B02 on Windows 7.
What I did is:
1. Issue rabbitmqctl stop_app, rabbitmqctl reset, rabbitmqctl stop on both nodes.2. Add auto-config to rabbitmq.config on both nodes:   {cluster_nodes, {['rabbit at existing-machine', 'rabbit at new-machine'], disc}}3. Start rabbitmq service on rabbit at new-machine followed by rabbit at existing-machine
After that, the cluster is successfully created, however, all existing data, e.g. virtual hosts, users, etc, is erased from the 2 nodes.
cluster_status result from new-machine:
C:\Program Files\RabbitMQ Server\rabbitmq_server-3.2.1\sbin>rabbitmqctl cluster_statusCluster status of node rabbit at new-machine ...[{nodes,[{disc,[rabbit at new-machine,rabbit at existing-machine]}]}, {running_nodes,[rabbit at existing-machine,rabbit at new-machine]}, {partitions,[]}]...done.
Rgds,Joshua 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/8716e401/attachment.html>

From simon at rabbitmq.com  Wed Dec 11 10:26:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Dec 2013 10:26:43 +0000
Subject: [rabbitmq-discuss] using rabbitmq with active directory without
 sending password.
In-Reply-To: <5364289F36AB9D48904552794BA271CA2897E6E93A@XC203447.MELINDA.LOCAL>
References: <5364289F36AB9D48904552794BA271CA2897E6E93A@XC203447.MELINDA.LOCAL>
Message-ID: <52A83DE3.6060300@rabbitmq.com>

I think you are asking for SSO integration with a logged in Windows 
user? I'm afraid RabbitMQ doesn't support that.

Cheers, Simon

On 10/12/13 19:12, gabriel.dausque at gdfsueztrading.com wrote:
> Hello,
>
> Because of new recommendation asked by our Security officer, we must add
> secure authentication to access rabbitmq.
>
> To do that, we are experiencing the usage of ldap plugin with a .Net
> client in front of it, but I I?m quite surprise to be forced to send the
> windows user password to the rabbitmq server in order for it to check
> the identity of the user  as it seems to be a very bad security practice
> to ask for the already authenticated user its password and reuse it, and
> also my security officer will not validate that kind of solution.
>
> Is there a way to only check that the user is already authenticated
> without explicit login/password using ldap authentication ?
>
> Best regards
>
> Gabriel DAUSQUE
>
> Expert SI Meteor FPR
>
> Tel : 01 56 65 66 68
>
> Mail : gabriel.dausque at gdfsueztrading.com
>
> ___________________________________________________________________
>
> This message (including any attachments) and its content are
> confidential, meant solely for the addressees.
> The views expressed in this message are those of its author and do not
> necessarily represent the opinion of GDF SUEZ Trading.
> If you are not the intended recipient please notify the sender
> immediately and destroy this e-mail.
> Any unauthorised copying, use, disclosure or distribution of the content
> of this e-mail is strictly forbidden.
> GDF SUEZ Trading shall not be liable for the message if altered, changed
> or falsified or computer virus contained.
> ___________________________________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Dec 11 10:32:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Dec 2013 10:32:00 +0000
Subject: [rabbitmq-discuss] How to create a rabbitmq cluster using
 existing application without losing existing data?
In-Reply-To: <BLU176-W2953CD322AC2DEF9139C6CADDD0@phx.gbl>
References: <BLU176-W2953CD322AC2DEF9139C6CADDD0@phx.gbl>
Message-ID: <52A83F20.1040003@rabbitmq.com>

On 11/12/13 10:26, Joshua Lim wrote:
> I'm trying to find out if it is possible to create a rabbitmq cluster
> for an existing production instance with data on it.

Yes.

> The reason is
> because I'm starting with only 1 server for the start and would like to
> expand to a 2 server cluster only in the future.

Which makes sense.

> What I did is:
>
> 1. Issue rabbitmqctl stop_app, rabbitmqctl reset, rabbitmqctl stop on
> both nodes.

rabbitmqctl reset is the culprit here - it will erase all information on 
the node.

> 2. Add auto-config to rabbitmq.config on both nodes:   {cluster_nodes,
> {['rabbit at existing-machine', 'rabbit at new-machine'], disc}}

Note that the auto-config lists nodes in an existing cluster that the 
machine should attempt to contact when coming up from a new installation 
(or post reset). And a standalone node is a cluster of size one.

So what you really wanted to do was:

* Not touch existing-machine
* Add {cluster_nodes, {['rabbit at existing-machine'], disc}} to new-machine
* Reset new-machine if you've previously used RabbitMQ on it
* Start new-machine

It should then join the existing machine.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Dec 11 10:33:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Dec 2013 10:33:51 +0000
Subject: [rabbitmq-discuss] Logging configuration changes
In-Reply-To: <1386755041994-31963.post@n5.nabble.com>
References: <1386755041994-31963.post@n5.nabble.com>
Message-ID: <52A83F8F.7020402@rabbitmq.com>

You can enable HTTP logging in the management plugin 
(http://www.rabbitmq.com/management.html#configuration); that will let 
you figure out what changes have been made via the HTTP API. But there's 
no general logging of object creation / deletion at the moment I'm afraid.

Cheers, Simon

On 11/12/13 09:44, noel wrote:
> Is it possible to see changes to configuration that occur on the broker e.g.
> user1 deleted queue1? Im hoping RabbitMQ logs these changes somewhere?
>
> I can see a log file created @ /var/log/rabbitmq/ but it only logs the
> actions I take from the Admin tab in the browser UI via the
> rabbitmq-management API e.g. create user. There is no log entries for adding
> a queue when I do this
>
> Looking for this, to monitoring changes occuring
>
> Thanks
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Logging-configuration-changes-tp31963.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From tim at rabbitmq.com  Wed Dec 11 10:52:06 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 11 Dec 2013 10:52:06 +0000
Subject: [rabbitmq-discuss] rabbitmqctl stop hangs
In-Reply-To: <78349D35-543C-40EB-86B8-D37A4833FAB1@rabbitmq.com>
References: <CECCDE5C.59227%ed.tyrrill@emc.com>
 <78349D35-543C-40EB-86B8-D37A4833FAB1@rabbitmq.com>
Message-ID: <A94A2A18-1F95-4E40-BCEA-584D68DE0734@rabbitmq.com>

Hi Ed,

If at all possible, would you please send as much of the logging information as possible? You can contact me offline about emailing/uploading it privately if you prefer, or simply scrub any private data from it before hand. I'm going to need to see more of the stack traces in the logs to diagnose this issue properly.

Thanks,
Tim

On 11 Dec 2013, at 09:18, Tim Watson wrote:

> Thanks for the analysis Ed, this sounds like a bug - ill take a walk through the code this morning and confirm that. If the shovel is "stuck" trying to establish a connection, that might well be an explanation. It's surprising that the supervision tree (for shovel workers) doesn't handle this scenario, but it may need to be reconfigured to handle delayed startup or the workers may need to be re-worked to handle startup differently.
> 
> I'll post back when I've validated those issues and let you know what my findings are.
> 
> Cheers,
> Tim
> 
> On 10 Dec 2013, at 23:40, "Tyrrill, Ed" <ed.tyrrill at emc.com> wrote:
> 
>> Hi Tim,
>> 
>> I realized I did not address all of your questions.
>> 
>> >  How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly.
>> 
>> I have one I server I left untouched that hung four days ago, and is still hung
>> 
>> > If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.
>> 
>> The destination of the shovel was down at the time so only the source side is relevant.  I noticed that the shutdown_log file has the time 13:46, with the message "Stopping and halting node 'rabbit at vm-ave29' ?", and shutdown_err is empty.  The "Halting Erlang VM" message in rabbit at vm-ave29.log is then coming five minutes later at 13:51.  The messages in rabbit at vm-ave29-sasl.log all seem related to shovel connect attempts.  Also note that the RabbitMQ erlang process is still running.
>> 
>> > We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?
>> 
>> Five durable queues.
>> 
>> Thanks,
>> Ed
>> 
>> From: <Tyrrill>, Edward Tyrrill <ed.tyrrill at emc.com>
>> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Date: Tuesday, December 10, 2013 10:48 AM
>> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Subject: Re: [rabbitmq-discuss] rabbitmqctl stop hangs
>> 
>> Hi Tim,
>> 
>> Thanks for your quick response.  From the end of the log it looks like the shovel plugin was trying to establish the connection to the remote broker, which was down at the time, at the same time stop was run:
>> 
>> =ERROR REPORT==== 6-Dec-2013::13:51:36 ===
>> ** Generic server <0.8762.19> terminating 
>> ** Last message in was {'EXIT',<0.8759.19>,
>>                            {{badmatch,{error,etimedout}},
>>                             [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
>>                              {rabbit_shovel_worker,handle_cast,2,[]},
>>                              {gen_server2,handle_msg,2,[]},
>>                              {proc_lib,init_p_do_apply,3,
>>                                  [{file,"proc_lib.erl"},{line,239}]}]}}
>> ** When Server state == {state,amqp_direct_connection,
>>                          {state,'rabbit at vm-ave29',
>>                           {user,<<"guest">>,
>>                            [administrator],
>>                            rabbit_auth_backend_internal,
>>                            {internal_user,<<"guest">>,
>>                             <<193,148,73,243,245,222,154,143,19,215,47,234,93,
>>                               175,56,125,17,151,61,97>>,
>>                             [administrator]}},
>>                           <<"/">>,
>>                           {amqp_params_direct,<<"guest">>,none,<<"/">>,
>>                            'rabbit at vm-ave29',none,[]},
>>                           {amqp_adapter_info,unknown,unknown,unknown,unknown,
>>                            <<"<'rabbit at vm-ave29'.3.8762.19>">>,
>>                            {'Direct',{0,9,1}},
>>                            []},
>>                           <0.8765.19>,undefined},
>>                          <0.8764.19>,
>>                          {amqp_params_direct,<<"guest">>,none,<<"/">>,
>>                           'rabbit at vm-ave29',none,[]},
>>                          0,
>>                          [{<<"capabilities">>,table,
>>                            [{<<"publisher_confirms">>,bool,true},
>>                             {<<"exchange_exchange_bindings">>,bool,true},
>>                             {<<"basic.nack">>,bool,true},
>>                             {<<"consumer_cancel_notify">>,bool,true},
>>                             {<<"connection.blocked">>,bool,true},
>>                             {<<"consumer_priorities">>,bool,true},
>>                             {<<"authentication_failure_close">>,bool,true}]},
>>                           {<<"copyright">>,longstr,
>>                            <<"Copyright (C) 2007-2013 GoPivotal, Inc.">>},
>>                           {<<"information">>,longstr,
>>                            <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>},
>>                           {<<"platform">>,longstr,<<"Erlang/OTP">>},
>>                           {<<"product">>,longstr,<<"RabbitMQ">>},
>>                           {<<"version">>,longstr,<<"3.2.0">>}],
>>                          none,false}
>> ** Reason for termination == 
>> ** {unexpected_msg,
>>        {'EXIT',<0.8759.19>,
>>            {{badmatch,{error,etimedout}},
>>             [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
>>              {rabbit_shovel_worker,handle_cast,2,[]},
>>              {gen_server2,handle_msg,2,[]},
>>              {proc_lib,init_p_do_apply,3,
>>                  [{file,"proc_lib.erl"},{line,239}]}]}}}
>> 
>> =INFO REPORT==== 6-Dec-2013::13:51:36 ===
>> stopped TCP Listener on 127.0.0.1:5672
>> 
>> =INFO REPORT==== 6-Dec-2013::13:51:36 ===
>> Halting Erlang VM
>> 
>> 
>> 
>> 
>> From: Tim Watson <tim at rabbitmq.com>
>> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Date: Tuesday, December 10, 2013 1:49 AM
>> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Subject: Re: [rabbitmq-discuss] rabbitmqctl stop hangs
>> 
>> There ought to be further information in the log files from the brokers in question during the stop operation. Can you post that, or put it somewhere accessible please? Why do you have both `rabbitmq-server stop' and `rabbitmqctl stop' running at the same time? Are those pointing to different rabbits? 
>> 
>> On 10 Dec 2013, at 01:32, Tyrrill, Ed wrote:
>> 
>>> Hi All,
>>> 
>>> We are using rabbitmq-server rpms on linux.  Recently we upgraded from 3.1.1-1 to 3.2.0-1, and we are seeing intermittent hangs when stopping rabbitmq.  Here is the ps output:
>>> 
>>> root     31052 31051  0 Dec06 ?        00:00:00 /bin/sh /sbin/service rabbitmq-server stop
>>> root     31055 31052  0 Dec06 ?        00:00:00 /bin/sh /etc/init.d/rabbitmq-server stop
>>> root     31100 31055  0 Dec06 ?        00:00:00 /bin/sh /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
>>> root     31111 31100  0 Dec06 ?        00:00:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "stop" "/var/run/rabbitmq/pid"
>>> rabbitmq 31112 31111  0 Dec06 ?        00:24:10 /usr/lib64/erlang/erts-5.10.3/bin/beam.smp -- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.0/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl31112 -boot start_clean -s rabbit_control_main -nodename rabbit at vm-ave29 -extra stop /var/run/rabbitmq/pid
>>> 
>>> The CPU time column on the erlang process does slowly go up.  I don't know if it plays a factor, but this broker has shovels defined to a remote broker, and the remote broker was down at the time of this stop.
>>> 
>> 
>> How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly. If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.
>> 
>>> Is this a known issue?  We've been seeing this a couple times a week (over > 100 brokers), and I need to get a fix for this.
>>> 
>> 
>> We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?
>> 
>> Tim
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/f3a826af/attachment.html>

From black.horizons at gmail.com  Tue Dec 10 19:01:18 2013
From: black.horizons at gmail.com (Alex McRoberts)
Date: Tue, 10 Dec 2013 11:01:18 -0800 (PST)
Subject: [rabbitmq-discuss] Typos on rabbitmq.com tutorials for PHP
Message-ID: <c66a7932-504d-47bf-88ff-ac15753da38c@googlegroups.com>

Hey Guys,

I've been reading the tutorials on using PHP with RabbitMQ. I think I've 
found a couple of typo's and I'd just like to clear them up with you.

The issues I've seen are on:

http://www.rabbitmq.com/tutorials/tutorial-two-php.html

1) "Message acknowledgments are turned on off" - I guess this should be 
"Message acknowledgments are turned on and off".
2) "It's time to turn them on by setting the second flag to basic_consume 
to false" - reading the method at 
https://github.com/videlalvaro/php-amqplib/blob/461961f962ab70c63adfb78215fb66123605da7e/PhpAmqpLib/Channel/AMQPChannel.php#L658 it 
seems that it's actually the fourth flag that needs set to false.

If anybody could clear these up that would be great 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/b3de3162/attachment.html>

From josh.carlson at kaazing.com  Tue Dec 10 19:36:19 2013
From: josh.carlson at kaazing.com (Josh Carlson)
Date: Tue, 10 Dec 2013 14:36:19 -0500
Subject: [rabbitmq-discuss] When using rabbitmq-jms
 javax.jms.Message.getJMSDestination does not return the actual destination
 when it is received from a consumer listening on a Topic with a wild card
In-Reply-To: <F246B1A6-0D8F-41BE-9A63-4BBC6A979738@rabbitmq.com>
References: <851fdb0f-10a7-4041-a297-983923b2e978@googlegroups.com>
 <F246B1A6-0D8F-41BE-9A63-4BBC6A979738@rabbitmq.com>
Message-ID: <52A76D33.1090909@kaazing.com>

Hi Steve,

I was wondering if this fix appears in the 1.1 client? It doesn't appear 
to be in the release notes 
https://www.vmware.com/support/vfabric-rabbitmq/doc/vfabric-rabbitmq-rn-3.2.html#resolvedissues-rjms

Thanks

Josh

On 09/18/2013 06:57 AM, Steve Powell wrote:
> Thanks Josh,
>
> This indeed appears to be a bug.  [I go to the trouble of serialising 
> and deserializing the destination and then overwrite it with the 
> Consumer?s destination before returning it!]
>
> I will raise an internal bug and should have this corrected in the 
> next release. Should you require further support this should be 
> requested through the usual vFabric channels.
>
> Steve Powell [/Cell/: +44-7815-838-558][RabbitMQ 
> <http://www.rabbitmq.com/>,//Pivotal <http://gopivotal.com/>]
> /?L?enfer, c?est les autres.? /Sartre
>
> On 17 Sep 2013, at 20:21, Josh Carlson <josh.carlson at kaazing.com 
> <mailto:josh.carlson at kaazing.com>> wrote:
>
>> When using rabbitmq-jms for vFabric RabbitMQ 
>> javax.jms.Message.getJMSDestination does not return the actual 
>> destination when it is received from a consumer listening on a Topic 
>> with a wild card. I have tested with both 1.0.3 and 1.0.5 clients 
>> with RabbitMQ 3.1.5.
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/5fda9a82/attachment.html>

From jkraaijeveld at justin.tv  Tue Dec 10 19:50:57 2013
From: jkraaijeveld at justin.tv (Jos Kraaijeveld)
Date: Tue, 10 Dec 2013 11:50:57 -0800 (PST)
Subject: [rabbitmq-discuss] Counting messages dropped because of expired TTL
Message-ID: <72bee647-56cf-420d-a868-de6a061ce5f4@googlegroups.com>

Hi there, 

We recently ran into a situation where we have more message than we can 
process, so I want to temporarily drop certain unimportant messages. This 
will be using a per-message TTL. I was wondering whether it was possible to 
see how many messages are actually dropped because their TTL has expired by 
the time they end up at the front of the queue. Is this information tracked 
and obtainable by Rabbit, or would I have to resort to a DLX-approach and 
process those dead messages manually?

Thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/2d50f28c/attachment.html>

From rashim.anand at hds.com  Tue Dec 10 22:49:58 2013
From: rashim.anand at hds.com (Rashim Anand)
Date: Tue, 10 Dec 2013 22:49:58 +0000
Subject: [rabbitmq-discuss] Periodic SSL connection timeouts
In-Reply-To: <52A1994D.9010907@rabbitmq.com>
References: <B72607244032BD4489DBA663C1FD87EF7F704AFD@USINDEM103.corp.hds.com>
 <52A1994D.9010907@rabbitmq.com>
Message-ID: <B72607244032BD4489DBA663C1FD87EF7F7056AB@USINDEM103.corp.hds.com>

Hi Emile,

Thanks for your response.

There are no other events that occur at the same frequency or during the error.

Most of the time, the SSL connections succeed. So I am not sure if SSL trouble shooting is even required. Also its very hard to run a bunch of manual commands at the exact time of the failure.

Can we increase the Rabbit MQ logging level to get more information in the logs? Is there anything else we can do to get more information?

Regards,
Rashim Anand


-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Friday, December 06, 2013 1:31 AM
To: Discussions about RabbitMQ
Cc: Rashim Anand
Subject: Re: [rabbitmq-discuss] Periodic SSL connection timeouts


Hi,

On 05/12/13 20:26, Rashim Anand wrote:

> We are facing periodic SSL connection timeout issues. Every 20-30 
> minutes we see Rabbit MQ SSL connection errors.


> =ERROR REPORT==== 27-Nov-2013::20:22:18 ===
> 
> error on AMQP connection <0.12608.35>: {ssl_upgrade_error,timeout} 
> (unknown POSIX error)

This is not enough information to diagnose the problem. Are there any other events in your environment that occur at the same frequency as the error? Can you replicate this problem using any of the methods described in the SSL troubleshooting tips?

http://www.rabbitmq.com/troubleshooting-ssl.html




-Emile

From Nire.Gales at Hostelbookers.com  Wed Dec 11 07:58:33 2013
From: Nire.Gales at Hostelbookers.com (Nire Gales)
Date: Wed, 11 Dec 2013 07:58:33 +0000
Subject: [rabbitmq-discuss] Rabbit MQ service logs
Message-ID: <67D7E8F8A744D743BDF9FF81388B190A67498E8E@SIDESWIPE.HostelBookers.net>

Hi
The services stop communicating to queues regardless of their status on Rabbit MQ.
I've looked through the windows error logs, and it seems everything is fine on that end, so I was wondering if maybe the Rabbit MQ logs could help
How can I find the Rabbit MQlogs for the last 24 hours?
Regards
Nir?


Nir? Gales
Infrastructure Engineer
Web Reservations International Group


Telephone: +44 (0)20 7025 2360 | Fax: +44 (0)20 7406 1801 | Email: Nire.Gales at Hostelbookers.com<mailto:Nire.Gales at Hostelbookers.com>


52-54 High Holborn, London, WC1V 6RL, UK


Registered Company: Hostelbookers.com Ltd., 2841908 England. Hostelbookers.com Ltd. is a subsidiary company of the Web Reservations International Group.


[www.hostelworld.com]<http://www.hostelworld.com/>[www.hostelbookers.com]<http://www.hostelbookers.com/>[www.hostels.com]<http://www.hostels.com/>[www.bedandbreakfastworld.com]<http://www.bedandbreakfastworld.com/>





________________________________

This email is from Hostelbookers.com Limited. Registered office: 52-54 High Holborn, London, WC1V 6RL, UK. Registered in England under Company No.: 2841908. This email and any files transmitted with it are confidential and may be privileged and are intended solely for the use of the individual or entity to whom they are addressed. As email can be subject to operational or technical difficulties and time delays, communications that are subject to deadlines should also be sent by post. Any unauthorised direct or indirect dissemination, distribution or copying of this message and any attachments is strictly prohibited. If you have received the email in error, please notify postmaster at hostelbookers.com

________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/2fb1c9cc/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1391 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/2fb1c9cc/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.gif
Type: image/gif
Size: 2194 bytes
Desc: image002.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/2fb1c9cc/attachment-0001.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.gif
Type: image/gif
Size: 1320 bytes
Desc: image003.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/2fb1c9cc/attachment-0002.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.gif
Type: image/gif
Size: 1291 bytes
Desc: image004.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/2fb1c9cc/attachment-0003.gif>

From lishulin at feinno.com  Wed Dec 11 08:24:40 2013
From: lishulin at feinno.com (lishulin)
Date: Wed, 11 Dec 2013 16:24:40 +0800
Subject: [rabbitmq-discuss] Is there some method to setting how long
	amessage is not acknowlegment will be requeued?
References: <DM__131211150610_13308055014@smtp.126.com>
 <CAE3HoVTee5aO-s_LvuT_L-Sp1DVNA0TwdzbLRYHmT+0P49v8NQ@mail.gmail.com>
Message-ID: <DM__131211161157_29785861730@smtp.feinno.com>

Hi MK:

Suppose that no connection interruption and the consumer connected to rabbitMQ 
for a very long time, and the consumer reply no aknowlegement of all the message it have got.
In this situation, rabbitMQ will keep all the message that have no acknowlegement in memory,
and the rabbitMQ server will be reached the watermark soon and blocking the message publishing,
Is this right?


----- Original Message ----- 
From: Michael Klishin 
To: Discussions about RabbitMQ 
Sent: 2013-12-11, 16:00:15
Subject: Re: [rabbitmq-discuss] Is there some method to setting how long amessage is not acknowlegment will be requeued?


2013/12/11 woodslee <woodslee at 126.com>

I have a question about message acknowlegement.
Is there some method or parameters to setting how long a message is not acknowlegment will be
think of deliveried unsuccessful, and will be requeued and deliveried again?

There is no.


You can have such a timeout in the app that consumes messages, though.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/b7bb911b/attachment.html>

From raj.kumar.sanpui at gmail.com  Wed Dec 11 10:52:59 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Wed, 11 Dec 2013 02:52:59 -0800 (PST)
Subject: [rabbitmq-discuss] How can a consumer get notification of arrival
 of a message in the queue?
Message-ID: <1386759179369-31970.post@n5.nabble.com>

I have written a client program using rabbitmq C library. But i wish to know,
how do the consumer program know if a message has arrived in the queue? It
can arrive at any point of time, or might not.

I understand for Java, there is a subscription mechanism:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011103.html

But how about C/C++?

Please help.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-can-a-consumer-get-notification-of-arrival-of-a-message-in-the-queue-tp31970.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Dec 11 11:05:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Dec 2013 11:05:28 +0000
Subject: [rabbitmq-discuss] Network partition detected,
 did not recover gracefully even though cluster_partition_handling =
 autoheal
In-Reply-To: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>
References: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>
Message-ID: <52A846F8.908@rabbitmq.com>

On 10/12/13 18:17, Nicholas Stuart wrote:
> I'm not sure why it failed, but I did have some network failure
> indicated in other systems, so I assume it was that. My issue is that
> the network never tried to rescue itself afterwards, even though in my
> rabbitmq.conf I have cluster_partition_handling set to autoheal. It is
> my understanding that setting it to autoheal will cause the nodes to fix
> its network partition, is this assumption incorrect?

It should do - the cluster should pick some nodes to restart and restart 
them, healing the partition.

Do you have any log messages beginning "Autoheal"?

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Wed Dec 11 11:12:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 Dec 2013 15:12:15 +0400
Subject: [rabbitmq-discuss] Counting messages dropped because of expired
	TTL
In-Reply-To: <72bee647-56cf-420d-a868-de6a061ce5f4@googlegroups.com>
References: <72bee647-56cf-420d-a868-de6a061ce5f4@googlegroups.com>
Message-ID: <CAE3HoVS9GMJTUBgqbtEosoYef4VK7Uy+W-TvzLSsGT1AkdUPWQ@mail.gmail.com>

2013/12/10 Jos Kraaijeveld <jkraaijeveld at justin.tv>

> Is this information tracked and obtainable by Rabbit, or would I have to
> resort to a DLX-approach and process those dead messages manually?


Jos,

Rabbit itself does not currently track message deletion rates.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/910de0a9/attachment.html>

From simon at rabbitmq.com  Wed Dec 11 11:12:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Dec 2013 11:12:46 +0000
Subject: [rabbitmq-discuss] Rabbit MQ service logs
In-Reply-To: <67D7E8F8A744D743BDF9FF81388B190A67498E8E@SIDESWIPE.HostelBookers.net>
References: <67D7E8F8A744D743BDF9FF81388B190A67498E8E@SIDESWIPE.HostelBookers.net>
Message-ID: <52A848AE.3040902@rabbitmq.com>

See http://www.rabbitmq.com/relocate.html for default locations of 
things. In particular, logs on Windows default to %APPDATA%\RabbitMQ\log.

Cheers, Simon

On 11/12/13 07:58, Nire Gales wrote:
> Hi
>
> The services stop communicating to queues regardless of their status on
> Rabbit MQ.
>
> I?ve looked through the windows error logs, and it seems everything is
> fine on that end, so I was wondering if maybe the Rabbit MQ logs could help
>
> How can I find the Rabbit MQlogs for the last 24 hours?
>
> Regards
>
> Nir?
>
> *Nir? Gales*
>
> Infrastructure Engineer
>
> Web Reservations International Group
>
> *Telephone: *+44 (0)20 7025 2360| *Fax: *+44 (0)20 7406 1801| *Email:
> *Nire.Gales at Hostelbookers.com <mailto:Nire.Gales at Hostelbookers.com>
>
> /52-54 High Holborn, London, WC1V 6RL, UK/
>
> /Registered Company: Hostelbookers.com Ltd., 2841908 England.
> Hostelbookers.com Ltd. is a subsidiary company of the Web Reservations
> International Group./
>
> www.hostelworld.com <http://www.hostelworld.com/>www.hostelbookers.com
> <http://www.hostelbookers.com/>www.hostels.com
> <http://www.hostels.com/>www.bedandbreakfastworld.com
> <http://www.bedandbreakfastworld.com/>
>
>
>
>
> ------------------------------------------------------------------------
>
> This email is from Hostelbookers.com Limited. Registered office: 52-54
> High Holborn, London, WC1V 6RL, UK. Registered in England under Company
> No.: 2841908. This email and any files transmitted with it are
> confidential and may be privileged and are intended solely for the use
> of the individual or entity to whom they are addressed. As email can be
> subject to operational or technical difficulties and time delays,
> communications that are subject to deadlines should also be sent by
> post. Any unauthorised direct or indirect dissemination, distribution or
> copying of this message and any attachments is strictly prohibited. If
> you have received the email in error, please notify
> postmaster at hostelbookers.com
>
> ------------------------------------------------------------------------
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Wed Dec 11 11:12:58 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 Dec 2013 15:12:58 +0400
Subject: [rabbitmq-discuss] Typos on rabbitmq.com tutorials for PHP
In-Reply-To: <c66a7932-504d-47bf-88ff-ac15753da38c@googlegroups.com>
References: <c66a7932-504d-47bf-88ff-ac15753da38c@googlegroups.com>
Message-ID: <CAE3HoVTP=PSwbnsX+DtcvyMyqZ_KpRfbMpWV+KK18+fu-=-C8g@mail.gmail.com>

2013/12/10 Alex McRoberts <black.horizons at gmail.com>

> If anybody could clear these up that would be great


Thanks for the report Alex, we will fix those some time soon.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/545a9613/attachment.html>

From michael.s.klishin at gmail.com  Wed Dec 11 11:14:41 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 Dec 2013 15:14:41 +0400
Subject: [rabbitmq-discuss] Rabbit MQ service logs
In-Reply-To: <67D7E8F8A744D743BDF9FF81388B190A67498E8E@SIDESWIPE.HostelBookers.net>
References: <67D7E8F8A744D743BDF9FF81388B190A67498E8E@SIDESWIPE.HostelBookers.net>
Message-ID: <CAE3HoVT17SoNeCSefoSBDGA-Z7bzcuWt9XPx5OgTKy0bckoJiA@mail.gmail.com>

2013/12/11 Nire Gales <Nire.Gales at hostelbookers.com>

> The services stop communicating to queues regardless of their status on
> Rabbit MQ.
>
> I?ve looked through the windows error logs, and it seems everything is
> fine on that end, so I was wondering if maybe the Rabbit MQ logs could help
>

This can be a connection interruption issue. Do your services handle and
recover from those?


>  How can I find the Rabbit MQlogs for the last 24 hours?
>

See http://rabbitmq.com/relocate.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/5d67f723/attachment.html>

From simon at rabbitmq.com  Wed Dec 11 11:17:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Dec 2013 11:17:49 +0000
Subject: [rabbitmq-discuss] Rabbit MQ service logs
In-Reply-To: <67D7E8F8A744D743BDF9FF81388B190A67499129@SIDESWIPE.HostelBookers.net>
References: <67D7E8F8A744D743BDF9FF81388B190A67498E8E@SIDESWIPE.HostelBookers.net>
 <52A848AE.3040902@rabbitmq.com>
 <67D7E8F8A744D743BDF9FF81388B190A67499129@SIDESWIPE.HostelBookers.net>
Message-ID: <52A849DD.6010909@rabbitmq.com>

Please keep rabbitmq-discuss in the discussion.

As the link I posted suggests, /var/log/rabbitmq is the default location 
for our Linux packages (.deb and .rpm). It depends on the installation 
method though.

Cheers, Simon

On 11/12/13 11:16, Nire Gales wrote:
> Hi Simon
>
> I need to find the logs on our linux servers eg: somewhere like cd var/log/rabbitmq
>
> Can you help me with that please.
>
> Nir?
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 11 December 2013 11:13
> To: Discussions about RabbitMQ
> Cc: Nire Gales
> Subject: Re: [rabbitmq-discuss] Rabbit MQ service logs
>
> See http://www.rabbitmq.com/relocate.html for default locations of things. In particular, logs on Windows default to %APPDATA%\RabbitMQ\log.
>
> Cheers, Simon
>
> On 11/12/13 07:58, Nire Gales wrote:
>> Hi
>>
>> The services stop communicating to queues regardless of their status
>> on Rabbit MQ.
>>
>> I've looked through the windows error logs, and it seems everything is
>> fine on that end, so I was wondering if maybe the Rabbit MQ logs could
>> help
>>
>> How can I find the Rabbit MQlogs for the last 24 hours?
>>
>> Regards
>>
>> Nir?
>>
>> *Nir? Gales*
>>
>> Infrastructure Engineer
>>
>> Web Reservations International Group
>>
>> *Telephone: *+44 (0)20 7025 2360| *Fax: *+44 (0)20 7406 1801| *Email:
>> *Nire.Gales at Hostelbookers.com <mailto:Nire.Gales at Hostelbookers.com>
>>
>> /52-54 High Holborn, London, WC1V 6RL, UK/
>>
>> /Registered Company: Hostelbookers.com Ltd., 2841908 England.
>> Hostelbookers.com Ltd. is a subsidiary company of the Web Reservations
>> International Group./
>>
>> www.hostelworld.com <http://www.hostelworld.com/>www.hostelbookers.com
>> <http://www.hostelbookers.com/>www.hostels.com
>> <http://www.hostels.com/>www.bedandbreakfastworld.com
>> <http://www.bedandbreakfastworld.com/>
>>
>>
>>
>>
>> ----------------------------------------------------------------------
>> --
>>
>> This email is from Hostelbookers.com Limited. Registered office: 52-54
>> High Holborn, London, WC1V 6RL, UK. Registered in England under
>> Company
>> No.: 2841908. This email and any files transmitted with it are
>> confidential and may be privileged and are intended solely for the use
>> of the individual or entity to whom they are addressed. As email can
>> be subject to operational or technical difficulties and time delays,
>> communications that are subject to deadlines should also be sent by
>> post. Any unauthorised direct or indirect dissemination, distribution
>> or copying of this message and any attachments is strictly prohibited.
>> If you have received the email in error, please notify
>> postmaster at hostelbookers.com
>>
>> ----------------------------------------------------------------------
>> --
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> ________________________________
>
> This email is from Hostelbookers.com Limited. Registered office: 52-54 High Holborn, London, WC1V 6RL, UK. Registered in England under Company No.: 2841908. This email and any files transmitted with it are confidential and may be privileged and are intended solely for the use of the individual or entity to whom they are addressed. As email can be subject to operational or technical difficulties and time delays, communications that are subject to deadlines should also be sent by post. Any unauthorised direct or indirect dissemination, distribution or copying of this message and any attachments is strictly prohibited. If you have received the email in error, please notify postmaster at hostelbookers.com
>
> ________________________________
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Wed Dec 11 11:16:32 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 Dec 2013 15:16:32 +0400
Subject: [rabbitmq-discuss] Is there some method to setting how long
 amessage is not acknowlegment will be requeued?
In-Reply-To: <DM__131211161157_29785861730@smtp.feinno.com>
References: <DM__131211150610_13308055014@smtp.126.com>
 <CAE3HoVTee5aO-s_LvuT_L-Sp1DVNA0TwdzbLRYHmT+0P49v8NQ@mail.gmail.com>
 <DM__131211161157_29785861730@smtp.feinno.com>
Message-ID: <CAE3HoVT=DJhNKmJZ=OB2xaSsa2ZXC+KN7cqez2sh=P7CZQf=iQ@mail.gmail.com>

2013/12/11 lishulin <lishulin at feinno.com>

> Suppose that no connection interruption and the consumer connected to
> rabbitMQ
> for a very long time, and the consumer reply no aknowlegement of all the
> message it have got.
> In this situation, rabbitMQ will keep all the message that have no
> acknowlegement in memory,
> and the rabbitMQ server will be reached the watermark soon and blocking
> the message publishing,
> Is this right?
>

Acknowledgement tracking does use some RAM but it would take quite a few
unacknowledged messages
for them to surpass the high VM memory watermark.

Of course, it depends on how much RAM RabbitMQ is allowed to use in the
first place.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/9ae3ea7b/attachment.html>

From videlalvaro at gmail.com  Wed Dec 11 11:48:57 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Dec 2013 11:48:57 +0000
Subject: [rabbitmq-discuss] Typos on rabbitmq.com tutorials for PHP
In-Reply-To: <CAE3HoVTP=PSwbnsX+DtcvyMyqZ_KpRfbMpWV+KK18+fu-=-C8g@mail.gmail.com>
References: <c66a7932-504d-47bf-88ff-ac15753da38c@googlegroups.com>
 <CAE3HoVTP=PSwbnsX+DtcvyMyqZ_KpRfbMpWV+KK18+fu-=-C8g@mail.gmail.com>
Message-ID: <CAMcAHLUyJd6N1GnpOBFaLFH0v9Wr0Khg2UYftY+u4-HxNPu0SA@mail.gmail.com>

Hi Alexander,

The first one is certainly a typo. In the other one ?second flag?
refers to ?second boolean value?, which is is indeed the fourth
parameter.

I'll take care of these typos. Thanks for reporting them.

Regards,

Alvaro


On Wed, Dec 11, 2013 at 11:12 AM, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
>
> 2013/12/10 Alex McRoberts <black.horizons at gmail.com>
>>
>> If anybody could clear these up that would be great
>
>
> Thanks for the report Alex, we will fix those some time soon.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From emile at rabbitmq.com  Wed Dec 11 12:03:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Dec 2013 12:03:47 +0000
Subject: [rabbitmq-discuss] RabbitMq[Functionality with multiple users]
In-Reply-To: <52A804F9.8000900@kindlebit.com>
References: <52A804F9.8000900@kindlebit.com>
Message-ID: <52A854A3.1070308@rabbitmq.com>


Hi

I think the solution you need is to consume messages asynchronously.
Have the messages delivered to the consumer as they become available,
rather than request messages from the queue one-at-a-time. This way
messages will be available for rendering or processing immediately.

The 3rd tutorial explains how to do this:
http://www.rabbitmq.com/tutorials/tutorial-three-java.html

On 11/12/13 06:23, Sukhjeet wrote:
> I need to send the message to that user. I am using a very basic code
> given on Rabbit-mq web site but I am not getting an idea on how
> rabbit-mq will server this.As for now I when I click on send message
> , a message is stored in the queue and then when I click on recieve
> message button on same page, the particular message is shown.


> BasicGetResult result = channel.BasicGet("MessageQueue", noAck);

Use BasicConsume instead of BasicGet here.




-Emil;e



From mklishin at gopivotal.com  Wed Dec 11 12:54:16 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 11 Dec 2013 16:54:16 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.0.6 is released
Message-ID: <1434522C-8299-489A-918B-BC134DC9A244@gopivotal.com>

Bunny 1.0.6 [1] is released.

This is a bug fix release. Release notes:
http://blog.rubyrabbitmq.info/blog/2013/12/11/bunny-1-dot-0-6-is-released/

1. https://rubygems.org/gems/bunny/versions/1.0.6
--
MK

Software Engineer, Pivotal/RabbitMQ

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/508a2787/attachment.sig>

From mklishin at gopivotal.com  Wed Dec 11 13:36:04 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 11 Dec 2013 17:36:04 +0400
Subject: [rabbitmq-discuss] |Spam| Re: Is there some method to setting
	how long	amessage is not acknowlegment will be requeued?
In-Reply-To: <DM__131211163400_08208730675@smtp.feinno.com>
References: <DM__131211150610_13308055014@smtp.126.com>
 <CAE3HoVTee5aO-s_LvuT_L-Sp1DVNA0TwdzbLRYHmT+0P49v8NQ@mail.gmail.com>
 <DM__131211163400_08208730675@smtp.feinno.com>
Message-ID: <CCE4C743-B538-4C4C-B1C9-31667984D9DF@rabbitmq.com>

On 11 Dec 2013, at 12:34, woodslee <woodslee at 126.com> wrote:

> Suppose that no connection interruption and the consumer connected to rabbitMQ
> for a very long time, and the consumer reply no aknowlegement of all the message it have got.
> In this situation, rabbitMQ will keep all the message that have no acknowlegement in memory,
> and the rabbitMQ server will be reached the watermark soon and blocking the message publishing,
> Is this right?

Are you saying that connection goes down before an ack is received? In such case, the message
will be re-queued.

MK

Software Engineer, Pivotal/RabbitMQ



From Nire.Gales at Hostelbookers.com  Wed Dec 11 11:38:31 2013
From: Nire.Gales at Hostelbookers.com (Nire Gales)
Date: Wed, 11 Dec 2013 11:38:31 +0000
Subject: [rabbitmq-discuss] Rabbit MQ service logs
In-Reply-To: <52A849DD.6010909@rabbitmq.com>
References: <67D7E8F8A744D743BDF9FF81388B190A67498E8E@SIDESWIPE.HostelBookers.net>
 <52A848AE.3040902@rabbitmq.com>
 <67D7E8F8A744D743BDF9FF81388B190A67499129@SIDESWIPE.HostelBookers.net>
 <52A849DD.6010909@rabbitmq.com>
Message-ID: <67D7E8F8A744D743BDF9FF81388B190A6749913F@SIDESWIPE.HostelBookers.net>

Hi

I can find the file however I cannot see the data I need.

For example I would like to see what happened in the past 24 hours; however I can only see data from the past week

Nir?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 11 December 2013 11:18
To: Nire Gales
Cc: rabbitmq-discuss
Subject: Re: [rabbitmq-discuss] Rabbit MQ service logs

Please keep rabbitmq-discuss in the discussion.

As the link I posted suggests, /var/log/rabbitmq is the default location for our Linux packages (.deb and .rpm). It depends on the installation method though.

Cheers, Simon

On 11/12/13 11:16, Nire Gales wrote:
> Hi Simon
>
> I need to find the logs on our linux servers eg: somewhere like cd
> var/log/rabbitmq
>
> Can you help me with that please.
>
> Nir?
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 11 December 2013 11:13
> To: Discussions about RabbitMQ
> Cc: Nire Gales
> Subject: Re: [rabbitmq-discuss] Rabbit MQ service logs
>
> See http://www.rabbitmq.com/relocate.html for default locations of things. In particular, logs on Windows default to %APPDATA%\RabbitMQ\log.
>
> Cheers, Simon
>
> On 11/12/13 07:58, Nire Gales wrote:
>> Hi
>>
>> The services stop communicating to queues regardless of their status
>> on Rabbit MQ.
>>
>> I've looked through the windows error logs, and it seems everything
>> is fine on that end, so I was wondering if maybe the Rabbit MQ logs
>> could help
>>
>> How can I find the Rabbit MQlogs for the last 24 hours?
>>
>> Regards
>>
>> Nir?
>>
>> *Nir? Gales*
>>
>> Infrastructure Engineer
>>
>> Web Reservations International Group
>>
>> *Telephone: *+44 (0)20 7025 2360| *Fax: *+44 (0)20 7406 1801| *Email:
>> *Nire.Gales at Hostelbookers.com <mailto:Nire.Gales at Hostelbookers.com>
>>
>> /52-54 High Holborn, London, WC1V 6RL, UK/
>>
>> /Registered Company: Hostelbookers.com Ltd., 2841908 England.
>> Hostelbookers.com Ltd. is a subsidiary company of the Web
>> Reservations International Group./
>>
>> www.hostelworld.com
>> <http://www.hostelworld.com/>www.hostelbookers.com
>> <http://www.hostelbookers.com/>www.hostels.com
>> <http://www.hostels.com/>www.bedandbreakfastworld.com
>> <http://www.bedandbreakfastworld.com/>
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> -
>> --
>>
>> This email is from Hostelbookers.com Limited. Registered office:
>> 52-54 High Holborn, London, WC1V 6RL, UK. Registered in England under
>> Company
>> No.: 2841908. This email and any files transmitted with it are
>> confidential and may be privileged and are intended solely for the
>> use of the individual or entity to whom they are addressed. As email
>> can be subject to operational or technical difficulties and time
>> delays, communications that are subject to deadlines should also be
>> sent by post. Any unauthorised direct or indirect dissemination,
>> distribution or copying of this message and any attachments is strictly prohibited.
>> If you have received the email in error, please notify
>> postmaster at hostelbookers.com
>>
>> ---------------------------------------------------------------------
>> -
>> --
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> ________________________________
>
> This email is from Hostelbookers.com Limited. Registered office: 52-54
> High Holborn, London, WC1V 6RL, UK. Registered in England under
> Company No.: 2841908. This email and any files transmitted with it are
> confidential and may be privileged and are intended solely for the use
> of the individual or entity to whom they are addressed. As email can
> be subject to operational or technical difficulties and time delays,
> communications that are subject to deadlines should also be sent by
> post. Any unauthorised direct or indirect dissemination, distribution
> or copying of this message and any attachments is strictly prohibited.
> If you have received the email in error, please notify
> postmaster at hostelbookers.com
>
> ________________________________
>


--
Simon MacMullen
RabbitMQ, Pivotal
________________________________

This email is from Hostelbookers.com Limited. Registered office: 52-54 High Holborn, London, WC1V 6RL, UK. Registered in England under Company No.: 2841908. This email and any files transmitted with it are confidential and may be privileged and are intended solely for the use of the individual or entity to whom they are addressed. As email can be subject to operational or technical difficulties and time delays, communications that are subject to deadlines should also be sent by post. Any unauthorised direct or indirect dissemination, distribution or copying of this message and any attachments is strictly prohibited. If you have received the email in error, please notify postmaster at hostelbookers.com

________________________________

From JHoge at bn.com  Wed Dec 11 14:33:20 2013
From: JHoge at bn.com (John Hoge)
Date: Wed, 11 Dec 2013 09:33:20 -0500
Subject: [rabbitmq-discuss] AMPQ - WAM - Win XP?
In-Reply-To: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0B16@WCEXCPMS01.hq.bn-corp.com>

Hi,

Does anyone have any suggestions to run RABBITMQ/AMPQ in WAMP on Windows?

I can't get the ampq PHP module to run in WAMP on my Win. XP machine.
I'll manually installed the .dll in WAMP ext folder as several posts recommend but I still get this error starting WAMP: 
PHP Startup: Unable to load dynamic library 'F:/wamp/bin/php/php5.4.3/ext/php_amqp.dll' - The specified module could not be found. 

And the PHP page errors out with 
Fatal error: Class 'PhpAmqpLib\Connection\AMQPConnection' not found in C:\wamp\www\php_sandbox\rabbetmq_send.php on line 12

Any ideas would help.

thanks so much,
John
-------------------------------------------------------------------------
This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
only for the use of the addressee(s) named herein.  If you are not an intended recipient,
please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
the message completely from your computer system.

From videlalvaro at gmail.com  Wed Dec 11 14:48:43 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Dec 2013 14:48:43 +0000
Subject: [rabbitmq-discuss] AMPQ - WAM - Win XP?
In-Reply-To: <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0B16@WCEXCPMS01.hq.bn-corp.com>
References: <mailman.1.1386158402.8293.rabbitmq-discuss@lists.rabbitmq.com>
 <2F6B2A1CD0466A4F8DC1F021C4AC865F021A9C0B16@WCEXCPMS01.hq.bn-corp.com>
Message-ID: <CAMcAHLVV_hQqDKzwRMfmP9k=hRmKsyvzOQyZ-CaYaqDx7B4nqA@mail.gmail.com>

Hi,

I haven't used PHP on windows for a while.

I'd check a) the PHP AMQP build works with your version of PHP, b) the
path where you copied the .dll is the right one on the php.ini

Apart from that maybe try asking on the library's github page, or see
if http://github.com/videlalvaro/php-amqplib works for you.

Regards,

Alvaro

On Wed, Dec 11, 2013 at 2:33 PM, John Hoge <JHoge at bn.com> wrote:
> Hi,
>
> Does anyone have any suggestions to run RABBITMQ/AMPQ in WAMP on Windows?
>
> I can't get the ampq PHP module to run in WAMP on my Win. XP machine.
> I'll manually installed the .dll in WAMP ext folder as several posts recommend but I still get this error starting WAMP:
> PHP Startup: Unable to load dynamic library 'F:/wamp/bin/php/php5.4.3/ext/php_amqp.dll' - The specified module could not be found.
>
> And the PHP page errors out with
> Fatal error: Class 'PhpAmqpLib\Connection\AMQPConnection' not found in C:\wamp\www\php_sandbox\rabbetmq_send.php on line 12
>
> Any ideas would help.
>
> thanks so much,
> John
> -------------------------------------------------------------------------
> This electronic mail message contains information that (a) is or may be CONFIDENTIAL,
> PROPRIETARY IN NATURE, OR OTHERWISE PROTECTED BY LAW FROM DISCLOSURE, and (b) is intended
> only for the use of the addressee(s) named herein.  If you are not an intended recipient,
> please send an email immediately to postmaster at bn.com  and take the steps necessary to delete
> the message completely from your computer system.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mike at suteki.co.uk  Wed Dec 11 14:51:17 2013
From: mike at suteki.co.uk (Mike Hadlow)
Date: Wed, 11 Dec 2013 14:51:17 +0000
Subject: [rabbitmq-discuss] Consumer cancel notification received on a new
 consumer on an HA-queue after node fail-over
Message-ID: <CAAc6ZR-hY6R_j2FBOLbsdopEEMnHvUEsPHH8nzbjk+8GJmMtYA@mail.gmail.com>

I have a question concerning consumer cancel notification when a consumer
is conusming from a queue when the cluster node that it is connected to
fails. In the docs (http://www.rabbitmq.com/consumer-cancel.html) it states:

"Other events, such as the queue being deleted, or in a clustered scenario,
the node on which the queue is located failing, will cause the consumption
to be cancelled, but the client channel will not be informed, which is
frequently unhelpful."

Surely if the node fails, the connection and channel will be disconnected,
so the consumer would not be able to receive a consumer cancel notification?

I am seeing behavior where a node fails, I immediately connect to an
alternative node, start a new consumer on the HA-queue, which then
immediately receives a consumer cancel notification. This only seems to
happen intermittently, which is doubly confusing.

Thanks
Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/5a6ccb30/attachment.html>

From shridharan.m at gmail.com  Wed Dec 11 15:03:46 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Wed, 11 Dec 2013 07:03:46 -0800
Subject: [rabbitmq-discuss] queue_procs using more memory in 1 node of a
	cluster
Message-ID: <CAPK6OetdC8uu4JL8FU91gqtf6U_djxpS1ZTEU8P59=Rb1Eyokw@mail.gmail.com>

Hello,

     I have a 2 node rabbit mq cluster with mirroring. From the web admin
UI (in queues tab), I have noticed that all the queues say its primary is
node 1 with node 2 as mirroring.

  I noticed that node 2 uses high memory in queue_procs (not sure what
exactly it means) 2.7 GB vs 10 MB in node 1 (more info below). Could
someone explain what this means and how I could resolve this mismatch of
memory usage?

Thank you,
Shri

Node 1:
* {memory,*
*     [{total,434405976},*
*      {connection_procs,20160952},*
*      {queue_procs,10945440},*
*      {plugins,57392},*
*      {other_proc,124653296},*
*      {mnesia,18446743796716438880},*
*      {mgmt_db,5323208},*
*      {msg_index,1934440},*
*      {other_ets,-18446743796515468096},*
*      {binary,5321488},*
*      {code,18395964},*
*      {atom,3451633},*
*      {other_system,43191379}]},*
* {vm_memory_high_watermark,0.4},*
* {vm_memory_limit,5047128883},*

Node 2:
*{memory,*
*     [{total,3170580544},*
*      {connection_procs,24989208},*
*      {queue_procs,2762497752},*
*      {plugins,151320},*
*      {other_proc,0},*
*      {mnesia,18446743960241058104},*
*      {mgmt_db,10144},*
*      {msg_index,10014968},*
*      {other_ets,-18446743959963810704},*
*      {binary,7078080},*
*      {code,18395964},*
*      {atom,2237825},*
*      {other_system,178510907}]},*
* {vm_memory_high_watermark,0.4},*
* {vm_memory_limit,5046969958},*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/6ac73593/attachment.html>

From emile at rabbitmq.com  Wed Dec 11 15:58:23 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Dec 2013 15:58:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.2 released
Message-ID: <52A88B9F.1050406@rabbitmq.com>


The RabbitMQ team is pleased to announce the release of RabbitMQ 3.2.2.

This release fixes a number of bugs in the broker (including High
Availability mode) and plugins (LDAP, Management and MQTT).

See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.2.2.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)
-------------- next part --------------
Release: RabbitMQ 3.2.2

Release Highlights
==================

server
------
bug fixes
25873 prevent possibility of deadlock when slaves start up (since 2.6.0)
25867 ensure automatic synchronisation does not fail when policy change
      causes new slaves to start and the master to change simultaneously
      (since 3.1.0)
25870 prevent the worker pool from running out of processes due to processes
      crashing (since 1.8.0)
25899 prevent race leading to cluster upgrade failure when multiple nodes
      attempt secondary upgrade simultaneously (since 2.4.1)
25912 correct reporting of flow control when connections become idle
      (since 2.8.0)


LDAP plugin
-----------
bug fixes
25863 prevent channels crashing during broker shutdown (since 2.3.0)


management plugin
-----------------
bug fixes
25872 prevent empty queues from showing length as '?' after going idle
      (since 3.1.0)
25889 ensure GET /api/overview uses consistent data types when server is idle
      (since 2.1.0)
25920 prevent rabbitmqadmin failure when no home directory is set (since 3.2.0)


MQTT plugin
-----------
bug fixes
25887 prevent possible error in the presence of multiple client IDs
25905 fix handling of acks from the broker with the 'multiple' flag set


Upgrading
=========
To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply install
the new version. All configuration and persistent message data is retained.

To upgrade a clustered RabbitMQ from release 2.1.1 or later, install the new
version on all the nodes and follow the instructions at
http://www.rabbitmq.com/clustering.html#upgrading .

To upgrade RabbitMQ from release 2.1.0, first upgrade to 2.1.1 (all data will be
retained), and then to the current version as described above.

When upgrading from RabbitMQ versions prior to 2.1.0, the existing data will be
moved to a backup location and a fresh, empty database will be created. A
warning is recorded in the logs. If your RabbitMQ installation contains
important data then we recommend you contact support at rabbitmq.com for
assistance with the upgrade.

From noel.mcgrath at gmail.com  Wed Dec 11 16:35:27 2013
From: noel.mcgrath at gmail.com (noel)
Date: Wed, 11 Dec 2013 08:35:27 -0800 (PST)
Subject: [rabbitmq-discuss] Logging configuration changes
In-Reply-To: <52A83F8F.7020402@rabbitmq.com>
References: <1386755041994-31963.post@n5.nabble.com>
 <52A83F8F.7020402@rabbitmq.com>
Message-ID: <1386779727442-31995.post@n5.nabble.com>

thanks simon



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Logging-configuration-changes-tp31963p31995.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gabriel.dausque at gdfsueztrading.com  Wed Dec 11 16:37:12 2013
From: gabriel.dausque at gdfsueztrading.com (gabriel.dausque at gdfsueztrading.com)
Date: Wed, 11 Dec 2013 17:37:12 +0100
Subject: [rabbitmq-discuss] using rabbitmq with active directory without
 sending password.
In-Reply-To: <52A83DE3.6060300@rabbitmq.com>
References: <5364289F36AB9D48904552794BA271CA2897E6E93A@XC203447.MELINDA.LOCAL>
 <52A83DE3.6060300@rabbitmq.com>
Message-ID: <5364289F36AB9D48904552794BA271CA2898108A82@XC203447.MELINDA.LOCAL>

Yep that's right.

It's for SSO integration. Ok if it is not supported, we might find another solution !

thanks

Cordialement

Gabriel DAUSQUE
Expert SI Meteor FPR
Tel?: 01 56 65 66 68
Mail?: gabriel.dausque at gdfsueztrading.com

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, December 11, 2013 11:27 AM
To: Discussions about RabbitMQ
Cc: Dausque Gabriel (GDF SUEZ Trading SAS)
Subject: Re: [rabbitmq-discuss] using rabbitmq with active directory without sending password.

I think you are asking for SSO integration with a logged in Windows user? I'm afraid RabbitMQ doesn't support that.

Cheers, Simon

On 10/12/13 19:12, gabriel.dausque at gdfsueztrading.com wrote:
> Hello,
>
> Because of new recommendation asked by our Security officer, we must 
> add secure authentication to access rabbitmq.
>
> To do that, we are experiencing the usage of ldap plugin with a .Net 
> client in front of it, but I I'm quite surprise to be forced to send 
> the windows user password to the rabbitmq server in order for it to 
> check the identity of the user  as it seems to be a very bad security 
> practice to ask for the already authenticated user its password and 
> reuse it, and also my security officer will not validate that kind of solution.
>
> Is there a way to only check that the user is already authenticated 
> without explicit login/password using ldap authentication ?
>
> Best regards
>
> Gabriel DAUSQUE
>
> Expert SI Meteor FPR
>
> Tel : 01 56 65 66 68
>
> Mail : gabriel.dausque at gdfsueztrading.com
>
> ___________________________________________________________________
>
> This message (including any attachments) and its content are 
> confidential, meant solely for the addressees.
> The views expressed in this message are those of its author and do not 
> necessarily represent the opinion of GDF SUEZ Trading.
> If you are not the intended recipient please notify the sender 
> immediately and destroy this e-mail.
> Any unauthorised copying, use, disclosure or distribution of the 
> content of this e-mail is strictly forbidden.
> GDF SUEZ Trading shall not be liable for the message if altered, 
> changed or falsified or computer virus contained.
> ___________________________________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal
___________________________________________________________________ 

This message (including any attachments) and its content are confidential, meant solely for the addressees. 
The views expressed in this message are those of its author and do not necessarily represent the opinion of GDF SUEZ Trading. 
If you are not the intended recipient please notify the sender immediately and destroy this e-mail. 
Any unauthorised copying, use, disclosure or distribution of the content of this e-mail is strictly forbidden. 
GDF SUEZ Trading shall not be liable for the message if altered, changed or falsified or computer virus contained. 
___________________________________________________________________ 


From sp345s at att.com  Wed Dec 11 19:11:11 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Wed, 11 Dec 2013 19:11:11 +0000
Subject: [rabbitmq-discuss] cluster
Message-ID: <59BF56992750434F89F8EBE141E64B1D018378AF@GAALPA1MSGUSR9C.ITServices.sbc.com>


We have 2 datacenters and are planning to have 2 separate clusters ..1 each in a datacenter ..

We want both the clusters to be active and have a geo load balance between these two clusters..
Can we have a federation bi directional between the clusters for a queue??
Also we are planning to have some mirrored queues on each cluster ... Can node 1 act as a master for one of the mirrored queue and node 2 acts as master for 2nd mirror queue ... or only 1 node acts as master for all the mirrored queues in the cluster ??
Also we are planning for a durable queues ...  let's say if a cluster is down before the messages get consumed .. and the message has TTL defined ... does the TTL continue during the downtime and do we lose the message once the nodes are UP .. or does it resets the TTL??

Appreciate all the help..
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/ffddadc8/attachment.html>

From sp345s at att.com  Wed Dec 11 19:13:33 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Wed, 11 Dec 2013 19:13:33 +0000
Subject: [rabbitmq-discuss] cluster
Message-ID: <59BF56992750434F89F8EBE141E64B1D018378BE@GAALPA1MSGUSR9C.ITServices.sbc.com>


We have 2 datacenters and are planning to have 2 separate clusters ..1 each in a datacenter ..

We want both the clusters to be active and have a geo load balance between these two clusters..
Can we have a federation bi directional between the clusters for a queue??
Also we are planning to have some mirrored queues on each cluster ... Can node 1 act as a master for one of the mirrored queue and node 2 acts as master for 2nd mirror queue ... or only 1 node acts as master for all the mirrored queues in the cluster ??
Also we are planning for a durable queues ...  let's say if a cluster is down before the messages get consumed .. and the message has TTL defined ... does the TTL continue during the downtime and do we lose the message once the nodes are UP .. or does it resets the TTL??

Appreciate all the help..
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/b889e601/attachment.html>

From goyalk at vmware.com  Wed Dec 11 20:14:00 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Wed, 11 Dec 2013 12:14:00 -0800 (PST)
Subject: [rabbitmq-discuss] Using export/import broker configuration as a
	way of backup/restore
Message-ID: <4116129a.000017e4.00000164@KAPILPC.vmware.com>

Hi, 

 

I need to know what broker entities are not available for export. I am
aware messages and auto-delete queues are not exported. Are there any
more? Maybe point me to some document?

 

Thanks

Kapil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/077b21d7/attachment.html>

From kaveh.shahbazian at gmail.com  Wed Dec 11 20:54:16 2013
From: kaveh.shahbazian at gmail.com (Kaveh Shahbazian)
Date: Thu, 12 Dec 2013 00:24:16 +0330
Subject: [rabbitmq-discuss] Send durable messages
Message-ID: <CAAX_u6hBN=3OQQCiju+PpTFQ1LLHbVfiyzwq-NYg8pq2kLXLyg@mail.gmail.com>

Hi, I want to send durable messages. But when I add 'durable = true' in
publish or message it complains that there is no such field in that record.

here is my code:

send() ->
    {ok, Connection} = amqp_connection:start(#amqp_params_network{ host =
"localhost" }),
    {ok, Channel} = amqp_connection:open_channel(Connection),

    amqp_channel:call(Channel, #'queue.declare'{queue = <<"q1_queue">>,
durable = true}),
    amqp_channel:cast(Channel,
                      #'basic.publish'{
 exchange = <<"">>,
 routing_key = <<"q1_queue">>
},
                      #amqp_msg{
 payload = <<"Hello World!">>
}),
    io:format(" [x] Sent 'Hello World!'~n"),
    ok = amqp_channel:close(Channel),
    ok = amqp_connection:close(Connection),
    ok.

Thanks;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/ca11599f/attachment.html>

From ed.tyrrill at emc.com  Wed Dec 11 21:20:31 2013
From: ed.tyrrill at emc.com (Tyrrill, Ed)
Date: Wed, 11 Dec 2013 16:20:31 -0500
Subject: [rabbitmq-discuss] Error starting rabbitmq in IPv6 environment
Message-ID: <CECE171F.593E6%ed.tyrrill@emc.com>

Hi RabbitMQ devs,

I have found a bug starting rabbitmq in a linux pure IPv6 environment where /etc/resolv.conf has a "nameserver" line specifying an IPv6 address.  This is what I see:

# service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.
# cat /var/log/rabbitmq/startup_log
ERROR: epmd error for host "a4ipn434": address (cannot connect to host/port)

Note that /etc/hosts specifies the FQ and short hostnames of the machine:

2620:0:170:586::1:1 a4ipn434.xxxxxxxxxxx a4ipn434

And /etc/resolv.conf specifies a nameserver with an IPv6 address:

nameserver 2620:0:170:58e::4

If I comment out this nameserver line in resolv.conf, then rabbitmq starts with no problem:

# service rabbitmq-server start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.
# cat /var/log/rabbitmq/startup_log

              RabbitMQ 3.2.0. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434.log
  ######  ##        /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434-sasl.log
  ##########
              Starting broker... completed with 0 plugins.

Also, FYI, I tried this with rabbitmq versions 3.2.1-1 and 3.2.0-1.

Thanks,
Ed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/15ca6283/attachment.html>

From nicholasastuart at gmail.com  Wed Dec 11 21:20:37 2013
From: nicholasastuart at gmail.com (Nicholas Stuart)
Date: Wed, 11 Dec 2013 15:20:37 -0600
Subject: [rabbitmq-discuss] Network partition detected,
 did not recover gracefully even though cluster_partition_handling =
 autoheal
In-Reply-To: <52A846F8.908@rabbitmq.com>
References: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>
 <52A846F8.908@rabbitmq.com>
Message-ID: <CAGHWcMXbcRqd3x=aRxgFT4MXH0xbZw0T7K+F=rOpO2MVnQfWCA@mail.gmail.com>

There are no log files that indicate autoheal, just the log lines regarding
the mnesia issues.


On Wed, Dec 11, 2013 at 5:05 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 10/12/13 18:17, Nicholas Stuart wrote:
>
>> I'm not sure why it failed, but I did have some network failure
>> indicated in other systems, so I assume it was that. My issue is that
>> the network never tried to rescue itself afterwards, even though in my
>> rabbitmq.conf I have cluster_partition_handling set to autoheal. It is
>> my understanding that setting it to autoheal will cause the nodes to fix
>> its network partition, is this assumption incorrect?
>>
>
> It should do - the cluster should pick some nodes to restart and restart
> them, healing the partition.
>
> Do you have any log messages beginning "Autoheal"?
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/e6fd5e5d/attachment.html>

From ed.tyrrill at emc.com  Wed Dec 11 21:39:43 2013
From: ed.tyrrill at emc.com (Tyrrill, Ed)
Date: Wed, 11 Dec 2013 16:39:43 -0500
Subject: [rabbitmq-discuss] Error starting rabbitmq in IPv6 environment
In-Reply-To: <CECE171F.593E6%ed.tyrrill@emc.com>
Message-ID: <CECE1B7B.59408%ed.tyrrill@emc.com>

I probably should have noted that I am using erlang R16B02.

Thanks,
Ed

From: <Tyrrill>, Edward Tyrrill <ed.tyrrill at emc.com<mailto:ed.tyrrill at emc.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Wednesday, December 11, 2013 1:20 PM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] Error starting rabbitmq in IPv6 environment

Hi RabbitMQ devs,

I have found a bug starting rabbitmq in a linux pure IPv6 environment where /etc/resolv.conf has a "nameserver" line specifying an IPv6 address.  This is what I see:

# service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.
# cat /var/log/rabbitmq/startup_log
ERROR: epmd error for host "a4ipn434": address (cannot connect to host/port)

Note that /etc/hosts specifies the FQ and short hostnames of the machine:

2620:0:170:586::1:1 a4ipn434.xxxxxxxxxxx a4ipn434

And /etc/resolv.conf specifies a nameserver with an IPv6 address:

nameserver 2620:0:170:58e::4

If I comment out this nameserver line in resolv.conf, then rabbitmq starts with no problem:

# service rabbitmq-server start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.
# cat /var/log/rabbitmq/startup_log

              RabbitMQ 3.2.0. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434.log<mailto:/data01/avamar/var/rabbitmq/log/rabbit at a4ipn434.log>
  ######  ##        /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434-sasl.log<mailto:/data01/avamar/var/rabbitmq/log/rabbit at a4ipn434-sasl.log>
  ##########
              Starting broker... completed with 0 plugins.

Also, FYI, I tried this with rabbitmq versions 3.2.1-1 and 3.2.0-1.

Thanks,
Ed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/23c5388d/attachment.html>

From videlalvaro at gmail.com  Wed Dec 11 22:21:18 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Dec 2013 22:21:18 +0000
Subject: [rabbitmq-discuss] Send durable messages
In-Reply-To: <CAAX_u6hBN=3OQQCiju+PpTFQ1LLHbVfiyzwq-NYg8pq2kLXLyg@mail.gmail.com>
References: <CAAX_u6hBN=3OQQCiju+PpTFQ1LLHbVfiyzwq-NYg8pq2kLXLyg@mail.gmail.com>
Message-ID: <CAMcAHLVkKU26_T81YU7KSb9CsSYUrf4doSZnWdwYYkyFim-A2Q@mail.gmail.com>

Hi,

You need to set the delivery_mode = 2

See https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/erlang/new_task.erl#L22

Regards,

Alvaro

On Wed, Dec 11, 2013 at 8:54 PM, Kaveh Shahbazian
<kaveh.shahbazian at gmail.com> wrote:
> Hi, I want to send durable messages. But when I add 'durable = true' in
> publish or message it complains that there is no such field in that record.
>
> here is my code:
>
> send() ->
>     {ok, Connection} = amqp_connection:start(#amqp_params_network{ host =
> "localhost" }),
>     {ok, Channel} = amqp_connection:open_channel(Connection),
>
>     amqp_channel:call(Channel, #'queue.declare'{queue = <<"q1_queue">>,
> durable = true}),
>     amqp_channel:cast(Channel,
>                       #'basic.publish'{
> exchange = <<"">>,
> routing_key = <<"q1_queue">>
> },
>                       #amqp_msg{
> payload = <<"Hello World!">>
> }),
>     io:format(" [x] Sent 'Hello World!'~n"),
>     ok = amqp_channel:close(Channel),
>     ok = amqp_connection:close(Connection),
>     ok.
>
> Thanks;
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mklishin at gopivotal.com  Wed Dec 11 22:48:10 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 12 Dec 2013 02:48:10 +0400
Subject: [rabbitmq-discuss] cluster
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D018378AF@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018378AF@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <06D342FB-BB55-489A-927E-45FD5463329F@rabbitmq.com>

On 11 Dec 2013, at 23:11, PATAR, SAGAR <sp345s at att.com> wrote:

> We want both the clusters to be active and have a geo load balance between these two clusters..
> Can we have a federation bi directional between the clusters for a queue??
> Also we are planning to have some mirrored queues on each cluster ? Can node 1 act as a master for one of the mirrored queue and node 2 acts as master for 2nd mirror queue ? or only 1 node acts as master for all the mirrored queues in the cluster ??
> Also we are planning for a durable queues ?  let?s say if a cluster is down before the messages get consumed .. and the message has TTL defined ? does the TTL continue during the downtime and do we lose the message once the nodes are UP .. or does it resets the TTL??

A few of these questions are answered on http://www.rabbitmq.com/federated-queues.html.

Federated queues are not for replication, through (federated exchanges are).

MK

Software Engineer, Pivotal/RabbitMQ



From kaveh.shahbazian at gmail.com  Thu Dec 12 07:45:06 2013
From: kaveh.shahbazian at gmail.com (Kaveh Shahbazian)
Date: Thu, 12 Dec 2013 11:15:06 +0330
Subject: [rabbitmq-discuss] Send durable messages
In-Reply-To: <CAMcAHLVkKU26_T81YU7KSb9CsSYUrf4doSZnWdwYYkyFim-A2Q@mail.gmail.com>
References: <CAAX_u6hBN=3OQQCiju+PpTFQ1LLHbVfiyzwq-NYg8pq2kLXLyg@mail.gmail.com>
 <CAMcAHLVkKU26_T81YU7KSb9CsSYUrf4doSZnWdwYYkyFim-A2Q@mail.gmail.com>
Message-ID: <CAAX_u6hooOM5jQUfb-rcedLzgVFWY=p10ixDyr=0wk-11F=f=A@mail.gmail.com>

Many thanks to you! That worked! Of-course it's strange why there is so
little Erlang samples for RabbitMQ! :)

Kaveh Shahbazian
?Walking on water and developing software from a specification are easy if
both are frozen.?
? Edward Berard
<http://goo.gl/ZZ2TMu>
<http://stackoverflow.com/users/54467/kaveh-shahbazian>


On Thu, Dec 12, 2013 at 1:51 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> You need to set the delivery_mode = 2
>
> See
> https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/erlang/new_task.erl#L22
>
> Regards,
>
> Alvaro
>
> On Wed, Dec 11, 2013 at 8:54 PM, Kaveh Shahbazian
> <kaveh.shahbazian at gmail.com> wrote:
> > Hi, I want to send durable messages. But when I add 'durable = true' in
> > publish or message it complains that there is no such field in that
> record.
> >
> > here is my code:
> >
> > send() ->
> >     {ok, Connection} = amqp_connection:start(#amqp_params_network{ host =
> > "localhost" }),
> >     {ok, Channel} = amqp_connection:open_channel(Connection),
> >
> >     amqp_channel:call(Channel, #'queue.declare'{queue = <<"q1_queue">>,
> > durable = true}),
> >     amqp_channel:cast(Channel,
> >                       #'basic.publish'{
> > exchange = <<"">>,
> > routing_key = <<"q1_queue">>
> > },
> >                       #amqp_msg{
> > payload = <<"Hello World!">>
> > }),
> >     io:format(" [x] Sent 'Hello World!'~n"),
> >     ok = amqp_channel:close(Channel),
> >     ok = amqp_connection:close(Connection),
> >     ok.
> >
> > Thanks;
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/b1c76448/attachment.html>

From samir.gahirwal at gmail.com  Wed Dec 11 22:52:29 2013
From: samir.gahirwal at gmail.com (SamirG)
Date: Wed, 11 Dec 2013 14:52:29 -0800 (PST)
Subject: [rabbitmq-discuss] Help: PLAIN login refused: user 'guest' -
	invalid credentials
Message-ID: <fa501e45-81d3-43b6-8d6b-8d6e820e6fe7@googlegroups.com>

Hi, 

I am seeing lot of these errors written in logs 

=ERROR REPORT==== 10-Dec-2013::14:00:27 ===
closing AMQP connection <0.4057.0> (10.0.0.5:24520 -> 10.0.0.33:5672):
{handshake_error,starting,0,
                 {amqp_error,access_refused,
                             "PLAIN login refused: user 'guest' - invalid 
credentials",
                             'connection.start_ok'}}
=ERROR REPORT==== 10-Dec-2013::14:00:35 ===
closing AMQP connection <0.4065.0> (10.0.0.6:25249 -> 10.0.0.33:5672):
{handshake_error,starting,0,
                 {amqp_error,access_refused,
                             "PLAIN login refused: user 'guest' - invalid 
credentials",
                             'connection.start_ok'}}

I checked credentials for guest user, and there is no issue with it. Most 
of these requests are coming from NetScalar, so not sure if something is 
wrong with NS seetings. Has anyone else faced similar issue? 

Also in same environment I am seeing 'Network partition detected' errors. 
Not sure if its related to invalid credentials issue. 


Thanks!
--SamirG 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/2d58561c/attachment.html>

From emile at rabbitmq.com  Thu Dec 12 09:16:46 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 12 Dec 2013 09:16:46 +0000
Subject: [rabbitmq-discuss] Help: PLAIN login refused: user 'guest' -
 invalid credentials
In-Reply-To: <fa501e45-81d3-43b6-8d6b-8d6e820e6fe7@googlegroups.com>
References: <fa501e45-81d3-43b6-8d6b-8d6e820e6fe7@googlegroups.com>
Message-ID: <52A97EFE.2010805@rabbitmq.com>

On 11/12/13 22:52, SamirG wrote:

> I checked credentials for guest user, and there is no issue with it.

The most likely cause is an incorrect username or password. How did you
check the credentials?




-Emile




From michael.s.klishin at gmail.com  Thu Dec 12 09:16:43 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 12 Dec 2013 13:16:43 +0400
Subject: [rabbitmq-discuss] Help: PLAIN login refused: user 'guest' -
 invalid credentials
In-Reply-To: <fa501e45-81d3-43b6-8d6b-8d6e820e6fe7@googlegroups.com>
References: <fa501e45-81d3-43b6-8d6b-8d6e820e6fe7@googlegroups.com>
Message-ID: <CAE3HoVQY-x5ELTyk+-C=0O0wtPXy+0XxLoVdamD_C6QHAFd9kA@mail.gmail.com>

2013/12/12 SamirG <samir.gahirwal at gmail.com>

> I am seeing lot of these errors written in logs
>
> =ERROR REPORT==== 10-Dec-2013::14:00:27 ===
> closing AMQP connection <0.4057.0> (10.0.0.5:24520 -> 10.0.0.33:5672):
> {handshake_error,starting,0,
>                  {amqp_error,access_refused,
>                              "PLAIN login refused: user 'guest' - invalid
> credentials",
>                              'connection.start_ok'}}
> =ERROR REPORT==== 10-Dec-2013::14:00:35 ===
> closing AMQP connection <0.4065.0> (10.0.0.6:25249 -> 10.0.0.33:5672):
> {handshake_error,starting,0,
>                  {amqp_error,access_refused,
>                              "PLAIN login refused: user 'guest' - invalid
> credentials",
>                              'connection.start_ok'}}
>
> I checked credentials for guest user, and there is no issue with it. Most
> of these requests are coming from NetScalar, so not sure if something is
> wrong with NS seetings. Has anyone else faced similar issue?
>

Make sure your client percent-escapes slashes in vhost names correctly (as
%2F).


> Also in same environment I am seeing 'Network partition detected' errors.
> Not sure if its related to invalid credentials issue.
>

It's not. It means that there was a connectivity interruption between
nodes. See
http://www.rabbitmq.com/partitions.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/6ee99d25/attachment.html>

From videlalvaro at gmail.com  Thu Dec 12 09:17:34 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 12 Dec 2013 09:17:34 +0000
Subject: [rabbitmq-discuss] Send durable messages
In-Reply-To: <CAAX_u6hooOM5jQUfb-rcedLzgVFWY=p10ixDyr=0wk-11F=f=A@mail.gmail.com>
References: <CAAX_u6hBN=3OQQCiju+PpTFQ1LLHbVfiyzwq-NYg8pq2kLXLyg@mail.gmail.com>
 <CAMcAHLVkKU26_T81YU7KSb9CsSYUrf4doSZnWdwYYkyFim-A2Q@mail.gmail.com>
 <CAAX_u6hooOM5jQUfb-rcedLzgVFWY=p10ixDyr=0wk-11F=f=A@mail.gmail.com>
Message-ID: <CAMcAHLUDcN_UOmvzZbJK_ZOuKAYr2zV0Cr3V3KG6ZGf1o=cxhQ@mail.gmail.com>

You can find all the tutorials ported to Erlang in that URL.

While not ideal, most RabbitMQ plugins, like shovel or federation, use the
Erlang client.

Regards,

Alvaro

On Thursday, December 12, 2013, Kaveh Shahbazian wrote:

> Many thanks to you! That worked! Of-course it's strange why there is so
> little Erlang samples for RabbitMQ! :)
>
> Kaveh Shahbazian
> "Walking on water and developing software from a specification are easy if
> both are frozen."
> -- Edward Berard
> <http://goo.gl/ZZ2TMu>
> <http://stackoverflow.com/users/54467/kaveh-shahbazian>
>
>
> On Thu, Dec 12, 2013 at 1:51 AM, Alvaro Videla <videlalvaro at gmail.com<javascript:_e({}, 'cvml', 'videlalvaro at gmail.com');>
> > wrote:
>
>> Hi,
>>
>> You need to set the delivery_mode = 2
>>
>> See
>> https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/erlang/new_task.erl#L22
>>
>> Regards,
>>
>> Alvaro
>>
>> On Wed, Dec 11, 2013 at 8:54 PM, Kaveh Shahbazian
>> <kaveh.shahbazian at gmail.com <javascript:_e({}, 'cvml',
>> 'kaveh.shahbazian at gmail.com');>> wrote:
>> > Hi, I want to send durable messages. But when I add 'durable = true' in
>> > publish or message it complains that there is no such field in that
>> record.
>> >
>> > here is my code:
>> >
>> > send() ->
>> >     {ok, Connection} = amqp_connection:start(#amqp_params_network{ host
>> =
>> > "localhost" }),
>> >     {ok, Channel} = amqp_connection:open_channel(Connection),
>> >
>> >     amqp_channel:call(Channel, #'queue.declare'{queue = <<"q1_queue">>,
>> > durable = true}),
>> >     amqp_channel:cast(Channel,
>> >                       #'basic.publish'{
>> > exchange = <<"">>,
>> > routing_key = <<"q1_queue">>
>> > },
>> >                       #amqp_msg{
>> > payload = <<"Hello World!">>
>> > }),
>> >     io:format(" [x] Sent 'Hello World!'~n"),
>> >     ok = amqp_channel:close(Channel),
>> >     ok = amqp_connection:close(Connection),
>> >     ok.
>> >
>> > Thanks;
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com <javascript:_e({}, 'cvml',
>> 'rabbitmq-discuss at lists.rabbitmq.com');>
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com <javascript:_e({}, 'cvml',
>> 'rabbitmq-discuss at lists.rabbitmq.com');>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/b7714cb8/attachment.html>

From michael.s.klishin at gmail.com  Thu Dec 12 10:16:52 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 12 Dec 2013 14:16:52 +0400
Subject: [rabbitmq-discuss] Help: PLAIN login refused: user 'guest' -
 invalid credentials
In-Reply-To: <CAE3HoVQY-x5ELTyk+-C=0O0wtPXy+0XxLoVdamD_C6QHAFd9kA@mail.gmail.com>
References: <fa501e45-81d3-43b6-8d6b-8d6e820e6fe7@googlegroups.com>
 <CAE3HoVQY-x5ELTyk+-C=0O0wtPXy+0XxLoVdamD_C6QHAFd9kA@mail.gmail.com>
Message-ID: <CAE3HoVQ+VAO5=KTEtiMriNUh=0Fu=HURooZw3MfJZ-8ZtsjxrQ@mail.gmail.com>

2013/12/12 Michael Klishin <michael.s.klishin at gmail.com>

> Make sure your client percent-escapes slashes in vhost names correctly (as
> %2F).


By this I mean that vhost name and not just credentials can be incorrect.
Percent escaping is one possible problem worth investigating.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/259da177/attachment.html>

From simon at rabbitmq.com  Thu Dec 12 10:25:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Dec 2013 10:25:01 +0000
Subject: [rabbitmq-discuss] Consumer cancel notification received on a
 new consumer on an HA-queue after node fail-over
In-Reply-To: <CAAc6ZR-hY6R_j2FBOLbsdopEEMnHvUEsPHH8nzbjk+8GJmMtYA@mail.gmail.com>
References: <CAAc6ZR-hY6R_j2FBOLbsdopEEMnHvUEsPHH8nzbjk+8GJmMtYA@mail.gmail.com>
Message-ID: <52A98EFD.50102@rabbitmq.com>

On 11/12/2013 14:51, Mike Hadlow wrote:
> I have a question concerning consumer cancel notification when a
> consumer is conusming from a queue when the cluster node that it is
> connected to fails. In the docs
> (http://www.rabbitmq.com/consumer-cancel.html) it states:
>
> "Other events, such as the queue being deleted, or in a clustered
> scenario, the node on which the queue is located failing, will cause the
> consumption to be cancelled, but the client channel will not be
> informed, which is frequently unhelpful."
>
> Surely if the node fails, the connection and channel will be
> disconnected, so the consumer would not be able to receive a consumer
> cancel notification?

I think that text is trying to say that if the node fails while the 
consumer is connected to a different node then the consumer will be 
cancelled.

> I am seeing behavior where a node fails, I immediately connect to an
> alternative node, start a new consumer on the HA-queue, which then
> immediately receives a consumer cancel notification. This only seems to
> happen intermittently, which is doubly confusing.

Yes, it's likely to be possible that if you reconnect fast enough the 
queue metadata has not yet been updated, so you consume from the old 
master and immediately get a cancel notification. But you'd just want to 
handle that the same way as any other cancellation - presumably by 
reissuing basic.consume. You need to handle that anyway, so this is a 
bit counterintuitive but I wouldn't call it a bug.

Cheers, Simon


From simon at rabbitmq.com  Thu Dec 12 10:35:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Dec 2013 10:35:05 +0000
Subject: [rabbitmq-discuss] Using export/import broker configuration as
 a way of backup/restore
In-Reply-To: <4116129a.000017e4.00000164@KAPILPC.vmware.com>
References: <4116129a.000017e4.00000164@KAPILPC.vmware.com>
Message-ID: <52A99159.4000500@rabbitmq.com>

On 11/12/2013 20:14, Kapil Goyal wrote:
> I need to know what broker entities are not available for export. I am
> aware messages and auto-delete queues are not exported. Are there any
> more? Maybe point me to some document?

I don't think there's any documentation other than the code:

http://hg.rabbitmq.com/rabbitmq-management/file/3eeb9cde47e4/src/rabbit_mgmt_wm_definitions.erl

The basic idea is to export all metadata we can successfully recreate.

So we don't export:
* messages (not metadata)
* connections and channels (obviously)
* exclusive queues (can't be recreated without a connection to attach to)
* built in exchanges (can't be recreated / no point)
* bindings to queues we are not going to export (no point)
* bindings to the default exchange (will be automatically recreated)

Auto-delete queues *are* exported.

Cheers, Simon


From simon at rabbitmq.com  Thu Dec 12 10:44:16 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Dec 2013 10:44:16 +0000
Subject: [rabbitmq-discuss] queue_procs using more memory in 1 node of a
 cluster
In-Reply-To: <CAPK6OetdC8uu4JL8FU91gqtf6U_djxpS1ZTEU8P59=Rb1Eyokw@mail.gmail.com>
References: <CAPK6OetdC8uu4JL8FU91gqtf6U_djxpS1ZTEU8P59=Rb1Eyokw@mail.gmail.com>
Message-ID: <52A99380.5050005@rabbitmq.com>

There isn't really enough information here to make a diagnosis. Some 
points that may guide the way however:

* There have been memory leaks in mirrored queues in older versions of 
RabbitMQ. If you are running an older version that may explain it.

* Your systems are currently both well under the memory high watermark - 
it's possible that one has been over the limit in the past while the 
other hasn't. This might have lead to queues on one node paging out most 
of their messages while queues on the other node didn't.

Cheers, Simon

On 11/12/2013 15:03, shridharan muthu wrote:
> Hello,
>       I have a 2 node rabbit mq cluster with mirroring. From the web
> admin UI (in queues tab), I have noticed that all the queues say its
> primary is node 1 with node 2 as mirroring.
>
>    I noticed that node 2 uses high memory in queue_procs (not sure what
> exactly it means) 2.7 GB vs 10 MB in node 1 (more info below). Could
> someone explain what this means and how I could resolve this mismatch of
> memory usage?
>
> Thank you,
> Shri
>
> Node 1:
> / {memory,/
> /     [{total,434405976},/
> /      {connection_procs,20160952},/
> /*{queue_procs,10945440},*/
> /      {plugins,57392},/
> /      {other_proc,124653296},/
> /      {mnesia,18446743796716438880},/
> /      {mgmt_db,5323208},/
> /      {msg_index,1934440},/
> /      {other_ets,-18446743796515468096},/
> /      {binary,5321488},/
> /      {code,18395964},/
> /      {atom,3451633},/
> /      {other_system,43191379}]},/
> / {vm_memory_high_watermark,0.4},/
> / {vm_memory_limit,5047128883},/
> /
> /
> Node 2:
> /{memory,/
> /     [{total,3170580544},/
> /      {connection_procs,24989208},/
> /*  {queue_procs,2762497752},*/
> /      {plugins,151320},/
> /      {other_proc,0},/
> /      {mnesia,18446743960241058104},/
> /      {mgmt_db,10144},/
> /      {msg_index,10014968},/
> /      {other_ets,-18446743959963810704},/
> /      {binary,7078080},/
> /      {code,18395964},/
> /      {atom,2237825},/
> /      {other_system,178510907}]},/
> / {vm_memory_high_watermark,0.4},/
> / {vm_memory_limit,5046969958},/
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Thu Dec 12 10:50:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Dec 2013 10:50:44 +0000
Subject: [rabbitmq-discuss] Error starting rabbitmq in IPv6 environment
In-Reply-To: <CECE171F.593E6%ed.tyrrill@emc.com>
References: <CECE171F.593E6%ed.tyrrill@emc.com>
Message-ID: <52A99504.6080702@rabbitmq.com>

This looks like more of an Erlang-level problem, looks like it is 
failing before RabbitMQ starts starting. Can you start "erl -sname foo" 
in pure IPv6 mode?

And of course, just to make sure, you can resolve a4ipn434, right? :-)

Cheers, Simon

On 11/12/2013 21:20, Tyrrill, Ed wrote:
> Hi RabbitMQ devs,
>
> I have found a bug starting rabbitmq in a linux pure IPv6 environment
> where /etc/resolv.conf has a "nameserver" line specifying an IPv6
> address.  This is what I see:
>
> # service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> _err}
> rabbitmq-server.
> # cat /var/log/rabbitmq/startup_log
> ERROR: epmd error for host "a4ipn434": address (cannot connect to host/port)
>
> Note that /etc/hosts specifies the FQ and short hostnames of the machine:
>
> 2620:0:170:586::1:1a4ipn434.xxxxxxxxxxx a4ipn434
>
> And /etc/resolv.conf specifies a nameserver with an IPv6 address:
>
> nameserver 2620:0:170:58e::4
>
> If I comment out this nameserver line in resolv.conf, then rabbitmq
> starts with no problem:
>
> # service rabbitmq-server start
> Starting rabbitmq-server: SUCCESS
> rabbitmq-server.
> # cat /var/log/rabbitmq/startup_log
>
>                RabbitMQ 3.2.0. Copyright (C) 2007-2013 GoPivotal, Inc.
>    ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>    ##  ##
>    ##########  Logs: /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434.log
>    ######  ##
>   /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434-sasl.log
>    ##########
>                Starting broker... completed with 0 plugins.
>
> Also, FYI, I tried this with rabbitmq versions 3.2.1-1 and 3.2.0-1.
>
> Thanks,
> Ed
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From carl.hoerberg at gmail.com  Thu Dec 12 10:51:24 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 12 Dec 2013 02:51:24 -0800 (PST)
Subject: [rabbitmq-discuss] weird stats tail behavior
Message-ID: <1386845484217-32019.post@n5.nabble.com>

We have a "constant spike" at the end of our charts: 

https://www.dropbox.com/s/8n7p2ih0rhm6nre/Screenshot%202013-12-12%2017.45.41.png
https://www.dropbox.com/s/y637pm0w66lskm0/Screenshot%202013-12-12%2017.46.08.png
https://www.dropbox.com/s/g17tna9d390oncn/Screenshot%202013-12-12%2017.46.59.png

There's always a spike at the end of the 10min chart, no matter how long you
look at it. 

Also note that the current msgs rates shows 0, while in fact the pub rate is
400msg/s.  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/weird-stats-tail-behavior-tp32019.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Dec 12 10:56:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Dec 2013 10:56:10 +0000
Subject: [rabbitmq-discuss] Network partition detected,
 did not recover gracefully even though cluster_partition_handling =
 autoheal
In-Reply-To: <CAGHWcMXbcRqd3x=aRxgFT4MXH0xbZw0T7K+F=rOpO2MVnQfWCA@mail.gmail.com>
References: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>
 <52A846F8.908@rabbitmq.com>
 <CAGHWcMXbcRqd3x=aRxgFT4MXH0xbZw0T7K+F=rOpO2MVnQfWCA@mail.gmail.com>
Message-ID: <52A9964A.3020309@rabbitmq.com>

On 11/12/2013 21:20, Nicholas Stuart wrote:
> There are no log files that indicate autoheal, just the log lines
> regarding the mnesia issues.

Hmm. That sounds like the configuration is not being picked up. What 
does "rabbitmqctl environment" say?

Cheers, Simon


From woodslee at 126.com  Thu Dec 12 11:03:26 2013
From: woodslee at 126.com (woodslee)
Date: Thu, 12 Dec 2013 19:03:26 +0800
Subject: [rabbitmq-discuss] How long will rabbitMQ requeue those which have
	not acknowledged message?
Message-ID: <DM__131212190320_47354787551@smtp.feinno.com>

Hi All

I have a time parameter X(minute)
When rabbitMQ delivery a message , X minute later, if the message have not acknowledged,
then rabbitMQ requeue the message.

Is this possible?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/19354d69/attachment.html>

From michael.s.klishin at gmail.com  Thu Dec 12 11:14:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 12 Dec 2013 15:14:11 +0400
Subject: [rabbitmq-discuss] How long will rabbitMQ requeue those which
 have not acknowledged message?
In-Reply-To: <DM__131212190320_47354787551@smtp.feinno.com>
References: <DM__131212190320_47354787551@smtp.feinno.com>
Message-ID: <CAE3HoVSteFz1-o5W6C5jWzMWfPpJPgFxukAjZ6QgqSkRh5BkNA@mail.gmail.com>

2013/12/12 woodslee <woodslee at 126.com>

> When rabbitMQ delivery a message , X minute later, if the message have not
> acknowledged,
> then rabbitMQ requeue the message.
>
> Is this possible?
>

Start a timer in delivery handler (on the client end) and then use
basic.nack with requeue = true
when time is up. RabbitMQ itself does not have a limit on how long a
delivery can be unacknowledged.

Note that channel closure will cause all unacknowledged messages on it to
be re-queued as well.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/8d3e449a/attachment.html>

From lishulin at feinno.com  Thu Dec 12 11:02:38 2013
From: lishulin at feinno.com (lishulin)
Date: Thu, 12 Dec 2013 19:02:38 +0800
Subject: [rabbitmq-discuss] How long will rabbitMQ requeue those which have
	not acknowledged message?
Message-ID: <DM__131212172519_47542210815@smtp.feinno.com>

Hi All

I have a time parameter X(minute)
When rabbitMQ delivery a message , X minute later, if the message have not acknowledged,
then rabbitMQ requeue the message.

Is this possible?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/5aaa9d4f/attachment.html>

From michael.s.klishin at gmail.com  Thu Dec 12 14:17:30 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 12 Dec 2013 18:17:30 +0400
Subject: [rabbitmq-discuss] How long will rabbitMQ requeue those which
 have not acknowledged message?
In-Reply-To: <DM__131212172519_47542210815@smtp.feinno.com>
References: <DM__131212172519_47542210815@smtp.feinno.com>
Message-ID: <CAE3HoVRcWztXHACSeauzQKyfXHW_yujbLbM_mbr1rXdyo88Amg@mail.gmail.com>

2013/12/12 lishulin <lishulin at feinno.com>

> I have a time parameter X(minute)
> When rabbitMQ delivery a message , X minute later, if the message have not
> acknowledged,
> then rabbitMQ requeue the message.
>
> Is this possible?
>

Already answered in http://markmail.org/thread/tgf5qhny5pkttjaw.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/af7c514d/attachment.html>

From CLefevre at Transparent.com  Thu Dec 12 15:06:08 2013
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Thu, 12 Dec 2013 15:06:08 +0000
Subject: [rabbitmq-discuss] RabbitMQ Admin Monitoring not showing live
 numbers?
In-Reply-To: <529E144F.5050006@rabbitmq.com>
References: <5798631D5F355D4C99FDF23580295AF81A137A42@TLMAIL1.Transparent.local>
 <529E144F.5050006@rabbitmq.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF81A139041@TLMAIL1.Transparent.local>

Queue is showing as Idle, and Message Rates of 0

Hence why we found it so odd.

Sorry for the delay in reply

Thank you for your time,
-Christopher Lefevre

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: Tuesday, December 03, 2013 12:27 PM
To: Discussions about RabbitMQ
Cc: Christopher Lefevre
Subject: Re: [rabbitmq-discuss] RabbitMQ Admin Monitoring not showing live numbers?

On 03/12/13 15:33, Christopher Lefevre wrote:
> In one of our recent integration tests, we are sending through a large
> number of messages ( 100's to 1000's ) per minute, and with 20
> consumers, all of the data is being properly routed and processed.
> However, the monitor for the queue is showing 0 messages Queued (
> Which is not surprising, as they are taken off immediately? )

Yes.

> but
> also the transfer rates, and messages per second are also all showing
> 0.
>
> We can see the consumers active on the queue, and it is the only queue
> that we are using for that test.

Hmm.

Does the queue show as "active" or "idle"? What does the overview page look like? (Does it show any message rates?)

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.

From nicholasastuart at gmail.com  Thu Dec 12 15:41:50 2013
From: nicholasastuart at gmail.com (Nicholas Stuart)
Date: Thu, 12 Dec 2013 09:41:50 -0600
Subject: [rabbitmq-discuss] Network partition detected,
 did not recover gracefully even though cluster_partition_handling =
 autoheal
In-Reply-To: <52A9964A.3020309@rabbitmq.com>
References: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>
 <52A846F8.908@rabbitmq.com>
 <CAGHWcMXbcRqd3x=aRxgFT4MXH0xbZw0T7K+F=rOpO2MVnQfWCA@mail.gmail.com>
 <52A9964A.3020309@rabbitmq.com>
Message-ID: <CAGHWcMXuXAWaiK5n4ryy3JTyWnx_Ts9ahAxvYKt-fFawtfynVQ@mail.gmail.com>

It says  {cluster_partition_handling,autoheal}, are there any other
variables I should look for there?



On Thu, Dec 12, 2013 at 4:56 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/12/2013 21:20, Nicholas Stuart wrote:
>
>> There are no log files that indicate autoheal, just the log lines
>> regarding the mnesia issues.
>>
>
> Hmm. That sounds like the configuration is not being picked up. What does
> "rabbitmqctl environment" say?
>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/23080ad2/attachment.html>

From simon at rabbitmq.com  Thu Dec 12 15:58:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Dec 2013 15:58:27 +0000
Subject: [rabbitmq-discuss] Network partition detected,
 did not recover gracefully even though cluster_partition_handling =
 autoheal
In-Reply-To: <CAGHWcMXuXAWaiK5n4ryy3JTyWnx_Ts9ahAxvYKt-fFawtfynVQ@mail.gmail.com>
References: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>
 <52A846F8.908@rabbitmq.com>
 <CAGHWcMXbcRqd3x=aRxgFT4MXH0xbZw0T7K+F=rOpO2MVnQfWCA@mail.gmail.com>
 <52A9964A.3020309@rabbitmq.com>
 <CAGHWcMXuXAWaiK5n4ryy3JTyWnx_Ts9ahAxvYKt-fFawtfynVQ@mail.gmail.com>
Message-ID: <52A9DD23.6070101@rabbitmq.com>

On 12/12/2013 15:41, Nicholas Stuart wrote:
> It says  {cluster_partition_handling,autoheal}, are there any other
> variables I should look for there?

Can you post the complete log file somewhere?

Cheers, Simon


From nicholasastuart at gmail.com  Thu Dec 12 16:11:52 2013
From: nicholasastuart at gmail.com (Nicholas Stuart)
Date: Thu, 12 Dec 2013 10:11:52 -0600
Subject: [rabbitmq-discuss] Network partition detected,
 did not recover gracefully even though cluster_partition_handling =
 autoheal
In-Reply-To: <52A9DD23.6070101@rabbitmq.com>
References: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>
 <52A846F8.908@rabbitmq.com>
 <CAGHWcMXbcRqd3x=aRxgFT4MXH0xbZw0T7K+F=rOpO2MVnQfWCA@mail.gmail.com>
 <52A9964A.3020309@rabbitmq.com>
 <CAGHWcMXuXAWaiK5n4ryy3JTyWnx_Ts9ahAxvYKt-fFawtfynVQ@mail.gmail.com>
 <52A9DD23.6070101@rabbitmq.com>
Message-ID: <CAGHWcMUtYZ9VcNU8EQEjuW2SvDw2+z32ONYBdm955zfQFaBhtw@mail.gmail.com>

[
        {rabbit, [
                {disk_free_limit, 2000000000},
                {vm_memory_high_watermark, 0.8},
                {heartbeat, 300},
                {cluster_partition_handling, autoheal}
        ]}
].



On Thu, Dec 12, 2013 at 9:58 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 12/12/2013 15:41, Nicholas Stuart wrote:
>
>> It says  {cluster_partition_handling,autoheal}, are there any other
>> variables I should look for there?
>>
>
> Can you post the complete log file somewhere?
>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/115c702d/attachment.html>

From joshua__lim at hotmail.com  Thu Dec 12 16:34:26 2013
From: joshua__lim at hotmail.com (Joshua Lim)
Date: Thu, 12 Dec 2013 16:34:26 +0000
Subject: [rabbitmq-discuss] How to create a rabbitmq cluster using
 existing application without losing existing data?
In-Reply-To: <52A83F20.1040003@rabbitmq.com>
References: <BLU176-W2953CD322AC2DEF9139C6CADDD0@phx.gbl>,
 <52A83F20.1040003@rabbitmq.com>
Message-ID: <BLU176-W429E7C8AA4F9F0CFEE5C5EADDC0@phx.gbl>

> Date: Wed, 11 Dec 2013 10:32:00 +0000
> From: simon at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: joshua__lim at hotmail.com
> Subject: Re: [rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?
> 
> On 11/12/13 10:26, Joshua Lim wrote:
> > I'm trying to find out if it is possible to create a rabbitmq cluster
> > for an existing production instance with data on it.
> 
> Yes.
> 
> > The reason is
> > because I'm starting with only 1 server for the start and would like to
> > expand to a 2 server cluster only in the future.
> 
> Which makes sense.
> 
> > What I did is:
> >
> > 1. Issue rabbitmqctl stop_app, rabbitmqctl reset, rabbitmqctl stop on
> > both nodes.
> 
> rabbitmqctl reset is the culprit here - it will erase all information on 
> the node.
> 
> > 2. Add auto-config to rabbitmq.config on both nodes:   {cluster_nodes,
> > {['rabbit at existing-machine', 'rabbit at new-machine'], disc}}
> 
> Note that the auto-config lists nodes in an existing cluster that the 
> machine should attempt to contact when coming up from a new installation 
> (or post reset). And a standalone node is a cluster of size one.
> > So what you really wanted to do was:> 
> * Not touch existing-machine
> * Add {cluster_nodes, {['rabbit at existing-machine'], disc}} to new-machine
> * Reset new-machine if you've previously used RabbitMQ on it
> * Start new-machine
Thanks for your pointers, this now works.  :) 
I was a bit confused by the 3 node example (see config below) mentioned in http://www.rabbitmq.com/clustering.html  That's why I put all the nodes into cluster_nodes field.
{cluster_nodes, {['rabbit at rabbit1', 'rabbit at rabbit2', 'rabbit at rabbit3'], disc}},
How about the cluster_nodes configuration field on existing machine?  I left it as {cluster_nodes, {['rabbit at existing-machine', 'rabbit at new-machine'], disc}}
Is that the correct way?  I need active-active ha.  By the way, I've not gone into http://www.rabbitmq.com/ha.html yet.

 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/4586d834/attachment.html>

From simon at rabbitmq.com  Thu Dec 12 16:40:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Dec 2013 16:40:46 +0000
Subject: [rabbitmq-discuss] How to create a rabbitmq cluster using
 existing application without losing existing data?
In-Reply-To: <BLU176-W429E7C8AA4F9F0CFEE5C5EADDC0@phx.gbl>
References: <BLU176-W2953CD322AC2DEF9139C6CADDD0@phx.gbl>,
 <52A83F20.1040003@rabbitmq.com>
 <BLU176-W429E7C8AA4F9F0CFEE5C5EADDC0@phx.gbl>
Message-ID: <52A9E70E.9000600@rabbitmq.com>

On 12/12/2013 16:34, Joshua Lim wrote:
> How about the cluster_nodes configuration field on existing machine?  I 
> left it as {cluster_nodes, {['rabbit at existing-machine', 
> 'rabbit at new-machine'], disc}}

That field will only even be read when the node in question comes up
with a completely blank database (i.e. first start, or after
'rabbitmqctl reset'). That presumably never applies to the existing
machine, so it doesn't matter what you have there.

Cheers, Simon

From simon at rabbitmq.com  Thu Dec 12 16:49:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Dec 2013 16:49:27 +0000
Subject: [rabbitmq-discuss] Network partition detected,
 did not recover gracefully even though cluster_partition_handling =
 autoheal
In-Reply-To: <CAGHWcMUtYZ9VcNU8EQEjuW2SvDw2+z32ONYBdm955zfQFaBhtw@mail.gmail.com>
References: <59272a42-b3d6-4981-965d-f45f04c6675d@googlegroups.com>
 <52A846F8.908@rabbitmq.com>
 <CAGHWcMXbcRqd3x=aRxgFT4MXH0xbZw0T7K+F=rOpO2MVnQfWCA@mail.gmail.com>
 <52A9964A.3020309@rabbitmq.com>
 <CAGHWcMXuXAWaiK5n4ryy3JTyWnx_Ts9ahAxvYKt-fFawtfynVQ@mail.gmail.com>
 <52A9DD23.6070101@rabbitmq.com>
 <CAGHWcMUtYZ9VcNU8EQEjuW2SvDw2+z32ONYBdm955zfQFaBhtw@mail.gmail.com>
Message-ID: <52A9E917.10204@rabbitmq.com>

Ah, sorry, I meant the server log file, not the configuration file.

Cheers, Simon

On 12/12/2013 16:11, Nicholas Stuart wrote:
> [
>          {rabbit, [
>                  {disk_free_limit, 2000000000},
>                  {vm_memory_high_watermark, 0.8},
>                  {heartbeat, 300},
>                  {cluster_partition_handling, autoheal}
>          ]}
> ].
>
>
>
> On Thu, Dec 12, 2013 at 9:58 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 12/12/2013 15:41, Nicholas Stuart wrote:
>
>         It says  {cluster_partition_handling,__autoheal}, are there any
>         other
>         variables I should look for there?
>
>
>     Can you post the complete log file somewhere?
>
>     Cheers, Simon
>
>


From ed.tyrrill at emc.com  Thu Dec 12 17:33:03 2013
From: ed.tyrrill at emc.com (Tyrrill, Ed)
Date: Thu, 12 Dec 2013 12:33:03 -0500
Subject: [rabbitmq-discuss] Error starting rabbitmq in IPv6 environment
In-Reply-To: <52A99504.6080702@rabbitmq.com>
Message-ID: <CECF2FF8.5955F%ed.tyrrill@emc.com>

Hi Simon,

This is what I get:

$ erl -sname foo
Erlang R16B02 (erts-5.10.3) [source] [64-bit] [smp:4:4] [async-threads:10]
[hipe] [kernel-poll:false]

Eshell V5.10.3  (abort with ^G)
(foo at a4ipn434)1> 

a4ipn434 is defined in /etc/hosts, and yes, is resolvable

$ ping6 a4ipn434
PING a4ipn434(a4ipn434.asl.lab.emc.com) 56 data bytes
64 bytes from a4ipn434.asl.lab.emc.com: icmp_seq=1 ttl=64 time=0.035 ms

Note that on linux, many of the legacy/IPv4 versions of system calls do
not work, and you have to use the IPv6 equivalent.  Please let me know if
I can provide you with any further information.

Thanks,
Ed



On 12/12/13 2:50 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>This looks like more of an Erlang-level problem, looks like it is
>failing before RabbitMQ starts starting. Can you start "erl -sname foo"
>in pure IPv6 mode?
>
>And of course, just to make sure, you can resolve a4ipn434, right? :-)
>
>Cheers, Simon
>
>On 11/12/2013 21:20, Tyrrill, Ed wrote:
>> Hi RabbitMQ devs,
>>
>> I have found a bug starting rabbitmq in a linux pure IPv6 environment
>> where /etc/resolv.conf has a "nameserver" line specifying an IPv6
>> address.  This is what I see:
>>
>> # service rabbitmq-server start
>> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
>> _err}
>> rabbitmq-server.
>> # cat /var/log/rabbitmq/startup_log
>> ERROR: epmd error for host "a4ipn434": address (cannot connect to
>>host/port)
>>
>> Note that /etc/hosts specifies the FQ and short hostnames of the
>>machine:
>>
>> 2620:0:170:586::1:1a4ipn434.xxxxxxxxxxx a4ipn434
>>
>> And /etc/resolv.conf specifies a nameserver with an IPv6 address:
>>
>> nameserver 2620:0:170:58e::4
>>
>> If I comment out this nameserver line in resolv.conf, then rabbitmq
>> starts with no problem:
>>
>> # service rabbitmq-server start
>> Starting rabbitmq-server: SUCCESS
>> rabbitmq-server.
>> # cat /var/log/rabbitmq/startup_log
>>
>>                RabbitMQ 3.2.0. Copyright (C) 2007-2013 GoPivotal, Inc.
>>    ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>>    ##  ##
>>    ##########  Logs: /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434.log
>>    ######  ##
>>   /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434-sasl.log
>>    ##########
>>                Starting broker... completed with 0 plugins.
>>
>> Also, FYI, I tried this with rabbitmq versions 3.2.1-1 and 3.2.0-1.
>>
>> Thanks,
>> Ed
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>


From michael.s.klishin at gmail.com  Thu Dec 12 18:31:56 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 12 Dec 2013 22:31:56 +0400
Subject: [rabbitmq-discuss] ANN Machine Head 1.0.0-beta5 is released
Message-ID: <CAE3HoVSJkkN5A32ds4s9P4bV2W1bH-Y5xZgeer94Z_4MwBGOtQ@mail.gmail.com>

Machine Head [1] is a minimalistic Clojure MQTT client.

beta5 is a development milestone release.

Release notes:
http://blog.clojurewerkz.org/blog/2013/12/12/machine-head-1-dot-0-0-beta5-is-released/

1. http://clojuremqtt.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/2e9d8ff7/attachment.html>

From pat at munkiisoft.com  Thu Dec 12 19:31:06 2013
From: pat at munkiisoft.com (Patrick Long)
Date: Thu, 12 Dec 2013 19:31:06 +0000
Subject: [rabbitmq-discuss] Syncing erlang cookie by editing rabbitmq-service
Message-ID: <CALDntb-2SDQJ82X=Lr+yjsnRaKA=SCTynFzDgbj-qBVwmAomjg@mail.gmail.com>

There are lots of posts about copying the cookie file onto all machines in
a cluster.

I don't want to do that. I want to use the setcookie option. I have seen
posts on how you can set it via the rabbitmq-server.bat but seeing as we
are using the windows service I am guess I need to set it via that.

I have tried

set RABBITMQ_SERVER_START_ARGS=-setcookie "HEYEVHYLJHOBGFQASQHK"

and multiple variations off that but it is not picking it up.

Could someone point out the error of my ways

TIA

Pat


-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/e3a75788/attachment.html>

From samir.gahirwal at gmail.com  Thu Dec 12 19:56:21 2013
From: samir.gahirwal at gmail.com (Samir Gahirwal)
Date: Thu, 12 Dec 2013 11:56:21 -0800
Subject: [rabbitmq-discuss] Help: PLAIN login refused: user 'guest' -
 invalid credentials
In-Reply-To: <52A97EFE.2010805@rabbitmq.com>
References: <fa501e45-81d3-43b6-8d6b-8d6e820e6fe7@googlegroups.com>
 <52A97EFE.2010805@rabbitmq.com>
Message-ID: <CAFp5BySrW+aQgkQz96-JAJ_LJfcHd7MSzG4WyJ_ROGxqdVbGEQ@mail.gmail.com>

All applications are using same credentials and there is no issue with
connection. It can connect fine and create/delete queues,


On Thu, Dec 12, 2013 at 1:16 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 11/12/13 22:52, SamirG wrote:
>
> > I checked credentials for guest user, and there is no issue with it.
>
> The most likely cause is an incorrect username or password. How did you
> check the credentials?
>
>
>
>
> -Emile
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/6fc9f8eb/attachment.html>

From steve at rabbitmq.com  Thu Dec 12 22:16:51 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 12 Dec 2013 22:16:51 +0000
Subject: [rabbitmq-discuss] When using rabbitmq-jms
	javax.jms.Message.getJMSDestination does not return the
	actual destination when it is received from a consumer
	listening on a Topic with a wild card
In-Reply-To: <52A76D33.1090909@kaazing.com>
References: <851fdb0f-10a7-4041-a297-983923b2e978@googlegroups.com>
 <F246B1A6-0D8F-41BE-9A63-4BBC6A979738@rabbitmq.com>
 <52A76D33.1090909@kaazing.com>
Message-ID: <3D1E61E9-34ED-4058-9CB2-6C814A6E6FAA@rabbitmq.com>

You are right, it isn't in the release notes -- I wonder why? But the fix is in RJMS 1.1.0, certainly. Sorry for misleading you.
Steve Powell  [M: +44-7815-838-558; H:+44-1962-775-598; W:+44-2380-111-528]
    And you all know, security is mortals? chiefest enemy.
Macbeth: III, 5

Steve Powell  [M: +44-7815-838-558; H:+44-1962-775-598; W:+44-2380-111-528]
    What I tell you three times is true.
Lewis Carroll; Hunting of the Snark: Fit the First

On 10 Dec 2013, at 19:36, Josh Carlson <josh.carlson at kaazing.com> wrote:

> Hi Steve,
> 
> I was wondering if this fix appears in the 1.1 client? It doesn't appear to be in the release notes https://www.vmware.com/support/vfabric-rabbitmq/doc/vfabric-rabbitmq-rn-3.2.html#resolvedissues-rjms
> 
> Thanks
> 
> Josh
> 
> On 09/18/2013 06:57 AM, Steve Powell wrote:
>> Thanks Josh,
>> 
>> This indeed appears to be a bug.  [I go to the trouble of serialising and deserializing the destination and then overwrite it with the Consumer?s destination before returning it!]
>> 
>> I will raise an internal bug and should have this corrected in the next release. Should you require further support this should be requested through the usual vFabric channels.
>> 
>> Steve Powell  [Cell: +44-7815-838-558] [RabbitMQ, Pivotal]
>> ?L?enfer, c?est les autres.? Sartre
>> 
>> On 17 Sep 2013, at 20:21, Josh Carlson <josh.carlson at kaazing.com> wrote:
>> 
>>> When using rabbitmq-jms for vFabric RabbitMQ javax.jms.Message.getJMSDestination does not return the actual destination when it is received from a consumer listening on a Topic with a wild card. I have tested with both 1.0.3 and 1.0.5 clients with RabbitMQ 3.1.5.
>> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/02f7bbb9/attachment.html>

From steve at rabbitmq.com  Thu Dec 12 22:21:01 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 12 Dec 2013 22:21:01 +0000
Subject: [rabbitmq-discuss] When using rabbitmq-jms
	javax.jms.Message.getJMSDestination does not return the
	actual destination when it is received from a consumer
	listening on a Topic with a wild card
In-Reply-To: <3D1E61E9-34ED-4058-9CB2-6C814A6E6FAA@rabbitmq.com>
References: <851fdb0f-10a7-4041-a297-983923b2e978@googlegroups.com>
 <F246B1A6-0D8F-41BE-9A63-4BBC6A979738@rabbitmq.com>
 <52A76D33.1090909@kaazing.com>
 <3D1E61E9-34ED-4058-9CB2-6C814A6E6FAA@rabbitmq.com>
Message-ID: <78AA6658-BCF7-463D-A9E2-87A84287CB0B@rabbitmq.com>

Found out why: the fix went into 1.0.6, which is why it doesn't appear in the 1.1.0 notes.
This was a small fix release, the last in the 1.0.x series.

Steve Powell  [M: +44-7815-838-558; H:+44-1962-775-598; W:+44-2380-111-528]
    What I tell you three times is true.
Lewis Carroll; Hunting of the Snark: Fit the First

On 12 Dec 2013, at 22:16, Steve Powell <steve at rabbitmq.com> wrote:

> You are right, it isn't in the release notes -- I wonder why? But the fix is in RJMS 1.1.0, certainly. Sorry for misleading you.
> Steve Powell  [M: +44-7815-838-558; H:+44-1962-775-598; W:+44-2380-111-528]
>     And you all know, security is mortals? chiefest enemy.
> Macbeth: III, 5
> 
> Steve Powell  [M: +44-7815-838-558; H:+44-1962-775-598; W:+44-2380-111-528]
>     What I tell you three times is true.
> Lewis Carroll; Hunting of the Snark: Fit the First
> 
> On 10 Dec 2013, at 19:36, Josh Carlson <josh.carlson at kaazing.com> wrote:
> 
>> Hi Steve,
>> 
>> I was wondering if this fix appears in the 1.1 client? It doesn't appear to be in the release notes https://www.vmware.com/support/vfabric-rabbitmq/doc/vfabric-rabbitmq-rn-3.2.html#resolvedissues-rjms
>> 
>> Thanks
>> 
>> Josh
>> 
>> On 09/18/2013 06:57 AM, Steve Powell wrote:
>>> Thanks Josh,
>>> 
>>> This indeed appears to be a bug.  [I go to the trouble of serialising and deserializing the destination and then overwrite it with the Consumer?s destination before returning it!]
>>> 
>>> I will raise an internal bug and should have this corrected in the next release. Should you require further support this should be requested through the usual vFabric channels.
>>> 
>>> Steve Powell  [Cell: +44-7815-838-558] [RabbitMQ, Pivotal]
>>> ?L?enfer, c?est les autres.? Sartre
>>> 
>>> On 17 Sep 2013, at 20:21, Josh Carlson <josh.carlson at kaazing.com> wrote:
>>> 
>>>> When using rabbitmq-jms for vFabric RabbitMQ javax.jms.Message.getJMSDestination does not return the actual destination when it is received from a consumer listening on a Topic with a wild card. I have tested with both 1.0.3 and 1.0.5 clients with RabbitMQ 3.1.5.
>>> 
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/995534a8/attachment.html>

From sid.young at gmail.com  Fri Dec 13 06:20:54 2013
From: sid.young at gmail.com (Sid Young)
Date: Thu, 12 Dec 2013 22:20:54 -0800 (PST)
Subject: [rabbitmq-discuss] ant build SimpleAmqpClient
Message-ID: <9c2c5a58-71a1-4753-81ae-1220bcfa8e18@googlegroups.com>


To the maintainer of the SimpleAmqpClient

How the hell do you actually build this and use it in a C++ program under 
Linux???

I have been pulling my hair out trying to build the code and it just fails 
constantly - is their a SIMPLE build process where I just type make and I 
get a library I can link into my code???

is there a simple yum install ???

Sid
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/62510c43/attachment.html>

From carl.hoerberg at gmail.com  Fri Dec 13 07:26:25 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 12 Dec 2013 23:26:25 -0800 (PST)
Subject: [rabbitmq-discuss] cluster crash when setting ha-mode=nodes
Message-ID: <1386919585377-32042.post@n5.nabble.com>

Set ha-mode=nodes on a all of vhosts, from ha-mode=all, to gracefully remove
a node. All queues failover successfully, but then /api/overview stopped
working, nor could we issue rabbitmqctl cluster_status. Tried to stop the
node we were rotating out, it didn't respond. Had to "kill" it after a
couple of minutes. Node 1 and 2 still doesn't respond, tries to issue "sudo
rabbitmqctl eval 'application:stop(rabbitmq_management).'" on node 1,
successfully, but on node 2 it just hangs.. 

Kills node2, node1 rabbitmq_mgmt starts, but still can't query
/api/overview. Kills node1 too, on start up we get a lot of "home node
'rabbit at lemur03' of durable queue 'celery' in vhost 'shycoqhj' is down or
inaccessible", but lemur03 shouldn't be master for any queue anymore! 

RabbitMQ 3.2.1, Erlang R16B01




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/cluster-crash-when-setting-ha-mode-nodes-tp32042.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Fri Dec 13 07:32:42 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 12 Dec 2013 23:32:42 -0800
Subject: [rabbitmq-discuss] ant build SimpleAmqpClient
In-Reply-To: <9c2c5a58-71a1-4753-81ae-1220bcfa8e18@googlegroups.com>
References: <9c2c5a58-71a1-4753-81ae-1220bcfa8e18@googlegroups.com>
Message-ID: <CAAt2po+maJ09W7sAhw4RDaQvPBjhkm=DU_6=UM-G9JHKER1d2A@mail.gmail.com>

What have you tried so far?

A good place to start is to read the README.md file:
https://github.com/alanxz/SimpleAmqpClient/blob/master/README.md

There may or may not be a package available for your OS - you'd have to do
some research to find it.

-Alan

On Thu, Dec 12, 2013 at 10:20 PM, Sid Young <sid.young at gmail.com> wrote:

>
> To the maintainer of the SimpleAmqpClient
>
> How the hell do you actually build this and use it in a C++ program under
> Linux???
>
> I have been pulling my hair out trying to build the code and it just fails
> constantly - is their a SIMPLE build process where I just type make and I
> get a library I can link into my code???
>
> is there a simple yum install ???
>
> Sid
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/3fd345ae/attachment.html>

From pat at munkiisoft.com  Fri Dec 13 07:44:58 2013
From: pat at munkiisoft.com (pat at munkiisoft.com)
Date: Thu, 12 Dec 2013 23:44:58 -0800 (PST)
Subject: [rabbitmq-discuss] Syncing erlang cookie by editing rabbitmq-service
Message-ID: <bce9ae2c-46ef-49aa-a89f-7402aed1752c@googlegroups.com>

There are lots of posts about copying the cookie file onto all machines in 
a cluster.

I don't want to do that. I want to use the setcookie option. I have seen 
posts on how you can set it via the rabbitmq-server.bat but seeing as we 
are using the windows service I am guess I need to set it via that.

I have tried 

set RABBITMQ_SERVER_START_ARGS=-setcookie "HEYEVHYLJHOBGFQASQHK"

and multiple variations off that but it is not picking it up. 

Could someone point out the error of my ways

TIA

Pat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/50605c30/attachment.html>

From joshua__lim at hotmail.com  Fri Dec 13 08:20:44 2013
From: joshua__lim at hotmail.com (Joshua Lim)
Date: Fri, 13 Dec 2013 08:20:44 +0000
Subject: [rabbitmq-discuss] How to create a rabbitmq cluster using
 existing application without losing existing data?
In-Reply-To: <52A9E70E.9000600@rabbitmq.com>
References: <BLU176-W2953CD322AC2DEF9139C6CADDD0@phx.gbl>,
 <52A83F20.1040003@rabbitmq.com>
 <BLU176-W429E7C8AA4F9F0CFEE5C5EADDC0@phx.gbl>, <52A9E70E.9000600@rabbitmq.com>
Message-ID: <BLU176-W5192501C94AAD47F8EED0BADDF0@phx.gbl>

> Date: Thu, 12 Dec 2013 16:40:46 +0000> From: simon at rabbitmq.com
> To: joshua__lim at hotmail.com
> CC: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?
> 
> On 12/12/2013 16:34, Joshua Lim wrote:
> > How about the cluster_nodes configuration field on existing machine?  I 
> > left it as {cluster_nodes, {['rabbit at existing-machine', 
> > 'rabbit at new-machine'], disc}}
> 
> That field will only even be read when the node in question comes up
> with a completely blank database (i.e. first start, or after
> 'rabbitmqctl reset'). That presumably never applies to the existing
> machine, so it doesn't matter what you have there.
> 
> Cheers, Simon


Thanks.  I tried redoing the whole test from scratch - resetting everything new-machine.
When I tried to cluster rabbit at new-machine with rabbit at existing-machine by adding the cluster auto config to new-machine:
       	         {cluster_nodes, {['rabbit at existing-machine'], disc}}
I get the following error:
Error description:   {error,{inconsistent_cluster,"Node rabbit at new-machine thinks it's clustered with node rabbit at existing-machine, but rabbit at existing-machine disagrees"}}
I managed to solve this by adding the same auto config to rabbit at existing-machine - this must be done before rabbitmq is started for the first time - which means I need to reset my existing machine.  Is this correct, or am I missing something?
       	         {cluster_nodes, {['rabbit at existing-machine'], disc}}
Rgds,Joshua





 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/17112b77/attachment.html>

From raj.kumar.sanpui at gmail.com  Fri Dec 13 08:36:28 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 00:36:28 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out in
	consumer?
Message-ID: <1386923788150-32046.post@n5.nabble.com>


I desperately need a help. I have been slogging last couple of nights, but
could not make it work !!!!!!

I have a program in which a seperate thread publishes a message, and a
consumer accepts it after ensuring the socket is readable (select), and
ensuring and there are no frames enqueued (amqp_frames_enqueued) or data in
buffer (amqp_data_in_buffer).

But though the log says, the message is indeed published to the queue, it
always times out.
There was a similar example posted on the same forum, which i followed, but
nothing works for me, and i always receive a timeout.

Please help !!!!

Here is my consumer code, till the point where it timedout.


void *con(void *arg) {
                        amqp_bytes_t queue;
                std::string message;
                printf("%s %s\n",__FUNCTION__,(char *) arg);

                Debug("%s() - Get an mq connection\n", __FUNCTION__);
                amqConnection *conn =  util.getAMQConnection ();
                if (conn == NULL) {
                        ErrLog("%s() - get connection failed\n",
__FUNCTION__);
                        pthread_exit(0) ;
                }
                Debug("%s() - declare exchange %s\n", __FUNCTION__,
EXCHANGE);
                int rc = conn->declareExchange(EXCHANGE, QUEUETYPE, 1);
                if (rc != 0) {
                        ErrLog("%s() - declare exchange %s %s failed\n",
__FUNCTION__, EXCHANGE, QUEUETYPE);
                        util.returnAMQConnection(conn);
                        pthread_exit(0) ;
                }

                Debug("%s() - consume  %s\n", __FUNCTION__,ROUTINGKEY );
                amqp_connection_state_t *state;
                state = conn->getConnectionState( );
                if (state == NULL)
                        printf("Could not receive connection state
object\n");

                if (!amqp_frames_enqueued(*state) &&
!amqp_data_in_buffer(*state)) {
                         int sock = amqp_get_sockfd(*state);
                         printf("socket: %d\n", sock);
                         int flags = fcntl(sock, F_GETFL, 0);
                         fcntl(sock, F_SETFL, flags | O_NONBLOCK);
                         int ret = 0;
                         do {
                                struct timeval timeout;
                                fd_set read_flags;
                                FD_ZERO(&read_flags);
                                FD_SET(sock, &read_flags);
                                /* Wait upto a second. */

                                timeout.tv_sec = 5;
                                timeout.tv_usec = 0;
                                ret = select(sock+1, &read_flags, NULL,
NULL, &timeout);
                                if (ret == -1)
                                        printf("select: %s\n",
strerror(errno));
                                else if (ret == 0)
                                        printf("select timedout\n");

                                 if (FD_ISSET(sock, &read_flags)) {
                                        printf("Flag is set\n");
                                        message = conn->consume(QUEUENAME,
EXCHANGE, ROUTINGKEY);
                                        if (0 == message.length()) {
                                                ErrLog("%s() - consume queue
%s failed\n", __FUNCTION__, QUEUENAME);
                                                printf("%s() - consume queue
%s failed\n", __FUNCTION__, QUEUENAME);
                                                rc =
conn->deleteQueue(QUEUENAME);
                                                if (rc != 0) {
                                                        ErrLog("%s() -
delete queue %s failed\n", __FUNCTION__, QUEUENAME);
                                                }
                                               
util.returnAMQConnection(conn);
                                                pthread_exit(0) ;

                                        }
                                }
                        } while (ret == 0);
                }




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From armen.michaeli at gmail.com  Thu Dec 12 16:36:08 2013
From: armen.michaeli at gmail.com (Armen Michaeli)
Date: Thu, 12 Dec 2013 17:36:08 +0100
Subject: [rabbitmq-discuss] Where/how does RabbitMQ store its users? I am
 getting same user list with two different servers
Message-ID: <CAHKDcORPJ-V5n3XXM2_xnCdNuLX=OSwRh4Uc4MmkiEGXxtteYQ@mail.gmail.com>

I had some authentication issues with 3.2.2 so I copied an installation of
3.2.1 I had from another host, but whichever server I run, rabbitmqcl
list_users gives me the list of the users I had been "adding" when 3.2.2
was running. What's going on?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/2ece9a10/attachment.html>

From raj.kumar.sanpui at gmail.com  Thu Dec 12 20:11:09 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Thu, 12 Dec 2013 12:11:09 -0800 (PST)
Subject: [rabbitmq-discuss] Why is my consumer unable to receive any
 message? amqp_simple_wait_frame returns less than zero.
Message-ID: <1386879069535-32037.post@n5.nabble.com>

I am creating a queue, using the rabbitmq GUI, declaring exchanges, and
routing keys as needed. For some reason "amqp_simple_wait_frame" returns
less than 0 always, and my program does not consume any messages.

Please help.

Here is my code.

std::string consume(std::string queuename, std::string exchange, std::string
routingkey, amqp_connection_state_t conn) {

        //if (exchange.length() > 0) bindQueue(queuename.c_str(),
exchange.c_str(), routingkey.c_str());
        //amqp_queue_bind(conn, 1,
        //                amqp_cstring_bytes(QUEUENAME),
        //                amqp_cstring_bytes(EXCHANGE),
        //                amqp_cstring_bytes(ROUTINGKEY),
        //                amqp_empty_table);
        amqp_basic_consume(conn, 1, amqp_cstring_bytes(queuename.c_str()),
amqp_empty_bytes, 0, 1, 0, amqp_empty_table);
        amqp_get_rpc_reply(conn);

        amqp_frame_t frame;
        int result;

        amqp_basic_deliver_t *d;
        amqp_basic_properties_t *p;
        size_t body_target;
        size_t body_received;

        amqp_maybe_release_buffers(conn);
        result = amqp_simple_wait_frame(conn, &frame);
        if (result < 0) {
                printf("%s Returning as result < 0\n",__FUNCTION__);
                //if (exchange.length() > 0) unbindQueue(queuename.c_str(),
exchange.c_str(), routingkey.c_str());
                return "";
        }

        printf("%s Frame type %d, channel %d\n",__FUNCTION__,
frame.frame_type, frame.channel);
        if (frame.frame_type != AMQP_FRAME_METHOD) {
                //if (exchange.length() > 0) unbindQueue(queuename.c_str(),
exchange.c_str(), routingkey.c_str());
                return "";
        }

        printf("%s Method %s\n", __FUNCTION__,
amqp_method_name(frame.payload.method.id));
        if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD) {
                //if (exchange.length() > 0) unbindQueue(queuename.c_str(),
exchange.c_str(), routingkey.c_str());
                return "";
        }

        d = (amqp_basic_deliver_t *) frame.payload.method.decoded;
        printf("%s Delivery %u, exchange %.*s routingkey
%.*s\n",__FUNCTION__,
                        (unsigned) d->delivery_tag,
                        (int) d->exchange.len, (char *) d->exchange.bytes,
                                                                                          
     (int) d->routing_key.len, (char *) d->routing_key.bytes);

        result = amqp_simple_wait_frame(conn, &frame);
        if (result < 0) {
                //if (exchange.length() > 0) unbindQueue(queuename.c_str(),
exchange.c_str(), routingkey.c_str());
                return "";
        }
        if (frame.frame_type != AMQP_FRAME_HEADER) {
                printf( "%s Expected header!",__FUNCTION__);
                //unbindQueue(queuename.c_str(), exchange.c_str(),
routingkey.c_str());
                return "";
        }
        p = (amqp_basic_properties_t *) frame.payload.properties.decoded;
        if (p->_flags & AMQP_BASIC_CONTENT_TYPE_FLAG) {
                printf("%s Content-type: %.*s\n",__FUNCTION__,
                                (int) p->content_type.len, (char *)
p->content_type.bytes);
        }
        //Debug("%s ----\n", __FUNCTION__);

        body_target = frame.payload.properties.body_size;
        body_received = 0;
        std::string response="";
        while (body_received < body_target) {
                result = amqp_simple_wait_frame(conn, &frame);
                if (result < 0)
                        break;

                if (frame.frame_type != AMQP_FRAME_BODY) {
                        printf( " %s Expected body!", __FUNCTION__);
                        break;
                }

                body_received += frame.payload.body_fragment.len;
                //assert(body_received <= body_target);

                //amqp_dump(frame.payload.body_fragment.bytes,
                //              frame.payload.body_fragment.len);
                response += std::string((char *)
frame.payload.body_fragment.bytes, body_received );
        }


        //if (exchange.length() > 0) unbindQueue(queuename.c_str(),
exchange.c_str(), routingkey.c_str());
        return response;
}

int main()
{
  amqp_connection_state_t conn;
  conn = amqp_new_connection();

  amqp_exchange_declare(conn, 1, amqp_cstring_bytes(EXCHANGE),
amqp_cstring_bytes(QUEUETYPE),\
                                0, 1, amqp_empty_table);
  std::string queuename="myPrefetchQ";
  amqp_queue_bind(conn, 1,
                        amqp_cstring_bytes(QUEUENAME),
                        amqp_cstring_bytes(EXCHANGE),
                        amqp_cstring_bytes(ROUTINGKEY),
                        amqp_empty_table);

  std::string consumed = consume(QUEUENAME, EXCHANGE, \
                ROUTINGKEY, conn);
  cout << "Received: ";
  cout << consumed;
}




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-my-consumer-unable-to-receive-any-message-amqp-simple-wait-frame-returns-less-than-zero-tp32037.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tcatyb at gmail.com  Thu Dec 12 20:38:48 2013
From: tcatyb at gmail.com (Tom Catyb)
Date: Thu, 12 Dec 2013 12:38:48 -0800 (PST)
Subject: [rabbitmq-discuss] Nodes in space
Message-ID: <581ff28a-5ad4-4aa9-94a9-cb03700b4bc0@googlegroups.com>

I was attempting to try clustering on a single node.
Everything looked great for workings until I decided to move them from RAM 
to disk nodes
Then, all heck broke loose and I have 2 nodes (maybe 3-4, cannot tell) that 
are down, can't be replaced, and just won't go away?

I thought it may have been when I activated the management plugins, but 
those are gone with no success.
I have restarted rabbitmq-server at least 10 times. I have rebooted the 
server.

None of which seems to have any effect. These are RAM nodes, so they should 
just go away. they did during my initial testing.

Help, I would hate to uninstall rabbit for no apparent good reason, as this 
will make me redo an Openstack server with 15 instances running.

Anybody out there ??

Thanks,
Tom C

We are the people our parents warned us about
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/d5f6ea94/attachment.html>

From tcatyb at gmail.com  Thu Dec 12 21:55:52 2013
From: tcatyb at gmail.com (Tom Catyb)
Date: Thu, 12 Dec 2013 13:55:52 -0800 (PST)
Subject: [rabbitmq-discuss] Nodes in space
In-Reply-To: <581ff28a-5ad4-4aa9-94a9-cb03700b4bc0@googlegroups.com>
References: <581ff28a-5ad4-4aa9-94a9-cb03700b4bc0@googlegroups.com>
Message-ID: <2d8b90d3-317a-4f7b-9a83-604e306342e6@googlegroups.com>

I made a tad bit of progress (?) in this.
I emptied the mnesia folder and restarted rabbit. The nodes still exist, 
but don't show up unless I try to use them.
Also, if I try to add a new node it just goes to space, and I cannot 
re-create a node by the old name properly.

Nothing other than the existing "rabbit" node will respond to start/stop 
commands

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/be5e55f5/attachment.html>

From mike at meshfire.com  Fri Dec 13 02:19:57 2013
From: mike at meshfire.com (MikeTempleman)
Date: Thu, 12 Dec 2013 18:19:57 -0800 (PST)
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
Message-ID: <1386901196928-32040.post@n5.nabble.com>

Tyson

Did you ever find an answer to this question? We are encountering virtually
the exact same problem.

We have a variable number of servers setup as producers and consumers and
see our throughput drop to zero on a periodic basis. This is most severe
when there are a few hundred thousand messages on rabbit.

Did you just drop Rabbit? Ours is running on an m1.large instance with RAID0
ephemeral drives, so size and performance of the disk subsystem is not an
issue (we are still in beta). We have spent untold hours tuning our sharded
mongodb subsystem only to find out that it is only being 25% utilized (at
least it will be blazing fast if we ever figure this out).





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ranjith.v at zohocorp.com  Fri Dec 13 09:12:59 2013
From: ranjith.v at zohocorp.com (Ranjith Venkatesan)
Date: Fri, 13 Dec 2013 01:12:59 -0800 (PST)
Subject: [rabbitmq-discuss] BasicQos Multiple msg ack
Message-ID: <1386925979353-32047.post@n5.nabble.com>

Hi,

I am new to RabbitMq. I am experimenting rabbitmq for past two days. In my
case, I want to fetch 100 messages from queue. It can be accomplished with
help of *channel.basicQos(100);*. But how to acknowledge for those bulk 100
messages? 


channel.basicAck(*???*, true);

My question is how to get deliveryTag for multiple msgs ? 


With regards

RANJITH VENKATESAN



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/BasicQos-Multiple-msg-ack-tp32047.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From rreyeslopez at hotmail.com  Fri Dec 13 10:15:14 2013
From: rreyeslopez at hotmail.com (rafareyeslopez)
Date: Fri, 13 Dec 2013 02:15:14 -0800 (PST)
Subject: [rabbitmq-discuss] Restarting Consumer appears often
In-Reply-To: <CADtU9_tev_J9wf3tr7JMfT5GQNwrzKh3JPO5tO1=mHTK1H_2PQ@mail.gmail.com>
References: <31c17a04-1e42-45f9-aae4-9269523ee599@googlegroups.com>
 <CADtU9_tev_J9wf3tr7JMfT5GQNwrzKh3JPO5tO1=mHTK1H_2PQ@mail.gmail.com>
Message-ID: <1386929714556-32048.post@n5.nabble.com>

hi,the full trace I get is:DEBUG [2013-12-13 11:09:38,335]
(AbstractConsumerMessage.java:handleListenerException:43) - ERROR
handleStartupFailure rabbit consumer - NOT IllegalStateException No message
listener specified - see property 'messageListener' WARN [2013-12-13
11:09:38,347] (SimpleMessageListenerContainer.java:run:569) - Consumer
raised exception, processing can restart if the connection factory supports
itjava.lang.IllegalStateException: No message listener specified - see
property 'messageListener'        at
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:494)       
at
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(SimpleMessageListenerContainer.java:58)       
at
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(SimpleMessageListenerContainer.java:107)       
at
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(SimpleMessageListenerContainer.java:608)       
at
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:454)       
at
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:471)       
at
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:455)       
at
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$300(SimpleMessageListenerContainer.java:58)       
at
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:548)       
at java.lang.Thread.run(Thread.java:662) INFO [2013-12-13 11:09:38,348]
(SimpleMessageListenerContainer.java:run:598) - Restarting Consumer:
tag=[amq.ctag-36SFE6xkz42Nps6nZ2Eqww], channel=Cached Rabbit Channel:
AMQChannel(amqp://guest at 127.0.1.1:5672/,6221), acknowledgeMode=AUTO local
queue size=0Why is telling me about the propery messageListener ? No message
listener specified - see property 'messageListener'I have my xml file for
configuration something like this:						                					        One
more question, can it be if a consumer raises this kind of exception and
inside do some query to database; leave the database connection open?Thanks
in advance, I do appreciate help here.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Restarting-Consumer-appears-often-tp30919p32048.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/1b83cb2a/attachment.html>

From james.andres at gmail.com  Fri Dec 13 10:57:50 2013
From: james.andres at gmail.com (James Andres)
Date: Fri, 13 Dec 2013 02:57:50 -0800 (PST)
Subject: [rabbitmq-discuss] Cannot delete queue using rabbitmq_management or
	rabbitmqadmin tool
Message-ID: <3cb4d85e-f894-4b5d-8920-b6948f82f582@googlegroups.com>

Hello,

I'm testing a 3 node RabbitMQ 3.1.5 cluster on Ubuntu using VirtualBox. In 
two cases so far I have managed to create queues which were unbindable and 
undeletable. The management web UI does not display any stats on the stuck 
queues and displays "Waiting for data...". I am using a headers exchange 
but I've had this happen with a topic exchange too. Both times it was a 
durable queue. Once it was a named queue, another time was an exclusive 
unnamed (eg: 'amq.ABC.123456') queue.

Is this a common problem? How does one go about forcibly deleting a queue 
without resetting the entire cluster?

Much appreciated,

James

PS: More specs: 3 VM's are Ubuntu 12.04, Erlang R14B04, Cluster config is 
SSL, am using a RabbitMQ vhost for all of this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/eb14f6eb/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 13 11:05:59 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Dec 2013 15:05:59 +0400
Subject: [rabbitmq-discuss] Where/how does RabbitMQ store its users? I
 am getting same user list with two different servers
In-Reply-To: <CAHKDcORPJ-V5n3XXM2_xnCdNuLX=OSwRh4Uc4MmkiEGXxtteYQ@mail.gmail.com>
References: <CAHKDcORPJ-V5n3XXM2_xnCdNuLX=OSwRh4Uc4MmkiEGXxtteYQ@mail.gmail.com>
Message-ID: <CAE3HoVSxQ4ofD2KZ1FUvdT0v+TW0q3A5WHk2MxtO7YQAuQ3oeA@mail.gmail.com>

2013/12/12 Armen Michaeli <armen.michaeli at gmail.com>

> I had some authentication issues with 3.2.2 so I copied an installation of
> 3.2.1 I had from another host, but whichever server I run, rabbitmqcl
> list_users gives me the list of the users I had been "adding" when 3.2.2
> was running. What's going on?


Users are stored in a distributed database called Mnesia. If your servers
are not clustered, then likely rabbitmqctl
contacts the same node instead of two different nodes. If they are
clustered, both nodes have a consistent view
of the users table, which is expected.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/1439262b/attachment.html>

From saurabh.infoedge at gmail.com  Fri Dec 13 11:08:25 2013
From: saurabh.infoedge at gmail.com (Saurabh Sharma)
Date: Fri, 13 Dec 2013 16:38:25 +0530
Subject: [rabbitmq-discuss] Server getting shutdown after being ideal for 1
	hour
Message-ID: <CABjnW3umsgQX4z1KAGH6AjgpoFEKGsS+4MAzA=QBrrXuaenjBw@mail.gmail.com>

Hi,
I am using generic RabbitMQ server for unix and its working fine.
I am facing a problem where i have started consumer and RabbitMQ server but
not pushing any message to RabbitMQ server.
*After 1 hour of continuous run , My RabbitMQ server is getting shut down
abruptly.*
is there any time setting which are causing this abrupt shutdown ?

Thanks and Regards
Saurabh Sharma
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/326f92f8/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 13 11:08:42 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Dec 2013 15:08:42 +0400
Subject: [rabbitmq-discuss] Nodes in space
In-Reply-To: <581ff28a-5ad4-4aa9-94a9-cb03700b4bc0@googlegroups.com>
References: <581ff28a-5ad4-4aa9-94a9-cb03700b4bc0@googlegroups.com>
Message-ID: <CAE3HoVQU4FEX4ZL+16WfPyxCkOCjCFTtoBPZ-xWsAinGJ0GZfw@mail.gmail.com>

2013/12/13 Tom Catyb <tcatyb at gmail.com>

> Everything looked great for workings until I decided to move them from RAM
> to disk nodes
> Then, all heck broke loose and I have 2 nodes (maybe 3-4, cannot tell)
> that are down, can't be replaced, and just won't go away?
>
> I thought it may have been when I activated the management plugins, but
> those are gone with no success.
> I have restarted rabbitmq-server at least 10 times. I have rebooted the
> server.
>
> None of which seems to have any effect. These are RAM nodes, so they
> should just go away. they did during my initial testing.
>

You haven't provided any info about how the nodes were removed from the
cluster and re-added.

See Changing Node Types and Breaking Up a Cluster in [1].

1. http://www.rabbitmq.com/clustering.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/40cebb07/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 13 11:11:45 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Dec 2013 15:11:45 +0400
Subject: [rabbitmq-discuss] BasicQos Multiple msg ack
In-Reply-To: <1386925979353-32047.post@n5.nabble.com>
References: <1386925979353-32047.post@n5.nabble.com>
Message-ID: <CAE3HoVQXsXON-s0MGrxZRs2Vr7b89uikpnHv2Qu=q1dV-PMCAQ@mail.gmail.com>

2013/12/13 Ranjith Venkatesan <ranjith.v at zohocorp.com>

> I am new to RabbitMq. I am experimenting rabbitmq for past two days. In my
> case, I want to fetch 100 messages from queue. It can be accomplished with
> help of *channel.basicQos(100);*.
>

Note that basic.qos only has effect on consumers using basic.consume, not
basic.get.


> But how to acknowledge for those bulk 100
> messages?
>
>
> channel.basicAck(*???*, true);
>
> My question is how to get deliveryTag for multiple msgs ?
>

See description of the multiple argument:

http://www.rabbitmq.com/releases/rabbitmq-java-client/current-javadoc/
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/50b6095c/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 13 11:14:43 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Dec 2013 15:14:43 +0400
Subject: [rabbitmq-discuss] Cannot delete queue using
 rabbitmq_management or rabbitmqadmin tool
In-Reply-To: <3cb4d85e-f894-4b5d-8920-b6948f82f582@googlegroups.com>
References: <3cb4d85e-f894-4b5d-8920-b6948f82f582@googlegroups.com>
Message-ID: <CAE3HoVRd6cRaZoYGucpjGcU21oKUTTR_p=jKw-h-ZnVMnX7ruQ@mail.gmail.com>

2013/12/13 James Andres <james.andres at gmail.com>

>  The management web UI does not display any stats on the stuck queues and
> displays "Waiting for data..."
>

What is in the logs? What does rabbitmqctl report produce? Have you tried
3.2.2?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/c4938def/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 13 11:15:41 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Dec 2013 15:15:41 +0400
Subject: [rabbitmq-discuss] Restarting Consumer appears often
In-Reply-To: <1386929714556-32048.post@n5.nabble.com>
References: <31c17a04-1e42-45f9-aae4-9269523ee599@googlegroups.com>
 <CADtU9_tev_J9wf3tr7JMfT5GQNwrzKh3JPO5tO1=mHTK1H_2PQ@mail.gmail.com>
 <1386929714556-32048.post@n5.nabble.com>
Message-ID: <CAE3HoVQzyJBVmkBp+MQ=aNbH9m7M_Jqi+pbMiCtBWDBXuT_LNA@mail.gmail.com>

2013/12/13 rafareyeslopez <rreyeslopez at hotmail.com>

> hi, the full trace I get is: DEBUG [2013-12-13 11:09:38,335]
> (AbstractConsumerMessage.java:handleListenerException:43) - ERROR
> handleStartupFailure rabbit consumer - NOT IllegalStateException No message
> listener specified - see property 'messageListener'
>

Sounds like you need to specify a message listener.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/b76df742/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 13 11:19:21 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Dec 2013 15:19:21 +0400
Subject: [rabbitmq-discuss] Server getting shutdown after being ideal
 for 1 hour
In-Reply-To: <CABjnW3umsgQX4z1KAGH6AjgpoFEKGsS+4MAzA=QBrrXuaenjBw@mail.gmail.com>
References: <CABjnW3umsgQX4z1KAGH6AjgpoFEKGsS+4MAzA=QBrrXuaenjBw@mail.gmail.com>
Message-ID: <CAE3HoVSEgXAejW=EvzCtFKYDfWnju45nyugxXxrKANg6VWhgQg@mail.gmail.com>

2013/12/13 Saurabh Sharma <saurabh.infoedge at gmail.com>

> *After 1 hour of continuous run , My RabbitMQ server is getting shut down
> abruptly.*
> is there any time setting which are causing this abrupt shutdown ?


Are you sure it's RabbitMQ that's being shut down and not a TCP connection
from
a client? What's in the logs?

Make sure you have heartbeats [1] enabled (default timeout is about 10
minutes). Can there be a firewall
or another intermediary that closes "stale" TCP connections?

1. http://www.rabbitmq.com/reliability.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/97600eae/attachment.html>

From rreyeslopez at hotmail.com  Fri Dec 13 11:38:17 2013
From: rreyeslopez at hotmail.com (rafareyeslopez)
Date: Fri, 13 Dec 2013 03:38:17 -0800 (PST)
Subject: [rabbitmq-discuss] Restarting Consumer appears often
In-Reply-To: <CAE3HoVQzyJBVmkBp+MQ=aNbH9m7M_Jqi+pbMiCtBWDBXuT_LNA@mail.gmail.com>
References: <31c17a04-1e42-45f9-aae4-9269523ee599@googlegroups.com>
 <CADtU9_tev_J9wf3tr7JMfT5GQNwrzKh3JPO5tO1=mHTK1H_2PQ@mail.gmail.com>
 <1386929714556-32048.post@n5.nabble.com>
 <CAE3HoVQzyJBVmkBp+MQ=aNbH9m7M_Jqi+pbMiCtBWDBXuT_LNA@mail.gmail.com>
Message-ID: <1386934697126-32061.post@n5.nabble.com>

Sorry I didnt added my config example, here it is:


	<rabbit:connection-factory id="connectionFactory" />
	<bean id="amqpTemplate"
class="org.springframework.amqp.rabbit.core.RabbitTemplate">
		<property name="connectionFactory" ref="connectionFactory" />
	</bean>

	<rabbit:admin connection-factory="connectionFactory" />

       <rabbit:queue durable="true" name="queue1" />

	<bean id="consumerqueue1" class="net.test.example.consumer.ConsumerQueue">
		<property name="connectionFactory" ref="connectionFactory" />
		<property name="queueNames" value="queue1" />
	</bean>


	<rabbit:listener-container
		connection-factory="connectionFactory">

		<rabbit:listener method="handle" ref="consumerqueue1"
			queues="queue1" />

</rabbit:listener-container>


All works fine, i mean messages are consumed. The issue is that log trace
appearing often and what makes me worry is that it can cause some system
degratation or even affect the database connections as consumers sometimes
have something to do with the database.

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Restarting-Consumer-appears-often-tp30919p32061.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From pat at munkiisoft.com  Fri Dec 13 13:54:24 2013
From: pat at munkiisoft.com (pat at munkiisoft.com)
Date: Fri, 13 Dec 2013 05:54:24 -0800 (PST)
Subject: [rabbitmq-discuss] help!!!!!!!!thx!!!
In-Reply-To: <89fdbc9f-46a7-444a-be2e-d662e0b98e0c@googlegroups.com>
References: <89fdbc9f-46a7-444a-be2e-d662e0b98e0c@googlegroups.com>
Message-ID: <aa2047a6-f855-4c00-8f6c-45d86bbcb06e@googlegroups.com>

It is definitely there. See the docs,https://www.rabbitmq.com/man/rabbitmqctl.1.man.html#Policy 
Management

Check their example

On Tuesday, December 3, 2013 2:08:25 AM UTC, cugb... at gmail.com wrote:
>
> rabbitmqctl set_policy ha-all "^ha\." '{"ha-mode":"all"}'
>
> this command is error?
>
> Error: invalid command 'set_policy ha-all ^ha\. {"ha-mode":"all"}'
>
>
> help!!!!
>
> why ? I can't find set_policy in rabbitmqctl........thankyou!!!
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/c909bb61/attachment.html>

From videlalvaro at gmail.com  Fri Dec 13 14:02:02 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 Dec 2013 14:02:02 +0000
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <1386901196928-32040.post@n5.nabble.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
Message-ID: <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>

Mike,

Would you be able to provide information more information to help us
debug the problem?

Tim (from the rabbitmq team) requested more info in order to try to
find answers for this.

For example, when consumption drops to zero, are there any logs on the
rabbitmq server that might tell of a flow control mechanism being
activated?

Regards,

Alvaro


On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <mike at meshfire.com> wrote:
> Tyson
>
> Did you ever find an answer to this question? We are encountering virtually
> the exact same problem.
>
> We have a variable number of servers setup as producers and consumers and
> see our throughput drop to zero on a periodic basis. This is most severe
> when there are a few hundred thousand messages on rabbit.
>
> Did you just drop Rabbit? Ours is running on an m1.large instance with RAID0
> ephemeral drives, so size and performance of the disk subsystem is not an
> issue (we are still in beta). We have spent untold hours tuning our sharded
> mongodb subsystem only to find out that it is only being 25% utilized (at
> least it will be blazing fast if we ever figure this out).
>
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From raj.kumar.sanpui at gmail.com  Fri Dec 13 14:21:11 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 06:21:11 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <1386923788150-32046.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
Message-ID: <1386944471298-32064.post@n5.nabble.com>

This is my latest code which DOES NOT WORK !!!


int amqConnection::isQueueReadable()
{
  int sock = amqp_get_sockfd(conn);
  printf("socket: %d\n", sock);
  int flags = fcntl(sock, F_GETFL, 0);
  fcntl(sock, F_SETFL, flags | O_NONBLOCK);
  if (!amqp_frames_enqueued(conn) && !amqp_data_in_buffer(conn)) {
                         int ret = 0;
                                struct timeval timeout;
                                fd_set read_flags;
                                /* Wait upto a second. */

                        do {
                                FD_ZERO(&read_flags);
                                FD_SET(amqp_get_sockfd(conn), &read_flags);
                                timeout.tv_sec = 5;
                                timeout.tv_usec = 0;
                                ret = select(sock+1, &read_flags, NULL,
NULL, &timeout);
                                if (ret == -1)
                                {
                                        printf("select: error: %d\n",
errno);
                                        return -1;
                                }
                                else if (ret == 0)
                                {
                                        printf("select timedout\n");
                                }


                                if (FD_ISSET(sock, &read_flags)) {
                                        printf("Flag is set\n");
                                        return 1;
                                }
                        } while (ret == 0);
  }
  printf("Buffers started filling\n");
  return -1;
}




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32064.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Fri Dec 13 14:24:45 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Dec 2013 18:24:45 +0400
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
 in consumer?
In-Reply-To: <1386944471298-32064.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
Message-ID: <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>

2013/12/13 kingsmasher1 <raj.kumar.sanpui at gmail.com>

> This is my latest code which DOES NOT WORK !!!


It may be more productive if you try being a little more specific than that.

What are your expectations? What are you trying to do? Is there actually
any data
coming to the client? (e.g. are you sure that your messages are routed the
way you expect).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/5cfa2084/attachment.html>

From raj.kumar.sanpui at gmail.com  Fri Dec 13 14:34:13 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 06:34:13 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
Message-ID: <1386945253253-32066.post@n5.nabble.com>

Hi Michael,

Thanks for the reply.
I have a queue created, with specific exchanges and routing key.

One of my threads, in the program goes ahead and publishes the data in the
queue, the main function tries to see, if there is any data available in the
queue, (which can be consumed).

That's what the above function does.
If i remove the above function, and directly fire the publishers and the
consumers, everything works fine, which shows that data is indeed published
to the queue which can be consumed.

But still for some reason, the above function always times out.

Thanks,




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32066.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From raj.kumar.sanpui at gmail.com  Fri Dec 13 14:41:31 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 06:41:31 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <1386945253253-32066.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
Message-ID: <1386945691847-32067.post@n5.nabble.com>

In short, i am trying to design a non-blocking consumer, by using the
"select" which looks if the file descriptor is readable (or in short, if
there is any message available in the queue).





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32067.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Dec 13 14:58:25 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 13 Dec 2013 18:58:25 +0400
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <1386945691847-32067.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
Message-ID: <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>

On 13 Dec 2013, at 18:41, kingsmasher1 <raj.kumar.sanpui at gmail.com> wrote:

> In short, i am trying to design a non-blocking consumer, by using the
> "select" which looks if the file descriptor is readable (or in short, if
> there is any message available in the queue).

select(2) will not indicate that there are messages in the queue. It will indicate
when there?s data available to read on the socket.

basic.get will return basic.get-empty when there are no messages to fetch.
Do you use basic.get in your code? (I?m not familiar with librabbitmq-c to tell if it
supports basic.consume)

Are you sure that messages are actually routed to the queue? (use Management UI to find this out)
Is there any data flowing from RabbitMQ to your process?

Finding answers to these 3 questions will greatly narrow down search space.

MK

Software Engineer, Pivotal/RabbitMQ



From raj.kumar.sanpui at gmail.com  Fri Dec 13 15:29:44 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 07:29:44 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
Message-ID: <1386948584168-32069.post@n5.nabble.com>

We are actually using amqp_basic_consume(  ).
I see the difference between them:
https://github.com/alanxz/rabbitmq-c/issues/37

Thus, to check indeed there are any messages in the queue, i will have to
keep on calling basic.get in a loop, that's as good as a blocking call like,
basic.consume

[Regarding your earlier reply about select( ), the file descriptor becomes
readable when, if there are any messages in the queue, right?]

The best is:
Do we have any API which can just check how many (or if there is any)
message in the queue?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32069.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Fri Dec 13 15:43:06 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 13 Dec 2013 07:43:06 -0800
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
 in consumer?
In-Reply-To: <1386948584168-32069.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
Message-ID: <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>

Raj;

The problem with your above code is that you've put the socket descriptor
in non-blocking mode and rabbitmq-c doesn't expect this, so when it tries
to recv() it gets a error it doesn't understand.

Instead of using select() directly, I'd suggest using a higher-level
non-blocking API such as
amqp_consume_message()<https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L2151>
to
wait for a message with a time-out.  An example of how to use this API can
be found in the
amqp_consumer.c<https://github.com/alanxz/rabbitmq-c/blob/master/examples/amqp_consumer.c>example.

HTH
-Alan


On Fri, Dec 13, 2013 at 7:29 AM, kingsmasher1 <raj.kumar.sanpui at gmail.com>wrote:

> We are actually using amqp_basic_consume(  ).
> I see the difference between them:
> https://github.com/alanxz/rabbitmq-c/issues/37
>
> Thus, to check indeed there are any messages in the queue, i will have to
> keep on calling basic.get in a loop, that's as good as a blocking call
> like,
> basic.consume
>
> [Regarding your earlier reply about select( ), the file descriptor becomes
> readable when, if there are any messages in the queue, right?]
>
> The best is:
> Do we have any API which can just check how many (or if there is any)
> message in the queue?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32069.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/8730db59/attachment.html>

From raj.kumar.sanpui at gmail.com  Fri Dec 13 15:46:28 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 07:46:28 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <1386948584168-32069.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
Message-ID: <1386949588017-32071.post@n5.nabble.com>

This is the output of rabbitmqctl:

ServerIFM33:/tmp # /usr/sbin/rabbitmqctl list_queues
Listing queues ...
file.ingest     0
MyprefetchQ     0
file.storage    0
file.dc.commit  0
file.alert      0
file.purge      0
file.archive    0
file.dc.receive 0
...done.

MyprefetchQ is the one i am interested in polling.
It does not show any messages, how are the messages getting dropped, when
the publisher is indeed publishing them? What's wrong?

If i fire the consumers, immediately the messages are consumed. Why the
queue isn't able to hold messages? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32071.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Fri Dec 13 15:52:56 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 13 Dec 2013 07:52:56 -0800
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
 in consumer?
In-Reply-To: <1386949588017-32071.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <1386949588017-32071.post@n5.nabble.com>
Message-ID: <CAAt2po+EaqqoSCTQCTQLg2SZp81jhTRX=EFhJC8U=r3mJ0S7gw@mail.gmail.com>

What is the routing key and exchange name you're publishing to?

What exchanges and queues did you create and how did you bind them?

Its possible to publish to an exchange that doesn't have a binding to a
queue - so the message will be silently dropped.

If you haven't already, you might want to take a look at:
http://www.rabbitmq.com/getstarted.html which gives a good overview of how
exchanges, queues, and bindings work, and several common patterns of usage.

-Alan


On Fri, Dec 13, 2013 at 7:46 AM, kingsmasher1 <raj.kumar.sanpui at gmail.com>wrote:

> This is the output of rabbitmqctl:
>
> ServerIFM33:/tmp # /usr/sbin/rabbitmqctl list_queues
> Listing queues ...
> file.ingest     0
> MyprefetchQ     0
> file.storage    0
> file.dc.commit  0
> file.alert      0
> file.purge      0
> file.archive    0
> file.dc.receive 0
> ...done.
>
> MyprefetchQ is the one i am interested in polling.
> It does not show any messages, how are the messages getting dropped, when
> the publisher is indeed publishing them? What's wrong?
>
> If i fire the consumers, immediately the messages are consumed. Why the
> queue isn't able to hold messages?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32071.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/79254a7d/attachment.html>

From raj.kumar.sanpui at gmail.com  Fri Dec 13 16:08:05 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 08:08:05 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
Message-ID: <1386950885965-32073.post@n5.nabble.com>

Thanks a lot for the reply Alan.
Seems like i made some basic mistake, my bindQueue happened inside the
consume method, and i was planning to call consume only after the "select(
)" validation, so that might be the reason as you suggested that the
messages are dropped.

In betwn. here is the functions we use, it's from an already-existing old
code, which does not have "message in queue or not" validation, which i am
trying to add.

#define EXCHANGE "topicex"
#define QUEUETYPE "topic"
#define ROUTINGKEY "pname"
#define QUEUENAME "MyprefetchQ"


void createPrefetchQueue(void)  {
        amqConnection *conn =  util.getAMQConnection ();
        int rc = conn->declareExchange(EXCHANGE, QUEUETYPE, 1);
        if (rc != 0) {
                ErrLog("%s() - declare exchange %s %s failed\n",
__FUNCTION__, EXCHANGE, QUEUETYPE);
                util.returnAMQConnection(conn);
                pthread_exit(0) ;
        }
        // Create my prefetch queue
        rc = conn->createQueue(QUEUENAME, 0, 1, 1, 0);

        if (rc != 0) {
         ErrLog("%s() - create MyprefetchQ %s failed\n", __FUNCTION__,
QUEUENAME);
         util.returnAMQConnection(conn);
                        pthread_exit(0) ;
    }
}

int amqConnection::createQueue(std::string queue, int passive, int durable,
int exclusive, int autoDelete){
	Debug("%s - Create queue %s \n", __FUNCTION__, queue.c_str());
/*
 amqp_queue_declare(amqp_connection_state_t state, amqp_channel_t channel,
amqp_bytes_t queue, amqp_boolean_t passive, amqp_boolean_t durable,
amqp_boolean_t exclusive, amqp_boolean_t auto_delete, amqp_table_t
arguments)
*/
	int channel=1;
	amqp_queue_declare(conn, channel, amqp_cstring_bytes(queue.c_str()), 0
			, 0, 0, 1,  amqp_empty_table);
	  amqp_rpc_reply_t res = amqp_get_rpc_reply(conn);
	  return check_amqp_error(res, "create queue");

}

Binding:
int amqConnection::bindQueue(const char* queue, const char* exchange, const
char* bindingkey) {
	Debug("%s() - %s %s\n", __FUNCTION__, queue, exchange, bindingkey);
	amqp_queue_bind(conn, 1,
			amqp_cstring_bytes(queue),
			amqp_cstring_bytes(exchange),
			amqp_cstring_bytes(bindingkey),
			amqp_empty_table);

	amqp_rpc_reply_t res = amqp_get_rpc_reply(conn);
	return check_amqp_error(res, "bind queue");
}


std::string amqConnection::consume(amqp_bytes_t queuename, std::string
exchange, std::string routingkey) {
	Debug("%s q %s ex %s rk %s- \n", __FUNCTION__, (char*)queuename.bytes,
exchange.c_str(), routingkey.c_str());

	if (exchange.length() > 0) bindQueue(queuename, exchange.c_str(),
routingkey.c_str());

<snip>
}



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32073.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Fri Dec 13 16:30:23 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Dec 2013 16:30:23 +0000
Subject: [rabbitmq-discuss] Syncing erlang cookie by editing
	rabbitmq-service
In-Reply-To: <bce9ae2c-46ef-49aa-a89f-7402aed1752c@googlegroups.com>
References: <bce9ae2c-46ef-49aa-a89f-7402aed1752c@googlegroups.com>
Message-ID: <52AB361F.3030805@rabbitmq.com>


Hi,

On 13/12/13 07:44, pat at munkiisoft.com wrote:

> set RABBITMQ_SERVER_START_ARGS=-setcookie "HEYEVHYLJHOBGFQASQHK"
> 
> and multiple variations off that but it is not picking it up. 
> 
> Could someone point out the error of my ways


Thanks for reporting the issue. Setting that variable should work, the
reason why it doesn't is due to a bug in the batch file. The release
that contains the fix for this problem will make mention of that fact in
the release notes.





-Emile

From pat at munkiisoft.com  Fri Dec 13 16:32:27 2013
From: pat at munkiisoft.com (Patrick Long)
Date: Fri, 13 Dec 2013 16:32:27 +0000
Subject: [rabbitmq-discuss] Syncing erlang cookie by editing
	rabbitmq-service
In-Reply-To: <52AB361F.3030805@rabbitmq.com>
References: <bce9ae2c-46ef-49aa-a89f-7402aed1752c@googlegroups.com>
 <52AB361F.3030805@rabbitmq.com>
Message-ID: <CALDntb9kJihgKcDb1XGN_Tn7CXZzhjVhTO5ouRPkYTnJ6yoktw@mail.gmail.com>

Can you suggest a workaround in the meantime? Other than manually copying
the cookie files


On 13 December 2013 16:30, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 13/12/13 07:44, pat at munkiisoft.com wrote:
>
> > set RABBITMQ_SERVER_START_ARGS=-setcookie "HEYEVHYLJHOBGFQASQHK"
> >
> > and multiple variations off that but it is not picking it up.
> >
> > Could someone point out the error of my ways
>
>
> Thanks for reporting the issue. Setting that variable should work, the
> reason why it doesn't is due to a bug in the batch file. The release
> that contains the fix for this problem will make mention of that fact in
> the release notes.
>
>
>
>
>
> -Emile
>



-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/f917eeb1/attachment.html>

From alan.antonuk at gmail.com  Fri Dec 13 16:33:40 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 13 Dec 2013 08:33:40 -0800
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
 in consumer?
In-Reply-To: <1386950885965-32073.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
Message-ID: <CAAt2poJK2kphQuR9LkOSG+hYRh4dX6h2C9g-ZftVciBX7kD+Wg@mail.gmail.com>

If you REALLY need to know the number of messages in a queue: the
queue.declare method returns a queue.declare-ok which includes a
message-count field - which will tell you the number of messages in a
queue. Keep in mind this involves a round-trip to the broker and is worse
for efficiency than polling with basic.get, if all you want to do is grab a
message when it becomes available.  If you'd like to do just that use
basic.consume.

-Alan


On Fri, Dec 13, 2013 at 8:08 AM, kingsmasher1 <raj.kumar.sanpui at gmail.com>wrote:

> Thanks a lot for the reply Alan.
> Seems like i made some basic mistake, my bindQueue happened inside the
> consume method, and i was planning to call consume only after the "select(
> )" validation, so that might be the reason as you suggested that the
> messages are dropped.
>
> In betwn. here is the functions we use, it's from an already-existing old
> code, which does not have "message in queue or not" validation, which i am
> trying to add.
>
> #define EXCHANGE "topicex"
> #define QUEUETYPE "topic"
> #define ROUTINGKEY "pname"
> #define QUEUENAME "MyprefetchQ"
>
>
> void createPrefetchQueue(void)  {
>         amqConnection *conn =  util.getAMQConnection ();
>         int rc = conn->declareExchange(EXCHANGE, QUEUETYPE, 1);
>         if (rc != 0) {
>                 ErrLog("%s() - declare exchange %s %s failed\n",
> __FUNCTION__, EXCHANGE, QUEUETYPE);
>                 util.returnAMQConnection(conn);
>                 pthread_exit(0) ;
>         }
>         // Create my prefetch queue
>         rc = conn->createQueue(QUEUENAME, 0, 1, 1, 0);
>
>         if (rc != 0) {
>          ErrLog("%s() - create MyprefetchQ %s failed\n", __FUNCTION__,
> QUEUENAME);
>          util.returnAMQConnection(conn);
>                         pthread_exit(0) ;
>     }
> }
>
> int amqConnection::createQueue(std::string queue, int passive, int durable,
> int exclusive, int autoDelete){
>         Debug("%s - Create queue %s \n", __FUNCTION__, queue.c_str());
> /*
>  amqp_queue_declare(amqp_connection_state_t state, amqp_channel_t channel,
> amqp_bytes_t queue, amqp_boolean_t passive, amqp_boolean_t durable,
> amqp_boolean_t exclusive, amqp_boolean_t auto_delete, amqp_table_t
> arguments)
> */
>         int channel=1;
>         amqp_queue_declare(conn, channel,
> amqp_cstring_bytes(queue.c_str()), 0
>                         , 0, 0, 1,  amqp_empty_table);
>           amqp_rpc_reply_t res = amqp_get_rpc_reply(conn);
>           return check_amqp_error(res, "create queue");
>
> }
>
> Binding:
> int amqConnection::bindQueue(const char* queue, const char* exchange, const
> char* bindingkey) {
>         Debug("%s() - %s %s\n", __FUNCTION__, queue, exchange, bindingkey);
>         amqp_queue_bind(conn, 1,
>                         amqp_cstring_bytes(queue),
>                         amqp_cstring_bytes(exchange),
>                         amqp_cstring_bytes(bindingkey),
>                         amqp_empty_table);
>
>         amqp_rpc_reply_t res = amqp_get_rpc_reply(conn);
>         return check_amqp_error(res, "bind queue");
> }
>
>
> std::string amqConnection::consume(amqp_bytes_t queuename, std::string
> exchange, std::string routingkey) {
>         Debug("%s q %s ex %s rk %s- \n", __FUNCTION__,
> (char*)queuename.bytes,
> exchange.c_str(), routingkey.c_str());
>
>         if (exchange.length() > 0) bindQueue(queuename, exchange.c_str(),
> routingkey.c_str());
>
> <snip>
> }
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32073.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/173f9a6c/attachment.html>

From raj.kumar.sanpui at gmail.com  Fri Dec 13 16:46:45 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 08:46:45 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <1386950885965-32073.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
Message-ID: <1386953205164-32077.post@n5.nabble.com>

Hi Alan,

For the purpose of the POC, we are creating the queue ourselves and
publishing the messages, but in the real application, the queue will be
already present and created by a backend (Java), and we have to just go
ahead and consume in the frontend (which is in C/C++) based on the
availability of messages in queue, and spawn a thread for consuming each
messages of queue for fast processing.

In betwn. before trying the other consume method (with timeout you
suggested) i thght to give it a last go and i just bind my queue, right
after creation, and i can see the messages getting persisted, i removed the
O_NOBLOCK option too, but still it gets timedout.

Any hint.

Thanks,
Raj



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32077.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Fri Dec 13 16:52:55 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 13 Dec 2013 08:52:55 -0800
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
 in consumer?
In-Reply-To: <1386953205164-32077.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
 <1386953205164-32077.post@n5.nabble.com>
Message-ID: <CAAt2poJ_Orq=W+Vo82v7H=exT93-DRcAYxdwm0H-kGSRSd1pxA@mail.gmail.com>

Don't use select(2). Use one of the higher-level APIs I suggested earlier.

-Alan


On Fri, Dec 13, 2013 at 8:46 AM, kingsmasher1 <raj.kumar.sanpui at gmail.com>wrote:

> Hi Alan,
>
> For the purpose of the POC, we are creating the queue ourselves and
> publishing the messages, but in the real application, the queue will be
> already present and created by a backend (Java), and we have to just go
> ahead and consume in the frontend (which is in C/C++) based on the
> availability of messages in queue, and spawn a thread for consuming each
> messages of queue for fast processing.
>
> In betwn. before trying the other consume method (with timeout you
> suggested) i thght to give it a last go and i just bind my queue, right
> after creation, and i can see the messages getting persisted, i removed the
> O_NOBLOCK option too, but still it gets timedout.
>
> Any hint.
>
> Thanks,
> Raj
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32077.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/11f9daa3/attachment.html>

From raj.kumar.sanpui at gmail.com  Fri Dec 13 16:53:24 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 08:53:24 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <1386953205164-32077.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
 <1386953205164-32077.post@n5.nabble.com>
Message-ID: <1386953604985-32078.post@n5.nabble.com>

Sorry, for being unclear, the purpose of writing my first paragraph was, we
can't use queue.declare, since in the real app, the queue will already be
declared.

Thanks
Raj



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32078.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From raj.kumar.sanpui at gmail.com  Fri Dec 13 16:56:43 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 08:56:43 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <CAAt2poJ_Orq=W+Vo82v7H=exT93-DRcAYxdwm0H-kGSRSd1pxA@mail.gmail.com>
References: <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
 <1386953205164-32077.post@n5.nabble.com>
 <CAAt2poJ_Orq=W+Vo82v7H=exT93-DRcAYxdwm0H-kGSRSd1pxA@mail.gmail.com>
Message-ID: <CADbNrROT16MpT9xzX1_uU_igZRiZ3KmErK3j_9Z+y0C-5cEEHQ@mail.gmail.com>

Thanks a lot Alan.
I will use that. It really helps.

Kind Regards
Raj Kumar


On Fri, Dec 13, 2013 at 10:24 PM, Alan Antonuk [via RabbitMQ] <
ml-node+s1065348n32079h37 at n5.nabble.com> wrote:

> Don't use select(2). Use one of the higher-level APIs I suggested earlier.
>
> -Alan
>
>
> On Fri, Dec 13, 2013 at 8:46 AM, kingsmasher1 <[hidden email]<http://user/SendEmail.jtp?type=node&node=32079&i=0>
> > wrote:
>
>> Hi Alan,
>>
>> For the purpose of the POC, we are creating the queue ourselves and
>> publishing the messages, but in the real application, the queue will be
>> already present and created by a backend (Java), and we have to just go
>> ahead and consume in the frontend (which is in C/C++) based on the
>> availability of messages in queue, and spawn a thread for consuming each
>> messages of queue for fast processing.
>>
>> In betwn. before trying the other consume method (with timeout you
>> suggested) i thght to give it a last go and i just bind my queue, right
>> after creation, and i can see the messages getting persisted, i removed
>> the
>> O_NOBLOCK option too, but still it gets timedout.
>>
>> Any hint.
>>
>> Thanks,
>> Raj
>>
>>
>>
>> --
>> View this message in context:
>> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32077.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32079&i=1>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=32079&i=2>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32079.html
>  To unsubscribe from Why is the "select" always getting timed out in
> consumer?, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=32046&code=cmFqLmt1bWFyLnNhbnB1aUBnbWFpbC5jb218MzIwNDZ8MTUwNTg3MDEzOA==>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32080.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/3a82d1ed/attachment.html>

From alan.antonuk at gmail.com  Fri Dec 13 17:04:40 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 13 Dec 2013 09:04:40 -0800
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
 in consumer?
In-Reply-To: <1386953604985-32078.post@n5.nabble.com>
References: <1386923788150-32046.post@n5.nabble.com>
 <1386944471298-32064.post@n5.nabble.com>
 <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
 <1386953205164-32077.post@n5.nabble.com>
 <1386953604985-32078.post@n5.nabble.com>
Message-ID: <CAAt2poJ7L2+zBJaghy1oT0eRZ-KywhFHA6cufVUMkDOV_Kp-uw@mail.gmail.com>

Assuming you pass in the same parameters; calling declare.queue on a queue
a second time will not have any effect.  If you don't want to create the
queue on the broker if it doesn't exist - you can use the 'passive' flag,
which will prevent the queue from being created in the event the queue
doesn't already exist on the broker.


On Fri, Dec 13, 2013 at 8:53 AM, kingsmasher1 <raj.kumar.sanpui at gmail.com>wrote:

> Sorry, for being unclear, the purpose of writing my first paragraph was, we
> can't use queue.declare, since in the real app, the queue will already be
> declared.
>
> Thanks
> Raj
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32078.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/a16e6461/attachment.html>

From raj.kumar.sanpui at gmail.com  Fri Dec 13 17:21:46 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 09:21:46 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <CAAt2poJ7L2+zBJaghy1oT0eRZ-KywhFHA6cufVUMkDOV_Kp-uw@mail.gmail.com>
References: <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
 <1386953205164-32077.post@n5.nabble.com>
 <1386953604985-32078.post@n5.nabble.com>
 <CAAt2poJ7L2+zBJaghy1oT0eRZ-KywhFHA6cufVUMkDOV_Kp-uw@mail.gmail.com>
Message-ID: <CADbNrRNp18sE6ER2vfEbqeYTNF3Rgpt40Ximjv1P9EZPuCVrtw@mail.gmail.com>

ohh..ok, so just in order to grab the number of messages present, at any
specific instance i can call the queue.declare anytime and pass the passive
parameter.

But considering the cons, the amqp_consume_message sounds better. But this,
is a good thing we can try and see for an experimental purpose.

We are using 2.8.7 rabbitmq which does not seem, to have the
amqp_consume_message, seems like it's a recent addition to your library.
Seems like it's time for us to upgrade :-)

Kind Regards
Raj




On Fri, Dec 13, 2013 at 10:36 PM, Alan Antonuk [via RabbitMQ] <
ml-node+s1065348n32081h99 at n5.nabble.com> wrote:

> Assuming you pass in the same parameters; calling declare.queue on a queue
> a second time will not have any effect.  If you don't want to create the
> queue on the broker if it doesn't exist - you can use the 'passive' flag,
> which will prevent the queue from being created in the event the queue
> doesn't already exist on the broker.
>
>
> On Fri, Dec 13, 2013 at 8:53 AM, kingsmasher1 <[hidden email]<http://user/SendEmail.jtp?type=node&node=32081&i=0>
> > wrote:
>
>> Sorry, for being unclear, the purpose of writing my first paragraph was,
>> we
>> can't use queue.declare, since in the real app, the queue will already be
>> declared.
>>
>> Thanks
>> Raj
>>
>>
>>
>> --
>> View this message in context:
>> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32078.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32081&i=1>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=32081&i=2>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32081.html
>  To unsubscribe from Why is the "select" always getting timed out in
> consumer?, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=32046&code=cmFqLmt1bWFyLnNhbnB1aUBnbWFpbC5jb218MzIwNDZ8MTUwNTg3MDEzOA==>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32082.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/cb0dd4bf/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 13 17:38:51 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Dec 2013 21:38:51 +0400
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
 in consumer?
In-Reply-To: <CADbNrRNp18sE6ER2vfEbqeYTNF3Rgpt40Ximjv1P9EZPuCVrtw@mail.gmail.com>
References: <CAE3HoVRgLqio47=NLUVi_-MW5Bc14i-ZzRJpAR6Mqk=H7fLBrg@mail.gmail.com>
 <1386945253253-32066.post@n5.nabble.com>
 <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
 <1386953205164-32077.post@n5.nabble.com>
 <1386953604985-32078.post@n5.nabble.com>
 <CAAt2poJ7L2+zBJaghy1oT0eRZ-KywhFHA6cufVUMkDOV_Kp-uw@mail.gmail.com>
 <CADbNrRNp18sE6ER2vfEbqeYTNF3Rgpt40Ximjv1P9EZPuCVrtw@mail.gmail.com>
Message-ID: <CAE3HoVQ1-zT8VgxGky98hf=Q7kWAcb+HyVAdC0SYe8dmCThDKg@mail.gmail.com>

2013/12/13 kingsmasher1 <raj.kumar.sanpui at gmail.com>

> ohh..ok, so just in order to grab the number of messages present, at any
> specific instance i can call the queue.declare anytime and pass the passive
> parameter.


You don't even need to set passive to true, just use the same attributes or
you will get 406 Precondition Failed
back.


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/93378e7e/attachment.html>

From raj.kumar.sanpui at gmail.com  Fri Dec 13 17:57:07 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Fri, 13 Dec 2013 09:57:07 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the "select" always getting timed out
	in consumer?
In-Reply-To: <CAE3HoVQ1-zT8VgxGky98hf=Q7kWAcb+HyVAdC0SYe8dmCThDKg@mail.gmail.com>
References: <1386945691847-32067.post@n5.nabble.com>
 <87463224-D05C-4CEC-9F16-809AED329608@rabbitmq.com>
 <1386948584168-32069.post@n5.nabble.com>
 <CAAt2poJkBae5sTQNyqPA-YEbC2XMt4+R6m3vWBNsMnAyKGD+FQ@mail.gmail.com>
 <1386950885965-32073.post@n5.nabble.com>
 <1386953205164-32077.post@n5.nabble.com>
 <1386953604985-32078.post@n5.nabble.com>
 <CAAt2poJ7L2+zBJaghy1oT0eRZ-KywhFHA6cufVUMkDOV_Kp-uw@mail.gmail.com>
 <CADbNrRNp18sE6ER2vfEbqeYTNF3Rgpt40Ximjv1P9EZPuCVrtw@mail.gmail.com>
 <CAE3HoVQ1-zT8VgxGky98hf=Q7kWAcb+HyVAdC0SYe8dmCThDKg@mail.gmail.com>
Message-ID: <CADbNrRNnowJZ9r+VMevhd7UOxVjOamKmYk+A_x0-2-ZK78zOyg@mail.gmail.com>

Thanks Michael,

But i don't want my queue to be altered, or even created if it is not
present. As Alan was suggesting, that's why we were planning to use passive.

Regards
Raj



On Fri, Dec 13, 2013 at 11:11 PM, michaelklishin [via RabbitMQ] <
ml-node+s1065348n32083h61 at n5.nabble.com> wrote:

> 2013/12/13 kingsmasher1 <[hidden email]<http://user/SendEmail.jtp?type=node&node=32083&i=0>
> >
>
> ohh..ok, so just in order to grab the number of messages present, at any
>> specific instance i can call the queue.declare anytime and pass the passive
>> parameter.
>
>
> You don't even need to set passive to true, just use the same attributes
> or you will get 406 Precondition Failed
>  back.
>
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=32083&i=1>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32083.html
>  To unsubscribe from Why is the "select" always getting timed out in
> consumer?, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=32046&code=cmFqLmt1bWFyLnNhbnB1aUBnbWFpbC5jb218MzIwNDZ8MTUwNTg3MDEzOA==>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-is-the-select-always-getting-timed-out-in-consumer-tp32046p32084.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/3fd50594/attachment.html>

From mike at meshfire.com  Fri Dec 13 18:17:30 2013
From: mike at meshfire.com (MikeTempleman)
Date: Fri, 13 Dec 2013 10:17:30 -0800 (PST)
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
 <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
Message-ID: <CALdW9BxbA9-tcWyyW1tQmu5A_gdp6F6Ps2m2oiON+wHOSK_x0Q@mail.gmail.com>

Hi Alvaro

I would be more than happy to provide logs. But all they have in them is
connection and shutdown information. Nothing more. I have just enabled
tracing on the vhost and will send the logs shortly. We encounter this
issue when under load every day now.

Let me tell you our architecture and deployment:

rabbitMQ:

   - m1.large ec2 instance. Version: RabbitMQ 3.1.5,  Erlang R14B04
   - 23 queues (transaction and direct)
   - 3 exchanges used, two fanout and one topic exchange
   - topic exchange
   - Topic exchange overview is attached.
   - 46 total channels.


AppServers

   - m1.large tomcat servers running grails application
   - 2-7 servers at any one time.
   - Consume + publish
   - On busy queues, each server has 16 consumers with prefetch at 100
   - message sizes on busy queues are ~4KB.
   - publishing rates on busiest queue ranges from 16/s to >100/s. (We need
   to be able to support 1000/s).


Each AppServer connects to a sharded mongodb cluster of 3 shards. Our first
suspicion was that something in Mongo or AWS was causing the periodic delay
but AWS techs looked into our volume use and said we were only use 25% of
available bandwidth.

At this moment, we have a modest publish rate (~50-60/s) but a backlog of
50,000 messages for the queue "user". You can see a 10 minute snapshot of
the queue and see the cycling.

I turned on tracing but the results don't seem to becoming into the log. Is
there another way to enable reporting of flow control?

Mike Templeman


-- 

*Mike Templeman*
*Head of Development*

T: @talkingfrog1950 <http://twitter.com/missdestructo>
T: @Meshfire <http://twitter.com/meshfire>



On Fri, Dec 13, 2013 at 6:03 AM, Alvaro Videla-2 [via RabbitMQ] <
ml-node+s1065348n32063h90 at n5.nabble.com> wrote:

> Mike,
>
> Would you be able to provide information more information to help us
> debug the problem?
>
> Tim (from the rabbitmq team) requested more info in order to try to
> find answers for this.
>
> For example, when consumption drops to zero, are there any logs on the
> rabbitmq server that might tell of a flow control mechanism being
> activated?
>
> Regards,
>
> Alvaro
>
>
> On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=0>>
> wrote:
>
> > Tyson
> >
> > Did you ever find an answer to this question? We are encountering
> virtually
> > the exact same problem.
> >
> > We have a variable number of servers setup as producers and consumers
> and
> > see our throughput drop to zero on a periodic basis. This is most severe
> > when there are a few hundred thousand messages on rabbit.
> >
> > Did you just drop Rabbit? Ours is running on an m1.large instance with
> RAID0
> > ephemeral drives, so size and performance of the disk subsystem is not
> an
> > issue (we are still in beta). We have spent untold hours tuning our
> sharded
> > mongodb subsystem only to find out that it is only being 25% utilized
> (at
> > least it will be blazing fast if we ever figure this out).
> >
> >
> >
> >
> >
> > --
> > View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=1>
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=2>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32063.html
>  To unsubscribe from Lower delivery rate than publish rate - why?, click
> here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=29247&code=bWlrZUBtZXNoZmlyZS5jb218MjkyNDd8MTYzNTUyMDM4MA==>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>


ploverExchange.tiff (39K) <http://rabbitmq.1065348.n5.nabble.com/attachment/32085/0/ploverExchange.tiff>
userqueue.tiff (94K) <http://rabbitmq.1065348.n5.nabble.com/attachment/32085/1/userqueue.tiff>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32085.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/eed16b04/attachment.html>

From mike at meshfire.com  Fri Dec 13 18:40:55 2013
From: mike at meshfire.com (MikeTempleman)
Date: Fri, 13 Dec 2013 10:40:55 -0800 (PST)
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
 <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
Message-ID: <CALdW9BwYaDg4yzCqRt0c+u=1Y_7Hzm8i3dBnSVnY27SfrC618A@mail.gmail.com>

Also, from observing the Connections screen on the web UI shows that no
flow control has been recently turned on for any of the four current
connections (four app servers).

-- 

*Mike Templeman*
*Head of Development*

T: @talkingfrog1950 <http://twitter.com/missdestructo>
T: @Meshfire <http://twitter.com/meshfire>



On Fri, Dec 13, 2013 at 10:17 AM, Mike Templeman <mike at meshfire.com> wrote:

> Hi Alvaro
>
> I would be more than happy to provide logs. But all they have in them is
> connection and shutdown information. Nothing more. I have just enabled
> tracing on the vhost and will send the logs shortly. We encounter this
> issue when under load every day now.
>
> Let me tell you our architecture and deployment:
>
> rabbitMQ:
>
>    - m1.large ec2 instance. Version: RabbitMQ 3.1.5,  Erlang R14B04
>    - 23 queues (transaction and direct)
>    - 3 exchanges used, two fanout and one topic exchange
>    - topic exchange
>    - Topic exchange overview is attached.
>    - 46 total channels.
>
>
> AppServers
>
>    - m1.large tomcat servers running grails application
>    - 2-7 servers at any one time.
>    - Consume + publish
>    - On busy queues, each server has 16 consumers with prefetch at 100
>    - message sizes on busy queues are ~4KB.
>    - publishing rates on busiest queue ranges from 16/s to >100/s. (We
>    need to be able to support 1000/s).
>
>
> Each AppServer connects to a sharded mongodb cluster of 3 shards. Our
> first suspicion was that something in Mongo or AWS was causing the periodic
> delay but AWS techs looked into our volume use and said we were only use
> 25% of available bandwidth.
>
> At this moment, we have a modest publish rate (~50-60/s) but a backlog of
> 50,000 messages for the queue "user". You can see a 10 minute snapshot of
> the queue and see the cycling.
>
> I turned on tracing but the results don't seem to becoming into the log.
> Is there another way to enable reporting of flow control?
>
> Mike Templeman
>
>
> --
>
> *Mike Templeman*
> *Head of Development*
>
> T: @talkingfrog1950 <http://twitter.com/missdestructo>
> T: @Meshfire <http://twitter.com/meshfire>
>
>
>
> On Fri, Dec 13, 2013 at 6:03 AM, Alvaro Videla-2 [via RabbitMQ] <
> ml-node+s1065348n32063h90 at n5.nabble.com> wrote:
>
>> Mike,
>>
>> Would you be able to provide information more information to help us
>> debug the problem?
>>
>> Tim (from the rabbitmq team) requested more info in order to try to
>> find answers for this.
>>
>> For example, when consumption drops to zero, are there any logs on the
>> rabbitmq server that might tell of a flow control mechanism being
>> activated?
>>
>> Regards,
>>
>> Alvaro
>>
>>
>> On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=0>>
>> wrote:
>>
>> > Tyson
>> >
>> > Did you ever find an answer to this question? We are encountering
>> virtually
>> > the exact same problem.
>> >
>> > We have a variable number of servers setup as producers and consumers
>> and
>> > see our throughput drop to zero on a periodic basis. This is most
>> severe
>> > when there are a few hundred thousand messages on rabbit.
>> >
>> > Did you just drop Rabbit? Ours is running on an m1.large instance with
>> RAID0
>> > ephemeral drives, so size and performance of the disk subsystem is not
>> an
>> > issue (we are still in beta). We have spent untold hours tuning our
>> sharded
>> > mongodb subsystem only to find out that it is only being 25% utilized
>> (at
>> > least it will be blazing fast if we ever figure this out).
>> >
>> >
>> >
>> >
>> >
>> > --
>> > View this message in context:
>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
>> > Sent from the RabbitMQ mailing list archive at Nabble.com.
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=1>
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=2>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> ------------------------------
>>  If you reply to this email, your message will be added to the
>> discussion below:
>>
>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32063.html
>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>> here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=29247&code=bWlrZUBtZXNoZmlyZS5jb218MjkyNDd8MTYzNTUyMDM4MA==>
>> .
>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>
>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32086.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/348b51f4/attachment.html>

From goyalk at vmware.com  Fri Dec 13 20:12:18 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Fri, 13 Dec 2013 12:12:18 -0800 (PST)
Subject: [rabbitmq-discuss] Using export/import broker configuration as
	a way of backup/restore
In-Reply-To: <52A99159.4000500@rabbitmq.com>
References: <4116129a.000017e4.00000164@KAPILPC.vmware.com>
 <52A99159.4000500@rabbitmq.com>
Message-ID: <16e70633.000017e4.0000018b@KAPILPC.vmware.com>

Hi Simon,

Thanks for your response. It is very useful. We are not using persistent
messages, so it appears that export/import will work well as
backup/restore.

Regards
Kapil

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Thursday, December 12, 2013 2:35 AM
To: Discussions about RabbitMQ
Cc: Kapil Goyal
Subject: Re: [rabbitmq-discuss] Using export/import broker configuration
as a way of backup/restore

On 11/12/2013 20:14, Kapil Goyal wrote:
> I need to know what broker entities are not available for export. I am 
> aware messages and auto-delete queues are not exported. Are there any 
> more? Maybe point me to some document?

I don't think there's any documentation other than the code:

https://urldefense.proofpoint.com/v1/url?u=http://hg.rabbitmq.com/rabbitmq
-management/file/3eeb9cde47e4/src/rabbit_mgmt_wm_definitions.erl&k=oIvRg1%
2BdGAgOoM1BIlLLqw%3D%3D%0A&r=JF6BIRiITniYYZhbhzlgNvj%2FeB0%2BYbRBSr0f8NG91
qs%3D%0A&m=NWTmJKC6T4aDU1am5TpwVNjUl8A7ODONhrw8YU4Q9tw%3D%0A&s=5172be47e38
3be560ca3f40ca4288e525f747b78234a585aaebdbe264b9feb71

The basic idea is to export all metadata we can successfully recreate.

So we don't export:
* messages (not metadata)
* connections and channels (obviously)
* exclusive queues (can't be recreated without a connection to attach to)
* built in exchanges (can't be recreated / no point)
* bindings to queues we are not going to export (no point)
* bindings to the default exchange (will be automatically recreated)

Auto-delete queues *are* exported.

Cheers, Simon

From mike at meshfire.com  Fri Dec 13 21:50:22 2013
From: mike at meshfire.com (MikeTempleman)
Date: Fri, 13 Dec 2013 13:50:22 -0800 (PST)
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
 <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
Message-ID: <CALdW9BziCs-DnF9cgjB42WOEh0T7NCgj3U=ofG=tyfmazgcfjg@mail.gmail.com>

I noticed something else very odd.

Currently, one queue has 43,000 messages backed up in its queue. But when I
look at the exchange (there is only one exchange) I see that the message
rate in exactly matches the message rate out.

With such a huge backlog, why would that be? I would have thought that the
consumers (there are 16 total distributed across 4 systems for that queue
with a prefetch of 100) would run at a much higher steady state.

This exchange also seems to cycle regularly. It appears to run from a low
of around 60/s in and out to 500+ a second in and out.

-- 

*Mike Templeman*
*Head of Development*

T: @talkingfrog1950 <http://twitter.com/missdestructo>
T: @Meshfire <http://twitter.com/meshfire>



On Fri, Dec 13, 2013 at 10:40 AM, Mike Templeman <mike at meshfire.com> wrote:

> Also, from observing the Connections screen on the web UI shows that no
> flow control has been recently turned on for any of the four current
> connections (four app servers).
>
> --
>
> *Mike Templeman *
> *Head of Development*
>
> T: @talkingfrog1950 <http://twitter.com/missdestructo>
> T: @Meshfire <http://twitter.com/meshfire>
>
>
>
> On Fri, Dec 13, 2013 at 10:17 AM, Mike Templeman <mike at meshfire.com>wrote:
>
>> Hi Alvaro
>>
>> I would be more than happy to provide logs. But all they have in them is
>> connection and shutdown information. Nothing more. I have just enabled
>> tracing on the vhost and will send the logs shortly. We encounter this
>> issue when under load every day now.
>>
>> Let me tell you our architecture and deployment:
>>
>> rabbitMQ:
>>
>>    - m1.large ec2 instance. Version: RabbitMQ 3.1.5,  Erlang R14B04
>>    - 23 queues (transaction and direct)
>>    - 3 exchanges used, two fanout and one topic exchange
>>    - topic exchange
>>    - Topic exchange overview is attached.
>>    - 46 total channels.
>>
>>
>> AppServers
>>
>>    - m1.large tomcat servers running grails application
>>    - 2-7 servers at any one time.
>>    - Consume + publish
>>    - On busy queues, each server has 16 consumers with prefetch at 100
>>    - message sizes on busy queues are ~4KB.
>>    - publishing rates on busiest queue ranges from 16/s to >100/s. (We
>>    need to be able to support 1000/s).
>>
>>
>> Each AppServer connects to a sharded mongodb cluster of 3 shards. Our
>> first suspicion was that something in Mongo or AWS was causing the periodic
>> delay but AWS techs looked into our volume use and said we were only use
>> 25% of available bandwidth.
>>
>> At this moment, we have a modest publish rate (~50-60/s) but a backlog of
>> 50,000 messages for the queue "user". You can see a 10 minute snapshot of
>> the queue and see the cycling.
>>
>> I turned on tracing but the results don't seem to becoming into the log.
>> Is there another way to enable reporting of flow control?
>>
>> Mike Templeman
>>
>>
>> --
>>
>> *Mike Templeman*
>> *Head of Development*
>>
>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>> T: @Meshfire <http://twitter.com/meshfire>
>>
>>
>>
>> On Fri, Dec 13, 2013 at 6:03 AM, Alvaro Videla-2 [via RabbitMQ] <
>> ml-node+s1065348n32063h90 at n5.nabble.com> wrote:
>>
>>> Mike,
>>>
>>> Would you be able to provide information more information to help us
>>> debug the problem?
>>>
>>> Tim (from the rabbitmq team) requested more info in order to try to
>>> find answers for this.
>>>
>>> For example, when consumption drops to zero, are there any logs on the
>>> rabbitmq server that might tell of a flow control mechanism being
>>> activated?
>>>
>>> Regards,
>>>
>>> Alvaro
>>>
>>>
>>> On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=0>>
>>> wrote:
>>>
>>> > Tyson
>>> >
>>> > Did you ever find an answer to this question? We are encountering
>>> virtually
>>> > the exact same problem.
>>> >
>>> > We have a variable number of servers setup as producers and consumers
>>> and
>>> > see our throughput drop to zero on a periodic basis. This is most
>>> severe
>>> > when there are a few hundred thousand messages on rabbit.
>>> >
>>> > Did you just drop Rabbit? Ours is running on an m1.large instance with
>>> RAID0
>>> > ephemeral drives, so size and performance of the disk subsystem is not
>>> an
>>> > issue (we are still in beta). We have spent untold hours tuning our
>>> sharded
>>> > mongodb subsystem only to find out that it is only being 25% utilized
>>> (at
>>> > least it will be blazing fast if we ever figure this out).
>>> >
>>> >
>>> >
>>> >
>>> >
>>> > --
>>> > View this message in context:
>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
>>> > Sent from the RabbitMQ mailing list archive at Nabble.com.
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=1>
>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=2>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>> ------------------------------
>>>  If you reply to this email, your message will be added to the
>>> discussion below:
>>>
>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32063.html
>>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>>> here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=29247&code=bWlrZUBtZXNoZmlyZS5jb218MjkyNDd8MTYzNTUyMDM4MA==>
>>> .
>>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>>
>>
>>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32088.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/d7369c36/attachment.html>

From mike at meshfire.com  Sat Dec 14 02:15:41 2013
From: mike at meshfire.com (MikeTempleman)
Date: Fri, 13 Dec 2013 18:15:41 -0800 (PST)
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
 <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
Message-ID: <CALdW9BwnLs_je13zg_4WBd-6NKemZDXry+sNXPV7ut8P=7hahw@mail.gmail.com>

I realized that was a bad interpretation. Sorry. The exchange is just
successfully routing all the messages to the target queues.

After reading a number of posts and this blog entry (
http://www.rabbitmq.com/blog/2011/09/24/sizing-your-rabbits/) I wonder if
the issue is that each message is ack'd. It seemed that the issue occurred
when I had a large backlog in the queues. When Rabbit is empty, performance
is fine. When the consumers tried to run at much higher speeds, we
encountered this cycling.

We have run a brief test with no-ack, not on production, and the
performance is excellent even under load. But this is not a viable solution
(appservers crash, autoscaling shuts servers down that have prefetched
messages and are still connected to rabbit) without a full redesign.

Assuming each queue is only one thread (I assume it handles both receipt,
delivery, and ack cleanup) then I can understand what might happen when the
consumers generate ~500 acks/s while new messages are coming in at a low
50-100/s rate on a specific queue. I will move out some events that tend to
generate peaks into their own queue and accept that queue processing more
slowly. As for separating the real worker queue, I suppose I could create 2
or so static queues to divide the load up.

So what I think I can do is:
1. bump the default tcp buffer from 128KB to around 10MB. The added
buffering may help a little
2. see if I can find out how to set the multiple ack flag. We are using
Grails so maybe that is just creating a custom bean. I don't know
3. create a couple of queues for lower-priority events specifically events
chosen to be less time critical.
4. if all that doesn't work then probably create 4 queues for the high
priority events, randomly publish to those queues, and put consumers for
each queue.
5. Also, upgrade the server to the latest version.

Mike Templeman

-- 

*Mike Templeman*
*Head of Development*

T: @talkingfrog1950 <http://twitter.com/missdestructo>
T: @Meshfire <http://twitter.com/meshfire>



On Fri, Dec 13, 2013 at 1:42 PM, Mike Templeman <mike at meshfire.com> wrote:

> I noticed something else very odd.
>
> Currently, one queue has 43,000 messages backed up in its queue. But when
> I look at the exchange (there is only one exchange) I see that the message
> rate in exactly matches the message rate out.
>
> With such a huge backlog, why would that be? I would have thought that the
> consumers (there are 16 total distributed across 4 systems for that queue
> with a prefetch of 100) would run at a much higher steady state.
>
> This exchange also seems to cycle regularly. It appears to run from a low
> of around 60/s in and out to 500+ a second in and out.
>
> --
>
> *Mike Templeman*
> *Head of Development*
>
> T: @talkingfrog1950 <http://twitter.com/missdestructo>
> T: @Meshfire <http://twitter.com/meshfire>
>
>
>
> On Fri, Dec 13, 2013 at 10:40 AM, Mike Templeman <mike at meshfire.com>wrote:
>
>> Also, from observing the Connections screen on the web UI shows that no
>> flow control has been recently turned on for any of the four current
>> connections (four app servers).
>>
>> --
>>
>> *Mike Templeman *
>> *Head of Development*
>>
>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>> T: @Meshfire <http://twitter.com/meshfire>
>>
>>
>>
>> On Fri, Dec 13, 2013 at 10:17 AM, Mike Templeman <mike at meshfire.com>wrote:
>>
>>> Hi Alvaro
>>>
>>> I would be more than happy to provide logs. But all they have in them is
>>> connection and shutdown information. Nothing more. I have just enabled
>>> tracing on the vhost and will send the logs shortly. We encounter this
>>> issue when under load every day now.
>>>
>>> Let me tell you our architecture and deployment:
>>>
>>> rabbitMQ:
>>>
>>>    - m1.large ec2 instance. Version: RabbitMQ 3.1.5,  Erlang R14B04
>>>    - 23 queues (transaction and direct)
>>>    - 3 exchanges used, two fanout and one topic exchange
>>>    - topic exchange
>>>    - Topic exchange overview is attached.
>>>    - 46 total channels.
>>>
>>>
>>> AppServers
>>>
>>>    - m1.large tomcat servers running grails application
>>>    - 2-7 servers at any one time.
>>>    - Consume + publish
>>>    - On busy queues, each server has 16 consumers with prefetch at 100
>>>    - message sizes on busy queues are ~4KB.
>>>    - publishing rates on busiest queue ranges from 16/s to >100/s. (We
>>>    need to be able to support 1000/s).
>>>
>>>
>>> Each AppServer connects to a sharded mongodb cluster of 3 shards. Our
>>> first suspicion was that something in Mongo or AWS was causing the periodic
>>> delay but AWS techs looked into our volume use and said we were only use
>>> 25% of available bandwidth.
>>>
>>> At this moment, we have a modest publish rate (~50-60/s) but a backlog
>>> of 50,000 messages for the queue "user". You can see a 10 minute snapshot
>>> of the queue and see the cycling.
>>>
>>> I turned on tracing but the results don't seem to becoming into the log.
>>> Is there another way to enable reporting of flow control?
>>>
>>> Mike Templeman
>>>
>>>
>>> --
>>>
>>> *Mike Templeman*
>>> *Head of Development*
>>>
>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>> T: @Meshfire <http://twitter.com/meshfire>
>>>
>>>
>>>
>>> On Fri, Dec 13, 2013 at 6:03 AM, Alvaro Videla-2 [via RabbitMQ] <
>>> ml-node+s1065348n32063h90 at n5.nabble.com> wrote:
>>>
>>>> Mike,
>>>>
>>>> Would you be able to provide information more information to help us
>>>> debug the problem?
>>>>
>>>> Tim (from the rabbitmq team) requested more info in order to try to
>>>> find answers for this.
>>>>
>>>> For example, when consumption drops to zero, are there any logs on the
>>>> rabbitmq server that might tell of a flow control mechanism being
>>>> activated?
>>>>
>>>> Regards,
>>>>
>>>> Alvaro
>>>>
>>>>
>>>> On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=0>>
>>>> wrote:
>>>>
>>>> > Tyson
>>>> >
>>>> > Did you ever find an answer to this question? We are encountering
>>>> virtually
>>>> > the exact same problem.
>>>> >
>>>> > We have a variable number of servers setup as producers and consumers
>>>> and
>>>> > see our throughput drop to zero on a periodic basis. This is most
>>>> severe
>>>> > when there are a few hundred thousand messages on rabbit.
>>>> >
>>>> > Did you just drop Rabbit? Ours is running on an m1.large instance
>>>> with RAID0
>>>> > ephemeral drives, so size and performance of the disk subsystem is
>>>> not an
>>>> > issue (we are still in beta). We have spent untold hours tuning our
>>>> sharded
>>>> > mongodb subsystem only to find out that it is only being 25% utilized
>>>> (at
>>>> > least it will be blazing fast if we ever figure this out).
>>>> >
>>>> >
>>>> >
>>>> >
>>>> >
>>>> > --
>>>> > View this message in context:
>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
>>>> > Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>> > _______________________________________________
>>>> > rabbitmq-discuss mailing list
>>>> > [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=1>
>>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=2>
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>> ------------------------------
>>>>  If you reply to this email, your message will be added to the
>>>> discussion below:
>>>>
>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32063.html
>>>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>>>> here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=29247&code=bWlrZUBtZXNoZmlyZS5jb218MjkyNDd8MTYzNTUyMDM4MA==>
>>>> .
>>>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>>>
>>>
>>>
>>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32089.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/642882af/attachment.html>

From saurabh.infoedge at gmail.com  Sat Dec 14 06:45:01 2013
From: saurabh.infoedge at gmail.com (Saurabh Sharma)
Date: Sat, 14 Dec 2013 12:15:01 +0530
Subject: [rabbitmq-discuss] Defining the definite acknowledgement time
Message-ID: <CABjnW3tb5qf32wnQnU5Y5xe7Q0HN3vYPS=oYShY8YvVZ-MbmWw@mail.gmail.com>

Hi,
In case of multiple consumer ,Is it possible to set the time within which
consumer should acknowledge the rabbitmq server otherwise the message
should be considered as not acknowledged by the RabbitMQ server and should
be given to the other consumer?


Thanks and Regards
Saurabh Sharma
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131214/3a0fe9b3/attachment.html>

From michael.s.klishin at gmail.com  Sat Dec 14 08:26:47 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 14 Dec 2013 12:26:47 +0400
Subject: [rabbitmq-discuss] Defining the definite acknowledgement time
In-Reply-To: <CABjnW3tb5qf32wnQnU5Y5xe7Q0HN3vYPS=oYShY8YvVZ-MbmWw@mail.gmail.com>
References: <CABjnW3tb5qf32wnQnU5Y5xe7Q0HN3vYPS=oYShY8YvVZ-MbmWw@mail.gmail.com>
Message-ID: <CAE3HoVQF-a-5njVSOdVfkFqWAh+Ksv4ofW=NSRpAPWE9zwoSVQ@mail.gmail.com>

2013/12/14 Saurabh Sharma <saurabh.infoedge at gmail.com>

> In case of multiple consumer ,Is it possible to set the time within which
> consumer should acknowledge the rabbitmq server otherwise the message
> should be considered as not acknowledged by the RabbitMQ server and should
> be given to the other consumer?


No but you can have such a timer in the consumer app.


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131214/df843b4e/attachment.html>

From edward.woodcock at gmail.com  Fri Dec 13 14:06:49 2013
From: edward.woodcock at gmail.com (EdJ)
Date: Fri, 13 Dec 2013 06:06:49 -0800 (PST)
Subject: [rabbitmq-discuss] I made a node.js EventEmitter interface for
	rabbit
Message-ID: <2a731346-1dd3-4d3b-a9eb-481ee1dd44ab@googlegroups.com>

Alright chaps,

  I use RabbitMQ heavily at work, and I ended up writing a facade for 
amqp.node that allows you to pretend that RabbitMQ is a normal node.js 
EventEmitter. This helps makes  your code easier to test on a CI box as you 
can just switch to a "normal" EventEmitter temporarily, as well as being a 
nice simple interface.

  Thought I'd share (it certainly saved us quite a lot of time in dev), so 
if anyone's interested in giving it a go it's on 
https://npmjs.org/package/amqp-events

Ta,
Ed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131213/8e2831a1/attachment.html>

From michael.s.klishin at gmail.com  Sat Dec 14 19:32:20 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 14 Dec 2013 23:32:20 +0400
Subject: [rabbitmq-discuss] I made a node.js EventEmitter interface for
	rabbit
In-Reply-To: <2a731346-1dd3-4d3b-a9eb-481ee1dd44ab@googlegroups.com>
References: <2a731346-1dd3-4d3b-a9eb-481ee1dd44ab@googlegroups.com>
Message-ID: <CAE3HoVTinvii598OhpJ7-S5fN=dJpnSPSpURJ+3659M+_Cjm3w@mail.gmail.com>

2013/12/13 EdJ <edward.woodcock at gmail.com>

>   Thought I'd share (it certainly saved us quite a lot of time in dev), so
> if anyone's interested in giving it a go it's on
> https://npmjs.org/package/amqp-events
>

For those looking for source code:
https://github.com/EdJ/amqp-events
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131214/3c65d24c/attachment.html>

From joshua__lim at hotmail.com  Sun Dec 15 08:59:18 2013
From: joshua__lim at hotmail.com (Joshua Lim)
Date: Sun, 15 Dec 2013 08:59:18 +0000
Subject: [rabbitmq-discuss] Home node of durable queue is down or
	inaccessible
Message-ID: <BLU176-W1924C49781FCE971A2A107ADD90@phx.gbl>

Hi,
While testing my 2 nodes cluster ( 'rabbit at existing-machine' +  'rabbit at new-machine'), I encountered a fatal situation in which the queue on one of the nodes ( 'rabbit at new-machine') was "lost" after I restarted that node.  Before restarting, everything worked.  Also, I was able to restart the nodes previously without any issue until that error appeared.
1. I'm using RabbitMQ 3.2.1 on Erlang R16B02 on Windows 7 for both machines.2. The config for both nodes uses:       	         {cluster_nodes, {['rabbit at existing-machine'], disc}},       	        {cluster_partition_handling, autoheal}3. A Javascript JSOCK-STOMP consumer running on my Android phone was connected to 'rabbit at new-machine' and subscribed to queue "queue01".4. I used NCAT (command line) to connect to 'rabbit at existing-machine' to send messages to "queue01" which I'll read off my Android phone if cluster mirroring works.
After restarting 'rabbit at new-machine', the following error appeared on the 'rabbit at new-machine' log.  The Javascript consumer has code re-subscribe to the queue if it encounters an error or disconnects, but this didn't appear to work for this case.  "queue01" was missing from the port 15672 management web console.
=INFO REPORT==== 15-Dec-2013::01:42:31 ===Server startup complete; 10 plugins started. * amqp_client * cowboy * mochiweb * rabbitmq_management * rabbitmq_management_agent * rabbitmq_stomp * rabbitmq_web_dispatch * rabbitmq_web_stomp * sockjs * webmachine
=ERROR REPORT==== 15-Dec-2013::01:48:47 ===connection <0.473.0>, channel 1 - soft error:{amqp_error,not_found,            "home node 'rabbit at existing-machine' of durable queue 'queue01' in vhost '/' is down or inaccessible",            'queue.declare'}
=ERROR REPORT==== 15-Dec-2013::01:48:47 ===STOMP error frame sent:Message: not_foundDetail: "NOT_FOUND - home node 'rabbit at existing-machine' of durable queue 'queue01' in vhost '/' is down or inaccessible\n"Server private detail: none
On the other hand, the log on  'rabbit at existing-machine' didn't show anything unusual, and I was able to still see "queue01" on the port 15672 management web console for the existing-machine.
=INFO REPORT==== 15-Dec-2013::00:19:44 ===Server startup complete; 10 plugins started. * amqp_client * cowboy * mochiweb * rabbitmq_management * rabbitmq_management_agent * rabbitmq_stomp * rabbitmq_web_dispatch * rabbitmq_web_stomp * sockjs * webmachine
=INFO REPORT==== 15-Dec-2013::00:29:57 ===accepting STOMP connection <0.491.0> (127.0.0.1:1207 -> 127.0.0.1:61613)
=INFO REPORT==== 15-Dec-2013::01:39:52 ===Statistics database started.
=INFO REPORT==== 15-Dec-2013::01:39:54 ===rabbit on node rabbit at new-machine down
=INFO REPORT==== 15-Dec-2013::01:42:20 ===rabbit on node rabbit at new-machine up

Other than the queue problem, I was able to add and delete virtual hosts on 'rabbit at existing-machine' and this was reflected on 'rabbit at new-machine' management web console.
Finally, I was only able to recover the queue problem by restarting rabbitmq on 'rabbit at existing-machine'.
Rgds,Joshua
  		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131215/6d12e989/attachment.html>

From videlalvaro at gmail.com  Sun Dec 15 13:00:29 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 15 Dec 2013 13:00:29 +0000
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <CALdW9BwnLs_je13zg_4WBd-6NKemZDXry+sNXPV7ut8P=7hahw@mail.gmail.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
 <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
 <CALdW9BwnLs_je13zg_4WBd-6NKemZDXry+sNXPV7ut8P=7hahw@mail.gmail.com>
Message-ID: <CAMcAHLWS+utJDFEaXQK-DUKK0yugE1Q9rDSjG+A9xAaQRQb=TQ@mail.gmail.com>

Hi Mike,

Yes, RabbitMQ queues are designed for fast delivery of messages and for
being as empty as possible, as that blog post explains.

Another interesting blog post, about consumer strategies and basic.qos
settings is this one:
http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/#more-276

re multi ack: yes, that might help.

Regards,

Alvaro


On Sat, Dec 14, 2013 at 2:15 AM, MikeTempleman <mike at meshfire.com> wrote:

> I realized that was a bad interpretation. Sorry. The exchange is just
> successfully routing all the messages to the target queues.
>
> After reading a number of posts and this blog entry (
> http://www.rabbitmq.com/blog/2011/09/24/sizing-your-rabbits/) I wonder if
> the issue is that each message is ack'd. It seemed that the issue occurred
> when I had a large backlog in the queues. When Rabbit is empty, performance
> is fine. When the consumers tried to run at much higher speeds, we
> encountered this cycling.
>
> We have run a brief test with no-ack, not on production, and the
> performance is excellent even under load. But this is not a viable solution
> (appservers crash, autoscaling shuts servers down that have prefetched
> messages and are still connected to rabbit) without a full redesign.
>
> Assuming each queue is only one thread (I assume it handles both receipt,
> delivery, and ack cleanup) then I can understand what might happen when the
> consumers generate ~500 acks/s while new messages are coming in at a low
> 50-100/s rate on a specific queue. I will move out some events that tend to
> generate peaks into their own queue and accept that queue processing more
> slowly. As for separating the real worker queue, I suppose I could create 2
> or so static queues to divide the load up.
>
> So what I think I can do is:
> 1. bump the default tcp buffer from 128KB to around 10MB. The added
> buffering may help a little
> 2. see if I can find out how to set the multiple ack flag. We are using
> Grails so maybe that is just creating a custom bean. I don't know
> 3. create a couple of queues for lower-priority events specifically events
> chosen to be less time critical.
> 4. if all that doesn't work then probably create 4 queues for the high
> priority events, randomly publish to those queues, and put consumers for
> each queue.
> 5. Also, upgrade the server to the latest version.
>
> Mike Templeman
>
> --
>
> *Mike Templeman*
> *Head of Development*
>
> T: @talkingfrog1950 <http://twitter.com/missdestructo>
> T: @Meshfire <http://twitter.com/meshfire>
>
>
>
> On Fri, Dec 13, 2013 at 1:42 PM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=0>
> > wrote:
>
>> I noticed something else very odd.
>>
>> Currently, one queue has 43,000 messages backed up in its queue. But when
>> I look at the exchange (there is only one exchange) I see that the message
>> rate in exactly matches the message rate out.
>>
>> With such a huge backlog, why would that be? I would have thought that
>> the consumers (there are 16 total distributed across 4 systems for that
>> queue with a prefetch of 100) would run at a much higher steady state.
>>
>> This exchange also seems to cycle regularly. It appears to run from a low
>> of around 60/s in and out to 500+ a second in and out.
>>
>>  --
>>
>> *Mike Templeman*
>> *Head of Development*
>>
>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>> T: @Meshfire <http://twitter.com/meshfire>
>>
>>
>>
>> On Fri, Dec 13, 2013 at 10:40 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=1>
>> > wrote:
>>
>>> Also, from observing the Connections screen on the web UI shows that no
>>> flow control has been recently turned on for any of the four current
>>> connections (four app servers).
>>>
>>> --
>>>
>>> *Mike Templeman *
>>> *Head of Development*
>>>
>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>> T: @Meshfire <http://twitter.com/meshfire>
>>>
>>>
>>>
>>> On Fri, Dec 13, 2013 at 10:17 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=2>
>>> > wrote:
>>>
>>>> Hi Alvaro
>>>>
>>>> I would be more than happy to provide logs. But all they have in them
>>>> is connection and shutdown information. Nothing more. I have just enabled
>>>> tracing on the vhost and will send the logs shortly. We encounter this
>>>> issue when under load every day now.
>>>>
>>>> Let me tell you our architecture and deployment:
>>>>
>>>> rabbitMQ:
>>>>
>>>>    - m1.large ec2 instance. Version: RabbitMQ 3.1.5,  Erlang R14B04
>>>>    - 23 queues (transaction and direct)
>>>>    - 3 exchanges used, two fanout and one topic exchange
>>>>    - topic exchange
>>>>    - Topic exchange overview is attached.
>>>>    - 46 total channels.
>>>>
>>>>
>>>> AppServers
>>>>
>>>>    - m1.large tomcat servers running grails application
>>>>    - 2-7 servers at any one time.
>>>>    - Consume + publish
>>>>    - On busy queues, each server has 16 consumers with prefetch at 100
>>>>    - message sizes on busy queues are ~4KB.
>>>>    - publishing rates on busiest queue ranges from 16/s to >100/s. (We
>>>>    need to be able to support 1000/s).
>>>>
>>>>
>>>> Each AppServer connects to a sharded mongodb cluster of 3 shards. Our
>>>> first suspicion was that something in Mongo or AWS was causing the periodic
>>>> delay but AWS techs looked into our volume use and said we were only use
>>>> 25% of available bandwidth.
>>>>
>>>> At this moment, we have a modest publish rate (~50-60/s) but a backlog
>>>> of 50,000 messages for the queue "user". You can see a 10 minute snapshot
>>>> of the queue and see the cycling.
>>>>
>>>> I turned on tracing but the results don't seem to becoming into the
>>>> log. Is there another way to enable reporting of flow control?
>>>>
>>>> Mike Templeman
>>>>
>>>>
>>>> --
>>>>
>>>> *Mike Templeman*
>>>> *Head of Development*
>>>>
>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>
>>>>
>>>>
>>>> On Fri, Dec 13, 2013 at 6:03 AM, Alvaro Videla-2 [via RabbitMQ] <[hidden
>>>> email] <http://user/SendEmail.jtp?type=node&node=32089&i=3>> wrote:
>>>>
>>>>> Mike,
>>>>>
>>>>> Would you be able to provide information more information to help us
>>>>> debug the problem?
>>>>>
>>>>> Tim (from the rabbitmq team) requested more info in order to try to
>>>>> find answers for this.
>>>>>
>>>>> For example, when consumption drops to zero, are there any logs on the
>>>>> rabbitmq server that might tell of a flow control mechanism being
>>>>> activated?
>>>>>
>>>>> Regards,
>>>>>
>>>>> Alvaro
>>>>>
>>>>>
>>>>> On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=0>>
>>>>> wrote:
>>>>>
>>>>> > Tyson
>>>>> >
>>>>> > Did you ever find an answer to this question? We are encountering
>>>>> virtually
>>>>> > the exact same problem.
>>>>> >
>>>>> > We have a variable number of servers setup as producers and
>>>>> consumers and
>>>>> > see our throughput drop to zero on a periodic basis. This is most
>>>>> severe
>>>>> > when there are a few hundred thousand messages on rabbit.
>>>>> >
>>>>> > Did you just drop Rabbit? Ours is running on an m1.large instance
>>>>> with RAID0
>>>>> > ephemeral drives, so size and performance of the disk subsystem is
>>>>> not an
>>>>> > issue (we are still in beta). We have spent untold hours tuning our
>>>>> sharded
>>>>> > mongodb subsystem only to find out that it is only being 25%
>>>>> utilized (at
>>>>> > least it will be blazing fast if we ever figure this out).
>>>>> >
>>>>> >
>>>>> >
>>>>> >
>>>>> >
>>>>> > --
>>>>> > View this message in context:
>>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
>>>>> > Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>>> > _______________________________________________
>>>>> > rabbitmq-discuss mailing list
>>>>> > [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=1>
>>>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=2>
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>> ------------------------------
>>>>>  If you reply to this email, your message will be added to the
>>>>> discussion below:
>>>>>
>>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32063.html
>>>>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>>>>> here.
>>>>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>>>>
>>>>
>>>>
>>>
>>
>
> ------------------------------
> View this message in context: Re: Lower delivery rate than publish rate -
> why?<http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32089.html>
> Sent from the RabbitMQ mailing list archive<http://rabbitmq.1065348.n5.nabble.com/>at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131215/1d96d215/attachment.html>

From ranjith.v at zohocorp.com  Mon Dec 16 07:04:42 2013
From: ranjith.v at zohocorp.com (Ranjith Venkatesan)
Date: Sun, 15 Dec 2013 23:04:42 -0800 (PST)
Subject: [rabbitmq-discuss] Channels Connections and Consumers
Message-ID: <1387177482616-32096.post@n5.nabble.com>

Hi,

I am experimenting with RabbitMq. I tried to push some msgs to RabbitMq and
consume from Mq. My server runs a job for each user, which will consume from
RabbitMq. I could able to retrieve message from RabbitMq. But, after
installing management plugin, i saw a strange behavior in RabbitMq. The
number of connection,channel and consumers keeps on increasing for each
schedule it runs.  But the number of connection,channel and consumers not
closing if a schedule stop executing. 


Do we manually close channel ,connections and channel ? Or Am i missing some
config parameters ? 


Thanks in  Advance

Ranjith Venkatesan



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Channels-Connections-and-Consumers-tp32096.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Mon Dec 16 08:26:31 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 16 Dec 2013 08:26:31 +0000
Subject: [rabbitmq-discuss] Channels Connections and Consumers
In-Reply-To: <1387177482616-32096.post@n5.nabble.com>
References: <1387177482616-32096.post@n5.nabble.com>
Message-ID: <CAMcAHLXtERbaH_q0LDfh3bJrY6u+5zkkbg2fbWdQzAcSUUY6wg@mail.gmail.com>

Hi,

If your consumer application stops running, then the channels and
connections will be force closed. Of course is better if your
applications closes them.

Are your connections being blocked due to flow control?

Regards,

Alvaro

On Mon, Dec 16, 2013 at 7:04 AM, Ranjith Venkatesan
<ranjith.v at zohocorp.com> wrote:
> Hi,
>
> I am experimenting with RabbitMq. I tried to push some msgs to RabbitMq and
> consume from Mq. My server runs a job for each user, which will consume from
> RabbitMq. I could able to retrieve message from RabbitMq. But, after
> installing management plugin, i saw a strange behavior in RabbitMq. The
> number of connection,channel and consumers keeps on increasing for each
> schedule it runs.  But the number of connection,channel and consumers not
> closing if a schedule stop executing.
>
>
> Do we manually close channel ,connections and channel ? Or Am i missing some
> config parameters ?
>
>
> Thanks in  Advance
>
> Ranjith Venkatesan
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Channels-Connections-and-Consumers-tp32096.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ranjith.v at zohocorp.com  Mon Dec 16 08:48:01 2013
From: ranjith.v at zohocorp.com (Ranjith Venkatesan)
Date: Mon, 16 Dec 2013 00:48:01 -0800 (PST)
Subject: [rabbitmq-discuss] Channels Connections and Consumers
In-Reply-To: <CAMcAHLXtERbaH_q0LDfh3bJrY6u+5zkkbg2fbWdQzAcSUUY6wg@mail.gmail.com>
References: <1387177482616-32096.post@n5.nabble.com>
 <CAMcAHLXtERbaH_q0LDfh3bJrY6u+5zkkbg2fbWdQzAcSUUY6wg@mail.gmail.com>
Message-ID: <1387183681513-32098.post@n5.nabble.com>

Hi Alvaro,

Thanks for your reply. I think it is in blocking state. Hence when next
schedule is running, it is creating a new channel. 

And i have a one more question. Whether Connection creation,channel and
consumer creation are costlier operations?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Channels-Connections-and-Consumers-tp32096p32098.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From grifisu at gmail.com  Sun Dec 15 22:47:57 2013
From: grifisu at gmail.com (noname)
Date: Mon, 16 Dec 2013 00:47:57 +0200
Subject: [rabbitmq-discuss] is there any way in making a node from a cluster
 ignore it's previous state and just start without trying to connect to the
 other nodes?
Message-ID: <CADmAsSnoio1oj8pwbQq2mOkh0rkWbqn-aAu+ifSKhNvyuKBdRw@mail.gmail.com>

hello,

so the problem is like this ->
from another thread - start / stop order matters if you get all nodes down
and don't start with the last one closed or just won't start in the 30
seconds interval all of them.. then it won't work, we all agree on that.

ok , my question is : is there any way i can tweak (files i can edit) a
r.m.q. node, so if i have this scenario->
node A , B, C -> i bring down A nice ( or just kill the node but wait for
the others to get an update that the A node is down) , then same for B, and
last C
now i don't want to start node C first , nor i want to start all of them at
once;
what i want to know is : is there any way if i start node A first to make
it just start and not try to connect to node B & C? it's ok if i lose my
queues...
tried editing my nodes_at_shutdown file not really working, anyone got any
other suggestions?
thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/5c5ec04c/attachment.html>

From grifisu at gmail.com  Sun Dec 15 22:51:47 2013
From: grifisu at gmail.com (noname)
Date: Sun, 15 Dec 2013 14:51:47 -0800 (PST)
Subject: [rabbitmq-discuss] is there any way in making a node from a cluster
 ignore its previous state and just start without trying to connect to the
 other nodes?
Message-ID: <b2b294b0-290e-4437-b9de-a6a52390c525@googlegroups.com>

hello,

so the problem is like this ->
from another thread - start / stop order matters if you get all nodes down 
and don't start with the last one closed or just won't start in the 30 
seconds interval all of them.. then it won't work, we all agree on that.

ok , my question is : is there any way i can tweak (files i can edit) a 
r.m.q. node, so if i have this scenario->
node A , B, C -> i bring down A nice ( or just kill the node but wait for 
the others to get an update that the A node is down) , then same for B, and 
last C 
now i don't want to start node C first , nor i want to start all of them at 
once;
what i want to know is : is there any way if i start node A first to make 
it just start and not try to connect to node B & C? it's ok if i lose my 
queues...
tried editing my nodes_at_shutdown file not really working, anyone got any 
other suggestions?
thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131215/5c59c2ce/attachment.html>

From minaev at gmail.com  Mon Dec 16 08:45:07 2013
From: minaev at gmail.com (Dimitri Minaev)
Date: Mon, 16 Dec 2013 12:45:07 +0400
Subject: [rabbitmq-discuss] Queue not shown in rabbitmqctl
Message-ID: <CANTUpDAjvkxdkDBh=Wy08ruxXfv01iD0oubtdL6JQKvy31P8mg@mail.gmail.com>

Hello,

Today, I found RabbitMQ in a non-responsive state. It shut down due to
insufficient number of  file descriptors. The reason was that one queue was
overloaded with messages and RabbitMQ dumped a lot of messages into temp
files, keeping them open. `lsof' showed something like:

beam.smp 23236 rabbitmq   77u   REG      251,0        0    1574055
/var/lib/rabbitmq/mnesia/rabbit at d
bx/queues/B36DQ7YBKCJQXP3FJIJYVP8FR/journal.jif
beam.smp 23236 rabbitmq   78u   REG      251,0        0    1574067
/var/lib/rabbitmq/mnesia/rabbit at d
bx/queues/E2OCOOGFQWGZ7QU7V4PDME9BU/journal.jif
beam.smp 23236 rabbitmq   79u   REG      251,0        0        361
/var/lib/rabbitmq/mnesia/rabbit at dbx
/queues/A3RS8QB81UX1HCFPVOUD9SQIF/journal.jif
beam.smp 23236 rabbitmq   80u   REG      251,0        0    1574069
/var/lib/rabbitmq/mnesia/rabbit at dbx
/queues/122SUYRH75USFEOUF8UJ1E9YP/journal.jif
beam.smp 23236 rabbitmq   81u   REG      251,0        0    3411720
/var/lib/rabbitmq/mnesia/rabbit at dbx
/queues/90OT1K6VYE7TUBR6GI1CMU8BT/journal.jif
beam.smp 23236 rabbitmq   82u  IPv6 1449769938      0t0        TCP *:amqp
(LISTEN)
beam.smp 23236 rabbitmq   83r   REG      251,0 16405205    2097797
/var/lib/rabbitmq/mnesia/rabbit at dbx/msg_store_transient/1355.rdq
beam.smp 23236 rabbitmq   84r   REG      251,0 16777279    2100373
/var/lib/rabbitmq/mnesia/rabbit at dbx/msg_store_transient/21679.rdq
beam.smp 23236 rabbitmq   85r   REG      251,0 16777566    2098314
/var/lib/rabbitmq/mnesia/rabbit at dbx/msg_store_transient/19328.rdq
beam.smp 23236 rabbitmq   86r   REG      251,0 16777490    2097792
/var/lib/rabbitmq/mnesia/rabbit at dbx/msg_store_transient/19025.rdq

These journal.jif and *rdq files consumed all file handles.

But the strange thing was that the queue with 50 million messages was
visible in the management interface, but not in `rabbitmqctl list_queues'
output. What might be the cause?

And, while we're at it, shouldn't RabbtiMQ close the temporary files it
creates when there's not enough memory?

Thank you.

-- 
With best regards,
Dimitri Minaev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/1aed2aa0/attachment.html>

From emile at rabbitmq.com  Mon Dec 16 08:58:12 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Dec 2013 08:58:12 +0000
Subject: [rabbitmq-discuss] Syncing erlang cookie by editing
	rabbitmq-service
In-Reply-To: <CALDntb9kJihgKcDb1XGN_Tn7CXZzhjVhTO5ouRPkYTnJ6yoktw@mail.gmail.com>
References: <bce9ae2c-46ef-49aa-a89f-7402aed1752c@googlegroups.com>
 <52AB361F.3030805@rabbitmq.com>
 <CALDntb9kJihgKcDb1XGN_Tn7CXZzhjVhTO5ouRPkYTnJ6yoktw@mail.gmail.com>
Message-ID: <52AEC0A4.5060101@rabbitmq.com>

On 13/12/13 16:32, Patrick Long wrote:
> Can you suggest a workaround in the meantime? Other than manually
> copying the cookie files

You could set the RABBITMQ_SERVER_START_ARGS variable
as you have and remove the line containing just "!STAR!" and the
trailing circumflex on the preceding line of rabbitmq-service.bat.





-Emile




From michael.s.klishin at gmail.com  Mon Dec 16 09:09:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 13:09:18 +0400
Subject: [rabbitmq-discuss] is there any way in making a node from a
 cluster ignore its previous state and just start without trying to connect
 to the other nodes?
In-Reply-To: <b2b294b0-290e-4437-b9de-a6a52390c525@googlegroups.com>
References: <b2b294b0-290e-4437-b9de-a6a52390c525@googlegroups.com>
Message-ID: <CAE3HoVTXqtx2mUUk3bd9xLXDMwkPbV2Bp_zfB86A1Ly8fNDdsA@mail.gmail.com>

2013/12/16 noname <grifisu at gmail.com>

> what i want to know is : is there any way if i start node A first to make
> it just start and not try to connect to node B & C? it's ok if i lose my
> queues...


You can reset nodes, see Breaking Up a Cluster in [1].

1. http://www.rabbitmq.com/clustering.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/5cbdd7be/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 16 09:12:19 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 13:12:19 +0400
Subject: [rabbitmq-discuss] Channels Connections and Consumers
In-Reply-To: <1387183681513-32098.post@n5.nabble.com>
References: <1387177482616-32096.post@n5.nabble.com>
 <CAMcAHLXtERbaH_q0LDfh3bJrY6u+5zkkbg2fbWdQzAcSUUY6wg@mail.gmail.com>
 <1387183681513-32098.post@n5.nabble.com>
Message-ID: <CAE3HoVTM0oJeVBCLF_cwjETh0Hk5T66QZPBqFD5vyH8YCXqNYw@mail.gmail.com>

2013/12/16 Ranjith Venkatesan <ranjith.v at zohocorp.com>

> And i have a one more question. Whether Connection creation,channel and
> consumer creation are costlier operations?
>

Opening a connection creates a new TCP connection. Opening a channel
consumes fewer resources
but is still not free, so you need to make sure that open channel growth is
not unbound.

Adding a consumer likely consumes the least amount of RAM.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/6a3930ac/attachment.html>

From ashishjoshi106 at gmail.com  Mon Dec 16 09:15:12 2013
From: ashishjoshi106 at gmail.com (Ashish Joshi)
Date: Mon, 16 Dec 2013 14:45:12 +0530
Subject: [rabbitmq-discuss] Error: Rabbitmq error while using Sensu
Message-ID: <CAMr_w0rt-Hi2L2=RL1-H9L8=UzcPAb_8V8UP1ZAg9CudVrM=pg@mail.gmail.com>

Please provide me some solution

sensu dashboard is connected and but after starting sensu-api and
sensu-client and sensu-server services they stopped automatically and shows
pid is dead in status.

I am sending you sensu-client.logs which showing that rabbitmq is not
connecting and after 3 attempts it gives connection timeout error :

{"timestamp":"2013-12-16T13:
37:48.853433+0530","level":"info","message":"loaded
extension","type":"handler","name":"debug","description":"outputs json
event data"}
{"timestamp":"2013-12-16T13:37:51.895658+0530","level":"warn","message":"reconnecting
to rabbitmq"}
{"timestamp":"2013-12-16T13:37:59.902074+0530","level":"warn","message":"reconnecting
to rabbitmq"}
{"timestamp":"2013-12-16T13:38:07.908031+0530","level":"warn","message":"reconnecting
to rabbitmq"}
{"timestamp":"2013-12-16T13:38:08.877783+0530","level":"fatal","message":"rabbitmq
connection error","error":"timed out while attempting to connect"}
{"timestamp":"2013-12-16T13:38:08.877997+0530","level":"warn","message":"stopping"}
{"timestamp":"2013-12-16T13:38:08.878091+0530","level":"warn","message":"unsubscribing
from client subscriptions"}
{"timestamp":"2013-12-16T13:38:08.878193+0530","level":"info","message":"completing
checks in progress","checks_in_progress":[]}
{"timestamp":"2013-12-16T13:38:09.379591+0530","level":"warn","message":"stopping
reactor"}





Regards:
Ashish Joshi
Linux Admin L3
HRN (Neerja Soft), Jaipur
9166631176
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/08c999df/attachment.html>

From 314992959 at qq.com  Mon Dec 16 09:25:02 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 16 Dec 2013 01:25:02 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c msg in queue can't be published
Message-ID: <1387185902020-32106.post@n5.nabble.com>

  I  create  a   queue:    q123.    create  a  exchange:  ex123.     and  
bind  the  queue  to  exchange  by    rule: fanout.    
  So  I can  send  msg  to  ex123  and  receive   msg   from   q123. 
  I  use   amqp_basic_consume(q123,...)  to  create  a  consumer:  con123.   
  At the beginning, if I send , then  I  receive.   But  once  I send  a 
msg,  I can not  receive it.   So  I Check the  queue  by   rabbitmqctl.  I 
see    the  msg  in q123   who  had  not  been  published.   So  I  try  to 
remove the consumer:  amqp_basic_cancel(q123...)  and   request  the
consumer             :amqp_basic_consume(q123....).  But  I  still  can  not
receive  the  msg.   
   finally  I  restart  the  connection  to  MQ  server,  then  I   receive 
the msg.  So  what's wrong with  my  c++ program?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-msg-in-queue-can-t-be-published-tp32106.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Mon Dec 16 09:25:10 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 13:25:10 +0400
Subject: [rabbitmq-discuss] Error: Rabbitmq error while using Sensu
In-Reply-To: <CAMr_w0rt-Hi2L2=RL1-H9L8=UzcPAb_8V8UP1ZAg9CudVrM=pg@mail.gmail.com>
References: <CAMr_w0rt-Hi2L2=RL1-H9L8=UzcPAb_8V8UP1ZAg9CudVrM=pg@mail.gmail.com>
Message-ID: <CAE3HoVS+Ds1MMaOjDTD6Jr7Q7VoU+R0knovvYQPuwm=H7ZTQqg@mail.gmail.com>

2013/12/16 Ashish Joshi <ashishjoshi106 at gmail.com>

> {"timestamp":"2013-12-16T13:38:08.877783+0530","level":"fatal","message":"rabbitmq
> connection error","error":"timed out while attempting to connect"}
>

Here is your answer: Sensu cannot reach RabbitMQ.


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/04b8f285/attachment.html>

From ranjith.v at zohocorp.com  Mon Dec 16 09:28:25 2013
From: ranjith.v at zohocorp.com (Ranjith Venkatesan)
Date: Mon, 16 Dec 2013 01:28:25 -0800 (PST)
Subject: [rabbitmq-discuss] Channels Connections and Consumers
In-Reply-To: <CAE3HoVTM0oJeVBCLF_cwjETh0Hk5T66QZPBqFD5vyH8YCXqNYw@mail.gmail.com>
References: <1387177482616-32096.post@n5.nabble.com>
 <CAMcAHLXtERbaH_q0LDfh3bJrY6u+5zkkbg2fbWdQzAcSUUY6wg@mail.gmail.com>
 <1387183681513-32098.post@n5.nabble.com>
 <CAE3HoVTM0oJeVBCLF_cwjETh0Hk5T66QZPBqFD5vyH8YCXqNYw@mail.gmail.com>
Message-ID: <1387186105951-32108.post@n5.nabble.com>

Hi michaelklishin,

Thanks for ur reply. I had two opinions reg Connections. 

==>One thing is keeping connection,channel,consumer for a particular user in
memory and utilizing that object from 2nd schedule onwards. 

==>Else, creating new connection,channel,consumer for every schedule ( for
each user) and closing it . 

Since initial steps (connection,channel) creation seems to be lighter
operation, hence i could go with 2nd option. With this number of opened
channels also will be in limit. 


regards

RANJITH VENKATESAN



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Channels-Connections-and-Consumers-tp32096p32108.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Mon Dec 16 09:29:51 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 13:29:51 +0400
Subject: [rabbitmq-discuss] rabbitmq-c msg in queue can't be published
In-Reply-To: <1387185902020-32106.post@n5.nabble.com>
References: <1387185902020-32106.post@n5.nabble.com>
Message-ID: <CAE3HoVTvD_6BSW2SC4sxbNV_vbVm_f4C1cv6egGMMD2ZWzzb4A@mail.gmail.com>

2013/12/16 3k4b251 <314992959 at qq.com>

> But  once  I send  a
> msg,  I can not  receive it.   So  I Check the  queue  by   rabbitmqctl.  I
> see    the  msg  in q123   who  had  not  been  published.   So  I  try  to
> remove the consumer:  amqp_basic_cancel(q123...)  and   request  the
> consumer             :amqp_basic_consume(q123....).  But  I  still  can
>  not
> receive  the  msg.
>    finally  I  restart  the  connection  to  MQ  server,  then  I   receive
> the msg.
>

Make sure that the queue is not auto-delete. Use management UI to find out
if the messages
are actually being routed and if the exchange type is indeed fanout. Make
sure your don't use
manual acknowledgements and configure basic.qos, or if you do, you ack or
reject messages
correctly.

See RabbitMQ log if there are any exceptions. Use RabbitMQ tracer (ships
with the Java client)
to see what's being sent up and down the wire.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/4ea7e604/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 16 09:31:48 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 13:31:48 +0400
Subject: [rabbitmq-discuss] Channels Connections and Consumers
In-Reply-To: <1387186105951-32108.post@n5.nabble.com>
References: <1387177482616-32096.post@n5.nabble.com>
 <CAMcAHLXtERbaH_q0LDfh3bJrY6u+5zkkbg2fbWdQzAcSUUY6wg@mail.gmail.com>
 <1387183681513-32098.post@n5.nabble.com>
 <CAE3HoVTM0oJeVBCLF_cwjETh0Hk5T66QZPBqFD5vyH8YCXqNYw@mail.gmail.com>
 <1387186105951-32108.post@n5.nabble.com>
Message-ID: <CAE3HoVQMVxLpi09jBKdH3=0v4ftEKDtSDLVmUxKX8J5Gpd8JUg@mail.gmail.com>

2013/12/16 Ranjith Venkatesan <ranjith.v at zohocorp.com>

> ==>Else, creating new connection,channel,consumer for every schedule ( for
> each user) and closing it .
>
> Since initial steps (connection,channel) creation seems to be lighter
> operation, hence i could go with 2nd option. With this number of opened
> channels also will be in limit.
>

It's a better idea if the scheduled operations do not run frequently (say,
many times a second):
it will be easier to design error handling and recovery (e.g. when network
connection fails).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/c93bcdd1/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 16 09:35:04 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 13:35:04 +0400
Subject: [rabbitmq-discuss] ANN Langohr 2.0 is released
Message-ID: <CAE3HoVRafjky+9RZu9mzhjtyZL4FD0vaOd0kwStv4ov2V8XqRg@mail.gmail.com>

Langohr [1] is a small RabbitMQ client.

2.0 is a major release that introduces automatic topology recovery
(exchanges, queues, bindings, consumers). Release notes:
http://blog.clojurewerkz.org/blog/2013/12/15/langohr-2-dot-0-0-is-released/

There's also a new documentation guide to accompany this release:
http://clojurerabbitmq.info/articles/error_handling.html

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/0c56f34a/attachment.html>

From 314992959 at qq.com  Mon Dec 16 10:15:28 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 16 Dec 2013 02:15:28 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c msg in queue can't be published
In-Reply-To: <CAE3HoVTvD_6BSW2SC4sxbNV_vbVm_f4C1cv6egGMMD2ZWzzb4A@mail.gmail.com>
References: <1387185902020-32106.post@n5.nabble.com>
 <CAE3HoVTvD_6BSW2SC4sxbNV_vbVm_f4C1cv6egGMMD2ZWzzb4A@mail.gmail.com>
Message-ID: <1387188928294-32112.post@n5.nabble.com>

the  queue  is  not auto-delete. I  used  the management UI  and sure the 
msg  already  in queue.  So  I  think  it's  not  route's  problem.   I  use 
Ack  But  I'm  sure  that  I'm  not  receive  the msg  before  by  my
program log.  no use qos.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-msg-in-queue-can-t-be-published-tp32106p32112.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Mon Dec 16 10:21:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 14:21:11 +0400
Subject: [rabbitmq-discuss] rabbitmq-c msg in queue can't be published
In-Reply-To: <1387188928294-32112.post@n5.nabble.com>
References: <1387185902020-32106.post@n5.nabble.com>
 <CAE3HoVTvD_6BSW2SC4sxbNV_vbVm_f4C1cv6egGMMD2ZWzzb4A@mail.gmail.com>
 <1387188928294-32112.post@n5.nabble.com>
Message-ID: <CAE3HoVRt21zRvjoR-=3cRdhAeYxOZJAoDe8yWDjiKGFOnYk2xA@mail.gmail.com>

2013/12/16 3k4b251 <314992959 at qq.com>

> the  queue  is  not auto-delete. I  used  the management UI  and sure the
> msg  already  in queue.  So  I  think  it's  not  route's  problem.   I
>  use
> Ack  But  I'm  sure  that  I'm  not  receive  the msg  before  by  my
> program log.  no use qos.
>

Then it may be that you don't use the client library correctly.

Please post some relevant parts of your code.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/d699dbae/attachment.html>

From joshua__lim at hotmail.com  Mon Dec 16 11:00:33 2013
From: joshua__lim at hotmail.com (joshua__lim)
Date: Mon, 16 Dec 2013 03:00:33 -0800 (PST)
Subject: [rabbitmq-discuss] Home node of durable queue is down or
	inaccessible
In-Reply-To: <BLU176-W1924C49781FCE971A2A107ADD90@phx.gbl>
References: <BLU176-W1924C49781FCE971A2A107ADD90@phx.gbl>
Message-ID: <1387191632847-32114.post@n5.nabble.com>

Here's a update to my initial email.  I found out that ha has a different
configuration from clustering from this article -
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-June/028151.html

So I ran the following command on both nodes:

rabbitmqctl set_policy ha-all ".*" "{""ha-mode"":""all""}"
..done.

Under the management plugin web-UI for both nodes, I'm able to see:

Virtual Host	Name	Pattern	Apply to	Definition	Priority
/	ha-all  .*	all	ha-mode:	all           0


Nevertheless, I'm still getting the same queue is down error when I removed
joshua at existing-machine:

=ERROR REPORT==== 16-Dec-2013::18:53:24 ===
connection <0.757.0>, channel 1 - soft error:
{amqp_error,not_found,
            "home node 'rabbit at existing-machine' of durable queue 'queue01'
in vhost '/' is down or inaccessible",
            'queue.declare'}

=ERROR REPORT==== 16-Dec-2013::18:53:24 ===
STOMP error frame sent:
Message: not_found
Detail: "NOT_FOUND - home node 'rabbit at existing-machine' of durable queue
'queue01' in vhost '/' is down or inaccessible\n"
Server private detail: none


btw, would there be by any chance a "auto-configuration" for policy ha using
the RabbitMQ configuration file?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Home-node-of-durable-queue-is-down-or-inaccessible-tp32094p32114.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Mon Dec 16 11:28:16 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 16 Dec 2013 11:28:16 +0000
Subject: [rabbitmq-discuss] is there any way in making a node from a
	cluster ignore it's previous state and just start without
	trying to connect to the other nodes?
In-Reply-To: <CADmAsSnoio1oj8pwbQq2mOkh0rkWbqn-aAu+ifSKhNvyuKBdRw@mail.gmail.com>
References: <CADmAsSnoio1oj8pwbQq2mOkh0rkWbqn-aAu+ifSKhNvyuKBdRw@mail.gmail.com>
Message-ID: <39FC993F-28A0-4679-A585-FE8FDF59ECEE@rabbitmq.com>

If you want to remove a node from a cluster, why not use the forget_cluster_node command, as described in http://www.rabbitmq.com/clustering.html? See the section "Breaking up a cluster" for more details. Does that look like what you need?

Cheers,
Tim

On 15 Dec 2013, at 22:47, noname wrote:

> hello,
> 
> so the problem is like this ->
> from another thread - start / stop order matters if you get all nodes down and don't start with the last one closed or just won't start in the 30 seconds interval all of them.. then it won't work, we all agree on that.
> 
> ok , my question is : is there any way i can tweak (files i can edit) a r.m.q. node, so if i have this scenario->
> node A , B, C -> i bring down A nice ( or just kill the node but wait for the others to get an update that the A node is down) , then same for B, and last C 
> now i don't want to start node C first , nor i want to start all of them at once;
> what i want to know is : is there any way if i start node A first to make it just start and not try to connect to node B & C? it's ok if i lose my queues...
> tried editing my nodes_at_shutdown file not really working, anyone got any other suggestions?
> thanks in advance.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Mon Dec 16 11:42:48 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 16 Dec 2013 11:42:48 +0000
Subject: [rabbitmq-discuss] Channels Connections and Consumers
In-Reply-To: <1387183681513-32098.post@n5.nabble.com>
References: <1387177482616-32096.post@n5.nabble.com>
 <CAMcAHLXtERbaH_q0LDfh3bJrY6u+5zkkbg2fbWdQzAcSUUY6wg@mail.gmail.com>
 <1387183681513-32098.post@n5.nabble.com>
Message-ID: <CAMcAHLWc6rRYnGzdjagA8UUfqg+LJvHmFN5XYOtf5ZjfPs29JA@mail.gmail.com>

Hi,

On Mon, Dec 16, 2013 at 8:48 AM, Ranjith Venkatesan
<ranjith.v at zohocorp.com> wrote:
> I think it is in blocking state. Hence when next

You should check why your app is being blocked by RabbitMQ, why the
flow control mechanism is activated, since it's there for a reason.

One of the problems with this mechanism is that if you abruptly close
the connection while it was in blocked state, then the connection will
stay there, leaking.

Regards,

Alvaro

From mgolden at smoczus.pl  Mon Dec 16 15:10:55 2013
From: mgolden at smoczus.pl (=?UTF-8?B?TWlyb3PFgmF3IE5hZ2HFmw==?=)
Date: Mon, 16 Dec 2013 16:10:55 +0100
Subject: [rabbitmq-discuss] Stability/Reliability of a cluster with mirrored
	queue
Message-ID: <52AF17FF.9050800@smoczus.pl>

Hi,

I would like to know your opinion about stability/reliability of a 
cluster with mirrored queues. I'm considering to use it and even tried 
with 3.2.0. I guess I don't have to point out how huge disappointment 
was it. And what's worse, if you skim recent releases notes, it's really 
hard to find a release without some bug fixes related to clustering 
and/or HA.

What I'm asking is, is a cluster setup with mirrored queues stable and 
reliable and past bugs/problems appeared really rarely in anomalous use 
cases/conditions or the reality is that it has some 
stability/reliability issues that affects every robust use cases at some 
point?

We have been running a single node without interruption on production 
(cloud) for about 1,5 year. Having in mind all past bugs, what I'm 
worried about is that, in a year from now I will come to a conclusion 
that because of a cluster with mirrored queue my overall reliability 
and/or stability was much worse than eg. just two separate nodes behind 
LB (maintainability is not a big deal here; we use persistence and can 
afford restoring messages from a failed node manually in case of a cloud 
machine failure).

Maybe someone can share his experience from production run?


/mn

From raj.kumar.sanpui at gmail.com  Mon Dec 16 15:36:24 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Mon, 16 Dec 2013 07:36:24 -0800 (PST)
Subject: [rabbitmq-discuss] Why does the queue drop other messages after the
	first is consumed?
Message-ID: <1387208184746-32118.post@n5.nabble.com>

Hi All,

I have created a queue using:
amqp_queue_declare(conn, channel, amqp_cstring_bytes(queue.c_str()), 0
                        , 1, 0, 1,  amqp_empty_table);

There are 4 publishers, which publishes the message fine, and the message
count is also 4. But as soon as one of the message is consumed the rest are
getting discarded.

Any hint, as why it is happening?





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-does-the-queue-drop-other-messages-after-the-first-is-consumed-tp32118.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From raj.kumar.sanpui at gmail.com  Mon Dec 16 15:50:37 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Mon, 16 Dec 2013 07:50:37 -0800 (PST)
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <1387208184746-32118.post@n5.nabble.com>
References: <1387208184746-32118.post@n5.nabble.com>
Message-ID: <1387209037979-32119.post@n5.nabble.com>

My queue's bindings are still there, and the other consumers waiting for the
message are clinged to the queue, but for some reason, no more messages can
be stored in the queue, even manually trying to publish messages using the
GUI does not work.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-does-the-queue-drop-other-messages-after-the-first-is-consumed-tp32118p32119.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Mon Dec 16 15:53:48 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 16 Dec 2013 15:53:48 +0000
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <1387209037979-32119.post@n5.nabble.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <1387209037979-32119.post@n5.nabble.com>
Message-ID: <CAMcAHLU-_NL0qnyVK3ke862ydmP1de6o5KqmRzCoc=sSdsgy0g@mail.gmail.com>

Be aware that people might not now the C API. What does those
zero/ones flag mean in that API?

On Mon, Dec 16, 2013 at 3:50 PM, kingsmasher1
<raj.kumar.sanpui at gmail.com> wrote:
> My queue's bindings are still there, and the other consumers waiting for the
> message are clinged to the queue, but for some reason, no more messages can
> be stored in the queue, even manually trying to publish messages using the
> GUI does not work.
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-does-the-queue-drop-other-messages-after-the-first-is-consumed-tp32118p32119.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Mon Dec 16 15:58:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 19:58:11 +0400
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <1387208184746-32118.post@n5.nabble.com>
References: <1387208184746-32118.post@n5.nabble.com>
Message-ID: <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>

2013/12/16 kingsmasher1 <raj.kumar.sanpui at gmail.com>

> There are 4 publishers, which publishes the message fine, and the message
> count is also 4. But as soon as one of the message is consumed the rest are
> getting discarded.
>

What do you mean by discarded? Are they not delivered, does the queue
message count in management UI drops to zero?

What's in the log? How do you consume the message? Is the consumer
cancelled at any point?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/5f37baf3/attachment.html>

From raj.kumar.sanpui at gmail.com  Mon Dec 16 16:13:02 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Mon, 16 Dec 2013 08:13:02 -0800 (PST)
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
Message-ID: <1387210382989-32122.post@n5.nabble.com>

Dear All,

Thanks for the response, yeah the message count in the GUI as well as the
rabbitmqctl shows as 0.

This is my consume method: (i just commented all the unbind calls to make
sure, after one consume the queue is not getting unbinded)

std::string amqConnection::consume() {
	Debug("%s - \n", __FUNCTION__);
	amqp_basic_consume(conn, 1, m_queuename, amqp_empty_bytes, 0, 1, 0,
amqp_empty_table);
	amqp_rpc_reply_t res = amqp_get_rpc_reply(conn);
	int rc = check_amqp_error(res, "consume");
	if (rc != 0) return NULL;

	amqp_frame_t frame;
	int result;

	amqp_basic_deliver_t *d;
	amqp_basic_properties_t *p;
	size_t body_target;
	size_t body_received;

	amqp_maybe_release_buffers(conn);
	Debug("%s - wait frame\n", __FUNCTION__);
	result = amqp_simple_wait_frame(conn, &frame);
	Debug("%s Result %d\n",__FUNCTION__, result);
	if (result < 0)
		return "";

	Debug("%s Frame type %d, channel %d\n",__FUNCTION__, frame.frame_type,
frame.channel);
	if (frame.frame_type != AMQP_FRAME_METHOD)
		return "";

	Debug("%s Method %s\n", __FUNCTION__,
amqp_method_name(frame.payload.method.id));
	if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
		return "";

	d = (amqp_basic_deliver_t *) frame.payload.method.decoded;
	Debug("%s Delivery %u, exchange %.*s routingkey %.*s\n",__FUNCTION__,
			(unsigned) d->delivery_tag,
			(int) d->exchange.len, (char *) d->exchange.bytes,
			(int) d->routing_key.len, (char *) d->routing_key.bytes);

	result = amqp_simple_wait_frame(conn, &frame);
	if (result < 0)
		return "";

	if (frame.frame_type != AMQP_FRAME_HEADER) {
		ErrLog( "%s Expected header!",__FUNCTION__);
		return "";
	}
	p = (amqp_basic_properties_t *) frame.payload.properties.decoded;
	if (p->_flags & AMQP_BASIC_CONTENT_TYPE_FLAG) {
		Debug("%s Content-type: %.*s\n",__FUNCTION__,
				(int) p->content_type.len, (char *) p->content_type.bytes);
	}
	Debug("%s ----\n", __FUNCTION__);

	body_target = frame.payload.properties.body_size;
	body_received = 0;
        std::string response="";
	while (body_received < body_target) {
		result = amqp_simple_wait_frame(conn, &frame);
		if (result < 0)
			break;

		if (frame.frame_type != AMQP_FRAME_BODY) {
			ErrLog( " %s Expected body!", __FUNCTION__);
			break;
		}

		body_received += frame.payload.body_fragment.len;
		//assert(body_received <= body_target);

		//amqp_dump(frame.payload.body_fragment.bytes,
		//		frame.payload.body_fragment.len);
	        response += std::string((char *) frame.payload.body_fragment.bytes,
body_received );
	}



	return response;
}



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-does-the-queue-drop-other-messages-after-the-first-is-consumed-tp32118p32122.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tcatyb at gmail.com  Mon Dec 16 16:17:34 2013
From: tcatyb at gmail.com (Tom Catyb)
Date: Mon, 16 Dec 2013 08:17:34 -0800 (PST)
Subject: [rabbitmq-discuss] is there any way in making a node from a
 cluster ignore its previous state and just start without trying to connect
 to the other nodes?
In-Reply-To: <b2b294b0-290e-4437-b9de-a6a52390c525@googlegroups.com>
References: <b2b294b0-290e-4437-b9de-a6a52390c525@googlegroups.com>
Message-ID: <0b5b3431-48dd-41e4-90c6-a89e815a1a1c@googlegroups.com>

You should be able to do a reset on the node.
Make sure your rabbit.config does not have nodes B,C in it,



On Sunday, December 15, 2013 5:51:47 PM UTC-5, noname wrote:
>
> hello,
>
> so the problem is like this ->
> from another thread - start / stop order matters if you get all nodes down 
> and don't start with the last one closed or just won't start in the 30 
> seconds interval all of them.. then it won't work, we all agree on that.
>
> ok , my question is : is there any way i can tweak (files i can edit) a 
> r.m.q. node, so if i have this scenario->
> node A , B, C -> i bring down A nice ( or just kill the node but wait for 
> the others to get an update that the A node is down) , then same for B, and 
> last C 
> now i don't want to start node C first , nor i want to start all of them 
> at once;
> what i want to know is : is there any way if i start node A first to make 
> it just start and not try to connect to node B & C? it's ok if i lose my 
> queues...
> tried editing my nodes_at_shutdown file not really working, anyone got any 
> other suggestions?
> thanks in advance.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/29f40dc0/attachment.html>

From raj.kumar.sanpui at gmail.com  Mon Dec 16 16:27:28 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Mon, 16 Dec 2013 21:57:28 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <1387210382989-32122.post@n5.nabble.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
Message-ID: <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>

And the consume is called from another thread...

void *con(void *arg) {
                amqp_bytes_t queue;
                printf("%s %s\n",__FUNCTION__,(char *) arg);

                Debug("%s() - Get an mq connection\n", __FUNCTION__);
                amqConnection *conn =  util.getAMQConnection ();
                if (conn == NULL) {
                        ErrLog("%s() - get connection failed\n",
__FUNCTION__);
                        pthread_exit(0) ;
                }
                Debug("%s() - declare exchange %s\n", __FUNCTION__,
EXCHANGE);
                int rc = conn->declareExchange(EXCHANGE, QUEUETYPE, 1);
                if (rc != 0) {
                        ErrLog("%s() - declare exchange %s %s failed\n",
__FUNCTION__, EXCHANGE, QUEUETYPE);
                        util.returnAMQConnection(conn);
                        pthread_exit(0) ;
                }

                pthread_mutex_trylock(&mutex_lock);
                printf("Consumer Thread %s: Lock acquired and trying to
consume\n",(char*) arg);
                messageCounter = conn->Qlength(QUEUENAME);
                //while (messageCounter == 0)
                {
                        printf("Consumer thread: %s waiting for signal as
messageCounter = 0\n",(char *) arg);
                        //pthread_cond_wait(&cond_lock, &mutex_lock);
                }
                printf("Consumer thread: %s Got signal !!! %d messages in
queue \n", (char *) arg, messageCounter);
                Debug("%s() - consume  %s\n", __FUNCTION__,ROUTINGKEY );

                std::string message = conn->consume(QUEUENAME, EXCHANGE,
ROUTINGKEY);
                if (0 == message.length()) {
                        ErrLog("%s() - consume queue %s failed\n",
__FUNCTION__, QUEUENAME);
                        printf("%s() - consume queue %s failed\n",
__FUNCTION__, QUEUENAME);
                        rc = conn->deleteQueue(QUEUENAME);
                        if (rc != 0) {
                                ErrLog("%s() - delete queue %s failed\n",
__FUNCTION__, QUEUENAME);
                        }
                        util.returnAMQConnection(conn);
                        pthread_exit(0) ;
                }
<snip>

   At the end we call pthread_mutex_unlock( ) so that other threads can
consume too !!




On Mon, Dec 16, 2013 at 9:43 PM, kingsmasher1 <raj.kumar.sanpui at gmail.com>wrote:

> Dear All,
>
> Thanks for the response, yeah the message count in the GUI as well as the
> rabbitmqctl shows as 0.
>
> This is my consume method: (i just commented all the unbind calls to make
> sure, after one consume the queue is not getting unbinded)
>
> std::string amqConnection::consume() {
>         Debug("%s - \n", __FUNCTION__);
>         amqp_basic_consume(conn, 1, m_queuename, amqp_empty_bytes, 0, 1, 0,
> amqp_empty_table);
>         amqp_rpc_reply_t res = amqp_get_rpc_reply(conn);
>         int rc = check_amqp_error(res, "consume");
>         if (rc != 0) return NULL;
>
>         amqp_frame_t frame;
>         int result;
>
>         amqp_basic_deliver_t *d;
>         amqp_basic_properties_t *p;
>         size_t body_target;
>         size_t body_received;
>
>         amqp_maybe_release_buffers(conn);
>         Debug("%s - wait frame\n", __FUNCTION__);
>         result = amqp_simple_wait_frame(conn, &frame);
>         Debug("%s Result %d\n",__FUNCTION__, result);
>         if (result < 0)
>                 return "";
>
>         Debug("%s Frame type %d, channel %d\n",__FUNCTION__,
> frame.frame_type,
> frame.channel);
>         if (frame.frame_type != AMQP_FRAME_METHOD)
>                 return "";
>
>         Debug("%s Method %s\n", __FUNCTION__,
> amqp_method_name(frame.payload.method.id));
>         if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
>                 return "";
>
>         d = (amqp_basic_deliver_t *) frame.payload.method.decoded;
>         Debug("%s Delivery %u, exchange %.*s routingkey
> %.*s\n",__FUNCTION__,
>                         (unsigned) d->delivery_tag,
>                         (int) d->exchange.len, (char *) d->exchange.bytes,
>                         (int) d->routing_key.len, (char *)
> d->routing_key.bytes);
>
>         result = amqp_simple_wait_frame(conn, &frame);
>         if (result < 0)
>                 return "";
>
>         if (frame.frame_type != AMQP_FRAME_HEADER) {
>                 ErrLog( "%s Expected header!",__FUNCTION__);
>                 return "";
>         }
>         p = (amqp_basic_properties_t *) frame.payload.properties.decoded;
>         if (p->_flags & AMQP_BASIC_CONTENT_TYPE_FLAG) {
>                 Debug("%s Content-type: %.*s\n",__FUNCTION__,
>                                 (int) p->content_type.len, (char *)
> p->content_type.bytes);
>         }
>         Debug("%s ----\n", __FUNCTION__);
>
>         body_target = frame.payload.properties.body_size;
>         body_received = 0;
>         std::string response="";
>         while (body_received < body_target) {
>                 result = amqp_simple_wait_frame(conn, &frame);
>                 if (result < 0)
>                         break;
>
>                 if (frame.frame_type != AMQP_FRAME_BODY) {
>                         ErrLog( " %s Expected body!", __FUNCTION__);
>                         break;
>                 }
>
>                 body_received += frame.payload.body_fragment.len;
>                 //assert(body_received <= body_target);
>
>                 //amqp_dump(frame.payload.body_fragment.bytes,
>                 //              frame.payload.body_fragment.len);
>                 response += std::string((char *)
> frame.payload.body_fragment.bytes,
> body_received );
>         }
>
>
>
>         return response;
> }
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Why-does-the-queue-drop-other-messages-after-the-first-is-consumed-tp32118p32122.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/443242f3/attachment.html>

From raj.kumar.sanpui at gmail.com  Mon Dec 16 16:44:58 2013
From: raj.kumar.sanpui at gmail.com (kingsmasher1)
Date: Mon, 16 Dec 2013 08:44:58 -0800 (PST)
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
Message-ID: <1387212298975-32125.post@n5.nabble.com>

Do you see any issues in my consume( ) code, which makes it drop other
messages?





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-does-the-queue-drop-other-messages-after-the-first-is-consumed-tp32118p32125.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Dec 16 16:49:16 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 16 Dec 2013 20:49:16 +0400
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
	the first is consumed?
In-Reply-To: <1387212298975-32125.post@n5.nabble.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
Message-ID: <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>

On 16 Dec 2013, at 20:44, kingsmasher1 <raj.kumar.sanpui at gmail.com> wrote:

> Do you see any issues in my consume( ) code, which makes it drop other
> messages?

I?m pretty sure the messages are not dropped, they are being delivered and either not
dispatched or not dispatched correctly in the client.

You can try using basic.qos = 1 with manual acknowledgements and/or protocol tracer tool.

MK

Software Engineer, Pivotal/RabbitMQ



From raj.kumar.sanpui at gmail.com  Mon Dec 16 16:54:42 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Mon, 16 Dec 2013 22:24:42 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
Message-ID: <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>

Yes, the messages are dispatched, but something happens in consume method,
which makes it drop. I am trying a line-by-line debug.
In between, where and how to use the basic.qos?

Thanks.


On Mon, Dec 16, 2013 at 10:19 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 16 Dec 2013, at 20:44, kingsmasher1 <raj.kumar.sanpui at gmail.com> wrote:
>
> > Do you see any issues in my consume( ) code, which makes it drop other
> > messages?
>
> I?m pretty sure the messages are not dropped, they are being delivered and
> either not
> dispatched or not dispatched correctly in the client.
>
> You can try using basic.qos = 1 with manual acknowledgements and/or
> protocol tracer tool.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/56b6fb44/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 16 17:15:08 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 21:15:08 +0400
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
Message-ID: <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>

2013/12/16 Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>

> Yes, the messages are dispatched, but something happens in consume method,
> which makes it drop. I am trying a line-by-line debug.


Have you tried looking at RabbitMQ log first? Perhaps something in the
delivery handler
causes a channel-level error.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/5bcddea9/attachment.html>

From raj.kumar.sanpui at gmail.com  Mon Dec 16 17:28:29 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Mon, 16 Dec 2013 22:58:29 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
Message-ID: <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>

Yeah, i will look at that right now, perhaps i was looking at my debug, and
i found:
After i call:
amqp_basic_consume(conn, 1, queuename, amqp_empty_bytes, 0, 1, 0,
amqp_empty_table);

Right after this call, the messages are truncated to 0.

I had put debug of queue count, before and after this.
Any hints?




On Mon, Dec 16, 2013 at 10:45 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> 2013/12/16 Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
>
>> Yes, the messages are dispatched, but something happens in consume
>> method, which makes it drop. I am trying a line-by-line debug.
>
>
> Have you tried looking at RabbitMQ log first? Perhaps something in the
> delivery handler
> causes a channel-level error.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/dd46820b/attachment.html>

From raj.kumar.sanpui at gmail.com  Mon Dec 16 17:30:01 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Mon, 16 Dec 2013 23:00:01 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
Message-ID: <CADbNrROJJ3AesVvXjP0JWf4xGp2xV+dtPb7gRDNrQncwxb==Ng@mail.gmail.com>

Here is what it says:

amqp_basic_consume_ok_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/structamqp__basic__consume__ok__t.html>*
amqp_basic_consume
(amqp_connection_state_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/amqp_8h.html#a59cfdff3bfbf28aba201be5636365fa4>
  state, amqp_channel_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/amqp_8h.html#a2905d3cff4f5b3e0a300c3d424181518>
  channel,amqp_bytes_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/structamqp__bytes__t.html>
  queue, amqp_bytes_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/structamqp__bytes__t.html>
  consumer_tag,amqp_boolean_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/amqp_8h.html#a67852bce88f5784b60b8f873fd4673f2>
  no_local, amqp_boolean_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/amqp_8h.html#a67852bce88f5784b60b8f873fd4673f2>
  no_ack,amqp_boolean_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/amqp_8h.html#a67852bce88f5784b60b8f873fd4673f2>
  exclusive, amqp_table_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/structamqp__table__t.html>
  arguments )

amqp_basic_consume
Parameters [in]stateconnection state [in]channelthe channel to do the RPC on[in]
queuequeue [in]consumer_tagconsumer_tag [in]no_localno_local [in]no_ack
no_ack [in]exclusiveexclusive [in]argumentsarguments Returns
amqp_basic_consume_ok_t<http://alanxz.github.io/rabbitmq-c/docs/0.2/structamqp__basic__consume__ok__t.html>


On Mon, Dec 16, 2013 at 10:58 PM, Raj Kumar Sanpui <
raj.kumar.sanpui at gmail.com> wrote:

> Yeah, i will look at that right now, perhaps i was looking at my debug,
> and i found:
> After i call:
> amqp_basic_consume(conn, 1, queuename, amqp_empty_bytes, 0, 1, 0,
> amqp_empty_table);
>
> Right after this call, the messages are truncated to 0.
>
> I had put debug of queue count, before and after this.
> Any hints?
>
>
>
>
> On Mon, Dec 16, 2013 at 10:45 PM, Michael Klishin <
> michael.s.klishin at gmail.com> wrote:
>
>>
>> 2013/12/16 Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
>>
>>> Yes, the messages are dispatched, but something happens in consume
>>> method, which makes it drop. I am trying a line-by-line debug.
>>
>>
>> Have you tried looking at RabbitMQ log first? Perhaps something in the
>> delivery handler
>> causes a channel-level error.
>> --
>> MK
>>
>> http://github.com/michaelklishin
>> http://twitter.com/michaelklishin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/d1ac754d/attachment.html>

From mpietrek at skytap.com  Mon Dec 16 17:37:59 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 16 Dec 2013 09:37:59 -0800
Subject: [rabbitmq-discuss] Best practices for cluster upgrades with
	uninterrupted service
In-Reply-To: <CACLE7iwJr0PFCWuzOtnR9YQ1NoHjsqUMQjGfrYPeWgM_G5_h5Q@mail.gmail.com>
References: <CACLE7iwJr0PFCWuzOtnR9YQ1NoHjsqUMQjGfrYPeWgM_G5_h5Q@mail.gmail.com>
Message-ID: <CACLE7iy4djybXhAyhkV-ttutv1wAnDJqycFUf20J_KdPBNDdYA@mail.gmail.com>

Hey all (and in particular the RabbitMQ devs).

Just wanted to call attention to my original question. I didn't get any
responses, and given the excellent level of help I've gotten in the past, I
figure my question was just overlooked in the general deluge of messages.

Thanks much,

Matt



On Mon, Dec 9, 2013 at 2:42 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Hey all RabbitMQ devs and experts,
>
> I?m looking for a validation of an approach, or a better suggestion on how
> to accomplish.
>
> The big picture is that we want to improve how we upgrade our clusters
> without interruptions in service. I know RabbitMQ supports running mixed
> versions within a cluster, but for us, upgrade may also mean bringing down
> a node for reconfiguration, an Erlang upgrade, or any other number of
> scenarios.
>
> Today we do controlled switchover of load from one RabbitMQ cluster to
> another, and then switch it back. We use two clusters (a master and an
> alternate). Both clusters are identically configured with two RabbitMQ
> instances, i.e ?master? is node1,node2, and ?alternate? is node3,node4.
>
> All queues are mirrored. We direct traffic to the master or alternate via
> a VIP.
>
> Today our upgrade process looks like this:
>
> --------
>
> * master is operation normally, and pointed to by the VIP.
>
> * Shut down both alternate nodes, upgrade them in whatever manner is
> necessary. Newer version, more ram, whatever.
>
> * Start up alternate cluster, then create the same set of queues on it as
> the master has.
>
> * Redirect the VIP to point to the alternate.
>
> * Clients see a connection drop because of the VIP change, but are
> tolerant and auto-reconnect.
>
> * Copy all queue contents from the master?s queues to the alternate?s
> same-named queues.
>
> * Shut down the master nodes and upgrade them.
>
> * Perform similar steps as above to move the VIP and messages back to the
> master.
>
> --------
>
> While this generally works, there are small but important problems with
> it. One problem is that some of our queues are created/deleted. I have seen
> scenarios where unfortunate timing can cause a queue to not be on the right
> cluster at the right moment.
>
> Looking at newer RabbitMQ features, in particular policy based mirroring
> control, I?m thinking something like this would be better:
>
> -------
>
> * Have node1/node2 running along normally, with the VIP pointing at it.
>
> * Start up node3/node4 in the same cluster
>
> * Use policy to make all queues mirrored by all four nodes. Use
> synch_queue as necessary to force synchronization in a reasonable time
> frame.
>
> * When all queues are synched, remove node1/node2 from the cluster and
> upgrade them.
>
> * Because our VIP is managed by keepalived, either node3 or node4 will
> obtain the VIP when node1/node2 are removed.
>
> --------
>
> The advantage of this is that it eliminates queue location timing windows
> and we don?t have to manually copy messages around. The only downside I?m
> aware of is that it won?t work when upgrading major/minor versions. That
> is, it should be fine from 3.4.3 to 3.4.7, but not 3.4 to 3.5. In that
> case, we'd use our original upgrade logic.
>
> Thoughts? Suggestions? Better ideas?
>
> Thanks,
>
>
> Matt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/9ba0e2ff/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 16 17:37:31 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Dec 2013 21:37:31 +0400
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
Message-ID: <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>

2013/12/16 Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>

> After i call:
> amqp_basic_consume(conn, 1, queuename, amqp_empty_bytes, 0, 1, 0,
> amqp_empty_table);
>
> Right after this call, the messages are truncated to 0.
>

As soon as there is a consumer on this queue, RabbitMQ will deliver
messages to it
as fast as possible, because you use automatic acknowledgements. Use manual
acks
and basic.qos if that's not what you want.

Local debug statements are of limited use in this case. What you need is to
trace what's going
down the wire.

What's in RabbitMQ log? It's very important to understand if there are
any channel exceptions.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/4bb3ea74/attachment.html>

From raj.kumar.sanpui at gmail.com  Mon Dec 16 17:42:16 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Mon, 16 Dec 2013 23:12:16 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
Message-ID: <CADbNrRPwuZaS87Xei3SwVpD-oe2qXWHFqWs2aS_K2tRP7ZNPDw@mail.gmail.com>

The logs doesn't seem to be of much info, the "abrupt close" is because i
pressed Ctrl + C.
Here is the log:


=INFO REPORT==== 16-Dec-2013::10:05:59 ===
accepting AMQP connection <0.32684.1> ([::1]:59097 -> [::1]:5672)

=INFO REPORT==== 16-Dec-2013::10:05:59 ===
accepting AMQP connection <0.32693.1> ([::1]:59098 -> [::1]:5672)

=INFO REPORT==== 16-Dec-2013::10:06:00 ===
accepting AMQP connection <0.32701.1> ([::1]:59099 -> [::1]:5672)

=INFO REPORT==== 16-Dec-2013::10:06:00 ===
accepting AMQP connection <0.32705.1> ([::1]:59100 -> [::1]:5672)

=INFO REPORT==== 16-Dec-2013::10:06:00 ===
accepting AMQP connection <0.32717.1> ([::1]:59101 -> [::1]:5672)

=INFO REPORT==== 16-Dec-2013::10:06:00 ===
accepting AMQP connection <0.32721.1> ([::1]:59102 -> [::1]:5672)

=WARNING REPORT==== 16-Dec-2013::10:06:01 ===
closing AMQP connection <0.32684.1> ([::1]:59097 -> [::1]:5672):
connection_closed_abruptly

=WARNING REPORT==== 16-Dec-2013::10:06:01 ===
closing AMQP connection <0.32701.1> ([::1]:59099 -> [::1]:5672):
connection_closed_abruptly

=WARNING REPORT==== 16-Dec-2013::10:06:01 ===
closing AMQP connection <0.32693.1> ([::1]:59098 -> [::1]:5672):
connection_closed_abruptly

=WARNING REPORT==== 16-Dec-2013::10:06:01 ===
closing AMQP connection <0.32705.1> ([::1]:59100 -> [::1]:5672):
connection_closed_abruptly

=WARNING REPORT==== 16-Dec-2013::10:06:01 ===
closing AMQP connection <0.32717.1> ([::1]:59101 -> [::1]:5672):
connection_closed_abruptly

=WARNING REPORT==== 16-Dec-2013::10:06:01 ===
closing AMQP connection <0.32721.1> ([::1]:59102 -> [::1]:5672):
connection_closed_abruptly



On Mon, Dec 16, 2013 at 11:07 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> 2013/12/16 Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
>
>> After i call:
>> amqp_basic_consume(conn, 1, queuename, amqp_empty_bytes, 0, 1, 0,
>> amqp_empty_table);
>>
>> Right after this call, the messages are truncated to 0.
>>
>
> As soon as there is a consumer on this queue, RabbitMQ will deliver
> messages to it
> as fast as possible, because you use automatic acknowledgements. Use
> manual acks
> and basic.qos if that's not what you want.
>
> Local debug statements are of limited use in this case. What you need is
> to trace what's going
> down the wire.
>
> What's in RabbitMQ log? It's very important to understand if there are
> any channel exceptions.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/2bc6ffc5/attachment.html>

From mklishin at gopivotal.com  Mon Dec 16 17:45:19 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 16 Dec 2013 21:45:19 +0400
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
	the first is consumed?
In-Reply-To: <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
Message-ID: <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>

On 16 Dec 2013, at 21:37, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> Local debug statements are of limited use in this case. What you need is to trace what's going
> down the wire.

Here?s how to use Tracer: download the release from [1], unarchive it, cd into rabbitmq-java-client-bin-3.2.2
and run ./runjava.sh com.rabbitmq.tools.Tracer.

Then connect to port 5673 instead of 5672 (given that RabbitMQ is running locally) from your client
and you will see protocol commands being sent both ways in the tracer shell.

1. http://www.rabbitmq.com/download.html

MK

Software Engineer, Pivotal/RabbitMQ



From raj.kumar.sanpui at gmail.com  Mon Dec 16 17:47:36 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Mon, 16 Dec 2013 23:17:36 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
Message-ID: <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>

Thanks.
In between, do we have any man page for basic.consume?

What does "no ack", "exclusive", "local" stands for?




On Mon, Dec 16, 2013 at 11:15 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 16 Dec 2013, at 21:37, Michael Klishin <michael.s.klishin at gmail.com>
> wrote:
>
> > Local debug statements are of limited use in this case. What you need is
> to trace what's going
> > down the wire.
>
> Here?s how to use Tracer: download the release from [1], unarchive it, cd
> into rabbitmq-java-client-bin-3.2.2
> and run ./runjava.sh com.rabbitmq.tools.Tracer.
>
> Then connect to port 5673 instead of 5672 (given that RabbitMQ is running
> locally) from your client
> and you will see protocol commands being sent both ways in the tracer
> shell.
>
> 1. http://www.rabbitmq.com/download.html
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/6129a8ab/attachment.html>

From mklishin at gopivotal.com  Mon Dec 16 17:52:45 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 16 Dec 2013 21:52:45 +0400
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
	the first is consumed?
In-Reply-To: <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
Message-ID: <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>

On 16 Dec 2013, at 21:47, Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com> wrote:

> In between, do we have any man page for basic.consume?
> 
> What does "no ack", "exclusive", "local" stands for?

Ignore local. Exclusive means that there can only ever be one consumer on the queue.

no ack means ?no manual ack?, that is, you don?t intend to use manual acknowledgements of
deliveries. See tutorial 2: http://www.rabbitmq.com/getstarted.html
and http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack

MK

Software Engineer, Pivotal/RabbitMQ



From raj.kumar.sanpui at gmail.com  Mon Dec 16 18:48:54 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Tue, 17 Dec 2013 00:18:54 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
 <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
Message-ID: <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>

Seems like rabbitmq has an allergy towards thread locks.
Invoke a consumer thread (basic.consume) calling pthread_mutex_lock( ) and
all but one message gets dropped. Same works absolutely fine, if no thread
locks are used.


On Mon, Dec 16, 2013 at 11:22 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 16 Dec 2013, at 21:47, Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
> wrote:
>
> > In between, do we have any man page for basic.consume?
> >
> > What does "no ack", "exclusive", "local" stands for?
>
> Ignore local. Exclusive means that there can only ever be one consumer on
> the queue.
>
> no ack means ?no manual ack?, that is, you don?t intend to use manual
> acknowledgements of
> deliveries. See tutorial 2: http://www.rabbitmq.com/getstarted.html
> and http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/490b6ded/attachment.html>

From videlalvaro at gmail.com  Mon Dec 16 18:56:42 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 16 Dec 2013 18:56:42 +0000
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
 <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
 <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>
Message-ID: <CAMcAHLXafTUcY7pkSNnE0p7X8H0La+Hx_D17egaSP4pqs1qZEg@mail.gmail.com>

Well, perhaps either your code or the AMQP library has that problem.
RabbitMQ doesn't know anything about application specific code.

On Mon, Dec 16, 2013 at 6:48 PM, Raj Kumar Sanpui
<raj.kumar.sanpui at gmail.com> wrote:
> Seems like rabbitmq has an allergy towards thread locks.
> Invoke a consumer thread (basic.consume) calling pthread_mutex_lock( ) and
> all but one message gets dropped. Same works absolutely fine, if no thread
> locks are used.
>
>
> On Mon, Dec 16, 2013 at 11:22 PM, Michael Klishin <mklishin at gopivotal.com>
> wrote:
>>
>> On 16 Dec 2013, at 21:47, Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
>> wrote:
>>
>> > In between, do we have any man page for basic.consume?
>> >
>> > What does "no ack", "exclusive", "local" stands for?
>>
>> Ignore local. Exclusive means that there can only ever be one consumer on
>> the queue.
>>
>> no ack means ?no manual ack?, that is, you don?t intend to use manual
>> acknowledgements of
>> deliveries. See tutorial 2: http://www.rabbitmq.com/getstarted.html
>> and http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack
>>
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From raj.kumar.sanpui at gmail.com  Mon Dec 16 18:59:58 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Tue, 17 Dec 2013 00:29:58 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CAMcAHLXafTUcY7pkSNnE0p7X8H0La+Hx_D17egaSP4pqs1qZEg@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
 <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
 <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>
 <CAMcAHLXafTUcY7pkSNnE0p7X8H0La+Hx_D17egaSP4pqs1qZEg@mail.gmail.com>
Message-ID: <CADbNrRNMq87aP=Kj2-FNw=6xXGe0Mitqorxb78+tYJXqQD5Afw@mail.gmail.com>

@Alvaro: The same code works perfect, if there are no pthread_mutex_lock.

Can Allan know anything about it.
@Alan Antonuk: Alan, do you have any issue in your library with regard to
thread locks (pthread_mutex_lock) ?




On Tue, Dec 17, 2013 at 12:26 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Well, perhaps either your code or the AMQP library has that problem.
> RabbitMQ doesn't know anything about application specific code.
>
> On Mon, Dec 16, 2013 at 6:48 PM, Raj Kumar Sanpui
> <raj.kumar.sanpui at gmail.com> wrote:
> > Seems like rabbitmq has an allergy towards thread locks.
> > Invoke a consumer thread (basic.consume) calling pthread_mutex_lock( )
> and
> > all but one message gets dropped. Same works absolutely fine, if no
> thread
> > locks are used.
> >
> >
> > On Mon, Dec 16, 2013 at 11:22 PM, Michael Klishin <
> mklishin at gopivotal.com>
> > wrote:
> >>
> >> On 16 Dec 2013, at 21:47, Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
> >> wrote:
> >>
> >> > In between, do we have any man page for basic.consume?
> >> >
> >> > What does "no ack", "exclusive", "local" stands for?
> >>
> >> Ignore local. Exclusive means that there can only ever be one consumer
> on
> >> the queue.
> >>
> >> no ack means ?no manual ack?, that is, you don?t intend to use manual
> >> acknowledgements of
> >> deliveries. See tutorial 2: http://www.rabbitmq.com/getstarted.html
> >> and http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack
> >>
> >> MK
> >>
> >> Software Engineer, Pivotal/RabbitMQ
> >>
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/f1862cb1/attachment.html>

From videlalvaro at gmail.com  Mon Dec 16 19:10:02 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 16 Dec 2013 19:10:02 +0000
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CADbNrRNMq87aP=Kj2-FNw=6xXGe0Mitqorxb78+tYJXqQD5Afw@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
 <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
 <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>
 <CAMcAHLXafTUcY7pkSNnE0p7X8H0La+Hx_D17egaSP4pqs1qZEg@mail.gmail.com>
 <CADbNrRNMq87aP=Kj2-FNw=6xXGe0Mitqorxb78+tYJXqQD5Afw@mail.gmail.com>
Message-ID: <CAMcAHLWY=96H2zv3sVjpEcr0N=Vz6RTZd4FJD2a-oG+8R94bzg@mail.gmail.com>

Hi,

Well it might be the code is corrupting the channel state, RabbitMQ
will just act based on the order you send AMQP commands to it. If your
code sends those commands in the wrong order, then errors might
happen, for example ack'ing the wrong message or things like that.

RabbitMQ is a server, which means, it is not concerned on which
threading library your application is using, or even if it is using
threads at all. Your application will send "requests" to RabbitMQ and
RabbitMQ will service them. In this case the requests are AMQP
commands.

Regards,

Alvaro

On Mon, Dec 16, 2013 at 6:59 PM, Raj Kumar Sanpui
<raj.kumar.sanpui at gmail.com> wrote:
> @Alvaro: The same code works perfect, if there are no pthread_mutex_lock.
>
> Can Allan know anything about it.
> @Alan Antonuk: Alan, do you have any issue in your library with regard to
> thread locks (pthread_mutex_lock) ?
>
>
>
>
> On Tue, Dec 17, 2013 at 12:26 AM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
>>
>> Well, perhaps either your code or the AMQP library has that problem.
>> RabbitMQ doesn't know anything about application specific code.
>>
>> On Mon, Dec 16, 2013 at 6:48 PM, Raj Kumar Sanpui
>> <raj.kumar.sanpui at gmail.com> wrote:
>> > Seems like rabbitmq has an allergy towards thread locks.
>> > Invoke a consumer thread (basic.consume) calling pthread_mutex_lock( )
>> > and
>> > all but one message gets dropped. Same works absolutely fine, if no
>> > thread
>> > locks are used.
>> >
>> >
>> > On Mon, Dec 16, 2013 at 11:22 PM, Michael Klishin
>> > <mklishin at gopivotal.com>
>> > wrote:
>> >>
>> >> On 16 Dec 2013, at 21:47, Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
>> >> wrote:
>> >>
>> >> > In between, do we have any man page for basic.consume?
>> >> >
>> >> > What does "no ack", "exclusive", "local" stands for?
>> >>
>> >> Ignore local. Exclusive means that there can only ever be one consumer
>> >> on
>> >> the queue.
>> >>
>> >> no ack means ?no manual ack?, that is, you don?t intend to use manual
>> >> acknowledgements of
>> >> deliveries. See tutorial 2: http://www.rabbitmq.com/getstarted.html
>> >> and http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack
>> >>
>> >> MK
>> >>
>> >> Software Engineer, Pivotal/RabbitMQ
>> >>
>> >>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From raj.kumar.sanpui at gmail.com  Mon Dec 16 19:29:32 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Tue, 17 Dec 2013 00:59:32 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CAMcAHLWY=96H2zv3sVjpEcr0N=Vz6RTZd4FJD2a-oG+8R94bzg@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
 <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
 <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>
 <CAMcAHLXafTUcY7pkSNnE0p7X8H0La+Hx_D17egaSP4pqs1qZEg@mail.gmail.com>
 <CADbNrRNMq87aP=Kj2-FNw=6xXGe0Mitqorxb78+tYJXqQD5Afw@mail.gmail.com>
 <CAMcAHLWY=96H2zv3sVjpEcr0N=Vz6RTZd4FJD2a-oG+8R94bzg@mail.gmail.com>
Message-ID: <CADbNrROqOy8Hya=fhSb00+5LvN66Sd8u-m11Z9PJi8okvNF4tg@mail.gmail.com>

Agreed, but something as simple as:

{{{
pthread_mutex_lock(&mutex);
basic.consume( );
pthread_mutex_unlock(&mutex);
}}}

Should not have any issues (unless the library you are using has), and
there are no issues in above code, if you can see.




On Tue, Dec 17, 2013 at 12:40 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> Well it might be the code is corrupting the channel state, RabbitMQ
> will just act based on the order you send AMQP commands to it. If your
> code sends those commands in the wrong order, then errors might
> happen, for example ack'ing the wrong message or things like that.
>
> RabbitMQ is a server, which means, it is not concerned on which
> threading library your application is using, or even if it is using
> threads at all. Your application will send "requests" to RabbitMQ and
> RabbitMQ will service them. In this case the requests are AMQP
> commands.
>
> Regards,
>
> Alvaro
>
> On Mon, Dec 16, 2013 at 6:59 PM, Raj Kumar Sanpui
> <raj.kumar.sanpui at gmail.com> wrote:
> > @Alvaro: The same code works perfect, if there are no pthread_mutex_lock.
> >
> > Can Allan know anything about it.
> > @Alan Antonuk: Alan, do you have any issue in your library with regard to
> > thread locks (pthread_mutex_lock) ?
> >
> >
> >
> >
> > On Tue, Dec 17, 2013 at 12:26 AM, Alvaro Videla <videlalvaro at gmail.com>
> > wrote:
> >>
> >> Well, perhaps either your code or the AMQP library has that problem.
> >> RabbitMQ doesn't know anything about application specific code.
> >>
> >> On Mon, Dec 16, 2013 at 6:48 PM, Raj Kumar Sanpui
> >> <raj.kumar.sanpui at gmail.com> wrote:
> >> > Seems like rabbitmq has an allergy towards thread locks.
> >> > Invoke a consumer thread (basic.consume) calling pthread_mutex_lock( )
> >> > and
> >> > all but one message gets dropped. Same works absolutely fine, if no
> >> > thread
> >> > locks are used.
> >> >
> >> >
> >> > On Mon, Dec 16, 2013 at 11:22 PM, Michael Klishin
> >> > <mklishin at gopivotal.com>
> >> > wrote:
> >> >>
> >> >> On 16 Dec 2013, at 21:47, Raj Kumar Sanpui <
> raj.kumar.sanpui at gmail.com>
> >> >> wrote:
> >> >>
> >> >> > In between, do we have any man page for basic.consume?
> >> >> >
> >> >> > What does "no ack", "exclusive", "local" stands for?
> >> >>
> >> >> Ignore local. Exclusive means that there can only ever be one
> consumer
> >> >> on
> >> >> the queue.
> >> >>
> >> >> no ack means ?no manual ack?, that is, you don?t intend to use manual
> >> >> acknowledgements of
> >> >> deliveries. See tutorial 2: http://www.rabbitmq.com/getstarted.html
> >> >> and http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack
> >> >>
> >> >> MK
> >> >>
> >> >> Software Engineer, Pivotal/RabbitMQ
> >> >>
> >> >>
> >> >> _______________________________________________
> >> >> rabbitmq-discuss mailing list
> >> >> rabbitmq-discuss at lists.rabbitmq.com
> >> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/c5e55f9f/attachment.html>

From gavinmroy at gmail.com  Mon Dec 16 19:32:53 2013
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Mon, 16 Dec 2013 14:32:53 -0500
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CADbNrROqOy8Hya=fhSb00+5LvN66Sd8u-m11Z9PJi8okvNF4tg@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
 <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
 <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>
 <CAMcAHLXafTUcY7pkSNnE0p7X8H0La+Hx_D17egaSP4pqs1qZEg@mail.gmail.com>
 <CADbNrRNMq87aP=Kj2-FNw=6xXGe0Mitqorxb78+tYJXqQD5Afw@mail.gmail.com>
 <CAMcAHLWY=96H2zv3sVjpEcr0N=Vz6RTZd4FJD2a-oG+8R94bzg@mail.gmail.com>
 <CADbNrROqOy8Hya=fhSb00+5LvN66Sd8u-m11Z9PJi8okvNF4tg@mail.gmail.com>
Message-ID: <etPan.52af5566.507ed7ab.fb3d@gmr-home.local>

What library are you using?

basic.consume() is not quite as simple as your code would imply. While it is issuing a RPC request to start consuming, most libraries have some semantics around its use such as registering a callback or setting up behaviors for what happens when messages are received from RabbitMQ. I think there?s more to what?s going on than you realize.


From:?Raj Kumar Sanpui Raj Kumar Sanpui
Reply:?Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
Date:?December 16, 2013 at 2:31:26 PM
To:?Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
Subject:? Re: [rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?  
Agreed, but something as simple as:

{{{
pthread_mutex_lock(&mutex);
basic.consume( );
pthread_mutex_unlock(&mutex);
}}}

Should not have any issues (unless the library you are using has), and there are no issues in above code, if you can see.




On Tue, Dec 17, 2013 at 12:40 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
Hi,

Well it might be the code is corrupting the channel state, RabbitMQ
will just act based on the order you send AMQP commands to it. If your
code sends those commands in the wrong order, then errors might
happen, for example ack'ing the wrong message or things like that.

RabbitMQ is a server, which means, it is not concerned on which
threading library your application is using, or even if it is using
threads at all. Your application will send "requests" to RabbitMQ and
RabbitMQ will service them. In this case the requests are AMQP
commands.

Regards,

Alvaro

On Mon, Dec 16, 2013 at 6:59 PM, Raj Kumar Sanpui
<raj.kumar.sanpui at gmail.com> wrote:
> @Alvaro: The same code works perfect, if there are no pthread_mutex_lock.
>
> Can Allan know anything about it.
> @Alan Antonuk: Alan, do you have any issue in your library with regard to
> thread locks (pthread_mutex_lock) ?
>
>
>
>
> On Tue, Dec 17, 2013 at 12:26 AM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
>>
>> Well, perhaps either your code or the AMQP library has that problem.
>> RabbitMQ doesn't know anything about application specific code.
>>
>> On Mon, Dec 16, 2013 at 6:48 PM, Raj Kumar Sanpui
>> <raj.kumar.sanpui at gmail.com> wrote:
>> > Seems like rabbitmq has an allergy towards thread locks.
>> > Invoke a consumer thread (basic.consume) calling pthread_mutex_lock( )
>> > and
>> > all but one message gets dropped. Same works absolutely fine, if no
>> > thread
>> > locks are used.
>> >
>> >
>> > On Mon, Dec 16, 2013 at 11:22 PM, Michael Klishin
>> > <mklishin at gopivotal.com>
>> > wrote:
>> >>
>> >> On 16 Dec 2013, at 21:47, Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
>> >> wrote:
>> >>
>> >> > In between, do we have any man page for basic.consume?
>> >> >
>> >> > What does "no ack", "exclusive", "local" stands for?
>> >>
>> >> Ignore local. Exclusive means that there can only ever be one consumer
>> >> on
>> >> the queue.
>> >>
>> >> no ack means ?no manual ack?, that is, you don?t intend to use manual
>> >> acknowledgements of
>> >> deliveries. See tutorial 2: http://www.rabbitmq.com/getstarted.html
>> >> and http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack
>> >>
>> >> MK
>> >>
>> >> Software Engineer, Pivotal/RabbitMQ
>> >>
>> >>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________  
rabbitmq-discuss mailing list  
rabbitmq-discuss at lists.rabbitmq.com  
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/c461f64f/attachment.html>

From gavinmroy at gmail.com  Mon Dec 16 19:52:36 2013
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Mon, 16 Dec 2013 14:52:36 -0500
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <etPan.52af5566.507ed7ab.fb3d@gmr-home.local>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
 <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
 <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>
 <CAMcAHLXafTUcY7pkSNnE0p7X8H0La+Hx_D17egaSP4pqs1qZEg@mail.gmail.com>
 <CADbNrRNMq87aP=Kj2-FNw=6xXGe0Mitqorxb78+tYJXqQD5Afw@mail.gmail.com>
 <CAMcAHLWY=96H2zv3sVjpEcr0N=Vz6RTZd4FJD2a-oG+8R94bzg@mail.gmail.com>
 <CADbNrROqOy8Hya=fhSb00+5LvN66Sd8u-m11Z9PJi8okvNF4tg@mail.gmail.com>
 <etPan.52af5566.507ed7ab.fb3d@gmr-home.local>
Message-ID: <etPan.52af5a04.41b71efb.fb3d@gmr-home.local>

Looking through the source of rabbitmq-c I see mutex code around ssl initialization (amqp_openssl.c), but I don?t see how that could cause your issue.

I?m wondering why you?d want to mutex either around the RPC request or if you?re calling amqp_consume_message (https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp_consumer.c#L136). ?What does putting a lock around your ?basic_consume()? invocation achieve?

Consuming is an asynchronous operation. You register your app as a consumer with RabbitMQ, then as RabbitMQ sees fit, messages are delivered to your application. Without context, I?m interpreting what you?re doing as if you want to use Basic.Get instead.


From:?Gavin M. Roy Gavin M. Roy
Reply:?Gavin M. Roy gavinmroy at gmail.com
Date:?December 16, 2013 at 2:33:11 PM
To:?Raj Kumar Sanpui raj.kumar.sanpui at gmail.com, Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
Subject:? Re: [rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?  
What library are you using?

basic.consume() is not quite as simple as your code would imply. While it is issuing a RPC request to start consuming, most libraries have some semantics around its use such as registering a callback or setting up behaviors for what happens when messages are received from RabbitMQ. I think there?s more to what?s going on than you realize.


From:?Raj Kumar Sanpui Raj Kumar Sanpui
Reply:?Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
Date:?December 16, 2013 at 2:31:26 PM
To:?Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
Subject:? Re: [rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?
Agreed, but something as simple as:

{{{
pthread_mutex_lock(&mutex);
basic.consume( );
pthread_mutex_unlock(&mutex);
}}}

Should not have any issues (unless the library you are using has), and there are no issues in above code, if you can see.




On Tue, Dec 17, 2013 at 12:40 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
Hi,

Well it might be the code is corrupting the channel state, RabbitMQ
will just act based on the order you send AMQP commands to it. If your
code sends those commands in the wrong order, then errors might
happen, for example ack'ing the wrong message or things like that.

RabbitMQ is a server, which means, it is not concerned on which
threading library your application is using, or even if it is using
threads at all. Your application will send "requests" to RabbitMQ and
RabbitMQ will service them. In this case the requests are AMQP
commands.

Regards,

Alvaro

On Mon, Dec 16, 2013 at 6:59 PM, Raj Kumar Sanpui
<raj.kumar.sanpui at gmail.com> wrote:
> @Alvaro: The same code works perfect, if there are no pthread_mutex_lock.
>
> Can Allan know anything about it.
> @Alan Antonuk: Alan, do you have any issue in your library with regard to
> thread locks (pthread_mutex_lock) ?
>
>
>
>
> On Tue, Dec 17, 2013 at 12:26 AM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
>>
>> Well, perhaps either your code or the AMQP library has that problem.
>> RabbitMQ doesn't know anything about application specific code.
>>
>> On Mon, Dec 16, 2013 at 6:48 PM, Raj Kumar Sanpui
>> <raj.kumar.sanpui at gmail.com> wrote:
>> > Seems like rabbitmq has an allergy towards thread locks.
>> > Invoke a consumer thread (basic.consume) calling pthread_mutex_lock( )
>> > and
>> > all but one message gets dropped. Same works absolutely fine, if no
>> > thread
>> > locks are used.
>> >
>> >
>> > On Mon, Dec 16, 2013 at 11:22 PM, Michael Klishin
>> > <mklishin at gopivotal.com>
>> > wrote:
>> >>
>> >> On 16 Dec 2013, at 21:47, Raj Kumar Sanpui <raj.kumar.sanpui at gmail.com>
>> >> wrote:
>> >>
>> >> > In between, do we have any man page for basic.consume?
>> >> >
>> >> > What does "no ack", "exclusive", "local" stands for?
>> >>
>> >> Ignore local. Exclusive means that there can only ever be one consumer
>> >> on
>> >> the queue.
>> >>
>> >> no ack means ?no manual ack?, that is, you don?t intend to use manual
>> >> acknowledgements of
>> >> deliveries. See tutorial 2: http://www.rabbitmq.com/getstarted.html
>> >> and http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack
>> >>
>> >> MK
>> >>
>> >> Software Engineer, Pivotal/RabbitMQ
>> >>
>> >>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/6c41d304/attachment.html>

From kansalneha28 at yahoo.com  Mon Dec 16 20:12:30 2013
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Mon, 16 Dec 2013 12:12:30 -0800 (PST)
Subject: [rabbitmq-discuss] Where is list of users stored?
In-Reply-To: <528FAA3A.7070504@rabbitmq.com>
References: <1385142422.48796.YahooMailNeo@web141706.mail.bf1.yahoo.com>
 <528FAA3A.7070504@rabbitmq.com>
Message-ID: <1387224750.49920.YahooMailNeo@web141706.mail.bf1.yahoo.com>

Just to follow up on this - I found the reason why users werent getting copied over. The users table is stored in a directory (under mnesia) that is named based on the machine name. So when a server snapshot is taken to create a new server, rabbit creates a new directory under mnesia for that server. 




On Friday, November 22, 2013 11:02 AM, Emile Joubert <emile at rabbitmq.com> wrote:
 

Hi,

On 22/11/13 17:47, Neha Kansal wrote:

> I would like to know where is the list of users stored by RabbitMQ.


Users are stored in the Mnesia database, in the rabbit_user table.? You
can find the list of users by running "rabbitmqctl list_users". Make
sure the broker is shutdown cleanly before making copies of the database
folder.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/26db3679/attachment.html>

From clarsen at euphoriaaudio.com  Mon Dec 16 20:24:19 2013
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Mon, 16 Dec 2013 15:24:19 -0500
Subject: [rabbitmq-discuss] rabbit_limiter Exception and Broker Issues
Message-ID: <077401cefa9c$cd2c2e70$67848b50$@euphoriaaudio.com>

Hiya, we ran into some problems with a cluster over the weekend. There was a
sharp increase in message publishing traffic to this 2 node cluster that
increased memory and FD usage but we didn't observe the normal limit
messages in the logs. Instead we say this "rabbit_limiter" exception and the
nodes stopped accepting published messages. Thankfully we were able to
consume the queued, in-memory, data before restarting the nodes. Did we
simply throw too many messages at Rabbit or was there an actual bug in the
limiter code? We're running 3.1.5 with Erlang R16B01 on both nodes. Below
are some bits from the main logs on both nodes and the full SASL logs are in
pastebin. Thanks!

 

Node 1 sasl

http://pastebin.com/h55i3AqQ

Node 2 sasl

http://pastebin.com/3hw7f6xA

 

------ NODE1 Rabbit LOG ------

 

=ERROR REPORT==== 14-Dec-2013::11:39:15 ===

** Generic server <0.21763.1353> terminating

** Last message in was stat

** When Server state == {lim,0,<0.26407.1167>,false,[],0}

** Reason for termination == 

** {function_clause,[{rabbit_limiter,handle_call,

                                     [stat,

                                      {<0.234.0>,#Ref<0.0.8426.115176>},

                                      {lim,0,<0.26407.1167>,false,[],0}],

                                     []},

                     {gen_server2,handle_msg,2,[]},

                     {proc_lib,init_p_do_apply,3,

                               [{file,"proc_lib.erl"},{line,239}]}]}

 

=ERROR REPORT==== 14-Dec-2013::11:55:10 ===

** Generic server <0.28277.6695> terminating

** Last message in was {'$gen_cast',

                           {method,

                               {'queue.declare',0,

                                   <<"notification.somehost">>,

                                   false,false,false,false,false,

                                   [{<<"x-expires">>,signedint,10800000}]},

                               none,noflow}}

** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,247,

                            <0.4536.6658>,<0.13044.6658>,<0.4536.6658>,

                            <<C_IP -> S_IP>>,

                            {lstate,<0.20106.6569>,false,false},

                            none,1,

                            {[],[]},

                            {user,<<"app_user">>,

                                [administrator],

                                rabbit_auth_backend_internal,

                                {internal_user,<<"app_user">>,

 
<<79,159,188,106,120,27,224,243,230,15,223,

                                      54,140,137,70,36,212,30,111,89>>,

                                    [administrator]}},

                            <<"/app_user">>,<<>>,

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {set,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {set,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            <0.8820.6668>,

                            {state,fine,5000,#Ref<0.0.6989.167017>},

                            false,1,

                            {{0,nil},{0,nil}},

                            [],

                            [{<<"consumer_cancel_notify">>,bool,true},

                             {<<"publisher_confirms">>,bool,true}],

                            none}

** Reason for termination == 

** {{{function_clause,

         [{supervisor2,handle_call,

              [stat,

               {<7347.227.0>,#Ref<7347.0.8145.90172>},

               {state,

                   {<7347.9746.1239>,rabbit_intermediate_sup},

                   one_for_one,[],

                   {dict,0,16,16,8,80,48,

                       {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

                       {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},

                   10,10,[],rabbit_intermediate_sup,[]}],

              []},

          {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},

          {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},

     {gen_server2,call,[<7347.9746.1239>,stat,infinity]}},

    [{gen_server2,call,3,[]},

     {delegate,safe_invoke,2,[]},

     {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},

     {delegate,handle_call,3,[]},

     {gen_server2,handle_msg,2,[]},

     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

 

=ERROR REPORT==== 14-Dec-2013::11:55:10 ===

AMQP connection <0.4536.6658> (running), channel 247 - error:

{{{function_clause,

      [{supervisor2,handle_call,

           [stat,

            {<7347.227.0>,#Ref<7347.0.8145.90172>},

            {state,

                {<7347.9746.1239>,rabbit_intermediate_sup},

                one_for_one,[],

                {dict,0,16,16,8,80,48,

                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},

                10,10,[],rabbit_intermediate_sup,[]}],

           []},

       {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},

       {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},

  {gen_server2,call,[<7347.9746.1239>,stat,infinity]}},

[{gen_server2,call,3,[]},

  {delegate,safe_invoke,2,[]},

  {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},

  {delegate,handle_call,3,[]},

  {gen_server2,handle_msg,2,[]},

  {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

 

=WARNING REPORT==== 14-Dec-2013::11:55:10 ===

Non-AMQP exit reason '{{{function_clause,

                         [{supervisor2,handle_call,

                           [stat,

                            {<7347.227.0>,#Ref<7347.0.8145.90172>},

                            {state,

                             {<7347.9746.1239>,rabbit_intermediate_sup},

                             one_for_one,[],

                             {dict,0,16,16,8,80,48,

                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                               []},

 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                []}}},

                             10,10,[],rabbit_intermediate_sup,[]}],

                           []},

                          {gen_server,handle_msg,5,

                           [{file,"gen_server.erl"},{line,585}]},

                          {proc_lib,init_p_do_apply,3,

                           [{file,"proc_lib.erl"},{line,239}]}]},

 
{gen_server2,call,[<7347.9746.1239>,stat,infinity]}},

                       [{gen_server2,call,3,[]},

                        {delegate,safe_invoke,2,[]},

                        {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},

                        {delegate,handle_call,3,[]},

                        {gen_server2,handle_msg,2,[]},

                        {proc_lib,wake_up,3,

                         [{file,"proc_lib.erl"},{line,249}]}]}'

 

=ERROR REPORT==== 14-Dec-2013::12:27:35 ===

** Generic server <0.17415.2019> terminating

** Last message in was {'$gen_cast',

                           {method,

                               {'queue.declare',0,

                                   <<"notification.somehost">>,

                                   false,false,false,false,false,

                                   [{<<"x-expires">>,signedint,10800000}]},

                               none,noflow}}

** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,240,

                            <0.23804.2237>,<0.9694.2017>,<0.23804.2237>,

                            <<C_IP -> S_IP>>,

                            {lstate,<0.8750.2014>,false,false},

                            none,1,

                            {[],[]},

                            {user,<<"app_user">>,

                                [administrator],

                                rabbit_auth_backend_internal,

                                {internal_user,<<"app_user">>,

 
<<199,64,175,52,127,65,248,9,70,171,15,9,5,

                                      122,73,4,195,147,238,67>>,

                                    [administrator]}},

                            <<"/app_user">>,<<>>,

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {set,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            {set,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            <0.6852.2217>,

                            {state,fine,5000,#Ref<0.0.8928.158612>},

                            false,1,

                            {{0,nil},{0,nil}},

                            [],

                            [{<<"consumer_cancel_notify">>,bool,true},

                             {<<"publisher_confirms">>,bool,true}],

                            none}

** Reason for termination == 

** {{{function_clause,

         [{supervisor2,handle_call,

              [stat,

               {<7347.226.0>,#Ref<7347.0.8518.17139>},

               {state,

                   {<7347.8508.1220>,rabbit_connection_sup},

                   one_for_all,

                   [{child,<7347.27376.2037>,reader,

                        {rabbit_reader,start_link,

                            [<7347.29450.2047>,<7347.19330.2055>,

                             #Fun<rabbit_heartbeat.2.69784259>]},

                        intrinsic,4294967295,worker,

                        [rabbit_reader]},

                    {child,<7347.29450.2047>,channel_sup3,

                        {rabbit_intermediate_sup,start_link,[]},

                        intrinsic,infinity,supervisor,

                        [rabbit_intermediate_sup]},

                    {child,<7347.19330.2055>,collector,

                        {rabbit_queue_collector,start_link,[]},

                        intrinsic,4294967295,worker,

                        [rabbit_queue_collector]}],

                   {dict,0,16,16,8,80,48,

                       {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

                       {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},

                   0,1,[],rabbit_connection_sup,[]}],

              []},

          {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},

          {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},

     {gen_server2,call,[<7347.8508.1220>,stat,infinity]}},

    [{gen_server2,call,3,[]},

     {delegate,safe_invoke,2,[]},

     {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},

     {delegate,handle_call,3,[]},

     {gen_server2,handle_msg,2,[]},

     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

 

=ERROR REPORT==== 14-Dec-2013::12:27:35 ===

AMQP connection <0.23804.2237> (running), channel 240 - error:

{{{function_clause,

      [{supervisor2,handle_call,

           [stat,

            {<7347.226.0>,#Ref<7347.0.8518.17139>},

            {state,

                {<7347.8508.1220>,rabbit_connection_sup},

                one_for_all,

                [{child,<7347.27376.2037>,reader,

                     {rabbit_reader,start_link,

                         [<7347.29450.2047>,<7347.19330.2055>,

                          #Fun<rabbit_heartbeat.2.69784259>]},

                     intrinsic,4294967295,worker,

                     [rabbit_reader]},

                 {child,<7347.29450.2047>,channel_sup3,

                     {rabbit_intermediate_sup,start_link,[]},

                     intrinsic,infinity,supervisor,

                     [rabbit_intermediate_sup]},

                 {child,<7347.19330.2055>,collector,

                     {rabbit_queue_collector,start_link,[]},

                     intrinsic,4294967295,worker,

                     [rabbit_queue_collector]}],

                {dict,0,16,16,8,80,48,

                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},

                0,1,[],rabbit_connection_sup,[]}],

           []},

       {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},

       {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},

  {gen_server2,call,[<7347.8508.1220>,stat,infinity]}},

[{gen_server2,call,3,[]},

  {delegate,safe_invoke,2,[]},

  {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},

  {delegate,handle_call,3,[]},

  {gen_server2,handle_msg,2,[]},

  {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

 

=WARNING REPORT==== 14-Dec-2013::12:27:35 ===

Non-AMQP exit reason '{{{function_clause,

                         [{supervisor2,handle_call,

                           [stat,

                            {<7347.226.0>,#Ref<7347.0.8518.17139>},

                            {state,

                             {<7347.8508.1220>,rabbit_connection_sup},

                             one_for_all,

                             [{child,<7347.27376.2037>,reader,

                               {rabbit_reader,start_link,

                                [<7347.29450.2047>,<7347.19330.2055>,

                                 #Fun<rabbit_heartbeat.2.69784259>]},

                               intrinsic,4294967295,worker,

                               [rabbit_reader]},

                              {child,<7347.29450.2047>,channel_sup3,

                               {rabbit_intermediate_sup,start_link,[]},

                               intrinsic,infinity,supervisor,

                               [rabbit_intermediate_sup]},

                              {child,<7347.19330.2055>,collector,

                               {rabbit_queue_collector,start_link,[]},

                               intrinsic,4294967295,worker,

                               [rabbit_queue_collector]}],

                             {dict,0,16,16,8,80,48,

                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                               []},

 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                []}}},

                             0,1,[],rabbit_connection_sup,[]}],

                           []},

                          {gen_server,handle_msg,5,

                           [{file,"gen_server.erl"},{line,585}]},

                          {proc_lib,init_p_do_apply,3,

                           [{file,"proc_lib.erl"},{line,239}]}]},

 
{gen_server2,call,[<7347.8508.1220>,stat,infinity]}},

                       [{gen_server2,call,3,[]},

                        {delegate,safe_invoke,2,[]},

                        {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},

                        {delegate,handle_call,3,[]},

                        {gen_server2,handle_msg,2,[]},

                        {proc_lib,wake_up,3,

                         [{file,"proc_lib.erl"},{line,249}]}]}'

                         

 

------ NODE2 Rabbit LOG ------

 

=ERROR REPORT==== 14-Dec-2013::11:55:10 ===

** Generic server <0.9746.1239> terminating 

** Last message in was stat

** When Server state == {state,{<0.9746.1239>,rabbit_intermediate_sup},

                               one_for_one,[],

                               {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],

                                      [],[],[]},

 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],

                                       [],[],[]}}},

                               10,10,[],rabbit_intermediate_sup,[]}

** Reason for termination == 

** {function_clause,

       [{supervisor2,handle_call,

            [stat,

             {<0.227.0>,#Ref<0.0.8145.90172>},

             {state,

                 {<0.9746.1239>,rabbit_intermediate_sup},

                 one_for_one,[],

                 {dict,0,16,16,8,80,48,

                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},

                 10,10,[],rabbit_intermediate_sup,[]}],

            []},

        {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},

        {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/1babfc3a/attachment.html>

From goyalk at vmware.com  Mon Dec 16 23:37:11 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Mon, 16 Dec 2013 15:37:11 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.1.5 crashed
In-Reply-To: <101707013.7734500.1387236783178.JavaMail.root@vmware.com>
Message-ID: <721958228.7735376.1387237031361.JavaMail.root@vmware.com>

Hi, 

A rabbitmq server in one of our setups crashed recently. Can you please take a look at the attached rabbit and rabbit-sasl logs and help me understand the issue? 

The logs attached start from around a minute before and until the crash. 

I also have a 17M crash dump file. If you'd like to look at it, can I send it as an email attachment or you'd prefer another way? 


Thanks 
Kapil 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/e99e7e9b/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at localhost.log
Type: text/x-log
Size: 6874 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/e99e7e9b/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at localhost-sasl.log
Type: text/x-log
Size: 93181 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131216/e99e7e9b/attachment-0001.bin>

From k.madnani84 at gmail.com  Tue Dec 17 05:55:25 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Mon, 16 Dec 2013 21:55:25 -0800 (PST)
Subject: [rabbitmq-discuss] Error in the Java testing client for ssl.
Message-ID: <1387259725249-32151.post@n5.nabble.com>

Hi,

In the rabbitMQ website in the ssl Support section :
http://www.rabbitmq.com/ssl.html

we have 2 Java Clients example(Example1 & Example2) connecting to a ssl
enabled RabbitMQ host.

Its regarding the example2:

I guess this line is missing :
char[] passphrase = "MySecretPassword".toCharArray(); 

before

 KeyManagerFactory kmf = KeyManagerFactory.getInstance("SunX509");
        kmf.init(ks, passphrase);







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-in-the-Java-testing-client-for-ssl-tp32151.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From whitefes at gmail.com  Tue Dec 17 10:14:56 2013
From: whitefes at gmail.com (Cheolseung Baek)
Date: Tue, 17 Dec 2013 02:14:56 -0800 (PST)
Subject: [rabbitmq-discuss] how to install rabbitmq & erlnag.
Message-ID: <3dca9064-88d1-4773-a9e9-e01c12339779@googlegroups.com>

Hello, I have some question install to AIX OS.

I read installing rabbitmq & erlang quide. but I don't know how to

install rabbitmq & erlnag.

I want your help, how to install rabbitmq & erlnag.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/c176425b/attachment.html>

From michael.s.klishin at gmail.com  Tue Dec 17 10:25:34 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 17 Dec 2013 14:25:34 +0400
Subject: [rabbitmq-discuss] how to install rabbitmq & erlnag.
In-Reply-To: <3dca9064-88d1-4773-a9e9-e01c12339779@googlegroups.com>
References: <3dca9064-88d1-4773-a9e9-e01c12339779@googlegroups.com>
Message-ID: <CAE3HoVRZe32nV-QznPEJTxPwpb7J=_orUBzSCoV2NSRs1ZHRUQ@mail.gmail.com>

2013/12/17 Cheolseung Baek <whitefes at gmail.com>

> I read installing rabbitmq & erlang quide. but I don't know how to
>
> install rabbitmq & erlnag.
>
> I want your help, how to install rabbitmq & erlnag.
>

I'm afraid Erlang still needs to be compiled from source for AIX:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011425.html

RabbitMQ generic UNIX package should work just fine then:
http://www.rabbitmq.com/install-generic-unix.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/eb4b763a/attachment.html>

From raj.kumar.sanpui at gmail.com  Tue Dec 17 10:29:28 2013
From: raj.kumar.sanpui at gmail.com (Raj Kumar Sanpui)
Date: Tue, 17 Dec 2013 15:59:28 +0530
Subject: [rabbitmq-discuss] Why does the queue drop other messages after
 the first is consumed?
In-Reply-To: <CADbNrRMd-wJpFMQbZZ1wMQFF=J1Ri7Kjsy3JK9ow5TkZB3OdiA@mail.gmail.com>
References: <1387208184746-32118.post@n5.nabble.com>
 <CAE3HoVRT5xpF-21GsumF0xygj+g0H4qRGkqhBddZxLqoUMgWeg@mail.gmail.com>
 <1387210382989-32122.post@n5.nabble.com>
 <CADbNrRNxdHNYWj9N1kd=UqWfn5uJwv7hL0n6e0G+j+WtoLiegg@mail.gmail.com>
 <1387212298975-32125.post@n5.nabble.com>
 <60CF325B-46DF-400B-8166-5A56B5F82EC4@rabbitmq.com>
 <CADbNrROBfLs8coPv0+dWcZdRs6ByB5j12enkL8TfVEF8JqKvHw@mail.gmail.com>
 <CAE3HoVRv9DHXkN2CgvhwdfRSXVkG+8XAspKNL=Sjz9Dnram6gA@mail.gmail.com>
 <CADbNrRMW4BJ1=5N0tZ3vW9DbGYwvhOCtCuj_FQ7kZ-4H21d6Gw@mail.gmail.com>
 <CAE3HoVSbjUjKo1q1c_9OF9a3fjoGKZG5-PUZ5szgdcOEy6MJ2A@mail.gmail.com>
 <C60E3A1A-004E-4052-B74D-6484D591341B@rabbitmq.com>
 <CADbNrRNh7DQJN5J8eBnO5GoEEDm9cjsCy_mNRfcYEKfnfMANTA@mail.gmail.com>
 <663DADC6-6E98-4A92-8CD8-A8B156534A17@rabbitmq.com>
 <CADbNrRNZYfoRA4tw-QrTppq3E4+g2bEYFWj7RrcDUD=F7HP8zQ@mail.gmail.com>
 <CAMcAHLXafTUcY7pkSNnE0p7X8H0La+Hx_D17egaSP4pqs1qZEg@mail.gmail.com>
 <CADbNrRNMq87aP=Kj2-FNw=6xXGe0Mitqorxb78+tYJXqQD5Afw@mail.gmail.com>
 <CAMcAHLWY=96H2zv3sVjpEcr0N=Vz6RTZd4FJD2a-oG+8R94bzg@mail.gmail.com>
 <CADbNrROqOy8Hya=fhSb00+5LvN66Sd8u-m11Z9PJi8okvNF4tg@mail.gmail.com>
 <etPan.52af5566.507ed7ab.fb3d@gmr-home.local>
 <etPan.52af5a04.41b71efb.fb3d@gmr-home.local>
 <CADbNrRMd-wJpFMQbZZ1wMQFF=J1Ri7Kjsy3JK9ow5TkZB3OdiA@mail.gmail.com>
Message-ID: <CADbNrRP0ZTrUDQK8U1LYDM4_8j2wzhkh9QJFvKavWugCM2W8RQ@mail.gmail.com>

On Tue, Dec 17, 2013 at 1:29 AM, Raj Kumar Sanpui <
raj.kumar.sanpui at gmail.com> wrote:

> If i have 10 messages in queue, and there are around 5 consumer threads,
> when each of them consume in turn, either using basic.consume or
> amqp.consume.message (the new non-blocking version):
> https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L2151
>
> So, as per you there should not be any thread locks, or the consume to be
> serialized, is not required per se.
> So, basic.consume or amap.consume.message, should be thread safe by itself?
>
> Thanks
>
>
>
> On Tue, Dec 17, 2013 at 1:22 AM, Gavin M. Roy <gavinmroy at gmail.com> wrote:
>
>> Looking through the source of rabbitmq-c I see mutex code around ssl
>> initialization (amqp_openssl.c), but I don?t see how that could cause your
>> issue.
>>
>> I?m wondering why you?d want to mutex either around the RPC request or if
>> you?re calling amqp_consume_message (
>> https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp_consumer.c#L136).
>>  What does putting a lock around your ?basic_consume()? invocation achieve?
>>
>> Consuming is an asynchronous operation. You register your app as a
>> consumer with RabbitMQ, then as RabbitMQ sees fit, messages are delivered
>> to your application. Without context, I?m interpreting what you?re doing as
>> if you want to use Basic.Get instead.
>>
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/f8559328/attachment.html>

From michael.justin at gmx.net  Tue Dec 17 10:36:30 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 17 Dec 2013 11:36:30 +0100
Subject: [rabbitmq-discuss] STOMP 1.2 support for ACK or NACK frames in
Message-ID: <l8p9f7$d63$1@ger.gmane.org>

Hello,

with STOMP 1.2 and an active STOMP transaction, does RabbitMQ support 
the "transaction" header for ACK and NACK commands, so that the client 
can rollback the ACK or NACK?

If yes, can the client use all acknowledgement modes of the SUBSCRIBE 
command ("ack:auto", "ack:client" and "ack:client-individual") and roll 
back ACK or NACK frames which belong to the transaction, or is it 
limited to ack:client / ack:client-individual?

Many thanks in advance
-- 
Michael Justin


From simon at rabbitmq.com  Tue Dec 17 10:42:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Dec 2013 10:42:18 +0000
Subject: [rabbitmq-discuss] BasicQos Multiple msg ack
In-Reply-To: <CAE3HoVQXsXON-s0MGrxZRs2Vr7b89uikpnHv2Qu=q1dV-PMCAQ@mail.gmail.com>
References: <1386925979353-32047.post@n5.nabble.com>
 <CAE3HoVQXsXON-s0MGrxZRs2Vr7b89uikpnHv2Qu=q1dV-PMCAQ@mail.gmail.com>
Message-ID: <52B02A8A.5020305@rabbitmq.com>

On 13/12/2013 11:11, Michael Klishin wrote:
> 2013/12/13 Ranjith Venkatesan <ranjith.v at zohocorp.com
> <mailto:ranjith.v at zohocorp.com>> But how to acknowledge for those
> bulk 100 messages?
>
>
> channel.basicAck(*???*, true);
>
> My question is how to get deliveryTag for multiple msgs ?
>
>
> See description of the multiple argument:
>
> http://www.rabbitmq.com/releases/rabbitmq-java-client/current-javadoc/

This link might be more useful:

http://www.rabbitmq.com/releases/rabbitmq-java-client/current-javadoc/com/rabbitmq/client/Channel.html#basicAck(long,
boolean)

It says:

> multiple - true to acknowledge all messages up to and including the
> supplied delivery tag; false to acknowledge just the supplied
> delivery tag.

i.e. set the delivery tag to that of the last message received.

Cheers, Simon

From bs.stack at gmail.com  Tue Dec 17 09:41:25 2013
From: bs.stack at gmail.com (Billy Stack)
Date: Tue, 17 Dec 2013 01:41:25 -0800 (PST)
Subject: [rabbitmq-discuss] Blocking connections - during load tests
Message-ID: <4a5d77e4-4796-46e4-b837-9d0a8dee8179@googlegroups.com>

All,

We are experiencing difficulty when performing load tests on one of our 
applications that uses RabbitMQ (via the .NET client).

Using JMeter with 30 concurrent threads we started to hammer our 
application.
The memory high-water mark was reached after a couple of hours.

Once this was reached the applications rabbitmq connection changed to 
status "blocked".
Also, subsequent new connections go to status "blocking"
For some reason, two other connections seem to be "running"

The question I have is we then stop the load tests, the server does not 
recover, is this as expected?
Is the problem the number of channels that we seem to have open for the 
load tests (i.e. 734)?

Any help greatly appreciated

Thanks,
Billy Stack


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/44d5b38d/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_connections.PNG
Type: image/png
Size: 38795 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/44d5b38d/attachment.png>

From simon at rabbitmq.com  Tue Dec 17 10:55:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Dec 2013 10:55:54 +0000
Subject: [rabbitmq-discuss] cluster crash when setting ha-mode=nodes
In-Reply-To: <1386919585377-32042.post@n5.nabble.com>
References: <1386919585377-32042.post@n5.nabble.com>
Message-ID: <52B02DBA.6080200@rabbitmq.com>

On 13/12/2013 07:26, carlhoerberg wrote:
> Set ha-mode=nodes on a all of vhosts, from ha-mode=all, to gracefully remove
> a node. All queues failover successfully, but then /api/overview stopped
> working, nor could we issue rabbitmqctl cluster_status. Tried to stop the
> node we were rotating out, it didn't respond. Had to "kill" it after a
> couple of minutes. Node 1 and 2 still doesn't respond, tries to issue "sudo
> rabbitmqctl eval 'application:stop(rabbitmq_management).'" on node 1,
> successfully, but on node 2 it just hangs..
>
> Kills node2, node1 rabbitmq_mgmt starts, but still can't query
> /api/overview. Kills node1 too, on start up we get a lot of "home node
> 'rabbit at lemur03' of durable queue 'celery' in vhost 'shycoqhj' is down or
> inaccessible", but lemur03 shouldn't be master for any queue anymore!
>
> RabbitMQ 3.2.1, Erlang R16B01

It's hard to guess what might be going on from this description. Do you 
have anything in the logs?

Cheers, Simon


From michael.s.klishin at gmail.com  Tue Dec 17 10:56:23 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 17 Dec 2013 14:56:23 +0400
Subject: [rabbitmq-discuss] Blocking connections - during load tests
In-Reply-To: <4a5d77e4-4796-46e4-b837-9d0a8dee8179@googlegroups.com>
References: <4a5d77e4-4796-46e4-b837-9d0a8dee8179@googlegroups.com>
Message-ID: <CAE3HoVTmwUVCwB4Hwe9b-g2++TDNWRKj=31ot5T3LZJqfThkgw@mail.gmail.com>

2013/12/17 Billy Stack <bs.stack at gmail.com>

> Once this was reached the applications rabbitmq connection changed to
> status "blocked".
> Also, subsequent new connections go to status "blocking"
>

This is expected.

For some reason, two other connections seem to be "running"
>

They are not publishing

The question I have is we then stop the load tests, the server does not
> recover, is this as expected?
>

It will if you drain messages from it. There will be visible messages in
the log.


> Is the problem the number of channels that we seem to have open for the
> load tests (i.e. 734)?
>

No, your consumers do not keep up with producers.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/28cbcaf2/attachment.html>

From videlalvaro at gmail.com  Tue Dec 17 10:57:12 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 17 Dec 2013 11:57:12 +0100
Subject: [rabbitmq-discuss] Blocking connections - during load tests
In-Reply-To: <4a5d77e4-4796-46e4-b837-9d0a8dee8179@googlegroups.com>
References: <4a5d77e4-4796-46e4-b837-9d0a8dee8179@googlegroups.com>
Message-ID: <CAMcAHLV+QGekmHzW886CqPQDqj76_x_Sdej+H1F4wB3E5vNAow@mail.gmail.com>

Hi,

You should try to find the reason why RabbitMQ is blocking
connections, see more here: http://www.rabbitmq.com/memory.html

This is a mechanism to prevent that rogue publisher crash the server.
Also, if you abruptly close the connections to RabbitMQ, and those
connections where in "blocked" state, then RabbitMQ can't close them.

Regards,

Alvaro

On Tue, Dec 17, 2013 at 10:41 AM, Billy Stack <bs.stack at gmail.com> wrote:
> All,
>
> We are experiencing difficulty when performing load tests on one of our
> applications that uses RabbitMQ (via the .NET client).
>
> Using JMeter with 30 concurrent threads we started to hammer our
> application.
> The memory high-water mark was reached after a couple of hours.
>
> Once this was reached the applications rabbitmq connection changed to status
> "blocked".
> Also, subsequent new connections go to status "blocking"
> For some reason, two other connections seem to be "running"
>
> The question I have is we then stop the load tests, the server does not
> recover, is this as expected?
> Is the problem the number of channels that we seem to have open for the load
> tests (i.e. 734)?
>
> Any help greatly appreciated
>
> Thanks,
> Billy Stack
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From carl.hoerberg at gmail.com  Tue Dec 17 10:57:15 2013
From: carl.hoerberg at gmail.com (=?utf-8?Q?Carl_H=C3=B6rberg?=)
Date: Tue, 17 Dec 2013 17:57:15 +0700
Subject: [rabbitmq-discuss]
 =?utf-8?q?cluster_crash_when_setting_ha-mode?= =?utf-8?q?=3Dnodes?=
In-Reply-To: <52B02DBA.6080200@rabbitmq.com>
References: <1386919585377-32042.post@n5.nabble.com>
 <52B02DBA.6080200@rabbitmq.com>
Message-ID: <etPan.52b02e10.7c83e458.119@Carls-MacBook-Air.local>

Nope, nothing in the logs. But on another cluster I just did rabbitmqctl stop_app and reset on one node, without setting ha-nodes first, and then it worked fine do decommission it.?

On 17 december 2013 at 17:55:41, Simon MacMullen (simon at rabbitmq.com) wrote:

On 13/12/2013 07:26, carlhoerberg wrote:  
> Set ha-mode=nodes on a all of vhosts, from ha-mode=all, to gracefully remove  
> a node. All queues failover successfully, but then /api/overview stopped  
> working, nor could we issue rabbitmqctl cluster_status. Tried to stop the  
> node we were rotating out, it didn't respond. Had to "kill" it after a  
> couple of minutes. Node 1 and 2 still doesn't respond, tries to issue "sudo  
> rabbitmqctl eval 'application:stop(rabbitmq_management).'" on node 1,  
> successfully, but on node 2 it just hangs..  
>  
> Kills node2, node1 rabbitmq_mgmt starts, but still can't query  
> /api/overview. Kills node1 too, on start up we get a lot of "home node  
> 'rabbit at lemur03' of durable queue 'celery' in vhost 'shycoqhj' is down or  
> inaccessible", but lemur03 shouldn't be master for any queue anymore!  
>  
> RabbitMQ 3.2.1, Erlang R16B01  

It's hard to guess what might be going on from this description. Do you  
have anything in the logs?  

Cheers, Simon  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/1f51cb08/attachment.html>

From emile at rabbitmq.com  Tue Dec 17 11:01:11 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Dec 2013 11:01:11 +0000
Subject: [rabbitmq-discuss] STOMP 1.2 support for ACK or NACK frames in
In-Reply-To: <l8p9f7$d63$1@ger.gmane.org>
References: <l8p9f7$d63$1@ger.gmane.org>
Message-ID: <52B02EF7.3030808@rabbitmq.com>


Hi Michael,

On 17/12/13 10:36, Michael Justin wrote:

> with STOMP 1.2 and an active STOMP transaction, does RabbitMQ support 
> the "transaction" header for ACK and NACK commands, so that the client 
> can rollback the ACK or NACK?

Yes.

> If yes, can the client use all acknowledgement modes of the SUBSCRIBE 
> command ("ack:auto", "ack:client" and "ack:client-individual") and roll 
> back ACK or NACK frames which belong to the transaction, or is it 
> limited to ack:client / ack:client-individual?


Transactions are scoped over ACK as well as NACK.



-Emile



From simon at rabbitmq.com  Tue Dec 17 11:24:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Dec 2013 11:24:21 +0000
Subject: [rabbitmq-discuss] Stability/Reliability of a cluster with
 mirrored queue
In-Reply-To: <52AF17FF.9050800@smoczus.pl>
References: <52AF17FF.9050800@smoczus.pl>
Message-ID: <52B03465.1060001@rabbitmq.com>

Well, there is in general a tendency towards increased stability in the 
HA code :-) I would say that most of the bugs that we are fixing these 
days are reasonably hard to hit. But there are regressions occasionally 
and there was a fairly severe one in 3.2.0, so that could have been the 
source of your problems.

Of course there is also the issue of clustering and network partitions; 
you will definitely experience more problems with clustering if 
deploying it across an unreliable network.

Cheers, Simon

On 16/12/2013 15:10, Miros?aw Naga? wrote:
> Hi,
>
> I would like to know your opinion about stability/reliability of a
> cluster with mirrored queues. I'm considering to use it and even tried
> with 3.2.0. I guess I don't have to point out how huge disappointment
> was it. And what's worse, if you skim recent releases notes, it's really
> hard to find a release without some bug fixes related to clustering
> and/or HA.
>
> What I'm asking is, is a cluster setup with mirrored queues stable and
> reliable and past bugs/problems appeared really rarely in anomalous use
> cases/conditions or the reality is that it has some
> stability/reliability issues that affects every robust use cases at some
> point?
>
> We have been running a single node without interruption on production
> (cloud) for about 1,5 year. Having in mind all past bugs, what I'm
> worried about is that, in a year from now I will come to a conclusion
> that because of a cluster with mirrored queue my overall reliability
> and/or stability was much worse than eg. just two separate nodes behind
> LB (maintainability is not a big deal here; we use persistence and can
> afford restoring messages from a failed node manually in case of a cloud
> machine failure).
>
> Maybe someone can share his experience from production run?
>
>
> /mn
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Dec 17 11:39:55 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Dec 2013 11:39:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.1.5 crashed
In-Reply-To: <721958228.7735376.1387237031361.JavaMail.root@vmware.com>
References: <721958228.7735376.1387237031361.JavaMail.root@vmware.com>
Message-ID: <52B0380B.5070707@rabbitmq.com>

So what I see from the logs is that a connection crashed since it 
received connection.close and then found that the TCP connection was 
already closed when it tried to send connection.close-ok in response.

That then caused the queue collector for that connection (component 
which deletes exclusive queues when a connection closes) to crash.

So that's some noise in the logs, I think that could be handled better - 
but I don't see anything there that would amount to the server itself 
crashing. Can you post complete logs somewhere? Probably more useful 
than the crash dump.

Cheers, Simon

On 16/12/2013 23:37, Kapil Goyal wrote:
> Hi,
>
> A rabbitmq server in one of our setups crashed recently. Can you please
> take a look at the attached rabbit and rabbit-sasl logs and help me
> understand the issue?
>
> The logs attached start from around a minute before and until the crash.
>
> I also have a 17M crash dump file. If you'd like to look at it, can I
> send it as an email attachment or you'd prefer another way?
>
>
> Thanks
> Kapil
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Tue Dec 17 11:44:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Dec 2013 11:44:48 +0000
Subject: [rabbitmq-discuss] rabbit,failure_during_boot
In-Reply-To: <CADnm59x_w3wjwncbvL53R-cnwjc82x6J_sDAEJ9-Ah8eQ-fnmA@mail.gmail.com>
References: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>
 <52A6E13C.9020702@rabbitmq.com>
 <CADnm59x_w3wjwncbvL53R-cnwjc82x6J_sDAEJ9-Ah8eQ-fnmA@mail.gmail.com>
Message-ID: <52B03930.9040909@rabbitmq.com>

On 17/12/2013 11:39, Tiziana Stoesselli wrote:
> #rabbitmqctl reset
> Resetting node 'Name at zenossoc' ...
> Error: unable to connect to node 'Name at zenossoc': nodedown

"rabbitmqctl reset" resets a running node. If you can't get your node to 
start then you'll need to delete the Mnesia directory manually with "rm 
-r /var/lib/rabbitmq/mnesia" or similar.

Cheers, Simon

From michael.justin at gmx.net  Tue Dec 17 11:57:24 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 17 Dec 2013 12:57:24 +0100
Subject: [rabbitmq-discuss] STOMP 1.2 support for ACK or NACK frames in
In-Reply-To: <52B02EF7.3030808@rabbitmq.com>
References: <l8p9f7$d63$1@ger.gmane.org> <52B02EF7.3030808@rabbitmq.com>
Message-ID: <l8pe6s$5e8$1@ger.gmane.org>

Am 17.12.2013 12:01, Emile Joubert wrote:
>
> Hi Michael,
>
> On 17/12/13 10:36, Michael Justin wrote:
>
>> with STOMP 1.2 and an active STOMP transaction, does RabbitMQ support
>> the "transaction" header for ACK and NACK commands, so that the client
>> can rollback the ACK or NACK?
>
> Yes.

Many thanks for the confirmation - I have tested it now (with success). 
This is a really cool feature.

Regards

-- 
Michael Justin


From simon at rabbitmq.com  Tue Dec 17 12:21:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Dec 2013 12:21:27 +0000
Subject: [rabbitmq-discuss] rabbit_limiter Exception and Broker Issues
In-Reply-To: <077401cefa9c$cd2c2e70$67848b50$@euphoriaaudio.com>
References: <077401cefa9c$cd2c2e70$67848b50$@euphoriaaudio.com>
Message-ID: <52B041C7.3060200@rabbitmq.com>

So that's very odd. You have a limiter (internal component responsible 
for a channel's prefetch count and a few other bits) and a supervisor 
crashing after receiving 'stat' - that's a message which should be sent 
only to queues.

Can you post the complete logs somewhere? I would like to see if there 
is any indication of how this could be happening.

Cheers, Simon

On 16/12/2013 20:24, Chris Larsen wrote:
> Hiya, we ran into some problems with a cluster over the weekend. There
> was a sharp increase in message publishing traffic to this 2 node
> cluster that increased memory and FD usage but we didn?t observe the
> normal limit messages in the logs. Instead we say this ?rabbit_limiter?
> exception and the nodes stopped accepting published messages. Thankfully
> we were able to consume the queued, in-memory, data before restarting
> the nodes. Did we simply throw too many messages at Rabbit or was there
> an actual bug in the limiter code? We?re running 3.1.5 with Erlang
> R16B01 on both nodes. Below are some bits from the main logs on both
> nodes and the full SASL logs are in pastebin. Thanks!
>
> Node 1 sasl
>
> http://pastebin.com/h55i3AqQ
>
> Node 2 sasl
>
> http://pastebin.com/3hw7f6xA
>
> ------ NODE1 Rabbit LOG ------
>
> =ERROR REPORT==== 14-Dec-2013::11:39:15 ===
>
> ** Generic server <0.21763.1353> terminating
>
> ** Last message in was stat
>
> ** When Server state == {lim,0,<0.26407.1167>,false,[],0}
>
> ** Reason for termination ==
>
> ** {function_clause,[{rabbit_limiter,handle_call,
>
>                                       [stat,
>
>                                        {<0.234.0>,#Ref<0.0.8426.115176>},
>
>                                        {lim,0,<0.26407.1167>,false,[],0}],
>
>                                       []},
>
>                       {gen_server2,handle_msg,2,[]},
>
>                       {proc_lib,init_p_do_apply,3,
>
>                                 [{file,"proc_lib.erl"},{line,239}]}]}
>
> =ERROR REPORT==== 14-Dec-2013::11:55:10 ===
>
> ** Generic server <0.28277.6695> terminating
>
> ** Last message in was {'$gen_cast',
>
>                             {method,
>
>                                 {'queue.declare',0,
>
>                                     <<"notification.somehost">>,
>
>                                     false,false,false,false,false,
>
>                                     [{<<"x-expires">>,signedint,10800000}]},
>
>                                 none,noflow}}
>
> ** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,247,
>
>                              <0.4536.6658>,<0.13044.6658>,<0.4536.6658>,
>
>                              <<C_IP -> S_IP>>,
>
>                              {lstate,<0.20106.6569>,false,false},
>
>                              none,1,
>
>                              {[],[]},
>
>                              {user,<<"app_user">>,
>
>                                  [administrator],
>
>                                  rabbit_auth_backend_internal,
>
>                                  {internal_user,<<"app_user">>,
>
>
> <<79,159,188,106,120,27,224,243,230,15,223,
>
>                                        54,140,137,70,36,212,30,111,89>>,
>
>                                      [administrator]}},
>
>                              <<"/app_user">>,<<>>,
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
>                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {set,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {set,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              <0.8820.6668>,
>
>                              {state,fine,5000,#Ref<0.0.6989.167017>},
>
>                              false,1,
>
>                              {{0,nil},{0,nil}},
>
>                              [],
>
>                              [{<<"consumer_cancel_notify">>,bool,true},
>
>                               {<<"publisher_confirms">>,bool,true}],
>
>                              none}
>
> ** Reason for termination ==
>
> ** {{{function_clause,
>
>           [{supervisor2,handle_call,
>
>                [stat,
>
>                 {<7347.227.0>,#Ref<7347.0.8145.90172>},
>
>                 {state,
>
>                     {<7347.9746.1239>,rabbit_intermediate_sup},
>
>                     one_for_one,[],
>
>                     {dict,0,16,16,8,80,48,
>
>                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                     10,10,[],rabbit_intermediate_sup,[]}],
>
>                []},
>
>            {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
>
>
> {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},
>
>       {gen_server2,call,[<7347.9746.1239>,stat,infinity]}},
>
>      [{gen_server2,call,3,[]},
>
>       {delegate,safe_invoke,2,[]},
>
>       {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},
>
>       {delegate,handle_call,3,[]},
>
>       {gen_server2,handle_msg,2,[]},
>
>       {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>
> =ERROR REPORT==== 14-Dec-2013::11:55:10 ===
>
> AMQP connection <0.4536.6658> (running), channel 247 - error:
>
> {{{function_clause,
>
>        [{supervisor2,handle_call,
>
>             [stat,
>
>              {<7347.227.0>,#Ref<7347.0.8145.90172>},
>
>              {state,
>
>                  {<7347.9746.1239>,rabbit_intermediate_sup},
>
>                  one_for_one,[],
>
>                  {dict,0,16,16,8,80,48,
>
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>                      {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                  10,10,[],rabbit_intermediate_sup,[]}],
>
>             []},
>
>         {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
>
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},
>
>    {gen_server2,call,[<7347.9746.1239>,stat,infinity]}},
>
> [{gen_server2,call,3,[]},
>
>    {delegate,safe_invoke,2,[]},
>
>    {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},
>
>    {delegate,handle_call,3,[]},
>
>    {gen_server2,handle_msg,2,[]},
>
>    {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>
> =WARNING REPORT==== 14-Dec-2013::11:55:10 ===
>
> Non-AMQP exit reason '{{{function_clause,
>
>                           [{supervisor2,handle_call,
>
>                             [stat,
>
>                              {<7347.227.0>,#Ref<7347.0.8145.90172>},
>
>                              {state,
>
>                               {<7347.9746.1239>,rabbit_intermediate_sup},
>
>                               one_for_one,[],
>
>                               {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                 []},
>
>
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                  []}}},
>
>                               10,10,[],rabbit_intermediate_sup,[]}],
>
>                             []},
>
>                            {gen_server,handle_msg,5,
>
>                             [{file,"gen_server.erl"},{line,585}]},
>
>                            {proc_lib,init_p_do_apply,3,
>
>                             [{file,"proc_lib.erl"},{line,239}]}]},
>
>
> {gen_server2,call,[<7347.9746.1239>,stat,infinity]}},
>
>                         [{gen_server2,call,3,[]},
>
>                          {delegate,safe_invoke,2,[]},
>
>                          {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},
>
>                          {delegate,handle_call,3,[]},
>
>                          {gen_server2,handle_msg,2,[]},
>
>                          {proc_lib,wake_up,3,
>
>                           [{file,"proc_lib.erl"},{line,249}]}]}'
>
> =ERROR REPORT==== 14-Dec-2013::12:27:35 ===
>
> ** Generic server <0.17415.2019> terminating
>
> ** Last message in was {'$gen_cast',
>
>                             {method,
>
>                                 {'queue.declare',0,
>
>                                     <<"notification.somehost">>,
>
>                                     false,false,false,false,false,
>
>                                     [{<<"x-expires">>,signedint,10800000}]},
>
>                                 none,noflow}}
>
> ** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,240,
>
>                              <0.23804.2237>,<0.9694.2017>,<0.23804.2237>,
>
>                              <<C_IP -> S_IP>>,
>
>                              {lstate,<0.8750.2014>,false,false},
>
>                              none,1,
>
>                              {[],[]},
>
>                              {user,<<"app_user">>,
>
>                                  [administrator],
>
>                                  rabbit_auth_backend_internal,
>
>                                  {internal_user,<<"app_user">>,
>
>
> <<199,64,175,52,127,65,248,9,70,171,15,9,5,
>
>                                        122,73,4,195,147,238,67>>,
>
>                                      [administrator]}},
>
>                              <<"/app_user">>,<<>>,
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {set,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
>                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              {set,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                              <0.6852.2217>,
>
>                              {state,fine,5000,#Ref<0.0.8928.158612>},
>
>                              false,1,
>
>                              {{0,nil},{0,nil}},
>
>                              [],
>
>                              [{<<"consumer_cancel_notify">>,bool,true},
>
>                               {<<"publisher_confirms">>,bool,true}],
>
>                              none}
>
> ** Reason for termination ==
>
> ** {{{function_clause,
>
>           [{supervisor2,handle_call,
>
>                [stat,
>
>                 {<7347.226.0>,#Ref<7347.0.8518.17139>},
>
>                 {state,
>
>                     {<7347.8508.1220>,rabbit_connection_sup},
>
>                     one_for_all,
>
>                     [{child,<7347.27376.2037>,reader,
>
>                          {rabbit_reader,start_link,
>
>                              [<7347.29450.2047>,<7347.19330.2055>,
>
>                               #Fun<rabbit_heartbeat.2.69784259>]},
>
>                          intrinsic,4294967295,worker,
>
>                          [rabbit_reader]},
>
>                      {child,<7347.29450.2047>,channel_sup3,
>
>                          {rabbit_intermediate_sup,start_link,[]},
>
>                          intrinsic,infinity,supervisor,
>
>                          [rabbit_intermediate_sup]},
>
>                      {child,<7347.19330.2055>,collector,
>
>                          {rabbit_queue_collector,start_link,[]},
>
>                          intrinsic,4294967295,worker,
>
>                          [rabbit_queue_collector]}],
>
>                     {dict,0,16,16,8,80,48,
>
>                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                     0,1,[],rabbit_connection_sup,[]}],
>
>                []},
>
>            {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
>
>
> {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},
>
>       {gen_server2,call,[<7347.8508.1220>,stat,infinity]}},
>
>      [{gen_server2,call,3,[]},
>
>       {delegate,safe_invoke,2,[]},
>
>       {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},
>
>       {delegate,handle_call,3,[]},
>
>       {gen_server2,handle_msg,2,[]},
>
>       {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>
> =ERROR REPORT==== 14-Dec-2013::12:27:35 ===
>
> AMQP connection <0.23804.2237> (running), channel 240 - error:
>
> {{{function_clause,
>
>        [{supervisor2,handle_call,
>
>             [stat,
>
>              {<7347.226.0>,#Ref<7347.0.8518.17139>},
>
>              {state,
>
>                  {<7347.8508.1220>,rabbit_connection_sup},
>
>                  one_for_all,
>
>                  [{child,<7347.27376.2037>,reader,
>
>                       {rabbit_reader,start_link,
>
>                           [<7347.29450.2047>,<7347.19330.2055>,
>
>                            #Fun<rabbit_heartbeat.2.69784259>]},
>
>                       intrinsic,4294967295,worker,
>
>                       [rabbit_reader]},
>
>                   {child,<7347.29450.2047>,channel_sup3,
>
>                       {rabbit_intermediate_sup,start_link,[]},
>
>                       intrinsic,infinity,supervisor,
>
>                       [rabbit_intermediate_sup]},
>
>                   {child,<7347.19330.2055>,collector,
>
>                       {rabbit_queue_collector,start_link,[]},
>
>                       intrinsic,4294967295,worker,
>
>                       [rabbit_queue_collector]}],
>
>                  {dict,0,16,16,8,80,48,
>
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>                      {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                  0,1,[],rabbit_connection_sup,[]}],
>
>             []},
>
>         {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
>
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},
>
>    {gen_server2,call,[<7347.8508.1220>,stat,infinity]}},
>
> [{gen_server2,call,3,[]},
>
>    {delegate,safe_invoke,2,[]},
>
>    {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},
>
>    {delegate,handle_call,3,[]},
>
>    {gen_server2,handle_msg,2,[]},
>
>    {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>
> =WARNING REPORT==== 14-Dec-2013::12:27:35 ===
>
> Non-AMQP exit reason '{{{function_clause,
>
>                           [{supervisor2,handle_call,
>
>                             [stat,
>
>                              {<7347.226.0>,#Ref<7347.0.8518.17139>},
>
>                              {state,
>
>                               {<7347.8508.1220>,rabbit_connection_sup},
>
>                               one_for_all,
>
>                               [{child,<7347.27376.2037>,reader,
>
>                                 {rabbit_reader,start_link,
>
>                                  [<7347.29450.2047>,<7347.19330.2055>,
>
>                                   #Fun<rabbit_heartbeat.2.69784259>]},
>
>                                 intrinsic,4294967295,worker,
>
>                                 [rabbit_reader]},
>
>                                {child,<7347.29450.2047>,channel_sup3,
>
>                                 {rabbit_intermediate_sup,start_link,[]},
>
>                                 intrinsic,infinity,supervisor,
>
>                                 [rabbit_intermediate_sup]},
>
>                                {child,<7347.19330.2055>,collector,
>
>                                 {rabbit_queue_collector,start_link,[]},
>
>                                 intrinsic,4294967295,worker,
>
>                                 [rabbit_queue_collector]}],
>
>                               {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                 []},
>
>
>                      {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                  []}}},
>
>                               0,1,[],rabbit_connection_sup,[]}],
>
>                             []},
>
>                            {gen_server,handle_msg,5,
>
>                             [{file,"gen_server.erl"},{line,585}]},
>
>                            {proc_lib,init_p_do_apply,3,
>
>                             [{file,"proc_lib.erl"},{line,239}]}]},
>
>
> {gen_server2,call,[<7347.8508.1220>,stat,infinity]}},
>
>                         [{gen_server2,call,3,[]},
>
>                          {delegate,safe_invoke,2,[]},
>
>                          {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},
>
>                          {delegate,handle_call,3,[]},
>
>                          {gen_server2,handle_msg,2,[]},
>
>                          {proc_lib,wake_up,3,
>
>                           [{file,"proc_lib.erl"},{line,249}]}]}'
>
> ------ NODE2 Rabbit LOG ------
>
> =ERROR REPORT==== 14-Dec-2013::11:55:10 ===
>
> ** Generic server <0.9746.1239> terminating
>
> ** Last message in was stat
>
> ** When Server state == {state,{<0.9746.1239>,rabbit_intermediate_sup},
>
>                                 one_for_one,[],
>
>                                 {dict,0,16,16,8,80,48,
>
>
>                 {[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                        [],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                         [],[],[]}}},
>
>                                 10,10,[],rabbit_intermediate_sup,[]}
>
> ** Reason for termination ==
>
> ** {function_clause,
>
>         [{supervisor2,handle_call,
>
>              [stat,
>
>               {<0.227.0>,#Ref<0.0.8145.90172>},
>
>               {state,
>
>                   {<0.9746.1239>,rabbit_intermediate_sup},
>
>                   one_for_one,[],
>
>                   {dict,0,16,16,8,80,48,
>
>                       {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>                       {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                   10,10,[],rabbit_intermediate_sup,[]}],
>
>              []},
>
>          {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,585}]},
>
>          {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From bison_art at o2.pl  Tue Dec 17 14:49:23 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 17 Dec 2013 06:49:23 -0800 (PST)
Subject: [rabbitmq-discuss] How remove messages which must be ack
Message-ID: <1387291762482-32168.post@n5.nabble.com>

Hi, I have question about how to remove messages from queue.
This messages must be ack and I can't stop the consumer.
I want to stop the consumer and clear the queue (purge)

Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-remove-messages-which-must-be-ack-tp32168.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ranjith.v at zohocorp.com  Tue Dec 17 15:05:17 2013
From: ranjith.v at zohocorp.com (Ranjith Venkatesan)
Date: Tue, 17 Dec 2013 07:05:17 -0800 (PST)
Subject: [rabbitmq-discuss] BasicQos Multiple msg ack
In-Reply-To: <52B02A8A.5020305@rabbitmq.com>
References: <1386925979353-32047.post@n5.nabble.com>
 <CAE3HoVQXsXON-s0MGrxZRs2Vr7b89uikpnHv2Qu=q1dV-PMCAQ@mail.gmail.com>
 <52B02A8A.5020305@rabbitmq.com>
Message-ID: <1387292717630-32169.post@n5.nabble.com>

Hi Simon,

Thanks for your reply. Now its working fine. I could able to acknowledge
bulk messages.

regards 


Ranjith Venkatesan 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/BasicQos-Multiple-msg-ack-tp32047p32169.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From james.andres at gmail.com  Tue Dec 17 16:04:23 2013
From: james.andres at gmail.com (James Andres)
Date: Tue, 17 Dec 2013 08:04:23 -0800 (PST)
Subject: [rabbitmq-discuss] Cannot delete queue using rabbitmq_management or
	rabbitmqadmin tool
In-Reply-To: <3cb4d85e-f894-4b5d-8920-b6948f82f582@googlegroups.com>
References: <3cb4d85e-f894-4b5d-8920-b6948f82f582@googlegroups.com>
Message-ID: <b0291d5b-c8fc-4eae-ac42-5150bdf181db@googlegroups.com>

I've since upgraded to Erlang R16B03 and Rabbit 3.2.2. The problem has not returned since the upgrade. So, so far so good.

Also worth mentioning many SSL handshakes were failing with the older Erlang. The upgrade seems to have helped.

From james.gardner at noaa.gov  Tue Dec 17 17:18:56 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 17 Dec 2013 11:18:56 -0600
Subject: [rabbitmq-discuss] Best way to ping server from client
In-Reply-To: <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>
References: <52A60115.3010902@noaa.gov>
 <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>
Message-ID: <52B08780.8030000@noaa.gov>


Hi Alvaro,

Great to get your reply, I didn't expect to hear from the Creator ;). 
Sorry about the delay, I wanted to think further on this before responding.
The access_request idea was the type of answer I was looking for, but alas:
http://www.rabbitmq.com/undeprecated.html
...so I can't base a solution on it.

The way I'm understanding it, there is a fundamental problem, when 
waiting for a server-push, in being able to detect the difference 
between 'server has nothing to send you' and 'server has just gone away 
forever', hence the need for some sort of heartbeat.
I guess I have come to the conclusion that the only way to tell if a 
server has gone away, is to send a request which should illicit an 
immediate response, hence the need for some sort of ping.
There are only two operations I can think of to use for pings, albeit 
relatively expensive ones:

For consume scripts, a periodic queue declaration call, since they're 
idempotent?
For publish scripts, a periodic QOS call, eg. setting prefetch number? 
(Am I correct in saying this would have no effect on a channel used only 
for publishing?)

Do you or anyone else see any problems with using these? Let me know if 
my thinking is off somehow.

Also, if you would care to, I would like to ask you to comment on:
https://github.com/videlalvaro/php-amqplib/commit/20d50074e6a2904737d23d93e36fd22ece46add2
Not sure I fully understand the exact implications or limitations that 
result from this issue; what are the scenarios in which this would cause 
a problem?

I would like to take the opportunity to thank you and all the 
contributors for a great library; it's been a real life saver since we 
were suffering a memory leak in the PECL AMQP extension. PhpAmqpLib has 
been very solid so far and I greatly prefer its design. It's also nice 
to be able to read the code easily, and package it along with our apps.
Cheers,

James


On 12/09/2013 11:49 AM, Alvaro Videla wrote:
> Hi James,
>
> I've thought about implementing some of the hearbeats exposed by
> RabbitMQ but is not so easy considering PHP's single thread view of
> the world. I could try to approximate timeouts for example, but not
> sure about what errors that could bring.
>
> As a complete hack and trying to answer your question, there's the
> access_request method which in RabbitMQ won't do much: See
> https://github.com/videlalvaro/php-amqplib/blob/master/PhpAmqpLib/Channel/AMQPChannel.php#L233
> andhttp://hg.rabbitmq.com/rabbitmq-server/file/3e9ad0a5795e/src/rabbit_channel.erl#l646
>
> Regards,
>
> Alvaro
>
> On Mon, Dec 9, 2013 at 6:42 PM, James Gardner<james.gardner at noaa.gov>  wrote:
>> Hi,
>>
>> I need to know the best way to 'ping' an AMQP server from a client (I'm
>> using PhpAmqpLib). We have encountered some situations where the client
>> doesn't realize the server has 'gone away', and hangs for far too long,
>> sometimes indefinitely. Regardless of whether this is a problem with the
>> client library, if I wanted to test the connection by issuing the most
>> benign, inexpensive request, what might that be? Perhaps there is a channel
>> method I can call repeatedly at regular intervals without causing errors,
>> like QOS, or something else? This would be during a consume.
>> Thanks,
>>
>> James Gardner, NWS NIDS
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Tue Dec 17 17:24:32 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 17 Dec 2013 18:24:32 +0100
Subject: [rabbitmq-discuss] Best way to ping server from client
In-Reply-To: <52B08780.8030000@noaa.gov>
References: <52A60115.3010902@noaa.gov>
 <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>
 <52B08780.8030000@noaa.gov>
Message-ID: <CAMcAHLXe6DehSxWu4dfeq1dijFmA7_0sQAAx57L=XakGxH8JEQ@mail.gmail.com>

Hi,

On Tue, Dec 17, 2013 at 6:18 PM, James Gardner <james.gardner at noaa.gov> wrote:
> Great to get your reply, I didn't expect to hear from the Creator ;). Sorry
> about the delay, I wanted to think further on this before responding.
> The access_request idea was the type of answer I was looking for, but alas:
> http://www.rabbitmq.com/undeprecated.html
> ...so I can't base a solution on it.

I'm not sure IF we are ever going to remove the access class. Maybe
some other RabbitMQ dev can answer this question.

> Also, if you would care to, I would like to ask you to comment on:
> https://github.com/videlalvaro/php-amqplib/commit/20d50074e6a2904737d23d93e36fd22ece46add2
> Not sure I fully understand the exact implications or limitations that
> result from this issue; what are the scenarios in which this would cause a
> problem?

The problem there is that after a read timeout, an exception will be
thrown, breaking most consumers out there. What the library needs to
do is to handle those timeouts internally and then abide by the
timeout parameter passed to channel wait().

In the meantime your solution might work. In my case, I'll try to
implement AMQP heartbeats.

Regards,

Alvaro

From james.gardner at noaa.gov  Tue Dec 17 18:04:23 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 17 Dec 2013 12:04:23 -0600
Subject: [rabbitmq-discuss] Best way to ping server from client
In-Reply-To: <CAMcAHLXe6DehSxWu4dfeq1dijFmA7_0sQAAx57L=XakGxH8JEQ@mail.gmail.com>
References: <52A60115.3010902@noaa.gov>
 <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>
 <52B08780.8030000@noaa.gov>
 <CAMcAHLXe6DehSxWu4dfeq1dijFmA7_0sQAAx57L=XakGxH8JEQ@mail.gmail.com>
Message-ID: <52B09227.4050200@noaa.gov>


Thanks Alvaro, I will look forward to any new versions.
- James

On 12/17/2013 11:24 AM, Alvaro Videla wrote:
> Hi,
>
> On Tue, Dec 17, 2013 at 6:18 PM, James Gardner <james.gardner at noaa.gov> wrote:
>> Great to get your reply, I didn't expect to hear from the Creator ;). Sorry
>> about the delay, I wanted to think further on this before responding.
>> The access_request idea was the type of answer I was looking for, but alas:
>> http://www.rabbitmq.com/undeprecated.html
>> ...so I can't base a solution on it.
> I'm not sure IF we are ever going to remove the access class. Maybe
> some other RabbitMQ dev can answer this question.
>
>> Also, if you would care to, I would like to ask you to comment on:
>> https://github.com/videlalvaro/php-amqplib/commit/20d50074e6a2904737d23d93e36fd22ece46add2
>> Not sure I fully understand the exact implications or limitations that
>> result from this issue; what are the scenarios in which this would cause a
>> problem?
> The problem there is that after a read timeout, an exception will be
> thrown, breaking most consumers out there. What the library needs to
> do is to handle those timeouts internally and then abide by the
> timeout parameter passed to channel wait().
>
> In the meantime your solution might work. In my case, I'll try to
> implement AMQP heartbeats.
>
> Regards,
>
> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From richard at raseley.com  Tue Dec 17 18:15:01 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 17 Dec 2013 10:15:01 -0800
Subject: [rabbitmq-discuss] Impact of Updating Queue Parameters on Queued
	Messages
Message-ID: <CAO=6ox8hBo4dkpAyNS_c-MmKsX7U0vbMaiU9MbanjBKteZVTgQ@mail.gmail.com>

Imagine the following scenario:

1) You have a queue named 'queue1' declared within a broker.

2) This queue has several messages in it that have yet to be consumed.

3) You want to change the properties of the queue, for this example say you
want to add a dead-letter exchange and dead-letter routing key.

4) You create a configuration file that is identical to the one currently
on the broker, except for these new queue parameters.

5) You upload the configuration file, thereby adding the new properties the
queue.

What is the impact on the messages in the queue?

A) The messages are purged, the queue is deleted and recreated with the new
parameters.

B) The messages are preserved and the queue's parameters are just updated.

C) Something else?

Thank you in advance for helping to clarify this.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/4c64b930/attachment.html>

From simon at rabbitmq.com  Tue Dec 17 18:26:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Dec 2013 18:26:21 +0000
Subject: [rabbitmq-discuss] Impact of Updating Queue Parameters on
 Queued Messages
In-Reply-To: <CAO=6ox8hBo4dkpAyNS_c-MmKsX7U0vbMaiU9MbanjBKteZVTgQ@mail.gmail.com>
References: <CAO=6ox8hBo4dkpAyNS_c-MmKsX7U0vbMaiU9MbanjBKteZVTgQ@mail.gmail.com>
Message-ID: <52B0974D.4050108@rabbitmq.com>

On 17/12/2013 18:15, Richard Raseley wrote:
> A) The messages are purged, the queue is deleted and recreated with the
> new parameters.
>
> B) The messages are preserved and the queue's parameters are just updated.
>
> C) Something else?

C) The messages are preserved and the queue's arguments are *not* 
updated (i.e. the definition for that queue is ignored). Queue arguments 
never change; the import / export definitions feature does not change that.

If you want to add a DLX to an existing queue you can do that with 
policies in 3.2.x: see "Configuration using policy" under 
http://www.rabbitmq.com/dlx.html

Cheers, Simon

From simon at rabbitmq.com  Tue Dec 17 18:41:16 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Dec 2013 18:41:16 +0000
Subject: [rabbitmq-discuss] Best way to ping server from client
In-Reply-To: <CAMcAHLXe6DehSxWu4dfeq1dijFmA7_0sQAAx57L=XakGxH8JEQ@mail.gmail.com>
References: <52A60115.3010902@noaa.gov>
 <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>
 <52B08780.8030000@noaa.gov>
 <CAMcAHLXe6DehSxWu4dfeq1dijFmA7_0sQAAx57L=XakGxH8JEQ@mail.gmail.com>
Message-ID: <52B09ACC.5000209@rabbitmq.com>

On 17/12/2013 17:24, Alvaro Videla wrote:
> On Tue, Dec 17, 2013 at 6:18 PM, James Gardner<james.gardner at noaa.gov>  wrote:
>> >Great to get your reply, I didn't expect to hear from the Creator;). Sorry
>> >about the delay, I wanted to think further on this before responding.
>> >The access_request idea was the type of answer I was looking for, but alas:
>> >http://www.rabbitmq.com/undeprecated.html
>> >...so I can't base a solution on it.
> I'm not sure IF we are ever going to remove the access class. Maybe
> some other RabbitMQ dev can answer this question.

Well, keeping compatibility with older clients tends to be more work 
than we anticipate so these days we only tend to take things out if we 
really need to, and I don't see a big need to ever take out access.request.

However, if you just want to issue an AMQP method that acts as a no-op, 
it might be more future-proof to redeclare an already-existing queue or 
exchange, or to reissue basic.qos. All of those tend to be more or less 
a no-op if they don't change anything.

Redeclaring a queue / exchange also has the advantage over basic.qos and 
access.request that you can set no_wait = true and thus turn it into an 
asynchronous method (i.e. you won't wait around for a declare-ok).

Cheers, Simon


From richard at raseley.com  Tue Dec 17 18:44:40 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 17 Dec 2013 10:44:40 -0800
Subject: [rabbitmq-discuss] Impact of Updating Queue Parameters on
	Queued Messages
In-Reply-To: <52B0974D.4050108@rabbitmq.com>
References: <CAO=6ox8hBo4dkpAyNS_c-MmKsX7U0vbMaiU9MbanjBKteZVTgQ@mail.gmail.com>
 <52B0974D.4050108@rabbitmq.com>
Message-ID: <CAO=6ox98tj7=dqHhKDx09ZFcWWPX2LmUy+28C1a8OcK3ZmyUSg@mail.gmail.com>

Thank you for your reply.

I will review the policy documentation and go that route.

Regards,

Richard


On Tue, Dec 17, 2013 at 10:26 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 17/12/2013 18:15, Richard Raseley wrote:
>
>> A) The messages are purged, the queue is deleted and recreated with the
>> new parameters.
>>
>> B) The messages are preserved and the queue's parameters are just updated.
>>
>> C) Something else?
>>
>
> C) The messages are preserved and the queue's arguments are *not* updated
> (i.e. the definition for that queue is ignored). Queue arguments never
> change; the import / export definitions feature does not change that.
>
> If you want to add a DLX to an existing queue you can do that with
> policies in 3.2.x: see "Configuration using policy" under
> http://www.rabbitmq.com/dlx.html
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/bd99e039/attachment.html>

From richard at raseley.com  Tue Dec 17 18:55:20 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 17 Dec 2013 10:55:20 -0800
Subject: [rabbitmq-discuss] Impact of Updating Queue Parameters on
	Queued Messages
In-Reply-To: <CAO=6ox98tj7=dqHhKDx09ZFcWWPX2LmUy+28C1a8OcK3ZmyUSg@mail.gmail.com>
References: <CAO=6ox8hBo4dkpAyNS_c-MmKsX7U0vbMaiU9MbanjBKteZVTgQ@mail.gmail.com>
 <52B0974D.4050108@rabbitmq.com>
 <CAO=6ox98tj7=dqHhKDx09ZFcWWPX2LmUy+28C1a8OcK3ZmyUSg@mail.gmail.com>
Message-ID: <CAO=6ox9rm4_mM8hYrtsQPbQsCrZYRBrGY2=pZmdFEvhpZ=KeSw@mail.gmail.com>

Follow-up question:

There doesn't seem to be a lot in the policy documentation about the
available definitions for (specifically) the DLX policies. Am I correct in
assuming there is also a 'dead-letter-routing-key' definition that I can
use for the expected effect?

If yes, is it preferred that these be defined in the same policy or
separate policies with different priorities?

Regards,

Richard


On Tue, Dec 17, 2013 at 10:44 AM, Richard Raseley <richard at raseley.com>wrote:

> Thank you for your reply.
>
> I will review the policy documentation and go that route.
>
> Regards,
>
> Richard
>
>
>
> On Tue, Dec 17, 2013 at 10:26 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 17/12/2013 18:15, Richard Raseley wrote:
>>
>>> A) The messages are purged, the queue is deleted and recreated with the
>>> new parameters.
>>>
>>> B) The messages are preserved and the queue's parameters are just
>>> updated.
>>>
>>> C) Something else?
>>>
>>
>> C) The messages are preserved and the queue's arguments are *not* updated
>> (i.e. the definition for that queue is ignored). Queue arguments never
>> change; the import / export definitions feature does not change that.
>>
>> If you want to add a DLX to an existing queue you can do that with
>> policies in 3.2.x: see "Configuration using policy" under
>> http://www.rabbitmq.com/dlx.html
>>
>> Cheers, Simon
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/0b7b1aea/attachment.html>

From james.gardner at noaa.gov  Tue Dec 17 18:58:57 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 17 Dec 2013 12:58:57 -0600
Subject: [rabbitmq-discuss] Best way to ping server from client
In-Reply-To: <52B09ACC.5000209@rabbitmq.com>
References: <52A60115.3010902@noaa.gov>
 <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>
 <52B08780.8030000@noaa.gov>
 <CAMcAHLXe6DehSxWu4dfeq1dijFmA7_0sQAAx57L=XakGxH8JEQ@mail.gmail.com>
 <52B09ACC.5000209@rabbitmq.com>
Message-ID: <52B09EF1.4010601@noaa.gov>


Awesome Simon, very useful to know.
Can you also just confirm that adjusting QOS settings on a channel will 
have no effect on anything except message consumption, and no effect on 
using it for publishing or any other activity?
- James


On 12/17/2013 12:41 PM, Simon MacMullen wrote:
> On 17/12/2013 17:24, Alvaro Videla wrote:
>> On Tue, Dec 17, 2013 at 6:18 PM, James 
>> Gardner<james.gardner at noaa.gov>  wrote:
>>> >Great to get your reply, I didn't expect to hear from the 
>>> Creator;). Sorry
>>> >about the delay, I wanted to think further on this before responding.
>>> >The access_request idea was the type of answer I was looking for, 
>>> but alas:
>>> >http://www.rabbitmq.com/undeprecated.html
>>> >...so I can't base a solution on it.
>> I'm not sure IF we are ever going to remove the access class. Maybe
>> some other RabbitMQ dev can answer this question.
>
> Well, keeping compatibility with older clients tends to be more work 
> than we anticipate so these days we only tend to take things out if we 
> really need to, and I don't see a big need to ever take out 
> access.request.
>
> However, if you just want to issue an AMQP method that acts as a 
> no-op, it might be more future-proof to redeclare an already-existing 
> queue or exchange, or to reissue basic.qos. All of those tend to be 
> more or less a no-op if they don't change anything.
>
> Redeclaring a queue / exchange also has the advantage over basic.qos 
> and access.request that you can set no_wait = true and thus turn it 
> into an asynchronous method (i.e. you won't wait around for a 
> declare-ok).
>
> Cheers, Simon
>


From michael.s.klishin at gmail.com  Tue Dec 17 19:01:32 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 17 Dec 2013 23:01:32 +0400
Subject: [rabbitmq-discuss] Best way to ping server from client
In-Reply-To: <52B09EF1.4010601@noaa.gov>
References: <52A60115.3010902@noaa.gov>
 <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>
 <52B08780.8030000@noaa.gov>
 <CAMcAHLXe6DehSxWu4dfeq1dijFmA7_0sQAAx57L=XakGxH8JEQ@mail.gmail.com>
 <52B09ACC.5000209@rabbitmq.com> <52B09EF1.4010601@noaa.gov>
Message-ID: <CAE3HoVSmBz3JCxH0f=u5-_dpLkdrpk0CrFeweU0mJw2WcuZcaw@mail.gmail.com>

2013/12/17 James Gardner <james.gardner at noaa.gov>

> Can you also just confirm that adjusting QOS settings on a channel will
> have no effect on anything except message consumption, and no effect on
> using it for publishing or any other activity?


This is correct. It also will have no effect on consumption with automatic
acknowledgements
or using basic.get.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/e1f775cc/attachment.html>

From james.gardner at noaa.gov  Tue Dec 17 20:03:32 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 17 Dec 2013 14:03:32 -0600
Subject: [rabbitmq-discuss] Best way to ping server from client
In-Reply-To: <CAE3HoVSmBz3JCxH0f=u5-_dpLkdrpk0CrFeweU0mJw2WcuZcaw@mail.gmail.com>
References: <52A60115.3010902@noaa.gov>
 <CAMcAHLWqya7zBG=mwyB27wcivC+_ONUfvREfZUVJdN12LQRnJA@mail.gmail.com>
 <52B08780.8030000@noaa.gov>
 <CAMcAHLXe6DehSxWu4dfeq1dijFmA7_0sQAAx57L=XakGxH8JEQ@mail.gmail.com>
 <52B09ACC.5000209@rabbitmq.com> <52B09EF1.4010601@noaa.gov>
 <CAE3HoVSmBz3JCxH0f=u5-_dpLkdrpk0CrFeweU0mJw2WcuZcaw@mail.gmail.com>
Message-ID: <52B0AE14.5000304@noaa.gov>


Great - thanks Michael.


On 12/17/2013 01:01 PM, Michael Klishin wrote:
> 2013/12/17 James Gardner <james.gardner at noaa.gov 
> <mailto:james.gardner at noaa.gov>>
>
>     Can you also just confirm that adjusting QOS settings on a channel
>     will have no effect on anything except message consumption, and no
>     effect on using it for publishing or any other activity?
>
>
> This is correct. It also will have no effect on consumption with 
> automatic acknowledgements
> or using basic.get.
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/b1e1141f/attachment.html>

From ryankbrown at gmail.com  Tue Dec 17 23:06:58 2013
From: ryankbrown at gmail.com (Ryan Brown)
Date: Tue, 17 Dec 2013 16:06:58 -0700
Subject: [rabbitmq-discuss] Publisher confirms requires seperate call to get
	ack?
Message-ID: <CAChGYf_RLHti7ZJim+SnGEbspVGY+PM_xOvdUmo=6JmS7gJYNw@mail.gmail.com>

So, in testing the use of publisher confirms in RabbitMQ I am seeing a
significant (many orders of magnitude) decrease in performance when
requesting publisher confirms. Based on my interpretation of the
documentation, it appears that, in order to confrim each message queued was
written to disc, I need to make a re

-- 
-rb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/9042c311/attachment.html>

From sp345s at att.com  Tue Dec 17 23:12:33 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Tue, 17 Dec 2013 23:12:33 +0000
Subject: [rabbitmq-discuss] 2 Way Federation
Message-ID: <59BF56992750434F89F8EBE141E64B1D018382DD@GAALPA1MSGUSR9C.ITServices.sbc.com>


We have 2 data centers and both are active and have separate clusters ... Clients who connect to data center 1(DC1) publishes to exchanges in DC1 and same goes with DC2 .. we wanted to check if we can have 2 way federation on exchanges so that only messages from one DC flows to other and we avoid the circular message flow ... Can you pl. suggest if this is a possibility ..

Appreciate all the help ..
Thanks,
Sagar

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/14c94771/attachment.html>

From ryankbrown at gmail.com  Tue Dec 17 23:15:49 2013
From: ryankbrown at gmail.com (Ryan Brown)
Date: Tue, 17 Dec 2013 16:15:49 -0700
Subject: [rabbitmq-discuss] Publisher confirms requires seperate call to
	get ack?
In-Reply-To: <CAChGYf_RLHti7ZJim+SnGEbspVGY+PM_xOvdUmo=6JmS7gJYNw@mail.gmail.com>
References: <CAChGYf_RLHti7ZJim+SnGEbspVGY+PM_xOvdUmo=6JmS7gJYNw@mail.gmail.com>
Message-ID: <CAChGYf8ySwwadyENsyVNquqwLrbx_HZtrxR-gEO8DSmGNb4yBQ@mail.gmail.com>

<<Sorry. Finger hit cmd-enter>>

So, in testing the use of publisher confirms in RabbitMQ I am seeing a
significant (many orders of magnitude) decrease in performance when
requesting publisher confirms. Based on my interpretation of the
documentation, it appears that, in order to confirm each message queued was
written to disc, I need to make a request to get the acknowledgment. In
doing so, my publishing rates look like this:

Without publisher confirms:

~11k/mps

With publisher confirms (including call for ack):

187/mps

I feel that I must be doing something wrong. The servers hosting RabbitMQ
are quite robust with 16 cores, 32gb RAM and SSD drives.

Is anybody aware of a good example doing publisher confirms, preferably in
erlang but any language will do. Also, is it necessary to do it for each
message? I know, theoretically, the answer is no. But I have a wrapper
around Rabbit that must return synchronously to clients publishing messages
so it appears to be the best option.

Thanks in advance for any help.

Best.


On Tue, Dec 17, 2013 at 4:06 PM, Ryan Brown <ryankbrown at gmail.com> wrote:

> So, in testing the use of publisher confirms in RabbitMQ I am seeing a
> significant (many orders of magnitude) decrease in performance when
> requesting publisher confirms. Based on my interpretation of the
> documentation, it appears that, in order to confrim each message queued was
> written to disc, I need to make a re
>
> --
> -rb
>



-- 
-rb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/47eecb75/attachment.html>

From videlalvaro at gmail.com  Tue Dec 17 23:36:00 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 18 Dec 2013 00:36:00 +0100
Subject: [rabbitmq-discuss] 2 Way Federation
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D018382DD@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018382DD@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <CAMcAHLWaKA1eZrQ8kfZX_oD8x6kT3uqv-qpRxPA05Ycp5f1hjg@mail.gmail.com>

Hi,

To avoid circular message flows set max-hops = 1. See
http://www.rabbitmq.com/federation-reference.html

Regards,

Alvaro

On Wed, Dec 18, 2013 at 12:12 AM, PATAR, SAGAR <sp345s at att.com> wrote:
>
>
> We have 2 data centers and both are active and have separate clusters ?
> Clients who connect to data center 1(DC1) publishes to exchanges in DC1 and
> same goes with DC2 .. we wanted to check if we can have 2 way federation on
> exchanges so that only messages from one DC flows to other and we avoid the
> circular message flow ? Can you pl. suggest if this is a possibility ..
>
>
>
> Appreciate all the help ..
>
> Thanks,
>
> Sagar
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From michael.s.klishin at gmail.com  Wed Dec 18 05:53:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 18 Dec 2013 09:53:11 +0400
Subject: [rabbitmq-discuss] Publisher confirms requires seperate call to
 get ack?
In-Reply-To: <CAChGYf8ySwwadyENsyVNquqwLrbx_HZtrxR-gEO8DSmGNb4yBQ@mail.gmail.com>
References: <CAChGYf_RLHti7ZJim+SnGEbspVGY+PM_xOvdUmo=6JmS7gJYNw@mail.gmail.com>
 <CAChGYf8ySwwadyENsyVNquqwLrbx_HZtrxR-gEO8DSmGNb4yBQ@mail.gmail.com>
Message-ID: <CAE3HoVSSaCXdTdq7VMTn-22Fz7S2QNNxB+0DbAWmVxyyCZ0zJA@mail.gmail.com>

2013/12/18 Ryan Brown <ryankbrown at gmail.com>

> Is anybody aware of a good example doing publisher confirms, preferably in
> erlang but any language will do. Also, is it necessary to do it for each
> message? I know, theoretically, the answer is no. But I have a wrapper
> around Rabbit that must return synchronously to clients publishing messages
> so it appears to be the best option.


It depends on your client library. E.g. in Java, C# and Ruby (Bunny) you
can publish as many messages
as you want and then use Channel#waitForConfirms to wait for all
outstanding confirms to arrive.

it doesn't have to be done per message and RabbitMQ pushes confirms to you,
you do not poll for acknowledgements.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/8cbd18d9/attachment.html>

From michaeli at stcorp.no  Tue Dec 17 14:11:43 2013
From: michaeli at stcorp.no (Armen Michaeli)
Date: Tue, 17 Dec 2013 15:11:43 +0100
Subject: [rabbitmq-discuss] Some sort of non-fatal error in RabbitMQ's SASL
 log file - what does it mean?
Message-ID: <52B05B9F.4080105@stcorp.no>

Hello. I have installed RabbitMQ 3.2.2 on two nodes as "Generic Unix" 
distribution from the website. Even though it appears to start 
successfully on both with "Starting broker... completed with 0 
plugins.", on one of the nodes, which is without doubt part of the older 
Linux distribution (Centos 5.10 with kernel 2.6.18, Erlang R12B from 
base repo), the *-sasl.log file is filled with the following:

=CRASH REPORT==== 17-Dec-2013::13:46:01 ===
   crasher:
     pid: <0.145.0>
     registered_name: rabbit_disk_monitor
     exception exit: {undef,[{erlang,min,[10000,733636.590592]},
{rabbit_disk_monitor,interval,1},
{rabbit_disk_monitor,start_timer,1},
{rabbit_disk_monitor,init,1},
                             {gen_server,init_it,6},
{proc_lib,init_p_do_apply,3}]}
       in function  gen_server:init_it/6
     initial call: rabbit_disk_monitor:init/1
     ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.108.0>]
     messages: []
     links: [<0.144.0>]
     dictionary: []
     trap_exit: false
     status: running
     heap_size: 6765
     stack_size: 23
     reductions: 10891
   neighbours:

=SUPERVISOR REPORT==== 17-Dec-2013::13:46:01 ===
      Supervisor: {local,rabbit_disk_monitor_sup}
      Context:    start_error
      Reason: {undef,[{erlang,min,[10000,733636.590592]},
{rabbit_disk_monitor,interval,1},
{rabbit_disk_monitor,start_timer,1},
                          {rabbit_disk_monitor,init,1},
                          {gen_server,init_it,6},
                          {proc_lib,init_p_do_apply,3}]}
      Offender:   [{pid,undefined},
                   {name,rabbit_disk_monitor},
{mfa,{rabbit_disk_monitor,start_link,[50000000]}},
                   {restart_type,transient},
                   {shutdown,4294967295},
                   {child_type,worker}]

This may not be a problem in itself, but I am debugging a problem where 
a client connecting to this particular RabbitMQ node, is unable to 
complete a handshake (The client is Celery). This may be Celerys fault 
of course, but on the other RabbitMQ node where the log doesn't list the 
above, the connection works fine, so I am suspecting the above having 
something to do with the handshake failure.

Meanwhile, I will try to juggle between different Erlang versions to try 
to get to the bottom of this, but maybe some of you guys can spot 
immediately what went wrong here?

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/dee6c15d/attachment.html>

From roatin.marth at gmail.com  Tue Dec 17 22:01:18 2013
From: roatin.marth at gmail.com (Roatin Marth)
Date: Tue, 17 Dec 2013 14:01:18 -0800 (PST)
Subject: [rabbitmq-discuss] cannot redeclare exchange with different type
Message-ID: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>

g'day folks,

just been rummaging through the rabbit mq tutorials and got myself stuck in 
a slight rut.

i'm perusing the pub/sub example in python on windows. 
i've declared an exchange, and having run the script, I can see it's been 
created through the management console,
but I keep getting an exception as soon as I run either the producer or the 
consumer app.

if I comment out the exchange_declare line, all is well.

the logger says I cannot redeclare an exchange with a different type.
in the management window I can see it is of type fanout. the code is 
declaring it as fanout.
I was under the impression exchange_declare was idempotent. is this correct?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/26aff682/attachment.html>

From roatin.marth at gmail.com  Tue Dec 17 22:05:48 2013
From: roatin.marth at gmail.com (Roatin Marth)
Date: Tue, 17 Dec 2013 14:05:48 -0800 (PST)
Subject: [rabbitmq-discuss] cannot redeclare exchange with different type
In-Reply-To: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
References: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
Message-ID: <e3fba3f0-33d9-49f7-a48e-7a76aaa993ed@googlegroups.com>

hmmm deleted the exchange and reran the app and all is well. 



and there you have it,...




On Tuesday, 17 December 2013 17:01:18 UTC-5, Roatin Marth wrote:
>
> g'day folks,
>
> just been rummaging through the rabbit mq tutorials and got myself stuck 
> in a slight rut.
>
> i'm perusing the pub/sub example in python on windows. 
> i've declared an exchange, and having run the script, I can see it's been 
> created through the management console,
> but I keep getting an exception as soon as I run either the producer or 
> the consumer app.
>
> if I comment out the exchange_declare line, all is well.
>
> the logger says I cannot redeclare an exchange with a different type.
> in the management window I can see it is of type fanout. the code is 
> declaring it as fanout.
> I was under the impression exchange_declare was idempotent. is this 
> correct?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/b5b1ff28/attachment.html>

From tiziana.stoesselli at gmail.com  Tue Dec 17 11:31:51 2013
From: tiziana.stoesselli at gmail.com (Tiziana Stoesselli)
Date: Tue, 17 Dec 2013 03:31:51 -0800 (PST)
Subject: [rabbitmq-discuss] rabbit,failure_during_boot
In-Reply-To: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>
References: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>
Message-ID: <e5791327-de4d-4e81-9f0a-9b65971d1775@googlegroups.com>

On 09/12/2013 15:50, Tiziana Stoesselli wrote:

>                   [{rabbit_queue_index,parse_pub_record_body,
>                        [<<0,0,0,0,0,0,0,0>>]},
>                    {rabbit_queue_index,load_journal_entries,1},
>

The queue index has ended up with a whole load of zeroes appended to it.

We've seen this happen a few times, usually associated with OS crashes or 
power loss or similar.

We changed the queue index file format to be more resilient to this sort of 
corruption in 3.2.0. I'm not sure if there's anything you can do though if 
you've already got a corrupt file with an older version of RabbitMQ apart 
from reset the node and start again.

Cheers, Simon

Il giorno luned? 9 dicembre 2013 16:50:04 UTC+1, Tiziana Stoesselli ha 
scritto:
>
> Anyone can help me?
>
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.8.4  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2012 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : Name at zenossoc
> app descriptor : 
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.4/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : otG5wqMg04+qfhmRCVkglQ==
> log            : /var/log/rabbitmq/Name.log
> sasl log       : /var/log/rabbitmq/Name-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/Name
> erlang version : 5.8.5
>
> -- rabbit boot start
> starting file handle cache server                                     
> ...done
> starting worker pool                                                  
> ...done
> starting database                                                     
> ...done
> starting database sync                                                
> ...done
> starting codec correctness check                                      
> ...done
> -- external infrastructure ready
> starting plugin registry                                              
> ...done
> starting auth mechanism cr-demo                                       
> ...done
> starting auth mechanism amqplain                                      
> ...done
> starting auth mechanism plain                                         
> ...done
> starting statistics event manager                                     
> ...done
> starting logging server                                               
> ...done
> starting exchange type direct                                         
> ...done
> starting exchange type fanout                                         
> ...done
> starting exchange type headers                                        
> ...done
> starting exchange type topic                                          
> ...done
> -- kernel ready
> starting alarm handler                                                
> ...done
> starting node monitor                                                 
> ...done
> starting cluster delegate                                             
> ...done
> starting guid generator                                               
> ...done
> starting memory monitor                                               
> ...done
> -- core initialized
> starting empty DB check                                               
> ...done
> starting exchange, queue and binding recovery                         ...
>
> BOOT FAILED
> ===========
>
> Error description:
>    {badmatch,
>        {error,
>            {{{function_clause,
>                  [{rabbit_queue_index,parse_pub_record_body,
>                       [<<0,0,0,0,0,0,0,0>>]},
>                   {rabbit_queue_index,load_journal_entries,1},
>                   {rabbit_queue_index,recover_journal,1},
>                   {rabbit_queue_index,scan_segments,3},
>                   {rabbit_queue_index,queue_index_walker_reader,2},
>                   {rabbit_queue_index,'-queue_index_walker/1-fun-0-',2},
>                   {worker_pool_worker,handle_cast,2},
>                   {gen_server2,handle_msg,2}]},
>              {gen_server2,call,[<0.184.0>,out,infinity]}},
>             {child,undefined,msg_store_persistent,
>                 {rabbit_msg_store,start_link,
>                     
> [msg_store_persistent,"/var/lib/rabbitmq/mnesia/Name",[],
>                      {#Fun<rabbit_queue_index.2.89252852>,
>                       {start,
>                           [{resource,<<"/zenoss">>,queue,
>                                <<"zenoss.queues.zep.heartbeats">>},
>                            {resource,<<"/zenoss">>,queue,
>                                <<"zenoss.queues.zep.migrated.archive">>},
>                            {resource,<<"/zenoss">>,queue,
>                                <<"zenoss.queues.zep.zenevents">>},
>                            {resource,<<"/zenoss">>,queue,<<"celery">>},
>                            {resource,<<"/zenoss">>,queue,
>                                <<"zenoss.queues.zep.modelchange">>},
>                            {resource,<<"/zenoss">>,queue,
>                                <<"zenoss.queues.zep.rawevents">>},
>                            {resource,<<"/zenoss">>,queue,
>                                <<"zenoss.queues.zep.migrated.summary">>},
>                            {resource,<<"/zenoss">>,queue,
>                                <<"zenoss.queues.zep.signal">>}]}}]},
>                 transient,4294967295,worker,
>                 [rabbit_msg_store]}}}}
>
> Log files (may contain more information):
>    /var/log/rabbitmq/Name.log
>    /var/log/rabbitmq/Name-sasl.log
>
> Stack trace:
>    [{rabbit_variable_queue,start_msg_store,2},
>     {rabbit_amqqueue,start,0},
>     {rabbit,recover,0},
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>     {rabbit,run_boot_step,1},
>     {rabbit,'-start/2-lc$^0/1-0-',1},
>     {rabbit,start,2},
>     {application_master,start_it_old,4}]
>
> {"Kernel pid 
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/464dfa9a/attachment.html>

From tiziana.stoesselli at gmail.com  Tue Dec 17 11:36:45 2013
From: tiziana.stoesselli at gmail.com (Tiziana Stoesselli)
Date: Tue, 17 Dec 2013 03:36:45 -0800 (PST)
Subject: [rabbitmq-discuss] rabbit,failure_during_boot
In-Reply-To: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>
References: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>
Message-ID: <661b6321-1b6e-4318-9eea-f566fbe6d7de@googlegroups.com>

On 09/12/2013 15:50, Tiziana Stoesselli wrote:

                      [{rabbit_queue_index,parse_pub_record_body,
                           [<<0,0,0,0,0,0,0,0>>]},
                       {rabbit_queue_index,load_journal_entries,1},


The queue index has ended up with a whole load of zeroes appended to it.

We've seen this happen a few times, usually associated with OS crashes or 
power loss or similar.

We changed the queue index file format to be more resilient to this sort of 
corruption in 3.2.0. I'm not sure if there's anything you can do though if 
you've already got a corrupt file with an older version of RabbitMQ apart 
from reset the node and start again.

Cheers, Simon


Hello Simon,

thank you for the response.
Following you can find my attempt

#rabbitmqctl reset
Resetting node 'Name at zenossoc' ...
Error: unable to connect to node 'Name at zenossoc': nodedown

DIAGNOSTICS
===========

nodes in question: ['Name at zenossoc']

hosts, their running nodes and ports:
- zenossoc: [{rabbitmqctl32151,33034}]

current node details:
- node name: rabbitmqctl32151 at zenossoc
- home dir: /var/lib/rabbitmq
- cookie hash: otG5wqMg04+qfhmRCVkglQ==

[root at zenossoc ~]# rabbitmqctl force_reset
Forcefully resetting node 'Name at zenossoc' ...
Error: unable to connect to node 'Name at zenossoc': nodedown

DIAGNOSTICS
===========

nodes in question: ['Name at zenossoc']

hosts, their running nodes and ports:
- zenossoc: [{rabbitmqctl32189,44438}]

current node details:
- node name: rabbitmqctl32189 at zenossoc
- home dir: /var/lib/rabbitmq
- cookie hash: otG5wqMg04+qfhmRCVkglQ==


any idea?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/6da9e97f/attachment.html>

From tiziana.stoesselli at gmail.com  Tue Dec 17 11:39:49 2013
From: tiziana.stoesselli at gmail.com (Tiziana Stoesselli)
Date: Tue, 17 Dec 2013 12:39:49 +0100
Subject: [rabbitmq-discuss] rabbit,failure_during_boot
In-Reply-To: <52A6E13C.9020702@rabbitmq.com>
References: <956bf50d-9f2a-4875-b03e-01099efe771b@googlegroups.com>
 <52A6E13C.9020702@rabbitmq.com>
Message-ID: <CADnm59x_w3wjwncbvL53R-cnwjc82x6J_sDAEJ9-Ah8eQ-fnmA@mail.gmail.com>

Hello Simon,

thank you for the response.
Following you can find my attempt

#rabbitmqctl reset
Resetting node 'Name at zenossoc' ...
Error: unable to connect to node 'Name at zenossoc': nodedown

DIAGNOSTICS
===========

nodes in question: ['Name at zenossoc']

hosts, their running nodes and ports:
- zenossoc: [{rabbitmqctl32151,33034}]

current node details:
- node name: rabbitmqctl32151 at zenossoc
- home dir: /var/lib/rabbitmq
- cookie hash: otG5wqMg04+qfhmRCVkglQ==

[root at zenossoc ~]# rabbitmqctl force_reset
Forcefully resetting node 'Name at zenossoc' ...
Error: unable to connect to node 'Name at zenossoc': nodedown

DIAGNOSTICS
===========

nodes in question: ['Name at zenossoc']

hosts, their running nodes and ports:
- zenossoc: [{rabbitmqctl32189,44438}]

current node details:
- node name: rabbitmqctl32189 at zenossoc
- home dir: /var/lib/rabbitmq
- cookie hash: otG5wqMg04+qfhmRCVkglQ==


any idea?


2013/12/10 Simon MacMullen <simon at rabbitmq.com>

> On 09/12/2013 15:50, Tiziana Stoesselli wrote:
>
>>                   [{rabbit_queue_index,parse_pub_record_body,
>>                        [<<0,0,0,0,0,0,0,0>>]},
>>                    {rabbit_queue_index,load_journal_entries,1},
>>
>
> The queue index has ended up with a whole load of zeroes appended to it.
>
> We've seen this happen a few times, usually associated with OS crashes or
> power loss or similar.
>
> We changed the queue index file format to be more resilient to this sort
> of corruption in 3.2.0. I'm not sure if there's anything you can do though
> if you've already got a corrupt file with an older version of RabbitMQ
> apart from reset the node and start again.
>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/aac9045d/attachment.html>

From matthias at rabbitmq.com  Wed Dec 18 08:42:31 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 18 Dec 2013 08:42:31 +0000
Subject: [rabbitmq-discuss] Some sort of non-fatal error in RabbitMQ's
 SASL log file - what does it mean?
In-Reply-To: <52B05B9F.4080105@stcorp.no>
References: <52B05B9F.4080105@stcorp.no>
Message-ID: <52B15FF7.4020405@rabbitmq.com>

On 17/12/13 14:11, Armen Michaeli wrote:
> RabbitMQ 3.2.2 Centos 5.10 with kernel 2.6.18, Erlang R12B
>
> =CRASH REPORT==== 17-Dec-2013::13:46:01 ===
>    crasher:
>      pid: <0.145.0>
>      registered_name: rabbit_disk_monitor
>      exception exit: {undef,[{erlang,min,[10000,733636.590592]},

 From http://www.rabbitmq.com/which-erlang.html

<quote>
The minimum version of Erlang required to run the RabbitMQ server is R13B03.
</quote>

Matthias.

From mklishin at gopivotal.com  Wed Dec 18 08:44:34 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Dec 2013 12:44:34 +0400
Subject: [rabbitmq-discuss] Some sort of non-fatal error in RabbitMQ's
	SASL log file - what does it mean?
In-Reply-To: <52B05B9F.4080105@stcorp.no>
References: <52B05B9F.4080105@stcorp.no>
Message-ID: <2B672040-AE19-4EA5-A795-2166D80F136F@rabbitmq.com>

On 17 Dec 2013, at 18:11, Armen Michaeli <michaeli at stcorp.no> wrote:

> Meanwhile, I will try to juggle between different Erlang versions to try to get to the bottom of this, but maybe some of you guys can spot immediately what went wrong here? 

=CRASH REPORT==== 17-Dec-2013::13:46:01 ===
  crasher:
    pid: <0.145.0>
    registered_name: rabbit_disk_monitor
    exception exit: {undef,[{erlang,min,[10000,733636.590592]},

erlang:min is not available in your Erlang release
(which is officially not supported).

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Dec 18 08:45:53 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 18 Dec 2013 12:45:53 +0400
Subject: [rabbitmq-discuss] cannot redeclare exchange with different type
In-Reply-To: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
References: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
Message-ID: <B5B55DCF-2F3C-48B6-B52A-19DB45137340@rabbitmq.com>

On 18 Dec 2013, at 02:01, Roatin Marth <roatin.marth at gmail.com> wrote:

> the logger says I cannot redeclare an exchange with a different type.
> in the management window I can see it is of type fanout. the code is declaring it as fanout.
> I was under the impression exchange_declare was idempotent. is this correct?

This is correct.

To change exchange type or attributes, you need to delete and re-declare the exchange.

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Wed Dec 18 09:53:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Dec 2013 09:53:27 +0000
Subject: [rabbitmq-discuss] 2 Way Federation
In-Reply-To: <CAMcAHLWaKA1eZrQ8kfZX_oD8x6kT3uqv-qpRxPA05Ycp5f1hjg@mail.gmail.com>
References: <59BF56992750434F89F8EBE141E64B1D018382DD@GAALPA1MSGUSR9C.ITServices.sbc.com>
 <CAMcAHLWaKA1eZrQ8kfZX_oD8x6kT3uqv-qpRxPA05Ycp5f1hjg@mail.gmail.com>
Message-ID: <52B17097.2030003@rabbitmq.com>

On 17/12/2013 23:36, Alvaro Videla wrote:
> Hi,
>
> To avoid circular message flows set max-hops = 1. See
> http://www.rabbitmq.com/federation-reference.html

Absolutely. And note that max-hops = 1 is in fact the default for this 
reason.

Cheers, Simon


From simon at rabbitmq.com  Wed Dec 18 10:00:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Dec 2013 10:00:45 +0000
Subject: [rabbitmq-discuss] Publisher confirms requires seperate call to
 get ack?
In-Reply-To: <CAE3HoVSSaCXdTdq7VMTn-22Fz7S2QNNxB+0DbAWmVxyyCZ0zJA@mail.gmail.com>
References: <CAChGYf_RLHti7ZJim+SnGEbspVGY+PM_xOvdUmo=6JmS7gJYNw@mail.gmail.com>
 <CAChGYf8ySwwadyENsyVNquqwLrbx_HZtrxR-gEO8DSmGNb4yBQ@mail.gmail.com>
 <CAE3HoVSSaCXdTdq7VMTn-22Fz7S2QNNxB+0DbAWmVxyyCZ0zJA@mail.gmail.com>
Message-ID: <52B1724D.2060009@rabbitmq.com>

On 18/12/2013 05:53, Michael Klishin wrote:
> It depends on your client library. E.g. in Java, C# and Ruby (Bunny) you
> can publish as many messages
> as you want and then use Channel#waitForConfirms to wait for all
> outstanding confirms to arrive.

You can do so in the Erlang client - either call 
amqp_channel:wait_for_confirms/1 every so often or (better) call 
amqp_channel:register_conform_handler/2 and accept the confirms 
yourself. That's better because every time you call 
amqp_channel:wait_for_confirms/1 the channel comes to a halt until all 
confirms have arrived.

> it doesn't have to be done per message and RabbitMQ pushes confirms to
> you, you do not poll for acknowledgements.

This is the key point. It sounds like the OP is publishing one message, 
waiting for one confirm, publishing the next message, and so on. That's 
an antipattern (at least when you want to go fast) since you can never 
go faster than 1 / (network round trip time) messages per second.

Cheers, Simon


From simon at rabbitmq.com  Wed Dec 18 10:10:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Dec 2013 10:10:05 +0000
Subject: [rabbitmq-discuss] Impact of Updating Queue Parameters on
 Queued Messages
In-Reply-To: <CAO=6ox9rm4_mM8hYrtsQPbQsCrZYRBrGY2=pZmdFEvhpZ=KeSw@mail.gmail.com>
References: <CAO=6ox8hBo4dkpAyNS_c-MmKsX7U0vbMaiU9MbanjBKteZVTgQ@mail.gmail.com>
 <52B0974D.4050108@rabbitmq.com>
 <CAO=6ox98tj7=dqHhKDx09ZFcWWPX2LmUy+28C1a8OcK3ZmyUSg@mail.gmail.com>
 <CAO=6ox9rm4_mM8hYrtsQPbQsCrZYRBrGY2=pZmdFEvhpZ=KeSw@mail.gmail.com>
Message-ID: <52B1747D.60603@rabbitmq.com>

On 17/12/2013 18:55, Richard Raseley wrote:
> Follow-up question:
>
> There doesn't seem to be a lot in the policy documentation about the
> available definitions for (specifically) the DLX policies. Am I correct
> in assuming there is also a 'dead-letter-routing-key' definition that I
> can use for the expected effect?

 From http://www.rabbitmq.com/dlx.html:

"Similarly, an explicit routing key can be specified by adding the key 
"dead-letter-routing-key" to the policy."

So yes :-)

> If yes, is it preferred that these be defined in the same policy or
> separate policies with different priorities?

Only one policy can apply to any queue / exchange, so they need to be in 
the same one.

Cheers, Simon


From simon at rabbitmq.com  Wed Dec 18 10:28:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Dec 2013 10:28:11 +0000
Subject: [rabbitmq-discuss] Best practices for cluster upgrades with
 uninterrupted service
In-Reply-To: <CACLE7iwJr0PFCWuzOtnR9YQ1NoHjsqUMQjGfrYPeWgM_G5_h5Q@mail.gmail.com>
References: <CACLE7iwJr0PFCWuzOtnR9YQ1NoHjsqUMQjGfrYPeWgM_G5_h5Q@mail.gmail.com>
Message-ID: <52B178BB.2070909@rabbitmq.com>

Hi Matt. I think your original plan is reasonable for feature upgrades.

For bugfix upgrades you should be able to cut out some of the steps - in 
particular you do not need to add and remove nodes from the cluster in 
order to upgrade them, you can just take them down and upgrade them one 
at a time while they are still registered in the cluster.

Cheers, Simon

On 09/12/2013 22:42, Matt Pietrek wrote:
> Hey all RabbitMQ devs and experts,
>
> I?m looking for a validation of an approach, or a better suggestion on
> how to accomplish.
>
> The big picture is that we want to improve how we upgrade our clusters
> without interruptions in service. I know RabbitMQ supports running mixed
> versions within a cluster, but for us, upgrade may also mean bringing
> down a node for reconfiguration, an Erlang upgrade, or any other number
> of scenarios.
>
> Today we do controlled switchover of load from one RabbitMQ cluster to
> another, and then switch it back. We use two clusters (a master and an
> alternate). Both clusters are identically configured with two RabbitMQ
> instances, i.e ?master? is node1,node2, and ?alternate? is node3,node4.
>
> All queues are mirrored. We direct traffic to the master or alternate
> via a VIP.
>
> Today our upgrade process looks like this:
>
> --------
>
> * master is operation normally, and pointed to by the VIP.
>
> * Shut down both alternate nodes, upgrade them in whatever manner is
> necessary. Newer version, more ram, whatever.
>
> * Start up alternate cluster, then create the same set of queues on it
> as the master has.
>
> * Redirect the VIP to point to the alternate.
>
> * Clients see a connection drop because of the VIP change, but are
> tolerant and auto-reconnect.
>
> * Copy all queue contents from the master?s queues to the alternate?s
> same-named queues.
>
> * Shut down the master nodes and upgrade them.
>
> * Perform similar steps as above to move the VIP and messages back to
> the master.
>
> --------
>
> While this generally works, there are small but important problems with
> it. One problem is that some of our queues are created/deleted. I have
> seen scenarios where unfortunate timing can cause a queue to not be on
> the right cluster at the right moment.
>
> Looking at newer RabbitMQ features, in particular policy based mirroring
> control, I?m thinking something like this would be better:
>
> -------
>
> * Have node1/node2 running along normally, with the VIP pointing at it.
>
> * Start up node3/node4 in the same cluster
>
> * Use policy to make all queues mirrored by all four nodes. Use
> synch_queue as necessary to force synchronization in a reasonable time
> frame.
>
> * When all queues are synched, remove node1/node2 from the cluster and
> upgrade them.
>
> * Because our VIP is managed by keepalived, either node3 or node4 will
> obtain the VIP when node1/node2 are removed.
>
> --------
>
> The advantage of this is that it eliminates queue location timing
> windows and we don?t have to manually copy messages around. The only
> downside I?m aware of is that it won?t work when upgrading major/minor
> versions. That is, it should be fine from 3.4.3 to 3.4.7, but not 3.4 to
> 3.5. In that case, we'd use our original upgrade logic.
>
> Thoughts? Suggestions? Better ideas?
>
> Thanks,
>
>
> Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From jesper.louis.andersen at erlang-solutions.com  Wed Dec 18 14:15:18 2013
From: jesper.louis.andersen at erlang-solutions.com (Jesper Louis Andersen)
Date: Wed, 18 Dec 2013 15:15:18 +0100
Subject: [rabbitmq-discuss] [PATCH] Make the Erlang RabbitMQ Client shut
	down gracefully
Message-ID: <CAGrdgiXZ_dvgnJbE8ZQZvnNHHLwwDMBmFEWG9YEs39QzWUhuAQ@mail.gmail.com>

Hi RMQ developers,

The following patch changes the behaviour of the RMQ Erlang Client when it
shuts down. It avoids spamming the log with death messages in graceful
closes. Background is below the patch.

Patch:

https://github.com/issuu/amqp_client/commit/2c582c983433027e007b4e80f2c6d9f25d7f854b
https://github.com/issuu/amqp_client/commit/2c582c983433027e007b4e80f2c6d9f25d7f854b.patch

Background:

The RMQ Erlang client holds a supervisor tree which contains processes
running as amqp_gen_consumers where a direct_consumer module has been
injected. A typical user of the client application will have its own
separate supervisor tree. To handle the crash of the client application,
the direct_consumer installs a *monitor* on the ConsumerPid. This allows us
to stop consumption if the consumer process goes away for some reason.

OTP compliant processes will have two kinds of exit reasons which are
graceful: "normal" and "shutdown". The former happens when the ConsumerPid
exits normally. Either by calling exit(normal) or by returning from the
top-level function. The latter happens if the supervisor decides to close
down the tree. It normally sends forth exit(Child, shutdown) in order to
shut down its supervisor children processes. Any other exit reason is a
grace error.

Implementation:

The patch detects the two cases of graceful shutdowns and then proceeds to
silently close the supervision tree on the RabbitMQ side. This stops such
errors from spamming in the logs when the supervisor tree closes down
normally. If other errors occur, we close down the tree like we always
have, yelling and screaming that something is going very wrong.

Review:

The patch has seen some internal testing and looks correct; but as I am not
too well versed in the supervisor tree, and in particular the supervisor2
structure, I might have introduced a leak. Please look closely at the code
with respect to crashing and stopping behaviour in mind. If supervisor2
works anything like supervisor here, it should work.

+++

I hope the RabbitMQ developers will consider this patch for inclusion as it
might help others. It is yours to use and I hereby sign it off as a
RabbitMQ contribution.

Merry Christmas :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/d6c7b29c/attachment.html>

From richard at raseley.com  Wed Dec 18 14:29:22 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 18 Dec 2013 06:29:22 -0800
Subject: [rabbitmq-discuss] Impact of Updating Queue Parameters on
	Queued Messages
In-Reply-To: <52B1747D.60603@rabbitmq.com>
References: <CAO=6ox8hBo4dkpAyNS_c-MmKsX7U0vbMaiU9MbanjBKteZVTgQ@mail.gmail.com>
 <52B0974D.4050108@rabbitmq.com>
 <CAO=6ox98tj7=dqHhKDx09ZFcWWPX2LmUy+28C1a8OcK3ZmyUSg@mail.gmail.com>
 <CAO=6ox9rm4_mM8hYrtsQPbQsCrZYRBrGY2=pZmdFEvhpZ=KeSw@mail.gmail.com>
 <52B1747D.60603@rabbitmq.com>
Message-ID: <CAO=6ox-ucFjQneOWG+-WC64L_WT9WFTRLQpaJhmCSwZ=P_ryqw@mail.gmail.com>

Wow, that's egg on my face. Not sure how I missed that one.

Thanks for your replies.

Regards,

Richard
On Dec 18, 2013 2:10 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

> On 17/12/2013 18:55, Richard Raseley wrote:
>
>> Follow-up question:
>>
>> There doesn't seem to be a lot in the policy documentation about the
>> available definitions for (specifically) the DLX policies. Am I correct
>> in assuming there is also a 'dead-letter-routing-key' definition that I
>> can use for the expected effect?
>>
>
> From http://www.rabbitmq.com/dlx.html:
>
> "Similarly, an explicit routing key can be specified by adding the key
> "dead-letter-routing-key" to the policy."
>
> So yes :-)
>
>  If yes, is it preferred that these be defined in the same policy or
>> separate policies with different priorities?
>>
>
> Only one policy can apply to any queue / exchange, so they need to be in
> the same one.
>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/413efd68/attachment.html>

From shridharan.m at gmail.com  Wed Dec 18 17:11:13 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Wed, 18 Dec 2013 09:11:13 -0800
Subject: [rabbitmq-discuss] Blocked/blocking connections & Memory
	fluctuations
Message-ID: <CAPK6OeuqpsPWSkJBrzqinxj3uRypWYHX+r1fsfpVTins+Wr6dg@mail.gmail.com>

Hi there,

   I am noticing couple of issues in our rabbit cluster (of 2 nodes).

   1. I notice a lot of blocked and blocking connections in the management
   admin UI but "rabbitmqctl list_connections" is not showing any blocked or
   blocking connections. These connections are living over a day and since we
   use php in our application layer, none of these connections should not live
   more than 5 mins. Whats strange is that this symptom is noticed in only one
   of the nodes of the cluster.
   2. Memory doubles once in a few seconds on same node of the cluster. May
   be GC is kicking in? Not sure whether it could relate to the
   blocked/blocking connections. Since this node didn't hit memory watermark
   level, logs doesn't have any warning/errors.

[image: Inline image 1]
    I am thinking about restarting the node and putting it back in the
cluster to see whether this goes away but I would like to understand what
is going on. Any help is appreciated.

    On a related note, I have a question about redistributing queues after
maintanence. For a cluster with 2 nodes (node 1 & node 2) with mirroring,
lets say out of 12 queues, 6 lives in node 1 (as master) and other 6 lives
in node 2.  For maintenance reasons, if I take node 2 down and put it back
in the cluster, all queues will live node 1 at this point. Is there any way
to redistribute the queues among these 2 nodes in this case to move 6
queues back to node 2?


Thanks,
Shri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/969c6dc1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen Shot 2013-12-18 at 8.30.33 AM.png
Type: image/png
Size: 29267 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/969c6dc1/attachment.png>

From mike at meshfire.com  Wed Dec 18 18:33:16 2013
From: mike at meshfire.com (MikeTempleman)
Date: Wed, 18 Dec 2013 10:33:16 -0800 (PST)
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <CAMcAHLWS+utJDFEaXQK-DUKK0yugE1Q9rDSjG+A9xAaQRQb=TQ@mail.gmail.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
 <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
 <CALdW9BwnLs_je13zg_4WBd-6NKemZDXry+sNXPV7ut8P=7hahw@mail.gmail.com>
 <CAMcAHLWS+utJDFEaXQK-DUKK0yugE1Q9rDSjG+A9xAaQRQb=TQ@mail.gmail.com>
Message-ID: <CALdW9BxGy+XnS_LwL91jpR2Hw_618XoDeYn=D+Cxqy5fdZuPqA@mail.gmail.com>

Well, multi-ack didn't help very much. We can see some, but not enough to
matter.

We cannot use auto-ack because consumers (multiple/server) die unexpectedly
as the app servers are autoscaled. We have not built a fully separated
service yet (too hard to debug on development machines right now). But
could Publisher confirms resolve the issue of servers dying with n messages
in their prefetch buffers?



-- 

*Mike Templeman*
*Head of Development*

T: @talkingfrog1950 <http://twitter.com/missdestructo>
T: @Meshfire <http://twitter.com/meshfire>



On Sun, Dec 15, 2013 at 5:02 AM, Alvaro Videla-2 [via RabbitMQ] <
ml-node+s1065348n32095h82 at n5.nabble.com> wrote:

> Hi Mike,
>
> Yes, RabbitMQ queues are designed for fast delivery of messages and for
> being as empty as possible, as that blog post explains.
>
> Another interesting blog post, about consumer strategies and basic.qos
> settings is this one:
> http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/#more-276
>
> re multi ack: yes, that might help.
>
> Regards,
>
> Alvaro
>
>
> On Sat, Dec 14, 2013 at 2:15 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32095&i=0>
> > wrote:
>
>> I realized that was a bad interpretation. Sorry. The exchange is just
>> successfully routing all the messages to the target queues.
>>
>> After reading a number of posts and this blog entry (
>> http://www.rabbitmq.com/blog/2011/09/24/sizing-your-rabbits/) I wonder
>> if the issue is that each message is ack'd. It seemed that the issue
>> occurred when I had a large backlog in the queues. When Rabbit is empty,
>> performance is fine. When the consumers tried to run at much higher speeds,
>> we encountered this cycling.
>>
>> We have run a brief test with no-ack, not on production, and the
>> performance is excellent even under load. But this is not a viable solution
>> (appservers crash, autoscaling shuts servers down that have prefetched
>> messages and are still connected to rabbit) without a full redesign.
>>
>> Assuming each queue is only one thread (I assume it handles both receipt,
>> delivery, and ack cleanup) then I can understand what might happen when the
>> consumers generate ~500 acks/s while new messages are coming in at a low
>> 50-100/s rate on a specific queue. I will move out some events that tend to
>> generate peaks into their own queue and accept that queue processing more
>> slowly. As for separating the real worker queue, I suppose I could create 2
>> or so static queues to divide the load up.
>>
>> So what I think I can do is:
>> 1. bump the default tcp buffer from 128KB to around 10MB. The added
>> buffering may help a little
>> 2. see if I can find out how to set the multiple ack flag. We are using
>> Grails so maybe that is just creating a custom bean. I don't know
>> 3. create a couple of queues for lower-priority events specifically
>> events chosen to be less time critical.
>> 4. if all that doesn't work then probably create 4 queues for the high
>> priority events, randomly publish to those queues, and put consumers for
>> each queue.
>> 5. Also, upgrade the server to the latest version.
>>
>> Mike Templeman
>>
>> --
>>
>> *Mike Templeman*
>> *Head of Development*
>>
>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>> T: @Meshfire <http://twitter.com/meshfire>
>>
>>
>>
>> On Fri, Dec 13, 2013 at 1:42 PM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=0>
>> > wrote:
>>
>>> I noticed something else very odd.
>>>
>>> Currently, one queue has 43,000 messages backed up in its queue. But
>>> when I look at the exchange (there is only one exchange) I see that the
>>> message rate in exactly matches the message rate out.
>>>
>>> With such a huge backlog, why would that be? I would have thought that
>>> the consumers (there are 16 total distributed across 4 systems for that
>>> queue with a prefetch of 100) would run at a much higher steady state.
>>>
>>> This exchange also seems to cycle regularly. It appears to run from a
>>> low of around 60/s in and out to 500+ a second in and out.
>>>
>>>  --
>>>
>>> *Mike Templeman*
>>> *Head of Development*
>>>
>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>> T: @Meshfire <http://twitter.com/meshfire>
>>>
>>>
>>>
>>> On Fri, Dec 13, 2013 at 10:40 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=1>
>>> > wrote:
>>>
>>>> Also, from observing the Connections screen on the web UI shows that
>>>> no flow control has been recently turned on for any of the four current
>>>> connections (four app servers).
>>>>
>>>> --
>>>>
>>>> *Mike Templeman *
>>>> *Head of Development*
>>>>
>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>
>>>>
>>>>
>>>> On Fri, Dec 13, 2013 at 10:17 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=2>
>>>> > wrote:
>>>>
>>>>> Hi Alvaro
>>>>>
>>>>> I would be more than happy to provide logs. But all they have in them
>>>>> is connection and shutdown information. Nothing more. I have just enabled
>>>>> tracing on the vhost and will send the logs shortly. We encounter this
>>>>> issue when under load every day now.
>>>>>
>>>>> Let me tell you our architecture and deployment:
>>>>>
>>>>> rabbitMQ:
>>>>>
>>>>>    - m1.large ec2 instance. Version: RabbitMQ 3.1.5,  Erlang R14B04
>>>>>    - 23 queues (transaction and direct)
>>>>>    - 3 exchanges used, two fanout and one topic exchange
>>>>>    - topic exchange
>>>>>    - Topic exchange overview is attached.
>>>>>    - 46 total channels.
>>>>>
>>>>>
>>>>> AppServers
>>>>>
>>>>>    - m1.large tomcat servers running grails application
>>>>>    - 2-7 servers at any one time.
>>>>>    - Consume + publish
>>>>>    - On busy queues, each server has 16 consumers with prefetch at 100
>>>>>    - message sizes on busy queues are ~4KB.
>>>>>    - publishing rates on busiest queue ranges from 16/s to >100/s.
>>>>>    (We need to be able to support 1000/s).
>>>>>
>>>>>
>>>>> Each AppServer connects to a sharded mongodb cluster of 3 shards. Our
>>>>> first suspicion was that something in Mongo or AWS was causing the periodic
>>>>> delay but AWS techs looked into our volume use and said we were only use
>>>>> 25% of available bandwidth.
>>>>>
>>>>> At this moment, we have a modest publish rate (~50-60/s) but a backlog
>>>>> of 50,000 messages for the queue "user". You can see a 10 minute snapshot
>>>>> of the queue and see the cycling.
>>>>>
>>>>> I turned on tracing but the results don't seem to becoming into the
>>>>> log. Is there another way to enable reporting of flow control?
>>>>>
>>>>> Mike Templeman
>>>>>
>>>>>
>>>>>  --
>>>>>
>>>>> *Mike Templeman*
>>>>> *Head of Development*
>>>>>
>>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>>
>>>>>
>>>>>
>>>>> On Fri, Dec 13, 2013 at 6:03 AM, Alvaro Videla-2 [via RabbitMQ] <[hidden
>>>>> email] <http://user/SendEmail.jtp?type=node&node=32089&i=3>> wrote:
>>>>>
>>>>>> Mike,
>>>>>>
>>>>>> Would you be able to provide information more information to help us
>>>>>> debug the problem?
>>>>>>
>>>>>> Tim (from the rabbitmq team) requested more info in order to try to
>>>>>> find answers for this.
>>>>>>
>>>>>> For example, when consumption drops to zero, are there any logs on
>>>>>> the
>>>>>> rabbitmq server that might tell of a flow control mechanism being
>>>>>> activated?
>>>>>>
>>>>>> Regards,
>>>>>>
>>>>>> Alvaro
>>>>>>
>>>>>>
>>>>>> On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=0>>
>>>>>> wrote:
>>>>>>
>>>>>> > Tyson
>>>>>> >
>>>>>> > Did you ever find an answer to this question? We are encountering
>>>>>> virtually
>>>>>> > the exact same problem.
>>>>>> >
>>>>>> > We have a variable number of servers setup as producers and
>>>>>> consumers and
>>>>>> > see our throughput drop to zero on a periodic basis. This is most
>>>>>> severe
>>>>>> > when there are a few hundred thousand messages on rabbit.
>>>>>> >
>>>>>> > Did you just drop Rabbit? Ours is running on an m1.large instance
>>>>>> with RAID0
>>>>>> > ephemeral drives, so size and performance of the disk subsystem is
>>>>>> not an
>>>>>> > issue (we are still in beta). We have spent untold hours tuning our
>>>>>> sharded
>>>>>> > mongodb subsystem only to find out that it is only being 25%
>>>>>> utilized (at
>>>>>> > least it will be blazing fast if we ever figure this out).
>>>>>> >
>>>>>> >
>>>>>> >
>>>>>> >
>>>>>> >
>>>>>> > --
>>>>>> > View this message in context:
>>>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
>>>>>> > Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>>>> > _______________________________________________
>>>>>> > rabbitmq-discuss mailing list
>>>>>> > [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=1>
>>>>>> >
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=2>
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>
>>>>>>
>>>>>> ------------------------------
>>>>>>  If you reply to this email, your message will be added to the
>>>>>> discussion below:
>>>>>>
>>>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32063.html
>>>>>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>>>>>> here.
>>>>>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>>>>>
>>>>>
>>>>>
>>>>
>>>
>>
>> ------------------------------
>> View this message in context: Re: Lower delivery rate than publish rate
>> - why?<http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32089.html>
>>  Sent from the RabbitMQ mailing list archive<http://rabbitmq.1065348.n5.nabble.com/>at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32095&i=1>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=32095&i=2>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32095.html
>  To unsubscribe from Lower delivery rate than publish rate - why?, click
> here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=29247&code=bWlrZUBtZXNoZmlyZS5jb218MjkyNDd8MTYzNTUyMDM4MA==>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32205.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/a38d800c/attachment.html>

From peter.moon at vce.com  Wed Dec 18 20:12:22 2013
From: peter.moon at vce.com (Peter Moon)
Date: Wed, 18 Dec 2013 12:12:22 -0800 (PST)
Subject: [rabbitmq-discuss] Ability to log module & timestamp in startup and
	shutdown_log
Message-ID: <1387397542306-32206.post@n5.nabble.com>

I am looking for a way to log internally in these files.
Specifically I want the module and timestamp in the log file.. 
I have found the following link - it seems that closest options are log
level? 

http://www.rabbitmq.com/configure.html
Is there a better option? 

thanks

Peter



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Ability-to-log-module-timestamp-in-startup-and-shutdown-log-tp32206.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jesper.louis.andersen at gmail.com  Wed Dec 18 21:56:52 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Wed, 18 Dec 2013 22:56:52 +0100
Subject: [rabbitmq-discuss] Fwd: [PATCH] Make the Erlang RabbitMQ Client
	shut down gracefully
In-Reply-To: <CAGrdgiXZ_dvgnJbE8ZQZvnNHHLwwDMBmFEWG9YEs39QzWUhuAQ@mail.gmail.com>
References: <CAGrdgiXZ_dvgnJbE8ZQZvnNHHLwwDMBmFEWG9YEs39QzWUhuAQ@mail.gmail.com>
Message-ID: <CAGrdgiUjavsQW9yU8CcdPqnJ+G2GR-JUsnft830a4Orr+Gut7Q@mail.gmail.com>

Resending this to avoid the spam filter. It patches rmqs Erlang client to
spam way less.
---------- Forwarded message ----------
From: "Jesper Louis Andersen" <jesper.louis.andersen at erlang-solutions.com>
Date: Dec 18, 2013 3:15 PM
Subject: [PATCH] Make the Erlang RabbitMQ Client shut down gracefully
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc:

Hi RMQ developers,

The following patch changes the behaviour of the RMQ Erlang Client when it
shuts down. It avoids spamming the log with death messages in graceful
closes. Background is below the patch.

Patch:

https://github.com/issuu/amqp_client/commit/2c582c983433027e007b4e80f2c6d9f25d7f854b
https://github.com/issuu/amqp_client/commit/2c582c983433027e007b4e80f2c6d9f25d7f854b.patch

Background:

The RMQ Erlang client holds a supervisor tree which contains processes
running as amqp_gen_consumers where a direct_consumer module has been
injected. A typical user of the client application will have its own
separate supervisor tree. To handle the crash of the client application,
the direct_consumer installs a *monitor* on the ConsumerPid. This allows us
to stop consumption if the consumer process goes away for some reason.

OTP compliant processes will have two kinds of exit reasons which are
graceful: "normal" and "shutdown". The former happens when the ConsumerPid
exits normally. Either by calling exit(normal) or by returning from the
top-level function. The latter happens if the supervisor decides to close
down the tree. It normally sends forth exit(Child, shutdown) in order to
shut down its supervisor children processes. Any other exit reason is a
grace error.

Implementation:

The patch detects the two cases of graceful shutdowns and then proceeds to
silently close the supervision tree on the RabbitMQ side. This stops such
errors from spamming in the logs when the supervisor tree closes down
normally. If other errors occur, we close down the tree like we always
have, yelling and screaming that something is going very wrong.

Review:

The patch has seen some internal testing and looks correct; but as I am not
too well versed in the supervisor tree, and in particular the supervisor2
structure, I might have introduced a leak. Please look closely at the code
with respect to crashing and stopping behaviour in mind. If supervisor2
works anything like supervisor here, it should work.

+++

I hope the RabbitMQ developers will consider this patch for inclusion as it
might help others. It is yours to use and I hereby sign it off as a
RabbitMQ contribution.

Merry Christmas :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/9915bb66/attachment.html>

From goyalk at vmware.com  Wed Dec 18 23:31:36 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Wed, 18 Dec 2013 15:31:36 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.1.5 crashed
In-Reply-To: <52B0380B.5070707@rabbitmq.com>
References: <721958228.7735376.1387237031361.JavaMail.root@vmware.com>
 <52B0380B.5070707@rabbitmq.com>
Message-ID: <1610035414.8293896.1387409496536.JavaMail.root@vmware.com>

Thanks Simon,

I am attaching more logs (zipped) from that day.

Crash dump is available at http://goo.gl/iB5Z8Y.

Thanks
Kapil

----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "Kapil Goyal" <goyalk at vmware.com>
Sent: Tuesday, December 17, 2013 3:39:55 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.5 crashed

So what I see from the logs is that a connection crashed since it 
received connection.close and then found that the TCP connection was 
already closed when it tried to send connection.close-ok in response.

That then caused the queue collector for that connection (component 
which deletes exclusive queues when a connection closes) to crash.

So that's some noise in the logs, I think that could be handled better - 
but I don't see anything there that would amount to the server itself 
crashing. Can you post complete logs somewhere? Probably more useful 
than the crash dump.

Cheers, Simon

On 16/12/2013 23:37, Kapil Goyal wrote:
> Hi,
>
> A rabbitmq server in one of our setups crashed recently. Can you please
> take a look at the attached rabbit and rabbit-sasl logs and help me
> understand the issue?
>
> The logs attached start from around a minute before and until the crash.
>
> I also have a 17M crash dump file. If you'd like to look at it, can I
> send it as an email attachment or you'd prefer another way?
>
>
> Thanks
> Kapil
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=JF6BIRiITniYYZhbhzlgNvj%2FeB0%2BYbRBSr0f8NG91qs%3D%0A&m=Z6q%2FpZ9j4Nys6NUpFt3IweKfXsGwzUAXjgvVXmGatz4%3D%0A&s=a92d49282fa22b791fd4ee337e0d46e8d8dc9bea47f5729bd1d35a2305a2a117
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at localhost.log.gz
Type: application/x-gzip
Size: 368867 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/93cf6d18/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at localhost-sasl.log.gz
Type: application/x-gzip
Size: 154730 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/93cf6d18/attachment-0001.bin>

From gavinmroy at gmail.com  Thu Dec 19 00:05:02 2013
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Wed, 18 Dec 2013 19:05:02 -0500
Subject: [rabbitmq-discuss] Connection.Blocked triggering?
Message-ID: <etPan.52b2382e.74b0dc51.58f@gmr-home.local>

At what point should Connection.Block be sent from RabbitMQ to a client application? I am able to see that I am triggering a Flow state in the RabbitMQ management UI but am not seeing any Connection.Block frames delivered to the client.

Thanks in advance,

Gavin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/b96f6d75/attachment.html>

From sid.young at gmail.com  Thu Dec 19 00:20:09 2013
From: sid.young at gmail.com (Sid Young)
Date: Wed, 18 Dec 2013 16:20:09 -0800 (PST)
Subject: [rabbitmq-discuss] cannot redeclare exchange with different type
In-Reply-To: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
References: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
Message-ID: <d3f7ac24-6cb2-48b9-a7c8-0041d2017752@googlegroups.com>


I have been exploring fanout exchanges for a few nights as part of a stock 
graphing system I'm writing and in the process of recreating the exchange 
numerous times via my c++ programs, it appears once created, you need to 
delete it before redefining it as a different type.

Sid




On Wednesday, December 18, 2013 8:01:18 AM UTC+10, Roatin Marth wrote:
>
> g'day folks,
>
> just been rummaging through the rabbit mq tutorials and got myself stuck 
> in a slight rut.
>
> i'm perusing the pub/sub example in python on windows. 
> i've declared an exchange, and having run the script, I can see it's been 
> created through the management console,
> but I keep getting an exception as soon as I run either the producer or 
> the consumer app.
>
> if I comment out the exchange_declare line, all is well.
>
> the logger says I cannot redeclare an exchange with a different type.
> in the management window I can see it is of type fanout. the code is 
> declaring it as fanout.
> I was under the impression exchange_declare was idempotent. is this 
> correct?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/14eeaf58/attachment.html>

From videlalvaro at gmail.com  Thu Dec 19 00:28:45 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Dec 2013 01:28:45 +0100
Subject: [rabbitmq-discuss] cannot redeclare exchange with different type
In-Reply-To: <d3f7ac24-6cb2-48b9-a7c8-0041d2017752@googlegroups.com>
References: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
 <d3f7ac24-6cb2-48b9-a7c8-0041d2017752@googlegroups.com>
Message-ID: <CAMcAHLXc-ht6cF8Lmj37X5bwAihNzSt0heQF2xZSq-nNXKqCWA@mail.gmail.com>

Sid,

Yes, to change queues and exchange parameters/types you need to delete
them and redeclare them.

Regards,

Alvaro

On Thu, Dec 19, 2013 at 1:20 AM, Sid Young <sid.young at gmail.com> wrote:
>
> I have been exploring fanout exchanges for a few nights as part of a stock
> graphing system I'm writing and in the process of recreating the exchange
> numerous times via my c++ programs, it appears once created, you need to
> delete it before redefining it as a different type.
>
> Sid
>
>
>
>
> On Wednesday, December 18, 2013 8:01:18 AM UTC+10, Roatin Marth wrote:
>>
>> g'day folks,
>>
>> just been rummaging through the rabbit mq tutorials and got myself stuck
>> in a slight rut.
>>
>> i'm perusing the pub/sub example in python on windows.
>> i've declared an exchange, and having run the script, I can see it's been
>> created through the management console,
>> but I keep getting an exception as soon as I run either the producer or
>> the consumer app.
>>
>> if I comment out the exchange_declare line, all is well.
>>
>> the logger says I cannot redeclare an exchange with a different type.
>> in the management window I can see it is of type fanout. the code is
>> declaring it as fanout.
>> I was under the impression exchange_declare was idempotent. is this
>> correct?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From gavinmroy at gmail.com  Thu Dec 19 03:23:01 2013
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Wed, 18 Dec 2013 22:23:01 -0500
Subject: [rabbitmq-discuss] rabbitpy 0.12.0 Released
Message-ID: <etPan.52b26695.625558ec.58f@gmr-home.local>

I am pleased to announce the availability of rabbitpy 0.12 on the Python Package Index:

	https://preview-pypi.python.org/project/rabbitpy/

rabbitpy is a pure python, thread-safe, minimalistic and pythonic BSD Licensed AMQP/RabbitMQ library that supports Python 2.6, 2.7 and 3.3. rabbitpy aims to provide a simple and easy to use API for interfacing with RabbitMQ, minimizing the programming overhead often found in other libraries.

For example, consuming messages can be as simple as (connecting to localhost:5672 / as guest by default)

? ? for msg in rabbitpy.consume(queue='test', no_ack=True):
? ? ? ? msg.pprint(True)

Documentation is available at?https://rabbitpy.readthedocs.org/en/latest/

Recent versions of rabbitpy have focused on performance improvements and reducing CPU overhead.

All users of rmqid or rabbitpy are encouraged to update to the latest version using pip:

? ? pip install ?upgrade rabbitpy

rabbitpy is available on GitHub at?https://github.com/gmr/rabbitpy?and is BSD licensed.

Please report any issues at?https://github.com/gmr/rabbitpy/issues

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/7e069c2f/attachment.html>

From Petr.Gotthard at Honeywell.com  Thu Dec 19 08:05:51 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 19 Dec 2013 08:05:51 +0000
Subject: [rabbitmq-discuss] Running RabbitMQ with little RAM
Message-ID: <F9E85480F62349458DF67CE8BA000D8D3FC227B0@FR44EX3005.global.ds.honeywell.com>

Hello,

Did anyone try to run RabbitMQ in an embedded / very memory constrained environment? Currently we run Rabbit nicely at a  512MB machine, but we would like to downgrade to far less RAM. What is the world record for smallest RabbitMQ installation? Did anyone tried e.g. 64MB?

I've seen Erlang-mini that claims to fit into 20MB. If we reduce the prefetch and use very small messages, could 48-64MB RAM be a realistic  number?
http://www.erlang-embedded.com/2013/09/new-erlang-package-for-small-devices-erlang-mini/

Thanks,
Petr
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/e403e910/attachment.html>

From tim at rabbitmq.com  Thu Dec 19 08:25:21 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 19 Dec 2013 08:25:21 +0000
Subject: [rabbitmq-discuss] Connection.Blocked triggering?
In-Reply-To: <etPan.52b2382e.74b0dc51.58f@gmr-home.local>
References: <etPan.52b2382e.74b0dc51.58f@gmr-home.local>
Message-ID: <0E2803BA-EB74-4F80-86C0-9BF4A22B58D9@rabbitmq.com>

AFAIK Rabbit hasn't sent connection.block to clients for quite some time. Instead, we introduce flow control in the broker through TCP back-pressure (i.e., not reading from producer's sockets). That is why you can see the connection in a flow state in the UI (because server-side flow control is in effect), but no connection.block is delivered to the client.

Cheers,
Tim

On 19 Dec 2013, at 00:05, Gavin M. Roy wrote:

> At what point should Connection.Block be sent from RabbitMQ to a client application? I am able to see that I am triggering a Flow state in the RabbitMQ management UI but am not seeing any Connection.Block frames delivered to the client.
> 
> Thanks in advance,
> 
> Gavin
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/520094f0/attachment.html>

From tim at rabbitmq.com  Thu Dec 19 09:10:36 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 19 Dec 2013 09:10:36 +0000
Subject: [rabbitmq-discuss] Connection.Blocked triggering?
In-Reply-To: <0E2803BA-EB74-4F80-86C0-9BF4A22B58D9@rabbitmq.com>
References: <etPan.52b2382e.74b0dc51.58f@gmr-home.local>
 <0E2803BA-EB74-4F80-86C0-9BF4A22B58D9@rabbitmq.com>
Message-ID: <D2E0AA4B-818C-4134-9478-E4D5ECFB6DBB@rabbitmq.com>

Sorry Gavin, I was getting confused between channel.flow and connection.blocked there. Someone pointed out that you're talking about http://www.rabbitmq.com/connection-blocked.html - duh! I suspect however, that just because you've managed to get a publisher subject to flow control, doesn't necessarily mean that you've actually triggered a resource alarm such that connection.blocked will be sent. Producers can (and do) enter flow control if the broker/queue cannot keep up with publishing rates, but only when a low memory or disk alarm is trigger will the connection.blocked signal be sent.

Hope that makes sense and sorry for misunderstanding the question.

Cheers,
Tim

On 19 Dec 2013, at 08:25, Tim Watson wrote:

> AFAIK Rabbit hasn't sent connection.block to clients for quite some time. Instead, we introduce flow control in the broker through TCP back-pressure (i.e., not reading from producer's sockets). That is why you can see the connection in a flow state in the UI (because server-side flow control is in effect), but no connection.block is delivered to the client.
> 
> Cheers,
> Tim
> 
> On 19 Dec 2013, at 00:05, Gavin M. Roy wrote:
> 
>> At what point should Connection.Block be sent from RabbitMQ to a client application? I am able to see that I am triggering a Flow state in the RabbitMQ management UI but am not seeing any Connection.Block frames delivered to the client.
>> 
>> Thanks in advance,
>> 
>> Gavin
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/f2e49d27/attachment.html>

From mnibeck at gmail.com  Thu Dec 19 01:31:49 2013
From: mnibeck at gmail.com (Mike Nibeck)
Date: Wed, 18 Dec 2013 17:31:49 -0800 (PST)
Subject: [rabbitmq-discuss] Recommended queue architecture
Message-ID: <3a664e85-2a08-400e-9292-47b6ff942b4b@googlegroups.com>

Scenario: Order processing system. Orders can contain multiple children 
objects (items, addresses, customer, etc.) We place messages on a queue 
when any elements of an order gets modified. We want to be able to 
correlate all of the messages into a single message "Order Updated", with 
the details of what got updated. The individual edits can come in at any 
time, and not necessarily all of the edits for given order will be 
processed at the same time.

In this scenario, I feel that we ned to somehow persist all of these 
messages and then do some sort of data analysis and group all of the 
related messages for a specific order. Can any of this aggregation occur 
within the queuing system, or will we need to persist these messages in 
another data store (DB) and process on a schedule?

_mike

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131218/0d785062/attachment.html>

From animesh.routh at hcl.com  Thu Dec 19 03:23:48 2013
From: animesh.routh at hcl.com (Animesh Routh - HCLI)
Date: Thu, 19 Dec 2013 03:23:48 +0000
Subject: [rabbitmq-discuss] please provice snmp MIB file for monitoring
	RabbitMQ
Message-ID: <5E87E4D02854184A9C1109F9E906FEAC745AB33F@NDA-ASST-MBS04.ASSOCIATES.CORP.HCL.IN>

Hi,

Please provide us the snmp MIB file for monitoring rabbitmq application monitoring.

Regards,

Animesh Routh
Sr. Consultant
HCL Infotech Ltd.
(A subsidiary of HCL INFOSYSTEMS LTD.)
UIDAI Technology Center,Level 1, Block B, Salarpuria Touchstone,
Marthahalli-Sarjapura Outer Ring Road, Bangalore -560087
Mob: +91-9986509069
www.hclinfotech.in<http://www.hclinfotech.in/>
www.hclinfosystems.com<http://www.hclinfosystems.com/>
[Fact_File_d8]



::DISCLAIMER::
----------------------------------------------------------------------------------------------------------------------------------------------------

The contents of this e-mail and any attachment(s) are confidential and intended for the named recipient(s) only.
E-mail transmission is not guaranteed to be secure or error-free as information could be intercepted, corrupted,
lost, destroyed, arrive late or incomplete, or may contain viruses in transmission. The e mail and its contents
(with or without referred errors) shall therefore not attach any liability on the originator or HCL or its affiliates.
Views or opinions, if any, presented in this email are solely those of the author and may not necessarily reflect the
views or opinions of HCL or its affiliates. Any form of reproduction, dissemination, copying, disclosure, modification,
distribution and / or publication of this message without the prior written consent of authorized representative of
HCL is strictly prohibited. If you have received this email in error please delete it and notify the sender immediately.
Before opening any email and/or attachments, please check them for viruses and other defects.

----------------------------------------------------------------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/58471466/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 2940 bytes
Desc: image001.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/58471466/attachment.jpg>

From simon at rabbitmq.com  Thu Dec 19 10:48:09 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 10:48:09 +0000
Subject: [rabbitmq-discuss] Running RabbitMQ with little RAM
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D3FC227B0@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D3FC227B0@FR44EX3005.global.ds.honeywell.com>
Message-ID: <52B2CEE9.9020502@rabbitmq.com>

On 19/12/13 08:05, Gotthard, Petr wrote:
> Hello,
>
> Did anyone try to run RabbitMQ in an embedded / very memory constrained
> environment? Currently we run Rabbit nicely at a  512MB machine, but we
> would like to downgrade to far less RAM. What is the world record for
> smallest RabbitMQ installation? Did anyone tried e.g. 64MB?
>
> I?ve seen Erlang-mini that claims to fit into 20MB. If we reduce the
> prefetch and use very small messages, could 48-64MB RAM be a realistic
> number?

The Erlang mini claim is for disk space BTW.

I don't have any real world experience trying to make RabbitMQ fit into 
a small memory footprint, but here are some observations:

You can certainly get an idle rabbit to fit into < 32MB memory. To 
squeeze out the last few MB you should disable all plugins, reduce the 
maximum number of Erlang processes by modifying SERVER_ERL_ARGS to take 
out the '+P 1048576' attribute, and reduce the ulimit to a reasonably 
small number.

A lightly loaded rabbit will use little more than that. But heavily 
loading the server will lead to memory usage reaching for the sky fairly 
quickly.

Hopefully others have more real world experience...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Dec 19 10:49:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 10:49:21 +0000
Subject: [rabbitmq-discuss] Fwd: [PATCH] Make the Erlang RabbitMQ Client
 shut down gracefully
In-Reply-To: <CAGrdgiUjavsQW9yU8CcdPqnJ+G2GR-JUsnft830a4Orr+Gut7Q@mail.gmail.com>
References: <CAGrdgiXZ_dvgnJbE8ZQZvnNHHLwwDMBmFEWG9YEs39QzWUhuAQ@mail.gmail.com>
 <CAGrdgiUjavsQW9yU8CcdPqnJ+G2GR-JUsnft830a4Orr+Gut7Q@mail.gmail.com>
Message-ID: <52B2CF31.1040403@rabbitmq.com>

Thanks for the patch (it may not get looked at until 2014 now though...)

I don't think the original mail was filtered BTW - what made you think 
it was?

Cheers, Simon

On 18/12/13 21:56, Jesper Louis Andersen wrote:
> Resending this to avoid the spam filter. It patches rmqs Erlang client
> to spam way less.
>
> ---------- Forwarded message ----------
> From: "Jesper Louis Andersen"
> <jesper.louis.andersen at erlang-solutions.com
> <mailto:jesper.louis.andersen at erlang-solutions.com>>
> Date: Dec 18, 2013 3:15 PM
> Subject: [PATCH] Make the Erlang RabbitMQ Client shut down gracefully
> To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
> Cc:
>
> Hi RMQ developers,
>
> The following patch changes the behaviour of the RMQ Erlang Client when
> it shuts down. It avoids spamming the log with death messages in
> graceful closes. Background is below the patch.
>
> Patch:
>
> https://github.com/issuu/amqp_client/commit/2c582c983433027e007b4e80f2c6d9f25d7f854b
> https://github.com/issuu/amqp_client/commit/2c582c983433027e007b4e80f2c6d9f25d7f854b.patch
>
> Background:
>
> The RMQ Erlang client holds a supervisor tree which contains processes
> running as amqp_gen_consumers where a direct_consumer module has been
> injected. A typical user of the client application will have its own
> separate supervisor tree. To handle the crash of the client application,
> the direct_consumer installs a *monitor* on the ConsumerPid. This allows
> us to stop consumption if the consumer process goes away for some reason.
>
> OTP compliant processes will have two kinds of exit reasons which are
> graceful: "normal" and "shutdown". The former happens when the
> ConsumerPid exits normally. Either by calling exit(normal) or by
> returning from the top-level function. The latter happens if the
> supervisor decides to close down the tree. It normally sends forth
> exit(Child, shutdown) in order to shut down its supervisor children
> processes. Any other exit reason is a grace error.
>
> Implementation:
>
> The patch detects the two cases of graceful shutdowns and then proceeds
> to silently close the supervision tree on the RabbitMQ side. This stops
> such errors from spamming in the logs when the supervisor tree closes
> down normally. If other errors occur, we close down the tree like we
> always have, yelling and screaming that something is going very wrong.
>
> Review:
>
> The patch has seen some internal testing and looks correct; but as I am
> not too well versed in the supervisor tree, and in particular the
> supervisor2 structure, I might have introduced a leak. Please look
> closely at the code with respect to crashing and stopping behaviour in
> mind. If supervisor2 works anything like supervisor here, it should work.
>
> +++
>
> I hope the RabbitMQ developers will consider this patch for inclusion as
> it might help others. It is yours to use and I hereby sign it off as a
> RabbitMQ contribution.
>
> Merry Christmas :)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Dec 19 10:51:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 10:51:14 +0000
Subject: [rabbitmq-discuss] Ability to log module & timestamp in startup
 and shutdown_log
In-Reply-To: <1387397542306-32206.post@n5.nabble.com>
References: <1387397542306-32206.post@n5.nabble.com>
Message-ID: <52B2CFA2.4050405@rabbitmq.com>

On 18/12/13 20:12, Peter Moon wrote:
> I am looking for a way to log internally in these files.
> Specifically I want the module and timestamp in the log file..
> I have found the following link - it seems that closest options are log
> level?
>
> http://www.rabbitmq.com/configure.html
> Is there a better option?

It's not really clear what you're asking for here.

In recent RabbitMQ versions the startup / shutdown logs are fairly 
minimal, they're only really there to catch failures before the logging 
mechanism is up. So timestamps and so on are in the main logs.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From jesper.louis.andersen at gmail.com  Thu Dec 19 11:01:07 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Thu, 19 Dec 2013 12:01:07 +0100
Subject: [rabbitmq-discuss] Fwd: [PATCH] Make the Erlang RabbitMQ Client
 shut down gracefully
In-Reply-To: <52B2CF31.1040403@rabbitmq.com>
References: <CAGrdgiXZ_dvgnJbE8ZQZvnNHHLwwDMBmFEWG9YEs39QzWUhuAQ@mail.gmail.com>
 <CAGrdgiUjavsQW9yU8CcdPqnJ+G2GR-JUsnft830a4Orr+Gut7Q@mail.gmail.com>
 <52B2CF31.1040403@rabbitmq.com>
Message-ID: <CAGrdgiXCAVpqcCybPFoBOn+zv1B-GGdmPaT6KvL=1gdfKU9vJw@mail.gmail.com>

On Thu, Dec 19, 2013 at 11:49 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Thanks for the patch (it may not get looked at until 2014 now though...)


This is good, because the patch needs more work :P

There is something fishy going on in the shutdown of the RabbitMQ client
tree, so hold the horses for now. I need to figure out exactly what is
happening and how to patch that problem away as well. The "shutdown" exit
reason can for some reason traverse the different processes in the RabbitMQ
supervision tree and that of course makes things go wrong in subtle ways.

I believe the patch is a first step, but more work is needed.


-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/da177104/attachment.html>

From simon at rabbitmq.com  Thu Dec 19 11:15:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 11:15:52 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.1.5 crashed
In-Reply-To: <1610035414.8293896.1387409496536.JavaMail.root@vmware.com>
References: <721958228.7735376.1387237031361.JavaMail.root@vmware.com>
 <52B0380B.5070707@rabbitmq.com>
 <1610035414.8293896.1387409496536.JavaMail.root@vmware.com>
Message-ID: <52B2D568.1020607@rabbitmq.com>

Thanks.

The VM crashed because it couldn't allocate memory.

Normally the memory monitor should detect that RabbitMQ is starting to 
use too much memory and prevent further publishing before reaching this 
point (see http://www.rabbitmq.com/memory.html#memsup). However, you hit 
a long-standing bug that made this less likely to happen.

When running RabbitMQ on a 32 bit Erlang VM on a 64 bit OS as you are, 
the memory monitor detects (in your case) 12GB physical memory in the 
OS, but then adjusts that for the smaller 32 bit address space. 
Unfortunately in versions of RabbitMQ prior to 3.2.1 running on Linux it 
adjusts the memory limit down to 4GB - but in fact the kernel will 
generally only make 2GB addressable.

So the memory alarm will only go off when really quite close to the 
limit. And in this 32 bit VM on 64 bit OS that's especially deadly - 
normally when you run out of physical memory you start to swap, which is 
not great but not disastrous - but when you run out of address space you 
hit a brick wall and die.

In fact I think I'm going to beef up that warning message, it should say 
"crashes are much more likely" or similar.

So there are various things you could do about this (upgrade RabbitMQ, 
reduce vm_memory_high_watermark) but by far the best thing would be to 
start using a 64 bit Erlang build.

Cheers, Simon

On 18/12/13 23:31, Kapil Goyal wrote:
> Thanks Simon,
>
> I am attaching more logs (zipped) from that day.
>
> Crash dump is available at http://goo.gl/iB5Z8Y.
>
> Thanks
> Kapil
>
> ----- Original Message -----
> From: "Simon MacMullen" <simon at rabbitmq.com>
> To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
> Cc: "Kapil Goyal" <goyalk at vmware.com>
> Sent: Tuesday, December 17, 2013 3:39:55 AM
> Subject: Re: [rabbitmq-discuss] RabbitMQ 3.1.5 crashed
>
> So what I see from the logs is that a connection crashed since it
> received connection.close and then found that the TCP connection was
> already closed when it tried to send connection.close-ok in response.
>
> That then caused the queue collector for that connection (component
> which deletes exclusive queues when a connection closes) to crash.
>
> So that's some noise in the logs, I think that could be handled better -
> but I don't see anything there that would amount to the server itself
> crashing. Can you post complete logs somewhere? Probably more useful
> than the crash dump.
>
> Cheers, Simon
>
> On 16/12/2013 23:37, Kapil Goyal wrote:
>> Hi,
>>
>> A rabbitmq server in one of our setups crashed recently. Can you please
>> take a look at the attached rabbit and rabbit-sasl logs and help me
>> understand the issue?
>>
>> The logs attached start from around a minute before and until the crash.
>>
>> I also have a 17M crash dump file. If you'd like to look at it, can I
>> send it as an email attachment or you'd prefer another way?
>>
>>
>> Thanks
>> Kapil
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=JF6BIRiITniYYZhbhzlgNvj%2FeB0%2BYbRBSr0f8NG91qs%3D%0A&m=Z6q%2FpZ9j4Nys6NUpFt3IweKfXsGwzUAXjgvVXmGatz4%3D%0A&s=a92d49282fa22b791fd4ee337e0d46e8d8dc9bea47f5729bd1d35a2305a2a117
>>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From videlalvaro at gmail.com  Thu Dec 19 11:34:14 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Dec 2013 12:34:14 +0100
Subject: [rabbitmq-discuss] Recommended queue architecture
In-Reply-To: <3a664e85-2a08-400e-9292-47b6ff942b4b@googlegroups.com>
References: <3a664e85-2a08-400e-9292-47b6ff942b4b@googlegroups.com>
Message-ID: <CAMcAHLXkMvyLGCsezdv2bkk2t330=kZ_rE+vr5iEQNP2kB2gmA@mail.gmail.com>

Hi,

RabbitMQ won't do any aggregation for you. What you could do is route
similar messages to the same queue(s). Also AMQP messages can have a
correlation_id property that you could use to aggregate them later.

Regards,

Alvaro

On Thu, Dec 19, 2013 at 2:31 AM, Mike Nibeck <mnibeck at gmail.com> wrote:
> Scenario: Order processing system. Orders can contain multiple children
> objects (items, addresses, customer, etc.) We place messages on a queue when
> any elements of an order gets modified. We want to be able to correlate all
> of the messages into a single message "Order Updated", with the details of
> what got updated. The individual edits can come in at any time, and not
> necessarily all of the edits for given order will be processed at the same
> time.
>
> In this scenario, I feel that we ned to somehow persist all of these
> messages and then do some sort of data analysis and group all of the related
> messages for a specific order. Can any of this aggregation occur within the
> queuing system, or will we need to persist these messages in another data
> store (DB) and process on a schedule?
>
> _mike
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From warrior2031 at gmail.com  Thu Dec 19 11:49:45 2013
From: warrior2031 at gmail.com (=?UTF-8?B?0JzQuNGF0LDQuNC7INCU0L7RgNC+0L3QuNC9?=)
Date: Thu, 19 Dec 2013 03:49:45 -0800 (PST)
Subject: [rabbitmq-discuss] How to pause and resume consumption gracefully
	in rabbitmq?
Message-ID: <5f0f52b1-6a7d-4c96-be92-7217a04e9d13@googlegroups.com>

So...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/4a841d2c/attachment.html>

From videlalvaro at gmail.com  Thu Dec 19 11:57:09 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Dec 2013 12:57:09 +0100
Subject: [rabbitmq-discuss] How to pause and resume consumption
 gracefully in rabbitmq?
In-Reply-To: <5f0f52b1-6a7d-4c96-be92-7217a04e9d13@googlegroups.com>
References: <5f0f52b1-6a7d-4c96-be92-7217a04e9d13@googlegroups.com>
Message-ID: <CAMcAHLX=N=udWy6nMhuQ-kCVRffhy=FXyqfOr210OeROm5_Msw@mail.gmail.com>

Hi,

basic.cancel will stop consuming from a queue. When you want to resume
consuming, you can just issue the same basic.consume you did before

Regards,

Alvaro

On Thu, Dec 19, 2013 at 12:49 PM, ?????? ??????? <warrior2031 at gmail.com> wrote:
> So...
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From michael.justin at gmx.net  Thu Dec 19 12:02:57 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 19 Dec 2013 13:02:57 +0100
Subject: [rabbitmq-discuss] Is there a compiled RabbitMQ AMQP client library
 available for the Windows or Linux platform?
Message-ID: <l8un9b$ob8$1@ger.gmane.org>

Hello,

for some experimental work on Delphi and Free Pascal client library 
bindings I am looking for compiled AMQP libraries for Windows (DLL) or 
Linux.

So far I found only source code for open source C/C++ AMQP libraries. I 
have not experience with C/C++, so maybe somebody knows Internet 
locations where I can find compiled library binaries?

-- 
Michael Justin


From warrior2031 at gmail.com  Thu Dec 19 12:03:15 2013
From: warrior2031 at gmail.com (=?UTF-8?B?0JzQuNGF0LDQuNC7INCU0L7RgNC+0L3QuNC9?=)
Date: Thu, 19 Dec 2013 04:03:15 -0800 (PST)
Subject: [rabbitmq-discuss] How to pause and resume consumption
 gracefully in rabbitmq?
In-Reply-To: <CAMcAHLX=N=udWy6nMhuQ-kCVRffhy=FXyqfOr210OeROm5_Msw@mail.gmail.com>
References: <5f0f52b1-6a7d-4c96-be92-7217a04e9d13@googlegroups.com>
 <CAMcAHLX=N=udWy6nMhuQ-kCVRffhy=FXyqfOr210OeROm5_Msw@mail.gmail.com>
Message-ID: <02e238e6-e102-45de-ae27-fcac12e4424f@googlegroups.com>

I'm using python library called pika, and I have a problem which I 
described in this question on stackoverlow.

http://stackoverflow.com/questions/20651111/how-to-pause-and-resume-consumption-gracefully-in-rabbitmq-pika-python

Basically, should I use the same consumer-tag or generate a new one if I'm 
resuming consumption?

If I would generate a new one every time I'm resuming consumption then 
sooner or later it would match some of the previous ones and I would get an 
exception.

???????, 19 ??????? 2013 ?., 15:57:09 UTC+4 ???????????? Alvaro Videla 
???????:
>
> Hi, 
>
> basic.cancel will stop consuming from a queue. When you want to resume 
> consuming, you can just issue the same basic.consume you did before 
>
> Regards, 
>
> Alvaro 
>
> On Thu, Dec 19, 2013 at 12:49 PM, ?????? ??????? <warri... at gmail.com<javascript:>> 
> wrote: 
> > So... 
> > 
> > _______________________________________________ 
> > rabbitmq-discuss mailing list 
> > rabbitmq... at lists.rabbitmq.com <javascript:> 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
> > 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/2d003561/attachment.html>

From videlalvaro at gmail.com  Thu Dec 19 12:18:14 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Dec 2013 13:18:14 +0100
Subject: [rabbitmq-discuss] How to pause and resume consumption
 gracefully in rabbitmq?
In-Reply-To: <02e238e6-e102-45de-ae27-fcac12e4424f@googlegroups.com>
References: <5f0f52b1-6a7d-4c96-be92-7217a04e9d13@googlegroups.com>
 <CAMcAHLX=N=udWy6nMhuQ-kCVRffhy=FXyqfOr210OeROm5_Msw@mail.gmail.com>
 <02e238e6-e102-45de-ae27-fcac12e4424f@googlegroups.com>
Message-ID: <CAMcAHLXP=bPZdjrSRjLC5UF847V-4VOuDZOj9iyjiELx13umwA@mail.gmail.com>

Hi,

I've replied on SO. Here's the answer as well:

Is there a reason why you define your own consumer_tags? You can pass
an empty string and let RabbitMQ generate consumer tags for you. The
reply from basic.consume, which is basic.consume-ok will return the
generated consumer_tag, so you can use it later to stop consuming.

See: http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume-ok

Regards,

Alvaro

On Thu, Dec 19, 2013 at 1:03 PM, ?????? ??????? <warrior2031 at gmail.com> wrote:
> I'm using python library called pika, and I have a problem which I described
> in this question on stackoverlow.
>
> http://stackoverflow.com/questions/20651111/how-to-pause-and-resume-consumption-gracefully-in-rabbitmq-pika-python
>
> Basically, should I use the same consumer-tag or generate a new one if I'm
> resuming consumption?
>
> If I would generate a new one every time I'm resuming consumption then
> sooner or later it would match some of the previous ones and I would get an
> exception.
>
> ???????, 19 ??????? 2013 ?., 15:57:09 UTC+4 ???????????? Alvaro Videla
> ???????:
>>
>> Hi,
>>
>> basic.cancel will stop consuming from a queue. When you want to resume
>> consuming, you can just issue the same basic.consume you did before
>>
>> Regards,
>>
>> Alvaro
>>
>> On Thu, Dec 19, 2013 at 12:49 PM, ?????? ??????? <warri... at gmail.com>
>> wrote:
>> > So...
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq... at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Thu Dec 19 12:17:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 12:17:46 +0000
Subject: [rabbitmq-discuss] How to pause and resume consumption
 gracefully in rabbitmq?
In-Reply-To: <02e238e6-e102-45de-ae27-fcac12e4424f@googlegroups.com>
References: <5f0f52b1-6a7d-4c96-be92-7217a04e9d13@googlegroups.com>
 <CAMcAHLX=N=udWy6nMhuQ-kCVRffhy=FXyqfOr210OeROm5_Msw@mail.gmail.com>
 <02e238e6-e102-45de-ae27-fcac12e4424f@googlegroups.com>
Message-ID: <52B2E3EA.4010404@rabbitmq.com>

Hmm. That looks like Pika is doing more than it should - it doesn't need 
to create a consumer tag if one is not supplied (the server will) and it 
also doesn't need to watch for duplicated consumer tags (resuming with 
the same tag is supported by the server).

Cheers, Simon

On 19/12/13 12:03, ?????? ??????? wrote:
> I'm using python library called pika, and I have a problem which I
> described in this question on stackoverlow.
>
> http://stackoverflow.com/questions/20651111/how-to-pause-and-resume-consumption-gracefully-in-rabbitmq-pika-python
>
> Basically, should I use the same consumer-tag or generate a new one if
> I'm resuming consumption?
>
> If I would generate a new one every time I'm resuming consumption then
> sooner or later it would match some of the previous ones and I would get
> an exception.
>
> ???????, 19 ??????? 2013 ?., 15:57:09 UTC+4 ???????????? Alvaro Videla
> ???????:
>
>     Hi,
>
>     basic.cancel will stop consuming from a queue. When you want to resume
>     consuming, you can just issue the same basic.consume you did before
>
>     Regards,
>
>     Alvaro
>
>     On Thu, Dec 19, 2013 at 12:49 PM, ?????? ??????? <warri... at gmail.com
>     <javascript:>> wrote:
>      > So...
>      >
>      > _______________________________________________
>      > rabbitmq-discuss mailing list
>      > rabbitmq... at lists.rabbitmq.com <javascript:>
>      >
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>      >
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From saurabh.infoedge at gmail.com  Thu Dec 19 12:53:54 2013
From: saurabh.infoedge at gmail.com (Saurabh Sharma)
Date: Thu, 19 Dec 2013 18:23:54 +0530
Subject: [rabbitmq-discuss] Access Control required for RabbitMQ and
	Management plugin
Message-ID: <CABjnW3uSDDQ-u3PGUNPzFquZ+pBT1Z=JSjuyqp19D578S0X1xw@mail.gmail.com>

Hi,
I am working on an application where i want different users for different
tasks.
1)I want a user who can publish/consume messages and ack/nack them but not
able to create queue on server . I am able to create this user by giving
read and write rights and No configure rights.
How can i only define rules that i only need user to have
queue.publish
queue.consume
queue.get

(basically how to create a user only with specific commands)
permissions and not the other permission .

2) I want to hit the Management plugin api for some purpose and it uses
authentication.
What kind of user should i create to use the api
a) read only [not able to hit the api]
b) read and write [not able to hit the api]
c) read , write , configure [able to hit the api]

if i create the aliveness-test queue on the server by a superuser , will i
be able to hit the api in all other cases [if the queue exist] using a read
only user.



Thanks and Regards
Saurabh Sharma
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/b097ac4b/attachment.html>

From simon at rabbitmq.com  Thu Dec 19 13:02:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 13:02:01 +0000
Subject: [rabbitmq-discuss] Access Control required for RabbitMQ and
 Management plugin
In-Reply-To: <CABjnW3uSDDQ-u3PGUNPzFquZ+pBT1Z=JSjuyqp19D578S0X1xw@mail.gmail.com>
References: <CABjnW3uSDDQ-u3PGUNPzFquZ+pBT1Z=JSjuyqp19D578S0X1xw@mail.gmail.com>
Message-ID: <52B2EE49.1040003@rabbitmq.com>

Have you read http://www.rabbitmq.com/access-control.html and 
http://www.rabbitmq.com/management.html#permissions?

Cheers, Simon

On 19/12/13 12:53, Saurabh Sharma wrote:
> Hi,
> I am working on an application where i want different users for
> different tasks.
> 1)I want a user who can publish/consume messages and ack/nack them but
> not able to create queue on server . I am able to create this user by
> giving read and write rights and No configure rights.
> How can i only define rules that i only need user to have
> queue.publish
> queue.consume
> queue.get
>
> (basically how to create a user only with specific commands)
> permissions and not the other permission .
>
> 2) I want to hit the Management plugin api for some purpose and it uses
> authentication.
> What kind of user should i create to use the api
> a) read only [not able to hit the api]
> b) read and write [not able to hit the api]
> c) read , write , configure [able to hit the api]
>
> if i create the aliveness-test queue on the server by a superuser , will
> i be able to hit the api in all other cases [if the queue exist] using a
> read only user.
>
>
>
> Thanks and Regards
> Saurabh Sharma
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Dec 19 15:50:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 15:50:06 +0000
Subject: [rabbitmq-discuss] Blocked/blocking connections & Memory
	fluctuations
In-Reply-To: <CAPK6OeuqpsPWSkJBrzqinxj3uRypWYHX+r1fsfpVTins+Wr6dg@mail.gmail.com>
References: <CAPK6OeuqpsPWSkJBrzqinxj3uRypWYHX+r1fsfpVTins+Wr6dg@mail.gmail.com>
Message-ID: <52B315AE.7040000@rabbitmq.com>

On 18/12/13 17:11, shridharan muthu wrote:
> Hi there,
>
>     I am noticing couple of issues in our rabbit cluster (of 2 nodes).
>
>  1. I notice a lot of blocked and blocking connections in the management
>     admin UI but "rabbitmqctl list_connections" is not showing any
>     blocked or blocking connections. These connections are living over a
>     day and since we use php in our application layer, none of these
>     connections should not live more than 5 mins. Whats strange is that
>     this symptom is noticed in only one of the nodes of the cluster.

Which version are you running? This sounds like a bug that was fixed in 
3.0.3 where connections and channels might not be cleaned up from the 
management database when their node went down.

>  2. Memory doubles once in a few seconds on same node of the cluster.
>     May be GC is kicking in? Not sure whether it could relate to the
>     blocked/blocking connections. Since this node didn't hit memory
>     watermark level, logs doesn't have any warning/errors.

That sounds like it might be GC, but it's hard to tell.

>      On a related note, I have a question about redistributing queues
> after maintanence. For a cluster with 2 nodes (node 1 & node 2) with
> mirroring, lets say out of 12 queues, 6 lives in node 1 (as master) and
> other 6 lives in node 2.  For maintenance reasons, if I take node 2 down
> and put it back in the cluster, all queues will live node 1 at this
> point. Is there any way to redistribute the queues among these 2 nodes
> in this case to move 6 queues back to node 2?

You could use a higher priority "nodes" policy to move the master to 
node 2, then delete it again (albeit the queue would be unmirrored while 
this was taking place). Oh, but you need to be on at least RabbitMQ 
3.1.x for that to work, 3.0.x does not let a mirroring policy move the 
master.

OTOH if the queues are mirrored to all nodes anyway, why worry? A slave 
takes about as many resources as a master anyway, so all your masters 
being on one node and all the slaves on the other should be no big deal.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From shridharan.m at gmail.com  Thu Dec 19 16:35:37 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Thu, 19 Dec 2013 08:35:37 -0800
Subject: [rabbitmq-discuss] Blocked/blocking connections & Memory
	fluctuations
In-Reply-To: <52B315AE.7040000@rabbitmq.com>
References: <CAPK6OeuqpsPWSkJBrzqinxj3uRypWYHX+r1fsfpVTins+Wr6dg@mail.gmail.com>
 <52B315AE.7040000@rabbitmq.com>
Message-ID: <CAPK6Oeu8kWC3K=iJxZu1gP1JziO6tWcptY+5e2+V1+4wk4=WrA@mail.gmail.com>

Thank you Simon. I have a few questions (inline with the explanation below).


On Thu, Dec 19, 2013 at 7:50 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 18/12/13 17:11, shridharan muthu wrote:
>
>>
>>
>>
>>
>> * Hi there,     I am noticing couple of issues in our rabbit cluster (of
>> 2 nodes). *
>> *  1. I notice a lot of blocked and blocking connections in the
>> management*
>>
>>
>>
>>
>>
>>
>> *     admin UI but "rabbitmqctl list_connections" is not showing any
>> blocked or blocking connections. These connections are living over a
>> day and since we use php in our application layer, none of these
>> connections should not live more than 5 mins. Whats strange is that
>> this symptom is noticed in only one of the nodes of the cluster. *
>>
>
> * Which version are you running? This sounds like a bug that was fixed in
> 3.0.3 where connections and channels might not be cleaned up from the
> management database when their node went down.*
>

       You are spot on Simon. We are using 3.0.2 version in our cluster. In
this case, restarting node will not help I guess. Can I delete these
blocked/blocking connections from Management UI?

>
> *  2. Memory doubles once in a few seconds on same node of the cluster.*
>>
>>
>>
>>
>> *     May be GC is kicking in? Not sure whether it could relate to the
>>   blocked/blocking connections. Since this node didn't hit memory
>> watermark level, logs doesn't have any warning/errors. *
>>
>
> * That sounds like it might be GC, but it's hard to tell.*
>
>
     Could it be cause of the blocked connections? I will check the memory
usage after cleaning up the connections.


>
>>
>>
>>
>>
>>
>> *      On a related note, I have a question about redistributing queues
>> after maintanence. For a cluster with 2 nodes (node 1 & node 2) with
>> mirroring, lets say out of 12 queues, 6 lives in node 1 (as master) and
>> other 6 lives in node 2.  For maintenance reasons, if I take node 2 down
>> and put it back in the cluster, all queues will live node 1 at this point.
>> Is there any way to redistribute the queues among these 2 nodes in this
>> case to move 6 queues back to node 2?*
>>
>
> * You could use a higher priority "nodes" policy to move the master to
> node 2, then delete it again (albeit the queue would be unmirrored while
> this was taking place). Oh, but you need to be on at least RabbitMQ 3.1.x
> for that to work, 3.0.x does not let a mirroring policy move the master.*
>

   Ah! But that would leave with tightly coupling queues to nodes.

>
>
> * OTOH if the queues are mirrored to all nodes anyway, why worry? A slave
> takes about as many resources as a master anyway, so all your masters being
> on one node and all the slaves on the other should be no big deal.*


    My understanding is that all operations (publish, consume) on a queue
will be forwarded from slaves to the master (where it will be executed and
broadcasted to all mirrors) and all the messages in the mirror will be used
only when the master goes down. This sounds like slaves are just forwarding
messages all the time (1 hop penalty) and generates more traffic between
slaves & the master.

>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/60397ec7/attachment.html>

From simon at rabbitmq.com  Thu Dec 19 17:27:33 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 17:27:33 +0000
Subject: [rabbitmq-discuss] Blocked/blocking connections & Memory
	fluctuations
In-Reply-To: <CAPK6Oeu8kWC3K=iJxZu1gP1JziO6tWcptY+5e2+V1+4wk4=WrA@mail.gmail.com>
References: <CAPK6OeuqpsPWSkJBrzqinxj3uRypWYHX+r1fsfpVTins+Wr6dg@mail.gmail.com>
 <52B315AE.7040000@rabbitmq.com>
 <CAPK6Oeu8kWC3K=iJxZu1gP1JziO6tWcptY+5e2+V1+4wk4=WrA@mail.gmail.com>
Message-ID: <52B32C85.7090509@rabbitmq.com>

On 19/12/13 16:35, shridharan muthu wrote:
>         You are spot on Simon. We are using 3.0.2 version in our
> cluster. In this case, restarting node will not help I guess. Can I
> delete these blocked/blocking connections from Management UI?

The only way to do that is to restart the management stats database:

# rabbitmqctl -n <node with the stats db> eval 
'application:stop(rabbitmq_management),application:start(rabbitmq_management).'

>       Could it be cause of the blocked connections? I will check the
> memory usage after cleaning up the connections.

I doubt it, those connections don't really exist except as rows in the 
management stats db. But note that we have fixed a few memory leaks 
since 3.0.2.

>     /You could use a higher priority "nodes" policy to move the master
>     to node 2, then delete it again (albeit the queue would be
>     unmirrored while this was taking place). Oh, but you need to be on
>     at least RabbitMQ 3.1.x for that to work, 3.0.x does not let a
>     mirroring policy move the master./
>
>     Ah! But that would leave with tightly coupling queues to nodes.

Only until you delete the "nodes" policy - you can use that to move the 
master, but then revert to an "all" policy; at which point the master 
will stay where it is.

>     /OTOH if the queues are mirrored to all nodes anyway, why worry? A
>     slave takes about as many resources as a master anyway, so all your
>     masters being on one node and all the slaves on the other should be
>     no big deal.
>     /
>
> //
>      My understanding is that all operations (publish, consume) on a
> queue will be forwarded from slaves to the master (where it will be
> executed and broadcasted to all mirrors) and all the messages in the
> mirror will be used only when the master goes down.

Yes.

> This sounds like
> slaves are just forwarding messages all the time (1 hop penalty) and
> generates more traffic between slaves & the master.

Sure, but how will distributing the masters around the cluster help 
that? Or are you saying your clients know that some queues are on node 
2, and expect to connect to that node to use that queue? If so that 
makes sense...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From brian at getset.com  Thu Dec 19 16:40:58 2013
From: brian at getset.com (Brian Marick)
Date: Thu, 19 Dec 2013 08:40:58 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ console has lost ability to log anyone
	in
Message-ID: <77708914-1c0a-4b29-bc79-c6810950cf8e@googlegroups.com>

Earlier today, I could log in as `guest`. Now I cannot. Further, no new 
user I create can log in. For example:

    5063 $ rabbitmqctl add_user brian brian
    Creating user "brian" ...
    ...done.
    5064 $ open http://localhost:15672

When I type the username and password into the appropriate boxes, I get `Login 
failed`. 

There's nothing in the log except:

    =INFO REPORT==== 19-Dec-2013::10:19:27 ===
    Creating user 'brian'

Before this happened, the console had "hung". That is, when I clicked on 
the Queues tab (or any other), nothing happened. I've seen that before, 
though. 

Ideas?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/2f23502d/attachment.html>

From michael.s.klishin at gmail.com  Thu Dec 19 18:10:10 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 19 Dec 2013 22:10:10 +0400
Subject: [rabbitmq-discuss] RabbitMQ console has lost ability to log
 anyone in
In-Reply-To: <77708914-1c0a-4b29-bc79-c6810950cf8e@googlegroups.com>
References: <77708914-1c0a-4b29-bc79-c6810950cf8e@googlegroups.com>
Message-ID: <CAE3HoVRznsRWyoPE9-HZqTMk-oO+13FOG8YZ6_1G3-6qBHiZzg@mail.gmail.com>

2013/12/19 Brian Marick <brian at getset.com>

> When I type the username and password into the appropriate boxes, I get `Login
> failed`.
>
> There's nothing in the log except:
>
>     =INFO REPORT==== 19-Dec-2013::10:19:27 ===
>     Creating user 'brian'
>

Do AMQP connections still work? Have you tried re-enabling the management
plugin?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/e47c4717/attachment.html>

From simon at rabbitmq.com  Thu Dec 19 18:13:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Dec 2013 18:13:22 +0000
Subject: [rabbitmq-discuss] RabbitMQ console has lost ability to log
 anyone in
In-Reply-To: <77708914-1c0a-4b29-bc79-c6810950cf8e@googlegroups.com>
References: <77708914-1c0a-4b29-bc79-c6810950cf8e@googlegroups.com>
Message-ID: <52B33742.5080203@rabbitmq.com>

On 19/12/13 16:40, Brian Marick wrote:
> Earlier today, I could log in as `guest`. Now I cannot. Further, no new
> user I create can log in. For example:
>
>      5063 $ rabbitmqctl add_user brian brian
>      Creating user "brian" ...
>      ...done.
>      5064 $ open http://localhost:15672
>
> When I type the username and password into the appropriate boxes, I get
> `Login failed`.

You will need to give the new user an appropriate tag to access mgmt. 
See http://www.rabbitmq.com/management.html#permissions

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From shridharan.m at gmail.com  Thu Dec 19 19:38:52 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Thu, 19 Dec 2013 11:38:52 -0800
Subject: [rabbitmq-discuss] Blocked/blocking connections & Memory
	fluctuations
In-Reply-To: <52B32C85.7090509@rabbitmq.com>
References: <CAPK6OeuqpsPWSkJBrzqinxj3uRypWYHX+r1fsfpVTins+Wr6dg@mail.gmail.com>
 <52B315AE.7040000@rabbitmq.com>
 <CAPK6Oeu8kWC3K=iJxZu1gP1JziO6tWcptY+5e2+V1+4wk4=WrA@mail.gmail.com>
 <52B32C85.7090509@rabbitmq.com>
Message-ID: <CAPK6OevWQUNGUymjRrUvr91b9sA_inEPP29+8cQxM3snbUv-nA@mail.gmail.com>

Hello Simon,

   I tried restarting rabbitmq management and I got the following error. I
am not able to use port 15672 at all.

*sudo rabbitmqctl -n rabbit eval
'application:stop(rabbitmq_management),application:start(rabbitmq_management).'*
*{error,*
*    {bad_return,*
*        {{rabbit_mgmt_app,start,[normal,[]]},*
*         {'EXIT',*
*             {{{case_clause,*
*                   {error,*
*                       {no_record_for_listener,*
*                           [{port,55672},{ignore_in_use,true}]}}},*
*               [{rabbit_mochiweb_registry,handle_call,3},*
*                {gen_server,handle_msg,5},*
*                {proc_lib,init_p_do_apply,3}]},*
*              {gen_server,call,*
*                  [rabbit_mochiweb_registry,*
*                   {add,rabbit_mgmt_redirect,*
*                       [{port,55672},{ignore_in_use,true}],*
*                       #Fun<rabbit_mochiweb.1.105980535>,*
*                       #Fun<rabbit_mochiweb.0.34137573>,*
*                       {[],"Redirect to port 15672"}},*
*                   infinity]}}}}}}*
*...done.*

So, Is there anyway bring it back up without restarting the app?

Shri


On Thu, Dec 19, 2013 at 9:27 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 19/12/13 16:35, shridharan muthu wrote:
>
>>         You are spot on Simon. We are using 3.0.2 version in our
>> cluster. In this case, restarting node will not help I guess. Can I
>> delete these blocked/blocking connections from Management UI?
>>
>
> The only way to do that is to restart the management stats database:
>
> # rabbitmqctl -n <node with the stats db> eval 'application:stop(rabbitmq_
> management),application:start(rabbitmq_management).'
>
>
>        Could it be cause of the blocked connections? I will check the
>> memory usage after cleaning up the connections.
>>
>
> I doubt it, those connections don't really exist except as rows in the
> management stats db. But note that we have fixed a few memory leaks since
> 3.0.2.
>
>      /You could use a higher priority "nodes" policy to move the master
>>
>>     to node 2, then delete it again (albeit the queue would be
>>     unmirrored while this was taking place). Oh, but you need to be on
>>     at least RabbitMQ 3.1.x for that to work, 3.0.x does not let a
>>     mirroring policy move the master./
>>
>>
>>     Ah! But that would leave with tightly coupling queues to nodes.
>>
>
> Only until you delete the "nodes" policy - you can use that to move the
> master, but then revert to an "all" policy; at which point the master will
> stay where it is.
>
>      /OTOH if the queues are mirrored to all nodes anyway, why worry? A
>>
>>     slave takes about as many resources as a master anyway, so all your
>>     masters being on one node and all the slaves on the other should be
>>     no big deal.
>>     /
>>
>> //
>>
>>      My understanding is that all operations (publish, consume) on a
>> queue will be forwarded from slaves to the master (where it will be
>> executed and broadcasted to all mirrors) and all the messages in the
>> mirror will be used only when the master goes down.
>>
>
> Yes.
>
>
>  This sounds like
>> slaves are just forwarding messages all the time (1 hop penalty) and
>> generates more traffic between slaves & the master.
>>
>
> Sure, but how will distributing the masters around the cluster help that?
> Or are you saying your clients know that some queues are on node 2, and
> expect to connect to that node to use that queue? If so that makes sense...
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/e3723731/attachment.html>

From richard at raseley.com  Thu Dec 19 21:26:02 2013
From: richard at raseley.com (Richard Raseley)
Date: Thu, 19 Dec 2013 13:26:02 -0800
Subject: [rabbitmq-discuss] CPU Utilization Concern
Message-ID: <CAO=6ox8DR8tFEywhCY2RON6gWqNe1y_cYKxF1ktyim==SBiicw@mail.gmail.com>

Currently working with an architecture as follows:

1) A topic exchange is bound to 3 consistent hash exchanges with routing
keys that match 3 distinct types of messages (e.g. type-a, type-b, type-c).

2) Each of these type-specific consistent hash exchanges is, in turn bound
to 16 type-specific queues (e.g. type-a-01, ... , type-a-16) with a weight
of 100.

3) Three consumers are configured to consume messages specific to that type
- each consumer connects to all of the 16 queues for it's type.

4) Producers connect to the broker and send messages to the topic exchange
with a routing key that matches the type of message they are sending.

5) Only one type is active at this time.

The reason we went down this path was to mitigate the 1 queue : 1 cpu core
limitation within RabbitMQ (or Erlange in general?).

We *are* seeing (relatively) even message distribution across the queues
for the on message type that is current active (yay), however I am only
seeing utilization on between 4-6 (depending on the time) out of the 16
total cores (others are 100% idle). This wasn't the behavior in my initial
testing (I saw relatively equal load across all cores).

Can someone confirm that in the architecture outlined above I would expect
to see (relatively) equal distribution across all available cores?
Furthermore, if my expectation is correct, are there Erlang / RabbitMQ
specific configurations that would impact things like core distribution /
affinity? I am also currently pursuing the idea that it might be some
hypervisor-specific setting that is causing this (no good info on that as
of yet).

Thank you in advance for any assistance.

Regards,

Richard Raseley
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/a29a40c7/attachment.html>

From michael.s.klishin at gmail.com  Thu Dec 19 22:56:04 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 20 Dec 2013 02:56:04 +0400
Subject: [rabbitmq-discuss] CPU Utilization Concern
In-Reply-To: <CAO=6ox8DR8tFEywhCY2RON6gWqNe1y_cYKxF1ktyim==SBiicw@mail.gmail.com>
References: <CAO=6ox8DR8tFEywhCY2RON6gWqNe1y_cYKxF1ktyim==SBiicw@mail.gmail.com>
Message-ID: <CAE3HoVSV4Fe7JRZDxoq09Qw0V4FcRCGWSRWNSpfwBEjoJ839gw@mail.gmail.com>

2013/12/20 Richard Raseley <richard at raseley.com>

> Can someone confirm that in the architecture outlined above I would expect
> to see (relatively) equal distribution across all available cores?


Your bottleneck is likely the consistent hash exchanges which are far from
speed demons, not queue throughput.


> Furthermore, if my expectation is correct, are there Erlang / RabbitMQ
> specific configurations that would impact things like core distribution /
> affinity?


See +S in [1] and [2]. Of course, hypervisor and/or OS settings may limit
what Erlang VM can do, too.

1. http://erlang.org/doc/man/erl.html
2.
http://jlouisramblings.blogspot.ru/2013/01/how-erlang-does-scheduling.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/a37459e1/attachment.html>

From ggtech888 at gmail.com  Thu Dec 19 22:20:42 2013
From: ggtech888 at gmail.com (gigi)
Date: Thu, 19 Dec 2013 14:20:42 -0800 (PST)
Subject: [rabbitmq-discuss] how to start rabbitmq broker in a javaEE
	application
Message-ID: <31e65436-4204-40a8-81d8-212d7fa198ff@googlegroups.com>

Hello, 

We plan to set up a rabbitmq broker to do some asynchronous jobs in a java 
enterprise application. I'm new to rabbitmq.Have been looking around and 
seen people suggesting Spring AMQP and Spring integration. However, it 
seems to me that neither is capable of starting the broker within java 
application. Can someone please shed some light into this? 

Also, would be very grateful if more examples, code, best practice of 
integrating rabbitmq with java application could be pointed out.

Thank you for the kind helps in advance

gigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/7237cb1a/attachment.html>

From jkuch at gopivotal.com  Fri Dec 20 02:00:30 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 19 Dec 2013 18:00:30 -0800
Subject: [rabbitmq-discuss] Error starting rabbitmq in IPv6 environment
In-Reply-To: <CECF2FF8.5955F%ed.tyrrill@emc.com>
References: <52A99504.6080702@rabbitmq.com> <CECF2FF8.5955F%ed.tyrrill@emc.com>
Message-ID: <CANOx8NkGdxN3bCz=C8d0x0hOVDsfUzoST-uy7rWVcHcBOnmPxA@mail.gmail.com>

Hi, Ed...

Gradually catching up on the thread here... Perhaps next week we could dig
into this a bit further... I'm new to your scenario and problems, but
perhaps we can hammer out some sane solution.

Best regards,
Jerry



On Thu, Dec 12, 2013 at 9:33 AM, Tyrrill, Ed <ed.tyrrill at emc.com> wrote:

> Hi Simon,
>
> This is what I get:
>
> $ erl -sname foo
> Erlang R16B02 (erts-5.10.3) [source] [64-bit] [smp:4:4] [async-threads:10]
> [hipe] [kernel-poll:false]
>
> Eshell V5.10.3  (abort with ^G)
> (foo at a4ipn434)1>
>
> a4ipn434 is defined in /etc/hosts, and yes, is resolvable
>
> $ ping6 a4ipn434
> PING a4ipn434(a4ipn434.asl.lab.emc.com) 56 data bytes
> 64 bytes from a4ipn434.asl.lab.emc.com: icmp_seq=1 ttl=64 time=0.035 ms
>
> Note that on linux, many of the legacy/IPv4 versions of system calls do
> not work, and you have to use the IPv6 equivalent.  Please let me know if
> I can provide you with any further information.
>
> Thanks,
> Ed
>
>
>
> On 12/12/13 2:50 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>
> >This looks like more of an Erlang-level problem, looks like it is
> >failing before RabbitMQ starts starting. Can you start "erl -sname foo"
> >in pure IPv6 mode?
> >
> >And of course, just to make sure, you can resolve a4ipn434, right? :-)
> >
> >Cheers, Simon
> >
> >On 11/12/2013 21:20, Tyrrill, Ed wrote:
> >> Hi RabbitMQ devs,
> >>
> >> I have found a bug starting rabbitmq in a linux pure IPv6 environment
> >> where /etc/resolv.conf has a "nameserver" line specifying an IPv6
> >> address.  This is what I see:
> >>
> >> # service rabbitmq-server start
> >> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> >> _err}
> >> rabbitmq-server.
> >> # cat /var/log/rabbitmq/startup_log
> >> ERROR: epmd error for host "a4ipn434": address (cannot connect to
> >>host/port)
> >>
> >> Note that /etc/hosts specifies the FQ and short hostnames of the
> >>machine:
> >>
> >> 2620:0:170:586::1:1a4ipn434.xxxxxxxxxxx a4ipn434
> >>
> >> And /etc/resolv.conf specifies a nameserver with an IPv6 address:
> >>
> >> nameserver 2620:0:170:58e::4
> >>
> >> If I comment out this nameserver line in resolv.conf, then rabbitmq
> >> starts with no problem:
> >>
> >> # service rabbitmq-server start
> >> Starting rabbitmq-server: SUCCESS
> >> rabbitmq-server.
> >> # cat /var/log/rabbitmq/startup_log
> >>
> >>                RabbitMQ 3.2.0. Copyright (C) 2007-2013 GoPivotal, Inc.
> >>    ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
> >>    ##  ##
> >>    ##########  Logs: /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434.log
> >>    ######  ##
> >>   /data01/avamar/var/rabbitmq/log/rabbit at a4ipn434-sasl.log
> >>    ##########
> >>                Starting broker... completed with 0 plugins.
> >>
> >> Also, FYI, I tried this with rabbitmq versions 3.2.1-1 and 3.2.0-1.
> >>
> >> Thanks,
> >> Ed
> >>
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/be645ae2/attachment.html>

From arunrao.seattle at gmail.com  Fri Dec 20 05:24:56 2013
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Thu, 19 Dec 2013 21:24:56 -0800
Subject: [rabbitmq-discuss] Disk/Memory Flow Control - question
Message-ID: <CAEJg2GD2Y1DC8D4FchiG9tur6=beO3gGHBCsZwDr49Wzh7FMdA@mail.gmail.com>

Hello -

When the disk/memory flow control monitoring is true, TCP connection (for
example, telnet) to rabbitmq port cannot be reached or will that still be
open?

Thanks in advance,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/9702801c/attachment.html>

From jkuch at gopivotal.com  Fri Dec 20 05:33:06 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 19 Dec 2013 21:33:06 -0800
Subject: [rabbitmq-discuss] Disk/Memory Flow Control - question
In-Reply-To: <CAEJg2GD2Y1DC8D4FchiG9tur6=beO3gGHBCsZwDr49Wzh7FMdA@mail.gmail.com>
References: <CAEJg2GD2Y1DC8D4FchiG9tur6=beO3gGHBCsZwDr49Wzh7FMdA@mail.gmail.com>
Message-ID: <CANOx8NneZUdsot-Gzxqdq0ZOo=HmnuuRazkYoMVVa5Y1VrN=VQ@mail.gmail.com>

Yes, the connection will remain.  But Rabbit will stop reading from it in
the case of publishes until the memory pressure can be relieved by
consumption and/or paging of messages to disk.



On Thu, Dec 19, 2013 at 9:24 PM, Arun Rao <arunrao.seattle at gmail.com> wrote:

> Hello -
>
> When the disk/memory flow control monitoring is true, TCP connection (for
> example, telnet) to rabbitmq port cannot be reached or will that still be
> open?
>
> Thanks in advance,
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/fee2001b/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 20 06:27:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 20 Dec 2013 10:27:18 +0400
Subject: [rabbitmq-discuss] how to start rabbitmq broker in a javaEE
	application
In-Reply-To: <31e65436-4204-40a8-81d8-212d7fa198ff@googlegroups.com>
References: <31e65436-4204-40a8-81d8-212d7fa198ff@googlegroups.com>
Message-ID: <CAE3HoVR0drAxYz5W0NCBftoRbvBUrh+DyJb=kOiSPX0LoaevGA@mail.gmail.com>

2013/12/20 gigi <ggtech888 at gmail.com>

> However, it seems to me that neither is capable of starting the broker
> within java application. Can someone please shed some light into this?
>

RabbitMQ is never started by applications. It's supposed to be running by
the time apps connect to it.
It also not meant to be embedded into a JVM-based app.


> Also, would be very grateful if more examples, code, best practice of
> integrating rabbitmq with java application could be pointed out.
>

Start at http://www.rabbitmq.com/getstarted.html.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/c618d2fd/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 20 06:29:24 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 20 Dec 2013 10:29:24 +0400
Subject: [rabbitmq-discuss] Disk/Memory Flow Control - question
In-Reply-To: <CANOx8NneZUdsot-Gzxqdq0ZOo=HmnuuRazkYoMVVa5Y1VrN=VQ@mail.gmail.com>
References: <CAEJg2GD2Y1DC8D4FchiG9tur6=beO3gGHBCsZwDr49Wzh7FMdA@mail.gmail.com>
 <CANOx8NneZUdsot-Gzxqdq0ZOo=HmnuuRazkYoMVVa5Y1VrN=VQ@mail.gmail.com>
Message-ID: <CAE3HoVRY-465wwaw1CzpujVLczTSNmMvhBMy=b52pR6=qEArpw@mail.gmail.com>

2013/12/20 Jerry Kuch <jkuch at gopivotal.com>

> Yes, the connection will remain.  But Rabbit will stop reading from it in
> the case of publishes until the memory pressure can be relieved by
> consumption and/or paging of messages to disk.


To add to this, if RabbitMQ runs out of file descriptors, it will not
accept new connections.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/49e3d847/attachment.html>

From saurabh.infoedge at gmail.com  Fri Dec 20 06:43:23 2013
From: saurabh.infoedge at gmail.com (Saurabh Sharma)
Date: Fri, 20 Dec 2013 12:13:23 +0530
Subject: [rabbitmq-discuss] Access Control required for RabbitMQ and
 Management plugin
In-Reply-To: <52B2EE49.1040003@rabbitmq.com>
References: <CABjnW3uSDDQ-u3PGUNPzFquZ+pBT1Z=JSjuyqp19D578S0X1xw@mail.gmail.com>
 <52B2EE49.1040003@rabbitmq.com>
Message-ID: <CABjnW3uLyzngR1MMya6KqPu3yZ5Gv9ZGcxU_APwWeR7ca4hkFg@mail.gmail.com>

Hi Simon,

Thanks for your reply .
I have gone through the links provided but still not able to achieve my
goal.
1) i want to create a user who can make call to api for aliveness test and
querying queues.
i am setting permission like

rabbitmqctl set_permissions -p / monitor "^(.\.aliveness-test.*)$"
"^(.\.aliveness-test.*)$" ".*"

but still getting the error that
"error":"not_authorised","reason":"ACCESS_REFUSED - access to queue
'aliveness-test' in vhost '/' refused for user 'monitor'"


can you please direct me about how to create a user with specific
permissions on a specific resource .



Thanks
Saurabh Sharma






On Thu, Dec 19, 2013 at 6:32 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Have you read http://www.rabbitmq.com/access-control.html and
> http://www.rabbitmq.com/management.html#permissions?
>
> Cheers, Simon
>
>
> On 19/12/13 12:53, Saurabh Sharma wrote:
>
>> Hi,
>> I am working on an application where i want different users for
>> different tasks.
>> 1)I want a user who can publish/consume messages and ack/nack them but
>> not able to create queue on server . I am able to create this user by
>> giving read and write rights and No configure rights.
>> How can i only define rules that i only need user to have
>> queue.publish
>> queue.consume
>> queue.get
>>
>> (basically how to create a user only with specific commands)
>> permissions and not the other permission .
>>
>> 2) I want to hit the Management plugin api for some purpose and it uses
>> authentication.
>> What kind of user should i create to use the api
>> a) read only [not able to hit the api]
>> b) read and write [not able to hit the api]
>> c) read , write , configure [able to hit the api]
>>
>> if i create the aliveness-test queue on the server by a superuser , will
>> i be able to hit the api in all other cases [if the queue exist] using a
>> read only user.
>>
>>
>>
>> Thanks and Regards
>> Saurabh Sharma
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/9970e0bf/attachment.html>

From jkuch at gopivotal.com  Fri Dec 20 06:47:25 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 19 Dec 2013 22:47:25 -0800
Subject: [rabbitmq-discuss] Access Control required for RabbitMQ and
 Management plugin
In-Reply-To: <CABjnW3uLyzngR1MMya6KqPu3yZ5Gv9ZGcxU_APwWeR7ca4hkFg@mail.gmail.com>
References: <CABjnW3uSDDQ-u3PGUNPzFquZ+pBT1Z=JSjuyqp19D578S0X1xw@mail.gmail.com>
 <52B2EE49.1040003@rabbitmq.com>
 <CABjnW3uLyzngR1MMya6KqPu3yZ5Gv9ZGcxU_APwWeR7ca4hkFg@mail.gmail.com>
Message-ID: <CANOx8NkdKp1XpapWzaA_jPP3OWUooL+v9SQ7vq_wZ63kQ3w2=Q@mail.gmail.com>

Please see:

http://www.rabbitmq.com/management.html

This may be helpful for considering the
management/policymaker/monitoring/administrator privileges that you may
want to consider when trying to do the aliveness test.

Best regards,
Headache Man



On Thu, Dec 19, 2013 at 10:43 PM, Saurabh Sharma <saurabh.infoedge at gmail.com
> wrote:

> Hi Simon,
>
> Thanks for your reply .
> I have gone through the links provided but still not able to achieve my
> goal.
> 1) i want to create a user who can make call to api for aliveness test and
> querying queues.
> i am setting permission like
>
> rabbitmqctl set_permissions -p / monitor "^(.\.aliveness-test.*)$"
> "^(.\.aliveness-test.*)$" ".*"
>
> but still getting the error that
> "error":"not_authorised","reason":"ACCESS_REFUSED - access to queue
> 'aliveness-test' in vhost '/' refused for user 'monitor'"
>
>
> can you please direct me about how to create a user with specific
> permissions on a specific resource .
>
>
>
> Thanks
> Saurabh Sharma
>
>
>
>
>
>
> On Thu, Dec 19, 2013 at 6:32 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> Have you read http://www.rabbitmq.com/access-control.html and
>> http://www.rabbitmq.com/management.html#permissions?
>>
>> Cheers, Simon
>>
>>
>> On 19/12/13 12:53, Saurabh Sharma wrote:
>>
>>> Hi,
>>> I am working on an application where i want different users for
>>> different tasks.
>>> 1)I want a user who can publish/consume messages and ack/nack them but
>>> not able to create queue on server . I am able to create this user by
>>> giving read and write rights and No configure rights.
>>> How can i only define rules that i only need user to have
>>> queue.publish
>>> queue.consume
>>> queue.get
>>>
>>> (basically how to create a user only with specific commands)
>>> permissions and not the other permission .
>>>
>>> 2) I want to hit the Management plugin api for some purpose and it uses
>>> authentication.
>>> What kind of user should i create to use the api
>>> a) read only [not able to hit the api]
>>> b) read and write [not able to hit the api]
>>> c) read , write , configure [able to hit the api]
>>>
>>> if i create the aliveness-test queue on the server by a superuser , will
>>> i be able to hit the api in all other cases [if the queue exist] using a
>>> read only user.
>>>
>>>
>>>
>>> Thanks and Regards
>>> Saurabh Sharma
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/28652c2e/attachment.html>

From simon at rabbitmq.com  Fri Dec 20 12:22:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Dec 2013 12:22:22 +0000
Subject: [rabbitmq-discuss] Blocked/blocking connections & Memory
	fluctuations
In-Reply-To: <CAPK6OevWQUNGUymjRrUvr91b9sA_inEPP29+8cQxM3snbUv-nA@mail.gmail.com>
References: <CAPK6OeuqpsPWSkJBrzqinxj3uRypWYHX+r1fsfpVTins+Wr6dg@mail.gmail.com>
 <52B315AE.7040000@rabbitmq.com>
 <CAPK6Oeu8kWC3K=iJxZu1gP1JziO6tWcptY+5e2+V1+4wk4=WrA@mail.gmail.com>
 <52B32C85.7090509@rabbitmq.com>
 <CAPK6OevWQUNGUymjRrUvr91b9sA_inEPP29+8cQxM3snbUv-nA@mail.gmail.com>
Message-ID: <52B4367E.9020707@rabbitmq.com>

Hmm. I cannot figure out how that could come to pass - it looks like 
there is a broken listener already there.

You might be able to fix this by invoking

$ rabbitmqctl -n rabbit eval 
'rabbit_web_dispatch_sup:stop_listener([{port,55672},{ignore_in_use,true}]).'

but if that doesn't work I think you'd have to restart the node I'm afraid.

Either way, I'd be very interested to see the logs from around when you 
tried to restart the management application.

Cheers, Simon

On 19/12/13 19:38, shridharan muthu wrote:
> Hello Simon,
>
>     I tried restarting rabbitmq management and I got the following
> error. I am not able to use port 15672 at all.
>
> /sudo rabbitmqctl -n rabbit eval
> 'application:stop(rabbitmq_management),application:start(rabbitmq_management).'/
> /{error,/
> /    {bad_return,/
> /        {{rabbit_mgmt_app,start,[normal,[]]},/
> /         {'EXIT',/
> /             {{{case_clause,/
> /                   {error,/
> /                       {no_record_for_listener,/
> /                           [{port,55672},{ignore_in_use,true}]}}},/
> /               [{rabbit_mochiweb_registry,handle_call,3},/
> /                {gen_server,handle_msg,5},/
> /                {proc_lib,init_p_do_apply,3}]},/
> /              {gen_server,call,/
> /                  [rabbit_mochiweb_registry,/
> /                   {add,rabbit_mgmt_redirect,/
> /                       [{port,55672},{ignore_in_use,true}],/
> /                       #Fun<rabbit_mochiweb.1.105980535>,/
> /                       #Fun<rabbit_mochiweb.0.34137573>,/
> /                       {[],"Redirect to port 15672"}},/
> /                   infinity]}}}}}}/
> /...done./
> /
> /
> So, Is there anyway bring it back up without restarting the app?
>
> Shri
>
>
> On Thu, Dec 19, 2013 at 9:27 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 19/12/13 16:35, shridharan muthu wrote:
>
>                  You are spot on Simon. We are using 3.0.2 version in our
>         cluster. In this case, restarting node will not help I guess. Can I
>         delete these blocked/blocking connections from Management UI?
>
>
>     The only way to do that is to restart the management stats database:
>
>     # rabbitmqctl -n <node with the stats db> eval
>     'application:stop(rabbitmq___management),application:start(__rabbitmq_management).'
>
>
>                Could it be cause of the blocked connections? I will
>         check the
>         memory usage after cleaning up the connections.
>
>
>     I doubt it, those connections don't really exist except as rows in
>     the management stats db. But note that we have fixed a few memory
>     leaks since 3.0.2.
>
>              /You could use a higher priority "nodes" policy to move the
>         master
>
>              to node 2, then delete it again (albeit the queue would be
>              unmirrored while this was taking place). Oh, but you need
>         to be on
>              at least RabbitMQ 3.1.x for that to work, 3.0.x does not let a
>              mirroring policy move the master./
>
>
>              Ah! But that would leave with tightly coupling queues to nodes.
>
>
>     Only until you delete the "nodes" policy - you can use that to move
>     the master, but then revert to an "all" policy; at which point the
>     master will stay where it is.
>
>              /OTOH if the queues are mirrored to all nodes anyway, why
>         worry? A
>
>              slave takes about as many resources as a master anyway, so
>         all your
>              masters being on one node and all the slaves on the other
>         should be
>              no big deal.
>              /
>
>         //
>
>               My understanding is that all operations (publish, consume)
>         on a
>         queue will be forwarded from slaves to the master (where it will be
>         executed and broadcasted to all mirrors) and all the messages in the
>         mirror will be used only when the master goes down.
>
>
>     Yes.
>
>
>         This sounds like
>         slaves are just forwarding messages all the time (1 hop penalty) and
>         generates more traffic between slaves & the master.
>
>
>     Sure, but how will distributing the masters around the cluster help
>     that? Or are you saying your clients know that some queues are on
>     node 2, and expect to connect to that node to use that queue? If so
>     that makes sense...
>
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Dec 20 12:33:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Dec 2013 12:33:58 +0000
Subject: [rabbitmq-discuss] Access Control required for RabbitMQ and
 Management plugin
In-Reply-To: <CABjnW3uLyzngR1MMya6KqPu3yZ5Gv9ZGcxU_APwWeR7ca4hkFg@mail.gmail.com>
References: <CABjnW3uSDDQ-u3PGUNPzFquZ+pBT1Z=JSjuyqp19D578S0X1xw@mail.gmail.com>
 <52B2EE49.1040003@rabbitmq.com>
 <CABjnW3uLyzngR1MMya6KqPu3yZ5Gv9ZGcxU_APwWeR7ca4hkFg@mail.gmail.com>
Message-ID: <52B43936.5010302@rabbitmq.com>

On 20/12/13 06:43, Saurabh Sharma wrote:
> 1) i want to create a user who can make call to api for aliveness test
> and querying queues.
> i am setting permission like
>
> rabbitmqctl set_permissions -p / monitor "^(.\.aliveness-test.*)$"
> "^(.\.aliveness-test.*)$" ".*"
>
> but still getting the error that
> "error":"not_authorised","reason":"ACCESS_REFUSED - access to queue
> 'aliveness-test' in vhost '/' refused for user 'monitor'"

Those brackets and dots are not needed. Also the aliveness-test 
publishes to the queue via the default exchange, so you need to define 
permissions for that. So:

$ rabbitmqctl set_permissions -p / monitor "^aliveness-test$" 
"^amq.default$" ".*"

should work.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mcintoshj at gmail.com  Fri Dec 20 16:27:05 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 20 Dec 2013 10:27:05 -0600
Subject: [rabbitmq-discuss] Shovel with multiple publish_properties oddity
Message-ID: <CAD6m6fGpzr0isTT7q-BaqwjOO58CKs4UQOQTp4GFw6HLKk9hdA@mail.gmail.com>

SO I have a shovel configuration I'm trying to get working so I can pass
back the "source-ip".  I'd previously done this with a header and it
worked, but I'm trying to switch to a publish_property so developers can
use headers in their publishes (since me setting the headers in the shovel
config overrides their headers).

With this config, things don't work:
[
    {rabbit, [
        {vm_memory_high_watermark, 0.6}
, {hipe_compile, false}
     ]}
  , {rabbitmq_shovel,[{shovels, [
        { 'vhost_queue', [
                  {sources,      [{broker, "amqp://guest:guest@/vhost"}] }
                , {destinations, [{broker,
"amqp://guest:guest at brokerhost/vhost"}]
}
                , {queue, <<"queue">>}
                , {prefetch_count, 15}
                , {publish_properties, [
                        {delivery_mode,2},
                        {content_type, <<"test">>}
                        ]}
                , {reconnect_delay, 30}
                , {publish_fields, [{exchange,
<<"exchange">>},{routing_key, <<"queue">>}]}

        ] }
  ]}]}
].


But if I remove the line "{delivery_mode,2},"  rabbit starts up fine.  If I
remove the content_type entry, rabbit starts up - it's just when both are
there nothing works.  Note, I can set the publish_properties for the
header, e.g.:

{publish_properties, [
{delivery_mode, 2}
, {headers, [{<<"source">>,longstr,<<"${HOSTNAME}">>}] }
]}

Works just fine.  Am I missing something?
Thanks!
Jason

-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/338993d1/attachment.html>

From saurabh.infoedge at gmail.com  Fri Dec 20 16:38:44 2013
From: saurabh.infoedge at gmail.com (Saurabh Sharma)
Date: Fri, 20 Dec 2013 22:08:44 +0530
Subject: [rabbitmq-discuss] Access Control required for RabbitMQ and
 Management plugin
In-Reply-To: <52B43936.5010302@rabbitmq.com>
References: <CABjnW3uSDDQ-u3PGUNPzFquZ+pBT1Z=JSjuyqp19D578S0X1xw@mail.gmail.com>
 <52B2EE49.1040003@rabbitmq.com>
 <CABjnW3uLyzngR1MMya6KqPu3yZ5Gv9ZGcxU_APwWeR7ca4hkFg@mail.gmail.com>
 <52B43936.5010302@rabbitmq.com>
Message-ID: <CABjnW3uzU+zv77ejtiPB4WS0kQh=KEVnGCzMJ+zy+4hhNpkgEw@mail.gmail.com>

Hi Simon ,
Thanks for your reply..

I am using three users
//for monitoring purpose
permission "alivenss-test.*" "" ".*"

//for read write
permission "" ".*" ".*" (instead of making "amq\.default" , i am keeping
configure as " " and it is working)

do "" means "^$" or "amq\.default" ?

//for all three
permission ".*" ".*" ".*"



Thanks
Saurabh





On Fri, Dec 20, 2013 at 6:03 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 20/12/13 06:43, Saurabh Sharma wrote:
>
>> 1) i want to create a user who can make call to api for aliveness test
>> and querying queues.
>> i am setting permission like
>>
>> rabbitmqctl set_permissions -p / monitor "^(.\.aliveness-test.*)$"
>> "^(.\.aliveness-test.*)$" ".*"
>>
>> but still getting the error that
>> "error":"not_authorised","reason":"ACCESS_REFUSED - access to queue
>> 'aliveness-test' in vhost '/' refused for user 'monitor'"
>>
>
> Those brackets and dots are not needed. Also the aliveness-test publishes
> to the queue via the default exchange, so you need to define permissions
> for that. So:
>
> $ rabbitmqctl set_permissions -p / monitor "^aliveness-test$"
> "^amq.default$" ".*"
>
> should work.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/ee0acb6b/attachment.html>

From simon at rabbitmq.com  Fri Dec 20 16:37:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Dec 2013 16:37:31 +0000
Subject: [rabbitmq-discuss] Shovel with multiple publish_properties
	oddity
In-Reply-To: <CAD6m6fGpzr0isTT7q-BaqwjOO58CKs4UQOQTp4GFw6HLKk9hdA@mail.gmail.com>
References: <CAD6m6fGpzr0isTT7q-BaqwjOO58CKs4UQOQTp4GFw6HLKk9hdA@mail.gmail.com>
Message-ID: <52B4724B.6080506@rabbitmq.com>

I just had a quick look at this.

Believe it or not the shovel config parser seems to be sensitive to the 
order of publish_properties. I was able to make this work by putting 
content_type before delivery_mode.

The developer responsible will receive a kicking.

With seasonal good cheer to all, Simon

On 20/12/13 16:27, Jason McIntosh wrote:
> SO I have a shovel configuration I'm trying to get working so I can pass
> back the "source-ip".  I'd previously done this with a header and it
> worked, but I'm trying to switch to a publish_property so developers can
> use headers in their publishes (since me setting the headers in the
> shovel config overrides their headers).
>
> With this config, things don't work:
> [
>      {rabbit, [
>          {vm_memory_high_watermark, 0.6}
> , {hipe_compile, false}
>       ]}
>    , {rabbitmq_shovel,[{shovels, [
>          { 'vhost_queue', [
>                    {sources,      [{broker, "amqp://guest:guest@/vhost"}] }
>                  , {destinations, [{broker,
> "amqp://guest:guest at brokerhost/vhost"}] }
>                  , {queue, <<"queue">>}
>                  , {prefetch_count, 15}
>                  , {publish_properties, [
>                          {delivery_mode,2},
>                          {content_type, <<"test">>}
>                          ]}
>                  , {reconnect_delay, 30}
>                  , {publish_fields, [{exchange,
> <<"exchange">>},{routing_key, <<"queue">>}]}
>
>          ] }
>    ]}]}
> ].
>
>
> But if I remove the line "{delivery_mode,2},"  rabbit starts up fine.
>   If I remove the content_type entry, rabbit starts up - it's just when
> both are there nothing works.  Note, I can set the publish_properties
> for the header, e.g.:
>
> {publish_properties, [
> {delivery_mode, 2}
> , {headers, [{<<"source">>,longstr,<<"${HOSTNAME}">>}] }
> ]}
>
> Works just fine.  Am I missing something?
> Thanks!
> Jason
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From roatin.marth at gmail.com  Fri Dec 20 17:01:30 2013
From: roatin.marth at gmail.com (Roatin Marth)
Date: Fri, 20 Dec 2013 09:01:30 -0800 (PST)
Subject: [rabbitmq-discuss] cannot redeclare exchange with different type
In-Reply-To: <CAMcAHLXc-ht6cF8Lmj37X5bwAihNzSt0heQF2xZSq-nNXKqCWA@mail.gmail.com>
References: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
 <d3f7ac24-6cb2-48b9-a7c8-0041d2017752@googlegroups.com>
 <CAMcAHLXc-ht6cF8Lmj37X5bwAihNzSt0heQF2xZSq-nNXKqCWA@mail.gmail.com>
Message-ID: <23d1140d-6682-4bff-8180-b42d712a10db@googlegroups.com>

right, then
i wasn't actually trying to change the type when i initially posted my 
query. which is why i was confused.
based on the samples on the rabbit tutorials, i assumed the call to 
declare_exchange was idempotent, meaning if it already existed, it wouldn't 
try to recreate it.
in my example, i have an exchange "myExchange" of type fanout. my code was 
simply ensuring this exchange existed by calling 
declare_exchange("myExchange", fanout);
when i ran my code the second time, it was giving me that error as if i was 
trying to change the type.
i checked the management page and the exchange was there with type fanout.
after i deleted the exchange, the code worked as expected after subsequent 
reruns of the app.




On Wednesday, 18 December 2013 19:28:45 UTC-5, Alvaro Videla wrote:
>
> Sid, 
>
> Yes, to change queues and exchange parameters/types you need to delete 
> them and redeclare them. 
>
> Regards, 
>
> Alvaro 
>
> On Thu, Dec 19, 2013 at 1:20 AM, Sid Young <sid.... at gmail.com<javascript:>> 
> wrote: 
> > 
> > I have been exploring fanout exchanges for a few nights as part of a 
> stock 
> > graphing system I'm writing and in the process of recreating the 
> exchange 
> > numerous times via my c++ programs, it appears once created, you need to 
> > delete it before redefining it as a different type. 
> > 
> > Sid 
> > 
> > 
> > 
> > 
> > On Wednesday, December 18, 2013 8:01:18 AM UTC+10, Roatin Marth wrote: 
> >> 
> >> g'day folks, 
> >> 
> >> just been rummaging through the rabbit mq tutorials and got myself 
> stuck 
> >> in a slight rut. 
> >> 
> >> i'm perusing the pub/sub example in python on windows. 
> >> i've declared an exchange, and having run the script, I can see it's 
> been 
> >> created through the management console, 
> >> but I keep getting an exception as soon as I run either the producer or 
> >> the consumer app. 
> >> 
> >> if I comment out the exchange_declare line, all is well. 
> >> 
> >> the logger says I cannot redeclare an exchange with a different type. 
> >> in the management window I can see it is of type fanout. the code is 
> >> declaring it as fanout. 
> >> I was under the impression exchange_declare was idempotent. is this 
> >> correct? 
> > 
> > 
> > _______________________________________________ 
> > rabbitmq-discuss mailing list 
> > rabbitmq... at lists.rabbitmq.com <javascript:> 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
> > 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/d7377d8e/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 20 17:56:08 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 20 Dec 2013 21:56:08 +0400
Subject: [rabbitmq-discuss] cannot redeclare exchange with different type
In-Reply-To: <23d1140d-6682-4bff-8180-b42d712a10db@googlegroups.com>
References: <aeb483c9-5080-4f3e-895e-fdccb3052b58@googlegroups.com>
 <d3f7ac24-6cb2-48b9-a7c8-0041d2017752@googlegroups.com>
 <CAMcAHLXc-ht6cF8Lmj37X5bwAihNzSt0heQF2xZSq-nNXKqCWA@mail.gmail.com>
 <23d1140d-6682-4bff-8180-b42d712a10db@googlegroups.com>
Message-ID: <CAE3HoVT2nf7SV_FSezjX90iLo8_tBPYu94fX8f51PY6vCMY7gw@mail.gmail.com>

2013/12/20 Roatin Marth <roatin.marth at gmail.com>

>  i assumed the call to declare_exchange was idempotent, meaning if it
> already existed, it wouldn't try to recreate it.
> in my example, i have an exchange "myExchange" of type fanout. my code was
> simply ensuring this exchange existed by calling
> declare_exchange("myExchange", fanout);
>

This assumption is correct.


> when i ran my code the second time, it was giving me that error as if i
> was trying to change the type.
> i checked the management page and the exchange was there with type fanout.
> after i deleted the exchange, the code worked as expected after subsequent
> reruns of the app.
>

This means some other attribute wasn't exactly the same.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/c2710a06/attachment.html>

From mcintoshj at gmail.com  Fri Dec 20 18:14:36 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 20 Dec 2013 12:14:36 -0600
Subject: [rabbitmq-discuss] Recommended queue architecture
In-Reply-To: <CAMcAHLXkMvyLGCsezdv2bkk2t330=kZ_rE+vr5iEQNP2kB2gmA@mail.gmail.com>
References: <3a664e85-2a08-400e-9292-47b6ff942b4b@googlegroups.com>
 <CAMcAHLXkMvyLGCsezdv2bkk2t330=kZ_rE+vr5iEQNP2kB2gmA@mail.gmail.com>
Message-ID: <CAD6m6fFjQ3eHpiDZj5dQn-8HDr-MtYpmjN=uCO0LDTCsK-qmvQ@mail.gmail.com>

Another off the wall idea - create a queue for "message orders
received/completed", publish on the first order "started order id", and
then create a queue for each "order id".  Then you could start up a
listener on that "message orders received/completed" to dynamically start
listeners on the specific "order id" queue and shut it down after the queue
is completed.  Not sure this is really a good idea though

Jason


On Thu, Dec 19, 2013 at 5:34 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> RabbitMQ won't do any aggregation for you. What you could do is route
> similar messages to the same queue(s). Also AMQP messages can have a
> correlation_id property that you could use to aggregate them later.
>
> Regards,
>
> Alvaro
>
> On Thu, Dec 19, 2013 at 2:31 AM, Mike Nibeck <mnibeck at gmail.com> wrote:
> > Scenario: Order processing system. Orders can contain multiple children
> > objects (items, addresses, customer, etc.) We place messages on a queue
> when
> > any elements of an order gets modified. We want to be able to correlate
> all
> > of the messages into a single message "Order Updated", with the details
> of
> > what got updated. The individual edits can come in at any time, and not
> > necessarily all of the edits for given order will be processed at the
> same
> > time.
> >
> > In this scenario, I feel that we ned to somehow persist all of these
> > messages and then do some sort of data analysis and group all of the
> related
> > messages for a specific order. Can any of this aggregation occur within
> the
> > queuing system, or will we need to persist these messages in another data
> > store (DB) and process on a schedule?
> >
> > _mike
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/dd55e58b/attachment.html>

From djacobfeuerborn at gmail.com  Sat Dec 21 15:03:48 2013
From: djacobfeuerborn at gmail.com (Dennis Jacobfeuerborn)
Date: Sat, 21 Dec 2013 07:03:48 -0800 (PST)
Subject: [rabbitmq-discuss] How to deal with untrusted publishers
Message-ID: <5be96243-11c3-4ff7-9a4e-db578acafa56@googlegroups.com>

Hi,
I'm currently working with a system where a publisher pushed messages to an 
exchange which end up in a queue and then get read by a consumer and stored 
in a database. The messages are of the form "<key> <value>" and where in 
the database the key ist stored is determined by the key.

Now I want to add another publisher and the information of that publisher 
is supposed to be stored in a different table.

The problem is that technically I need to change the message format to 
"<publisher>.<key> <value>" so the consumer can know where to store the 
keys but for security reasons I cannot really rely on the publisher sending 
the correct data so I really need to insert the <publisher> bit on the 
broker side based on the username the publisher connects with. For example:

- Publisher connects with the credentials "publisher1"/(some password)
- Publisher sends message "mykey myvalue" to exchange X
- Exchange X modifies the message and prepends a string containing the 
username resulting in the message "publisher1.mykey myvalue"
- Consumer receives the message and can store the data in the appropriate 
place

Is there a way to accomplish this or something similar with rabbitmq?

Regards,
  Dennis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131221/76e2da66/attachment.html>

From mike at meshfire.com  Sat Dec 21 17:02:16 2013
From: mike at meshfire.com (MikeTempleman)
Date: Sat, 21 Dec 2013 09:02:16 -0800 (PST)
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <CAMcAHLWS+utJDFEaXQK-DUKK0yugE1Q9rDSjG+A9xAaQRQb=TQ@mail.gmail.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
 <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
 <CALdW9BwnLs_je13zg_4WBd-6NKemZDXry+sNXPV7ut8P=7hahw@mail.gmail.com>
 <CAMcAHLWS+utJDFEaXQK-DUKK0yugE1Q9rDSjG+A9xAaQRQb=TQ@mail.gmail.com>
Message-ID: <CALdW9ByXM5eHB38_KZc36_Lb7VveBWMF8C0gSJ=ik96U+xg41w@mail.gmail.com>

We are still seeing the cycling.

I wanted to ask if the round-robing scheduling could be a factor.

For example, if I have 4 servers with 5 channels each on the same topic
queue. Each channel has a prefetch setting of 50. When a channel consumer
becomes blocked (slow db operation, overloaded with other requests, etc.),
does that block delivery of messages to the other channels? If that
delivery to fill the prefetch cache is delayed, is there any impact on the
client (i.e. does it become blocked)?

iow, is there a way for all channels on all servers to become blocked in a
high load situation? Even if their prefetch caches are full?

-- 

*Mike Templeman*
*Head of Development*

T: @talkingfrog1950 <http://twitter.com/missdestructo>
T: @Meshfire <http://twitter.com/meshfire>



On Wed, Dec 18, 2013 at 10:32 AM, Mike Templeman <mike at meshfire.com> wrote:

> Well, multi-ack didn't help very much. We can see some, but not enough to
> matter.
>
> We cannot use auto-ack because consumers (multiple/server) die
> unexpectedly as the app servers are autoscaled. We have not built a fully
> separated service yet (too hard to debug on development machines right
> now). But could Publisher confirms resolve the issue of servers dying with
> n messages in their prefetch buffers?
>
>
>
> --
>
> *Mike Templeman *
> *Head of Development*
>
> T: @talkingfrog1950 <http://twitter.com/missdestructo>
> T: @Meshfire <http://twitter.com/meshfire>
>
>
>
> On Sun, Dec 15, 2013 at 5:02 AM, Alvaro Videla-2 [via RabbitMQ] <
> ml-node+s1065348n32095h82 at n5.nabble.com> wrote:
>
>> Hi Mike,
>>
>> Yes, RabbitMQ queues are designed for fast delivery of messages and for
>> being as empty as possible, as that blog post explains.
>>
>> Another interesting blog post, about consumer strategies and basic.qos
>> settings is this one:
>> http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/#more-276
>>
>> re multi ack: yes, that might help.
>>
>> Regards,
>>
>> Alvaro
>>
>>
>> On Sat, Dec 14, 2013 at 2:15 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32095&i=0>
>> > wrote:
>>
>>> I realized that was a bad interpretation. Sorry. The exchange is just
>>> successfully routing all the messages to the target queues.
>>>
>>> After reading a number of posts and this blog entry (
>>> http://www.rabbitmq.com/blog/2011/09/24/sizing-your-rabbits/) I wonder
>>> if the issue is that each message is ack'd. It seemed that the issue
>>> occurred when I had a large backlog in the queues. When Rabbit is empty,
>>> performance is fine. When the consumers tried to run at much higher speeds,
>>> we encountered this cycling.
>>>
>>> We have run a brief test with no-ack, not on production, and the
>>> performance is excellent even under load. But this is not a viable solution
>>> (appservers crash, autoscaling shuts servers down that have prefetched
>>> messages and are still connected to rabbit) without a full redesign.
>>>
>>> Assuming each queue is only one thread (I assume it handles both
>>> receipt, delivery, and ack cleanup) then I can understand what might happen
>>> when the consumers generate ~500 acks/s while new messages are coming in at
>>> a low 50-100/s rate on a specific queue. I will move out some events that
>>> tend to generate peaks into their own queue and accept that queue
>>> processing more slowly. As for separating the real worker queue, I suppose
>>> I could create 2 or so static queues to divide the load up.
>>>
>>> So what I think I can do is:
>>> 1. bump the default tcp buffer from 128KB to around 10MB. The added
>>> buffering may help a little
>>> 2. see if I can find out how to set the multiple ack flag. We are using
>>> Grails so maybe that is just creating a custom bean. I don't know
>>> 3. create a couple of queues for lower-priority events specifically
>>> events chosen to be less time critical.
>>> 4. if all that doesn't work then probably create 4 queues for the high
>>> priority events, randomly publish to those queues, and put consumers for
>>> each queue.
>>> 5. Also, upgrade the server to the latest version.
>>>
>>> Mike Templeman
>>>
>>> --
>>>
>>> *Mike Templeman*
>>> *Head of Development*
>>>
>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>> T: @Meshfire <http://twitter.com/meshfire>
>>>
>>>
>>>
>>> On Fri, Dec 13, 2013 at 1:42 PM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=0>
>>> > wrote:
>>>
>>>> I noticed something else very odd.
>>>>
>>>> Currently, one queue has 43,000 messages backed up in its queue. But
>>>> when I look at the exchange (there is only one exchange) I see that the
>>>> message rate in exactly matches the message rate out.
>>>>
>>>> With such a huge backlog, why would that be? I would have thought that
>>>> the consumers (there are 16 total distributed across 4 systems for that
>>>> queue with a prefetch of 100) would run at a much higher steady state.
>>>>
>>>> This exchange also seems to cycle regularly. It appears to run from a
>>>> low of around 60/s in and out to 500+ a second in and out.
>>>>
>>>>  --
>>>>
>>>> *Mike Templeman*
>>>> *Head of Development*
>>>>
>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>
>>>>
>>>>
>>>> On Fri, Dec 13, 2013 at 10:40 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=1>
>>>> > wrote:
>>>>
>>>>> Also, from observing the Connections screen on the web UI shows that
>>>>> no flow control has been recently turned on for any of the four current
>>>>> connections (four app servers).
>>>>>
>>>>> --
>>>>>
>>>>> *Mike Templeman *
>>>>> *Head of Development*
>>>>>
>>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>>
>>>>>
>>>>>
>>>>> On Fri, Dec 13, 2013 at 10:17 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=2>
>>>>> > wrote:
>>>>>
>>>>>> Hi Alvaro
>>>>>>
>>>>>> I would be more than happy to provide logs. But all they have in them
>>>>>> is connection and shutdown information. Nothing more. I have just enabled
>>>>>> tracing on the vhost and will send the logs shortly. We encounter this
>>>>>> issue when under load every day now.
>>>>>>
>>>>>> Let me tell you our architecture and deployment:
>>>>>>
>>>>>> rabbitMQ:
>>>>>>
>>>>>>    - m1.large ec2 instance. Version: RabbitMQ 3.1.5,  Erlang R14B04
>>>>>>    - 23 queues (transaction and direct)
>>>>>>    - 3 exchanges used, two fanout and one topic exchange
>>>>>>    - topic exchange
>>>>>>    - Topic exchange overview is attached.
>>>>>>    - 46 total channels.
>>>>>>
>>>>>>
>>>>>> AppServers
>>>>>>
>>>>>>    - m1.large tomcat servers running grails application
>>>>>>    - 2-7 servers at any one time.
>>>>>>    - Consume + publish
>>>>>>    - On busy queues, each server has 16 consumers with prefetch at
>>>>>>    100
>>>>>>    - message sizes on busy queues are ~4KB.
>>>>>>    - publishing rates on busiest queue ranges from 16/s to >100/s.
>>>>>>    (We need to be able to support 1000/s).
>>>>>>
>>>>>>
>>>>>> Each AppServer connects to a sharded mongodb cluster of 3 shards. Our
>>>>>> first suspicion was that something in Mongo or AWS was causing the periodic
>>>>>> delay but AWS techs looked into our volume use and said we were only use
>>>>>> 25% of available bandwidth.
>>>>>>
>>>>>> At this moment, we have a modest publish rate (~50-60/s) but a
>>>>>> backlog of 50,000 messages for the queue "user". You can see a 10 minute
>>>>>> snapshot of the queue and see the cycling.
>>>>>>
>>>>>> I turned on tracing but the results don't seem to becoming into the
>>>>>> log. Is there another way to enable reporting of flow control?
>>>>>>
>>>>>> Mike Templeman
>>>>>>
>>>>>>
>>>>>>  --
>>>>>>
>>>>>> *Mike Templeman*
>>>>>> *Head of Development*
>>>>>>
>>>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Fri, Dec 13, 2013 at 6:03 AM, Alvaro Videla-2 [via RabbitMQ] <[hidden
>>>>>> email] <http://user/SendEmail.jtp?type=node&node=32089&i=3>> wrote:
>>>>>>
>>>>>>> Mike,
>>>>>>>
>>>>>>> Would you be able to provide information more information to help us
>>>>>>> debug the problem?
>>>>>>>
>>>>>>> Tim (from the rabbitmq team) requested more info in order to try to
>>>>>>> find answers for this.
>>>>>>>
>>>>>>> For example, when consumption drops to zero, are there any logs on
>>>>>>> the
>>>>>>> rabbitmq server that might tell of a flow control mechanism being
>>>>>>> activated?
>>>>>>>
>>>>>>> Regards,
>>>>>>>
>>>>>>> Alvaro
>>>>>>>
>>>>>>>
>>>>>>> On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=0>>
>>>>>>> wrote:
>>>>>>>
>>>>>>> > Tyson
>>>>>>> >
>>>>>>> > Did you ever find an answer to this question? We are encountering
>>>>>>> virtually
>>>>>>> > the exact same problem.
>>>>>>> >
>>>>>>> > We have a variable number of servers setup as producers and
>>>>>>> consumers and
>>>>>>> > see our throughput drop to zero on a periodic basis. This is most
>>>>>>> severe
>>>>>>> > when there are a few hundred thousand messages on rabbit.
>>>>>>> >
>>>>>>> > Did you just drop Rabbit? Ours is running on an m1.large instance
>>>>>>> with RAID0
>>>>>>> > ephemeral drives, so size and performance of the disk subsystem is
>>>>>>> not an
>>>>>>> > issue (we are still in beta). We have spent untold hours tuning
>>>>>>> our sharded
>>>>>>> > mongodb subsystem only to find out that it is only being 25%
>>>>>>> utilized (at
>>>>>>> > least it will be blazing fast if we ever figure this out).
>>>>>>> >
>>>>>>> >
>>>>>>> >
>>>>>>> >
>>>>>>> >
>>>>>>> > --
>>>>>>> > View this message in context:
>>>>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
>>>>>>> > Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>>>>> > _______________________________________________
>>>>>>> > rabbitmq-discuss mailing list
>>>>>>> > [hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=1>
>>>>>>> >
>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>> _______________________________________________
>>>>>>> rabbitmq-discuss mailing list
>>>>>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=2>
>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>
>>>>>>>
>>>>>>> ------------------------------
>>>>>>>  If you reply to this email, your message will be added to the
>>>>>>> discussion below:
>>>>>>>
>>>>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32063.html
>>>>>>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>>>>>>> here.
>>>>>>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>> ------------------------------
>>> View this message in context: Re: Lower delivery rate than publish rate
>>> - why?<http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32089.html>
>>>  Sent from the RabbitMQ mailing list archive<http://rabbitmq.1065348.n5.nabble.com/>at Nabble.com.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32095&i=1>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32095&i=2>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> ------------------------------
>>  If you reply to this email, your message will be added to the
>> discussion below:
>>
>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32095.html
>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>> here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=29247&code=bWlrZUBtZXNoZmlyZS5jb218MjkyNDd8MTYzNTUyMDM4MA==>
>> .
>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>
>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32259.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131221/2981b64b/attachment.html>

From michael.s.klishin at gmail.com  Sat Dec 21 19:13:28 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 21 Dec 2013 23:13:28 +0400
Subject: [rabbitmq-discuss] How to deal with untrusted publishers
In-Reply-To: <5be96243-11c3-4ff7-9a4e-db578acafa56@googlegroups.com>
References: <5be96243-11c3-4ff7-9a4e-db578acafa56@googlegroups.com>
Message-ID: <CAE3HoVSXh--=jA_PTFe0ZO4+_uVz==7iDeTFkQdccrZ=HcQYvQ@mail.gmail.com>

2013/12/21 Dennis Jacobfeuerborn <djacobfeuerborn at gmail.com>

> The problem is that technically I need to change the message format to
> "<publisher>.<key> <value>" so the consumer can know where to store the
> keys but for security reasons I cannot really rely on the publisher sending
> the correct data so I really need to insert the <publisher> bit on the
> broker side based on the username the publisher connects with. For example:
>
> - Publisher connects with the credentials "publisher1"/(some password)
> - Publisher sends message "mykey myvalue" to exchange X
> - Exchange X modifies the message and prepends a string containing the
> username resulting in the message "publisher1.mykey myvalue"
> - Consumer receives the message and can store the data in the appropriate
> place
>
> Is there a way to accomplish this or something similar with rabbitmq?
>

What you want to do can be accomplished with a custom exchange (a plugin
written in Erlang,
which implements an API with about 4-6 functions) or you could just add an
intermediary consumer
that's written in any that that republishes valid messages to another
exchange.

A couple more things I'd recommend:

 * Don't make routing keys too smart (encode too much information into them)
 * Use message headers or payload (serialized as JSON, Protocol Buffers or
similar) if you need to pass more info

HTH.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131221/50d42af2/attachment.html>

From videlalvaro at gmail.com  Sat Dec 21 21:10:55 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 21 Dec 2013 22:10:55 +0100
Subject: [rabbitmq-discuss] Lower delivery rate than publish rate - why?
In-Reply-To: <CALdW9ByXM5eHB38_KZc36_Lb7VveBWMF8C0gSJ=ik96U+xg41w@mail.gmail.com>
References: <bc4520ba-17ce-4f87-a4cf-1c374c3ad6e0@googlegroups.com>
 <1386901196928-32040.post@n5.nabble.com>
 <CAMcAHLV1b=F9nRp7CQo0ohTU=6qAUkUJM98y1+xKo7Kfq5aehg@mail.gmail.com>
 <CALdW9BwnLs_je13zg_4WBd-6NKemZDXry+sNXPV7ut8P=7hahw@mail.gmail.com>
 <CAMcAHLWS+utJDFEaXQK-DUKK0yugE1Q9rDSjG+A9xAaQRQb=TQ@mail.gmail.com>
 <CALdW9ByXM5eHB38_KZc36_Lb7VveBWMF8C0gSJ=ik96U+xg41w@mail.gmail.com>
Message-ID: <CAMcAHLXioBFJV0G2M63myb-z92+aW0YJcKFJT13bH_tuatbttw@mail.gmail.com>

Hi,

RabbitMQ will always prioritise sending messages to consumers that are
ready. So a slow consumer won't block others from receiving messages,
provided there's a basic.qos set, ie: not unlimited.

There's a better explanation of consumers ready here:
http://www.rabbitmq.com/consumer-priority.html

Regards,

Alvaro


On Sat, Dec 21, 2013 at 6:02 PM, MikeTempleman <mike at meshfire.com> wrote:

> We are still seeing the cycling.
>
> I wanted to ask if the round-robing scheduling could be a factor.
>
> For example, if I have 4 servers with 5 channels each on the same topic
> queue. Each channel has a prefetch setting of 50. When a channel consumer
> becomes blocked (slow db operation, overloaded with other requests, etc.),
> does that block delivery of messages to the other channels? If that
> delivery to fill the prefetch cache is delayed, is there any impact on the
> client (i.e. does it become blocked)?
>
> iow, is there a way for all channels on all servers to become blocked in a
> high load situation? Even if their prefetch caches are full?
>
> --
>
> *Mike Templeman*
> *Head of Development*
>
> T: @talkingfrog1950 <http://twitter.com/missdestructo>
> T: @Meshfire <http://twitter.com/meshfire>
>
>
>
> On Wed, Dec 18, 2013 at 10:32 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32259&i=0>
> > wrote:
>
>> Well, multi-ack didn't help very much. We can see some, but not enough to
>> matter.
>>
>> We cannot use auto-ack because consumers (multiple/server) die
>> unexpectedly as the app servers are autoscaled. We have not built a fully
>> separated service yet (too hard to debug on development machines right
>> now). But could Publisher confirms resolve the issue of servers dying with
>> n messages in their prefetch buffers?
>>
>>
>>
>> --
>>
>> *Mike Templeman *
>> *Head of Development*
>>
>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>> T: @Meshfire <http://twitter.com/meshfire>
>>
>>
>>
>> On Sun, Dec 15, 2013 at 5:02 AM, Alvaro Videla-2 [via RabbitMQ] <[hidden
>> email] <http://user/SendEmail.jtp?type=node&node=32259&i=1>> wrote:
>>
>>> Hi Mike,
>>>
>>> Yes, RabbitMQ queues are designed for fast delivery of messages and for
>>> being as empty as possible, as that blog post explains.
>>>
>>> Another interesting blog post, about consumer strategies and basic.qos
>>> settings is this one:
>>> http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/#more-276
>>>
>>> re multi ack: yes, that might help.
>>>
>>> Regards,
>>>
>>> Alvaro
>>>
>>>
>>> On Sat, Dec 14, 2013 at 2:15 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32095&i=0>
>>> > wrote:
>>>
>>>> I realized that was a bad interpretation. Sorry. The exchange is just
>>>> successfully routing all the messages to the target queues.
>>>>
>>>> After reading a number of posts and this blog entry (
>>>> http://www.rabbitmq.com/blog/2011/09/24/sizing-your-rabbits/) I wonder
>>>> if the issue is that each message is ack'd. It seemed that the issue
>>>> occurred when I had a large backlog in the queues. When Rabbit is empty,
>>>> performance is fine. When the consumers tried to run at much higher speeds,
>>>> we encountered this cycling.
>>>>
>>>> We have run a brief test with no-ack, not on production, and the
>>>> performance is excellent even under load. But this is not a viable solution
>>>> (appservers crash, autoscaling shuts servers down that have prefetched
>>>> messages and are still connected to rabbit) without a full redesign.
>>>>
>>>> Assuming each queue is only one thread (I assume it handles both
>>>> receipt, delivery, and ack cleanup) then I can understand what might happen
>>>> when the consumers generate ~500 acks/s while new messages are coming in at
>>>> a low 50-100/s rate on a specific queue. I will move out some events that
>>>> tend to generate peaks into their own queue and accept that queue
>>>> processing more slowly. As for separating the real worker queue, I suppose
>>>> I could create 2 or so static queues to divide the load up.
>>>>
>>>> So what I think I can do is:
>>>> 1. bump the default tcp buffer from 128KB to around 10MB. The added
>>>> buffering may help a little
>>>> 2. see if I can find out how to set the multiple ack flag. We are using
>>>> Grails so maybe that is just creating a custom bean. I don't know
>>>> 3. create a couple of queues for lower-priority events specifically
>>>> events chosen to be less time critical.
>>>> 4. if all that doesn't work then probably create 4 queues for the high
>>>> priority events, randomly publish to those queues, and put consumers for
>>>> each queue.
>>>> 5. Also, upgrade the server to the latest version.
>>>>
>>>> Mike Templeman
>>>>
>>>> --
>>>>
>>>> *Mike Templeman*
>>>> *Head of Development*
>>>>
>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>
>>>>
>>>>
>>>> On Fri, Dec 13, 2013 at 1:42 PM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=0>
>>>> > wrote:
>>>>
>>>>> I noticed something else very odd.
>>>>>
>>>>> Currently, one queue has 43,000 messages backed up in its queue. But
>>>>> when I look at the exchange (there is only one exchange) I see that the
>>>>> message rate in exactly matches the message rate out.
>>>>>
>>>>> With such a huge backlog, why would that be? I would have thought that
>>>>> the consumers (there are 16 total distributed across 4 systems for that
>>>>> queue with a prefetch of 100) would run at a much higher steady state.
>>>>>
>>>>> This exchange also seems to cycle regularly. It appears to run from a
>>>>> low of around 60/s in and out to 500+ a second in and out.
>>>>>
>>>>>  --
>>>>>
>>>>> *Mike Templeman*
>>>>> *Head of Development*
>>>>>
>>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>>
>>>>>
>>>>>
>>>>> On Fri, Dec 13, 2013 at 10:40 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=1>
>>>>> > wrote:
>>>>>
>>>>>> Also, from observing the Connections screen on the web UI shows that
>>>>>> no flow control has been recently turned on for any of the four current
>>>>>> connections (four app servers).
>>>>>>
>>>>>> --
>>>>>>
>>>>>> *Mike Templeman *
>>>>>> *Head of Development*
>>>>>>
>>>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Fri, Dec 13, 2013 at 10:17 AM, Mike Templeman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32089&i=2>
>>>>>> > wrote:
>>>>>>
>>>>>>> Hi Alvaro
>>>>>>>
>>>>>>> I would be more than happy to provide logs. But all they have in
>>>>>>> them is connection and shutdown information. Nothing more. I have just
>>>>>>> enabled tracing on the vhost and will send the logs shortly. We encounter
>>>>>>> this issue when under load every day now.
>>>>>>>
>>>>>>> Let me tell you our architecture and deployment:
>>>>>>>
>>>>>>> rabbitMQ:
>>>>>>>
>>>>>>>    - m1.large ec2 instance. Version: RabbitMQ 3.1.5,  Erlang R14B04
>>>>>>>    - 23 queues (transaction and direct)
>>>>>>>    - 3 exchanges used, two fanout and one topic exchange
>>>>>>>    - topic exchange
>>>>>>>    - Topic exchange overview is attached.
>>>>>>>    - 46 total channels.
>>>>>>>
>>>>>>>
>>>>>>> AppServers
>>>>>>>
>>>>>>>    - m1.large tomcat servers running grails application
>>>>>>>    - 2-7 servers at any one time.
>>>>>>>    - Consume + publish
>>>>>>>    - On busy queues, each server has 16 consumers with prefetch at
>>>>>>>    100
>>>>>>>    - message sizes on busy queues are ~4KB.
>>>>>>>    - publishing rates on busiest queue ranges from 16/s to >100/s.
>>>>>>>    (We need to be able to support 1000/s).
>>>>>>>
>>>>>>>
>>>>>>> Each AppServer connects to a sharded mongodb cluster of 3 shards.
>>>>>>> Our first suspicion was that something in Mongo or AWS was causing the
>>>>>>> periodic delay but AWS techs looked into our volume use and said we were
>>>>>>> only use 25% of available bandwidth.
>>>>>>>
>>>>>>> At this moment, we have a modest publish rate (~50-60/s) but a
>>>>>>> backlog of 50,000 messages for the queue "user". You can see a 10 minute
>>>>>>> snapshot of the queue and see the cycling.
>>>>>>>
>>>>>>> I turned on tracing but the results don't seem to becoming into the
>>>>>>> log. Is there another way to enable reporting of flow control?
>>>>>>>
>>>>>>> Mike Templeman
>>>>>>>
>>>>>>>
>>>>>>>  --
>>>>>>>
>>>>>>> *Mike Templeman*
>>>>>>> *Head of Development*
>>>>>>>
>>>>>>> T: @talkingfrog1950 <http://twitter.com/missdestructo>
>>>>>>> T: @Meshfire <http://twitter.com/meshfire>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On Fri, Dec 13, 2013 at 6:03 AM, Alvaro Videla-2 [via RabbitMQ] <[hidden
>>>>>>> email] <http://user/SendEmail.jtp?type=node&node=32089&i=3>> wrote:
>>>>>>>
>>>>>>>> Mike,
>>>>>>>>
>>>>>>>> Would you be able to provide information more information to help
>>>>>>>> us
>>>>>>>> debug the problem?
>>>>>>>>
>>>>>>>> Tim (from the rabbitmq team) requested more info in order to try to
>>>>>>>> find answers for this.
>>>>>>>>
>>>>>>>> For example, when consumption drops to zero, are there any logs on
>>>>>>>> the
>>>>>>>> rabbitmq server that might tell of a flow control mechanism being
>>>>>>>> activated?
>>>>>>>>
>>>>>>>> Regards,
>>>>>>>>
>>>>>>>> Alvaro
>>>>>>>>
>>>>>>>>
>>>>>>>> On Fri, Dec 13, 2013 at 2:19 AM, MikeTempleman <[hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=0>>
>>>>>>>> wrote:
>>>>>>>>
>>>>>>>> > Tyson
>>>>>>>> >
>>>>>>>> > Did you ever find an answer to this question? We are encountering
>>>>>>>> virtually
>>>>>>>> > the exact same problem.
>>>>>>>> >
>>>>>>>> > We have a variable number of servers setup as producers and
>>>>>>>> consumers and
>>>>>>>> > see our throughput drop to zero on a periodic basis. This is most
>>>>>>>> severe
>>>>>>>> > when there are a few hundred thousand messages on rabbit.
>>>>>>>> >
>>>>>>>> > Did you just drop Rabbit? Ours is running on an m1.large instance
>>>>>>>> with RAID0
>>>>>>>> > ephemeral drives, so size and performance of the disk subsystem
>>>>>>>> is not an
>>>>>>>> > issue (we are still in beta). We have spent untold hours tuning
>>>>>>>> our sharded
>>>>>>>> > mongodb subsystem only to find out that it is only being 25%
>>>>>>>> utilized (at
>>>>>>>> > least it will be blazing fast if we ever figure this out).
>>>>>>>> >
>>>>>>>> >
>>>>>>>> >
>>>>>>>> >
>>>>>>>> >
>>>>>>>> > --
>>>>>>>> > View this message in context:
>>>>>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32040.html
>>>>>>>> > Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>>>>>> > _______________________________________________
>>>>>>>> > rabbitmq-discuss mailing list
>>>>>>>> > [hidden email]<http://user/SendEmail.jtp?type=node&node=32063&i=1>
>>>>>>>> >
>>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>> _______________________________________________
>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32063&i=2>
>>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>
>>>>>>>>
>>>>>>>> ------------------------------
>>>>>>>>  If you reply to this email, your message will be added to the
>>>>>>>> discussion below:
>>>>>>>>
>>>>>>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32063.html
>>>>>>>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>>>>>>>> here.
>>>>>>>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>> ------------------------------
>>>> View this message in context: Re: Lower delivery rate than publish
>>>> rate - why?<http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32089.html>
>>>>  Sent from the RabbitMQ mailing list archive<http://rabbitmq.1065348.n5.nabble.com/>at Nabble.com.
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32095&i=1>
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> [hidden email] <http://user/SendEmail.jtp?type=node&node=32095&i=2>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>> ------------------------------
>>>  If you reply to this email, your message will be added to the
>>> discussion below:
>>>
>>> http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32095.html
>>>  To unsubscribe from Lower delivery rate than publish rate - why?, click
>>> here.
>>> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>>
>>
>>
>
> ------------------------------
> View this message in context: Re: Lower delivery rate than publish rate -
> why?<http://rabbitmq.1065348.n5.nabble.com/Lower-delivery-rate-than-publish-rate-why-tp29247p32259.html>
> Sent from the RabbitMQ mailing list archive<http://rabbitmq.1065348.n5.nabble.com/>at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131221/32bc60a1/attachment.html>

From sid.young at gmail.com  Sun Dec 22 03:17:08 2013
From: sid.young at gmail.com (Sid Young)
Date: Sat, 21 Dec 2013 19:17:08 -0800 (PST)
Subject: [rabbitmq-discuss] amqp_channel_open retrun value
Message-ID: <eae30f46-f464-4c7a-9723-69095f65e422@googlegroups.com>

Hi,

I am trying to work out how to get the return value from 
amqp_channel_open() in rabbitmq-c but it does not appear to be documented 
anywhere?

What is the easiest way to get the return value from the call in "C". I'm 
using the "C" library and the code works fine, but I want to log the status 
of the call. 

Is it some kind of RPC call made later?

Thanks

Sid
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131221/c7c2adcf/attachment.html>

From alan.antonuk at gmail.com  Sun Dec 22 05:20:05 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 21 Dec 2013 21:20:05 -0800
Subject: [rabbitmq-discuss] amqp_channel_open retrun value
In-Reply-To: <eae30f46-f464-4c7a-9723-69095f65e422@googlegroups.com>
References: <eae30f46-f464-4c7a-9723-69095f65e422@googlegroups.com>
Message-ID: <CAAt2po+r4T8exsyh1Kz1WmzZDAZpuOBzmEmm6E9NP65yziW_3w@mail.gmail.com>

For RPC functions that are defined in amqp_framing.h; if they return a
non-NULL value, the actual RPC call was successful. If they return a NULL
value, you should call the amqp_last_rpc_reply() to get information on why
the call failed.

Read the documentation here:
https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L1635for
further details

-Alan


On Sat, Dec 21, 2013 at 7:17 PM, Sid Young <sid.young at gmail.com> wrote:

> Hi,
>
> I am trying to work out how to get the return value from
> amqp_channel_open() in rabbitmq-c but it does not appear to be documented
> anywhere?
>
> What is the easiest way to get the return value from the call in "C". I'm
> using the "C" library and the code works fine, but I want to log the status
> of the call.
>
> Is it some kind of RPC call made later?
>
> Thanks
>
> Sid
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131221/c3ed3277/attachment.html>

From arachweb at gmail.com  Sun Dec 22 17:35:16 2013
From: arachweb at gmail.com (Paul Bell)
Date: Sun, 22 Dec 2013 12:35:16 -0500
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <5297651F.7010801@ontrenet.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
 <5297651F.7010801@ontrenet.com>
Message-ID: <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>

Simon, Alvaro, and Darren,

Thank you for your helpful replies. I apologize for dropping the ball on
this thread. I remain acutely interested in this topic, just been busy...

So let me add an element to the HA cluster environment: suppose I have two
HA clusters, perhaps geographically separated. The two clusters are
connected via the Shovel plugin. Some questions:

a. First, do I rightly assume that it's possible to connect HA clusters via
Shovel?

b. If my component on cluster A publishes a message to its local broker,
will that message get sent via Shovel to the remote cluster? I think what
I'm asking here concerns whether or not *my* component must publish to the
Shovel itself, or does the cluster "know" to propagate the message via
Shovel? I ask this because I'm wondering how far I can push the mirroring
capabilities of the logical broker. I seem to recall that the local end of
a Shovel would appear to local components as a regular exchange.

c. Finally, does Shovel permit more than two peer clusters or, if I had 3
clusters, would I need 3 Shovels interconnecting them?

Thanks again.

-Paul



On Thu, Nov 28, 2013 at 10:45 AM, Darren Govoni <darren at ontrenet.com> wrote:

> It should also be noted that if the "master" node for an HA queue becomes
> inactive a new one is elected.
>
>
> On 11/28/2013 10:12 AM, Alvaro Videla wrote:
>
>> Hi,
>>
>> On Thu, Nov 28, 2013 at 2:36 PM, Paul <arachweb at gmail.com> wrote:
>>
>>  My concern is that in an HA Queue implementation, a given message could
>>> be consumed more than once, i.e., once on computer A and once on B.
>>> Consequently, the same unit of work will be executed twice, and that's no
>>> good.
>>>
>> No. RabbitMQ will ensure that a message will be seen by just one
>> consumer. If a message arrived to queue Q, which is mirrored on node A
>> and node B, the message will be replicated across those nodes, but
>> still RabbitMQ will send the message to just one consumer. HA queues
>> have a master node and it will synchronise work with the slave queues.
>>
>> Of course what Simon says above also applies. If a message got routed
>> to more than one queue, then that particular message could be seen by
>> more than one consumer, but that doesn't seem to be what you are
>> asking here.
>>
>> For a particular queue (whether HA or not) messages are delivered just
>> once. If the consumer is in ack mode and it crashes before acking,
>> then yes, that message will be requeued and delivered again.
>>
>> Also one recommendation, although not easy to achieve, is to have
>> idempotent consumers.
>>
>> Regards,
>>
>> Alvaro
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131222/3488c21d/attachment.html>

From michael.s.klishin at gmail.com  Sun Dec 22 17:42:19 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 22 Dec 2013 21:42:19 +0400
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
 <5297651F.7010801@ontrenet.com>
 <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>
Message-ID: <CAE3HoVSkeYrLxS=pEJ_FH5sAyAqG3yp2535MBf-Lt4FZX9A+HA@mail.gmail.com>

2013/12/22 Paul Bell <arachweb at gmail.com>

> a. First, do I rightly assume that it's possible to connect HA clusters
> via Shovel?
>

Yes. Shovel or (exchange) Federation.


>
> b. If my component on cluster A publishes a message to its local broker,
> will that message get sent via Shovel to the remote cluster? I think what
> I'm asking here concerns whether or not *my* component must publish to the
> Shovel itself, or does the cluster "know" to propagate the message via
> Shovel? I ask this because I'm wondering how far I can push the mirroring
> capabilities of the logical broker. I seem to recall that the local end of
> a Shovel would appear to local components as a regular exchange.
>

Shovel and exchange federation basically replicate message streams of an
exchange
to another node/cluster. Queue federation distributes queue contents
between nodes/clusters
(this is NOT replication but rather a form of partitioning).


> c. Finally, does Shovel permit more than two peer clusters or, if I had 3
> clusters, would I need 3 Shovels interconnecting them?
>

Shovel connects two nodes. You can connect node A to B, then B to C.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131222/ffe31368/attachment.html>

From arachweb at gmail.com  Sun Dec 22 17:52:50 2013
From: arachweb at gmail.com (Paul Bell)
Date: Sun, 22 Dec 2013 12:52:50 -0500
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CAE3HoVSkeYrLxS=pEJ_FH5sAyAqG3yp2535MBf-Lt4FZX9A+HA@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
 <5297651F.7010801@ontrenet.com>
 <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>
 <CAE3HoVSkeYrLxS=pEJ_FH5sAyAqG3yp2535MBf-Lt4FZX9A+HA@mail.gmail.com>
Message-ID: <CA+ttMd94bBrsJoc--vwmaTL_xAw_4CsmZ17Xt091x6QS2UUGkA@mail.gmail.com>

Thanks, Michael.

I was looking at http://www.rabbitmq.com/shovel.html when your post
appeared. The language on that page speaks in terms of source and
destination brokers. Does this mean that Shovel is one way? Put otherwise,
if Cluster 1 is source and Cluster 2 destination, can Cluster 2 also act as
source; or would such a configuration/use require 2 Shovels, one for each
direction?

-Paul


On Sun, Dec 22, 2013 at 12:42 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/12/22 Paul Bell <arachweb at gmail.com>
>
>> a. First, do I rightly assume that it's possible to connect HA clusters
>> via Shovel?
>>
>
> Yes. Shovel or (exchange) Federation.
>
>
>>
>> b. If my component on cluster A publishes a message to its local broker,
>> will that message get sent via Shovel to the remote cluster? I think what
>> I'm asking here concerns whether or not *my* component must publish to the
>> Shovel itself, or does the cluster "know" to propagate the message via
>> Shovel? I ask this because I'm wondering how far I can push the mirroring
>> capabilities of the logical broker. I seem to recall that the local end of
>> a Shovel would appear to local components as a regular exchange.
>>
>
> Shovel and exchange federation basically replicate message streams of an
> exchange
> to another node/cluster. Queue federation distributes queue contents
> between nodes/clusters
> (this is NOT replication but rather a form of partitioning).
>
>
>> c. Finally, does Shovel permit more than two peer clusters or, if I had 3
>> clusters, would I need 3 Shovels interconnecting them?
>>
>
> Shovel connects two nodes. You can connect node A to B, then B to C.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131222/a1c33e9c/attachment.html>

From michael.s.klishin at gmail.com  Sun Dec 22 17:56:47 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 22 Dec 2013 21:56:47 +0400
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CA+ttMd94bBrsJoc--vwmaTL_xAw_4CsmZ17Xt091x6QS2UUGkA@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
 <5297651F.7010801@ontrenet.com>
 <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>
 <CAE3HoVSkeYrLxS=pEJ_FH5sAyAqG3yp2535MBf-Lt4FZX9A+HA@mail.gmail.com>
 <CA+ttMd94bBrsJoc--vwmaTL_xAw_4CsmZ17Xt091x6QS2UUGkA@mail.gmail.com>
Message-ID: <CAE3HoVR7+Rz85cRqzBDaNBgxY2_Da2nLURTOTVXP5qShGvjpHQ@mail.gmail.com>

2013/12/22 Paul Bell <arachweb at gmail.com>

> I was looking at http://www.rabbitmq.com/shovel.html when your post
> appeared. The language on that page speaks in terms of source and
> destination brokers. Does this mean that Shovel is one way? Put otherwise,
> if Cluster 1 is source and Cluster 2 destination, can Cluster 2 also act as
> source; or would such a configuration/use require 2 Shovels, one for each
> direction?
>

I believe it can but if you are looking for more sophisticated replication
setups,
take a look at federated exchanges:

http://www.rabbitmq.com/federated-exchanges.html

(note the max-hops setting)
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131222/71231569/attachment.html>

From sid.young at gmail.com  Mon Dec 23 00:14:20 2013
From: sid.young at gmail.com (Sid Young)
Date: Mon, 23 Dec 2013 10:14:20 +1000
Subject: [rabbitmq-discuss] amqp_channel_open retrun value
In-Reply-To: <CAAt2po+r4T8exsyh1Kz1WmzZDAZpuOBzmEmm6E9NP65yziW_3w@mail.gmail.com>
References: <eae30f46-f464-4c7a-9723-69095f65e422@googlegroups.com>
 <CAAt2po+r4T8exsyh1Kz1WmzZDAZpuOBzmEmm6E9NP65yziW_3w@mail.gmail.com>
Message-ID: <CAEZ+gOyRAsPFM5xZj8rF5XVE1uEDA7T5HQ_cqQU7CORw4avgvw@mail.gmail.com>

Thanks Alan,

So do I need to call:

   AMQP_PUBLIC_FUNCTION amqp_rpc_reply_t AMQP_CALL
amqp_get_rpc_reply(amqp_connection_state_t state);

after the call to get the reply status?

Sid



On Sun, Dec 22, 2013 at 3:20 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:

> For RPC functions that are defined in amqp_framing.h; if they return a
> non-NULL value, the actual RPC call was successful. If they return a NULL
> value, you should call the amqp_last_rpc_reply() to get information on why
> the call failed.
>
> Read the documentation here:
> https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L1635for further details
>
> -Alan
>
>
> On Sat, Dec 21, 2013 at 7:17 PM, Sid Young <sid.young at gmail.com> wrote:
>
>> Hi,
>>
>> I am trying to work out how to get the return value from
>> amqp_channel_open() in rabbitmq-c but it does not appear to be documented
>> anywhere?
>>
>> What is the easiest way to get the return value from the call in "C". I'm
>> using the "C" library and the code works fine, but I want to log the status
>> of the call.
>>
>> Is it some kind of RPC call made later?
>>
>> Thanks
>>
>> Sid
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/eb536bc5/attachment.html>

From alan.antonuk at gmail.com  Mon Dec 23 04:18:01 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sun, 22 Dec 2013 20:18:01 -0800
Subject: [rabbitmq-discuss] amqp_channel_open retrun value
In-Reply-To: <CAEZ+gOyRAsPFM5xZj8rF5XVE1uEDA7T5HQ_cqQU7CORw4avgvw@mail.gmail.com>
References: <eae30f46-f464-4c7a-9723-69095f65e422@googlegroups.com>
 <CAAt2po+r4T8exsyh1Kz1WmzZDAZpuOBzmEmm6E9NP65yziW_3w@mail.gmail.com>
 <CAEZ+gOyRAsPFM5xZj8rF5XVE1uEDA7T5HQ_cqQU7CORw4avgvw@mail.gmail.com>
Message-ID: <CAAt2poJs-KxB-zWtD0UfHCciENW7fhXT4Qge0128jv9JinOzdg@mail.gmail.com>

amqp_channel_open() is considered successful if it returns a non-NULL
value. If and only if amqp_channel_open() returns NULL the call has failed,
and you should call amqp_get_rpc_reply() to get further information about
the failure.

-Alan


On Sun, Dec 22, 2013 at 4:14 PM, Sid Young <sid.young at gmail.com> wrote:

> Thanks Alan,
>
> So do I need to call:
>
>    AMQP_PUBLIC_FUNCTION amqp_rpc_reply_t AMQP_CALL amqp_get_rpc_reply(amqp_connection_state_t state);
>
> after the call to get the reply status?
>
> Sid
>
>
>
> On Sun, Dec 22, 2013 at 3:20 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:
>
>> For RPC functions that are defined in amqp_framing.h; if they return a
>> non-NULL value, the actual RPC call was successful. If they return a NULL
>> value, you should call the amqp_last_rpc_reply() to get information on why
>> the call failed.
>>
>> Read the documentation here:
>> https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L1635for further details
>>
>> -Alan
>>
>>
>> On Sat, Dec 21, 2013 at 7:17 PM, Sid Young <sid.young at gmail.com> wrote:
>>
>>> Hi,
>>>
>>> I am trying to work out how to get the return value from
>>> amqp_channel_open() in rabbitmq-c but it does not appear to be documented
>>> anywhere?
>>>
>>> What is the easiest way to get the return value from the call in "C".
>>> I'm using the "C" library and the code works fine, but I want to log the
>>> status of the call.
>>>
>>> Is it some kind of RPC call made later?
>>>
>>> Thanks
>>>
>>> Sid
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131222/d1bd372b/attachment.html>

From sid.young at gmail.com  Mon Dec 23 05:38:26 2013
From: sid.young at gmail.com (Sid Young)
Date: Mon, 23 Dec 2013 15:38:26 +1000
Subject: [rabbitmq-discuss] amqp_channel_open retrun value
In-Reply-To: <CAAt2poJs-KxB-zWtD0UfHCciENW7fhXT4Qge0128jv9JinOzdg@mail.gmail.com>
References: <eae30f46-f464-4c7a-9723-69095f65e422@googlegroups.com>
 <CAAt2po+r4T8exsyh1Kz1WmzZDAZpuOBzmEmm6E9NP65yziW_3w@mail.gmail.com>
 <CAEZ+gOyRAsPFM5xZj8rF5XVE1uEDA7T5HQ_cqQU7CORw4avgvw@mail.gmail.com>
 <CAAt2poJs-KxB-zWtD0UfHCciENW7fhXT4Qge0128jv9JinOzdg@mail.gmail.com>
Message-ID: <CAEZ+gOyp6Sp5mYgq-LWXNPZ+kaiHfBKaG0GEvoWZdN4jRNKfQQ@mail.gmail.com>

Ok thanks, thats very clear :)

I have another question about consuming messages, but I'm going to read the
spec first then get back to you.


Sid






On Mon, Dec 23, 2013 at 2:18 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:

> amqp_channel_open() is considered successful if it returns a non-NULL
> value. If and only if amqp_channel_open() returns NULL the call has failed,
> and you should call amqp_get_rpc_reply() to get further information about
> the failure.
>
> -Alan
>
>
> On Sun, Dec 22, 2013 at 4:14 PM, Sid Young <sid.young at gmail.com> wrote:
>
>> Thanks Alan,
>>
>> So do I need to call:
>>
>>    AMQP_PUBLIC_FUNCTION amqp_rpc_reply_t AMQP_CALL amqp_get_rpc_reply(amqp_connection_state_t state);
>>
>>
>> after the call to get the reply status?
>>
>> Sid
>>
>>
>>
>> On Sun, Dec 22, 2013 at 3:20 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:
>>
>>> For RPC functions that are defined in amqp_framing.h; if they return a
>>> non-NULL value, the actual RPC call was successful. If they return a NULL
>>> value, you should call the amqp_last_rpc_reply() to get information on why
>>> the call failed.
>>>
>>> Read the documentation here:
>>> https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L1635for further details
>>>
>>> -Alan
>>>
>>>
>>> On Sat, Dec 21, 2013 at 7:17 PM, Sid Young <sid.young at gmail.com> wrote:
>>>
>>>> Hi,
>>>>
>>>> I am trying to work out how to get the return value from
>>>> amqp_channel_open() in rabbitmq-c but it does not appear to be documented
>>>> anywhere?
>>>>
>>>> What is the easiest way to get the return value from the call in "C".
>>>> I'm using the "C" library and the code works fine, but I want to log the
>>>> status of the call.
>>>>
>>>> Is it some kind of RPC call made later?
>>>>
>>>> Thanks
>>>>
>>>> Sid
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Sid Young
0458 396 300
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/a8d4bf86/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 23 06:37:24 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 23 Dec 2013 10:37:24 +0400
Subject: [rabbitmq-discuss] ANN Langohr 2.0.1 is released
Message-ID: <CAE3HoVTUV4hy2ZFr8dy_KpYSH-NLVNhq=zH9Vj6tUviid0eQRQ@mail.gmail.com>

Langohr [1] is a feature complete Clojure client for RabbitMQ.

2.0.1 is a bug fix release. Release notes:
http://blog.clojurewerkz.org/blog/2013/12/22/langohr-2-dot-0-1-is-released/

1. http://clojurerabbitmq.info

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/dcfe8ee1/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 23 06:39:20 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 23 Dec 2013 10:39:20 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.1.8 is released
Message-ID: <CAE3HoVT--YZwWUT_sEVMeTQE_qQTOusEQZQnrJwP4W6tWVcmtQ@mail.gmail.com>

amqp gem 1.1.8 is released [1].

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/12/22/amqp-1-dot-1-8-is-released/

1. https://rubygems.org/gems/amqp/versions/1.1.8
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/17cb37d1/attachment.html>

From sid.young at gmail.com  Mon Dec 23 06:59:15 2013
From: sid.young at gmail.com (Sid Young)
Date: Mon, 23 Dec 2013 16:59:15 +1000
Subject: [rabbitmq-discuss] Errors using AMQPCPP Library example
Message-ID: <CAEZ+gOyFF++HEdqQ=jAMpUnsosyEpQjiOavjMF_jdTmRqcDcGA@mail.gmail.com>

I have been trying to use the AMQPCPP library and when I tired to do a get
on a queue with some messages in it using the example_get application
supplied with the library, I received the following error:

server channel error 406, message: PRECONDITION_FAILED - parameters for
queue 'asx_save2db' in vhost '/' not equivalent class=50 method=10


Is the original author "akalend" on this list?
Is there any documentation on using the library, it look reasonably good,
has the functionalit I need for my C++ code and compiled with no issues
under Centos6.4


Sid
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/eff095da/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 23 07:04:46 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 23 Dec 2013 11:04:46 +0400
Subject: [rabbitmq-discuss] Errors using AMQPCPP Library example
In-Reply-To: <CAEZ+gOyFF++HEdqQ=jAMpUnsosyEpQjiOavjMF_jdTmRqcDcGA@mail.gmail.com>
References: <CAEZ+gOyFF++HEdqQ=jAMpUnsosyEpQjiOavjMF_jdTmRqcDcGA@mail.gmail.com>
Message-ID: <CAE3HoVS+HWDZGVuYPBF3xDMBeV3Py=kRqzWCh3OqzaZcKXaN+Q@mail.gmail.com>

2013/12/23 Sid Young <sid.young at gmail.com>

> server channel error 406, message: PRECONDITION_FAILED - parameters for
> queue 'asx_save2db' in vhost '/' not equivalent class=50 method=10


This means you declare queue asx_save2db with properties different from
those it already has.
There is nothing library-specific about it.

Use RabbitMQ management UI or rabbitmqctl list_queues to find out what they
are.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/2ca3b241/attachment.html>

From haster2004 at yandex.ru  Mon Dec 23 08:12:06 2013
From: haster2004 at yandex.ru (Haster)
Date: Mon, 23 Dec 2013 00:12:06 -0800 (PST)
Subject: [rabbitmq-discuss] [rabbitmq_c] Infinite wait in
	login_with_properties function
Message-ID: <1387786326818-32275.post@n5.nabble.com>

Hi there!

Today I have caught a bug that my program could not stop.
I used a gdb and found that application was on recv method. Call stack:

#0  0x0000003435c0dc81 in recv () from /lib64/libpthread.so.0
#1  0x00002aaaad84ead1 in ?? () from
/import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
#2  0x00002aaaad84be83 in ?? () from
/import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
#3  0x00002aaaad84c19e in ?? () from
/import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
#4  0x00002aaaad84c72c in amqp_simple_wait_method ()
   from
/import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
#5  0x00002aaaad84cab6 in ?? () from
/import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
#6  0x00002aaaad84ce8a in amqp_login_with_properties ()
   from
/import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
#7  0x00002aaaad626313 in RabbitMQ::RabbitMQConnectionImpl::connect
(this=0xfaf3a00, hostName=...,
    portNumber=<value optimized out>, userName=..., userPwd=...,
heartbeat=0, vhost=...)
    at rabbitmq_source/rabbitmq_connector/RabbitMQConnectionImpl.cpp:115
#8  0x00002aaaad60d900 in rabbitmq_ns::consumer_impl::execute
(this=0xb4579d8) at rabbitmq_source/rabbitmq_impl.cpp:823
#9  0x00002b25bdde1aa3 in threads::thread_proc (thr_ptr=0xb4579d8) at
has_common_source/source/cpp/threads.cpp:225
#10 0x0000003435c0673d in start_thread () from /lib64/libpthread.so.0
#11 0x00000034350d40cd in clone () from /lib64/libc.so.6

So, method login_with_properties is blocked, and there is some usecase where
program execute amqp_send_header in amqp_login_inner without errors but
can't get data from amqp_simple_wait_method.

Maybe rabbitmq_c needs nonblock login method? 




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-Infinite-wait-in-login-with-properties-function-tp32275.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From peter.moon at vce.com  Fri Dec 20 18:21:03 2013
From: peter.moon at vce.com (Peter Moon)
Date: Fri, 20 Dec 2013 10:21:03 -0800 (PST)
Subject: [rabbitmq-discuss] Ability to log module & timestamp in startup
	and shutdown_log
In-Reply-To: <52B2CFA2.4050405@rabbitmq.com>
References: <1387397542306-32206.post@n5.nabble.com>
 <52B2CFA2.4050405@rabbitmq.com>
Message-ID: <1387563663852-32257.post@n5.nabble.com>

Hi Simon, 

So from your previous email it seems that turning on a log_level or other
switch in the above URL will not help with my request - i.e. the bracket
fields denote information that I would like to get in the logs.

thanks

Peter

<timestamp> <module responsible> starting alarm handler                                               
...done
starting node monitor                                                
...done



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Ability-to-log-module-timestamp-in-startup-and-shutdown-log-tp32206p32257.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From KarrasT at Pragmatics.com  Fri Dec 20 20:12:16 2013
From: KarrasT at Pragmatics.com (Karras, Thomas)
Date: Fri, 20 Dec 2013 15:12:16 -0500
Subject: [rabbitmq-discuss] ssl ciphers with federation
Message-ID: <62573470865EAA41A09BB261D33F2DDF0498DA@pragmail3.pragmatics.com>

Hi, 

 

I'm having some issues using federation with SSL. We are using a FIPS
openSSL client and the default SSL cipher seems to use md5 which is not
allowed. This causes the following error when trying to start up
rabbitMQ without setting a specific cipher.

 

md5_dgst.c(78): OpenSSL internal error, assertion failed: Digest MD5
forbidden in FIPS mode!

 

This error goes away and RabbitMQ starts up fine when a cipher is set in
the rabbitmq.config file. The problem comes up again when we set up
federation over SSL. In the latest version of RabbitMQ(3.2.2) there does
not seem to be a place to set up ssl_options for the federation
configuration, so once we setup a new upstream with SSL the server
crashes with the same MD5 forbidden error. Is there a way to default
erlang or maybe another parameter in the federation plugin where I can
set the SSL cipher for the federation client?

 

Thanks,

 

Thomas Karras

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131220/fd094482/attachment.html>

From anumu001 at gmail.com  Mon Dec 23 10:31:58 2013
From: anumu001 at gmail.com (prem kumar Anumula)
Date: Mon, 23 Dec 2013 16:01:58 +0530
Subject: [rabbitmq-discuss] unable to join to cluster nodes
Message-ID: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>

Hi all,

I installed two rabbitmq server nodes in two different VMs, executed
 following steps in two nodes but unable to join the second node to Cluster.

node 1:

[root at localhost ~]#  rabbitmq-server -detached
Warning: PID file not written; -detached was passed.

[root at localhost ~]#  rabbitmqctl cluster_status
Cluster status of node rabbit at localhost ...
[{nodes,[{disc,[rabbit at localhost]}]},
 {running_nodes,[rabbit at localhost]},
 {partitions,[]}]
...done.

node 2:
[root at localhost ~]# rabbitmq-server -detached
Warning: PID file not written; -detached was passed.
[root at localhost ~]# rabbitmqctl cluster_status
Cluster status of node rabbit at localhost ...
[{nodes,[{disc,[rabbit at localhost]}]},
 {running_nodes,[rabbit at localhost]},
 {partitions,[]}]
...done.
*[root at localhost ~]# rabbitmqctl join_cluster rabbit at 10.0.0.190
<rabbit at 10.0.0.190> *
*Clustering node rabbit at localhost with 'rabbit at 10.0.0.190
<rabbit at 10.0.0.190>' ...*
*Error: mnesia_unexpectedly_running*

Cokiee Hash is same on both nodes, 10.0.0.190 is server node1.
please let me what i am doing wrong and how can resolve this...

rgds
prem
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/a127eaeb/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 23 11:00:03 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 23 Dec 2013 15:00:03 +0400
Subject: [rabbitmq-discuss] unable to join to cluster nodes
In-Reply-To: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
References: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
Message-ID: <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>

2013/12/23 prem kumar Anumula <anumu001 at gmail.com>

> *[root at localhost ~]# rabbitmqctl join_cluster rabbit at 10.0.0.190
> <rabbit at 10.0.0.190> *
> *Clustering node rabbit at localhost with 'rabbit at 10.0.0.190
> <rabbit at 10.0.0.190>' ...*
> *Error: mnesia_unexpectedly_running*
>
> Cokiee Hash is same on both nodes, 10.0.0.190 is server node1.
> please let me what i am doing wrong and how can resolve this...
>

You need to reset the node you want to join the existing cluster.

See http://www.rabbitmq.com/clustering.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/adf8b138/attachment.html>

From anumu001 at gmail.com  Mon Dec 23 11:24:49 2013
From: anumu001 at gmail.com (prem kumar Anumula)
Date: Mon, 23 Dec 2013 16:54:49 +0530
Subject: [rabbitmq-discuss] unable to join to cluster nodes
In-Reply-To: <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>
References: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
 <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>
Message-ID: <CACMhsg6NFos8tSNnY6mQKhS74o3BMsx6L-kdjmn+DS_D70Maog@mail.gmail.com>

HI MK,

after reset it showing as follows
[root at localhost ~]# rabbitmqctl reset
Resetting node rabbit at localhost ...
...done.
[root at localhost ~]# rabbitmqctl cluster_status
Cluster status of node rabbit at localhost ...
[{nodes,[{disc,[rabbit at localhost]}]}]
...done.
[root at localhost ~]# rabbitmqctl join_cluster rabbit at 10.0.0.190
Clustering node rabbit at localhost with 'rabbit at 10.0.0.190' ...
Error: {cannot_discover_cluster,"The nodes provided are either offline or
not running"}
[root at localhost ~]# rabbitmqctl -n rabbit at 10.0.0.190 cluster_status
Cluster status of node 'rabbit at 10.0.0.190' ...
Error: unable to connect to node 'rabbit at 10.0.0.190': nodedown

=ERROR REPORT==== 23-Dec-2013::16:46:51 ===
** System NOT running to use fully qualified hostnames **
** Hostname 10.0.0.190 is illegal **

DIAGNOSTICS
===========

nodes in question: ['rabbit at 10.0.0.190']

hosts, their running nodes and ports:
- 10.0.0.190: [{rabbit,53585}]

current node details:
- node name: rabbitmqctl20226 at localhost
- home dir: /var/lib/rabbitmq
- cookie hash: YmFLx9FJO85dMOZ6jFxwgg==


Output of the commands execution highlighted with yellow.

please help me how to resolve this issues...

Regards
Prem


On Mon, Dec 23, 2013 at 4:30 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/12/23 prem kumar Anumula <anumu001 at gmail.com>
>
>> *[root at localhost ~]# rabbitmqctl join_cluster rabbit at 10.0.0.190
>> <rabbit at 10.0.0.190> *
>> *Clustering node rabbit at localhost with 'rabbit at 10.0.0.190
>> <rabbit at 10.0.0.190>' ...*
>> *Error: mnesia_unexpectedly_running*
>>
>> Cokiee Hash is same on both nodes, 10.0.0.190 is server node1.
>> please let me what i am doing wrong and how can resolve this...
>>
>
> You need to reset the node you want to join the existing cluster.
>
> See http://www.rabbitmq.com/clustering.html
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/454430fa/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 23 11:37:38 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 23 Dec 2013 15:37:38 +0400
Subject: [rabbitmq-discuss] unable to join to cluster nodes
In-Reply-To: <CACMhsg6NFos8tSNnY6mQKhS74o3BMsx6L-kdjmn+DS_D70Maog@mail.gmail.com>
References: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
 <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>
 <CACMhsg6NFos8tSNnY6mQKhS74o3BMsx6L-kdjmn+DS_D70Maog@mail.gmail.com>
Message-ID: <CAE3HoVQx7VmLDh-rQHJRpL7DosgiYNb9gJ76xrmRkaNk9mfSHw@mail.gmail.com>

2013/12/23 prem kumar Anumula <anumu001 at gmail.com>

> [root at localhost ~]# rabbitmqctl reset
> Resetting node rabbit at localhost ...
> ...done.
> [root at localhost ~]# rabbitmqctl cluster_status
>

It should be reset, then stop_app, then join_cluster, then start_app

See Creating the Cluster in http://www.rabbitmq.com/clustering.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/1ecfa650/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 23 11:41:40 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 23 Dec 2013 15:41:40 +0400
Subject: [rabbitmq-discuss] unable to join to cluster nodes
In-Reply-To: <CAE3HoVQx7VmLDh-rQHJRpL7DosgiYNb9gJ76xrmRkaNk9mfSHw@mail.gmail.com>
References: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
 <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>
 <CACMhsg6NFos8tSNnY6mQKhS74o3BMsx6L-kdjmn+DS_D70Maog@mail.gmail.com>
 <CAE3HoVQx7VmLDh-rQHJRpL7DosgiYNb9gJ76xrmRkaNk9mfSHw@mail.gmail.com>
Message-ID: <CAE3HoVR_Fw92viXjPeNsyub9ykZPFE+9tygtp5u5=w74y8Kaig@mail.gmail.com>

2013/12/23 Michael Klishin <michael.s.klishin at gmail.com>

> It should be reset, then stop_app, then join_cluster, then start_app


Better yet,

stop_app, then reset, then join_cluster, then start_app
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/d428e82b/attachment.html>

From anumu001 at gmail.com  Mon Dec 23 11:45:29 2013
From: anumu001 at gmail.com (prem kumar Anumula)
Date: Mon, 23 Dec 2013 17:15:29 +0530
Subject: [rabbitmq-discuss] unable to join to cluster nodes
In-Reply-To: <CAE3HoVR_Fw92viXjPeNsyub9ykZPFE+9tygtp5u5=w74y8Kaig@mail.gmail.com>
References: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
 <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>
 <CACMhsg6NFos8tSNnY6mQKhS74o3BMsx6L-kdjmn+DS_D70Maog@mail.gmail.com>
 <CAE3HoVQx7VmLDh-rQHJRpL7DosgiYNb9gJ76xrmRkaNk9mfSHw@mail.gmail.com>
 <CAE3HoVR_Fw92viXjPeNsyub9ykZPFE+9tygtp5u5=w74y8Kaig@mail.gmail.com>
Message-ID: <CACMhsg4EU+qYN_b77N=gZKWgC4pDS2c-L61e0Mt3LXom_fq2yA@mail.gmail.com>

hi MK

at joining cluster step i am getting following error.

[root at localhost ~]# rabbitmqctl join_cluster rabbit at 10.0.0.190
Clustering node rabbit at localhost with 'rabbit at 10.0.0.190' ...
Error: {cannot_discover_cluster,"The nodes provided are either offline or
not running"}

rgds
prem


On Mon, Dec 23, 2013 at 5:11 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> 2013/12/23 Michael Klishin <michael.s.klishin at gmail.com>
>
>> It should be reset, then stop_app, then join_cluster, then start_app
>
>
> Better yet,
>
> stop_app, then reset, then join_cluster, then start_app
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/16ba70e7/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 23 11:53:54 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 23 Dec 2013 15:53:54 +0400
Subject: [rabbitmq-discuss] unable to join to cluster nodes
In-Reply-To: <CACMhsg4EU+qYN_b77N=gZKWgC4pDS2c-L61e0Mt3LXom_fq2yA@mail.gmail.com>
References: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
 <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>
 <CACMhsg6NFos8tSNnY6mQKhS74o3BMsx6L-kdjmn+DS_D70Maog@mail.gmail.com>
 <CAE3HoVQx7VmLDh-rQHJRpL7DosgiYNb9gJ76xrmRkaNk9mfSHw@mail.gmail.com>
 <CAE3HoVR_Fw92viXjPeNsyub9ykZPFE+9tygtp5u5=w74y8Kaig@mail.gmail.com>
 <CACMhsg4EU+qYN_b77N=gZKWgC4pDS2c-L61e0Mt3LXom_fq2yA@mail.gmail.com>
Message-ID: <CAE3HoVQZ=R8uRRgxMVuwm1Jb=CvS6ERqgEoYMCMUg6+MMxZiUg@mail.gmail.com>

2013/12/23 prem kumar Anumula <anumu001 at gmail.com>

> [root at localhost ~]# rabbitmqctl join_cluster rabbit at 10.0.0.190
> Clustering node rabbit at localhost with 'rabbit at 10.0.0.190' ...
> Error: {cannot_discover_cluster,"The nodes provided are either offline or
> not running"}
>

This means that this node cannot reach 10.0.0.190 on port 4369 (epmd
[1]) or RabbitMQ is not running
on 10.0.0.190.

1. http://www.erlang.org/doc/man/epmd.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/2d8367bc/attachment.html>

From shridharan.m at gmail.com  Mon Dec 23 16:44:05 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Mon, 23 Dec 2013 08:44:05 -0800
Subject: [rabbitmq-discuss] Blocked/blocking connections & Memory
	fluctuations
In-Reply-To: <52B4367E.9020707@rabbitmq.com>
References: <CAPK6OeuqpsPWSkJBrzqinxj3uRypWYHX+r1fsfpVTins+Wr6dg@mail.gmail.com>
 <52B315AE.7040000@rabbitmq.com>
 <CAPK6Oeu8kWC3K=iJxZu1gP1JziO6tWcptY+5e2+V1+4wk4=WrA@mail.gmail.com>
 <52B32C85.7090509@rabbitmq.com>
 <CAPK6OevWQUNGUymjRrUvr91b9sA_inEPP29+8cQxM3snbUv-nA@mail.gmail.com>
 <52B4367E.9020707@rabbitmq.com>
Message-ID: <CAPK6Oev-4p26sMExP-vwOUwEH1vaLT4Ho3q0vobYHgTn18=_bg@mail.gmail.com>

Hello Simon,

      I ended up restarting the node. Here is what I saw from the logs
during management restart.

*rabbit_mochiweb_registry crash:*
*=ERROR REPORT==== 19-Dec-2013::11:50:28 ===*
*** Generic server rabbit_mochiweb_registry terminating*
*** Last message in was {add,rabbit_mgmt_redirect,*
*                            [{port,55672},{ignore_in_use,true}],*
*                            #Fun<rabbit_mochiweb.1.105980535>,*
*                            #Fun<rabbit_mochiweb.0.34137573>,*
*                            {[],"Redirect to port 15672"}}*
*** When Server state == undefined*
*** Reason for termination ==*
*** {{case_clause,*
*
{error,{no_record_for_listener,[{port,55672},{ignore_in_use,true}]}}},*
*    [{rabbit_mochiweb_registry,handle_call,3},*
*     {gen_server,handle_msg,5},*
*     {proc_lib,init_p_do_apply,3}]}*

*=INFO REPORT==== 19-Dec-2013::11:50:28 ===*
*    application: rabbitmq_management*
*    exited: {bad_return,*
*                {{rabbit_mgmt_app,start,[normal,[]]},*
*                 {'EXIT',*
*                     {{{case_clause,*
*                           {error,*
*                               {no_record_for_listener,*
*                                   [{port,55672},{ignore_in_use,true}]}}},*
*                       [{rabbit_mochiweb_registry,handle_call,3},*
*                        {gen_server,handle_msg,5},*
*                        {proc_lib,init_p_do_apply,3}]},*
*                      {gen_server,call,*
*                          [rabbit_mochiweb_registry,*
*                           {add,rabbit_mgmt_redirect,*
*                               [{port,55672},{ignore_in_use,true}],*
*                               #Fun<rabbit_mochiweb.1.105980535>,*
*                               #Fun<rabbit_mochiweb.0.34137573>,*
*                               {[],"Redirect to port 15672"}},*
*                           infinity]}}}}}*
*    type: temporary*



On Fri, Dec 20, 2013 at 4:22 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hmm. I cannot figure out how that could come to pass - it looks like there
> is a broken listener already there.
>
> You might be able to fix this by invoking
>
> $ rabbitmqctl -n rabbit eval 'rabbit_web_dispatch_sup:stop_
> listener([{port,55672},{ignore_in_use,true}]).'
>
> but if that doesn't work I think you'd have to restart the node I'm afraid.
>
> Either way, I'd be very interested to see the logs from around when you
> tried to restart the management application.
>
> Cheers, Simon
>
>
> On 19/12/13 19:38, shridharan muthu wrote:
>
>> Hello Simon,
>>
>>     I tried restarting rabbitmq management and I got the following
>> error. I am not able to use port 15672 at all.
>>
>> /sudo rabbitmqctl -n rabbit eval
>> 'application:stop(rabbitmq_management),application:start(
>> rabbitmq_management).'/
>> /{error,/
>> /    {bad_return,/
>> /        {{rabbit_mgmt_app,start,[normal,[]]},/
>> /         {'EXIT',/
>> /             {{{case_clause,/
>> /                   {error,/
>> /                       {no_record_for_listener,/
>> /                           [{port,55672},{ignore_in_use,true}]}}},/
>> /               [{rabbit_mochiweb_registry,handle_call,3},/
>> /                {gen_server,handle_msg,5},/
>> /                {proc_lib,init_p_do_apply,3}]},/
>> /              {gen_server,call,/
>> /                  [rabbit_mochiweb_registry,/
>> /                   {add,rabbit_mgmt_redirect,/
>> /                       [{port,55672},{ignore_in_use,true}],/
>> /                       #Fun<rabbit_mochiweb.1.105980535>,/
>> /                       #Fun<rabbit_mochiweb.0.34137573>,/
>> /                       {[],"Redirect to port 15672"}},/
>> /                   infinity]}}}}}}/
>> /...done./
>> /
>>
>> /
>> So, Is there anyway bring it back up without restarting the app?
>>
>> Shri
>>
>>
>> On Thu, Dec 19, 2013 at 9:27 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     On 19/12/13 16:35, shridharan muthu wrote:
>>
>>                  You are spot on Simon. We are using 3.0.2 version in our
>>         cluster. In this case, restarting node will not help I guess. Can
>> I
>>         delete these blocked/blocking connections from Management UI?
>>
>>
>>     The only way to do that is to restart the management stats database:
>>
>>     # rabbitmqctl -n <node with the stats db> eval
>>     'application:stop(rabbitmq___management),application:start(
>> __rabbitmq_management).'
>>
>>
>>
>>                Could it be cause of the blocked connections? I will
>>         check the
>>         memory usage after cleaning up the connections.
>>
>>
>>     I doubt it, those connections don't really exist except as rows in
>>     the management stats db. But note that we have fixed a few memory
>>     leaks since 3.0.2.
>>
>>              /You could use a higher priority "nodes" policy to move the
>>         master
>>
>>              to node 2, then delete it again (albeit the queue would be
>>              unmirrored while this was taking place). Oh, but you need
>>         to be on
>>              at least RabbitMQ 3.1.x for that to work, 3.0.x does not let
>> a
>>              mirroring policy move the master./
>>
>>
>>              Ah! But that would leave with tightly coupling queues to
>> nodes.
>>
>>
>>     Only until you delete the "nodes" policy - you can use that to move
>>     the master, but then revert to an "all" policy; at which point the
>>     master will stay where it is.
>>
>>              /OTOH if the queues are mirrored to all nodes anyway, why
>>         worry? A
>>
>>              slave takes about as many resources as a master anyway, so
>>         all your
>>              masters being on one node and all the slaves on the other
>>         should be
>>              no big deal.
>>              /
>>
>>         //
>>
>>               My understanding is that all operations (publish, consume)
>>         on a
>>         queue will be forwarded from slaves to the master (where it will
>> be
>>         executed and broadcasted to all mirrors) and all the messages in
>> the
>>         mirror will be used only when the master goes down.
>>
>>
>>     Yes.
>>
>>
>>         This sounds like
>>         slaves are just forwarding messages all the time (1 hop penalty)
>> and
>>         generates more traffic between slaves & the master.
>>
>>
>>     Sure, but how will distributing the masters around the cluster help
>>     that? Or are you saying your clients know that some queues are on
>>     node 2, and expect to connect to that node to use that queue? If so
>>     that makes sense...
>>
>>
>>     Cheers, Simon
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, Pivotal
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/70da9667/attachment.html>

From ggtech888 at gmail.com  Mon Dec 23 17:12:23 2013
From: ggtech888 at gmail.com (gigi)
Date: Mon, 23 Dec 2013 17:12:23 +0000 (UTC)
Subject: [rabbitmq-discuss]
	=?utf-8?q?how_to_start_rabbitmq_broker_in_a_ja?=
	=?utf-8?q?vaEE=09application?=
References: <31e65436-4204-40a8-81d8-212d7fa198ff@googlegroups.com>
 <CAE3HoVR0drAxYz5W0NCBftoRbvBUrh+DyJb=kOiSPX0LoaevGA@mail.gmail.com>
Message-ID: <loom.20131223T180705-398@post.gmane.org>

Michael Klishin <michael.s.klishin at ...> writes:

> 
> 
> 2013/12/20 gigi <ggtech888 at gmail.com>
> 
> However, it seems to me that neither is capable of starting the broker
within java application. Can someone please shed some light into this?
> 
> 
> RabbitMQ is never started by applications. It's supposed to be running by
the time apps connect to it.
> 
> It also not meant to be embedded into a JVM-based app.
> 
> ?
> 
> 
> Also, would be very grateful if more examples, code, best practice of
integrating rabbitmq with java application could be pointed out.
> 
> 
> Start at?http://www.rabbitmq.com/getstarted.html.
> 


Thank you very much for the reply, Michael. Really appreciate it

So in the enterprise app world, what do people usually do to start a
rabbitmq broker? I figured it would be naive to use a shell script to start
it before deployments of its java producer/consumers each release



From michael.s.klishin at gmail.com  Mon Dec 23 18:06:52 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 23 Dec 2013 22:06:52 +0400
Subject: [rabbitmq-discuss] how to start rabbitmq broker in a javaEE
	application
In-Reply-To: <loom.20131223T180705-398@post.gmane.org>
References: <31e65436-4204-40a8-81d8-212d7fa198ff@googlegroups.com>
 <CAE3HoVR0drAxYz5W0NCBftoRbvBUrh+DyJb=kOiSPX0LoaevGA@mail.gmail.com>
 <loom.20131223T180705-398@post.gmane.org>
Message-ID: <CAE3HoVQh5gk7KhcG-kWMCuQYj3xw2zdnWtau9Ja2PAC3Luo4YA@mail.gmail.com>

2013/12/23 gigi <ggtech888 at gmail.com>

> So in the enterprise app world, what do people usually do to start a
> rabbitmq broker? I figured it would be naive to use a shell script to start
> it before deployments of its java producer/consumers each release
>

If you install RabbitMQ via .deb or .rpm package, it should be all taken
for you by
the init scripts.

It's pretty common these days to provision services such as Rabbit using
Chef, Puppet, Pallet or similar.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/581946ba/attachment.html>

From pjwerneck at gmail.com  Mon Dec 23 20:41:49 2013
From: pjwerneck at gmail.com (Pedro Werneck)
Date: Mon, 23 Dec 2013 12:41:49 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ receiving data,
	but no messages delivered
Message-ID: <950a1a78-d365-4122-9cf1-ad4c29e53601@googlegroups.com>


We've been running RabbitMQ 3.0.2 with Erlang R14B04 for months, with no 
issues at all. Recently, our whole AWS infrastructure crashed and we had to 
rebuild some of it from scratch. Since then, we're having some strange 
problems with RabbitMQ. We have a main broker used by four applications, 
let's call them A, B, C and D, using Python 2.7 and Celery 3.0.18. 
Everything works fine when webservice instances are publishing messages and 
when worker instances are consuming messages, however, messages published 
by a worker instance of A and B never reach the queue. 

We can log the calls being made, we can sniff the network and see the 
packets leaving the worker instance, we can see the packets arriving at the 
RabbitMQ instance, and if we open the given Connection in the RabbitMQ 
management plugin we even see data arriving at a rate of 25kb/s, but no 
messages are delivered. The exchange and bindings are correct, since they 
work for other cases, and we can see the exchange and routing key are not 
corrupted or anything when sniffing the packets. If the message is sent by 
the exact same code and settings from a webservice instance or a 
shellscript, everything is fine, but when it's sent by the worker 
instance,  RabbitMQ seems to be ignoring it completely.

Any ideas on what's wrong?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131223/d8b6b690/attachment.html>

From michael.s.klishin at gmail.com  Tue Dec 24 02:38:35 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 24 Dec 2013 06:38:35 +0400
Subject: [rabbitmq-discuss] RabbitMQ receiving data,
	but no messages delivered
In-Reply-To: <950a1a78-d365-4122-9cf1-ad4c29e53601@googlegroups.com>
References: <950a1a78-d365-4122-9cf1-ad4c29e53601@googlegroups.com>
Message-ID: <CAE3HoVSMoXN115dfQtGwmDRQ_akkbz0Gx4gF7Mj6pRXZbWRiBg@mail.gmail.com>

2013/12/24 Pedro Werneck <pjwerneck at gmail.com>

> Any ideas on what's wrong?


Make sure the queue actually has consumers (why they may or may not be
present
is a Celery-specific question) and messages don't have TTL = 0 set on them.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/103252d8/attachment.html>

From anumu001 at gmail.com  Tue Dec 24 11:25:20 2013
From: anumu001 at gmail.com (prem kumar Anumula)
Date: Tue, 24 Dec 2013 16:55:20 +0530
Subject: [rabbitmq-discuss] unable to join to cluster nodes
In-Reply-To: <CAE3HoVQZ=R8uRRgxMVuwm1Jb=CvS6ERqgEoYMCMUg6+MMxZiUg@mail.gmail.com>
References: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
 <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>
 <CACMhsg6NFos8tSNnY6mQKhS74o3BMsx6L-kdjmn+DS_D70Maog@mail.gmail.com>
 <CAE3HoVQx7VmLDh-rQHJRpL7DosgiYNb9gJ76xrmRkaNk9mfSHw@mail.gmail.com>
 <CAE3HoVR_Fw92viXjPeNsyub9ykZPFE+9tygtp5u5=w74y8Kaig@mail.gmail.com>
 <CACMhsg4EU+qYN_b77N=gZKWgC4pDS2c-L61e0Mt3LXom_fq2yA@mail.gmail.com>
 <CAE3HoVQZ=R8uRRgxMVuwm1Jb=CvS6ERqgEoYMCMUg6+MMxZiUg@mail.gmail.com>
Message-ID: <CACMhsg5_qjSnwVQh1ga-O6zh9SbXvy+NiaRXVLz7e400ruSmCA@mail.gmail.com>

Hi MK,

I am able to telnet on port 4369, PING response is also good.
Both nodes are in same network segment and ports are enables in IPTABLES.

interested to know the following details:

1. how to know  -- hostname, node and port running from both cluster nodes.
2. Is there any specific changes required for rabbitMQ to join cluster
other than mentioned steps..

Rgds
prem




On Mon, Dec 23, 2013 at 5:23 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/12/23 prem kumar Anumula <anumu001 at gmail.com>
>
>> [root at localhost ~]# rabbitmqctl join_cluster rabbit at 10.0.0.190
>> Clustering node rabbit at localhost with 'rabbit at 10.0.0.190' ...
>> Error: {cannot_discover_cluster,"The nodes provided are either offline or
>> not running"}
>>
>
> This means that this node cannot reach 10.0.0.190 on port 4369 (epmd
> [1]) or RabbitMQ is not running
> on 10.0.0.190.
>
> 1. http://www.erlang.org/doc/man/epmd.html
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/1954542a/attachment.html>

From michael.s.klishin at gmail.com  Tue Dec 24 12:00:40 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 24 Dec 2013 16:00:40 +0400
Subject: [rabbitmq-discuss] unable to join to cluster nodes
In-Reply-To: <CACMhsg5_qjSnwVQh1ga-O6zh9SbXvy+NiaRXVLz7e400ruSmCA@mail.gmail.com>
References: <CACMhsg6FWzLwgbXvZgQYH-5+zuD8-6W3gca4zGPcbPF2d8JuEA@mail.gmail.com>
 <CAE3HoVRz8V0N8-zjQ9chQFCBFoFpBqgpPw0SMhEsGdBMKbUZ6A@mail.gmail.com>
 <CACMhsg6NFos8tSNnY6mQKhS74o3BMsx6L-kdjmn+DS_D70Maog@mail.gmail.com>
 <CAE3HoVQx7VmLDh-rQHJRpL7DosgiYNb9gJ76xrmRkaNk9mfSHw@mail.gmail.com>
 <CAE3HoVR_Fw92viXjPeNsyub9ykZPFE+9tygtp5u5=w74y8Kaig@mail.gmail.com>
 <CACMhsg4EU+qYN_b77N=gZKWgC4pDS2c-L61e0Mt3LXom_fq2yA@mail.gmail.com>
 <CAE3HoVQZ=R8uRRgxMVuwm1Jb=CvS6ERqgEoYMCMUg6+MMxZiUg@mail.gmail.com>
 <CACMhsg5_qjSnwVQh1ga-O6zh9SbXvy+NiaRXVLz7e400ruSmCA@mail.gmail.com>
Message-ID: <CAE3HoVTL4bvw4tQGj7RifrbvQJFe4mzRwU=BqhUghisJaxy6zA@mail.gmail.com>

2013/12/24 prem kumar Anumula <anumu001 at gmail.com>

> 1. how to know  -- hostname, node and port running from both cluster nodes.
>

RabbitMQ clustering uses epmd port ? which is almost never overridden but
can be ? see [1].


> 2. Is there any specific changes required for rabbitMQ to join cluster
> other than mentioned steps..
>

I believe [1] (the entire document) answers this. If you use hostnames,
they need to resolve,
there's some advice on [2] about this.

1. http://www.rabbitmq.com/clustering.html#firewall
2. http://www.rabbitmq.com/ec2.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/d0be3a96/attachment.html>

From Punit.Jain at emc.com  Tue Dec 24 13:11:44 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Tue, 24 Dec 2013 08:11:44 -0500
Subject: [rabbitmq-discuss] RabbitMQ configuration backup
Message-ID: <DB14E94115BBC84E8960C12C176D06760178C758F5@MX25A.corp.emc.com>

Hi All,
I want to take the backup of current RabbitMQ configuration and restore it in a new machine. I figured out that it can be done through management plugin, but for a reason I don't want to use it. Is there another way to achieve this apart from management plugin?

Thanks in Advance!
-Punit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/961d1923/attachment.html>

From michael.s.klishin at gmail.com  Tue Dec 24 13:33:50 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 24 Dec 2013 17:33:50 +0400
Subject: [rabbitmq-discuss] RabbitMQ configuration backup
In-Reply-To: <DB14E94115BBC84E8960C12C176D06760178C758F5@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06760178C758F5@MX25A.corp.emc.com>
Message-ID: <CAE3HoVTsUtk1p6uJdOfXUhHzNY6KU+SZ6=NXUGr6z+xZSO9QaQ@mail.gmail.com>

2013/12/24 Jain, Punit <Punit.Jain at emc.com>

> I want to take the backup of current RabbitMQ configuration and restore it
> in a new machine. I figured out that it can be done through management
> plugin, but for a reason I don?t want to use it. Is there another way to
> achieve this apart from management plugin?
>

You can copy Mnesia database and message store directories when RabbitMQ is
not running.
See http://rabbitmq.com/relocate.html.

Note that mnesia directory has hostname in its name, so you'll have to
account for that when
restoring.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/f8fc2179/attachment.html>

From pradeep.mn at nestgroup.net  Tue Dec 24 10:49:24 2013
From: pradeep.mn at nestgroup.net (Pradeep  Kumar M. N.)
Date: Tue, 24 Dec 2013 16:19:24 +0530
Subject: [rabbitmq-discuss] Query on RabbitMQ Performance
Message-ID: <840ACF55023B76489F16AAE942FC0282EEE1BC@MAIL-TVM.tvm.nestgroup.net>

Dear All,

 

I have a query on RabbitMQ performance. I am using RabbitMQ to send 10MB
binary data. I tried transferring it as a whole 10MB data as well as
multiple 100KB data.  But interestingly, multiple 100KB data took less
time than 1 single message of 10MB. Eventually I am transferring 10MB.

 

 

RabbitMQ Version: 3.2.1

Client: Java

Message Durable - No

Queue Durable - No

 

 

Thanks
Pradeep

***** Confidentiality Statement/Disclaimer *****

This message and any attachments is intended for the sole use of the intended recipient. It may contain confidential information. Any unauthorized use, dissemination or modification is strictly prohibited. If you are not the intended recipient, please notify the sender immediately then delete it from all your systems, and do not copy, use or print. Internet communications are not secure and it is the responsibility of the recipient to make sure that it is virus/malicious code exempt.
The company/sender cannot be responsible for any unauthorized alterations or modifications made to the contents. If you require any form of confirmation of the contents, please contact the company/sender. The company/sender is not liable for any errors or omissions in the content of this message.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/28cd3371/attachment.html>

From michael.s.klishin at gmail.com  Tue Dec 24 14:38:55 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 24 Dec 2013 18:38:55 +0400
Subject: [rabbitmq-discuss] Query on RabbitMQ Performance
In-Reply-To: <840ACF55023B76489F16AAE942FC0282EEE1BC@MAIL-TVM.tvm.nestgroup.net>
References: <840ACF55023B76489F16AAE942FC0282EEE1BC@MAIL-TVM.tvm.nestgroup.net>
Message-ID: <CAE3HoVQtJcUnwEK_5Y=qgd_gqEd9ZaDF4m+F77mNkA3Aqzh+2A@mail.gmail.com>

2013/12/24 Pradeep Kumar M. N. <pradeep.mn at nestgroup.net>

> But interestingly, multiple 100KB data took less time than 1 single
> message of 10MB. Eventually I am transferring 10MB.


There is a certain message processing overhead that is 100 times greater
when you split
10 MB into 100 chunks of 100Kb. Try 10 messages 1 MB in size, you will
likely see
a smaller difference.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/51f4085c/attachment.html>

From michael.s.klishin at gmail.com  Tue Dec 24 15:22:41 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 24 Dec 2013 19:22:41 +0400
Subject: [rabbitmq-discuss] Query on RabbitMQ Performance
In-Reply-To: <CAE3HoVQtJcUnwEK_5Y=qgd_gqEd9ZaDF4m+F77mNkA3Aqzh+2A@mail.gmail.com>
References: <840ACF55023B76489F16AAE942FC0282EEE1BC@MAIL-TVM.tvm.nestgroup.net>
 <CAE3HoVQtJcUnwEK_5Y=qgd_gqEd9ZaDF4m+F77mNkA3Aqzh+2A@mail.gmail.com>
Message-ID: <CAE3HoVRzW4RSAh4C7AzfKP_BnO6ESvHKMBeEgnKJrgj2QQ72Jw@mail.gmail.com>

2013/12/24 Michael Klishin <michael.s.klishin at gmail.com>

> There is a certain message processing overhead that is 100 times greater
> when you split
> 10 MB into 100 chunks of 100Kb. Try 10 messages 1 MB in size, you will
> likely see
> a smaller difference.
>

Scratch that.

By default client libraries will chunk messages > 128 KB in size into 128
KB frames. What you see is likely a client-side inefficiency.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/673e0de8/attachment.html>

From arunrao.seattle at gmail.com  Tue Dec 24 21:00:47 2013
From: arunrao.seattle at gmail.com (Arun)
Date: Tue, 24 Dec 2013 13:00:47 -0800
Subject: [rabbitmq-discuss] Query on RabbitMQ Performance
In-Reply-To: <CAE3HoVRzW4RSAh4C7AzfKP_BnO6ESvHKMBeEgnKJrgj2QQ72Jw@mail.gmail.com>
References: <840ACF55023B76489F16AAE942FC0282EEE1BC@MAIL-TVM.tvm.nestgroup.net>
 <CAE3HoVQtJcUnwEK_5Y=qgd_gqEd9ZaDF4m+F77mNkA3Aqzh+2A@mail.gmail.com>
 <CAE3HoVRzW4RSAh4C7AzfKP_BnO6ESvHKMBeEgnKJrgj2QQ72Jw@mail.gmail.com>
Message-ID: <E975FBB5-B26D-427A-829A-7957B99FDAA7@gmail.com>

Hi Michael -

How can I find out what is my client side message chunk size?


How to update this value?

Thanks!
Sent from my iPhone

> On Dec 24, 2013, at 7:22 AM, Michael Klishin <michael.s.klishin at gmail.com> wrote:
> 
> 
> 2013/12/24 Michael Klishin <michael.s.klishin at gmail.com>
>> There is a certain message processing overhead that is 100 times greater when you split
>> 10 MB into 100 chunks of 100Kb. Try 10 messages 1 MB in size, you will likely see
>> a smaller difference.
> 
> Scratch that.
> 
> By default client libraries will chunk messages > 128 KB in size into 128 KB frames. What you see is likely a client-side inefficiency.
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/68e637ff/attachment.html>

From arunrao.seattle at gmail.com  Wed Dec 25 00:05:31 2013
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Tue, 24 Dec 2013 16:05:31 -0800
Subject: [rabbitmq-discuss] Query on RabbitMQ Performance
In-Reply-To: <E975FBB5-B26D-427A-829A-7957B99FDAA7@gmail.com>
References: <840ACF55023B76489F16AAE942FC0282EEE1BC@MAIL-TVM.tvm.nestgroup.net>
 <CAE3HoVQtJcUnwEK_5Y=qgd_gqEd9ZaDF4m+F77mNkA3Aqzh+2A@mail.gmail.com>
 <CAE3HoVRzW4RSAh4C7AzfKP_BnO6ESvHKMBeEgnKJrgj2QQ72Jw@mail.gmail.com>
 <E975FBB5-B26D-427A-829A-7957B99FDAA7@gmail.com>
Message-ID: <CAEJg2GDwGdYgo7uPESQ8FwUgRKMvwN9Go_i1nAr7FObNw60Xcw@mail.gmail.com>

I see that on the server side I can configure frame_max as documented here:
http://www.rabbitmq.com/configure.html.

Also, as noted on the frame_max section, this is a negotiation on the
server side to clients. So I assume this is just a setting on server side
and no additional configuration necessary on the client side.

Thanks!


On Tue, Dec 24, 2013 at 1:00 PM, Arun <arunrao.seattle at gmail.com> wrote:

> Hi Michael -
>
> How can I find out what is my client side message chunk size?
>
>
> How to update this value?
>
> Thanks!
> Sent from my iPhone
>
> On Dec 24, 2013, at 7:22 AM, Michael Klishin <michael.s.klishin at gmail.com>
> wrote:
>
>
> 2013/12/24 Michael Klishin <michael.s.klishin at gmail.com>
>
>> There is a certain message processing overhead that is 100 times greater
>> when you split
>> 10 MB into 100 chunks of 100Kb. Try 10 messages 1 MB in size, you will
>> likely see
>> a smaller difference.
>>
>
> Scratch that.
>
> By default client libraries will chunk messages > 128 KB in size into 128
> KB frames. What you see is likely a client-side inefficiency.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131224/f8359f9f/attachment.html>

From michael.s.klishin at gmail.com  Wed Dec 25 05:14:23 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 25 Dec 2013 09:14:23 +0400
Subject: [rabbitmq-discuss] Query on RabbitMQ Performance
In-Reply-To: <E975FBB5-B26D-427A-829A-7957B99FDAA7@gmail.com>
References: <840ACF55023B76489F16AAE942FC0282EEE1BC@MAIL-TVM.tvm.nestgroup.net>
 <CAE3HoVQtJcUnwEK_5Y=qgd_gqEd9ZaDF4m+F77mNkA3Aqzh+2A@mail.gmail.com>
 <CAE3HoVRzW4RSAh4C7AzfKP_BnO6ESvHKMBeEgnKJrgj2QQ72Jw@mail.gmail.com>
 <E975FBB5-B26D-427A-829A-7957B99FDAA7@gmail.com>
Message-ID: <CAE3HoVRhh8HbkR3L9OAGZv90h090qqkWhPDHNthFxs28-E-0Yg@mail.gmail.com>

2013/12/25 Arun <arunrao.seattle at gmail.com>

> How can I find out what is my client side message chunk size?
>
>
> How to update this value?
>

See

https://www.rabbitmq.com/releases/rabbitmq-java-client/v3.2.1/rabbitmq-java-client-javadoc-3.2.1/

and its respective getter.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131225/3b24e757/attachment.html>

From haster2004 at yandex.ru  Wed Dec 25 09:50:03 2013
From: haster2004 at yandex.ru (Haster)
Date: Wed, 25 Dec 2013 01:50:03 -0800 (PST)
Subject: [rabbitmq-discuss] Is there a compiled RabbitMQ AMQP client
 library available for the Windows or Linux platform?
In-Reply-To: <l8un9b$ob8$1@ger.gmane.org>
References: <l8un9b$ob8$1@ger.gmane.org>
Message-ID: <1387965003576-32302.post@n5.nabble.com>

Hi, I don't know such places in Internet.
But I can share binaries for Windows x32, x64, Linux RedHat 5.0 x64, Linux
RedHat 6.0 x64, HPUX x64 (IA64) and Sun Solaris 2.10 x64 (SPARC)

But I think that it's more simple to build this library on place



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Is-there-a-compiled-RabbitMQ-AMQP-client-library-available-for-the-Windows-or-Linux-platform-tp32226p32302.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From arachweb at gmail.com  Wed Dec 25 18:22:40 2013
From: arachweb at gmail.com (Paul Bell)
Date: Wed, 25 Dec 2013 13:22:40 -0500
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CAE3HoVR7+Rz85cRqzBDaNBgxY2_Da2nLURTOTVXP5qShGvjpHQ@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
 <5297651F.7010801@ontrenet.com>
 <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>
 <CAE3HoVSkeYrLxS=pEJ_FH5sAyAqG3yp2535MBf-Lt4FZX9A+HA@mail.gmail.com>
 <CA+ttMd94bBrsJoc--vwmaTL_xAw_4CsmZ17Xt091x6QS2UUGkA@mail.gmail.com>
 <CAE3HoVR7+Rz85cRqzBDaNBgxY2_Da2nLURTOTVXP5qShGvjpHQ@mail.gmail.com>
Message-ID: <CA+ttMd-O6pYZ3aAB6ArY1+Eb2=QsBOuLpgUVFQ0hXBokf3Yz5A@mail.gmail.com>

Hi Michael,

I think we're close to the answer I need in order to think about this more
clearly. So, if I have two HA clusters connected via Shovel and I want to
publish a message that will be propagated not only to the local nodes in
the cluster, but also across the Shovel to all of the nodes in the remote
cluster, to where must I publish?

Can my component simply publish to any exchange on its node, or must it
publish twice, once to any exchange on its node and again to a "special"
exchange which represents one end of the Shovel? (I don't really mean "any"
exchange; just trying to make a distinction between a local exchange I've
defined and which is mirrored across the local cluster, and what I suppose
to be a different exchange that is one end of the Shovel. I may be way out
of my depth in making this distinction).

I will look at exchange confederation as you suggest.

Thanks for your help.

-Paul




On Sun, Dec 22, 2013 at 12:56 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/12/22 Paul Bell <arachweb at gmail.com>
>
>> I was looking at http://www.rabbitmq.com/shovel.html when your post
>> appeared. The language on that page speaks in terms of source and
>> destination brokers. Does this mean that Shovel is one way? Put otherwise,
>> if Cluster 1 is source and Cluster 2 destination, can Cluster 2 also act as
>> source; or would such a configuration/use require 2 Shovels, one for each
>> direction?
>>
>
> I believe it can but if you are looking for more sophisticated replication
> setups,
> take a look at federated exchanges:
>
> http://www.rabbitmq.com/federated-exchanges.html
>
> (note the max-hops setting)
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131225/d5260bc5/attachment.html>

From 314992959 at qq.com  Thu Dec 26 02:08:19 2013
From: 314992959 at qq.com (3k4b251)
Date: Wed, 25 Dec 2013 18:08:19 -0800 (PST)
Subject: [rabbitmq-discuss] =?utf-8?q?Rabbitmq_Server=28WINDOWS=29_configu?=
 =?utf-8?q?ration=EF=BC=9A_how__to__change___tcp=5Flistener=3F?=
Message-ID: <1388023699234-32304.post@n5.nabble.com>

it's  always  be   5672.     I  try  to  change   rabbitmq-service.bat  and  
rabbitmq-server.bat's  content  :  
  
<http://rabbitmq.1065348.n5.nabble.com/file/n32304/QQ%E6%88%AA%E5%9B%BE20131226100708.jpg> 

  also  try  to   set   environment  value  RABBITMQ_NODE_PORT  =  5801. 
But  when  I start   by   rabbitmq-service.bat.  I  use   rabbitmqctl.bat  
to   check  out  the  environment  And  See  the TCP_Listener  Still  5672.
  
<http://rabbitmq.1065348.n5.nabble.com/file/n32304/QQ%E6%88%AA%E5%9B%BE20131226100751.jpg> 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-Server-WINDOWS-configuration-how-to-change-tcp-listener-tp32304.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Thu Dec 26 03:22:20 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 25 Dec 2013 19:22:20 -0800
Subject: [rabbitmq-discuss] [rabbitmq_c] Infinite wait in
 login_with_properties function
In-Reply-To: <1387786326818-32275.post@n5.nabble.com>
References: <1387786326818-32275.post@n5.nabble.com>
Message-ID: <CAAt2poJhK0ndFKbpMd17jY23NEj+ZQ_sUsB27z15W5pOB3mwhA@mail.gmail.com>

How frequently does this happen?

Is it something you can reliably reproduce?

-Alan


On Mon, Dec 23, 2013 at 12:12 AM, Haster <haster2004 at yandex.ru> wrote:

> Hi there!
>
> Today I have caught a bug that my program could not stop.
> I used a gdb and found that application was on recv method. Call stack:
>
> #0  0x0000003435c0dc81 in recv () from /lib64/libpthread.so.0
> #1  0x00002aaaad84ead1 in ?? () from
> /import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
> #2  0x00002aaaad84be83 in ?? () from
> /import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
> #3  0x00002aaaad84c19e in ?? () from
> /import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
> #4  0x00002aaaad84c72c in amqp_simple_wait_method ()
>    from
> /import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
> #5  0x00002aaaad84cab6 in ?? () from
> /import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
> #6  0x00002aaaad84ce8a in amqp_login_with_properties ()
>    from
> /import/home/yury.alioshinov/linux_i686/5102/lib/librabbitmq_c.so.1.1.1
> #7  0x00002aaaad626313 in RabbitMQ::RabbitMQConnectionImpl::connect
> (this=0xfaf3a00, hostName=...,
>     portNumber=<value optimized out>, userName=..., userPwd=...,
> heartbeat=0, vhost=...)
>     at rabbitmq_source/rabbitmq_connector/RabbitMQConnectionImpl.cpp:115
> #8  0x00002aaaad60d900 in rabbitmq_ns::consumer_impl::execute
> (this=0xb4579d8) at rabbitmq_source/rabbitmq_impl.cpp:823
> #9  0x00002b25bdde1aa3 in threads::thread_proc (thr_ptr=0xb4579d8) at
> has_common_source/source/cpp/threads.cpp:225
> #10 0x0000003435c0673d in start_thread () from /lib64/libpthread.so.0
> #11 0x00000034350d40cd in clone () from /lib64/libc.so.6
>
> So, method login_with_properties is blocked, and there is some usecase
> where
> program execute amqp_send_header in amqp_login_inner without errors but
> can't get data from amqp_simple_wait_method.
>
> Maybe rabbitmq_c needs nonblock login method?
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-Infinite-wait-in-login-with-properties-function-tp32275.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131225/25d9952c/attachment.html>

From haster2004 at yandex.ru  Thu Dec 26 06:05:35 2013
From: haster2004 at yandex.ru (Haster)
Date: Wed, 25 Dec 2013 22:05:35 -0800 (PST)
Subject: [rabbitmq-discuss] [rabbitmq_c] Infinite wait in
	login_with_properties function
In-Reply-To: <CAAt2poJhK0ndFKbpMd17jY23NEj+ZQ_sUsB27z15W5pOB3mwhA@mail.gmail.com>
References: <1387786326818-32275.post@n5.nabble.com>
 <CAAt2poJhK0ndFKbpMd17jY23NEj+ZQ_sUsB27z15W5pOB3mwhA@mail.gmail.com>
Message-ID: <1388037935031-32306.post@n5.nabble.com>

Hi, Alan.

I saw this behavior only one time. But I didn't try to reproduce it.

I don't think, that network problems could happen frequently in that place,
but
if they happen... there will be infinite loop



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-Infinite-wait-in-login-with-properties-function-tp32275p32306.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From hisumer at bimetri.com  Thu Dec 26 09:16:57 2013
From: hisumer at bimetri.com (=?ISO-8859-9?Q?Halil_=DDbrahim_S=DCMER?=)
Date: Thu, 26 Dec 2013 11:16:57 +0200
Subject: [rabbitmq-discuss] Fwd: RabbitMQ configuration
In-Reply-To: <CAFR5bjAA87SqA7VHHN0p3zLFu03HU=eaNnBRvr_r11xsLn1H5g@mail.gmail.com>
References: <CAFR5bjAA87SqA7VHHN0p3zLFu03HU=eaNnBRvr_r11xsLn1H5g@mail.gmail.com>
Message-ID: <CAFR5bjCiREVKrQTo+5vN05hk8huqwMCm2E5iunAaoCUbWjLyvg@mail.gmail.com>

Hi Guys,

We are developing m2m cloud platform using mqtt ( eclipse paho) and
RabbitMQ server. However I've stuck with some problems, having trouble to
solve these problems. I need your support.

One thing I noticed is that if I kill a consumer uncleanly (emulating a
crashed program or shutdown client without sending disconnect message to
rabbitMQ server), the server thinks that this consumer is still there for a
long time. As a result of this, even if I reconnect server after connection
lost or emulating error. Server still thinks that previous session is
active and my new connection could be resulted as connection lost on the
client side or published messages has been ignored since they moved to
"unacked" box on RabbitMQ queue. Until I manually shut down previous
channel (unclean shutdown) this problem continues. However If connection
never lost and close cleanly, I've never encountered this problem. I'm
using gprs modem to connect RabbitMQ server and connection lost or timeouts
may occurs some times thus I need to solve this problem on the RabbitMQ
server side. I'm using keep alive pings on Mqtt client. Does RabbitMQ
supports server ping service or any other mechanism that catch socket
connection lost on the client side. If there is any, could you help me with
setting it.

Another thing is my subscriptions expires even if there are messages
waiting to deliver to the clients, is there any configuration to close.

The last thing, I've read all your documentation on your page
http://www.rabbitmq.com/configure.html. I've checked my rabbitMQ
installation directory where RabbitMQ config file should exsists "config
file(s) : /etc/rabbitmq/rabbitmq.config" but I couldn't found any
"rabbitmq.config" file. If I create a config file on the directory and save
my configurations. Does RabbitMQ checks the directory and configure new
settings or do I need to set "rabbitmq.config" file directory to other
RabbitMQ configuration files.

Best Regards,

-- 
Halil ibrahim S?mer
G?m?l? Yaz?l?m Tasar?m M?hendisi

*Bilgi ve ?leti?im Teknolojileri*

*Adres:* Ankara Teknoloji Geli?tirme B?lgesi,
Cyberpark, Cyberplaza, B Blok, Kat:2,
No:B212, 06800, Bilkent, ?ankaya, ANKARA
*Telefon:* +90 312 472 0 449  (dahili:14)
*Faks:* +90 312 472 2 449
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131226/49446f76/attachment.html>

From kthari85 at gmail.com  Fri Dec 27 01:56:27 2013
From: kthari85 at gmail.com (Hari K T)
Date: Thu, 26 Dec 2013 17:56:27 -0800 (PST)
Subject: [rabbitmq-discuss] Newbie question
Message-ID: <6cb53e35-2ca7-45e8-96d8-eacc66c84452@googlegroups.com>

Hi,

This is my first post to RabbitMQ. It is mainly some technological 
difficulties I am facing, and would like to know how rabbitmq can solve it.

Currently let us assume you have 1000's of feeds. And you need to parse the 
feed and process on those articles. ( I know about superfeedr.com, take 
this an example )

The fetch feeds is currently running on gearman. 

1)  the problem with gearman is handling of job-server fail over 
https://answers.launchpad.net/gearmand/+question/112134

2 ) When you process a data, I try to keep the data connecting to mongo 
from the same worker. The mongodb fails to connect may be due to the 
restrictions . 

What I am trying to achieve is store it for a few minutes if the client 
failed due to certain problem, the callback will not work.

Either you want to add all the data back to the queue and start processing 
the same. Not a good idea.

An intermediary save, and get back the data is what I was thinking.

So when you look at rabbitmq the current way is similar to the RPC .

ie what will happen when the client ( the one who initialized the worker ) 
was killed, or drops the connection in between processing?

If you need any more information I am happy to give

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131226/6832a58f/attachment.html>

From pradeepmn.mn at gmail.com  Fri Dec 27 04:42:50 2013
From: pradeepmn.mn at gmail.com (Pradeep Mn)
Date: Thu, 26 Dec 2013 20:42:50 -0800 (PST)
Subject: [rabbitmq-discuss] Query on RabbitMQ Performance
Message-ID: <7ab1c9c9-5f47-4abb-9f93-f83b4aa70529@googlegroups.com>



Dear All,

 

I have a query on RabbitMQ performance. I am using RabbitMQ to send 10MB 
binary data. I tried transferring it as a whole 10MB data as well as 
multiple 100KB data.  But interestingly, multiple 100KB data took less time 
than 1 single message of 10MB. Eventually I am transferring 10MB.

 

 

RabbitMQ Version: 3.2.1

Client: Java

Message Durable ? No

Queue Durable ? No

 

 

Thanks
Pradeep
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131226/9218b78b/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 27 14:07:47 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 27 Dec 2013 18:07:47 +0400
Subject: [rabbitmq-discuss] Newbie question
In-Reply-To: <6cb53e35-2ca7-45e8-96d8-eacc66c84452@googlegroups.com>
References: <6cb53e35-2ca7-45e8-96d8-eacc66c84452@googlegroups.com>
Message-ID: <CAE3HoVQeFbpZfHaqJ1zWKQY1QnsDR4eUUQEEwhjSrJz7xQE-jA@mail.gmail.com>

2013/12/27 Hari K T <kthari85 at gmail.com>

> ie what will happen when the client ( the one who initialized the worker )
> was killed, or drops the connection in between processing?


If you use manual acknowledgement of deliveries, all unacknowledged
messages will be requeued.

See Tutorial 2:
http://www.rabbitmq.com/getstarted.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/aada0804/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 27 14:09:02 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 27 Dec 2013 18:09:02 +0400
Subject: [rabbitmq-discuss] Query on RabbitMQ Performance
In-Reply-To: <7ab1c9c9-5f47-4abb-9f93-f83b4aa70529@googlegroups.com>
References: <7ab1c9c9-5f47-4abb-9f93-f83b4aa70529@googlegroups.com>
Message-ID: <CAE3HoVR+cBprqeFoLaaiGpTq5b_ZKC4MwDzOdpfFwW4T7RXvfw@mail.gmail.com>

2013/12/27 Pradeep Mn <pradeepmn.mn at gmail.com>

> I have a query on RabbitMQ performance. I am using RabbitMQ to send 10MB
> binary data. I tried transferring it as a whole 10MB data as well as
> multiple 100KB data.  But interestingly, multiple 100KB data took less time
> than 1 single message of 10MB. Eventually I am transferring 10MB.


There is an optimisation in RabbitMQ server proposed that makes protocol
reader/parser perform
the way you expect. It may make it into RabbitMQ 3.3.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/b17517e6/attachment.html>

From videlalvaro at gmail.com  Fri Dec 27 15:59:40 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 27 Dec 2013 16:59:40 +0100
Subject: [rabbitmq-discuss] New release of reverse topic exchange
Message-ID: <CAMcAHLW_4u-e_HZDVx32g7QgOo5FbgRjiQaQ_w5eqfh1pJjD3A@mail.gmail.com>

Hi,

There's a new release of the Reverse Topic Exchange plugin which fixes
the matching algorithm and decreases the memory requirements.

You can find the new release here:
https://github.com/videlalvaro/rabbitmq-rtopic-exchange/tree/master/binaries

Also I wrote a note about performance in the README:

https://github.com/videlalvaro/rabbitmq-rtopic-exchange#Performance

Regards,

Alvaro

From k.madnani84 at gmail.com  Fri Dec 27 16:04:00 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Fri, 27 Dec 2013 08:04:00 -0800 (PST)
Subject: [rabbitmq-discuss] Validation of rabbitmq.config file?
Message-ID: <1388160240725-32313.post@n5.nabble.com>

Hi,

Is there a way to validate rabbitmq.config file before starting the rabbitmq
server?

Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Validation-of-rabbitmq-config-file-tp32313.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From shridharan.m at gmail.com  Fri Dec 27 16:55:55 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Fri, 27 Dec 2013 08:55:55 -0800
Subject: [rabbitmq-discuss] Rabbit Mq 3.0.2 memory leak
Message-ID: <CAPK6Oevr7A1L7HpuuLYfS-2u0-YiEjoJ=Ak3YkCDaVe7csx91w@mail.gmail.com>

Hello there,

     I am facing a memory leak situation with our production cluster with
Rabbit version 3.0.2. We have one high volume queue (out of other 45
queues) causing this issue. The cluster has 2 nodes and the memory leak
happens only on the slave node for that queue. I am attaching two
screenshots to show

   1. memory on the slave builds up over time compared to the master which
   stays consistently around 400 MB.
   2. memory doubles every few seconds for the slave node.


Original memory usage ( which is so high compared to the second node which
is the master for that queue)
[image: Inline image 2]
Doubled memory on slave
[image: Inline image 3]
This queue processes 300-350 messages a sec and we have around 0 to 20
messages in the queue coz of traffic spikiness. Here is how producers and
consumers are using it.

Producers:
    Application (php, web servers) will establish a connection, publish a
message, close the connection. We have approx 250 app servers publishing
messages for this queue.

Consumers:
    Worker will establish a connection, consume messages using get with
autoack for 2 mins, worker will close the connection and dies. 448 workers
are consuming messages for this queue.

Note: we use php amqplib 0.2.2 (which is really old and due for an upgrade)

I know the quick answer is "upgrade" but is there a short term solution to
fix this before we upgrade? I usually delete the queue (since application
creates it if it doesn't exist) and take it to stable state before the
memory builds up for 3 days to hit the watermark.

Thanks,
Shri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SlaveMemoryOriginal.png
Type: image/png
Size: 53360 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SlaveMemory.png
Type: image/png
Size: 51949 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment-0001.png>

From james.eddy at us.thalesgroup.com  Fri Dec 27 18:13:24 2013
From: james.eddy at us.thalesgroup.com (James)
Date: Fri, 27 Dec 2013 18:13:24 +0000 (UTC)
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
	node we see a very slow dequeue of messages
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
 <loom.20131206T020729-16@post.gmane.org>
 <loom.20131206T221755-465@post.gmane.org> <52A7343D.4020003@rabbitmq.com>
Message-ID: <loom.20131227T191248-958@post.gmane.org>

Simon MacMullen <simon at ...> writes:

> 
> On 06/12/13 21:29, James wrote:
> > Result: CLIENT_A0 continues to publish at 1MSG/sec, after net_ticktime
> > CLIENT_A1 is dequeueing much less then 1MSG/sec and falls behind.
> 
> Thanks for a detailed description of the issue. Just to let you know 
> that I've reproduced this.
> 
> Cheers, Simon
> 


Hi Simon,

Do you have a target release date/version for this issue?

Thanks,
James



From tom.collins.work at gmail.com  Fri Dec 27 19:38:56 2013
From: tom.collins.work at gmail.com (tom collins)
Date: Fri, 27 Dec 2013 13:38:56 -0600
Subject: [rabbitmq-discuss] MQTT on different virtual hosts
Message-ID: <CALP4UdCteB4Am-PBuZgbXh5kWeoSpwyrO+0h43KdiTpEPutvsQ@mail.gmail.com>

Hi,

I'm trying to set up testing/staging/production virtual hosts, however I
can't find anything suggesting you can specify configuration settings for
individual virtual hosts, or configure the MQTT plugin for different vhosts
based on the port and/or username/password.

Is there a best practice using the MQTT plugin with different vhosts?

Thanks
Tom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/4666d7be/attachment.html>

From michael.s.klishin at gmail.com  Fri Dec 27 21:20:23 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 28 Dec 2013 01:20:23 +0400
Subject: [rabbitmq-discuss] MQTT on different virtual hosts
In-Reply-To: <CALP4UdCteB4Am-PBuZgbXh5kWeoSpwyrO+0h43KdiTpEPutvsQ@mail.gmail.com>
References: <CALP4UdCteB4Am-PBuZgbXh5kWeoSpwyrO+0h43KdiTpEPutvsQ@mail.gmail.com>
Message-ID: <CAE3HoVRuza-LWQwE3e9Gc-R=TomNqT_+zgXzSdQw3W5SKR-FWw@mail.gmail.com>

2013/12/27 tom collins <tom.collins.work at gmail.com>

> I'm trying to set up testing/staging/production virtual hosts, however I
> can't find anything suggesting you can specify configuration settings for
> individual virtual hosts, or configure the MQTT plugin for different vhosts
> based on the port and/or username/password.
>
> Is there a best practice using the MQTT plugin with different vhosts?
>

There is no way to do this at the moment. One of the upcoming versions will
make it possible
to specify vhost MQTT connections will use as part of the username.

MQTT itself has no concept of vhosts, period.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131228/1f84cdf4/attachment.html>

From jkuch at gopivotal.com  Fri Dec 27 22:11:04 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Fri, 27 Dec 2013 14:11:04 -0800
Subject: [rabbitmq-discuss] Validation of rabbitmq.config file?
In-Reply-To: <1388160240725-32313.post@n5.nabble.com>
References: <1388160240725-32313.post@n5.nabble.com>
Message-ID: <CANOx8NkkLAW9FoyWqQq-DUiq61dnw43LO_Kq7t3v_hsQZ=szSg@mail.gmail.com>

One easy trick is to start up an Erlang REPL and past the entirety of your
rabbitmq.config into it.  The file's contents are an Erlang term, and if
you've got a typo that's malformed it, this will catch it.  It won't of
course catch incorrect or meaningless, but syntactically sound settings.

Also, editing the files in an editor that supports Erlang syntax coloring
will also help you catch a lot of unclosed delimiters and the like...




On Fri, Dec 27, 2013 at 8:04 AM, k.madnani84 <k.madnani84 at gmail.com> wrote:

> Hi,
>
> Is there a way to validate rabbitmq.config file before starting the
> rabbitmq
> server?
>
> Thanks.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Validation-of-rabbitmq-config-file-tp32313.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/074d3109/attachment.html>

From arunrao.seattle at gmail.com  Sat Dec 28 04:36:36 2013
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Fri, 27 Dec 2013 20:36:36 -0800
Subject: [rabbitmq-discuss] AMQP Gems?
Message-ID: <CAEJg2GBt9GfWEXWsR3x7wAEAzZTjuQ-FimU9q1VV3ErMT=CuaA@mail.gmail.com>

Hi -

Has anyone tried AMQP Gems? I am trying to read the messages, waiting to be
consumed, in queues from RabbitMQ.

Thanks!
-arun.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/da162a68/attachment.html>

From michael.s.klishin at gmail.com  Sat Dec 28 08:32:06 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 28 Dec 2013 12:32:06 +0400
Subject: [rabbitmq-discuss] AMQP Gems?
In-Reply-To: <CAEJg2GBt9GfWEXWsR3x7wAEAzZTjuQ-FimU9q1VV3ErMT=CuaA@mail.gmail.com>
References: <CAEJg2GBt9GfWEXWsR3x7wAEAzZTjuQ-FimU9q1VV3ErMT=CuaA@mail.gmail.com>
Message-ID: <CAE3HoVQtgBt5SYLLky09dLXBDAGLe4k7pfkcYWOsgmNBruGtbQ@mail.gmail.com>

2013/12/28 Arun Rao <arunrao.seattle at gmail.com>

> Has anyone tried AMQP Gems? I am trying to read the messages, waiting to
> be consumed, in queues from RabbitMQ.


See http://rubybunny.info/articles/getting_started.html.

Unless you use EventMachine heavily already, there is no good reason to use
amqp gem.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131228/ea91cb22/attachment.html>

From arachweb at gmail.com  Sat Dec 28 20:21:04 2013
From: arachweb at gmail.com (Paul Bell)
Date: Sat, 28 Dec 2013 15:21:04 -0500
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CA+ttMd-O6pYZ3aAB6ArY1+Eb2=QsBOuLpgUVFQ0hXBokf3Yz5A@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
 <5297651F.7010801@ontrenet.com>
 <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>
 <CAE3HoVSkeYrLxS=pEJ_FH5sAyAqG3yp2535MBf-Lt4FZX9A+HA@mail.gmail.com>
 <CA+ttMd94bBrsJoc--vwmaTL_xAw_4CsmZ17Xt091x6QS2UUGkA@mail.gmail.com>
 <CAE3HoVR7+Rz85cRqzBDaNBgxY2_Da2nLURTOTVXP5qShGvjpHQ@mail.gmail.com>
 <CA+ttMd-O6pYZ3aAB6ArY1+Eb2=QsBOuLpgUVFQ0hXBokf3Yz5A@mail.gmail.com>
Message-ID: <CA+ttMd-XD4Hkfe0A0y1JJP+YxC0g4j9_QAdr9r1Q6bKxFss=Mg@mail.gmail.com>

Can anyone shed some light on the questions I raised in my previous post?

Thank you.

-Paul


On Wed, Dec 25, 2013 at 1:22 PM, Paul Bell <arachweb at gmail.com> wrote:

> Hi Michael,
>
> I think we're close to the answer I need in order to think about this more
> clearly. So, if I have two HA clusters connected via Shovel and I want to
> publish a message that will be propagated not only to the local nodes in
> the cluster, but also across the Shovel to all of the nodes in the remote
> cluster, to where must I publish?
>
> Can my component simply publish to any exchange on its node, or must it
> publish twice, once to any exchange on its node and again to a "special"
> exchange which represents one end of the Shovel? (I don't really mean "any"
> exchange; just trying to make a distinction between a local exchange I've
> defined and which is mirrored across the local cluster, and what I suppose
> to be a different exchange that is one end of the Shovel. I may be way out
> of my depth in making this distinction).
>
> I will look at exchange confederation as you suggest.
>
> Thanks for your help.
>
> -Paul
>
>
>
>
> On Sun, Dec 22, 2013 at 12:56 PM, Michael Klishin <
> michael.s.klishin at gmail.com> wrote:
>
>> 2013/12/22 Paul Bell <arachweb at gmail.com>
>>
>>> I was looking at http://www.rabbitmq.com/shovel.html when your post
>>> appeared. The language on that page speaks in terms of source and
>>> destination brokers. Does this mean that Shovel is one way? Put otherwise,
>>> if Cluster 1 is source and Cluster 2 destination, can Cluster 2 also act as
>>> source; or would such a configuration/use require 2 Shovels, one for each
>>> direction?
>>>
>>
>> I believe it can but if you are looking for more sophisticated
>> replication setups,
>> take a look at federated exchanges:
>>
>> http://www.rabbitmq.com/federated-exchanges.html
>>
>> (note the max-hops setting)
>>
>> --
>> MK
>>
>> http://github.com/michaelklishin
>> http://twitter.com/michaelklishin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131228/b531748d/attachment.html>

From k.madnani84 at gmail.com  Sun Dec 29 07:16:19 2013
From: k.madnani84 at gmail.com (k.madnani84)
Date: Sat, 28 Dec 2013 23:16:19 -0800 (PST)
Subject: [rabbitmq-discuss] Does Certificate updation requires server bounce?
Message-ID: <1388301379242-32322.post@n5.nabble.com>

Hi,

Suppose i have a rabbitMQ with ssl support enabled.If i Modify any of the
certificates(root or server) or key do i need to bounce back the server to
bring it to effect?

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Does-Certificate-updation-requires-server-bounce-tp32322.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.laing at nytimes.com  Sun Dec 29 22:52:42 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Sun, 29 Dec 2013 17:52:42 -0500
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CA+ttMd-XD4Hkfe0A0y1JJP+YxC0g4j9_QAdr9r1Q6bKxFss=Mg@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
 <5297651F.7010801@ontrenet.com>
 <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>
 <CAE3HoVSkeYrLxS=pEJ_FH5sAyAqG3yp2535MBf-Lt4FZX9A+HA@mail.gmail.com>
 <CA+ttMd94bBrsJoc--vwmaTL_xAw_4CsmZ17Xt091x6QS2UUGkA@mail.gmail.com>
 <CAE3HoVR7+Rz85cRqzBDaNBgxY2_Da2nLURTOTVXP5qShGvjpHQ@mail.gmail.com>
 <CA+ttMd-O6pYZ3aAB6ArY1+Eb2=QsBOuLpgUVFQ0hXBokf3Yz5A@mail.gmail.com>
 <CA+ttMd-XD4Hkfe0A0y1JJP+YxC0g4j9_QAdr9r1Q6bKxFss=Mg@mail.gmail.com>
Message-ID: <CAKgmDnGECyDtuCj7z+d=rQ+hjFhHqX-SAEL7Kw=p5SQHeGQn1w@mail.gmail.com>

Perhaps you should read the docs...


On Sat, Dec 28, 2013 at 3:21 PM, Paul Bell <arachweb at gmail.com> wrote:

> Can anyone shed some light on the questions I raised in my previous post?
>
> Thank you.
>
> -Paul
>
>
> On Wed, Dec 25, 2013 at 1:22 PM, Paul Bell <arachweb at gmail.com> wrote:
>
>> Hi Michael,
>>
>> I think we're close to the answer I need in order to think about this
>> more clearly. So, if I have two HA clusters connected via Shovel and I want
>> to publish a message that will be propagated not only to the local nodes in
>> the cluster, but also across the Shovel to all of the nodes in the remote
>> cluster, to where must I publish?
>>
>> Can my component simply publish to any exchange on its node, or must it
>> publish twice, once to any exchange on its node and again to a "special"
>> exchange which represents one end of the Shovel? (I don't really mean "any"
>> exchange; just trying to make a distinction between a local exchange I've
>> defined and which is mirrored across the local cluster, and what I suppose
>> to be a different exchange that is one end of the Shovel. I may be way out
>> of my depth in making this distinction).
>>
>> I will look at exchange confederation as you suggest.
>>
>> Thanks for your help.
>>
>> -Paul
>>
>>
>>
>>
>> On Sun, Dec 22, 2013 at 12:56 PM, Michael Klishin <
>> michael.s.klishin at gmail.com> wrote:
>>
>>> 2013/12/22 Paul Bell <arachweb at gmail.com>
>>>
>>>> I was looking at http://www.rabbitmq.com/shovel.html when your post
>>>> appeared. The language on that page speaks in terms of source and
>>>> destination brokers. Does this mean that Shovel is one way? Put otherwise,
>>>> if Cluster 1 is source and Cluster 2 destination, can Cluster 2 also act as
>>>> source; or would such a configuration/use require 2 Shovels, one for each
>>>> direction?
>>>>
>>>
>>> I believe it can but if you are looking for more sophisticated
>>> replication setups,
>>> take a look at federated exchanges:
>>>
>>> http://www.rabbitmq.com/federated-exchanges.html
>>>
>>> (note the max-hops setting)
>>>
>>> --
>>> MK
>>>
>>> http://github.com/michaelklishin
>>> http://twitter.com/michaelklishin
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131229/91352d3b/attachment.html>

From 314992959 at qq.com  Mon Dec 30 06:43:27 2013
From: 314992959 at qq.com (3k4b251)
Date: Sun, 29 Dec 2013 22:43:27 -0800 (PST)
Subject: [rabbitmq-discuss]
 =?utf-8?q?Rabbitmq_Server=28WINDOWS=29_configu?=
 =?utf-8?q?ration=EF=BC=9A_how__to__change___tcp=5Flistener=3F?=
In-Reply-To: <1388023699234-32304.post@n5.nabble.com>
References: <1388023699234-32304.post@n5.nabble.com>
Message-ID: <1388385807175-32324.post@n5.nabble.com>

can  anybody  help me ?  thanks  very much.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-Server-WINDOWS-configuration-how-to-change-tcp-listener-tp32304p32324.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Mon Dec 30 09:36:36 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 30 Dec 2013 09:36:36 +0000
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CA+ttMd-O6pYZ3aAB6ArY1+Eb2=QsBOuLpgUVFQ0hXBokf3Yz5A@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
 <5297651F.7010801@ontrenet.com>
 <CA+ttMd9efn6imHOWt+Ebg=qgSN-yTs2rejvw=E+rMM06dZR5sA@mail.gmail.com>
 <CAE3HoVSkeYrLxS=pEJ_FH5sAyAqG3yp2535MBf-Lt4FZX9A+HA@mail.gmail.com>
 <CA+ttMd94bBrsJoc--vwmaTL_xAw_4CsmZ17Xt091x6QS2UUGkA@mail.gmail.com>
 <CAE3HoVR7+Rz85cRqzBDaNBgxY2_Da2nLURTOTVXP5qShGvjpHQ@mail.gmail.com>
 <CA+ttMd-O6pYZ3aAB6ArY1+Eb2=QsBOuLpgUVFQ0hXBokf3Yz5A@mail.gmail.com>
Message-ID: <C575E735-7F2B-464F-B6DA-3D835769268E@rabbitmq.com>

Hi Paul,

Sorry for the delayed answer....

On 25 Dec 2013, at 18:22, Paul Bell wrote:

> Hi Michael,
> 
> I think we're close to the answer I need in order to think about this more clearly. So, if I have two HA clusters connected via Shovel and I want to publish a message that will be propagated not only to the local nodes in the cluster, but also across the Shovel to all of the nodes in the remote cluster, to where must I publish?
> 

I'm not sure I understand your topology precisely here, sorry.

> Can my component simply publish to any exchange on its node, or must it publish twice, once to any exchange on its node and again to a "special" exchange which represents one end of the Shovel? (I don't really mean "any" exchange; just trying to make a distinction between a local exchange I've defined and which is mirrored across the local cluster, and what I suppose to be a different exchange that is one end of the Shovel. I may be way out of my depth in making this distinction).
> 

The shovel reads from a queue (on the source) and publishes to an exchange (the destination). There's nothing special about the queue it reads from or the exchange it publishes to - they're just regular objects. Once you publishes to an exchange, how the message gets routed is entirely up to you (of course) and which queue(s) the shovel reads from is completely configurable.

Cheers,
Tim


From tim at rabbitmq.com  Mon Dec 30 09:38:28 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 30 Dec 2013 09:38:28 +0000
Subject: [rabbitmq-discuss]
 =?utf-8?q?Rabbitmq_Server=28WINDOWS=29_configu?=
 =?utf-8?q?ration=EF=BC=9A_how__to__change___tcp=5Flistener=3F?=
In-Reply-To: <1388023699234-32304.post@n5.nabble.com>
References: <1388023699234-32304.post@n5.nabble.com>
Message-ID: <D9051849-CA34-4DA5-B582-970D44E8A4E5@rabbitmq.com>

It is not RABBITMQ_NODE_PORT you need to change. You must change the `tcp_listeners' section of the configuration file. See https://www.rabbitmq.com/configure.html for more details.

Cheers,
Tim 

On 26 Dec 2013, at 02:08, 3k4b251 wrote:

> it's  always  be   5672.     I  try  to  change   rabbitmq-service.bat  and  
> rabbitmq-server.bat's  content  :  
> 
> <http://rabbitmq.1065348.n5.nabble.com/file/n32304/QQ%E6%88%AA%E5%9B%BE20131226100708.jpg> 
> 
>  also  try  to   set   environment  value  RABBITMQ_NODE_PORT  =  5801. 
> But  when  I start   by   rabbitmq-service.bat.  I  use   rabbitmqctl.bat  
> to   check  out  the  environment  And  See  the TCP_Listener  Still  5672.
> 
> <http://rabbitmq.1065348.n5.nabble.com/file/n32304/QQ%E6%88%AA%E5%9B%BE20131226100751.jpg> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-Server-WINDOWS-configuration-how-to-change-tcp-listener-tp32304.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From sandy.sandeeep at gmail.com  Mon Dec 30 10:03:46 2013
From: sandy.sandeeep at gmail.com (sandeep kumar)
Date: Mon, 30 Dec 2013 15:33:46 +0530
Subject: [rabbitmq-discuss] flow control in rabbitmq
Message-ID: <CAC3dgDeP0n10ODR67Q7DiUEMN4bNWyPwU0O56R1=+VJQtoUU8Q@mail.gmail.com>

Hi ,

I have used single rabbitmq node , And I set  memory_high_watermark to a
small value(0.05)
and messages are being sent to the rabbitmq node at a higher rate.
When memory is about to be breached because of higher rate of messages to
the node creation of .rdq files is observed.
when the memory consumtion crosses the limit all connections to the node
getting blocked is observed.
At this point of time there is neither increase in queue size nor .rdq
size, but publish to queue statemt is getting executed.

Questions are :

where are the published messages are getting store when connections to
queue are in blocked state

how to handle this kind of scenario gracefully
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131230/4d1c9b84/attachment.html>

From michael.s.klishin at gmail.com  Mon Dec 30 10:20:43 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 30 Dec 2013 14:20:43 +0400
Subject: [rabbitmq-discuss] flow control in rabbitmq
In-Reply-To: <CAC3dgDeP0n10ODR67Q7DiUEMN4bNWyPwU0O56R1=+VJQtoUU8Q@mail.gmail.com>
References: <CAC3dgDeP0n10ODR67Q7DiUEMN4bNWyPwU0O56R1=+VJQtoUU8Q@mail.gmail.com>
Message-ID: <CAE3HoVQ8WXHiMuDTGyhaohq4eBzfc5y3RYsDUbd24-Bz9tc2aA@mail.gmail.com>

2013/12/30 sandeep kumar <sandy.sandeeep at gmail.com>

> where are the published messages are getting store when connections to
> queue are in blocked state
>

When RabbitMQ blocks a publisher, it stops reading from the socket. So,
some amount of in flight
data will be stored in OS caches. Once those fill up, publishing operations
should block (at least with
most clients).


> how to handle this kind of scenario gracefully
>

Allow RabbitMQ use more RAM, add more consumers so that they drain queues
and implement a feature in the client (similar to a write-ahead log) where
messages can go before being
published. You can also monitor message rates and server state over HTTP
API and throttle
your publishers using app-specific rules.

See also http://www.rabbitmq.com/connection-blocked.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131230/b49eccc9/attachment.html>

From tim at rabbitmq.com  Mon Dec 30 12:08:26 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 30 Dec 2013 12:08:26 +0000
Subject: [rabbitmq-discuss]
 =?utf-8?q?Rabbitmq_Server=28WINDOWS=29_configu?=
 =?utf-8?q?ration=EF=BC=9A_how__to__change___tcp=5Flistener=3F?=
In-Reply-To: <D9051849-CA34-4DA5-B582-970D44E8A4E5@rabbitmq.com>
References: <1388023699234-32304.post@n5.nabble.com>
 <D9051849-CA34-4DA5-B582-970D44E8A4E5@rabbitmq.com>
Message-ID: <F2D4DEBF-C4D5-4DCE-83A9-329F225C2ED0@rabbitmq.com>

Sorry, please let me clarify this as I don't want to add confusion: you can indeed change/set an _environment variable_ called RABBITMQ_NODE_PORT to override the configuration file - I had forgotten about that env variable. What I was getting at in my previous post is that changing the service.bat script is not the way to go about changing the port - actually setting the environment variable *or* changing the config file should do it. But if you change the service.bat script, you'll need to uninstall and then reinstall the service in order for the script changes to be picked up, which isn't the right way to go about setting the port.

Hope that's a bit clearer.

Cheers,
Tim

On 30 Dec 2013, at 09:38, Tim Watson wrote:

> It is not RABBITMQ_NODE_PORT you need to change. You must change the `tcp_listeners' section of the configuration file. See https://www.rabbitmq.com/configure.html for more details.
> 
> Cheers,
> Tim 
> 
> On 26 Dec 2013, at 02:08, 3k4b251 wrote:
> 
>> it's  always  be   5672.     I  try  to  change   rabbitmq-service.bat  and  
>> rabbitmq-server.bat's  content  :  
>> 
>> <http://rabbitmq.1065348.n5.nabble.com/file/n32304/QQ%E6%88%AA%E5%9B%BE20131226100708.jpg> 
>> 
>> also  try  to   set   environment  value  RABBITMQ_NODE_PORT  =  5801. 
>> But  when  I start   by   rabbitmq-service.bat.  I  use   rabbitmqctl.bat  
>> to   check  out  the  environment  And  See  the TCP_Listener  Still  5672.
>> 
>> <http://rabbitmq.1065348.n5.nabble.com/file/n32304/QQ%E6%88%AA%E5%9B%BE20131226100751.jpg> 
>> 
>> 
>> 
>> --
>> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-Server-WINDOWS-configuration-how-to-change-tcp-listener-tp32304.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alan.antonuk at gmail.com  Mon Dec 30 12:23:43 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 30 Dec 2013 04:23:43 -0800
Subject: [rabbitmq-discuss] [rabbitmq_c] Infinite wait in
 login_with_properties function
In-Reply-To: <1388037935031-32306.post@n5.nabble.com>
References: <1387786326818-32275.post@n5.nabble.com>
 <CAAt2poJhK0ndFKbpMd17jY23NEj+ZQ_sUsB27z15W5pOB3mwhA@mail.gmail.com>
 <1388037935031-32306.post@n5.nabble.com>
Message-ID: <CAAt2poJh10xbp1wAE_E_pHUne2KFf5qipskfMsCocsQAVgVF1Q@mail.gmail.com>

To be clear rabbitmq-c shouldn't infinite loop inside of amqp_login*() when
network issues occur. Most likely what will happen is that the recv() call
will have a long timeout before returning failure, which will be bubbled up
and returned as an error from the amqp_login*() function.

-Alan


On Wed, Dec 25, 2013 at 10:05 PM, Haster <haster2004 at yandex.ru> wrote:

> Hi, Alan.
>
> I saw this behavior only one time. But I didn't try to reproduce it.
>
> I don't think, that network problems could happen frequently in that place,
> but
> if they happen... there will be infinite loop
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-Infinite-wait-in-login-with-properties-function-tp32275p32306.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131230/9f6ced42/attachment.html>

From tim at rabbitmq.com  Mon Dec 30 15:21:32 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 30 Dec 2013 15:21:32 +0000
Subject: [rabbitmq-discuss] Does Certificate updation requires server
	bounce?
In-Reply-To: <1388301379242-32322.post@n5.nabble.com>
References: <1388301379242-32322.post@n5.nabble.com>
Message-ID: <221650E4-4AE9-4A8A-A60E-B69FF1766508@rabbitmq.com>

Hi,

On 29 Dec 2013, at 07:16, k.madnani84 wrote:
> Suppose i have a rabbitMQ with ssl support enabled.If i Modify any of the
> certificates(root or server) or key do i need to bounce back the server to
> bring it to effect?
> 

RabbitMQ reads its configuration file just once at startup, so changing the path to any certificates (if that's what you're asking about) will not take effect unless the server is restarted. If you're asking about making physical changes to the cert file(s) once the server is running, then I'm not sure what the answer is here. Having briefly looked at erlang's ssl application, some caching of certificates does appear to be taking place, but there are several components at work so so I'm not 100% certain. It appears that the runtime trusted certificates database used by the ssl application uses an MD5 hash of the cert file to determine whether or not a new trusted cert entry is required when initialising a new ssl connection, but what the actual effect will be (of changing a file whilst the server is running) I couldn't say right now without further investigation.

Cheers,
Tim

From 1006798382 at qq.com  Mon Dec 30 16:44:33 2013
From: 1006798382 at qq.com (=?gb18030?B?0qy35w==?=)
Date: Tue, 31 Dec 2013 00:44:33 +0800
Subject: [rabbitmq-discuss] MQ consumer become very slow if there are a lot
	of ready message
Message-ID: <tencent_6422895F3FA7FA061ED0BAB9@qq.com>

I have 1 node with 8 cores cpu(Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz) and 16G RAMOS: centos 6.3 64bits
Rabbit MQ version: rabbitmq-server-3.2.2-1.noarch


exchange: ex-statcen, direct type
queue :4 queues, use the same direct routine key to get 4 copies from the ex-statcen


It worked ok at start, the speed to ex-statcen exchange is 7k/sec, and the consumer is very quickly.
After a while, the queue consumer become slow, about 2,000,000 messages stayed in queue.
Then I stop the consumer and restart a new consumer, the speed of consumption was still very slow, about 10~700/sec.


My question is why the speed of consumption can not back to the 7k/sec? How to improve the speed.


Note that I've enabled the HiPE. with erlang R16B03 version


thx!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/39fec625/attachment.html>

From videlalvaro at gmail.com  Mon Dec 30 16:50:17 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 30 Dec 2013 17:50:17 +0100
Subject: [rabbitmq-discuss] MQ consumer become very slow if there are a
 lot of ready message
In-Reply-To: <tencent_6422895F3FA7FA061ED0BAB9@qq.com>
References: <tencent_6422895F3FA7FA061ED0BAB9@qq.com>
Message-ID: <CAMcAHLXye=Bjeao7kVEWo+8ZvmF6VuaC3Ey6DKD5xNLjQ=J8cg@mail.gmail.com>

Hi,

See: http://www.rabbitmq.com/blog/2011/10/27/performance-of-queues-when-less-is-more/

Usually RabbitMQ queues are faster with fewer messages for the reasons
explained there.

Apart from that, that blog post explains how you could configure your
basic.qos settings to reduce latency.

Regards,

Alvaro

On Mon, Dec 30, 2013 at 5:44 PM, ?? <1006798382 at qq.com> wrote:
> I have 1 node with 8 cores cpu(Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz) and
> 16G RAM
> OS: centos 6.3 64bits
> Rabbit MQ version: rabbitmq-server-3.2.2-1.noarch
>
> exchange: ex-statcen, direct type
> queue :4 queues, use the same direct routine key to get 4 copies from the
> ex-statcen
>
> It worked ok at start, the speed to ex-statcen exchange is 7k/sec, and the
> consumer is very quickly.
> After a while, the queue consumer become slow, about 2,000,000 messages
> stayed in queue.
> Then I stop the consumer and restart a new consumer, the speed of
> consumption was still very slow, about 10~700/sec.
>
> My question is why the speed of consumption can not back to the 7k/sec? How
> to improve the speed.
>
> Note that I've enabled the HiPE. with erlang R16B03 version
>
> thx!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From ryankbrown at gmail.com  Mon Dec 30 18:08:17 2013
From: ryankbrown at gmail.com (Ryan Brown)
Date: Mon, 30 Dec 2013 11:08:17 -0700
Subject: [rabbitmq-discuss] rabbitmq-server_3.2.2-1_all.deb installs Erlang
	14b?
Message-ID: <CAChGYf96w_=X88xpMgipktKpOxFBBzsqbUFf+sx71NPke++=kw@mail.gmail.com>

I am creating a fabric script to install rabbit from a barebones ubuntu
12.04 box. First step is to install erlang 16, which we do from the ESL deb
package. Then we install rabbit with the rabbitmq-server_3.2.2-1_all.deb
package. During install, the rabbit package installs 14b over the 16
install. I assume this is dues to where the ESL package gets installed by
default. (?) Any ideas of how can I prevent this from happening?

Best.

-- 
-rb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131230/f2dabdf0/attachment.html>

From tom.collins.work at gmail.com  Mon Dec 30 18:58:01 2013
From: tom.collins.work at gmail.com (tom collins)
Date: Mon, 30 Dec 2013 12:58:01 -0600
Subject: [rabbitmq-discuss] MQTT cannot connect client
Message-ID: <CALP4UdAZ572vUtCg4+j15KTHmb=__s4x8SO+sDF0bM5Bp8LiUA@mail.gmail.com>

Hi,



I'm having timeout issues connecting clients and I'm stumped. I?m doubting
it?s a bug but I have no idea how to get around the problem without
restarting RMQ every time it occurs.



I'm working on an Android app using MQTT, which at times does not close
cleanly meaning it doesn't disconnect. The application restarts and seems
to connect on a new connection (clean session set to false, is this correct
behaviour?) which can be seen in the management interface and the client
connection is made successfully.


However after about five cycles (The amount of times seems to differ) of
the client abruptly closing and connecting RMQ seems to hang and does not
respond to any client connection. The MQTT client attempts to connect,
appears in the management interface connections but does not respond
meaning the client times out(or waits for the response if a timeout isn't
specified).


Heartbeats are configured so I'm assuming this should disconnect the old
client connections but for some reason it isn't...



I?ve checked the logs (Displaying all levels) and nothing stands out. There
was a  reoccurring error which seemed to be my closest lead but I haven?t
seen it (See below for log) for at least a week and even though the problem
still occurs, I still have no inkling as to why this error was occurring.







=SUPERVISOR REPORT==== 23-Dec-2013::19:04:14 ===

     Supervisor: {<0.6080.0>,amqp_connection_sup}

     Context:    shutdown

     Reason:     reached_max_restart_intensity

     Offender:   [{pid,<0.6082.0>},

                  {name,connection},

                  {mfargs,

                      {amqp_gen_connection,start_link,

                          [<0.6081.0>,

                           {amqp_params_direct,<<"public-mqtt-client">>,

                               <<"-------------">>,<<"---------">>,

                               'rabbit at -----------,

                               {amqp_adapter_info,

                                   {----------------},

                                   1883,

                                   {----------------,79},

                                   57632,

                                   <<"---------------:57632 ->
-------------:1883">>,

                                   {'MQTT',{3,1}},

                                   [{ssl,false}]},

                               []}]}},

                  {restart_type,intrinsic},

                  {shutdown,brutal_kill},

                  {child_type,worker}]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131230/4be46543/attachment.html>

From j-jimenez at finamex.com.mx  Mon Dec 30 20:07:39 2013
From: j-jimenez at finamex.com.mx (Jose Jimenez Ortiz)
Date: Mon, 30 Dec 2013 14:07:39 -0600
Subject: [rabbitmq-discuss] Cluster + Federation
Message-ID: <AFFA651B612BDE4EB570E34F0571834D12CC11CAB8@mail.vfinamex.local>

Hi,

Actually use Federation scheme on WAN, but in the future planed use Federation + Cluster, Con you indicate or help me on this?

I have some questions:


*         .Net clients, how know what rabbitmq connecting (2 fedora boxs in cluster)?

*         Rabbitmq federation, resolve so what cluster box connecting?

Regards,
Jose Jimenez


________________________________
AVISO IMPORTANTE
Este correo electr?nico y sus anexos pueden contener informaci?n CONFIDENCIAL para uso exclusivo de su destinatario. Si ha recibido este correo por error, por favor, notif?quelo al remitente y b?rrelo de su sistema junto con los archivos que en su caso se anexen. Las opiniones expresadas en este correo son las de su autor y no son necesariamente compartidas o apoyadas por la compa??a. Cualquier opini?n, propuesta o recomendaci?n aqu? contenida est? sujeta a las condiciones regulatorias que resulten aplicables y a los acuerdos comerciales, contratos y dem?s documentos suscritos con el destinatario y/o con la empresa que representa. No se garantiza que la transmisi?n de este correo sea segura o libre de errores, podr?a haber sido viciada, perdida, destruida, haber llegado tarde, de forma incompleta o contener VIRUS.

IMPORTANT NOTICE
This e-mail w/attachments is intended solely for the use of the intended recipient(s) and may contain information that is privileged, confidential or proprietary. If you are not an intended recipient, please notify the sender, and then please delete and destroy all copies and attachments. The opinions expressed in this e-mail are not necessarily shared or supported by the Company. Any opinion, suggestion or recommendation written in this e-mail will be subject to regulatory conditions, commercial agreements, copyright laws, contracts and any other agreement signed with the addressee and/or the Company that the addressee represents. The transmission of this e-mail cannot be guaranteed to be secure or virus free, the transmission could be vitiated, lost, destroyed, delayed, incomplete or may contain virus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131230/074ae761/attachment.html>

From davechintan at gmail.com  Tue Dec 31 10:38:06 2013
From: davechintan at gmail.com (Chintan Dave)
Date: Tue, 31 Dec 2013 16:08:06 +0530
Subject: [rabbitmq-discuss] JMS provider in python using RabbitMQ
Message-ID: <CAL9x60o0fW9jOsoj7wDm8xPZ9wd_VQSnJAHXfzLszyp8Bs0-tw@mail.gmail.com>

Hi,

I need to post messages on a JMS queue on a remote server.
If I am not wrong, RabbitMQ is compliant to JMS v1.1. I want to develop a
JMS producer using the python binding supported by RabbitMQ, however I am
not able to find any specific reference documentation for the same.

The one's available use AMQP Producer and Consumer.

Any pointers would be helpful.
-- 
Regards,
Chintan Dave,

LinkedIn: http://in.linkedin.com/in/chintandave
Blog:http://www.chintandave.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/550c30f1/attachment.html>

From kournjaev at gmail.com  Tue Dec 31 09:20:58 2013
From: kournjaev at gmail.com (Roman Kournjaev)
Date: Tue, 31 Dec 2013 01:20:58 -0800 (PST)
Subject: [rabbitmq-discuss] Scaling rabbitmq on ec2
Message-ID: <13c5c66f-bbed-4d96-b8e8-03402916c91d@googlegroups.com>

Hi

I hope someone can help me out with some advice , cause I am struggling for 
quite a while now.

I have some ad server application running on AWS ec2. The server are 
tomcats that can scale , with the load right now I have 10 servers running. 
The overall load on the servers is something 1K rps . It produces twice as 
much messages that have to be persisted eventually.

Right now the servers send these messages to rabbitmq instances ( that are 
not connected to a cluster ) , each tomcat has an open connection to every 
rabbitmq broker and just picks one randomly to send a message.

On the other side I have a consumer that consumes all the messages from all 
the brokers.

The brokers are running on a medium instance ( thats 1 cpu and 3.5 GB ram ) 
and the queues are not persistent or mirrored. The issue is that the 
brokers get to 100 cpu at speeds reaching 700 messages/sec. 

I guess connecting the brokers to a cluster will only decrease the 
performance also i will have to configure a tcp load balancer to connect to 
the cluster from tomcats. Also creating a rabbitmq cluster is not trivial 
at all , especially if the brokers are on an auto scaling group.

So for the question : 


   1. I read some benchmarks out there and could not understand whether the 
   700m/sec is slow or not. I can use a bigger instance with more CPU , but 
   will the load grow linear ? 
   2. Do you spot anything wrong in the architecture ? Can you think of an 
   overall better approach in the message chain ?


Thanks
Roman



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/91206f58/attachment.html>

From tim at rabbitmq.com  Tue Dec 31 13:13:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 31 Dec 2013 13:13:07 +0000
Subject: [rabbitmq-discuss] JMS provider in python using RabbitMQ
In-Reply-To: <CAL9x60o0fW9jOsoj7wDm8xPZ9wd_VQSnJAHXfzLszyp8Bs0-tw@mail.gmail.com>
References: <CAL9x60o0fW9jOsoj7wDm8xPZ9wd_VQSnJAHXfzLszyp8Bs0-tw@mail.gmail.com>
Message-ID: <B3A55BEC-4077-40BE-B716-63B68BA42B47@rabbitmq.com>

Hi
On 31 Dec 2013, at 10:38, Chintan Dave wrote:
> I need to post messages on a JMS queue on a remote server.
> If I am not wrong, RabbitMQ is compliant to JMS v1.1. I want to develop a JMS producer using the python binding supported by RabbitMQ, however I am not able to find any specific reference documentation for the same.
> 

JMS is a Java-specific API, so you won't be able to write JMS (Java Messaging Service) code in python. What you should be able to do is send/write AMQP messages to an exchange using python + AMQP, bind that exchange to one or more queues (using AMQP bindings on the broker) and _consume_ the queued messages from a java client.

> The one's available use AMQP Producer and Consumer.
> 
> Any pointers would be helpful.

If you explain a bit more about the architecture you're aiming to produce, we might be able to offer more specific advice.

Cheers,
Tim


From michael.laing at nytimes.com  Tue Dec 31 13:20:10 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 31 Dec 2013 08:20:10 -0500
Subject: [rabbitmq-discuss] Scaling rabbitmq on ec2
In-Reply-To: <13c5c66f-bbed-4d96-b8e8-03402916c91d@googlegroups.com>
References: <13c5c66f-bbed-4d96-b8e8-03402916c91d@googlegroups.com>
Message-ID: <CAKgmDnHqPfVYtRkD7FYDRQ3c3oi1A4AksLD+J_yOHNVZ8XWypw@mail.gmail.com>

Hi Roman,

We use ec2 and autoscaling extensively as well.

If you are pushing 100% then you are out of the 'sweet spot' for the
instance.

The first thing I suggest is to switch to C1 medium instances for your
workload (1.7GB memory, 2 CPUs). These instances have 2.5 times the
processing power of the M1 mediums for about the same price. Given what you
have said about your workload, you can get by with less memory.
Erlang/rabbitmq are very memory efficient (not like Java) and can really
make use of the extra CPU.

Clustering will not buy you anything on smallish autoscaling instances,
based upon your description, and will add more complexity than it removes,
IMHO.

The second thing I would suggest is to experiment and test:

Spreading out across multiple instances, as you describe, is operationally
complex. If your base load warrants it, you could try larger instances and
fewer of them, e.g. C1 xlarge with 8 CPUs. We cluster 3 of these as the
'core' of a processing pipeline (we have variable numbers of pipelines in a
region).

An advantage of larger instances is that they have consistently higher
bandwidth and are less subject to 'noisy neighbors'.

However, you may want to use multiple queues anyway, in your architecture,
in order to keep all the CPUs busy. We don't do that but there are many on
the list who can offer good advice - and lots of previous messages about
that.

We cluster and mirror our queues to avoid losing messages and to centralize
administration. I would experiment with it if I were you. There is a small
performance penalty.

BTW you don't need the TCP load balancer with a cluster: every machine can
see every queue regardless of whether they are mirrored or not.

Hope this helps.

Michael




On Tue, Dec 31, 2013 at 4:20 AM, Roman Kournjaev <kournjaev at gmail.com>wrote:

> Hi
>
> I hope someone can help me out with some advice , cause I am struggling
> for quite a while now.
>
> I have some ad server application running on AWS ec2. The server are
> tomcats that can scale , with the load right now I have 10 servers running.
> The overall load on the servers is something 1K rps . It produces twice as
> much messages that have to be persisted eventually.
>
> Right now the servers send these messages to rabbitmq instances ( that are
> not connected to a cluster ) , each tomcat has an open connection to every
> rabbitmq broker and just picks one randomly to send a message.
>
> On the other side I have a consumer that consumes all the messages from
> all the brokers.
>
> The brokers are running on a medium instance ( thats 1 cpu and 3.5 GB ram
> ) and the queues are not persistent or mirrored. The issue is that the
> brokers get to 100 cpu at speeds reaching 700 messages/sec.
>
> I guess connecting the brokers to a cluster will only decrease the
> performance also i will have to configure a tcp load balancer to connect to
> the cluster from tomcats. Also creating a rabbitmq cluster is not trivial
> at all , especially if the brokers are on an auto scaling group.
>
> So for the question :
>
>
>    1. I read some benchmarks out there and could not understand whether
>    the 700m/sec is slow or not. I can use a bigger instance with more CPU ,
>    but will the load grow linear ?
>    2. Do you spot anything wrong in the architecture ? Can you think of
>    an overall better approach in the message chain ?
>
>
> Thanks
> Roman
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/8f3f291d/attachment.html>

From tim at rabbitmq.com  Tue Dec 31 15:24:23 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 31 Dec 2013 15:24:23 +0000
Subject: [rabbitmq-discuss] cluster
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D018378BE@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018378BE@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <BF168DC3-379E-4DC6-80F9-05F27288B097@rabbitmq.com>

Hi,

On 11 Dec 2013, at 19:13, PATAR, SAGAR wrote:
> We have 2 datacenters and are planning to have 2 separate clusters ..1 each in a datacenter ..
>  
> We want both the clusters to be active and have a geo load balance between these two clusters..
> Can we have a federation bi directional between the clusters for a queue??

Yes - see the section on "Federating clusters" in http://www.rabbitmq.com/federation.html. From the documentation on http://www.rabbitmq.com/federated-exchanges.html you might also want to look at the section "Can I federate a federated exchange?" as well.

> Also we are planning to have some mirrored queues on each cluster ? Can node 1 act as a master for one of the mirrored queue and node 2 acts as master for 2nd mirror queue ? or only 1 node acts as master for all the mirrored queues in the cluster ??

You can use the "nodes" policy to deliberately change which nodes are mirror-queue masters. The key thing usually considers though, is how many slave nodes you want to replicate across. But in general, yes, you can (and will) have master queue processes residing on various nodes in the cluster.

> Also we are planning for a durable queues ?  let?s say if a cluster is down before the messages get consumed .. and the message has TTL defined ? does the TTL continue during the downtime and do we lose the message once the nodes are UP .. or does it resets the TTL??

TTL does not continue during downtime.

>  
> Appreciate all the help..
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/1c9b5a14/attachment.html>

From tim at rabbitmq.com  Tue Dec 31 15:25:53 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 31 Dec 2013 15:25:53 +0000
Subject: [rabbitmq-discuss] Periodic SSL connection timeout issues
In-Reply-To: <9966f3ca-0fcf-45dd-b68f-13804d145e30@googlegroups.com>
References: <9966f3ca-0fcf-45dd-b68f-13804d145e30@googlegroups.com>
Message-ID: <90690DC4-75BE-4215-8014-E08D49539DC8@rabbitmq.com>

Hi,

> Could you please help us figure out the root cause of this problem and any workarounds if any?

Have you ruled out physical and/or logical network interruptions as the cause? Are you using AMQP heartbeats?

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/351fcb55/attachment.html>

From tim at rabbitmq.com  Tue Dec 31 15:44:53 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 31 Dec 2013 15:44:53 +0000
Subject: [rabbitmq-discuss] cluster
In-Reply-To: <BF168DC3-379E-4DC6-80F9-05F27288B097@rabbitmq.com>
References: <59BF56992750434F89F8EBE141E64B1D018378BE@GAALPA1MSGUSR9C.ITServices.sbc.com>
 <BF168DC3-379E-4DC6-80F9-05F27288B097@rabbitmq.com>
Message-ID: <B0AD903A-9342-4D32-B64E-657E9BDD0363@rabbitmq.com>

On 31 Dec 2013, at 15:24, Tim Watson wrote:
>> Also we are planning for a durable queues ?  let?s say if a cluster is down before the messages get consumed .. and the message has TTL defined ? does the TTL continue during the downtime and do we lose the message once the nodes are UP .. or does it resets the TTL??
> 
> TTL does not continue during downtime.
> 
>> 

Whoa - sorry that's quite wrong. TTL *does* continue during downtime. The messages will be expired (i.e., dropped) if their TTL expires and downtime *does* count towards the TTL.

Sorry for the confusion.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/f12794a9/attachment.html>

From roberto at canary.is  Tue Dec 31 16:47:45 2013
From: roberto at canary.is (Roberto Pagliari)
Date: Tue, 31 Dec 2013 11:47:45 -0500
Subject: [rabbitmq-discuss] RabbitMQ for ARM
Message-ID: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>

I found this client for C++ that I would like to compile for ARM
architecture:

https://github.com/alanxz/SimpleAmqpClient

but it does require boost to compile.


Is there anything available that *does not* require Boost libraries (either
C or C++)?



Thank you,
Roberto
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/742d9047/attachment.html>

From matwey.kornilov at gmail.com  Tue Dec 31 19:38:32 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Tue, 31 Dec 2013 23:38:32 +0400
Subject: [rabbitmq-discuss] RabbitMQ for ARM
In-Reply-To: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>
References: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>
Message-ID: <l9v6fd$f6t$1@ger.gmane.org>

31.12.2013 20:47, Roberto Pagliari ?????:

> Is there anything available that *does not* require Boost libraries
> (either C or C++)?

What's about 'official' C client?
https://github.com/alanxz/rabbitmq-c


From jkuch at gopivotal.com  Tue Dec 31 19:39:09 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Tue, 31 Dec 2013 11:39:09 -0800
Subject: [rabbitmq-discuss] RabbitMQ for ARM
In-Reply-To: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>
References: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>
Message-ID: <CANOx8NmXsSR=C4QWid7tEEwbg9K9u-SqErx43ymtvkWcTNJv7Q@mail.gmail.com>

ARM architecture on what OS and toolchain?  The rabbitmq-c client can be
built on various systems that typically run on ARM such as iOS and its
vendor-provided toolchain.




On Tue, Dec 31, 2013 at 8:47 AM, Roberto Pagliari <roberto at canary.is> wrote:

> I found this client for C++ that I would like to compile for ARM
> architecture:
>
> https://github.com/alanxz/SimpleAmqpClient
>
> but it does require boost to compile.
>
>
> Is there anything available that *does not* require Boost libraries
> (either C or C++)?
>
>
>
> Thank you,
> Roberto
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/574dd074/attachment.html>

From jkuch at gopivotal.com  Tue Dec 31 19:44:05 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Tue, 31 Dec 2013 11:44:05 -0800
Subject: [rabbitmq-discuss] RabbitMQ for ARM
In-Reply-To: <l9v6fd$f6t$1@ger.gmane.org>
References: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>
 <l9v6fd$f6t$1@ger.gmane.org>
Message-ID: <CANOx8NnY3sjPPSMjnA5midf9J2_K+GyvGnXdcjRrLaguBgUPdw@mail.gmail.com>

That's the one I've used on ARM-based iOS successfully.


On Tue, Dec 31, 2013 at 11:38 AM, Matwey V. Kornilov <
matwey.kornilov at gmail.com> wrote:

> 31.12.2013 20:47, Roberto Pagliari ?????:
>
>  Is there anything available that *does not* require Boost libraries
>> (either C or C++)?
>>
>
> What's about 'official' C client?
> https://github.com/alanxz/rabbitmq-c
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/92afb185/attachment.html>

From roberto at canary.is  Tue Dec 31 19:56:07 2013
From: roberto at canary.is (Roberto Pagliari)
Date: Tue, 31 Dec 2013 14:56:07 -0500
Subject: [rabbitmq-discuss] RabbitMQ for ARM
In-Reply-To: <CANOx8NnY3sjPPSMjnA5midf9J2_K+GyvGnXdcjRrLaguBgUPdw@mail.gmail.com>
References: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>
 <l9v6fd$f6t$1@ger.gmane.org>
 <CANOx8NnY3sjPPSMjnA5midf9J2_K+GyvGnXdcjRrLaguBgUPdw@mail.gmail.com>
Message-ID: <CANAFtV5vEZMi11EKLFNDMwzPx_yPSYDidwALYPspF2Uw=8ZbzQ@mail.gmail.com>

The host where I build is Ubuntu 12.

the ARM architecture is running busy-box..


On Tue, Dec 31, 2013 at 2:44 PM, Jerry Kuch <jkuch at gopivotal.com> wrote:

> That's the one I've used on ARM-based iOS successfully.
>
>
> On Tue, Dec 31, 2013 at 11:38 AM, Matwey V. Kornilov <
> matwey.kornilov at gmail.com> wrote:
>
>> 31.12.2013 20:47, Roberto Pagliari ?????:
>>
>>  Is there anything available that *does not* require Boost libraries
>>> (either C or C++)?
>>>
>>
>> What's about 'official' C client?
>> https://github.com/alanxz/rabbitmq-c
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/b0479a89/attachment.html>

From matwey.kornilov at gmail.com  Tue Dec 31 21:24:33 2013
From: matwey.kornilov at gmail.com (Matwey V. Kornilov)
Date: Wed, 01 Jan 2014 01:24:33 +0400
Subject: [rabbitmq-discuss] RabbitMQ for ARM
In-Reply-To: <CANOx8NnY3sjPPSMjnA5midf9J2_K+GyvGnXdcjRrLaguBgUPdw@mail.gmail.com>
References: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>
 <l9v6fd$f6t$1@ger.gmane.org>
 <CANOx8NnY3sjPPSMjnA5midf9J2_K+GyvGnXdcjRrLaguBgUPdw@mail.gmail.com>
Message-ID: <l9vcm5$afh$1@ger.gmane.org>

31.12.2013 23:44, Jerry Kuch ?????:
> That's the one I've used on ARM-based iOS successfully.

Small wonder. I really don't think that this library can include 
something architecture specific.




From jkuch at gopivotal.com  Tue Dec 31 22:08:26 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Tue, 31 Dec 2013 14:08:26 -0800
Subject: [rabbitmq-discuss] RabbitMQ for ARM
In-Reply-To: <l9vcm5$afh$1@ger.gmane.org>
References: <CANAFtV4_hksr8hYaJBuhPFYjc3uig3ii5dDhVGiTb8XamyotKg@mail.gmail.com>
 <l9v6fd$f6t$1@ger.gmane.org>
 <CANOx8NnY3sjPPSMjnA5midf9J2_K+GyvGnXdcjRrLaguBgUPdw@mail.gmail.com>
 <l9vcm5$afh$1@ger.gmane.org>
Message-ID: <CANOx8Nn81cn8Z+AWWvbnJ7SN=--QobEYVD1iPsuUJYpK0LifNA@mail.gmail.com>

Agreed. If you need an AMQP client that you have to compile to native code
somewhere, this is your best choice. It's also a compact and conceptually
simple enough piece of code that it doesn't benefit hugely from a lot of
OOP-i-ness spackled atop it anyway...  once library and toolchain
dependencies grow these things get hard to use pretty quickly.



On Tue, Dec 31, 2013 at 1:24 PM, Matwey V. Kornilov <
matwey.kornilov at gmail.com> wrote:

> 31.12.2013 23:44, Jerry Kuch ?????:
>
>  That's the one I've used on ARM-based iOS successfully.
>>
>
> Small wonder. I really don't think that this library can include something
> architecture specific.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131231/5ab1c719/attachment.html>

