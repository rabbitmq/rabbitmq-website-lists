<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] .NET client SimpleRpcServer question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20.NET%20client%20SimpleRpcServer%20question&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003885.html">
   <LINK REL="Next"  HREF="003751.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] .NET client SimpleRpcServer question</H1>
    <B>Ryan Davis</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20.NET%20client%20SimpleRpcServer%20question&In-Reply-To="
       TITLE="[rabbitmq-discuss] .NET client SimpleRpcServer question">ryan at acceleration.net
       </A><BR>
    <I>Fri Jun  5 15:20:08 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003885.html">[rabbitmq-discuss] Fwd: rabbit MQ high-through put stock quotes
</A></li>
        <LI>Next message: <A HREF="003751.html">[rabbitmq-discuss] .NET client SimpleRpcServer question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3702">[ date ]</a>
              <a href="thread.html#3702">[ thread ]</a>
              <a href="subject.html#3702">[ subject ]</a>
              <a href="author.html#3702">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have some C# code extending SimpleRpcServer and am getting an
exception when trying to shut down.  In the documentation PDF, it said
to call the Close() function on your RpcServer when you are ready to
shutdown.  Since the MainLoop() function blocks, the Close() has to be
called from another thread, right?  I have code that looks something
like this:

//RpcServer is a member variable
parentObj.ShuttingDown += delegate {
  RpcServer.Close();
};
// glossing over the AMQP config a little here
using(var connection =  factory.CreateConnection(&quot;my-amqp-server&quot;))
using(var model =  connection.CreateModel())
using(var subscription =  new Subscription(model, &quot;queue&quot;, false))
using (RpcServer = new MyRpcServer(subscription, this)) { // MyRpcServer
extends SimpleRpcServer
  RpcServer.MainLoop();
}

When I do fire the ShuttingDown event from another thread, we call
Close() with no problems, and then the MainLoop throws a
NullReferenceException:

System.NullReferenceException: Object reference not set to an instance of an object.     
at RabbitMQ.Client.Impl.ModelBase.BasicCancel(String consumerTag)     
at RabbitMQ.Client.MessagePatterns.Subscription.Close()     
at RabbitMQ.Client.MessagePatterns.Subscription.System.IDisposable.Dispose()     
at RabbitMQ.Client.MessagePatterns.SimpleRpcServer.MainLoop()

I followed this call stack through the RabbitMQ.Client source and didn't
see anything obvious.

This isn't causing me any harm right now (other than red flags in my
logs), but it would be if I tried to put anything important after the
MainLoop call.

Is there a cleaner way to shut down an RpcServer?  Should I just swallow
this nullref when I'm shutting down?

Thanks,

-- 
Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003885.html">[rabbitmq-discuss] Fwd: rabbit MQ high-through put stock quotes
</A></li>
	<LI>Next message: <A HREF="003751.html">[rabbitmq-discuss] .NET client SimpleRpcServer question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3702">[ date ]</a>
              <a href="thread.html#3702">[ thread ]</a>
              <a href="subject.html#3702">[ subject ]</a>
              <a href="author.html#3702">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
