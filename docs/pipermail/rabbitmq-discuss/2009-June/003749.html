<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Creating exchanges on demand.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Creating%20exchanges%20on%20demand.&In-Reply-To=f5965c00906051304y6ff36c67od27c978a81452621%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003726.html">
   <LINK REL="Next"  HREF="003750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Creating exchanges on demand.</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Creating%20exchanges%20on%20demand.&In-Reply-To=f5965c00906051304y6ff36c67od27c978a81452621%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Creating exchanges on demand.">matthias at lshift.net
       </A><BR>
    <I>Mon Jun  8 20:44:44 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003726.html">[rabbitmq-discuss] Creating exchanges on demand.
</A></li>
        <LI>Next message: <A HREF="003750.html">[rabbitmq-discuss] Creating exchanges on demand.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3749">[ date ]</a>
              <a href="thread.html#3749">[ thread ]</a>
              <a href="subject.html#3749">[ subject ]</a>
              <a href="author.html#3749">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Camilo,

Camilo Lopez wrote:
&gt;<i> Appart from the rpc facilities  in the clients is there a good pattern
</I>&gt;<i> to follow here?
</I>
The rpc wrappers actually implement a very straightforward pattern. Take 
a look at the code for Rpc{Client,Server}.java.

The pattern is this:

The server creates a queue for requests and binds that queue to an 
exchange. In the simplest case, the queue is named after the rpc service 
and the standard binding to AMQP's default exchange suffices - that's 
what I am assuming below. The server subscribes a consumer to that queue.

Each client creates a (usually anonymous and exclusive) queue for 
replies and subscribes a consumer (usually with noAck=true) to that queue.

RPCs then happen as follows:

1. The client publishes the request as a message to the default exchange 
with a routing key identifying the rpc service, the request as the 
payload, and two message properties (see 
<A HREF="http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.5/rabbitmq-java-client-javadoc-1.5.5/com/rabbitmq/client/AMQP.BasicProperties.html">http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.5/rabbitmq-java-client-javadoc-1.5.5/com/rabbitmq/client/AMQP.BasicProperties.html</A>) 
a correlationId that identifies the requests (this is only necessary if 
the client wants to pipeline requests), and a replyTo property set to 
its reply queue name.

2. The server's consumer receives the request, performs the necessary 
invocations, and then publishes the reply to the default exchange with 
the routing key set to the value of the replyTo property of the request, 
and the correlationId message property set to the correlationId property 
of the request. The client then basic.ack's the request.

3. The client's consumer receives the reply, and correlates it with the 
request using the correlationId.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003726.html">[rabbitmq-discuss] Creating exchanges on demand.
</A></li>
	<LI>Next message: <A HREF="003750.html">[rabbitmq-discuss] Creating exchanges on demand.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3749">[ date ]</a>
              <a href="thread.html#3749">[ thread ]</a>
              <a href="subject.html#3749">[ subject ]</a>
              <a href="author.html#3749">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
