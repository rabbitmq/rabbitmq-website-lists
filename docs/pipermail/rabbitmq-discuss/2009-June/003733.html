<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20stomp-adapter%20behaviour&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003732.html">
   <LINK REL="Next"  HREF="003734.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ stomp-adapter behaviour</H1>
    <B>Nicolas Echaniz</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20stomp-adapter%20behaviour&In-Reply-To="
       TITLE="[rabbitmq-discuss] RabbitMQ stomp-adapter behaviour">nico at rakar.com
       </A><BR>
    <I>Mon Jun  8 03:40:23 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003732.html">[rabbitmq-discuss] Workaround for basic reject...
</A></li>
        <LI>Next message: <A HREF="003734.html">[rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3733">[ date ]</a>
              <a href="thread.html#3733">[ thread ]</a>
              <a href="subject.html#3733">[ subject ]</a>
              <a href="author.html#3733">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

There has recently been a discussion[1] in the Orbited[2] mailing list -to 
which I'm cc'ing this message-  about using RabbitMQ + stomp-adapter as STOMP 
Broker for a &quot;comet&quot; web-chat sample application.

The problems began when I replaced Orbited's own rather simple STOMP Broker 
(called morbid) with RabbitMQ + stomp-adapter. After configuration, the sample 
code worked fine, but the messages sent were not received by every client 
subscribed to the destination.

I found out that this was the RabbitMQ interpretation of how the broker should 
behave by reading some docs in your site[3] and a thread in your mailing 
list[4].

So I adapted my sample code to make it work with RabbitMQ in &quot;broadcast 
behaviour&quot;.
As of his writing, you can find a running sample at:
<A HREF="http://www.proyectomutuo.org/live/public">http://www.proyectomutuo.org/live/public</A>

Having solved this matter I started looking into the matter of subscribing my 
Django app to the STOMP broker. Before starting, I looked into the stomper 
Python module code to see if I'd be able to send the extra-headers that 
RabbitMQ needs to behave as I need it to, but it I found out that I wouldn't.

So a new thread[5] started in the Orbited list.

This lead me to re-read the STOMP Protocol spec[6] and judjing from the 
different clients code I've looked at it looks like everyone else's 
understanding of this paragraph:

&quot;The SUBSCRIBE command is used to register to listen to a given destination. 
Like the SEND command, the SUBSCRIBE command requires a destination header 
indicating which destination to subscribe to. Any messages received on the 
subscription will henceforth be delivered as MESSAGE frames from the server to 
the client.&quot;

... is that if a client has subscribed to a destination, then it should 
receive every message that is sent to that destination - what you call 
&quot;broadcast&quot; behaviour in your docs.


So now I'm writing here because it seems to me rather odd that every STOMP 
client code should be modified to be able to send extra-headers to RabbitMQ  
when they seem to be correctly implementing their STOMP Clients according to 
the spec.
Although I must agree that the spec text is rather ambiguous on this matter, I 
believe that interoperability with existing clients is important here and it 
looks to me like non-STOMP extra-headers should not be required from the 
client in order to achieve what seems to be a rather common use case of a 
producer broadcasting to every subscribed consumer and not just to any of them 
(round-robinish behaviour).


I've been reading a lot these days and chose RabbitMQ over the other 
alternatives because it looks like the best alternative in terms of 
performance, reliability, and scallability but I'm not all too sure that 
&quot;fixing&quot; the client libraries myself is the way to go, considering that the 
stomp-adapter is still experimental code.


An Orbited user (who has come across the same issue) has offered to work on 
the erlang stomp-adapter code if needed.


I look forward to reading from you.

If I happen to sound rude or unpolite, please pardon my english... it's not my 
mother tongue.


Cheers,

NicoEch&#225;niz

[1] <A HREF="http://groups.google.com/group/orbited-">http://groups.google.com/group/orbited-</A>
users/browse_thread/thread/e6a2a4d1bf13eda1
[2] <A HREF="http://www.orbited.org">http://www.orbited.org</A>
[3] <A HREF="http://dev.rabbitmq.com/wiki/StompGateway">http://dev.rabbitmq.com/wiki/StompGateway</A>
[4] <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-</A>
September/001784.html 

[5] <A HREF="http://groups.google.com/group/orbited-">http://groups.google.com/group/orbited-</A>
users/browse_thread/thread/896d37d61dceb073

[6] <A HREF="http://stomp.codehaus.org/Protocol">http://stomp.codehaus.org/Protocol</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003732.html">[rabbitmq-discuss] Workaround for basic reject...
</A></li>
	<LI>Next message: <A HREF="003734.html">[rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3733">[ date ]</a>
              <a href="thread.html#3733">[ thread ]</a>
              <a href="subject.html#3733">[ subject ]</a>
              <a href="author.html#3733">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
