<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20stomp-adapter%20behaviour&In-Reply-To=af1bce590906090806v417c5d6ftca82b722658cba4b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003774.html">
   <LINK REL="Next"  HREF="003799.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ stomp-adapter behaviour</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20stomp-adapter%20behaviour&In-Reply-To=af1bce590906090806v417c5d6ftca82b722658cba4b%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ stomp-adapter behaviour">matthias at lshift.net
       </A><BR>
    <I>Wed Jun 10 17:35:29 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003774.html">[rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
</A></li>
        <LI>Next message: <A HREF="003799.html">[rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3795">[ date ]</a>
              <a href="thread.html#3795">[ thread ]</a>
              <a href="subject.html#3795">[ subject ]</a>
              <a href="author.html#3795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gavin,

Gavin M. Roy wrote:
&gt;<i> I change this auto-delete = false in the code before compilation to
</I>&gt;<i> mirror ActiveMQ behavior.
</I>&gt;<i> [...]
</I>&gt;<i> the biggest issue I had to overcome was the concept that one has to
</I>&gt;<i> subscribe to a queue in order to set the default behavior for it.
</I>
&gt;<i>From your and other peoples' comments I gather that with the default
</I>behaviour it should be possible to SEND messages to a destination even
when there are no (and never have been any) subscribers for that
destination. The messages should be queued and delivered to future
clients when they subsequently SUBSCRIBE to that destination.

Correct?

If so then the challenge we face in implementing that behaviour on top
of AMQP is that the only place messages get stored in AMQP is in queues,
and that these queues need to be created explicitly and, with the
exception of exclusive and auto-delete queues, destroyed explicitly.

Currently the STOMP adapter only declares queues on SUBSCRIBE. We could
change it so it also declares them on SEND. AMQP's queue.declare is
idempotent, so this should work fine but there is a performance penalty.

With that change in place messages will get queued w/o the need to have
a subscription first.

Now, declaring queues implicitly on SEND and SUBSCRIBE is all very well,
but how &amp; when do we get rid of them? Setting &quot;auto-delete = false&quot; has
the unfortunate side effect of the queues sticking around forever, even
when they have no messages or subscribers. That does not matter much if
there are a finite and small(ish) number of possible destinations. But
when there are many destinations, only some of which are in use at any
given time, then server resources can be exhausted.

I can think of various approaches to address this problem, but none are
very pleasant.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003774.html">[rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
</A></li>
	<LI>Next message: <A HREF="003799.html">[rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3795">[ date ]</a>
              <a href="thread.html#3795">[ thread ]</a>
              <a href="subject.html#3795">[ subject ]</a>
              <a href="author.html#3795">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
