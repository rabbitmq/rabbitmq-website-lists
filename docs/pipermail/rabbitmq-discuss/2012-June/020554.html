<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq_jsonrpc_channel reconnect ability?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq_jsonrpc_channel%20reconnect%20ability%3F&In-Reply-To=%3CCAM8fPiQKQ204H%2BA3AnknGy2QBJXZ1oJaAyg5ZpUDCc63bwb3wA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020574.html">
   <LINK REL="Next"  HREF="020519.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq_jsonrpc_channel reconnect ability?</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq_jsonrpc_channel%20reconnect%20ability%3F&In-Reply-To=%3CCAM8fPiQKQ204H%2BA3AnknGy2QBJXZ1oJaAyg5ZpUDCc63bwb3wA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq_jsonrpc_channel reconnect ability?">tonygarnockjones+rabbitmq at gmail.com
       </A><BR>
    <I>Mon Jun 11 15:46:26 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020574.html">[rabbitmq-discuss] rabbitmq_jsonrpc_channel reconnect ability?
</A></li>
        <LI>Next message: <A HREF="020519.html">[rabbitmq-discuss] Clustering question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20554">[ date ]</a>
              <a href="thread.html#20554">[ thread ]</a>
              <a href="subject.html#20554">[ subject ]</a>
              <a href="author.html#20554">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11 June 2012 09:55, Marek Majkowski &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">majek04 at gmail.com</A>&gt; wrote:

&gt;<i> I'm afraid there is no &quot;proper&quot; way. When it works - great. But on
</I>&gt;<i> network errors, I'd assume the state of the channel is undefined.
</I>&gt;<i> I would be surprised if there is a sane way to recover. Best solution
</I>&gt;<i> IMO is to kill the channel and establish a new one.
</I>&gt;<i>
</I>
I don't think it's actually so bad in principle, though the implementation
isn't there yet.

The channel object on the server side has a timeout - if there's a waiting
longpoll, the timer isn't counting down, but during periods when the object
is untouched the timer is ticking. The timer is reset to its starting value
whenever the object receives a method call. Eventually, if left alone, the
channel's timer expires and the channel is closed.

So, if you can arrange for the JS to just attempt reconnection over and
over up to the point where the timer must have expired, you can rejoin your
channel state. (It works this way because of the spotty nature of XHR
&quot;connections&quot; in the best case.) You can control the expiry timer length on
the channel object - pass the channelTimeout option (in *seconds*) to the
RabbitMQ.Channel constructor from rabbitmq.js.

If the channel timer has expired, and you try to touch the old channel
object, you'll get an error from the server (because the server doesn't
know what object you mean anymore). In that case, yes, all the channel
state is gone and you need to take extra steps like creating a fresh
channel to work with.

I'm not certain, but it might be the case that a few small (but
carefully-thought-out) changes to rabbitmq.js could make it sanely and
transparently attempt reconnection.

Tony
-- 
Tony Garnock-Jones
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonygarnockjones at gmail.com</A>
<A HREF="http://homepages.kcbbs.gen.nz/tonyg/">http://homepages.kcbbs.gen.nz/tonyg/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120611/24a026f9/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120611/24a026f9/attachment.htm</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020574.html">[rabbitmq-discuss] rabbitmq_jsonrpc_channel reconnect ability?
</A></li>
	<LI>Next message: <A HREF="020519.html">[rabbitmq-discuss] Clustering question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20554">[ date ]</a>
              <a href="thread.html#20554">[ thread ]</a>
              <a href="subject.html#20554">[ subject ]</a>
              <a href="author.html#20554">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
