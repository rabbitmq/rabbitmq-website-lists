<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Using Disruptor in web app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20Disruptor%20in%20web%20app&In-Reply-To=%3C4FD5C4B4.1020607%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020536.html">
   <LINK REL="Next"  HREF="020540.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Using Disruptor in web app</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20Disruptor%20in%20web%20app&In-Reply-To=%3C4FD5C4B4.1020607%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Using Disruptor in web app">simon at rabbitmq.com
       </A><BR>
    <I>Mon Jun 11 11:13:08 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020536.html">[rabbitmq-discuss] Using Disruptor in web app
</A></li>
        <LI>Next message: <A HREF="020540.html">[rabbitmq-discuss] stomp+ssl message send works,	receive hangs after around 200-300 messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20539">[ date ]</a>
              <a href="thread.html#20539">[ thread ]</a>
              <a href="subject.html#20539">[ subject ]</a>
              <a href="author.html#20539">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This doesn't appear to be a very RabbitMQ-related question. Did you want 
to ask here instead? <A HREF="http://groups.google.com/group/lmax-disruptor">http://groups.google.com/group/lmax-disruptor</A>

Cheers, Simon

On 10/06/12 22:57, oscar wrote:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> Firstly this is awesome stuff and I want to use it in my next project,
</I>&gt;<i> which we be run in a web server.  I'm a little worried about trying to
</I>&gt;<i> architect my project for performance based around using the disruptor
</I>&gt;<i> and getting worse performance than normal due to not understanding it
</I>&gt;<i> well enough.  I would really appreciate some input.
</I>&gt;<i>
</I>&gt;<i> The project will be hosted so I won't be able to simplify by having
</I>&gt;<i> all data in memory (I think).  It will be a fairy traditional (boring)
</I>&gt;<i> project, order entry processing (and other stuff).  So some screens to
</I>&gt;<i> view orders, products query for them edit/maintain CRUD type stuff.
</I>&gt;<i> So latency isn't important in itself but only as a means to support
</I>&gt;<i> the maximum number of users for a smallish server with between 1.7 -17
</I>&gt;<i> Gb of memory.
</I>&gt;<i>
</I>&gt;<i> 1) Is the disruptor for me?  (I hope yes)
</I>&gt;<i> 2) When designing the ringbuffer events, how concerned should I be
</I>&gt;<i> that they don't change in terms of memory location as they are
</I>&gt;<i> mutated.  For instance if I use strings in the event than these will
</I>&gt;<i> be re-allocated on each mutation.  Should I use say StringBuilders or
</I>&gt;<i> even something like protobuf messages and have the event type as a
</I>&gt;<i> byte array and marshall each event into that byte array  (handling for
</I>&gt;<i> overflow) I see this as trading memory striding against cpu overhead
</I>&gt;<i> and short lived object creation (new strings etc) in the marshalling/
</I>&gt;<i> demarshalling process?
</I>&gt;<i> 3) Since each event will be marshalled from an http request I'm not
</I>&gt;<i> sure how large to make the event.  Should it be large so that the ring
</I>&gt;<i> buffer has fewer slots but the chance of an oversize object (won't fit
</I>&gt;<i> in preallocated event slot) is very small?
</I>&gt;<i> 4) Should I have just one input ringbuffer with an event definition
</I>&gt;<i> that can handle any event (http request) or multiple input ring
</I>&gt;<i> buffers?  I think that LMAX had just one.
</I>&gt;<i> 5) What should the overall process flow be?  an http request will come
</I>&gt;<i> in and my web container thread will quickly marshall it into an event
</I>&gt;<i> and put in on the ring buffer.  Consumers will read it it and say
</I>&gt;<i> fetch a customer from the DB and update the event.  Finally my
</I>&gt;<i> business processor (final single threaded beast of a consumer) will
</I>&gt;<i> produce an http response.  What's the best/standard way of
</I>&gt;<i> communicating that back the original thread that orginated the
</I>&gt;<i> request?  via a Latch that's put onto the event?
</I>&gt;<i>
</I>&gt;<i> 6) Lastly is there a standard pattern / best practice architecture to
</I>&gt;<i> be adopted for a CRUD like web app running in a webserver using the
</I>&gt;<i> Disruptor.  I feel like what I'm doing is so standard that the ought
</I>&gt;<i> to be a right way to do it.  I'm thinking right now that I would only
</I>&gt;<i> need one RingBuffer being fed by the webserver request threads and
</I>&gt;<i> then various consumers decorating that,  or do I need another one on
</I>&gt;<i> the output side that the business processor is the producer to?
</I>&gt;<i>
</I>&gt;<i> Hope I'm not being dense, really appreciate any advice you can give on
</I>&gt;<i> any of the points I've raised.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020536.html">[rabbitmq-discuss] Using Disruptor in web app
</A></li>
	<LI>Next message: <A HREF="020540.html">[rabbitmq-discuss] stomp+ssl message send works,	receive hangs after around 200-300 messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20539">[ date ]</a>
              <a href="thread.html#20539">[ thread ]</a>
              <a href="subject.html#20539">[ subject ]</a>
              <a href="author.html#20539">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
