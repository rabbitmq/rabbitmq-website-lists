<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Incorrect display of mirrored queues as unsynchronised after database failover
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Incorrect%20display%20of%20mirrored%20queues%20as%0A%20unsynchronised%20after%20database%20failover&In-Reply-To=%3CCACLE7iw%2BR11gM_pyapzKdbJSErUGCM8NhTScSJ_tSqgr_v26GQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020775.html">
   <LINK REL="Next"  HREF="020867.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Incorrect display of mirrored queues as unsynchronised after database failover</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Incorrect%20display%20of%20mirrored%20queues%20as%0A%20unsynchronised%20after%20database%20failover&In-Reply-To=%3CCACLE7iw%2BR11gM_pyapzKdbJSErUGCM8NhTScSJ_tSqgr_v26GQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Incorrect display of mirrored queues as unsynchronised after database failover">mpietrek at skytap.com
       </A><BR>
    <I>Fri Jun 22 18:44:09 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020775.html">[rabbitmq-discuss] Incorrect display of mirrored queues as	unsynchronised after database failover
</A></li>
        <LI>Next message: <A HREF="020867.html">[rabbitmq-discuss] Incorrect display of mirrored queues as unsynchronised after database failover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20805">[ date ]</a>
              <a href="thread.html#20805">[ thread ]</a>
              <a href="subject.html#20805">[ subject ]</a>
              <a href="author.html#20805">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Simon.

I realized just now that I was less than precise in my prior summary of the
state.

It does appear that that rabbitmqctl and the management API are in sync on
what they report. What's &quot;interesting&quot; is that after the broker rejoins the
cluster, it's not always a slave for the queues it was previously a master
or slave for.

If you'll recall from my original message, we normally have 3 brokers.
During the rolling upgrade we take one down and then rejoin it to the
cluster. What we're seeing is that after the broker rejoins, some of the
queues have the expected two slaves ('+2' in the UI). However, other queues
(seemingly at random) have only one slave ('+1').

The management UI and rabbitmqctl agree on what we're seeing. And prior to
the operation, all the queues had two slaves.


On Fri, Jun 22, 2012 at 4:45 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 20/06/12 22:31, Matt Pietrek wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Back before 2.8.0 was announced, I reported an issue with Mirrored
</I>&gt;&gt;<i> queues reporting some nodes as unsynchronized.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hmm. Well, there was a real issue there. That one was where the management
</I>&gt;<i> plugin was getting desynchronised from what was really going on. So if you
</I>&gt;<i> are still seeing something similar in 2.8.2, does management agree with
</I>&gt;<i> rabbitmqctl?
</I>&gt;<i>
</I>&gt;<i> (In general rabbitmqctl goes and calls into processes whenever it needs to
</I>&gt;<i> know something, while management listens to events that are broadcast and
</I>&gt;<i> maintains its own view of the world.)
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120622/ef94a6a6/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120622/ef94a6a6/attachment.htm</A>&gt;
</PRE>

















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020775.html">[rabbitmq-discuss] Incorrect display of mirrored queues as	unsynchronised after database failover
</A></li>
	<LI>Next message: <A HREF="020867.html">[rabbitmq-discuss] Incorrect display of mirrored queues as unsynchronised after database failover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20805">[ date ]</a>
              <a href="thread.html#20805">[ thread ]</a>
              <a href="subject.html#20805">[ subject ]</a>
              <a href="author.html#20805">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
