<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ + PHP and RPC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20%2B%20PHP%20and%20RPC&In-Reply-To=%3C4FE2F301.5030304%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020737.html">
   <LINK REL="Next"  HREF="020739.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ + PHP and RPC</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20%2B%20PHP%20and%20RPC&In-Reply-To=%3C4FE2F301.5030304%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ + PHP and RPC">simon at rabbitmq.com
       </A><BR>
    <I>Thu Jun 21 11:10:09 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020737.html">[rabbitmq-discuss] RabbitMQ + PHP and RPC
</A></li>
        <LI>Next message: <A HREF="020739.html">[rabbitmq-discuss] RabbitMQ + PHP and RPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20738">[ date ]</a>
              <a href="thread.html#20738">[ thread ]</a>
              <a href="subject.html#20738">[ subject ]</a>
              <a href="author.html#20738">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Dennis.

The whole point of an exclusive queue is that it is accessible solely by 
the connection that declares it. You don't want to declare a queue as 
exclusive if it is going to be used by more than one connection.

So I'm not sure why you are declaring it exclusive? If you are trying to 
make sure that it goes away when the client connection does, you 
probably want to make it autodelete - then it will be deleted when the 
client connection stops consuming from it.

Cheers, Simon

On 21/06/12 10:48, Denis wrote:
&gt;<i> Sorry for me writing here: I can't figure out how to use mailing list
</I>&gt;<i> for replies =/
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My Client.php declares callback queue php-object as following:
</I>&gt;<i>
</I>&gt;<i> |$callbackQueue=  new  \AMQPQueue($channel);
</I>&gt;<i> $callbackQueue-&gt;setFlags(AMQP_EXCLUSIVE);  // set EXCLUSIVE flag
</I>&gt;<i> $callbackQueue-&gt;declare();|
</I>&gt;<i>
</I>&gt;<i> After that I pass it's name at an envelope to server like this
</I>&gt;<i> ($callbackQueue-&gt;getName at 'reply_to')
</I>&gt;<i>
</I>&gt;<i> |$exchange-&gt;publish(
</I>&gt;<i>         json_encode(array('process me!')),
</I>&gt;<i>         'temp_action',
</I>&gt;<i>         AMQP_MANDATORY,
</I>&gt;<i>         array(
</I>&gt;<i>                 'reply_to'  =&gt;  $callbackQueue-&gt;getName(),  // pass callback queue name
</I>&gt;<i>                 'correlation_id'  =&gt;  $correlationId
</I>&gt;<i>         )
</I>&gt;<i> );|
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> And my Server.php creates a new Queue php-object (in an anonymous
</I>&gt;<i> function that handles consuming) as following:
</I>&gt;<i>
</I>&gt;<i> |        $callbackQueue=  new  \AMQPQueue($channel);
</I>&gt;<i>         $callbackQueue-&gt;setName($envelope-&gt;getReplyTo());
</I>&gt;<i>         $callbackQueue-&gt;setFlags(AMQP_EXCLUSIVE);  // set EXCLUSIVE flag|
</I>&gt;<i>
</I>&gt;<i> Right after that moment I'm trying to bind newly created $callbackQueue
</I>&gt;<i> object to an exchange - and this causes blocking issue.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm not sure which exact options are different (exclusive looks for me
</I>&gt;<i> to be the only flag I set in both cases).
</I>&gt;<i> Setting name in Server.php is necessary and name is taken from
</I>&gt;<i> envelope's 'reply_to' setting.
</I>&gt;<i>
</I>&gt;<i> As far as I can see no extra declaration of callback queue is happening
</I>&gt;<i> on a Server.php side. (Although tempQueue Server consumes messages from
</I>&gt;<i> is extra declared, but this is made for server to be able to listen that
</I>&gt;<i> queue even when before any client exists)
</I>&gt;<i>
</I>&gt;<i> On Thursday, June 21, 2012 12:33:42 PM UTC+4, Alvaro Videla wrote:
</I>&gt;<i>
</I>&gt;<i>     While not using the same library here you have the official
</I>&gt;<i>     tutorials ported to PHP
</I>&gt;<i>
</I>&gt;<i>     <A HREF="https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php">https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php</A>
</I>&gt;<i>     &lt;<A HREF="https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php">https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php</A>&gt;
</I>&gt;<i>
</I>&gt;<i>     The problem in your code is that you declare queues with different
</I>&gt;<i>     options.
</I>&gt;<i>
</I>&gt;<i>     So as one reply say, if you declare queue A as durable, then every
</I>&gt;<i>     other declaration of that queue must be durable. The same for the
</I>&gt;<i>     exclusive flag.
</I>&gt;<i>
</I>&gt;<i>     Also you don't need to redeclare a queue to publish messages to it.
</I>&gt;<i>     As an RPC server you assume that the address sent in the 'reply_to'
</I>&gt;<i>     property is already present. I think is the responsibility of the
</I>&gt;<i>     RpcClient to make sure the queue where it is waiting for replies
</I>&gt;<i>     exists already.
</I>&gt;<i>
</I>&gt;<i>     Regards,
</I>&gt;<i>
</I>&gt;<i>     Alvaro
</I>&gt;<i>
</I>&gt;<i>     And you can indeed do RPC over RabbitMQ by using different connections.
</I>&gt;<i>
</I>&gt;<i>     On Wed, Jun 20, 2012 at 8:03 PM, Denis wrote:
</I>&gt;<i>
</I>&gt;<i>         Hello guys.
</I>&gt;<i>
</I>&gt;<i>         I'm trying to build RPC using PHP, here is my description of
</I>&gt;<i>         problem:
</I>&gt;<i>         <A HREF="http://stackoverflow.com/__questions/11104004/rabbitmq-__rpc-exclusive-queues-locking-__php">http://stackoverflow.com/__questions/11104004/rabbitmq-__rpc-exclusive-queues-locking-__php</A>
</I>&gt;<i>         &lt;<A HREF="http://stackoverflow.com/questions/11104004/rabbitmq-rpc-exclusive-queues-locking-php">http://stackoverflow.com/questions/11104004/rabbitmq-rpc-exclusive-queues-locking-php</A>&gt;
</I>&gt;<i>
</I>&gt;<i>         The main issue I suspect is that Client.php and Server.php try
</I>&gt;<i>         to connect to RabbitMQ server using different connections, which
</I>&gt;<i>         leads to inability of using EXCLUSIVE queue (that is declared in
</I>&gt;<i>         CLient.php) from Server.php
</I>&gt;<i>
</I>&gt;<i>         Can u give me a way I can dig to? I'm out of ideas ...
</I>&gt;<i>
</I>&gt;<i>         _______________________________________________
</I>&gt;<i>         rabbitmq-discuss mailing list
</I>&gt;<i>         <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i>         <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>         &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>










































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020737.html">[rabbitmq-discuss] RabbitMQ + PHP and RPC
</A></li>
	<LI>Next message: <A HREF="020739.html">[rabbitmq-discuss] RabbitMQ + PHP and RPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20738">[ date ]</a>
              <a href="thread.html#20738">[ thread ]</a>
              <a href="subject.html#20738">[ subject ]</a>
              <a href="author.html#20738">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
