<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustered startup with multiple queues and	multiple masters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustered%20startup%20with%20multiple%20queues%20and%0A%09multiple%20masters&In-Reply-To=%3C87pq8vsn35.wl%25francesco%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020675.html">
   <LINK REL="Next"  HREF="020715.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustered startup with multiple queues and	multiple masters</H1>
    <B>Francesco Mazzoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustered%20startup%20with%20multiple%20queues%20and%0A%09multiple%20masters&In-Reply-To=%3C87pq8vsn35.wl%25francesco%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Clustered startup with multiple queues and	multiple masters">francesco at rabbitmq.com
       </A><BR>
    <I>Tue Jun 19 09:49:34 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020675.html">[rabbitmq-discuss] Clustered startup with multiple queues and multiple masters
</A></li>
        <LI>Next message: <A HREF="020715.html">[rabbitmq-discuss] Clustered startup with multiple queues and multiple masters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20689">[ date ]</a>
              <a href="thread.html#20689">[ thread ]</a>
              <a href="subject.html#20689">[ subject ]</a>
              <a href="author.html#20689">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matt,

At Mon, 18 Jun 2012 11:16:40 -0700,
Matt Pietrek wrote:
&gt;<i> 
</I>&gt;<i> Francesco,
</I>&gt;<i> 
</I>&gt;<i> Thanks very much for the detailed reply. It was extremely helpful.
</I>
Glad I could help.

&gt;<i> Question 1
</I>&gt;<i> ----------------
</I>&gt;<i> I stumbled across this in my own previous experimentation. The
</I>&gt;<i> question is, do I risk message loss by first starting a node that
</I>&gt;<i> joined the cluster late, thus not having the full set of messages that
</I>&gt;<i> other nodes have?
</I>
No.

&gt;<i> Question 2
</I>&gt;<i> ---------------
</I>&gt;<i> Related to the above scenario, is there any danger (after an unplanned
</I>&gt;<i> shutdown), in simply letting all the nodes start in parallel and
</I>&gt;<i> letting Mnesia's waiting sort out the order? It seems to work OK in my
</I>&gt;<i> limited testing so far, but I don't know if we're risking data loss.
</I>
It should be fine, but in general it's better to do cluster operations
sequentially and at one site. In this specific case it should be OK.

&gt;<i> Question 3
</I>&gt;<i> ---------------
</I>&gt;<i> You said:
</I>&gt;<i> 
</I>&gt;<i> &gt; In other words, it's up to you to restart them so that the node with the most up-to-date mnesia is started first
</I>&gt;<i> 
</I>&gt;<i> Is there any information recorded somewhere (e.g. the logs), which
</I>&gt;<i> would indicate which node has the &quot;most up to date&quot; Mnesia database? I
</I>&gt;<i> see messages like:
</I>&gt;<i> 
</I>&gt;<i>  &gt; Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2.1.273.0</A>&gt; to master
</I>&gt;<i> 
</I>&gt;<i> But don't know if they're necessarily correlated to who the most
</I>&gt;<i> up-to-date Mnesia is.
</I>
Well, the fact that something got promoted to master tells you that
the previous master definitely went down before the promoted node.

There won't be precise information if you stop the nodes abruptly, but
you can look at &quot;rabbit on node &lt;node&gt; down&quot; messages in the logs -
the node in the clusters are linked in distributed Erlang and these
messages are generated when a node receives a 'DOWN' message from
another node. Since they are &quot;info&quot; messages, you need to make sure to
have those enabled - they are enabled by default but a lot of people
don't like them.


Francesco.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020675.html">[rabbitmq-discuss] Clustered startup with multiple queues and multiple masters
</A></li>
	<LI>Next message: <A HREF="020715.html">[rabbitmq-discuss] Clustered startup with multiple queues and multiple masters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20689">[ date ]</a>
              <a href="thread.html#20689">[ thread ]</a>
              <a href="subject.html#20689">[ subject ]</a>
              <a href="author.html#20689">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
