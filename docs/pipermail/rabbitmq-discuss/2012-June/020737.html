<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ + PHP and RPC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20%2B%20PHP%20and%20RPC&In-Reply-To=%3C4d6237b0-cf35-4d5a-ad98-97095c8171ab%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020824.html">
   <LINK REL="Next"  HREF="020738.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ + PHP and RPC</H1>
    <B>Denis</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20%2B%20PHP%20and%20RPC&In-Reply-To=%3C4d6237b0-cf35-4d5a-ad98-97095c8171ab%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ + PHP and RPC">box4dennis at gmail.com
       </A><BR>
    <I>Thu Jun 21 10:48:19 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020824.html">[rabbitmq-discuss] Crash with RabbitMQ-Web-Stomp plugin on	Debian
</A></li>
        <LI>Next message: <A HREF="020738.html">[rabbitmq-discuss] RabbitMQ + PHP and RPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20737">[ date ]</a>
              <a href="thread.html#20737">[ thread ]</a>
              <a href="subject.html#20737">[ subject ]</a>
              <a href="author.html#20737">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry for me writing here: I can't figure out how to use mailing list for 
replies =/


My Client.php declares callback queue php-object as following:

$callbackQueue = new \AMQPQueue($channel);
$callbackQueue-&gt;setFlags(AMQP_EXCLUSIVE); // set EXCLUSIVE flag
$callbackQueue-&gt;declare();

After that I pass it's name at an envelope to server like this 
($callbackQueue-&gt;getName at 'reply_to')

$exchange-&gt;publish(
    json_encode(array('process me!')),
    'temp_action',
    AMQP_MANDATORY,
    array(
        'reply_to' =&gt; $callbackQueue-&gt;getName(), // pass callback queue name
        'correlation_id' =&gt; $correlationId
    )
);


And my Server.php creates a new Queue php-object (in an anonymous function 
that handles consuming) as following:

    $callbackQueue = new \AMQPQueue($channel);
    $callbackQueue-&gt;setName($envelope-&gt;getReplyTo());
    $callbackQueue-&gt;setFlags(AMQP_EXCLUSIVE); // set EXCLUSIVE flag

Right after that moment I'm trying to bind newly created $callbackQueue 
object to an exchange - and this causes blocking issue.


I'm not sure which exact options are different (exclusive looks for me to 
be the only flag I set in both cases). 
Setting name in Server.php is necessary and name is taken from envelope's 
'reply_to' setting. 

As far as I can see no extra declaration of callback queue is happening on 
a Server.php side. (Although tempQueue Server consumes messages from is 
extra declared, but this is made for server to be able to listen that queue 
even when before any client exists)

On Thursday, June 21, 2012 12:33:42 PM UTC+4, Alvaro Videla wrote:
&gt;<i>
</I>&gt;<i> While not using the same library here you have the official tutorials 
</I>&gt;<i> ported to PHP
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php">https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php</A>
</I>&gt;<i>
</I>&gt;<i> The problem in your code is that you declare queues with different 
</I>&gt;<i> options. 
</I>&gt;<i>
</I>&gt;<i> So as one reply say, if you declare queue A as durable, then every other 
</I>&gt;<i> declaration of that queue must be durable. The same for the exclusive flag.
</I>&gt;<i>
</I>&gt;<i> Also you don't need to redeclare a queue to publish messages to it. As an 
</I>&gt;<i> RPC server you assume that the address sent in the 'reply_to' property is 
</I>&gt;<i> already present. I think is the responsibility of the RpcClient to make 
</I>&gt;<i> sure the queue where it is waiting for replies exists already.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Alvaro
</I>&gt;<i>
</I>&gt;<i> And you can indeed do RPC over RabbitMQ by using different connections.
</I>&gt;<i>
</I>&gt;<i> On Wed, Jun 20, 2012 at 8:03 PM, Denis wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hello guys.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm trying to build RPC using PHP, here is my description of problem:
</I>&gt;&gt;<i> <A HREF="http://stackoverflow.com/**questions/11104004/rabbitmq-**">http://stackoverflow.com/**questions/11104004/rabbitmq-**</A>
</I>&gt;&gt;<i> rpc-exclusive-queues-locking-**php&lt;<A HREF="http://stackoverflow.com/questions/11104004/rabbitmq-rpc-exclusive-queues-locking-php">http://stackoverflow.com/questions/11104004/rabbitmq-rpc-exclusive-queues-locking-php</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The main issue I suspect is that Client.php and Server.php try to connect 
</I>&gt;&gt;<i> to RabbitMQ server using different connections, which leads to inability of 
</I>&gt;&gt;<i> using EXCLUSIVE queue (that is declared in CLient.php) from Server.php
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can u give me a way I can dig to? I'm out of ideas ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120621/0937d3fb/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120621/0937d3fb/attachment.htm</A>&gt;
</PRE>










































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020824.html">[rabbitmq-discuss] Crash with RabbitMQ-Web-Stomp plugin on	Debian
</A></li>
	<LI>Next message: <A HREF="020738.html">[rabbitmq-discuss] RabbitMQ + PHP and RPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20737">[ date ]</a>
              <a href="thread.html#20737">[ thread ]</a>
              <a href="subject.html#20737">[ subject ]</a>
              <a href="author.html#20737">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
