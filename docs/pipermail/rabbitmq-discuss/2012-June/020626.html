<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem in high availability setup together with corosync
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20in%20high%20availability%20setup%20together%0A%20with%20corosync&In-Reply-To=%3C39d9d569-7d4f-413f-8a31-bb9875a063b7%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020628.html">
   <LINK REL="Next"  HREF="020784.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem in high availability setup together with corosync</H1>
    <B>sateesh Bodla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20in%20high%20availability%20setup%20together%0A%20with%20corosync&In-Reply-To=%3C39d9d569-7d4f-413f-8a31-bb9875a063b7%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Problem in high availability setup together with corosync">bbalasateesh at gmail.com
       </A><BR>
    <I>Fri Jun 15 07:42:05 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020628.html">[rabbitmq-discuss] Shovel problem by failed DNS request
</A></li>
        <LI>Next message: <A HREF="020784.html">[rabbitmq-discuss] Problem in high availability setup together with corosync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20626">[ date ]</a>
              <a href="thread.html#20626">[ thread ]</a>
              <a href="subject.html#20626">[ subject ]</a>
              <a href="author.html#20626">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Christopher,

We are trying to setup the HA for RabbitMQ with Corosync. We are able to 
install the corosync but not able to configure with RabbitMQ. We have tried 
to locate but not able to find where to configure. Please can you provide 
some pointers of steps to configure the RabbitMQ configuration files with 
Corosync.

Thanks in advance,
Sateesh B.

On Friday, January 27, 2012 11:19:05 PM UTC+5:30, Christopher Grebs wrote:
&gt;<i>
</I>&gt;<i> Hey there,
</I>&gt;<i>
</I>&gt;<i> today we experimented with some high availability setup featuring 
</I>&gt;<i> RabbitMQ + HA-Queues and Corosync.  Currently we have this setup:
</I>&gt;<i>
</I>&gt;<i>   * 2 nodes named mq01ha and mq02ha
</I>&gt;<i>
</I>&gt;<i> Both nodes have ha-ip addresses that move to the other node that is not 
</I>&gt;<i> down so that all services can proceed, no matter to what node they are 
</I>&gt;<i> connected.
</I>&gt;<i>
</I>&gt;<i> Our test scenario:
</I>&gt;<i>
</I>&gt;<i> One producer is pushing to mq01ha and one consumer is consuming from 
</I>&gt;<i> mq01ha, the consumer is a bit slower so that messages pile up unacked.
</I>&gt;<i>
</I>&gt;<i> Now we kill mq01ha by pusing the virtual power button (virtual maschines 
</I>&gt;<i> are great!), corosync moves the ip from mq01ha to mq02ha and the 
</I>&gt;<i> consumers and producers proceed with their work.  This works great and 
</I>&gt;<i> everything is fine again.
</I>&gt;<i>
</I>&gt;<i> Now (and this is the part where I need your knowledge) we currently have 
</I>&gt;<i> the setup that if mq01 starts up again the ip address moves back to mq01.
</I>&gt;<i>
</I>&gt;<i> Now mq01 is back up, all consumers and producers are proceeding with 
</I>&gt;<i> their work.  But unfortunately in mq01 and mq02 all messages that were 
</I>&gt;<i> unacked while mq01 gone down are still unacked and there is some not 
</I>&gt;<i> existing connection open in the connections view on rabbitmq. This is 
</I>&gt;<i> true for both, the web interface and for rabbitmqctl. Even if I shutdown 
</I>&gt;<i> all consumers and producers this connection exists, so it's not related 
</I>&gt;<i> to any real TCP connection.
</I>&gt;<i>
</I>&gt;<i> I think that rabbitmq is not designed for this kind of scenario, but 
</I>&gt;<i> maybe you can tell me more about what rabbitmq does.  Maybe we found 
</I>&gt;<i> some bug, I don't know.
</I>&gt;<i>
</I>&gt;<i> What we are now planning is a simple setup with only one ha-ip that 
</I>&gt;<i> moves from host to host only in failover so that - in theory - 
</I>&gt;<i> everything should work properly again.  But we have to check if then 
</I>&gt;<i> again we have the problem that unacked messages stay unacked.
</I>&gt;<i>
</I>&gt;<i> Hopefully I described this stuff clear enough :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Christopher.
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> Christopher Grebs
</I>&gt;<i> Data Processing Developer
</I>&gt;<i>
</I>&gt;<i> Tel +49-30-611035-1664
</I>&gt;<i> Fax -49-30-611035-2652
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">christopher.grebs at native-instruments.de</A>
</I>&gt;<i>
</I>&gt;<i> NATIVE INSTRUMENTS GmbH
</I>&gt;<i> Schlesische Strasse 29-30
</I>&gt;<i> 10997 Berlin, Germany
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.native-instruments.com">http://www.native-instruments.com</A>
</I>&gt;<i>
</I>&gt;<i> ***
</I>&gt;<i>
</I>&gt;<i> KOMPLETE 8 ULTIMATE - the premium NI producer collection
</I>&gt;<i> =&gt;   <A HREF="http://www.native-instruments.com/komplete8">http://www.native-instruments.com/komplete8</A>
</I>&gt;<i>
</I>&gt;<i> TRAKTOR KONTROL S2 - the professional 2.1 DJ system
</I>&gt;<i> =&gt;   <A HREF="http://www.native-instruments.com/s2">http://www.native-instruments.com/s2</A>
</I>&gt;<i>
</I>&gt;<i> -&gt;&gt;&gt;&gt;&gt;&gt;  NATIVE INSTRUMENTS - The Future of Sound&lt;&lt;&lt;&lt;&lt;&lt;-
</I>&gt;<i>
</I>&gt;<i> Registergericht: Amtsgericht Charlottenburg
</I>&gt;<i> Registernummer: HRB 72458
</I>&gt;<i> UST.-ID.-Nr. DE 20 374 7747
</I>&gt;<i>
</I>&gt;<i> Gesch&#228;ftsf&#252;hrung: Daniel Haver (CEO), Mate Galic
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120614/5a0b0ffe/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120614/5a0b0ffe/attachment.html</A>&gt;
</PRE>








































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020628.html">[rabbitmq-discuss] Shovel problem by failed DNS request
</A></li>
	<LI>Next message: <A HREF="020784.html">[rabbitmq-discuss] Problem in high availability setup together with corosync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20626">[ date ]</a>
              <a href="thread.html#20626">[ thread ]</a>
              <a href="subject.html#20626">[ subject ]</a>
              <a href="author.html#20626">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
