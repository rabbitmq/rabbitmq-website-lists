<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ + PHP and RPC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20%2B%20PHP%20and%20RPC&In-Reply-To=%3C4FE2F777.4080802%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020739.html">
   <LINK REL="Next"  HREF="020744.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ + PHP and RPC</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20%2B%20PHP%20and%20RPC&In-Reply-To=%3C4FE2F777.4080802%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ + PHP and RPC">simon at rabbitmq.com
       </A><BR>
    <I>Thu Jun 21 11:29:11 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020739.html">[rabbitmq-discuss] RabbitMQ + PHP and RPC
</A></li>
        <LI>Next message: <A HREF="020744.html">[rabbitmq-discuss] RabbitMQ 2.8.3 released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20741">[ date ]</a>
              <a href="thread.html#20741">[ thread ]</a>
              <a href="subject.html#20741">[ subject ]</a>
              <a href="author.html#20741">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Oh, of course. I'm being slow today.

You just don't need to declare the queue on the RPC server, the client 
will already have declared it. And the server can publish to it by 
publishing to the default exchange (named &quot;&quot;) with a routing key of the 
queue's name. Does this make sense?

Cheers, Simon

On 21/06/12 11:19, Dennis wrote:
&gt;<i> Hi, Simon
</I>&gt;<i>
</I>&gt;<i> I'm just using approach described at
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/tutorials/tutorial-six-python.html">http://www.rabbitmq.com/tutorials/tutorial-six-python.html</A> which says
</I>&gt;<i> exclusive=True
</I>&gt;<i>
</I>&gt;<i> AMQP_AUTODELETE constant from here:
</I>&gt;<i> <A HREF="http://www.php.net/manual/en/amqp.constants.php">http://www.php.net/manual/en/amqp.constants.php</A> seems not working
</I>&gt;<i> properly also. Queue remains empty after all messages are consumed and
</I>&gt;<i> after both client and server disconnected from server. It's probably
</I>&gt;<i> again the issue of PECL php library.
</I>&gt;<i> Will dig this further and write the results
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Jun 21, 2012 at 2:10 PM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Hi Dennis.
</I>&gt;<i>
</I>&gt;<i>     The whole point of an exclusive queue is that it is accessible
</I>&gt;<i>     solely by the connection that declares it. You don't want to declare
</I>&gt;<i>     a queue as exclusive if it is going to be used by more than one
</I>&gt;<i>     connection.
</I>&gt;<i>
</I>&gt;<i>     So I'm not sure why you are declaring it exclusive? If you are
</I>&gt;<i>     trying to make sure that it goes away when the client connection
</I>&gt;<i>     does, you probably want to make it autodelete - then it will be
</I>&gt;<i>     deleted when the client connection stops consuming from it.
</I>&gt;<i>
</I>&gt;<i>     Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>     On 21/06/12 10:48, Denis wrote:
</I>&gt;<i>
</I>&gt;<i>         Sorry for me writing here: I can't figure out how to use mailing
</I>&gt;<i>         list
</I>&gt;<i>         for replies =/
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         My Client.php declares callback queue php-object as following:
</I>&gt;<i>
</I>&gt;<i>         |$callbackQueue=  new  \AMQPQueue($channel);
</I>&gt;<i>
</I>&gt;<i>         $callbackQueue-&gt;setFlags(AMQP___EXCLUSIVE);  // set EXCLUSIVE flag
</I>&gt;<i>         $callbackQueue-&gt;declare();|
</I>&gt;<i>
</I>&gt;<i>         After that I pass it's name at an envelope to server like this
</I>&gt;<i>         ($callbackQueue-&gt;getName at 'reply_to')
</I>&gt;<i>
</I>&gt;<i>         |$exchange-&gt;publish(
</I>&gt;<i>                 json_encode(array('process me!')),
</I>&gt;<i>         'temp_action',
</I>&gt;<i>                 AMQP_MANDATORY,
</I>&gt;<i>                 array(
</I>&gt;<i>         'reply_to'  =&gt;  $callbackQueue-&gt;getName(),  // pass callback
</I>&gt;<i>         queue name
</I>&gt;<i>         'correlation_id'  =&gt;  $correlationId
</I>&gt;<i>                 )
</I>&gt;<i>         );|
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         And my Server.php creates a new Queue php-object (in an anonymous
</I>&gt;<i>         function that handles consuming) as following:
</I>&gt;<i>
</I>&gt;<i>         |        $callbackQueue=  new  \AMQPQueue($channel);
</I>&gt;<i>
</I>&gt;<i>                 $callbackQueue-&gt;setName($__envelope-&gt;getReplyTo());
</I>&gt;<i>                 $callbackQueue-&gt;setFlags(AMQP___EXCLUSIVE);  // set
</I>&gt;<i>         EXCLUSIVE flag|
</I>&gt;<i>
</I>&gt;<i>         Right after that moment I'm trying to bind newly created
</I>&gt;<i>         $callbackQueue
</I>&gt;<i>         object to an exchange - and this causes blocking issue.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         I'm not sure which exact options are different (exclusive looks
</I>&gt;<i>         for me
</I>&gt;<i>         to be the only flag I set in both cases).
</I>&gt;<i>         Setting name in Server.php is necessary and name is taken from
</I>&gt;<i>         envelope's 'reply_to' setting.
</I>&gt;<i>
</I>&gt;<i>         As far as I can see no extra declaration of callback queue is
</I>&gt;<i>         happening
</I>&gt;<i>         on a Server.php side. (Although tempQueue Server consumes
</I>&gt;<i>         messages from
</I>&gt;<i>         is extra declared, but this is made for server to be able to
</I>&gt;<i>         listen that
</I>&gt;<i>         queue even when before any client exists)
</I>&gt;<i>
</I>&gt;<i>         On Thursday, June 21, 2012 12:33:42 PM UTC+4, Alvaro Videla wrote:
</I>&gt;<i>
</I>&gt;<i>             While not using the same library here you have the official
</I>&gt;<i>             tutorials ported to PHP
</I>&gt;<i>
</I>&gt;<i>         <A HREF="https://github.com/rabbitmq/__rabbitmq-tutorials/tree/__master/php">https://github.com/rabbitmq/__rabbitmq-tutorials/tree/__master/php</A>
</I>&gt;<i>         &lt;<A HREF="https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php">https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php</A>&gt;
</I>&gt;<i>         &lt;<A HREF="https://github.com/rabbitmq/__rabbitmq-tutorials/tree/__master/php">https://github.com/rabbitmq/__rabbitmq-tutorials/tree/__master/php</A>
</I>&gt;<i>         &lt;<A HREF="https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php">https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php</A>&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>             The problem in your code is that you declare queues with
</I>&gt;<i>         different
</I>&gt;<i>             options.
</I>&gt;<i>
</I>&gt;<i>             So as one reply say, if you declare queue A as durable, then
</I>&gt;<i>         every
</I>&gt;<i>             other declaration of that queue must be durable. The same
</I>&gt;<i>         for the
</I>&gt;<i>             exclusive flag.
</I>&gt;<i>
</I>&gt;<i>             Also you don't need to redeclare a queue to publish messages
</I>&gt;<i>         to it.
</I>&gt;<i>             As an RPC server you assume that the address sent in the
</I>&gt;<i>         'reply_to'
</I>&gt;<i>             property is already present. I think is the responsibility
</I>&gt;<i>         of the
</I>&gt;<i>             RpcClient to make sure the queue where it is waiting for replies
</I>&gt;<i>             exists already.
</I>&gt;<i>
</I>&gt;<i>             Regards,
</I>&gt;<i>
</I>&gt;<i>             Alvaro
</I>&gt;<i>
</I>&gt;<i>             And you can indeed do RPC over RabbitMQ by using different
</I>&gt;<i>         connections.
</I>&gt;<i>
</I>&gt;<i>             On Wed, Jun 20, 2012 at 8:03 PM, Denis wrote:
</I>&gt;<i>
</I>&gt;<i>                 Hello guys.
</I>&gt;<i>
</I>&gt;<i>                 I'm trying to build RPC using PHP, here is my description of
</I>&gt;<i>                 problem:
</I>&gt;<i>         <A HREF="http://stackoverflow.com/____questions/11104004/rabbitmq-____rpc-exclusive-queues-locking-____php">http://stackoverflow.com/____questions/11104004/rabbitmq-____rpc-exclusive-queues-locking-____php</A>
</I>&gt;<i>         &lt;<A HREF="http://stackoverflow.com/__questions/11104004/rabbitmq-__rpc-exclusive-queues-locking-__php">http://stackoverflow.com/__questions/11104004/rabbitmq-__rpc-exclusive-queues-locking-__php</A>&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;<A HREF="http://stackoverflow.com/__questions/11104004/rabbitmq-__rpc-exclusive-queues-locking-__php">http://stackoverflow.com/__questions/11104004/rabbitmq-__rpc-exclusive-queues-locking-__php</A>
</I>&gt;<i>         &lt;<A HREF="http://stackoverflow.com/questions/11104004/rabbitmq-rpc-exclusive-queues-locking-php">http://stackoverflow.com/questions/11104004/rabbitmq-rpc-exclusive-queues-locking-php</A>&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>                 The main issue I suspect is that Client.php and
</I>&gt;<i>         Server.php try
</I>&gt;<i>                 to connect to RabbitMQ server using different
</I>&gt;<i>         connections, which
</I>&gt;<i>                 leads to inability of using EXCLUSIVE queue (that is
</I>&gt;<i>         declared in
</I>&gt;<i>                 CLient.php) from Server.php
</I>&gt;<i>
</I>&gt;<i>                 Can u give me a way I can dig to? I'm out of ideas ...
</I>&gt;<i>
</I>&gt;<i>                 _________________________________________________
</I>&gt;<i>                 rabbitmq-discuss mailing list
</I>&gt;<i>         <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.__rabbitmq.com</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at __lists.rabbitmq.com</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
</I>&gt;<i>         <A HREF="https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss">https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss</A>
</I>&gt;<i>         &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>         &lt;<A HREF="https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss">https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss</A>
</I>&gt;<i>         &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         _________________________________________________
</I>&gt;<i>         rabbitmq-discuss mailing list
</I>&gt;<i>         <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.__rabbitmq.com</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i>         <A HREF="https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss">https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss</A>
</I>&gt;<i>         &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     --
</I>&gt;<i>     Simon MacMullen
</I>&gt;<i>     RabbitMQ, VMware
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>









































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020739.html">[rabbitmq-discuss] RabbitMQ + PHP and RPC
</A></li>
	<LI>Next message: <A HREF="020744.html">[rabbitmq-discuss] RabbitMQ 2.8.3 released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20741">[ date ]</a>
              <a href="thread.html#20741">[ thread ]</a>
              <a href="subject.html#20741">[ subject ]</a>
              <a href="author.html#20741">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
