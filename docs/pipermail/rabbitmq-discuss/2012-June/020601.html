<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: RabbitMQ 2.8.2 Erlang crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fwd%3A%20RabbitMQ%202.8.2%20Erlang%20crash&In-Reply-To=%3C87aa07o3rx.wl%25francesco%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020599.html">
   <LINK REL="Next"  HREF="020535.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: RabbitMQ 2.8.2 Erlang crash</H1>
    <B>Francesco Mazzoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fwd%3A%20RabbitMQ%202.8.2%20Erlang%20crash&In-Reply-To=%3C87aa07o3rx.wl%25francesco%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Fwd: RabbitMQ 2.8.2 Erlang crash">francesco at rabbitmq.com
       </A><BR>
    <I>Wed Jun 13 12:22:10 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020599.html">[rabbitmq-discuss] Fwd: RabbitMQ 2.8.2 Erlang crash
</A></li>
        <LI>Next message: <A HREF="020535.html">[rabbitmq-discuss] there is a Consumer connected?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20601">[ date ]</a>
              <a href="thread.html#20601">[ thread ]</a>
              <a href="subject.html#20601">[ subject ]</a>
              <a href="author.html#20601">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
One clarification:

&gt;<i> If what I described above matches your situation, then you can refer
</I>&gt;<i> to this other post I just sent regarding those situations:
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020594.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020594.html</A>
</I>&gt;<i> .
</I>
That post advocates reseting the cluster nodes to restore a &quot;clean&quot;
cluster. That obviously means that you'll lose any data that resides
on that node only, for example non-HA queues. So if don't want that,
you should only follow step 1 and then start the other nodes, while
making sure that the rabbit/erlang version stays the same.

Francesco.

At Wed, 13 Jun 2012 11:53:10 +0100,
Francesco Mazzoli wrote:
&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> &gt; I have a problem with starting RabbitMQ service after spliting
</I>&gt;<i> &gt; cluster.  Software crash everytime during
</I>&gt;<i> &gt; &quot;/etc/init.d/rabbitmq-server start&quot;.
</I>&gt;<i> 
</I>&gt;<i> What do you mean by &quot;splitting cluster&quot;? I'd interpret it as &quot;the
</I>&gt;<i> connection was severed between the two nodes&quot;, but maybe it's
</I>&gt;<i> something different, considering that you're having problems
</I>&gt;<i> *starting* nodes. In any case, clustering in rabbit does not tolerate
</I>&gt;<i> partitions well. The most it can take is simply nodes going down and
</I>&gt;<i> then up again, but if the data in the tables diverge, things will go
</I>&gt;<i> wrong.
</I>&gt;<i> 
</I>&gt;<i> In your case, since you're getting a timeout in the database boot
</I>&gt;<i> step, I'd guess that for some reason mnesia thinks that it has to wait
</I>&gt;<i> the tables in the other nodes first. This typically happen when
</I>&gt;<i> trying to start a node of an offline cluster before starting the last
</I>&gt;<i> node to go down (mnesia wants the last node to go down first because
</I>&gt;<i> it has the most up-to-date data). Normally rabbit will terminate with
</I>&gt;<i> a friendlier error message (&quot;please start up the last node to go down&quot;
</I>&gt;<i> or similar) but if you shut down the nodes abruptly this won't happen
</I>&gt;<i> and you'll get an hanging node.
</I>&gt;<i> 
</I>&gt;<i> If what I described above matches your situation, then you can refer
</I>&gt;<i> to this other post I just sent regarding those situations:
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020594.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020594.html</A>
</I>&gt;<i> . If it doesn't, can you describe in more detail what you are doing to
</I>&gt;<i> get that? The logs would help too.
</I>&gt;<i> 
</I>&gt;<i> Francesco.
</I>&gt;<i> 
</I>&gt;<i> At Sat, 9 Jun 2012 17:24:47 +0200,
</I>&gt;<i> Micha&#322; Ki&#281;dy&#347; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [1  &lt;multipart/alternative (7bit)&gt;]
</I>&gt;<i> &gt; [1.1  &lt;text/plain; ISO-8859-2 (quoted-printable)&gt;]
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [1.2  &lt;text/html; ISO-8859-2 (quoted-printable)&gt;]
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ---------- Forwarded message ----------
</I>&gt;<i> &gt; From: Alexis Richardson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis at rabbitmq.com</A>&gt;
</I>&gt;<i> &gt; Date: 2012/6/8
</I>&gt;<i> &gt; Subject: Re: RabbitMQ 2.8.2 Erlang crash
</I>&gt;<i> &gt; To: Micha&#322; Ki&#281;dy&#347; / Gadu-Gadu &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">m.kiedys at gadu-gadu.pl</A>&gt;
</I>&gt;<i> &gt; Cc: rabbitmq info &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">info at rabbitmq.com</A>&gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Micha&#322;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Also, if you could post this to rabbitmq-discuss, that would be helpful.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Best wishes
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; alexis
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Fri, Jun 8, 2012 at 8:34 AM, Micha&#322; Ki&#281;dy&#347; / Gadu-Gadu
</I>&gt;<i> &gt; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">m.kiedys at gadu-gadu.pl</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; Hello
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I have a problem with starting RabbitMQ service after spliting cluster.
</I>&gt;<i> &gt; &gt; Software crash everytime during &quot;/etc/init.d/rabbitmq-server start&quot;.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Log:
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at arch-task-mq-8</A>:~# rabbitmq-server
</I>&gt;<i> &gt; &gt; Activating RabbitMQ plugins ...
</I>&gt;<i> &gt; &gt; 6 plugins activated:
</I>&gt;<i> &gt; &gt; * amqp_client-2.8.2
</I>&gt;<i> &gt; &gt; * mochiweb-1.3-rmq2.8.2-git
</I>&gt;<i> &gt; &gt; * rabbitmq_management-2.8.2
</I>&gt;<i> &gt; &gt; * rabbitmq_management_agent-2.8.2
</I>&gt;<i> &gt; &gt; * rabbitmq_mochiweb-2.8.2
</I>&gt;<i> &gt; &gt; * webmachine-1.7.0-rmq2.8.2-hg
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ** Found 0 name clashes in code paths
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; +---+ &#160; +---+
</I>&gt;<i> &gt; &gt; | &#160; | &#160; | &#160; |
</I>&gt;<i> &gt; &gt; | &#160; | &#160; | &#160; |
</I>&gt;<i> &gt; &gt; | &#160; | &#160; | &#160; |
</I>&gt;<i> &gt; &gt; | &#160; +---+ &#160; +-------+
</I>&gt;<i> &gt; &gt; | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; |
</I>&gt;<i> &gt; &gt; | RabbitMQ &#160;+---+ &#160; |
</I>&gt;<i> &gt; &gt; | &#160; &#160; &#160; &#160; &#160; | &#160; | &#160; |
</I>&gt;<i> &gt; &gt; | &#160; v2.8.2 &#160;+---+ &#160; |
</I>&gt;<i> &gt; &gt; | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; |
</I>&gt;<i> &gt; &gt; +-------------------+
</I>&gt;<i> &gt; &gt; AMQP 0-9-1 / 0-9 / 0-8
</I>&gt;<i> &gt; &gt; Copyright (C) 2007-2012 VMware, Inc.
</I>&gt;<i> &gt; &gt; Licensed under the MPL. &#160;See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; node &#160; &#160; &#160; &#160; &#160; : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arch-task-mq-8</A>
</I>&gt;<i> &gt; &gt; app descriptor :
</I>&gt;<i> &gt; &gt; /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
</I>&gt;<i> &gt; &gt; home dir &#160; &#160; &#160; : /var/lib/rabbitmq
</I>&gt;<i> &gt; &gt; config file(s) : /etc/rabbitmq/rabbitmq.config
</I>&gt;<i> &gt; &gt; cookie hash &#160; &#160;: +MKjvqvf4/0q7+0Fhc9OEw==
</I>&gt;<i> &gt; &gt; log &#160; &#160; &#160; &#160; &#160; &#160;: /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arch-task-mq-8.log</A>
</I>&gt;<i> &gt; &gt; sasl log &#160; &#160; &#160; : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arch-task-mq-8-sasl.log</A>
</I>&gt;<i> &gt; &gt; database dir &#160; : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arch-task-mq-8</A>
</I>&gt;<i> &gt; &gt; erlang version : 5.8
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; -- rabbit boot start
</I>&gt;<i> &gt; &gt; starting file handle cache server
</I>&gt;<i> &gt; &gt; ...done
</I>&gt;<i> &gt; &gt; starting worker pool
</I>&gt;<i> &gt; &gt; &#160;...done
</I>&gt;<i> &gt; &gt; starting database &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ...
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; BOOT FAILED
</I>&gt;<i> &gt; &gt; ===========
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Timeout contacting cluster nodes: ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arch-task-mq-7</A>'].
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; DIAGNOSTICS
</I>&gt;<i> &gt; &gt; ===========
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; nodes in question: ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arch-task-mq-7</A>']
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; hosts, their running nodes and ports:
</I>&gt;<i> &gt; &gt; - arch-task-mq-7: [{rabbit,46044}]
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; current node details:
</I>&gt;<i> &gt; &gt; - node name: '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arch-task-mq-8</A>'
</I>&gt;<i> &gt; &gt; - home dir: /var/lib/rabbitmq
</I>&gt;<i> &gt; &gt; - cookie hash: +MKjvqvf4/0q7+0Fhc9OEw==
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; {&quot;Kernel pid
</I>&gt;<i> &gt; &gt; terminated&quot;,application_controller,&quot;{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}&quot;}
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Crash dump was written to: erl_crash.dump
</I>&gt;<i> &gt; &gt; Kernel pid terminated (application_controller)
</I>&gt;<i> &gt; &gt; ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Regards,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; --
</I>&gt;<i> &gt; &gt; Micha&#322; Ki&#281;dy&#347;
</I>&gt;<i> &gt; &gt; web architect / Pion Aplikacji Internetowych
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; GG Network S.A
</I>&gt;<i> &gt; &gt; ul. Kamionkowska 45
</I>&gt;<i> &gt; &gt; 03-812 Warszawa
</I>&gt;<i> &gt; &gt; tel.: +48 22 427 79 00
</I>&gt;<i> &gt; &gt; fax.: +48 22 427 74 25
</I>&gt;<i> &gt; &gt; gg:16698
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Sp&#243;&#322;ka zarejestrowana w S&#261;dzie Rejonowym dla m. st. Warszawy, XIII
</I>&gt;<i> &gt; &gt; Wydzia&#322; Gospodarczy KRS pod numerem 0000264575, NIP 867-19-48-977.
</I>&gt;<i> &gt; &gt; Kapita&#322; zak&#322;adowy: &#160;1 758 461,10 z&#322; - wp&#322;acony w ca&#322;o&#347;ci.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [2  &lt;text/plain; us-ascii (7bit)&gt;]
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020599.html">[rabbitmq-discuss] Fwd: RabbitMQ 2.8.2 Erlang crash
</A></li>
	<LI>Next message: <A HREF="020535.html">[rabbitmq-discuss] there is a Consumer connected?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20601">[ date ]</a>
              <a href="thread.html#20601">[ thread ]</a>
              <a href="subject.html#20601">[ subject ]</a>
              <a href="author.html#20601">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
