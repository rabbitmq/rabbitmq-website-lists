<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustered startup with multiple queues and multiple masters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustered%20startup%20with%20multiple%20queues%20and%0A%20multiple%20masters&In-Reply-To=%3CCACLE7iyQHdO1OW2FCKHGm3GOGK3RgULzoMDk2vd2V2YCVbrc3Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020750.html">
   <LINK REL="Next"  HREF="020755.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustered startup with multiple queues and multiple masters</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustered%20startup%20with%20multiple%20queues%20and%0A%20multiple%20masters&In-Reply-To=%3CCACLE7iyQHdO1OW2FCKHGm3GOGK3RgULzoMDk2vd2V2YCVbrc3Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Clustered startup with multiple queues and multiple masters">mpietrek at skytap.com
       </A><BR>
    <I>Thu Jun 21 17:05:05 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020750.html">[rabbitmq-discuss] Clustered startup with multiple queues and multiple masters
</A></li>
        <LI>Next message: <A HREF="020755.html">[rabbitmq-discuss] Clustered startup with multiple queues and	multiple masters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20753">[ date ]</a>
              <a href="thread.html#20753">[ thread ]</a>
              <a href="subject.html#20753">[ subject ]</a>
              <a href="author.html#20753">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Francesco.

Your script looks reasonably close to what I'm doing, except for a couple
of key differences:

All of your nodes are running on the same host. In my setup, each node is
in its own VM. I imagine this introduces additional networking into the
communication between nodes.

When you start Rabbit instances, you're doing it sequentially. In my setup
I start up in parallel on all three VMs via Capistrano. If you can't go the
multi-VM route, you may be able to somewhat simulate this by starting the
instances with an '&amp;' at the end.

I use &quot;killall -9 beam.smp&quot;, rather than just &quot;killall beam.smp&quot;


In short, the goal of my test is to simulate a worst case powerout in the
datacenter. All of our Rabbit instances run on separate VMs for fault
tolerance. Hopefully we won't lose them all at once, but if we do, we need
to be able to reliably restart them.



On Thu, Jun 21, 2012 at 6:36 AM, Francesco Mazzoli
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">francesco at rabbitmq.com</A>&gt;wrote:

&gt;<i> Hi Matt,
</I>&gt;<i> At Tue, 19 Jun 2012 16:33:05 -0700,
</I>&gt;<i> Matt Pietrek wrote:
</I>&gt;<i> &gt; Francesco,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks again for the valuable insight from your reply. I'm down to
</I>&gt;<i> &gt; one issue at this point.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Given what you said earlier about it being OK to start the brokers
</I>&gt;<i> &gt; in any order, I wrote a simple &quot;catastrophic stress&quot; test. The good
</I>&gt;<i> &gt; news is that RabbitMQ does what's expected. The bad news: Only most
</I>&gt;<i> &gt; of the time, i.e. about 90%.
</I>&gt;<i>
</I>&gt;<i> First of all, this is more of an erlang question than a RabbitMQ one -
</I>&gt;<i> not that this changes anything, but you could ask about it in
</I>&gt;<i> erlang-questions as well. RabbitMQ clusters are mnesia clusters, so
</I>&gt;<i> they offer the same guarantees.
</I>&gt;<i>
</I>&gt;<i> I can't think of a motivation of why this would be happening, but I'm
</I>&gt;<i> no expert with mnesia. I've attached a script that reproduces your
</I>&gt;<i> test, can you verify that that's more or less what you're doing? I'm
</I>&gt;<i> using the puka python client to publish the messages. I've run it 50
</I>&gt;<i> times but I wasn't able to reproduce your problem.
</I>&gt;<i>
</I>&gt;<i> In the case that my test is indeed accurate I think that the best
</I>&gt;<i> thing is to ask about someone with more mnesia knowledge - I have CCed
</I>&gt;<i> possible candidates :).
</I>&gt;<i>
</I>&gt;<i> Francesco.
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120621/bbaa7888/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120621/bbaa7888/attachment.htm</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020750.html">[rabbitmq-discuss] Clustered startup with multiple queues and multiple masters
</A></li>
	<LI>Next message: <A HREF="020755.html">[rabbitmq-discuss] Clustered startup with multiple queues and	multiple masters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20753">[ date ]</a>
              <a href="thread.html#20753">[ thread ]</a>
              <a href="subject.html#20753">[ subject ]</a>
              <a href="author.html#20753">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
