From tonygarnockjones+rabbitmq at gmail.com  Sun Jan  1 21:50:40 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Sun, 1 Jan 2012 16:50:40 -0500
Subject: [rabbitmq-discuss] RabbitMQ - JSON RPC Https Support?
In-Reply-To: <1325436445.67235.YahooMailClassic@web39304.mail.mud.yahoo.com>
References: <CAM8fPiQMLUxHv1s5-X2rL1P0kF05QT-bm8NDV2V5+j2XnAZ94w@mail.gmail.com>
	<1325436445.67235.YahooMailClassic@web39304.mail.mud.yahoo.com>
Message-ID: <CAM8fPiQtXcXm8R-ih4KwG9ETx0h8e+L+TbeeiacQR1C6k9gmUg@mail.gmail.com>

On 1 January 2012 11:47, preeti sp <preetisp_83 at yahoo.com> wrote:
> I am interested in knowing every little detail pertaining to JSON RPC
Http plugin.
> I am not finding enough documentation online for the same.

There isn't much documentation for the Rabbit JSON-RPC plugin itself.
However, there is quite a lot of documentation on both JSON-RPC in general
and on my Erlang/Javascript JSON-RPC implementation in particular:

   - The project's homepage is http://tonyg.github.com/erlang-rfc4627/.
   - The JSON-RPC 1.1 spec is
   http://tonyg.github.com/erlang-rfc4627/doc/JSON-RPC-1-1-WD-20060807.html.
   - The manual for erlang-rfc4627 is
   http://tonyg.github.com/erlang-rfc4627/doc/index.html. See in particular
   the section titled "Invoking JSON-RPC procedures from Javascript".

I'd also suggest getting the plugin and its examples up and running,
visiting the examples in your browser, and using Firebug or similar to
inspect the HTTP requests that are going across the wire. Looking at some
real network traffic will be enlightening.

Regards,
  Tony
--
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120101/ba50c3b0/attachment.htm>

From adamrabung at gmail.com  Mon Jan  2 17:01:27 2012
From: adamrabung at gmail.com (Adam Rabung)
Date: Mon, 2 Jan 2012 12:01:27 -0500
Subject: [rabbitmq-discuss] Channel shutdown listener
Message-ID: <CAAN_EDp3SsTGLR0XE4x_=yWtfBAB78gKniVJcFKdA6NyYSKkxA@mail.gmail.com>

Hi,
I'm having trouble using a ShutdownListener with a Channel.  It seems
that shutdown listeners on Connections are called, but not Channels.
Here's code that reproduces the problem:
https://gist.github.com/1551353

I run this, then kill the cluster.  The only output is
"Connection shut down"

I am using 2.7.1 rabbit/java client.  What am I doing wrong?

Thank you,
Adam

From adamrabung at gmail.com  Mon Jan  2 18:24:09 2012
From: adamrabung at gmail.com (Adam Rabung)
Date: Mon, 2 Jan 2012 13:24:09 -0500
Subject: [rabbitmq-discuss] Brining cluster node back up after stop
Message-ID: <CAAN_EDo3sO=WZX+5ePoc42Uid7xMy6iac_cvDCFK_fBc+TzJUA@mail.gmail.com>

Hello,
I am investigating active/active clustering, using just my machine for
now.  All is going well, but I'm having a hard time bringing up a node
that I have previously stopped.  I believe the problem only happens
when I restart a node that was a disk node when I stopped it.

startCluster script:
https://gist.github.com/1551407

running startCluster:
https://gist.github.com/1551429

After starting the cluster, I'm able to bring node 2 and 3 up and down
with no problem, but node 1 does not come back up.
https://gist.github.com/1551582

I realize this may just be a problem due to the fact that I have three
nodes on one machine, but I am troubled by how little I understand
from that error message :)

Thank you,
Adam

From srdan at burtcorp.com  Mon Jan  2 18:40:29 2012
From: srdan at burtcorp.com (Srdan Kvrgic)
Date: Mon, 2 Jan 2012 19:40:29 +0100
Subject: [rabbitmq-discuss] Performance on ec2
In-Reply-To: <B6C9B5CE-77B8-49A1-AD18-0745B6C1B5D5@burtcorp.com>
References: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
	<CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>
	<29734019-3327-406D-9338-596565E8C8DB@burtcorp.com>
	<CACOPnvdCKOmyn96EHqirYDmeiYNFcH-BMV4MGGxRVm6WJD1RBQ@mail.gmail.com>
	<B6C9B5CE-77B8-49A1-AD18-0745B6C1B5D5@burtcorp.com>
Message-ID: <E3DA278C-ECCD-4D84-BDE2-1DA52B432D05@burtcorp.com>

Hi

So, I've done a bunch more tests, graphs of which can be found here: http://goo.gl/wmEmD

The takeaway:
	* You can load/drain a maximum of 8000 1000-byte messages per second, regardless of the amount of mq-servers or the speed of the machine.
	* Making the messages 100 times smaller gained  25% per message speed increase, but loss in total throughput.
	* Making the messages 10 times bigger (i.e. batching) dropped message rate by 50%, but gained 500% in overall throughput.


I can replicate the behavior on my mac pretty well with the server instances on ec2, if I only run one instance of loader and one instance of drainer. I can publish 1000 byte messages on the server as fast as I can drain them (@about 7000/s). My machine had a single mq instance, the ec2 server was running against two mq servers in a cluster. Same performance. 

When running 3 loader and 3 drainer instances everything was fine for the rate limited upload of 2000/s. I loaded at 6000/s and I drained at 6000/s.

However, when I cranked the loader instance's rate to 3000/s, I noticed the effect I noticed earlier - the drain speed was much lower until the 1 000 000 messages were queued, and then it popped back up to about 8000/s

At load rate of 5000/s per instance (15000 in total), the effect was even clearer. 

I tried lowering the size of the messages to 10 bytes, instead of 1000. That improved the peak drain speed from about 8000/s  to 10 000/s. Not a huge increase, considering I'd hacked the message size down to 1%.

I also tried bumping up the message size to 10 000 bytes. That killed the message rate, obviously. But not that much. At 1200/s per instance, everything was running smoothly. I had a stable throughput of 3600 messages per second, or 36 000 messages per second unpacked.

At the rate of 2000/s I? I ran into some problems. It all seemed to work well. I wasn't maxing out the loading, but I was only able to push some 4000 messages per second in total. I was even reasonably sure that was due to bandwidth on the mq servers (they ware pushing 30 megs per second each (at peak)). Then the server started getting out of memory. This stopped the loading, and the drain part screamed in at 6500 messages per second. This freed up memory. So the loaders loaded more, which killed the drainer's speed. Which caused memory errors. This eventually stabilized at a disappointing ~1200 messages per second in total.




On Dec 29, 2011, at 23:03 , Srdan Kvrgic wrote:

> Nope, can't say that I have. 
> 
> It's not really the use case though - in real life the queues are actually significant.
> 
> I'll try it though. If that'll yield some insight. Hell, I'd try eating a balanced diet and getting plenty of sleep if that could help.
> 
> //S
> 
> 
> On Dec 29, 2011, at 17:53 , Alexis Richardson wrote:
> 
>> Srdan
>> 
>> I just had a quick look through your slides.  Have you tried using one
>> loader and one drainer and one queue, on one core, and gradually
>> increasing their rates?  What do you see?
>> 
>> alexis
>> 
>> 
>> 
>> On Wed, Dec 28, 2011 at 9:05 PM, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>>> 
>>> On Dec 28, 2011, at 19:48 , Tony Garnock-Jones wrote:
>>> 
>>> On 28 December 2011 12:49, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>>>> 
>>>> My question is as simple as it is complex: 'Is that it?' What can I do to
>>>> tweak these numbers? Massively.
>>> 
>>> 
>>> Is this a transient-messaging use case (RabbitMQ as router, not relying
>>> particularly on disk storage), or a persistent-messaging use case (where you
>>> die in flames if a single message is dropped), or somewhere in-between?
>>> 
>>> 
>>> Well, it is transient in so fact that we use it to distribute messages to a
>>> large number of workers. In that way it is a router. But it also functions
>>> as a buffer. If we for instance update the workers we like to be able to
>>> stop and restart them without throwing messages away.
>>> 
>>> Each individual message is not that important in itself. And if we loose a
>>> larger amount of messages, we can re-queue the affected blocks. We're big on
>>> idempotence and can cut ourselves some slack if we need to.
>>> 
>>> That said, once you get to sending thousands of messages per second and the
>>> system goes all fishy on you for an indeterminate length of time, the
>>> re-queueing becomes? inconvenient. Inconvenient to the degree that it for
>>> most practical purposes stops being an option and you become prepared to
>>> 'invest' yourself away from those problems if at all possible.
>>> 
>>> 
>>> //S
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
> 


From mpietrek at skytap.com  Mon Jan  2 19:49:28 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 02 Jan 2012 11:49:28 -0800
Subject: [rabbitmq-discuss] slave_pids and synchronised_slave_pids not
 available from the HTTP api?
Message-ID: <CB274A48.25D75%mpietrek@skytap.com>

I'm crafting some custom tooling that needs to know about the sync status of
mirrored queues. Up to this point I've been successfully using the HTTP API
via the rabbitmqadmin module and been able to get everything I need .
However, I'm stymied on slave_pids and  synchronised_slave_pids, which don't
seem to come through.

Per the rabbitmqctl cmd-line help, slave_pid and synchronised_slave_pids are
valid queueinfoitems. Up to this point, queueinfoitem names have worked
equally well with "rabbitmqadmin list queues"

I've simplified the repro case down to the following; Rabbitmqctl displays
these fields as expected:

mpietrek at play:~/work/$rabbitmqctl list_queues consumers messages name
slave_pids synchronised_slave_pids
Listing queues ...
0 0 fake_munger_queue [<rabbit at play2.1.248.0>] [<rabbit at play2.1.248.0>]
0 0 fake_service_2 [<rabbit at play2.1.250.0>] [<rabbit at play2.1.250.0>]
...done.


However, rabbitmqadmin doesn't:

mpietrek at play:~/work/$rabbitmqadmin.py list queues consumers messages name
slave_pids synchronised_slave_pids
+-----------+----------+----------------------+------------+----------------
---------+
| consumers | messages |         name         | slave_pids |
synchronised_slave_pids |
+-----------+----------+----------------------+------------+----------------
---------+
| 0         | 0        | fake_munger_queue    |            |
|
| 0         | 0        | fake_service_2       |            |
|
+-----------+----------+----------------------+------------+----------------
---------+

Is this normal/expected? Am I not understanding something?

FWIW, this is using RabbitMQ 2.71 on Ubuntu 10.04.

Thanks,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120102/5e6cc733/attachment.htm>

From steve at rabbitmq.com  Tue Jan  3 10:17:58 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 3 Jan 2012 10:17:58 +0000
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>
Message-ID: <499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>

Hi Jared,

I'm afraid I'm not familiar with pbuilder, but rather than just ignore your
note I looked at the output.

There seem to be several puzzling things here:

one is that dpkg complains about several packages not being installed:
> Unpacking pbuilder-satisfydepends-dummy (from .../pbuilder-satisfydepends-dummy.deb) ...
> dpkg: dependency problems prevent configuration of pbuilder-satisfydepends-dummy:
>  pbuilder-satisfydepends-dummy depends on cdbs; however:
>   Package cdbs is not installed.
>  pbuilder-satisfydepends-dummy depends on debhelper (>= 5); however:
>   Package debhelper is not installed.
>  pbuilder-satisfydepends-dummy depends on erlang-dev; however:
>   Package erlang-dev is not installed.
>  pbuilder-satisfydepends-dummy depends on python-simplejson; however:
>   Package python-simplejson is not installed.
>  pbuilder-satisfydepends-dummy depends on xmlto; however:
>   Package xmlto is not installed.
>  pbuilder-satisfydepends-dummy depends on xsltproc; however:
>   Package xsltproc is not installed.
> dpkg: error processing pbuilder-satisfydepends-dummy (--install):
>  dependency problems - leaving unconfigured
though this looks as though to be corrected subsequently...I cannot interpret
this...

second, there is an nmap missing complaint at three places (not sure why
you would be calling nmap here, though I see we have a ref to it in
rabbitmq_auth_backend_ldap's package.mk file) 
e.g.:
> make[2]: Entering directory `/tmp/buildd/rabbitmq-server-2.7.1/plugins-src'
> make -f all-packages.mk clean-all-packages
> /bin/sh: nmap: not found

third, make ... clean in rabbit appears to fail strangely:
> make -C ./rabbitmq-server clean
> make: Entering an unknown directory
> make: *** ./rabbitmq-server: No such file or directory.  Stop.
> make: Leaving an unknown directory
> make[3]: *** [rabbitmq-server+clean] Error 2
> make[3]: Target `clean-all-packages' not remade because of errors.
which looks suspicious.  It could imply a make problem... (note that this
follows the rm -rf commands for mochiweb-wrapper and eldap-wrapper stuff)

fourth, it appears some git repository structures don't exist, or are corrupt:
> echo UPSTREAM_SHORT_HASH:=`git --git-dir=./mochiweb-wrapper/mochiweb-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >mochiweb-wrapper/build/hash.mk
> fatal: Not a git repository: './mochiweb-wrapper/mochiweb-git/.git'
and
> echo UPSTREAM_SHORT_HASH:=`git --git-dir=erlang-rfc4627-wrapper/erlang-rfc4627-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >erlang-rfc4627-wrapper/build/hash.mk
> fatal: Not a git repository: 'erlang-rfc4627-wrapper/erlang-rfc4627-git/.git'
and
> echo UPSTREAM_SHORT_HASH:=`git --git-dir=eldap-wrapper/eldap-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >eldap-wrapper/build/hash.mk
> fatal: Not a git repository: 'eldap-wrapper/eldap-git/.git'
again, I'm not sure why this might be but not getting the erlang patch would
explain the compiler error:
> Compiler function asn1ct:compile_asn/3 failed:
> {undef,[{asn1ct,compile_asn,
>     ....

and finally:
> echo UPSTREAM_SHORT_HASH:=`hg id -R ./webmachine-wrapper/webmachine-hg -i | cut -c -7` >webmachine-wrapper/build/hash.mk
> /bin/sh: hg: not found

implies that you don't have mercurial installed, which might be a problem.

I'm sure you could have found these things by yourself, but I hope one or
more of these trigger some ideas for you to try.

Steve Powell  (a puzzled bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 31 Dec 2011, at 00:49, Jared Biel wrote:

> Hello,
> 
> We make use of the .dsc .diff and .orig.tgz files present in your apt
> repo located at http://rabbitmq.com/debian to perform some
> modifications and rebuild using pbuilder. I have been unable to
> successfully build a package since 2.7.0 because it fails to compile
> one of the plugins (eldap-wrapper.) It appears to die with
> "do-package.mk:507: *** Failed to produce eldap-wrapper/build/deps.mk.
>  Stop."
> 
> Please see the full output of pbuilder here:
> http://pastebin.com/raw.php?i=TdnDfaPJ
> 
> The only modification that I'm performing is changing -sname to -name
> in all files where it's present. This worked prior to 2.7.0 (when the
> plugins weren't included in the main source.)
> 
> Thanks for your help,
> Jared
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Tue Jan  3 10:45:45 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 3 Jan 2012 10:45:45 +0000
Subject: [rabbitmq-discuss] Fwd: Failed to configure Rabbitmq HA(pacemaker)
References: <CAKrFU7Xct85j1OoZOg=SNW3tZa21kdB56NyxWbFnXbrHyfpoKg@mail.gmail.com>
Message-ID: <38AC2D13-3F48-465D-8959-7032E3F6D89A@rabbitmq.com>

ftr
Steve Powell  (a happy new bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

Begin forwarded message:

> From: Jae Sang Lee <hyangii at gmail.com>
> Date: 2 January 2012 01:21:40 GMT
> To: Steve Powell <steve at rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] Failed to configure Rabbitmq HA(pacemaker)
> 
> Yes, a reason of problem(the slave doesn't 'promote' properly) is not equal of UID/GID between master/slave.
> 
> I also try to make mirrored queue for HA. 
> 
> Thank you very much!
> 
> 
> 
> 2011/12/31 Steve Powell <steve at rabbitmq.com>
> I'm just guessing, but there is this on the pacemaker page:
> 
> > The main trick to HA Rabbit is to ensure that when the passive node becomes
> > the active node, it must have the same node-name as the failed node. It must
> > also have read and write access to the files in the shared storage, and if
> > it's going to also be part of a cluster then it must also have the same
> > Erlang cookie.
> >
> > The server runs as the user rabbitmq which is a member of the group
> > rabbitmq. You must ensure that this user and group have the same UIDs and
> > GIDs on both nodes. You can probably save yourself some time by explicitly
> > creating the rabbitmq user and group with the same UID and GID on all nodes
> > before installing the RabbitMQ server at all. If necessary, edit/etc/passwd
> > and /etc/group on both nodes, and then reinstall the RabbitMQ server to
> > ensure all necessary files are owned by the correct user and group.
> 
> That could explain why the slave doesn't 'promote' properly.
> 
> However, that said, there is also this:
> 
> > This page documents a legacy technique for achieving active-passive high
> > availability with RabbitMQ. Active-active mirrored queues are easier to use
> > and do not impose a delay at failover.
> 
> So, yes, pacemaker HA is a 'legacy' technique though it should still work
> and it is possible that in certain circumstances it may offer advantages.
> However, closely coupled rabbit nodes in a cluster with mirrored queues
> offers the best HA solution so far.
> 
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
> 
> On 30 Dec 2011, at 00:51, Jae Sang Lee wrote:
> > active-active HA looks good. but that manual isn't kindly now so I tried to
> > HA using pacemaker first.
> > HA using pacemaker is old way and don't recommend now?
> >
> > 2011/12/29 Joseph Marlin <joseph.a.marlin at gmail.com>
> > Is there a specific reason that you do not want to use Rabbit's new built in
> > active-active HA?
> >
> > http://www.rabbitmq.com/ha.html
> >
> 


From steve at rabbitmq.com  Tue Jan  3 12:50:59 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 3 Jan 2012 12:50:59 +0000
Subject: [rabbitmq-discuss] Channel shutdown listener
In-Reply-To: <CAAN_EDp3SsTGLR0XE4x_=yWtfBAB78gKniVJcFKdA6NyYSKkxA@mail.gmail.com>
References: <CAAN_EDp3SsTGLR0XE4x_=yWtfBAB78gKniVJcFKdA6NyYSKkxA@mail.gmail.com>
Message-ID: <3C450827-9FAC-49D3-90DF-2D7904D30B17@rabbitmq.com>

Adam,
Thank you for pointing this out. I don't think you are doing
anything wrong; I think it is a bug.

When the connection is closed (by the broker) all its channels
are closed without notifying the listeners.

I have raised a problem for this.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 2 Jan 2012, at 17:01, Adam Rabung wrote:

> Hi,
> I'm having trouble using a ShutdownListener with a Channel.  It seems
> that shutdown listeners on Connections are called, but not Channels.
> Here's code that reproduces the problem:
> https://gist.github.com/1551353
> 
> I run this, then kill the cluster.  The only output is
> "Connection shut down"
> 
> I am using 2.7.1 rabbit/java client.  What am I doing wrong?
> 
> Thank you,
> Adam
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Tue Jan  3 12:57:16 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 12:57:16 +0000
Subject: [rabbitmq-discuss] TTLs in 2.5.1
In-Reply-To: <CAHiEoM7Ra=myY2DjF1pQ03PjXZ-RDg_CNZtiMx=SG476Nj-dZw@mail.gmail.com>
References: <CAHiEoM7Ra=myY2DjF1pQ03PjXZ-RDg_CNZtiMx=SG476Nj-dZw@mail.gmail.com>
Message-ID: <4F02FB2C.9090904@rabbitmq.com>

Hi Aaron,

On 20/12/11 03:29, Aaron Westendorf wrote:
> We're running Rabbit 2.5.1 in a 2 node cluster and need  to implement
> message TTLs to mitigate some pressing problems. If anyone could help
> us out with some questions we have that would be most appreciated.
> 
> Are they fully supported in this version?

Yes, support for per-queue message TTL was introduced in rabbit 2.2.0.

> If we're going to enable TTLs, is there a pressing need to upgrade or
> can we stay on 2.5.1?

We would always recommend running the latest version. In this case you
do not need to upgrade specifically to get this feature.

> Is there anything special to note about them in a 2.5.1 cluster?

No. per-queue TTL is a queue-specific feature and queues exist only on a
single node in a 2.5.1 cluster.

> Do we need to turn on client qos, or will rabbit change its consumer
> delivery rules on TTL'd messages?

You do not need to set QoS for messages to expire.

> Are there any recommended lower bounds on this value?

This depends on your usage and hardware performance characteristics. You
should test and validate in a comparable environment before deploying to
production.

A value larger than the average latency makes sense.

> What kind of effect should we expect message TTL to have on resource
> requirements?

I would expect perhaps a small improvement since it is easier for the
broker to expire a message than to deliver.

> Will this significantly impact the memory footprint specifically?

The effect would be similar to a consumer that works at the combined
rate of the publishers.

> Anything special about TTL in the case where rabbit is already under
> very high load?


From emile at rabbitmq.com  Tue Jan  3 13:35:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 13:35:56 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin fails when trying to get
 message from a queue
In-Reply-To: <627b6699-0bb3-422e-9367-4739fbeb7a59@32g2000yqp.googlegroups.com>
References: <627b6699-0bb3-422e-9367-4739fbeb7a59@32g2000yqp.googlegroups.com>
Message-ID: <4F03043C.2050905@rabbitmq.com>

Hi Asaf,

On 26/12/11 11:24, asafdav wrote:
> Hi guys, I'm using rabbitmqadmin for unit testing purpose. The scripts
> fails when I try to fetch messages from queue.
> For example, the following command:
> rabbitmqadmin get queue=test requeue=false
> 
> returns this error message
> *** {u'key_missing': u'encoding'}

Thanks for letting us know. I've filed a bug (24652). Hopefully we'll be
able to fix this shortly.


-Emile

From emile at rabbitmq.com  Tue Jan  3 14:10:18 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 14:10:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ Stability Issues with large queue -
 2011-12-28
In-Reply-To: <E89E025C-D8EA-497C-9207-3E547338B0D4@aol.com>
References: <6FEDEAFD-03B8-4D55-A4D6-D4F4268E715B@aol.com>
	<E89E025C-D8EA-497C-9207-3E547338B0D4@aol.com>
Message-ID: <4F030C4A.6050504@rabbitmq.com>

Hi,

The logfile indicates that the memory alarm has triggered, preventing
further publishes. A broker in this state will only allow fetching. Is
this what you see? What are the symptoms of the crash you observed?

According to the report your one queue alone uses 3.7Gb while the total
memory limit is only 4.8Gb. I would suggest lowering the
vm_memory_high_watermark to the default value of 0.4 or lower so that
the broker starts conserving memory sooner.

If you see segfaults then consider disabling HiPE. This feature is
experimental and could be the cause of your problem.



On 28/12/11 22:20, DawgTool wrote:
> ==> dc001.log <==
> =INFO REPORT==== 28-Dec-2011::17:00:00 ===
> vm_memory_high_watermark set. Memory used:8662988728 allowed:5153960755
> 
> =INFO REPORT==== 28-Dec-2011::17:00:00 ===
>     alarm_handler: {set,{{vm_memory_high_watermark,'dc001 at rmquat-m01'},[]}}

>  {vm_memory_high_watermark,0.5999999999767169},
>  {vm_memory_limit,5153960755}]

>  {vm_memory_high_watermark,0.6}]

>>  {rabbit,                    [{vm_memory_high_watermark, 0.6},
>>                               {collect_statistics_interval, 5000},
>>                               {hipe_compile, true}
>>                              ]
>>  },
>>  {rabbitmq_management,       [ {http_log_dir, "/data/rabbitmq/dc001/rabbit-mgmt"} ] },
>>  {rabbitmq_management_agent, [ {force_fine_statistics, true} ] }


>> [17:32] <dawgtool> background. doing some testing on 2.7.0 : 4 servers 2vcpu, 8gb ram, 80gb disc.
>> [17:32] <dawgtool> cluser is setup all disc, currently one exchange durable fanout
>> [17:33] <dawgtool> one queue also durable bind to the exchange.
>> [17:33] <dawgtool> i'm pushing about 5M records, payload is ~500bytes each record
>> [17:34] <dawgtool> rate is about 14k/s (which seems pretty slow)
>> [17:35] <dawgtool> but my problem is, I'm testing a case where they consumers are busy or unavailable, so the queues would be filling up.
>> [17:35] <dawgtool> even after slowing the publish rate to about 4k/s the mirrored queue does not complete on any of the clusters nodes other then master.
>> [17:37] <dawgtool> memory seems to be the biggest issue here, as the servers will grow passed the high water mark, and eventually crash one at a time.
>> [17:37] <dawgtool> once they are restarted, most servers in the cluster will have about 200k to 300k of messages in their queue
>> [17:40] <dawgtool> so question is, why is so much memory being consumed (on disk these records are about 5.5GB) RabbitMQ pushes to 7.9 real, 11.9 virtual (swapping).
>> [17:40] <dawgtool> why is the queue not stopping the publishers (RAM based clusters seem to stop the publisher until it can be spilled to disk)
>> [17:41] <dawgtool> Why is mirroring unreliable in this test.

From emile at rabbitmq.com  Tue Jan  3 14:33:20 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 14:33:20 +0000
Subject: [rabbitmq-discuss] Brining cluster node back up after stop
In-Reply-To: <CAAN_EDo3sO=WZX+5ePoc42Uid7xMy6iac_cvDCFK_fBc+TzJUA@mail.gmail.com>
References: <CAAN_EDo3sO=WZX+5ePoc42Uid7xMy6iac_cvDCFK_fBc+TzJUA@mail.gmail.com>
Message-ID: <4F0311B0.9090104@rabbitmq.com>

Hi Adam,

On 02/01/12 18:24, Adam Rabung wrote:
> Hello,
> I am investigating active/active clustering, using just my machine for
> now.  All is going well, but I'm having a hard time bringing up a node
> that I have previously stopped.  I believe the problem only happens
> when I restart a node that was a disk node when I stopped it.
> 
> startCluster script:
> https://gist.github.com/1551407
> 
> running startCluster:
> https://gist.github.com/1551429
> 
> After starting the cluster, I'm able to bring node 2 and 3 up and down
> with no problem, but node 1 does not come back up.
> https://gist.github.com/1551582
> 
> I realize this may just be a problem due to the fact that I have three
> nodes on one machine, but I am troubled by how little I understand
> from that error message :)

I've just repeated the same commands (using the latest version of
rabbitmq-server, rabbitmq-management and all their dependencies) which
did not produce the same error:

Error: {cannot_start_application,rabbitmq_management,...

This means the management plugin was unable to start. You could try to
recompile all the dependencies from scratch or disable the management
plugin temporarily.



-Emile

From michael.s.klishin at gmail.com  Tue Jan  3 14:34:56 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 3 Jan 2012 18:34:56 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.9.0.pre (beta) is
	released
Message-ID: <34392D5A-42AD-4DF7-9165-F54221B5181C@gmail.com>

Hi and Happy New Year,

amqp gem 0.9.0.pre ("beta") is released to rubygems.org [1]. This release is fully backwards compatible with 0.8.4 and
has two fixes:

 * :default_routing_key value is now respected by AMQP::Exchange#initialize and AMQP::Exchange#publish. This is a rarely used feature but we saw one project relying on it, so it is now supported again.
 * Automatic recovery mode [2] now works for publishers.

I believe the 2nd improvement alone is worth upgrading.
0.9.0 will be released after a few more backwards compatible beta releases but we encourage you to give it a try today.

Thank you and happy 2012.


1. https://rubygems.org/gems/amqp/versions/0.9.0.pre3
2. http://rubyamqp.info/articles/error_handling/#automatic_recovery

P.S.

I want to explain why there are 3 pre releases on rubygems.org. On January 1st rubygems.org had some issues that led me to believe pre1 wasn't published correctly, so I tried a couple more times throughout the day. Because re-publishing with the same version number is prohibited (and rightfully so), I had to bump versions.
It turns out all releases were successful, but indexing of gems (what makes `gem install` find the version you want) was several hours behind its regular schedule. By now it has caught up, which can be verified with

gem list -r --prerelease --versions amqp

So all 3 .pre releases are effectively the same but go ahead and run with 0.9.0.pre3.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From alexandru at rabbitmq.com  Tue Jan  3 14:41:57 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 3 Jan 2012 14:41:57 +0000
Subject: [rabbitmq-discuss] does rabbitmq server close connections?
In-Reply-To: <CAG2rwuPPsZ+90KZiK9xtinTR6Yeo3GiEwsmb6HBtp_di9Yhh+g@mail.gmail.com>
References: <CAG2rwuPPsZ+90KZiK9xtinTR6Yeo3GiEwsmb6HBtp_di9Yhh+g@mail.gmail.com>
Message-ID: <20120103144157.GB3191@southbank>

> With 100's of computers connected to rabbitmq with persistent connections,
> would this pose any problems?

Not unless you run out of free file handles.  On normal installations,
it should handle up to thousands of connections without difficulty.  You
could further configure it to support more connections.

> Does it time-out by default?

No.  Connections are not timed out.

> Why use a heartbeat?  Is it to re-establish if the heartbeat fails?

If the network fails between a client and the broker, and there's no
traffic between them at that point, both will think the connection is
still open, even though it isn't.  Heartbeats ensure that both broker
and client are notified fairly quickly if the connection fails.

> Would it be better for clients to close connections and only open a
> connection when necessary?

It depends on your use case.

> For reading messages we need persistent connections.
> But for writing, and I can see how we could potentially only open a
> connection to write a message when required.

For consuming messages *efficiently*, you need persistent connections.
If you only get messages very rarely, you could open a connection, poll
the broker with basic.get and then close the connection.  But, if you
need to consume a lot of messages, you probably want persistent
connections anyway.

Hope this helps.

Cheers,
Alex

On Thu, Dec 29, 2011 at 05:21:26PM -0500, S Ahmed wrote:
> With 100's of computers connected to rabbitmq with persistent connections,
> would this pose any problems?
> 
> Does it time-out by default?
> 
> Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
> 
> Would it be better for clients to close connections and only open a
> connection when necessary?
> 
> For reading messages we need persistent connections.
> 
> But for writing, and I can see how we could potentially only open a
> connection to write a message when required.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Tue Jan  3 14:46:33 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 3 Jan 2012 14:46:33 +0000
Subject: [rabbitmq-discuss] inspecting messages
In-Reply-To: <CAFcBufOzaCmKBXnz2hkTt3zFQ7GWxCc-cEKrMrZJpWdLWAjaNA@mail.gmail.com>
References: <CAFcBufOzaCmKBXnz2hkTt3zFQ7GWxCc-cEKrMrZJpWdLWAjaNA@mail.gmail.com>
Message-ID: <20120103144633.GC3191@southbank>

Hi Dmitry,

There's no way to inspect messages on a queue in AMQP or RabbitMQ.
There are a variety of ways to get messages (and then maybe requeue
them).  What are you trying to achieve?

Cheers,
Alex

On Wed, Dec 28, 2011 at 11:41:31AM -0800, Dmitry Beransky wrote:
> Hi,
> 
> Is there a way to inspect individual messages in a queue for content
> either with a tool or via API?
> 
> 
> Thanks
> Dmitry
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Tue Jan  3 14:52:15 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 3 Jan 2012 14:52:15 +0000
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.9.0.pre (beta) is
	released
In-Reply-To: <34392D5A-42AD-4DF7-9165-F54221B5181C@gmail.com>
References: <34392D5A-42AD-4DF7-9165-F54221B5181C@gmail.com>
Message-ID: <CACOPnve0HfX7Ujv5V4ef9pMPdtXA5zCjS3XNEwd8q+TN+C3U5g@mail.gmail.com>

Michael

Thank-you!

Let us know if you think the info on the rabbitmq.com web site needs
updating - it probably does!

alexis


On Tue, Jan 3, 2012 at 2:34 PM, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
> Hi and Happy New Year,
>
> amqp gem 0.9.0.pre ("beta") is released to rubygems.org [1]. This release is fully backwards compatible with 0.8.4 and
> has two fixes:
>
> ?* :default_routing_key value is now respected by AMQP::Exchange#initialize and AMQP::Exchange#publish. This is a rarely used feature but we saw one project relying on it, so it is now supported again.
> ?* Automatic recovery mode [2] now works for publishers.
>
> I believe the 2nd improvement alone is worth upgrading.
> 0.9.0 will be released after a few more backwards compatible beta releases but we encourage you to give it a try today.
>
> Thank you and happy 2012.
>
>
> 1. https://rubygems.org/gems/amqp/versions/0.9.0.pre3
> 2. http://rubyamqp.info/articles/error_handling/#automatic_recovery
>
> P.S.
>
> I want to explain why there are 3 pre releases on rubygems.org. On January 1st rubygems.org had some issues that led me to believe pre1 wasn't published correctly, so I tried a couple more times throughout the day. Because re-publishing with the same version number is prohibited (and rightfully so), I had to bump versions.
> It turns out all releases were successful, but indexing of gems (what makes `gem install` find the version you want) was several hours behind its regular schedule. By now it has caught up, which can be verified with
>
> gem list -r --prerelease --versions amqp
>
> So all 3 .pre releases are effectively the same but go ahead and run with 0.9.0.pre3.
>
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Tue Jan  3 15:00:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 15:00:14 +0000
Subject: [rabbitmq-discuss] active-active implementation in php
In-Reply-To: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
References: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
Message-ID: <4F0317FE.2050802@rabbitmq.com>

Hi Dhaneesh,

On 30/12/11 04:25, Dhaneesh Radhakrishnan wrote:
> Hi
> 
>  Is it possible to  implement Mirrored Queue ( active-active )using
> php-ampliqb  for
> HA

Judging by the queue_declare() function, php-amqplib does support
arguments, so it is possible to make use of mirrored queues using this
library.

See http://www.rabbitmq.com/ha.html for details on how to set the
"x-ha-policy" argument.



-Emile

From john.letourneau at alcatel-lucent.com  Tue Jan  3 15:01:04 2012
From: john.letourneau at alcatel-lucent.com (Letourneau, John P (John))
Date: Tue, 3 Jan 2012 09:01:04 -0600
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate Messages
Message-ID: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>

Hello group,
First a compliment - this software is great how it just works out of the box! I know it has taken you all a while to get it there, but it is much appreciated by newbies like myself.

In my research I have a need for federating several brokers together. So I have some experiments I have been doing to learn the ins and outs of how it all works. For now I have 3 systems each with 1 broker. The idea is this represents a hierarchy that is 3 deep [not very broad at the moment 8-) ]. In my experiments I am wanting a "shared bus" for logging. This means that for clients on any machine, messages to the federated log exchange will be seen on all other machines, including itself. As one might expect, this sometimes results in the message being seen >1 time at some clients.

I played around with the hop count, but that did not really solve any problems other than eventually stopping the forwarding of a given message...as it should. So I am starting to think of alternative configurations that can give me the behavior of 1 msg to a client, distributing the message to all nodes in the network, be efficient of course, and also minimize the knowledge required at each of the nodes/clients so as to allow easy administration as the network grows. I would hate to have to be reconfiguring existing clients and brokers each time a new node is added to grow the overall network.

I have thought of introducing 'flow-up' exchanges and other means of directing the flow up/down the tree...these mental gynastics lead me to duplicate messages or too much topology information being needed. I also considered routing rules where perhaps the node name is used as the first word in the route [node2.log.critical]...to work I would define an exchange/queue binding that did a match on everything EXCEPT my node. Alas I could not find anything that allowed 'not' matching part of a route. It is also likely that we may not settle on a tree hierarchy but may allow a graph so as to allow path duplication; but that decision is still open.

I've looked through all posts since June 22 to see what others are encountering with federation...sadly not too many people seem to be using it. So, is there any hope for me?

Thanks in advance...

John Letourneau,  DMTS   topgun at bell-labs.com

http://ect-bell-labs.com/who/topgun/
Applications Research Domain
Bell Labs

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/27e1eeff/attachment.htm>

From videlalvaro at gmail.com  Tue Jan  3 15:07:33 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 3 Jan 2012 16:07:33 +0100
Subject: [rabbitmq-discuss] active-active implementation in php
In-Reply-To: <4F0317FE.2050802@rabbitmq.com>
References: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
	<4F0317FE.2050802@rabbitmq.com>
Message-ID: <CAMcAHLWt7XnCBu7q4sA2PQNQ_xAx8gHMg2rWqgVH5-RWo4Pw-A@mail.gmail.com>

Hi,

Yes? it should support the arguments parameter.

BTW? I recommend that you use this version of the library:
https://github.com/videlalvaro/php-amqplib for the reasons stated here:
http://videlalvaro.github.com/2011/11/php-amqplib-future.html

Regards,

Alvaro

On Tue, Jan 3, 2012 at 4:00 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Dhaneesh,
>
> On 30/12/11 04:25, Dhaneesh Radhakrishnan wrote:
> > Hi
> >
> >  Is it possible to  implement Mirrored Queue ( active-active )using
> > php-ampliqb  for
> > HA
>
> Judging by the queue_declare() function, php-amqplib does support
> arguments, so it is possible to make use of mirrored queues using this
> library.
>
> See http://www.rabbitmq.com/ha.html for details on how to set the
> "x-ha-policy" argument.
>
>
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/ed83fe7c/attachment.htm>

From Simone.Busoli at ferrari.com  Tue Jan  3 15:22:58 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Tue, 3 Jan 2012 15:22:58 +0000
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate
	Messages
In-Reply-To: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
References: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520BDA65@GSVCLU03.ges.ferlan.it>

Hi John, I'm not sure about this:

As one might expect, this sometimes results in the message being seen >1 time at some clients.

It shouldn't be the expected behavior except for certain scenarios (i.e. disconnection of the brokers). Am I missing something perhaps?

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/acf1f153/attachment.htm>

From emile at rabbitmq.com  Tue Jan  3 15:40:55 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 15:40:55 +0000
Subject: [rabbitmq-discuss] Messaging using both ActiveMQ and RabbitMQ
In-Reply-To: <CAHrXUcV_w54s1QeWEkuwkHytZus=zqrOKbu--TEjVATkfzUGXw@mail.gmail.com>
References: <CAHrXUcV_w54s1QeWEkuwkHytZus=zqrOKbu--TEjVATkfzUGXw@mail.gmail.com>
Message-ID: <4F032187.2040201@rabbitmq.com>

Hi Iain,

On 21/12/11 14:59, Iain Emsley wrote:
> I've been experimenting with the STOMP plugin on Rabbit 2.7.0 on Ubuntu
> 10.10 virtual machine (assume IP of 1.2.3.4) and trying to get it to
> listen to an ActiveMQ broker on 1.2.3.5:61618 <http://1.2.3.5:61618>

A broker can't listen to another broker directly. You will need a bridge
between them. Your bridge could either speak STOMP to both; or AMQP to
RabbitMQ and JMS to ActiveMQ.

> (Ubuntu 10.10 virtual machine). Having set up the tcp_listener in
> rabbitmq.config  as {"1.2.3.5", 61618}, the broker replies with an
> "eaddrnotavail" as I was trying to get the Rabbit broker to listen to

"eaddrnotavail" means the port was busy. You can't have RabbitMQ and
ActiveMQ both listening on the same port.

> Is it possible to configure Rabbit in this way so that I can have
> standardise our system onto Rabbit? Or alternatively would I need to
> write a bridge to consume from Active and publish to Rabbit? Even then

Yes, a bridge is precisely the way to go about it.



-Emile


From emile at rabbitmq.com  Tue Jan  3 15:46:13 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 15:46:13 +0000
Subject: [rabbitmq-discuss] RabbitMQ Direct vs Topic exchange
 performance with simple routing keys
In-Reply-To: <004901ccc70a$8503c940$8f0b5bc0$@oryo.lt>
References: <004901ccc70a$8503c940$8f0b5bc0$@oryo.lt>
Message-ID: <4F0322C5.6040208@rabbitmq.com>

On 30/12/11 15:48, Andrius Norkaitis wrote:

> I have queue which should bind with several keys such as "ID1", "ID2" etc.
> and with complex key "Rounting.1.*"
> Should I use two different type of exchanges (direct and topic) or could
> just use single topic exchange?
> Will there be any performance differences?


From kolapoorna at gmail.com  Tue Jan  3 15:46:27 2012
From: kolapoorna at gmail.com (Poorna Chander Kola)
Date: Tue, 3 Jan 2012 15:46:27 +0000
Subject: [rabbitmq-discuss] Queue Size
Message-ID: <CABEsvMfbyPQPLyNNscZe=2NhxtsBhswDA7pp8WU=B=J-cCrCgA@mail.gmail.com>

Hi,

How we can find the phisical memory, the persistent queue is occupied on
disk. Please show some light on it. Thank you

-- 
Cheers
Poorna Chander Kola
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/9b17efa7/attachment.htm>

From msteele at beringmedia.com  Tue Jan  3 15:47:43 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Tue, 3 Jan 2012 10:47:43 -0500
Subject: [rabbitmq-discuss] does rabbitmq server close connections?
In-Reply-To: <20120103144157.GB3191@southbank>
References: <CAG2rwuPPsZ+90KZiK9xtinTR6Yeo3GiEwsmb6HBtp_di9Yhh+g@mail.gmail.com>
	<20120103144157.GB3191@southbank>
Message-ID: <CAH24rBONoy6YmJugja21d5APK0GMbQAA2Cud3+LR3RE5txNPaQ@mail.gmail.com>

We've been bitten by this with firewalls that close connections after idle
timeouts. Best solution I can come up with is to use TCP keepalives.

If you client supports setting TCP options during the connection, that's
all you need to do for the client side part. For the server side, I
couldn't find any options for this in the rabbit config, so we implemented
libkeepalive to force the server to use keepalives.

Rabbit folks, please add this as an option to the server.

Cheers,

Mark Steele, CISSP, CSM
Bering Media Inc.

On Tue, Jan 3, 2012 at 9:41 AM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> > With 100's of computers connected to rabbitmq with persistent
> connections,
> > would this pose any problems?
>
> Not unless you run out of free file handles.  On normal installations,
> it should handle up to thousands of connections without difficulty.  You
> could further configure it to support more connections.
>
> > Does it time-out by default?
>
> No.  Connections are not timed out.
>
> > Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
>
> If the network fails between a client and the broker, and there's no
> traffic between them at that point, both will think the connection is
> still open, even though it isn't.  Heartbeats ensure that both broker
> and client are notified fairly quickly if the connection fails.
>
> > Would it be better for clients to close connections and only open a
> > connection when necessary?
>
> It depends on your use case.
>
> > For reading messages we need persistent connections.
> > But for writing, and I can see how we could potentially only open a
> > connection to write a message when required.
>
> For consuming messages *efficiently*, you need persistent connections.
> If you only get messages very rarely, you could open a connection, poll
> the broker with basic.get and then close the connection.  But, if you
> need to consume a lot of messages, you probably want persistent
> connections anyway.
>
> Hope this helps.
>
> Cheers,
> Alex
>
> On Thu, Dec 29, 2011 at 05:21:26PM -0500, S Ahmed wrote:
> > With 100's of computers connected to rabbitmq with persistent
> connections,
> > would this pose any problems?
> >
> > Does it time-out by default?
> >
> > Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
> >
> > Would it be better for clients to close connections and only open a
> > connection when necessary?
> >
> > For reading messages we need persistent connections.
> >
> > But for writing, and I can see how we could potentially only open a
> > connection to write a message when required.
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/385f0ffa/attachment.htm>

From john.letourneau at alcatel-lucent.com  Tue Jan  3 15:51:23 2012
From: john.letourneau at alcatel-lucent.com (Letourneau, John P (John))
Date: Tue, 3 Jan 2012 09:51:23 -0600
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate
	Messages
In-Reply-To: <88E590DC4586974D825FC82AE798294E520BDA65@GSVCLU03.ges.ferlan.it>
References: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
	<88E590DC4586974D825FC82AE798294E520BDA65@GSVCLU03.ges.ferlan.it>
Message-ID: <5D476051A786C040BF0D9CB87BCBE3AA05975254A4@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>

Well, perhaps a bit more about my configuration 8-)
3 nodes...call them N1, N2, N3.
On each I have federation configured.
N2 - exchange log, connects to N1/log and N3/log
N3 - exchange log, connects to N2/log
Right now I cannot seem to have the N1 exchange log connect to N2/log; will need to find out why sometime.
I do it this way so that regardless of where the producer of the log message is, everyone everywhere will see it.

Each layer in the hierarchy only knows about nodes in adjacent layers...N2 being the busy one with a layer above and below.
If everyone has hops=1, sending a log message to N1/log will only go to N2 and not N3 [this is correct].
Setting hops=4, sending a log to N1/log will go to N2 and N3...it will also be returned to N2 thus a consumer on N2 will see the original msg AND the one sent via N2/N3 federation link. Also N3 sees it twice also for a total of once on N1, twice on N2, and twice on N3...the message took a total of 4 hops.

So, this is what I mean by 'one might expect' 8-)
-John

From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com]
Sent: Tuesday, January 03, 2012 10:23 AM
To: Letourneau, John P (John); rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: Federation Configuration and Duplicate Messages

Hi John, I'm not sure about this:

As one might expect, this sometimes results in the message being seen >1 time at some clients.

It shouldn't be the expected behavior except for certain scenarios (i.e. disconnection of the brokers). Am I missing something perhaps?

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
your system.
_________________________________________________________________________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/c8f94362/attachment.htm>

From emile at rabbitmq.com  Tue Jan  3 16:07:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 16:07:01 +0000
Subject: [rabbitmq-discuss] Queue Size
In-Reply-To: <CABEsvMfbyPQPLyNNscZe=2NhxtsBhswDA7pp8WU=B=J-cCrCgA@mail.gmail.com>
References: <CABEsvMfbyPQPLyNNscZe=2NhxtsBhswDA7pp8WU=B=J-cCrCgA@mail.gmail.com>
Message-ID: <4F0327A5.80104@rabbitmq.com>

Hi Poorna,

On 03/01/12 15:46, Poorna Chander Kola wrote:
> How we can find the phisical memory, the persistent queue is occupied on
> disk. Please show some light on it. Thank you

You can find out how much RAM a queue consumes with
"rabbitmqctl list_queues name memory".

You can get an idea of how many messages are on disk by calling
"rabbitmqctl list_queues name memory backing_queue_status"
and noting the "persistent_count" value. Bear in mind that this is not
part of the published interface, and it only provides a message count.




-Emile

From alexandru at rabbitmq.com  Tue Jan  3 16:06:20 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 3 Jan 2012 16:06:20 +0000
Subject: [rabbitmq-discuss] does rabbitmq server close connections?
In-Reply-To: <CAH24rBONoy6YmJugja21d5APK0GMbQAA2Cud3+LR3RE5txNPaQ@mail.gmail.com>
References: <CAG2rwuPPsZ+90KZiK9xtinTR6Yeo3GiEwsmb6HBtp_di9Yhh+g@mail.gmail.com>
	<20120103144157.GB3191@southbank>
	<CAH24rBONoy6YmJugja21d5APK0GMbQAA2Cud3+LR3RE5txNPaQ@mail.gmail.com>
Message-ID: <20120103160620.GG3191@southbank>

> We've been bitten by this with firewalls that close connections after idle
> timeouts. Best solution I can come up with is to use TCP keepalives.

Enabling heartbeats (when connecting with a client) didn't help?
(heartbeats are the AMQP equivalent of TCP keep-alives)

> If you client supports setting TCP options during the connection, that's
> all you need to do for the client side part. For the server side, I
> couldn't find any options for this in the rabbit config, so we implemented
> libkeepalive to force the server to use keepalives.
> 
> Rabbit folks, please add this as an option to the server.

I haven't tried, but I think you can enable keepalives in the
rabbitmq.config.  Just add a tcp_listen_options entry with {keepalive,
true}:

[
        {rabbit, [{tcp_listen_options, [{keepalive, true}]}]}
].

http://www.rabbitmq.com/configure.html#config-items

Wouldn't something like that work?

Cheers,
Alex

On Tue, Jan 03, 2012 at 10:47:43AM -0500, Mark Steele wrote:
> We've been bitten by this with firewalls that close connections after idle
> timeouts. Best solution I can come up with is to use TCP keepalives.
> 
> If you client supports setting TCP options during the connection, that's
> all you need to do for the client side part. For the server side, I
> couldn't find any options for this in the rabbit config, so we implemented
> libkeepalive to force the server to use keepalives.
> 
> Rabbit folks, please add this as an option to the server.
> 
> Cheers,
> 
> Mark Steele, CISSP, CSM
> Bering Media Inc.
> 
> On Tue, Jan 3, 2012 at 9:41 AM, Alexandru Scvor?ov
> <alexandru at rabbitmq.com>wrote:
> 
> > > With 100's of computers connected to rabbitmq with persistent
> > connections,
> > > would this pose any problems?
> >
> > Not unless you run out of free file handles.  On normal installations,
> > it should handle up to thousands of connections without difficulty.  You
> > could further configure it to support more connections.
> >
> > > Does it time-out by default?
> >
> > No.  Connections are not timed out.
> >
> > > Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
> >
> > If the network fails between a client and the broker, and there's no
> > traffic between them at that point, both will think the connection is
> > still open, even though it isn't.  Heartbeats ensure that both broker
> > and client are notified fairly quickly if the connection fails.
> >
> > > Would it be better for clients to close connections and only open a
> > > connection when necessary?
> >
> > It depends on your use case.
> >
> > > For reading messages we need persistent connections.
> > > But for writing, and I can see how we could potentially only open a
> > > connection to write a message when required.
> >
> > For consuming messages *efficiently*, you need persistent connections.
> > If you only get messages very rarely, you could open a connection, poll
> > the broker with basic.get and then close the connection.  But, if you
> > need to consume a lot of messages, you probably want persistent
> > connections anyway.
> >
> > Hope this helps.
> >
> > Cheers,
> > Alex
> >
> > On Thu, Dec 29, 2011 at 05:21:26PM -0500, S Ahmed wrote:
> > > With 100's of computers connected to rabbitmq with persistent
> > connections,
> > > would this pose any problems?
> > >
> > > Does it time-out by default?
> > >
> > > Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
> > >
> > > Would it be better for clients to close connections and only open a
> > > connection when necessary?
> > >
> > > For reading messages we need persistent connections.
> > >
> > > But for writing, and I can see how we could potentially only open a
> > > connection to write a message when required.
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >

From msteele at beringmedia.com  Tue Jan  3 16:16:20 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Tue, 3 Jan 2012 11:16:20 -0500
Subject: [rabbitmq-discuss] does rabbitmq server close connections?
In-Reply-To: <20120103160620.GG3191@southbank>
References: <CAG2rwuPPsZ+90KZiK9xtinTR6Yeo3GiEwsmb6HBtp_di9Yhh+g@mail.gmail.com>
	<20120103144157.GB3191@southbank>
	<CAH24rBONoy6YmJugja21d5APK0GMbQAA2Cud3+LR3RE5txNPaQ@mail.gmail.com>
	<20120103160620.GG3191@southbank>
Message-ID: <CAH24rBMARYYbar5U6yrrT3KPs-EddZoTx5RkxVivPw4AhGSOTQ@mail.gmail.com>

You're the expert, should it work? :)

I haven't tested that out, hadn't occurred to me to try.

On Tue, Jan 3, 2012 at 11:06 AM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> > We've been bitten by this with firewalls that close connections after
> idle
> > timeouts. Best solution I can come up with is to use TCP keepalives.
>
> Enabling heartbeats (when connecting with a client) didn't help?
> (heartbeats are the AMQP equivalent of TCP keep-alives)
>
> > If you client supports setting TCP options during the connection, that's
> > all you need to do for the client side part. For the server side, I
> > couldn't find any options for this in the rabbit config, so we
> implemented
> > libkeepalive to force the server to use keepalives.
> >
> > Rabbit folks, please add this as an option to the server.
>
> I haven't tried, but I think you can enable keepalives in the
> rabbitmq.config.  Just add a tcp_listen_options entry with {keepalive,
> true}:
>
> [
>        {rabbit, [{tcp_listen_options, [{keepalive, true}]}]}
> ].
>
> http://www.rabbitmq.com/configure.html#config-items
>
> Wouldn't something like that work?
>
> Cheers,
> Alex
>
> On Tue, Jan 03, 2012 at 10:47:43AM -0500, Mark Steele wrote:
> > We've been bitten by this with firewalls that close connections after
> idle
> > timeouts. Best solution I can come up with is to use TCP keepalives.
> >
> > If you client supports setting TCP options during the connection, that's
> > all you need to do for the client side part. For the server side, I
> > couldn't find any options for this in the rabbit config, so we
> implemented
> > libkeepalive to force the server to use keepalives.
> >
> > Rabbit folks, please add this as an option to the server.
> >
> > Cheers,
> >
> > Mark Steele, CISSP, CSM
> > Bering Media Inc.
> >
> > On Tue, Jan 3, 2012 at 9:41 AM, Alexandru Scvor?ov
> > <alexandru at rabbitmq.com>wrote:
> >
> > > > With 100's of computers connected to rabbitmq with persistent
> > > connections,
> > > > would this pose any problems?
> > >
> > > Not unless you run out of free file handles.  On normal installations,
> > > it should handle up to thousands of connections without difficulty.
>  You
> > > could further configure it to support more connections.
> > >
> > > > Does it time-out by default?
> > >
> > > No.  Connections are not timed out.
> > >
> > > > Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
> > >
> > > If the network fails between a client and the broker, and there's no
> > > traffic between them at that point, both will think the connection is
> > > still open, even though it isn't.  Heartbeats ensure that both broker
> > > and client are notified fairly quickly if the connection fails.
> > >
> > > > Would it be better for clients to close connections and only open a
> > > > connection when necessary?
> > >
> > > It depends on your use case.
> > >
> > > > For reading messages we need persistent connections.
> > > > But for writing, and I can see how we could potentially only open a
> > > > connection to write a message when required.
> > >
> > > For consuming messages *efficiently*, you need persistent connections.
> > > If you only get messages very rarely, you could open a connection, poll
> > > the broker with basic.get and then close the connection.  But, if you
> > > need to consume a lot of messages, you probably want persistent
> > > connections anyway.
> > >
> > > Hope this helps.
> > >
> > > Cheers,
> > > Alex
> > >
> > > On Thu, Dec 29, 2011 at 05:21:26PM -0500, S Ahmed wrote:
> > > > With 100's of computers connected to rabbitmq with persistent
> > > connections,
> > > > would this pose any problems?
> > > >
> > > > Does it time-out by default?
> > > >
> > > > Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
> > > >
> > > > Would it be better for clients to close connections and only open a
> > > > connection when necessary?
> > > >
> > > > For reading messages we need persistent connections.
> > > >
> > > > But for writing, and I can see how we could potentially only open a
> > > > connection to write a message when required.
> > >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/90029d6f/attachment.htm>

From chilversc at gmail.com  Tue Jan  3 16:27:45 2012
From: chilversc at gmail.com (Chris Chilvers)
Date: Tue, 3 Jan 2012 08:27:45 -0800 (PST)
Subject: [rabbitmq-discuss] Web Management for 2.6.1
Message-ID: <da7e544f-0e0c-4756-8101-b3bb821b0d54@n6g2000vbg.googlegroups.com>

What are the instructions for setting up the web management UI in
2.6.1?

I'm trying to set up the web management UI in Centos 6.2 from the EPEL
repository.

I've downloaded the following plugins from http://www.rabbitmq.com/releases/plugins/v2.6.1/
and placed them in /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/plugins
    amqp_client-2.6.1.ez
    rabbitmq_management-2.6.1.ez
    rabbitmq_management_agent-2.6.1.ez
    rabbitmq_mochiweb-2.6.1.ez
    webmachine-1.7.0-rmq2.6.1-hg0c4b60a.ez

However, when I try to start rabbitmq, it fails to start up. The last
3 lines displayed are:
    broker running
    ** Found 0 name clashes in code paths
    Erlang has closed

From aaron at agoragames.com  Tue Jan  3 16:42:07 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 3 Jan 2012 11:42:07 -0500
Subject: [rabbitmq-discuss] TTLs in 2.5.1
In-Reply-To: <4F02FB2C.9090904@rabbitmq.com>
References: <CAHiEoM7Ra=myY2DjF1pQ03PjXZ-RDg_CNZtiMx=SG476Nj-dZw@mail.gmail.com>
	<4F02FB2C.9090904@rabbitmq.com>
Message-ID: <CAHiEoM4oKLeGjdhNW4a9YZLgRK7KiKg7uGAGr5A8LWv=pE511w@mail.gmail.com>

Thank you Emile. We ended up with an application TTL because it was
easier to implement for our use case. In testing queue TTLs, I
observed that I did need to set QoS, else rabbit would stage a message
for delivery to a consumer and thus it no longer resided in the queue
to be expired.



On Tue, Jan 3, 2012 at 7:57 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Aaron,
>
> On 20/12/11 03:29, Aaron Westendorf wrote:
>> We're running Rabbit 2.5.1 in a 2 node cluster and need ?to implement
>> message TTLs to mitigate some pressing problems. If anyone could help
>> us out with some questions we have that would be most appreciated.
>>
>> Are they fully supported in this version?
>
> Yes, support for per-queue message TTL was introduced in rabbit 2.2.0.
>
>> If we're going to enable TTLs, is there a pressing need to upgrade or
>> can we stay on 2.5.1?
>
> We would always recommend running the latest version. In this case you
> do not need to upgrade specifically to get this feature.
>
>> Is there anything special to note about them in a 2.5.1 cluster?
>
> No. per-queue TTL is a queue-specific feature and queues exist only on a
> single node in a 2.5.1 cluster.
>
>> Do we need to turn on client qos, or will rabbit change its consumer
>> delivery rules on TTL'd messages?
>
> You do not need to set QoS for messages to expire.
>
>> Are there any recommended lower bounds on this value?
>
> This depends on your usage and hardware performance characteristics. You
> should test and validate in a comparable environment before deploying to
> production.
>
> A value larger than the average latency makes sense.
>
>> What kind of effect should we expect message TTL to have on resource
>> requirements?
>
> I would expect perhaps a small improvement since it is easier for the
> broker to expire a message than to deliver.
>
>> Will this significantly impact the memory footprint specifically?
>
> The effect would be similar to a consumer that works at the combined
> rate of the publishers.
>
>> Anything special about TTL in the case where rabbit is already under
>> very high load?
>
> From the perspective of the persistence layer message expiry is similar
> to message delivery. If your disk is a bottleneck then expiry is
> unlikely to help.
>
>
> Also see the notes here:
> http://www.rabbitmq.com/extensions.html#queue-ttl
>
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From emile at rabbitmq.com  Tue Jan  3 17:02:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jan 2012 17:02:52 +0000
Subject: [rabbitmq-discuss] Web Management for 2.6.1
In-Reply-To: <da7e544f-0e0c-4756-8101-b3bb821b0d54@n6g2000vbg.googlegroups.com>
References: <da7e544f-0e0c-4756-8101-b3bb821b0d54@n6g2000vbg.googlegroups.com>
Message-ID: <4F0334BC.3080903@rabbitmq.com>

Hi Chris,

On 03/01/12 16:27, Chris Chilvers wrote:
> What are the instructions for setting up the web management UI in
> 2.6.1?
> 
> I'm trying to set up the web management UI in Centos 6.2 from the EPEL
> repository.
> 
> I've downloaded the following plugins from http://www.rabbitmq.com/releases/plugins/v2.6.1/
> and placed them in /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/plugins
>     amqp_client-2.6.1.ez
>     rabbitmq_management-2.6.1.ez
>     rabbitmq_management_agent-2.6.1.ez
>     rabbitmq_mochiweb-2.6.1.ez
>     webmachine-1.7.0-rmq2.6.1-hg0c4b60a.ez
> 
> However, when I try to start rabbitmq, it fails to start up. The last
> 3 lines displayed are:
>     broker running
>     ** Found 0 name clashes in code paths
>     Erlang has closed

Is it possible that you missed out mochiweb?
(mochiweb-1.3-rmq2.6.1-git9a53dbd.ez)

I realise that the instructions have changed since 2.6.1 and the website
only contains instructions for the latest version.


-Emile

From chilversc at gmail.com  Tue Jan  3 17:21:48 2012
From: chilversc at gmail.com (Chris Chilvers)
Date: Tue, 3 Jan 2012 09:21:48 -0800 (PST)
Subject: [rabbitmq-discuss] Web Management for 2.6.1
In-Reply-To: <4F0334BC.3080903@rabbitmq.com>
References: <da7e544f-0e0c-4756-8101-b3bb821b0d54@n6g2000vbg.googlegroups.com>
	<4F0334BC.3080903@rabbitmq.com>
Message-ID: <2d5818d8-c6d0-4e70-87e2-08c3384ce096@t13g2000yqg.googlegroups.com>

Ah yes, I did miss that file.

Odd, all the other missing files would complain before the server even
started up about missing X. Which is how I was working out what the
dependencies were.

On Jan 3, 5:02?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Chris,
>
> On 03/01/12 16:27, Chris Chilvers wrote:
>
>
>
>
>
>
>
>
>
> > What are the instructions for setting up the web management UI in
> > 2.6.1?
>
> > I'm trying to set up the web management UI in Centos 6.2 from the EPEL
> > repository.
>
> > I've downloaded the following plugins fromhttp://www.rabbitmq.com/releases/plugins/v2.6.1/
> > and placed them in /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/plugins
> > ? ? amqp_client-2.6.1.ez
> > ? ? rabbitmq_management-2.6.1.ez
> > ? ? rabbitmq_management_agent-2.6.1.ez
> > ? ? rabbitmq_mochiweb-2.6.1.ez
> > ? ? webmachine-1.7.0-rmq2.6.1-hg0c4b60a.ez
>
> > However, when I try to start rabbitmq, it fails to start up. The last
> > 3 lines displayed are:
> > ? ? broker running
> > ? ? ** Found 0 name clashes in code paths
> > ? ? Erlang has closed
>
> Is it possible that you missed out mochiweb?
> (mochiweb-1.3-rmq2.6.1-git9a53dbd.ez)
>
> I realise that the instructions have changed since 2.6.1 and the website
> only contains instructions for the latest version.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From awilliam at whitemice.org  Tue Jan  3 17:52:31 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Tue, 03 Jan 2012 12:52:31 -0500
Subject: [rabbitmq-discuss] Web Management for 2.6.1
In-Reply-To: <4F0334BC.3080903@rabbitmq.com>
References: <da7e544f-0e0c-4756-8101-b3bb821b0d54@n6g2000vbg.googlegroups.com>
	<4F0334BC.3080903@rabbitmq.com>
Message-ID: <1325613151.3291.4.camel@linux-dauq.site>

On Tue, 2012-01-03 at 17:02 +0000, Emile Joubert wrote:
> On 03/01/12 16:27, Chris Chilvers wrote:
> > What are the instructions for setting up the web management UI in
> > 2.6.1?
> > I'm trying to set up the web management UI in Centos 6.2 from the EPEL
> > repository.
> > I've downloaded the following plugins from http://www.rabbitmq.com/releases/plugins/v2.6.1/
> > and placed them in /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/plugins
> >     amqp_client-2.6.1.ez
> >     rabbitmq_management-2.6.1.ez
> >     rabbitmq_management_agent-2.6.1.ez
> >     rabbitmq_mochiweb-2.6.1.ez
> >     webmachine-1.7.0-rmq2.6.1-hg0c4b60a.ez
> > However, when I try to start rabbitmq, it fails to start up. The last
> > 3 lines displayed are:
> >     broker running
> >     ** Found 0 name clashes in code paths
> >     Erlang has closed

What plugins does the "rabbitmq-plugins" command list as
available/installed?
-- 
System & Network Administrator [ LPI & NCLA ]
<http://www.whitemiceconsulting.com>
OpenGroupware Developer <http://www.opengroupware.us>
Adam Tauno Williams


From joseph.a.marlin at gmail.com  Tue Jan  3 17:53:53 2012
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Tue, 3 Jan 2012 09:53:53 -0800 (PST)
Subject: [rabbitmq-discuss] AMPQ Info Script Added to Nmap
Message-ID: <21841325.862.1325613233770.JavaMail.geo-discussion-forums@vbw20>

Just a fun fact for you, in case you ever find it useful: A new version of 
NMAP was just released today, and it includes a script called amqp-info 
which gathers a list of server properties from an AMQP server.

Here is an example output from a scan I ran on one of our test nodes:

Nmap scan report for target
Host is up (0.00092s latency).
PORT     STATE SERVICE
5672/tcp open  amqp
| amqp-info: 
|   capabilities: 
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2011 VMware, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 2.5.1
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US

Nmap done: 1 IP address (1 host up) scanned in 0.10 seconds

More info: http://seclists.org/nmap-dev/2012/q1/23
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/ba8020c8/attachment.htm>

From dmitry.maven at gmail.com  Tue Jan  3 18:39:57 2012
From: dmitry.maven at gmail.com (Dmitry Beransky)
Date: Tue, 3 Jan 2012 10:39:57 -0800
Subject: [rabbitmq-discuss] inspecting messages
In-Reply-To: <20120103144633.GC3191@southbank>
References: <CAFcBufOzaCmKBXnz2hkTt3zFQ7GWxCc-cEKrMrZJpWdLWAjaNA@mail.gmail.com>
	<20120103144633.GC3191@southbank>
Message-ID: <CAFcBufNb0aBh0wmGjzi8_ZvTAvkN_q-LfYQ8yqmdi3cg9rsC1w@mail.gmail.com>

This is for debugging purposes.  Our queue has grown all of a sudden
from a few hundred thousand to several million messages and it doesn't
seem to be getting any smaller.  The messages are various celery
tasks.  The logs don't show anything abnormal, so I wanted to inspect
messages for content to try to figure out what's going on.  I'd need
to do this without disturbing the queue (without re-queuing that is).


Thanks
D.

On Tue, Jan 3, 2012 at 6:46 AM, Alexandru Scvor?ov
<alexandru at rabbitmq.com> wrote:
> Hi Dmitry,
>
> There's no way to inspect messages on a queue in AMQP or RabbitMQ.
> There are a variety of ways to get messages (and then maybe requeue
> them). ?What are you trying to achieve?
>
> Cheers,
> Alex
>
> On Wed, Dec 28, 2011 at 11:41:31AM -0800, Dmitry Beransky wrote:
>> Hi,
>>
>> Is there a way to inspect individual messages in a queue for content
>> either with a tool or via API?
>>
>>
>> Thanks
>> Dmitry
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Tue Jan  3 18:52:38 2012
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 3 Jan 2012 12:52:38 -0600
Subject: [rabbitmq-discuss] "How do I...?"
In-Reply-To: <CAM8fPiRpnXiqhFX3ach7W_qhf0uqav9EHZ750X3dOrRHUA-qqA@mail.gmail.com>
References: <CAM8fPiRpnXiqhFX3ach7W_qhf0uqav9EHZ750X3dOrRHUA-qqA@mail.gmail.com>
Message-ID: <CAJreXKCcuf=po_AmtnJ8hWnMdcALP1y0Jv6D-fsertxcJoZHtA@mail.gmail.com>

When I get home I'll try to send out that excel spreadsheet I put
together for a failed RabbitMQ Recipes book proposal. I had at least
70 "How Do I...?" questions on it.

I backed away from the proposal because I realized I had tempered my
knowledge with much real world experience but plan to get back to
eventually. :)

Thanks,
James

On Wed, Dec 21, 2011 at 12:30 PM, Tony Garnock-Jones
<tonygarnockjones+rabbitmq at gmail.com> wrote:
> Hi all,
>
> What questions should go on a "How do I ... with RabbitMQ?" page on the
> Rabbit website?
>
> I'm imagining both basic low-level how-tos as well as higher-level best
> practices for achieving a certain result. Essentially describing a few use
> cases for messaging in general.
>
> I can think of a few examples to kick things off:
>
> How do I prioritize delivery of some messages over others with RabbitMQ? (A:
> Take Doug Barth's approach, or some variation of it)
> How do I queue up tasks for later processing with RabbitMQ? (A: Use celery
> perhaps? Plenty of approaches to roll-your-own too)
> How do I send email from a RabbitMQ queue?
> How do I receive messages from HTTP POSTs into a RabbitMQ exchange?
> How do I push messages to the browser using RabbitMQ?
> How do I connect to RabbitMQ from iOS devices?
>
> The "Going Further" section of the existing how.html page has some good
> things on it. I'm sure some of the other links on that page could be
> presented in more general "How do I...?" terms, too. What else am I missing?
>
> Cheers,
> ? Tony
>
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Tue Jan  3 19:03:26 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 3 Jan 2012 19:03:26 +0000
Subject: [rabbitmq-discuss] "How do I...?"
In-Reply-To: <CAJreXKCcuf=po_AmtnJ8hWnMdcALP1y0Jv6D-fsertxcJoZHtA@mail.gmail.com>
References: <CAM8fPiRpnXiqhFX3ach7W_qhf0uqav9EHZ750X3dOrRHUA-qqA@mail.gmail.com>
	<CAJreXKCcuf=po_AmtnJ8hWnMdcALP1y0Jv6D-fsertxcJoZHtA@mail.gmail.com>
Message-ID: <CACOPnvfe-88cZPB0JR3UnvKpaqJsNisvA8DOdkkoGhSuMc=z0w@mail.gmail.com>

That would be very cool.



On Tue, Jan 3, 2012 at 6:52 PM, James Carr <james.r.carr at gmail.com> wrote:
> When I get home I'll try to send out that excel spreadsheet I put
> together for a failed RabbitMQ Recipes book proposal. I had at least
> 70 "How Do I...?" questions on it.
>
> I backed away from the proposal because I realized I had tempered my
> knowledge with much real world experience but plan to get back to
> eventually. :)
>
> Thanks,
> James
>
> On Wed, Dec 21, 2011 at 12:30 PM, Tony Garnock-Jones
> <tonygarnockjones+rabbitmq at gmail.com> wrote:
>> Hi all,
>>
>> What questions should go on a "How do I ... with RabbitMQ?" page on the
>> Rabbit website?
>>
>> I'm imagining both basic low-level how-tos as well as higher-level best
>> practices for achieving a certain result. Essentially describing a few use
>> cases for messaging in general.
>>
>> I can think of a few examples to kick things off:
>>
>> How do I prioritize delivery of some messages over others with RabbitMQ? (A:
>> Take Doug Barth's approach, or some variation of it)
>> How do I queue up tasks for later processing with RabbitMQ? (A: Use celery
>> perhaps? Plenty of approaches to roll-your-own too)
>> How do I send email from a RabbitMQ queue?
>> How do I receive messages from HTTP POSTs into a RabbitMQ exchange?
>> How do I push messages to the browser using RabbitMQ?
>> How do I connect to RabbitMQ from iOS devices?
>>
>> The "Going Further" section of the existing how.html page has some good
>> things on it. I'm sure some of the other links on that page could be
>> presented in more general "How do I...?" terms, too. What else am I missing?
>>
>> Cheers,
>> ? Tony
>>
>> --
>> Tony Garnock-Jones
>> tonygarnockjones at gmail.com
>> http://homepages.kcbbs.gen.nz/tonyg/
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jared.biel at bolderthinking.com  Tue Jan  3 19:40:59 2012
From: jared.biel at bolderthinking.com (Jared Biel)
Date: Tue, 3 Jan 2012 13:40:59 -0600
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>
	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
Message-ID: <CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>

Hi Steve,

Thanks for the reply. It appears that the nmap/mercurial/git errors
don't stop the build process as they're not crucial to the build. I
believe the show stopping error is an erlang compile error:

erlc -Wall +debug_info -I eldap-wrapper/eldap-git/generated -o
eldap-wrapper/eldap-git/generated
eldap-wrapper/eldap-git/src/ELDAPv3.asn
Compiler function asn1ct:compile_asn/3 failed:
{undef,[{asn1ct,compile_asn,

["/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/src/ELDAPv3",

"/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated/ELDAPv3",

{options,["/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated"],

"/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated",
                          undefined,[],999,false,999,
                          [debug_info],
                          [],
                          "/tmp/buildd/rabbitmq-server-2.7.1/plugins-src"}]},
        {erl_compile,compile_file,4},
        {erl_compile,compile3,3},
        {erl_compile,compiler_runner,1}]}

However, we don't use eldap so I decided to rip it out of the plugins
folder and make sure nothing attempted to build it. I got a little
farther then got an error with while building erlang-rfc4627-wrapper
(full output http://pastebin.com/raw.php?i=taEW7Xpr). At this point I
decided to go Kill Bill on the plugins directory and pared it down to
just the following: erlando, rabbitmq-auth-mechanism-ssl,
rabbitmq-erlang-client, rabbitmq-external-exchange,
rabbitmq-federation, rabbitmq-ha-test, rabbitmq-metronome,
rabbitmq-shovel, rabbitmq-stomp, rabbitmq-toke, toke. After this I was
able to successfully build using pbuilder.

It seems that some of the plugins have erlc issues while building. We
don't use many plugins (yet) so it isn't a problem for us. However I'm
curious as to the method/build environment used for the official
packages at rabbitmq.com/debian.

Thanks,
Jared

On Tue, Jan 3, 2012 at 04:17, Steve Powell <steve at rabbitmq.com> wrote:
> Hi Jared,
>
> I'm afraid I'm not familiar with pbuilder, but rather than just ignore your
> note I looked at the output.
>
> There seem to be several puzzling things here:
>
> one is that dpkg complains about several packages not being installed:
>> Unpacking pbuilder-satisfydepends-dummy (from .../pbuilder-satisfydepends-dummy.deb) ...
>> dpkg: dependency problems prevent configuration of pbuilder-satisfydepends-dummy:
>> ?pbuilder-satisfydepends-dummy depends on cdbs; however:
>> ? Package cdbs is not installed.
>> ?pbuilder-satisfydepends-dummy depends on debhelper (>= 5); however:
>> ? Package debhelper is not installed.
>> ?pbuilder-satisfydepends-dummy depends on erlang-dev; however:
>> ? Package erlang-dev is not installed.
>> ?pbuilder-satisfydepends-dummy depends on python-simplejson; however:
>> ? Package python-simplejson is not installed.
>> ?pbuilder-satisfydepends-dummy depends on xmlto; however:
>> ? Package xmlto is not installed.
>> ?pbuilder-satisfydepends-dummy depends on xsltproc; however:
>> ? Package xsltproc is not installed.
>> dpkg: error processing pbuilder-satisfydepends-dummy (--install):
>> ?dependency problems - leaving unconfigured
> though this looks as though to be corrected subsequently...I cannot interpret
> this...
>
> second, there is an nmap missing complaint at three places (not sure why
> you would be calling nmap here, though I see we have a ref to it in
> rabbitmq_auth_backend_ldap's package.mk file)
> e.g.:
>> make[2]: Entering directory `/tmp/buildd/rabbitmq-server-2.7.1/plugins-src'
>> make -f all-packages.mk clean-all-packages
>> /bin/sh: nmap: not found
>
> third, make ... clean in rabbit appears to fail strangely:
>> make -C ./rabbitmq-server clean
>> make: Entering an unknown directory
>> make: *** ./rabbitmq-server: No such file or directory. ?Stop.
>> make: Leaving an unknown directory
>> make[3]: *** [rabbitmq-server+clean] Error 2
>> make[3]: Target `clean-all-packages' not remade because of errors.
> which looks suspicious. ?It could imply a make problem... (note that this
> follows the rm -rf commands for mochiweb-wrapper and eldap-wrapper stuff)
>
> fourth, it appears some git repository structures don't exist, or are corrupt:
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=./mochiweb-wrapper/mochiweb-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >mochiweb-wrapper/build/hash.mk
>> fatal: Not a git repository: './mochiweb-wrapper/mochiweb-git/.git'
> and
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=erlang-rfc4627-wrapper/erlang-rfc4627-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >erlang-rfc4627-wrapper/build/hash.mk
>> fatal: Not a git repository: 'erlang-rfc4627-wrapper/erlang-rfc4627-git/.git'
> and
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=eldap-wrapper/eldap-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >eldap-wrapper/build/hash.mk
>> fatal: Not a git repository: 'eldap-wrapper/eldap-git/.git'
> again, I'm not sure why this might be but not getting the erlang patch would
> explain the compiler error:
>> Compiler function asn1ct:compile_asn/3 failed:
>> {undef,[{asn1ct,compile_asn,
>> ? ? ....
>
> and finally:
>> echo UPSTREAM_SHORT_HASH:=`hg id -R ./webmachine-wrapper/webmachine-hg -i | cut -c -7` >webmachine-wrapper/build/hash.mk
>> /bin/sh: hg: not found
>
> implies that you don't have mercurial installed, which might be a problem.
>
> I'm sure you could have found these things by yourself, but I hope one or
> more of these trigger some ideas for you to try.
>
> Steve Powell ?(a puzzled bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 31 Dec 2011, at 00:49, Jared Biel wrote:
>
>> Hello,
>>
>> We make use of the .dsc .diff and .orig.tgz files present in your apt
>> repo located at http://rabbitmq.com/debian to perform some
>> modifications and rebuild using pbuilder. I have been unable to
>> successfully build a package since 2.7.0 because it fails to compile
>> one of the plugins (eldap-wrapper.) It appears to die with
>> "do-package.mk:507: *** Failed to produce eldap-wrapper/build/deps.mk.
>> ?Stop."
>>
>> Please see the full output of pbuilder here:
>> http://pastebin.com/raw.php?i=TdnDfaPJ
>>
>> The only modification that I'm performing is changing -sname to -name
>> in all files where it's present. This worked prior to 2.7.0 (when the
>> plugins weren't included in the main source.)
>>
>> Thanks for your help,
>> Jared
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jared.biel at bolderthinking.com  Tue Jan  3 19:41:30 2012
From: jared.biel at bolderthinking.com (Jared Biel)
Date: Tue, 3 Jan 2012 13:41:30 -0600
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>
	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
Message-ID: <CAHoS6UaLbQwns4znQBmCziuzTv0myu+5swNNRfLzLUf2dfGrzw@mail.gmail.com>

Hi Steve,

Thanks for the reply. It appears that the nmap/mercurial/git errors
don't stop the build process as they're not crucial to the build. I
believe the show stopping error is an erlang compile error:

erlc -Wall +debug_info -I eldap-wrapper/eldap-git/generated -o
eldap-wrapper/eldap-git/generated
eldap-wrapper/eldap-git/src/ELDAPv3.asn
Compiler function asn1ct:compile_asn/3 failed:
{undef,[{asn1ct,compile_asn,

["/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/src/ELDAPv3",

"/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated/ELDAPv3",

{options,["/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated"],

"/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated",
                          undefined,[],999,false,999,
                          [debug_info],
                          [],
                          "/tmp/buildd/rabbitmq-server-2.7.1/plugins-src"}]},
        {erl_compile,compile_file,4},
        {erl_compile,compile3,3},
        {erl_compile,compiler_runner,1}]}

However, we don't use eldap so I decided to rip it out of the plugins
folder and make sure nothing attempted to build it. I got a little
farther then got an error with while building erlang-rfc4627-wrapper
(full output http://pastebin.com/raw.php?i=taEW7Xpr). At this point I
decided to go Kill Bill on the plugins directory and pared it down to
just the following: erlando, rabbitmq-auth-mechanism-ssl,
rabbitmq-erlang-client, rabbitmq-external-exchange,
rabbitmq-federation, rabbitmq-ha-test, rabbitmq-metronome,
rabbitmq-shovel, rabbitmq-stomp, rabbitmq-toke, toke. After this I was
able to successfully build using pbuilder.

It seems that some of the plugins have erlc issues while building. We
don't use many plugins (yet) so it isn't a problem for us. However I'm
curious as to the method/build environment used for the official
packages at rabbitmq.com/debian.

Thanks,
Jared

On Tue, Jan 3, 2012 at 04:17, Steve Powell <steve at rabbitmq.com> wrote:
> Hi Jared,
>
> I'm afraid I'm not familiar with pbuilder, but rather than just ignore your
> note I looked at the output.
>
> There seem to be several puzzling things here:
>
> one is that dpkg complains about several packages not being installed:
>> Unpacking pbuilder-satisfydepends-dummy (from .../pbuilder-satisfydepends-dummy.deb) ...
>> dpkg: dependency problems prevent configuration of pbuilder-satisfydepends-dummy:
>> ?pbuilder-satisfydepends-dummy depends on cdbs; however:
>> ? Package cdbs is not installed.
>> ?pbuilder-satisfydepends-dummy depends on debhelper (>= 5); however:
>> ? Package debhelper is not installed.
>> ?pbuilder-satisfydepends-dummy depends on erlang-dev; however:
>> ? Package erlang-dev is not installed.
>> ?pbuilder-satisfydepends-dummy depends on python-simplejson; however:
>> ? Package python-simplejson is not installed.
>> ?pbuilder-satisfydepends-dummy depends on xmlto; however:
>> ? Package xmlto is not installed.
>> ?pbuilder-satisfydepends-dummy depends on xsltproc; however:
>> ? Package xsltproc is not installed.
>> dpkg: error processing pbuilder-satisfydepends-dummy (--install):
>> ?dependency problems - leaving unconfigured
> though this looks as though to be corrected subsequently...I cannot interpret
> this...
>
> second, there is an nmap missing complaint at three places (not sure why
> you would be calling nmap here, though I see we have a ref to it in
> rabbitmq_auth_backend_ldap's package.mk file)
> e.g.:
>> make[2]: Entering directory `/tmp/buildd/rabbitmq-server-2.7.1/plugins-src'
>> make -f all-packages.mk clean-all-packages
>> /bin/sh: nmap: not found
>
> third, make ... clean in rabbit appears to fail strangely:
>> make -C ./rabbitmq-server clean
>> make: Entering an unknown directory
>> make: *** ./rabbitmq-server: No such file or directory. ?Stop.
>> make: Leaving an unknown directory
>> make[3]: *** [rabbitmq-server+clean] Error 2
>> make[3]: Target `clean-all-packages' not remade because of errors.
> which looks suspicious. ?It could imply a make problem... (note that this
> follows the rm -rf commands for mochiweb-wrapper and eldap-wrapper stuff)
>
> fourth, it appears some git repository structures don't exist, or are corrupt:
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=./mochiweb-wrapper/mochiweb-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >mochiweb-wrapper/build/hash.mk
>> fatal: Not a git repository: './mochiweb-wrapper/mochiweb-git/.git'
> and
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=erlang-rfc4627-wrapper/erlang-rfc4627-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >erlang-rfc4627-wrapper/build/hash.mk
>> fatal: Not a git repository: 'erlang-rfc4627-wrapper/erlang-rfc4627-git/.git'
> and
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=eldap-wrapper/eldap-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >eldap-wrapper/build/hash.mk
>> fatal: Not a git repository: 'eldap-wrapper/eldap-git/.git'
> again, I'm not sure why this might be but not getting the erlang patch would
> explain the compiler error:
>> Compiler function asn1ct:compile_asn/3 failed:
>> {undef,[{asn1ct,compile_asn,
>> ? ? ....
>
> and finally:
>> echo UPSTREAM_SHORT_HASH:=`hg id -R ./webmachine-wrapper/webmachine-hg -i | cut -c -7` >webmachine-wrapper/build/hash.mk
>> /bin/sh: hg: not found
>
> implies that you don't have mercurial installed, which might be a problem.
>
> I'm sure you could have found these things by yourself, but I hope one or
> more of these trigger some ideas for you to try.
>
> Steve Powell ?(a puzzled bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 31 Dec 2011, at 00:49, Jared Biel wrote:
>
>> Hello,
>>
>> We make use of the .dsc .diff and .orig.tgz files present in your apt
>> repo located at http://rabbitmq.com/debian to perform some
>> modifications and rebuild using pbuilder. I have been unable to
>> successfully build a package since 2.7.0 because it fails to compile
>> one of the plugins (eldap-wrapper.) It appears to die with
>> "do-package.mk:507: *** Failed to produce eldap-wrapper/build/deps.mk.
>> ?Stop."
>>
>> Please see the full output of pbuilder here:
>> http://pastebin.com/raw.php?i=TdnDfaPJ
>>
>> The only modification that I'm performing is changing -sname to -name
>> in all files where it's present. This worked prior to 2.7.0 (when the
>> plugins weren't included in the main source.)
>>
>> Thanks for your help,
>> Jared
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jared.biel at bolderthinking.com  Tue Jan  3 19:40:59 2012
From: jared.biel at bolderthinking.com (Jared Biel)
Date: Tue, 3 Jan 2012 13:40:59 -0600
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>
	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
Message-ID: <CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>

Hi Steve,

Thanks for the reply. It appears that the nmap/mercurial/git errors
don't stop the build process as they're not crucial to the build. I
believe the show stopping error is an erlang compile error:

erlc -Wall +debug_info -I eldap-wrapper/eldap-git/generated -o
eldap-wrapper/eldap-git/generated
eldap-wrapper/eldap-git/src/ELDAPv3.asn
Compiler function asn1ct:compile_asn/3 failed:
{undef,[{asn1ct,compile_asn,

["/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/src/ELDAPv3",

"/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated/ELDAPv3",

{options,["/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated"],

"/tmp/buildd/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated",
                          undefined,[],999,false,999,
                          [debug_info],
                          [],
                          "/tmp/buildd/rabbitmq-server-2.7.1/plugins-src"}]},
        {erl_compile,compile_file,4},
        {erl_compile,compile3,3},
        {erl_compile,compiler_runner,1}]}

However, we don't use eldap so I decided to rip it out of the plugins
folder and make sure nothing attempted to build it. I got a little
farther then got an error with while building erlang-rfc4627-wrapper
(full output http://pastebin.com/raw.php?i=taEW7Xpr). At this point I
decided to go Kill Bill on the plugins directory and pared it down to
just the following: erlando, rabbitmq-auth-mechanism-ssl,
rabbitmq-erlang-client, rabbitmq-external-exchange,
rabbitmq-federation, rabbitmq-ha-test, rabbitmq-metronome,
rabbitmq-shovel, rabbitmq-stomp, rabbitmq-toke, toke. After this I was
able to successfully build using pbuilder.

It seems that some of the plugins have erlc issues while building. We
don't use many plugins (yet) so it isn't a problem for us. However I'm
curious as to the method/build environment used for the official
packages at rabbitmq.com/debian.

Thanks,
Jared

On Tue, Jan 3, 2012 at 04:17, Steve Powell <steve at rabbitmq.com> wrote:
> Hi Jared,
>
> I'm afraid I'm not familiar with pbuilder, but rather than just ignore your
> note I looked at the output.
>
> There seem to be several puzzling things here:
>
> one is that dpkg complains about several packages not being installed:
>> Unpacking pbuilder-satisfydepends-dummy (from .../pbuilder-satisfydepends-dummy.deb) ...
>> dpkg: dependency problems prevent configuration of pbuilder-satisfydepends-dummy:
>> ?pbuilder-satisfydepends-dummy depends on cdbs; however:
>> ? Package cdbs is not installed.
>> ?pbuilder-satisfydepends-dummy depends on debhelper (>= 5); however:
>> ? Package debhelper is not installed.
>> ?pbuilder-satisfydepends-dummy depends on erlang-dev; however:
>> ? Package erlang-dev is not installed.
>> ?pbuilder-satisfydepends-dummy depends on python-simplejson; however:
>> ? Package python-simplejson is not installed.
>> ?pbuilder-satisfydepends-dummy depends on xmlto; however:
>> ? Package xmlto is not installed.
>> ?pbuilder-satisfydepends-dummy depends on xsltproc; however:
>> ? Package xsltproc is not installed.
>> dpkg: error processing pbuilder-satisfydepends-dummy (--install):
>> ?dependency problems - leaving unconfigured
> though this looks as though to be corrected subsequently...I cannot interpret
> this...
>
> second, there is an nmap missing complaint at three places (not sure why
> you would be calling nmap here, though I see we have a ref to it in
> rabbitmq_auth_backend_ldap's package.mk file)
> e.g.:
>> make[2]: Entering directory `/tmp/buildd/rabbitmq-server-2.7.1/plugins-src'
>> make -f all-packages.mk clean-all-packages
>> /bin/sh: nmap: not found
>
> third, make ... clean in rabbit appears to fail strangely:
>> make -C ./rabbitmq-server clean
>> make: Entering an unknown directory
>> make: *** ./rabbitmq-server: No such file or directory. ?Stop.
>> make: Leaving an unknown directory
>> make[3]: *** [rabbitmq-server+clean] Error 2
>> make[3]: Target `clean-all-packages' not remade because of errors.
> which looks suspicious. ?It could imply a make problem... (note that this
> follows the rm -rf commands for mochiweb-wrapper and eldap-wrapper stuff)
>
> fourth, it appears some git repository structures don't exist, or are corrupt:
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=./mochiweb-wrapper/mochiweb-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >mochiweb-wrapper/build/hash.mk
>> fatal: Not a git repository: './mochiweb-wrapper/mochiweb-git/.git'
> and
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=erlang-rfc4627-wrapper/erlang-rfc4627-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >erlang-rfc4627-wrapper/build/hash.mk
>> fatal: Not a git repository: 'erlang-rfc4627-wrapper/erlang-rfc4627-git/.git'
> and
>> echo UPSTREAM_SHORT_HASH:=`git --git-dir=eldap-wrapper/eldap-git/.git log -n 1 HEAD | grep commit | cut -b 8-14` >eldap-wrapper/build/hash.mk
>> fatal: Not a git repository: 'eldap-wrapper/eldap-git/.git'
> again, I'm not sure why this might be but not getting the erlang patch would
> explain the compiler error:
>> Compiler function asn1ct:compile_asn/3 failed:
>> {undef,[{asn1ct,compile_asn,
>> ? ? ....
>
> and finally:
>> echo UPSTREAM_SHORT_HASH:=`hg id -R ./webmachine-wrapper/webmachine-hg -i | cut -c -7` >webmachine-wrapper/build/hash.mk
>> /bin/sh: hg: not found
>
> implies that you don't have mercurial installed, which might be a problem.
>
> I'm sure you could have found these things by yourself, but I hope one or
> more of these trigger some ideas for you to try.
>
> Steve Powell ?(a puzzled bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 31 Dec 2011, at 00:49, Jared Biel wrote:
>
>> Hello,
>>
>> We make use of the .dsc .diff and .orig.tgz files present in your apt
>> repo located at http://rabbitmq.com/debian to perform some
>> modifications and rebuild using pbuilder. I have been unable to
>> successfully build a package since 2.7.0 because it fails to compile
>> one of the plugins (eldap-wrapper.) It appears to die with
>> "do-package.mk:507: *** Failed to produce eldap-wrapper/build/deps.mk.
>> ?Stop."
>>
>> Please see the full output of pbuilder here:
>> http://pastebin.com/raw.php?i=TdnDfaPJ
>>
>> The only modification that I'm performing is changing -sname to -name
>> in all files where it's present. This worked prior to 2.7.0 (when the
>> plugins weren't included in the main source.)
>>
>> Thanks for your help,
>> Jared
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jruiz at johnruiz.com  Tue Jan  3 19:42:26 2012
From: jruiz at johnruiz.com (John Ruiz)
Date: Tue, 3 Jan 2012 11:42:26 -0800 (PST)
Subject: [rabbitmq-discuss] Bug: rmq_auth_mech_ssl crashes when Cert Subject
 contains more than one CN
Message-ID: <5f01e2cf-ac30-4968-991e-ba87b6469896@p4g2000vbt.googlegroups.com>

When using Microsoft Active Directory and Certificate Services (AD DS
& AD CS) as your Kerberos/LDAP/PKI environment, users are - by default
- created in the Users container (CN=Users, DC=example, DC=com) in
LDAP.

Therefore, the DN of new domain users contains two common name (CN)
elements in their DN (i.e. CN=Test User, CN=Users, DC=example,
DC=com).  Therefore, the Subject of the user's certificate will
contain two CN elements.  This crashes the find_by_type method (line
88 of rabbit_ssl.erl) when the return of lists:flatten are an array
instead of a single value.

I suggest that the code be updated to check for multiple CN elements
and to concatenate them with a space (" ").  In this way, instead of
crashing and being unusable in Windows environments, administrators
will be able to create a rabbitmq user that will match the
concatenated value (i.e. "Users Test User").

Please see this thread for historical information:
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/0a93665c63113683

Apologies for submitting this here, but when I created a rabbitmq
bugzilla account, I had no privileges whatsoever.

From alexis at rabbitmq.com  Tue Jan  3 19:47:27 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 3 Jan 2012 19:47:27 +0000
Subject: [rabbitmq-discuss] Bug: rmq_auth_mech_ssl crashes when Cert
 Subject contains more than one CN
In-Reply-To: <5f01e2cf-ac30-4968-991e-ba87b6469896@p4g2000vbt.googlegroups.com>
References: <5f01e2cf-ac30-4968-991e-ba87b6469896@p4g2000vbt.googlegroups.com>
Message-ID: <CACOPnvcroKQD5wUrmnr5+piqzoRzMjy+-Qgky15=yWFS2j0SLA@mail.gmail.com>

On Tue, Jan 3, 2012 at 7:42 PM, John Ruiz <jruiz at johnruiz.com> wrote:
>
> Apologies for submitting this here, but when I created a rabbitmq
> bugzilla account, I had no privileges whatsoever.

Please can you expand on this; iirc there is a way to post stuff.

From harvey.robin at gmail.com  Tue Jan  3 20:03:24 2012
From: harvey.robin at gmail.com (Robin Harvey)
Date: Tue, 3 Jan 2012 20:03:24 +0000
Subject: [rabbitmq-discuss] active-active implementation in php
In-Reply-To: <CAMcAHLWt7XnCBu7q4sA2PQNQ_xAx8gHMg2rWqgVH5-RWo4Pw-A@mail.gmail.com>
References: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
	<4F0317FE.2050802@rabbitmq.com>
	<CAMcAHLWt7XnCBu7q4sA2PQNQ_xAx8gHMg2rWqgVH5-RWo4Pw-A@mail.gmail.com>
Message-ID: <CAOvN6FCu7dWWCSPqnfWu5OgZBGMm-nq-UWhVtn-rWEd9+1RPhQ@mail.gmail.com>

Alvaro - does php-amqplib support incoming consumer cancels?


Out of interest, how does the client know where to re-connect to when a
queue fails (i.e. which slave got promoted)?  I've seen the following
(here: http://www.rabbitmq.com/ha.html):

> Clients that were consuming from the mirrored-queue and support our Consumer
Cancellation Notifications<http://www.rabbitmq.com/extensions.html#consumer-cancel-notify>extension
will receive a notification that their subscription to the
mirrored-queue has been abruptly cancelled. At this point they should
re-consume from the queue, which will pick up the new master

...but this doesn't give much detail.  Are the reconnection parameters in
the consumer.cancel method?


Thanks,
--Robin

On 3 January 2012 15:07, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi,
>
> Yes? it should support the arguments parameter.
>
> BTW? I recommend that you use this version of the library:
> https://github.com/videlalvaro/php-amqplib for the reasons stated here:
> http://videlalvaro.github.com/2011/11/php-amqplib-future.html
>
> Regards,
>
> Alvaro
>
>
> On Tue, Jan 3, 2012 at 4:00 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>> Hi Dhaneesh,
>>
>> On 30/12/11 04:25, Dhaneesh Radhakrishnan wrote:
>> > Hi
>> >
>> >  Is it possible to  implement Mirrored Queue ( active-active )using
>> > php-ampliqb  for
>> > HA
>>
>> Judging by the queue_declare() function, php-amqplib does support
>> arguments, so it is possible to make use of mirrored queues using this
>> library.
>>
>> See http://www.rabbitmq.com/ha.html for details on how to set the
>> "x-ha-policy" argument.
>>
>>
>>
>> -Emile
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/66bd82c0/attachment.htm>

From jruiz at johnruiz.com  Tue Jan  3 20:08:21 2012
From: jruiz at johnruiz.com (John Ruiz)
Date: Tue, 3 Jan 2012 12:08:21 -0800 (PST)
Subject: [rabbitmq-discuss] Bug: rmq_auth_mech_ssl crashes when Cert
 Subject contains more than one CN
In-Reply-To: <CACOPnvcroKQD5wUrmnr5+piqzoRzMjy+-Qgky15=yWFS2j0SLA@mail.gmail.com>
References: <5f01e2cf-ac30-4968-991e-ba87b6469896@p4g2000vbt.googlegroups.com>
	<CACOPnvcroKQD5wUrmnr5+piqzoRzMjy+-Qgky15=yWFS2j0SLA@mail.gmail.com>
Message-ID: <7cd0dd78-f2a8-4f00-9325-b029dec27943@d10g2000vbh.googlegroups.com>

This (http://www.johnruiz.com/no-permissions.png)

leads to

This (http://www.johnruiz.com/no-access.png)

On Jan 3, 2:47?pm, Alexis Richardson <ale... at rabbitmq.com> wrote:
> On Tue, Jan 3, 2012 at 7:42 PM, John Ruiz <jr... at johnruiz.com> wrote:
>
> > Apologies for submitting this here, but when I created a rabbitmq
> > bugzilla account, I had no privileges whatsoever.
>
> Please can you expand on this; iirc there is a way to post stuff.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Tue Jan  3 20:16:13 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 3 Jan 2012 21:16:13 +0100
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate
	Messages
In-Reply-To: <5D476051A786C040BF0D9CB87BCBE3AA05975254A4@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
References: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
	<88E590DC4586974D825FC82AE798294E520BDA65@GSVCLU03.ges.ferlan.it>
	<5D476051A786C040BF0D9CB87BCBE3AA05975254A4@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
Message-ID: <CAOn7oW_EbZtN-1wdNa-hiNV17GiFz6nutbux4rQtKPU=bs1Gcw@mail.gmail.com>

Inline

On Jan 3, 2012 4:52 PM, "Letourneau, John P (John)" <
john.letourneau at alcatel-lucent.com> wrote:
>
> Well, perhaps a bit more about my configuration 8-)
>
> 3 nodes?call them N1, N2, N3.
>
> On each I have federation configured.
>
> N2 ? exchange log, connects to N1/log and N3/log
>
> N3 ? exchange log, connects to N2/log
>
> Right now I cannot seem to have the N1 exchange log connect to N2/log;
will need to find out why sometime.
>
> I do it this way so that regardless of where the producer of the log
message is, everyone everywhere will see it.

If this is your aim, can't you simply federate the log exchange on each
broker with the other two and set max hops to 1?

>
>
>
> Each layer in the hierarchy only knows about nodes in adjacent layers?N2
being the busy one with a layer above and below.
>
> If everyone has hops=1, sending a log message to N1/log will only go to
N2 and not N3 [this is correct].
>
> Setting hops=4, sending a log to N1/log will go to N2 and N3?it will also
be returned to N2 thus a consumer on N2 will see the original msg AND the
one sent via N2/N3 federation link. Also N3 sees it twice also for a total
of once on N1, twice on N2, and twice on N3?the message took a total of 4
hops.
>
>
>
> So, this is what I mean by ?one might expect? 8-)
>
> -John
>
>
>
> From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com]
> Sent: Tuesday, January 03, 2012 10:23 AM
> To: Letourneau, John P (John); rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: Federation Configuration and Duplicate Messages
>
>
>
> Hi John, I?m not sure about this:
>
>
>
> As one might expect, this sometimes results in the message being seen >1
time at some clients.
>
>
>
> It shouldn?t be the expected behavior except for certain scenarios (i.e.
disconnection of the brokers). Am I missing something perhaps?
>
>
_________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario e
puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
messaggio non e il destinatario designato, o il dipendente/agente
responsabile
> per la consegna del messaggio al destinatario designato, si informa che
ogni disseminazione, distribuzione o copiatura di questa comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
>
_________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may
contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the
intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any
dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
immediately by return e-mail and delete this e-mail and all attachments
from
> your system.
>
_________________________________________________________________________________________________________________
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/313065bf/attachment.htm>

From alexis at rabbitmq.com  Tue Jan  3 20:22:10 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 3 Jan 2012 20:22:10 +0000
Subject: [rabbitmq-discuss] Bug: rmq_auth_mech_ssl crashes when Cert
 Subject contains more than one CN
In-Reply-To: <7cd0dd78-f2a8-4f00-9325-b029dec27943@d10g2000vbh.googlegroups.com>
References: <5f01e2cf-ac30-4968-991e-ba87b6469896@p4g2000vbt.googlegroups.com>
	<CACOPnvcroKQD5wUrmnr5+piqzoRzMjy+-Qgky15=yWFS2j0SLA@mail.gmail.com>
	<7cd0dd78-f2a8-4f00-9325-b029dec27943@d10g2000vbh.googlegroups.com>
Message-ID: <CACOPnvfJrQAtn+8hL1_rUGdGBPh40FOMxuce4M8MWgVRnNcQhg@mail.gmail.com>

Let me look into this and report back John...


On Tue, Jan 3, 2012 at 8:08 PM, John Ruiz <jruiz at johnruiz.com> wrote:
> This (http://www.johnruiz.com/no-permissions.png)
>
> leads to
>
> This (http://www.johnruiz.com/no-access.png)
>
> On Jan 3, 2:47?pm, Alexis Richardson <ale... at rabbitmq.com> wrote:
>> On Tue, Jan 3, 2012 at 7:42 PM, John Ruiz <jr... at johnruiz.com> wrote:
>>
>> > Apologies for submitting this here, but when I created a rabbitmq
>> > bugzilla account, I had no privileges whatsoever.
>>
>> Please can you expand on this; iirc there is a way to post stuff.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Tue Jan  3 21:00:22 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 3 Jan 2012 22:00:22 +0100
Subject: [rabbitmq-discuss] active-active implementation in php
In-Reply-To: <CAOvN6FCu7dWWCSPqnfWu5OgZBGMm-nq-UWhVtn-rWEd9+1RPhQ@mail.gmail.com>
References: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
	<4F0317FE.2050802@rabbitmq.com>
	<CAMcAHLWt7XnCBu7q4sA2PQNQ_xAx8gHMg2rWqgVH5-RWo4Pw-A@mail.gmail.com>
	<CAOvN6FCu7dWWCSPqnfWu5OgZBGMm-nq-UWhVtn-rWEd9+1RPhQ@mail.gmail.com>
Message-ID: <59F27BFB-A3BB-48A8-B139-E6EA7A82E32E@gmail.com>

Hi Robin,

The library implements the basic.cancel method but I haven't tested this yet.

I think I will try to set up a Demo and implement any missing features in case they are needed.

Alvaro

On Jan 3, 2012, at 9:03 PM, Robin Harvey wrote:

> Alvaro - does php-amqplib support incoming consumer cancels?
> 
> 
> Out of interest, how does the client know where to re-connect to when a queue fails (i.e. which slave got promoted)?  I've seen the following (here: http://www.rabbitmq.com/ha.html):
> 
> > Clients that were consuming from the mirrored-queue and support our Consumer Cancellation Notifications extension will receive a notification that their subscription to the mirrored-queue has been abruptly cancelled. At this point they should re-consume from the queue, which will pick up the new master
> 
> ...but this doesn't give much detail.  Are the reconnection parameters in the consumer.cancel method?
> 
> 
> Thanks,
> --Robin
> 
> On 3 January 2012 15:07, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
> 
> Yes? it should support the arguments parameter. 
> 
> BTW? I recommend that you use this version of the library: https://github.com/videlalvaro/php-amqplib for the reasons stated here: http://videlalvaro.github.com/2011/11/php-amqplib-future.html
> 
> Regards,
> 
> Alvaro
> 
> 
> On Tue, Jan 3, 2012 at 4:00 PM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Dhaneesh,
> 
> On 30/12/11 04:25, Dhaneesh Radhakrishnan wrote:
> > Hi
> >
> >  Is it possible to  implement Mirrored Queue ( active-active )using
> > php-ampliqb  for
> > HA
> 
> Judging by the queue_declare() function, php-amqplib does support
> arguments, so it is possible to make use of mirrored queues using this
> library.
> 
> See http://www.rabbitmq.com/ha.html for details on how to set the
> "x-ha-policy" argument.
> 
> 
> 
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120103/7c1aa1d2/attachment.htm>

From andy.berryman at channeladvisor.com  Tue Jan  3 21:01:36 2012
From: andy.berryman at channeladvisor.com (AndyB)
Date: Tue, 3 Jan 2012 13:01:36 -0800 (PST)
Subject: [rabbitmq-discuss] Why are deliveries still showing even though msg
	counts show 0 in admin?
Message-ID: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>

I'm seeing data in the RabbitMQ Admin page for my Queue that has me
rather confused.  I have ~30 consumers on the queue.  The publishes to
the queue are done in large batches at periodic intervals.  For
example, a schedule kicks off every 30 minutes and looks for work that
needs to be submitted, and then sends a publish for each piece of work
to the queue.  So the queue will build up pretty quickly and then get
processed down by the consumers.  When the batch begins getting
published I can see the message counts (ready, unacknowledged, total)
show up with correct values and the deliveries to the consumers as
well.

What is confusing me is that I'm seeing the message counts for all
values go to 0, but the deliveries are continuing to show work for a
good bit of time (several minutes).  So what messages are being
delivered if the counts are showing 0?

And along the same lines, what does it mean whenever I'm looking at
that page while work is being submitted and the ready value is 0, but
unacknowledged and total are growing?

Thanks
Andy

From michael.s.klishin at gmail.com  Tue Jan  3 22:06:11 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 4 Jan 2012 02:06:11 +0400
Subject: [rabbitmq-discuss] Why are deliveries still showing even though
	msg counts show 0 in admin?
In-Reply-To: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>
References: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>
Message-ID: <C8930831-07B9-4D98-B538-108D3B991F7B@gmail.com>

AndyB:

> What is confusing me is that I'm seeing the message counts for all
> values go to 0, but the deliveries are continuing to show work for a
> good bit of time (several minutes).  So what messages are being
> delivered if the counts are showing 0?

It depends on your particular client but probably RabbitMQ delivers messages and clients then keep them around
until they are all processed. If you use message acknowledgements, there is no reason to worry: if your application crashes, RabbitMQ will notice that connection was closed and will requeue unacknowledged messages.

See basic.qos AMQP method if you want to control this behavior.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From andy.berryman at channeladvisor.com  Tue Jan  3 23:52:07 2012
From: andy.berryman at channeladvisor.com (AndyB)
Date: Tue, 3 Jan 2012 15:52:07 -0800 (PST)
Subject: [rabbitmq-discuss] Why are deliveries still showing even though
	msg counts show 0 in admin?
In-Reply-To: <C8930831-07B9-4D98-B538-108D3B991F7B@gmail.com>
References: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>
	<C8930831-07B9-4D98-B538-108D3B991F7B@gmail.com>
Message-ID: <0469d1e9-473c-4f02-8c7e-ed6300df0199@k29g2000vbl.googlegroups.com>

Let me try and explain with a bit more detail.  My publisher and
consumer code are both written in C# and are using the C# driver from
the website.  I am using message acknowledgements and each of my
consumers is configured with a fetch count of 2.  So given that I have
30 consumers, here is what I typically see when monitoring the admin
page and the message counts ...

While messages are being published, the ready and unacknowledged
counts equal the value being displayed for total.  And the
unacknowledged value is equal to 60 (30 consumers * 2 fetch count).
The incoming message rates will show a pretty varying value, but lets
just say the average is ~300 messages/sec.  And the deliveries are
showing variable rates of ~60 messages/sec per consumer.  This remains
fairly constant while the messages are processed off the queue.

Where I'm getting confused is that when it seems to me like all of the
messages have been processed, the counts all show 0, I still see the
delivery rates showing values and they continue to do so for a good
amount of time.  During this time, the counts remain 0, as well as the
incoming messages rates (as nothing else is being published).  So it
seems to me like the counts arent showing messages that are really
there, which are still being delivered.  What's going on there?  Could
these possibly be messages that are being delivered from disk that got
streamed there because memory was too low to keep them in RAM?

Andy

On Jan 3, 5:06?pm, Michael Klishin <michael.s.klis... at gmail.com>
wrote:
> AndyB:
>
> > What is confusing me is that I'm seeing the message counts for all
> > values go to 0, but the deliveries are continuing to show work for a
> > good bit of time (several minutes). ?So what messages are being
> > delivered if the counts are showing 0?
>
> It depends on your particular client but probably RabbitMQ delivers messages and clients then keep them around
> until they are all processed. If you use message acknowledgements, there is no reason to worry: if your application crashes, RabbitMQ will notice that connection was closed and will requeue unacknowledged messages.
>
> See basic.qos AMQP method if you want to control this behavior.
>
> MK
>
> http://github.com/michaelklishinhttp://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From huangyuyang at mail.htsc.com.cn  Wed Jan  4 01:14:18 2012
From: huangyuyang at mail.htsc.com.cn (=?gb2312?B?u8bUo9Hz?=)
Date: Wed, 4 Jan 2012 09:14:18 +0800
Subject: [rabbitmq-discuss] =?gb2312?b?16q3ojogSEVMUDogcmFiYml0bXFhZG1p?=
	=?gb2312?b?biBlcnJvcg==?=
Message-ID: <201201040914188431715@mail.htsc.com.cn>

for help !!


Eason Huang 




???? ???
????? 2011?12?30?(???) ??1:45
???? support
??? HELP: rabbitmqadmin error 
Hi

I run "python.exe rabbitmqadmin" in windows dos , showing "ERROR: Action not specified ".
attachment is the screen snopshot.

please help me




Eason Huang from China
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/d46475b0/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 1.png
Type: application/octet-stream
Size: 11307 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/d46475b0/attachment.obj>

From videlalvaro at gmail.com  Wed Jan  4 07:14:40 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 4 Jan 2012 08:14:40 +0100
Subject: [rabbitmq-discuss] topic routing and the management plugin
Message-ID: <8DF09A05-84A6-4F8C-A33C-E34A3B518ACB@gmail.com>

Hi,

Have you guys seen this https://skitch.com/bcantrill/gi52p/rabbitupgrade

It's been tweeted by Bryan Cantrill, the creator of DTrace. That graph is from their Joyent deployment

See https://twitter.com/#!/bcantrill/status/154425077247643648

I know the topic routing has been fixed, no idea about the management plugin tho.

Cheers,

Alvaro




From vbernard42 at gmail.com  Wed Jan  4 08:37:54 2012
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Wed, 4 Jan 2012 00:37:54 -0800 (PST)
Subject: [rabbitmq-discuss] =?gb2312?b?16q3ojogSEVMUDogcmFiYml0bXFhZG1p?=
	=?gb2312?b?biBlcnJvcg==?=
In-Reply-To: <201201040914188431715@mail.htsc.com.cn>
References: <201201040914188431715@mail.htsc.com.cn>
Message-ID: <285d17fd-a299-4e76-82c7-2d2de1432bfb@d10g2000vbh.googlegroups.com>

Hi,

You need to pass arguments to this script. Look at the output of
"python.exe rabbitmqadmin --help" for a list of commands and options.
For example:

python.exe rabbitmqadmin -H <hostname> list exchanges

Cheers.

On 4 jan, 02:14, ??? <huangyuy... at mail.htsc.com.cn> wrote:
> for help !!
>
> Eason Huang
>
> ???? ???
> ????? 2011?12?30?(???) ??1:45
> ???? support
> ??? HELP: rabbitmqadmin error
> Hi
>
> I run "python.exe rabbitmqadmin" in windows dos , showing "ERROR: Action not specified ".
> attachment is the screen snopshot.
>
> please help me
>
> Eason Huang from China
>
>  1.png
> 14KAfficherT?l?charger
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Wed Jan  4 08:44:23 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 4 Jan 2012 08:44:23 +0000
Subject: [rabbitmq-discuss] does rabbitmq server close connections?
In-Reply-To: <CAH24rBMARYYbar5U6yrrT3KPs-EddZoTx5RkxVivPw4AhGSOTQ@mail.gmail.com>
References: <CAG2rwuPPsZ+90KZiK9xtinTR6Yeo3GiEwsmb6HBtp_di9Yhh+g@mail.gmail.com>
	<20120103144157.GB3191@southbank>
	<CAH24rBONoy6YmJugja21d5APK0GMbQAA2Cud3+LR3RE5txNPaQ@mail.gmail.com>
	<20120103160620.GG3191@southbank>
	<CAH24rBMARYYbar5U6yrrT3KPs-EddZoTx5RkxVivPw4AhGSOTQ@mail.gmail.com>
Message-ID: <20120104084423.GI3191@southbank>

> You're the expert, should it work? :)

This should work:

> > Enabling heartbeats (when connecting with a client) didn't help?
> > (heartbeats are the AMQP equivalent of TCP keep-alives)

Adding this to the rabbit entry in rabbitmq.config (yes, you also need
to respecify the default rabbit options) enables keep-alive on the
sockets.

{tcp_listen_options, [binary,
                     {packet, raw},
                     {reuseaddr, true},
                     {backlog, 128},
                     {nodelay, true},
                     {exit_on_close, false},
                     {keepalive, true}]}

I don't know whether this is enough to prevent your firewall from
terminating the "idle" connections.

Cheers,
Alex

On Tue, Jan 03, 2012 at 11:16:20AM -0500, Mark Steele wrote:
> You're the expert, should it work? :)
> 
> I haven't tested that out, hadn't occurred to me to try.
> 
> On Tue, Jan 3, 2012 at 11:06 AM, Alexandru Scvor?ov
> <alexandru at rabbitmq.com>wrote:
> 
> > > We've been bitten by this with firewalls that close connections after
> > idle
> > > timeouts. Best solution I can come up with is to use TCP keepalives.
> >
> > Enabling heartbeats (when connecting with a client) didn't help?
> > (heartbeats are the AMQP equivalent of TCP keep-alives)
> >
> > > If you client supports setting TCP options during the connection, that's
> > > all you need to do for the client side part. For the server side, I
> > > couldn't find any options for this in the rabbit config, so we
> > implemented
> > > libkeepalive to force the server to use keepalives.
> > >
> > > Rabbit folks, please add this as an option to the server.
> >
> > I haven't tried, but I think you can enable keepalives in the
> > rabbitmq.config.  Just add a tcp_listen_options entry with {keepalive,
> > true}:
> >
> > [
> >        {rabbit, [{tcp_listen_options, [{keepalive, true}]}]}
> > ].
> >
> > http://www.rabbitmq.com/configure.html#config-items
> >
> > Wouldn't something like that work?
> >
> > Cheers,
> > Alex
> >
> > On Tue, Jan 03, 2012 at 10:47:43AM -0500, Mark Steele wrote:
> > > We've been bitten by this with firewalls that close connections after
> > idle
> > > timeouts. Best solution I can come up with is to use TCP keepalives.
> > >
> > > If you client supports setting TCP options during the connection, that's
> > > all you need to do for the client side part. For the server side, I
> > > couldn't find any options for this in the rabbit config, so we
> > implemented
> > > libkeepalive to force the server to use keepalives.
> > >
> > > Rabbit folks, please add this as an option to the server.
> > >
> > > Cheers,
> > >
> > > Mark Steele, CISSP, CSM
> > > Bering Media Inc.
> > >
> > > On Tue, Jan 3, 2012 at 9:41 AM, Alexandru Scvor?ov
> > > <alexandru at rabbitmq.com>wrote:
> > >
> > > > > With 100's of computers connected to rabbitmq with persistent
> > > > connections,
> > > > > would this pose any problems?
> > > >
> > > > Not unless you run out of free file handles.  On normal installations,
> > > > it should handle up to thousands of connections without difficulty.
> >  You
> > > > could further configure it to support more connections.
> > > >
> > > > > Does it time-out by default?
> > > >
> > > > No.  Connections are not timed out.
> > > >
> > > > > Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
> > > >
> > > > If the network fails between a client and the broker, and there's no
> > > > traffic between them at that point, both will think the connection is
> > > > still open, even though it isn't.  Heartbeats ensure that both broker
> > > > and client are notified fairly quickly if the connection fails.
> > > >
> > > > > Would it be better for clients to close connections and only open a
> > > > > connection when necessary?
> > > >
> > > > It depends on your use case.
> > > >
> > > > > For reading messages we need persistent connections.
> > > > > But for writing, and I can see how we could potentially only open a
> > > > > connection to write a message when required.
> > > >
> > > > For consuming messages *efficiently*, you need persistent connections.
> > > > If you only get messages very rarely, you could open a connection, poll
> > > > the broker with basic.get and then close the connection.  But, if you
> > > > need to consume a lot of messages, you probably want persistent
> > > > connections anyway.
> > > >
> > > > Hope this helps.
> > > >
> > > > Cheers,
> > > > Alex
> > > >
> > > > On Thu, Dec 29, 2011 at 05:21:26PM -0500, S Ahmed wrote:
> > > > > With 100's of computers connected to rabbitmq with persistent
> > > > connections,
> > > > > would this pose any problems?
> > > > >
> > > > > Does it time-out by default?
> > > > >
> > > > > Why use a heartbeat?  Is it to re-establish if the heartbeat fails?
> > > > >
> > > > > Would it be better for clients to close connections and only open a
> > > > > connection when necessary?
> > > > >
> > > > > For reading messages we need persistent connections.
> > > > >
> > > > > But for writing, and I can see how we could potentially only open a
> > > > > connection to write a message when required.
> > > >
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >
> >

From john.letourneau at alcatel-lucent.com  Wed Jan  4 11:54:00 2012
From: john.letourneau at alcatel-lucent.com (Letourneau, John P (John))
Date: Wed, 4 Jan 2012 05:54:00 -0600
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate
 Messages
In-Reply-To: <CAOn7oW_EbZtN-1wdNa-hiNV17GiFz6nutbux4rQtKPU=bs1Gcw@mail.gmail.com>
References: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
	<88E590DC4586974D825FC82AE798294E520BDA65@GSVCLU03.ges.ferlan.it>
	<5D476051A786C040BF0D9CB87BCBE3AA05975254A4@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
	<CAOn7oW_EbZtN-1wdNa-hiNV17GiFz6nutbux4rQtKPU=bs1Gcw@mail.gmail.com>
Message-ID: <5D476051A786C040BF0D9CB87BCBE3AA0597617438@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>

Simone,
If I were to set hops=1, then a message posted at N1 would go to N2 but will NOT go to N3. This has been verified.
Similarly a message posted at N3 would go to N2 but NOT go to N1.

-John

From: Simone Busoli [mailto:simone.busoli at gmail.com]
Sent: Tuesday, January 03, 2012 3:16 PM
To: Letourneau, John P (John)
Cc: Busoli, Simone; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Federation Configuration and Duplicate Messages


Inline

On Jan 3, 2012 4:52 PM, "Letourneau, John P (John)" <john.letourneau at alcatel-lucent.com<mailto:john.letourneau at alcatel-lucent.com>> wrote:
>
> Well, perhaps a bit more about my configuration 8-)
>
> 3 nodes...call them N1, N2, N3.
>
> On each I have federation configured.
>
> N2 - exchange log, connects to N1/log and N3/log
>
> N3 - exchange log, connects to N2/log
>
> Right now I cannot seem to have the N1 exchange log connect to N2/log; will need to find out why sometime.
>
> I do it this way so that regardless of where the producer of the log message is, everyone everywhere will see it.

If this is your aim, can't you simply federate the log exchange on each broker with the other two and set max hops to 1?

>
>
>
> Each layer in the hierarchy only knows about nodes in adjacent layers...N2 being the busy one with a layer above and below.
>
> If everyone has hops=1, sending a log message to N1/log will only go to N2 and not N3 [this is correct].
>
> Setting hops=4, sending a log to N1/log will go to N2 and N3...it will also be returned to N2 thus a consumer on N2 will see the original msg AND the one sent via N2/N3 federation link. Also N3 sees it twice also for a total of once on N1, twice on N2, and twice on N3...the message took a total of 4 hops.
>
>
>
> So, this is what I mean by 'one might expect' 8-)
>
> -John
>
>
>
> From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com<mailto:Simone.Busoli at ferrari.com>]
> Sent: Tuesday, January 03, 2012 10:23 AM
> To: Letourneau, John P (John); rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> Subject: RE: Federation Configuration and Duplicate Messages
>
>
>
> Hi John, I'm not sure about this:
>
>
>
> As one might expect, this sometimes results in the message being seen >1 time at some clients.
>
>
>
> It shouldn't be the expected behavior except for certain scenarios (i.e. disconnection of the brokers). Am I missing something perhaps?
>
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
> your system.
> _________________________________________________________________________________________________________________
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/bddfe717/attachment.htm>

From Simone.Busoli at ferrari.com  Wed Jan  4 12:01:47 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 4 Jan 2012 12:01:47 +0000
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate
	Messages
In-Reply-To: <5D476051A786C040BF0D9CB87BCBE3AA0597617438@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
References: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com><88E590DC4586974D825FC82AE798294E520BDA65@GSVCLU03.ges.ferlan.it><5D476051A786C040BF0D9CB87BCBE3AA05975254A4@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
	<CAOn7oW_EbZtN-1wdNa-hiNV17GiFz6nutbux4rQtKPU=bs1Gcw@mail.gmail.com>
	<5D476051A786C040BF0D9CB87BCBE3AA0597617438@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520BDD7C@GSVCLU03.ges.ferlan.it>

That's true with your current configuration, but if you federate each broker with the other two like I suggested it is going to work.

From: Letourneau, John P (John) [mailto:john.letourneau at alcatel-lucent.com]
Sent: mercoled? 4 gennaio 2012 12:54
To: Simone Busoli
Cc: Busoli, Simone; rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] Federation Configuration and Duplicate Messages

Simone,
If I were to set hops=1, then a message posted at N1 would go to N2 but will NOT go to N3. This has been verified.
Similarly a message posted at N3 would go to N2 but NOT go to N1.

-John

From: Simone Busoli [mailto:simone.busoli at gmail.com]
Sent: Tuesday, January 03, 2012 3:16 PM
To: Letourneau, John P (John)
Cc: Busoli, Simone; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Federation Configuration and Duplicate Messages


Inline

On Jan 3, 2012 4:52 PM, "Letourneau, John P (John)" <john.letourneau at alcatel-lucent.com<mailto:john.letourneau at alcatel-lucent.com>> wrote:
>
> Well, perhaps a bit more about my configuration 8-)
>
> 3 nodes...call them N1, N2, N3.
>
> On each I have federation configured.
>
> N2 - exchange log, connects to N1/log and N3/log
>
> N3 - exchange log, connects to N2/log
>
> Right now I cannot seem to have the N1 exchange log connect to N2/log; will need to find out why sometime.
>
> I do it this way so that regardless of where the producer of the log message is, everyone everywhere will see it.

If this is your aim, can't you simply federate the log exchange on each broker with the other two and set max hops to 1?

>
>
>
> Each layer in the hierarchy only knows about nodes in adjacent layers...N2 being the busy one with a layer above and below.
>
> If everyone has hops=1, sending a log message to N1/log will only go to N2 and not N3 [this is correct].
>
> Setting hops=4, sending a log to N1/log will go to N2 and N3...it will also be returned to N2 thus a consumer on N2 will see the original msg AND the one sent via N2/N3 federation link. Also N3 sees it twice also for a total of once on N1, twice on N2, and twice on N3...the message took a total of 4 hops.
>
>
>
> So, this is what I mean by 'one might expect' 8-)
>
> -John
>
>
>
> From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com<mailto:Simone.Busoli at ferrari.com>]
> Sent: Tuesday, January 03, 2012 10:23 AM
> To: Letourneau, John P (John); rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> Subject: RE: Federation Configuration and Duplicate Messages
>
>
>
> Hi John, I'm not sure about this:
>
>
>
> As one might expect, this sometimes results in the message being seen >1 time at some clients.
>
>
>
> It shouldn't be the expected behavior except for certain scenarios (i.e. disconnection of the brokers). Am I missing something perhaps?
>
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
> your system.
> _________________________________________________________________________________________________________________
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/19a0c1df/attachment.htm>

From john.letourneau at alcatel-lucent.com  Wed Jan  4 12:27:09 2012
From: john.letourneau at alcatel-lucent.com (Letourneau, John P (John))
Date: Wed, 4 Jan 2012 06:27:09 -0600
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate
 Messages
In-Reply-To: <88E590DC4586974D825FC82AE798294E520BDD7C@GSVCLU03.ges.ferlan.it>
References: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com><88E590DC4586974D825FC82AE798294E520BDA65@GSVCLU03.ges.ferlan.it><5D476051A786C040BF0D9CB87BCBE3AA05975254A4@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
	<CAOn7oW_EbZtN-1wdNa-hiNV17GiFz6nutbux4rQtKPU=bs1Gcw@mail.gmail.com>
	<5D476051A786C040BF0D9CB87BCBE3AA0597617438@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
	<88E590DC4586974D825FC82AE798294E520BDD7C@GSVCLU03.ges.ferlan.it>
Message-ID: <5D476051A786C040BF0D9CB87BCBE3AA0597617446@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>

Simone,
Ah, sorry I missed the suggestion to configure a fully interconnected network.
Yes that would work. However it becomes an administrative nightmare as nodes are added to the network.
Therefore I don't think this is viable.
-John

From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com]
Sent: Wednesday, January 04, 2012 7:02 AM
To: Letourneau, John P (John); Simone Busoli
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] Federation Configuration and Duplicate Messages

That's true with your current configuration, but if you federate each broker with the other two like I suggested it is going to work.

From: Letourneau, John P (John) [mailto:john.letourneau at alcatel-lucent.com]
Sent: mercoled? 4 gennaio 2012 12:54
To: Simone Busoli
Cc: Busoli, Simone; rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] Federation Configuration and Duplicate Messages

Simone,
If I were to set hops=1, then a message posted at N1 would go to N2 but will NOT go to N3. This has been verified.
Similarly a message posted at N3 would go to N2 but NOT go to N1.

-John

From: Simone Busoli [mailto:simone.busoli at gmail.com]
Sent: Tuesday, January 03, 2012 3:16 PM
To: Letourneau, John P (John)
Cc: Busoli, Simone; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Federation Configuration and Duplicate Messages


Inline

On Jan 3, 2012 4:52 PM, "Letourneau, John P (John)" <john.letourneau at alcatel-lucent.com<mailto:john.letourneau at alcatel-lucent.com>> wrote:
>
> Well, perhaps a bit more about my configuration 8-)
>
> 3 nodes...call them N1, N2, N3.
>
> On each I have federation configured.
>
> N2 - exchange log, connects to N1/log and N3/log
>
> N3 - exchange log, connects to N2/log
>
> Right now I cannot seem to have the N1 exchange log connect to N2/log; will need to find out why sometime.
>
> I do it this way so that regardless of where the producer of the log message is, everyone everywhere will see it.

If this is your aim, can't you simply federate the log exchange on each broker with the other two and set max hops to 1?

>
>
>
> Each layer in the hierarchy only knows about nodes in adjacent layers...N2 being the busy one with a layer above and below.
>
> If everyone has hops=1, sending a log message to N1/log will only go to N2 and not N3 [this is correct].
>
> Setting hops=4, sending a log to N1/log will go to N2 and N3...it will also be returned to N2 thus a consumer on N2 will see the original msg AND the one sent via N2/N3 federation link. Also N3 sees it twice also for a total of once on N1, twice on N2, and twice on N3...the message took a total of 4 hops.
>
>
>
> So, this is what I mean by 'one might expect' 8-)
>
> -John
>
>
>
> From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com<mailto:Simone.Busoli at ferrari.com>]
> Sent: Tuesday, January 03, 2012 10:23 AM
> To: Letourneau, John P (John); rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> Subject: RE: Federation Configuration and Duplicate Messages
>
>
>
> Hi John, I'm not sure about this:
>
>
>
> As one might expect, this sometimes results in the message being seen >1 time at some clients.
>
>
>
> It shouldn't be the expected behavior except for certain scenarios (i.e. disconnection of the brokers). Am I missing something perhaps?
>
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
> your system.
> _________________________________________________________________________________________________________________
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
your system.
_________________________________________________________________________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/5bba45c9/attachment.htm>

From simon at rabbitmq.com  Wed Jan  4 13:24:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jan 2012 13:24:44 +0000
Subject: [rabbitmq-discuss] topic routing and the management plugin
In-Reply-To: <8DF09A05-84A6-4F8C-A33C-E34A3B518ACB@gmail.com>
References: <8DF09A05-84A6-4F8C-A33C-E34A3B518ACB@gmail.com>
Message-ID: <4F04531C.2020209@rabbitmq.com>

On 04/01/12 07:14, Alvaro Videla wrote:
> I know the topic routing has been fixed, no idea about the management plugin tho.

I replied to Bryan off-list. The bug he was seeing was:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-December/016893.html

...which is fixed in 2.7.1.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan  4 13:33:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jan 2012 13:33:19 +0000
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
	<CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>
Message-ID: <4F04551F.9070302@rabbitmq.com>

On 03/01/12 19:40, Jared Biel wrote:
> It seems that some of the plugins have erlc issues while building.

Hmm. It';s possible that our Debian control file is wrong - we list 
erlang-nox under "Depends" (which is correct) but erlang-dev under 
"Build-Depends". erlang-dev doesn't drag in all the libraries implied by 
erlang-nox, which was definitely what caused your problem with eldap and 
probably the other problems you saw. I'll file a bug.

Can you build from the Debian source if you install erlang-nox?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan  4 13:41:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jan 2012 13:41:28 +0000
Subject: [rabbitmq-discuss] Queue Size
In-Reply-To: <4F0327A5.80104@rabbitmq.com>
References: <CABEsvMfbyPQPLyNNscZe=2NhxtsBhswDA7pp8WU=B=J-cCrCgA@mail.gmail.com>
	<4F0327A5.80104@rabbitmq.com>
Message-ID: <4F045708.4010408@rabbitmq.com>

On 03/01/12 16:07, Emile Joubert wrote:
> Hi Poorna,
>
> On 03/01/12 15:46, Poorna Chander Kola wrote:
>> How we can find the phisical memory, the persistent queue is occupied on
>> disk. Please show some light on it. Thank you
>
> You can find out how much RAM a queue consumes with
> "rabbitmqctl list_queues name memory".
>
> You can get an idea of how many messages are on disk by calling
> "rabbitmqctl list_queues name memory backing_queue_status"
> and noting the "persistent_count" value. Bear in mind that this is not
> part of the published interface, and it only provides a message count.

Also, bear in mind that "the amount of space a queue takes on disk" is a 
rather dubious concept, since messages that get sent to multiple queues 
will only get sent to disk once - in fact the on-disk data structures 
have little connection with queues.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Wed Jan  4 13:42:41 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 4 Jan 2012 17:42:41 +0400
Subject: [rabbitmq-discuss] [announcement] HotBunnies 1.3.4 is released
Message-ID: <76E0150D-AD20-4D55-B2A1-C434CA8CF472@gmail.com>

Hot Bunnies [1] 1.3.4 is released to rubygems.org [2]. This is a bug fix release:

 * HotBunnies::Queue::Headers#reject should use Channel#basicReject, not #basicAck

1. https://github.com/ruby-amqp/hot_bunnies
2. https://rubygems.org/gems/hot_bunnies/versions/1.3.4-java

Have a good day.


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From simon at rabbitmq.com  Wed Jan  4 14:00:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jan 2012 14:00:02 +0000
Subject: [rabbitmq-discuss] slave_pids and synchronised_slave_pids not
 available from the HTTP api?
In-Reply-To: <CB274A48.25D75%mpietrek@skytap.com>
References: <CB274A48.25D75%mpietrek@skytap.com>
Message-ID: <4F045B62.5050706@rabbitmq.com>

You have two problems.

One is that the info items are renamed to slave_nodes and 
synchronised_slave_nodes by mgmt, since it tries to hide the existence 
of pids.

However, the second is that rabbitmqadmin does not know how to parse / 
display info items that are arrays. This probably needs fixing. You 
could use the {raw|pretty}_json output formats (which do not have this 
limitation) as a workaround, but ugh.

$ rabbitmqadmin -f pretty_json list queues | grep -A2 slave
     "slave_nodes": [
       "rabbit at smacmullen"
     ],
     "synchronised_slave_nodes": [
       "rabbit at smacmullen"
     ],

Cheers, Simon

On 02/01/12 19:49, Matt Pietrek wrote:
> I'm crafting some custom tooling that needs to know about the sync
> status of mirrored queues. Up to this point I've been successfully using
> the HTTP API via the rabbitmqadmin module and been able to get
> everything I need . However, I'm stymied on slave_pids and
> synchronised_slave_pids, which don't seem to come through.
>
> Per the rabbitmqctl cmd-line help, slave_pid and synchronised_slave_pids
> are valid queueinfoitems. Up to this point, queueinfoitem names have
> worked equally well with "rabbitmqadmin list queues"
>
> I've simplified the repro case down to the following; Rabbitmqctl
> displays these fields as expected:
>
> mpietrek at play:~/work/$rabbitmqctl list_queues consumers messages name
> slave_pids synchronised_slave_pids
> Listing queues ...
> 00fake_munger_queue[<rabbit at play2.1.248.0>][<rabbit at play2.1.248.0>]
> 00fake_service_2[<rabbit at play2.1.250.0>][<rabbit at play2.1.250.0>]
> ...done.
>
>
> However, rabbitmqadmin doesn't:
>
> mpietrek at play:~/work/$rabbitmqadmin.py list queues consumers messages
> name slave_pids synchronised_slave_pids
> +-----------+----------+----------------------+------------+-------------------------+
> | consumers | messages | name | slave_pids | synchronised_slave_pids |
> +-----------+----------+----------------------+------------+-------------------------+
> | 0 | 0 | fake_munger_queue | | |
> | 0 | 0 | fake_service_2 | | |
> +-----------+----------+----------------------+------------+-------------------------+
>
> Is this normal/expected? Am I not understanding something?
>
> FWIW, this is using RabbitMQ 2.71 on Ubuntu 10.04.
>
> Thanks,
>
> Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan  4 14:02:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jan 2012 14:02:59 +0000
Subject: [rabbitmq-discuss] RabbitMQ - JSON RPC Https Support?
In-Reply-To: <CAM8fPiRzN=qScjPkGxGMyKZWhNcbUC0Mi_n6hPMRj=Qjy1qYJQ@mail.gmail.com>
References: <1325312803.25063.YahooMailClassic@web39302.mail.mud.yahoo.com>
	<CAM8fPiRzN=qScjPkGxGMyKZWhNcbUC0Mi_n6hPMRj=Qjy1qYJQ@mail.gmail.com>
Message-ID: <4F045C13.4080104@rabbitmq.com>

On 31/12/11 14:52, Tony Garnock-Jones wrote:
> It doesn't do HTTPS itself:

Actually, it does now (or rather rabbitmq-mochiweb does). See:

http://www.rabbitmq.com/mochiweb.html

There's an example for how to do this at the bottom (but directed 
towards mgmt, so you need to configure the '*' listener instead of mgmt).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Wed Jan  4 14:52:10 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 4 Jan 2012 09:52:10 -0500
Subject: [rabbitmq-discuss] RabbitMQ - JSON RPC Https Support?
In-Reply-To: <4F045C13.4080104@rabbitmq.com>
References: <1325312803.25063.YahooMailClassic@web39302.mail.mud.yahoo.com>
	<CAM8fPiRzN=qScjPkGxGMyKZWhNcbUC0Mi_n6hPMRj=Qjy1qYJQ@mail.gmail.com>
	<4F045C13.4080104@rabbitmq.com>
Message-ID: <CAM8fPiSgPP3L9N7zVsU60WEo60zWn8X3n0AdzFO3ZnuB6+MPvQ@mail.gmail.com>

Hey, that's very cool! I must experiment with getting that set up.

On 4 January 2012 09:02, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 31/12/11 14:52, Tony Garnock-Jones wrote:
>
>> It doesn't do HTTPS itself:
>>
>
> Actually, it does now (or rather rabbitmq-mochiweb does). See:
>
> http://www.rabbitmq.com/**mochiweb.html<http://www.rabbitmq.com/mochiweb.html>
>
> There's an example for how to do this at the bottom (but directed towards
> mgmt, so you need to configure the '*' listener instead of mgmt).
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/fc9d51f9/attachment.htm>

From andy.berryman at channeladvisor.com  Wed Jan  4 15:09:32 2012
From: andy.berryman at channeladvisor.com (AndyB)
Date: Wed, 4 Jan 2012 07:09:32 -0800 (PST)
Subject: [rabbitmq-discuss] Why are deliveries still showing even though
	msg counts show 0 in admin?
In-Reply-To: <0469d1e9-473c-4f02-8c7e-ed6300df0199@k29g2000vbl.googlegroups.com>
References: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>
	<C8930831-07B9-4D98-B538-108D3B991F7B@gmail.com>
	<0469d1e9-473c-4f02-8c7e-ed6300df0199@k29g2000vbl.googlegroups.com>
Message-ID: <e955c12d-9599-4ce7-85c6-918526a1aeb7@m4g2000vbc.googlegroups.com>

Still hoping someone out there can help me with this one.  Any
guidance is greatly appreciated.

Thanks
Andy

On Jan 3, 6:52?pm, AndyB <andy.berry... at channeladvisor.com> wrote:
> Let me try and explain with a bit more detail. ?My publisher and
> consumer code are both written in C# and are using the C# driver from
> the website. ?I am using message acknowledgements and each of my
> consumers is configured with a fetch count of 2. ?So given that I have
> 30 consumers, here is what I typically see when monitoring the admin
> page and the message counts ...
>
> While messages are being published, the ready and unacknowledged
> counts equal the value being displayed for total. ?And the
> unacknowledged value is equal to 60 (30 consumers * 2 fetch count).
> The incoming message rates will show a pretty varying value, but lets
> just say the average is ~300 messages/sec. ?And the deliveries are
> showing variable rates of ~60 messages/sec per consumer. ?This remains
> fairly constant while the messages are processed off the queue.
>
> Where I'm getting confused is that when it seems to me like all of the
> messages have been processed, the counts all show 0, I still see the
> delivery rates showing values and they continue to do so for a good
> amount of time. ?During this time, the counts remain 0, as well as the
> incoming messages rates (as nothing else is being published). ?So it
> seems to me like the counts arent showing messages that are really
> there, which are still being delivered. ?What's going on there? ?Could
> these possibly be messages that are being delivered from disk that got
> streamed there because memory was too low to keep them in RAM?
>
> Andy
>
> On Jan 3, 5:06?pm, Michael Klishin <michael.s.klis... at gmail.com>
> wrote:
>
>
>
>
>
>
>
> > AndyB:
>
> > > What is confusing me is that I'm seeing the message counts for all
> > > values go to 0, but the deliveries are continuing to show work for a
> > > good bit of time (several minutes). ?So what messages are being
> > > delivered if the counts are showing 0?
>
> > It depends on your particular client but probably RabbitMQ delivers messages and clients then keep them around
> > until they are all processed. If you use message acknowledgements, there is no reason to worry: if your application crashes, RabbitMQ will notice that connection was closed and will requeue unacknowledged messages.
>
> > See basic.qos AMQP method if you want to control this behavior.
>
> > MK
>
> >http://github.com/michaelklishinhttp://twitter.com/michaelklishin
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jruiz at johnruiz.com  Wed Jan  4 15:18:58 2012
From: jruiz at johnruiz.com (John Ruiz)
Date: Wed, 4 Jan 2012 07:18:58 -0800 (PST)
Subject: [rabbitmq-discuss] Bug: rmq_auth_mech_ssl crashes when Cert
 Subject contains more than one CN
In-Reply-To: <CACOPnvfJrQAtn+8hL1_rUGdGBPh40FOMxuce4M8MWgVRnNcQhg@mail.gmail.com>
References: <5f01e2cf-ac30-4968-991e-ba87b6469896@p4g2000vbt.googlegroups.com>
	<CACOPnvcroKQD5wUrmnr5+piqzoRzMjy+-Qgky15=yWFS2j0SLA@mail.gmail.com>
	<7cd0dd78-f2a8-4f00-9325-b029dec27943@d10g2000vbh.googlegroups.com>
	<CACOPnvfJrQAtn+8hL1_rUGdGBPh40FOMxuce4M8MWgVRnNcQhg@mail.gmail.com>
Message-ID: <c2e63221-74ac-4b8c-a3db-e5a484080297@t30g2000vbx.googlegroups.com>

Thanks, I appreciate that.  I'd be glad to submit it to Bugzilla for
you when I can.

In the meantime, is there anyone who can comment about the bug
itself?  This is the only thing standing between me and having a
complete, working, rabbitmq solution in a real-world? Windows
environment. =)

Thanks!

On Jan 3, 3:22?pm, Alexis Richardson <ale... at rabbitmq.com> wrote:
> Let me look into this and report back John...
>
>
>
>
>
>
>
>
>
> On Tue, Jan 3, 2012 at 8:08 PM, John Ruiz <jr... at johnruiz.com> wrote:
> > This (http://www.johnruiz.com/no-permissions.png)
>
> > leads to
>
> > This (http://www.johnruiz.com/no-access.png)
>
> > On Jan 3, 2:47?pm, Alexis Richardson <ale... at rabbitmq.com> wrote:
> >> On Tue, Jan 3, 2012 at 7:42 PM, John Ruiz <jr... at johnruiz.com> wrote:
>
> >> > Apologies for submitting this here, but when I created a rabbitmq
> >> > bugzilla account, I had no privileges whatsoever.
>
> >> Please can you expand on this; iirc there is a way to post stuff.
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Wed Jan  4 15:20:34 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 4 Jan 2012 16:20:34 +0100
Subject: [rabbitmq-discuss] Translating the tutorials
Message-ID: <CAMcAHLX-qt1YvdNfnTiae5dt_Gb4HcrzQrrFEFr2bgKS5cqmog@mail.gmail.com>

Hi,

I been thinking at how hard it could be to translate the RabbitMQ
tutorials. If I'm not mistaken they are originally written in Markdown and
then exported to HTML.

So my proposal is the have some folder structure like the one from this
book: https://github.com/progit/progit and then let the community fork the
repo and help with the translation.

The community has helped to translate the examples to different programming
languages so I think people might volunteer to translate the text too.

I know there's extra work involved mostly on adapting the website to handle
the new language parameter, maintaining the repo on github, merging
requests and so on but I think it might be worth it as well.

What do you think?

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/d0ca1489/attachment.htm>

From Simone.Busoli at ferrari.com  Wed Jan  4 16:53:38 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 4 Jan 2012 16:53:38 +0000
Subject: [rabbitmq-discuss] Resource declarations in configuration file
Message-ID: <88E590DC4586974D825FC82AE798294E520BDEF0@GSVCLU03.ges.ferlan.it>

I'm trying to move away from shovel to federation, but I'd need to create additional resources which are not part of the federation. With shovel I could create them alongside those used by the shovel (and just not use them in the shovel), but federation doesn't seem to let you declare something which is not going to be used in the federation, since you have to specify upstream sets for each downstream exchange you declare.

Is it possible to perform generic resource declarations inside the configuration file without exploiting either shovel or federation?


_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/a9d81f3e/attachment.htm>

From simon at rabbitmq.com  Wed Jan  4 17:29:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jan 2012 17:29:49 +0000
Subject: [rabbitmq-discuss] Resource declarations in configuration file
In-Reply-To: <88E590DC4586974D825FC82AE798294E520BDEF0@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E520BDEF0@GSVCLU03.ges.ferlan.it>
Message-ID: <4F048C8D.4080807@rabbitmq.com>

On 04/01/12 16:53, Busoli, Simone wrote:
> Is it possible to perform generic resource declarations inside the
> configuration file without exploiting either shovel or federation?

Not at the moment, although it's yet another of those things we've had 
on the back burner for years...

One way we've thought about implementing this is a feature in mgmt where 
it would automatically read in one of its definition files at startup - 
that way you get users and vhosts too.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mpietrek at skytap.com  Wed Jan  4 18:05:05 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 04 Jan 2012 10:05:05 -0800
Subject: [rabbitmq-discuss] slave_pids and synchronised_slave_pids not
 available from the HTTP api?
In-Reply-To: <CB274A48.25D75%mpietrek@skytap.com>
Message-ID: <CB29D42B.25FC3%mpietrek@skytap.com>

Resending, as I've not seen any response as of yet, and figured that some
folks may have come back online after I sent the original message.

If nothing else, simple yes/no to the question in the Subject: would be
helpful.

Thanks much,

Matt Pietrek

From:  Matt Pietrek <mpietrek at skytap.com>
Date:  Mon, 02 Jan 2012 11:49:28 -0800
To:  "rabbitmq-discuss at lists.rabbitmq.com"
<rabbitmq-discuss at lists.rabbitmq.com>
Cc:  Matt Pietrek <mpietrek at skytap.com>
Subject:  slave_pids and synchronised_slave_pids not available from the HTTP
api?

I'm crafting some custom tooling that needs to know about the sync status of
mirrored queues. Up to this point I've been successfully using the HTTP API
via the rabbitmqadmin module and been able to get everything I need .
However, I'm stymied on slave_pids and  synchronised_slave_pids, which don't
seem to come through.

Per the rabbitmqctl cmd-line help, slave_pid and synchronised_slave_pids are
valid queueinfoitems. Up to this point, queueinfoitem names have worked
equally well with "rabbitmqadmin list queues"

I've simplified the repro case down to the following; Rabbitmqctl displays
these fields as expected:

mpietrek at play:~/work/$rabbitmqctl list_queues consumers messages name
slave_pids synchronised_slave_pids
Listing queues ...
0 0 fake_munger_queue [<rabbit at play2.1.248.0>] [<rabbit at play2.1.248.0>]
0 0 fake_service_2 [<rabbit at play2.1.250.0>] [<rabbit at play2.1.250.0>]
...done.


However, rabbitmqadmin doesn't:

mpietrek at play:~/work/$rabbitmqadmin.py list queues consumers messages name
slave_pids synchronised_slave_pids
+-----------+----------+----------------------+------------+----------------
---------+
| consumers | messages |         name         | slave_pids |
synchronised_slave_pids |
+-----------+----------+----------------------+------------+----------------
---------+
| 0         | 0        | fake_munger_queue    |            |
|
| 0         | 0        | fake_service_2       |            |
|
+-----------+----------+----------------------+------------+----------------
---------+

Is this normal/expected? Am I not understanding something?

FWIW, this is using RabbitMQ 2.71 on Ubuntu 10.04.

Thanks,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/ab7f1e10/attachment.htm>

From simon at rabbitmq.com  Wed Jan  4 18:08:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jan 2012 18:08:29 +0000
Subject: [rabbitmq-discuss] slave_pids and synchronised_slave_pids not
 available from the HTTP api?
In-Reply-To: <CB29D42B.25FC3%mpietrek@skytap.com>
References: <CB29D42B.25FC3%mpietrek@skytap.com>
Message-ID: <4F04959D.1010307@rabbitmq.com>

I replied a few hours ago:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017146.html

Did you not get that?

By the way, here's a first pass at a rabbitmqadmin which fixes the problem:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/83a549d7454c/bin/rabbitmqadmin

Cheers, Simon

On 04/01/12 18:05, Matt Pietrek wrote:
> Resending, as I've not seen any response as of yet, and figured that
> some folks may have come back online after I sent the original message.
>
> If nothing else, simple yes/no to the question in the Subject: would be
> helpful.
>
> Thanks much,
>
> Matt Pietrek
>
> From: Matt Pietrek <mpietrek at skytap.com <mailto:mpietrek at skytap.com>>
> Date: Mon, 02 Jan 2012 11:49:28 -0800
> To: "rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>"
> <rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
> Cc: Matt Pietrek <mpietrek at skytap.com <mailto:mpietrek at skytap.com>>
> Subject: slave_pids and synchronised_slave_pids not available from the
> HTTP api?
>
> I'm crafting some custom tooling that needs to know about the sync
> status of mirrored queues. Up to this point I've been successfully using
> the HTTP API via the rabbitmqadmin module and been able to get
> everything I need . However, I'm stymied on slave_pids and
> synchronised_slave_pids, which don't seem to come through.
>
> Per the rabbitmqctl cmd-line help, slave_pid and synchronised_slave_pids
> are valid queueinfoitems. Up to this point, queueinfoitem names have
> worked equally well with "rabbitmqadmin list queues"
>
> I've simplified the repro case down to the following; Rabbitmqctl
> displays these fields as expected:
>
> mpietrek at play:~/work/$rabbitmqctl list_queues consumers messages name
> slave_pids synchronised_slave_pids
> Listing queues ...
> 00fake_munger_queue[<rabbit at play2.1.248.0
> <mailto:rabbit at play2.1.248.0>>][<rabbit at play2.1.248.0
> <mailto:rabbit at play2.1.248.0>>]
> 00fake_service_2[<rabbit at play2.1.250.0
> <mailto:rabbit at play2.1.250.0>>][<rabbit at play2.1.250.0
> <mailto:rabbit at play2.1.250.0>>]
> ...done.
>
>
> However, rabbitmqadmin doesn't:
>
> mpietrek at play:~/work/$rabbitmqadmin.py list queues consumers messages
> name slave_pids synchronised_slave_pids
> +-----------+----------+----------------------+------------+-------------------------+
> | consumers | messages | name | slave_pids | synchronised_slave_pids |
> +-----------+----------+----------------------+------------+-------------------------+
> | 0 | 0 | fake_munger_queue | | |
> | 0 | 0 | fake_service_2 | | |
> +-----------+----------+----------------------+------------+-------------------------+
>
> Is this normal/expected? Am I not understanding something?
>
> FWIW, this is using RabbitMQ 2.71 on Ubuntu 10.04.
>
> Thanks,
>
> Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From Jim.Langston at compuware.com  Wed Jan  4 18:20:30 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Wed, 4 Jan 2012 18:20:30 +0000
Subject: [rabbitmq-discuss] Is there ever a need for a federation and a
	cluster?
Message-ID: <CB2A0293.C52C%jim.langston@compuware.com>

Hi all,

Given a scenario where the entire environment is identical for
rabbitMQ (same servers, OS's , RMQ versions ? etc) , would there ever
 be a need to have the environment configured for using both
as a cluster, and as a federation ?


From mcumings at narrativescience.com  Wed Jan  4 18:22:52 2012
From: mcumings at narrativescience.com (Michael Cumings)
Date: Wed, 4 Jan 2012 12:22:52 -0600
Subject: [rabbitmq-discuss] Is there ever a need for a federation and a
	cluster?
In-Reply-To: <CB2A0293.C52C%jim.langston@compuware.com>
References: <CB2A0293.C52C%jim.langston@compuware.com>
Message-ID: <CAMscK0ZZRDfxOGA2+BRUTEODdrB4H8H2h-z3qBx99Pc=MUGyDQ@mail.gmail.com>

I'm in the process of setting up multiple clusters, each cluster is in a
different data center separated by WANs.  I don't want to try to cluster
across a WAN connection, but there are some messages that I want to be able
to route to both locations.

On Wed, Jan 4, 2012 at 12:20 PM, Langston, Jim
<Jim.Langston at compuware.com>wrote:

>  Hi all,
>
>  Given a scenario where the entire environment is identical for
> rabbitMQ (same servers, OS's , RMQ versions ? etc) , would there ever
>  be a need to have the environment configured for using both
> as a cluster, and as a federation ?
>
>  From what I've gathered so far, before experimenting, it seems that
> unless there is some sort of mixed environment, clustering is the way
> to go.
>
>  What about if there are two different clusters, w/ different brokers and
> exchanges ? Would you want to use a federation between them ?
>
>  Thanks,
>
>  Jim
>
>  The contents of this e-mail are intended for the named addressee only.
> It contains information that may be confidential. Unless you are the named
> addressee or an authorized designee, you may not copy or use it, or
> disclose it to anyone else. If you received it in error please notify us
> immediately and then destroy it.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/9bbf52e9/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 9440 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/9bbf52e9/attachment.jpeg>

From simon at rabbitmq.com  Wed Jan  4 18:25:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jan 2012 18:25:22 +0000
Subject: [rabbitmq-discuss] Is there ever a need for a federation and
 a	cluster?
In-Reply-To: <CAMscK0ZZRDfxOGA2+BRUTEODdrB4H8H2h-z3qBx99Pc=MUGyDQ@mail.gmail.com>
References: <CB2A0293.C52C%jim.langston@compuware.com>
	<CAMscK0ZZRDfxOGA2+BRUTEODdrB4H8H2h-z3qBx99Pc=MUGyDQ@mail.gmail.com>
Message-ID: <4F049992.9020207@rabbitmq.com>

That's basically it.

See a bit more discussion at: http://www.rabbitmq.com/distributed.html

Cheers, Simon

On 04/01/12 18:22, Michael Cumings wrote:
> I'm in the process of setting up multiple clusters, each cluster is in a
> different data center separated by WANs.  I don't want to try to cluster
> across a WAN connection, but there are some messages that I want to be
> able to route to both locations.
>
> On Wed, Jan 4, 2012 at 12:20 PM, Langston, Jim
> <Jim.Langston at compuware.com <mailto:Jim.Langston at compuware.com>> wrote:
>
>     Hi all,
>
>     Given a scenario where the entire environment is identical for
>     rabbitMQ (same servers, OS's , RMQ versions ? etc) , would there ever
>       be a need to have the environment configured for using both
>     as a cluster, and as a federation ?
>
>      From what I've gathered so far, before experimenting, it seems that
>     unless there is some sort of mixed environment, clustering is the way
>     to go.
>
>     What about if there are two different clusters, w/ different brokers and
>     exchanges ? Would you want to use a federation between them ?
>
>     Thanks,
>
>     Jim
>
>     The contents of this e-mail are intended for the named addressee
>     only. It contains information that may be confidential. Unless you
>     are the named addressee or an authorized designee, you may not copy
>     or use it, or disclose it to anyone else. If you received it in
>     error please notify us immediately and then destroy it.
>
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From jerryk at vmware.com  Wed Jan  4 18:25:33 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 4 Jan 2012 10:25:33 -0800 (PST)
Subject: [rabbitmq-discuss] Is there ever a need for a federation and
	a	cluster?
In-Reply-To: <CB2A0293.C52C%jim.langston@compuware.com>
Message-ID: <a9f171b8-d22d-4f82-a2de-dc0a4b32b40f@StrongMad.local>

Hi, Jim:

It depends on your scenario.

You might want to federate across a WAN; you wouldn't cluster across one, since
the Erlang distribution mechanisms that clustering builds on don't tolerate
partitions and high latency well.

You'd cluster if your goal is to increase the total capacity of your broker,
bearing in mind that the maximum throughput possible through a single queue
won't get larger when you do so.

Federating or Shoveling between different clusters, as you describe, is an 
entirely reasonable thing to do in some circumstances.  Suppose, for example
that you want increased capacity over a single host broker, or mirrored queues,
or the like within each of two WAN-connected datacenters, but still wanted to
be able to pass some subset of your message traffic between the datacenters.

Best regards,
Jerry

----- Original Message -----
From: "Jim Langston" <Jim.Langston at compuware.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 4, 2012 10:20:30 AM
Subject: [rabbitmq-discuss] Is there ever a need for a federation and a	cluster?




Hi all,


Given a scenario where the entire environment is identical for
rabbitMQ (same servers, OS's , RMQ versions ? etc) , would there ever
be a need to have the environment configured for using both
as a cluster, and as a federation ?



From Jim.Langston at compuware.com  Wed Jan  4 18:35:08 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Wed, 4 Jan 2012 18:35:08 +0000
Subject: [rabbitmq-discuss] Is there ever a need for a federation and a
 cluster?
In-Reply-To: <4F049992.9020207@rabbitmq.com>
Message-ID: <CB2A04C2.C538%jim.langston@compuware.com>

This is the one that caught my attention, since the federation description
is what I currently have , two clusters, each independent, but need to
exchange the messages. The are on the same LAN , just have different jobs
to do. This was the place I saw that federation was the way to do it, I
thought
maybe combining the clusters into one would do it as well, but I didn't see
where that was doable, even given that everything is identical as far as
configurations.

Jim

On 1/4/12 1:25 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>That's basically it.
>
>See a bit more discussion at: http://www.rabbitmq.com/distributed.html
>
>Cheers, Simon
>
>On 04/01/12 18:22, Michael Cumings wrote:
>> I'm in the process of setting up multiple clusters, each cluster is in a
>> different data center separated by WANs.  I don't want to try to cluster
>> across a WAN connection, but there are some messages that I want to be
>> able to route to both locations.
>>
>> On Wed, Jan 4, 2012 at 12:20 PM, Langston, Jim
>> <Jim.Langston at compuware.com <mailto:Jim.Langston at compuware.com>> wrote:
>>
>>     Hi all,
>>
>>     Given a scenario where the entire environment is identical for
>>     rabbitMQ (same servers, OS's , RMQ versions ? etc) , would there
>>ever
>>       be a need to have the environment configured for using both
>>     as a cluster, and as a federation ?
>>
>>      From what I've gathered so far, before experimenting, it seems that
>>     unless there is some sort of mixed environment, clustering is the
>>way
>>     to go.
>>
>>     What about if there are two different clusters, w/ different
>>brokers and
>>     exchanges ? Would you want to use a federation between them ?
>>
>>     Thanks,
>>
>>     Jim
>>
>>     The contents of this e-mail are intended for the named addressee
>>     only. It contains information that may be confidential. Unless you
>>     are the named addressee or an authorized designee, you may not copy
>>     or use it, or disclose it to anyone else. If you received it in
>>     error please notify us immediately and then destroy it.
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jared.biel at bolderthinking.com  Wed Jan  4 19:18:05 2012
From: jared.biel at bolderthinking.com (Jared Biel)
Date: Wed, 4 Jan 2012 13:18:05 -0600
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <4F04551F.9070302@rabbitmq.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>
	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
	<CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>
	<4F04551F.9070302@rabbitmq.com>
Message-ID: <CAHoS6UY3KupXEo0N-gf8y2RjfEcRq5GOsgELMbk4JkiGJtBjnw@mail.gmail.com>

Excellent - this did get me quite a bit farther. It looks like
erlang-nox should indeed be a build dependency. I ran up against
another error during the build process:
"erlang-rfc4627-wrapper/erlang-rfc4627-git/src/rfc4627_jsonrpc_inets.erl:97:
can't find include lib "inets/src/httpd.hrl""

The file httpd.hrl is part of the erlang-src package. After installing
this as well I was able to successfully build. If you want to be
complete in satisfying build dependencies, I also needed to install
zip, unzip and nmap.

So, here's the complete list of missing build dependencies:
erlang-nox, erlang-src, nmap, unzip, zip.

Thanks for all of your help!

-Jared

On Wed, Jan 4, 2012 at 07:33, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 03/01/12 19:40, Jared Biel wrote:
>>
>> It seems that some of the plugins have erlc issues while building.
>
>
> Hmm. It';s possible that our Debian control file is wrong - we list
> erlang-nox under "Depends" (which is correct) but erlang-dev under
> "Build-Depends". erlang-dev doesn't drag in all the libraries implied by
> erlang-nox, which was definitely what caused your problem with eldap and
> probably the other problems you saw. I'll file a bug.
>
> Can you build from the Debian source if you install erlang-nox?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jared.biel at bolderthinking.com  Wed Jan  4 19:32:44 2012
From: jared.biel at bolderthinking.com (Jared Biel)
Date: Wed, 4 Jan 2012 13:32:44 -0600
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <CAHoS6UY3KupXEo0N-gf8y2RjfEcRq5GOsgELMbk4JkiGJtBjnw@mail.gmail.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>
	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
	<CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>
	<4F04551F.9070302@rabbitmq.com>
	<CAHoS6UY3KupXEo0N-gf8y2RjfEcRq5GOsgELMbk4JkiGJtBjnw@mail.gmail.com>
Message-ID: <CAHoS6UbkYDxvdjZg3ri8Ss5Lm61uzL-ASQCoKzapdDLLcCcOQg@mail.gmail.com>

I'd like to take this opportunity to add some things to my debian
package wishlist:

1. An /etc/default/rabbitmq file that contains something like START=no
2. Modification to rabbitmq-server.init to make use of that file so
rabbitmq won't start unless START is equal to a true value.

This construct is a part of many other debian daemons and is generally
well understood/accepted. In fact the rabbitmq postrm script currently
takes this file into account already. We make this modification to the
package and put it in our repo because if rabbitmq starts before we
drop our cookie into place (for cluster membership) Bad Things happen.

Thanks,
Jared

On Wed, Jan 4, 2012 at 13:18, Jared Biel <jared.biel at bolderthinking.com> wrote:
> Excellent - this did get me quite a bit farther. It looks like
> erlang-nox should indeed be a build dependency. I ran up against
> another error during the build process:
> "erlang-rfc4627-wrapper/erlang-rfc4627-git/src/rfc4627_jsonrpc_inets.erl:97:
> can't find include lib "inets/src/httpd.hrl""
>
> The file httpd.hrl is part of the erlang-src package. After installing
> this as well I was able to successfully build. If you want to be
> complete in satisfying build dependencies, I also needed to install
> zip, unzip and nmap.
>
> So, here's the complete list of missing build dependencies:
> erlang-nox, erlang-src, nmap, unzip, zip.
>
> Thanks for all of your help!
>
> -Jared
>
> On Wed, Jan 4, 2012 at 07:33, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 03/01/12 19:40, Jared Biel wrote:
>>>
>>> It seems that some of the plugins have erlc issues while building.
>>
>>
>> Hmm. It';s possible that our Debian control file is wrong - we list
>> erlang-nox under "Depends" (which is correct) but erlang-dev under
>> "Build-Depends". erlang-dev doesn't drag in all the libraries implied by
>> erlang-nox, which was definitely what caused your problem with eldap and
>> probably the other problems you saw. I'll file a bug.
>>
>> Can you build from the Debian source if you install erlang-nox?
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Wed Jan  4 21:16:52 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 4 Jan 2012 22:16:52 +0100
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate
	Messages
Message-ID: <CAOn7oW-GLeEDyjbbL_L+tyhj-kLjjsb0Epy2R2i5pmv_8kNc0A@mail.gmail.com>

Hi John, I understand your purpose now, and unfortunately I don't think
it's going to be easy to achieve that if you don't federate the brokers
with each other in a symmetric fashion.
I am also wondering if that would be advisable at all nonetheless, it would
become quite difficult to visualize how messages are flowing around.

Anyway keep in mind that federated exchanges can also be configured
dynamically over AMQP, therefore as long as you keep the hosts fixed (those
need to be in the configuration files) you can federate more exchanges as
you go.
I'm not sure this satisfies your requirements by the way.
On Jan 4, 2012 1:27 PM, "Letourneau, John P (John)" <
john.letourneau at alcatel-lucent.com> wrote:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/171cbeba/attachment.htm>

From simone.busoli at gmail.com  Wed Jan  4 21:23:34 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 4 Jan 2012 22:23:34 +0100
Subject: [rabbitmq-discuss] Resource declarations in configuration file
Message-ID: <CAOn7oW-m=L8wpJqsFEzh2yTQ_R=mfoKmN9XbwuYoO0cQMGpjgQ@mail.gmail.com>

Hi Simon, yes that would be really useful to ease operations. It is
specifically nice to be able to deploy a package which autoconfigures
itself when starting up, instead of requiring manual operations once it's
running.

Out of curiosity, is there a issue tracker or anything similar where it is
possible to follow what's being worked on and the priorities of the tasks
in the backlog?
On Jan 4, 2012 6:30 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/00e9f8ac/attachment.htm>

From deckerego at gmail.com  Thu Jan  5 05:08:37 2012
From: deckerego at gmail.com (DeckerEgo)
Date: Wed, 4 Jan 2012 21:08:37 -0800 (PST)
Subject: [rabbitmq-discuss] [announcement] Release 1.0 of Camel Spring AMQP
	component
Message-ID: <e2771791-04a8-4853-ae08-a153d22451ae@b32g2000yqn.googlegroups.com>

The camel-spring-amqp component previously posted on this list has
finally hit Release 1.0 and has been pushed to Sonatype's central
Maven servers for general use. Binaries can be downloaded directly
from https://github.com/Bluelock/camel-spring-amqp or you can point
your local neighborhood POM to the camel-spring-amqp artifact.

This release has undergone integration testing and is ready for
everyone to try out. Release 1.1 is already underway; pull requests,
bug reports and suggestions are always welcome!

From uday.subbarayan at yahoo.com  Thu Jan  5 05:42:03 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Wed, 4 Jan 2012 21:42:03 -0800 (PST)
Subject: [rabbitmq-discuss] How to attach C++ library?
Message-ID: <1325742123.3702.YahooMailNeo@web44916.mail.sp1.yahoo.com>

Hi All,
? ? Happy New Year.

We have a C++ library which is currently used inside a product. We want to convert this library in to a socket based server and connect to Rabbit MQ so that it can consume & publish messages from the clients.

Has any one done any similar work?

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120104/c57c911e/attachment.htm>

From brett.r.cameron at gmail.com  Thu Jan  5 07:48:10 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 5 Jan 2012 20:48:10 +1300
Subject: [rabbitmq-discuss] How to attach C++ library?
In-Reply-To: <1325742123.3702.YahooMailNeo@web44916.mail.sp1.yahoo.com>
References: <1325742123.3702.YahooMailNeo@web44916.mail.sp1.yahoo.com>
Message-ID: <CALPqkip0awmgkJxeH0saPL2On=ZSap3+arVKX-30rW0bz4BkNA@mail.gmail.com>

Uday,

You should be able to do this using the C API (
http://www.rabbitmq.com/c-client.html). What OS are you using? When you say
that you want to convert the C++ code into a "socket based server", will it
be acting purely as a consumer of messages (no response), or will it be
operating in some sort of request/response (RPC) fashion?

Brett


On Thu, Jan 5, 2012 at 6:42 PM, Uday Subbarayan
<uday.subbarayan at yahoo.com>wrote:

> Hi All,
>     Happy New Year.
>
> We have a C++ library which is currently used inside a product. We want to
> convert this library in to a socket based server and connect to Rabbit MQ
> so that it can consume & publish messages from the clients.
>
> Has any one done any similar work?
>
> Thanks,
> -Uday.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120105/013fb047/attachment.htm>

From simon at rabbitmq.com  Thu Jan  5 10:24:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jan 2012 10:24:26 +0000
Subject: [rabbitmq-discuss] Resource declarations in configuration file
In-Reply-To: <CAOn7oW-m=L8wpJqsFEzh2yTQ_R=mfoKmN9XbwuYoO0cQMGpjgQ@mail.gmail.com>
References: <CAOn7oW-m=L8wpJqsFEzh2yTQ_R=mfoKmN9XbwuYoO0cQMGpjgQ@mail.gmail.com>
Message-ID: <4F057A5A.8070506@rabbitmq.com>

On 04/01/12 21:23, Simone Busoli wrote:
> Out of curiosity, is there a issue tracker or anything similar where it
> is possible to follow what's being worked on and the priorities of the
> tasks in the backlog?

No, not yet.

Although this is probably going from badly-overdue to 
oh-my-god-it-needs-to-happen-now. We'll see...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  5 10:32:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jan 2012 10:32:40 +0000
Subject: [rabbitmq-discuss] x509 Authentication
In-Reply-To: <bw71ury1ja7.fsf@mail.cern.ch>
References: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>	<4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46@EXMBX03.austin.utexas.edu>
	<bw71ury1ja7.fsf@mail.cern.ch>
Message-ID: <4F057C48.80300@rabbitmq.com>

On 21/12/11 07:22, Lionel Cons wrote:
> It would really be good to improve X.509 authentication in a consistent
> way in RabbitMQ. Things I can think of:
>   - use common code between AMQP and STOMP

Yes.

>   - use DN rather than CN, maybe via a configurable option

Yes.

>   - standard DN cleanup (such as your quotes removal)

Umm, really? The question of how to canonically construct a string 
representation of a DN is annoyingly fiddly, but I really don't believe 
removing quotes is likely to be a part of it.

We'd probably have to aim for "whatever OpenSSL does" and "whatever 
Active Directory does" as goals for how to do it. Let us pray to the god 
of ASN.1 (some sort of Eldritch abomination I'm sure) that both of those 
are the same thing...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  5 10:36:56 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jan 2012 10:36:56 +0000
Subject: [rabbitmq-discuss] Building RabbitMQ for AMQP 1.0 (?)
In-Reply-To: <33029721.post@talk.nabble.com>
References: <33029721.post@talk.nabble.com>
Message-ID: <4F057D48.7010201@rabbitmq.com>

That error looks like you have not got the appropriate branch of 
rabbitmq-codegen, or (more likely perhaps) that you built -server and/or 
-erlang-client against default first. If you are definitely on the right 
branch, clean *everything* and rebuild.

Cheers, Simon

On 23/12/11 15:05, mexxik wrote:
>
> Hello!
>
> I know, that AMQP 1.0 is not released yet, and Rabbit's plugin for that
> protocol version is very experimental, but still: have anyone tried to build
> this plugin?
>
> The description says, that it requires bug23749 of rabbitmq-server and
> rabbitmq-codegen, but even after using those branches, I wasn't able to
> successfully build the plugin in.
>
> The compiler throws an Error 1:
> src/rabbit_amqp1_0_outgoing_link.erl:36: record 'basic.credit' undefined
> src/rabbit_amqp1_0_outgoing_link.erl:73: record 'basic.credit_state'
> undefined
> src/rabbit_amqp1_0_outgoing_link.erl:78: variable 'Available0' is unbound
> src/rabbit_amqp1_0_outgoing_link.erl:89: variable 'Count' is unbound
> src/rabbit_amqp1_0_outgoing_link.erl:90: variable 'LinkCredit' is unbound
> src/rabbit_amqp1_0_outgoing_link.erl:92: variable 'Drain' is unbound
> src/rabbit_amqp1_0_outgoing_link.erl:108: record 'basic.credit_ok' undefined
> src/rabbit_amqp1_0_outgoing_link.erl:110: record 'basic.credit' undefined
> src/rabbit_amqp1_0_outgoing_link.erl:114: variable 'Available' is unbound
> src/rabbit_amqp1_0_outgoing_link.erl:32: Warning: variable 'Count' is unused
> src/rabbit_amqp1_0_outgoing_link.erl:107: Warning: variable 'CTag' is unused
>
> I "don't speak" Erlang, but looks like something is missing in the
> rabbitmq-amqp1.0 plugin source code.
>
> ... I am just eager to try AMQP 1.0 now, even in experimental mode. :)
>
> Thanks
> Max


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  5 10:38:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jan 2012 10:38:27 +0000
Subject: [rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the
 .NET client
In-Reply-To: <c7288b20-ff6e-4929-b0fd-f7901432df09@d10g2000vbk.googlegroups.com>
References: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>	<4c33908a-5e73-4b7f-b7cb-e691aed256f6@y7g2000vbe.googlegroups.com>	<c9696d25-4acc-4d3e-b5e4-a28362dd1dae@d10g2000vbk.googlegroups.com>	<b5f96060-d33b-4339-9ace-5971453ee57a@z17g2000vbe.googlegroups.com>
	<c7288b20-ff6e-4929-b0fd-f7901432df09@d10g2000vbk.googlegroups.com>
Message-ID: <4F057DA3.70707@rabbitmq.com>

Somewhat weirdly that's not how our local AD server seems to be doing 
things. But this is clearly a problem. I think 
rabbitmq_auth_mechanism_ssl needs to switch to using DNs...

Cheers, Simon

On 30/12/11 19:52, John Ruiz wrote:
> See this stackoverflow thread for more information:
>
> http://stackoverflow.com/questions/8683006/this-erlang-code-throws-an-exception-and-i-dont-know-why
>
> Since this is the way that Windows Domains operate out of the box, I
> suggest that instead of writing the code such that it throws an
> exception, it instead concatenates any CN strings it finds.
>
> At least this way I could have created a "Users John Ruiz" or "John
> Ruiz Users" user in RabbitMQ and it would work.  With the
> implementation as it stands today, I would need to create my own OU in
> AD and then redirect the users container following this article:
> http://support.microsoft.com/kb/324949.
>
> The problem is the note at the bottom of that article:
>
> "Some applications require specific security principals to be located
> in default containers like CN=Users or CN=Computers. Verify that your
> applications have such dependencies before you move them out of the
> CN=users and CN=computes containers."
>
> I have already discovered that I cannot move my service accounts
> outside of the CN=users container or else many of my Constrained
> Delegation scenarios no longer work. (More on constrained delegation
> of kerberos credentials here: http://technet.microsoft.com/en-us/library/cc739587%28WS.10%29.aspx).
>
> On Dec 30, 11:48 am, John Ruiz<jr... at johnruiz.com>  wrote:
>> I have a certificate with the following Subject:
>> "CN=John Ruiz, CN=Users, DC=devexample, DC=com"
>>
>> When you look at rabbit_ssl.erl's find_by_type function, (this is my
>> first time seeing erlang code, btw) I notice that there's a "<-
>> lists:flatten(RDNs)" line.  I don't know what the result of
>> lists:flatten will be.  This is probably why the connection suddenly
>> ends... the user I've created for rabbit isn't matching what the cert
>> says.
>>
>> Can anyone help me?
>>
>> On Dec 30, 11:19 am, John Ruiz<jr... at johnruiz.com>  wrote:
>>
>>
>>
>>
>>
>>
>>
>>> Now that I have all of this working, I need to switch over from an
>>> openssl-based CA to our production CA, which is Active Directory
>>> Certificate Services.  All certificates are issued by the subordinate
>>> enterprise CA -->  ISSUE01.devexample.com.
>>
>>> I have a certificate for myself in my personal store on
>>> DC01.devexample.com (Windows Server).
>>
>>> The RabbitMQ Service runs as Local System on APP01.devexample.com
>>> (Windows Server) so there's a certificate for APP01.devexample.com in
>>> the Local Computer's Personal store.
>>
>>> The Root CA certificate is already in Trusted Root Certs on all
>>> machines in the domain devexample.com.  The ISSUE01 CA cert is in the
>>> Intermediate Certification Authority store everywhere as well.
>>
>>> I have exported the Root CA cert to a DER file and then moved it to a
>>> linux machine where I used openssl to convert it to PEM.  I then moved
>>> it back to APP01.  Next, I exported APP01's cert (with private key) to
>>> a PFX file, moved it to a linux machine and extracted the signed
>>> public key cert and the private key cert.
>>
>>> # extract the private key (still password protected)
>>> openssl.exe pkcs12 -in publicAndprivate.pfx -nocerts -out
>>> privateKey.pem
>>
>>> # extract the public cert
>>> openssl.exe pkcs12 -in publicAndprivate.pfx -clcerts -nokeys -out
>>> app01.pem
>>
>>> # remove the password protection
>>> openssl.exe rsa -in privateKey.pem -out app01-private.pem
>>
>>> I moved all of these PEMs back to APP01 -- the CA's public cert,
>>> APP01's public cert, and APP01's private key.  Here is my
>>> rabbitmq.config
>>
>>> [
>>>    {rabbit, [
>>>       {auth_mechanisms,['EXTERNAL']},
>>>       {ssl_listeners, [5671]},
>>>       {ssl_options, [{cacertfile,"C:/Keys/pki-root-ca.pem"},
>>>                      {certfile,"C:/Keys/app01.pem"},
>>>                      {keyfile,"C:/Keys/app01-private.pem"},
>>>                      {verify,verify_peer},
>>>                      {fail_if_no_peer_cert,true}]}
>>>     ]}
>>> ].
>>
>>> When I run the code that I've already listed in my blog post, I get
>>> this exception:http://pastebin.com/9USFHWzf
>>
>>> In the rabbit log, I see this:http://pastebin.com/GsWsxLGV
>>
>>> As far as I can tell, I've done everything correctly.  I've ensured
>>> that my code references APP01.devexample.com, exactly as it appears on
>>> the certificate (Subject: CN = APP01.devexample.com).
>>
>>> What should I do/try?
>>
>>> Please help!
>>
>>> On Dec 27, 4:22 pm, John Ruiz<jr... at johnruiz.com>  wrote:
>>
>>>> I have figured it out.  There were two issues.
>>
>>>> 1. Add the external mechanism factory to your connection factory's
>>>> auth mechanisms
>>>>      i.e. -- cf.AuthMechanisms = new AuthMechanismFactory[] { new
>>>> ExternalMechanismFactory() };
>>
>>>> 2. Configure the server's auth_mechanisms variable in your
>>>> rabbitmq.config.
>>>>      Here is my complete rabbitmq.config:
>>
>>>> [
>>>>    {rabbit, [
>>>>       {auth_mechanisms,['EXTERNAL']},
>>>>       {ssl_listeners, [5671]},
>>>>       {ssl_options, [{cacertfile,"C:/Path/To/Your/cacert.pem"},
>>>>                      {certfile,"C:/Path/To/Your/cert.pem"},
>>>>                      {keyfile,"C:/Path/To/Your/key.pem"},
>>>>                      {verify,verify_peer},
>>>>                      {fail_if_no_peer_cert,true}]}
>>>>     ]}
>>>> ].
>>
>>>> On Dec 27, 1:16 pm, John Ruiz<jr... at johnruiz.com>  wrote:
>>
>>>>> Hi All,
>>
>>>>> I've successfully followed the SSL tutorial and gotten my .NET client
>>>>> to connect, send, and receive messages over SSL.  See my blog for the
>>>>> code:http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbi....
>>
>>>>> As the next step, I enabled the plugin "rabbitmq_auth_mechanism_ssl"
>>>>> and then re-installed the Windows Service.  Then I re-ran the code I
>>>>> have listed in my blog -- with the addition of a Console.ReadLine() at
>>>>> the end of my using statements so I can see the connection details in
>>>>> the management web app.
>>
>>>>> I am still connecting as guest.  What do I need to do in order to
>>>>> connect as the CN of the Subject on my certificate?
>>
>>>>> Thanks!
>>>>> ~ jR
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  5 10:42:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jan 2012 10:42:06 +0000
Subject: [rabbitmq-discuss] Federating distributed RabbitMQ brokers
In-Reply-To: <CAHrXUcXRm5BuX6XR7u-Bx2w4dpFXgdSrkbKhbTO57BGki99U6Q@mail.gmail.com>
References: <CAHrXUcXRm5BuX6XR7u-Bx2w4dpFXgdSrkbKhbTO57BGki99U6Q@mail.gmail.com>
Message-ID: <4F057E7E.8020200@rabbitmq.com>

On 21/12/11 15:02, Iain Emsley wrote:
> Slightly following on from my earlier mail regarding getting ActiveMQ
> and RabbitMQ talking to each other, I'm looking at the way that our
> brokers operate.
>
> As I'm pushing messages across firewalls, is it considered best practice
> to have a central broker and SSL/VPN tunnel to allow the consumer in the
> different zones or to have a Rabbit broker in each zone and federate
> them, leaving the consumers to listen to messages in their own zone?

To some extent the answer is always "it depends".

A single broker is simpler to set up and think about. If your clients 
can cope with WAN links going down and your message rates are low enough 
to fit within a single broker this is always going to be the simplest 
thing to do. Otherwise you'll want to federate.

> With the second option of having a broker in each zone, I assume from my
> reading on the plugins site that the RabbitMQ federation plugin would be
> the best option into terms of ensuring that messages sent to an
> exchange/queue can be transferred to the correct broker  using amqp+ssl?
> If I split the traffic across vhosts, can these be  aded to the
> federation (i.e. If I want to split up traffic coming from different
> systems?)

Sure - federation works on a per-exchange basis.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  5 10:44:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jan 2012 10:44:32 +0000
Subject: [rabbitmq-discuss] Federation Configuration and Duplicate
	Messages
In-Reply-To: <5D476051A786C040BF0D9CB87BCBE3AA0597617446@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
References: <5D476051A786C040BF0D9CB87BCBE3AA0597525464@USNAVSXCHMBSB3.ndc.alcatel-lucent.com><88E590DC4586974D825FC82AE798294E520BDA65@GSVCLU03.ges.ferlan.it><5D476051A786C040BF0D9CB87BCBE3AA05975254A4@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>	<CAOn7oW_EbZtN-1wdNa-hiNV17GiFz6nutbux4rQtKPU=bs1Gcw@mail.gmail.com>	<5D476051A786C040BF0D9CB87BCBE3AA0597617438@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>	<88E590DC4586974D825FC82AE798294E520BDD7C@GSVCLU03.ges.ferlan.it>
	<5D476051A786C040BF0D9CB87BCBE3AA0597617446@USNAVSXCHMBSB3.ndc.alcatel-lucent.com>
Message-ID: <4F057F10.4020002@rabbitmq.com>

We'd like to make managing big federated networks easier. At some point 
we will want to make it possible to modify the federation config of a 
broker without restarting it. In terms of managing the federation as a 
whole, you may want to look into something like puppet or chef.

Another thing we'd like to add in the future (as always, subject to 
resource constraints) is loop detection in federation - this would 
alleviate your problem I imagine.

Cheers, Simon

On 04/01/12 12:27, Letourneau, John P (John) wrote:
> Simone,
>
> Ah, sorry I missed the suggestion to configure a fully interconnected
> network.
>
> Yes that would work. However it becomes an administrative nightmare as
> nodes are added to the network.
>
> Therefore I don?t think this is viable.
>
> -John
>
> *From:*Busoli, Simone [mailto:Simone.Busoli at ferrari.com]
> *Sent:* Wednesday, January 04, 2012 7:02 AM
> *To:* Letourneau, John P (John); Simone Busoli
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* RE: [rabbitmq-discuss] Federation Configuration and Duplicate
> Messages
>
> That?s true with your current configuration, but if you federate each
> broker with the other two like I suggested it is going to work.
>
> *From:*Letourneau, John P (John)
> [mailto:john.letourneau at alcatel-lucent.com]
> *Sent:* mercoled? 4 gennaio 2012 12:54
> *To:* Simone Busoli
> *Cc:* Busoli, Simone; rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* RE: [rabbitmq-discuss] Federation Configuration and Duplicate
> Messages
>
> Simone,
>
> If I were to set hops=1, then a message posted at N1 would go to N2 but
> will NOT go to N3. This has been verified.
>
> Similarly a message posted at N3 would go to N2 but NOT go to N1.
>
> -John
>
> *From:*Simone Busoli [mailto:simone.busoli at gmail.com]
> *Sent:* Tuesday, January 03, 2012 3:16 PM
> *To:* Letourneau, John P (John)
> *Cc:* Busoli, Simone; rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] Federation Configuration and Duplicate
> Messages
>
> Inline
>
> On Jan 3, 2012 4:52 PM, "Letourneau, John P (John)"
> <john.letourneau at alcatel-lucent.com
> <mailto:john.letourneau at alcatel-lucent.com>> wrote:
>  >
>  > Well, perhaps a bit more about my configuration 8-)
>  >
>  > 3 nodes?call them N1, N2, N3.
>  >
>  > On each I have federation configured.
>  >
>  > N2 ? exchange log, connects to N1/log and N3/log
>  >
>  > N3 ? exchange log, connects to N2/log
>  >
>  > Right now I cannot seem to have the N1 exchange log connect to
> N2/log; will need to find out why sometime.
>  >
>  > I do it this way so that regardless of where the producer of the log
> message is, everyone everywhere will see it.
>
> If this is your aim, can't you simply federate the log exchange on each
> broker with the other two and set max hops to 1?
>
>  >
>  >
>  >
>  > Each layer in the hierarchy only knows about nodes in adjacent
> layers?N2 being the busy one with a layer above and below.
>  >
>  > If everyone has hops=1, sending a log message to N1/log will only go
> to N2 and not N3 [this is correct].
>  >
>  > Setting hops=4, sending a log to N1/log will go to N2 and N3?it will
> also be returned to N2 thus a consumer on N2 will see the original msg
> AND the one sent via N2/N3 federation link. Also N3 sees it twice also
> for a total of once on N1, twice on N2, and twice on N3?the message took
> a total of 4 hops.
>  >
>  >
>  >
>  > So, this is what I mean by ?one might expect? 8-)
>  >
>  > -John
>  >
>  >
>  >
>  > From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com
> <mailto:Simone.Busoli at ferrari.com>]
>  > Sent: Tuesday, January 03, 2012 10:23 AM
>  > To: Letourneau, John P (John); rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>  > Subject: RE: Federation Configuration and Duplicate Messages
>  >
>  >
>  >
>  > Hi John, I?m not sure about this:
>  >
>  >
>  >
>  > As one might expect, this sometimes results in the message being seen
>  >1 time at some clients.
>  >
>  >
>  >
>  > It shouldn?t be the expected behavior except for certain scenarios
> (i.e. disconnection of the brokers). Am I missing something perhaps?
>  >
>  >
> _________________________________________________________________________________________________________________
>  > Questo messaggio e da intendersi esclusivamente ad uso del
> destinatario e puo contenere informazioni che sono di natura
> privilegiata, confidenziale
>  > o non divulgabile secondo le leggi vigenti. Se il lettore del
> presente messaggio non e il destinatario designato, o il
> dipendente/agente responsabile
>  > per la consegna del messaggio al destinatario designato, si informa
> che ogni disseminazione, distribuzione o copiatura di questa
> comunicazione e
>  > strettamente proibita anche ai sensi del decreto legislativo 196/03 .
> Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
>  > immediatamente a mezzo e-mail di risposta e successivamente di
> procedere alla cancellazione di questa e-mail e relativi allegati dal
> vostro sistema.
>  >
> _________________________________________________________________________________________________________________
>  > This message is intended only for the use of the addressee and may
> contain information that is privileged, confidential and exempt from
>  > disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the
>  > message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
>  > prohibited. If you have received this e-mail in error, please notify
> us immediately by return e-mail and delete this e-mail and all
> attachments from
>  > your system.
>  >
> _________________________________________________________________________________________________________________
>  >
>  >
>  > _______________________________________________
>  > rabbitmq-discuss mailing list
>  > rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>  > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >
>
> _________________________________________________________________________________________________________________
> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario
> e pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
> messaggio non ? il destinatario designato, o il dipendente/agente
> responsabile
> per la consegna del messaggio al destinatario designato, si informa che
> ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may
> contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
> immediately by return e-mail and delete this e-mail and all attachments
> from
> your system.
> _________________________________________________________________________________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  5 10:48:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jan 2012 10:48:51 +0000
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <CAHoS6UbkYDxvdjZg3ri8Ss5Lm61uzL-ASQCoKzapdDLLcCcOQg@mail.gmail.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>	<CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>	<4F04551F.9070302@rabbitmq.com>	<CAHoS6UY3KupXEo0N-gf8y2RjfEcRq5GOsgELMbk4JkiGJtBjnw@mail.gmail.com>
	<CAHoS6UbkYDxvdjZg3ri8Ss5Lm61uzL-ASQCoKzapdDLLcCcOQg@mail.gmail.com>
Message-ID: <4F058013.6070206@rabbitmq.com>

On 04/01/12 19:32, Jared Biel wrote:
> 1. An /etc/default/rabbitmq file that contains something like START=no
> 2. Modification to rabbitmq-server.init to make use of that file so
> rabbitmq won't start unless START is equal to a true value.

Hmm. I have to admit to not being a Debian packaging expert but is this 
how things are meant to work? If I apt-get install apache2 or mysql, 
then by the time apt has done its work I have a running server.

So I think if we did this then we would want to default to START=yes or 
else lots of people would turn up on this mailing list saying "I just 
installed rabbitmq-server and nothing happened!". And if we do that then 
why not just use update-rc.d?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  5 10:51:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jan 2012 10:51:57 +0000
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <CAHoS6UY3KupXEo0N-gf8y2RjfEcRq5GOsgELMbk4JkiGJtBjnw@mail.gmail.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>	<CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>	<4F04551F.9070302@rabbitmq.com>
	<CAHoS6UY3KupXEo0N-gf8y2RjfEcRq5GOsgELMbk4JkiGJtBjnw@mail.gmail.com>
Message-ID: <4F0580CD.4060102@rabbitmq.com>

On 04/01/12 19:18, Jared Biel wrote:
> So, here's the complete list of missing build dependencies:
> erlang-nox, erlang-src, nmap, unzip, zip.

Oh, and thanks for this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Thu Jan  5 11:01:23 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 5 Jan 2012 11:01:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ to the browser - scale question
In-Reply-To: <b2f00a6e-4af2-4929-a9e0-01b838e29122@u5g2000vbd.googlegroups.com>
References: <b2f00a6e-4af2-4929-a9e0-01b838e29122@u5g2000vbd.googlegroups.com>
Message-ID: <CABzX+qwf=T_YW3SGL+-ic4mGL_YzL6sj4AGGBnyWd6DmM-MgjA@mail.gmail.com>

On Wed, Dec 21, 2011 at 01:28, monosodiumg <monosodiumg at gmail.com> wrote:
> My use case is distributing data updates ?to user's browsers. Typical
> initial load of 5KB and updates of <200B at a rate of 0.5 updates/s.
> I have 500 topics and 1M browser clients, with a very uneven sub
> profile ?e.g. 30% of users subscribing to the same one topic. Most
> users subscribe to just one topic. Clients using browsers are a bit
> erratic.

Outgoing messages = 1M * 0.5 msg/sec = 500K msg/sec

A normal RabbitMQ broker should handle around 30K msg/sec.
With a strong box, new Erlang and HIPE enabled you should
be able to get up to 50K msg/sec per box.

So, for your needs you should consider partitioning the clients
and using mulitple brokers. As far as I understand most messages
are broadcasted (you mentioned 500 topics). Just forwarding
all messages to all brokers should do (as far as the rate of
produced messages is reasonable, let's say few K msg/sec).

By using multiple brokers you also will gain a bit of fault tolerance.

Outgoing throughput = 5KB * churn_rate_per_sec + 1M clients * 200B * 0.5 sec
  - that's around 100MiB/s

Yes, you should use multiple brokers :)

> I have a few questions:
> 1. Can RabbitMQ handle that load?

Use mutliple brokers and publish all messages to all of them.

> 2. What is the roadmap for rabbitmq_jsonrpc_channel?

As you may see from the commit history we're not heavily
working on it at the minute. We're considering creating a plugin
that would combine SockJS and rabbitmq-stomp plugin, in order to
allow some form of web messaging.

> 3. How does RabbitMQ (+jsonrpc plugin) deal with browser clients
> failing to disconnect explicitly?

Frankly - I don't know!

> 4. What does this mean for thread and socket counts server-side?

Erlang/Rabbit don't use too much operating system threads, don't worry
about that.
But Erlang does use a thing called "erlang processes", and there is a
preconfigured limit for that. If you're considering starting many connections
against a single RabbitMQ broker you may consider updating that limit.

Socket limit is on most unix-es set to 1024. Feel free to modify this
number using `ulimit -n`.

Additionally, rabbitmq-management plugin shows files/sockets counters,
you can use that to see how rabbit is doing and how many file descriptors
are still available.

Cheers,
   Marek

From majek04 at gmail.com  Thu Jan  5 11:12:58 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 5 Jan 2012 11:12:58 +0000
Subject: [rabbitmq-discuss] AMPQ Info Script Added to Nmap
In-Reply-To: <CABzX+qz9sJsMsZZu_bffND=Aj3M5yF7SXTTKK=mYFRB5VuBkwQ@mail.gmail.com>
References: <21841325.862.1325613233770.JavaMail.geo-discussion-forums@vbw20>
	<CABzX+qz9sJsMsZZu_bffND=Aj3M5yF7SXTTKK=mYFRB5VuBkwQ@mail.gmail.com>
Message-ID: <CABzX+qyX4uqMxZnXZUFE-BcaVpe+wbzE1RETg+tW1fY4LxL1Xg@mail.gmail.com>

On Tue, Jan 3, 2012 at 17:53, Joseph Marlin <joseph.a.marlin at gmail.com> wrote:
> Just a fun fact for you, in case you ever find it useful: A new version of
> NMAP was just released today, and it includes a script called amqp-info
> which gathers a list of server properties from an AMQP server.
>
> Here is an example output from a scan I ran on one of our test nodes:
>
> Nmap scan report for target
> Host is up (0.00092s latency).
> PORT     STATE SERVICE
> 5672/tcp open  amqp
> [...]
> More info: http://seclists.org/nmap-dev/2012/q1/23

Cool! It was on my TODO list for quite a while, nice to hear that the
script got done by someone else :)

Cheers,
 Marek

From majek04 at gmail.com  Thu Jan  5 11:15:07 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 5 Jan 2012 11:15:07 +0000
Subject: [rabbitmq-discuss] New to Rabbit MQ
In-Reply-To: <26C1D439C1BCAC43A317AD69C4BE2F910149F45C@USLAEX40.wedbush.com>
References: <26C1D439C1BCAC43A317AD69C4BE2F910149F45C@USLAEX40.wedbush.com>
Message-ID: <CABzX+qxPWb8khFayrBSmHiLR6oUp4o=K9F_rAoTjU4oE5RCBDA@mail.gmail.com>

On Thu, Dec 29, 2011 at 19:06, Myron Hammond <Myron.Hammond at wedbush.com> wrote:
> I have successfully fumbled my way through the IBM WebSphere MQ trial ? in
> the .NET environment.? I wanted to check out RabbitMQ.? I wanted to know if
> anyone knows of any resources that show a conversion from WebSphere to
> RabbitMQ.
>
> If it is available, it will save me piles of time.

I haven't seen any direct WebSphere -to- Rabbitmq guides.

But we have few cool (and simple :P) tutorials that could give
you a kick start!
  http://www.rabbitmq.com/getstarted.html

Code is available here:
 https://github.com/rabbitmq/rabbitmq-tutorials

Marek

From Chris.Hampson at arm.com  Thu Jan  5 13:50:36 2012
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Thu, 5 Jan 2012 13:50:36 +0000
Subject: [rabbitmq-discuss] Seeming high CPU for broker
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E1D7B8AA740@GEORGE.Emea.Arm.com>

Hi All,

We've been running a few brokers for quite some time now. About a month ago one of them pretty much maxed out the CPU of the machine it was running on and has maintained this high level ever since.

It's only ever using 20% (max) of the memory, not swapping, the load average of the machine is less than one and the service seems unaffected.

Is this something I shouldn't be concerned with, it's not really having to cope with too much at the moment, a couple of active VHOSTS, small handful of exchanges, and in general less than 200/sec messages to even the busiest of those.

I'm getting nagged by the ops guys due to it setting off notifications for the high CPU load, if it's expected or not something to worry about this I can just tell them to disable that notification (or at least ignore it).

Are there any ways (beyond rabbitmqctl and the web interface) to see what's going on and if there's trouble ahead?

Many thanks,

Chris

-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From emile at rabbitmq.com  Thu Jan  5 14:09:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 05 Jan 2012 14:09:06 +0000
Subject: [rabbitmq-discuss] Why are deliveries still showing even though
 msg counts show 0 in admin?
In-Reply-To: <e955c12d-9599-4ce7-85c6-918526a1aeb7@m4g2000vbc.googlegroups.com>
References: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>
	<C8930831-07B9-4D98-B538-108D3B991F7B@gmail.com>
	<0469d1e9-473c-4f02-8c7e-ed6300df0199@k29g2000vbl.googlegroups.com>
	<e955c12d-9599-4ce7-85c6-918526a1aeb7@m4g2000vbc.googlegroups.com>
Message-ID: <4F05AF02.3060803@rabbitmq.com>

Hi Andy,

On 04/01/12 15:09, AndyB wrote:
>> Where I'm getting confused is that when it seems to me like all of the
>> messages have been processed, the counts all show 0, I still see the
>> delivery rates showing values and they continue to do so for a good
>> amount of time.  During this time, the counts remain 0, as well as the

The rates are calculated by making comparisons with previous stats and
calculating the difference. There is an inevitable delay involved - is
this perhaps what you are seeing?

>> incoming messages rates (as nothing else is being published).  So it
>> seems to me like the counts arent showing messages that are really
>> there, which are still being delivered.  What's going on there?  Could
>> these possibly be messages that are being delivered from disk that got
>> streamed there because memory was too low to keep them in RAM?

No, whether the message was ever on disk is not a factor, and even if a
message was on disk it is always delivered via RAM.


-Emile

From andy.berryman at channeladvisor.com  Thu Jan  5 14:18:55 2012
From: andy.berryman at channeladvisor.com (AndyB)
Date: Thu, 5 Jan 2012 06:18:55 -0800 (PST)
Subject: [rabbitmq-discuss] Why are deliveries still showing even though
	msg counts show 0 in admin?
In-Reply-To: <4F05AF02.3060803@rabbitmq.com>
References: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>
	<C8930831-07B9-4D98-B538-108D3B991F7B@gmail.com>
	<0469d1e9-473c-4f02-8c7e-ed6300df0199@k29g2000vbl.googlegroups.com>
	<e955c12d-9599-4ce7-85c6-918526a1aeb7@m4g2000vbc.googlegroups.com>
	<4F05AF02.3060803@rabbitmq.com>
Message-ID: <e5398a65-e756-4636-8595-b4b9c1fd6590@dp8g2000vbb.googlegroups.com>

Does 10 minutes sounds like a valid delay period?  Seems like an
awfully long time to me.

I understand that the message is always delivered from RAM.  But if
the message was on disk, it has to be pulled from there and put into
RAM to be delivered.  My question was really more around whether or
not the counts displayed reflected messages that were on disk as well
as those that might be in RAM?

Thanks
Andy

On Jan 5, 9:09?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Andy,
>
> On 04/01/12 15:09, AndyB wrote:
>
> >> Where I'm getting confused is that when it seems to me like all of the
> >> messages have been processed, the counts all show 0, I still see the
> >> delivery rates showing values and they continue to do so for a good
> >> amount of time. ?During this time, the counts remain 0, as well as the
>
> The rates are calculated by making comparisons with previous stats and
> calculating the difference. There is an inevitable delay involved - is
> this perhaps what you are seeing?
>
> >> incoming messages rates (as nothing else is being published). ?So it
> >> seems to me like the counts arent showing messages that are really
> >> there, which are still being delivered. ?What's going on there? ?Could
> >> these possibly be messages that are being delivered from disk that got
> >> streamed there because memory was too low to keep them in RAM?
>
> No, whether the message was ever on disk is not a factor, and even if a
> message was on disk it is always delivered via RAM.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From wsmith at tacc.utexas.edu  Thu Jan  5 14:44:22 2012
From: wsmith at tacc.utexas.edu (Warren Smith)
Date: Thu, 5 Jan 2012 14:44:22 +0000
Subject: [rabbitmq-discuss] x509 Authentication
In-Reply-To: <4F057C48.80300@rabbitmq.com>
References: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>
	<4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46@EXMBX03.austin.utexas.edu>
	<bw71ury1ja7.fsf@mail.cern.ch> <4F057C48.80300@rabbitmq.com>
Message-ID: <4B5D885B77E8CC43852B8F0315AD03BA0D4D1A88@EXMBX03.austin.utexas.edu>


The reason that I ended up removing quotes from DNs is because (if I remember correctly) for the same certificate, a DN from Erlang would sometimes have quotes but the DN from openssl would not. I was using a script that invoked "openssl x509 -in <cert.pem> -subject" and then "rabbitmqctl add_user ...; rabbitmqctl set_permissions ..." to add users to rabbitmq. I couldn't quickly figure out a pattern when erlang added quotes (it wasn't as simple as the RDN having a space in it), so I just stripped them all out in the DN received by my modified rabbitmq_auth_mechanism_ssl.

I agree that this type of DN cleanup isn't really required, but it made things easier for me and apparently for Lionel, also.


Warren


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Thursday, January 05, 2012 4:33 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] x509 Authentication

On 21/12/11 07:22, Lionel Cons wrote:
> It would really be good to improve X.509 authentication in a 
> consistent way in RabbitMQ. Things I can think of:
>   - use common code between AMQP and STOMP

Yes.

>   - use DN rather than CN, maybe via a configurable option

Yes.

>   - standard DN cleanup (such as your quotes removal)

Umm, really? The question of how to canonically construct a string representation of a DN is annoyingly fiddly, but I really don't believe removing quotes is likely to be a part of it.

We'd probably have to aim for "whatever OpenSSL does" and "whatever Active Directory does" as goals for how to do it. Let us pray to the god of ASN.1 (some sort of Eldritch abomination I'm sure) that both of those are the same thing...

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jared.biel at bolderthinking.com  Thu Jan  5 16:53:12 2012
From: jared.biel at bolderthinking.com (Jared Biel)
Date: Thu, 5 Jan 2012 10:53:12 -0600
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
In-Reply-To: <4F058013.6070206@rabbitmq.com>
References: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>
	<499EC6B0-011F-497C-8540-D9028EF83D85@rabbitmq.com>
	<CAHoS6UaPPqzWH=OpyrWKp=Ubdfqbjvs2z6TB8HoNf=-FOyfbEw@mail.gmail.com>
	<4F04551F.9070302@rabbitmq.com>
	<CAHoS6UY3KupXEo0N-gf8y2RjfEcRq5GOsgELMbk4JkiGJtBjnw@mail.gmail.com>
	<CAHoS6UbkYDxvdjZg3ri8Ss5Lm61uzL-ASQCoKzapdDLLcCcOQg@mail.gmail.com>
	<4F058013.6070206@rabbitmq.com>
Message-ID: <CAHoS6UZiEGuwwKKAjhYp0z9XCNcDGGE2=y6n+Tu=ifW38HfcHQ@mail.gmail.com>

Hi Simon,

I'm not sure what logic Debian uses when determining to implement a
START=yes/no function in init scripts. Apache 2 installs and listens
on 0.0.0.0 but MySQL runs through a postinst configure script before
it starts up. There are some daemons that don't start out of the box
without editing an /etc/default file: monit, puppet, saslauthd,
opensips (3rd party package from vendor.)

The packages that have this behavior have an entry in their init
script to alert the user when trying to start a daemon if it's not
been enabled. Also, there's a debian package control file that can be
used to specify config files (DEBIAN/conffiles) that shouldn't be
modified on upgrade. This means  that START=no would only affect new
installations and upgrades of existing installs that don't have
knowledge of this.

if is_true "$START" ; then
  start-stop-daemon --start --quiet --pidfile $PIDFILE ...
else
  echo "puppet not configured to start, please edit
/etc/default/puppet to enable"
fi

My reason for wanting rabbitmq to use this process is the following:

1. Rabbitmq package is installed and post install script starts the daemon
2. The first time the daemon has been started an erlang cookie is generated
3. The mnesia database is initialized and it's keyed to the cookie
4. I drop in my cookie that's used across all of my nodes and attempt
to restart rabbitmq. It fails because the mnesia database expects to
have a different cookie. I must now blow away the database.

There also exists the potential for abuse of a newly installed
rabbitmq server, given that it listens on 0.0.0.0 and uses guest/guest
by default. Of course preventing abuse is the responsibility of the
admin but /etc/default can serve as a bit of a safety.

Overall it doesn't affect me much because I need to repackage anyway
to enable -name in lieu of -sname but I think it'd be a nice thing to
have by default.

Thanks,
Jared

On Thu, Jan 5, 2012 at 04:48, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 04/01/12 19:32, Jared Biel wrote:
>>
>> 1. An /etc/default/rabbitmq file that contains something like START=no
>> 2. Modification to rabbitmq-server.init to make use of that file so
>> rabbitmq won't start unless START is equal to a true value.
>
>
> Hmm. I have to admit to not being a Debian packaging expert but is this how
> things are meant to work? If I apt-get install apache2 or mysql, then by the
> time apt has done its work I have a running server.
>
> So I think if we did this then we would want to default to START=yes or else
> lots of people would turn up on this mailing list saying "I just installed
> rabbitmq-server and nothing happened!". And if we do that then why not just
> use update-rc.d?
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From starsareblueandfaraway at gmail.com  Thu Jan  5 17:04:13 2012
From: starsareblueandfaraway at gmail.com (Roy Hyunjin Han)
Date: Thu, 5 Jan 2012 09:04:13 -0800 (PST)
Subject: [rabbitmq-discuss] pika + ssl disconnects with ssl_upgrade_error
Message-ID: <f63a2b26-c4f0-4ee1-855a-a6ca062e32ce@m10g2000vbc.googlegroups.com>

Hi Gavin,

Thanks to pika, I am able to connect to RabbitMQ over SSL.  However,
the code disconnects immediately.  Do you have suggestions on what
might be going wrong?

Thanks,
RHH


Here is the error I see in /var/log/rabbitmq/rabbit at yyy.log.
::

   error on TCP connection <0.265.0>:{ssl_upgrade_error, {eoptions,
{certfile, '/xxx/server/cert.pem'}}}

Here are the contents of /etc/rabbitmq/rabbitmq.config, where I
created the certificates as specified on <http://www.rabbitmq.com/
ssl.html>.
::

   [
       {rabbit, [
           {ssl_listeners, [5671]},
           {ssl_options, [
               {cacertfile, '/xxx/testca/cacert.pem'},
               {certfile, '/xxx/server/cert.pem'},
               {keyfile, '/xxx/server/key.pem'},
               {verify, verify_peer},
               {fail_if_no_peer_cert, true}
           ]}
       ]}
   ].

Here is the Python code.
::

   parameters = ConnectionParameters(host, port,
credentials=credentials, ssl=True, ssl_options=dict(
       ca_certs='/xxx/testca/cacert.pem',
       certfile='/xxx/client/cert.pem',
       keyfile='/xxx/client/key.pem',
       cert_reqs=CERT_REQUIRED))

Here is the pika version that I am using.
::

   https://github.com/pika/pika/commit/5e3e91bcab50d492bb887f298fbf59ba345439a6

From starsareblueandfaraway at gmail.com  Thu Jan  5 16:59:17 2012
From: starsareblueandfaraway at gmail.com (Roy Hyunjin Han)
Date: Thu, 5 Jan 2012 08:59:17 -0800 (PST)
Subject: [rabbitmq-discuss] pika + ssl disconnects with ssl_upgrade_error
Message-ID: <ca1e9ab5-38d4-40e0-a2ec-aa3022a5faf8@u6g2000vbc.googlegroups.com>

Hi Gavin,

Thanks to pika, I am able to connect to RabbitMQ over SSL.  However,
the code disconnects immediately.  Do you have suggestions on what
might be going wrong?

Thanks,
RHH


Here is the error I see in /var/log/rabbitmq/rabbit at yyy.log.
::

    error on TCP connection <0.265.0>:{ssl_upgrade_error, {eoptions,
{certfile, '/xxx/server/cert.pem'}}}

Here are the contents of /etc/rabbitmq/rabbitmq.config, where I
created the certificates as specified on <http://www.rabbitmq.com/
ssl.html>.
::

    [
        {rabbit, [
            {ssl_listeners, [5671]},
            {ssl_options, [
                {cacertfile, '/xxx/testca/cacert.pem'},
                {certfile, '/xxx/server/cert.pem'},
                {keyfile, '/xxx/server/key.pem'},
                {verify, verify_peer},
                {fail_if_no_peer_cert, true}
            ]}
        ]}
    ].

Here is the Python code.
::

    parameters = ConnectionParameters(host, port,
credentials=credentials, ssl=True, ssl_options=dict(
        ca_certs='/xxx/testca/cacert.pem',
        certfile='/xxx/client/cert.pem',
        keyfile='/xxx/client/key.pem',
        cert_reqs=CERT_REQUIRED))

Here is the pika version that I am using.
::

    https://github.com/pika/pika/commit/5e3e91bcab50d492bb887f298fbf59ba345439a6

From alexandru at rabbitmq.com  Thu Jan  5 17:15:03 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 5 Jan 2012 17:15:03 +0000
Subject: [rabbitmq-discuss] pika + ssl disconnects with ssl_upgrade_error
In-Reply-To: <f63a2b26-c4f0-4ee1-855a-a6ca062e32ce@m10g2000vbc.googlegroups.com>
References: <f63a2b26-c4f0-4ee1-855a-a6ca062e32ce@m10g2000vbc.googlegroups.com>
Message-ID: <20120105171503.GZ3191@southbank>

>    error on TCP connection <0.265.0>:{ssl_upgrade_error, {eoptions,
> {certfile, '/xxx/server/cert.pem'}}}

eoptions means that particular option is incorrect.

>            {ssl_options, [
>                {cacertfile, '/xxx/testca/cacert.pem'},
>                {certfile, '/xxx/server/cert.pem'},
>                {keyfile, '/xxx/server/key.pem'},

Please use double quotes.  So, "/xxx/server/cert.pem", not
'/xxx/server/cert.pem'.  The same goes for the other options.

In case you're wondering, it's because in Erlang 'meh' is an atom and
"meh" is a string, and the code there expects a string.

Cheers,
Alex

On Thu, Jan 05, 2012 at 09:04:13AM -0800, Roy Hyunjin Han wrote:
> Hi Gavin,
> 
> Thanks to pika, I am able to connect to RabbitMQ over SSL.  However,
> the code disconnects immediately.  Do you have suggestions on what
> might be going wrong?
> 
> Thanks,
> RHH
> 
> 
> Here is the error I see in /var/log/rabbitmq/rabbit at yyy.log.
> ::
> 
>    error on TCP connection <0.265.0>:{ssl_upgrade_error, {eoptions,
> {certfile, '/xxx/server/cert.pem'}}}
> 
> Here are the contents of /etc/rabbitmq/rabbitmq.config, where I
> created the certificates as specified on <http://www.rabbitmq.com/
> ssl.html>.
> ::
> 
>    [
>        {rabbit, [
>            {ssl_listeners, [5671]},
>            {ssl_options, [
>                {cacertfile, '/xxx/testca/cacert.pem'},
>                {certfile, '/xxx/server/cert.pem'},
>                {keyfile, '/xxx/server/key.pem'},
>                {verify, verify_peer},
>                {fail_if_no_peer_cert, true}
>            ]}
>        ]}
>    ].
> 
> Here is the Python code.
> ::
> 
>    parameters = ConnectionParameters(host, port,
> credentials=credentials, ssl=True, ssl_options=dict(
>        ca_certs='/xxx/testca/cacert.pem',
>        certfile='/xxx/client/cert.pem',
>        keyfile='/xxx/client/key.pem',
>        cert_reqs=CERT_REQUIRED))
> 
> Here is the pika version that I am using.
> ::
> 
>    https://github.com/pika/pika/commit/5e3e91bcab50d492bb887f298fbf59ba345439a6
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From starsareblueandfaraway at gmail.com  Thu Jan  5 18:22:20 2012
From: starsareblueandfaraway at gmail.com (Roy Hyunjin Han)
Date: Thu, 5 Jan 2012 13:22:20 -0500
Subject: [rabbitmq-discuss] pika + ssl disconnects with ssl_upgrade_error
In-Reply-To: <20120105171503.GZ3191@southbank>
References: <f63a2b26-c4f0-4ee1-855a-a6ca062e32ce@m10g2000vbc.googlegroups.com>
	<20120105171503.GZ3191@southbank>
Message-ID: <CABScDVtC_LZ0zrA4fvyOSwSZR17wRS5H7QSkjLeaGFRbOb80hA@mail.gmail.com>

2012/1/5 Alexandru Scvor?ov <alexandru at rabbitmq.com>:
> eoptions means that particular option is incorrect.
>
>> ? ? ? ? ? ?{ssl_options, [
>> ? ? ? ? ? ? ? ?{cacertfile, '/xxx/testca/cacert.pem'},
>> ? ? ? ? ? ? ? ?{certfile, '/xxx/server/cert.pem'},
>> ? ? ? ? ? ? ? ?{keyfile, '/xxx/server/key.pem'},
>
> Please use double quotes. ?So, "/xxx/server/cert.pem", not
> '/xxx/server/cert.pem'. ?The same goes for the other options.

Thanks, Alexandru.  Your fix and explanation worked.  However, I am
running into a new error.  It looks like this is an Erlang traceback.
Looking on http://www.erlang.org/doc/man/inet.html, the best I can
guess is that "eacces" is some kind of permissions error.  Is there
documentation that can help me decode these error messages?

Thanks,
RHH


SSL: 1073: error:{error,{badmatch,{error,eacces}}} /xxx/testca/cacert.pem
  [{ssl_connection,init_certificates,2},
   {ssl_connection,ssl_init,2},
   {ssl_connection,init,1},
   {gen_fsm,init_it,6},
   {proc_lib,init_p_do_apply,3}]

error on TCP connection <0.239.0>:{ssl_upgrade_error,ecacertfile}

From alexandru at rabbitmq.com  Thu Jan  5 18:30:48 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 5 Jan 2012 18:30:48 +0000
Subject: [rabbitmq-discuss] pika + ssl disconnects with ssl_upgrade_error
In-Reply-To: <CABScDVtC_LZ0zrA4fvyOSwSZR17wRS5H7QSkjLeaGFRbOb80hA@mail.gmail.com>
References: <f63a2b26-c4f0-4ee1-855a-a6ca062e32ce@m10g2000vbc.googlegroups.com>
	<20120105171503.GZ3191@southbank>
	<CABScDVtC_LZ0zrA4fvyOSwSZR17wRS5H7QSkjLeaGFRbOb80hA@mail.gmail.com>
Message-ID: <20120105183048.GA3191@southbank>

> Looking on http://www.erlang.org/doc/man/inet.html, the best I can
> guess is that "eacces" is some kind of permissions error.

Correct.  Make sure the user the server is running under (it's probably
rabbitmq) has read access to the certificate/key files.

> Is there
> documentation that can help me decode these error messages?

If you're referring to the Erlang SSL errors, no there isn't.

Cheers,
Alex

On Thu, Jan 05, 2012 at 01:22:20PM -0500, Roy Hyunjin Han wrote:
> 2012/1/5 Alexandru Scvor?ov <alexandru at rabbitmq.com>:
> > eoptions means that particular option is incorrect.
> >
> >> ? ? ? ? ? ?{ssl_options, [
> >> ? ? ? ? ? ? ? ?{cacertfile, '/xxx/testca/cacert.pem'},
> >> ? ? ? ? ? ? ? ?{certfile, '/xxx/server/cert.pem'},
> >> ? ? ? ? ? ? ? ?{keyfile, '/xxx/server/key.pem'},
> >
> > Please use double quotes. ?So, "/xxx/server/cert.pem", not
> > '/xxx/server/cert.pem'. ?The same goes for the other options.
> 
> Thanks, Alexandru.  Your fix and explanation worked.  However, I am
> running into a new error.  It looks like this is an Erlang traceback.
> Looking on http://www.erlang.org/doc/man/inet.html, the best I can
> guess is that "eacces" is some kind of permissions error.  Is there
> documentation that can help me decode these error messages?
> 
> Thanks,
> RHH
> 
> 
> SSL: 1073: error:{error,{badmatch,{error,eacces}}} /xxx/testca/cacert.pem
>   [{ssl_connection,init_certificates,2},
>    {ssl_connection,ssl_init,2},
>    {ssl_connection,init,1},
>    {gen_fsm,init_it,6},
>    {proc_lib,init_p_do_apply,3}]
> 
> error on TCP connection <0.239.0>:{ssl_upgrade_error,ecacertfile}

From alexis at rabbitmq.com  Thu Jan  5 18:41:48 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 5 Jan 2012 18:41:48 +0000
Subject: [rabbitmq-discuss] Performance on ec2
In-Reply-To: <E3DA278C-ECCD-4D84-BDE2-1DA52B432D05@burtcorp.com>
References: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
	<CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>
	<29734019-3327-406D-9338-596565E8C8DB@burtcorp.com>
	<CACOPnvdCKOmyn96EHqirYDmeiYNFcH-BMV4MGGxRVm6WJD1RBQ@mail.gmail.com>
	<B6C9B5CE-77B8-49A1-AD18-0745B6C1B5D5@burtcorp.com>
	<E3DA278C-ECCD-4D84-BDE2-1DA52B432D05@burtcorp.com>
Message-ID: <CACOPnveSR3fBavs3d2pF9tHY0KiAA70mf+J4CRL5_eH1sFazfQ@mail.gmail.com>

Srdan

Thanks for doing this and posting the results.

Please bear with us...

a

On Mon, Jan 2, 2012 at 6:40 PM, Srdan Kvrgic <srdan at burtcorp.com> wrote:
> Hi
>
> So, I've done a bunch more tests, graphs of which can be found here: http://goo.gl/wmEmD
>
> The takeaway:
> ? ? ? ?* You can load/drain a maximum of 8000 1000-byte messages per second, regardless of the amount of mq-servers or the speed of the machine.
> ? ? ? ?* Making the messages 100 times smaller gained ?25% per message speed increase, but loss in total throughput.
> ? ? ? ?* Making the messages 10 times bigger (i.e. batching) dropped message rate by 50%, but gained 500% in overall throughput.
>
>
> I can replicate the behavior on my mac pretty well with the server instances on ec2, if I only run one instance of loader and one instance of drainer. I can publish 1000 byte messages on the server as fast as I can drain them (@about 7000/s). My machine had a single mq instance, the ec2 server was running against two mq servers in a cluster. Same performance.
>
> When running 3 loader and 3 drainer instances everything was fine for the rate limited upload of 2000/s. I loaded at 6000/s and I drained at 6000/s.
>
> However, when I cranked the loader instance's rate to 3000/s, I noticed the effect I noticed earlier - the drain speed was much lower until the 1 000 000 messages were queued, and then it popped back up to about 8000/s
>
> At load rate of 5000/s per instance (15000 in total), the effect was even clearer.
>
> I tried lowering the size of the messages to 10 bytes, instead of 1000. That improved the peak drain speed from about 8000/s ?to 10 000/s. Not a huge increase, considering I'd hacked the message size down to 1%.
>
> I also tried bumping up the message size to 10 000 bytes. That killed the message rate, obviously. But not that much. At 1200/s per instance, everything was running smoothly. I had a stable throughput of 3600 messages per second, or 36 000 messages per second unpacked.
>
> At the rate of 2000/s I? I ran into some problems. It all seemed to work well. I wasn't maxing out the loading, but I was only able to push some 4000 messages per second in total. I was even reasonably sure that was due to bandwidth on the mq servers (they ware pushing 30 megs per second each (at peak)). Then the server started getting out of memory. This stopped the loading, and the drain part screamed in at 6500 messages per second. This freed up memory. So the loaders loaded more, which killed the drainer's speed. Which caused memory errors. This eventually stabilized at a disappointing ~1200 messages per second in total.
>
>
>
>
> On Dec 29, 2011, at 23:03 , Srdan Kvrgic wrote:
>
>> Nope, can't say that I have.
>>
>> It's not really the use case though - in real life the queues are actually significant.
>>
>> I'll try it though. If that'll yield some insight. Hell, I'd try eating a balanced diet and getting plenty of sleep if that could help.
>>
>> //S
>>
>>
>> On Dec 29, 2011, at 17:53 , Alexis Richardson wrote:
>>
>>> Srdan
>>>
>>> I just had a quick look through your slides. ?Have you tried using one
>>> loader and one drainer and one queue, on one core, and gradually
>>> increasing their rates? ?What do you see?
>>>
>>> alexis
>>>
>>>
>>>
>>> On Wed, Dec 28, 2011 at 9:05 PM, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>>>>
>>>> On Dec 28, 2011, at 19:48 , Tony Garnock-Jones wrote:
>>>>
>>>> On 28 December 2011 12:49, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>>>>>
>>>>> My question is as simple as it is complex: 'Is that it?' What can I do to
>>>>> tweak these numbers? Massively.
>>>>
>>>>
>>>> Is this a transient-messaging use case (RabbitMQ as router, not relying
>>>> particularly on disk storage), or a persistent-messaging use case (where you
>>>> die in flames if a single message is dropped), or somewhere in-between?
>>>>
>>>>
>>>> Well, it is transient in so fact that we use it to distribute messages to a
>>>> large number of workers. In that way it is a router. But it also functions
>>>> as a buffer. If we for instance update the workers we like to be able to
>>>> stop and restart them without throwing messages away.
>>>>
>>>> Each individual message is not that important in itself. And if we loose a
>>>> larger amount of messages, we can re-queue the affected blocks. We're big on
>>>> idempotence and can cut ourselves some slack if we need to.
>>>>
>>>> That said, once you get to sending thousands of messages per second and the
>>>> system goes all fishy on you for an indeterminate length of time, the
>>>> re-queueing becomes? inconvenient. Inconvenient to the degree that it for
>>>> most practical purposes stops being an option and you become prepared to
>>>> 'invest' yourself away from those problems if at all possible.
>>>>
>>>>
>>>> //S
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From starsareblueandfaraway at gmail.com  Thu Jan  5 19:16:11 2012
From: starsareblueandfaraway at gmail.com (Roy Hyunjin Han)
Date: Thu, 5 Jan 2012 14:16:11 -0500
Subject: [rabbitmq-discuss] pika + ssl disconnects with ssl_upgrade_error
In-Reply-To: <20120105183048.GA3191@southbank>
References: <f63a2b26-c4f0-4ee1-855a-a6ca062e32ce@m10g2000vbc.googlegroups.com>
	<20120105171503.GZ3191@southbank>
	<CABScDVtC_LZ0zrA4fvyOSwSZR17wRS5H7QSkjLeaGFRbOb80hA@mail.gmail.com>
	<20120105183048.GA3191@southbank>
Message-ID: <CABScDVt042R898sYK-4mU6gmh3gTDEjcVxzxTZsxVORUsMrfZA@mail.gmail.com>

2012/1/5 Alexandru Scvor?ov <alexandru at rabbitmq.com>:
>> Looking on http://www.erlang.org/doc/man/inet.html, the best I can
>> guess is that "eacces" is some kind of permissions error.
>
> Correct. ?Make sure the user the server is running under (it's probably
> rabbitmq) has read access to the certificate/key files.

Thank you so much.  I moved the certificates and changed permissions
so that the certificates are accessible by rabbitmq.  After fixing a
typo in my code, pika finally connected to RabbitMQ + SSL.  SCORE!!

From mh at foldr3.com  Thu Jan  5 19:39:56 2012
From: mh at foldr3.com (Muharem Hrnjadovic)
Date: Thu, 05 Jan 2012 20:39:56 +0100
Subject: [rabbitmq-discuss] Announcement: RabbitMQ talk in Zurich
Message-ID: <4F05FC8C.8060401@foldr3.com>

Wednesday, February 8, 2012 at 7:00 PM:

    http://www.meetup.com/zh-geeks/events/46618202/

Best regards/Mit freundlichen Gr??en

-- 
Muharem Hrnjadovic <mh at foldr3.com>
Public key id   : B2BBFCFC
Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 900 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120105/f478e43c/attachment.pgp>

From christopher.grebs at native-instruments.de  Thu Jan  5 19:50:21 2012
From: christopher.grebs at native-instruments.de (christopher.grebs)
Date: Thu, 05 Jan 2012 20:50:21 +0100
Subject: [rabbitmq-discuss] Problem with transaction handling on high
	availability queues
Message-ID: <4F05FEFD.6020008@native-instruments.de>

Hey there everyone,

as suggested on the IRC I try to find my luck here.  Currently we are 
using RabbitMQ with the Pika python client backend by the gocept.amqprun 
library (http://pypi.python.org/pypi/gocept.amqprun) which works 
perfectly for now.

We are now trying to setup high-availability queues to further improve 
our current rabbitmq setup to be more reliable and more available.  Our 
current setup uses transactions ('tx.commit' and stuff) and I am now 
encountering this error:

=ERROR REPORT==== 5-Jan-2012::19:11:40 ===
connection<0.20298.26>, channel 1 - error:
{amqp_error,precondition_failed,"partial tx completion",'tx.commit'}


Full errorreport: http://paste.pocoo.org/show/tSb4QSdOlVpoZJggfJIa/

We are using RabbitMQ 2.7.0.

It would be awesome if somebody has a clue on what's going on.  If you 
need any further information, don't hesitate to ask.

Thanks a lot!

Cheers,
Christopher.

From jasonjwwilliams at gmail.com  Thu Jan  5 20:01:29 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 5 Jan 2012 13:01:29 -0700
Subject: [rabbitmq-discuss] Announcement: RabbitMQ talk in Zurich
In-Reply-To: <4F05FC8C.8060401@foldr3.com>
References: <4F05FC8C.8060401@foldr3.com>
Message-ID: <CAHZAEpeOdw98-zi5dYfmWPBusQB1LH_f=AoE+KKR=hsbukWKxQ@mail.gmail.com>

That Alvaro guy's pretty good. :)

-J

On Thu, Jan 5, 2012 at 12:39 PM, Muharem Hrnjadovic <mh at foldr3.com> wrote:

> Wednesday, February 8, 2012 at 7:00 PM:
>
>    http://www.meetup.com/zh-geeks/events/46618202/
>
> Best regards/Mit freundlichen Gr??en
>
> --
> Muharem Hrnjadovic <mh at foldr3.com>
> Public key id   : B2BBFCFC
> Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120105/69b093f0/attachment.htm>

From jerryk at vmware.com  Thu Jan  5 20:38:53 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 5 Jan 2012 12:38:53 -0800 (PST)
Subject: [rabbitmq-discuss] Announcement: RabbitMQ talk in Zurich
In-Reply-To: <CAHZAEpeOdw98-zi5dYfmWPBusQB1LH_f=AoE+KKR=hsbukWKxQ@mail.gmail.com>
Message-ID: <c05d988e-8ef0-4f03-8263-aa59b5e9c014@StrongMad.local>

I MAKE IRRESPONSIBLE AND VAGUE ALLEGATIONS OF BIAS!  :-)

Just kidding, Alvaro and Jason...

For those who just walked in on the gag, Jason and Alvaro just
finished writing a soon to be released RabbitMQ book together:

http://www.manning.com/videla/

----- Original Message -----
From: "Jason J. W. Williams" <jasonjwwilliams at gmail.com>
To: "Muharem Hrnjadovic" <mh at foldr3.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, January 5, 2012 12:01:29 PM
Subject: Re: [rabbitmq-discuss] Announcement: RabbitMQ talk in Zurich


That Alvaro guy's pretty good. :)


-J


On Thu, Jan 5, 2012 at 12:39 PM, Muharem Hrnjadovic < mh at foldr3.com > wrote:


Wednesday, February 8, 2012 at 7:00 PM:

http://www.meetup.com/zh-geeks/events/46618202/

Best regards/Mit freundlichen Gr??en

--
Muharem Hrnjadovic < mh at foldr3.com >
Public key id : B2BBFCFC
Key fingerprint : A5A3 CC67 2B87 D641 103F 5602 219F 6B60 B2BB FCFC


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From uday.subbarayan at yahoo.com  Thu Jan  5 22:29:38 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Thu, 5 Jan 2012 14:29:38 -0800 (PST)
Subject: [rabbitmq-discuss] How to attach C++ library?
In-Reply-To: <CALPqkip0awmgkJxeH0saPL2On=ZSap3+arVKX-30rW0bz4BkNA@mail.gmail.com>
References: <1325742123.3702.YahooMailNeo@web44916.mail.sp1.yahoo.com>
	<CALPqkip0awmgkJxeH0saPL2On=ZSap3+arVKX-30rW0bz4BkNA@mail.gmail.com>
Message-ID: <1325802578.9799.YahooMailNeo@web44910.mail.sp1.yahoo.com>

Thanks Brett for the pointer. I am aware of it.

Our C++ server will act both as consumer of the message and also publisher of the message. The worker queue model will fit best. These servers are workers and will get the task via Rabbit MQ. After completing the task, it will post the status back to the queue.

Best,
-Uday.


________________________________
 From: Brett Cameron <brett.r.cameron at gmail.com>
To: Uday Subbarayan <uday.subbarayan at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Wednesday, January 4, 2012 11:48 PM
Subject: Re: [rabbitmq-discuss] How to attach C++ library?
 

Uday,

You should be able to do this using the C API (http://www.rabbitmq.com/c-client.html). What OS are you using? When you say that you want to convert the C++ code into a "socket based server", will it be acting purely as a consumer of messages (no response), or will it be operating in some sort of request/response (RPC) fashion?

Brett



On Thu, Jan 5, 2012 at 6:42 PM, Uday Subbarayan <uday.subbarayan at yahoo.com> wrote:

Hi All,
>? ? Happy New Year.
>
>
>We have a C++ library which is currently used inside a product. We want to convert this library in to a socket based server and connect to Rabbit MQ so that it can consume & publish messages from the clients.
>
>
>Has any one done any similar work?
>
>
>Thanks,
>-Uday.
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120105/9a56fe89/attachment.htm>

From jerryk at vmware.com  Thu Jan  5 23:27:06 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 5 Jan 2012 15:27:06 -0800 (PST)
Subject: [rabbitmq-discuss] Seeming high CPU for broker
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E1D7B8AA740@GEORGE.Emea.Arm.com>
Message-ID: <7cf2af2c-3e66-4d2c-960b-80f96afe78c1@CoachZ.local>

Hi, Chris...

What Rabbit version are you running?  Which, if any, plugins do you have
enabled?

Best regards,
Jerry

----- Original Message -----
From: "Chris Hampson" <Chris.Hampson at arm.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, January 5, 2012 5:50:36 AM
Subject: [rabbitmq-discuss] Seeming high CPU for broker

Hi All,

We've been running a few brokers for quite some time now. About a month ago one of them pretty much maxed out the CPU of the machine it was running on and has maintained this high level ever since.

It's only ever using 20% (max) of the memory, not swapping, the load average of the machine is less than one and the service seems unaffected.

Is this something I shouldn't be concerned with, it's not really having to cope with too much at the moment, a couple of active VHOSTS, small handful of exchanges, and in general less than 200/sec messages to even the busiest of those.

I'm getting nagged by the ops guys due to it setting off notifications for the high CPU load, if it's expected or not something to worry about this I can just tell them to disable that notification (or at least ignore it).

Are there any ways (beyond rabbitmqctl and the web interface) to see what's going on and if there's trouble ahead?

Many thanks,

Chris

-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.nye1 at gmail.com  Thu Jan  5 23:57:21 2012
From: michael.nye1 at gmail.com (Michael Nye)
Date: Fri, 6 Jan 2012 09:57:21 +1000
Subject: [rabbitmq-discuss] Irregular service failure
Message-ID: <CAFHLqDJSGhpfXf1UwD0PcLh0=7khdcOhFX4seotrku9LkCNFiw@mail.gmail.com>

Hello,

I am currently using RabbitMQ in a reasonably high throughput manner, I
would guess 100,000+ messages per day being sent through it.  The install
is on a Windows Server 2008 R2 box and all applications are in C# with
everything running on the same machine.

The service will run fine for weeks, months but then randomly (so far it
has happened 2 or 3 times) it appears the service just stops working.  All
applications will start throwing an exception AlreadyClosedException, and
stop being able to send messages.  To get things working again, I stop all
applications, restart the rabbitmq service, and start the applications
again.

I am not sure where to start in terms of debugging this, so am interested
in hearing what people would suggest to try to track down why this is
happening (I am only a basic user of rabbit).  I believe the RabbitMQ
service install is a stock standard install of version 2.6.1, so
potentially an upgrade to 2.7.1 may clear things up.

For the record here is the exception being thrown,

The AMQP operation was interrupted: AMQP close-reason, initiated by
Library, code=541, text="Unexpected Exception", classId=0, methodId=0,
cause=System.IO.IOException: Unable to read data from the transport
connection: An existing connection was forcibly closed by the remote host.
---> System.Net.Sockets.SocketException: An existing connection was
forcibly closed by the remote host
  at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset,
Int32 size)
  --- End of inner exception stack trace ---
  at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
  at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
  at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
 Source = RabbitMQ.Client

 StackTrace:
      at RabbitMQ.Client.Impl.SessionBase.Transmit(Command cmd)
  at RabbitMQ.Client.Impl.ModelBase.ModelSend(MethodBase method,
ContentHeaderBase header, Byte[] body)
  at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, Boolean mandatory, Boolean immediate, IBasicProperties
basicProperties, Byte[] body)
  at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, IBasicProperties basicProperties, Byte[] body)
  at ...

Any help to track down the cause of this problem is appreciated!

Thanks,

Michael.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/b6e9d6af/attachment.htm>

From dagda1 at scotalt.net  Fri Jan  6 07:30:31 2012
From: dagda1 at scotalt.net (Paul Cowan)
Date: Fri, 6 Jan 2012 07:30:31 +0000
Subject: [rabbitmq-discuss] EventMachine EM::Iterator being blocked with
	rabbitmq rbc
Message-ID: <CAEBV8YQtZ2RnxoYCFsZAroeeerZ+HO0qu6z6vaOH_NjEPL33Aw@mail.gmail.com>

I am trying to set up RabbitMQ rpc. I want one queue to listen, and when it
receives a message I want it to reply to an anonymous queue that is
specified via the reply_to header with multiple messages.

I have the following thor task creates a queue and then uses EM:Iterator to
send a number of messages back to the queue specified with the replyt_to
routing key:

desc "start_consumer", "start the test consumer"
def start_consumer
  conf = {
    :host => "localhost",
    :user => "guest",
    :password => "guest",
    :vhost => "/",
    :logging => true,
    :port => 5672
  }

  # n = 1

  AMQP.start(conf) do |connection|

    channel = AMQP::Channel.new(connection)

    requests_queue = channel.queue("one")
    requests_queue.purge

    Signal.trap("INT") do
      connection.close do
        EM.stop{exit}
      end
    end

    channel.prefetch(1)

    requests_queue.subscribe(:ack => true) do |header, body|
      url_search = MultiJson.decode(body)

      EM::Iterator.new(0..5).each do |n, iter|
        lead = get_lead(n, (n == 5))

        puts "about to publish #{n} message is_last = #{lead.is_last}
at #{Time.now}"

        AMQP::Exchange.default.publish(
                                        MultiJson.encode(lead),
                                        :immediate => true,
                                        :routing_key => header.reply_to,
                                        :correlation_id => header.correlation_id
                                      )

        iter.next
      end
    end

    puts " [x] Awaiting RPC requests"
  end
end

The code beloow sends a message to the queue specified above and also
creates a queue that will be used to listen for the messages sent by the
EM::Iterator code. This queue's name is the routing key for the first
queues reply_to header.

def publish(urlSearch, routing_key)
  EM.run do
    corr_id = rand(10_000_000).to_s

    requests ||= Hash.new

    connection = AMQP.connect(:host => "localhost")

    callback_queue = AMQP::Channel.new(connection).queue("",
:exclusive => false)

    callback_queue.subscribe do |header, body|
      lead = safe_json_decode(body)

      puts "company = #{lead["company"]} is_last = #{lead["is_last"]}
received at #{Time.now}"

      if lead["is_last"]
        puts "in exit"
        connection.close do
          EM.stop{exit}
        end
      end
    end

    callback_queue.append_callback(:declare) do
      AMQP::Exchange.default.publish(MultiJson.encode(urlSearch),
:routing_key => routing_key, :reply_to => callback_queue.name,
:correlation_id => corr_id)
    end

    puts "initial message sent"
  end
end

The above code works as I want with one annoying exception. Something is
blocking the EM::Iterator code from being executed asynchronously. It is
only after the EM::Iterator code has completed that the messages are sent.
I want the messages to be sent asynchronously and handled by the anonymous
queue after each iteration. At the moment, it is only after the
EM::Iterator code has completed its last iteration that all the messages
are sent.

Can anyone see what I am doing wrong or suggest a different approach? I
tried EM::defer and had the same behaviour.

Thanks

Paul
Cheers

Paul Cowan

Cutting-Edge Solutions (Scotland)

http://thesoftwaresimpleton.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/6e726c86/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jan  6 07:44:33 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 6 Jan 2012 11:44:33 +0400
Subject: [rabbitmq-discuss] EventMachine EM::Iterator being blocked with
	rabbitmq rbc
In-Reply-To: <CAEBV8YQtZ2RnxoYCFsZAroeeerZ+HO0qu6z6vaOH_NjEPL33Aw@mail.gmail.com>
References: <CAEBV8YQtZ2RnxoYCFsZAroeeerZ+HO0qu6z6vaOH_NjEPL33Aw@mail.gmail.com>
Message-ID: <08A166E4-DF97-487C-BA3B-5EDB662751B9@gmail.com>

Paul Cowan:

> The above code works as I want with one annoying exception. Something is blocking the EM::Iterator code from being executed asynchronously. It is only after the EM::Iterator code has completed that the messages are sent. I want the messages to be sent asynchronously and handled by the anonymous queue after each iteration. At the moment, it is only after the EM::Iterator code has completed its last iteration that all the messages are sent.
> 

This is a question for EventMachine mailing list. EventMachine::Iterator is only available in beta releases of EventMachine 1.0, so use it with caution.

> Can anyone see what I am doing wrong or suggest a different approach? I tried EM::defer and had the same behaviour.
> 

EventMachine.defer uses a thread pool with 20 threads by default. If operations you defer to it are blocked, it may suggest that the issue is not with something blocking the event loop.

For example, you are using prefetch = 1 and manual acknowledgements for your consumer that uses EventMachine::Iterator. However, I don't see messages being acknowledged.

You can use Wireshark GUI to record a session of what's going up and down the wire (filter for "amqp").

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From dagda1 at scotalt.net  Fri Jan  6 08:39:33 2012
From: dagda1 at scotalt.net (Paul Cowan)
Date: Fri, 6 Jan 2012 08:39:33 +0000
Subject: [rabbitmq-discuss] EventMachine EM::Iterator being blocked with
 rabbitmq rbc
In-Reply-To: <08A166E4-DF97-487C-BA3B-5EDB662751B9@gmail.com>
References: <CAEBV8YQtZ2RnxoYCFsZAroeeerZ+HO0qu6z6vaOH_NjEPL33Aw@mail.gmail.com>
	<08A166E4-DF97-487C-BA3B-5EDB662751B9@gmail.com>
Message-ID: <CAEBV8YS6H+q0CKwqjGoKYWKM5FyQDvKwwBkLPorZ0CrjBN_S1g@mail.gmail.com>

Hi,

Thanks for the answer, I will rollback to EM::defer and checkout what is
going on over wireshark.

Is there any documentation for the append_callback method and if so, where
can I find it.

Cheers

Paul Cowan

Cutting-Edge Solutions (Scotland)

http://thesoftwaresimpleton.com/



On 6 January 2012 07:44, Michael Klishin <michael.s.klishin at gmail.com>wrote:

> Paul Cowan:
>
> > The above code works as I want with one annoying exception. Something is
> blocking the EM::Iterator code from being executed asynchronously. It is
> only after the EM::Iterator code has completed that the messages are sent.
> I want the messages to be sent asynchronously and handled by the anonymous
> queue after each iteration. At the moment, it is only after the
> EM::Iterator code has completed its last iteration that all the messages
> are sent.
> >
>
> This is a question for EventMachine mailing list. EventMachine::Iterator
> is only available in beta releases of EventMachine 1.0, so use it with
> caution.
>
> > Can anyone see what I am doing wrong or suggest a different approach? I
> tried EM::defer and had the same behaviour.
> >
>
> EventMachine.defer uses a thread pool with 20 threads by default. If
> operations you defer to it are blocked, it may suggest that the issue is
> not with something blocking the event loop.
>
> For example, you are using prefetch = 1 and manual acknowledgements for
> your consumer that uses EventMachine::Iterator. However, I don't see
> messages being acknowledged.
>
> You can use Wireshark GUI to record a session of what's going up and down
> the wire (filter for "amqp").
>
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/1f08b0f1/attachment.htm>

From simon at rabbitmq.com  Fri Jan  6 10:36:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jan 2012 10:36:14 +0000
Subject: [rabbitmq-discuss] Irregular service failure
In-Reply-To: <CAFHLqDJSGhpfXf1UwD0PcLh0=7khdcOhFX4seotrku9LkCNFiw@mail.gmail.com>
References: <CAFHLqDJSGhpfXf1UwD0PcLh0=7khdcOhFX4seotrku9LkCNFiw@mail.gmail.com>
Message-ID: <4F06CE9E.6010800@rabbitmq.com>

On 05/01/12 23:57, Michael Nye wrote:
> The AMQP operation was interrupted: AMQP close-reason, initiated by
> Library, code=541, text="Unexpected Exception"

So the server is reporting an internal error. The client side 
stacktraces don't show anything meaningful in this case, you'd need to 
look in the server logs.

But quite a few bugs were fixed between 2.6.1 and 2.7.1 so you may just 
want to try upgrading.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan  6 10:45:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jan 2012 10:45:01 +0000
Subject: [rabbitmq-discuss] Problem with transaction handling on high
 availability queues
In-Reply-To: <4F05FEFD.6020008@native-instruments.de>
References: <4F05FEFD.6020008@native-instruments.de>
Message-ID: <4F06D0AD.6090602@rabbitmq.com>

On 05/01/12 19:50, christopher.grebs wrote:
> =ERROR REPORT==== 5-Jan-2012::19:11:40 ===
> connection<0.20298.26>, channel 1 - error:
> {amqp_error,precondition_failed,"partial tx completion",'tx.commit'}

Basically the transaction was not able to commit. In recent RabbitMQ 
versions transactions a implemented in terms of confirms; this error on 
commit is equivalent to the confirm mechanism having sent nacks.

And the confirm mechanism will only send a nack if a queue crashes. So 
I'm guessing that's what happened - you can check further up the log 
file (sorry, the URL you posted is not responding for me). There were 
several bugs in this area that were fixed in 2.7.1 so you might want to 
upgrade.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From christopher.grebs at native-instruments.de  Fri Jan  6 11:01:34 2012
From: christopher.grebs at native-instruments.de (Christopher Grebs)
Date: Fri, 06 Jan 2012 12:01:34 +0100
Subject: [rabbitmq-discuss] Problem with transaction handling on high
 availability queues
In-Reply-To: <4F06D0AD.6090602@rabbitmq.com>
References: <4F05FEFD.6020008@native-instruments.de>
	<4F06D0AD.6090602@rabbitmq.com>
Message-ID: <4F06D48E.9060002@native-instruments.de>

Hey Simon,

thanks for your reply!

I moved the error report to a more reliable service, see 
http://paste.ubuntuusers.de/404922/ - currently I have problems 
reproducing the error, 'cause I tried to build a basic example on where 
it breaks, hell it's like always if one puts out the debug guns... then 
everything works :-(

But, what I remember was that the consumer had some error, did a 
tx.commit and tx.rollback and on the rollback it crashed.  One thing I 
found to be a reasonable problem was that the rollback did not wait for 
the commit to happen, maybe this caused some problems.

Once I am able to reproduce this once and for all I try to update to 
2.7.1 to see if this fixes my problems.

Thanks a lot!

Cheers, Christopher.

On 01/06/2012 11:45 AM, Simon MacMullen wrote:
> On 05/01/12 19:50, christopher.grebs wrote:
>> =ERROR REPORT==== 5-Jan-2012::19:11:40 ===
>> connection<0.20298.26>, channel 1 - error:
>> {amqp_error,precondition_failed,"partial tx completion",'tx.commit'}
>
> Basically the transaction was not able to commit. In recent RabbitMQ 
> versions transactions a implemented in terms of confirms; this error 
> on commit is equivalent to the confirm mechanism having sent nacks.
>
> And the confirm mechanism will only send a nack if a queue crashes. So 
> I'm guessing that's what happened - you can check further up the log 
> file (sorry, the URL you posted is not responding for me). There were 
> several bugs in this area that were fixed in 2.7.1 so you might want 
> to upgrade.
>
> Cheers, Simon
>


-- 
Christopher Grebs
Data Processing Developer

Tel +49-30-611035-1664
Fax -49-30-611035-2652
christopher.grebs at native-instruments.de

NATIVE INSTRUMENTS GmbH
Schlesische Strasse 29-30
10997 Berlin, Germany

http://www.native-instruments.com



***

KOMPLETE 8 ULTIMATE - the premium NI producer collection
=>   http://www.native-instruments.com/komplete8

TRAKTOR KONTROL S2 - the professional 2.1 DJ system
=>   http://www.native-instruments.com/s2

->>>>>>  NATIVE INSTRUMENTS - The Future of Sound<<<<<<-

Registergericht: Amtsgericht Charlottenburg
Registernummer: HRB 72458
UST.-ID.-Nr. DE 20 374 7747

Gesch?ftsf?hrung: Daniel Haver (CEO), Mate Galic


From simon at rabbitmq.com  Fri Jan  6 11:34:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jan 2012 11:34:58 +0000
Subject: [rabbitmq-discuss] Problem with transaction handling on high
 availability queues
In-Reply-To: <4F06D48E.9060002@native-instruments.de>
References: <4F05FEFD.6020008@native-instruments.de>	<4F06D0AD.6090602@rabbitmq.com>
	<4F06D48E.9060002@native-instruments.de>
Message-ID: <4F06DC62.6060803@rabbitmq.com>

On 06/01/12 11:01, Christopher Grebs wrote:
> I moved the error report to a more reliable service,

 From the error report:

  ** Reason for termination ==
  ** {function_clause,[{gb_trees,insert, <snip> 
{rabbit_amqqueue_process,maybe_record_confirm_message,2},
                       {rabbit_amqqueue_process,deliver_or_enqueue,2},
                       {rabbit_amqqueue_process,handle_cast,2},
                       {gen_server2,handle_msg,2},
                       {proc_lib,wake_up,3}]}

This is a bug in queue promotion that was fixed in 2.7.1. So you should 
definitely upgrade :)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From christopher.grebs at native-instruments.de  Fri Jan  6 11:51:24 2012
From: christopher.grebs at native-instruments.de (Christopher Grebs)
Date: Fri, 06 Jan 2012 12:51:24 +0100
Subject: [rabbitmq-discuss] Problem with transaction handling on high
 availability queues
In-Reply-To: <4F06DC62.6060803@rabbitmq.com>
References: <4F05FEFD.6020008@native-instruments.de>	<4F06D0AD.6090602@rabbitmq.com>
	<4F06D48E.9060002@native-instruments.de>
	<4F06DC62.6060803@rabbitmq.com>
Message-ID: <4F06E03C.7090104@native-instruments.de>

Hey,

seriously, you guys are awesome!  Thanks a lot, I upgraded and for now I 
have not seen any problems.  Even the upgrade went without any 
interruption, great.  I love this stuff :-)

Thanks a lot!

Cheers, Christopher.

On 01/06/2012 12:34 PM, Simon MacMullen wrote:
> On 06/01/12 11:01, Christopher Grebs wrote:
>> I moved the error report to a more reliable service,
>
> From the error report:
>
>  ** Reason for termination ==
>  ** {function_clause,[{gb_trees,insert, <snip> 
> {rabbit_amqqueue_process,maybe_record_confirm_message,2},
>                       {rabbit_amqqueue_process,deliver_or_enqueue,2},
>                       {rabbit_amqqueue_process,handle_cast,2},
>                       {gen_server2,handle_msg,2},
>                       {proc_lib,wake_up,3}]}
>
> This is a bug in queue promotion that was fixed in 2.7.1. So you 
> should definitely upgrade :)
>
> Cheers, Simon
>


-- 
Christopher Grebs
Data Processing Developer

Tel +49-30-611035-1664
Fax -49-30-611035-2652
christopher.grebs at native-instruments.de

NATIVE INSTRUMENTS GmbH
Schlesische Strasse 29-30
10997 Berlin, Germany

http://www.native-instruments.com



***

KOMPLETE 8 ULTIMATE - the premium NI producer collection
=>   http://www.native-instruments.com/komplete8

TRAKTOR KONTROL S2 - the professional 2.1 DJ system
=>   http://www.native-instruments.com/s2

->>>>>>  NATIVE INSTRUMENTS - The Future of Sound<<<<<<-

Registergericht: Amtsgericht Charlottenburg
Registernummer: HRB 72458
UST.-ID.-Nr. DE 20 374 7747

Gesch?ftsf?hrung: Daniel Haver (CEO), Mate Galic


From simon at rabbitmq.com  Fri Jan  6 13:31:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jan 2012 13:31:18 +0000
Subject: [rabbitmq-discuss] x509 Authentication
In-Reply-To: <4B5D885B77E8CC43852B8F0315AD03BA0D4D1A88@EXMBX03.austin.utexas.edu>
References: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>	<4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46@EXMBX03.austin.utexas.edu>	<bw71ury1ja7.fsf@mail.cern.ch>
	<4F057C48.80300@rabbitmq.com>
	<4B5D885B77E8CC43852B8F0315AD03BA0D4D1A88@EXMBX03.austin.utexas.edu>
Message-ID: <4F06F7A6.7070102@rabbitmq.com>

I'm having trouble replicating this - can you give me an example of a DN 
that produced quotes in Rabbit but not with OpenSSL?

Cheers, Simon

On 05/01/12 14:44, Warren Smith wrote:
>
> The reason that I ended up removing quotes from DNs is because (if I
> remember correctly) for the same certificate, a DN from Erlang would
> sometimes have quotes but the DN from openssl would not. I was using
> a script that invoked "openssl x509 -in<cert.pem>  -subject" and then
> "rabbitmqctl add_user ...; rabbitmqctl set_permissions ..." to add
> users to rabbitmq. I couldn't quickly figure out a pattern when
> erlang added quotes (it wasn't as simple as the RDN having a space in
> it), so I just stripped them all out in the DN received by my
> modified rabbitmq_auth_mechanism_ssl.
>
> I agree that this type of DN cleanup isn't really required, but it
> made things easier for me and apparently for Lionel, also.
>
>
> Warren
>
>
> -----Original Message----- From:
> rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
> Simon MacMullen Sent: Thursday, January 05, 2012 4:33 AM To:
> rabbitmq-discuss at lists.rabbitmq.com Subject: Re: [rabbitmq-discuss]
> x509 Authentication
>
> On 21/12/11 07:22, Lionel Cons wrote:
>> It would really be good to improve X.509 authentication in a
>> consistent way in RabbitMQ. Things I can think of: - use common
>> code between AMQP and STOMP
>
> Yes.
>
>> - use DN rather than CN, maybe via a configurable option
>
> Yes.
>
>> - standard DN cleanup (such as your quotes removal)
>
> Umm, really? The question of how to canonically construct a string
> representation of a DN is annoyingly fiddly, but I really don't
> believe removing quotes is likely to be a part of it.
>
> We'd probably have to aim for "whatever OpenSSL does" and "whatever
> Active Directory does" as goals for how to do it. Let us pray to the
> god of ASN.1 (some sort of Eldritch abomination I'm sure) that both
> of those are the same thing...
>
> Cheers, Simon
>
> -- Simon MacMullen RabbitMQ, VMware
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From lionel.cons at cern.ch  Fri Jan  6 13:55:39 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 6 Jan 2012 14:55:39 +0100
Subject: [rabbitmq-discuss] x509 Authentication
In-Reply-To: <4F06F7A6.7070102@rabbitmq.com> (Simon MacMullen's message of
	"Fri, 6 Jan 2012 13:31:18 +0000")
References: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>
	<4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46@EXMBX03.austin.utexas.edu>
	<bw71ury1ja7.fsf@mail.cern.ch> <4F057C48.80300@rabbitmq.com>
	<4B5D885B77E8CC43852B8F0315AD03BA0D4D1A88@EXMBX03.austin.utexas.edu>
	<4F06F7A6.7070102@rabbitmq.com>
Message-ID: <bw7mxa1hr50.fsf@mail.cern.ch>

Simon MacMullen <simon at rabbitmq.com> writes:
> I'm having trouble replicating this - can you give me an example of a
> DN that produced quotes in Rabbit but not with OpenSSL?

For our certificates (issued here at CERN), OpenSSL returns something like:

$ openssl x509 -noout -in usercert.pem -subject -nameopt RFC2253
subject= CN=John Doe,CN=123456,CN=jdoe,OU=Users,OU=Organic Units,DC=cern,DC=ch

while Rabbit sees:

CN=John Doe,CN=123456,CN=jdoe,OU=Users,OU=Organic Units,DC="cern",DC="ch"

Cheers,

Lionel

From simon at rabbitmq.com  Fri Jan  6 13:57:31 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jan 2012 13:57:31 +0000
Subject: [rabbitmq-discuss] x509 Authentication
In-Reply-To: <bw7mxa1hr50.fsf@mail.cern.ch>
References: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>	<4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46@EXMBX03.austin.utexas.edu>	<bw71ury1ja7.fsf@mail.cern.ch>
	<4F057C48.80300@rabbitmq.com>	<4B5D885B77E8CC43852B8F0315AD03BA0D4D1A88@EXMBX03.austin.utexas.edu>	<4F06F7A6.7070102@rabbitmq.com>
	<bw7mxa1hr50.fsf@mail.cern.ch>
Message-ID: <4F06FDCB.4040409@rabbitmq.com>

On 06/01/12 13:55, Lionel Cons wrote:
> For our certificates (issued here at CERN), OpenSSL returns something like:
>
> $ openssl x509 -noout -in usercert.pem -subject -nameopt RFC2253
> subject= CN=John Doe,CN=123456,CN=jdoe,OU=Users,OU=Organic Units,DC=cern,DC=ch
>
> while Rabbit sees:
>
> CN=John Doe,CN=123456,CN=jdoe,OU=Users,OU=Organic Units,DC="cern",DC="ch"

That's great, thanks.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Chris.Hampson at arm.com  Fri Jan  6 14:59:34 2012
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Fri, 6 Jan 2012 14:59:34 +0000
Subject: [rabbitmq-discuss] Seeming high CPU for broker
In-Reply-To: <7cf2af2c-3e66-4d2c-960b-80f96afe78c1@CoachZ.local>
References: <A610E03AD50BFC4D95529A36D37FA55E1D7B8AA740@GEORGE.Emea.Arm.com>
	<7cf2af2c-3e66-4d2c-960b-80f96afe78c1@CoachZ.local>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E1D7B8AAB6B@GEORGE.Emea.Arm.com>

Sorry, I really should know better than to be that vague...

Rabbit/Erlang version: 2.3.1 / R14B

Plugins:
[{running_applications,
     [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","2.3.1"},
      {rabbit_management,"RabbitMQ Management Console","2.3.1"},
      {webmachine,"webmachine","1.7.0"},
      {rabbit_management_agent,"RabbitMQ Management Agent","2.3.1"},
      {rabbit_jsonrpc_channel_test,"rabbit_jsonrpc_channel_test","0.01"},
      {amqp_client,"RabbitMQ AMQP Client","2.3.1"},
      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
      {rabbit_jsonrpc,"Rabbit JSON-RPC","2.3.1"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.3.1"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {crypto,"CRYPTO version 2","2.0.1"},
      {inets,"INETS  CXC 138 49","5.5"},
      {rabbit_stomp,"Embedded Rabbit Stomp Adapter","2.4.1"},
      {rabbit,"RabbitMQ","2.3.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.15"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.2"},
      {stdlib,"ERTS  CXC 138 10","1.17.1"},
      {kernel,"ERTS  CXC 138 10","2.14.1"}]},
 {nodes,[{disc,['rabbit at cam-amqp1']}]},
 {running_nodes,['rabbit at cam-amqp1']}]

Cheers,

Chris


> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Jerry Kuch
> Sent: 05 January 2012 23:27
> To: Chris Hampson
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Seeming high CPU for broker
>
> Hi, Chris...
>
> What Rabbit version are you running?  Which, if any, plugins do you
> have
> enabled?
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Chris Hampson" <Chris.Hampson at arm.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Thursday, January 5, 2012 5:50:36 AM
> Subject: [rabbitmq-discuss] Seeming high CPU for broker
>
> Hi All,
>
> We've been running a few brokers for quite some time now. About a month
> ago one of them pretty much maxed out the CPU of the machine it was
> running on and has maintained this high level ever since.
>
> It's only ever using 20% (max) of the memory, not swapping, the load
> average of the machine is less than one and the service seems
> unaffected.
>
> Is this something I shouldn't be concerned with, it's not really having
> to cope with too much at the moment, a couple of active VHOSTS, small
> handful of exchanges, and in general less than 200/sec messages to even
> the busiest of those.
>
> I'm getting nagged by the ops guys due to it setting off notifications
> for the high CPU load, if it's expected or not something to worry about
> this I can just tell them to disable that notification (or at least
> ignore it).
>
> Are there any ways (beyond rabbitmqctl and the web interface) to see
> what's going on and if there's trouble ahead?
>
> Many thanks,
>
> Chris
>
> -- IMPORTANT NOTICE: The contents of this email and any attachments are
> confidential and may also be privileged. If you are not the intended
> recipient, please notify the sender immediately and do not disclose the
> contents to any other person, use it for any purpose, or store or copy
> the information in any medium.  Thank you.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From dagda1 at scotalt.net  Fri Jan  6 17:38:24 2012
From: dagda1 at scotalt.net (Paul Cowan)
Date: Fri, 6 Jan 2012 17:38:24 +0000
Subject: [rabbitmq-discuss] EventMachine EM::Iterator being blocked with
 rabbitmq rbc
In-Reply-To: <CAEBV8YS6H+q0CKwqjGoKYWKM5FyQDvKwwBkLPorZ0CrjBN_S1g@mail.gmail.com>
References: <CAEBV8YQtZ2RnxoYCFsZAroeeerZ+HO0qu6z6vaOH_NjEPL33Aw@mail.gmail.com>
	<08A166E4-DF97-487C-BA3B-5EDB662751B9@gmail.com>
	<CAEBV8YS6H+q0CKwqjGoKYWKM5FyQDvKwwBkLPorZ0CrjBN_S1g@mail.gmail.com>
Message-ID: <CAEBV8YRcyu-H85u4emUN0H-aE7RX6D3Oqx0BkTDkVMAKf0-WyQ@mail.gmail.com>

Hi,

I have refactored my code to use EM::defer.  I still have the same problem
as before.

I am a bit new to rabbitmq and EventMachine, I wonder if anyone could
review the EM::defer code in the following gist:

https://gist.github.com/1571453

Also, do you think the header.ack on line 44 of the gist is in the right
place?

Cheers

Paul Cowan

Cutting-Edge Solutions (Scotland)

http://thesoftwaresimpleton.com/



On 6 January 2012 08:39, Paul Cowan <dagda1 at scotalt.net> wrote:

> Hi,
>
> Thanks for the answer, I will rollback to EM::defer and checkout what is
> going on over wireshark.
>
> Is there any documentation for the append_callback method and if so, where
> can I find it.
>
> Cheers
>
> Paul Cowan
>
> Cutting-Edge Solutions (Scotland)
>
> http://thesoftwaresimpleton.com/
>
>
>
>
> On 6 January 2012 07:44, Michael Klishin <michael.s.klishin at gmail.com>wrote:
>
>> Paul Cowan:
>>
>> > The above code works as I want with one annoying exception. Something
>> is blocking the EM::Iterator code from being executed asynchronously. It is
>> only after the EM::Iterator code has completed that the messages are sent.
>> I want the messages to be sent asynchronously and handled by the anonymous
>> queue after each iteration. At the moment, it is only after the
>> EM::Iterator code has completed its last iteration that all the messages
>> are sent.
>> >
>>
>> This is a question for EventMachine mailing list. EventMachine::Iterator
>> is only available in beta releases of EventMachine 1.0, so use it with
>> caution.
>>
>> > Can anyone see what I am doing wrong or suggest a different approach? I
>> tried EM::defer and had the same behaviour.
>> >
>>
>> EventMachine.defer uses a thread pool with 20 threads by default. If
>> operations you defer to it are blocked, it may suggest that the issue is
>> not with something blocking the event loop.
>>
>> For example, you are using prefetch = 1 and manual acknowledgements for
>> your consumer that uses EventMachine::Iterator. However, I don't see
>> messages being acknowledged.
>>
>> You can use Wireshark GUI to record a session of what's going up and down
>> the wire (filter for "amqp").
>>
>> MK
>>
>> http://github.com/michaelklishin
>> http://twitter.com/michaelklishin
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/b209195c/attachment.htm>

From simon at rabbitmq.com  Fri Jan  6 18:19:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 Jan 2012 18:19:21 +0000
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4ED4BA64.2060504@rabbitmq.com>
References: <4ECCCB33.3040803@foldr3.com>	<4ECCCE5A.3020909@rabbitmq.com>	<4ECD0BCB.3090304@foldr3.com>	<4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com>	<4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com>	<4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com> <4ED4BA64.2060504@rabbitmq.com>
Message-ID: <4F073B29.7060303@rabbitmq.com>

On 29/11/11 10:56, Simon MacMullen wrote:
> On 28/11/11 19:26, Muharem Hrnjadovic wrote:
>> Simon, I plan to upgrade that server to ubuntu 11.10 which would give me
>> erlang 14.b.2 out of the box. Would that be good enough?
>
> Yes, that would be great. Thanks!

I know it's a month later and I believe you've reduced memory use in 
various ways, but I just saw this commit referenced on the Erlang 
mailing list:

http://erlang.org/pipermail/erlang-questions/2012-January/063593.html

https://github.com/erlang/otp/commit/caad36a5e2fc09d6a416fe31a7053bdfdb35c62d

Which points out that there's a bug in Erlang <= R14B03 which will cause 
the emulator to crash if a single process (i.e. not the entire server, 
but a single channel or queue or connection) tries to allocate more than 
32GB. This is probably pretty unlikely in RabbitMQ-land, but people with 
single gigantic queues should take note...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From shilei1980 at gmail.com  Fri Jan  6 18:02:41 2012
From: shilei1980 at gmail.com (njsss)
Date: Fri, 6 Jan 2012 10:02:41 -0800 (PST)
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
Message-ID: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>

Hello all,

I'm new to rabbitmq and python as well. I installed pika and followed
the tutorials. But what I need is an event-driving messenger. Is there
anyway to do it?

Thanks,

From bikrambhuyan at gmail.com  Fri Jan  6 20:14:02 2012
From: bikrambhuyan at gmail.com (Bikram Bhuyan)
Date: Fri, 6 Jan 2012 12:14:02 -0800
Subject: [rabbitmq-discuss] Help needed for .NET API for RabbitMQ.
Message-ID: <CAHweZgKrZK+iisOsd1KhVa5qRHgybryPRT-inT3zgcsiL5_x_Q@mail.gmail.com>

Hi Guys,

I need some help in my below requirement for implementing RabbitMQ for
.NET. Could you please help me in providing right pointer to API which can
be used to achieve this task.

1. I am right now working on a batch process in C# .net with RabbitMQ as
the communication channel.

2. I have one producer which runs every 15 minutes and put the request to
the queue with the TaskId (Say 12345) to the Queue.

3. My consumer takes the TaskId from the queue and process the other logic.

The consumer normally takes a lot of time to complete the task around 30
minutes or more, as it is a batch process which do a lot of activities. So
a lot of request are added to the queue by producer modules. So I am having
a lot of back logs for the same task id (12345) over a period of time.

So I wanted to implement the logic that if the message (12345) already
exists in the queue (not processed completely) I don?t wanted to add it to
the queue for this id (12345). Could you please send me the details of the
API calls which will give me the list of messages in a queue so that I can
have my own logic to check if the message already exists.

Thanks,

Bikram.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/a9a40401/attachment.htm>

From majek04 at gmail.com  Fri Jan  6 21:09:33 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 6 Jan 2012 21:09:33 +0000
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
In-Reply-To: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
References: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
Message-ID: <CABzX+qxfUVWh9tGqMRvo2Ew3pyFTcFfrXYysnQc+wxhSzCNXkg@mail.gmail.com>

On Fri, Jan 6, 2012 at 18:02, njsss <shilei1980 at gmail.com> wrote:
> Hello all,
>
> I'm new to rabbitmq and python as well. I installed pika and followed
> the tutorials. But what I need is an event-driving messenger. Is there
> anyway to do it?

Have you seen pika examples?
https://github.com/pika/pika/tree/master/examples

Marek

From j.14159 at gmail.com  Fri Jan  6 21:16:40 2012
From: j.14159 at gmail.com (Jeremy Pierre)
Date: Fri, 6 Jan 2012 13:16:40 -0800
Subject: [rabbitmq-discuss] RabbitMQ load issues
Message-ID: <CAHtD+9P9-7_hgHf8vcwZn3BGQEviRHZvFjn1kwnVEGy4_v7wag@mail.gmail.com>

Hi All,

At Alexis(@monadic)'s request, I'm posting a few details of an issue
that we were back and forth a bit on over Twitter about(I'm @j14159).

Full disclosure:  I expect that what I'm doing(and the type of server
I'm doing it on) may not be(or really isn't at all)
ideal/correct/whatever.

Here's the basic gist of what I'm doing:

- Ubuntu server 10.04
- RabbitMQ version 2.6.1(installed from RabbitMQ's package repo)
- Erlang R13B03(stock from Ubuntu)
- Single RabbitMQ node running on a stock Amazon EC2 m1-large(if I
recall correctly, 2 cores and 8gigs of RAM).
- Single direct exchange
- Single topic exchange
- Single vhost("/")

There are a set of harvesters collecting data from long running TCP
streams.  These harvesters send individual items to a set of
processors via the direct exchange.

The processors categorize the items by the userId they concern and a
sub-category of the type of event(there are 7 categories) and sends
them to the topic exchange with a topic following the format:

<the source of the data, irrelevant for now>.<userId>.<item's category>

So given the item categories, there are up to 7 different specific
bindings(am I using the right term?) for a queue, NOT including
wildcard ones, e.g.

"<source>.1542.category1"
"<source>.1542.category2"
"<source>.7455.category6"

Yesterday I started hammering our services a bit to test the limits,
here's the basic outline of what we did:

- There is a service that consumes individual items from the topic
exchange, reporting to user-land applications.
- A given user may subscribe a la carte to any combination of 6 out of
the 7 categories of items.
- the service creates an individual queue per category and listens for
updates(built using Akka 1.2's AMQP module)

When we got to about 110,000 queues on the topic exchange, RabbitMQ
basically stopped responding(on the direct exchange as well).  After a
little while(10-15min), rabbitmqctl could no longer even connect to
the still-running RabbitMQ instance(on the same machine).  RabbitMQ(2
processes listed in top/htop that I could see) was using ~5-ish gigs
of RAM.

We're in the process of getting a proper RabbitMQ cluster setup on
boxes with more RAM(~20gigs I think), likely 3 nodes so that will
likely alleviate some of the problems.  I've also refactored the top
layer service in question to keep a single userId's subscriptions
silo'd in one consumer(wildcard topic) which reduces the number of
bindings/queues so we're hardly in panic mode just yet ;)

Additionally, there will be more different top layer services
listening to the topic exchange in different ways - topic exchanges
provide some flexibility that we've pretty much settled on being
necessary so going to something like direct won't do, as far as I can
tell.

Sorry for the rambling post there, any and all
input/criticism/whatever is most welcome.

Regards,

Jeremy Pierre

From bmurphy1976 at gmail.com  Fri Jan  6 21:17:22 2012
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Fri, 6 Jan 2012 15:17:22 -0600
Subject: [rabbitmq-discuss] C# v2.7.1 Client Unhandled Exceptions
Message-ID: <CAP+1M2eq3JOrTrjWA70u97fYbq7feoS9h-hiR_MAQQ-fGQdibA@mail.gmail.com>

Hi Guys,

Every since upgrading to v2.7.1 we've found that the RabbitMQ driver has
been killing our applications by throwing unhandled exceptions in
background threads.  Here are two stack traces that brought down one of our
test apps:

[2012-01-06 21:13:36,193] [ERROR] Unhandled Exception
System.Net.Sockets.SocketException: The descriptor is not a socket
  at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel
optionLevel, SocketOptionName optionName, System.Object optionValue)
[0x00000] in <filename unknown>:0
  at System.Net.Sockets.TcpClient.set_LingerState
(System.Net.Sockets.LingerOption value) [0x00000] in <filename unknown>:0
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close () [0x00000] in
<filename unknown>:0
  at RabbitMQ.Client.Impl.ConnectionBase.FinishClose () [0x00000] in
<filename unknown>:0
  at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop () [0x00000] in
<filename unknown>:0
  at System.Threading.Thread.StartUnsafe () [0x00000] in <filename
unknown>:0

[2012-01-06 21:13:20,706] [ERROR] Unhandled Exception
System.ObjectDisposedException: The object was used after being disposed.
  at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel
optionLevel, SocketOptionName optionName, System.Object optionValue)
[0x00000] in <filename unknown>:0
  at System.Net.Sockets.TcpClient.set_LingerState
(System.Net.Sockets.LingerOption value) [0x00000] in <filename unknown>:0
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close () [0x00000] in
<filename unknown>:0
  at RabbitMQ.Client.Impl.ConnectionBase.FinishClose () [0x00000] in
<filename unknown>:0
  at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop () [0x00000] in
<filename unknown>:0
  at System.Threading.Thread.StartUnsafe () [0x00000] in <filename
unknown>:0

This happens on both windows and mono 2.10.1 and never seems to originate
in any of our code.

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/20b08d6c/attachment.htm>

From kot.begemot at gmail.com  Fri Jan  6 21:36:45 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Fri, 6 Jan 2012 13:36:45 -0800
Subject: [rabbitmq-discuss] C# v2.7.1 Client Unhandled Exceptions
In-Reply-To: <CAP+1M2eq3JOrTrjWA70u97fYbq7feoS9h-hiR_MAQQ-fGQdibA@mail.gmail.com>
References: <CAP+1M2eq3JOrTrjWA70u97fYbq7feoS9h-hiR_MAQQ-fGQdibA@mail.gmail.com>
Message-ID: <CAFWGgNGeC8SrjGvKwvsGQ4kCN3+HdSMeP5ToUj+i5oQFMB78Nw@mail.gmail.com>

What's your heartbeat setting?

Vadim.

On Fri, Jan 6, 2012 at 1:17 PM, Bryan Murphy <bmurphy1976 at gmail.com> wrote:

> Hi Guys,
>
> Every since upgrading to v2.7.1 we've found that the RabbitMQ driver has
> been killing our applications by throwing unhandled exceptions in
> background threads.  Here are two stack traces that brought down one of our
> test apps:
>
> [2012-01-06 21:13:36,193] [ERROR] Unhandled Exception
> System.Net.Sockets.SocketException: The descriptor is not a socket
>   at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel
> optionLevel, SocketOptionName optionName, System.Object optionValue)
> [0x00000] in <filename unknown>:0
>   at System.Net.Sockets.TcpClient.set_LingerState
> (System.Net.Sockets.LingerOption value) [0x00000] in <filename unknown>:0
>   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close () [0x00000] in
> <filename unknown>:0
>   at RabbitMQ.Client.Impl.ConnectionBase.FinishClose () [0x00000] in
> <filename unknown>:0
>   at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop () [0x00000] in
> <filename unknown>:0
>   at System.Threading.Thread.StartUnsafe () [0x00000] in <filename
> unknown>:0
>
> [2012-01-06 21:13:20,706] [ERROR] Unhandled Exception
> System.ObjectDisposedException: The object was used after being disposed.
>   at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel
> optionLevel, SocketOptionName optionName, System.Object optionValue)
> [0x00000] in <filename unknown>:0
>   at System.Net.Sockets.TcpClient.set_LingerState
> (System.Net.Sockets.LingerOption value) [0x00000] in <filename unknown>:0
>   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close () [0x00000] in
> <filename unknown>:0
>   at RabbitMQ.Client.Impl.ConnectionBase.FinishClose () [0x00000] in
> <filename unknown>:0
>   at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop () [0x00000] in
> <filename unknown>:0
>   at System.Threading.Thread.StartUnsafe () [0x00000] in <filename
> unknown>:0
>
> This happens on both windows and mono 2.10.1 and never seems to originate
> in any of our code.
>
> Thanks,
> Bryan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 

From simone.busoli at gmail.com  Fri Jan  6 21:54:30 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 6 Jan 2012 22:54:30 +0100
Subject: [rabbitmq-discuss] C# v2.7.1 Client Unhandled Exceptions
In-Reply-To: <CAP+1M2eq3JOrTrjWA70u97fYbq7feoS9h-hiR_MAQQ-fGQdibA@mail.gmail.com>
References: <CAP+1M2eq3JOrTrjWA70u97fYbq7feoS9h-hiR_MAQQ-fGQdibA@mail.gmail.com>
Message-ID: <CAOn7oW88BSS-HybpE96Jjg=Au=Xsv==9TW46O3zNtY4QCZ6N+w@mail.gmail.com>

Hi Bryan, I think it's a known bug which has popped up on the list some
days ago, not sure it is fixed in the repository though, but a bug report
has been filed already. It's indeed related to heartbeat settings.
The thread was titled "Possible bug when disposing connections in .NET
client 2.7.0/1"

On Fri, Jan 6, 2012 at 22:17, Bryan Murphy <bmurphy1976 at gmail.com> wrote:

> Hi Guys,
>
> Every since upgrading to v2.7.1 we've found that the RabbitMQ driver has
> been killing our applications by throwing unhandled exceptions in
> background threads.  Here are two stack traces that brought down one of our
> test apps:
>
> [2012-01-06 21:13:36,193] [ERROR] Unhandled Exception
> System.Net.Sockets.SocketException: The descriptor is not a socket
>   at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel
> optionLevel, SocketOptionName optionName, System.Object optionValue)
> [0x00000] in <filename unknown>:0
>   at System.Net.Sockets.TcpClient.set_LingerState
> (System.Net.Sockets.LingerOption value) [0x00000] in <filename unknown>:0
>   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close () [0x00000] in
> <filename unknown>:0
>   at RabbitMQ.Client.Impl.ConnectionBase.FinishClose () [0x00000] in
> <filename unknown>:0
>   at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop () [0x00000] in
> <filename unknown>:0
>   at System.Threading.Thread.StartUnsafe () [0x00000] in <filename
> unknown>:0
>
> [2012-01-06 21:13:20,706] [ERROR] Unhandled Exception
> System.ObjectDisposedException: The object was used after being disposed.
>   at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel
> optionLevel, SocketOptionName optionName, System.Object optionValue)
> [0x00000] in <filename unknown>:0
>   at System.Net.Sockets.TcpClient.set_LingerState
> (System.Net.Sockets.LingerOption value) [0x00000] in <filename unknown>:0
>   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close () [0x00000] in
> <filename unknown>:0
>   at RabbitMQ.Client.Impl.ConnectionBase.FinishClose () [0x00000] in
> <filename unknown>:0
>   at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop () [0x00000] in
> <filename unknown>:0
>   at System.Threading.Thread.StartUnsafe () [0x00000] in <filename
> unknown>:0
>
> This happens on both windows and mono 2.10.1 and never seems to originate
> in any of our code.
>
> Thanks,
> Bryan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/fe05be85/attachment.htm>

From njsss2011 at gmail.com  Fri Jan  6 21:54:55 2012
From: njsss2011 at gmail.com (njsss)
Date: Fri, 6 Jan 2012 13:54:55 -0800 (PST)
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
In-Reply-To: <CABzX+qxfUVWh9tGqMRvo2Ew3pyFTcFfrXYysnQc+wxhSzCNXkg@mail.gmail.com>
References: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
	<CABzX+qxfUVWh9tGqMRvo2Ew3pyFTcFfrXYysnQc+wxhSzCNXkg@mail.gmail.com>
Message-ID: <74b53963-82f2-4d1c-bc9c-2feb781239fe@l24g2000yqm.googlegroups.com>

Marek,

Thank you for your reply. No I didn't see these examples, but I did
take a look at the pika online document.
I read the statement of using "selectconnection" instead of
"blockingconnection", and I tried the demo_receive.py.
The problem I see is that at the end there's this ioloop, which I
first thought only running at background, but instead continue
blocking until ctrl+C.
However, I have a panda3d game animation, and I want while it is
rendering, still can listen outside calls and make certain changes.
With the ioloop, the animation won't even be able to start. without
it, the connection does not seem to fully connected, and will not
listen to the rabbitmq.
What is the easiest to do it?

Thanks

Lei


On Jan 6, 3:09?pm, Marek Majkowski <maje... at gmail.com> wrote:
> On Fri, Jan 6, 2012 at 18:02, njsss <shilei1... at gmail.com> wrote:
> > Hello all,
>
> > I'm new to rabbitmq and python as well. I installed pika and followed
> > the tutorials. But what I need is an event-driving messenger. Is there
> > anyway to do it?
>
> Have you seen pika examples?https://github.com/pika/pika/tree/master/examples
>
> Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pacesysjosh at gmail.com  Fri Jan  6 22:43:36 2012
From: pacesysjosh at gmail.com (Josh Stone)
Date: Fri, 6 Jan 2012 14:43:36 -0800
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Handling
	failover
Message-ID: <CAELmV7DcmSLT9F=+KkeDpKT3e_QiOP1okOwWt90QhCpgRf9u4A@mail.gmail.com>

I'm looking at the consistent hash exchange for a project, and am wondering
what happens when one or more rabbitmq nodes go down or the entire cluster
goes down. Assuming we're using active/active HA, the queues can be
recovered. But my concern is that the consistent hashing will be different
when the system comes up again. Messages that previously would have hashed
to queue A might now hash to queue B. This would be problematic if queue
A's consumer is processing a previous message that now hashes to queue B.

Is this a valid concern or are failures handled nicely via some other means?

Thanks,
Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/5a6d14ff/attachment.htm>

From ekirpichov at gmail.com  Sat Jan  7 06:31:01 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Sat, 7 Jan 2012 10:31:01 +0400
Subject: [rabbitmq-discuss] Help needed for .NET API for RabbitMQ.
In-Reply-To: <CAHweZgKrZK+iisOsd1KhVa5qRHgybryPRT-inT3zgcsiL5_x_Q@mail.gmail.com>
References: <CAHweZgKrZK+iisOsd1KhVa5qRHgybryPRT-inT3zgcsiL5_x_Q@mail.gmail.com>
Message-ID: <CANVKUrX7q9XwNeJjwb5p=eQZ5PDnwXavfJsDZf8uLuyhhR+djA@mail.gmail.com>

Hi Bikram,

Why don't you place the deduplication on producer side? E.g. consumer sends
back messages that the task has been processed, and the producer only puts
the task into the queue if the last one has already been processed.

On Sat, Jan 7, 2012 at 12:14 AM, Bikram Bhuyan <bikrambhuyan at gmail.com>wrote:

> Hi Guys,
>
> I need some help in my below requirement for implementing RabbitMQ for
> .NET. Could you please help me in providing right pointer to API which can
> be used to achieve this task.
>
> 1. I am right now working on a batch process in C# .net with RabbitMQ as
> the communication channel.
>
> 2. I have one producer which runs every 15 minutes and put the request to
> the queue with the TaskId (Say 12345) to the Queue.
>
> 3. My consumer takes the TaskId from the queue and process the other logic.
>
> The consumer normally takes a lot of time to complete the task around 30
> minutes or more, as it is a batch process which do a lot of activities. So
> a lot of request are added to the queue by producer modules. So I am having
> a lot of back logs for the same task id (12345) over a period of time.
>
> So I wanted to implement the logic that if the message (12345) already
> exists in the queue (not processed completely) I don?t wanted to add it to
> the queue for this id (12345). Could you please send me the details of the
> API calls which will give me the list of messages in a queue so that I can
> have my own logic to check if the message already exists.
>
> Thanks,
>
> Bikram.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120107/bb3e6e46/attachment.htm>

From bikrambhuyan at gmail.com  Sat Jan  7 06:58:51 2012
From: bikrambhuyan at gmail.com (Bikram Bhuyan)
Date: Fri, 6 Jan 2012 22:58:51 -0800
Subject: [rabbitmq-discuss] Help needed for .NET API for RabbitMQ.
In-Reply-To: <CANVKUrX7q9XwNeJjwb5p=eQZ5PDnwXavfJsDZf8uLuyhhR+djA@mail.gmail.com>
References: <CAHweZgKrZK+iisOsd1KhVa5qRHgybryPRT-inT3zgcsiL5_x_Q@mail.gmail.com>
	<CANVKUrX7q9XwNeJjwb5p=eQZ5PDnwXavfJsDZf8uLuyhhR+djA@mail.gmail.com>
Message-ID: <CAHweZg+sQYj7bVewtQnJ5fExRbXqEjR6GgwfRqQoYJrFnt-mXA@mail.gmail.com>

Hi Eugene,

I am trying to do that. But not sure how to know if the item is already in
the queue. That what I am trying to achieve it. Could you please give some
pointor or logic hot to achieve it?

Thanks,
Bikram.
On Fri, Jan 6, 2012 at 10:31 PM, Eugene Kirpichov <ekirpichov at gmail.com>wrote:

> Hi Bikram,
>
> Why don't you place the deduplication on producer side? E.g. consumer
> sends back messages that the task has been processed, and the producer only
> puts the task into the queue if the last one has already been processed.
>
> On Sat, Jan 7, 2012 at 12:14 AM, Bikram Bhuyan <bikrambhuyan at gmail.com>wrote:
>
>> Hi Guys,
>>
>> I need some help in my below requirement for implementing RabbitMQ for
>> .NET. Could you please help me in providing right pointer to API which can
>> be used to achieve this task.
>>
>> 1. I am right now working on a batch process in C# .net with RabbitMQ as
>> the communication channel.
>>
>> 2. I have one producer which runs every 15 minutes and put the request to
>> the queue with the TaskId (Say 12345) to the Queue.
>>
>> 3. My consumer takes the TaskId from the queue and process the other
>> logic.
>>
>> The consumer normally takes a lot of time to complete the task around 30
>> minutes or more, as it is a batch process which do a lot of activities. So
>> a lot of request are added to the queue by producer modules. So I am having
>> a lot of back logs for the same task id (12345) over a period of time.
>>
>> So I wanted to implement the logic that if the message (12345) already
>> exists in the queue (not processed completely) I don?t wanted to add it to
>> the queue for this id (12345). Could you please send me the details of the
>> API calls which will give me the list of messages in a queue so that I can
>> have my own logic to check if the message already exists.
>>
>> Thanks,
>>
>> Bikram.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120106/fab6026a/attachment.htm>

From hpk.warrier at gmail.com  Sat Jan  7 07:27:42 2012
From: hpk.warrier at gmail.com (pradeep w)
Date: Sat, 7 Jan 2012 12:57:42 +0530
Subject: [rabbitmq-discuss] lots of channel getting created
Message-ID: <CAFwZ77p5fqAAHT6LfoYuy=WWNtcNiceAyR4vLDYfWZ7ae0Vs-g@mail.gmail.com>

Hi
 I have doubt/issue regarding new channel creation. In my application I run
periodic jobs to make and publish message relevant for respective client.
Client acknowledges all the messages on consumption also

My code looks as below:


 message publication
>

            ConnectionFactory factory = new ConnectionFactory();
>             factory.setHost("localhost");
>             Connection connection = factory.newConnection();
>             Channel channel = connection.createChannel();
>             String queuename = getOBQueueName(clientId);
>             channel.queueDeclare(queuename, true, false, false, null);
>
 /**  make the message **/
>
channel.basicPublish("", queuename, MessageProperties.PERSISTENT_BASIC,
> message.getBytes());
>

            channel.close();
>             connection.close();
>


However after a while [in the management console] I see a lot of channels
[as of now more than 1000]. And most of these are not being used at all.

I would like to understand what is going wrong here.

thanks
pradeep
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120107/9859ec3e/attachment.htm>

From simone.busoli at gmail.com  Sat Jan  7 08:47:35 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 7 Jan 2012 09:47:35 +0100
Subject: [rabbitmq-discuss] Help needed for .NET API for RabbitMQ.
In-Reply-To: <CAHweZg+sQYj7bVewtQnJ5fExRbXqEjR6GgwfRqQoYJrFnt-mXA@mail.gmail.com>
References: <CAHweZgKrZK+iisOsd1KhVa5qRHgybryPRT-inT3zgcsiL5_x_Q@mail.gmail.com>
	<CANVKUrX7q9XwNeJjwb5p=eQZ5PDnwXavfJsDZf8uLuyhhR+djA@mail.gmail.com>
	<CAHweZg+sQYj7bVewtQnJ5fExRbXqEjR6GgwfRqQoYJrFnt-mXA@mail.gmail.com>
Message-ID: <CAOn7oW8SBoZvGRO4wVL_=Xk30mkYCv9=Mi6iCiMeks-fgocBtw@mail.gmail.com>

You cannot know directly if a specific item is in queue, but you can come
up with a way to figure it out. For example you might set up the consumers
to reply to the producer when they complete processing an item. In this way
the producer can avoid submitting items that haven't been processed yet.
In order to do this you have to set up some sort of request/reply, of which
you can find an example in the tutorials section of the website.
On Jan 7, 2012 7:59 AM, "Bikram Bhuyan" <bikrambhuyan at gmail.com> wrote:

> Hi Eugene,
>
> I am trying to do that. But not sure how to know if the item is already in
> the queue. That what I am trying to achieve it. Could you please give some
> pointor or logic hot to achieve it?
>
> Thanks,
> Bikram.
> On Fri, Jan 6, 2012 at 10:31 PM, Eugene Kirpichov <ekirpichov at gmail.com>wrote:
>
>> Hi Bikram,
>>
>> Why don't you place the deduplication on producer side? E.g. consumer
>> sends back messages that the task has been processed, and the producer only
>> puts the task into the queue if the last one has already been processed.
>>
>> On Sat, Jan 7, 2012 at 12:14 AM, Bikram Bhuyan <bikrambhuyan at gmail.com>wrote:
>>
>>> Hi Guys,
>>>
>>> I need some help in my below requirement for implementing RabbitMQ for
>>> .NET. Could you please help me in providing right pointer to API which can
>>> be used to achieve this task.
>>>
>>> 1. I am right now working on a batch process in C# .net with RabbitMQ as
>>> the communication channel.
>>>
>>> 2. I have one producer which runs every 15 minutes and put the request
>>> to the queue with the TaskId (Say 12345) to the Queue.
>>>
>>> 3. My consumer takes the TaskId from the queue and process the other
>>> logic.
>>>
>>> The consumer normally takes a lot of time to complete the task around 30
>>> minutes or more, as it is a batch process which do a lot of activities. So
>>> a lot of request are added to the queue by producer modules. So I am having
>>> a lot of back logs for the same task id (12345) over a period of time.
>>>
>>> So I wanted to implement the logic that if the message (12345) already
>>> exists in the queue (not processed completely) I don?t wanted to add it to
>>> the queue for this id (12345). Could you please send me the details of the
>>> API calls which will give me the list of messages in a queue so that I can
>>> have my own logic to check if the message already exists.
>>>
>>> Thanks,
>>>
>>> Bikram.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120107/561bc977/attachment.htm>

From jvhiemer at googlemail.com  Sat Jan  7 15:38:17 2012
From: jvhiemer at googlemail.com (jhiemer)
Date: Sat, 7 Jan 2012 07:38:17 -0800 (PST)
Subject: [rabbitmq-discuss] Complete JSON Objects definition of RabbitMQ
	Management Plugin
Message-ID: <128a1ed7-7a30-488d-8de6-738f3cc4e15d@p42g2000vbt.googlegroups.com>

Hi,
I am currently searching for an existing definition of all JSON
Objects which are receivable via HTTP API. Does any one here has the
definitions?

Thanks a lot and have a nice weekend!

Johannes

From isaias.barroso at gmail.com  Sat Jan  7 20:38:22 2012
From: isaias.barroso at gmail.com (Isaias Barroso)
Date: Sat, 7 Jan 2012 18:38:22 -0200
Subject: [rabbitmq-discuss] Orchestration vs. Choreography
Message-ID: <CAHi+jtQQJp6BbJnCwbZkf-1k4Bz+zTj+NaKHKzPv=vzEK9amkQ@mail.gmail.com>

Dear all,

I'm design a process that is splitted on some tasks (one queue for each
piece of process). To a sample, suppose I have a message that can treated
for many steps: Retrieve Information, enrich information, Save on Database,
but each step can occurs or not, so I've thought about on two approaches :

1 - Orchestration: In this case a central component will receive the
message and decide for each step, after execution of each step this
component will decide the next step.
2 - Choreography: In this case each step must to know the next step and
send message for next queue

Does anybody has some opinion about the better approach? Does anybody knows
some tool/framework that works top of Rabbit that manage it (Java if
possible) ?


Best regards


-- 
Isa?as Barroso
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120107/1cc8bf5b/attachment.htm>

From monosodiumg at gmail.com  Sat Jan  7 21:13:05 2012
From: monosodiumg at gmail.com (monosodiumg)
Date: Sat, 7 Jan 2012 13:13:05 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ to the browser - scale question
In-Reply-To: <CABzX+qwf=T_YW3SGL+-ic4mGL_YzL6sj4AGGBnyWd6DmM-MgjA@mail.gmail.com>
References: <b2f00a6e-4af2-4929-a9e0-01b838e29122@u5g2000vbd.googlegroups.com>
	<CABzX+qwf=T_YW3SGL+-ic4mGL_YzL6sj4AGGBnyWd6DmM-MgjA@mail.gmail.com>
Message-ID: <91b37898-1796-400f-9a0c-49bee64aa92d@t16g2000vba.googlegroups.com>

Thanks for that analysis. It's clear to me now that RabbitMQ doesn't
work for push at the scale I would need - yet.

On Jan 5, 12:01?pm, Marek Majkowski <maje... at gmail.com> wrote:
> On Wed, Dec 21, 2011 at 01:28, monosodiumg <monosodi... at gmail.com> wrote:
> > My use case is distributing data updates ?to user's browsers. Typical
> > initial load of 5KB and updates of <200B at a rate of 0.5 updates/s.
> > I have 500 topics and 1M browser clients, with a very uneven sub
> > profile ?e.g. 30% of users subscribing to the same one topic. Most
> > users subscribe to just one topic. Clients using browsers are a bit
> > erratic.
>
> Outgoing messages = 1M * 0.5 msg/sec =500Kmsg/sec
>
> A normal RabbitMQ broker should handle around 30K msg/sec.
> With a strong box, new Erlang and HIPE enabled you should
> be able to get up to 50K msg/sec per box.
>
> So, for your needs you should consider partitioning the clients
> and using mulitple brokers. As far as I understand most messages
> are broadcasted (you mentioned 500 topics). Just forwarding
> all messages to all brokers should do (as far as the rate of
> produced messages is reasonable, let's say few K msg/sec).
>
> By using multiple brokers you also will gain a bit of fault tolerance.
>
> Outgoing throughput = 5KB * churn_rate_per_sec + 1M clients * 200B * 0.5 sec
> ? - that's around 100MiB/s
>
> Yes, you should use multiple brokers :)
>
> > I have a few questions:
> > 1. Can RabbitMQ handle that load?
>
> Use mutliple brokers and publish all messages to all of them.
>
> > 2. What is the roadmap for rabbitmq_jsonrpc_channel?
>
> As you may see from the commit history we're not heavily
> working on it at the minute. We're considering creating a plugin
> that would combine SockJS and rabbitmq-stomp plugin, in order to
> allow some form of web messaging.
>
> > 3. How does RabbitMQ (+jsonrpc plugin) deal with browser clients
> > failing to disconnect explicitly?
>
> Frankly - I don't know!
>
> > 4. What does this mean for thread and socket counts server-side?
>
> Erlang/Rabbit don't use too much operating system threads, don't worry
> about that.
> But Erlang does use a thing called "erlang processes", and there is a
> preconfigured limit for that. If you're considering starting many connections
> against a single RabbitMQ broker you may consider updating that limit.
>
> Socket limit is on most unix-es set to 1024. Feel free to modify this
> number using `ulimit -n`.
>
> Additionally, rabbitmq-management plugin shows files/sockets counters,
> you can use that to see how rabbit is doing and how many file descriptors
> are still available.
>
> Cheers,
> ? ?Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From blalor at bravo5.org  Sat Jan  7 22:33:52 2012
From: blalor at bravo5.org (Brian Lalor)
Date: Sat, 7 Jan 2012 17:33:52 -0500
Subject: [rabbitmq-discuss] RabbitMQ to the browser - scale question
In-Reply-To: <91b37898-1796-400f-9a0c-49bee64aa92d@t16g2000vba.googlegroups.com>
References: <b2f00a6e-4af2-4929-a9e0-01b838e29122@u5g2000vbd.googlegroups.com>
	<CABzX+qwf=T_YW3SGL+-ic4mGL_YzL6sj4AGGBnyWd6DmM-MgjA@mail.gmail.com>
	<91b37898-1796-400f-9a0c-49bee64aa92d@t16g2000vba.googlegroups.com>
Message-ID: <E7B77283-AEAA-4F4C-8282-6D5FD33FD63C@bravo5.org>

On Jan 5, 12:01 pm, Marek Majkowski <maje... at gmail.com> wrote:

>> 2. What is the roadmap for rabbitmq_jsonrpc_channel?
> 
> As you may see from the commit history we're not heavily
> working on it at the minute. We're considering creating a plugin
> that would combine SockJS and rabbitmq-stomp plugin, in order to
> allow some form of web messaging.

I've got a very small-scale implementation of real-time updates to the browser using Node.js and Socket.IO.  My browser (Safari on iOS and OS X) supports WebSockets.  I don't know about throughput, but I'm very happy with the simplicity of the implementation.

The server:
https://github.com/blalor/home-automator/blob/master/ui/amqp_socketio_bridge.js

The client-side JavaScript:
https://github.com/blalor/home-automator/blob/master/ui/static/live_power/main.js

Basically, the browser connects to the Node.js server and subscribes to a couple of topics on an exchange, and then Socket.IO emits the messages as events which are received by the connected clients.

From ciprian.craciun at gmail.com  Sun Jan  8 14:02:54 2012
From: ciprian.craciun at gmail.com (Ciprian Dorin Craciun)
Date: Sun, 8 Jan 2012 16:02:54 +0200
Subject: [rabbitmq-discuss] Orchestration vs. Choreography
In-Reply-To: <CAHi+jtQQJp6BbJnCwbZkf-1k4Bz+zTj+NaKHKzPv=vzEK9amkQ@mail.gmail.com>
References: <CAHi+jtQQJp6BbJnCwbZkf-1k4Bz+zTj+NaKHKzPv=vzEK9amkQ@mail.gmail.com>
Message-ID: <CA+Tk8fxXzEorpMAf5Z8EP=Sghqtqzs8aQ6G=xnJPxQ3zB-9M+A@mail.gmail.com>

On Sat, Jan 7, 2012 at 22:38, Isaias Barroso <isaias.barroso at gmail.com> wrote:
> Dear all,
>
> I'm design a process that is splitted on some tasks (one queue for each
> piece of process). To a sample, suppose I have a message that can treated
> for many steps: Retrieve Information, enrich information, Save on Database,
> but each step can occurs or not, so I've thought about on two approaches :
>
> 1 - Orchestration: In this case a central component will receive the message
> and decide for each step, after execution of each step this component will
> decide the next step.
> 2 - Choreography: In this case each step must to know the next step and send
> message for next queue
>
> Does anybody has some opinion about the better approach? Does anybody knows
> some tool/framework that works top of Rabbit that manage it (Java if
> possible) ?
>
> Best regards
> --
> Isa?as Barroso


    I've also pondered about the same topic a while ago... (Though I
haven't tried it in practice.) As such my options were the following:

    a) (the easiest one) Go with the choreography approach, but
instead of naming the queue of the next service (and send to a direct
exchange), just send it to an exchange named by the next step's
purpose (like "enrich", "validate", etc.). Maybe make this a topic
exchange and put enough information in the routing key to allow
"debugging" by being able to register another queue and "capture" the
traffic.

    b) (the "declarative" approach) Why not have the orchestration
approach (in a declarative flavor) combined with choreography:
    * let's assume that you have a task which goes through a set of
processes (transformations or just validations, etc.) which can be
described as decision tree (a binary tree of actions, where each node
is a process and the two children (one for success and one for
failure) are the next process to be executed);
    * now you just put this decision tree inside the "envelope" of
each message, send it to the root process;
    * this process executes its logic and based on the outcome
(success or failure), extracts one of it's subtrees, puts that in the
new envelope and together with the new message sends it to the root of
the new tree; (evidently at some point the new tree would be empty,
which means it should stop sending it further;)
    * (you could again use "purpose" names for exchanges instead of
direct queues;)
    * you could extend this to a graph (maybe containing cycles, thus
obtaining loops), by saying that each node has two links to other
nodes;
    * of course yet another extension would be to allow "labeled" node
links, i.e. each process outputs two things: a next-step string label,
and the new message, and now you select from the labeled links the one
matching the label; (maybe have something as a default link);

    Thus with option b) you obtain both the advantages of choreography
(i.e. no middle man to become a single point of failure or
bottleneck), but also the advantages of orchestration (i.e. each
message having it's own "route" through the processes). At the same
time you keep the processors "dumb", none knowing of another.

    Hope this helps.
    Ciprian.

    P.S.: If you like this approach (b), you could go even further and
instead of using a static decision tree (or graph) you could
substitute that with an embedded language or machine which allows
generic operations on both the old and new message to decide the next
actions. (I could expand on this if someone is interested.)

    A practical (not very elegant) Java approach:
    * define a Java interface with a method like `public AmqpTarget
decide (MyMessage old, MyMessage new)` (or something similar), where
`AmqpTarget` has two fields for exchange and routing key;
    a) if all the processes share the same code and are upgraded at
the same time, just instantiate a serializable object implementing
that interface and put that in the envelope instead of the decision
tree;
    b) if you don't have shared code or you want to keep your options opened:
    * for each different "workflow" define a new public "top" class
(i.e. not nested or anonymous) implementing that interface with as few
dependencies as possible;
    * in the envelope instead of the decision tree put the byte-code
of this class (you can use the
`MyWorkflowClass.class.getResourceStream(MyWorkflowClass.class.getCanonicalName())`
and the canonical name; (be careful to use caching or you'll get
`PermGenError` or similar;)
    * to instantiate the class on the receiver just create a custom
classloader which when asked for the bytecode of that known class just
returns the bytes previously stored;

From isaias.barroso at gmail.com  Sun Jan  8 14:46:34 2012
From: isaias.barroso at gmail.com (Isaias Barroso)
Date: Sun, 8 Jan 2012 12:46:34 -0200
Subject: [rabbitmq-discuss] Orchestration vs. Choreography
In-Reply-To: <CA+Tk8fxXzEorpMAf5Z8EP=Sghqtqzs8aQ6G=xnJPxQ3zB-9M+A@mail.gmail.com>
References: <CAHi+jtQQJp6BbJnCwbZkf-1k4Bz+zTj+NaKHKzPv=vzEK9amkQ@mail.gmail.com>
	<CA+Tk8fxXzEorpMAf5Z8EP=Sghqtqzs8aQ6G=xnJPxQ3zB-9M+A@mail.gmail.com>
Message-ID: <CAHi+jtRXAJru+oS=6xXkX_9H_JkJvHhWbrPWv+zwuSeMBL4Bwg@mail.gmail.com>

Hi Ciprian,


    I've also pondered about the same topic a while ago... (Though I
> haven't tried it in practice.) As such my options were the following:
>
>    a) (the easiest one) Go with the choreography approach, but
> instead of naming the queue of the next service (and send to a direct
> exchange), just send it to an exchange named by the next step's
> purpose (like "enrich", "validate", etc.). Maybe make this a topic
> exchange and put enough information in the routing key to allow
> "debugging" by being able to register another queue and "capture" the
> traffic.
>
>
Yes, I agree with you, send to a exchange is more apropriate


>    b) (the "declarative" approach) Why not have the orchestration
> approach (in a declarative flavor) combined with choreography:
>    * let's assume that you have a task which goes through a set of
> processes (transformations or just validations, etc.) which can be
> described as decision tree (a binary tree of actions, where each node
> is a process and the two children (one for success and one for
> failure) are the next process to be executed);
>    * now you just put this decision tree inside the "envelope" of
> each message, send it to the root process;
>    * this process executes its logic and based on the outcome
> (success or failure), extracts one of it's subtrees, puts that in the
> new envelope and together with the new message sends it to the root of
> the new tree; (evidently at some point the new tree would be empty,
> which means it should stop sending it further;)
>    * (you could again use "purpose" names for exchanges instead of
> direct queues;)
>    * you could extend this to a graph (maybe containing cycles, thus
> obtaining loops), by saying that each node has two links to other
> nodes;
>    * of course yet another extension would be to allow "labeled" node
> links, i.e. each process outputs two things: a next-step string label,
> and the new message, and now you select from the labeled links the one
> matching the label; (maybe have something as a default link);
>
>    Thus with option b) you obtain both the advantages of choreography
> (i.e. no middle man to become a single point of failure or
> bottleneck), but also the advantages of orchestration (i.e. each
> message having it's own "route" through the processes). At the same
> time you keep the processors "dumb", none knowing of another.
>

Very interesting this approach, and better the possibility to eliminate a
possible SPOF.



>
>    Hope this helps.
>    Ciprian.
>
>    P.S.: If you like this approach (b), you could go even further and
> instead of using a static decision tree (or graph) you could
> substitute that with an embedded language or machine which allows
> generic operations on both the old and new message to decide the next
> actions. (I could expand on this if someone is interested.)
>
> I think that (b) approach can be more flexible for large and complex
process and it sounds good.

Maybe this topic can generate good discussions and patterns for complex
process management.

Best regards




>    A practical (not very elegant) Java approach:
>    * define a Java interface with a method like `public AmqpTarget
> decide (MyMessage old, MyMessage new)` (or something similar), where
> `AmqpTarget` has two fields for exchange and routing key;
>    a) if all the processes share the same code and are upgraded at
> the same time, just instantiate a serializable object implementing
> that interface and put that in the envelope instead of the decision
> tree;
>    b) if you don't have shared code or you want to keep your options
> opened:
>    * for each different "workflow" define a new public "top" class
> (i.e. not nested or anonymous) implementing that interface with as few
> dependencies as possible;
>    * in the envelope instead of the decision tree put the byte-code
> of this class (you can use the
>
> `MyWorkflowClass.class.getResourceStream(MyWorkflowClass.class.getCanonicalName())`
> and the canonical name; (be careful to use caching or you'll get
> `PermGenError` or similar;)
>    * to instantiate the class on the receiver just create a custom
> classloader which when asked for the bytecode of that known class just
> returns the bytes previously stored;
>



-- 
Isa?as Barroso
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120108/4e56504b/attachment.htm>

From isaias.barroso at gmail.com  Sun Jan  8 14:52:34 2012
From: isaias.barroso at gmail.com (Isaias Barroso)
Date: Sun, 8 Jan 2012 12:52:34 -0200
Subject: [rabbitmq-discuss] Orchestration vs. Choreography
In-Reply-To: <CAHi+jtRXAJru+oS=6xXkX_9H_JkJvHhWbrPWv+zwuSeMBL4Bwg@mail.gmail.com>
References: <CAHi+jtQQJp6BbJnCwbZkf-1k4Bz+zTj+NaKHKzPv=vzEK9amkQ@mail.gmail.com>
	<CA+Tk8fxXzEorpMAf5Z8EP=Sghqtqzs8aQ6G=xnJPxQ3zB-9M+A@mail.gmail.com>
	<CAHi+jtRXAJru+oS=6xXkX_9H_JkJvHhWbrPWv+zwuSeMBL4Bwg@mail.gmail.com>
Message-ID: <CAHi+jtRHjuGAuoFumGV2KO_oYzEnWdXW1p49Bj239b_tfW7btg@mail.gmail.com>

Hi Ciprian,

I've seen that Spring Integration with AMQP module can be a solution for
Orchestration, I'll do a deep analysis on it. But I think is more restrict
that mixed approach (b)

Best regards



On Sun, Jan 8, 2012 at 12:46 PM, Isaias Barroso <isaias.barroso at gmail.com>wrote:

> Hi Ciprian,
>
>
>     I've also pondered about the same topic a while ago... (Though I
>> haven't tried it in practice.) As such my options were the following:
>>
>>    a) (the easiest one) Go with the choreography approach, but
>> instead of naming the queue of the next service (and send to a direct
>> exchange), just send it to an exchange named by the next step's
>> purpose (like "enrich", "validate", etc.). Maybe make this a topic
>> exchange and put enough information in the routing key to allow
>> "debugging" by being able to register another queue and "capture" the
>> traffic.
>>
>>
> Yes, I agree with you, send to a exchange is more apropriate
>
>
>>    b) (the "declarative" approach) Why not have the orchestration
>> approach (in a declarative flavor) combined with choreography:
>>    * let's assume that you have a task which goes through a set of
>> processes (transformations or just validations, etc.) which can be
>> described as decision tree (a binary tree of actions, where each node
>> is a process and the two children (one for success and one for
>> failure) are the next process to be executed);
>>    * now you just put this decision tree inside the "envelope" of
>> each message, send it to the root process;
>>    * this process executes its logic and based on the outcome
>> (success or failure), extracts one of it's subtrees, puts that in the
>> new envelope and together with the new message sends it to the root of
>> the new tree; (evidently at some point the new tree would be empty,
>> which means it should stop sending it further;)
>>    * (you could again use "purpose" names for exchanges instead of
>> direct queues;)
>>    * you could extend this to a graph (maybe containing cycles, thus
>> obtaining loops), by saying that each node has two links to other
>> nodes;
>>    * of course yet another extension would be to allow "labeled" node
>> links, i.e. each process outputs two things: a next-step string label,
>> and the new message, and now you select from the labeled links the one
>> matching the label; (maybe have something as a default link);
>>
>>    Thus with option b) you obtain both the advantages of choreography
>> (i.e. no middle man to become a single point of failure or
>> bottleneck), but also the advantages of orchestration (i.e. each
>> message having it's own "route" through the processes). At the same
>> time you keep the processors "dumb", none knowing of another.
>>
>
> Very interesting this approach, and better the possibility to eliminate a
> possible SPOF.
>
>
>
>>
>>    Hope this helps.
>>    Ciprian.
>>
>>    P.S.: If you like this approach (b), you could go even further and
>> instead of using a static decision tree (or graph) you could
>> substitute that with an embedded language or machine which allows
>> generic operations on both the old and new message to decide the next
>> actions. (I could expand on this if someone is interested.)
>>
>> I think that (b) approach can be more flexible for large and complex
> process and it sounds good.
>
> Maybe this topic can generate good discussions and patterns for complex
> process management.
>
> Best regards
>
>
>
>
>>    A practical (not very elegant) Java approach:
>>    * define a Java interface with a method like `public AmqpTarget
>> decide (MyMessage old, MyMessage new)` (or something similar), where
>> `AmqpTarget` has two fields for exchange and routing key;
>>    a) if all the processes share the same code and are upgraded at
>> the same time, just instantiate a serializable object implementing
>> that interface and put that in the envelope instead of the decision
>> tree;
>>    b) if you don't have shared code or you want to keep your options
>> opened:
>>    * for each different "workflow" define a new public "top" class
>> (i.e. not nested or anonymous) implementing that interface with as few
>> dependencies as possible;
>>    * in the envelope instead of the decision tree put the byte-code
>> of this class (you can use the
>>
>> `MyWorkflowClass.class.getResourceStream(MyWorkflowClass.class.getCanonicalName())`
>> and the canonical name; (be careful to use caching or you'll get
>> `PermGenError` or similar;)
>>    * to instantiate the class on the receiver just create a custom
>> classloader which when asked for the bytecode of that known class just
>> returns the bytes previously stored;
>>
>
>
>
> --
> Isa?as Barroso
>
>


-- 
Isa?as Barroso
Consultor SAP NetWeaver / Oracle (SOA / ADF) / JEE
Belo Horizonte - MG
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120108/0b70a406/attachment.htm>

From dagda1 at scotalt.net  Sun Jan  8 15:36:36 2012
From: dagda1 at scotalt.net (Paul Cowan)
Date: Sun, 8 Jan 2012 15:36:36 +0000
Subject: [rabbitmq-discuss] EventMachine EM::Iterator being blocked with
 rabbitmq rbc
In-Reply-To: <CAEBV8YRcyu-H85u4emUN0H-aE7RX6D3Oqx0BkTDkVMAKf0-WyQ@mail.gmail.com>
References: <CAEBV8YQtZ2RnxoYCFsZAroeeerZ+HO0qu6z6vaOH_NjEPL33Aw@mail.gmail.com>
	<08A166E4-DF97-487C-BA3B-5EDB662751B9@gmail.com>
	<CAEBV8YS6H+q0CKwqjGoKYWKM5FyQDvKwwBkLPorZ0CrjBN_S1g@mail.gmail.com>
	<CAEBV8YRcyu-H85u4emUN0H-aE7RX6D3Oqx0BkTDkVMAKf0-WyQ@mail.gmail.com>
Message-ID: <CAEBV8YTmty+Kj7gLkMO16_jYcC9Lgeq9GomE1jWFiKMAYUMgpg@mail.gmail.com>

Hi,

Spinning up a new thread was the answer to my problem:

              Thread.new do
                5.times do
                  lead = get_lead(n, (n == 5))

                  puts "message #{n} is_last = #{lead.is_last} at
#{Time.now}";

                  AMQP::Exchange.default.publish(
                                                  MultiJson.encode(lead),
                                                  :routing_key =>
header.reply_to,
                                                  :correlation_id =>
header.correlation_id
                                                )

                  n += 1
                  sleep(2)
                end
              end

Creating a new thread stops the EventMachine reactor being blocked and the
messages are sent async.

Cheers

Paul Cowan

Cutting-Edge Solutions (Scotland)

http://thesoftwaresimpleton.com/



On 6 January 2012 17:38, Paul Cowan <dagda1 at scotalt.net> wrote:

> Hi,
>
> I have refactored my code to use EM::defer.  I still have the same problem
> as before.
>
> I am a bit new to rabbitmq and EventMachine, I wonder if anyone could
> review the EM::defer code in the following gist:
>
> https://gist.github.com/1571453
>
> Also, do you think the header.ack on line 44 of the gist is in the right
> place?
>
> Cheers
>
> Paul Cowan
>
> Cutting-Edge Solutions (Scotland)
>
> http://thesoftwaresimpleton.com/
>
>
>
> On 6 January 2012 08:39, Paul Cowan <dagda1 at scotalt.net> wrote:
>
>> Hi,
>>
>> Thanks for the answer, I will rollback to EM::defer and checkout what is
>> going on over wireshark.
>>
>> Is there any documentation for the append_callback method and if so,
>> where can I find it.
>>
>> Cheers
>>
>> Paul Cowan
>>
>> Cutting-Edge Solutions (Scotland)
>>
>> http://thesoftwaresimpleton.com/
>>
>>
>>
>>
>> On 6 January 2012 07:44, Michael Klishin <michael.s.klishin at gmail.com>wrote:
>>
>>> Paul Cowan:
>>>
>>> > The above code works as I want with one annoying exception. Something
>>> is blocking the EM::Iterator code from being executed asynchronously. It is
>>> only after the EM::Iterator code has completed that the messages are sent.
>>> I want the messages to be sent asynchronously and handled by the anonymous
>>> queue after each iteration. At the moment, it is only after the
>>> EM::Iterator code has completed its last iteration that all the messages
>>> are sent.
>>> >
>>>
>>> This is a question for EventMachine mailing list. EventMachine::Iterator
>>> is only available in beta releases of EventMachine 1.0, so use it with
>>> caution.
>>>
>>> > Can anyone see what I am doing wrong or suggest a different approach?
>>> I tried EM::defer and had the same behaviour.
>>> >
>>>
>>> EventMachine.defer uses a thread pool with 20 threads by default. If
>>> operations you defer to it are blocked, it may suggest that the issue is
>>> not with something blocking the event loop.
>>>
>>> For example, you are using prefetch = 1 and manual acknowledgements for
>>> your consumer that uses EventMachine::Iterator. However, I don't see
>>> messages being acknowledged.
>>>
>>> You can use Wireshark GUI to record a session of what's going up and
>>> down the wire (filter for "amqp").
>>>
>>> MK
>>>
>>> http://github.com/michaelklishin
>>> http://twitter.com/michaelklishin
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120108/bad1c8da/attachment.htm>

From michael.s.klishin at gmail.com  Sun Jan  8 20:46:42 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 9 Jan 2012 00:46:42 +0400
Subject: [rabbitmq-discuss] EventMachine EM::Iterator being blocked with
	rabbitmq rbc
In-Reply-To: <CAEBV8YTmty+Kj7gLkMO16_jYcC9Lgeq9GomE1jWFiKMAYUMgpg@mail.gmail.com>
References: <CAEBV8YQtZ2RnxoYCFsZAroeeerZ+HO0qu6z6vaOH_NjEPL33Aw@mail.gmail.com>
	<08A166E4-DF97-487C-BA3B-5EDB662751B9@gmail.com>
	<CAEBV8YS6H+q0CKwqjGoKYWKM5FyQDvKwwBkLPorZ0CrjBN_S1g@mail.gmail.com>
	<CAEBV8YRcyu-H85u4emUN0H-aE7RX6D3Oqx0BkTDkVMAKf0-WyQ@mail.gmail.com>
	<CAEBV8YTmty+Kj7gLkMO16_jYcC9Lgeq9GomE1jWFiKMAYUMgpg@mail.gmail.com>
Message-ID: <DCCC916E-3A3A-42C3-95BF-74F7E7675466@gmail.com>

Paul Cowan:

> Spinning up a new thread was the answer to my problem:
> 
>               Thread.new do
>                 5.times do
>                   lead = get_lead(n, (n == 5))
> 
>                   puts "message #{n} is_last = #{lead.is_last} at #{Time.now}";
>                 
>                   AMQP::Exchange.default.publish(
>                                                   MultiJson.encode(lead), 
>                                                   :routing_key => header.reply_to,
>                                                   :correlation_id => header.correlation_id
>                                                 )
>                 
>                   n += 1
>                   sleep(2)
>                 end
>               end

Paul,

Keep in mind that channels should not be shared between threads. I just checked the source and AMQP::Exchange.default called w/o argument opens a new channel every time but I still wanted to
remind about this.

Sharing channels used for publishing between threads may result in frames being delivered out of order.

MK



From emile at rabbitmq.com  Mon Jan  9 09:15:07 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jan 2012 09:15:07 +0000
Subject: [rabbitmq-discuss] C# v2.7.1 Client Unhandled Exceptions
In-Reply-To: <CAOn7oW88BSS-HybpE96Jjg=Au=Xsv==9TW46O3zNtY4QCZ6N+w@mail.gmail.com>
References: <CAP+1M2eq3JOrTrjWA70u97fYbq7feoS9h-hiR_MAQQ-fGQdibA@mail.gmail.com>
	<CAOn7oW88BSS-HybpE96Jjg=Au=Xsv==9TW46O3zNtY4QCZ6N+w@mail.gmail.com>
Message-ID: <4F0AB01B.3020900@rabbitmq.com>

On 06/01/12 21:54, Simone Busoli wrote:
> Hi Bryan, I think it's a known bug which has popped up on the list some
> days ago, not sure it is fixed in the repository though, but a bug
> report has been filed already. It's indeed related to heartbeat settings.
> The thread was titled "Possible bug when disposing connections in .NET
> client 2.7.0/1"

I concur with Simone, this looks very similar to the previously reported
bug. We are tracking this as bug24650, so any fixes (none yet) will
appear on a branch with that name.


-Emile

From emile at rabbitmq.com  Mon Jan  9 09:33:24 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jan 2012 09:33:24 +0000
Subject: [rabbitmq-discuss] lots of channel getting created
In-Reply-To: <CAFwZ77p5fqAAHT6LfoYuy=WWNtcNiceAyR4vLDYfWZ7ae0Vs-g@mail.gmail.com>
References: <CAFwZ77p5fqAAHT6LfoYuy=WWNtcNiceAyR4vLDYfWZ7ae0Vs-g@mail.gmail.com>
Message-ID: <4F0AB464.4060005@rabbitmq.com>

Hi Pradeep,

On 07/01/12 07:27, pradeep w wrote:

>                 channel.close();
>                 connection.close();           
> 
> However after a while [in the management console] I see a lot of
> channels [as of now more than 1000]. And most of these are not being
> used at all.

The code you posted should not leak channels, so something else must be
going wrong. Are you certain that the "channel.close();" line is being
executed? Is it possible that a different client is connecting and
failing to properly close channels?

If you are still stuck after checking this then you may want to consider
connecting to the broker via a protocol tracer which will confirm
whether your client is closing the channel or not:

http://www.rabbitmq.com/api-guide.html#tracer
http://www.rabbitmq.com/releases/rabbitmq-java-client/current-javadoc/com/rabbitmq/tools/Tracer.html


-Emile



From emile at rabbitmq.com  Mon Jan  9 09:47:46 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jan 2012 09:47:46 +0000
Subject: [rabbitmq-discuss] Help needed for .NET API for RabbitMQ.
In-Reply-To: <CAHweZg+sQYj7bVewtQnJ5fExRbXqEjR6GgwfRqQoYJrFnt-mXA@mail.gmail.com>
References: <CAHweZgKrZK+iisOsd1KhVa5qRHgybryPRT-inT3zgcsiL5_x_Q@mail.gmail.com>
	<CANVKUrX7q9XwNeJjwb5p=eQZ5PDnwXavfJsDZf8uLuyhhR+djA@mail.gmail.com>
	<CAHweZg+sQYj7bVewtQnJ5fExRbXqEjR6GgwfRqQoYJrFnt-mXA@mail.gmail.com>
Message-ID: <4F0AB7C2.2070905@rabbitmq.com>

Hi Bikram,

On 07/01/12 06:58, Bikram Bhuyan wrote:
> I am trying to do that. But not sure how to know if the item is already
> in the queue. That what I am trying to achieve it. Could you please give
> some pointor or logic hot to achieve it?

Deduplication is something that you have to perform outside the broker.
A database table of task ids is the typical solution. You could populate
this database on the client when the message is received, and update the
same task id when the processing is complete.

You could also perform the deduplication on the producer. This will
avoid the cost of queueing duplicate tasks, but you will need to think
about how you handle the case when a consumer fails while processing a task.


-Emile




From emile at rabbitmq.com  Mon Jan  9 09:55:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jan 2012 09:55:14 +0000
Subject: [rabbitmq-discuss] Complete JSON Objects definition of RabbitMQ
 Management Plugin
In-Reply-To: <128a1ed7-7a30-488d-8de6-738f3cc4e15d@p42g2000vbt.googlegroups.com>
References: <128a1ed7-7a30-488d-8de6-738f3cc4e15d@p42g2000vbt.googlegroups.com>
Message-ID: <4F0AB982.40709@rabbitmq.com>

Hi Johannes,

On 07/01/12 15:38, jhiemer wrote:
> I am currently searching for an existing definition of all JSON
> Objects which are receivable via HTTP API. Does any one here has the
> definitions?

I'm not aware of a formal schema of all possible outputs. If there was
one it would probably change between releases.

It should be possible to generate most of the schema by inspecting the
replies to all the API endpoints:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/priv/www/api/index.html


-Emile

From jvhiemer at googlemail.com  Mon Jan  9 10:02:33 2012
From: jvhiemer at googlemail.com (jhiemer)
Date: Mon, 9 Jan 2012 02:02:33 -0800 (PST)
Subject: [rabbitmq-discuss] Complete JSON Objects definition of RabbitMQ
	Management Plugin
In-Reply-To: <4F0AB982.40709@rabbitmq.com>
References: <128a1ed7-7a30-488d-8de6-738f3cc4e15d@p42g2000vbt.googlegroups.com>
	<4F0AB982.40709@rabbitmq.com>
Message-ID: <e6918ff5-5bf1-4d86-80a4-c972fe82f41e@m4g2000vbc.googlegroups.com>

Hi Emilie,
first of all, thanks a lot for your reply. I already began using that.
A nice thing would be if there are some options to auto generate POJOs
from the JSON-Objects. There a couple of tools for that, but they
always referring the url of the service and through the security
restrictions it is not possible to get the JSON Object.

On Jan 9, 10:55?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Johannes,
>
> On 07/01/12 15:38, jhiemer wrote:
>
> > I am currently searching for an existing definition of all JSON
> > Objects which are receivable via HTTP API. Does any one here has the
> > definitions?
>
> I'm not aware of a formal schema of all possible outputs. If there was
> one it would probably change between releases.
>
> It should be possible to generate most of the schema by inspecting the
> replies to all the API endpoints:http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/priv/www/...
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Jan  9 10:05:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jan 2012 10:05:30 +0000
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Handling
 failover
In-Reply-To: <CAELmV7DcmSLT9F=+KkeDpKT3e_QiOP1okOwWt90QhCpgRf9u4A@mail.gmail.com>
References: <CAELmV7DcmSLT9F=+KkeDpKT3e_QiOP1okOwWt90QhCpgRf9u4A@mail.gmail.com>
Message-ID: <4F0ABBEA.5070002@rabbitmq.com>

Hi Josh,

On 06/01/12 22:43, Josh Stone wrote:
> I'm looking at the consistent hash exchange for a project, and am
> wondering what happens when one or more rabbitmq nodes go down or the
> entire cluster goes down. Assuming we're using active/active HA, the
> queues can be recovered. But my concern is that the consistent hashing
> will be different when the system comes up again. Messages that
> previously would have hashed to queue A might now hash to queue B. This
> would be problematic if queue A's consumer is processing a previous
> message that now hashes to queue B.
> 
> Is this a valid concern or are failures handled nicely via some other means?

The consistent hash exchange maintains its state in the distributed
mnesia database, which means that it is replicated across all nodes of a
cluster. I would expect the routing logic to produce identical results
regardless of whether some nodes have failed, or after the entire
cluster restarts. Are you seeing different behaviour?


-Emile

From emile at rabbitmq.com  Mon Jan  9 10:43:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jan 2012 10:43:14 +0000
Subject: [rabbitmq-discuss] Why are deliveries still showing even though
 msg counts show 0 in admin?
In-Reply-To: <e5398a65-e756-4636-8595-b4b9c1fd6590@dp8g2000vbb.googlegroups.com>
References: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>
	<C8930831-07B9-4D98-B538-108D3B991F7B@gmail.com>
	<0469d1e9-473c-4f02-8c7e-ed6300df0199@k29g2000vbl.googlegroups.com>
	<e955c12d-9599-4ce7-85c6-918526a1aeb7@m4g2000vbc.googlegroups.com>
	<4F05AF02.3060803@rabbitmq.com>
	<e5398a65-e756-4636-8595-b4b9c1fd6590@dp8g2000vbb.googlegroups.com>
Message-ID: <4F0AC4C2.5060108@rabbitmq.com>

Hi,

On 05/01/12 14:18, AndyB wrote:
> Does 10 minutes sounds like a valid delay period?  Seems like an
> awfully long time to me.

I does seem like a very long time. Can you confirm that this is
happening on a single node (no clustering), clients are not using
auto-ack, and QoS prefetching is set to 2?

I understand that after all the message counts have reached 0, and
publishers stopped publishing you see a positive delivery rate for 10
minutes.

What is the delivery rate you see during the 10 minutes?
I assume publishers are connected during the 10 minutes - are any of
them perhaps publishing at a low rate?

> I understand that the message is always delivered from RAM.  But if
> the message was on disk, it has to be pulled from there and put into
> RAM to be delivered.  My question was really more around whether or
> not the counts displayed reflected messages that were on disk as well
> as those that might be in RAM?

Whether a message was not on disk, on disk as well as RAM, or spent time
only on disk (removed from RAM and then reloaded later) is not directly
reflected in any of the management console statistics.

-Emile

From jvhiemer at googlemail.com  Mon Jan  9 11:25:55 2012
From: jvhiemer at googlemail.com (jhiemer)
Date: Mon, 9 Jan 2012 03:25:55 -0800 (PST)
Subject: [rabbitmq-discuss] Concurrently execution of jobs - Spring AMQP
	with RabbitMQ
Message-ID: <c52ffe9f-bf5b-4798-94d9-4900bc66779d@z19g2000vbe.googlegroups.com>

Hi,
I have a basic question regarding the design of an application. The
scenario is as follows. A frontend sends job message to two different
queues (respectively routingKeys). The following shows the
configuration of the queues.

amqp.schedule.routingKeyName=service.schedule
amqp.schedule.routingKey=service.schedule
amqp.schedule.queue=service.schedule
amqp.schedule.max=10

amqp.compose.routingKeyName=service.compose
amqp.compose.routingKey=service.compose
amqp.compose.queue=service.compose
amqp.compose.max=2

While scheduling does not take that much time, compose jobs may take
between 1 and 10 minutes. As you can see I can run 10 schedule jobs
concurrently, while I can only run 2 compose jobs concurrently. I am
using Spring AMQP with RabbitMQ.

To limit this, do I need to run for compose 2 consumers, and for
schedule 10?

P.S. In Spring AMQP there is ChannelAwareMessageListener, which fires
asynchronous the onMessage() method, whenever a message arrives,
opening a thread for each message. Would that be the other way to go?
What would I need to take care of in this case? What I was thinking of
was two Consumers (Compose, Schedule) with prefetchCount set to 2
(Compose) or 10 (Schedule) to limit the concurrent execution of tasks?

I would be glad if anyone could help me out. I am bit stuck at the
moment. :-(

Regards

From majek04 at gmail.com  Mon Jan  9 11:52:51 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 9 Jan 2012 11:52:51 +0000
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
In-Reply-To: <74b53963-82f2-4d1c-bc9c-2feb781239fe@l24g2000yqm.googlegroups.com>
References: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
	<CABzX+qxfUVWh9tGqMRvo2Ew3pyFTcFfrXYysnQc+wxhSzCNXkg@mail.gmail.com>
	<74b53963-82f2-4d1c-bc9c-2feb781239fe@l24g2000yqm.googlegroups.com>
Message-ID: <CABzX+qx-pzrkV5=ugn_d_sBtksFceCY-bK-nshV=K3nVWtZLOQ@mail.gmail.com>

On Fri, Jan 6, 2012 at 21:54, njsss <njsss2011 at gmail.com> wrote:
> [...]
> The problem I see is that at the end there's this ioloop, which I
> first thought only running at background, but instead continue
> blocking until ctrl+C.
> However, I have a panda3d game animation, and I want while it is
> rendering, still can listen outside calls and make certain changes.
> With the ioloop, the animation won't even be able to start. without
> it, the connection does not seem to fully connected, and will not
> listen to the rabbitmq.
> What is the easiest to do it?

Generally, if you want to wait for messages from RabbitMQ, you
will need to `wait`. If you must do computation at the same time -
it gets complicated.

The usual way of dealing with the problem is to use threads.

In one thread you could wait on a rabbitmq client, in other
thread you could do cpu-intensive computation.
But it's easy to mess up with the synchronization, so beware.

Alternatively, you may review the Puka client library:
   https://github.com/majek/puka
This library allows you to build your own `select` waiting
loop, which may help if you want to `wait` on multiple
socket descriptors (not only a rabbitmq client descriptor).
OTOH, it won't directly help with the problem of
latency-sensitive Rabbitmq connection and a CPU-intensive task.

Hope that helps,
  Marek

From jvhiemer at googlemail.com  Mon Jan  9 12:58:21 2012
From: jvhiemer at googlemail.com (jhiemer)
Date: Mon, 9 Jan 2012 04:58:21 -0800 (PST)
Subject: [rabbitmq-discuss] Concurrently execution of jobs - Spring AMQP
	with RabbitMQ
In-Reply-To: <c52ffe9f-bf5b-4798-94d9-4900bc66779d@z19g2000vbe.googlegroups.com>
References: <c52ffe9f-bf5b-4798-94d9-4900bc66779d@z19g2000vbe.googlegroups.com>
Message-ID: <7be1dffc-1550-4fdd-b1d2-a9468efeb003@u6g2000vbc.googlegroups.com>

Hi,
I finally solved my issue with the help of Spring. In Spring AMQP
there is an option for the definition of consumers being started when
creating a SimpleMessageListenerContainer. A successful configuration
looks like this:

public SimpleMessageListenerContainer compositionListenerContainer() {
		SimpleMessageListenerContainer container = new
SimpleMessageListenerContainer(connectionFactory());
		container.setQueues(compositionQueue());
		container.setMessageListener(compositionMessageListenerAdapter());
		container.setAcknowledgeMode(AcknowledgeMode.MANUAL);
		container.setPrefetchCount(prefetchCount);
		container.setErrorHandler(errorHandler());
		container.setConcurrentConsumers(concurrentConsumers);
		return container;
}

Have a nice day.

On Jan 9, 12:25?pm, jhiemer <jvhie... at googlemail.com> wrote:
> Hi,
> I have a basic question regarding the design of an application. The
> scenario is as follows. A frontend sends job message to two different
> queues (respectively routingKeys). The following shows the
> configuration of the queues.
>
> amqp.schedule.routingKeyName=service.schedule
> amqp.schedule.routingKey=service.schedule
> amqp.schedule.queue=service.schedule
> amqp.schedule.max=10
>
> amqp.compose.routingKeyName=service.compose
> amqp.compose.routingKey=service.compose
> amqp.compose.queue=service.compose
> amqp.compose.max=2
>
> While scheduling does not take that much time, compose jobs may take
> between 1 and 10 minutes. As you can see I can run 10 schedule jobs
> concurrently, while I can only run 2 compose jobs concurrently. I am
> using Spring AMQP with RabbitMQ.
>
> To limit this, do I need to run for compose 2 consumers, and for
> schedule 10?
>
> P.S. In Spring AMQP there is ChannelAwareMessageListener, which fires
> asynchronous the onMessage() method, whenever a message arrives,
> opening a thread for each message. Would that be the other way to go?
> What would I need to take care of in this case? What I was thinking of
> was two Consumers (Compose, Schedule) with prefetchCount set to 2
> (Compose) or 10 (Schedule) to limit the concurrent execution of tasks?
>
> I would be glad if anyone could help me out. I am bit stuck at the
> moment. :-(
>
> Regards
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alec at mocatta.net  Mon Jan  9 15:40:06 2012
From: alec at mocatta.net (Alec Mocatta)
Date: Mon, 9 Jan 2012 15:40:06 +0000
Subject: [rabbitmq-discuss] AMQP Spec
Message-ID: <CAAze+-n7E9zJA592Z8zoJdFib7k=nqWMaAKq_+BRNPOc05XU=w@mail.gmail.com>

Hi,

The AMQP Specifications seem to have been down since at least
October<http://old.nabble.com/AMQP-1.0-Specifications-p32672548.html>.
Could anyone zip and email the PDFs at
http://amqp.org/resources/specifications to me please?

Thanks,

Alec
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120109/5a959712/attachment.htm>

From david at rabbitmq.com  Mon Jan  9 15:51:00 2012
From: david at rabbitmq.com (David Wragg)
Date: Mon, 09 Jan 2012 15:51:00 +0000
Subject: [rabbitmq-discuss] AMQP Spec
In-Reply-To: <CAAze+-n7E9zJA592Z8zoJdFib7k=nqWMaAKq_+BRNPOc05XU=w@mail.gmail.com>
	(Alec Mocatta's message of "Mon, 9 Jan 2012 15:40:06 +0000")
References: <CAAze+-n7E9zJA592Z8zoJdFib7k=nqWMaAKq_+BRNPOc05XU=w@mail.gmail.com>
Message-ID: <yrv4cipkkc1sr.fsf@dwragg.eng.vmware.com>

Hi Alec,

Alec Mocatta <alec at mocatta.net> writes:
> The AMQP Specifications seem to have been down since at least
> October<http://old.nabble.com/AMQP-1.0-Specifications-p32672548.html>.
> Could anyone zip and email the PDFs at
> http://amqp.org/resources/specifications to me please?

The specifications are still available on amqp.org, though perhaps the
URIs for the specification documents changed.  See
<http://www.amqp.org/resources/download> for the current links to the
documents.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From david at rabbitmq.com  Mon Jan  9 15:57:11 2012
From: david at rabbitmq.com (David Wragg)
Date: Mon, 09 Jan 2012 15:57:11 +0000
Subject: [rabbitmq-discuss] AMQP Spec
In-Reply-To: <yrv4cipkkc1sr.fsf@dwragg.eng.vmware.com> (David Wragg's message
	of "Mon, 09 Jan 2012 15:51:00 +0000")
References: <CAAze+-n7E9zJA592Z8zoJdFib7k=nqWMaAKq_+BRNPOc05XU=w@mail.gmail.com>
	<yrv4cipkkc1sr.fsf@dwragg.eng.vmware.com>
Message-ID: <yrv4cehv8c1ig.fsf@dwragg.eng.vmware.com>

David Wragg <david at rabbitmq.com> writes:
> Alec Mocatta <alec at mocatta.net> writes:
>> The AMQP Specifications seem to have been down since at least
>> October<http://old.nabble.com/AMQP-1.0-Specifications-p32672548.html>.
>> Could anyone zip and email the PDFs at
>> http://amqp.org/resources/specifications to me please?
>
> The specifications are still available on amqp.org, though perhaps the
> URIs for the specification documents changed.  See
> <http://www.amqp.org/resources/download> for the current links to the
> documents.

Ignore me.  They are unavailable at the moment.  Though not since
October - I regularly download copies.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From jruiz at johnruiz.com  Mon Jan  9 16:25:46 2012
From: jruiz at johnruiz.com (John Ruiz)
Date: Mon, 9 Jan 2012 08:25:46 -0800 (PST)
Subject: [rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the
	.NET client
In-Reply-To: <4F057DA3.70707@rabbitmq.com>
References: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>
	<4c33908a-5e73-4b7f-b7cb-e691aed256f6@y7g2000vbe.googlegroups.com>
	<c9696d25-4acc-4d3e-b5e4-a28362dd1dae@d10g2000vbk.googlegroups.com>
	<b5f96060-d33b-4339-9ace-5971453ee57a@z17g2000vbe.googlegroups.com>
	<c7288b20-ff6e-4929-b0fd-f7901432df09@d10g2000vbk.googlegroups.com>
	<4F057DA3.70707@rabbitmq.com>
Message-ID: <33046c31-d9bd-4f58-a9bb-5f5848e590f6@o14g2000vbo.googlegroups.com>

I wonder what version of Windows Server you're running?

I installed Windows Server 2008 R2 Enterprise with Service Pack 1

Then I installed the Active Directory Directory Services role and
stood up my domain in a new forest.

This is the setup that yields CN=Users,DC=example,DC=com


On Jan 5, 5:38?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> Somewhat weirdly that's not how our local AD server seems to be doing
> things. But this is clearly a problem. I think
> rabbitmq_auth_mechanism_ssl needs to switch to using DNs...
>
> Cheers, Simon
>
> On 30/12/11 19:52, John Ruiz wrote:
>
>
>
>
>
> > See this stackoverflow thread for more information:
>
> >http://stackoverflow.com/questions/8683006/this-erlang-code-throws-an...
>
> > Since this is the way that Windows Domains operate out of the box, I
> > suggest that instead of writing the code such that it throws an
> > exception, it instead concatenates any CN strings it finds.
>
> > At least this way I could have created a "Users John Ruiz" or "John
> > Ruiz Users" user in RabbitMQ and it would work. ?With the
> > implementation as it stands today, I would need to create my own OU in
> > AD and then redirect the users container following this article:
> >http://support.microsoft.com/kb/324949.
>
> > The problem is the note at the bottom of that article:
>
> > "Some applications require specific security principals to be located
> > in default containers like CN=Users or CN=Computers. Verify that your
> > applications have such dependencies before you move them out of the
> > CN=users and CN=computes containers."
>
> > I have already discovered that I cannot move my service accounts
> > outside of the CN=users container or else many of my Constrained
> > Delegation scenarios no longer work. (More on constrained delegation
> > of kerberos credentials here:http://technet.microsoft.com/en-us/library/cc739587%28WS.10%29.aspx).
>
> > On Dec 30, 11:48 am, John Ruiz<jr... at johnruiz.com> ?wrote:
> >> I have a certificate with the following Subject:
> >> "CN=John Ruiz, CN=Users, DC=devexample, DC=com"
>
> >> When you look at rabbit_ssl.erl's find_by_type function, (this is my
> >> first time seeing erlang code, btw) I notice that there's a "<-
> >> lists:flatten(RDNs)" line. ?I don't know what the result of
> >> lists:flatten will be. ?This is probably why the connection suddenly
> >> ends... the user I've created for rabbit isn't matching what the cert
> >> says.
>
> >> Can anyone help me?
>
> >> On Dec 30, 11:19 am, John Ruiz<jr... at johnruiz.com> ?wrote:
>
> >>> Now that I have all of this working, I need to switch over from an
> >>> openssl-based CA to our production CA, which is Active Directory
> >>> Certificate Services. ?All certificates are issued by the subordinate
> >>> enterprise CA --> ?ISSUE01.devexample.com.
>
> >>> I have a certificate for myself in my personal store on
> >>> DC01.devexample.com (Windows Server).
>
> >>> The RabbitMQ Service runs as Local System on APP01.devexample.com
> >>> (Windows Server) so there's a certificate for APP01.devexample.com in
> >>> the Local Computer's Personal store.
>
> >>> The Root CA certificate is already in Trusted Root Certs on all
> >>> machines in the domain devexample.com. ?The ISSUE01 CA cert is in the
> >>> Intermediate Certification Authority store everywhere as well.
>
> >>> I have exported the Root CA cert to a DER file and then moved it to a
> >>> linux machine where I used openssl to convert it to PEM. ?I then moved
> >>> it back to APP01. ?Next, I exported APP01's cert (with private key) to
> >>> a PFX file, moved it to a linux machine and extracted the signed
> >>> public key cert and the private key cert.
>
> >>> # extract the private key (still password protected)
> >>> openssl.exe pkcs12 -in publicAndprivate.pfx -nocerts -out
> >>> privateKey.pem
>
> >>> # extract the public cert
> >>> openssl.exe pkcs12 -in publicAndprivate.pfx -clcerts -nokeys -out
> >>> app01.pem
>
> >>> # remove the password protection
> >>> openssl.exe rsa -in privateKey.pem -out app01-private.pem
>
> >>> I moved all of these PEMs back to APP01 -- the CA's public cert,
> >>> APP01's public cert, and APP01's private key. ?Here is my
> >>> rabbitmq.config
>
> >>> [
> >>> ? ?{rabbit, [
> >>> ? ? ? {auth_mechanisms,['EXTERNAL']},
> >>> ? ? ? {ssl_listeners, [5671]},
> >>> ? ? ? {ssl_options, [{cacertfile,"C:/Keys/pki-root-ca.pem"},
> >>> ? ? ? ? ? ? ? ? ? ? ?{certfile,"C:/Keys/app01.pem"},
> >>> ? ? ? ? ? ? ? ? ? ? ?{keyfile,"C:/Keys/app01-private.pem"},
> >>> ? ? ? ? ? ? ? ? ? ? ?{verify,verify_peer},
> >>> ? ? ? ? ? ? ? ? ? ? ?{fail_if_no_peer_cert,true}]}
> >>> ? ? ]}
> >>> ].
>
> >>> When I run the code that I've already listed in my blog post, I get
> >>> this exception:http://pastebin.com/9USFHWzf
>
> >>> In the rabbit log, I see this:http://pastebin.com/GsWsxLGV
>
> >>> As far as I can tell, I've done everything correctly. ?I've ensured
> >>> that my code references APP01.devexample.com, exactly as it appears on
> >>> the certificate (Subject: CN = APP01.devexample.com).
>
> >>> What should I do/try?
>
> >>> Please help!
>
> >>> On Dec 27, 4:22 pm, John Ruiz<jr... at johnruiz.com> ?wrote:
>
> >>>> I have figured it out. ?There were two issues.
>
> >>>> 1. Add the external mechanism factory to your connection factory's
> >>>> auth mechanisms
> >>>> ? ? ?i.e. -- cf.AuthMechanisms = new AuthMechanismFactory[] { new
> >>>> ExternalMechanismFactory() };
>
> >>>> 2. Configure the server's auth_mechanisms variable in your
> >>>> rabbitmq.config.
> >>>> ? ? ?Here is my complete rabbitmq.config:
>
> >>>> [
> >>>> ? ?{rabbit, [
> >>>> ? ? ? {auth_mechanisms,['EXTERNAL']},
> >>>> ? ? ? {ssl_listeners, [5671]},
> >>>> ? ? ? {ssl_options, [{cacertfile,"C:/Path/To/Your/cacert.pem"},
> >>>> ? ? ? ? ? ? ? ? ? ? ?{certfile,"C:/Path/To/Your/cert.pem"},
> >>>> ? ? ? ? ? ? ? ? ? ? ?{keyfile,"C:/Path/To/Your/key.pem"},
> >>>> ? ? ? ? ? ? ? ? ? ? ?{verify,verify_peer},
> >>>> ? ? ? ? ? ? ? ? ? ? ?{fail_if_no_peer_cert,true}]}
> >>>> ? ? ]}
> >>>> ].
>
> >>>> On Dec 27, 1:16 pm, John Ruiz<jr... at johnruiz.com> ?wrote:
>
> >>>>> Hi All,
>
> >>>>> I've successfully followed the SSL tutorial and gotten my .NET client
> >>>>> to connect, send, and receive messages over SSL. ?See my blog for the
> >>>>> code:http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbi....
>
> >>>>> As the next step, I enabled the plugin "rabbitmq_auth_mechanism_ssl"
> >>>>> and then re-installed the Windows Service. ?Then I re-ran the code I
> >>>>> have listed in my blog -- with the addition of a Console.ReadLine() at
> >>>>> the end of my using statements so I can see the connection details in
> >>>>> the management web app.
>
> >>>>> I am still connecting as guest. ?What do I need to do in order to
> >>>>> connect as the CN of the Subject on my certificate?
>
> >>>>> Thanks!
> >>>>> ~ jR
> >>>>> _______________________________________________
> >>>>> rabbitmq-discuss mailing list
> >>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >>>> _______________________________________________
> >>>> rabbitmq-discuss mailing list
> >>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss- Hide quoted text -
>
> - Show quoted text -

From simon at rabbitmq.com  Mon Jan  9 16:32:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 09 Jan 2012 16:32:38 +0000
Subject: [rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the
 .NET client
In-Reply-To: <33046c31-d9bd-4f58-a9bb-5f5848e590f6@o14g2000vbo.googlegroups.com>
References: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>	<4c33908a-5e73-4b7f-b7cb-e691aed256f6@y7g2000vbe.googlegroups.com>	<c9696d25-4acc-4d3e-b5e4-a28362dd1dae@d10g2000vbk.googlegroups.com>	<b5f96060-d33b-4339-9ace-5971453ee57a@z17g2000vbe.googlegroups.com>	<c7288b20-ff6e-4929-b0fd-f7901432df09@d10g2000vbk.googlegroups.com>	<4F057DA3.70707@rabbitmq.com>
	<33046c31-d9bd-4f58-a9bb-5f5848e590f6@o14g2000vbo.googlegroups.com>
Message-ID: <4F0B16A6.3040205@rabbitmq.com>

Windows Server 2003 apparently, but I'm very much not a Windows sysadmin...

If you're up for building plugins from source, the branch "bug24265" of 
rabbitmq_auth_mechanism_ssl contains my attempt at supporting DNs / 
concatenating multiple CNs.

Cheers, Simon

On 09/01/12 16:25, John Ruiz wrote:
> I wonder what version of Windows Server you're running?
>
> I installed Windows Server 2008 R2 Enterprise with Service Pack 1
>
> Then I installed the Active Directory Directory Services role and
> stood up my domain in a new forest.
>
> This is the setup that yields CN=Users,DC=example,DC=com
>
>
> On Jan 5, 5:38 am, Simon MacMullen<si... at rabbitmq.com>  wrote:
>> Somewhat weirdly that's not how our local AD server seems to be doing
>> things. But this is clearly a problem. I think
>> rabbitmq_auth_mechanism_ssl needs to switch to using DNs...
>>
>> Cheers, Simon
>>
>> On 30/12/11 19:52, John Ruiz wrote:
>>
>>
>>
>>
>>
>>> See this stackoverflow thread for more information:
>>
>>> http://stackoverflow.com/questions/8683006/this-erlang-code-throws-an...
>>
>>> Since this is the way that Windows Domains operate out of the box, I
>>> suggest that instead of writing the code such that it throws an
>>> exception, it instead concatenates any CN strings it finds.
>>
>>> At least this way I could have created a "Users John Ruiz" or "John
>>> Ruiz Users" user in RabbitMQ and it would work.  With the
>>> implementation as it stands today, I would need to create my own OU in
>>> AD and then redirect the users container following this article:
>>> http://support.microsoft.com/kb/324949.
>>
>>> The problem is the note at the bottom of that article:
>>
>>> "Some applications require specific security principals to be located
>>> in default containers like CN=Users or CN=Computers. Verify that your
>>> applications have such dependencies before you move them out of the
>>> CN=users and CN=computes containers."
>>
>>> I have already discovered that I cannot move my service accounts
>>> outside of the CN=users container or else many of my Constrained
>>> Delegation scenarios no longer work. (More on constrained delegation
>>> of kerberos credentials here:http://technet.microsoft.com/en-us/library/cc739587%28WS.10%29.aspx).
>>
>>> On Dec 30, 11:48 am, John Ruiz<jr... at johnruiz.com>    wrote:
>>>> I have a certificate with the following Subject:
>>>> "CN=John Ruiz, CN=Users, DC=devexample, DC=com"
>>
>>>> When you look at rabbit_ssl.erl's find_by_type function, (this is my
>>>> first time seeing erlang code, btw) I notice that there's a "<-
>>>> lists:flatten(RDNs)" line.  I don't know what the result of
>>>> lists:flatten will be.  This is probably why the connection suddenly
>>>> ends... the user I've created for rabbit isn't matching what the cert
>>>> says.
>>
>>>> Can anyone help me?
>>
>>>> On Dec 30, 11:19 am, John Ruiz<jr... at johnruiz.com>    wrote:
>>
>>>>> Now that I have all of this working, I need to switch over from an
>>>>> openssl-based CA to our production CA, which is Active Directory
>>>>> Certificate Services.  All certificates are issued by the subordinate
>>>>> enterprise CA -->    ISSUE01.devexample.com.
>>
>>>>> I have a certificate for myself in my personal store on
>>>>> DC01.devexample.com (Windows Server).
>>
>>>>> The RabbitMQ Service runs as Local System on APP01.devexample.com
>>>>> (Windows Server) so there's a certificate for APP01.devexample.com in
>>>>> the Local Computer's Personal store.
>>
>>>>> The Root CA certificate is already in Trusted Root Certs on all
>>>>> machines in the domain devexample.com.  The ISSUE01 CA cert is in the
>>>>> Intermediate Certification Authority store everywhere as well.
>>
>>>>> I have exported the Root CA cert to a DER file and then moved it to a
>>>>> linux machine where I used openssl to convert it to PEM.  I then moved
>>>>> it back to APP01.  Next, I exported APP01's cert (with private key) to
>>>>> a PFX file, moved it to a linux machine and extracted the signed
>>>>> public key cert and the private key cert.
>>
>>>>> # extract the private key (still password protected)
>>>>> openssl.exe pkcs12 -in publicAndprivate.pfx -nocerts -out
>>>>> privateKey.pem
>>
>>>>> # extract the public cert
>>>>> openssl.exe pkcs12 -in publicAndprivate.pfx -clcerts -nokeys -out
>>>>> app01.pem
>>
>>>>> # remove the password protection
>>>>> openssl.exe rsa -in privateKey.pem -out app01-private.pem
>>
>>>>> I moved all of these PEMs back to APP01 -- the CA's public cert,
>>>>> APP01's public cert, and APP01's private key.  Here is my
>>>>> rabbitmq.config
>>
>>>>> [
>>>>>     {rabbit, [
>>>>>        {auth_mechanisms,['EXTERNAL']},
>>>>>        {ssl_listeners, [5671]},
>>>>>        {ssl_options, [{cacertfile,"C:/Keys/pki-root-ca.pem"},
>>>>>                       {certfile,"C:/Keys/app01.pem"},
>>>>>                       {keyfile,"C:/Keys/app01-private.pem"},
>>>>>                       {verify,verify_peer},
>>>>>                       {fail_if_no_peer_cert,true}]}
>>>>>      ]}
>>>>> ].
>>
>>>>> When I run the code that I've already listed in my blog post, I get
>>>>> this exception:http://pastebin.com/9USFHWzf
>>
>>>>> In the rabbit log, I see this:http://pastebin.com/GsWsxLGV
>>
>>>>> As far as I can tell, I've done everything correctly.  I've ensured
>>>>> that my code references APP01.devexample.com, exactly as it appears on
>>>>> the certificate (Subject: CN = APP01.devexample.com).
>>
>>>>> What should I do/try?
>>
>>>>> Please help!
>>
>>>>> On Dec 27, 4:22 pm, John Ruiz<jr... at johnruiz.com>    wrote:
>>
>>>>>> I have figured it out.  There were two issues.
>>
>>>>>> 1. Add the external mechanism factory to your connection factory's
>>>>>> auth mechanisms
>>>>>>       i.e. -- cf.AuthMechanisms = new AuthMechanismFactory[] { new
>>>>>> ExternalMechanismFactory() };
>>
>>>>>> 2. Configure the server's auth_mechanisms variable in your
>>>>>> rabbitmq.config.
>>>>>>       Here is my complete rabbitmq.config:
>>
>>>>>> [
>>>>>>     {rabbit, [
>>>>>>        {auth_mechanisms,['EXTERNAL']},
>>>>>>        {ssl_listeners, [5671]},
>>>>>>        {ssl_options, [{cacertfile,"C:/Path/To/Your/cacert.pem"},
>>>>>>                       {certfile,"C:/Path/To/Your/cert.pem"},
>>>>>>                       {keyfile,"C:/Path/To/Your/key.pem"},
>>>>>>                       {verify,verify_peer},
>>>>>>                       {fail_if_no_peer_cert,true}]}
>>>>>>      ]}
>>>>>> ].
>>
>>>>>> On Dec 27, 1:16 pm, John Ruiz<jr... at johnruiz.com>    wrote:
>>
>>>>>>> Hi All,
>>
>>>>>>> I've successfully followed the SSL tutorial and gotten my .NET client
>>>>>>> to connect, send, and receive messages over SSL.  See my blog for the
>>>>>>> code:http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbi....
>>
>>>>>>> As the next step, I enabled the plugin "rabbitmq_auth_mechanism_ssl"
>>>>>>> and then re-installed the Windows Service.  Then I re-ran the code I
>>>>>>> have listed in my blog -- with the addition of a Console.ReadLine() at
>>>>>>> the end of my using statements so I can see the connection details in
>>>>>>> the management web app.
>>
>>>>>>> I am still connecting as guest.  What do I need to do in order to
>>>>>>> connect as the CN of the Subject on my certificate?
>>
>>>>>>> Thanks!
>>>>>>> ~ jR
>>>>>>> _______________________________________________
>>>>>>> rabbitmq-discuss mailing list
>>>>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss- Hide quoted text -
>>
>> - Show quoted text -
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Mon Jan  9 16:38:56 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 9 Jan 2012 11:38:56 -0500
Subject: [rabbitmq-discuss] AMQP Spec
In-Reply-To: <yrv4cehv8c1ig.fsf@dwragg.eng.vmware.com>
References: <CAAze+-n7E9zJA592Z8zoJdFib7k=nqWMaAKq_+BRNPOc05XU=w@mail.gmail.com>
	<yrv4cipkkc1sr.fsf@dwragg.eng.vmware.com>
	<yrv4cehv8c1ig.fsf@dwragg.eng.vmware.com>
Message-ID: <CAM8fPiSKZ+7y78F3q-RH3Yred_DWv=SidTZ1JCjEvODUOstCXA@mail.gmail.com>

Could the Rabbit website host a mirrored copy of the document? Perhaps
linked from http://www.rabbitmq.com/specification.html.

By the way, the website is looking *great* these days. I mean particularly
in terms of content. (I was particularly pleased to see the Broker
Semantics page there! I like it.)

Regards,
  Tony

On 9 January 2012 10:57, David Wragg <david at rabbitmq.com> wrote:

> David Wragg <david at rabbitmq.com> writes:
> > Alec Mocatta <alec at mocatta.net> writes:
> >> The AMQP Specifications seem to have been down since at least
> >> October<http://old.nabble.com/AMQP-1.0-Specifications-p32672548.html>.
> >> Could anyone zip and email the PDFs at
> >> http://amqp.org/resources/specifications to me please?
> >
> > The specifications are still available on amqp.org, though perhaps the
> > URIs for the specification documents changed.  See
> > <http://www.amqp.org/resources/download> for the current links to the
> > documents.
>
> Ignore me.  They are unavailable at the moment.  Though not since
> October - I regularly download copies.
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120109/e3b2bc8b/attachment.htm>

From andrea.rosa at hp.com  Mon Jan  9 17:07:16 2012
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 9 Jan 2012 17:07:16 +0000
Subject: [rabbitmq-discuss] handshake_timeout
Message-ID: <5F389C517756284F80239F55BCA5DDDD3690C353@G4W3209.americas.hpqcorp.net>

Hi

Sometimes I find in the log file these errors:
Type A
=ERROR REPORT==== 9-Jan-2012::06:01:49 ===
exception on TCP connection <0.211.5973> from x.x.x.x:54400
{handshake_timeout,handshake}

Type B
=ERROR REPORT==== 9-Jan-2012::03:37:43 ===
exception on TCP connection <0.9443.464> from x.x.x.x:57573
{handshake_timeout,frame_header}

Can you confirm me that:
- those problem mean that the client cannot terminate the handshake protocol? So is It not a problem with the server? 
- The hankdshake timeout is something defined at OS level
- it's not clear to me the difference between type A and B

Best Regards
--
Andrea Rosa


From simon at rabbitmq.com  Mon Jan  9 17:15:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 09 Jan 2012 17:15:18 +0000
Subject: [rabbitmq-discuss] handshake_timeout
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3690C353@G4W3209.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3690C353@G4W3209.americas.hpqcorp.net>
Message-ID: <4F0B20A6.5010604@rabbitmq.com>

On 09/01/12 17:07, Rosa, Andrea wrote:
> Hi
>
> Sometimes I find in the log file these errors:
> Type A
> =ERROR REPORT==== 9-Jan-2012::06:01:49 ===
> exception on TCP connection<0.211.5973>  from x.x.x.x:54400
> {handshake_timeout,handshake}
>
> Type B
> =ERROR REPORT==== 9-Jan-2012::03:37:43 ===
> exception on TCP connection<0.9443.464>  from x.x.x.x:57573
> {handshake_timeout,frame_header}
>
> Can you confirm me that:
> - those problem mean that the client cannot terminate the handshake protocol? So is It not a problem with the server?

It means the client and server did not complete the AMQP handshake 
before a timeout occurred (10s).

> - The hankdshake timeout is something defined at OS level

No, it's a rabbit thing - hard coded in rabbit_reader at the moment.

> - it's not clear to me the difference between type A and B

The difference is in how far it got before the timeout. In type A it got 
almost nowhere - not even the first few bytes ("AMQP\0\0\9\1") got 
through. In type B some connection start frames may have been exchanged.

You might see type A if people are doing "telnet servername 5672" or 
otherwise connecting and then sending nothing at all. You should only 
see type B if you have a very slow or buggy client I think.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From andrea.rosa at hp.com  Mon Jan  9 17:31:37 2012
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 9 Jan 2012 17:31:37 +0000
Subject: [rabbitmq-discuss] handshake_timeout
In-Reply-To: <4F0B20A6.5010604@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD3690C353@G4W3209.americas.hpqcorp.net>
	<4F0B20A6.5010604@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3690C385@G4W3209.americas.hpqcorp.net>

Hi Simon


>You might see type A if people are doing "telnet servername 5672" or
>otherwise connecting and then sending nothing at all. You should only
>see type B if you have a very slow or buggy client I think.

Thanks for your help, it's not clear to me your example, are you saying that if
there is a connection and then nothing is sent on this connection I can see this timeout error?
But if the connection has been established why I should have a handshake error?

Thanks
--
Andrea


From simon at rabbitmq.com  Mon Jan  9 17:34:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 09 Jan 2012 17:34:14 +0000
Subject: [rabbitmq-discuss] handshake_timeout
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3690C385@G4W3209.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3690C353@G4W3209.americas.hpqcorp.net>
	<4F0B20A6.5010604@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3690C385@G4W3209.americas.hpqcorp.net>
Message-ID: <4F0B2516.1040408@rabbitmq.com>

On 09/01/12 17:31, Rosa, Andrea wrote:
> Thanks for your help, it's not clear to me your example, are you saying that if
> there is a connection and then nothing is sent on this connection I can see this timeout error?

Yes. If there is a *TCP connection* and nothing is sent.

> But if the connection has been established why I should have a handshake error?

If you mean "AMQP connection" then you should never see a handshake 
timeout. If you mean "TCP connection" then failing to establish an AMQP 
connection will cause this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From developer at dnsplus.net  Mon Jan  9 18:08:30 2012
From: developer at dnsplus.net (dnsplus)
Date: Mon, 9 Jan 2012 10:08:30 -0800 (PST)
Subject: [rabbitmq-discuss]  Auth failure: Bad CONNECT
Message-ID: <33107784.post@talk.nabble.com>


Hello, World !

First, I am very new to RabbitMQ, and linux is not my preferred platform.
However, I am working on building a small virtual applicance which will run
RabbitMQ. I have the appliance built with SLES 11 SP1, with ERLANG and
RabbitMQ integrated (manually added) from Suse Studio. 

My applicance boots up, and rabbitmq-server starts happily.  I can
successfuly run all the rabbitmqctl commands. I have the stomp_plugin
loading at startup, and I can connect via telnet to confirm that the port is
open, and in fact listening. 

However I cannot 'connect' to the server using a STOMP client. My client
session shows:

wgmq201:/home/mq-admin/scripts # perl connect.pl
*** unexpected ERROR frame received: Bad CONNECT

My RabbitMQ Logs show this:

=INFO REPORT==== 9-Jan-2012::11:15:39 ===
accepted TCP connection on [::]:61613 from 127.0.0.1:48251

=INFO REPORT==== 9-Jan-2012::11:15:39 ===
starting STOMP connection <0.256.0> from ::FFFF:127.0.0.1:48251

=ERROR REPORT==== 9-Jan-2012::11:15:39 ===
STOMP error frame sent:
Message: "Bad CONNECT"
Detail: "Authentication failure\n"
Server private detail: none

I have used the rabbitmqctl reset_password guest guest command 


This is the connect.pl script i have thus far:

#!/perl/bin -w
#

use Net::STOMP::Client;

$stomp = Net::STOMP::Client->new(host=>'localhost', port=>61613);

$stomp->connect(login=>"guest", passcode=>"guest");


Please advise, and thanks !
-- 
View this message in context: http://old.nabble.com/Auth-failure%3A-Bad-CONNECT-tp33107784p33107784.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From aaron at agoragames.com  Mon Jan  9 18:16:15 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 9 Jan 2012 13:16:15 -0500
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
In-Reply-To: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
References: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
Message-ID: <CAHiEoM5vBiCWucx_6SFXYpi6wToBX0pL_Z4P9Cxoc6Bby=NUNg@mail.gmail.com>

You can also use haigha which supports pyevent and gevent for its loop.
https://github.com/agoragames/haigha

Regarding your animation loop, you can simply queue the "draw()" onto
the event loop so it's all in synch, use native threading, or both
pyevent and gevent support a concept of "loop for N milliseconds, then
return", so you can call that whenever your animation loop yields.

-Aaron


On Fri, Jan 6, 2012 at 1:02 PM, njsss <shilei1980 at gmail.com> wrote:
> Hello all,
>
> I'm new to rabbitmq and python as well. I installed pika and followed
> the tutorials. But what I need is an event-driving messenger. Is there
> anyway to do it?
>
> Thanks,
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From hpk.warrier at gmail.com  Mon Jan  9 18:18:26 2012
From: hpk.warrier at gmail.com (pradeep w)
Date: Mon, 9 Jan 2012 23:48:26 +0530
Subject: [rabbitmq-discuss] lots of channel getting created
In-Reply-To: <4F0AB464.4060005@rabbitmq.com>
References: <CAFwZ77p5fqAAHT6LfoYuy=WWNtcNiceAyR4vLDYfWZ7ae0Vs-g@mail.gmail.com>
	<4F0AB464.4060005@rabbitmq.com>
Message-ID: <CAFwZ77pBpwMYWCgfxE8LYDQ8h5UdT1PUTT7-f+FnB3_EeO1hRQ@mail.gmail.com>

Thanks . At the code level I'm very certain about closing. I have common
point for Rabbit MQ related operation : one for publishing and one for
consuming . And at both these I confirmed channel and connection getting
closed after the processing [including any exception cases].
I'll try the tracer and try to get more information.

On Mon, Jan 9, 2012 at 3:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Pradeep,
>
> On 07/01/12 07:27, pradeep w wrote:
>
> >                 channel.close();
> >                 connection.close();
> >
> > However after a while [in the management console] I see a lot of
> > channels [as of now more than 1000]. And most of these are not being
> > used at all.
>
> The code you posted should not leak channels, so something else must be
> going wrong. Are you certain that the "channel.close();" line is being
> executed? Is it possible that a different client is connecting and
> failing to properly close channels?
>
> If you are still stuck after checking this then you may want to consider
> connecting to the broker via a protocol tracer which will confirm
> whether your client is closing the channel or not:
>
> http://www.rabbitmq.com/api-guide.html#tracer
>
> http://www.rabbitmq.com/releases/rabbitmq-java-client/current-javadoc/com/rabbitmq/tools/Tracer.html
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120109/56a2ba83/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jan  9 19:59:54 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 9 Jan 2012 23:59:54 +0400
Subject: [rabbitmq-discuss] AMQP Spec
In-Reply-To: <CAAze+-n7E9zJA592Z8zoJdFib7k=nqWMaAKq_+BRNPOc05XU=w@mail.gmail.com>
References: <CAAze+-n7E9zJA592Z8zoJdFib7k=nqWMaAKq_+BRNPOc05XU=w@mail.gmail.com>
Message-ID: <42DFC0CB-FD7D-4597-997D-A679042B79B0@gmail.com>

Alec Mocatta:

> The AMQP Specifications seem to have been down since at least October. Could anyone zip and email the PDFs at http://amqp.org/resources/specifications to me please?

If someone is looking for AMQP 0.9.1 documents, I backed them up some time ago:

http://bit.ly/amqp091spec
http://bit.ly/amqp091reference


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From adamrabung at gmail.com  Mon Jan  9 22:03:23 2012
From: adamrabung at gmail.com (Adam Rabung)
Date: Mon, 9 Jan 2012 17:03:23 -0500
Subject: [rabbitmq-discuss] ConnectionFactory and load balancing
Message-ID: <CAAN_EDoxP+qidfB47wwra=3kntXA7Yxbs1ejABs7oLLxe2gomQ@mail.gmail.com>

Hi,
I am running an active/active cluster.  The newConnection(Address[])
method of ConnectionFactory takes an array of addresses to try to
connect to, in order.  If I'd like to avoid HAProxy for now, it seems
like it would be wise for me to randomize this array of Addresses
before calling newConnection, to achieve some degree of load
balancing.  Is that a worthwhile approach?
Thank you,
Adam

From vveludan at gmail.com  Mon Jan  9 23:39:48 2012
From: vveludan at gmail.com (Venkat)
Date: Mon, 9 Jan 2012 15:39:48 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
Message-ID: <bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>

Hi Steve I have run some tests using RabbitMQ 2.7.1 please find the
following:

OS: CentOS release 5.5
RabbitMQ Version: 2.7.1
RabbitMQ Java Client: 2.7.1
spring-amqp Version: 1.0.0RELEASE
erlang version : 5.8.4 (http://repos.fedorapeople.org/repos/peter/
erlang/epel-erlang.repo: using Erlang version:R14B)
----------------------------------
Cluster Information:
Started Cluster with one RabbitMQ Node (Node A)
After test.queue is created on Node A, joined Node B to the cluster.
---------------------------------------------
Parent Queue Configuration:

@Configuration
public abstract class AbstractMDBRabbitConfiguration {

	protected abstract void configureMDBTemplate(RabbitTemplate
template);




	@Bean
	public ConnectionFactory connectionFactory() {
		String rabbitMQUser = "guest";
		String rabbitMQPassword = "guest";
		String rabbitMQHost = "localhost";
		CachingConnectionFactory connectionFactory = new
CachingConnectionFactory(rabbitMQHost);
		connectionFactory.setChannelCacheSize(10);
		connectionFactory.setUsername(rabbitMQUser);
		connectionFactory.setPassword(rabbitMQPassword);
		return connectionFactory;
	}

	@Bean
	public RabbitTemplate rabbitTemplate() {
		RabbitTemplate template = new DMBTemplate(connectionFactory());
		template.setMessageConverter(messageConverter());
		configureMDBTemplate(template);
		return template;
	}


	@Bean
	public MessageConverter messageConverter() {
		return new SimpleMessageConverter();
	}

	@Bean
	public AmqpAdmin amqpAdmin() {
		RabbitAdmin rabbitAdmin = new RabbitAdmin(connectionFactory());
		return rabbitAdmin ;
	}
-------------------------------------------------------------------------------------
Test Queue Configuaration:

@Configuration
public class LoggingConfiguration extends
AbstractMDBRabbitConfiguration {

	private static final String AUDIT_EXCHANGE_NAME = "test.exchange";
	private static final String AUDIT_QUEUE_NAME = "test.queue";
	private static final String AUDIT_ROUTING_KEY = AUDIT_QUEUE_NAME;

	@Override
	public void configureMDBTemplate(RabbitTemplate mdbTemplate) {
		mdbTemplate.setExchange(AUDIT_EXCHANGE_NAME);
		mdbTemplate.setRoutingKey(AUDIT_ROUTING_KEY);
	}

	@Bean
	public Queue mdbQueue() {
		Map<String, Object> args = new HashMap<String, Object>();
		String haPolicyValue = "all";
		args.put("x-ha-policy", haPolicyValue);
		Queue queue = new Queue(AUDIT_QUEUE_NAME,true,false,false,args);
		return queue;
	}

	@Bean
	public TopicExchange mdbAuditExchange() {
		TopicExchange exchange = new
TopicExchange(AUDIT_EXCHANGE_NAME,true,false);
		return exchange;
	}

	@Bean
	public Binding mdbAuditBinding() {
		return
BindingBuilder.bind(mdbQueue()).to(mdbAuditExchange()).with(AUDIT_ROUTING_KEY);
	}
}
------------------------------------------------------
Queue Consumer configuration:

	<context:component-scan base-package="com.test.services.logging">
	</context:component-scan>

	<bean id="messageListenerContainer"
class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
		<property name="connectionFactory" ref="connectionFactory" />
		<property name="queueNames" value="test.queue"/>
	    <property name="concurrentConsumers" value="5" />
	    <property name="messageListener" ref="messageListenerAdapter" />
	</bean>

	<bean id="messageListenerAdapter"
class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
		<property name="delegate" ref="logHandler" />
		<property name="messageConverter" ref="messageConverter" />
	</bean>

	<bean id="loggingEventHandler"
class="com.test.services.logging.LoggingEventHandler">
	</bean>

	<bean id="logHandler"
class="com.test.services.logging.LoggingProcessor">
		<property name="loggingEventHandler" ref="loggingEventHandler"/>
	</bean>


-------------------------------------------------------
Test Scenario:

First Test: Stopped the Queue Consumer during the test to watch for
the message count using rabbitmqctl list_queues

Executed a program that spawns 10 threads, each thread placing 2000
messages on test.queue.
While messages are pumped into test.queue crashed (hard-failure using
kill -9) RabbitMQ broker on Node A.
Ran the above test for two iterations.
Following are the findings:
- In the first iteration lost only 3 messages. When the program that
was pumping in messages is stopped found that 19997 messages were
piled up in the queue.
  Verified this by running rabbitmqctl list_queues
- In the second iteration lost only 2 messages. When the program that
was pumping in messages is stopped found that 19998 messages were
piled up in the queue.
  Verified this by running rabbitmqctl list_queues

Second Test: Queue consumer was running during the test
Executed the same program used in the first test to pump in messages.
While messages are pumped in, hard crashed RabbitMQ broker on Node A.
Same findings as in the first test. Lost 2 messages during the first
iteration and 3 messages in the second iteration.

These results are better compared to 2.7.0.

I have one question, referring to http://www.rabbitmq.com/ha.html:
As a result of the requeuing, clients that re-consume from the queue
must be aware that they are likely to subsequently receive messages
that they have seen previously

During the second test when I had Queue Consumer was up and running, I
didn't find any duplicate messages processed (though 2-3 messages
lost)
All messages processed are written to log. I have verified that there
were no duplicate messages by running grep command to fetch the Thread
Id on the log file.
Please find the following info:
[ecloud at t-3 log]$ grep Thread-0 central-log.log | wc -l
1999
[ecloud at t-3 log]$ grep Thread-1 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-2 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-3 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-4 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-5 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-6 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-7 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-8 central-log.log | wc -l
1999
[ecloud at t-3 log]$ grep Thread-9 central-log.log | wc -l
2000

You notice that there are two lines displaying 1999, this is because
two messages were lost. Otherwise you see 2000 messages processed
from each thread.


From shilei1980 at gmail.com  Mon Jan  9 23:49:07 2012
From: shilei1980 at gmail.com (njsss)
Date: Mon, 9 Jan 2012 15:49:07 -0800 (PST)
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
In-Reply-To: <CAHiEoM5vBiCWucx_6SFXYpi6wToBX0pL_Z4P9Cxoc6Bby=NUNg@mail.gmail.com>
References: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
	<CAHiEoM5vBiCWucx_6SFXYpi6wToBX0pL_Z4P9Cxoc6Bby=NUNg@mail.gmail.com>
Message-ID: <09cf2059-50aa-4997-b2a1-d1a73c52dd7f@k10g2000yqk.googlegroups.com>

Excuse me for being a newb, but how to "loop for N ms" in Pika
(haven't got time to look into haigha)?
I tried to set a timeout func in the ioloop:

def on_timeout():
? ? global connection
? ? print "timeout"
? ? connection.close()
connection.add_timeout(timeout, on_timeout)

and insert these between each frame (don't really know how to do the
queue in that game engine (panda3D) as well :( ):
? ? ? ? connection = SelectConnection(parameters, on_connected)
? ? ? ? connection.add_timeout(timeout, on_timeout)
? ? ? ? connection.ioloop.start()

but running into trouble
"UserWarning: SelectConnection.Close invoked while closing or closed ?
? ? self.__class__.__name__) "

On Jan 9, 12:16?pm, Aaron Westendorf <aa... at agoragames.com> wrote:
> You can also use haigha which supports pyevent and gevent for its loop.https://github.com/agoragames/haigha
>
> Regarding your animation loop, you can simply queue the "draw()" onto
> the event loop so it's all in synch, use native threading, or both
> pyevent and gevent support a concept of "loop for N milliseconds, then
> return", so you can call that whenever your animation loop yields.
>
> -Aaron
>
> On Fri, Jan 6, 2012 at 1:02 PM, njsss <shilei1... at gmail.com> wrote:
> > Hello all,
>
> > I'm new to rabbitmq and python as well. I installed pika and followed
> > the tutorials. But what I need is an event-driving messenger. Is there
> > anyway to do it?
>
> > Thanks,
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aa... at agoragames.comwww.agoragames.com
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From vveludan at gmail.com  Tue Jan 10 00:47:48 2012
From: vveludan at gmail.com (Venkat)
Date: Mon, 9 Jan 2012 16:47:48 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
Message-ID: <26b46fb0-b9c8-4ec8-848f-dc0100cb3f85@m4g2000vbc.googlegroups.com>

Steve I gorgot include some more info in my previous post. It is as
follows:
I have used HA Proxy for load balancing using roundrobin pattern.
I am thinking about those 2/3 lost message. I assuming that HA Proxy
was not quick enough to detect about the Crashed Node A and thus those
2/3 messages were routed to crashed NodeA. Please correct me if I am
wrong.

Thanks
Venkat

On Jan 9, 6:39?pm, Venkat <vvelu... at gmail.com> wrote:
> Hi Steve I have run some tests using RabbitMQ 2.7.1 please find the
> following:
>
> OS: CentOS release 5.5
> RabbitMQ Version: 2.7.1
> RabbitMQ Java Client: 2.7.1
> spring-amqp Version: 1.0.0RELEASE
> erlang version : 5.8.4 (http://repos.fedorapeople.org/repos/peter/
> erlang/epel-erlang.repo: using Erlang version:R14B)
> ----------------------------------
> Cluster Information:
> Started Cluster with one RabbitMQ Node (Node A)
> After test.queue is created on Node A, joined Node B to the cluster.
> ---------------------------------------------
> Parent Queue Configuration:
>
> @Configuration
> public abstract class AbstractMDBRabbitConfiguration {
>
> ? ? ? ? protected abstract void configureMDBTemplate(RabbitTemplate
> template);
>
> ? ? ? ? @Bean
> ? ? ? ? public ConnectionFactory connectionFactory() {
> ? ? ? ? ? ? ? ? String rabbitMQUser = "guest";
> ? ? ? ? ? ? ? ? String rabbitMQPassword = "guest";
> ? ? ? ? ? ? ? ? String rabbitMQHost = "localhost";
> ? ? ? ? ? ? ? ? CachingConnectionFactory connectionFactory = new
> CachingConnectionFactory(rabbitMQHost);
> ? ? ? ? ? ? ? ? connectionFactory.setChannelCacheSize(10);
> ? ? ? ? ? ? ? ? connectionFactory.setUsername(rabbitMQUser);
> ? ? ? ? ? ? ? ? connectionFactory.setPassword(rabbitMQPassword);
> ? ? ? ? ? ? ? ? return connectionFactory;
> ? ? ? ? }
>
> ? ? ? ? @Bean
> ? ? ? ? public RabbitTemplate rabbitTemplate() {
> ? ? ? ? ? ? ? ? RabbitTemplate template = new DMBTemplate(connectionFactory());
> ? ? ? ? ? ? ? ? template.setMessageConverter(messageConverter());
> ? ? ? ? ? ? ? ? configureMDBTemplate(template);
> ? ? ? ? ? ? ? ? return template;
> ? ? ? ? }
>
> ? ? ? ? @Bean
> ? ? ? ? public MessageConverter messageConverter() {
> ? ? ? ? ? ? ? ? return new SimpleMessageConverter();
> ? ? ? ? }
>
> ? ? ? ? @Bean
> ? ? ? ? public AmqpAdmin amqpAdmin() {
> ? ? ? ? ? ? ? ? RabbitAdmin rabbitAdmin = new RabbitAdmin(connectionFactory());
> ? ? ? ? ? ? ? ? return rabbitAdmin ;
> ? ? ? ? }
> --------------------------------------------------------------------------- ----------
> Test Queue Configuaration:
>
> @Configuration
> public class LoggingConfiguration extends
> AbstractMDBRabbitConfiguration {
>
> ? ? ? ? private static final String AUDIT_EXCHANGE_NAME = "test.exchange";
> ? ? ? ? private static final String AUDIT_QUEUE_NAME = "test.queue";
> ? ? ? ? private static final String AUDIT_ROUTING_KEY = AUDIT_QUEUE_NAME;
>
> ? ? ? ? @Override
> ? ? ? ? public void configureMDBTemplate(RabbitTemplate mdbTemplate) {
> ? ? ? ? ? ? ? ? mdbTemplate.setExchange(AUDIT_EXCHANGE_NAME);
> ? ? ? ? ? ? ? ? mdbTemplate.setRoutingKey(AUDIT_ROUTING_KEY);
> ? ? ? ? }
>
> ? ? ? ? @Bean
> ? ? ? ? public Queue mdbQueue() {
> ? ? ? ? ? ? ? ? Map<String, Object> args = new HashMap<String, Object>();
> ? ? ? ? ? ? ? ? String haPolicyValue = "all";
> ? ? ? ? ? ? ? ? args.put("x-ha-policy", haPolicyValue);
> ? ? ? ? ? ? ? ? Queue queue = new Queue(AUDIT_QUEUE_NAME,true,false,false,args);
> ? ? ? ? ? ? ? ? return queue;
> ? ? ? ? }
>
> ? ? ? ? @Bean
> ? ? ? ? public TopicExchange mdbAuditExchange() {
> ? ? ? ? ? ? ? ? TopicExchange exchange = new
> TopicExchange(AUDIT_EXCHANGE_NAME,true,false);
> ? ? ? ? ? ? ? ? return exchange;
> ? ? ? ? }
>
> ? ? ? ? @Bean
> ? ? ? ? public Binding mdbAuditBinding() {
> ? ? ? ? ? ? ? ? return
> BindingBuilder.bind(mdbQueue()).to(mdbAuditExchange()).with(AUDIT_ROUTING_K EY);
> ? ? ? ? }}
>
> ------------------------------------------------------
> Queue Consumer configuration:
>
> ? ? ? ? <context:component-scan base-package="com.test.services.logging">
> ? ? ? ? </context:component-scan>
>
> ? ? ? ? <bean id="messageListenerContainer"
> class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContai ner">
> ? ? ? ? ? ? ? ? <property name="connectionFactory" ref="connectionFactory" />
> ? ? ? ? ? ? ? ? <property name="queueNames" value="test.queue"/>
> ? ? ? ? ? ? <property name="concurrentConsumers" value="5" />
> ? ? ? ? ? ? <property name="messageListener" ref="messageListenerAdapter" />
> ? ? ? ? </bean>
>
> ? ? ? ? <bean id="messageListenerAdapter"
> class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdap ter">
> ? ? ? ? ? ? ? ? <property name="delegate" ref="logHandler" />
> ? ? ? ? ? ? ? ? <property name="messageConverter" ref="messageConverter" />
> ? ? ? ? </bean>
>
> ? ? ? ? <bean id="loggingEventHandler"
> class="com.test.services.logging.LoggingEventHandler">
> ? ? ? ? </bean>
>
> ? ? ? ? <bean id="logHandler"
> class="com.test.services.logging.LoggingProcessor">
> ? ? ? ? ? ? ? ? <property name="loggingEventHandler" ref="loggingEventHandler"/>
> ? ? ? ? </bean>
>
> -------------------------------------------------------
> Test Scenario:
>
> First Test: Stopped the Queue Consumer during the test to watch for
> the message count using rabbitmqctl list_queues
>
> Executed a program that spawns 10 threads, each thread placing 2000
> messages on test.queue.
> While messages are pumped into test.queue crashed (hard-failure using
> kill -9) RabbitMQ broker on Node A.
> Ran the above test for two iterations.
> Following are the findings:
> - In the first iteration lost only 3 messages. When the program that
> was pumping in messages is stopped found that 19997 messages were
> piled up in the queue.
> ? Verified this by running rabbitmqctl list_queues
> - In the second iteration lost only 2 messages. When the program that
> was pumping in messages is stopped found that 19998 messages were
> piled up in the queue.
> ? Verified this by running rabbitmqctl list_queues
>
> Second Test: Queue consumer was running during the test
> Executed the same program used in the first test to pump in messages.
> While messages are pumped in, hard crashed RabbitMQ broker on Node A.
> Same findings as in the first test. Lost 2 messages during the first
> iteration and 3 messages in the second iteration.
>
> These results are better compared to 2.7.0.
>
> I have one question, referring tohttp://www.rabbitmq.com/ha.html:
> As a result of the requeuing, clients that re-consume from the queue
> must be aware that they are likely to subsequently receive messages
> that they have seen previously
>
> During the second test when I had Queue Consumer was up and running, I
> didn't find any duplicate messages processed (though 2-3 messages
> lost)
> All messages processed are written to log. I have verified that there
> were no duplicate messages by running grep command to fetch the Thread
> Id on the log file.
> Please find the following info:
> [ecloud at t-3 log]$ grep Thread-0 central-log.log | wc -l
> 1999
> [ecloud at t-3 log]$ grep Thread-1 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-2 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-3 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-4 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-5 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-6 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-7 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-8 central-log.log | wc -l
> 1999
> [ecloud at t-3 log]$ grep Thread-9 central-log.log | wc -l
> 2000
>
> You notice that there are two lines displaying 1999, this is because
> two messages were lost. Otherwise you see 2000 messages processed
> from each thread.
>
> From this, does it mean that I don't have to worry about duplicate
> messages due to requeing?.
>
> The other thing that I just wanted to bring it to your attention (it
> doesn't bother me). It is as follows:
> I have NodeA in the beginning of the cluster then I join NodeB to the
> cluster.
> If I run rabbitmqctl report on NodeA, it throws an error saying that
> NodeA is down (when it is really not down). But it works fine on
> NodeB.
>
> Thanks
> Venkat
>
> On Dec 22 2011, 1:32?pm, Steve Powell <st... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > Please let us know if this cures your problem.
>
> > Steve Powell ?(a happy bunny)
> > ----------some more definitions from the SPD----------
> > avoirdupois (phr.) 'Would you like peas with that?'
> > distribute (v.) To denigrate an award ceremony.
> > definite (phr.) 'It's hard of hearing, I think.'
> > modest (n.) The most mod.
>
> > On 22 Dec 2011, at 16:52, Venkat wrote:
>
> > > I saw a post on RabbitMQ 2.7.1 Release. We will be planning to upgrade
> > > to 2.7.1.
>
> > > Thanks
> > > Venkat
>
> > > On Dec 21, 9:39 pm, Venkat <vvelu... at gmail.com> wrote:
> > >> Good evening.
> > >> We have ?a cluster of two RabbitMQ nodes running 2.7.0 version using
> > >> mirrored queues.
> > >> There are 25 queues all using x-ha-policy = all.
> > >> There was a point where one queue had 5000 messages and the other
> > >> queue had about 600K messages. Message consumption was slow due to the
> > >> business logic using Cassandra was slowing down. At this point
> > >> executed rabbitmqctl report command one NodeA. It displayed that node
> > >> was down though the node was up. Executed the report command on NodeB,
> > >> after there was no response. After some time when executed rabbitmqctl
> > >> list_queues command on NodeA some of the queues were not listed. I
> > >> just wanted to find running report command when broker is under heavy
> > >> load can cause any problem.
>
> > >> Thanks
> > >> Venkat
> > >> _______________________________________________
> > >> rabbitmq-discuss mailing list
> > >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Tue Jan 10 00:56:02 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 9 Jan 2012 17:56:02 -0700
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
 with mirrored queues
In-Reply-To: <26b46fb0-b9c8-4ec8-848f-dc0100cb3f85@m4g2000vbc.googlegroups.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
	<26b46fb0-b9c8-4ec8-848f-dc0100cb3f85@m4g2000vbc.googlegroups.com>
Message-ID: <CAHZAEpfpJoKNUkTDjhy8vm8Tfvi+hP8FtVA73m_BjxP6jbWDhg@mail.gmail.com>

>
> I have used HA Proxy for load balancing using roundrobin pattern.
> I am thinking about those 2/3 lost message. I assuming that HA Proxy
> was not quick enough to detect about the Crashed Node A and thus those
> 2/3 messages were routed to crashed NodeA. Please correct me if I am
> wrong.


Was the Rabbit responding on 5672? HAProxy is just a dumb TCP connection
load balancer, so if your Rabbit is not responding on 5672 (e.g. crashed)
HAProxy will get a TCP reset and should pass that along to your app (should
appear to your app as a dropped connection).

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120109/40647ceb/attachment.htm>

From lionel.cons at cern.ch  Tue Jan 10 06:47:16 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 10 Jan 2012 07:47:16 +0100
Subject: [rabbitmq-discuss] Auth failure: Bad CONNECT
In-Reply-To: <33107784.post@talk.nabble.com> (dnsplus's message of "Mon, 9 Jan
	2012 10:08:30 -0800")
References: <33107784.post@talk.nabble.com>
Message-ID: <bw7vcokm4uj.fsf@mail.cern.ch>

dnsplus <developer at dnsplus.net> writes:
> wgmq201:/home/mq-admin/scripts # perl connect.pl
> *** unexpected ERROR frame received: Bad CONNECT
> [...]
> $stomp->connect(login=>"guest", passcode=>"guest");

Try to add the virtual host you want to use in the CONNECT frame:

  $stomp->connect(login=>"guest", passcode=>"guest", host=>"your-virtual-host");

This should hopefully work.

Cheers,

Lionel

From torinsandall at gmail.com  Tue Jan 10 09:15:45 2012
From: torinsandall at gmail.com (Torin Sandall)
Date: Tue, 10 Jan 2012 01:15:45 -0800
Subject: [rabbitmq-discuss] Question about HA extension benefits
Message-ID: <CABKNZ0X-W6-jXjfk0YoOUQowgTF76-qm52dgx4_6L=Ds4KqD0A@mail.gmail.com>

I'm experimenting with the HA extension and would like to get some
clarification on the benefits/guarantees provided my system already runs a
rabbitmq cluster with clients using publisher and consumer acks.


From andrea.rosa at hp.com  Tue Jan 10 09:45:13 2012
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Tue, 10 Jan 2012 09:45:13 +0000
Subject: [rabbitmq-discuss] handshake_timeout
In-Reply-To: <4F0B2516.1040408@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD3690C353@G4W3209.americas.hpqcorp.net>
	<4F0B20A6.5010604@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3690C385@G4W3209.americas.hpqcorp.net>
	<4F0B2516.1040408@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3690C46D@G4W3209.americas.hpqcorp.net>

Hi Simon


>> Thanks for your help, it's not clear to me your example, are you
>saying that if
>> there is a connection and then nothing is sent on this connection I
>can see this timeout error?
>
>Yes. If there is a *TCP connection* and nothing is sent.

Just a double check this behavior is specific for rabbitmq, because with TCP we can establish a connection and even if nothing is sent there is no timeout exception. 

Thanks
--
Andrea

From simon at rabbitmq.com  Tue Jan 10 10:44:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Jan 2012 10:44:03 +0000
Subject: [rabbitmq-discuss] handshake_timeout
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3690C46D@G4W3209.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3690C353@G4W3209.americas.hpqcorp.net>
	<4F0B20A6.5010604@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3690C385@G4W3209.americas.hpqcorp.net>
	<4F0B2516.1040408@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3690C46D@G4W3209.americas.hpqcorp.net>
Message-ID: <4F0C1673.2090504@rabbitmq.com>

On 10/01/12 09:45, Rosa, Andrea wrote:
>> Yes. If there is a *TCP connection* and nothing is sent.
>
> Just a double check this behavior is specific for rabbitmq, because
> with TCP we can establish a connection and even if nothing is sent
> there is no timeout exception.

Well the point is that we need to establish an AMQP connection on top of 
the TCP connection. If that process does not complete we want to detect 
it and close the connection.

This behaviour is not unique to RabbitMQ - take the example of Apache 
and HTTP. If I telnet to an Apache server and do not start sending HTTP, 
I get disconnected. After about ten seconds ;-)

Once the AMQP connection is actually established it will stay up 
indefinitely (modulo heartbeats).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 10 10:52:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Jan 2012 10:52:24 +0000
Subject: [rabbitmq-discuss] Question about HA extension benefits
In-Reply-To: <CABKNZ0X-W6-jXjfk0YoOUQowgTF76-qm52dgx4_6L=Ds4KqD0A@mail.gmail.com>
References: <CABKNZ0X-W6-jXjfk0YoOUQowgTF76-qm52dgx4_6L=Ds4KqD0A@mail.gmail.com>
Message-ID: <4F0C1868.5010904@rabbitmq.com>

On 10/01/12 09:15, Torin Sandall wrote:
>  From what I understand, the HA extension will cause queues to be
> replicated so in the event of node failure, the queue would still be
> available and the publishers would not need to retransmit messages. This
> is great, I'm just wondering if there are other benefits I should be
> aware of.

That's basically it - what else were you hoping for?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jass.zhao at gmail.com  Tue Jan 10 12:08:32 2012
From: jass.zhao at gmail.com (Gnep)
Date: Tue, 10 Jan 2012 04:08:32 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbit fails to start on EC2 Ubuntu 11.04
Message-ID: <99b9dc8b-253e-4391-8b9a-fd1d8419b963@v14g2000yqh.googlegroups.com>

Hi,

I followed the manual http://www.rabbitmq.com/ec2.html to setup rabbit
on Ubuntu 11.04. Everything goes fine, except when I tried to start
rabbit server:

root at rabiit# rabbitmq-server
Activating RabbitMQ plugins ...
0 plugins activated:

node with name "rabbit" already running on "rabbit"
diagnostics:
- nodes and their ports on rabbit: [{rabbit,38878},
                                    {rabbitmqprelaunch2039,33005}]
- current node: rabbitmqprelaunch2039 at rabbit
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: gItMUWlpJAhfs9LBB1uCEg==

I'm new to rabbit, could somebody shed some light on this?

Thanks,
Gnep

From emile at rabbitmq.com  Tue Jan 10 12:16:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Jan 2012 12:16:05 +0000
Subject: [rabbitmq-discuss] Rabbit fails to start on EC2 Ubuntu 11.04
In-Reply-To: <99b9dc8b-253e-4391-8b9a-fd1d8419b963@v14g2000yqh.googlegroups.com>
References: <99b9dc8b-253e-4391-8b9a-fd1d8419b963@v14g2000yqh.googlegroups.com>
Message-ID: <4F0C2C05.4020003@rabbitmq.com>

Hi Gnep,

On 10/01/12 12:08, Gnep wrote:
> Hi,
> 
> I followed the manual http://www.rabbitmq.com/ec2.html to setup rabbit
> on Ubuntu 11.04. Everything goes fine, except when I tried to start
> rabbit server:
> 
> root at rabiit# rabbitmq-server
> Activating RabbitMQ plugins ...
> 0 plugins activated:
> 
> node with name "rabbit" already running on "rabbit"

It looks like the broker is already running, and thus preventing you
from starting it once more.


-Emile

From simon at rabbitmq.com  Tue Jan 10 12:16:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Jan 2012 12:16:55 +0000
Subject: [rabbitmq-discuss] Rabbit fails to start on EC2 Ubuntu 11.04
In-Reply-To: <99b9dc8b-253e-4391-8b9a-fd1d8419b963@v14g2000yqh.googlegroups.com>
References: <99b9dc8b-253e-4391-8b9a-fd1d8419b963@v14g2000yqh.googlegroups.com>
Message-ID: <4F0C2C37.3010209@rabbitmq.com>

On 10/01/12 12:08, Gnep wrote:
> node with name "rabbit" already running on "rabbit"

The Debian packages for RabbitMQ start the server automatically, you 
don't need to launch it yourself.

Also you should use "/etc/init.d/rabbitmq-server {stop|start}" or 
"service rabbitmq-server {stop|start}" to stop and start the service to 
ensure it runs as the correct user etc.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Tue Jan 10 13:36:27 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 10 Jan 2012 13:36:27 +0000
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
In-Reply-To: <09cf2059-50aa-4997-b2a1-d1a73c52dd7f@k10g2000yqk.googlegroups.com>
References: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
	<CAHiEoM5vBiCWucx_6SFXYpi6wToBX0pL_Z4P9Cxoc6Bby=NUNg@mail.gmail.com>
	<09cf2059-50aa-4997-b2a1-d1a73c52dd7f@k10g2000yqk.googlegroups.com>
Message-ID: <CABzX+qxFTWhEmh5rpJbX16vrJ+Ued51SUy7+LVk31MNCEKgqUQ@mail.gmail.com>

On Mon, Jan 9, 2012 at 23:49, njsss <shilei1980 at gmail.com> wrote:
> Excuse me for being a newb, but how to "loop for N ms" in Pika
> (haven't got time to look into haigha)?

Briefly looking at the sources, it looks like it's not supported, I
hope our pika gurus will correct me:
   https://github.com/pika/pika/blob/120fdea5913e7ed80536ff55634ab0f8f4554e79/pika/adapters/asyncore_connection.py

Maybe you could use `add_timeout`?

Cheers,
    Marek

> I tried to set a timeout func in the ioloop:
>
> def on_timeout():
> ? ? global connection
> ? ? print "timeout"
> ? ? connection.close()
> connection.add_timeout(timeout, on_timeout)
>
> and insert these between each frame (don't really know how to do the
> queue in that game engine (panda3D) as well :( ):
> ? ? ? ? connection = SelectConnection(parameters, on_connected)
> ? ? ? ? connection.add_timeout(timeout, on_timeout)
> ? ? ? ? connection.ioloop.start()
>
> but running into trouble
> "UserWarning: SelectConnection.Close invoked while closing or closed
> ? ? self.__class__.__name__) "
>
> On Jan 9, 12:16?pm, Aaron Westendorf <aa... at agoragames.com> wrote:
>> You can also use haigha which supports pyevent and gevent for its loop.https://github.com/agoragames/haigha
>>
>> Regarding your animation loop, you can simply queue the "draw()" onto
>> the event loop so it's all in synch, use native threading, or both
>> pyevent and gevent support a concept of "loop for N milliseconds, then
>> return", so you can call that whenever your animation loop yields.
>>
>> -Aaron
>>
>> On Fri, Jan 6, 2012 at 1:02 PM, njsss <shilei1... at gmail.com> wrote:
>> > Hello all,
>>
>> > I'm new to rabbitmq and python as well. I installed pika and followed
>> > the tutorials. But what I need is an event-driving messenger. Is there
>> > anyway to do it?
>>
>> > Thanks,
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-disc... at lists.rabbitmq.com
>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> --
>> Aaron Westendorf
>> Senior Software Engineer
>> Agora Games
>> 359 Broadway
>> Troy, NY 12180
>> Phone: 518.268.1000
>> aa... at agoragames.comwww.agoragames.com
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From developer at dnsplus.net  Tue Jan 10 15:58:16 2012
From: developer at dnsplus.net (dnsplus)
Date: Tue, 10 Jan 2012 07:58:16 -0800 (PST)
Subject: [rabbitmq-discuss] Auth failure: Bad CONNECT
In-Reply-To: <bw7vcokm4uj.fsf@mail.cern.ch>
References: <33107784.post@talk.nabble.com> <bw7vcokm4uj.fsf@mail.cern.ch>
Message-ID: <33112570.post@talk.nabble.com>




Lionel Cons wrote:
> 
> dnsplus <developer at dnsplus.net> writes:
>> wgmq201:/home/mq-admin/scripts # perl connect.pl
>> *** unexpected ERROR frame received: Bad CONNECT
>> [...]
>> $stomp->connect(login=>"guest", passcode=>"guest");
> 
> Try to add the virtual host you want to use in the CONNECT frame:
> 
>   $stomp->connect(login=>"guest", passcode=>"guest",
> host=>"your-virtual-host");
> 
> This should hopefully work.
> 
> Cheers,
> 
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

Sadly, no. I still get the Bad CONNECT response. 

What can I check as for dependencies for Net::STOMP ? I can't tell based on
the CPAN pages whether there are, or are not, any dependencies. 

Thanks !
-- 
View this message in context: http://old.nabble.com/Auth-failure%3A-Bad-CONNECT-tp33107784p33112570.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From graf0 at post.pl  Tue Jan 10 16:16:40 2012
From: graf0 at post.pl (=?iso-8859-2?Q?Grzegorz_Marsza=B3ek?=)
Date: Tue, 10 Jan 2012 17:16:40 +0100
Subject: [rabbitmq-discuss] begginer question about performance & use case
Message-ID: <8A745FEF-8ECB-4B4E-A3DB-778CAEF1F977@post.pl>

Hello!

I'm very new to rabbitmq and messaging in general - but I see a lot of potential in it for my current project :)

I'd like to ask you, if rabbitmq is good choice for following scenario:

I have many software agents running as service and installed on users pc. Now I'd like to implement 4 features:

* sending commands to and form agents when needed - well, it seems that rabbitmq is built especially for that :)

* presence - I've done some mailing list digging and there seems to be at least 2 solutions: presence-exchange, or rabbitmq-external-exchange + writing own exchange (unfortunately I don't now erlang). I'd like to ask you if you have any experience with this code? Are they stable (esp. presence-exchagne)?

* forwarding tcp connections between agents and server. Here is my biggest doubt. I'd like to provide vnc access to computer with agents installed, but I cannot assume, that they will be reachable via tcp/ip (ie.: they could be hidden behind some firewall with nat etc.). So I have following idea: I will make 2 consumers - first will be awainting for messages in agent, second will be running on server. Then, we agent connects it asks server to start listening on port X. If anything will connect to port X, then server will forward all data from this connection to agent - ang agent will make connection to vnc server on localhost:5900. From this point agent and server will be exchanging messages in both directions literally forwarding tcp data through using amqp messages for that. I understand, that this will have it's overhead, but I don't expect a lot of those connection - from my experience there will be few dozens of them simultanousely. I have hardware & network bandwith to handle the (not so big) load. But main question is - is rabbitmq good solution for such forwarding? What about latency? Any other problems that I don't see could arise?

* security. In this solution rabbitmq will be accessible from Internet (all agents needs to connect). This makes its own concerns, but first thing is - I'd like to limit, what agents could do. I don't want any agent with valid password and username do whatever they want - just limit them to subset of queues (ie.: mysystem.AGENTUUID.*), maybe give them write permission to set of exchanges. I saw in documentation that it's possible - but do you think it's good idea - there potentially will be thousands of such rules (at least few per one agent, and at very begining I need to service at least 2000 user computer with agent installed!)?

I would be gratful for you advice :)

Regards
---
Grzegorz Marsza?ek
graf0 at post.pl



From steve at rabbitmq.com  Tue Jan 10 16:27:52 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 10 Jan 2012 16:27:52 +0000
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
Message-ID: <0CF971BF-82C1-4D62-BB41-2628875837AE@rabbitmq.com>

Hi Venkat,

I'm glad things are better under 2.7.1.

> I have one question, referring to http://www.rabbitmq.com/ha.html:
>> As a result of the requeuing, clients that re-consume from the queue
>> must be aware that they are likely to subsequently receive messages
>> that they have seen previously

This is an accurate quote, and is still true.  Acknowledgements are only sent
to the master and then copied to the slaves, so the slaves might not know
about some of them if the master goes down before some acknowledgements can
be forwarded.  If you are lucky (and it appears that you are, or else you are
using auto acknowledgements) then none of the acknowledgements are lost
(or none are required!).

> You notice that there are two lines displaying 1999, this is because
> two messages were lost. Otherwise you see 2000 messages processed
> from each thread.
> 
> From this, does it mean that I don't have to worry about duplicate
> messages due to requeing?

No, it doesn't mean that. If you have explicit acknowledgements by your
consumers, then when the master fails the slave may redeliver some messages
that were acknowledged, as well as the ones that weren't.

What interests me is the messages that are lost. If I understand it
correctly, messages are published to the master and all the slaves
simultaneously, so the failure of the master shouldn't lose any messages.

Having said that, you haven't said to which broker your test apps connect.
If they were connected to the master at the time, then what do they do when
the master fails?  Do they automatically reconnect (I presume this is in
the tests' logs)? Do they resend the last message (which will have failed
because the connection will have been dropped)?

If they do not resend, then this could be the source of the lost messages
-- they were not sent in the first place.

Please can you explain just a little more about the test thread connection
history, and to which broker they are connected?  I would expect that, if
they are connected to the slave, then you won't see any lost messages in
this test scenario.

> I assuming that HA Proxy
> was not quick enough to detect about the Crashed Node A and thus those
> 2/3 messages were routed to crashed NodeA. Please correct me if I am
> wrong.

I don't think this is the problem, as messages are published to all the
brokers mirroring the queue.

> The other thing that I just wanted to bring it to your attention (it
> doesn't bother me). It is as follows:
> I have NodeA in the beginning of the cluster then I join NodeB to the
> cluster.
> If I run rabbitmqctl report on NodeA, it throws an error saying that
> NodeA is down (when it is really not down). But it works fine on
> NodeB.

This is interesting, too. Can you supply us with the complete output from
rabbitmqctl status for both nodes, and explain exactly what you mean by
'run rabbitmqctl on NodeA'?

Thank you for reporting these issues.

Steve Powell  (a curious bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 9 Jan 2012, at 23:39, Venkat wrote:

> Hi Steve I have run some tests using RabbitMQ 2.7.1 please find the
> following:
...(elided)

From developer at dnsplus.net  Tue Jan 10 16:48:12 2012
From: developer at dnsplus.net (dnsplus)
Date: Tue, 10 Jan 2012 08:48:12 -0800 (PST)
Subject: [rabbitmq-discuss] Auth failure: Bad CONNECT
In-Reply-To: <33112570.post@talk.nabble.com>
References: <33107784.post@talk.nabble.com> <bw7vcokm4uj.fsf@mail.cern.ch>
	<33112570.post@talk.nabble.com>
Message-ID: <33112968.post@talk.nabble.com>




dnsplus wrote:
> 
> 
> 
> Lionel Cons wrote:
>> 
>> dnsplus <developer at dnsplus.net> writes:
>>> wgmq201:/home/mq-admin/scripts # perl connect.pl
>>> *** unexpected ERROR frame received: Bad CONNECT
>>> [...]
>>> $stomp->connect(login=>"guest", passcode=>"guest");
>> 
>> Try to add the virtual host you want to use in the CONNECT frame:
>> 
>>   $stomp->connect(login=>"guest", passcode=>"guest",
>> host=>"your-virtual-host");
>> 
>> This should hopefully work.
>> 
>> Cheers,
>> 
>> Lionel
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> Sadly, no. I still get the Bad CONNECT response. 
> 
> What can I check as for dependencies for Net::STOMP ? I can't tell based
> on the CPAN pages whether there are, or are not, any dependencies. 
> 
> Thanks !
> 


I installed the Net::Stomp module via CPAN, and the perl examples at:

http://hg.rabbitmq.com/rabbitmq-stomp/file/f763412c0ee7/examples/perl

all work properly. 

I wonder what it is about the 'Net::STOMP::Client' provider that rabbitmq
does not like ?

-- 
View this message in context: http://old.nabble.com/Auth-failure%3A-Bad-CONNECT-tp33107784p33112968.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From mspetrovic at gmail.com  Tue Jan 10 18:28:58 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Tue, 10 Jan 2012 10:28:58 -0800
Subject: [rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
Message-ID: <CABMnSbG=ni64VTsqrE5Q-TktWhznQ3rA9hrje3LnkaHuUB3tYg@mail.gmail.com>

Hello.

This note is longer than I thought it would be, but I do not believe
my situation is complicated.

I am a RabbitMQ newcomer and am trying to identify which exchange type
to use for my application.

I have a publisher P that needs to send messages about database table
updates. ?A message will bear the name of a single table name,
followed by some opaque application data:

Logically,

message == tableName | somedata

So consider a simplified database with three tables of interest: ?T1,
T2, and T3.

There are two consumers, C1 and C2.

C1 needs to receive all messages concerning tables T1 and T2.

C2 needs to receive all messages concerning tables T2 and T3.

By implication, C1 and C2 must both receive messages about T2, where
their interests overlap.

Ideally, I want to publish to a single exchange, and, therefore, my
consumers also bind to this same single exchange. ?I say this because
in fact there are a lot more than three tables to treat - there are
almost 200. ?A proliferation of exchanges per-table would be not good.

I am considering a topic or header exchange.

If a header exchange, I was thinking of the publisher P putting the
concerned table name in a "table header" and the consumers binding to
the exchange with an interest in receiving messages with a table
header value equal to T1, T2, or T3 (I believe x-match == any would be
appropriate when the consumer binds). ?But some of my readings on
header exhchanges here

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010935.html

suggest that header exchanges may not be as useful as maybe the name
suggests.  Maybe I'm being overly paranoid.

And I consider topic exchanges because I know they admit messages
about T2 consumed by C1 still being available to C2.

Would someone be kind enough to suggest approaches to discern which
type of exchange to use.

Thank you very kindly.

-- 
Mark

From adamrabung at gmail.com  Tue Jan 10 19:57:02 2012
From: adamrabung at gmail.com (Adam Rabung)
Date: Tue, 10 Jan 2012 14:57:02 -0500
Subject: [rabbitmq-discuss] ConnectionFactory and load balancing
In-Reply-To: <CAAN_EDoxP+qidfB47wwra=3kntXA7Yxbs1ejABs7oLLxe2gomQ@mail.gmail.com>
References: <CAAN_EDoxP+qidfB47wwra=3kntXA7Yxbs1ejABs7oLLxe2gomQ@mail.gmail.com>
Message-ID: <CAAN_EDor5bQz1xRs_9AGqmFQzmqMAd4mPd1Lz6ZMdQ5Lg_L4OA@mail.gmail.com>

Let me restate :)

Connection.newConnection(Address[]) seems to be the best way, short of
using HAProxy, to safely attain a connection to a cluster in the presence
of nodes going down.  When we are mirroring queues across a cluster, is it
important to connect to the "master" node for a queue, or should we
randomize the Address[] to achieve some load balancing?

Any feedback appreciated,
Adam

On Mon, Jan 9, 2012 at 5:03 PM, Adam Rabung <adamrabung at gmail.com> wrote:
> Hi,
> I am running an active/active cluster.  The newConnection(Address[])
> method of ConnectionFactory takes an array of addresses to try to
> connect to, in order.  If I'd like to avoid HAProxy for now, it seems
> like it would be wise for me to randomize this array of Addresses
> before calling newConnection, to achieve some degree of load
> balancing.  Is that a worthwhile approach?
> Thank you,
> Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120110/288ffbbd/attachment.htm>

From cao at ll.mit.edu  Tue Jan 10 20:03:44 2012
From: cao at ll.mit.edu (Cao, Yican - 0661 - MITLL)
Date: Tue, 10 Jan 2012 15:03:44 -0500
Subject: [rabbitmq-discuss] Is it possible that group clustering nodes
 shovel/federate with other group clustering nodes
Message-ID: <2A2E5FBC-AD23-4CCF-8C8A-5EEC86FAEC88@ll.mit.edu>

Hi,

I have a crazy idea: 
1. clustering 3 nodes with HAQ (highly available queue) as group A.
2. clustering other 2 nodes with HAQ as group B.
3. federating/shoveling group A and group B with 1 or 2 exchange.

Group A and B will connect via WAN, so clustering is not recommended by RabbitMQ.

Is it possible? If so, has anyone done this? 
Thanks a lot.


Yican Cao
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 6299 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120110/a4f72437/attachment.bin>

From mspetrovic at gmail.com  Tue Jan 10 22:20:44 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Tue, 10 Jan 2012 14:20:44 -0800
Subject: [rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
In-Reply-To: <CABMnSbG=ni64VTsqrE5Q-TktWhznQ3rA9hrje3LnkaHuUB3tYg@mail.gmail.com>
References: <CABMnSbG=ni64VTsqrE5Q-TktWhznQ3rA9hrje3LnkaHuUB3tYg@mail.gmail.com>
Message-ID: <CABMnSbH1s5ve5EcO+fR-pv4ZeTNi=ZSWvyRzG-3y45L2O8hpEA@mail.gmail.com>

Talking to myself here (I have no problem with that :-)), I think I
have at least one solution to this.

- Create a single exchange E
- The Publisher P creates a channel with a single queue and routing
key with the same names as the Table T in question.
- Publisher publishes a message to channel
- The Consumer C1 iterates over the table names T1 and T2 he cares
about and binds his channel to queues and routing keys with the same
name as the table name iterated over
- The Consumer C1 then starts a thread for each of these queues, and
whose run() method calls channel.basicConsume(queueName, autoAck,
rabbitConsumer)

where rabbitConsumer extends com.rabbitmq.client.DefaultConsumer.

While this seems to work, and is a bit easier to understand how to
program than header exchanges (if a header exchange would even work
for me - I wonder), I dont' like the thread-per-queue I need to spawn
to handle messages inbound for each queue.

What would be nice is if I could call channel.basicConsume(autoAck,
rabbitConsumer), which would read messages off all the queues that
were bound to that channel.

While I have something working, I'm not yet real thrilled with my
programming model.

Anybody?

Thanks!

On Tue, Jan 10, 2012 at 10:28 AM, Mark Petrovic <mspetrovic at gmail.com> wrote:
> Hello.
>
> This note is longer than I thought it would be, but I do not believe
> my situation is complicated.
>
> I am a RabbitMQ newcomer and am trying to identify which exchange type
> to use for my application.
>
> I have a publisher P that needs to send messages about database table
> updates. ?A message will bear the name of a single table name,
> followed by some opaque application data:
>
> Logically,
>
> message == tableName | somedata
>
> So consider a simplified database with three tables of interest: ?T1,
> T2, and T3.
>
> There are two consumers, C1 and C2.
>
> C1 needs to receive all messages concerning tables T1 and T2.
>
> C2 needs to receive all messages concerning tables T2 and T3.
>
> By implication, C1 and C2 must both receive messages about T2, where
> their interests overlap.
>
> Ideally, I want to publish to a single exchange, and, therefore, my
> consumers also bind to this same single exchange. ?I say this because
> in fact there are a lot more than three tables to treat - there are
> almost 200. ?A proliferation of exchanges per-table would be not good.
>
> I am considering a topic or header exchange.
>
> If a header exchange, I was thinking of the publisher P putting the
> concerned table name in a "table header" and the consumers binding to
> the exchange with an interest in receiving messages with a table
> header value equal to T1, T2, or T3 (I believe x-match == any would be
> appropriate when the consumer binds). ?But some of my readings on
> header exhchanges here
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010935.html
>
> suggest that header exchanges may not be as useful as maybe the name
> suggests. ?Maybe I'm being overly paranoid.
>
> And I consider topic exchanges because I know they admit messages
> about T2 consumed by C1 still being available to C2.
>
> Would someone be kind enough to suggest approaches to discern which
> type of exchange to use.
>
> Thank you very kindly.
>
> --
> Mark



-- 
Mark

From vveludan at gmail.com  Tue Jan 10 23:13:15 2012
From: vveludan at gmail.com (Venkat)
Date: Tue, 10 Jan 2012 15:13:15 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <0CF971BF-82C1-4D62-BB41-2628875837AE@rabbitmq.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
	<0CF971BF-82C1-4D62-BB41-2628875837AE@rabbitmq.com>
Message-ID: <03877dc9-66c8-473b-a99a-6f8c8bf4bb59@d10g2000vbh.googlegroups.com>

Hi Steve please find the following:

> If you are lucky (and it appears that you are, or else you are
> using auto acknowledgements) then none of the acknowledgements are lost
> (or none are required!).
In my queue consumer there is no acknowledgeMode set.
SimpleMessageListenerContainer sets the acknowledgeMode as AUTO as
default if it is not set.
In other words auto acknowledgment is used.

>If they do not resend, then this could be the source of the lost messages
> they were not sent in the first place.
The producer may have been connected to crashed Node.
I have seen two AmqpExceptions in the log.
I didn't have logic in my producer code to resend the message on
AmqpException.
In the catch block I have added the code to resend the message as
follows:
	@Override
	public void convertAndSend(final Object message)  {
		MessageProperties props = null;
		try {
			props = new MessageProperties();
			props.setDeliveryMode(MessageDeliveryMode.PERSISTENT);   //setting
delivery mode as PERSISTENT
			send(getMessageConverter().toMessage(message, props));

		} catch (AmqpException amqpe) {
			send(getMessageConverter().toMessage(message, props));
		}
	}



After adding the code to resend message on exception, I have rerun the
test.
This time there were no messages lost. All 20K messages were
processed.
[ecloud at t-3 log]$ grep Thread-0 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-1 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-2 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-3 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-4 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-5 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-6 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-7 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-8 central-log.log | wc -l
2000
[ecloud at t-3 log]$ grep Thread-9 central-log.log | wc -l
2000

>This is interesting, too. Can you supply us with the complete output from
>rabbitmqctl status for both nodes, and explain exactly what you mean by
>'run rabbitmqctl on NodeA'?

I meant running report.
This time I have captured all the details.
In the beginning of the test I had only node t-2.
Running report command worked fine on t-2 node.

Then I joined t-4 node to the cluster as follows:

/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl stop_app
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl reset
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster
rabbit at t-2 rabbit at t-4

Then I ran report command on t-2. Following is the error displayed:
[ecloud at t-2 vv]$  /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/
rabbitmqctl report > /home/ecloud/vv/rep3.txt
Error: unable to connect to node 'rabbit at t-2': nodedown
diagnostics:
- nodes and their ports on t-2: [{rabbit,19667},
                                       {rabbitmqctl28789,44074}]
- current node: 'rabbitmqctl28789 at t-2'
- current node home dir: /home/ecloud
- current node cookie hash: VLhPX0Ti0bNE//tFwfQQGA==

 I ran status command on t-2 node:

[ecloud at t-2 vv]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/
rabbitmqctl -n rabbit at t-2 status

Status of node 'rabbit at t-2' ...
[{pid,28188},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.19"},
                        {os_mon,"CPO  CXC 138 46","2.2.6"},
                        {sasl,"SASL  CXC 138 11","2.1.9.4"},
                        {stdlib,"ERTS  CXC 138 10","1.17.4"},
                        {kernel,"ERTS  CXC 138 10","2.14.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [rq:1]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,60196864},
          {processes,10386136},
          {processes_used,10379416},
          {system,49810728},
          {atom,1122009},
          {atom_used,1117604},
          {binary,69968},
          {code,11235581},
          {ets,793680}]},
 {vm_memory_high_watermark,0.39999999962067656},
 {vm_memory_limit,843607244}]
...done.

Following is after running status command on t-4 node:
[ecloud at t-4 ~]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/
rabbitmqctl -n rabbit at t-4 status
Status of node 'rabbit at t-4' ...
[{pid,22424},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.6"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.19"},
                        {sasl,"SASL  CXC 138 11","2.1.9.4"},
                        {stdlib,"ERTS  CXC 138 10","1.17.4"},
                        {kernel,"ERTS  CXC 138 10","2.14.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:
4:4] [rq:4]
 [async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,68521368},
          {processes,10537392},
          {processes_used,10500904},
          {system,57983976},
          {atom,1125249},
          {atom_used,1122051},
          {binary,3123584},
          {code,11235605},
          {ets,2940008}]},
 {vm_memory_high_watermark,0.3999999994293313},
 {vm_memory_limit,420559257}]
...done.


Thanks
Venkat




On Jan 10, 11:27?am, Steve Powell <st... at rabbitmq.com> wrote:
> Hi Venkat,
>
> I'm glad things are better under 2.7.1.
>
> > I have one question, referring tohttp://www.rabbitmq.com/ha.html:
> >> As a result of the requeuing, clients that re-consume from the queue
> >> must be aware that they are likely to subsequently receive messages
> >> that they have seen previously
>
> This is an accurate quote, and is still true. ?Acknowledgements are only sent
> to the master and then copied to the slaves, so the slaves might not know
> about some of them if the master goes down before some acknowledgements can
> be forwarded. ?If you are lucky (and it appears that you are, or else you are
> using auto acknowledgements) then none of the acknowledgements are lost
> (or none are required!).
>
> > You notice that there are two lines displaying 1999, this is because
> > two messages were lost. Otherwise you see 2000 messages processed
> > from each thread.
>
> > From this, does it mean that I don't have to worry about duplicate
> > messages due to requeing?
>
> No, it doesn't mean that. If you have explicit acknowledgements by your
> consumers, then when the master fails the slave may redeliver some messages
> that were acknowledged, as well as the ones that weren't.
>
> What interests me is the messages that are lost. If I understand it
> correctly, messages are published to the master and all the slaves
> simultaneously, so the failure of the master shouldn't lose any messages.
>
> Having said that, you haven't said to which broker your test apps connect.
> If they were connected to the master at the time, then what do they do when
> the master fails? ?Do they automatically reconnect (I presume this is in
> the tests' logs)? Do they resend the last message (which will have failed
> because the connection will have been dropped)?
>
> If they do not resend, then this could be the source of the lost messages
> -- they were not sent in the first place.
>
> Please can you explain just a little more about the test thread connection
> history, and to which broker they are connected? ?I would expect that, if
> they are connected to the slave, then you won't see any lost messages in
> this test scenario.
>
> > I assuming that HA Proxy
> > was not quick enough to detect about the Crashed Node A and thus those
> > 2/3 messages were routed to crashed NodeA. Please correct me if I am
> > wrong.
>
> I don't think this is the problem, as messages are published to all the
> brokers mirroring the queue.
>
> > The other thing that I just wanted to bring it to your attention (it
> > doesn't bother me). It is as follows:
> > I have NodeA in the beginning of the cluster then I join NodeB to the
> > cluster.
> > If I run rabbitmqctl report on NodeA, it throws an error saying that
> > NodeA is down (when it is really not down). But it works fine on
> > NodeB.
>
> This is interesting, too. Can you supply us with the complete output from
> rabbitmqctl status for both nodes, and explain exactly what you mean by
> 'run rabbitmqctl on NodeA'?
>
> Thank you for reporting these issues.
>
> Steve Powell ?(a curious bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 9 Jan 2012, at 23:39, Venkat wrote:
>
> > Hi Steve I have run some tests using RabbitMQ 2.7.1 please find the
> > following:
>
> ...(elided)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From brett.r.cameron at gmail.com  Tue Jan 10 23:54:17 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 11 Jan 2012 12:54:17 +1300
Subject: [rabbitmq-discuss] How to attach C++ library?
In-Reply-To: <1325802578.9799.YahooMailNeo@web44910.mail.sp1.yahoo.com>
References: <1325742123.3702.YahooMailNeo@web44916.mail.sp1.yahoo.com>
	<CALPqkip0awmgkJxeH0saPL2On=ZSap3+arVKX-30rW0bz4BkNA@mail.gmail.com>
	<1325802578.9799.YahooMailNeo@web44910.mail.sp1.yahoo.com>
Message-ID: <CALPqkiq0etuAz6vnNkXLBaWtm=v-9XaJ=vLxyUPGgN4JP1=N4A@mail.gmail.com>

Uday,

I will try to get you a bit of an example in the next day or so that will
hopefully illustrate how this might be done using the C API...

Regards,
Brett

On Fri, Jan 6, 2012 at 11:29 AM, Uday Subbarayan
<uday.subbarayan at yahoo.com>wrote:

> Thanks Brett for the pointer. I am aware of it.
>
> Our C++ server will act both as consumer of the message and also publisher
> of the message. The worker queue model will fit best. These servers are
> workers and will get the task via Rabbit MQ. After completing the task, it
> will post the status back to the queue.
>
> Best,
> -Uday.
>
>   ------------------------------
> *From:* Brett Cameron <brett.r.cameron at gmail.com>
> *To:* Uday Subbarayan <uday.subbarayan at yahoo.com>
> *Cc:* "rabbitmq-discuss at lists.rabbitmq.com" <
> rabbitmq-discuss at lists.rabbitmq.com>
> *Sent:* Wednesday, January 4, 2012 11:48 PM
> *Subject:* Re: [rabbitmq-discuss] How to attach C++ library?
>
> Uday,
>
> You should be able to do this using the C API (
> http://www.rabbitmq.com/c-client.html). What OS are you using? When you
> say that you want to convert the C++ code into a "socket based server",
> will it be acting purely as a consumer of messages (no response), or will
> it be operating in some sort of request/response (RPC) fashion?
>
> Brett
>
>
> On Thu, Jan 5, 2012 at 6:42 PM, Uday Subbarayan <uday.subbarayan at yahoo.com
> > wrote:
>
> Hi All,
>     Happy New Year.
>
> We have a C++ library which is currently used inside a product. We want to
> convert this library in to a socket based server and connect to Rabbit MQ
> so that it can consume & publish messages from the clients.
>
> Has any one done any similar work?
>
> Thanks,
> -Uday.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/0385664b/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Jan 11 00:30:23 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 10 Jan 2012 17:30:23 -0700
Subject: [rabbitmq-discuss] RabbitMQ in Action - Java and .NET
Message-ID: <CAHZAEpfMi4F3_2NyxCfT_X2-ThsF-a_Uxfb9zm97x-CDEeG1QA@mail.gmail.com>

Hi Guys,

The latest MEAP for the book is out. Just wanted to let folks who had
requested Java and .NET coverage know that the new MEAP has a
chapter-length appendix on using both with Rabbit (step-by-step mapping of
some of the earlier examples into Java and .NET). Also, we added an
appendix on installing Rabbit on Windows.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120110/ce42da7e/attachment.htm>

From mspetrovic at gmail.com  Wed Jan 11 00:46:00 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Tue, 10 Jan 2012 16:46:00 -0800
Subject: [rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
In-Reply-To: <CABMnSbH1s5ve5EcO+fR-pv4ZeTNi=ZSWvyRzG-3y45L2O8hpEA@mail.gmail.com>
References: <CABMnSbG=ni64VTsqrE5Q-TktWhznQ3rA9hrje3LnkaHuUB3tYg@mail.gmail.com>
	<CABMnSbH1s5ve5EcO+fR-pv4ZeTNi=ZSWvyRzG-3y45L2O8hpEA@mail.gmail.com>
Message-ID: <CABMnSbGycP7=3EF5fEmCD_YjX1o=wU3pyHbJd5hv_hhUnUYaxg@mail.gmail.com>

I think I have a solution, better than one based on a header exchange
or the scheme I outline below.

It's basically this solution:

http://www.rabbitmq.com/tutorials/tutorial-five-java.html

where the routing keys are the table names.  This gives me a single
consumer queue bound to mulitple routing keys, which gets my job done.



On Tue, Jan 10, 2012 at 2:20 PM, Mark Petrovic <mspetrovic at gmail.com> wrote:
> Talking to myself here (I have no problem with that :-)), I think I
> have at least one solution to this.
>
> - Create a single exchange E
> - The Publisher P creates a channel with a single queue and routing
> key with the same names as the Table T in question.
> - Publisher publishes a message to channel
> - The Consumer C1 iterates over the table names T1 and T2 he cares
> about and binds his channel to queues and routing keys with the same
> name as the table name iterated over
> - The Consumer C1 then starts a thread for each of these queues, and
> whose run() method calls channel.basicConsume(queueName, autoAck,
> rabbitConsumer)
>
> where rabbitConsumer extends com.rabbitmq.client.DefaultConsumer.
>
> While this seems to work, and is a bit easier to understand how to
> program than header exchanges (if a header exchange would even work
> for me - I wonder), I dont' like the thread-per-queue I need to spawn
> to handle messages inbound for each queue.
>
> What would be nice is if I could call channel.basicConsume(autoAck,
> rabbitConsumer), which would read messages off all the queues that
> were bound to that channel.
>
> While I have something working, I'm not yet real thrilled with my
> programming model.
>
> Anybody?
>
> Thanks!
>
> On Tue, Jan 10, 2012 at 10:28 AM, Mark Petrovic <mspetrovic at gmail.com> wrote:
>> Hello.
>>
>> This note is longer than I thought it would be, but I do not believe
>> my situation is complicated.
>>
>> I am a RabbitMQ newcomer and am trying to identify which exchange type
>> to use for my application.
>>
>> I have a publisher P that needs to send messages about database table
>> updates. ?A message will bear the name of a single table name,
>> followed by some opaque application data:
>>
>> Logically,
>>
>> message == tableName | somedata
>>
>> So consider a simplified database with three tables of interest: ?T1,
>> T2, and T3.
>>
>> There are two consumers, C1 and C2.
>>
>> C1 needs to receive all messages concerning tables T1 and T2.
>>
>> C2 needs to receive all messages concerning tables T2 and T3.
>>
>> By implication, C1 and C2 must both receive messages about T2, where
>> their interests overlap.
>>
>> Ideally, I want to publish to a single exchange, and, therefore, my
>> consumers also bind to this same single exchange. ?I say this because
>> in fact there are a lot more than three tables to treat - there are
>> almost 200. ?A proliferation of exchanges per-table would be not good.
>>
>> I am considering a topic or header exchange.
>>
>> If a header exchange, I was thinking of the publisher P putting the
>> concerned table name in a "table header" and the consumers binding to
>> the exchange with an interest in receiving messages with a table
>> header value equal to T1, T2, or T3 (I believe x-match == any would be
>> appropriate when the consumer binds). ?But some of my readings on
>> header exhchanges here
>>
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010935.html
>>
>> suggest that header exchanges may not be as useful as maybe the name
>> suggests. ?Maybe I'm being overly paranoid.
>>
>> And I consider topic exchanges because I know they admit messages
>> about T2 consumed by C1 still being available to C2.
>>
>> Would someone be kind enough to suggest approaches to discern which
>> type of exchange to use.
>>
>> Thank you very kindly.
>>
>> --
>> Mark
>
>
>
> --
> Mark



-- 
Mark

From vveludan at gmail.com  Wed Jan 11 01:22:28 2012
From: vveludan at gmail.com (Venkat)
Date: Tue, 10 Jan 2012 17:22:28 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <03877dc9-66c8-473b-a99a-6f8c8bf4bb59@d10g2000vbh.googlegroups.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
	<0CF971BF-82C1-4D62-BB41-2628875837AE@rabbitmq.com>
	<03877dc9-66c8-473b-a99a-6f8c8bf4bb59@d10g2000vbh.googlegroups.com>
Message-ID: <6ff0e474-a026-449f-994d-f062203175ca@w4g2000vbc.googlegroups.com>

Steve I just wanted to add further notes.
I didn't have to write any reconnectivity mechanism for queue consumer
because spring-amqp provides built-in reconnectivity mechanism in
SimpleMessageListenerContainer.

Thanks
Venkat

On Jan 10, 6:13?pm, Venkat <vvelu... at gmail.com> wrote:
> Hi Steve please find the following:
>
> > If you are lucky (and it appears that you are, or else you are
> > using auto acknowledgements) then none of the acknowledgements are lost
> > (or none are required!).
>
> In my queue consumer there is no acknowledgeMode set.
> SimpleMessageListenerContainer sets the acknowledgeMode as AUTO as
> default if it is not set.
> In other words auto acknowledgment is used.
>
> >If they do not resend, then this could be the source of the lost messages
> > they were not sent in the first place.
>
> The producer may have been connected to crashed Node.
> I have seen two AmqpExceptions in the log.
> I didn't have logic in my producer code to resend the message on
> AmqpException.
> In the catch block I have added the code to resend the message as
> follows:
> ? ? ? ? @Override
> ? ? ? ? public void convertAndSend(final Object message) ?{
> ? ? ? ? ? ? ? ? MessageProperties props = null;
> ? ? ? ? ? ? ? ? try {
> ? ? ? ? ? ? ? ? ? ? ? ? props = new MessageProperties();
> ? ? ? ? ? ? ? ? ? ? ? ? props.setDeliveryMode(MessageDeliveryMode.PERSISTENT); ? //setting
> delivery mode as PERSISTENT
> ? ? ? ? ? ? ? ? ? ? ? ? send(getMessageConverter().toMessage(message, props));
>
> ? ? ? ? ? ? ? ? } catch (AmqpException amqpe) {
> ? ? ? ? ? ? ? ? ? ? ? ? send(getMessageConverter().toMessage(message, props));
> ? ? ? ? ? ? ? ? }
> ? ? ? ? }
>
> After adding the code to resend message on exception, I have rerun the
> test.
> This time there were no messages lost. All 20K messages were
> processed.
> [ecloud at t-3 log]$ grep Thread-0 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-1 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-2 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-3 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-4 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-5 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-6 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-7 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-8 central-log.log | wc -l
> 2000
> [ecloud at t-3 log]$ grep Thread-9 central-log.log | wc -l
> 2000
>
> >This is interesting, too. Can you supply us with the complete output from
> >rabbitmqctl status for both nodes, and explain exactly what you mean by
> >'run rabbitmqctl on NodeA'?
>
> I meant running report.
> This time I have captured all the details.
> In the beginning of the test I had only node t-2.
> Running report command worked fine on t-2 node.
>
> Then I joined t-4 node to the cluster as follows:
>
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl stop_app
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl reset
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster
> rabbit at t-2 rabbit at t-4
>
> Then I ran report command on t-2. Following is the error displayed:
> [ecloud at t-2 vv]$ ?/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/
> rabbitmqctl report > /home/ecloud/vv/rep3.txt
> Error: unable to connect to node 'rabbit at t-2': nodedown
> diagnostics:
> - nodes and their ports on t-2: [{rabbit,19667},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{rabbitmqctl28789,44074}]
> - current node: 'rabbitmqctl28789 at t-2'
> - current node home dir: /home/ecloud
> - current node cookie hash: VLhPX0Ti0bNE//tFwfQQGA==
>
> ?I ran status command on t-2 node:
>
> [ecloud at t-2 vv]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/
> rabbitmqctl -n rabbit at t-2 status
>
> Status of node 'rabbit at t-2' ...
> [{pid,28188},
> ?{running_applications,[{rabbit,"RabbitMQ","2.7.1"},
> ? ? ? ? ? ? ? ? ? ? ? ? {mnesia,"MNESIA ?CXC 138 12","4.4.19"},
> ? ? ? ? ? ? ? ? ? ? ? ? {os_mon,"CPO ?CXC 138 46","2.2.6"},
> ? ? ? ? ? ? ? ? ? ? ? ? {sasl,"SASL ?CXC 138 11","2.1.9.4"},
> ? ? ? ? ? ? ? ? ? ? ? ? {stdlib,"ERTS ?CXC 138 10","1.17.4"},
> ? ? ? ? ? ? ? ? ? ? ? ? {kernel,"ERTS ?CXC 138 10","2.14.4"}]},
> ?{os,{unix,linux}},
> ?{erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [rq:1]
> [async-threads:30] [kernel-poll:true]\n"},
> ?{memory,[{total,60196864},
> ? ? ? ? ? {processes,10386136},
> ? ? ? ? ? {processes_used,10379416},
> ? ? ? ? ? {system,49810728},
> ? ? ? ? ? {atom,1122009},
> ? ? ? ? ? {atom_used,1117604},
> ? ? ? ? ? {binary,69968},
> ? ? ? ? ? {code,11235581},
> ? ? ? ? ? {ets,793680}]},
> ?{vm_memory_high_watermark,0.39999999962067656},
> ?{vm_memory_limit,843607244}]
> ...done.
>
> Following is after running status command on t-4 node:
> [ecloud at t-4 ~]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/
> rabbitmqctl -n rabbit at t-4 status
> Status of node 'rabbit at t-4' ...
> [{pid,22424},
> ?{running_applications,[{rabbit,"RabbitMQ","2.7.1"},
> ? ? ? ? ? ? ? ? ? ? ? ? {os_mon,"CPO ?CXC 138 46","2.2.6"},
> ? ? ? ? ? ? ? ? ? ? ? ? {mnesia,"MNESIA ?CXC 138 12","4.4.19"},
> ? ? ? ? ? ? ? ? ? ? ? ? {sasl,"SASL ?CXC 138 11","2.1.9.4"},
> ? ? ? ? ? ? ? ? ? ? ? ? {stdlib,"ERTS ?CXC 138 10","1.17.4"},
> ? ? ? ? ? ? ? ? ? ? ? ? {kernel,"ERTS ?CXC 138 10","2.14.4"}]},
> ?{os,{unix,linux}},
> ?{erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:
> 4:4] [rq:4]
> ?[async-threads:30] [kernel-poll:true]\n"},
> ?{memory,[{total,68521368},
> ? ? ? ? ? {processes,10537392},
> ? ? ? ? ? {processes_used,10500904},
> ? ? ? ? ? {system,57983976},
> ? ? ? ? ? {atom,1125249},
> ? ? ? ? ? {atom_used,1122051},
> ? ? ? ? ? {binary,3123584},
> ? ? ? ? ? {code,11235605},
> ? ? ? ? ? {ets,2940008}]},
> ?{vm_memory_high_watermark,0.3999999994293313},
> ?{vm_memory_limit,420559257}]
> ...done.
>
> Thanks
> Venkat
>
> On Jan 10, 11:27?am, Steve Powell <st... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > Hi Venkat,
>
> > I'm glad things are better under 2.7.1.
>
> > > I have one question, referring tohttp://www.rabbitmq.com/ha.html:
> > >> As a result of the requeuing, clients that re-consume from the queue
> > >> must be aware that they are likely to subsequently receive messages
> > >> that they have seen previously
>
> > This is an accurate quote, and is still true. ?Acknowledgements are only sent
> > to the master and then copied to the slaves, so the slaves might not know
> > about some of them if the master goes down before some acknowledgements can
> > be forwarded. ?If you are lucky (and it appears that you are, or else you are
> > using auto acknowledgements) then none of the acknowledgements are lost
> > (or none are required!).
>
> > > You notice that there are two lines displaying 1999, this is because
> > > two messages were lost. Otherwise you see 2000 messages processed
> > > from each thread.
>
> > > From this, does it mean that I don't have to worry about duplicate
> > > messages due to requeing?
>
> > No, it doesn't mean that. If you have explicit acknowledgements by your
> > consumers, then when the master fails the slave may redeliver some messages
> > that were acknowledged, as well as the ones that weren't.
>
> > What interests me is the messages that are lost. If I understand it
> > correctly, messages are published to the master and all the slaves
> > simultaneously, so the failure of the master shouldn't lose any messages.
>
> > Having said that, you haven't said to which broker your test apps connect.
> > If they were connected to the master at the time, then what do they do when
> > the master fails? ?Do they automatically reconnect (I presume this is in
> > the tests' logs)? Do they resend the last message (which will have failed
> > because the connection will have been dropped)?
>
> > If they do not resend, then this could be the source of the lost messages
> > -- they were not sent in the first place.
>
> > Please can you explain just a little more about the test thread connection
> > history, and to which broker they are connected? ?I would expect that, if
> > they are connected to the slave, then you won't see any lost messages in
> > this test scenario.
>
> > > I assuming that HA Proxy
> > > was not quick enough to detect about the Crashed Node A and thus those
> > > 2/3 messages were routed to crashed NodeA. Please correct me if I am
> > > wrong.
>
> > I don't think this is the problem, as messages are published to all the
> > brokers mirroring the queue.
>
> > > The other thing that I just wanted to bring it to your attention (it
> > > doesn't bother me). It is as follows:
> > > I have NodeA in the beginning of the cluster then I join NodeB to the
> > > cluster.
> > > If I run rabbitmqctl report on NodeA, it throws an error saying that
> > > NodeA is down (when it is really not down). But it works fine on
> > > NodeB.
>
> > This is interesting, too. Can you supply us with the complete output from
> > rabbitmqctl status for both nodes, and explain exactly what you mean by
> > 'run rabbitmqctl on NodeA'?
>
> > Thank you for reporting these issues.
>
> > Steve Powell ?(a curious bunny)
> > ----------some more definitions from the SPD----------
> > avoirdupois (phr.) 'Would you like peas with that?'
> > distribute (v.) To denigrate an award ceremony.
> > definite (phr.) 'It's hard of hearing, I think.'
> > modest (n.) The most mod.
>
> > On 9 Jan 2012, at 23:39, Venkat wrote:
>
> > > Hi Steve I have run some tests using RabbitMQ 2.7.1 please find the
> > > following:
>
> > ...(elided)
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From brian.newsgroup at gmail.com  Wed Jan 11 01:31:25 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Wed, 11 Jan 2012 12:31:25 +1100
Subject: [rabbitmq-discuss] About exchange bindings
Message-ID: <CALD4NQaWt4QOkquUMkdYVHSLZ-qYcBqFPoHDAsN2JEh8J1bi1w@mail.gmail.com>

Hi there,

RabbitMQ implemented exchange bindings as an extension to the AMQP
protocol. However, I couldn't find detailed documentation about it.

The function is declared as:
def exchange_bind(self, callback=None, ticket=0, destination=None,
source=None, routing_key='', nowait=False, arguments={}):

My questions are:
1. In the function definition, what does the argument "ticket" mean, and
how to use it?
2. What is the set of arguments for "arguments = {}"?

It'd be great if someone could explain with examples. Thanks heaps!

Cheers,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/72a56983/attachment.htm>

From jerryk at vmware.com  Wed Jan 11 01:56:29 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 10 Jan 2012 17:56:29 -0800 (PST)
Subject: [rabbitmq-discuss] About exchange bindings
In-Reply-To: <CALD4NQaWt4QOkquUMkdYVHSLZ-qYcBqFPoHDAsN2JEh8J1bi1w@mail.gmail.com>
Message-ID: <dd5d6e58-f8ba-4648-ba95-580fb1d3c565@StrongMad.local>

Hi, Brian...

Apologies if I'm not quite reading you correctly.  Do you mean
*exchange-to-exchange* bindings as appeared in 2.1.1?  Which 
client(s) are you trying to get them working with?  Your snippet
looks Ruby-ish?

Best regards,
Jerry

----- Original Message -----
From: "Brian Jing" <brian.newsgroup at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, January 10, 2012 5:31:25 PM
Subject: [rabbitmq-discuss] About exchange bindings


Hi there, 

RabbitMQ implemented exchange bindings as an extension to the AMQP protocol. However, I couldn't find detailed documentation about it. 

The function is declared as: 
def exchange_bind(self, callback=None, ticket=0, destination=None, source=None, routing_key='', nowait=False, arguments={}): 

My questions are: 
1. In the function definition, what does the argument "ticket" mean, and how to use it? 
2. What is the set of arguments for "arguments = {}"? 

It'd be great if someone could explain with examples. Thanks heaps! 

Cheers, 

Brian 



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From brian.newsgroup at gmail.com  Wed Jan 11 02:14:32 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Wed, 11 Jan 2012 13:14:32 +1100
Subject: [rabbitmq-discuss] About exchange bindings
In-Reply-To: <dd5d6e58-f8ba-4648-ba95-580fb1d3c565@StrongMad.local>
References: <CALD4NQaWt4QOkquUMkdYVHSLZ-qYcBqFPoHDAsN2JEh8J1bi1w@mail.gmail.com>
	<dd5d6e58-f8ba-4648-ba95-580fb1d3c565@StrongMad.local>
Message-ID: <CALD4NQY0_eMSwFguirX-rnXTZ26gf_iObOhChE6UVgs7UFVcuw@mail.gmail.com>

Hi Jerry,

Thanks for your reply!

And sorry about the confusion. I was talking about exchange to exchange
binding. I'm using Pika (python client lib).

This following code declares two exchanges and bind them together. What I
don't understand is the second argument of the function call
"exchange_bind". It's called "ticket", and is defaulted to 0. Have no idea
what it means, though it works without any problems.

channel.exchange_declare(exchange='broadcast',
                             type='fanout')
channel.exchange_declare(exchange='main',
                             type='direct')
channel.exchange_bind(None, 0, "broadcast", "main", "toABD")

Cheers,

Brian

On Wed, Jan 11, 2012 at 12:56 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Brian...
>
> Apologies if I'm not quite reading you correctly.  Do you mean
> *exchange-to-exchange* bindings as appeared in 2.1.1?  Which
> client(s) are you trying to get them working with?  Your snippet
> looks Ruby-ish?
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Brian Jing" <brian.newsgroup at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, January 10, 2012 5:31:25 PM
> Subject: [rabbitmq-discuss] About exchange bindings
>
>
> Hi there,
>
> RabbitMQ implemented exchange bindings as an extension to the AMQP
> protocol. However, I couldn't find detailed documentation about it.
>
> The function is declared as:
> def exchange_bind(self, callback=None, ticket=0, destination=None,
> source=None, routing_key='', nowait=False, arguments={}):
>
> My questions are:
> 1. In the function definition, what does the argument "ticket" mean, and
> how to use it?
> 2. What is the set of arguments for "arguments = {}"?
>
> It'd be great if someone could explain with examples. Thanks heaps!
>
> Cheers,
>
> Brian
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/1936df28/attachment.htm>

From videlalvaro at gmail.com  Wed Jan 11 09:28:24 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Jan 2012 10:28:24 +0100
Subject: [rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
In-Reply-To: <CABMnSbGycP7=3EF5fEmCD_YjX1o=wU3pyHbJd5hv_hhUnUYaxg@mail.gmail.com>
References: <CABMnSbG=ni64VTsqrE5Q-TktWhznQ3rA9hrje3LnkaHuUB3tYg@mail.gmail.com>
	<CABMnSbH1s5ve5EcO+fR-pv4ZeTNi=ZSWvyRzG-3y45L2O8hpEA@mail.gmail.com>
	<CABMnSbGycP7=3EF5fEmCD_YjX1o=wU3pyHbJd5hv_hhUnUYaxg@mail.gmail.com>
Message-ID: <CAMcAHLW_ezfZYyLoPiwFE7irSdbboyFccoPK56oAeOMbZFhXAg@mail.gmail.com>

Hi Mark,

Yes a topic exchange can be ideal when you need to "listen" based on
several patterns. Also this exchange leaves the possibility open for new
table names,
You just have to think about the binding pattern that you want to use.

Also keep in mind that if you want message X to arrive at consumer A and B
then you need one separate queue per consumer bound to that exchange using
a binding key that matches the routing key used when publishing message X.
What this means is that messages are "fanout'ed" at the exchange, but once
they arrive at a queue then messages are pulled out individually and once
gone from the queue is not seen again.

Cheers,

Alvaro

On Wed, Jan 11, 2012 at 1:46 AM, Mark Petrovic <mspetrovic at gmail.com> wrote:

> I think I have a solution, better than one based on a header exchange
> or the scheme I outline below.
>
> It's basically this solution:
>
> http://www.rabbitmq.com/tutorials/tutorial-five-java.html
>
> where the routing keys are the table names.  This gives me a single
> consumer queue bound to mulitple routing keys, which gets my job done.
>
>
>
> On Tue, Jan 10, 2012 at 2:20 PM, Mark Petrovic <mspetrovic at gmail.com>
> wrote:
> > Talking to myself here (I have no problem with that :-)), I think I
> > have at least one solution to this.
> >
> > - Create a single exchange E
> > - The Publisher P creates a channel with a single queue and routing
> > key with the same names as the Table T in question.
> > - Publisher publishes a message to channel
> > - The Consumer C1 iterates over the table names T1 and T2 he cares
> > about and binds his channel to queues and routing keys with the same
> > name as the table name iterated over
> > - The Consumer C1 then starts a thread for each of these queues, and
> > whose run() method calls channel.basicConsume(queueName, autoAck,
> > rabbitConsumer)
> >
> > where rabbitConsumer extends com.rabbitmq.client.DefaultConsumer.
> >
> > While this seems to work, and is a bit easier to understand how to
> > program than header exchanges (if a header exchange would even work
> > for me - I wonder), I dont' like the thread-per-queue I need to spawn
> > to handle messages inbound for each queue.
> >
> > What would be nice is if I could call channel.basicConsume(autoAck,
> > rabbitConsumer), which would read messages off all the queues that
> > were bound to that channel.
> >
> > While I have something working, I'm not yet real thrilled with my
> > programming model.
> >
> > Anybody?
> >
> > Thanks!
> >
> > On Tue, Jan 10, 2012 at 10:28 AM, Mark Petrovic <mspetrovic at gmail.com>
> wrote:
> >> Hello.
> >>
> >> This note is longer than I thought it would be, but I do not believe
> >> my situation is complicated.
> >>
> >> I am a RabbitMQ newcomer and am trying to identify which exchange type
> >> to use for my application.
> >>
> >> I have a publisher P that needs to send messages about database table
> >> updates.  A message will bear the name of a single table name,
> >> followed by some opaque application data:
> >>
> >> Logically,
> >>
> >> message == tableName | somedata
> >>
> >> So consider a simplified database with three tables of interest:  T1,
> >> T2, and T3.
> >>
> >> There are two consumers, C1 and C2.
> >>
> >> C1 needs to receive all messages concerning tables T1 and T2.
> >>
> >> C2 needs to receive all messages concerning tables T2 and T3.
> >>
> >> By implication, C1 and C2 must both receive messages about T2, where
> >> their interests overlap.
> >>
> >> Ideally, I want to publish to a single exchange, and, therefore, my
> >> consumers also bind to this same single exchange.  I say this because
> >> in fact there are a lot more than three tables to treat - there are
> >> almost 200.  A proliferation of exchanges per-table would be not good.
> >>
> >> I am considering a topic or header exchange.
> >>
> >> If a header exchange, I was thinking of the publisher P putting the
> >> concerned table name in a "table header" and the consumers binding to
> >> the exchange with an interest in receiving messages with a table
> >> header value equal to T1, T2, or T3 (I believe x-match == any would be
> >> appropriate when the consumer binds).  But some of my readings on
> >> header exhchanges here
> >>
> >>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010935.html
> >>
> >> suggest that header exchanges may not be as useful as maybe the name
> >> suggests.  Maybe I'm being overly paranoid.
> >>
> >> And I consider topic exchanges because I know they admit messages
> >> about T2 consumed by C1 still being available to C2.
> >>
> >> Would someone be kind enough to suggest approaches to discern which
> >> type of exchange to use.
> >>
> >> Thank you very kindly.
> >>
> >> --
> >> Mark
> >
> >
> >
> > --
> > Mark
>
>
>
> --
> Mark
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/fb624872/attachment.htm>

From mikeb at rabbitmq.com  Wed Jan 11 09:39:01 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 11 Jan 2012 09:39:01 +0000
Subject: [rabbitmq-discuss] About exchange bindings
In-Reply-To: <CALD4NQaWt4QOkquUMkdYVHSLZ-qYcBqFPoHDAsN2JEh8J1bi1w@mail.gmail.com>
References: <CALD4NQaWt4QOkquUMkdYVHSLZ-qYcBqFPoHDAsN2JEh8J1bi1w@mail.gmail.com>
Message-ID: <4F0D58B5.4060401@rabbitmq.com>

> My questions are:
> 1. In the function definition, what does the argument "ticket" mean, and
> how to use it?

It's a throwback to AMQP 0-8 that was removed in AMQP 0-9-1 (I don't 
know why it's in an API). Just let it default to 0.

> 2. What is the set of arguments for "arguments = {}"?

Generally, none. It's an extension mechanism in AMQP, and usually left 
alone. Aside from vendor extensions, the only reason for ever using it 
is for a binding to a headers exchange, which encodes its match values 
in the 'arguments' field.

-Michael

>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Wed Jan 11 10:53:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Jan 2012 10:53:08 +0000
Subject: [rabbitmq-discuss] Is it possible that group clustering nodes
 shovel/federate with other group clustering nodes
In-Reply-To: <2A2E5FBC-AD23-4CCF-8C8A-5EEC86FAEC88@ll.mit.edu>
References: <2A2E5FBC-AD23-4CCF-8C8A-5EEC86FAEC88@ll.mit.edu>
Message-ID: <4F0D6A14.5030807@rabbitmq.com>

On 10/01/12 20:03, Cao, Yican - 0661 - MITLL wrote:
> I have a crazy idea:

Not crazy at all! Using clustering and federation/shovel together is 
absolutely reasonable.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Gerard.Savage at ncr.com  Wed Jan 11 11:18:14 2012
From: Gerard.Savage at ncr.com (Savage, Gerard)
Date: Wed, 11 Jan 2012 11:18:14 +0000
Subject: [rabbitmq-discuss] rabbitMQ & Erlang on AIX Server
Message-ID: <7C1486751158924084B4221944B1BE1E03789833EA@sgbred210.corp.ncr.com>

Hi,

I would like to run rabbitMQ, and so Erlang R15, on AIX Server. Are there any guide or installation help instructions out there that I can use - or any known problems with this configuration?

thanks

Gerard Savage


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/3c27c0f9/attachment.htm>

From simon at rabbitmq.com  Wed Jan 11 11:30:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Jan 2012 11:30:14 +0000
Subject: [rabbitmq-discuss] ConnectionFactory and load balancing
In-Reply-To: <CAAN_EDor5bQz1xRs_9AGqmFQzmqMAd4mPd1Lz6ZMdQ5Lg_L4OA@mail.gmail.com>
References: <CAAN_EDoxP+qidfB47wwra=3kntXA7Yxbs1ejABs7oLLxe2gomQ@mail.gmail.com>
	<CAAN_EDor5bQz1xRs_9AGqmFQzmqMAd4mPd1Lz6ZMdQ5Lg_L4OA@mail.gmail.com>
Message-ID: <4F0D72C6.3000800@rabbitmq.com>

The cluster will connect consumers to the "master" node anyway. In 
theory it's likely to be more performant if you connect directly to the 
master node, but in practice I suspect the difference would be fairly minor.

Getting load balancing on a mirrored queue doesn't really make much 
sense as a concept since *all* the mirrors need to do *all* the work 
anyway - there's no real load to balance.

Cheers, Simon

On 10/01/12 19:57, Adam Rabung wrote:
> Let me restate :)
>
> Connection.newConnection(Address[]) seems to be the best way, short of
> using HAProxy, to safely attain a connection to a cluster in the
> presence of nodes going down.  When we are mirroring queues across a
> cluster, is it important to connect to the "master" node for a queue, or
> should we randomize the Address[] to achieve some load balancing?
>
> Any feedback appreciated,
> Adam
>
> On Mon, Jan 9, 2012 at 5:03 PM, Adam Rabung <adamrabung at gmail.com
> <mailto:adamrabung at gmail.com>> wrote:
>  > Hi,
>  > I am running an active/active cluster.  The newConnection(Address[])
>  > method of ConnectionFactory takes an array of addresses to try to
>  > connect to, in order.  If I'd like to avoid HAProxy for now, it seems
>  > like it would be wise for me to randomize this array of Addresses
>  > before calling newConnection, to achieve some degree of load
>  > balancing.  Is that a worthwhile approach?
>  > Thank you,
>  > Adam
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Jan 11 11:44:27 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Jan 2012 11:44:27 +0000
Subject: [rabbitmq-discuss] rabbitMQ & Erlang on AIX Server
In-Reply-To: <7C1486751158924084B4221944B1BE1E03789833EA@sgbred210.corp.ncr.com>
References: <7C1486751158924084B4221944B1BE1E03789833EA@sgbred210.corp.ncr.com>
Message-ID: <4F0D761B.7020907@rabbitmq.com>

Hi Gerard,

On 11/01/12 11:18, Savage, Gerard wrote:
> I would like to run rabbitMQ, and so Erlang R15, on AIX Server. Are
> there any guide or installation help instructions out there that I can
> use - or any known problems with this configuration?

You might want to ask this question on the erlang-questions mailing list
as well. I see an AIX question was discussed in Sept 2011:
http://erlang.org/pipermail/erlang-questions/2011-September/060915.html

I'm not aware of any AIX Erlang packages for a sufficiently recent
version of Erlang (R12B3 at the very least, assuming no plugins). This
means you will need to compile Erlang yourself. I've had limited success
doing so on AIX 5.3 but without SMP support, and there seems to be some
sort of deadlock in the terminal IO preventing all the compilers from
working. The main .erl compiler does work though.

If you can get Erlang running then RabbitMQ will run fine. Rabbit
contains the necessary code to detect memory on AIX.

Also see this thread from 2011:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011376.html


-Emile

From dhivya.swaminathan at tcs.com  Wed Jan 11 11:47:14 2012
From: dhivya.swaminathan at tcs.com (Dhivya Swaminathan)
Date: Wed, 11 Jan 2012 17:17:14 +0530
Subject: [rabbitmq-discuss] Rabbitmq persistence on federation
Message-ID: <OF529EDB0A.02A37282-ON65257982.0040BFBC-65257982.0040BFC6@tcs.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/f2a5de74/attachment.htm>

From simon at rabbitmq.com  Wed Jan 11 11:57:16 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Jan 2012 11:57:16 +0000
Subject: [rabbitmq-discuss] Rabbitmq persistence on federation
In-Reply-To: <OF529EDB0A.02A37282-ON65257982.0040BFBC-65257982.0040BFC6@tcs.com>
References: <OF529EDB0A.02A37282-ON65257982.0040BFBC-65257982.0040BFC6@tcs.com>
Message-ID: <4F0D791C.8050000@rabbitmq.com>

On 11/01/12 11:47, Dhivya Swaminathan wrote:
> Hi,

Hi,

> I am new to federation plugin in rabbitmq.From the federation plugin
> release preview it is told--"Queues that bind to a federation exchange
> receive messages that were published to the upstream exchanges (or the
> upstreams' upstreams) as well as messages that are published locally. In
> the event of the network going down, messages will be queued upstream."
>
> My understanding
>
> Upstream exchanges-a set of exchanges each in a remote broker connected
> through WAN to a federated exchange.
> Federation exchange- a local broker which connects with Upstream
> brokers.

Yes.

> Also it contains all the collection of published messages all
> over remote m/c and the local m/c.

No. Federated exchanges (like all AMQP exchanges) do not really 
"contain" any messages.

> If so,if we pass a message from the local broker to a remote broker and
> the connection goes down at that time,persistence of messages will be
> there in local node or in remote node or duplication will occur on both
> nodes.

Well, you've just swapped the definition of "local" and "remote" you 
were using before. Obviously every broker is local to somewhere, which 
is why we use the terms "upstream" and "downstream" instead :-)

A federated exchange will pull in messages from its upstreams (and so we 
would refer to it as the downstream). The messages published to the 
upstream exchange are queued in the upstream broker waiting for the 
downstream exchange to get them. So in the event of the connection going 
down, that's where they'll be.

Note that some messages may be in flight at this point - if so they can 
be duplicated.

> How is mnesia working in Rabbitmq-Federation.

It's not, really. It contains the definitions of the federated exchanges 
(as it does for all the exchanges).

> Also what are the
> downstream exchnages?Is that the local exchange of the local broker?

As mentioned, "local" can be confusing. But when you declare a federated 
exchange, that is the downstream. Does that make sense?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Wed Jan 11 12:34:06 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 11 Jan 2012 12:34:06 +0000
Subject: [rabbitmq-discuss] rabbitMQ & Erlang on AIX Server
In-Reply-To: <4F0D761B.7020907@rabbitmq.com>
References: <7C1486751158924084B4221944B1BE1E03789833EA@sgbred210.corp.ncr.com>
	<4F0D761B.7020907@rabbitmq.com>
Message-ID: <CACOPnvfogg61XpjxbY=mAyvCqp5zBFd09T6aKOa9echZPL+w1Q@mail.gmail.com>

I have bcc'd people who have successfully run Rabbit & Erlang on AIX.
They may be able to comment...

alexis


On Wed, Jan 11, 2012 at 11:44 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Gerard,
>
> On 11/01/12 11:18, Savage, Gerard wrote:
>> I would like to run rabbitMQ, and so Erlang R15, on AIX Server. Are
>> there any guide or installation help instructions out there that I can
>> use - or any known problems with this configuration?
>
> You might want to ask this question on the erlang-questions mailing list
> as well. I see an AIX question was discussed in Sept 2011:
> http://erlang.org/pipermail/erlang-questions/2011-September/060915.html
>
> I'm not aware of any AIX Erlang packages for a sufficiently recent
> version of Erlang (R12B3 at the very least, assuming no plugins). This
> means you will need to compile Erlang yourself. I've had limited success
> doing so on AIX 5.3 but without SMP support, and there seems to be some
> sort of deadlock in the terminal IO preventing all the compilers from
> working. The main .erl compiler does work though.
>
> If you can get Erlang running then RabbitMQ will run fine. Rabbit
> contains the necessary code to detect memory on AIX.
>
> Also see this thread from 2011:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011376.html
>
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dhivya.swaminathan at tcs.com  Wed Jan 11 14:38:55 2012
From: dhivya.swaminathan at tcs.com (Dhivya Swaminathan)
Date: Wed, 11 Jan 2012 20:08:55 +0530
Subject: [rabbitmq-discuss] Fw: Rabbitmq persistence on federation
Message-ID: <OF96A46802.99DD2D66-ON65257982.005077D7-65257982.005077E0@tcs.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/40fe2c62/attachment.htm>

From mspetrovic at gmail.com  Wed Jan 11 15:09:45 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Wed, 11 Jan 2012 07:09:45 -0800
Subject: [rabbitmq-discuss] Newcomer to Rabbit seeks exchange-type advice
In-Reply-To: <CAMcAHLW_ezfZYyLoPiwFE7irSdbboyFccoPK56oAeOMbZFhXAg@mail.gmail.com>
References: <CABMnSbG=ni64VTsqrE5Q-TktWhznQ3rA9hrje3LnkaHuUB3tYg@mail.gmail.com>
	<CABMnSbH1s5ve5EcO+fR-pv4ZeTNi=ZSWvyRzG-3y45L2O8hpEA@mail.gmail.com>
	<CABMnSbGycP7=3EF5fEmCD_YjX1o=wU3pyHbJd5hv_hhUnUYaxg@mail.gmail.com>
	<CAMcAHLW_ezfZYyLoPiwFE7irSdbboyFccoPK56oAeOMbZFhXAg@mail.gmail.com>
Message-ID: <CABMnSbEzdqDxEuxKSZcUuYeE7M_Ltwx4=YNY_14M8hb1C-jkJg@mail.gmail.com>

Thank you, Alvaro.

Yes, I discovered that each consumer must have its own uniquely-named
queue.  I originally derived that queue name using a 128-bit UUID, but
discovered later that if I pass an empty string for the queue name in
the queue-declare, the server will generate a unique queue name for
me.  Perfect.

I appreciate your kind response.

I just downloaded the latest MEAP version of your book.  It's a
wonderful resource.  Thank you!

Mark

On Wed, Jan 11, 2012 at 1:28 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi Mark,
>
> Yes a topic exchange can be ideal when you need to "listen" based on several
> patterns. Also this exchange leaves the possibility open for new table
> names,
> You just have to think about the binding pattern that you want to use.
>
> Also keep in mind that if you want message X to arrive at consumer A and B
> then you need one separate queue per consumer bound to that exchange using a
> binding key that matches the routing key used when publishing message X.
> What this means is that messages are "fanout'ed" at the exchange, but once
> they arrive at a queue then messages are pulled out individually and once
> gone from the queue is not seen again.
>
> Cheers,
>
> Alvaro
>
> On Wed, Jan 11, 2012 at 1:46 AM, Mark Petrovic <mspetrovic at gmail.com> wrote:
>>
>> I think I have a solution, better than one based on a header exchange
>> or the scheme I outline below.
>>
>> It's basically this solution:
>>
>> http://www.rabbitmq.com/tutorials/tutorial-five-java.html
>>
>> where the routing keys are the table names. ?This gives me a single
>> consumer queue bound to mulitple routing keys, which gets my job done.
>>
>>
>>
>> On Tue, Jan 10, 2012 at 2:20 PM, Mark Petrovic <mspetrovic at gmail.com>
>> wrote:
>> > Talking to myself here (I have no problem with that :-)), I think I
>> > have at least one solution to this.
>> >
>> > - Create a single exchange E
>> > - The Publisher P creates a channel with a single queue and routing
>> > key with the same names as the Table T in question.
>> > - Publisher publishes a message to channel
>> > - The Consumer C1 iterates over the table names T1 and T2 he cares
>> > about and binds his channel to queues and routing keys with the same
>> > name as the table name iterated over
>> > - The Consumer C1 then starts a thread for each of these queues, and
>> > whose run() method calls channel.basicConsume(queueName, autoAck,
>> > rabbitConsumer)
>> >
>> > where rabbitConsumer extends com.rabbitmq.client.DefaultConsumer.
>> >
>> > While this seems to work, and is a bit easier to understand how to
>> > program than header exchanges (if a header exchange would even work
>> > for me - I wonder), I dont' like the thread-per-queue I need to spawn
>> > to handle messages inbound for each queue.
>> >
>> > What would be nice is if I could call channel.basicConsume(autoAck,
>> > rabbitConsumer), which would read messages off all the queues that
>> > were bound to that channel.
>> >
>> > While I have something working, I'm not yet real thrilled with my
>> > programming model.
>> >
>> > Anybody?
>> >
>> > Thanks!
>> >
>> > On Tue, Jan 10, 2012 at 10:28 AM, Mark Petrovic <mspetrovic at gmail.com>
>> > wrote:
>> >> Hello.
>> >>
>> >> This note is longer than I thought it would be, but I do not believe
>> >> my situation is complicated.
>> >>
>> >> I am a RabbitMQ newcomer and am trying to identify which exchange type
>> >> to use for my application.
>> >>
>> >> I have a publisher P that needs to send messages about database table
>> >> updates. ?A message will bear the name of a single table name,
>> >> followed by some opaque application data:
>> >>
>> >> Logically,
>> >>
>> >> message == tableName | somedata
>> >>
>> >> So consider a simplified database with three tables of interest: ?T1,
>> >> T2, and T3.
>> >>
>> >> There are two consumers, C1 and C2.
>> >>
>> >> C1 needs to receive all messages concerning tables T1 and T2.
>> >>
>> >> C2 needs to receive all messages concerning tables T2 and T3.
>> >>
>> >> By implication, C1 and C2 must both receive messages about T2, where
>> >> their interests overlap.
>> >>
>> >> Ideally, I want to publish to a single exchange, and, therefore, my
>> >> consumers also bind to this same single exchange. ?I say this because
>> >> in fact there are a lot more than three tables to treat - there are
>> >> almost 200. ?A proliferation of exchanges per-table would be not good.
>> >>
>> >> I am considering a topic or header exchange.
>> >>
>> >> If a header exchange, I was thinking of the publisher P putting the
>> >> concerned table name in a "table header" and the consumers binding to
>> >> the exchange with an interest in receiving messages with a table
>> >> header value equal to T1, T2, or T3 (I believe x-match == any would be
>> >> appropriate when the consumer binds). ?But some of my readings on
>> >> header exhchanges here
>> >>
>> >>
>> >> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010935.html
>> >>
>> >> suggest that header exchanges may not be as useful as maybe the name
>> >> suggests. ?Maybe I'm being overly paranoid.
>> >>
>> >> And I consider topic exchanges because I know they admit messages
>> >> about T2 consumed by C1 still being available to C2.
>> >>
>> >> Would someone be kind enough to suggest approaches to discern which
>> >> type of exchange to use.
>> >>
>> >> Thank you very kindly.
>> >>
>> >> --
>> >> Mark
>> >
>> >
>> >
>> > --
>> > Mark
>>
>>
>>
>> --
>> Mark
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Mark

From ak4u2009 at gmail.com  Wed Jan 11 15:27:34 2012
From: ak4u2009 at gmail.com (Aamir Khan)
Date: Wed, 11 Jan 2012 20:57:34 +0530
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
Message-ID: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>

Hi,

I am working on a web application in which lots of users can send message
to a central server. This central server will push message to all the users
based on topic based filtering. This can be easily accomplished by using
rabbitMQ. I am using Tornado web server for non blocking asynchronously
pushing the messages to clients with rabbitMQ as middle ware for the
message queuing. My point lies in that i also need to store each message
into database so as to keep record of each. Since the messages won't be
very structured data so i am planning to have noSQL storage. Can somebody
please suggest some documentation where rabbitMQ is used in addition to
database storage ?

Well, i also read that i can use Redis Pub/Sub to have this feature of
subscribe and publish model, so i am quite confused whether to go for
rabbitMQ ?

Any suggestions are most welcome.


-- 
Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/d2846609/attachment.htm>

From alexis at rabbitmq.com  Wed Jan 11 15:43:31 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 11 Jan 2012 15:43:31 +0000
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
References: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
Message-ID: <CACOPnvff9Bgvjq6P0hO9H0i-iXUtONmjf7kUH3F0qYksFiB+-w@mail.gmail.com>

What kind of storage do you want to use, and for what use cases?

On Wed, Jan 11, 2012 at 3:27 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
> Hi,
>
> I am working on a web application in which lots of users can send message to
> a central server. This central server will push message to all the users
> based on topic based filtering. This can be easily accomplished by using
> rabbitMQ. I am using Tornado web server for non blocking asynchronously
> pushing the messages to clients with rabbitMQ as middle ware for the message
> queuing.?My point lies in that i also need to store each message into
> database so as to keep record of each. Since the messages won't be very
> structured data so i am planning to have noSQL storage. Can somebody please
> suggest some documentation where rabbitMQ is used in addition to database
> storage ?
>
> Well, i also read that i can use Redis Pub/Sub to have this feature of
> subscribe and publish model, so i am quite confused whether to go for
> rabbitMQ ?
>
> Any suggestions are most welcome.
>
>
> --
> Aamir Khan |?3rd?Year ?|?Computer Science & Engineering?|?IIT Roorkee
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From michael.s.klishin at gmail.com  Wed Jan 11 15:50:31 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 Jan 2012 19:50:31 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.9.0 is released
Message-ID: <F456DC7B-9D80-4B6E-B904-B39900365F68@gmail.com>

amqp gem 0.9.0 is released to rubygems.org [1]. There were no changes between 0.9.0.pre3 and 0.9.0 final.
This release is completely backwards compatible with 0.8.x releases, all users are encouraged to upgrade.

== Bug fixes

* :default_routing_key value is now respected by AMQP::Exchange#initialize and AMQP::Exchange#publish. This is a rarely used feature but we saw one project relying on it, so it is now supported again.


== New features

* Automatic recovery mode [2] now works for publishers, see [3] and [4] for examples.


== CI status

Passing against every Ruby under the sun:

http://travis-ci.org/#!/ruby-amqp/amqp/builds/507046
http://travis-ci.org/#!/ruby-amqp/amq-client/builds/506918
http://travis-ci.org/#!/ruby-amqp/amq-protocol/builds/506862


== Next version

Next version will be 1.0. Here's what we have in mind for it:

 * Separate publisher entities that will automatically use publisher confirms.
 * Exchange to exchange binding support (the only RabbitMQ-specific extension amqp gem still does not support)
 * Finish and document Ruby on Rails integration.
 * Documentation guide updates (see http://rubyamqp.info)
 * Features and public API methods deprecated in 0.8.0 will be *removed completely*.
 * Automated interoperability test suite (at least with Java and JVM-based clients like Hot Bunnies [5] and Langohr [6])


Have a good day.

1. https://rubygems.org/gems/amqp/versions/0.9.0
2. http://rubyamqp.info/articles/error_handling/#automatic_recovery
3. https://github.com/ruby-amqp/amqp/blob/master/examples/error_handling/hello_world_producer.rb
4. https://github.com/ruby-amqp/amqp/blob/master/examples/error_handling/automatically_recovering_hello_world_consumer.rb
5. https://github.com/ruby-amqp/hot_bunnies
6. https://github.com/michaelklishin/langohr

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From majek04 at gmail.com  Wed Jan 11 16:01:00 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 11 Jan 2012 16:01:00 +0000
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
References: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
Message-ID: <CABzX+qwshGM6fr7QhH6sfupwjQvB51NYqZBmDChS7KTZb5oVzQ@mail.gmail.com>

On Wed, Jan 11, 2012 at 15:27, Aamir Khan <ak4u2009 at gmail.com> wrote:
> I am working on a web application in which lots of users can send message to
> a central server. This central server will push message to all the users
> based on topic based filtering. This can be easily accomplished by using
> rabbitMQ. I am using Tornado web server for non blocking asynchronously
> pushing the messages to clients with rabbitMQ as middle ware for the message
> queuing.?My point lies in that i also need to store each message into
> database so as to keep record of each. Since the messages won't be very
> structured data so i am planning to have noSQL storage. Can somebody please
> suggest some documentation where rabbitMQ is used in addition to database
> storage ?

Take a look at RabbitMQ tutorials:
    http://www.rabbitmq.com/getstarted.html

Database - well, that's your choice :)

> Well, i also read that i can use Redis Pub/Sub to have this feature of
> subscribe and publish model, so i am quite confused whether to go for
> rabbitMQ ?
>
> Any suggestions are most welcome.

You definetely should take a look at SockJS:
   https://github.com/sockjs/
and sockjs-tornado server:
   https://github.com/MrJoes/sockjs-tornado

Cheers,
  Marek

From ak4u2009 at gmail.com  Wed Jan 11 16:00:59 2012
From: ak4u2009 at gmail.com (Aamir Khan)
Date: Wed, 11 Jan 2012 21:30:59 +0530
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <CACOPnvff9Bgvjq6P0hO9H0i-iXUtONmjf7kUH3F0qYksFiB+-w@mail.gmail.com>
References: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
	<CACOPnvff9Bgvjq6P0hO9H0i-iXUtONmjf7kUH3F0qYksFiB+-w@mail.gmail.com>
Message-ID: <CA+PaLXLiSiieoJ++Y6yMVSo0XrZYDDYH5O4E66FjmpcWv7CsGA@mail.gmail.com>

Well, There are two situations for the application.

1. When there is a live QA session going on, so everybody can ask question
and we have to just push the questions to all the subscribers using the
messaging middle ware. In case we are getting questions at a very high
frequency then we will have a buffer and send questions to subscribers
after certain period of time in order to avoid the confusion because of too
much questions.

2. There is no live session going on and you can't ask any question, but
can just browse through the talk that happened in the past.

I hope i have mentioned clearly what i am trying to build. Please give your
valuable suggestions how should i go about it ?


On Wed, Jan 11, 2012 at 9:13 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> What kind of storage do you want to use, and for what use cases?
>
> On Wed, Jan 11, 2012 at 3:27 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
> > Hi,
> >
> > I am working on a web application in which lots of users can send
> message to
> > a central server. This central server will push message to all the users
> > based on topic based filtering. This can be easily accomplished by using
> > rabbitMQ. I am using Tornado web server for non blocking asynchronously
> > pushing the messages to clients with rabbitMQ as middle ware for the
> message
> > queuing. My point lies in that i also need to store each message into
> > database so as to keep record of each. Since the messages won't be very
> > structured data so i am planning to have noSQL storage. Can somebody
> please
> > suggest some documentation where rabbitMQ is used in addition to database
> > storage ?
> >
> > Well, i also read that i can use Redis Pub/Sub to have this feature of
> > subscribe and publish model, so i am quite confused whether to go for
> > rabbitMQ ?
> >
> > Any suggestions are most welcome.
> >
> >
> > --
> > Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>



-- 
Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/bc0564b1/attachment.htm>

From alexis at rabbitmq.com  Wed Jan 11 16:04:23 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 11 Jan 2012 16:04:23 +0000
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <CA+PaLXLiSiieoJ++Y6yMVSo0XrZYDDYH5O4E66FjmpcWv7CsGA@mail.gmail.com>
References: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
	<CACOPnvff9Bgvjq6P0hO9H0i-iXUtONmjf7kUH3F0qYksFiB+-w@mail.gmail.com>
	<CA+PaLXLiSiieoJ++Y6yMVSo0XrZYDDYH5O4E66FjmpcWv7CsGA@mail.gmail.com>
Message-ID: <CACOPnveHrXf_p5i4dqk96f44qhLnzfyPkaw5oToveaXZ8eoavg@mail.gmail.com>

Aamir

You can do 1 using RabbitMQ, because it lets you combine pubsub with
durable buffers (aka "queues").

You can do 2 by adding an archiving process as a subscriber to the firehose.

alexis


On Wed, Jan 11, 2012 at 4:00 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
> Well, There are two situations for the application.
>
> 1. When there is a live QA session going on, so everybody can ask question
> and we have to just push the questions to all the subscribers using the
> messaging middle ware. In case we are getting questions at a very high
> frequency then we will have a buffer and send questions to subscribers after
> certain period of time in order to avoid the confusion because of too much
> questions.
>
> 2. There is no live session going on and you can't ask any question, but can
> just browse through the talk that happened in the past.
>
> I hope i have mentioned clearly what i am trying to build. Please give your
> valuable suggestions how should i go about it ?
>
>
> On Wed, Jan 11, 2012 at 9:13 PM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> What kind of storage do you want to use, and for what use cases?
>>
>> On Wed, Jan 11, 2012 at 3:27 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
>> > Hi,
>> >
>> > I am working on a web application in which lots of users can send
>> > message to
>> > a central server. This central server will push message to all the users
>> > based on topic based filtering. This can be easily accomplished by using
>> > rabbitMQ. I am using Tornado web server for non blocking asynchronously
>> > pushing the messages to clients with rabbitMQ as middle ware for the
>> > message
>> > queuing.?My point lies in that i also need to store each message into
>> > database so as to keep record of each. Since the messages won't be very
>> > structured data so i am planning to have noSQL storage. Can somebody
>> > please
>> > suggest some documentation where rabbitMQ is used in addition to
>> > database
>> > storage ?
>> >
>> > Well, i also read that i can use Redis Pub/Sub to have this feature of
>> > subscribe and publish model, so i am quite confused whether to go for
>> > rabbitMQ ?
>> >
>> > Any suggestions are most welcome.
>> >
>> >
>> > --
>> > Aamir Khan |?3rd?Year ?|?Computer Science & Engineering?|?IIT Roorkee
>> >
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>
>
>
> --
> Aamir Khan |?3rd?Year ?|?Computer Science & Engineering?|?IIT Roorkee
>
>

From jerryk at vmware.com  Wed Jan 11 16:09:32 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 11 Jan 2012 08:09:32 -0800 (PST)
Subject: [rabbitmq-discuss] Is it possible that group clustering nodes
	shovel/federate with other group clustering nodes
In-Reply-To: <42647A1D-556D-4F21-9C32-1DB0E780DDBC@ll.mit.edu>
Message-ID: <fc508609-5c50-4fcd-9f6f-b977851d1f45@StrongMad.local>

Hi, Yican:

There are very clear and friendly discussions of setting up clusters and shovel
in this book, of which a preview eBook edition is currently available (the print
book should hit the stands sometime around March):

http://www.manning.com/videla/

It does not, however, cover the Federation plugin.  For that you'll have to look
at the Rabbit web site.

The following links are from RabbitMQ's own web site:

For clustering Rabbit:  http://www.rabbitmq.com/clustering.html

For Federation:  http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/

And for Shovel:  http://hg.rabbitmq.com/rabbitmq-shovel/file/default/README

It might require a bit more thought about your specific application to clinch 
the decision between Federation and Shovel.

Best regards,
Jerry

----- Original Message -----
From: "Yican Cao - 0661 - MITLL" <cao at ll.mit.edu>
To: "Jerry Kuch" <jerryk at vmware.com>
Sent: Wednesday, January 11, 2012 6:31:42 AM
Subject: Re: [rabbitmq-discuss] Is it possible that group clustering nodes shovel/federate with other group clustering nodes

Hi Jerry,

Thanks for answer my email promptly.
Yes, you're correct. That is exactly what I try to do.

Is there any example or document I can follow?
Thanks.

Yican


On Jan 10, 2012, at 8:20 PM, Jerry Kuch wrote:

> Hi, Yican...
> 
> If I understand your intentions correctly, you're proposing a use
> case that's quite commonly done, namely the clustering of nodes within
> a geographic location for increasing throughput, or perhaps HA, and
> then setting up Federation or Shovel to span the long hauls between
> your geographic locations.  This, plus judiciously picking which messages
> you plan to move between sites is the essence of the sort of WAN 
> distribution you're after.
> 
> Best regards,
> Jerry
> 
> ----- Original Message -----
> From: "Yican Cao - 0661 - MITLL" <cao at ll.mit.edu>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, January 10, 2012 12:03:44 PM
> Subject: [rabbitmq-discuss] Is it possible that group clustering nodes shovel/federate with other group clustering nodes
> 
> Hi,
> 
> I have a crazy idea: 
> 1. clustering 3 nodes with HAQ (highly available queue) as group A.
> 2. clustering other 2 nodes with HAQ as group B.
> 3. federating/shoveling group A and group B with 1 or 2 exchange.
> 
> Group A and B will connect via WAN, so clustering is not recommended by RabbitMQ.
> 
> Is it possible? If so, has anyone done this? 
> Thanks a lot.
> 
> 
> Yican Cao
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From michael.s.klishin at gmail.com  Wed Jan 11 16:09:36 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 Jan 2012 20:09:36 +0400
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <CABzX+qwshGM6fr7QhH6sfupwjQvB51NYqZBmDChS7KTZb5oVzQ@mail.gmail.com>
References: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
	<CABzX+qwshGM6fr7QhH6sfupwjQvB51NYqZBmDChS7KTZb5oVzQ@mail.gmail.com>
Message-ID: <90EC297D-20B6-49D1-BDAA-E1609B914321@gmail.com>

Marek Majkowski:

> Take a look at RabbitMQ tutorials:
>    http://www.rabbitmq.com/getstarted.html

And maybe also

http://rubyamqp.info/articles/amqp_9_1_model_explained
http://rubyamqp.info/articles/getting_started/

(those guides are not really specific to Ruby or particular client). They will give you an idea of key RabbitMQ features and whether they fit your use case.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From jon at jbrisbin.com  Wed Jan 11 16:21:49 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 11 Jan 2012 10:21:49 -0600 (CST)
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <d23dc883-eb80-4a6a-b7d4-97aaf6e4a6ca@jbrisbin.local>
Message-ID: <76ac55cd-3c62-40fc-8ca5-645a2199cbc8@jbrisbin.local>

Aamir, 

If you're thinking about using Riak, I wrote a custom exchange plugin for RabbitMQ that does exactly what you're talking about: it stores every message sent to that exchange in Riak. 

There's a corresponding component that you can install into Riak to send AMQP messages out whenever data is updated (it's a postcommit hook). 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Alexis Richardson" <alexis at rabbitmq.com>
> To: "Aamir Khan" <ak4u2009 at gmail.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, January 11, 2012 9:43:31 AM
> Subject: Re: [rabbitmq-discuss] Suggestion - Simple Pub/Sub

> What kind of storage do you want to use, and for what use cases?

> On Wed, Jan 11, 2012 at 3:27 PM, Aamir Khan <ak4u2009 at gmail.com>
> wrote:
> > Hi,
> >
> > I am working on a web application in which lots of users can send
> > message to
> > a central server. This central server will push message to all the
> > users
> > based on topic based filtering. This can be easily accomplished by
> > using
> > rabbitMQ. I am using Tornado web server for non blocking
> > asynchronously
> > pushing the messages to clients with rabbitMQ as middle ware for
> > the message
> > queuing. My point lies in that i also need to store each message
> > into
> > database so as to keep record of each. Since the messages won't be
> > very
> > structured data so i am planning to have noSQL storage. Can
> > somebody please
> > suggest some documentation where rabbitMQ is used in addition to
> > database
> > storage ?
> >
> > Well, i also read that i can use Redis Pub/Sub to have this feature
> > of
> > subscribe and publish model, so i am quite confused whether to go
> > for
> > rabbitMQ ?
> >
> > Any suggestions are most welcome.
> >
> >
> > --
> > Aamir Khan | 3rd Year | Computer Science & Engineering | IIT
> > Roorkee
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/9f896d79/attachment.htm>

From jon at jbrisbin.com  Wed Jan 11 16:22:27 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 11 Jan 2012 10:22:27 -0600 (CST)
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <CACOPnvff9Bgvjq6P0hO9H0i-iXUtONmjf7kUH3F0qYksFiB+-w@mail.gmail.com>
Message-ID: <0f570d7b-4a71-4894-a434-3a7e48b16564@jbrisbin.local>

I think I forgot to include the link in that last email! Oops ;) 

https://github.com/jbrisbin/riak-exchange 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Alexis Richardson" <alexis at rabbitmq.com>
> To: "Aamir Khan" <ak4u2009 at gmail.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, January 11, 2012 9:43:31 AM
> Subject: Re: [rabbitmq-discuss] Suggestion - Simple Pub/Sub

> What kind of storage do you want to use, and for what use cases?

> On Wed, Jan 11, 2012 at 3:27 PM, Aamir Khan <ak4u2009 at gmail.com>
> wrote:
> > Hi,
> >
> > I am working on a web application in which lots of users can send
> > message to
> > a central server. This central server will push message to all the
> > users
> > based on topic based filtering. This can be easily accomplished by
> > using
> > rabbitMQ. I am using Tornado web server for non blocking
> > asynchronously
> > pushing the messages to clients with rabbitMQ as middle ware for
> > the message
> > queuing. My point lies in that i also need to store each message
> > into
> > database so as to keep record of each. Since the messages won't be
> > very
> > structured data so i am planning to have noSQL storage. Can
> > somebody please
> > suggest some documentation where rabbitMQ is used in addition to
> > database
> > storage ?
> >
> > Well, i also read that i can use Redis Pub/Sub to have this feature
> > of
> > subscribe and publish model, so i am quite confused whether to go
> > for
> > rabbitMQ ?
> >
> > Any suggestions are most welcome.
> >
> >
> > --
> > Aamir Khan | 3rd Year | Computer Science & Engineering | IIT
> > Roorkee
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/96ebdd80/attachment.htm>

From ozhurakousky at vmware.com  Wed Jan 11 16:36:58 2012
From: ozhurakousky at vmware.com (Oleg Zhurakousky)
Date: Wed, 11 Jan 2012 08:36:58 -0800 (PST)
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <76ac55cd-3c62-40fc-8ca5-645a2199cbc8@jbrisbin.local>
Message-ID: <9b4f6ef1-763b-4e2c-8840-1b4f09a5f273@oleg-2.local>

Aamir

If your webapp is Java-based you can also look at Spring Integration http://www.springsource.org/spring-integration framework which provides simple interfacing to both Rabbit via AMQP adapters/channels - http://static.springsource.org/spring-integration/reference/htmlsingle/#amqp and Redis MessageStore and pub-sub channel - http://static.springsource.org/spring-integration/reference/htmlsingle/#redis

The interesting thing here is that you may end up with a hybrid solution where Messages may need be stored before and after they are sent to other subscribers. This is where patterns such as Claim Check comes really handy http://www.eaipatterns.com/StoreInLibrary.html. This way you can have something like this:

(producer) -> store message(any supported datastore) - send(AMQP) . . . . receive(AMQP)(consumer) -> store-message . . . .etc.

The above could be easily assembled with Spring INtegration and you'll have a choice of data-stores (e.g., JDBC, Redis, Mongo etc.)

Cheers
Oleg

----- Original Message -----
From: "Jon Brisbin" <jon at jbrisbin.com>
To: "Alexis Richardson" <alexis at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 11:21:49 AM
Subject: Re: [rabbitmq-discuss] Suggestion - Simple Pub/Sub



Aamir, 

If you're thinking about using Riak, I wrote a custom exchange plugin for RabbitMQ that does exactly what you're talking about: it stores every message sent to that exchange in Riak. 

There's a corresponding component that you can install into Riak to send AMQP messages out whenever data is updated (it's a postcommit hook). 



Thanks! 

Jon Brisbin 
http//jbrisbin.com 




From: "Alexis Richardson" <alexis at rabbitmq.com> 
To: "Aamir Khan" <ak4u2009 at gmail.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Wednesday, January 11, 2012 9:43:31 AM 
Subject: Re: [rabbitmq-discuss] Suggestion - Simple Pub/Sub 

What kind of storage do you want to use, and for what use cases? 

On Wed, Jan 11, 2012 at 3:27 PM, Aamir Khan <ak4u2009 at gmail.com> wrote: 
> Hi, 
> 
> I am working on a web application in which lots of users can send message to 
> a central server. This central server will push message to all the users 
> based on topic based filtering. This can be easily accomplished by using 
> rabbitMQ. I am using Tornado web server for non blocking asynchronously 
> pushing the messages to clients with rabbitMQ as middle ware for the message 
> queuing. My point lies in that i also need to store each message into 
> database so as to keep record of each. Since the messages won't be very 
> structured data so i am planning to have noSQL storage. Can somebody please 
> suggest some documentation where rabbitMQ is used in addition to database 
> storage ? 
> 
> Well, i also read that i can use Redis Pub/Sub to have this feature of 
> subscribe and publish model, so i am quite confused whether to go for 
> rabbitMQ ? 
> 
> Any suggestions are most welcome. 
> 
> 
> -- 
> Aamir Khan | 3rd Year | Computer Science & Engineering | IIT Roorkee 
> 
> 
> 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> rabbitmq-discuss at lists.rabbitmq.com 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
> 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ak4u2009 at gmail.com  Wed Jan 11 17:24:57 2012
From: ak4u2009 at gmail.com (Aamir Khan)
Date: Wed, 11 Jan 2012 22:54:57 +0530
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <CACOPnveHrXf_p5i4dqk96f44qhLnzfyPkaw5oToveaXZ8eoavg@mail.gmail.com>
References: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
	<CACOPnvff9Bgvjq6P0hO9H0i-iXUtONmjf7kUH3F0qYksFiB+-w@mail.gmail.com>
	<CA+PaLXLiSiieoJ++Y6yMVSo0XrZYDDYH5O4E66FjmpcWv7CsGA@mail.gmail.com>
	<CACOPnveHrXf_p5i4dqk96f44qhLnzfyPkaw5oToveaXZ8eoavg@mail.gmail.com>
Message-ID: <CA+PaLXKcEBn5j36U45fguCM99KBAvhTwtL9BroORwDdWDESe=g@mail.gmail.com>

There will be many users and topics. For simplicity lets call users as U1,
U2, U3 and topic as T1, T2. Now any user can publish and subscribe to any
topic after authentication mechanism. So, what i understood by examples is
that i should create create queues for each (user,topic) combination. In
exchange we write the logic if the message is to be sent to T1 then all the
queues with T1 as topic should get that message. Am i on correct path ?

On Wed, Jan 11, 2012 at 9:34 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Aamir
>
> You can do 1 using RabbitMQ, because it lets you combine pubsub with
> durable buffers (aka "queues").
>
> You can do 2 by adding an archiving process as a subscriber to the
> firehose.
>
> alexis
>
>
> On Wed, Jan 11, 2012 at 4:00 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
> > Well, There are two situations for the application.
> >
> > 1. When there is a live QA session going on, so everybody can ask
> question
> > and we have to just push the questions to all the subscribers using the
> > messaging middle ware. In case we are getting questions at a very high
> > frequency then we will have a buffer and send questions to subscribers
> after
> > certain period of time in order to avoid the confusion because of too
> much
> > questions.
> >
> > 2. There is no live session going on and you can't ask any question, but
> can
> > just browse through the talk that happened in the past.
> >
> > I hope i have mentioned clearly what i am trying to build. Please give
> your
> > valuable suggestions how should i go about it ?
> >
> >
> > On Wed, Jan 11, 2012 at 9:13 PM, Alexis Richardson <alexis at rabbitmq.com>
> > wrote:
> >>
> >> What kind of storage do you want to use, and for what use cases?
> >>
> >> On Wed, Jan 11, 2012 at 3:27 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
> >> > Hi,
> >> >
> >> > I am working on a web application in which lots of users can send
> >> > message to
> >> > a central server. This central server will push message to all the
> users
> >> > based on topic based filtering. This can be easily accomplished by
> using
> >> > rabbitMQ. I am using Tornado web server for non blocking
> asynchronously
> >> > pushing the messages to clients with rabbitMQ as middle ware for the
> >> > message
> >> > queuing. My point lies in that i also need to store each message into
> >> > database so as to keep record of each. Since the messages won't be
> very
> >> > structured data so i am planning to have noSQL storage. Can somebody
> >> > please
> >> > suggest some documentation where rabbitMQ is used in addition to
> >> > database
> >> > storage ?
> >> >
> >> > Well, i also read that i can use Redis Pub/Sub to have this feature of
> >> > subscribe and publish model, so i am quite confused whether to go for
> >> > rabbitMQ ?
> >> >
> >> > Any suggestions are most welcome.
> >> >
> >> >
> >> > --
> >> > Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee
> >> >
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >
> >
> >
> >
> > --
> > Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee
> >
> >
>



-- 
Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/0c09affc/attachment.htm>

From alexis at rabbitmq.com  Wed Jan 11 17:30:04 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 11 Jan 2012 17:30:04 +0000
Subject: [rabbitmq-discuss] Suggestion - Simple Pub/Sub
In-Reply-To: <CA+PaLXKcEBn5j36U45fguCM99KBAvhTwtL9BroORwDdWDESe=g@mail.gmail.com>
References: <CA+PaLX+abipuqU80WWAi1gB5DyzhaJKGrX+1bwKxgCO3-5rkVA@mail.gmail.com>
	<CACOPnvff9Bgvjq6P0hO9H0i-iXUtONmjf7kUH3F0qYksFiB+-w@mail.gmail.com>
	<CA+PaLXLiSiieoJ++Y6yMVSo0XrZYDDYH5O4E66FjmpcWv7CsGA@mail.gmail.com>
	<CACOPnveHrXf_p5i4dqk96f44qhLnzfyPkaw5oToveaXZ8eoavg@mail.gmail.com>
	<CA+PaLXKcEBn5j36U45fguCM99KBAvhTwtL9BroORwDdWDESe=g@mail.gmail.com>
Message-ID: <CACOPnvcnpvf-BOY3GqnqPL_4BEk=S-HONUzKCqGYX4MyULhGOw@mail.gmail.com>

I don't think you will need to create one queue for each (user, topic)
pair.  If you want U1 to see all messages on T1 and T2, then you can
use one queue for U1.  It is ok for a single queue to have multiple
T1, T2, ... keys.

alexis


On Wed, Jan 11, 2012 at 5:24 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
> There will be many users and topics. For simplicity lets call users as U1,
> U2, U3 and topic as T1, T2. Now any user can publish and subscribe to any
> topic after authentication mechanism. So, what i understood by examples is
> that i should create create queues for each (user,topic) combination. In
> exchange we write the logic if the message is to be sent to T1 then all the
> queues with T1 as topic should get that message. Am i on correct path ?
>
> On Wed, Jan 11, 2012 at 9:34 PM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> Aamir
>>
>> You can do 1 using RabbitMQ, because it lets you combine pubsub with
>> durable buffers (aka "queues").
>>
>> You can do 2 by adding an archiving process as a subscriber to the
>> firehose.
>>
>> alexis
>>
>>
>> On Wed, Jan 11, 2012 at 4:00 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
>> > Well, There are two situations for the application.
>> >
>> > 1. When there is a live QA session going on, so everybody can ask
>> > question
>> > and we have to just push the questions to all the subscribers using the
>> > messaging middle ware. In case we are getting questions at a very high
>> > frequency then we will have a buffer and send questions to subscribers
>> > after
>> > certain period of time in order to avoid the confusion because of too
>> > much
>> > questions.
>> >
>> > 2. There is no live session going on and you can't ask any question, but
>> > can
>> > just browse through the talk that happened in the past.
>> >
>> > I hope i have mentioned clearly what i am trying to build. Please give
>> > your
>> > valuable suggestions how should i go about it ?
>> >
>> >
>> > On Wed, Jan 11, 2012 at 9:13 PM, Alexis Richardson <alexis at rabbitmq.com>
>> > wrote:
>> >>
>> >> What kind of storage do you want to use, and for what use cases?
>> >>
>> >> On Wed, Jan 11, 2012 at 3:27 PM, Aamir Khan <ak4u2009 at gmail.com> wrote:
>> >> > Hi,
>> >> >
>> >> > I am working on a web application in which lots of users can send
>> >> > message to
>> >> > a central server. This central server will push message to all the
>> >> > users
>> >> > based on topic based filtering. This can be easily accomplished by
>> >> > using
>> >> > rabbitMQ. I am using Tornado web server for non blocking
>> >> > asynchronously
>> >> > pushing the messages to clients with rabbitMQ as middle ware for the
>> >> > message
>> >> > queuing.?My point lies in that i also need to store each message into
>> >> > database so as to keep record of each. Since the messages won't be
>> >> > very
>> >> > structured data so i am planning to have noSQL storage. Can somebody
>> >> > please
>> >> > suggest some documentation where rabbitMQ is used in addition to
>> >> > database
>> >> > storage ?
>> >> >
>> >> > Well, i also read that i can use Redis Pub/Sub to have this feature
>> >> > of
>> >> > subscribe and publish model, so i am quite confused whether to go for
>> >> > rabbitMQ ?
>> >> >
>> >> > Any suggestions are most welcome.
>> >> >
>> >> >
>> >> > --
>> >> > Aamir Khan |?3rd?Year ?|?Computer Science & Engineering?|?IIT Roorkee
>> >> >
>> >> >
>> >> >
>> >> > _______________________________________________
>> >> > rabbitmq-discuss mailing list
>> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >
>> >
>> >
>> >
>> >
>> > --
>> > Aamir Khan |?3rd?Year ?|?Computer Science & Engineering?|?IIT Roorkee
>> >
>> >
>
>
>
>
> --
> Aamir Khan |?3rd?Year ?|?Computer Science & Engineering?|?IIT Roorkee
>
>

From steve at rabbitmq.com  Wed Jan 11 17:55:36 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 11 Jan 2012 17:55:36 +0000
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <6ff0e474-a026-449f-994d-f062203175ca@w4g2000vbc.googlegroups.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
	<0CF971BF-82C1-4D62-BB41-2628875837AE@rabbitmq.com>
	<03877dc9-66c8-473b-a99a-6f8c8bf4bb59@d10g2000vbh.googlegroups.com>
	<6ff0e474-a026-449f-994d-f062203175ca@w4g2000vbc.googlegroups.com>
Message-ID: <C173C983-48CC-4AC1-ADC8-336E9F99B1F4@rabbitmq.com>

Hi Venkat,

> This time there were no messages lost. All 20K messages were
> processed.
That's great.

I'm trying to figure out what might be wrong with
rabbitmqctl report; I'll get back to you.

Meanwhile, running
       rabbitmqctl -n rabbit at t-2 status
ON NODE t-4 might be interesting.

Also, can you tell us the output from
       rabbitmqctl cluster_status
on both nodes, please.

It is not clear if you have issued the stop_app and start_app and
reset/force_reset commands properly (you probably have), so could you follow
the steps as described in the clustering guide, and issue 
rabbitmqctl cluster_status on both nodes after each cluster change?
We should be able to see where things went wrong, then.  

(You did start_app after the cluster command, didn't you???  :-))

Cheers,

Steve Powell  (a hoppy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 11 Jan 2012, at 01:22, Venkat wrote:
> ...

From james.poole at rsa.com  Wed Jan 11 18:32:23 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Wed, 11 Jan 2012 13:32:23 -0500
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under
	Load
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>

We've let loose one of our testing ninjas on RabbitMQ for load testing, and
we're consistently running into issues when the high memory watermark is
hit.

 

Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1

 

2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second,
for a total of 50 seconds

 

Everything behaves as expected, until the memory footprint hits the high
watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots

 

VM environment = VMware, Inc.R vCenter Lab Manager 4.0 (4.0.3.1318)

 

One other note is that we see the same problem with ERL R14B04 and Rabbit
2.7.0.

 

I have looked through the log file and also turned on the console debug
output, and nothing seems to be jumping out as an error.  If needed, I can
upload the minidump from the Blue Screen and the ERL crash dump file, just
point me where to do it.

 

Let me know if there is anything else I can do to try and help get this
fixed.

 

 

 

In the rabbit log, there are no errors, and only a few warnings 20 seconds
before the crash:

 

=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830

 

=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly

 

 

In the console output log file for the physical machine, this is the only
message I see:

 

starting direct_client
...done

starting notify cluster nodes
...done

 

broker running

Eshell V5.9  (abort with ^G)

(rabbit at QEDLP082)1> 

Crash dump was written to: C:/Documents and
Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/e1621720/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/e1621720/attachment.bin>

From jerryk at vmware.com  Wed Jan 11 18:43:49 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 11 Jan 2012 10:43:49 -0800 (PST)
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
	under	Load
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
Message-ID: <b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>

James:  Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment?  The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help).  I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us?  If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.poole at rsa.com  Wed Jan 11 18:51:42 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Wed, 11 Jan 2012 13:51:42 -0500
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under	Load
In-Reply-To: <b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>

Yeah, I should have mentioned that we started out testing with the 64-bit version and found this issue... though the VM probably didn't have very much more memory than a 32-bit address space would provide.  Then we backed down to the 32-bit version to see if it went away, but it didn't.

I will see if we can send out the test program (it's just a simple java app using the rabbitmq-java-client-2.7.1).  If I can send it out, how would I go about this... attach to the email or upload it to a server somewhere?

-James

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

James:  Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment?  The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help).  I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us?  If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/10a325a9/attachment.bin>

From enrico at enricozini.org  Wed Jan 11 18:52:19 2012
From: enrico at enricozini.org (Enrico Zini)
Date: Wed, 11 Jan 2012 19:52:19 +0100
Subject: [rabbitmq-discuss] pika stops ioloop on disconnect
Message-ID: <20120111185219.GB16258@enricozini.org>

Hello,

I'm trying to deal with RabbitMQ outages from a tornado-based pika
sender. Currently on pika 0.9.5 (the latest stable release afaict).

If I stop RabbitMQ, I correctly get my on_close_callback notified.
However, pika also stops the Tornado IOLoop with this code in
base_connection.py:

    def _adapter_disconnect(self):
        """
        Called if we are forced to disconnect for some reason from Connection
        """
        # Remove from the IOLoop
        self.ioloop.stop()

        # Close our socket
        self.socket.close()

    def _handle_disconnect(self):
        """
        Called internally when we know our socket is disconnected already
        """
        # Remove from the IOLoop
        self.ioloop.stop()

        # Close up our Connection state
        self._on_connection_closed(None, True)

self.ioloop.stop() doesn't remove anything from the tornadio ioloop, but
just stops it. That's a rather surprising behaviour to me.

I can of course wrap the ioloop.start() call in my application inside a
"while True:", but before I pick up the axe I'd like to understand what
is going on: is the Tornado IOLoop stopped for a reason?

Note that _adapter_disconnect in TornadoConnection seems to do the right
thing:

    def _adapter_disconnect(self):
        """
        Disconnect from the RabbitMQ Broker
        """
        # Remove from the IOLoop
        self.ioloop.remove_handler(self.socket.fileno())

        # Close our socket since the Connection class told us to do so
        self.socket.close()

        # Let the developer know to look for this circumstance
        warn("Tornado IOLoop may be running but Pika has shutdown.")

but _handle_disconnect is not overridden in TornadoConnection, so
ioloop.stop() is still called.

Looks like a bug to me, but I'd like to double check it here since I've
only just started looking into pika's code.


Ciao,

Enrico

-- 
GPG key: 4096R/E7AD5568 2009-05-08 Enrico Zini <enrico at enricozini.org>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 490 bytes
Desc: Digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/4509eed6/attachment.pgp>

From jerryk at vmware.com  Wed Jan 11 19:16:44 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 11 Jan 2012 11:16:44 -0800 (PST)
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
	under	Load
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>
Message-ID: <5f5f323b-2b24-489a-84a3-af5f1fe47336@StrongMad.local>

Hi, James:

I'm not sure we have a totally great way of handing off the files.  If
they're small enough just emailing me a .tar.gz-file or the like is great.
Otherwise, we might consider DropBox or the like...

Thanks for poking at it further.

Out of curiosity, are you looking at deploying Rabbit into production on
Windows, or is this mostly on dev/test machines?  Anecdotally it seems like
the various Linuxes get much wider production use than the other platforms,
and thus at any moment there are more eyes prying and more hands exercising
them...

Best regards,
Jerry

----- Original Message -----
From: "James Poole" <james.poole at rsa.com>
To: "Jerry Kuch (VMware)" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:51:42 AM
Subject: RE: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load

Yeah, I should have mentioned that we started out testing with the 64-bit version and found this issue... though the VM probably didn't have very much more memory than a 32-bit address space would provide.  Then we backed down to the 32-bit version to see if it went away, but it didn't.

I will see if we can send out the test program (it's just a simple java app using the rabbitmq-java-client-2.7.1).  If I can send it out, how would I go about this... attach to the email or upload it to a server somewhere?

-James

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

James:  Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment?  The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help).  I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us?  If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From cao at ll.mit.edu  Wed Jan 11 19:25:54 2012
From: cao at ll.mit.edu (Cao, Yican - 0661 - MITLL)
Date: Wed, 11 Jan 2012 14:25:54 -0500
Subject: [rabbitmq-discuss] Is it possible that group clustering nodes
 shovel/federate with other group clustering nodes
In-Reply-To: <fc508609-5c50-4fcd-9f6f-b977851d1f45@StrongMad.local>
References: <fc508609-5c50-4fcd-9f6f-b977851d1f45@StrongMad.local>
Message-ID: <DAEBFA6A-9FBE-4046-AAC9-7CDE01D76839@ll.mit.edu>

Hi Jerry,

I have setup clusters and shovel among individual nodes. It is well documented in RabbitMQ web site.
 
Problem I have is how I shovel a group of clustered nodes to another clustered nodes. What does rabbitmq.config file look like in a nested way? 
eg. :  
	a-1	cluster a-2, 
		cluster a-3,
	shovel
	b-1	cluster b-2

I assume that a-2 and a-3 in group a nodes will do the same to shovel group b nodes. I need bi-direction, I will shovel nodes in group b nodes.

Thanks a lot.


Yican



On Jan 11, 2012, at 11:09 AM, Jerry Kuch wrote:

> Hi, Yican:
> 
> There are very clear and friendly discussions of setting up clusters and shovel
> in this book, of which a preview eBook edition is currently available (the print
> book should hit the stands sometime around March):
> 
> http://www.manning.com/videla/
> 
> It does not, however, cover the Federation plugin.  For that you'll have to look
> at the Rabbit web site.
> 
> The following links are from RabbitMQ's own web site:
> 
> For clustering Rabbit:  http://www.rabbitmq.com/clustering.html
> 
> For Federation:  http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/
> 
> And for Shovel:  http://hg.rabbitmq.com/rabbitmq-shovel/file/default/README
> 
> It might require a bit more thought about your specific application to clinch 
> the decision between Federation and Shovel.
> 
> Best regards,
> Jerry
> 
> ----- Original Message -----
> From: "Yican Cao - 0661 - MITLL" <cao at ll.mit.edu>
> To: "Jerry Kuch" <jerryk at vmware.com>
> Sent: Wednesday, January 11, 2012 6:31:42 AM
> Subject: Re: [rabbitmq-discuss] Is it possible that group clustering nodes shovel/federate with other group clustering nodes
> 
> Hi Jerry,
> 
> Thanks for answer my email promptly.
> Yes, you're correct. That is exactly what I try to do.
> 
> Is there any example or document I can follow?
> Thanks.
> 
> Yican
> 
> 
> On Jan 10, 2012, at 8:20 PM, Jerry Kuch wrote:
> 
>> Hi, Yican...
>> 
>> If I understand your intentions correctly, you're proposing a use
>> case that's quite commonly done, namely the clustering of nodes within
>> a geographic location for increasing throughput, or perhaps HA, and
>> then setting up Federation or Shovel to span the long hauls between
>> your geographic locations.  This, plus judiciously picking which messages
>> you plan to move between sites is the essence of the sort of WAN 
>> distribution you're after.
>> 
>> Best regards,
>> Jerry
>> 
>> ----- Original Message -----
>> From: "Yican Cao - 0661 - MITLL" <cao at ll.mit.edu>
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Tuesday, January 10, 2012 12:03:44 PM
>> Subject: [rabbitmq-discuss] Is it possible that group clustering nodes shovel/federate with other group clustering nodes
>> 
>> Hi,
>> 
>> I have a crazy idea: 
>> 1. clustering 3 nodes with HAQ (highly available queue) as group A.
>> 2. clustering other 2 nodes with HAQ as group B.
>> 3. federating/shoveling group A and group B with 1 or 2 exchange.
>> 
>> Group A and B will connect via WAN, so clustering is not recommended by RabbitMQ.
>> 
>> Is it possible? If so, has anyone done this? 
>> Thanks a lot.
>> 
>> 
>> Yican Cao
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 6299 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/28c10289/attachment.bin>

From jim at rabbitmq.com  Wed Jan 11 19:26:28 2012
From: jim at rabbitmq.com (Jim Apperly)
Date: Wed, 11 Jan 2012 19:26:28 +0000
Subject: [rabbitmq-discuss] Is it possible that group clustering nodes
 shovel/federate with other group clustering nodes
In-Reply-To: <fc508609-5c50-4fcd-9f6f-b977851d1f45@StrongMad.local>
References: <42647A1D-556D-4F21-9C32-1DB0E780DDBC@ll.mit.edu>
	<fc508609-5c50-4fcd-9f6f-b977851d1f45@StrongMad.local>
Message-ID: <CAMdQUi9Ki7BDgcCm-N=+Y2biAe5QZop2=42SmrL+a1f1pCaq5A@mail.gmail.com>

Please also see this, for some disambiguation around how you might run
distributed rabbits:

http://www.rabbitmq.com/distributed.html

Jim

On 11 January 2012 16:09, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Yican:
>
> There are very clear and friendly discussions of setting up clusters and
> shovel
> in this book, of which a preview eBook edition is currently available (the
> print
> book should hit the stands sometime around March):
>
> http://www.manning.com/videla/
>
> It does not, however, cover the Federation plugin.  For that you'll have
> to look
> at the Rabbit web site.
>
> The following links are from RabbitMQ's own web site:
>
> For clustering Rabbit:  http://www.rabbitmq.com/clustering.html
>
> For Federation:
> http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/
>
> And for Shovel:
> http://hg.rabbitmq.com/rabbitmq-shovel/file/default/README
>
> It might require a bit more thought about your specific application to
> clinch
> the decision between Federation and Shovel.
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Yican Cao - 0661 - MITLL" <cao at ll.mit.edu>
> To: "Jerry Kuch" <jerryk at vmware.com>
> Sent: Wednesday, January 11, 2012 6:31:42 AM
> Subject: Re: [rabbitmq-discuss] Is it possible that group clustering nodes
> shovel/federate with other group clustering nodes
>
> Hi Jerry,
>
> Thanks for answer my email promptly.
> Yes, you're correct. That is exactly what I try to do.
>
> Is there any example or document I can follow?
> Thanks.
>
> Yican
>
>
> On Jan 10, 2012, at 8:20 PM, Jerry Kuch wrote:
>
> > Hi, Yican...
> >
> > If I understand your intentions correctly, you're proposing a use
> > case that's quite commonly done, namely the clustering of nodes within
> > a geographic location for increasing throughput, or perhaps HA, and
> > then setting up Federation or Shovel to span the long hauls between
> > your geographic locations.  This, plus judiciously picking which messages
> > you plan to move between sites is the essence of the sort of WAN
> > distribution you're after.
> >
> > Best regards,
> > Jerry
> >
> > ----- Original Message -----
> > From: "Yican Cao - 0661 - MITLL" <cao at ll.mit.edu>
> > To: rabbitmq-discuss at lists.rabbitmq.com
> > Sent: Tuesday, January 10, 2012 12:03:44 PM
> > Subject: [rabbitmq-discuss] Is it possible that group clustering nodes
> shovel/federate with other group clustering nodes
> >
> > Hi,
> >
> > I have a crazy idea:
> > 1. clustering 3 nodes with HAQ (highly available queue) as group A.
> > 2. clustering other 2 nodes with HAQ as group B.
> > 3. federating/shoveling group A and group B with 1 or 2 exchange.
> >
> > Group A and B will connect via WAN, so clustering is not recommended by
> RabbitMQ.
> >
> > Is it possible? If so, has anyone done this?
> > Thanks a lot.
> >
> >
> > Yican Cao
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/937850e8/attachment.htm>

From simone.busoli at gmail.com  Wed Jan 11 20:01:58 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 11 Jan 2012 21:01:58 +0100
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>
Message-ID: <CAOn7oW_PB-yP4SsQaW9Tq4-r9WS0P2PRNVuEFJf5pj4ED0naxQ@mail.gmail.com>

Hi James,

If you can provide more details about the load you're applying to the
broker I would be glad to try to reproduce it.
We've been using RabbitMQ on Windows in production for some months now and
didn't experience any weird behavior.
What I'm interested in is whether entities and messages are durable, if you
use transactions or publisher confirms and the like.
On Jan 11, 2012 7:52 PM, <james.poole at rsa.com> wrote:

> Yeah, I should have mentioned that we started out testing with the 64-bit
> version and found this issue... though the VM probably didn't have very
> much more memory than a 32-bit address space would provide.  Then we backed
> down to the 32-bit version to see if it went away, but it didn't.
>
> I will see if we can send out the test program (it's just a simple java
> app using the rabbitmq-java-client-2.7.1).  If I can send it out, how would
> I go about this... attach to the email or upload it to a server somewhere?
>
> -James
>
> -----Original Message-----
> From: Jerry Kuch [mailto:jerryk at vmware.com]
> Sent: Wednesday, January 11, 2012 1:44 PM
> To: Poole, James
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
> under Load
>
> James:  Out of curiousity have you tried the new 64-bit release of
> Erlang for Windows in your environment?  The address space size
> limitations of the 32-bit version have been associated with crashy
> Rabbits in the past (although bringing your memory high watermark
> value down so that the back-pressure mechanisms engage when the
> broker is in less trouble may help).  I think you can scare up the
> new Erlang here:
>
> http://www.erlang.org/download/otp_win64_R15B.exe
>
> Until recently there was no 64-bit Erlang, so even those running on
> 64-bit Windows boxes were still relegated to 32-bit VMs.
>
> I am curious about the different results between a physical machine
> and a virtualized one, with one showing a "clean" Erlang VM crash and
> the other exhibiting a blue-screen, fatal OS-wrecker...
>
> Is the traffic you're using to bring these systems down part of a
> large or proprietary app, or can you extract a bare minimum piece
> of code that brings the pain and share it with us?  If you could
> do the latter we could more easily investigate the situation within
> VMware since the difference in behavior between baremetal and
> virtualization is disquieting...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "james poole" <james.poole at rsa.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, January 11, 2012 10:32:23 AM
> Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
> under     Load
>
>
>
>
>
> We?ve let loose one of our testing ninjas on RabbitMQ for load testing,
> and we?re consistently running into issues when the high memory watermark
> is hit.
>
>
>
> Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1
>
>
>
> 2,000 Consumers each with their own queue bound to a direct exchange
>
> 1 Producer, publishing a 2 MB message to the exchange, once every second,
> for a total of 50 seconds
>
>
>
> Everything behaves as expected, until the memory footprint hits the high
> watermark, at which point:
>
> On a physical machine: ERL process crashes and dump file is created
>
> On a Virtual Machine: Blue Screen of Death is shown and server reboots
>
>
>
> VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318)
>
>
>
> One other note is that we see the same problem with ERL R14B04 and Rabbit
> 2.7.0.
>
>
>
> I have looked through the log file and also turned on the console debug
> output, and nothing seems to be jumping out as an error. If needed, I can
> upload the minidump from the Blue Screen and the ERL crash dump file, just
> point me where to do it.
>
>
>
> Let me know if there is anything else I can do to try and help get this
> fixed.
>
>
>
>
>
>
>
> In the rabbit log, there are no errors, and only a few warnings 20 seconds
> before the crash:
>
>
>
> =INFO REPORT==== 11-Jan-2012::10:55:53 ===
>
> closing TCP connection <0.4405.0> from 10.6.64.104:57830
>
>
>
> =WARNING REPORT==== 11-Jan-2012::10:55:53 ===
>
> exception on TCP connection <0.20552.0> from 10.6.64.104:59521
>
> connection_closed_abruptly
>
>
>
>
>
> In the console output log file for the physical machine, this is the only
> message I see:
>
>
>
> starting direct_client ...done
>
> starting notify cluster nodes ...done
>
>
>
> broker running
>
> Eshell V5.9 (abort with ^G)
>
> (rabbit at QEDLP082)1>
>
> Crash dump was written to: C:/Documents and
> Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump
>
> eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").
>
> in message_loop
>
> win32sysinfo:Erlang has closed.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120111/f7ea5be2/attachment.htm>

From simone.busoli at gmail.com  Wed Jan 11 23:13:41 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 12 Jan 2012 00:13:41 +0100
Subject: [rabbitmq-discuss] Considerations on client error semantics
Message-ID: <CAOn7oW_dufxpSS6yQiQF+5uWsjwmCn1hZg1-sz-xo6bMme--mA@mail.gmail.com>

Hi I would like to share some thoughts about error handling when
interacting with the broker, and specifically with the .NET API.

By looking at the source code of the client, reading the docs and some
experience with using it I am under the impression that it's not easy to
figure out whether, which ones, and how to handle and react to exceptions
thrown when calling methods on the client.

I think that most of the exceptions that can arise under normal usage of
the client  should appear in this list:

- BrokerUnreachableException
- AlreadyClosedException
- OperationInterruptedException
- IOException
- EndOfStreamException

Aiming at creating highly reliable applications making use of the API which
are not supposed to crash and loose, duplicate or get any messages out of
order I realized that the behavior of the client is a bit underspecified.
The straightforward approach would be to catch every exception thrown by
the client, but it's not straightforward to figure out whether all of them
should really be handled in the same way.
Also, failure conditions are also notified by events on the various
IConnection and IModel interfaces, which is useful but also confusing in
that they partially overlap with the exceptions.

Although all of the above concerns mostly the .NET client I'm very
interested in how others are solving the same problem.

Following is a rough overview of the behavior of the API I expose to such
kind of applications.

On the publishing side:

- publishes don't make it to the broker immediately, but rather collected
into an in-memory queue which is gated by a semaphore watching the status
of the connection by subscribing to the ConnectionShutdown event.
- Connection shutdowns are monitored and reconnection is scheduled.
- Publisher confirms are used. Unconfirmed or nacked messages are
republished at intervals and also enqueued for publishing as soon as the
connection shuts down, in order to be the first to be published when the
connection is restored
- BasicPublish invocations are wrapped into try-catch blocks catching
several kind of exceptions but doing nothing except logging. Since the
message appears as unconfirmed it will eventually be republished.

On the consuming side:

- QueueingConsumer is used, looping its queue on a separate thread.
Deliveries are marshalled to the application and acked after that. Issues
to deal with are: what happens if an exception is thrown by the application
while processing the message?

- Ahead of the consuming loop there are deduplication and resequencing
filters, in the order. Deduplication is required especially as publisher
confirms may cause it, resequencing is needed because of limited guarantees
RabbitMQ provides about ordering and also because connection and broker
shutdowns may lead to messages arriving out of order.

- Connection status is monitored and connection is rescheduled when it
drops. It is not clear whether exceptions thrown when calling QueueDeclare,
QueueBind, BasicConsume, should be interpreted as connection going down or
if in such cases the connection should be closed explicitly and scheduled
for later. The fact is, if any of those throw you really want to start from
the beginning even if they weren't caused by the connection dropping, if
this is at all possible.

There are lots of other pernicious details, but these are the main things I
beliveve.
Sorry for the long mail, I'd appreciate some feedback.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/6eceb73c/attachment.htm>

From brian.newsgroup at gmail.com  Thu Jan 12 01:25:46 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Thu, 12 Jan 2012 12:25:46 +1100
Subject: [rabbitmq-discuss] About exchange bindings
In-Reply-To: <4F0D58B5.4060401@rabbitmq.com>
References: <CALD4NQaWt4QOkquUMkdYVHSLZ-qYcBqFPoHDAsN2JEh8J1bi1w@mail.gmail.com>
	<4F0D58B5.4060401@rabbitmq.com>
Message-ID: <CALD4NQYP4e_EXiR06DkA4spz+PyQBeWzEN0hj+nhxx5sEp1Y+Q@mail.gmail.com>

Thanks Michael for your explanation! Very much appreciated!

Cheers,

Brian

On Wed, Jan 11, 2012 at 8:39 PM, Michael Bridgen <mikeb at rabbitmq.com> wrote:

> My questions are:
>> 1. In the function definition, what does the argument "ticket" mean, and
>> how to use it?
>>
>
> It's a throwback to AMQP 0-8 that was removed in AMQP 0-9-1 (I don't know
> why it's in an API). Just let it default to 0.
>
>
>  2. What is the set of arguments for "arguments = {}"?
>>
>
> Generally, none. It's an extension mechanism in AMQP, and usually left
> alone. Aside from vendor extensions, the only reason for ever using it is
> for a binding to a headers exchange, which encodes its match values in the
> 'arguments' field.
>
> -Michael
>
>
>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/6ff8928e/attachment.htm>

From michael.s.klishin at gmail.com  Thu Jan 12 04:40:15 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 12 Jan 2012 08:40:15 +0400
Subject: [rabbitmq-discuss] Considerations on client error semantics
In-Reply-To: <CAOn7oW_dufxpSS6yQiQF+5uWsjwmCn1hZg1-sz-xo6bMme--mA@mail.gmail.com>
References: <CAOn7oW_dufxpSS6yQiQF+5uWsjwmCn1hZg1-sz-xo6bMme--mA@mail.gmail.com>
Message-ID: <DFF7CFC6-0256-45CB-BD54-846EE9A89328@gmail.com>

Simone Busoli:

> There are lots of other pernicious details, but these are the main things I beliveve.
> Sorry for the long mail, I'd appreciate some feedback.

I have largely the same experience (althrough with JVM-based and Ruby clients). I am slowly rolling in support for techniques you've described into RabbitMQ clients I maintain.

One more issue I can bring to the table is handling endless redelivery loops, for example:

 * A message is delivered by rabbitmq to a consumer
 * The consumer fails to process it (say there was some edge case in the payload that it could not handle)
 * The message is rejected with requeue = true.
 * A message is delivered by rabbitmq to a consumer?

and so on.

I believe all these topics are worth writing a small book about :)

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From lionel.cons at cern.ch  Thu Jan 12 08:04:44 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Thu, 12 Jan 2012 09:04:44 +0100
Subject: [rabbitmq-discuss] Auth failure: Bad CONNECT
In-Reply-To: <33112570.post@talk.nabble.com> (dnsplus's message of "Tue, 10
	Jan 2012 07:58:16 -0800")
References: <33107784.post@talk.nabble.com> <bw7vcokm4uj.fsf@mail.cern.ch>
	<33112570.post@talk.nabble.com>
Message-ID: <bw7lipdwdlv.fsf@mail.cern.ch>

dnsplus <developer at dnsplus.net> writes:
> Sadly, no. I still get the Bad CONNECT response. 

Which version of RabbitMQ are you using?

Here, with RabbitMQ 2.7.1 and Net-STOMP-Client 1.2, the following code
does work:

 use Net::STOMP::Client;
 $stomp = Net::STOMP::Client->new(host=>'localhost', port=>61223);
 $stomp->connect(login=>"guest", passcode=>"guest", host=>"rabbitmq");

(note: our virtual host is called "rabbitmq" and not "default")

As a side note, the RabbitMQ logs should contain more information
so that broker admins can more quickly unedrstand what's wrong.

Cheers,

Lionel

From lukemanner at gmail.com  Thu Jan 12 09:04:06 2012
From: lukemanner at gmail.com (luke manner)
Date: Thu, 12 Jan 2012 10:04:06 +0100
Subject: [rabbitmq-discuss] Clustering,
	Mirrored queue and high availability in RabbitMQ
Message-ID: <CAJBmP-Wc8pdXmtXy40Yd-Bo1brsnP2PRnGDLc8WZrVHq9Y1HrQ@mail.gmail.com>

Hi all,
we are studing/testing RabbitMQ in order to use it on a big project.

I'd like to know if it is correct:


   1. If I have a mirrored queue, all consumers of this queue are all
   connected to the master queue and not to the slaves (slaves are used for
   backup if master node fails).
   2. When a queue (mirrored or not) is  dinamically  created  by a client
   in a cluster enviroment , it is created on the client's node and not in any
   node of the cluster (so there is an automatic load balancing of queues in a
   cluster)
   3. If a client is connected to a mirrored queue and the master of the
   queue fails/goes down, a slave is defined as a new master and new
   connections go through the new node; but all old clients, that were using
   connections to the old master node, have dead channel and RabbitMQ don't
   create automatically connection to the new node.

Are these sentences right?

Thanks in advance!
Luke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/bc11908e/attachment.htm>

From majek04 at gmail.com  Thu Jan 12 10:54:33 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 12 Jan 2012 10:54:33 +0000
Subject: [rabbitmq-discuss] pika stops ioloop on disconnect
In-Reply-To: <20120111185219.GB16258@enricozini.org>
References: <20120111185219.GB16258@enricozini.org>
Message-ID: <CABzX+qywyGQFAJNMWVkxzSuVpCfmDEVCae99OfsOiCArEab2HQ@mail.gmail.com>

On Wed, Jan 11, 2012 at 18:52, Enrico Zini <enrico at enricozini.org> wrote:
> Hello,
>
> I'm trying to deal with RabbitMQ outages from a tornado-based pika
> sender. Currently on pika 0.9.5 (the latest stable release afaict).
>
> If I stop RabbitMQ, I correctly get my on_close_callback notified.
> However, pika also stops the Tornado IOLoop with this code in
> base_connection.py:

I'm not sure how the tornado adapter works in Pika.
Please consider raising a bug if you think this behaviour
is a bug:
    https://github.com/pika/pika/issues

Also, it may help if you attached a runnable test case to the bug.

Cheers,
  Marek

>
> ? ?def _adapter_disconnect(self):
> ? ? ? ?"""
> ? ? ? ?Called if we are forced to disconnect for some reason from Connection
> ? ? ? ?"""
> ? ? ? ?# Remove from the IOLoop
> ? ? ? ?self.ioloop.stop()
>
> ? ? ? ?# Close our socket
> ? ? ? ?self.socket.close()
>
> ? ?def _handle_disconnect(self):
> ? ? ? ?"""
> ? ? ? ?Called internally when we know our socket is disconnected already
> ? ? ? ?"""
> ? ? ? ?# Remove from the IOLoop
> ? ? ? ?self.ioloop.stop()
>
> ? ? ? ?# Close up our Connection state
> ? ? ? ?self._on_connection_closed(None, True)
>
> self.ioloop.stop() doesn't remove anything from the tornadio ioloop, but
> just stops it. That's a rather surprising behaviour to me.
>
> I can of course wrap the ioloop.start() call in my application inside a
> "while True:", but before I pick up the axe I'd like to understand what
> is going on: is the Tornado IOLoop stopped for a reason?
>
> Note that _adapter_disconnect in TornadoConnection seems to do the right
> thing:
>
> ? ?def _adapter_disconnect(self):
> ? ? ? ?"""
> ? ? ? ?Disconnect from the RabbitMQ Broker
> ? ? ? ?"""
> ? ? ? ?# Remove from the IOLoop
> ? ? ? ?self.ioloop.remove_handler(self.socket.fileno())
>
> ? ? ? ?# Close our socket since the Connection class told us to do so
> ? ? ? ?self.socket.close()
>
> ? ? ? ?# Let the developer know to look for this circumstance
> ? ? ? ?warn("Tornado IOLoop may be running but Pika has shutdown.")
>
> but _handle_disconnect is not overridden in TornadoConnection, so
> ioloop.stop() is still called.
>
> Looks like a bug to me, but I'd like to double check it here since I've
> only just started looking into pika's code.
>
>
> Ciao,
>
> Enrico
>
> --
> GPG key: 4096R/E7AD5568 2009-05-08 Enrico Zini <enrico at enricozini.org>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.poole at rsa.com  Thu Jan 12 13:54:52 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Thu, 12 Jan 2012 08:54:52 -0500
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under	Load
In-Reply-To: <5f5f323b-2b24-489a-84a3-af5f1fe47336@StrongMad.local>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>
	<5f5f323b-2b24-489a-84a3-af5f1fe47336@StrongMad.local>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6159@MX36A.corp.emc.com>

I am in the process of getting the tool to reproduce and will email it to you when it's available.

We were planning on deploying in production on Windows, though if this is not something that is recommended, I would definitely like to know about that now :)

-James

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Wednesday, January 11, 2012 2:17 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

Hi, James:

I'm not sure we have a totally great way of handing off the files.  If
they're small enough just emailing me a .tar.gz-file or the like is great.
Otherwise, we might consider DropBox or the like...

Thanks for poking at it further.

Out of curiosity, are you looking at deploying Rabbit into production on
Windows, or is this mostly on dev/test machines?  Anecdotally it seems like
the various Linuxes get much wider production use than the other platforms,
and thus at any moment there are more eyes prying and more hands exercising
them...

Best regards,
Jerry

----- Original Message -----
From: "James Poole" <james.poole at rsa.com>
To: "Jerry Kuch (VMware)" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:51:42 AM
Subject: RE: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load

Yeah, I should have mentioned that we started out testing with the 64-bit version and found this issue... though the VM probably didn't have very much more memory than a 32-bit address space would provide.  Then we backed down to the 32-bit version to see if it went away, but it didn't.

I will see if we can send out the test program (it's just a simple java app using the rabbitmq-java-client-2.7.1).  If I can send it out, how would I go about this... attach to the email or upload it to a server somewhere?

-James

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

James:  Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment?  The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help).  I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us?  If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/44a8df3f/attachment.bin>

From michael.justin at gmx.net  Thu Jan 12 14:29:48 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 12 Jan 2012 15:29:48 +0100
Subject: [rabbitmq-discuss] STOMP - balance incoming/outgoing message rate?
Message-ID: <jemqou$4eq$3@dough.gmane.org>

Hello,

I have set up a STOMP client test application for RabbitMQ (2.7.1 on 
Windows Vista) which runs two threads, one is continuously sending 
messages to a topic, and the other consumes them, using client-side ack.

The results show that the broker accepts new messages at a high rate 
(around 10,000 messages per second) but sends them to the client at a 
much lower rate (200 to 300 messages per second):

after two seconds:
sent/received 19370/580 290 msgs/s (3448 microsecs/roundtrip)

after 30 seconds:
sent/received 303375/7229 190 msgs/s (5263 microsecs/roundtrip)

Is there a way to configure the STOMP plugin so that the input / output 
speed is more balanced?

Many thanks in advance
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From simon at rabbitmq.com  Thu Jan 12 14:36:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Jan 2012 14:36:01 +0000
Subject: [rabbitmq-discuss] STOMP - balance incoming/outgoing message
 rate?
In-Reply-To: <jemqou$4eq$3@dough.gmane.org>
References: <jemqou$4eq$3@dough.gmane.org>
Message-ID: <4F0EEFD1.50208@rabbitmq.com>

On 12/01/12 14:29, Michael Justin wrote:
> Is there a way to configure the STOMP plugin so that the input / output
> speed is more balanced?

Not right now.

By coincidence I am looking at this right now (well, the AMQP case but 
the STOMP one is similar)...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From pbell at syncsort.com  Thu Jan 12 15:05:19 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Thu, 12 Jan 2012 10:05:19 -0500
Subject: [rabbitmq-discuss] One Producer, Many Consumers, Many physical nodes
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B004@MAILCCR.us.syncsort.com>

All,

I am new to Rabbit and am trying to understand how best to deploy it in a given system.

I envision a single producer writing to a single queue, and multiple consumers pulling from this single queue. The wrinkle here is that these consumers can be on different physical computers.

Can this be done with Rabbit and, if so, can someone explain the several approaches to it?

Thanks very much.

-Paul

________________________________


ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/a6f6332a/attachment.htm>

From mikeb at rabbitmq.com  Thu Jan 12 15:12:26 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 12 Jan 2012 15:12:26 +0000
Subject: [rabbitmq-discuss] One Producer, Many Consumers,
 Many physical nodes
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B004@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B004@MAILCCR.us.syncsort.com>
Message-ID: <4F0EF85A.9090202@rabbitmq.com>

On 01/12/2012 03:05 PM, Bell, Paul M. wrote:
> All,
>
> I am new to Rabbit and am trying to understand how best to deploy it in
> a given system.
>
> I envision a single producer writing to a single queue, and multiple
> consumers pulling from this single queue. The wrinkle here is that these
> consumers can be on different physical computers.
>
> Can this be done with Rabbit and, if so, can someone explain the several
> approaches to it?

Yes, many clients is what RabbitMQ is designed for. The queue is hosted 
at the server and the clients interact with it over the network.

You may wish to run through the tutorials at
http://rabbit.mq/getstarted.html

-Michael


>
> ------------------------------------------------------------------------
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files
> transmitted with this message) may contain proprietary, trade secret or
> other confidential and/or legally privileged information. Any pricing
> information contained in this message or in any files transmitted with
> this message is always confidential and cannot be shared with any third
> parties without prior written approval from Syncsort. This message is
> intended to be read only by the individual or entity to whom it is
> addressed or by their designee. If the reader of this message is not the
> intended recipient, you are on notice that any use, disclosure, copying
> or distribution of this message, in any form, is strictly prohibited. If
> you have received this message in error, please immediately notify the
> sender and/or Syncsort and destroy all copies of this message in your
> possession, custody or control.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Thu Jan 12 15:13:15 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 12 Jan 2012 16:13:15 +0100
Subject: [rabbitmq-discuss] One Producer, Many Consumers,
	Many physical nodes
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B004@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B004@MAILCCR.us.syncsort.com>
Message-ID: <CAMcAHLVkr7Vz=VSph5tYNvQJhq9ou93Zoz8THkgD7p4Ahqatgw@mail.gmail.com>

Hi,

As long as you can connect to Rabbit it doesn't matter where the consumers
are run. i.e.: RabbitMQ doesn't care about the location of the client. So
you could run everything on the same box including the broker, or have one
box for the producer, another for the broker and one for the consumer (or
even one box per consumer).

Cheers,

Alvaro

On Thu, Jan 12, 2012 at 4:05 PM, Bell, Paul M. <pbell at syncsort.com> wrote:

>  All,****
>
> ** **
>
> I am new to Rabbit and am trying to understand how best to deploy it in a
> given system.****
>
> ** **
>
> I envision a single producer writing to a single queue, and multiple
> consumers pulling from this single queue. The wrinkle here is that these
> consumers can be on different physical computers.****
>
> ** **
>
> Can this be done with Rabbit and, if so, can someone explain the several
> approaches to it?****
>
> ** **
>
> Thanks very much.****
>
> ** **
>
> -Paul****
>
> ------------------------------
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted
> with this message) may contain proprietary, trade secret or other
> confidential and/or legally privileged information. Any pricing information
> contained in this message or in any files transmitted with this message is
> always confidential and cannot be shared with any third parties without
> prior written approval from Syncsort. This message is intended to be read
> only by the individual or entity to whom it is addressed or by their
> designee. If the reader of this message is not the intended recipient, you
> are on notice that any use, disclosure, copying or distribution of this
> message, in any form, is strictly prohibited. If you have received this
> message in error, please immediately notify the sender and/or Syncsort and
> destroy all copies of this message in your possession, custody or control.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/b2116d79/attachment.htm>

From developer at dnsplus.net  Thu Jan 12 15:46:40 2012
From: developer at dnsplus.net (dnsplus)
Date: Thu, 12 Jan 2012 07:46:40 -0800 (PST)
Subject: [rabbitmq-discuss] Auth failure: Bad CONNECT
In-Reply-To: <bw7lipdwdlv.fsf@mail.cern.ch>
References: <33107784.post@talk.nabble.com> <bw7vcokm4uj.fsf@mail.cern.ch>
	<33112570.post@talk.nabble.com> <bw7lipdwdlv.fsf@mail.cern.ch>
Message-ID: <33128574.post@talk.nabble.com>




Lionel Cons wrote:
> 
> dnsplus <developer at dnsplus.net> writes:
>> Sadly, no. I still get the Bad CONNECT response. 
> 
> Which version of RabbitMQ are you using?
> 
> Here, with RabbitMQ 2.7.1 and Net-STOMP-Client 1.2, the following code
> does work:
> 
>  use Net::STOMP::Client;
>  $stomp = Net::STOMP::Client->new(host=>'localhost', port=>61223);
>  $stomp->connect(login=>"guest", passcode=>"guest", host=>"rabbitmq");
> 
> (note: our virtual host is called "rabbitmq" and not "default")
> 
> As a side note, the RabbitMQ logs should contain more information
> so that broker admins can more quickly unedrstand what's wrong.
> 
> Cheers,
> 
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

I revisited your suggestion, and tried this:

use Net::STOMP::Client;
my $stomp = Net::STOMP::Client->new(host=>'localhost', port=>61613);
$stomp->connect(login=>'guest', passcode=>'guest', host=>'/');
$stomp->send(destination => "/queue/test", body => "hello world!");
$stomp->disconnect;

I this resulted in the successful creation of the queue "test" which has 1
ready message (hello world!) sitting in the queue waiting to be consumed. 

I had earlier misunderstood the syntax of the 'host=>' entry in the
connect() statement. 

I find it curious that none of the examples / documentation i could find on
this provider included this. 

Thanks for your help. It looks like I have two viable providers to research
and compare for my project (Net::Stomp and Net::STOMP)

- dnsplus
-- 
View this message in context: http://old.nabble.com/Auth-failure%3A-Bad-CONNECT-tp33107784p33128574.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From pbell at syncsort.com  Thu Jan 12 15:53:50 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Thu, 12 Jan 2012 10:53:50 -0500
Subject: [rabbitmq-discuss] One Producer, Many Consumers,
 Many physical nodes
In-Reply-To: <4F0EF85A.9090202@rabbitmq.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B004@MAILCCR.us.syncsort.com>
	<4F0EF85A.9090202@rabbitmq.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B011@MAILCCR.us.syncsort.com>

Michael and Alvaro,

Thank you both. That's good news.

Please let me follow-up with some finer grained aspects:

Am I right to think that the "one producer, one queue, many consumers on different computers" model would allow "even" distribution of messages? I don't want each message duplicated for each consumer. Rather, the fan-out should partition the entire message set with each consumer getting a subset thereof.

When a consumer pulls a message from the queue, is there a way to leave that message in queue? If so, can queue elements be updated in-place, e.g., with "status" info about the state of the work that the message (task) represents?

Thanks again.

-Paul


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Bridgen
Sent: Thursday, January 12, 2012 10:12 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] One Producer, Many Consumers,Many physical nodes

On 01/12/2012 03:05 PM, Bell, Paul M. wrote:
> All,
>
> I am new to Rabbit and am trying to understand how best to deploy it in
> a given system.
>
> I envision a single producer writing to a single queue, and multiple
> consumers pulling from this single queue. The wrinkle here is that these
> consumers can be on different physical computers.
>
> Can this be done with Rabbit and, if so, can someone explain the several
> approaches to it?

Yes, many clients is what RabbitMQ is designed for. The queue is hosted
at the server and the clients interact with it over the network.

You may wish to run through the tutorials at
http://rabbit.mq/getstarted.html

-Michael


>
> ------------------------------------------------------------------------
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files
> transmitted with this message) may contain proprietary, trade secret or
> other confidential and/or legally privileged information. Any pricing
> information contained in this message or in any files transmitted with
> this message is always confidential and cannot be shared with any third
> parties without prior written approval from Syncsort. This message is
> intended to be read only by the individual or entity to whom it is
> addressed or by their designee. If the reader of this message is not the
> intended recipient, you are on notice that any use, disclosure, copying
> or distribution of this message, in any form, is strictly prohibited. If
> you have received this message in error, please immediately notify the
> sender and/or Syncsort and destroy all copies of this message in your
> possession, custody or control.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From mikeb at rabbitmq.com  Thu Jan 12 15:59:23 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 12 Jan 2012 15:59:23 +0000
Subject: [rabbitmq-discuss] One Producer, Many Consumers,
 Many physical nodes
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B011@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B004@MAILCCR.us.syncsort.com>	<4F0EF85A.9090202@rabbitmq.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B2D89B011@MAILCCR.us.syncsort.com>
Message-ID: <4F0F035B.6070509@rabbitmq.com>

Paul,

Looking through the tutorials will obviate many further questions.

On this specifically,

> When a consumer pulls a message from the queue, is there a way to
> leave that message in queue? If so, can queue elements be updated
> in-place, e.g., with "status" info about the state of the work that
> the message (task) represents?

No. You can leave it in the queue, but you can't change it. You'd have 
to post another message.

-Michael

>
> -----Original Message----- From:
> rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
> Michael Bridgen Sent: Thursday, January 12, 2012 10:12 AM To:
> rabbitmq-discuss at lists.rabbitmq.com Subject: Re: [rabbitmq-discuss]
> One Producer, Many Consumers,Many physical nodes
>
> On 01/12/2012 03:05 PM, Bell, Paul M. wrote:
>> All,
>>
>> I am new to Rabbit and am trying to understand how best to deploy
>> it in a given system.
>>
>> I envision a single producer writing to a single queue, and
>> multiple consumers pulling from this single queue. The wrinkle here
>> is that these consumers can be on different physical computers.
>>
>> Can this be done with Rabbit and, if so, can someone explain the
>> several approaches to it?
>
> Yes, many clients is what RabbitMQ is designed for. The queue is
> hosted at the server and the clients interact with it over the
> network.
>
> You may wish to run through the tutorials at
> http://rabbit.mq/getstarted.html
>
> -Michael
>
>
>>
>> ------------------------------------------------------------------------
>>
>>
>>
>>
ATTENTION: -----
>>
>> The information contained in this message (including any files
>> transmitted with this message) may contain proprietary, trade
>> secret or other confidential and/or legally privileged information.
>> Any pricing information contained in this message or in any files
>> transmitted with this message is always confidential and cannot be
>> shared with any third parties without prior written approval from
>> Syncsort. This message is intended to be read only by the
>> individual or entity to whom it is addressed or by their designee.
>> If the reader of this message is not the intended recipient, you
>> are on notice that any use, disclosure, copying or distribution of
>> this message, in any form, is strictly prohibited. If you have
>> received this message in error, please immediately notify the
>> sender and/or Syncsort and destroy all copies of this message in
>> your possession, custody or control.
>>
>>
>>
>> _______________________________________________ rabbitmq-discuss
>> mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>>
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files
> transmitted with this message) may contain proprietary, trade secret
> or other  confidential and/or legally privileged information. Any
> pricing information contained in this message or in any files
> transmitted with this message is always confidential and cannot be
> shared with any third parties without prior written approval from
> Syncsort. This message is intended to be read only by the individual
> or entity to whom it is addressed or by their designee. If the reader
> of this message is not the intended recipient, you are on notice that
> any use, disclosure, copying or distribution of this message, in any
> form, is strictly prohibited. If you have received this message in
> error, please immediately notify the sender and/or Syncsort and
> destroy all copies of this message in your possession, custody or
> control. _______________________________________________
> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From daverstevens at gmail.com  Thu Jan 12 16:00:30 2012
From: daverstevens at gmail.com (Dave Stevens)
Date: Thu, 12 Jan 2012 08:00:30 -0800 (PST)
Subject: [rabbitmq-discuss] Clustering,
	Mirrored queue and high availability in RabbitMQ
In-Reply-To: <CAJBmP-Wc8pdXmtXy40Yd-Bo1brsnP2PRnGDLc8WZrVHq9Y1HrQ@mail.gmail.com>
References: <CAJBmP-Wc8pdXmtXy40Yd-Bo1brsnP2PRnGDLc8WZrVHq9Y1HrQ@mail.gmail.com>
Message-ID: <55a4f04f-f3c2-4482-b844-30995ad7be90@z1g2000vbx.googlegroups.com>

I believe all of these are at least partially incorrect and/or
implementation dependent.

On Jan 12, 4:04?am, luke manner <lukeman... at gmail.com> wrote:
> Hi all,
> we are studing/testing RabbitMQ in order to use it on a big project.
>
> I'd like to know if it is correct:
>
> ? ?1. If I have a mirrored queue, all consumers of this queue are all
> ? ?connected to the master queue and not to the slaves (slaves are used for
> ? ?backup if master node fails).

Consumers may be connected to slave nodes as well.

> ? ?2. When a queue (mirrored or not) is ?dinamically ?created ?by a client
> ? ?in a cluster enviroment , it is created on the client's node and not in any
> ? ?node of the cluster (so there is an automatic load balancing of queues in a
> ? ?cluster)

When declaring an HA (mirrored) queue, it may be mirrored across all
nodes specified in the queue parameter. In regards to "automatic load
balancing", if consumers are all connected to 1 out of N nodes in a
cluster, it is obviously not load balanced.

> ? ?3. If a client is connected to a mirrored queue and the master of the
> ? ?queue fails/goes down, a slave is defined as a new master and new
> ? ?connections go through the new node; but all old clients, that were using
> ? ?connections to the old master node, have dead channel and RabbitMQ don't
> ? ?create automatically connection to the new node.

In the process of being promoted to master, a slave queue will kick
off all of it's consumers (but not kill the connection obviously). The
recreation of these consumers must also be handled. Some higher level
client libraries support this. Spring Amqp (java/.NET) is one which
does to a certain degree at least. I believe Akka (java/scala) is also
able to take a collection of hosts and will attempt to reconnect to a
node on a different host if connection is lost.

>
> Are these sentences right?
>
> Thanks in advance!
> Luke
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From daverstevens at gmail.com  Thu Jan 12 16:12:14 2012
From: daverstevens at gmail.com (Dave Stevens)
Date: Thu, 12 Jan 2012 08:12:14 -0800 (PST)
Subject: [rabbitmq-discuss] Consumers from slave queues on different nodes
	and duplicate messages
Message-ID: <2b23eddb-0f97-4f21-b2e1-98f54e2fb47c@ck5g2000vbb.googlegroups.com>

When multiple consumers are consuming from a single, logical, HA queue
mirrored across N nodes, is there any potential for duplicate messages
beyond the documented case when a slave is promoted to master?

I am thinking specifically about the case when consumer A is consuming
from slave queue on node X and consumer B is consuming from slave
queue on node Y. From very superficial testing with noAck=true, it
appears as though the master queue only delivers a single msg to
either A or B as desired, yet I'm assuming it must notify the other
queue of the msgs existence. Is this in fact correct, or must I be
concerned with the msg arriving at BOTH A and B. Does this behavior
change when noAck=false since master is no longer Acking the message?

From simon at rabbitmq.com  Thu Jan 12 16:15:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Jan 2012 16:15:36 +0000
Subject: [rabbitmq-discuss] Consumers from slave queues on different
 nodes and duplicate messages
In-Reply-To: <2b23eddb-0f97-4f21-b2e1-98f54e2fb47c@ck5g2000vbb.googlegroups.com>
References: <2b23eddb-0f97-4f21-b2e1-98f54e2fb47c@ck5g2000vbb.googlegroups.com>
Message-ID: <4F0F0728.8040902@rabbitmq.com>

On 12/01/12 16:12, Dave Stevens wrote:
> I am thinking specifically about the case when consumer A is consuming
> from slave queue on node X and consumer B is consuming from slave
> queue on node Y.

This doesn't really happen.

A can consume from node X, and B from node Y, *but* internally to the 
cluster both are connected to the master node. That's pretty much what 
makes it the master. The reason for this is exactly the concern you 
raise :-)

So publishes go to all nodes, consumes just come from the master (which 
then informs the slaves so they drop the messages).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lukemanner at gmail.com  Thu Jan 12 16:26:14 2012
From: lukemanner at gmail.com (luke manner)
Date: Thu, 12 Jan 2012 17:26:14 +0100
Subject: [rabbitmq-discuss] Clustering,
 Mirrored queue and high availability in RabbitMQ
In-Reply-To: <55a4f04f-f3c2-4482-b844-30995ad7be90@z1g2000vbx.googlegroups.com>
References: <CAJBmP-Wc8pdXmtXy40Yd-Bo1brsnP2PRnGDLc8WZrVHq9Y1HrQ@mail.gmail.com>
	<55a4f04f-f3c2-4482-b844-30995ad7be90@z1g2000vbx.googlegroups.com>
Message-ID: <CAJBmP-VVsTZH1hxVyqo71XysGNi0haSLw1g4_mMHhRAFk7A-Nw@mail.gmail.com>

Thanks Dave for your reply.


>>1. If I have a mirrored queue, all consumers of this queue are all
>>    connected to the master queue and not to the slaves (slaves are used
for
>>    backup if master node fails).

>Consumers may be connected to slave nodes as well.


You're right, I didn't express myself in the correct way.
I wanted to say that if I have a mirrored queue and I have a consumer that
is connected to a slave node, a message is consumed from master queue and
not from slave queue; is this right?


2012/1/12 Dave Stevens <daverstevens at gmail.com>

> I believe all of these are at least partially incorrect and/or
> implementation dependent.
>
> On Jan 12, 4:04 am, luke manner <lukeman... at gmail.com> wrote:
> > Hi all,
> > we are studing/testing RabbitMQ in order to use it on a big project.
> >
> > I'd like to know if it is correct:
> >
> >    1. If I have a mirrored queue, all consumers of this queue are all
> >    connected to the master queue and not to the slaves (slaves are used
> for
> >    backup if master node fails).
>
> Consumers may be connected to slave nodes as well.
>
> >    2. When a queue (mirrored or not) is  dinamically  created  by a
> client
> >    in a cluster enviroment , it is created on the client's node and not
> in any
> >    node of the cluster (so there is an automatic load balancing of
> queues in a
> >    cluster)
>
> When declaring an HA (mirrored) queue, it may be mirrored across all
> nodes specified in the queue parameter. In regards to "automatic load
> balancing", if consumers are all connected to 1 out of N nodes in a
> cluster, it is obviously not load balanced.
>
> >    3. If a client is connected to a mirrored queue and the master of the
> >    queue fails/goes down, a slave is defined as a new master and new
> >    connections go through the new node; but all old clients, that were
> using
> >    connections to the old master node, have dead channel and RabbitMQ
> don't
> >    create automatically connection to the new node.
>
> In the process of being promoted to master, a slave queue will kick
> off all of it's consumers (but not kill the connection obviously). The
> recreation of these consumers must also be handled. Some higher level
> client libraries support this. Spring Amqp (java/.NET) is one which
> does to a certain degree at least. I believe Akka (java/scala) is also
> able to take a collection of hosts and will attempt to reconnect to a
> node on a different host if connection is lost.
>
> >
> > Are these sentences right?
> >
> > Thanks in advance!
> > Luke
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/d528be63/attachment.htm>

From simon at rabbitmq.com  Thu Jan 12 16:28:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Jan 2012 16:28:22 +0000
Subject: [rabbitmq-discuss] Clustering,
 Mirrored queue and high availability in RabbitMQ
In-Reply-To: <CAJBmP-VVsTZH1hxVyqo71XysGNi0haSLw1g4_mMHhRAFk7A-Nw@mail.gmail.com>
References: <CAJBmP-Wc8pdXmtXy40Yd-Bo1brsnP2PRnGDLc8WZrVHq9Y1HrQ@mail.gmail.com>	<55a4f04f-f3c2-4482-b844-30995ad7be90@z1g2000vbx.googlegroups.com>
	<CAJBmP-VVsTZH1hxVyqo71XysGNi0haSLw1g4_mMHhRAFk7A-Nw@mail.gmail.com>
Message-ID: <4F0F0A26.9040108@rabbitmq.com>

On 12/01/12 16:26, luke manner wrote:
> You're right, I didn't express myself in the correct way.
> I wanted to say that if I have a mirrored queue and I have a consumer
> that is connected to a slave node, a message is consumed from master
> queue and not from slave queue; is this right?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Thu Jan 12 16:39:06 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 12 Jan 2012 16:39:06 +0000
Subject: [rabbitmq-discuss] rabbitmq-c API improvements for multiple
	channels
In-Reply-To: <CAAt2poJqy+pwASwhbChmAbF569w3xHM02sFJwNJ3ZSVKX8MoxA@mail.gmail.com>
References: <CAAt2poJqy+pwASwhbChmAbF569w3xHM02sFJwNJ3ZSVKX8MoxA@mail.gmail.com>
Message-ID: <CACOPnvfx14ctnj2j+aE00icET7VugteBN6Vw5EgikROJMHh0_Q@mail.gmail.com>

Alan

It appears that you stunned everyone into silence ;-)

How are you getting on with this?

alexis


On Wed, Dec 14, 2011 at 8:15 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:
> I've been working on a c++ wrapper around rabbitmq-c that presents a
> "humane" API to the programmer heavily inspired by the Puka project.
> (see:?https://github.com/alanxz/SimpleAmqpClient).
>
> In developing this library I've run across several limitations of the
> rabbitmq-c when working with multiple channels, the biggest issue being:
>
> - There is no way to wait for a list of methods on a channel.
> There is amqp_simple_wait_method() - however this suffers from some serious
> drawbacks:
> + you can only specify one method to listen for
> + it calls abort() if a different method, or a method on a different channel
> is received
> A use case for this might be: doing a basic.publish, and you want to want to
> wait for a basic.ack or a basic.return on a channel with confirms enabled
>
> The way I got around this in SimpleAmqpClient was to only use
> amqp_simple_wait_frame() and maintain queues of amqp_frame_t for each
> channel that I have open.
>
> However, this comes with one serious drawback: memory management. Each
> decoded frame is allocated in a connection-wide amqp_pool_t. ?Because of
> this - it is impossible to recycle the pool and release memory unless you
> have dealt with all of your pending amqp_frame_t's. ?This becomes a problem
> in?pathological?cases where you have two consumers sending simultaneously,
> you can get in the situation that even though the client program eventually
> deals with every consumed message, memory never gets released, because there
> is always at least one frame queued up.
>
> The above demonstrates the second biggest issue with the rabbitmq-c API:
> memory management when dealing with multiple channels. ?There is no way to
> separate out memory allocation on, for example, a per-channel basis (with
> the library client keeping track of the memory pools used for example).
>
> Before I go on I'd like to mention one feature that I find useful with the
> current API: it is possible to use something like select() before calling
> amqp_simple_wait_frame() to setup a timeout while waiting for a consumer,
> which is useful when developing single-threaded RPC apps.
>
>
> So now the interesting part: how could the API be improved?
>
> Some thoughts I've had dealing with the memory management:
> 1. Create a amqp_simple_wait_frame() variant that as one of the parameters
> provides a callback to allocate memory, either something like a malloc()
> call, which the client would then be responsible for freeing, or perhaps
> something like get_amqp_pool(amqp_frame_t) which allows the client to return
> a memory pool which rabbitmq-c would use to allocate memory for that frame.
> ?The amqp_frame_t would have to have some minimal amount of information
> filled in - such as frame type and channel to be useful.
>
> 2. amqp_channel_t becomes a struct containing both the the channel_id and a
> amqp_pool_t. ?The amqp_pool would be used by the library to allocate frames
> received on that channel. ?The client would then be responsible for calling
> amqp_pool_recycle at an appropriate point.
>
> Some thoughts on improving the API to deal with multiple channels:
> 1. Add the following to the API:
> amqp_simple_wait_frame_on_channel - wait for a frame on a specified channel
> amqp_simple_wait_methods - wait for multiple methods on a specified channel.
> Don't abort() if the wrong method, or channel is received, instead queue up
> the frame as is done in amqp_simple_rpc
> amqp_frames_enqueued_for_channel to add feature parity with
> amqp_frames_enqueued
> I started to code this up at one point but abandoned it as it didn't support
> the interesting property of being able to use select() to specify a timeout
> when calling amqp_simple_wait_frame_on_channel. ?At least not without adding
> timeout to the rabbitmq-c api, which didn't fit with how the current
> rabbitmq-c api. Here's the implementation I came up with before I abandoned
> it. I can't guarantee is completely free of
> bugs.?https://github.com/alanxz/rabbitmq-c/commits/simple_wait_frame/
>
> 2. Continue to duck the issue and allow clients to write their own code to
> deal with multiple channels (fixing the memory management issue using one of
> the above techniques)
>
> 3. Something I haven't thought of yet.
>
> So anyone have any thoughts on all of this?
>
> -Alan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From contact at jimeh.me  Thu Jan 12 16:41:58 2012
From: contact at jimeh.me (Jim Myhrberg)
Date: Thu, 12 Jan 2012 16:41:58 +0000
Subject: [rabbitmq-discuss] High publish rates, mirrored queues,
	high watermark...
Message-ID: <9BA1A4042F8141F8973C36034BCFDFB2@jimeh.me>

Hi, I was hoping you guys would be able to answer some quick questions about an issue we're having.

We've recently started using mirrored queues across two RabbitMQ instances on two servers, and it's working really well except for when publish rates are really high for a longer period of time. At that point RabbitMQ starts eating a lot of memory on the master node until it hits our high watermark limit of 18.9GB, at which point things basically stop working.

My theory of what is happening is that when RabbitMQ can't process incoming publish requests fast enough, it caches the raw TCP packets in memory until it can deal with them and direct it to the queue(s) in question. And I'm assuming the fact that we are using mirrored queues adds overhead in dealing with a publish request as it needs to be synced to the other node(s). Am I right?

My theory is based on the fact that we could deal with much higher publish rates without and problems before we switched to mirrored queues. And the fact that we've had a few points when memory usage has been excessive we've seen queues that were completely empty according to the management plugin, but our workers were still processing +1000 messages/sec for a good hour, all the while the management plugin said no incoming messages, and +1000 msg/s get/acks.

Thanks :)


-jim 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/602e7f4d/attachment.htm>

From simon at rabbitmq.com  Thu Jan 12 17:23:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Jan 2012 17:23:26 +0000
Subject: [rabbitmq-discuss] High publish rates, mirrored queues,
 high watermark...
In-Reply-To: <9BA1A4042F8141F8973C36034BCFDFB2@jimeh.me>
References: <9BA1A4042F8141F8973C36034BCFDFB2@jimeh.me>
Message-ID: <4F0F170E.4010501@rabbitmq.com>

On 12/01/12 16:41, Jim Myhrberg wrote:
> Hi, I was hoping you guys would be able to answer some quick questions
> about an issue we're having.

Hi Jim.

> We've recently started using mirrored queues across two RabbitMQ
> instances on two servers, and it's working really well except for when
> publish rates are really high for a longer period of time. At that point
> RabbitMQ starts eating a lot of memory on the master node until it hits
> our high watermark limit of 18.9GB, at which point things basically stop
> working.
>
> My theory of what is happening is that when RabbitMQ can't process
> incoming publish requests fast enough, it caches the raw TCP packets in
> memory until it can deal with them and direct it to the queue(s) in
> question.

This is approximately true. In fact RabbitMQ can be viewed as a 
pipeline, when publishing over AMQP it would look like:

(OS TCP buffer) -> [reader] -> [channel] -> [queue] -> etc...

Each of the square bracketed things is an Erlang process. The reader 
(aka connection) disassembles packets into AMQP methods (most frequently 
basic.publish). The channel applies those methods (in the case of basic 
publish by making routing decisions, checking security, etc). And then 
there's the queue.

The Erlang processes communicate by message passing - so each process 
has a mailbox which contains messages which have been sent on by the 
previous stage but not yet handled.

The OS manages the size of the TCP buffer and in general it won't be 
able to contain *too* huge a number of messages, but the process 
mailboxes can grow arbitrarily large when you publish "too fast" for the 
queue to keep up. And that's where most of your memory is going I'll bet.

The theory was that more and more memory will get used up by the process 
mailboxes and eventually the memory alarm will go off, which will cause 
all the readers to block while Rabbit sorts itself out. However, by this 
stage there can be a huge amount of work to do (ironically the more 
memory you have the worse off you are), and everything grinds to a halt 
for potentially a very long time.

The good news is that we're working (right now, by lucky coincidence) on 
a system of internal flow control that will prevent the process 
mailboxes from becoming too big. This means that a publisher which is 
publishing "too fast" for a queue to handle will get pushed back on much 
more rapidly (within a second or so rather than after memory fills up).

This feature is likely to be in the next release, but if you can't wait 
until then you can improve matters considerably by using confirms and 
only allowing each publisher to have (e.g.) 1000 unconfirmed messages. 
You won't get a confirm back until the message has hit the queue, so you 
bound the number of in-flight messages.

Arguably you should be doing that anyway - if your messages are 
important enough that they need to go to mirrored queues they are 
probably important enough that the publisher needs confirmation that 
they've been accepted by the broker.

> And I'm assuming the fact that we are using mirrored queues
> adds overhead in dealing with a publish request as it needs to be synced
> to the other node(s). Am I right?

Yes, very much so. Mirrored queues are noticeably slower than 
non-mirrored ones due to the extra work involved. And also they're newer 
and not as heavily optimised.

> My theory is based on the fact that we could deal with much higher
> publish rates without and problems before we switched to mirrored
> queues. And the fact that we've had a few points when memory usage has
> been excessive we've seen queues that were completely empty according to
> the management plugin, but our workers were still processing +1000
> messages/sec for a good hour, all the while the management plugin said
> no incoming messages, and +1000 msg/s get/acks.

Yes, that's exactly consistent with messages being backed up in process 
mailboxes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From static.void.dev at gmail.com  Thu Jan 12 17:30:35 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 12 Jan 2012 09:30:35 -0800
Subject: [rabbitmq-discuss] RabbitMQ HA
Message-ID: <4F0F18BB.7080508@gmail.com>

Hi all,

I was wondering if I could get some advice on RabbitMQ HA. I've read 
that RabbitMQ has clustering out of the box but that only helps with 
load correct? IE, if one RabbitMQ broker can not handle all of our 
traffic then we should look into clustering correct? Since we will be 
slowly rolling out our RabbitMQ implementation I don't think load will 
be our initial problem. Instead we want to be able to gracefully handle 
an outage of one or more RabbitMQ machines. How is this traditionally 
handled? Is there any built in replication similar to a master-master 
database setup?

Any ideas?

Thanks

From lukas.zielinski at googlemail.com  Thu Jan 12 17:18:24 2012
From: lukas.zielinski at googlemail.com (lukas)
Date: Thu, 12 Jan 2012 09:18:24 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbit forgetting users after shutting down both
	cluster-nodes
Message-ID: <494adb6b-576b-4e11-8651-e58658f8b673@z1g2000vbx.googlegroups.com>

We have a strange problem.

Setup: Two rabbitmq-nodes (v. 2.5.1) running as a cluster, one user
(added with rabbitmqctl add_user and set_permissions), system is Linux
2.6.32

The following happens:

1. Both nodes running normally
2. First node is stopped (rabbitmqctl stop_app) -> our client switches
to 2nd node
3. Second node is stopped -> client diconnects
4. First node is started again -> client can't connect because the
user is gone. ( there is only the default user "guest")

How can this happen?



From alexis at rabbitmq.com  Thu Jan 12 17:33:55 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 12 Jan 2012 17:33:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ HA
In-Reply-To: <4F0F18BB.7080508@gmail.com>
References: <4F0F18BB.7080508@gmail.com>
Message-ID: <CACOPnvfhbpPdKrNhyE5bbeowBhWeMi+W3wM+Vt5hs0a9PenkZA@mail.gmail.com>

Mark

Does this help?  http://www.rabbitmq.com/ha.html

alexis


On Thu, Jan 12, 2012 at 5:30 PM, Mark <static.void.dev at gmail.com> wrote:
> Hi all,
>
> I was wondering if I could get some advice on RabbitMQ HA. I've read that
> RabbitMQ has clustering out of the box but that only helps with load
> correct? IE, if one RabbitMQ broker can not handle all of our traffic then
> we should look into clustering correct? Since we will be slowly rolling out
> our RabbitMQ implementation I don't think load will be our initial problem.
> Instead we want to be able to gracefully handle an outage of one or more
> RabbitMQ machines. How is this traditionally handled? Is there any built in
> replication similar to a master-master database setup?
>
> Any ideas?
>
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.poole at rsa.com  Thu Jan 12 17:55:59 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Thu, 12 Jan 2012 12:55:59 -0500
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <CAOn7oW_PB-yP4SsQaW9Tq4-r9WS0P2PRNVuEFJf5pj4ED0naxQ@mail.gmail.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>
	<CAOn7oW_PB-yP4SsQaW9Tq4-r9WS0P2PRNVuEFJf5pj4ED0naxQ@mail.gmail.com>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6246@MX36A.corp.emc.com>

Simone, that would be great if you could try to reproduce it.

 

As mentioned, we are creating 2000 consumers each with their own queue bound
to a fanout exchange.  After the queues have all been created and bound, a
producer publishes a 2 MB message to this fanout exchange once every second
for 50 seconds.

 

All queues are non-durable.  And autoAck was set to false in the Java
client.

 

Everything hums along until the vm_memory_high_watermark is triggered and
then we see the crash.  One interesting thing is that in the log it still
shows it accepting and starting tcp connections after the memory alarm is
triggered (for around 15 seconds before the crash).  I thought this was
supposed to block until the memory was under control?

 

-James

 

From: Simone Busoli [mailto:simone.busoli at gmail.com] 
Sent: Wednesday, January 11, 2012 3:02 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com; Kuch, Jerry (VMware)
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
under Load

 

Hi James,

If you can provide more details about the load you're applying to the broker
I would be glad to try to reproduce it.
We've been using RabbitMQ on Windows in production for some months now and
didn't experience any weird behavior.
What I'm interested in is whether entities and messages are durable, if you
use transactions or publisher confirms and the like.

On Jan 11, 2012 7:52 PM, <james.poole at rsa.com> wrote:

Yeah, I should have mentioned that we started out testing with the 64-bit
version and found this issue... though the VM probably didn't have very much
more memory than a 32-bit address space would provide.  Then we backed down
to the 32-bit version to see if it went away, but it didn't.

I will see if we can send out the test program (it's just a simple java app
using the rabbitmq-java-client-2.7.1).  If I can send it out, how would I go
about this... attach to the email or upload it to a server somewhere?

-James

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
under Load

James:  Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment?  The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help).  I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us?  If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under
Load





We've let loose one of our testing ninjas on RabbitMQ for load testing, and
we're consistently running into issues when the high memory watermark is
hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second,
for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high
watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.R vCenter Lab Manager 4.0 (4.0.3.1318)



One other note is that we see the same problem with ERL R14B04 and Rabbit
2.7.0.



I have looked through the log file and also turned on the console debug
output, and nothing seems to be jumping out as an error. If needed, I can
upload the minidump from the Blue Screen and the ERL crash dump file, just
point me where to do it.



Let me know if there is anything else I can do to try and help get this
fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds
before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only
message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and
Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/d8747951/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/d8747951/attachment.bin>

From simone.busoli at gmail.com  Thu Jan 12 18:02:41 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 12 Jan 2012 19:02:41 +0100
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6246@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>
	<CAOn7oW_PB-yP4SsQaW9Tq4-r9WS0P2PRNVuEFJf5pj4ED0naxQ@mail.gmail.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F6246@MX36A.corp.emc.com>
Message-ID: <CAOn7oW_jaitQT=Xw=YMqVfEKfiFNRYSD2zNf69=5p1sog11hqQ@mail.gmail.com>

Are you acking messages? If you don't, those messages will have to be
stored somewhere and 2000 * 2MB * 1/s = 4 GB/s

On Thu, Jan 12, 2012 at 18:55, <james.poole at rsa.com> wrote:

> Simone, that would be great if you could try to reproduce it.****
>
> ** **
>
> As mentioned, we are creating 2000 consumers each with their own queue
> bound to a fanout exchange.  After the queues have all been created and
> bound, a producer publishes a 2 MB message to this fanout exchange once
> every second for 50 seconds.****
>
> ** **
>
> All queues are non-durable.  And autoAck was set to false in the Java
> client.****
>
> ** **
>
> Everything hums along until the vm_memory_high_watermark is triggered and
> then we see the crash.  One interesting thing is that in the log it still
> shows it accepting and starting tcp connections after the memory alarm is
> triggered (for around 15 seconds before the crash).  I thought this was
> supposed to block until the memory was under control?****
>
> ** **
>
> -James****
>
> ** **
>
> *From:* Simone Busoli [mailto:simone.busoli at gmail.com]
> *Sent:* Wednesday, January 11, 2012 3:02 PM
> *To:* Poole, James
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com; Kuch, Jerry (VMware)
>
> *Subject:* Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue
> Screens under Load****
>
> ** **
>
> Hi James,****
>
> If you can provide more details about the load you're applying to the
> broker I would be glad to try to reproduce it.
> We've been using RabbitMQ on Windows in production for some months now and
> didn't experience any weird behavior.
> What I'm interested in is whether entities and messages are durable, if
> you use transactions or publisher confirms and the like.****
>
> On Jan 11, 2012 7:52 PM, <james.poole at rsa.com> wrote:****
>
> Yeah, I should have mentioned that we started out testing with the 64-bit
> version and found this issue... though the VM probably didn't have very
> much more memory than a 32-bit address space would provide.  Then we backed
> down to the 32-bit version to see if it went away, but it didn't.
>
> I will see if we can send out the test program (it's just a simple java
> app using the rabbitmq-java-client-2.7.1).  If I can send it out, how would
> I go about this... attach to the email or upload it to a server somewhere?
>
> -James
>
> -----Original Message-----
> From: Jerry Kuch [mailto:jerryk at vmware.com]
> Sent: Wednesday, January 11, 2012 1:44 PM
> To: Poole, James
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
> under Load
>
> James:  Out of curiousity have you tried the new 64-bit release of
> Erlang for Windows in your environment?  The address space size
> limitations of the 32-bit version have been associated with crashy
> Rabbits in the past (although bringing your memory high watermark
> value down so that the back-pressure mechanisms engage when the
> broker is in less trouble may help).  I think you can scare up the
> new Erlang here:
>
> http://www.erlang.org/download/otp_win64_R15B.exe
>
> Until recently there was no 64-bit Erlang, so even those running on
> 64-bit Windows boxes were still relegated to 32-bit VMs.
>
> I am curious about the different results between a physical machine
> and a virtualized one, with one showing a "clean" Erlang VM crash and
> the other exhibiting a blue-screen, fatal OS-wrecker...
>
> Is the traffic you're using to bring these systems down part of a
> large or proprietary app, or can you extract a bare minimum piece
> of code that brings the pain and share it with us?  If you could
> do the latter we could more easily investigate the situation within
> VMware since the difference in behavior between baremetal and
> virtualization is disquieting...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "james poole" <james.poole at rsa.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, January 11, 2012 10:32:23 AM
> Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
> under     Load
>
>
>
>
>
> We?ve let loose one of our testing ninjas on RabbitMQ for load testing,
> and we?re consistently running into issues when the high memory watermark
> is hit.
>
>
>
> Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1
>
>
>
> 2,000 Consumers each with their own queue bound to a direct exchange
>
> 1 Producer, publishing a 2 MB message to the exchange, once every second,
> for a total of 50 seconds
>
>
>
> Everything behaves as expected, until the memory footprint hits the high
> watermark, at which point:
>
> On a physical machine: ERL process crashes and dump file is created
>
> On a Virtual Machine: Blue Screen of Death is shown and server reboots
>
>
>
> VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318)
>
>
>
> One other note is that we see the same problem with ERL R14B04 and Rabbit
> 2.7.0.
>
>
>
> I have looked through the log file and also turned on the console debug
> output, and nothing seems to be jumping out as an error. If needed, I can
> upload the minidump from the Blue Screen and the ERL crash dump file, just
> point me where to do it.
>
>
>
> Let me know if there is anything else I can do to try and help get this
> fixed.
>
>
>
>
>
>
>
> In the rabbit log, there are no errors, and only a few warnings 20 seconds
> before the crash:
>
>
>
> =INFO REPORT==== 11-Jan-2012::10:55:53 ===
>
> closing TCP connection <0.4405.0> from 10.6.64.104:57830
>
>
>
> =WARNING REPORT==== 11-Jan-2012::10:55:53 ===
>
> exception on TCP connection <0.20552.0> from 10.6.64.104:59521
>
> connection_closed_abruptly
>
>
>
>
>
> In the console output log file for the physical machine, this is the only
> message I see:
>
>
>
> starting direct_client ...done
>
> starting notify cluster nodes ...done
>
>
>
> broker running
>
> Eshell V5.9 (abort with ^G)
>
> (rabbit at QEDLP082)1>
>
> Crash dump was written to: C:/Documents and
> Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump
>
> eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").
>
> in message_loop
>
> win32sysinfo:Erlang has closed.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/c025f33d/attachment.htm>

From james.poole at rsa.com  Thu Jan 12 18:17:03 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Thu, 12 Jan 2012 13:17:03 -0500
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <CAOn7oW_jaitQT=Xw=YMqVfEKfiFNRYSD2zNf69=5p1sog11hqQ@mail.gmail.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>
	<CAOn7oW_PB-yP4SsQaW9Tq4-r9WS0P2PRNVuEFJf5pj4ED0naxQ@mail.gmail.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F6246@MX36A.corp.emc.com>
	<CAOn7oW_jaitQT=Xw=YMqVfEKfiFNRYSD2zNf69=5p1sog11hqQ@mail.gmail.com>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6256@MX36A.corp.emc.com>

We are sending the Ack from the consumer side after the message is
delivered.  I will try setting autoAck to true and see if that makes a
difference.

 

I thought Rabbit was smart enough to just keep one copy of a message for a
fanout?  Does it really create 2000 separate copies of the same message in
memory, or does it just do this when the message is being sent?

 

-James

 

From: Simone Busoli [mailto:simone.busoli at gmail.com] 
Sent: Thursday, January 12, 2012 1:03 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com; Kuch, Jerry (VMware)
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
under Load

 

Are you acking messages? If you don't, those messages will have to be stored
somewhere and 2000 * 2MB * 1/s = 4 GB/s

On Thu, Jan 12, 2012 at 18:55, <james.poole at rsa.com> wrote:

Simone, that would be great if you could try to reproduce it.

 

As mentioned, we are creating 2000 consumers each with their own queue bound
to a fanout exchange.  After the queues have all been created and bound, a
producer publishes a 2 MB message to this fanout exchange once every second
for 50 seconds.

 

All queues are non-durable.  And autoAck was set to false in the Java
client.

 

Everything hums along until the vm_memory_high_watermark is triggered and
then we see the crash.  One interesting thing is that in the log it still
shows it accepting and starting tcp connections after the memory alarm is
triggered (for around 15 seconds before the crash).  I thought this was
supposed to block until the memory was under control?

 

-James

 

From: Simone Busoli [mailto:simone.busoli at gmail.com] 
Sent: Wednesday, January 11, 2012 3:02 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com; Kuch, Jerry (VMware)


Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
under Load

 

Hi James,

If you can provide more details about the load you're applying to the broker
I would be glad to try to reproduce it.
We've been using RabbitMQ on Windows in production for some months now and
didn't experience any weird behavior.
What I'm interested in is whether entities and messages are durable, if you
use transactions or publisher confirms and the like.

On Jan 11, 2012 7:52 PM, <james.poole at rsa.com> wrote:

Yeah, I should have mentioned that we started out testing with the 64-bit
version and found this issue... though the VM probably didn't have very much
more memory than a 32-bit address space would provide.  Then we backed down
to the 32-bit version to see if it went away, but it didn't.

I will see if we can send out the test program (it's just a simple java app
using the rabbitmq-java-client-2.7.1).  If I can send it out, how would I go
about this... attach to the email or upload it to a server somewhere?

-James

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
under Load

James:  Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment?  The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help).  I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us?  If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under
Load





We've let loose one of our testing ninjas on RabbitMQ for load testing, and
we're consistently running into issues when the high memory watermark is
hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second,
for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high
watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.R vCenter Lab Manager 4.0 (4.0.3.1318)



One other note is that we see the same problem with ERL R14B04 and Rabbit
2.7.0.



I have looked through the log file and also turned on the console debug
output, and nothing seems to be jumping out as an error. If needed, I can
upload the minidump from the Blue Screen and the ERL crash dump file, just
point me where to do it.



Let me know if there is anything else I can do to try and help get this
fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds
before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only
message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and
Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/cb3bc629/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/cb3bc629/attachment.bin>

From simone.busoli at gmail.com  Thu Jan 12 18:22:22 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 12 Jan 2012 19:22:22 +0100
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6256@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>
	<CAOn7oW_PB-yP4SsQaW9Tq4-r9WS0P2PRNVuEFJf5pj4ED0naxQ@mail.gmail.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F6246@MX36A.corp.emc.com>
	<CAOn7oW_jaitQT=Xw=YMqVfEKfiFNRYSD2zNf69=5p1sog11hqQ@mail.gmail.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F6256@MX36A.corp.emc.com>
Message-ID: <CAOn7oW8c9=hz1V8NRYhqxbCutNcJicwL3o0Az__UX6MRhwcstA@mail.gmail.com>

I'm honestly not sure, please take my last mail with a grain of salt, I
might have hit send too fast. I always assumed that each queue would get
its own copy of a message, but in fact it's totally sensible for RabbitMQ
to keep only one copy of the message in such case.
The devs will be able to shed some more light on this, I just meant to
point out that big unacked messages may lead to problems as they need to be
stored somewhere.

On Thu, Jan 12, 2012 at 19:17, <james.poole at rsa.com> wrote:

> We are sending the Ack from the consumer side after the message is
> delivered.  I will try setting autoAck to true and see if that makes a
> difference.****
>
> ** **
>
> I thought Rabbit was smart enough to just keep one copy of a message for a
> fanout?  Does it really create 2000 separate copies of the same message in
> memory, or does it just do this when the message is being sent?****
>
> ** **
>
> -James****
>
> ** **
>
> *From:* Simone Busoli [mailto:simone.busoli at gmail.com]
> *Sent:* Thursday, January 12, 2012 1:03 PM
>
> *To:* Poole, James
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com; Kuch, Jerry (VMware)
> *Subject:* Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue
> Screens under Load****
>
> ** **
>
> Are you acking messages? If you don't, those messages will have to be
> stored somewhere and 2000 * 2MB * 1/s = 4 GB/s****
>
> On Thu, Jan 12, 2012 at 18:55, <james.poole at rsa.com> wrote:****
>
> Simone, that would be great if you could try to reproduce it.****
>
>  ****
>
> As mentioned, we are creating 2000 consumers each with their own queue
> bound to a fanout exchange.  After the queues have all been created and
> bound, a producer publishes a 2 MB message to this fanout exchange once
> every second for 50 seconds.****
>
>  ****
>
> All queues are non-durable.  And autoAck was set to false in the Java
> client.****
>
>  ****
>
> Everything hums along until the vm_memory_high_watermark is triggered and
> then we see the crash.  One interesting thing is that in the log it still
> shows it accepting and starting tcp connections after the memory alarm is
> triggered (for around 15 seconds before the crash).  I thought this was
> supposed to block until the memory was under control?****
>
>  ****
>
> -James****
>
>  ****
>
> *From:* Simone Busoli [mailto:simone.busoli at gmail.com]
> *Sent:* Wednesday, January 11, 2012 3:02 PM
> *To:* Poole, James
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com; Kuch, Jerry (VMware)****
>
>
> *Subject:* Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue
> Screens under Load****
>
>  ****
>
> Hi James,****
>
> If you can provide more details about the load you're applying to the
> broker I would be glad to try to reproduce it.
> We've been using RabbitMQ on Windows in production for some months now and
> didn't experience any weird behavior.
> What I'm interested in is whether entities and messages are durable, if
> you use transactions or publisher confirms and the like.****
>
> On Jan 11, 2012 7:52 PM, <james.poole at rsa.com> wrote:****
>
> Yeah, I should have mentioned that we started out testing with the 64-bit
> version and found this issue... though the VM probably didn't have very
> much more memory than a 32-bit address space would provide.  Then we backed
> down to the 32-bit version to see if it went away, but it didn't.
>
> I will see if we can send out the test program (it's just a simple java
> app using the rabbitmq-java-client-2.7.1).  If I can send it out, how would
> I go about this... attach to the email or upload it to a server somewhere?
>
> -James
>
> -----Original Message-----
> From: Jerry Kuch [mailto:jerryk at vmware.com]
> Sent: Wednesday, January 11, 2012 1:44 PM
> To: Poole, James
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
> under Load
>
> James:  Out of curiousity have you tried the new 64-bit release of
> Erlang for Windows in your environment?  The address space size
> limitations of the 32-bit version have been associated with crashy
> Rabbits in the past (although bringing your memory high watermark
> value down so that the back-pressure mechanisms engage when the
> broker is in less trouble may help).  I think you can scare up the
> new Erlang here:
>
> http://www.erlang.org/download/otp_win64_R15B.exe
>
> Until recently there was no 64-bit Erlang, so even those running on
> 64-bit Windows boxes were still relegated to 32-bit VMs.
>
> I am curious about the different results between a physical machine
> and a virtualized one, with one showing a "clean" Erlang VM crash and
> the other exhibiting a blue-screen, fatal OS-wrecker...
>
> Is the traffic you're using to bring these systems down part of a
> large or proprietary app, or can you extract a bare minimum piece
> of code that brings the pain and share it with us?  If you could
> do the latter we could more easily investigate the situation within
> VMware since the difference in behavior between baremetal and
> virtualization is disquieting...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "james poole" <james.poole at rsa.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, January 11, 2012 10:32:23 AM
> Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
> under     Load
>
>
>
>
>
> We?ve let loose one of our testing ninjas on RabbitMQ for load testing,
> and we?re consistently running into issues when the high memory watermark
> is hit.
>
>
>
> Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1
>
>
>
> 2,000 Consumers each with their own queue bound to a direct exchange
>
> 1 Producer, publishing a 2 MB message to the exchange, once every second,
> for a total of 50 seconds
>
>
>
> Everything behaves as expected, until the memory footprint hits the high
> watermark, at which point:
>
> On a physical machine: ERL process crashes and dump file is created
>
> On a Virtual Machine: Blue Screen of Death is shown and server reboots
>
>
>
> VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318)
>
>
>
> One other note is that we see the same problem with ERL R14B04 and Rabbit
> 2.7.0.
>
>
>
> I have looked through the log file and also turned on the console debug
> output, and nothing seems to be jumping out as an error. If needed, I can
> upload the minidump from the Blue Screen and the ERL crash dump file, just
> point me where to do it.
>
>
>
> Let me know if there is anything else I can do to try and help get this
> fixed.
>
>
>
>
>
>
>
> In the rabbit log, there are no errors, and only a few warnings 20 seconds
> before the crash:
>
>
>
> =INFO REPORT==== 11-Jan-2012::10:55:53 ===
>
> closing TCP connection <0.4405.0> from 10.6.64.104:57830
>
>
>
> =WARNING REPORT==== 11-Jan-2012::10:55:53 ===
>
> exception on TCP connection <0.20552.0> from 10.6.64.104:59521
>
> connection_closed_abruptly
>
>
>
>
>
> In the console output log file for the physical machine, this is the only
> message I see:
>
>
>
> starting direct_client ...done
>
> starting notify cluster nodes ...done
>
>
>
> broker running
>
> Eshell V5.9 (abort with ^G)
>
> (rabbit at QEDLP082)1>
>
> Crash dump was written to: C:/Documents and
> Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump
>
> eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").
>
> in message_loop
>
> win32sysinfo:Erlang has closed.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
> ** **
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/8cd47e0c/attachment.htm>

From mridusmita.talukdar at wipro.com  Thu Jan 12 19:04:32 2012
From: mridusmita.talukdar at wipro.com (mridusmita.talukdar at wipro.com)
Date: Thu, 12 Jan 2012 19:04:32 +0000
Subject: [rabbitmq-discuss] Clarification needed for HA of RabbitMQ
	statistics database
Message-ID: <B37E5D4168FAA74FAF8AA88EC8018BCB048ACBB0@BLR-SJP-MBX6.wipro.com>

Hi,

In the RabbitMQ documentation there is a mention about how the management plugin works in a cluster, and from what I understand these are the main points:

1.       The management plugin can be installed on one or more nodes in the cluster

2.       Cluster nodes which do not have full management plugin will need to have an management-agent plugin installed on them

3.       The management plugin installs a database into RabbitMQ. In a RabbitMQ cluster there will be only one copy of the statistics database located in the first node to come up that has full management plugin installed. If that node goes down then statistics information will be missing.

My question is: Isn't there any other way by which we can make the statistics database highly available? Because our requirement is that, we would like to review the statistics on a monthly basis, but in case the lone node goes down within that period, we lose all the information.

Thanks and regards,
Mridu


Please do not print this email unless it is absolutely necessary. 

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. 

WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. 

www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120112/12120614/attachment.htm>

From static.void.dev at gmail.com  Thu Jan 12 20:51:23 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 12 Jan 2012 12:51:23 -0800
Subject: [rabbitmq-discuss] Number of queues and messages
Message-ID: <4F0F47CB.2070800@gmail.com>

Is there any hard limit on the number of queues and/or messages one 
RabbitMQ broker can handle? I'm guessing it would be bound by available 
ram on the machine? How about if queues and messages are persisted?

From videlalvaro at gmail.com  Thu Jan 12 20:53:48 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 12 Jan 2012 21:53:48 +0100
Subject: [rabbitmq-discuss] Number of queues and messages
In-Reply-To: <4F0F47CB.2070800@gmail.com>
References: <4F0F47CB.2070800@gmail.com>
Message-ID: <A0CECFDB-52FB-48E7-89DF-CC621F84CE27@gmail.com>

Hi,

Not that I want to do shameless self promotion but on Chapter 11 of RabbitMQ in Action we cover in detail memory usage by queues, exchanges  and bindings.

Cheers,

Alvaro

On Jan 12, 2012, at 9:51 PM, Mark wrote:

> Is there any hard limit on the number of queues and/or messages one RabbitMQ broker can handle? I'm guessing it would be bound by available ram on the machine? How about if queues and messages are persisted?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From daverstevens at gmail.com  Thu Jan 12 23:18:00 2012
From: daverstevens at gmail.com (Dave Stevens)
Date: Thu, 12 Jan 2012 15:18:00 -0800 (PST)
Subject: [rabbitmq-discuss] Clustering,
	Mirrored queue and high availability in RabbitMQ
In-Reply-To: <55a4f04f-f3c2-4482-b844-30995ad7be90@z1g2000vbx.googlegroups.com>
References: <CAJBmP-Wc8pdXmtXy40Yd-Bo1brsnP2PRnGDLc8WZrVHq9Y1HrQ@mail.gmail.com>
	<55a4f04f-f3c2-4482-b844-30995ad7be90@z1g2000vbx.googlegroups.com>
Message-ID: <6d80d5c8-672f-49b5-a0b7-b82b6ca7b954@h13g2000vbn.googlegroups.com>

Just to clarify, it unfortunately appears that the java Spring AMQP
1.0.0.Release client does not restart the consumer on slave promotion
to master as I expected. It does automatically reconnect on
disconnect, but in the case of slave promotion to master, there is no
disconnect.

On Jan 12, 11:00?am, Dave Stevens <daverstev... at gmail.com> wrote:
> I believe all of these are at least partially incorrect and/or
> implementation dependent.
>
> On Jan 12, 4:04?am, luke manner <lukeman... at gmail.com> wrote:
>
> > Hi all,
> > we are studing/testing RabbitMQ in order to use it on a big project.
>
> > I'd like to know if it is correct:
>
> > ? ?1. If I have a mirrored queue, all consumers of this queue are all
> > ? ?connected to the master queue and not to the slaves (slaves are used for
> > ? ?backup if master node fails).
>
> Consumers may be connected to slave nodes as well.
>
> > ? ?2. When a queue (mirrored or not) is ?dinamically ?created ?by a client
> > ? ?in a cluster enviroment , it is created on the client's node and not in any
> > ? ?node of the cluster (so there is an automatic load balancing of queues in a
> > ? ?cluster)
>
> When declaring an HA (mirrored) queue, it may be mirrored across all
> nodes specified in the queue parameter. In regards to "automatic load
> balancing", if consumers are all connected to 1 out of N nodes in a
> cluster, it is obviously not load balanced.
>
> > ? ?3. If a client is connected to a mirrored queue and the master of the
> > ? ?queue fails/goes down, a slave is defined as a new master and new
> > ? ?connections go through the new node; but all old clients, that were using
> > ? ?connections to the old master node, have dead channel and RabbitMQ don't
> > ? ?create automatically connection to the new node.
>
> In the process of being promoted to master, a slave queue will kick
> off all of it's consumers (but not kill the connection obviously). The
> recreation of these consumers must also be handled. Some higher level
> client libraries support this. Spring Amqp (java/.NET) is one which
> does to a certain degree at least. I believe Akka (java/scala) is also
> able to take a collection of hosts and will attempt to reconnect to a
> node on a different host if connection is lost.
>
>
>
> > Are these sentences right?
>
> > Thanks in advance!
> > Luke
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Thu Jan 12 23:37:05 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 12 Jan 2012 15:37:05 -0800 (PST)
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
	under Load
In-Reply-To: <CAOn7oW8c9=hz1V8NRYhqxbCutNcJicwL3o0Az__UX6MRhwcstA@mail.gmail.com>
Message-ID: <b41e729b-72c1-46c4-be82-45a74b294163@CoachZ.local>

Simone and James:

James's assumption is generally right.  Fanout does *not* require actual,
literal copies of a message to exist for all of the receiving queues bound
to a fanout exchange....

Best regards,
Jerry

----- Original Message -----
From: "Simone Busoli" <simone.busoli at gmail.com>
To: "james poole" <james.poole at rsa.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com, jerryk at vmware.com
Sent: Thursday, January 12, 2012 10:22:22 AM
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

I'm honestly not sure, please take my last mail with a grain of salt, I might have hit send too fast. I always assumed that each queue would get its own copy of a message, but in fact it's totally sensible for RabbitMQ to keep only one copy of the message in such case.
The devs will be able to shed some more light on this, I just meant to point out that big unacked messages may lead to problems as they need to be stored somewhere.


On Thu, Jan 12, 2012 at 19:17, < james.poole at rsa.com > wrote:






We are sending the Ack from the consumer side after the message is delivered. I will try setting autoAck to true and see if that makes a difference.



I thought Rabbit was smart enough to just keep one copy of a message for a fanout? Does it really create 2000 separate copies of the same message in memory, or does it just do this when the message is being sent?



-James




From: Simone Busoli [mailto: simone.busoli at gmail.com ]
Sent: Thursday, January 12, 2012 1:03 PM


To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com ; Kuch, Jerry (VMware)
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load







Are you acking messages? If you don't, those messages will have to be stored somewhere and 2000 * 2MB * 1/s = 4 GB/s


On Thu, Jan 12, 2012 at 18:55, < james.poole at rsa.com > wrote:



Simone, that would be great if you could try to reproduce it.



As mentioned, we are creating 2000 consumers each with their own queue bound to a fanout exchange. After the queues have all been created and bound, a producer publishes a 2 MB message to this fanout exchange once every second for 50 seconds.



All queues are non-durable. And autoAck was set to false in the Java client.



Everything hums along until the vm_memory_high_watermark is triggered and then we see the crash. One interesting thing is that in the log it still shows it accepting and starting tcp connections after the memory alarm is triggered (for around 15 seconds before the crash). I thought this was supposed to block until the memory was under control?



-James




From: Simone Busoli [mailto: simone.busoli at gmail.com ]
Sent: Wednesday, January 11, 2012 3:02 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com ; Kuch, Jerry (VMware)




Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load





Hi James,

If you can provide more details about the load you're applying to the broker I would be glad to try to reproduce it.
We've been using RabbitMQ on Windows in production for some months now and didn't experience any weird behavior.
What I'm interested in is whether entities and messages are durable, if you use transactions or publisher confirms and the like.


On Jan 11, 2012 7:52 PM, < james.poole at rsa.com > wrote:

Yeah, I should have mentioned that we started out testing with the 64-bit version and found this issue... though the VM probably didn't have very much more memory than a 32-bit address space would provide. Then we backed down to the 32-bit version to see if it went away, but it didn't.

I will see if we can send out the test program (it's just a simple java app using the rabbitmq-java-client-2.7.1). If I can send it out, how would I go about this... attach to the email or upload it to a server somewhere?

-James

-----Original Message-----
From: Jerry Kuch [mailto: jerryk at vmware.com ]
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

James: Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment? The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help). I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us? If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" < james.poole at rsa.com >
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From vveludan at gmail.com  Fri Jan 13 05:03:33 2012
From: vveludan at gmail.com (Venkat)
Date: Thu, 12 Jan 2012 21:03:33 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <C173C983-48CC-4AC1-ADC8-336E9F99B1F4@rabbitmq.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
	<0CF971BF-82C1-4D62-BB41-2628875837AE@rabbitmq.com>
	<03877dc9-66c8-473b-a99a-6f8c8bf4bb59@d10g2000vbh.googlegroups.com>
	<6ff0e474-a026-449f-994d-f062203175ca@w4g2000vbc.googlegroups.com>
	<C173C983-48CC-4AC1-ADC8-336E9F99B1F4@rabbitmq.com>
Message-ID: <16d4069e-726a-4121-b412-341cff384c4b@ck5g2000vbb.googlegroups.com>

> (You did start_app after the cluster command, didn't you??? ?:-))

Hi Steve I did restart the the app.
Following are the steps I have performed on both nodes:

Starting the second node t-4:
./rabbitmq-server -detached

Steps to join t-4 node to t-2:
 /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl stop_app

 /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl reset

 /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster
rabbit at t-2 rabbit at t-4
 Clustering node 'rabbit at t-4' with ['rabbit at t-2',
                                         'rabbit at t-4'] ...
...done.

/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl start_app
Starting node 'rabbit at t-4' ...
...done.

Running cluster_status on t-4 node:
[ecloud at t-4 sbin]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/
rabbitmqctl cluster_status
Cluster status of node 'rabbit at t-4' ...
[{nodes,[{disc,['rabbit at t-4','rabbit at t-2']}]},
 {running_nodes,['rabbit at t-2','rabbit at t-4']}]
...done.

Running cluster_status on t-2 node (to which t-4 is joined):
[ecloud at t-2 vv]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/
rabbitmqctl cluster_status
Cluster status of node 'rabbit at t-2' ...
[{nodes,[{disc,['rabbit at t-4','rabbit at t-2']}]},
 {running_nodes,['rabbit at t-4','rabbit at t-2']}]
...done.

---------------------------------------------------------------------------------------------------------------
I have been testing with HA feature with different scenario.
In my previous test the messages were pumped in with a SOAP service.
This was pumping messages at slow rate.
I have used a test that pumps in messages by calling plain Java
Service. I have also increased messages pumping in from 20K to 40K.
I am finding that messages are lost while pumping into the queue.
As you mentioned earlier this could be due to connecting to dead
broker.
I modified the producer code by giving 2 seconds lapse of time and
setting a fresh ConnectionFactory as follows:
	@Override
	public void convertAndSend(final Object message) throws AmqpException
{
		MessageProperties props = null;
		try {
			props = new MessageProperties();
			props.setDeliveryMode(MessageDeliveryMode.PERSISTENT);   //setting
delivery mode as PERSISTENT
			send(getMessageConverter().toMessage(message, props));
		} catch (AmqpException amqpe) {
			System.out.println("Exception occurred while sending:
"+amqpe.getMessage());
			try {
				Thread.sleep(2000);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
			Properties props1 = FrameworkServiceLocator.getInstance().
	
getCommonsConfigurationService(ServiceConstants.DMB_COMMONS_CONFIG_SERVICE).
			getProperties(CommonsConfigurationConstants.RABBIT_MQ_CONFIG_NAME);
			String rabbitMQUser =
props1.getProperty(CommonsConfigurationConstants.RABBITMQ_USER);
			String rabbitMQPassword =
props1.getProperty(CommonsConfigurationConstants.RABBITMQ_PASSWORD);
			String rabbitMQHost =
props1.getProperty(CommonsConfigurationConstants.RABBITMQ_HOST);
			String rabbitMQChannelCacheSize =
props1.getProperty(CommonsConfigurationConstants.RABBITMQ_CHANNEL_CACHE_SIZE);
			CachingConnectionFactory connectionFactory = new
CachingConnectionFactory(rabbitMQHost);
	
connectionFactory.setChannelCacheSize(Integer.parseInt(rabbitMQChannelCacheSize));
			connectionFactory.setUsername(rabbitMQUser);
			connectionFactory.setPassword(rabbitMQPassword);
			setConnectionFactory(connectionFactory);
			try {
				send(getMessageConverter().toMessage(message, props));
			} catch(AmqpException e1) {
				e1.printStackTrace();
			}
		}
	}

After this change is made, I saw an exception occurred once while
sending 40K messages which is as follows:
java.net.SocketException: Broken pipe.
 I have run the test 10-15 times each time 5K-6K messages were lost
but this exception was occurring only once.

Thanks
Venkat


On Jan 11, 12:55?pm, Steve Powell <st... at rabbitmq.com> wrote:
> Hi Venkat,
>
> > This time there were no messages lost. All 20K messages were
> > processed.
>
> That's great.
>
> I'm trying to figure out what might be wrong with
> rabbitmqctl report; I'll get back to you.
>
> Meanwhile, running
> ? ? ? ?rabbitmqctl -n rabbit at t-2 status
> ON NODE t-4 might be interesting.
>
> Also, can you tell us the output from
> ? ? ? ?rabbitmqctl cluster_status
> on both nodes, please.
>
> It is not clear if you have issued the stop_app and start_app and
> reset/force_reset commands properly (you probably have), so could you follow
> the steps as described in the clustering guide, and issue
> rabbitmqctl cluster_status on both nodes after each cluster change?
> We should be able to see where things went wrong, then.
>
> (You did start_app after the cluster command, didn't you??? ?:-))
>
> Cheers,
>
> Steve Powell ?(a hoppy bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 11 Jan 2012, at 01:22, Venkat wrote:> ...
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lucooo at gmail.com  Fri Jan 13 10:27:34 2012
From: lucooo at gmail.com (LuCo)
Date: Fri, 13 Jan 2012 02:27:34 -0800 (PST)
Subject: [rabbitmq-discuss] WCF bindings connection drop outs
Message-ID: <5acc550d-1f04-4063-95ea-f43ec47b4d14@f11g2000yql.googlegroups.com>

Hi there.

I am using the RabbitMQ.ServiceModel WCF bindings with a .Net client
talking to a standard WCF service (two way) and am having a problem
with a long running connection which seems to stop responding after a
long period of time (vague, but it happens without fail if I leave the
client open overnight) only when I next try to use the WCF client
channel.

On the server, the WCF service runs ok and I can confirm in the
RabbitMQ Management plugin that the queue has been created for this
service (I might add I slightly modified the RabbitMQ WCF source to
use durable queues for the service).

On the client, I create a WCF channel from a ChannelFactory<T> and
maintain a single instance of these objects during the lifetime of the
client (ignoring potential channel faulting for now to keep things
simple). Once I use the channel to call the service (successfully) I
can confirm in the RabbitMQ Management plugin that the client has a
queue created on the broker and messages are flowing between the
client and service.

If I leave the client overnight, the next time I attempt to use the
channel to call the service I receive an IOException at the following
point in the stack:

"Unable to read data from the transport connection: An existing
connection was forcibly closed by the remote host."

   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32
offset, Int32 size)
   at System.IO.BufferedStream.ReadByte()
   at System.IO.BinaryReader.ReadByte()
   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)

InnerException: SocketException (SocketErrorCode = ConnectionReset)

I have observed the following in trying to work out what is going on
here:
(1) Prior to the exception above, the RabbitMQ Management plugin shows
the client queue at a port number I can confirm is ESTABLISHED via a
netstat on the client

(2) After the exception above, a netstat on the client reveals the
port has been removed from the list, however, the RabbitMQ Management
plugin still shows the client queue at the old port number and does
not update. I have enabled tracing on the broker and no messages are
exchanged when the exception is raised, nor have been since the last
successful message (previous day).

(3) Attempting to use the channel after the exception (again, without
creating a new channel) results in the below exception:
"The AMQP operation was interrupted: AMQP close-reason, initiated by
Library, code=541, text="Unexpected Exception", classId=0, methodId=0,
cause=System.IO.IOException: Unable to read data from the transport
connection: An existing connection was forcibly closed by the remote
host. ---> System.Net.Sockets.SocketException: An existing connection
was forcibly closed by the remote host
   at System.Net.Sockets.Socket.Receive(Byte[] buffer, Int32 offset,
Int32 size, SocketFlags socketFlags)
   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32
offset, Int32 size)
   --- End of inner exception stack trace ---
   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
in C:\rabbitmq-dotnet-client-2.7.0\projects\client\RabbitMQ.Client\src
\client\impl\Frame.cs:line 103
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame() in C:
\rabbitmq-dotnet-client-2.7.0\projects\client\RabbitMQ.Client\src
\client\impl\SocketFrameHandler_0_9.cs:line 136
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration() in C:
\rabbitmq-dotnet-client-2.7.0\projects\client\RabbitMQ.Client\src
\client\impl\ConnectionBase.cs:line 632
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop() in C:\rabbitmq-
dotnet-client-2.7.0\projects\client\RabbitMQ.Client\src\client\impl
\ConnectionBase.cs:line 582"

(4) I can create a new client channel without any issues and
successfully send messages to the service. However, whilst this solves
the issue on the client, I end up with ghost queues on the broker that
just hang around uselessly.

(5) I can switch the WCF bindings to TCP (eliminating RabbitMQ from
the equation) and I do not see the above problem.

Any thoughts? Am I not using the RabbitMQ WCF bindings as I should be?
Do I need to modify the RabbitMQ.ServiceModel source to toggle timeout
settings?

Thanks. Daniel

From emile at rabbitmq.com  Fri Jan 13 10:41:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Jan 2012 10:41:06 +0000
Subject: [rabbitmq-discuss] Rabbit forgetting users after shutting down
 both cluster-nodes
In-Reply-To: <494adb6b-576b-4e11-8651-e58658f8b673@z1g2000vbx.googlegroups.com>
References: <494adb6b-576b-4e11-8651-e58658f8b673@z1g2000vbx.googlegroups.com>
Message-ID: <4F100A42.3050201@rabbitmq.com>

Hi Lukas,

On 12/01/12 17:18, lukas wrote:
> We have a strange problem.
> 
> Setup: Two rabbitmq-nodes (v. 2.5.1) running as a cluster, one user
> (added with rabbitmqctl add_user and set_permissions), system is Linux
> 2.6.32
> 
> The following happens:
> 
> 1. Both nodes running normally
> 2. First node is stopped (rabbitmqctl stop_app) -> our client switches
> to 2nd node
> 3. Second node is stopped -> client diconnects
> 4. First node is started again -> client can't connect because the
> user is gone. ( there is only the default user "guest")
> 
> How can this happen?


From emile at rabbitmq.com  Fri Jan 13 10:55:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Jan 2012 10:55:48 +0000
Subject: [rabbitmq-discuss] Rabbit forgetting users after shutting down
 both cluster-nodes
In-Reply-To: <4F100A42.3050201@rabbitmq.com>
References: <494adb6b-576b-4e11-8651-e58658f8b673@z1g2000vbx.googlegroups.com>
	<4F100A42.3050201@rabbitmq.com>
Message-ID: <4F100DB4.1040906@rabbitmq.com>

On 13/01/12 10:41, Emile Joubert wrote:
> Hi Lukas,
> 
> On 12/01/12 17:18, lukas wrote:
>> We have a strange problem.
>>
>> Setup: Two rabbitmq-nodes (v. 2.5.1) running as a cluster, one user
>> (added with rabbitmqctl add_user and set_permissions), system is Linux
>> 2.6.32
>>
>> The following happens:
>>
>> 1. Both nodes running normally
>> 2. First node is stopped (rabbitmqctl stop_app) -> our client switches
>> to 2nd node
>> 3. Second node is stopped -> client diconnects
>> 4. First node is started again -> client can't connect because the
>> user is gone. ( there is only the default user "guest")
>>
>> How can this happen?
> 
> From you description it sounds likely that node2 was the only disc node.
> You can use the "rabbitmqctl cluster_status" command to confirm. Also
> note that more recent versions of RabbitMQ will log a warning when the
> last disc-node leaves the cluster. You should ensure that both nodes are
> disc-nodes to prevent this problem.

Could you please supply the exact transcript so that I can confirm my
diagnosis? I'm interested to know whether you performed a "rabbitmqctl
reset" command between step 3 and 4.


-Emile


From simon at rabbitmq.com  Fri Jan 13 11:44:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jan 2012 11:44:19 +0000
Subject: [rabbitmq-discuss] Number of queues and messages
In-Reply-To: <4F0F47CB.2070800@gmail.com>
References: <4F0F47CB.2070800@gmail.com>
Message-ID: <4F101913.4000408@rabbitmq.com>

On 12/01/12 20:51, Mark wrote:
> Is there any hard limit on the number of queues and/or messages one
> RabbitMQ broker can handle? I'm guessing it would be bound by available
> ram on the machine?

RabbitMQ will page out messages to disc under memory pressure. It still 
keeps a small amount of per-message metadata in RAM though.

The number of queues is bound by RAM.

In practice, both limits are quite high.

> How about if queues and messages are persisted?

Makes no difference - transient messages *can* get paged out, persistent 
ones *must*.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 13 11:47:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jan 2012 11:47:26 +0000
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <b41e729b-72c1-46c4-be82-45a74b294163@CoachZ.local>
References: <b41e729b-72c1-46c4-be82-45a74b294163@CoachZ.local>
Message-ID: <4F1019CE.6090107@rabbitmq.com>

On 12/01/12 23:37, Jerry Kuch wrote:
> James's assumption is generally right.  Fanout does *not* require actual,
> literal copies of a message to exist for all of the receiving queues bound
> to a fanout exchange....

It's not just fanout exchanges. If a message gets delivered to more than 
one queue we will only persist one copy of the body to disc, and will 
only have one copy of the body in RAM (umm, if it's > 64 bytes in length).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 13 11:49:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jan 2012 11:49:47 +0000
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6246@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F601D@MX36A.corp.emc.com>	<CAOn7oW_PB-yP4SsQaW9Tq4-r9WS0P2PRNVuEFJf5pj4ED0naxQ@mail.gmail.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E35F6246@MX36A.corp.emc.com>
Message-ID: <4F101A5B.4050108@rabbitmq.com>

On 12/01/12 17:55, james.poole at rsa.com wrote:
> Everything hums along until the vm_memory_high_watermark is triggered
> and then we see the crash.  One interesting thing is that in the log it
> still shows it accepting and starting tcp connections after the memory
> alarm is triggered (for around 15 seconds before the crash).  I thought
> this was supposed to block until the memory was under control?

It won't refuse connections. The idea is that it should accept 
connections, but then block them if they try to publish. If you want to 
connect to consume messages you should be allowed to even after the 
alarm is triggered...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 13 11:55:05 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jan 2012 11:55:05 +0000
Subject: [rabbitmq-discuss] Clarification needed for HA of
 RabbitMQ	statistics database
In-Reply-To: <B37E5D4168FAA74FAF8AA88EC8018BCB048ACBB0@BLR-SJP-MBX6.wipro.com>
References: <B37E5D4168FAA74FAF8AA88EC8018BCB048ACBB0@BLR-SJP-MBX6.wipro.com>
Message-ID: <4F101B99.8080707@rabbitmq.com>

That information is actually out of date (theoretically as of 2.6.0 
although in practice the stats DB recovery was buggy until 2.7.1). I'll 
update it.

So now the stats DB will get recreated on another node in the cluster 
(assuming there is another node which is running the full mgmt plugin, 
not just the agent). When the DB is recreated it will gather the 
information it needs from the rest of the cluster. So there shouldn't be 
anything to worry about.

Cheers, Simon

On 12/01/12 19:04, mridusmita.talukdar at wipro.com wrote:
> Hi,
>
> In the RabbitMQ documentation there is a mention about how the
> management plugin works in a cluster, and from what I understand these
> are the main points:
>
> 1.The management plugin can be installed on one or more nodes in the cluster
>
> 2.Cluster nodes which do not have full management plugin will need to
> have an management-agent plugin installed on them
>
> 3.The management plugin installs a database into RabbitMQ. In a RabbitMQ
> cluster there will be only one copy of the statistics database located
> in the first node to come up that has full management plugin installed.
> If that node goes down then statistics information will be missing.
>
> My question is: Isn?t there any other way by which we can make the
> statistics database highly available? Because our requirement is that,
> we would like to review the statistics on a monthly basis, but in case
> the lone node goes down within that period, we lose all the information.
>
> Thanks and regards,
>
> Mridu
>
> *Please do not print this email unless it is absolutely necessary. *
>
> The information contained in this electronic message and any attachments
> to this message are intended for the exclusive use of the addressee(s)
> and may contain proprietary, confidential or privileged information. If
> you are not the intended recipient, you should not disseminate,
> distribute or copy this e-mail. Please notify the sender immediately and
> destroy all copies of this message and any attachments.
>
> WARNING: Computer viruses can be transmitted via email. The recipient
> should check this email and any attachments for the presence of viruses.
> The company accepts no liability for any damage caused by any virus
> transmitted by this email.
>
> www.wipro.com
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Jan 13 12:11:47 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Jan 2012 12:11:47 +0000
Subject: [rabbitmq-discuss] WCF bindings connection drop outs
In-Reply-To: <5acc550d-1f04-4063-95ea-f43ec47b4d14@f11g2000yql.googlegroups.com>
References: <5acc550d-1f04-4063-95ea-f43ec47b4d14@f11g2000yql.googlegroups.com>
Message-ID: <4F101F83.2040302@rabbitmq.com>

On 13/01/12 10:27, LuCo wrote:
> Hi there.
> 
> I am using the RabbitMQ.ServiceModel WCF bindings with a .Net client
> talking to a standard WCF service (two way) and am having a problem
> with a long running connection which seems to stop responding after a
> long period of time (vague, but it happens without fail if I leave the
> client open overnight) only when I next try to use the WCF client
> channel.

Thanks for your very detailed message. Could you try to enable
heartbeats for the RabbitMQ channels that are established for WCF? The
internal RabbitMQTransportBindingElement.ConnectionFactory() method
looks like the correct place to add this. AMQP heartbeats will probably
help if a network device is causing long-lived connections to drop
silently and peers are unaware of this.

The ghost queues are a consequence of declaring the internal WCF queues
as durable. It seldom makes sense to declare server-named queues as
durable, unless the name is recorded somewhere.



-Emile

From emile at rabbitmq.com  Fri Jan 13 12:18:31 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Jan 2012 12:18:31 +0000
Subject: [rabbitmq-discuss] Why are deliveries still showing even though
 msg counts show 0 in admin?
In-Reply-To: <4F0AC4C2.5060108@rabbitmq.com>
References: <d0c92013-3754-41d3-a086-66a4672841d8@z25g2000vbs.googlegroups.com>
	<C8930831-07B9-4D98-B538-108D3B991F7B@gmail.com>
	<0469d1e9-473c-4f02-8c7e-ed6300df0199@k29g2000vbl.googlegroups.com>
	<e955c12d-9599-4ce7-85c6-918526a1aeb7@m4g2000vbc.googlegroups.com>
	<4F05AF02.3060803@rabbitmq.com>
	<e5398a65-e756-4636-8595-b4b9c1fd6590@dp8g2000vbb.googlegroups.com>
	<4F0AC4C2.5060108@rabbitmq.com>
Message-ID: <4F102117.10301@rabbitmq.com>

Hi Andy,

On 09/01/12 10:43, Emile Joubert wrote:
> Hi,
> 
> On 05/01/12 14:18, AndyB wrote:
>> Does 10 minutes sounds like a valid delay period?  Seems like an
>> awfully long time to me.
> 
> I does seem like a very long time. Can you confirm that this is
> happening on a single node (no clustering), clients are not using
> auto-ack, and QoS prefetching is set to 2?

Have you had an opportunity to investigate this any further? If there is
the possibility of a bug lurking in the vicinity then we'd like to get
to the bottom of it...


Thanks

Emile

From lucooo at gmail.com  Fri Jan 13 13:44:11 2012
From: lucooo at gmail.com (LuCo)
Date: Fri, 13 Jan 2012 05:44:11 -0800 (PST)
Subject: [rabbitmq-discuss] WCF bindings connection drop outs
In-Reply-To: <4F101F83.2040302@rabbitmq.com>
References: <5acc550d-1f04-4063-95ea-f43ec47b4d14@f11g2000yql.googlegroups.com>
	<4F101F83.2040302@rabbitmq.com>
Message-ID: <addc9143-80f0-4ee0-bd06-4b072df61543@f33g2000yqh.googlegroups.com>

Thanks for the quick reply Emile!

I will enable heartbeats and let you know how that goes early next
week.

Not sure I get your response regarding durable queues? Only the
service queues are durable. The client queues are not, and it is the
client queues that are hanging about on the broker when a client's WCF
channel resets. In a normal scenario, once I close the client channel,
the client queues on the broker are deleted. However in the above
scenario, the connection has gone down and there seems to be no way
for the client to notify the broker that this is the case, and thus
the queues will just hang about?

We have made the service queues only durable to minimise disruption
when WCF services are brought down (for releases mainly). This also
has the benefit of allowing the queue to be named which we can monitor
clearly through the admin plugin (without these named queues, it would
be annoying to constantly work out which randomly generated queue name
corresponds to which service).

On Jan 13, 12:11?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> On 13/01/12 10:27, LuCo wrote:
>
> > Hi there.
>
> > I am using the RabbitMQ.ServiceModel WCF bindings with a .Net client
> > talking to a standard WCF service (two way) and am having a problem
> > with a long running connection which seems to stop responding after a
> > long period of time (vague, but it happens without fail if I leave the
> > client open overnight) only when I next try to use the WCF client
> > channel.
>
> Thanks for your very detailed message. Could you try to enable
> heartbeats for the RabbitMQ channels that are established for WCF? The
> internal RabbitMQTransportBindingElement.ConnectionFactory() method
> looks like the correct place to add this. AMQP heartbeats will probably
> help if a network device is causing long-lived connections to drop
> silently and peers are unaware of this.
>
> The ghost queues are a consequence of declaring the internal WCF queues
> as durable. It seldom makes sense to declare server-named queues as
> durable, unless the name is recorded somewhere.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.poole at rsa.com  Fri Jan 13 14:25:57 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Fri, 13 Jan 2012 09:25:57 -0500
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <b41e729b-72c1-46c4-be82-45a74b294163@CoachZ.local>
References: <CAOn7oW8c9=hz1V8NRYhqxbCutNcJicwL3o0Az__UX6MRhwcstA@mail.gmail.com>
	<b41e729b-72c1-46c4-be82-45a74b294163@CoachZ.local>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6457@MX36A.corp.emc.com>

Just to follow up, using autoAck=true did not resolve the crash.  I will continue trying a few different scenarios and I am waiting for the test engineer to give me a stripped down java program to reproduce the issue.  I'll send it out when I get it.

-James


-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Thursday, January 12, 2012 6:37 PM
To: Simone Busoli
Cc: rabbitmq-discuss at lists.rabbitmq.com; Poole, James
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

Simone and James:

James's assumption is generally right.  Fanout does *not* require actual,
literal copies of a message to exist for all of the receiving queues bound
to a fanout exchange....

Best regards,
Jerry

----- Original Message -----
From: "Simone Busoli" <simone.busoli at gmail.com>
To: "james poole" <james.poole at rsa.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com, jerryk at vmware.com
Sent: Thursday, January 12, 2012 10:22:22 AM
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

I'm honestly not sure, please take my last mail with a grain of salt, I might have hit send too fast. I always assumed that each queue would get its own copy of a message, but in fact it's totally sensible for RabbitMQ to keep only one copy of the message in such case.
The devs will be able to shed some more light on this, I just meant to point out that big unacked messages may lead to problems as they need to be stored somewhere.


On Thu, Jan 12, 2012 at 19:17, < james.poole at rsa.com > wrote:






We are sending the Ack from the consumer side after the message is delivered. I will try setting autoAck to true and see if that makes a difference.



I thought Rabbit was smart enough to just keep one copy of a message for a fanout? Does it really create 2000 separate copies of the same message in memory, or does it just do this when the message is being sent?



-James




From: Simone Busoli [mailto: simone.busoli at gmail.com ]
Sent: Thursday, January 12, 2012 1:03 PM


To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com ; Kuch, Jerry (VMware)
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load







Are you acking messages? If you don't, those messages will have to be stored somewhere and 2000 * 2MB * 1/s = 4 GB/s


On Thu, Jan 12, 2012 at 18:55, < james.poole at rsa.com > wrote:



Simone, that would be great if you could try to reproduce it.



As mentioned, we are creating 2000 consumers each with their own queue bound to a fanout exchange. After the queues have all been created and bound, a producer publishes a 2 MB message to this fanout exchange once every second for 50 seconds.



All queues are non-durable. And autoAck was set to false in the Java client.



Everything hums along until the vm_memory_high_watermark is triggered and then we see the crash. One interesting thing is that in the log it still shows it accepting and starting tcp connections after the memory alarm is triggered (for around 15 seconds before the crash). I thought this was supposed to block until the memory was under control?



-James




From: Simone Busoli [mailto: simone.busoli at gmail.com ]
Sent: Wednesday, January 11, 2012 3:02 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com ; Kuch, Jerry (VMware)




Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load





Hi James,

If you can provide more details about the load you're applying to the broker I would be glad to try to reproduce it.
We've been using RabbitMQ on Windows in production for some months now and didn't experience any weird behavior.
What I'm interested in is whether entities and messages are durable, if you use transactions or publisher confirms and the like.


On Jan 11, 2012 7:52 PM, < james.poole at rsa.com > wrote:

Yeah, I should have mentioned that we started out testing with the 64-bit version and found this issue... though the VM probably didn't have very much more memory than a 32-bit address space would provide. Then we backed down to the 32-bit version to see if it went away, but it didn't.

I will see if we can send out the test program (it's just a simple java app using the rabbitmq-java-client-2.7.1). If I can send it out, how would I go about this... attach to the email or upload it to a server somewhere?

-James

-----Original Message-----
From: Jerry Kuch [mailto: jerryk at vmware.com ]
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

James: Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment? The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help). I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us? If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" < james.poole at rsa.com >
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120113/12ff26bf/attachment.bin>

From behzad.eslami at gmail.com  Fri Jan 13 14:26:03 2012
From: behzad.eslami at gmail.com (AmirBehzad Eslami)
Date: Fri, 13 Jan 2012 17:56:03 +0330
Subject: [rabbitmq-discuss] New to world of Message Queues
Message-ID: <CAB=ZGGBq4GJk-0C0c3-BTeaaxYrGkQO_kUcoau2_i62=y00dxw@mail.gmail.com>

Hi,

We have a service, where users sends code and we reply them with the answer.
The code is sent to us via Sms, and we'll reply via SMS.
Technically, `recv.php` running on Apache is responsible to handle
incoming SMS messages.
Once a SMS is recieved, we need to provide a reply for it.
There are dozens of Reply services.
Depending on the number which SMS is sent _TO_, a Reply service will
be responsible to answer.

Now I have a design idea, with an emphasis to scalability.

Once a SMS is recieved (recv.php?f=XXXXXXXXXX&t=YYYY&body=Blah blah):
1) recv.php reads the SMS header.
2) +YYYY indicates that the user wants to use the Football service. In
this service, users send us a code, asking for detailed info about
Football programs this week. We have many other services, e.g.
Whether, Acronyms, etc.
2) For +YYYY, we have a Queue, where we store incoming SMS messages.
In other words, for each Service, we've implemented a Queue.
3) There are dozens of Queues, and dozens of Listeners. A daemon
listens to an specific Queue, waiting for new SMS messages.
4) Now ListenerZ pops the SMS from the Queue, reads SMS's content, and
generates a `reply-sms` to be posted to the user.
5) ListenerZ inserts the `reply-sms` into a different Queue, named
`dispatch-queue`.
6) Dispatcher reads all messages in this queue every second, and calls
a web service to send the reply SMS.
7) If SMS is sent successfully, it is logged into db. Otherwise, we
will re-insert it to `dispatch-queue` to  send it later.

recv.php disributes SMS messages into queues, and dispathcer sends the
final sms-replyes.
If i want to add a new service, i write a new listener, and bind it
with a queue.

Currently, I'm using PostgreSQL for queues! Which is not a good idea,
as i googled for it.
After googling, I found Gearman, RabbitMQ, ActiveMQ, ZeroMQ, RestMQ, etc.
@see: http://www.engineyard.com/blog/2011/5-subtle-ways-youre-using-mysql-as-a-queue-and-why-itll-bite-you/

How can i use RabbitMQ in my problem? All I need is a simple queue? or
a Job Server is better?
What do you think about my design and its distributed architecture?
Have you implemented something similiar?
Please let me know your recommendations.

-regards,
amirbehzad

P.S. I'm a web developer, and I'm very new to the world of Distributed
Computing.
and I found RabbitMQ to be most popular one.

From awilliam at whitemice.org  Fri Jan 13 14:54:47 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Fri, 13 Jan 2012 09:54:47 -0500
Subject: [rabbitmq-discuss] New to world of Message Queues
In-Reply-To: <CAB=ZGGBq4GJk-0C0c3-BTeaaxYrGkQO_kUcoau2_i62=y00dxw@mail.gmail.com>
References: <CAB=ZGGBq4GJk-0C0c3-BTeaaxYrGkQO_kUcoau2_i62=y00dxw@mail.gmail.com>
Message-ID: <1326466487.3023.3.camel@linux-dauq.site>

On Fri, 2012-01-13 at 17:56 +0330, AmirBehzad Eslami wrote:
> We have a service, where users sends code and we reply them with the answer.
> The code is sent to us via Sms, and we'll reply via SMS.
> Technically, `recv.php` running on Apache is responsible to handle
> incoming SMS messages.
> Once a SMS is recieved, we need to provide a reply for it.
> There are dozens of Reply services.
> Depending on the number which SMS is sent _TO_, a Reply service will
> be responsible to answer.
> Once a SMS is recieved (recv.php?f=XXXXXXXXXX&t=YYYY&body=Blah blah):
> 1) recv.php reads the SMS header.
> How can i use RabbitMQ in my problem? All I need is a simple queue? or
> a Job Server is better?
> What do you think about my design and its distributed architecture?
> Have you implemented something similiar?
> Please let me know your recommendations.

There are lots of devils in the details;  but me, off the top of my
head...

1.) Make recv.php as simple as possible.  Just get the message, verify
it isn't whackadoodle, and put it into a queue.
2.) Have 1-to-n number of listeners for that queue that take the message
examine it to determine how it should be handled and place it in the
appropriate queue for the message type.
3.) Have type specific handlers listening to their approporiate queues
that work the messages and generate the responses.

I might even have the message-type processors submit their responses to
a queue with workers that send messages.

This way you can add more message-types and more processors easily.  You
can also downtime any specific component for updates/etc... and it can
pick back up when it comes back.  The latter is one of my favorite
features of message-queue based applications.

-- 
System & Network Administrator [ LPI & NCLA ]
<http://www.whitemiceconsulting.com>
OpenGroupware Developer <http://www.opengroupware.us>
Adam Tauno Williams


From lukas.zielinski at googlemail.com  Fri Jan 13 16:25:56 2012
From: lukas.zielinski at googlemail.com (lukas)
Date: Fri, 13 Jan 2012 08:25:56 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbit forgetting users after shutting down
	both cluster-nodes
In-Reply-To: <4F100DB4.1040906@rabbitmq.com>
References: <494adb6b-576b-4e11-8651-e58658f8b673@z1g2000vbx.googlegroups.com>
	<4F100A42.3050201@rabbitmq.com> <4F100DB4.1040906@rabbitmq.com>
Message-ID: <67cab579-8b46-46f8-ac6f-046a8d1c2aae@cf6g2000vbb.googlegroups.com>

Thank you for the tip, Emile.

I think it might have been the reason. Right now however we are unable
to reproduce the problem. Let's see if it happens again..

On 13 Jan., 11:55, Emile Joubert <em... at rabbitmq.com> wrote:
> On 13/01/12 10:41, Emile Joubert wrote:
>
>
>
>
>
>
>
>
>
> > Hi Lukas,
>
> > On 12/01/12 17:18, lukas wrote:
> >> We have a strange problem.
>
> >> Setup: Two rabbitmq-nodes (v. 2.5.1) running as a cluster, one user
> >> (added with rabbitmqctl add_user and set_permissions), system is Linux
> >> 2.6.32
>
> >> The following happens:
>
> >> 1. Both nodes running normally
> >> 2. First node is stopped (rabbitmqctl stop_app) -> our client switches
> >> to 2nd node
> >> 3. Second node is stopped -> client diconnects
> >> 4. First node is started again -> client can't connect because the
> >> user is gone. ( there is only the default user "guest")
>
> >> How can this happen?
>
> > From you description it sounds likely that node2 was the only disc node.
> > You can use the "rabbitmqctl cluster_status" command to confirm. Also
> > note that more recent versions of RabbitMQ will log a warning when the
> > last disc-node leaves the cluster. You should ensure that both nodes are
> > disc-nodes to prevent this problem.
>
> Could you please supply the exact transcript so that I can confirm my
> diagnosis? I'm interested to know whether you performed a "rabbitmqctl
> reset" command between step 3 and 4.
>
> -Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From fdourado at bancofator.com.br  Fri Jan 13 17:09:32 2012
From: fdourado at bancofator.com.br (Fernando Dourado - SENIOR SOLUTION)
Date: Fri, 13 Jan 2012 15:09:32 -0200
Subject: [rabbitmq-discuss] Management console/plugin show wrong date
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C705604020@FSP-SRV-EXCH01.FatorDoria.br>

Hi Folks!

 

We are using last version of RabbitMQ 2.7.1 with Erlang R14B03 with
management plugin and on main page management plugin is showing a wrong
date on page footer. No wrong time, only date is wrong and causes some
mistakes. 

 

I have attached a print-screen showing the "problem".

 

Cheers.

 

 

Fernando Dourado 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120113/5f125cc5/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: management-console.PNG
Type: image/png
Size: 116122 bytes
Desc: management-console.PNG
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120113/5f125cc5/attachment.png>

From simon at rabbitmq.com  Fri Jan 13 17:18:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jan 2012 17:18:28 +0000
Subject: [rabbitmq-discuss] Management console/plugin show wrong date
In-Reply-To: <6E15CEE6F245AC46B04E0160AAFD88C705604020@FSP-SRV-EXCH01.FatorDoria.br>
References: <6E15CEE6F245AC46B04E0160AAFD88C705604020@FSP-SRV-EXCH01.FatorDoria.br>
Message-ID: <4F106764.5040107@rabbitmq.com>

On 13/01/12 17:09, Fernando Dourado - SENIOR SOLUTION wrote:
> We are using last version of RabbitMQ 2.7.1 with Erlang R14B03 with
> management plugin and on main page management plugin is showing a wrong
> date on page footer. No wrong time, only date is wrong and causes some
> mistakes.
>
> I have attached a print-screen showing the ?problem?.

Hi Fernando. The timestamp on the page footer is taken from the machine 
running the web browser - check its clock is correct.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 13 17:47:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Jan 2012 17:47:00 +0000
Subject: [rabbitmq-discuss] Management console/plugin show wrong date
In-Reply-To: <6E15CEE6F245AC46B04E0160AAFD88C70560408A@FSP-SRV-EXCH01.FatorDoria.br>
References: <6E15CEE6F245AC46B04E0160AAFD88C705604020@FSP-SRV-EXCH01.FatorDoria.br>
	<4F106764.5040107@rabbitmq.com>
	<6E15CEE6F245AC46B04E0160AAFD88C70560408A@FSP-SRV-EXCH01.FatorDoria.br>
Message-ID: <4F106E14.8010509@rabbitmq.com>

On 13/01/12 17:26, Fernando Dourado - SENIOR SOLUTION wrote:
> Thanks for the reply Simon.
>
> Strange because is my own machine and FF, Chrome and IE show the same
> value.
>
> Please, look attached file.

Wow.

This is in fact a bug. It's taking the day of the week rather than the 
day of the month when formatting the date. It's been like that for a 
year, and I never spotted it, nor did anyone else.

Congratulations, you win the embarrassing bug of the week award.

Thanks for noticing. Needless to say it'll be fixed in the next release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From hcoyote at ghostar.org  Fri Jan 13 17:57:17 2012
From: hcoyote at ghostar.org (Travis)
Date: Fri, 13 Jan 2012 11:57:17 -0600
Subject: [rabbitmq-discuss] rabbitmq-server 2.7.1 src rpm for Fedora/Redhat
	fails to build.
Message-ID: <CAChq9g1Br_TZsKYo5JN9D=QNxZrb2x=PN1JDGR+=GDhQ6OXDkQ@mail.gmail.com>

I'm attempting to rebuild the source rpm to remove the Requires for
erlang to get around a problem during install on Centos 5.6 (for some
reason, yum wants to keep trying to install R12B despite us having
R14B installed already).

The rpmbuild is failing with what appears to be a git error associated
with mochiweb and a few other plugins.  At first, I thought it was
choking on not finding git, but we certainly have it installed.

What's going on here?  Also, if we could figure out this dependency
issue, I wouldn't need to be rebuilding this and could use the rpm
straight off of rabbitmq.com's download page.


:;  which git
/usr/bin/git
:;  git --version
git version 1.7.4.1


:;  sudo rpmbuild -bb rabbitmq-server.spec
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.1374
+ umask 022
+ cd /home/tcampbell/src/rpm/BUILD
+ cd /home/tcampbell/src/rpm/BUILD
+ rm -rf rabbitmq-server-2.7.1
+ /bin/gzip -dc /home/tcampbell/src/rpm/SOURCES/rabbitmq-server-2.7.1.tar.gz
+ tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd rabbitmq-server-2.7.1
++ /usr/bin/id -u
+ '[' 0 = 0 ']'
+ /bin/chown -Rhf root .
++ /usr/bin/id -u
+ '[' 0 = 0 ']'
+ /bin/chgrp -Rhf root .
+ /bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.1374
+ umask 022
+ cd /home/tcampbell/src/rpm/BUILD
+ cd rabbitmq-server-2.7.1
++ basename /home/tcampbell/src/rpm/SOURCES/rabbitmq-script-wrapper
+ cp /home/tcampbell/src/rpm/SOURCES/rabbitmq-script-wrapper
/home/tcampbell/src/rpm/BUILD/rabbitmq-script-wrapper
++ basename /home/tcampbell/src/rpm/SOURCES/rabbitmq-server.ocf
+ cp /home/tcampbell/src/rpm/SOURCES/rabbitmq-server.ocf
/home/tcampbell/src/rpm/BUILD/rabbitmq-server.ocf
+ make -j8
python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json
src/rabbit_framing_amqp_0_9_1.erl
python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.8.json
src/rabbit_framing_amqp_0_8.erl
xsltproc --novalid --stringparam modulename "`basename
src/rabbit_ctl_usage.erl .erl`" \
		docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp
xsltproc --novalid --stringparam modulename "`basename
src/rabbit_plugins_usage.erl .erl`" \
		docs/usage.xsl docs/rabbitmq-plugins.1.xml > src/rabbit_plugins_usage.erl.tmp
python codegen.py --ignore-conflicts header
../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json
../rabbitmq-codegen//amqp-rabbitmq-0.8.json include/rabbit_framing.hrl
sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_plugins_usage.erl.tmp
> src/rabbit_plugins_usage.erl.tmp2
fold -s src/rabbit_plugins_usage.erl.tmp2 > src/rabbit_plugins_usage.erl.tmp3
mv src/rabbit_plugins_usage.erl.tmp3 src/rabbit_plugins_usage.erl
sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_ctl_usage.erl.tmp >
src/rabbit_ctl_usage.erl.tmp2
rm src/rabbit_plugins_usage.erl.tmp src/rabbit_plugins_usage.erl.tmp2
fold -s src/rabbit_ctl_usage.erl.tmp2 > src/rabbit_ctl_usage.erl.tmp3
mv src/rabbit_ctl_usage.erl.tmp3 src/rabbit_ctl_usage.erl
rm src/rabbit_ctl_usage.erl.tmp src/rabbit_ctl_usage.erl.tmp2
rm -f deps.mk
echo src/delegate.erl:src/delegate_sup.erl:src/file_handle_cache.erl:src/gatherer.erl:src/gen_server2.erl:src/gm.erl:src/gm_soak_test.erl:src/gm_speed_test.erl:src/gm_tests.erl:src/lqueue.erl:src/mirrored_supervisor.erl:src/mirrored_supervisor_tests.erl:src/pg2_fixed.erl:src/pg_local.erl:src/priority_queue.erl:src/rabbit.erl:src/rabbit_access_control.erl:src/rabbit_alarm.erl:src/rabbit_amqqueue.erl:src/rabbit_amqqueue_process.erl:src/rabbit_amqqueue_sup.erl:src/rabbit_auth_backend.erl:src/rabbit_auth_backend_internal.erl:src/rabbit_auth_mechanism.erl:src/rabbit_auth_mechanism_amqplain.erl:src/rabbit_auth_mechanism_cr_demo.erl:src/rabbit_auth_mechanism_plain.erl:src/rabbit_backing_queue.erl:src/rabbit_backing_queue_qc.erl:src/rabbit_basic.erl:src/rabbit_binary_generator.erl:src/rabbit_binary_parser.erl:src/rabbit_binding.erl:src/rabbit_channel.erl:src/rabbit_channel_sup.erl:src/rabbit_channel_sup_sup.erl:src/rabbit_client_sup.erl:src/rabbit_command_assembler.erl:src/rabbit_connection_sup.erl:src/rabbit_control.erl:src/rabbit_direct.erl:src/rabbit_error_logger.erl:src/rabbit_error_logger_file_h.erl:src/rabbit_event.erl:src/rabbit_exchange.erl:src/rabbit_exchange_type.erl:src/rabbit_exchange_type_direct.erl:src/rabbit_exchange_type_fanout.erl:src/rabbit_exchange_type_headers.erl:src/rabbit_exchange_type_topic.erl:src/rabbit_file.erl:src/rabbit_framing.erl:src/rabbit_guid.erl:src/rabbit_heartbeat.erl:src/rabbit_limiter.erl:src/rabbit_log.erl:src/rabbit_memory_monitor.erl:src/rabbit_mirror_queue_coordinator.erl:src/rabbit_mirror_queue_master.erl:src/rabbit_mirror_queue_misc.erl:src/rabbit_mirror_queue_slave.erl:src/rabbit_mirror_queue_slave_sup.erl:src/rabbit_misc.erl:src/rabbit_mnesia.erl:src/rabbit_msg_file.erl:src/rabbit_msg_store.erl:src/rabbit_msg_store_ets_index.erl:src/rabbit_msg_store_gc.erl:src/rabbit_msg_store_index.erl:src/rabbit_net.erl:src/rabbit_networking.erl:src/rabbit_node_monitor.erl:src/rabbit_plugins.erl:src/rabbit_prelaunch.erl:src/rabbit_queue_collector.erl:src/rabbit_queue_index.erl:src/rabbit_reader.erl:src/rabbit_registry.erl:src/rabbit_restartable_sup.erl:src/rabbit_router.erl:src/rabbit_sasl_report_file_h.erl:src/rabbit_ssl.erl:src/rabbit_sup.erl:src/rabbit_tests.erl:src/rabbit_tests_event_receiver.erl:src/rabbit_trace.erl:src/rabbit_types.erl:src/rabbit_upgrade.erl:src/rabbit_upgrade_functions.erl:src/rabbit_variable_queue.erl:src/rabbit_version.erl:src/rabbit_vhost.erl:src/rabbit_writer.erl:src/supervisor2.erl:src/tcp_acceptor.erl:src/tcp_acceptor_sup.erl:src/tcp_listener.erl:src/tcp_listener_sup.erl:src/test_sup.erl:src/vm_memory_monitor.erl:src/worker_pool.erl:src/worker_pool_sup.erl:src/worker_pool_worker.erl:src/rabbit_framing_amqp_0_9_1.erl:src/rabbit_framing_amqp_0_8.erl:src/rabbit_ctl_usage.erl:src/rabbit_plugins_usage.erl:include/gm_specs.hrl:include/rabbit.hrl:include/rabbit_auth_backend_spec.hrl:include/rabbit_auth_mechanism_spec.hrl:include/rabbit_backing_queue_spec.hrl:include/rabbit_exchange_type_spec.hrl:include/rabbit_msg_store.hrl:include/rabbit_msg_store_index.hrl:include/rabbit_framing.hrl:
| escript generate_deps deps.mk ebin
escript generate_app ebin/rabbit_app.in ebin/rabbit.app src
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gen_server2.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/delegate_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/lqueue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/supervisor2.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/pg2_fixed.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/pg_local.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/priority_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_access_control.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_alarm.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_amqqueue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_amqqueue_process.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_amqqueue_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_backend.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_mechanism.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_backing_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_backing_queue_qc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_basic.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_binary_generator.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_binary_parser.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_binding.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_channel.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_channel_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_channel_sup_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_client_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_command_assembler.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_connection_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_control.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_ctl_usage.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_direct.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_error_logger.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_error_logger_file_h.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_event.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_file.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_framing.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_framing_amqp_0_8.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_framing_amqp_0_9_1.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_guid.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_heartbeat.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_limiter.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_log.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_memory_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_master.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_misc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_slave_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_misc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mnesia.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_file.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_store.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_store_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_store_gc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_net.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_networking.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_node_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_plugins.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_plugins_usage.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_prelaunch.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_queue_collector.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_queue_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_reader.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_registry.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_restartable_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_router.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_sasl_report_file_h.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_ssl.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_tests.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_tests_event_receiver.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_trace.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_types.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_upgrade.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_upgrade_functions.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_variable_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_version.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_vhost.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_writer.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/tcp_acceptor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/tcp_acceptor_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/tcp_listener.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/tcp_listener_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/test_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/vm_memory_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/worker_pool.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/worker_pool_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/worker_pool_worker.erl
[ -d "plugins-src/rabbitmq-server" ] || ln -s
"/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1"
"plugins-src/rabbitmq-server"
mkdir -p plugins
PLUGINS_SRC_DIR="" make -C "plugins-src" plugins-dist
PLUGINS_DIST_DIR="/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins"
VERSION=0.0.0
make[1]: Entering directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
make -f all-packages.mk all-releasable VERSION=0.0.0
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/delegate.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/file_handle_cache.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gatherer.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin src/gm.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/mirrored_supervisor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_backend_internal.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_mechanism_amqplain.erl
make[2]: Entering directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
[elided] generate deps
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_mechanism_cr_demo.erl
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-tracing/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-tracing/build/deps.mk
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_mechanism_plain.erl
src/mirrored_supervisor.erl:126: Warning: conflicting behaviours -
callback init/1 required by both 'supervisor2' and 'gen_server2' (line
125)
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type_direct.erl
[elided] generate deps
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type_fanout.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type_headers.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type_topic.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_store_ets_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gm_soak_test.erl
[elided] fix test deps
sed -i -e 's|rabbitmq-stomp/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-stomp/build/deps.mk
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-shovel/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-shovel/build/deps.mk
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gm_speed_test.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gm_tests.erl
[elided] generate deps
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/mirrored_supervisor_tests.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_coordinator.erl
[elided] generate deps
[elided] generate deps
[elided] generate deps
src/rabbit_mirror_queue_coordinator.erl:27: Warning: conflicting
behaviours - callback terminate/2 required by both 'gm' and
'gen_server2' (line 26)
[elided] fix test deps
sed -i -e 's|rabbitmq-management-visualiser/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-management-visualiser/build/deps.mk
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_slave.erl
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-management/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-management/build/deps.mk
echo UPSTREAM_SHORT_HASH:=`hg id -R ./webmachine-wrapper/webmachine-hg
-i | cut -c -7` >webmachine-wrapper/build/hash.mk
[elided] fix test deps
sed -i -e 's|rabbitmq-jsonrpc/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-jsonrpc/build/deps.mk
sed -n -e 's|^.*{vsn, *"\([^"]*\)".*$|ORIGINAL_VERSION:=\1|p'
<webmachine-wrapper/webmachine-hg/ebin/webmachine.app
>webmachine-wrapper/build/version.mk
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-shovel-management/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-shovel-management/build/deps.mk
[elided] generate deps
abort: There is no Mercurial repository here (.hg not found)
[elided] generate deps
src/mirrored_supervisor_tests.erl:25: Warning: conflicting behaviours
- callback init/1 required by both 'mirrored_supervisor' and
'gen_server' (line 24)
[elided] generate deps
[elided] generate deps
src/rabbit_mirror_queue_slave.erl:45: Warning: conflicting behaviours
- callback terminate/2 required by both 'gm' and 'gen_server2' (line
44)
[elided] generate deps
[elided] fix test deps
[elided] fix test deps
sed -i -e 's|webmachine-wrapper/build/deps.mk|$(DEPS_FILE)|'
webmachine-wrapper/build/deps.mk
sed -i -e 's|rabbitmq-mochiweb/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-mochiweb/build/deps.mk
[elided] generate deps
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-jsonrpc-channel-examples/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-jsonrpc-channel-examples/build/deps.mk
echo UPSTREAM_SHORT_HASH:=`git
--git-dir=./mochiweb-wrapper/mochiweb-git/.git log -n 1 HEAD | grep
commit | cut -b 8-14` >mochiweb-wrapper/build/hash.mk
fatal: Not a git repository: './mochiweb-wrapper/mochiweb-git/.git'
./mochiweb-wrapper/mochiweb-git/support/make_app.escript
mochiweb-wrapper/mochiweb-git/src/mochiweb.app.src
mochiweb-wrapper/mochiweb-git/mochiweb.app "" "`cd
./mochiweb-wrapper/mochiweb-git/src && echo *.erl | sed 's|\.erl||g'`"
[elided] fix test deps
sed -i -e 's|rabbitmq-jsonrpc-channel/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-jsonrpc-channel/build/deps.mk
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-management-agent/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-management-agent/build/deps.mk
[elided] fix test deps
[elided] fix test deps
sed -i -e 's|rabbitmq-consistent-hash-exchange/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-consistent-hash-exchange/build/deps.mk
echo UPSTREAM_SHORT_HASH:=`git
--git-dir=erlang-rfc4627-wrapper/erlang-rfc4627-git/.git log -n 1 HEAD
| grep commit | cut -b 8-14` >erlang-rfc4627-wrapper/build/hash.mk
fatal: Not a git repository: 'erlang-rfc4627-wrapper/erlang-rfc4627-git/.git'
sed -i -e 's|rabbitmq-federation/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-federation/build/deps.mk
[elided] generate deps
erlc -Wall +debug_info -I eldap-wrapper/eldap-git/generated -o
eldap-wrapper/eldap-git/generated
eldap-wrapper/eldap-git/src/ELDAPv3.asn
echo UPSTREAM_SHORT_HASH:=`git --git-dir=eldap-wrapper/eldap-git/.git
log -n 1 HEAD | grep commit | cut -b 8-14`
>eldap-wrapper/build/hash.mk
fatal: Not a git repository: 'eldap-wrapper/eldap-git/.git'
[elided] fix test deps
sed -i -e 's|rabbitmq-auth-mechanism-ssl/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-auth-mechanism-ssl/build/deps.mk
Compiler function asn1ct:compile_asn/3 failed:
{undef,[{asn1ct,compile_asn,

["/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/src/ELDAPv3",

"/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated/ELDAPv3",

{options,["/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated"],

"/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated",
                          undefined,[],999,false,999,
                          [debug_info],
                          [],

"/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src"}]},
        {erl_compile,compile_file,4},
        {erl_compile,compile3,3},
        {erl_compile,compiler_runner,1}]}
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:24: Warning:
ambiguous call of overridden auto-imported BIF error/1
 - use erlang:error/1 or "-compile({no_auto_import,[error/1]})." to
resolve name clash
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:42: Warning:
ambiguous call of overridden auto-imported BIF error/1
 - use erlang:error/1 or "-compile({no_auto_import,[error/1]})." to
resolve name clash
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:45: Warning:
ambiguous call of overridden auto-imported BIF error/1
 - use erlang:error/1 or "-compile({no_auto_import,[error/1]})." to
resolve name clash
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:48: Warning:
ambiguous call of overridden auto-imported BIF error/1
 - use erlang:error/1 or "-compile({no_auto_import,[error/1]})." to
resolve name clash
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:66: Warning:
variable 'Attrs' is unused
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:71: Warning:
variable 'Attrs' is unused
[elided] fix test deps
sed -i -e 's|mochiweb-wrapper/build/deps.mk|$(DEPS_FILE)|'
mochiweb-wrapper/build/deps.mk
[elided] fix test deps
[elided] fix test deps
sed -i -e 's|erlang-rfc4627-wrapper/build/deps.mk|$(DEPS_FILE)|'
erlang-rfc4627-wrapper/build/deps.mk
sed -i -e 's|rabbitmq-auth-backend-ldap/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-auth-backend-ldap/build/deps.mk
[elided] fix test deps
sed -i -e 's|erlando/build/deps.mk|$(DEPS_FILE)|' erlando/build/deps.mk
sed -n -e 's|^.*{vsn, *"\([^"]*\)".*$|ORIGINAL_VERSION:=\1|p'
<mochiweb-wrapper/mochiweb-git/mochiweb.app
>mochiweb-wrapper/build/version.mk
make[2]: Leaving directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
make[2]: Entering directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
do-package.mk:507: *** Failed to produce eldap-wrapper/build/deps.mk.  Stop.
make[2]: Leaving directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
make[1]: *** [release] Error 2
make[1]: Leaving directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
make: *** [plugins] Error 2
error: Bad exit status from /var/tmp/rpm-tmp.1374 (%build)


RPM build errors:
    Bad exit status from /var/tmp/rpm-tmp.1374 (%build)
-- 
Travis Campbell
travis at ghostar.org

From sam at pfgltd.com  Fri Jan 13 18:04:07 2012
From: sam at pfgltd.com (Sam Domonkos)
Date: Fri, 13 Jan 2012 13:04:07 -0500
Subject: [rabbitmq-discuss] [Bug] When displaying the payload in the Web
 Management console/plugin the payload is displayed without xml chars
 escaped.
Message-ID: <4F107217.4020100@pfgltd.com>

When displaying the payload in the Web Management console/plugin the 
payload is displayed without xml chars as escaped versions. (example, 
&amp; is displaying as &).

version: RabbitMQ 2.7.1

--Sam

From fdourado at bancofator.com.br  Fri Jan 13 18:25:02 2012
From: fdourado at bancofator.com.br (Fernando Dourado - SENIOR SOLUTION)
Date: Fri, 13 Jan 2012 16:25:02 -0200
Subject: [rabbitmq-discuss] Management console/plugin show wrong date
In-Reply-To: <4F106E14.8010509@rabbitmq.com>
References: <6E15CEE6F245AC46B04E0160AAFD88C705604020@FSP-SRV-EXCH01.FatorDoria.br>
	<4F106764.5040107@rabbitmq.com>
	<6E15CEE6F245AC46B04E0160AAFD88C70560408A@FSP-SRV-EXCH01.FatorDoria.br>
	<4F106E14.8010509@rabbitmq.com>
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C7056041D8@FSP-SRV-EXCH01.FatorDoria.br>

Okay, fantastic information. I'm fine now, I thought I was drunk (rsss)

Go Rabbit... Go!

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: sexta-feira, 13 de janeiro de 2012 15:47
To: Fernando Dourado - SENIOR SOLUTION;
rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Management console/plugin show wrong
date

On 13/01/12 17:26, Fernando Dourado - SENIOR SOLUTION wrote:
> Thanks for the reply Simon.
>
> Strange because is my own machine and FF, Chrome and IE show the same 
> value.
>
> Please, look attached file.

Wow.

This is in fact a bug. It's taking the day of the week rather than the
day of the month when formatting the date. It's been like that for a
year, and I never spotted it, nor did anyone else.

Congratulations, you win the embarrassing bug of the week award.

Thanks for noticing. Needless to say it'll be fixed in the next release.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

From mridusmita.talukdar at wipro.com  Fri Jan 13 19:12:44 2012
From: mridusmita.talukdar at wipro.com (mridusmita.talukdar at wipro.com)
Date: Fri, 13 Jan 2012 19:12:44 +0000
Subject: [rabbitmq-discuss] Clarification needed for HA of
	RabbitMQ	statistics database
Message-ID: <B37E5D4168FAA74FAF8AA88EC8018BCB048AD119@BLR-SJP-MBX6.wipro.com>

Thanks Simon.


>> That information is actually out of date (theoretically as of 2.6.0
although in practice the stats DB recovery was buggy until 2.7.1). I'll
update it.

Is there a place where we can get the latest documentation of RabbitMQ which reflects the current RabbitMQ version? That will help us in our design considerations.

Thanks and regards,
Mridu


Please do not print this email unless it is absolutely necessary. 

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. 

WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. 

www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120113/8d2652fc/attachment.htm>

From jerryk at vmware.com  Fri Jan 13 19:21:44 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 13 Jan 2012 11:21:44 -0800 (PST)
Subject: [rabbitmq-discuss] Clarification needed for HA
	of	RabbitMQ	statistics database
In-Reply-To: <B37E5D4168FAA74FAF8AA88EC8018BCB048AD119@BLR-SJP-MBX6.wipro.com>
Message-ID: <d2a1a08e-b12f-4d5e-84b3-1511473dfdec@StrongMad.local>

Hi, Mridu:  The easiest thing might be to keep an eye on the release notes
for new Rabbits as they appear.  For bugs that haven't directly generated a
lot of external, public discussion on their own, this is sometimes the most
natural way to find out that a suspected problem has been dispatched...

Best regards,
Jerry

----- Original Message -----
From: "mridusmita talukdar" <mridusmita.talukdar at wipro.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, January 13, 2012 11:12:44 AM
Subject: Re: [rabbitmq-discuss] Clarification needed for HA of	RabbitMQ	statistics database





Thanks Simon. 

>> That information is actually out of date (theoretically as of 2.6.0 

although in practice the stats DB recovery was buggy until 2.7.1). I'll 

update it. 



Is there a place where we can get the latest documentation of RabbitMQ which reflects the current RabbitMQ version? That will help us in our design considerations. 



Thanks and regards, 

Mridu 



Please do not print this email unless it is absolutely necessary. 

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. 

WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. 

www.wipro.com 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.poole at rsa.com  Fri Jan 13 20:44:31 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Fri, 13 Jan 2012 15:44:31 -0500
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
In-Reply-To: <b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6606@MX36A.corp.emc.com>

Jerry,

I have modified the EmitLog.java and ReceiveLogs.java from the tutorials on the website to reproduce the crash (attached).  If the mailing list strips these attachments out, just ping me if anyone wants a copy and I'll send them directly.

Both files will need to be modified to change the address on the factory.setHost() call to your specific broker, and you will need to pass the path to a 2 MB+ file as an argument to the EmitLog process.

Thanks for looking into this.

-James



-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

James:  Out of curiousity have you tried the new 64-bit release of
Erlang for Windows in your environment?  The address space size
limitations of the 32-bit version have been associated with crashy
Rabbits in the past (although bringing your memory high watermark
value down so that the back-pressure mechanisms engage when the
broker is in less trouble may help).  I think you can scare up the
new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on
64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine
and a virtualized one, with one showing a "clean" Erlang VM crash and
the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a
large or proprietary app, or can you extract a bare minimum piece
of code that brings the pain and share it with us?  If you could
do the latter we could more easily investigate the situation within
VMware since the difference in behavior between baremetal and
virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
A non-text attachment was scrubbed...
Name: EmitLog.java
Type: text/java
Size: 2276 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120113/4e2d18a2/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ReceiveLogs.java
Type: text/java
Size: 1630 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120113/4e2d18a2/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120113/4e2d18a2/attachment-0002.bin>

From alan.antonuk at gmail.com  Fri Jan 13 21:19:50 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 13 Jan 2012 16:19:50 -0500
Subject: [rabbitmq-discuss] rabbitmq-c API improvements for multiple
	channels
In-Reply-To: <CACOPnvfx14ctnj2j+aE00icET7VugteBN6Vw5EgikROJMHh0_Q@mail.gmail.com>
References: <CAAt2poJqy+pwASwhbChmAbF569w3xHM02sFJwNJ3ZSVKX8MoxA@mail.gmail.com>
	<CACOPnvfx14ctnj2j+aE00icET7VugteBN6Vw5EgikROJMHh0_Q@mail.gmail.com>
Message-ID: <CAAt2poKSx8MFP9ORT5L7auA3w7g6JpLXdPdw99ujOJv1PSnyqg@mail.gmail.com>

I haven't really had a huge amount of time to work on it since I sent the
first message message, with the holidays and starting up a new project at
work.

Also I was hoping to get some input from the rabbitmq guys so that any
changes I make would have a better chance of being accepted.

Taking a quick look at what I wrote a month ago, today my plan would be to
implement having a amqp_pool_t associated with each amqp_channel_t and see
how far I could get with that.

-Alan

On Thu, Jan 12, 2012 at 11:39 AM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Alan
>
> It appears that you stunned everyone into silence ;-)
>
> How are you getting on with this?
>
> alexis
>
>
> On Wed, Dec 14, 2011 at 8:15 PM, Alan Antonuk <alan.antonuk at gmail.com>
> wrote:
> > I've been working on a c++ wrapper around rabbitmq-c that presents a
> > "humane" API to the programmer heavily inspired by the Puka project.
> > (see: https://github.com/alanxz/SimpleAmqpClient).
> >
> > In developing this library I've run across several limitations of the
> > rabbitmq-c when working with multiple channels, the biggest issue being:
> >
> > - There is no way to wait for a list of methods on a channel.
> > There is amqp_simple_wait_method() - however this suffers from some
> serious
> > drawbacks:
> > + you can only specify one method to listen for
> > + it calls abort() if a different method, or a method on a different
> channel
> > is received
> > A use case for this might be: doing a basic.publish, and you want to
> want to
> > wait for a basic.ack or a basic.return on a channel with confirms enabled
> >
> > The way I got around this in SimpleAmqpClient was to only use
> > amqp_simple_wait_frame() and maintain queues of amqp_frame_t for each
> > channel that I have open.
> >
> > However, this comes with one serious drawback: memory management. Each
> > decoded frame is allocated in a connection-wide amqp_pool_t.  Because of
> > this - it is impossible to recycle the pool and release memory unless you
> > have dealt with all of your pending amqp_frame_t's.  This becomes a
> problem
> > in pathological cases where you have two consumers sending
> simultaneously,
> > you can get in the situation that even though the client program
> eventually
> > deals with every consumed message, memory never gets released, because
> there
> > is always at least one frame queued up.
> >
> > The above demonstrates the second biggest issue with the rabbitmq-c API:
> > memory management when dealing with multiple channels.  There is no way
> to
> > separate out memory allocation on, for example, a per-channel basis (with
> > the library client keeping track of the memory pools used for example).
> >
> > Before I go on I'd like to mention one feature that I find useful with
> the
> > current API: it is possible to use something like select() before calling
> > amqp_simple_wait_frame() to setup a timeout while waiting for a consumer,
> > which is useful when developing single-threaded RPC apps.
> >
> >
> > So now the interesting part: how could the API be improved?
> >
> > Some thoughts I've had dealing with the memory management:
> > 1. Create a amqp_simple_wait_frame() variant that as one of the
> parameters
> > provides a callback to allocate memory, either something like a malloc()
> > call, which the client would then be responsible for freeing, or perhaps
> > something like get_amqp_pool(amqp_frame_t) which allows the client to
> return
> > a memory pool which rabbitmq-c would use to allocate memory for that
> frame.
> >  The amqp_frame_t would have to have some minimal amount of information
> > filled in - such as frame type and channel to be useful.
> >
> > 2. amqp_channel_t becomes a struct containing both the the channel_id
> and a
> > amqp_pool_t.  The amqp_pool would be used by the library to allocate
> frames
> > received on that channel.  The client would then be responsible for
> calling
> > amqp_pool_recycle at an appropriate point.
> >
> > Some thoughts on improving the API to deal with multiple channels:
> > 1. Add the following to the API:
> > amqp_simple_wait_frame_on_channel - wait for a frame on a specified
> channel
> > amqp_simple_wait_methods - wait for multiple methods on a specified
> channel.
> > Don't abort() if the wrong method, or channel is received, instead queue
> up
> > the frame as is done in amqp_simple_rpc
> > amqp_frames_enqueued_for_channel to add feature parity with
> > amqp_frames_enqueued
> > I started to code this up at one point but abandoned it as it didn't
> support
> > the interesting property of being able to use select() to specify a
> timeout
> > when calling amqp_simple_wait_frame_on_channel.  At least not without
> adding
> > timeout to the rabbitmq-c api, which didn't fit with how the current
> > rabbitmq-c api. Here's the implementation I came up with before I
> abandoned
> > it. I can't guarantee is completely free of
> > bugs. https://github.com/alanxz/rabbitmq-c/commits/simple_wait_frame/
> >
> > 2. Continue to duck the issue and allow clients to write their own code
> to
> > deal with multiple channels (fixing the memory management issue using
> one of
> > the above techniques)
> >
> > 3. Something I haven't thought of yet.
> >
> > So anyone have any thoughts on all of this?
> >
> > -Alan
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120113/c0db03ee/attachment.htm>

From alexis at rabbitmq.com  Fri Jan 13 22:15:47 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 13 Jan 2012 22:15:47 +0000
Subject: [rabbitmq-discuss] rabbitmq-c API improvements for multiple
	channels
In-Reply-To: <CAAt2poKSx8MFP9ORT5L7auA3w7g6JpLXdPdw99ujOJv1PSnyqg@mail.gmail.com>
References: <CAAt2poJqy+pwASwhbChmAbF569w3xHM02sFJwNJ3ZSVKX8MoxA@mail.gmail.com>
	<CACOPnvfx14ctnj2j+aE00icET7VugteBN6Vw5EgikROJMHh0_Q@mail.gmail.com>
	<CAAt2poKSx8MFP9ORT5L7auA3w7g6JpLXdPdw99ujOJv1PSnyqg@mail.gmail.com>
Message-ID: <CACOPnvdd=svYgtoP33J+ntpbQzNKS9GONcx_tTvFou8cJdK14A@mail.gmail.com>

Alan,

I'm afraid everyone has been distracted.

Could anyone on the list opine?

alexis


On Fri, Jan 13, 2012 at 9:19 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:
> I haven't really had a huge amount of time to work on it since I sent the
> first message message, with the holidays and starting up a new project at
> work.
>
> Also I was hoping to get some input from the rabbitmq guys so that any
> changes I make would have a better chance of being accepted.
>
> Taking a quick look at what I wrote a month ago, today my plan would be to
> implement having a amqp_pool_t associated with each amqp_channel_t and see
> how far I could get with that.
>
> -Alan
>
> On Thu, Jan 12, 2012 at 11:39 AM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> Alan
>>
>> It appears that you stunned everyone into silence ;-)
>>
>> How are you getting on with this?
>>
>> alexis
>>
>>
>> On Wed, Dec 14, 2011 at 8:15 PM, Alan Antonuk <alan.antonuk at gmail.com>
>> wrote:
>> > I've been working on a c++ wrapper around rabbitmq-c that presents a
>> > "humane" API to the programmer heavily inspired by the Puka project.
>> > (see:?https://github.com/alanxz/SimpleAmqpClient).
>> >
>> > In developing this library I've run across several limitations of the
>> > rabbitmq-c when working with multiple channels, the biggest issue being:
>> >
>> > - There is no way to wait for a list of methods on a channel.
>> > There is amqp_simple_wait_method() - however this suffers from some
>> > serious
>> > drawbacks:
>> > + you can only specify one method to listen for
>> > + it calls abort() if a different method, or a method on a different
>> > channel
>> > is received
>> > A use case for this might be: doing a basic.publish, and you want to
>> > want to
>> > wait for a basic.ack or a basic.return on a channel with confirms
>> > enabled
>> >
>> > The way I got around this in SimpleAmqpClient was to only use
>> > amqp_simple_wait_frame() and maintain queues of amqp_frame_t for each
>> > channel that I have open.
>> >
>> > However, this comes with one serious drawback: memory management. Each
>> > decoded frame is allocated in a connection-wide amqp_pool_t. ?Because of
>> > this - it is impossible to recycle the pool and release memory unless
>> > you
>> > have dealt with all of your pending amqp_frame_t's. ?This becomes a
>> > problem
>> > in?pathological?cases where you have two consumers sending
>> > simultaneously,
>> > you can get in the situation that even though the client program
>> > eventually
>> > deals with every consumed message, memory never gets released, because
>> > there
>> > is always at least one frame queued up.
>> >
>> > The above demonstrates the second biggest issue with the rabbitmq-c API:
>> > memory management when dealing with multiple channels. ?There is no way
>> > to
>> > separate out memory allocation on, for example, a per-channel basis
>> > (with
>> > the library client keeping track of the memory pools used for example).
>> >
>> > Before I go on I'd like to mention one feature that I find useful with
>> > the
>> > current API: it is possible to use something like select() before
>> > calling
>> > amqp_simple_wait_frame() to setup a timeout while waiting for a
>> > consumer,
>> > which is useful when developing single-threaded RPC apps.
>> >
>> >
>> > So now the interesting part: how could the API be improved?
>> >
>> > Some thoughts I've had dealing with the memory management:
>> > 1. Create a amqp_simple_wait_frame() variant that as one of the
>> > parameters
>> > provides a callback to allocate memory, either something like a malloc()
>> > call, which the client would then be responsible for freeing, or perhaps
>> > something like get_amqp_pool(amqp_frame_t) which allows the client to
>> > return
>> > a memory pool which rabbitmq-c would use to allocate memory for that
>> > frame.
>> > ?The amqp_frame_t would have to have some minimal amount of information
>> > filled in - such as frame type and channel to be useful.
>> >
>> > 2. amqp_channel_t becomes a struct containing both the the channel_id
>> > and a
>> > amqp_pool_t. ?The amqp_pool would be used by the library to allocate
>> > frames
>> > received on that channel. ?The client would then be responsible for
>> > calling
>> > amqp_pool_recycle at an appropriate point.
>> >
>> > Some thoughts on improving the API to deal with multiple channels:
>> > 1. Add the following to the API:
>> > amqp_simple_wait_frame_on_channel - wait for a frame on a specified
>> > channel
>> > amqp_simple_wait_methods - wait for multiple methods on a specified
>> > channel.
>> > Don't abort() if the wrong method, or channel is received, instead queue
>> > up
>> > the frame as is done in amqp_simple_rpc
>> > amqp_frames_enqueued_for_channel to add feature parity with
>> > amqp_frames_enqueued
>> > I started to code this up at one point but abandoned it as it didn't
>> > support
>> > the interesting property of being able to use select() to specify a
>> > timeout
>> > when calling amqp_simple_wait_frame_on_channel. ?At least not without
>> > adding
>> > timeout to the rabbitmq-c api, which didn't fit with how the current
>> > rabbitmq-c api. Here's the implementation I came up with before I
>> > abandoned
>> > it. I can't guarantee is completely free of
>> > bugs.?https://github.com/alanxz/rabbitmq-c/commits/simple_wait_frame/
>> >
>> > 2. Continue to duck the issue and allow clients to write their own code
>> > to
>> > deal with multiple channels (fixing the memory management issue using
>> > one of
>> > the above techniques)
>> >
>> > 3. Something I haven't thought of yet.
>> >
>> > So anyone have any thoughts on all of this?
>> >
>> > -Alan
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>

From jerryk at vmware.com  Fri Jan 13 23:30:56 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 13 Jan 2012 15:30:56 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-server 2.7.1 src rpm for
	Fedora/Redhat	fails to build.
In-Reply-To: <CAChq9g1Br_TZsKYo5JN9D=QNxZrb2x=PN1JDGR+=GDhQ6OXDkQ@mail.gmail.com>
Message-ID: <9fb681e0-6f1e-44db-90f7-dd1501f80148@CoachZ.local>

Hi, Travis:

I may be misremembering the situation for CentOS, but is it
possible for you to set up the fedorapeople repository and use
it to get a newer Erlang?  That's what I generally do on RHEL
systems which otherwise suffer from variants of this (quite
admittedly gross) situation....

If you follow the correct initial segments of these instructions:

http://www.rabbitmq.com/install-rpm.html

You can get yourself an Erlang that's new enough to work with
our RPM distribution and that should also be able to handle
your build-from-source needs.

Best regards,
Jerry

----- Original Message -----
From: "Travis" <hcoyote at ghostar.org>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, January 13, 2012 9:57:17 AM
Subject: [rabbitmq-discuss] rabbitmq-server 2.7.1 src rpm for Fedora/Redhat	fails to build.

I'm attempting to rebuild the source rpm to remove the Requires for
erlang to get around a problem during install on Centos 5.6 (for some
reason, yum wants to keep trying to install R12B despite us having
R14B installed already).

The rpmbuild is failing with what appears to be a git error associated
with mochiweb and a few other plugins.  At first, I thought it was
choking on not finding git, but we certainly have it installed.

What's going on here?  Also, if we could figure out this dependency
issue, I wouldn't need to be rebuilding this and could use the rpm
straight off of rabbitmq.com's download page.


:;  which git
/usr/bin/git
:;  git --version
git version 1.7.4.1


:;  sudo rpmbuild -bb rabbitmq-server.spec
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.1374
+ umask 022
+ cd /home/tcampbell/src/rpm/BUILD
+ cd /home/tcampbell/src/rpm/BUILD
+ rm -rf rabbitmq-server-2.7.1
+ /bin/gzip -dc /home/tcampbell/src/rpm/SOURCES/rabbitmq-server-2.7.1.tar.gz
+ tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd rabbitmq-server-2.7.1
++ /usr/bin/id -u
+ '[' 0 = 0 ']'
+ /bin/chown -Rhf root .
++ /usr/bin/id -u
+ '[' 0 = 0 ']'
+ /bin/chgrp -Rhf root .
+ /bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.1374
+ umask 022
+ cd /home/tcampbell/src/rpm/BUILD
+ cd rabbitmq-server-2.7.1
++ basename /home/tcampbell/src/rpm/SOURCES/rabbitmq-script-wrapper
+ cp /home/tcampbell/src/rpm/SOURCES/rabbitmq-script-wrapper
/home/tcampbell/src/rpm/BUILD/rabbitmq-script-wrapper
++ basename /home/tcampbell/src/rpm/SOURCES/rabbitmq-server.ocf
+ cp /home/tcampbell/src/rpm/SOURCES/rabbitmq-server.ocf
/home/tcampbell/src/rpm/BUILD/rabbitmq-server.ocf
+ make -j8
python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json
src/rabbit_framing_amqp_0_9_1.erl
python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.8.json
src/rabbit_framing_amqp_0_8.erl
xsltproc --novalid --stringparam modulename "`basename
src/rabbit_ctl_usage.erl .erl`" \
		docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp
xsltproc --novalid --stringparam modulename "`basename
src/rabbit_plugins_usage.erl .erl`" \
		docs/usage.xsl docs/rabbitmq-plugins.1.xml > src/rabbit_plugins_usage.erl.tmp
python codegen.py --ignore-conflicts header
../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json
../rabbitmq-codegen//amqp-rabbitmq-0.8.json include/rabbit_framing.hrl
sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_plugins_usage.erl.tmp
> src/rabbit_plugins_usage.erl.tmp2
fold -s src/rabbit_plugins_usage.erl.tmp2 > src/rabbit_plugins_usage.erl.tmp3
mv src/rabbit_plugins_usage.erl.tmp3 src/rabbit_plugins_usage.erl
sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_ctl_usage.erl.tmp >
src/rabbit_ctl_usage.erl.tmp2
rm src/rabbit_plugins_usage.erl.tmp src/rabbit_plugins_usage.erl.tmp2
fold -s src/rabbit_ctl_usage.erl.tmp2 > src/rabbit_ctl_usage.erl.tmp3
mv src/rabbit_ctl_usage.erl.tmp3 src/rabbit_ctl_usage.erl
rm src/rabbit_ctl_usage.erl.tmp src/rabbit_ctl_usage.erl.tmp2
rm -f deps.mk
echo src/delegate.erl:src/delegate_sup.erl:src/file_handle_cache.erl:src/gatherer.erl:src/gen_server2.erl:src/gm.erl:src/gm_soak_test.erl:src/gm_speed_test.erl:src/gm_tests.erl:src/lqueue.erl:src/mirrored_supervisor.erl:src/mirrored_supervisor_tests.erl:src/pg2_fixed.erl:src/pg_local.erl:src/priority_queue.erl:src/rabbit.erl:src/rabbit_access_control.erl:src/rabbit_alarm.erl:src/rabbit_amqqueue.erl:src/rabbit_amqqueue_process.erl:src/rabbit_amqqueue_sup.erl:src/rabbit_auth_backend.erl:src/rabbit_auth_backend_internal.erl:src/rabbit_auth_mechanism.erl:src/rabbit_auth_mechanism_amqplain.erl:src/rabbit_auth_mechanism_cr_demo.erl:src/rabbit_auth_mechanism_plain.erl:src/rabbit_backing_queue.erl:src/rabbit_backing_queue_qc.erl:src/rabbit_basic.erl:src/rabbit_binary_generator.erl:src/rabbit_binary_parser.erl:src/rabbit_binding.erl:src/rabbit_channel.erl:src/rabbit_channel_sup.erl:src/rabbit_channel_sup_sup.erl:src/rabbit_client_sup.erl:src/rabbit_command_assembler.erl:src/rabbit_con
 nection_sup.erl:src/rabbit_control.erl:src/rabbit_direct.erl:src/rabbit_error_logger.erl:src/rabbit_error_logger_file_h.erl:src/rabbit_event.erl:src/rabbit_exchange.erl:src/rabbit_exchange_type.erl:src/rabbit_exchange_type_direct.erl:src/rabbit_exchange_type_fanout.erl:src/rabbit_exchange_type_headers.erl:src/rabbit_exchange_type_topic.erl:src/rabbit_file.erl:src/rabbit_framing.erl:src/rabbit_guid.erl:src/rabbit_heartbeat.erl:src/rabbit_limiter.erl:src/rabbit_log.erl:src/rabbit_memory_monitor.erl:src/rabbit_mirror_queue_coordinator.erl:src/rabbit_mirror_queue_master.erl:src/rabbit_mirror_queue_misc.erl:src/rabbit_mirror_queue_slave.erl:src/rabbit_mirror_queue_slave_sup.erl:src/rabbit_misc.erl:src/rabbit_mnesia.erl:src/rabbit_msg_file.erl:src/rabbit_msg_store.erl:src/rabbit_msg_store_ets_index.erl:src/rabbit_msg_store_gc.erl:src/rabbit_msg_store_index.erl:src/rabbit_net.erl:src/rabbit_networking.erl:src/rabbit_node_monitor.erl:src/rabbit_plugins.erl:src/rabbit_prelaunch.erl:s
 rc/rabbit_queue_collector.erl:src/rabbit_queue_index.erl:src/rabbit_reader.erl:src/rabbit_registry.erl:src/rabbit_restartable_sup.erl:src/rabbit_router.erl:src/rabbit_sasl_report_file_h.erl:src/rabbit_ssl.erl:src/rabbit_sup.erl:src/rabbit_tests.erl:src/rabbit_tests_event_receiver.erl:src/rabbit_trace.erl:src/rabbit_types.erl:src/rabbit_upgrade.erl:src/rabbit_upgrade_functions.erl:src/rabbit_variable_queue.erl:src/rabbit_version.erl:src/rabbit_vhost.erl:src/rabbit_writer.erl:src/supervisor2.erl:src/tcp_acceptor.erl:src/tcp_acceptor_sup.erl:src/tcp_listener.erl:src/tcp_listener_sup.erl:src/test_sup.erl:src/vm_memory_monitor.erl:src/worker_pool.erl:src/worker_pool_sup.erl:src/worker_pool_worker.erl:src/rabbit_framing_amqp_0_9_1.erl:src/rabbit_framing_amqp_0_8.erl:src/rabbit_ctl_usage.erl:src/rabbit_plugins_usage.erl:include/gm_specs.hrl:include/rabbit.hrl:include/rabbit_auth_backend_spec.hrl:include/rabbit_auth_mechanism_spec.hrl:include/rabbit_backing_queue_spec.hrl:include/ra
 bbit_exchange_type_spec.hrl:include/rabbit_msg_store.hrl:include/rabbit_msg_store_index.hrl:include/rabbit_framing.hrl:
| escript generate_deps deps.mk ebin
escript generate_app ebin/rabbit_app.in ebin/rabbit.app src
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gen_server2.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/delegate_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/lqueue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/supervisor2.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/pg2_fixed.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/pg_local.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/priority_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_access_control.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_alarm.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_amqqueue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_amqqueue_process.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_amqqueue_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_backend.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_mechanism.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_backing_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_backing_queue_qc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_basic.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_binary_generator.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_binary_parser.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_binding.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_channel.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_channel_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_channel_sup_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_client_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_command_assembler.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_connection_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_control.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_ctl_usage.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_direct.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_error_logger.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_error_logger_file_h.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_event.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_file.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_framing.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_framing_amqp_0_8.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_framing_amqp_0_9_1.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_guid.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_heartbeat.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_limiter.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_log.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_memory_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_master.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_misc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_slave_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_misc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mnesia.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_file.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_store.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_store_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_store_gc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_net.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_networking.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_node_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_plugins.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_plugins_usage.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_prelaunch.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_queue_collector.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_queue_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_reader.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_registry.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_restartable_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_router.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_sasl_report_file_h.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_ssl.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_tests.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_tests_event_receiver.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_trace.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_types.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_upgrade.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_upgrade_functions.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_variable_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_version.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_vhost.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_writer.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/tcp_acceptor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/tcp_acceptor_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/tcp_listener.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/tcp_listener_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/test_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/vm_memory_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/worker_pool.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/worker_pool_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/worker_pool_worker.erl
[ -d "plugins-src/rabbitmq-server" ] || ln -s
"/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1"
"plugins-src/rabbitmq-server"
mkdir -p plugins
PLUGINS_SRC_DIR="" make -C "plugins-src" plugins-dist
PLUGINS_DIST_DIR="/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins"
VERSION=0.0.0
make[1]: Entering directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
make -f all-packages.mk all-releasable VERSION=0.0.0
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/delegate.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/file_handle_cache.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gatherer.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin src/gm.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/mirrored_supervisor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_backend_internal.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_mechanism_amqplain.erl
make[2]: Entering directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
[elided] generate deps
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_mechanism_cr_demo.erl
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-tracing/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-tracing/build/deps.mk
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_auth_mechanism_plain.erl
src/mirrored_supervisor.erl:126: Warning: conflicting behaviours -
callback init/1 required by both 'supervisor2' and 'gen_server2' (line
125)
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type_direct.erl
[elided] generate deps
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type_fanout.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type_headers.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_exchange_type_topic.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_msg_store_ets_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gm_soak_test.erl
[elided] fix test deps
sed -i -e 's|rabbitmq-stomp/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-stomp/build/deps.mk
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-shovel/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-shovel/build/deps.mk
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gm_speed_test.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/gm_tests.erl
[elided] generate deps
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/mirrored_supervisor_tests.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_coordinator.erl
[elided] generate deps
[elided] generate deps
[elided] generate deps
src/rabbit_mirror_queue_coordinator.erl:27: Warning: conflicting
behaviours - callback terminate/2 required by both 'gm' and
'gen_server2' (line 26)
[elided] fix test deps
sed -i -e 's|rabbitmq-management-visualiser/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-management-visualiser/build/deps.mk
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin
src/rabbit_mirror_queue_slave.erl
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-management/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-management/build/deps.mk
echo UPSTREAM_SHORT_HASH:=`hg id -R ./webmachine-wrapper/webmachine-hg
-i | cut -c -7` >webmachine-wrapper/build/hash.mk
[elided] fix test deps
sed -i -e 's|rabbitmq-jsonrpc/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-jsonrpc/build/deps.mk
sed -n -e 's|^.*{vsn, *"\([^"]*\)".*$|ORIGINAL_VERSION:=\1|p'
<webmachine-wrapper/webmachine-hg/ebin/webmachine.app
>webmachine-wrapper/build/version.mk
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-shovel-management/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-shovel-management/build/deps.mk
[elided] generate deps
abort: There is no Mercurial repository here (.hg not found)
[elided] generate deps
src/mirrored_supervisor_tests.erl:25: Warning: conflicting behaviours
- callback init/1 required by both 'mirrored_supervisor' and
'gen_server' (line 24)
[elided] generate deps
[elided] generate deps
src/rabbit_mirror_queue_slave.erl:45: Warning: conflicting behaviours
- callback terminate/2 required by both 'gm' and 'gen_server2' (line
44)
[elided] generate deps
[elided] fix test deps
[elided] fix test deps
sed -i -e 's|webmachine-wrapper/build/deps.mk|$(DEPS_FILE)|'
webmachine-wrapper/build/deps.mk
sed -i -e 's|rabbitmq-mochiweb/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-mochiweb/build/deps.mk
[elided] generate deps
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-jsonrpc-channel-examples/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-jsonrpc-channel-examples/build/deps.mk
echo UPSTREAM_SHORT_HASH:=`git
--git-dir=./mochiweb-wrapper/mochiweb-git/.git log -n 1 HEAD | grep
commit | cut -b 8-14` >mochiweb-wrapper/build/hash.mk
fatal: Not a git repository: './mochiweb-wrapper/mochiweb-git/.git'
./mochiweb-wrapper/mochiweb-git/support/make_app.escript
mochiweb-wrapper/mochiweb-git/src/mochiweb.app.src
mochiweb-wrapper/mochiweb-git/mochiweb.app "" "`cd
./mochiweb-wrapper/mochiweb-git/src && echo *.erl | sed 's|\.erl||g'`"
[elided] fix test deps
sed -i -e 's|rabbitmq-jsonrpc-channel/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-jsonrpc-channel/build/deps.mk
[elided] generate deps
[elided] fix test deps
sed -i -e 's|rabbitmq-management-agent/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-management-agent/build/deps.mk
[elided] fix test deps
[elided] fix test deps
sed -i -e 's|rabbitmq-consistent-hash-exchange/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-consistent-hash-exchange/build/deps.mk
echo UPSTREAM_SHORT_HASH:=`git
--git-dir=erlang-rfc4627-wrapper/erlang-rfc4627-git/.git log -n 1 HEAD
| grep commit | cut -b 8-14` >erlang-rfc4627-wrapper/build/hash.mk
fatal: Not a git repository: 'erlang-rfc4627-wrapper/erlang-rfc4627-git/.git'
sed -i -e 's|rabbitmq-federation/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-federation/build/deps.mk
[elided] generate deps
erlc -Wall +debug_info -I eldap-wrapper/eldap-git/generated -o
eldap-wrapper/eldap-git/generated
eldap-wrapper/eldap-git/src/ELDAPv3.asn
echo UPSTREAM_SHORT_HASH:=`git --git-dir=eldap-wrapper/eldap-git/.git
log -n 1 HEAD | grep commit | cut -b 8-14`
>eldap-wrapper/build/hash.mk
fatal: Not a git repository: 'eldap-wrapper/eldap-git/.git'
[elided] fix test deps
sed -i -e 's|rabbitmq-auth-mechanism-ssl/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-auth-mechanism-ssl/build/deps.mk
Compiler function asn1ct:compile_asn/3 failed:
{undef,[{asn1ct,compile_asn,

["/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/src/ELDAPv3",

"/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated/ELDAPv3",

{options,["/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated"],

"/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src/eldap-wrapper/eldap-git/generated",
                          undefined,[],999,false,999,
                          [debug_info],
                          [],

"/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src"}]},
        {erl_compile,compile_file,4},
        {erl_compile,compile3,3},
        {erl_compile,compiler_runner,1}]}
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:24: Warning:
ambiguous call of overridden auto-imported BIF error/1
 - use erlang:error/1 or "-compile({no_auto_import,[error/1]})." to
resolve name clash
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:42: Warning:
ambiguous call of overridden auto-imported BIF error/1
 - use erlang:error/1 or "-compile({no_auto_import,[error/1]})." to
resolve name clash
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:45: Warning:
ambiguous call of overridden auto-imported BIF error/1
 - use erlang:error/1 or "-compile({no_auto_import,[error/1]})." to
resolve name clash
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:48: Warning:
ambiguous call of overridden auto-imported BIF error/1
 - use erlang:error/1 or "-compile({no_auto_import,[error/1]})." to
resolve name clash
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:66: Warning:
variable 'Attrs' is unused
./mochiweb-wrapper/mochiweb-git/support/make_app.escript:71: Warning:
variable 'Attrs' is unused
[elided] fix test deps
sed -i -e 's|mochiweb-wrapper/build/deps.mk|$(DEPS_FILE)|'
mochiweb-wrapper/build/deps.mk
[elided] fix test deps
[elided] fix test deps
sed -i -e 's|erlang-rfc4627-wrapper/build/deps.mk|$(DEPS_FILE)|'
erlang-rfc4627-wrapper/build/deps.mk
sed -i -e 's|rabbitmq-auth-backend-ldap/build/deps.mk|$(DEPS_FILE)|'
rabbitmq-auth-backend-ldap/build/deps.mk
[elided] fix test deps
sed -i -e 's|erlando/build/deps.mk|$(DEPS_FILE)|' erlando/build/deps.mk
sed -n -e 's|^.*{vsn, *"\([^"]*\)".*$|ORIGINAL_VERSION:=\1|p'
<mochiweb-wrapper/mochiweb-git/mochiweb.app
>mochiweb-wrapper/build/version.mk
make[2]: Leaving directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
make[2]: Entering directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
do-package.mk:507: *** Failed to produce eldap-wrapper/build/deps.mk.  Stop.
make[2]: Leaving directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
make[1]: *** [release] Error 2
make[1]: Leaving directory
`/home/tcampbell/src/rpm/BUILD/rabbitmq-server-2.7.1/plugins-src'
make: *** [plugins] Error 2
error: Bad exit status from /var/tmp/rpm-tmp.1374 (%build)


RPM build errors:
    Bad exit status from /var/tmp/rpm-tmp.1374 (%build)
--
Travis Campbell
travis at ghostar.org
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Sat Jan 14 10:27:31 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 14 Jan 2012 14:27:31 +0400
Subject: [rabbitmq-discuss] Important change in amqp gem master
Message-ID: <F1EBD9FE-C4AB-474E-BBAA-04E79AF077BF@gmail.com>

Deprecated code from amqp gem 0.6.x and 0.7.x release series is now REMOVED
in master [1]. We have had deprecation warnings in place for over 6 months now and currently working
towards 1.0 release. Time for old poorly named classes and other cruft to go.

If you still haven't migrated to 0.8.x and later releases, time to do it. See our migration guide [2]
for more information.

Have a good day!


1. https://github.com/ruby-amqp/amqp/commit/d63c95d2b3e36780d4d3c0948a8245df857322bc
2. http://rubyamqp.info/articles/08_migration/

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From orenshome at gmail.com  Sun Jan 15 09:16:45 2012
From: orenshome at gmail.com (Oren Shochat)
Date: Sun, 15 Jan 2012 11:16:45 +0200
Subject: [rabbitmq-discuss] Getting Rid of a Faulty message
Message-ID: <CAJtNgzw5od_s1-jc6zFAJddr_k6KvVFm6LHSS5Y+OZG4Q8CeRQ@mail.gmail.com>

I have a RabbitMQ on Amazon load balancing between N processors that do
heavy image processing algorithms (running 1-8 min on an 8 core computer) .
I'm using RabbitMQ fair dispatch and message acknowledgement to make sure
the Algorithm requests are distributed fairly amongst the processors.

However once in a while I get a message that causes the processor to crash.
RabbitMQ of course (since no ack received and connection terminated) makes
sure the message goes to the next processor which also crashes because
processors share the same code.  Soon all the processors are down. They go
up again, but the faulty message stays in the system until I get the alarms
and purges the RabbitMQ queue.

The processors have a 10 years old legacy code written by multiple
mathematicians and is almost impossible to protect against all faulty data.



Is there any mechanism in RabbitMQ that can still give me load balancing
but kick out a message that cannot be processed by consumers?


Thanks

Oren
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120115/72fe6582/attachment.htm>

From simone.busoli at gmail.com  Sun Jan 15 10:54:55 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sun, 15 Jan 2012 11:54:55 +0100
Subject: [rabbitmq-discuss] Getting Rid of a Faulty message
In-Reply-To: <CAJtNgzw5od_s1-jc6zFAJddr_k6KvVFm6LHSS5Y+OZG4Q8CeRQ@mail.gmail.com>
References: <CAJtNgzw5od_s1-jc6zFAJddr_k6KvVFm6LHSS5Y+OZG4Q8CeRQ@mail.gmail.com>
Message-ID: <CAOn7oW_2-PxbRWfXfjHfAJFnpL88bHb-64Ygp1Wc4hg-bHVwjQ@mail.gmail.com>

Hi Oren,

RabbitMQ has some mechanisms to handle this, but you'd first need to
describe what you want to do with the faulty message.

   - IF you know the message is going to bring down the other processors
   why aren't you just acking (or nacking or rejecting with requeue=false) it
   before crashing the first processor? I am assuming this is an option, it
   may not be.
   - If you cannot even modify the part of the code which interacts with
   RabbitMQ in the processors you could enable the autoack option, and each
   message will be considered acked as soon as it leaves the broker network
   stack. Beware that this relaxes the reliability constraints you may have,
   introducing the chance of loosing messages


On Sun, Jan 15, 2012 at 10:16, Oren Shochat <orenshome at gmail.com> wrote:

> I have a RabbitMQ on Amazon load balancing between N processors that do
> heavy image processing algorithms (running 1-8 min on an 8 core computer) .
> I'm using RabbitMQ fair dispatch and message acknowledgement to make sure
> the Algorithm requests are distributed fairly amongst the processors.
>
> However once in a while I get a message that causes the processor to
> crash. RabbitMQ of course (since no ack received and connection terminated)
> makes sure the message goes to the next processor which also crashes
> because processors share the same code.  Soon all the processors are
> down. They go up again, but the faulty message stays in the system until I
> get the alarms and purges the RabbitMQ queue.
>
> The processors have a 10 years old legacy code written by multiple
> mathematicians and is almost impossible to protect against all faulty data.
>
>
>
> Is there any mechanism in RabbitMQ that can still give me load balancing
> but kick out a message that cannot be processed by consumers?
>
>
> Thanks
>
> Oren
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120115/f259d60c/attachment.htm>

From sophiewenxizhang at googlemail.com  Mon Jan 16 10:02:39 2012
From: sophiewenxizhang at googlemail.com (TZHA)
Date: Mon, 16 Jan 2012 02:02:39 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in
	production environment.
Message-ID: <7f328139-e23a-4946-8932-fc728aad3021@a17g2000yqj.googlegroups.com>

Hi,

i am working with rabbitmq-c (downloaded from github/newest version -
cmake/VS2010 rebuild under windows) and would like to prepare a
rabbitmq/c/c++ based solution for a production environment.

However for a real application, we still have some reliability
requirements that are apparently not yet supported by rabbitmq-c.

The first requirement is to get ?cancellation notification? in case,
e.g. whenever a queue is down ? so that the client/consumer can
reconnect to the broker.

For this purpose ? as I understood, the client has to send  the
?client-capabilities? with

   ...
   consumer_cancel_notify = true,
   publisher_confirms = true

for the connection setup. In  case of of rabbitmq-c, I saw that one
shall set the capabilities in amqp_login (amqp_socket.c)  method.
Current this is set to NULL.

  amqp_connection_open_t s
  s.capabilities.len = 0;
  s.capabilities.bytes = NULL;

Can some expert tell me what kind of syntax can be used for the
s.capabilities.bytes field?

The next requirement is to receive publisher_confirms. I guess that
the client-capabilities is also a pre-condition, and I have to set the
?mandatory? parameter for the amqp_basic_publish method to 1. Is there
anything else I have to set?

Thanks in advance for any advices.

From sophiewenxizhang at googlemail.com  Mon Jan 16 10:04:21 2012
From: sophiewenxizhang at googlemail.com (TZHA)
Date: Mon, 16 Jan 2012 02:04:21 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c (librabbizmq) works only
	partially.
In-Reply-To: <9a957d55-452a-44f4-b65f-fe15fcdcad3d@p2g2000vbj.googlegroups.com>
References: <loom.20111128T112008-575@post.gmane.org>
	<yrv4cobvwfn38.fsf@dwragg.eng.vmware.com>
	<abedf3db-60b0-4369-9dce-676629672d02@r28g2000yqj.googlegroups.com>
	<yrv4ck46kfh9p.fsf@dwragg.eng.vmware.com>
	<9a957d55-452a-44f4-b65f-fe15fcdcad3d@p2g2000vbj.googlegroups.com>
Message-ID: <4310e2ad-c680-44f6-969c-05b06834f457@24g2000yqi.googlegroups.com>

Hi,

I just want to confirm that the cmake build works under my Window with
VS2010.

Thanks.

On 2 Dez. 2011, 17:26, TZHA <sophiewenxizh... at googlemail.com> wrote:
> Thanks for the reply.
>
> I will check it during the next week.
>
> On 28 Nov., 15:33, David Wragg <da... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> >TZHA<sophiewenxizh... at googlemail.com> writes:
> > > The error I got with the latest version ofrabbitmq-cwas:
>
> > > "A buffer overrun has occurred in z_rabbitmq_client_consumer.exe which
> > > has corrupted the program's internal state. Press Break to debug the
> > > program or Continue to terminate the program.
>
> > This is because you are trying to use a mingw build of librabbitmq from
> > Visual Studio. ?This doesn't work because VS and gcc disagree about x86
> > calling conventions. ?As a result, the program crashes is a way that VS
> > diagnoses as a buffer overrun.
>
> > > I started VS 2010 debugging on a consumer project (c++) which uses the
> > >rabbitmq-cc api.
>
> > > I guess I finally found out at least the reason for my previous
> > > error. ?I used a c++ wrapper (amqpcpp ?- modified) which calls
> > > amqp_simple_rpc to implement the consumer, which then caused the error
> > > (but runs correctly with DEBUG).
>
> > > I modified the code to use amqp_basic_consume (following the
> > > consumer.c), the c++ consumer ?application works now.
>
> > > However, I still have the buffer overrun problem with the latest
> > > version. I used MinGW to build the package. ?Do you whether there is a
> > > guide/readme for cmake build?
>
> > There are some brief instructions in therabbitmq-cREADME. ?In more
> > detail:
>
> > Install cmake (from <http://cmake.org/>). ?Then open up a command
> > prompt, create a build directory, and from there run cmake with the path
> > to therabbitmq-csource directory:
>
> > Z:\>cd tmp
>
> > Z:\tmp>mkdirrabbitmq-c-build
>
> > Z:\tmp>cdrabbitmq-c-build
>
> > Z:\tmp\rabbitmq-c-build>cmake ..\rabbitmq-c
> > -- Building for: Visual Studio 10
> > -- Check for working C compiler using: Visual Studio 10
> > -- Check for working C compiler using: Visual Studio 10 -- works
> > -- Detecting C compiler ABI info
> > -- Detecting C compiler ABI info - done
> > -- Found PythonInterp: C:/Python27/python.exe (found version "2.7")
> > -- Using amqp_codegen.py in Z:/tmp/rabbitmq-codegen
> > -- Configuring done
> > -- Generating done
> > -- Build files have been written to: Z:/tmp/rabbitmq-c-build
>
> > Then open up therabbitmq-c.sln file in VS, and build.
>
> > --
> > David Wragg
> > Staff Engineer, RabbitMQ
> > VMware, Inc.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Jan 16 10:50:25 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Jan 2012 10:50:25 +0000
Subject: [rabbitmq-discuss] Getting Rid of a Faulty message
In-Reply-To: <CAJtNgzw5od_s1-jc6zFAJddr_k6KvVFm6LHSS5Y+OZG4Q8CeRQ@mail.gmail.com>
References: <CAJtNgzw5od_s1-jc6zFAJddr_k6KvVFm6LHSS5Y+OZG4Q8CeRQ@mail.gmail.com>
Message-ID: <4F1400F1.4070003@rabbitmq.com>

Hi Oren,

On 15/01/12 09:16, Oren Shochat wrote:
> I have a RabbitMQ on Amazon load balancing between N processors that do
> heavy image processing algorithms (running 1-8 min on an 8 core
> computer) . I'm using RabbitMQ fair dispatch and message acknowledgement
> to make sure the Algorithm requests are distributed fairly amongst the
> processors.
> 
> However once in a while I get a message that causes the processor to
> crash. RabbitMQ of course (since no ack received and connection
> terminated) makes sure the message goes to the next processor which also
> crashes because processors share the same code.  Soon all the processors
> are down. They go up again, but the faulty message stays in the system
> until I get the alarms and purges the RabbitMQ queue.

Full support for toxic/poison message handling is a planned feature (See
the "basic / deliver / 01" reference in the 0-9-1 rules here:
http://www.rabbitmq.com/specification.html#rules)

In the meantime you can make use of the "redelivered" flag as an
indicator that a processor previously failed to process a message and
treat it with greater circumspection.



-Emile


From yogimogi at gmail.com  Mon Jan 16 07:15:09 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Sun, 15 Jan 2012 23:15:09 -0800 (PST)
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
Message-ID: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>

Hello,

Is there a way to ensure that queue with x-expires option set, in
addition to not being unused, will not get deleted if there is at-
least one message on the queue?

regards, Yogesh

From simon at rabbitmq.com  Mon Jan 16 11:26:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Jan 2012 11:26:40 +0000
Subject: [rabbitmq-discuss] rabbitmq-server 2.7.1 src rpm for
 Fedora/Redhat fails to build.
In-Reply-To: <CAChq9g1Br_TZsKYo5JN9D=QNxZrb2x=PN1JDGR+=GDhQ6OXDkQ@mail.gmail.com>
References: <CAChq9g1Br_TZsKYo5JN9D=QNxZrb2x=PN1JDGR+=GDhQ6OXDkQ@mail.gmail.com>
Message-ID: <4F140970.4030701@rabbitmq.com>

On 13/01/12 17:57, Travis wrote:
> The rpmbuild is failing with what appears to be a git error associated
> with mochiweb and a few other plugins.  At first, I thought it was
> choking on not finding git, but we certainly have it installed.

I think that's a red herring - the real error is a bit further on, 
complaining about not having the Erlang ASN.1 compiler:

 > Compiler function asn1ct:compile_asn/3 failed:
 > {undef,[{asn1ct,compile_asn,

I'm not sure how this works on Red Hat, but you need to make sure you 
have this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jan 16 11:29:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Jan 2012 11:29:02 +0000
Subject: [rabbitmq-discuss] [Bug] When displaying the payload in the Web
 Management console/plugin the payload is displayed without xml chars
 escaped.
In-Reply-To: <4F107217.4020100@pfgltd.com>
References: <4F107217.4020100@pfgltd.com>
Message-ID: <4F1409FE.9080500@rabbitmq.com>

On 13/01/12 18:04, Sam Domonkos wrote:
> When displaying the payload in the Web Management console/plugin the
> payload is displayed without xml chars as escaped versions. (example,
> &amp; is displaying as &).

Ah. Thanks for the heads up.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From mspetrovic at gmail.com  Mon Jan 16 14:43:07 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Mon, 16 Jan 2012 06:43:07 -0800
Subject: [rabbitmq-discuss] The idiom for shutting down a consumer in a
	thread task
Message-ID: <CABMnSbHzRqM1-9x4BY=LtVHPnn8FYF3swgBsh1qj7UxNgeerAQ@mail.gmail.com>

Hello.

I'm looking for the idiom for how to gracefully shutdown a consumer
running in a Java thread.  Given a Runnable's run() method that looks
like this

    @Override
    public void run() {
        while (doConsume) {
            try {
                channel.basicConsume(queue, false, busReader);
            } catch (IOException e) {
                throw new RuntimeException("Error in reader", e);
            }
        }
    }

what is the recommended way to cancel this logical task?  Call
connection.close() and exit out the catch-block?

Thank you.

-- 
Mark

From andrea.rosa at hp.com  Mon Jan 16 14:49:06 2012
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 16 Jan 2012 14:49:06 +0000
Subject: [rabbitmq-discuss] server crash 2.6.1
Message-ID: <5F389C517756284F80239F55BCA5DDDD3690D8AD@G4W3209.americas.hpqcorp.net>

Hi 

the rabbitmq server crashed and in the log file I found the following error:

=ERROR REPORT==== 16-Jan-2012::12:56:26 ===
** Generic server msg_store_transient terminating
** Last message in was {'$gen_cast',
                           {client_dying,
                               <<30,178,227,234,255,154,35,131,109,133,30,
                                 176,149,67,212,244>>}}	


After this error all connections have been closed.
I restarted the service and now it seems ok, here the results of the rabbitmqctl status command:
[{pid,24464},
 {running_applications,[{rabbit,"RabbitMQ","2.6.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.4"},
                        {sasl,"SASL  CXC 138 11","2.1.8"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        {stdlib,"ERTS  CXC 138 10","1.16.4"},
                        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:24:24] [rq:24] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,99948160},
          {processes,71699784},
          {processes_used,71674392},
          {system,28248376},
          {atom,1108281},
          {atom_used,1096157},
          {binary,1072504},
          {code,11832227},
          {ets,6533584}]}]
...done.

The log entries doesn't help me.
Kind regards
--
Andrea Rosa

From steve at rabbitmq.com  Mon Jan 16 15:21:19 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 16 Jan 2012 15:21:19 +0000
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <16d4069e-726a-4121-b412-341cff384c4b@ck5g2000vbb.googlegroups.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
	<0CF971BF-82C1-4D62-BB41-2628875837AE@rabbitmq.com>
	<03877dc9-66c8-473b-a99a-6f8c8bf4bb59@d10g2000vbh.googlegroups.com>
	<6ff0e474-a026-449f-994d-f062203175ca@w4g2000vbc.googlegroups.com>
	<C173C983-48CC-4AC1-ADC8-336E9F99B1F4@rabbitmq.com>
	<16d4069e-726a-4121-b412-341cff384c4b@ck5g2000vbb.googlegroups.com>
Message-ID: <7DCEDEF1-71CE-495F-A476-5937273CFFC2@rabbitmq.com>

Hi Venkat,

I'm not at all sure what is happening with the cluster nodes. But it is hard to
tell with the information provided.  It looks as though your nodes are both
running as disc nodes happily -- is it still true that the rabbitmqctl report
command is failing on t-2? I wondered if this might be something to do with the
user you are running the rabbitmqctl command under?  Try it with and without
sudo, for example.

Your message rate of 40k with only one exception/loss is good, isn't it? I'm not
certain that the recreate connection code you have used is all necessary, but if
it works for you, that's fine. What made you put in a 2-second delay (why a
delay and why 2 seconds)?

The only other thing I might suggest is that you investigate publisher confirms.
This is a lightweight way of knowing that a publish actually got through to the
rabbitmq node and was successfully passed on (or stored). See
[http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/] for an
introduction using Java, and
[http://www.rabbitmq.com/extensions.html#publishing] for the AMQP details. It
may be just what you want to know when wondering if your message is lost.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 13 Jan 2012, at 05:03, Venkat wrote:

(You did start_app after the cluster command, didn't you???  :-))

Hi Steve I did restart the the app.
Following are the steps I have performed on both nodes:

Starting the second node t-4:
./rabbitmq-server -detached

Steps to join t-4 node to t-2:
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl stop_app
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl reset
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster rabbit at t-2 rabbit at t-4
Clustering node 'rabbit at t-4' with ['rabbit at t-2',
                                    'rabbit at t-4'] ...
...done.
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl start_app
Starting node 'rabbit at t-4' ...
...done.

Running cluster_status on t-4 node:
[ecloud at t-4 sbin]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster_status
Cluster status of node 'rabbit at t-4' ...
[{nodes,[{disc,['rabbit at t-4','rabbit at t-2']}]},
{running_nodes,['rabbit at t-2','rabbit at t-4']}]
...done.

Running cluster_status on t-2 node (to which t-4 is joined):
[ecloud at t-2 vv]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster_status
Cluster status of node 'rabbit at t-2' ...
[{nodes,[{disc,['rabbit at t-4','rabbit at t-2']}]},
{running_nodes,['rabbit at t-4','rabbit at t-2']}]
...done.

--------------------------------------------------------------------------------
I have been testing with HA feature with different scenario.
In my previous test the messages were pumped in with a SOAP service.
This was pumping messages at slow rate.
I have used a test that pumps in messages by calling plain Java
Service. I have also increased messages pumping in from 20K to 40K.
I am finding that messages are lost while pumping into the queue.
As you mentioned earlier this could be due to connecting to dead
broker.
I modified the producer code by giving 2 seconds lapse of time and
setting a fresh ConnectionFactory as follows:

@Override
public void convertAndSend(final Object message) throws AmqpException
{
  MessageProperties props = null;
  try {
    props = new MessageProperties();
    props.setDeliveryMode(MessageDeliveryMode.PERSISTENT);   //setting delivery mode as PERSISTENT
    send(getMessageConverter().toMessage(message, props));
  } catch (AmqpException amqpe) {
    System.out.println("Exception occurred while sending:"+amqpe.getMessage());
    try {
      Thread.sleep(2000);
    } catch (InterruptedException e) {
      e.printStackTrace();
    }
    Properties props1 = FrameworkServiceLocator.getInstance().
      getCommonsConfigurationService(ServiceConstants.DMB_COMMONS_CONFIG_SERVICE).
      getProperties(CommonsConfigurationConstants.RABBIT_MQ_CONFIG_NAME);
    String rabbitMQUser = props1.getProperty(CommonsConfigurationConstants.RABBITMQ_USER);
    String rabbitMQPassword = props1.getProperty(CommonsConfigurationConstants.RABBITMQ_PASSWORD);
    String rabbitMQHost = props1.getProperty(CommonsConfigurationConstants.RABBITMQ_HOST);
    String rabbitMQChannelCacheSize = props1.getProperty(CommonsConfigurationConstants.RABBITMQ_CHANNEL_CACHE_SIZE);
    CachingConnectionFactory connectionFactory = new CachingConnectionFactory(rabbitMQHost);
    connectionFactory.setChannelCacheSize(Integer.parseInt(rabbitMQChannelCacheSize));
    connectionFactory.setUsername(rabbitMQUser);
    connectionFactory.setPassword(rabbitMQPassword);
    setConnectionFactory(connectionFactory);
    try {
      send(getMessageConverter().toMessage(message, props));
    } catch(AmqpException e1) {
      e1.printStackTrace();
    }
  }
}

After this change is made, I saw an exception occurred once while
sending 40K messages which is as follows:
java.net.SocketException: Broken pipe.
I have run the test 10-15 times each time 5K-6K messages were lost
but this exception was occurring only once.

Thanks
Venkat


On Jan 11, 12:55 pm, Steve Powell <st... at rabbitmq.com> wrote:
Hi Venkat,

This time there were no messages lost. All 20K messages were
processed.

That's great.

I'm trying to figure out what might be wrong with
rabbitmqctl report; I'll get back to you.

Meanwhile, running
       rabbitmqctl -n rabbit at t-2 status
ON NODE t-4 might be interesting.

Also, can you tell us the output from
       rabbitmqctl cluster_status
on both nodes, please.

It is not clear if you have issued the stop_app and start_app and
reset/force_reset commands properly (you probably have), so could you follow
the steps as described in the clustering guide, and issue
rabbitmqctl cluster_status on both nodes after each cluster change?
We should be able to see where things went wrong, then.

(You did start_app after the cluster command, didn't you???  :-))

Cheers,

Steve Powell  (a hoppy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 11 Jan 2012, at 01:22, Venkat wrote:> ...

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Jan 16 15:25:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Jan 2012 15:25:10 +0000
Subject: [rabbitmq-discuss] server crash 2.6.1
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3690D8AD@G4W3209.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3690D8AD@G4W3209.americas.hpqcorp.net>
Message-ID: <4F144156.6060700@rabbitmq.com>

On 16/01/12 14:49, Rosa, Andrea wrote:
> the rabbitmq server crashed and in the log file I found the following error:
>
> =ERROR REPORT==== 16-Jan-2012::12:56:26 ===
> ** Generic server msg_store_transient terminating
> ** Last message in was {'$gen_cast',
>                             {client_dying,
>                                 <<30,178,227,234,255,154,35,131,109,133,30,
>                                   176,149,67,212,244>>}}	
>

That's not the complete error - there should be

** When Server state ==

and

** Reason for termination ==

sections too - can you post those?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jan 16 15:26:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Jan 2012 15:26:11 +0000
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
In-Reply-To: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>
References: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>
Message-ID: <4F144193.5040109@rabbitmq.com>

On 16/01/12 07:15, Yogesh Ketkar wrote:
> Is there a way to ensure that queue with x-expires option set, in
> addition to not being unused, will not get deleted if there is at-
> least one message on the queue?

I'm afraid not. What are you trying to do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Mon Jan 16 15:31:04 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Jan 2012 19:31:04 +0400
Subject: [rabbitmq-discuss] The idiom for shutting down a consumer in a
	thread task
In-Reply-To: <CABMnSbHzRqM1-9x4BY=LtVHPnn8FYF3swgBsh1qj7UxNgeerAQ@mail.gmail.com>
References: <CABMnSbHzRqM1-9x4BY=LtVHPnn8FYF3swgBsh1qj7UxNgeerAQ@mail.gmail.com>
Message-ID: <B640E64C-26F5-4D5F-8A49-F5FB302CA44F@gmail.com>

Mark Petrovic:

> what is the recommended way to cancel this logical task?  Call
> connection.close() and exit out the catch-block?

Closing the entire connection is probably not necessary. Closing the channel is sufficient. Another way is to store consumer tag basicConsume returns you and use basicCancel to cancel it later.

MK


From static.void.dev at gmail.com  Mon Jan 16 15:39:17 2012
From: static.void.dev at gmail.com (Mark)
Date: Mon, 16 Jan 2012 07:39:17 -0800
Subject: [rabbitmq-discuss] Ruby and AMQP
Message-ID: <4F1444A5.2050709@gmail.com>

Morning all,

I have some questions regarding the use of RabbitMQ or even AMQP in 
general. Our main application is written in Ruby on Rails and we have a 
bunch of auxiliary services (search, recommendations, emailing, image 
resizing, etc). For our queuing needs we are currently using a Redis 
backed queing system (Resque) and for communications between services we 
are using JSON. I am looking into AMQP/RabbitMQ to see if can be of any 
use. The only problem is I don't see why AMQP should replace what we 
have now.

For example Resque is a great queuing system. We simply throw a job into 
the queue and have it completed by one of our workers which is dead 
simple to spawn... ie, just tell Resque how many workers you want for 
job X. In RabbitMQ or the Ruby-AMQP gem I don't see how this is easily 
accomplished. How would I spawn multiple workers without each of them 
loading up the full Rails environment? Is there anything to manage all 
of these workers?

Secondly, I know RabbitMQ is way more than just a simple queuing system 
but when it comes to RPC what are the benefits over a simple restful or 
JSON approach?

I was hoping someone can shed some light on these questions. It would 
also be very helpful if some ruby users out there could explain how you 
are using AMQP and why you chose it over alternative options?

Thanks.

- M

From yogimogi at gmail.com  Mon Jan 16 15:56:30 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Mon, 16 Jan 2012 07:56:30 -0800 (PST)
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
In-Reply-To: <4F144193.5040109@rabbitmq.com>
References: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>
	<4F144193.5040109@rabbitmq.com>
Message-ID: <384f67bd-c561-4728-8796-7528863d9176@k3g2000pbn.googlegroups.com>

Thanks Simon for the response.
This is what I am trying to achieve.

I am going to get events from an external system on RabbitMQ queue.
Event payload looks something like

Payload-1
<Info>
   <AppId>10</AppId>
   <Action>Create</Action>
</Info>

Payload-2
<Info>
   <AppId>10</AppId>
   <Action>Delete</Action>
</Info>

Payload-3
<Info>
   <AppId>11</AppId>
   <Action>Create</Action>
</Info>

Events which have same AppId have to be processed sequentially. So I
was planning to have just one consumer on this queue, this consumer
will create queues on the fly with names like AppId-10, AppId-10 etc
and move those corresponding events to those queues. Each of these
queues will have only one consumer so as to guarantee sequential
processing of the events.
There could be thousands of queues which would get created, each with
probably on 10 to 20 messages.
I would like to delete the queue with no messages in it and so asked
the question.

Can you suggest an alternative to achieve
1. Delete the queue when last event processed from the queue has
<Action>Delete</Action> as this implies that
   no more events with same <AppId> would ever get created.
2. Delete the queue when it is IDLE for certain period, meaning it is
empty and no more event was added to it for certain time period.

regards, Yogesh


On Jan 16, 8:26?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 16/01/12 07:15, Yogesh Ketkar wrote:
>
> > Is there a way to ensure that queue with x-expires option set, in
> > addition to not being unused, will not get deleted if there is at-
> > least one message on the queue?
>
> I'm afraid not. What are you trying to do?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alan.antonuk at gmail.com  Mon Jan 16 16:32:00 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 16 Jan 2012 11:32:00 -0500
Subject: [rabbitmq-discuss] rabbitmq-c (librabbizmq) works only
	partially.
In-Reply-To: <4310e2ad-c680-44f6-969c-05b06834f457@24g2000yqi.googlegroups.com>
References: <loom.20111128T112008-575@post.gmane.org>
	<yrv4cobvwfn38.fsf@dwragg.eng.vmware.com>
	<abedf3db-60b0-4369-9dce-676629672d02@r28g2000yqj.googlegroups.com>
	<yrv4ck46kfh9p.fsf@dwragg.eng.vmware.com>
	<9a957d55-452a-44f4-b65f-fe15fcdcad3d@p2g2000vbj.googlegroups.com>
	<4310e2ad-c680-44f6-969c-05b06834f457@24g2000yqi.googlegroups.com>
Message-ID: <CAAt2poJ1oDDUJ6Eiz0gNwSL0XvQFA6ZDcjRmXXgxM4T7b+ebvg@mail.gmail.com>

The rabbitmq-c library should compile with cmake under VS2010/

On Mon, Jan 16, 2012 at 5:04 AM, TZHA <sophiewenxizhang at googlemail.com>wrote:

> Hi,
>
> I just want to confirm that the cmake build works under my Window with
> VS2010.
>
> Thanks.
>
> On 2 Dez. 2011, 17:26, TZHA <sophiewenxizh... at googlemail.com> wrote:
> > Thanks for the reply.
> >
> > I will check it during the next week.
> >
> > On 28 Nov., 15:33, David Wragg <da... at rabbitmq.com> wrote:
> >
> >
> >
> >
> >
> >
> >
> > >TZHA<sophiewenxizh... at googlemail.com> writes:
> > > > The error I got with the latest version ofrabbitmq-cwas:
> >
> > > > "A buffer overrun has occurred in z_rabbitmq_client_consumer.exe
> which
> > > > has corrupted the program's internal state. Press Break to debug the
> > > > program or Continue to terminate the program.
> >
> > > This is because you are trying to use a mingw build of librabbitmq from
> > > Visual Studio.  This doesn't work because VS and gcc disagree about x86
> > > calling conventions.  As a result, the program crashes is a way that VS
> > > diagnoses as a buffer overrun.
> >
> > > > I started VS 2010 debugging on a consumer project (c++) which uses
> the
> > > >rabbitmq-cc api.
> >
> > > > I guess I finally found out at least the reason for my previous
> > > > error.  I used a c++ wrapper (amqpcpp  - modified) which calls
> > > > amqp_simple_rpc to implement the consumer, which then caused the
> error
> > > > (but runs correctly with DEBUG).
> >
> > > > I modified the code to use amqp_basic_consume (following the
> > > > consumer.c), the c++ consumer  application works now.
> >
> > > > However, I still have the buffer overrun problem with the latest
> > > > version. I used MinGW to build the package.  Do you whether there is
> a
> > > > guide/readme for cmake build?
> >
> > > There are some brief instructions in therabbitmq-cREADME.  In more
> > > detail:
> >
> > > Install cmake (from <http://cmake.org/>).  Then open up a command
> > > prompt, create a build directory, and from there run cmake with the
> path
> > > to therabbitmq-csource directory:
> >
> > > Z:\>cd tmp
> >
> > > Z:\tmp>mkdirrabbitmq-c-build
> >
> > > Z:\tmp>cdrabbitmq-c-build
> >
> > > Z:\tmp\rabbitmq-c-build>cmake ..\rabbitmq-c
> > > -- Building for: Visual Studio 10
> > > -- Check for working C compiler using: Visual Studio 10
> > > -- Check for working C compiler using: Visual Studio 10 -- works
> > > -- Detecting C compiler ABI info
> > > -- Detecting C compiler ABI info - done
> > > -- Found PythonInterp: C:/Python27/python.exe (found version "2.7")
> > > -- Using amqp_codegen.py in Z:/tmp/rabbitmq-codegen
> > > -- Configuring done
> > > -- Generating done
> > > -- Build files have been written to: Z:/tmp/rabbitmq-c-build
> >
> > > Then open up therabbitmq-c.sln file in VS, and build.
> >
> > > --
> > > David Wragg
> > > Staff Engineer, RabbitMQ
> > > VMware, Inc.
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120116/6f5cf2c3/attachment.htm>

From dougbarth at gmail.com  Mon Jan 16 16:44:00 2012
From: dougbarth at gmail.com (Doug Barth)
Date: Mon, 16 Jan 2012 08:44:00 -0800 (PST)
Subject: [rabbitmq-discuss] Ruby and AMQP
In-Reply-To: <4F1444A5.2050709@gmail.com>
References: <4F1444A5.2050709@gmail.com>
Message-ID: <08641542-d132-425b-bf1d-a8b057f984ac@m11g2000yqe.googlegroups.com>

Our application makes use of both RabbitMQ backed workers and Resque
workers. We've found RabbitMQ to be a good fit for quick to process,
high volume units of work (eg. sending a text message to a phone).
Resque has been a better fit for work that takes longer to run and
generally can be volatile (eg. a backend script to clean up database
tables). We did a simple no-op test of Resque vs. a custom AMQP backed
worker. Resque's forking model results in a higher floor for how fast
a single job can be processed: ~10ms for Resque, vs. 0-1ms for AMQP.
This makes sense because processing a Resque job involves forking a
new process and re-establishing connections to any external resources.

For workers, we primarily run pools of workers that boot the Rails
environment and subscribe to queues to receive work. To manage those
pools, we use god/monit to start and stop them.

Overall, RabbitMQ has worked extremely well for these high performance
queues. We have a single box running the RabbitMQ server and have seen
it processing messages durable, persistent messages at up to 2,000/
sec. We've also had RabbitMQ have as many as 8.1M messages sitting in
queues waiting to be processed.

For request/response work loads, we've tried a few options. We played
with RabbitMQ as the communication mechanism, but found there were was
a performance penalty (likely our code) over a more typical web
service based connection. We now mostly use HTTP web service calls
between systems going through a load balancer. That works well enough,
but we find ourselves spending a fair amount of time dealing with
figuring out the best way to marshal data to and from JSON. We also
need to reconfigure the load balancer to add new capacity.

At some point, we'd like to get back to using a queueing system for
the communication mechanism. This presents two potential benefits for
us: being able to use msgpack to serialize data between systems, and
being able to boot new workers and have them start pulling work
without any config changes.

--
Doug Barth
Engineer
Signal <http://www.signalhq.com>

From michael.s.klishin at gmail.com  Mon Jan 16 17:07:18 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 16 Jan 2012 21:07:18 +0400
Subject: [rabbitmq-discuss] Ruby and AMQP
In-Reply-To: <4F1444A5.2050709@gmail.com>
References: <4F1444A5.2050709@gmail.com>
Message-ID: <AF9B90C6-A3E9-465C-A007-9FFA87693FBE@gmail.com>

Mark:

> For example Resque is a great queuing system.
> We simply throw a job into the queue and have it completed by one of our workers which is dead simple to spawn... ie, just tell Resque how many workers you want for job X. In RabbitMQ or the Ruby-AMQP gem I don't see how this is easily accomplished. How would I spawn multiple workers without each of them loading up the full Rails environment? Is there anything to manage all of these workers?
> 

I think you are seeing AMQP from slightly incorrect perspective. Resque has very specific usage scenarios and is limited to just Ruby (yes, you can reimplement parts of it in anything but out of the box it assumes Ruby). Resque also assumes your consumers never run for a long time, which has upsides and downsides. For systems that are
inherently event-driven, it only goes so far. If you need validation of that, take a look at how many Resque extensions people had to build. Many of those features are available out of the box in "real" messaging solutions.

AMQP was created to connect diverse applications that don't necessarily work the way Resque does (cron-driven processes that go up and die all the time) and not necessary are built with Ruby or run on CRuby and use fork(2).

So, AMQP is not a prepackaged highly-specialized solution like Resque. You can build one on top of AMQP and some people do. Whether they are significantly better than similar solutions on top of key-value stores, I don't know.

AMQP also has features that are commonly needed in when you make multiple applications work together. Message acknowledgements & redelivery is one example. Server-named queues for replies is another. Exclusive consumers is one more. A dozen of very common predefined message properties is also a feature in my opinion.



Now let me tell you a story of one project that is fairly popular in the Ruby community: travis-ci.org. It started with Resque and we migrated to use RabbitMQ and have 4 applications instead of 1. All this has been live since November 25th, 2011 and maybe it is time to take a look at how well that worked.

When I first joined travis-ci.org development team (April last year), it was using Resque for build distribution and HTTP for build log reporting. Things worked relatively well (I can't say anybody was really unhappy with Resque or Redis) but we quickly found ourselves in need of features like

* Operation acknowledgements
* Redelivery of failed operations to another machine
* Efficient streaming of build logs (HTTP is not the most efficient protocol for streaming)
* Better delivery guarantees for messages like build termination
* Sophisticated routing that includes rules like target OS and CPU architecture
* HA features

in addition, we have spent many weeks debugging issues with a key C extension and/or CRuby, so at some point several people independently came up with an idea of just using JRuby, JVM and official Java clients for tools we rely on. This also meant we had to split the system into several parts but it was obvious that it is exactly the right thing to do.

If your background processing application needs to load the entire Rails environment, you should consider extracting a library from it. This is exactly what travis-ci.org went through over the last several months and we are very happy with it. That said, even though these days things like IRC notifications are handled by AMQP-based app, they were moved not because Redis did not work for those cases but simply because we wanted to keep related parts of the system together in one app.

More information here: http://about.travis-ci.org/docs/dev/overview/.

Did this work well? In my personal opinion and judging from our maintenance burden and stability improvements (even with *quickly* growing number of projects), it did.
There are upsides for having processes that start and stop all the time, like it they pretty much don't have
to care about network outages. But overall, even in areas where we still don't tolerate network failures as good as we would like to, we do not lose important data thanks to
AMQP features (message acknowledgements, message redelivery, persistent messages).
We do not lose builds unless we decide to purge queues, for example. Many long standing issues with HTTP streaming that resulted in "builds running forever" and other
similar bugs are now in the past. 
Fairly performance-sensitive and complicate log stream processing is now handled by a JVM-based app that has throughput capacity that will last us for months even though we are growing at 25-35 projects per day and adding support for new languages and adding more worker machines. Finally, we can use any major programming language for future versions and/or applications if we choose so.

> Secondly, I know RabbitMQ is way more than just a simple queuing system but when it comes to RPC what are the benefits over a simple restful or JSON approach?
> 

RPC is used to describe many different things these days. Resque is not an RPC system if you ask me. Could you clarify what you mean by RPC? If you need is just delay email delivery or run other operations that don't have to be executed in "near real time", are never processed by more than one type
of consumer and don't generate events in turn) Resque is just what you need. There is no upside to using AMQP for these things other than interoperability.

> I was hoping someone can shed some light on these questions. It would also be very helpful if some ruby users out there could explain how you are using AMQP and why you chose it over alternative options?

Why I am my company uses RabbitMQ: because things I build are long running processes that are often not built with Ruby. Because I find it impractical to reinvent AMQP features on top of key-value stores. Because AMQP gives me flexibility and opinionated/specialized solutions like Resque do not.


Why travis-ci.org moved to RabbitMQ from Resque: because we find it impractical to reinvent AMQP features on top of key-value stores. Because AMQP works for streaming much better than hybrid Resque/HTTP solutions. Because we can use JRuby, Java, Clojure or anything else we may need or choose to use. Because to build what we want to build we need more advanced features and while RabbitMQ does not provide all of them today, it is the closest open source solution we can find.

If you want to learn more about AMQP in general and amqp gem in particular, take a look at http://rubyamqp.info. We have spent a lot of time trying to explain
why features exist as much as what API parts you use to access them.

Finally, a disclaimer: keep in mind that I maintain 2 Ruby AMQP clients and have been using RabbitMQ for over 3 years now. I almost definitely am biased. But if you don't
want to listen to my arguments, check out this blog post about ZeroMQ (which is different from RabbitMQ in many ways, but strives to solve the same problem) from
one of the Resque creators: http://techno-weenie.net/2011/6/17/zeromq-pub-sub/


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From hcoyote at ghostar.org  Mon Jan 16 17:26:43 2012
From: hcoyote at ghostar.org (Travis)
Date: Mon, 16 Jan 2012 11:26:43 -0600
Subject: [rabbitmq-discuss] rabbitmq-server 2.7.1 src rpm for
 Fedora/Redhat fails to build.
In-Reply-To: <9fb681e0-6f1e-44db-90f7-dd1501f80148@CoachZ.local>
References: <CAChq9g1Br_TZsKYo5JN9D=QNxZrb2x=PN1JDGR+=GDhQ6OXDkQ@mail.gmail.com>
	<9fb681e0-6f1e-44db-90f7-dd1501f80148@CoachZ.local>
Message-ID: <CAChq9g2BhFzhZGydVaPWQ92F-bTVe018uqhQd1=B7WgfbUwpeQ@mail.gmail.com>

On Fri, Jan 13, 2012 at 5:30 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> Hi, Travis:
>
> I may be misremembering the situation for CentOS, but is it
> possible for you to set up the fedorapeople repository and use
> it to get a newer Erlang? ?That's what I generally do on RHEL
> systems which otherwise suffer from variants of this (quite
> admittedly gross) situation....

I'm already running with the epel-erlang repo on my build server.

Thanks, though!

Travis
-- 
Travis Campbell
travis at ghostar.org

From hcoyote at ghostar.org  Mon Jan 16 17:27:41 2012
From: hcoyote at ghostar.org (Travis)
Date: Mon, 16 Jan 2012 11:27:41 -0600
Subject: [rabbitmq-discuss] rabbitmq-server 2.7.1 src rpm for
 Fedora/Redhat fails to build.
In-Reply-To: <4F140970.4030701@rabbitmq.com>
References: <CAChq9g1Br_TZsKYo5JN9D=QNxZrb2x=PN1JDGR+=GDhQ6OXDkQ@mail.gmail.com>
	<4F140970.4030701@rabbitmq.com>
Message-ID: <CAChq9g1VAboGixycBVpve+MSgaChE=LCYK-uiLWVV1=FDEGqQQ@mail.gmail.com>

On Mon, Jan 16, 2012 at 5:26 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 13/01/12 17:57, Travis wrote:
>>
>> The rpmbuild is failing with what appears to be a git error associated
>> with mochiweb and a few other plugins. ?At first, I thought it was
>> choking on not finding git, but we certainly have it installed.
>
>
> I think that's a red herring - the real error is a bit further on,
> complaining about not having the Erlang ASN.1 compiler:
>
>
>> Compiler function asn1ct:compile_asn/3 failed:
>> {undef,[{asn1ct,compile_asn,
>
> I'm not sure how this works on Red Hat, but you need to make sure you have
> this.
>

Ahha!

I installed erlang-asn1 from the epel-erlang repo and this seems to
correct it.  I'll test it out and see what happens with the RPMs once
I've installed them.

Travis
-- 
Travis Campbell
travis at ghostar.org

From 0x6e6562 at gmail.com  Mon Jan 16 17:34:07 2012
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 16 Jan 2012 17:34:07 +0000
Subject: [rabbitmq-discuss] Recovering Rabbit without restarting
Message-ID: <CAB-G1jhf7cPf0GiQQzVQ2HUCJS9=4oaCTmvvati3OrxVi6w=fw@mail.gmail.com>

Hi,

I'm currently looking into a production scenario with
2.7.0/RHEL5/R13B3 where Rabbit has ground to halt by consuming as good
as all of the CPU, but is still responding to external requests,
albeit very slowly. Peers appear to still be connected to the broker.
Running rabbitmqctl works, but any kind of report (status,
list_queues, report etc) is taking too long to return to get any
diagnostics whatsoever.

So I was wondering if there is any way to somehow throttle heavyweight
activities so that we can run some of the normal diagnostics, short of
restarting the whole instance.

Cheers,

Ben

From static.void.dev at gmail.com  Mon Jan 16 18:31:19 2012
From: static.void.dev at gmail.com (Mark)
Date: Mon, 16 Jan 2012 10:31:19 -0800
Subject: [rabbitmq-discuss] Ruby and AMQP
In-Reply-To: <08641542-d132-425b-bf1d-a8b057f984ac@m11g2000yqe.googlegroups.com>
References: <4F1444A5.2050709@gmail.com>
	<08641542-d132-425b-bf1d-a8b057f984ac@m11g2000yqe.googlegroups.com>
Message-ID: <4F146CF7.6010202@gmail.com>

Can you elaborate on how you set up a pool of workers. Does each worker 
boot up the complete rails environment?

On 1/16/12 8:44 AM, Doug Barth wrote:
> Our application makes use of both RabbitMQ backed workers and Resque
> workers. We've found RabbitMQ to be a good fit for quick to process,
> high volume units of work (eg. sending a text message to a phone).
> Resque has been a better fit for work that takes longer to run and
> generally can be volatile (eg. a backend script to clean up database
> tables). We did a simple no-op test of Resque vs. a custom AMQP backed
> worker. Resque's forking model results in a higher floor for how fast
> a single job can be processed: ~10ms for Resque, vs. 0-1ms for AMQP.
> This makes sense because processing a Resque job involves forking a
> new process and re-establishing connections to any external resources.
>
> For workers, we primarily run pools of workers that boot the Rails
> environment and subscribe to queues to receive work. To manage those
> pools, we use god/monit to start and stop them.
>
> Overall, RabbitMQ has worked extremely well for these high performance
> queues. We have a single box running the RabbitMQ server and have seen
> it processing messages durable, persistent messages at up to 2,000/
> sec. We've also had RabbitMQ have as many as 8.1M messages sitting in
> queues waiting to be processed.
>
> For request/response work loads, we've tried a few options. We played
> with RabbitMQ as the communication mechanism, but found there were was
> a performance penalty (likely our code) over a more typical web
> service based connection. We now mostly use HTTP web service calls
> between systems going through a load balancer. That works well enough,
> but we find ourselves spending a fair amount of time dealing with
> figuring out the best way to marshal data to and from JSON. We also
> need to reconfigure the load balancer to add new capacity.
>
> At some point, we'd like to get back to using a queueing system for
> the communication mechanism. This presents two potential benefits for
> us: being able to use msgpack to serialize data between systems, and
> being able to boot new workers and have them start pulling work
> without any config changes.
>
> --
> Doug Barth
> Engineer
> Signal<http://www.signalhq.com>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Mon Jan 16 22:12:21 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 16 Jan 2012 23:12:21 +0100
Subject: [rabbitmq-discuss] Clarification on semantics of publisher confirms
Message-ID: <CAOn7oW-tw+LMcQkmrCL4q0CF+MpFSjVn92w30BvnojwB3E51sw@mail.gmail.com>

Hi, while using the Federation plugin with publisher confirms during some
load tests I noticed a behavior I wasn't expecting after the link between
two brokers with a federated exchange went down:

   - The link stayed down for several hours, and around 100k messages
   accumulated on the upstream broker
   - The upstream kept publishing messages at a rate of 10/s during the
   network failure
   - The downstream had 5 channels with consumers consuming each from a
   queue
   - Every queue/exchange is durable messages are persistent and autoack is
   off on the clients
   - Using the default unbounded prefetch thresholds both for the
   federation and the client channels

Once the connection has restored I noticed several things:

   - the upstream started delivering messages to the downstream, apparently
   overflowing it since its CPU stayed at 100% for several minutes
   - none of the clients connected to the downstream received anything for
   quite some time, not sure when they exactly started receiving messages
   - the UI interface kept showing lots of undelivered and unconfirmed
   messages on the federation outbound queue

After some time, around two hours, the upstream broker completed delivering
all the messages to the downstream and the downstream confirmed all of
them. The clients are currently still catching up with the backlog.
Now any insight in what RabbitMQ was actually doing during this time is
appreciated, but I am specifically interested in how publisher confirms
behave in general. From the docs:

Persistent messages are confirmed when all queues have either delivered the
message and received an acknowledgement (if required), or persisted the
message

What is not clear to me is whether there is a chance for one or more slow
consumers, as in this case, to slow down the entire federation due to the
downstream broker waiting for their acknowledge for delivered messages,
which they are not able to give soon as they are still trying to catch up
with the backlog. So if the federation uses publisher confirms and the
downstream is not acking messages to the upstream because the clients have
not all acknowledge them, then also the upstream will be slowed down and
its outbound queue not emptied as long as consumers on the downstream ack
their messages. If this is the case I would think it is a bit weird for
slow consumers on a broker to also affect what happens on another broker.

When and how does the broker decide whether to confirm messages because
they were "delivered and acked" or "persisted"? I would rather prefer it
did it when persisting them, rather than when delivering them to clients
which cannot acknowledge them in time.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120116/8cf2f587/attachment.htm>

From marcus_rubeus at hotmail.com  Mon Jan 16 23:19:59 2012
From: marcus_rubeus at hotmail.com (MarcusR)
Date: Mon, 16 Jan 2012 15:19:59 -0800 (PST)
Subject: [rabbitmq-discuss] X-expires not working in 0-8-0 clients
Message-ID: <776164fc-e66b-479d-8cd2-db8009926122@g27g2000yqa.googlegroups.com>

It seems that the x-expires argument for declaring queues is not
accepted from 0-8 clients. The error message I receive is this:

PRECONDITION_FAILED - invalid arg 'x-expires' for queue

I assume this is because 0-8 only has the type "I" to write integers
in the argument field table. Perhaps it uses a different numeric type
that is not available to 0-8 clients. Is there a way around this
limitation? Has anyone gotten this to work? To me this seems like a
bug.

Here is a hex dump of the queue declare that I send:

0000  01 00 01 00 00 00 4a 00  32 00 0a 00 00 2f 61 6c   ......J.
2..../al
0010  6c 2d 31 2d 39 39 64 66  35 39 65 33 66 35 34 37   l-1-99df
59e3f547
0020  34 64 61 37 66 33 65 39  30 63 30 30 66 31 30 31   4da7f3e9
0c00f101
0030  39 38 64 65 2d 33 32 31  36 39 37 34 38 10 00 00   98de-321
69748...
0040  00 0f 09 78 2d 65 78 70  69 72 65 73 49 e8 03 00   ...x-exp
iresI?..
0050  00 ce

From brian.newsgroup at gmail.com  Tue Jan 17 06:50:05 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Tue, 17 Jan 2012 17:50:05 +1100
Subject: [rabbitmq-discuss] About RabbitMQ federation plugin
Message-ID: <CALD4NQbiL9n6rGyY0frdsB9jmF4CYFZTiZZTeZvHNBArsuZ_gw@mail.gmail.com>

Hi guys,

I've played with the federation plugin a little. It seems that in order to
send a message to a queue on the downstream server, the same queue has to
be declared on the upstream server for federation to work?

For example:
__________________
|                              |
| Downstream server |   Exchange-D <------  q1
|_________________|
             ^
             |
             |
__________________
|                              |
| Upstream server     |  Exchange-U <------  q1
|_________________|

_______
|            |
| Client   |
|_______|

If I want to send messages from client through Upstream server to
Downstream server, The messages can only get through when I declare a "q1"
on Upstream server, bind that queue to Exchange-U with a routing key, then
send the message to Exchange-U using that routing key. Not sure if this is
how it's supposed to work.

Is it possible not to declare q1 on Upstream server and make federation
work? My problem is that I have multiple customers listening to their own
queues on Downstream server, and customers can be removed or added at any
time. Say if X just connected to Downstream server, and I want to send
messages to it. How would I be able to send messages to X given that I
don't have a queue on Upstream server that corresponds to it? Though I
already know X is in the customer list, when my clients start and
initialise, I don't think it's a good idea to just create queues for all
customers on the list, which I think would consume system resources
unnecessarily.

Hopefully it all makes sense to you guys. Let me know if it's unclear.

The following is my federation config.
{rabbitmq_federation,
   [ {exchanges, [[{exchange,     "Exchange-D"},
                   {virtual_host, "/"},
                   {type,         "topic"},
                   {durable,      true},
                   {auto_delete,  false},
                   {internal,     false},
                   {upstream_set, "upsteam-servers"}]
                 ]},
     {upstream_sets, [{"upsteam-servers", [[{connection, "192.168.0.21"},
                                         {exchange,   "Exchange-U"},
                                         {max_hops,   2}
                                         ]}
                     ]},
     {connections, [{"Upstream-server",       [{host,          "upstream"},
                                         {protocol,        "amqps"},
                                         {port,            5671},
                                         {ssl_options,
                                          [{cacertfile,
"/etc/rabbitmq/certs/testca/cacert.pem"},
                                           {certfile,
"/etc/rabbitmq/certs/client/cert.pem"},
                                           {keyfile,
"/etc/rabbitmq/certs/client/key.pem"},
                                           {verify,     verify_peer},
                                           {fail_if_no_peer_cert, false}
                                          ]}
                                        ]}
                                     ]},
     {local_username, "guest"},
   ]
  }

Thanks,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/def809e6/attachment.htm>

From simone.busoli at gmail.com  Tue Jan 17 07:24:39 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 17 Jan 2012 08:24:39 +0100
Subject: [rabbitmq-discuss] About RabbitMQ federation plugin
In-Reply-To: <CALD4NQbiL9n6rGyY0frdsB9jmF4CYFZTiZZTeZvHNBArsuZ_gw@mail.gmail.com>
References: <CALD4NQbiL9n6rGyY0frdsB9jmF4CYFZTiZZTeZvHNBArsuZ_gw@mail.gmail.com>
Message-ID: <CAOn7oW8ENFjansMm2J=3NLa78yeXUHu6cXMvvbrmQH9m2Ok76w@mail.gmail.com>

Hi Brian, no you definitely don't need to create any queues manually for
the federation to work. Once you federate an exchange the exchange is
created by the plugin on the downstream server (it has to exist on the
upstream instead) and when you bind a queue to the federated exchange on
the downstream server the bindings are sent to the upstream, which will
deliver just the interesting messages published to the exchange on the
upstream server to the downstream server. In other words it should work
quite intuitively.
On Jan 17, 2012 7:51 AM, "Brian Jing" <brian.newsgroup at gmail.com> wrote:

> Hi guys,
>
> I've played with the federation plugin a little. It seems that in order to
> send a message to a queue on the downstream server, the same queue has to
> be declared on the upstream server for federation to work?
>
> For example:
> __________________
> |                              |
> | Downstream server |   Exchange-D <------  q1
> |_________________|
>              ^
>              |
>              |
> __________________
> |                              |
> | Upstream server     |  Exchange-U <------  q1
> |_________________|
>
> _______
> |            |
> | Client   |
> |_______|
>
> If I want to send messages from client through Upstream server to
> Downstream server, The messages can only get through when I declare a "q1"
> on Upstream server, bind that queue to Exchange-U with a routing key, then
> send the message to Exchange-U using that routing key. Not sure if this is
> how it's supposed to work.
>
> Is it possible not to declare q1 on Upstream server and make federation
> work? My problem is that I have multiple customers listening to their own
> queues on Downstream server, and customers can be removed or added at any
> time. Say if X just connected to Downstream server, and I want to send
> messages to it. How would I be able to send messages to X given that I
> don't have a queue on Upstream server that corresponds to it? Though I
> already know X is in the customer list, when my clients start and
> initialise, I don't think it's a good idea to just create queues for all
> customers on the list, which I think would consume system resources
> unnecessarily.
>
> Hopefully it all makes sense to you guys. Let me know if it's unclear.
>
> The following is my federation config.
> {rabbitmq_federation,
>    [ {exchanges, [[{exchange,     "Exchange-D"},
>                    {virtual_host, "/"},
>                    {type,         "topic"},
>                    {durable,      true},
>                    {auto_delete,  false},
>                    {internal,     false},
>                    {upstream_set, "upsteam-servers"}]
>                  ]},
>      {upstream_sets, [{"upsteam-servers", [[{connection, "192.168.0.21"},
>                                          {exchange,   "Exchange-U"},
>                                          {max_hops,   2}
>                                          ]}
>                      ]},
>      {connections, [{"Upstream-server",       [{host,          "upstream"},
>                                          {protocol,        "amqps"},
>                                          {port,            5671},
>                                          {ssl_options,
>                                           [{cacertfile,
> "/etc/rabbitmq/certs/testca/cacert.pem"},
>                                            {certfile,
> "/etc/rabbitmq/certs/client/cert.pem"},
>                                            {keyfile,
> "/etc/rabbitmq/certs/client/key.pem"},
>                                            {verify,     verify_peer},
>                                            {fail_if_no_peer_cert, false}
>                                           ]}
>                                         ]}
>                                      ]},
>      {local_username, "guest"},
>    ]
>   }
>
> Thanks,
>
> Brian
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/45aeb133/attachment.htm>

From sophiewenxizhang at googlemail.com  Tue Jan 17 09:08:06 2012
From: sophiewenxizhang at googlemail.com (TZHA)
Date: Tue, 17 Jan 2012 01:08:06 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in
	production environment.
In-Reply-To: <7f328139-e23a-4946-8932-fc728aad3021@a17g2000yqj.googlegroups.com>
References: <7f328139-e23a-4946-8932-fc728aad3021@a17g2000yqj.googlegroups.com>
Message-ID: <a672997f-f5b7-41c7-b760-11c9dbf5f726@i25g2000vbt.googlegroups.com>

Basically, if we can get the notifications/confirmations at the socket
connection, it is relatively easier to extend the c client with the
corresponding processing capabilities (we are planning to do this).
The difficulty is however in enabling the server to send the required
events.

Unfortunately, without the ability to get cancellation notification
and publisher confirmation, the c client connection for Rabbitmq can
be a showstopper in a highly heterogeneous environment for Rabbitmq.

From andrea.rosa at hp.com  Tue Jan 17 09:08:44 2012
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Tue, 17 Jan 2012 09:08:44 +0000
Subject: [rabbitmq-discuss] server crash 2.6.1
In-Reply-To: <4F144156.6060700@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD3690D8AD@G4W3209.americas.hpqcorp.net>
	<4F144156.6060700@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3690DA84@G4W3209.americas.hpqcorp.net>

Hi Simon

Thanks for your reply, I attached here a snippet of log files with more details.
Thanks
--
Andrea Rosa

>-----Original Message-----
>From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
>discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
>Sent: 16 January 2012 15:25
>To: rabbitmq-discuss at lists.rabbitmq.com
>Subject: Re: [rabbitmq-discuss] server crash 2.6.1
>
>On 16/01/12 14:49, Rosa, Andrea wrote:
>> the rabbitmq server crashed and in the log file I found the following
>error:
>>
>> =ERROR REPORT==== 16-Jan-2012::12:56:26 ===
>> ** Generic server msg_store_transient terminating
>> ** Last message in was {'$gen_cast',
>>                             {client_dying,
>>
><<30,178,227,234,255,154,35,131,109,133,30,
>>                                   176,149,67,212,244>>}}
>>
>
>That's not the complete error - there should be
>
>** When Server state ==
>
>and
>
>** Reason for termination ==
>
>sections too - can you post those?
>
>Cheers, Simon
>
>--
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: RabbimqLogSnippet.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/8e2c5005/attachment.txt>

From emile at rabbitmq.com  Tue Jan 17 10:20:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Jan 2012 10:20:23 +0000
Subject: [rabbitmq-discuss] X-expires not working in 0-8-0 clients
In-Reply-To: <776164fc-e66b-479d-8cd2-db8009926122@g27g2000yqa.googlegroups.com>
References: <776164fc-e66b-479d-8cd2-db8009926122@g27g2000yqa.googlegroups.com>
Message-ID: <4F154B67.4090303@rabbitmq.com>

Hi Marcus,

On 16/01/12 23:19, MarcusR wrote:
> It seems that the x-expires argument for declaring queues is not
> accepted from 0-8 clients. The error message I receive is this:
> 
> PRECONDITION_FAILED - invalid arg 'x-expires' for queue

I don't think the version of the client matters. What version of the
broker are you using? V2.0.0 and v2.1.0 only accepted expiry values of
type "long int", while you are using "int". If that is the problem then
you should either supply a "long" value or use at least v2.1.1 of the
broker (preferably the latest version).


-Emile

From simon at rabbitmq.com  Tue Jan 17 10:47:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jan 2012 10:47:14 +0000
Subject: [rabbitmq-discuss] server crash 2.6.1
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3690DA84@G4W3209.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3690D8AD@G4W3209.americas.hpqcorp.net>
	<4F144156.6060700@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3690DA84@G4W3209.americas.hpqcorp.net>
Message-ID: <4F1551B2.5040606@rabbitmq.com>

On 17/01/12 09:08, Rosa, Andrea wrote:
> Thanks for your reply, I attached here a snippet of log files with more details.

 From the logs:

** Reason for termination ==
** {{badmatch,false},
     [{rabbit_msg_store_ets_index,insert,2},
      {rabbit_msg_store,write_message,3},
      {rabbit_msg_store,handle_cast,2},
      {gen_server2,handle_msg,2},
      {proc_lib,wake_up,3}]}

We believe we fixed this in 2.7.1 (although it was one of those that we 
got by staring at the code; we were never able to replicate it).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From rob.versluis at gmail.com  Tue Jan 17 10:42:53 2012
From: rob.versluis at gmail.com (rob)
Date: Tue, 17 Jan 2012 02:42:53 -0800 (PST)
Subject: [rabbitmq-discuss] Embedded device and RabbitMQ
Message-ID: <d611d59d-7721-427c-9242-44f2559c5ace@d10g2000vbh.googlegroups.com>

Hi,

I'm working on a new project. I have the following question:
An embedded device transmitting measurement data to a RabbitMQ server.
After sending, I would like to receive (sometimes) settings for the
embedded device. Is this the right setup?

http://www.rabbitmq.com/tutorials/tutorial-six-java.html

Regards,

Rob

From simon at rabbitmq.com  Tue Jan 17 11:00:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jan 2012 11:00:29 +0000
Subject: [rabbitmq-discuss] About RabbitMQ federation plugin
In-Reply-To: <CALD4NQbiL9n6rGyY0frdsB9jmF4CYFZTiZZTeZvHNBArsuZ_gw@mail.gmail.com>
References: <CALD4NQbiL9n6rGyY0frdsB9jmF4CYFZTiZZTeZvHNBArsuZ_gw@mail.gmail.com>
Message-ID: <4F1554CD.9080300@rabbitmq.com>

On 17/01/12 06:50, Brian Jing wrote:
> I've played with the federation plugin a little. It seems that in order
> to send a message to a queue on the downstream server, the same queue
> has to be declared on the upstream server for federation to work?

No, that should definitely not be the case.

The federation plugin is meant to send bindings upstream automatically 
(so that it does not just send all messages upstream -> downstream, but 
only the ones that will be routed once they get downstream).

When you bind a queue to the downstream exchange with routing key A, you 
should see a similar binding appear between the upstream exchange and 
the intermediate upstream exchange (called something like "federation: 
name -> name {A|B}". Is that happening?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 17 11:31:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jan 2012 11:31:12 +0000
Subject: [rabbitmq-discuss] Clarification on semantics of publisher
	confirms
In-Reply-To: <CAOn7oW-tw+LMcQkmrCL4q0CF+MpFSjVn92w30BvnojwB3E51sw@mail.gmail.com>
References: <CAOn7oW-tw+LMcQkmrCL4q0CF+MpFSjVn92w30BvnojwB3E51sw@mail.gmail.com>
Message-ID: <4F155C00.8070202@rabbitmq.com>

On 16/01/12 22:12, Simone Busoli wrote:
> Hi, while using the Federation plugin with publisher confirms during
> some load tests I noticed a behavior I wasn't expecting after the link
> between two brokers with a federated exchange went down:

Hi Simone.

>     * The link stayed down for several hours, and around 100k messages
>       accumulated on the upstream broker

I hope you mean "The network was down for several hours" not "RabbitMQ 
took several hours to re-establish the link".

>     * The upstream kept publishing messages at a rate of 10/s during the
>       network failure
>     * The downstream had 5 channels with consumers consuming each from a
>       queue
>     * Every queue/exchange is durable messages are persistent and
>       autoack is off on the clients
>     * Using the default unbounded prefetch thresholds both for the
>       federation and the client channels
>
> Once the connection has restored I noticed several things:
>
>     * the upstream started delivering messages to the downstream,
>       apparently overflowing it since its CPU stayed at 100% for several
>       minutes
>     * none of the clients connected to the downstream received anything
>       for quite some time, not sure when they exactly started receiving
>       messages
>     * the UI interface kept showing lots of undelivered and unconfirmed
>       messages on the federation outbound queue

It is currently possible to overload a RabbitMQ server by sending it a 
huge number of small messages very fast. The symptoms are as you 
describe (since the messages get backed up before they get to a queue in 
the downstream broker). Eventually if you keep sending messages the 
memory alarm will go off and then the broker will have time to sort 
itself out, but this can lead to quite a delay.

We're looking to improve this situation in the next release.

> After some time, around two hours, the upstream broker completed
> delivering all the messages to the downstream and the downstream
> confirmed all of them. The clients are currently still catching up with
> the backlog.

However, I'm surprised that it took two hours to churn through just 100k 
messages. That should be a few seconds worth on average hardware. Was 
the downstream broker particularly small?

> Now any insight in what RabbitMQ was actually doing during this time is
> appreciated, but I am specifically interested in how publisher confirms
> behave in general. From the docs:
>
> Persistent messages are confirmed when all queues have either delivered
> the message and received an acknowledgement (if required), or persisted
> the message
>
> What is not clear to me is whether there is a chance for one or more
> slow consumers, as in this case, to slow down the entire federation due
> to the downstream broker waiting for their acknowledge for delivered
> messages, which they are not able to give soon as they are still trying
> to catch up with the backlog. So if the federation uses publisher
> confirms and the downstream is not acking messages to the upstream
> because the clients have not all acknowledge them, then also the
> upstream will be slowed down and its outbound queue not emptied as long
> as consumers on the downstream ack their messages. If this is the case I
> would think it is a bit weird for slow consumers on a broker to also
> affect what happens on another broker.
>
> When and how does the broker decide whether to confirm messages because
> they were "delivered and acked" or "persisted"? I would rather prefer it
> did it when persisting them, rather than when delivering them to clients
> which cannot acknowledge them in time.

The broker will deliver the message and also schedule it to be 
persisted. It will then send back a confirm when *either* it has 
received an ack from the client *or* an fsync from the disk. So slow 
consumers should not be able to slow down a federation.

So I think the problem you were seeing was due to messages building up 
before they got to the queues on the downstream broker. But I'm 
surprised only 100k messages could do this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 17 11:40:42 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jan 2012 11:40:42 +0000
Subject: [rabbitmq-discuss] Recovering Rabbit without restarting
In-Reply-To: <CAB-G1jhf7cPf0GiQQzVQ2HUCJS9=4oaCTmvvati3OrxVi6w=fw@mail.gmail.com>
References: <CAB-G1jhf7cPf0GiQQzVQ2HUCJS9=4oaCTmvvati3OrxVi6w=fw@mail.gmail.com>
Message-ID: <4F155E3A.6090604@rabbitmq.com>

On 16/01/12 17:34, Ben Hood wrote:
> I'm currently looking into a production scenario with
> 2.7.0/RHEL5/R13B3 where Rabbit has ground to halt by consuming as good
> as all of the CPU, but is still responding to external requests,
> albeit very slowly. Peers appear to still be connected to the broker.
> Running rabbitmqctl works, but any kind of report (status,
> list_queues, report etc) is taking too long to return to get any
> diagnostics whatsoever.
>
> So I was wondering if there is any way to somehow throttle heavyweight
> activities so that we can run some of the normal diagnostics, short of
> restarting the whole instance.

If the memory alarm has not already gone off by this point you may 
benefit from making it go off to halt publishers:

$ rabbitmqctl set_vm_memory_high_watermark 0.00001

(remember to set it back to 0.4 or whatever afterward!)

Also, the management plugin should in general be more responsive than 
rabbitmqctl in heavily-loaded situations. This is because rabbitmqctl 
will go and interrogate each {queue / connection / channel} in turn, 
while management caches updates that are broadcast by these objects.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue Jan 17 11:47:13 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 17 Jan 2012 11:47:13 +0000
Subject: [rabbitmq-discuss] The idiom for shutting down a consumer in a
	thread task
In-Reply-To: <CABMnSbHzRqM1-9x4BY=LtVHPnn8FYF3swgBsh1qj7UxNgeerAQ@mail.gmail.com>
References: <CABMnSbHzRqM1-9x4BY=LtVHPnn8FYF3swgBsh1qj7UxNgeerAQ@mail.gmail.com>
Message-ID: <88552116-1DC2-499B-8D09-AC9A7126B0D7@rabbitmq.com>

Hi Mark,

This is very odd code -- basicConsume() *starts* a Consumer (which will run on
other threads not this one) it doesn't actually 'consume' anything itself. Why
are you looping on this in a Runnable?

The way to stop a consumer is to issue basicCancel(consumerTag). The consumerTag
is returned from the basicConsume() call, so you ought to remember this
somewhere (or you can supply a tag of your own devising). The Consumer will
receive a handleCancelOk() call as the last thing that drives it. Should you
wish to wait for this (it doesn't run synchronously with the cancel call), you
can use some Java latchery (CountdownLatch(1) for example) or some other Java
synchronisation mechanism to allow the caller to wait for the Consumer to
finish.

If you have an application running on another Java thread, then there is no
built-in clean Java way of stopping that thread. It is necessary to write your
own application-specific way of interrupting another thread's progress. Careful
use of the InterruptedException in Java can do it well, but you have to know
exactly what thread to interrupt and get all the parts to cooperate properly for
this to work reliably.

More information about your application might help us assist you further.

Steve Powell  (a chappy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 16 Jan 2012, at 14:43, Mark Petrovic wrote:

Hello.

I'm looking for the idiom for how to gracefully shutdown a consumer
running in a Java thread.  Given a Runnable's run() method that looks
like this

   @Override
   public void run() {
       while (doConsume) {
           try {
               channel.basicConsume(queue, false, busReader);
           } catch (IOException e) {
               throw new RuntimeException("Error in reader", e);
           }
       }
   }

what is the recommended way to cancel this logical task?  Call
connection.close() and exit out the catch-block?

Thank you.

-- 
Mark
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Jan 17 12:47:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jan 2012 12:47:26 +0000
Subject: [rabbitmq-discuss] RabbitMQ load issues
In-Reply-To: <CAHtD+9P9-7_hgHf8vcwZn3BGQEviRHZvFjn1kwnVEGy4_v7wag@mail.gmail.com>
References: <CAHtD+9P9-7_hgHf8vcwZn3BGQEviRHZvFjn1kwnVEGy4_v7wag@mail.gmail.com>
Message-ID: <4F156DDE.8030408@rabbitmq.com>

On 06/01/12 21:16, Jeremy Pierre wrote:
> Hi All,

Hi!

<snip>

> When we got to about 110,000 queues on the topic exchange, RabbitMQ
> basically stopped responding(on the direct exchange as well).  After a
> little while(10-15min), rabbitmqctl could no longer even connect to
> the still-running RabbitMQ instance(on the same machine).  RabbitMQ(2
> processes listed in top/htop that I could see) was using ~5-ish gigs
> of RAM.

Hmm. While RabbitMQ is designed to scale :-) 100k queues and 700k 
bindings does start to sound like "a lot".

Having said that I was able to create that number of queues / bindings 
on my desktop machine in half an hour or so without *too* much trouble.

Some tips:

* If you're declaring queues in bulk, make sure you do so synchonously 
(i.e. nowait=false).

* If you're going to have that many queues and that few routing keys 
then presumably every message published will be delivered to huge 
numbers of queues. I assume you expect your publishing rate to be small. 
Publishing a couple of messages per second is a lot if they're delivered 
to 50k queues.

* Every queue process consumes a fixed small amount of memory. Spreading 
queues out over a cluster will help.

* Every queue and binding creates a row in an Mnesia table. Mnesia 
tables always reside in RAM, so for huge numbers of queues in a cluster 
expect to use lots of RAM. Therefore instead of clustering you will 
probably find it better to shard the queues out over independent brokers 
and connect them with federation. The case of huge numbers of queues and 
very few routing keys could almost be made for federation. For the 
massive fanout case you probably want to build a (maybe multi-layered) 
federation tree rather than the complete graph people use more often 
with federation.

* For every active queue (one that has sent or received a message in the 
last few seconds) there is a small CPU cost when using the management 
plugin. With huge numbers of queues per node it may be helpful to 
disable mgmt. On the other hand "rabbitmqctl list_queues" will contact 
all the queues synchronously (maybe waking them up). Monitoring will be 
an issue.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue Jan 17 13:27:00 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 17 Jan 2012 13:27:00 +0000
Subject: [rabbitmq-discuss] Embedded device and RabbitMQ
In-Reply-To: <d611d59d-7721-427c-9242-44f2559c5ace@d10g2000vbh.googlegroups.com>
References: <d611d59d-7721-427c-9242-44f2559c5ace@d10g2000vbh.googlegroups.com>
Message-ID: <8489165D-1A9E-4F3F-8BD9-3BF08D6F3FB6@rabbitmq.com>

Hi Rob,

The tutorial-six is to demonstrate RPCs (Remote Procedure Calls). This is appropriate for the case where there is always a response (reply) to a request.  If you require a response rarely (or not all the time) it would probably be more efficient to write your own pair of programs (client/server) which have a mechanism for deciding whether to respond or not.

Having said that, it is possible to distinguish between a call and a 'cast' in the RpcServer part, and not to send a response back for a cast, but we currently have no way of sending a cast from the client code.  You could extend that.

Finally, the current Rpc cide uses QueueingConsumer which, although it works quite well, is a bit slow, and it is possible to directly use Consumer code to process the server requests (and receive replies) without hjaving to have an intermediate queue (which is no longer necessary from 2.7.0 because of an improved Consumer threading model).

A better description of your problem space, could help us to assist you more. 

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.



On 17 Jan 2012, at 10:42, rob wrote:

> Hi,
> 
> I'm working on a new project. I have the following question:
> An embedded device transmitting measurement data to a RabbitMQ server.
> After sending, I would like to receive (sometimes) settings for the
> embedded device. Is this the right setup?
> 
> http://www.rabbitmq.com/tutorials/tutorial-six-java.html
> 
> Regards,
> 
> Rob
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/bc9c6de9/attachment.htm>

From mnkpdon.32 at gmail.com  Tue Jan 17 14:27:12 2012
From: mnkpdon.32 at gmail.com (mayank)
Date: Tue, 17 Jan 2012 06:27:12 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ process getting killed on log off
Message-ID: <e92aee88-e210-490f-ac9b-039143877f42@o13g2000vbf.googlegroups.com>

I have deployed RabbitMQ in cluster mode with 2 nodes(windows server)
and high availability queues in . The RabbitMQ is running as an
application and not as a service.

I have followed the exact steps mentioned in the RabbitMQ website.

As per the RabbitMQ documentation clustering can be done only when
RabbitMQ is running as an application.

The issue is that when the user logs off from the server machine(node)
the running rabbitmq-server process gets killed and the RabbitMQ node
goes down.

Is there solution for this in RabbitMQ, or do I have write my own
windows service to execute "rabbitmq-server start" so that it keeps
running even when the user logs off.

From simon at rabbitmq.com  Tue Jan 17 15:36:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jan 2012 15:36:15 +0000
Subject: [rabbitmq-discuss] RabbitMQ process getting killed on log off
In-Reply-To: <e92aee88-e210-490f-ac9b-039143877f42@o13g2000vbf.googlegroups.com>
References: <e92aee88-e210-490f-ac9b-039143877f42@o13g2000vbf.googlegroups.com>
Message-ID: <4F15956F.1040802@rabbitmq.com>

On 17/01/12 14:27, mayank wrote:
> As per the RabbitMQ documentation clustering can be done only when
> RabbitMQ is running as an application.

Um, really? Where do we say that?

On Windows, running as an application is only useful for developing / 
testing, for precisely the reason you're talking about. You should be 
running as a service on production.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mnkpdon.32 at gmail.com  Tue Jan 17 15:45:47 2012
From: mnkpdon.32 at gmail.com (mayank)
Date: Tue, 17 Jan 2012 07:45:47 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ process getting killed on log off
In-Reply-To: <4F15956F.1040802@rabbitmq.com>
References: <e92aee88-e210-490f-ac9b-039143877f42@o13g2000vbf.googlegroups.com>
	<4F15956F.1040802@rabbitmq.com>
Message-ID: <08c01b46-b474-47f7-8bc4-23083d04ef54@o14g2000vbo.googlegroups.com>

When I am installing it as an service, and then trying to do
clustering using rabbitmqctl, it is giving error that the node is
down. Is there any place where I can find the steps to do clustering
while running it as service.

Thanks
Mayankl

On Jan 17, 3:36?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 17/01/12 14:27, mayank wrote:
>
> > As per the RabbitMQ documentation clustering can be done only when
> > RabbitMQ is running as an application.
>
> Um, really? Where do we say that?
>
> On Windows, running as an application is only useful for developing /
> testing, for precisely the reason you're talking about. You should be
> running as a service on production.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alan.antonuk at gmail.com  Tue Jan 17 15:52:38 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 17 Jan 2012 10:52:38 -0500
Subject: [rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in
 production environment.
In-Reply-To: <7f328139-e23a-4946-8932-fc728aad3021@a17g2000yqj.googlegroups.com>
References: <7f328139-e23a-4946-8932-fc728aad3021@a17g2000yqj.googlegroups.com>
Message-ID: <CAAt2poJD20QZiebR+crY6OxxK4QZHRztjibwmCHwWjZFKYjeBw@mail.gmail.com>

Responses inlined

On Mon, Jan 16, 2012 at 5:02 AM, TZHA <sophiewenxizhang at googlemail.com>wrote:

> Hi,
>
> i am working with rabbitmq-c (downloaded from github/newest version -
> cmake/VS2010 rebuild under windows) and would like to prepare a
> rabbitmq/c/c++ based solution for a production environment.
>
> However for a real application, we still have some reliability
> requirements that are apparently not yet supported by rabbitmq-c.
>
> The first requirement is to get ?cancellation notification? in case,
> e.g. whenever a queue is down ? so that the client/consumer can
> reconnect to the broker.
>
> For this purpose ? as I understood, the client has to send  the
> ?client-capabilities? with
>
>   ...
>   consumer_cancel_notify = true,
>   publisher_confirms = true
>
> For the consumer_cancel_notify - the client does need to tell the broker
that it wants to turn this on.

For the publisher_confirms - the client is not required to tell the broker
to enable this.  To enabled it on a channel you should send send a
confirm.select to enable publisher_confirms for a channel. You can send the
client capabilities to query the broker to see if it supports this
extension before continuing connecting to a broker.

For some more info how rabbit supports these extensions:
http://www.rabbitmq.com/extensions.html

for the connection setup. In  case of of rabbitmq-c, I saw that one
> shall set the capabilities in amqp_login (amqp_socket.c)  method.
> Current this is set to NULL.
>
>  amqp_connection_open_t s
>  s.capabilities.len = 0;
>  s.capabilities.bytes = NULL;
>

The format of that field is I believe a shortstr.  However that's not where
you want to send capabilities.  When you get the connection.start method
from the broker, you need to examine the server-properties (which is a
table) parameter to see if the broker supports the extensions you want.
 When you respond with a connection.start-ok, you need to put the
extensions you want to enable in the client-properties parameter, which is
also a table.


>
> Can some expert tell me what kind of syntax can be used for the
> s.capabilities.bytes field?
>
> The next requirement is to receive publisher_confirms. I guess that
> the client-capabilities is also a pre-condition, and I have to set the
> ?mandatory? parameter for the amqp_basic_publish method to 1. Is there
> anything else I have to set?
>

In order to enable publisher confirms,

You need to do the confirm.select (amqp_confirm_select(...) ) method on the
channel you want to enable publisher confirms on.
After which anytime you do a basic.publish, (amqp_basic_publish(...)) you
will eventually get a basic.ack back from the broker once the message has
been processed*.
* Note: processed does not mean delivered, it just means that the broker
received it and did something with it (routed to a queue, returned it,
dropped it etc).  If you want ensure that the message got routed a queue -
send the mandatory flag.  If the message isn't routed to a queue the
message will returned to the client with a basic.return, then you will be a
basic.ack.

More information on publisher confirms:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.confirm
More information on the basic publish fields:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish
Finally an example client that leverages rabbitmq-c and uses publisher
confirms:
https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cpp#L282


> Thanks in advance for any advices.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/cfc969b1/attachment.htm>

From emile at rabbitmq.com  Tue Jan 17 16:04:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Jan 2012 16:04:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ process getting killed on log off
In-Reply-To: <08c01b46-b474-47f7-8bc4-23083d04ef54@o14g2000vbo.googlegroups.com>
References: <e92aee88-e210-490f-ac9b-039143877f42@o13g2000vbf.googlegroups.com>
	<4F15956F.1040802@rabbitmq.com>
	<08c01b46-b474-47f7-8bc4-23083d04ef54@o14g2000vbo.googlegroups.com>
Message-ID: <4F159BFE.2050100@rabbitmq.com>

Hi,

On 17/01/12 15:45, mayank wrote:
> When I am installing it as an service, and then trying to do
> clustering using rabbitmqctl, it is giving error that the node is
> down. Is there any place where I can find the steps to do clustering
> while running it as service.

Can you explain at which step of the clustering transcript
(http://www.rabbitmq.com/clustering.html#transcript) you receive an
error, and any entries logged at the nodes at that time?

Ensure that all nodes are able to run independently first. If they are
all on the same server then node names and ports must be unique. In
order to configure nodes you will need a correctly set .erlang.cookie
file. Also take care that hostnames are case-sensitive on Windows.



-Emile

From simon at rabbitmq.com  Tue Jan 17 16:17:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jan 2012 16:17:32 +0000
Subject: [rabbitmq-discuss] Seeming high CPU for broker
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E1D7B8AA740@GEORGE.Emea.Arm.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1D7B8AA740@GEORGE.Emea.Arm.com>
Message-ID: <4F159F1C.6050201@rabbitmq.com>

On 05/01/12 13:50, Chris Hampson wrote:
> Hi All,
>
> We've been running a few brokers for quite some time now. About a
> month ago one of them pretty much maxed out the CPU of the machine it
> was running on and has maintained this high level ever since.

Has it been restarted since?

> It's only ever using 20% (max) of the memory, not swapping, the load
> average of the machine is less than one and the service seems
> unaffected.
>
> Is this something I shouldn't be concerned with, it's not really
> having to cope with too much at the moment, a couple of active
> VHOSTS, small handful of exchanges, and in general less than 200/sec
> messages to even the busiest of those.

Well, this definitely seems wrong. One immediate possibility springs to 
mind: the mgmt plugin had some pretty poor efficiency in the face of 
large numbers of {queues/channels/connections} until 2.5.0 (both for 
responding to queries and background CPU usage). If you have lots of 
{queues/channels/connections} that's worth considering.

2.3.1 is in general a bit old, and a lot of optimisation has flowed 
under the bridge since then, so as always I'd suggest an upgrade ;-)

> I'm getting nagged by the ops guys due to it setting off
> notifications for the high CPU load, if it's expected or not
> something to worry about this I can just tell them to disable that
> notification (or at least ignore it).
>
> Are there any ways (beyond rabbitmqctl and the web interface) to see
> what's going on and if there's trouble ahead?

Nothing very lovely. Erlang ships with a utility called etop which can 
give you a top-like view of the processes in your Erlang VM. It's a bit 
fiddly and low level though.

It may not be installed by default and the script to launch it is in 
often not put in your path - for example with Debian you'd need to 
apt-get install erlang-observer and invoke it from:

/usr/lib/erlang/lib/observer-0.9.8.3/priv/bin/	

You can invoke it with:

$ /path/to/etop -node rabbit@$(hostname)

(If using our deb / rpm packaging you may need to become rabbitmq to do 
this, or copy the Erlang cookie from the rabbitmq user.)

This should show what process(es) are using all that CPU and we can go 
from there...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mnkpdon.32 at gmail.com  Tue Jan 17 16:32:05 2012
From: mnkpdon.32 at gmail.com (mayank)
Date: Tue, 17 Jan 2012 08:32:05 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ process getting killed on log off
In-Reply-To: <4F159BFE.2050100@rabbitmq.com>
References: <e92aee88-e210-490f-ac9b-039143877f42@o13g2000vbf.googlegroups.com>
	<4F15956F.1040802@rabbitmq.com>
	<08c01b46-b474-47f7-8bc4-23083d04ef54@o14g2000vbo.googlegroups.com>
	<4F159BFE.2050100@rabbitmq.com>
Message-ID: <31cbbeea-6601-4b6f-84a7-91957bbf3f11@w4g2000vbc.googlegroups.com>


Hi

I worked now, I had to copy the erlang cookie from c:\windows to c:
\users\<current logged-in user> to make rabbitmqctl work with service.
But I was wondering whether this is the best way. Can't I somehow make
rabbimqctl look at c:\Windows folder instead?

Thanks for the help.
Mayank

On Jan 17, 4:04?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 17/01/12 15:45, mayank wrote:
>
> > When I am installing it as an service, and then trying to do
> > clustering using rabbitmqctl, it is giving error that the node is
> > down. Is there any place where I can find the steps to do clustering
> > while running it as service.
>
> Can you explain at which step of the clustering transcript
> (http://www.rabbitmq.com/clustering.html#transcript) you receive an
> error, and any entries logged at the nodes at that time?
>
> Ensure that all nodes are able to run independently first. If they are
> all on the same server then node names and ports must be unique. In
> order to configure nodes you will need a correctly set .erlang.cookie
> file. Also take care that hostnames are case-sensitive on Windows.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Tue Jan 17 17:00:41 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Jan 2012 17:00:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ process getting killed on log off
In-Reply-To: <31cbbeea-6601-4b6f-84a7-91957bbf3f11@w4g2000vbc.googlegroups.com>
References: <e92aee88-e210-490f-ac9b-039143877f42@o13g2000vbf.googlegroups.com>
	<4F15956F.1040802@rabbitmq.com>
	<08c01b46-b474-47f7-8bc4-23083d04ef54@o14g2000vbo.googlegroups.com>
	<4F159BFE.2050100@rabbitmq.com>
	<31cbbeea-6601-4b6f-84a7-91957bbf3f11@w4g2000vbc.googlegroups.com>
Message-ID: <4F15A939.9030008@rabbitmq.com>

Hi,

On 17/01/12 16:32, mayank wrote:
> I worked now, I had to copy the erlang cookie from c:\windows to c:
> \users\<current logged-in user> to make rabbitmqctl work with service.
> But I was wondering whether this is the best way. Can't I somehow make
> rabbimqctl look at c:\Windows folder instead?

Erlang will look for a cookie in your home folder. For more exotic
options see
http://www.erlang.org/doc/reference_manual/distributed.html#id82585

I would advise against too much sophistication, because Erlang will
simply create a new cookie if it can't find one. You might then suddenly
find nodes unable to communicate as a result.


-Emile

From mnkpdon.32 at gmail.com  Tue Jan 17 17:22:03 2012
From: mnkpdon.32 at gmail.com (mayank)
Date: Tue, 17 Jan 2012 09:22:03 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ process getting killed on log off
In-Reply-To: <4F15A939.9030008@rabbitmq.com>
References: <e92aee88-e210-490f-ac9b-039143877f42@o13g2000vbf.googlegroups.com>
	<4F15956F.1040802@rabbitmq.com>
	<08c01b46-b474-47f7-8bc4-23083d04ef54@o14g2000vbo.googlegroups.com>
	<4F159BFE.2050100@rabbitmq.com>
	<31cbbeea-6601-4b6f-84a7-91957bbf3f11@w4g2000vbc.googlegroups.com>
	<4F15A939.9030008@rabbitmq.com>
Message-ID: <e9767775-3209-470e-95aa-fddb8d2e32f6@i25g2000vbt.googlegroups.com>

I will probably stick with what works now :)

Thanks for the help
Mayank

On Jan 17, 5:00?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 17/01/12 16:32, mayank wrote:
>
> > I worked now, I had to copy the erlang cookie from c:\windows to c:
> > \users\<current logged-in user> to make rabbitmqctl work with service.
> > But I was wondering whether this is the best way. Can't I somehow make
> > rabbimqctl look at c:\Windows folder instead?
>
> Erlang will look for a cookie in your home folder. For more exotic
> options seehttp://www.erlang.org/doc/reference_manual/distributed.html#id82585
>
> I would advise against too much sophistication, because Erlang will
> simply create a new cookie if it can't find one. You might then suddenly
> find nodes unable to communicate as a result.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From static.void.dev at gmail.com  Tue Jan 17 17:40:16 2012
From: static.void.dev at gmail.com (Mark)
Date: Tue, 17 Jan 2012 09:40:16 -0800
Subject: [rabbitmq-discuss] Ruby Gem with Unicorn server
Message-ID: <4F15B280.1070201@gmail.com>

Reading through 
http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/ConnectingToTheBroker.textile 
and I noticed when using the AMQP gem with Unicorn you must:

/"start the EventMachine reactor and AMQP connection after the master 
process forks workers"/

We've been using Unicorn for some time now so I'm aware of 
reestablishing connections after Unicorn forks, however I have some 
questions in regards to AMQP. Do I simply need to start up AMQP in a 
separate thread as in the example:

Thread.new  {  AMQP.start  }

Then in my controllers I would need to do everything inside a next_tick 
block?

EventMachine.next_tick  do
...
end


Is this all that is required? How come in the example we are connecting 
to a channel/queue in the after_fork hook? Is this for debugging purposes?

I also have one other question regarding EventMachine#next_tick. I've 
read that:

/"Everything scheduled using EM#next_tick will happen synchronously in 
the main thread.  Any long running tasks inside an EM#next_tick block 
will cause the entire program to block until complete. Typically a bad 
thing."

/Does this mean we don't gain anything by using EM in this fashion.. ie 
our attempt to use AMQP asynchronously is actually synchronous?

Thanks for the clarification!

- M




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/5e6f7e48/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jan 17 18:10:26 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 17 Jan 2012 22:10:26 +0400
Subject: [rabbitmq-discuss] Ruby Gem with Unicorn server
In-Reply-To: <4F15B280.1070201@gmail.com>
References: <4F15B280.1070201@gmail.com>
Message-ID: <8C7EA923-CBD7-49E2-A5C4-7E6B07281B92@gmail.com>

Mark:

> Is this all that is required?

Yes. In 0.9.0 (possibly in 0.8.4 as well) there is a helper that reads config/amqp.yml similarly to config/database.yml:

  require "amqp/utilities/event_loop_helper"
  require "amqp/integration/rails"

  # this helper detects what app server (if any) is being used and starts EventMachine reactor in a separate
  # thread or just uses .next_tick (for example, with Thin).
  AMQP::Utilities::EventLoopHelper.run

  # reads config/amqp.yml, takes environment-specific key out of it (e.g. :development) and
  # merges whatever you pass to .start with it.
  AMQP::Integration::Rails.start do |connection|
    puts "Connected to AMQP broker"
    # this is just an accessor for 1 channel. It has no special properties, just a placeholder for
    # applications that only need one channel
    AMQP.channel    = AMQP::Channel.new(connection)
  end

I would like to try to make it detect Unicorn forking, that's why it is not not yet in the documentation: it may slightly change
for 1.0. Your suggestions about what you want it to do are very welcome.


> How come in the example we are connecting to a channel/queue in the after_fork hook? Is this for debugging purposes?

Channels are typically opened when applications boot. Messages are published there just so that people can see messages flow. 
More on what role channels play: http://rubyamqp.info/articles/amqp_9_1_model_explained/#amqp_channels

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From michael.s.klishin at gmail.com  Tue Jan 17 18:16:58 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 17 Jan 2012 22:16:58 +0400
Subject: [rabbitmq-discuss] Ruby Gem with Unicorn server
In-Reply-To: <4F15B280.1070201@gmail.com>
References: <4F15B280.1070201@gmail.com>
Message-ID: <BB33B839-87AD-4279-883E-11ED21282781@gmail.com>

Mark:

> I also have one other question regarding EventMachine#next_tick. I've read that:
> 
> "Everything scheduled using EM#next_tick will happen synchronously in the main thread.  Any long running tasks inside an EM#next_tick block will cause the entire program to block until complete. Typically a bad thing."
> 
> Does this mean we don't gain anything by using EM in this fashion.. ie our attempt to use AMQP asynchronously is actually synchronous? 
> 

That piece of (EventMachine) documentation tries to say that EventMachine.next_tick always runs callbacks on the event loop thread (it does not necessary
have to be main thread. With Unicorn, Puma or any Web server that is not Thin, it won't be main). So you need to be careful to not block it. Web apps rarely
do anything that may do that.

EventMachine.next_tick used to delay any operations that use EventMachine until after event loop is ready. That's is all. It does not make amqp gem
synchronous. It just says "hey, EventMachine. I am not sure if you are running already, but when you are, run this code. Kthxbai".

So, to reiterate: with Unicorn, main Ruby VM thread is used by Unicorn itself. EventMachine is started in another thread. All network activity caused by amqp gem
always happens on that thread. In the context of Web apps that usually only publish events and commands, you typically never have to worry about it.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From joeyfitz at gmail.com  Tue Jan 17 18:25:20 2012
From: joeyfitz at gmail.com (joefitzgerald)
Date: Tue, 17 Jan 2012 10:25:20 -0800 (PST)
Subject: [rabbitmq-discuss] Issue Enabling Plugins on OS X 10.7
Message-ID: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>

Hi,

I'm having issues enabling plugins on my machine (OS X 10.7, 64-bit).
I've installed Erlang R15B_1+ssl & RabbitMQ 2.7.1_0 using MacPorts.

Initially, I had this error:

Joes-MacBook-Pro:var joe$ sudo rabbitmq-plugins enable
rabbitmq_management
Error: {cannot_write_enabled_plugins_file,
           "/opt/local/etc/rabbitmq/enabled_plugins",enoent}

So, I created the /opt/local/etc/rabbitmq directory and touched the /
opt/local/etc/rabbitmq/enabled_plugins file.

Now, I get this error:

Joes-MacBook-Pro:/ joe$ sudo rabbitmq-plugins enable
rabbitmq_management
Error: {'EXIT',{{case_clause,{ok,[]}},
                [{rabbit_plugins,read_enabled_plugins,1,
                                 [{file,"src/rabbit_plugins.erl"},
{line,326}]},
                 {rabbit_plugins,action,5,
                                 [{file,"src/rabbit_plugins.erl"},
{line,97}]},
                 {rabbit_plugins,start,0,
                                 [{file,"src/rabbit_plugins.erl"},
{line,59}]},
                 {init,start_it,1,[]},
                 {init,start_em,1,[]}]}}

Has anyone seen this before / have any tips for me to resolve the
issue?

Thanks!

- Joe

From 0x6e6562 at gmail.com  Tue Jan 17 18:26:43 2012
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 17 Jan 2012 18:26:43 +0000
Subject: [rabbitmq-discuss] Recovering Rabbit without restarting
In-Reply-To: <4F155E3A.6090604@rabbitmq.com>
References: <CAB-G1jhf7cPf0GiQQzVQ2HUCJS9=4oaCTmvvati3OrxVi6w=fw@mail.gmail.com>
	<4F155E3A.6090604@rabbitmq.com>
Message-ID: <CAB-G1jhDa8yZPucj7Rq=WUEmrL_cD0ak+n53iz5A4BFsYQJ1gg@mail.gmail.com>

Hey Simon,

On Tue, Jan 17, 2012 at 11:40 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 16/01/12 17:34, Ben Hood wrote:
>>
>> I'm currently looking into a production scenario with
>> 2.7.0/RHEL5/R13B3 where Rabbit has ground to halt by consuming as good
>> as all of the CPU, but is still responding to external requests,
>> albeit very slowly. Peers appear to still be connected to the broker.
>> Running rabbitmqctl works, but any kind of report (status,
>> list_queues, report etc) is taking too long to return to get any
>> diagnostics whatsoever.
>>
>> So I was wondering if there is any way to somehow throttle heavyweight
>> activities so that we can run some of the normal diagnostics, short of
>> restarting the whole instance.
>
>
> If the memory alarm has not already gone off by this point you may benefit
> from making it go off to halt publishers:

I assume that the memory alarm had gone off, since the management UI
was reporting 3.9 GB over a 1.5 GB watermark. The UI also correctly
colored the background box as bright red :-)

> Also, the management plugin should in general be more responsive than
> rabbitmqctl in heavily-loaded situations. This is because rabbitmqctl will
> go and interrogate each {queue / connection / channel} in turn, while
> management caches updates that are broadcast by these objects.

So it turns out the UI was effectively unresponsive - each _refresh_
would take a couple of minutes and the JS app would periodically crash
in Chrome (don't know about Mozilla).

The way I ended solving the issue was the with realization that 3
client instances had each leaked ca. 50K channels. After killing these
connections with rabbitmqctl (which took about 1 minute per
connection), the broker returned to a normal operating state. So in
the end, no other client connections needed to get terminated.

So all that was required was a bit of patience - thanks for taking the
time to look into this though.

Cheers,

Ben

From static.void.dev at gmail.com  Tue Jan 17 19:33:01 2012
From: static.void.dev at gmail.com (Mark)
Date: Tue, 17 Jan 2012 11:33:01 -0800
Subject: [rabbitmq-discuss] Ruby Gem with Unicorn server
In-Reply-To: <8C7EA923-CBD7-49E2-A5C4-7E6B07281B92@gmail.com>
References: <4F15B280.1070201@gmail.com>
	<8C7EA923-CBD7-49E2-A5C4-7E6B07281B92@gmail.com>
Message-ID: <4F15CCED.4030404@gmail.com>

Thanks for clearing this up. Ill have to check out those integration 
classes you mentioned.

Question... typically only 1 channel is needed per application right?

On 1/17/12 10:10 AM, Michael Klishin wrote:
> Mark:
>
>> Is this all that is required?
> Yes. In 0.9.0 (possibly in 0.8.4 as well) there is a helper that reads config/amqp.yml similarly to config/database.yml:
>
>    require "amqp/utilities/event_loop_helper"
>    require "amqp/integration/rails"
>
>    # this helper detects what app server (if any) is being used and starts EventMachine reactor in a separate
>    # thread or just uses .next_tick (for example, with Thin).
>    AMQP::Utilities::EventLoopHelper.run
>
>    # reads config/amqp.yml, takes environment-specific key out of it (e.g. :development) and
>    # merges whatever you pass to .start with it.
>    AMQP::Integration::Rails.start do |connection|
>      puts "Connected to AMQP broker"
>      # this is just an accessor for 1 channel. It has no special properties, just a placeholder for
>      # applications that only need one channel
>      AMQP.channel    = AMQP::Channel.new(connection)
>    end
>
> I would like to try to make it detect Unicorn forking, that's why it is not not yet in the documentation: it may slightly change
> for 1.0. Your suggestions about what you want it to do are very welcome.
>
>
>> How come in the example we are connecting to a channel/queue in the after_fork hook? Is this for debugging purposes?
> Channels are typically opened when applications boot. Messages are published there just so that people can see messages flow.
> More on what role channels play: http://rubyamqp.info/articles/amqp_9_1_model_explained/#amqp_channels
>
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>

From michael.s.klishin at gmail.com  Tue Jan 17 19:42:10 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 17 Jan 2012 23:42:10 +0400
Subject: [rabbitmq-discuss] Ruby Gem with Unicorn server
In-Reply-To: <4F15CCED.4030404@gmail.com>
References: <4F15B280.1070201@gmail.com>
	<8C7EA923-CBD7-49E2-A5C4-7E6B07281B92@gmail.com>
	<4F15CCED.4030404@gmail.com>
Message-ID: <7361ABA0-9A6A-420C-B0FD-713E5000381E@gmail.com>

Mark:

> Question... typically only 1 channel is needed per application right?

For Web apps that just publish messages and never consume them, yes.

For consumer applications, you almost always end up with multiple channels because
channels should not be shared between threads and error handling in AMQP 0.9.1 is per-channel (connection-level exceptions usually
indicate misconfiguration or serious client bugs). Another common reason for separation is to be able to see separate message flows
in the RabbitMQ Web UI.

You can always start with 1 channel (this is why AMQP.channel accessor is there, so you don't have to decide where to assign it) and add more,
often moving to this technique: 

http://rubyamqp.info/articles/getting_started/#integration_with_objects

but It is not uncommon to see publishing being done as

AMQP.channel.default_exchange.publish(payload, ?)

initially. This is not discouraged.

Channels on the wire are just integers every message carries so they are very cheap to create and maintain in terms of resources,
both for clients and RabbitMQ itself.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From videlalvaro at gmail.com  Tue Jan 17 19:45:03 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 17 Jan 2012 20:45:03 +0100
Subject: [rabbitmq-discuss] Issue Enabling Plugins on OS X 10.7
In-Reply-To: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>
References: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>
Message-ID: <44D03CCB-A3E4-47B9-AD92-9B32875A9454@gmail.com>

Hi,

Usually you just have to chmod the configuration folder so the rabbitmq process can write in that folder. 

So usually you don't need to "sudo" to run rabbit or any of the management commands. Just run those with the same user that started Rabbitmq.

-Alvaro

On Jan 17, 2012, at 7:25 PM, joefitzgerald wrote:

> Hi,
> 
> I'm having issues enabling plugins on my machine (OS X 10.7, 64-bit).
> I've installed Erlang R15B_1+ssl & RabbitMQ 2.7.1_0 using MacPorts.
> 
> Initially, I had this error:
> 
> Joes-MacBook-Pro:var joe$ sudo rabbitmq-plugins enable
> rabbitmq_management
> Error: {cannot_write_enabled_plugins_file,
>           "/opt/local/etc/rabbitmq/enabled_plugins",enoent}
> 
> So, I created the /opt/local/etc/rabbitmq directory and touched the /
> opt/local/etc/rabbitmq/enabled_plugins file.
> 
> Now, I get this error:
> 
> Joes-MacBook-Pro:/ joe$ sudo rabbitmq-plugins enable
> rabbitmq_management
> Error: {'EXIT',{{case_clause,{ok,[]}},
>                [{rabbit_plugins,read_enabled_plugins,1,
>                                 [{file,"src/rabbit_plugins.erl"},
> {line,326}]},
>                 {rabbit_plugins,action,5,
>                                 [{file,"src/rabbit_plugins.erl"},
> {line,97}]},
>                 {rabbit_plugins,start,0,
>                                 [{file,"src/rabbit_plugins.erl"},
> {line,59}]},
>                 {init,start_it,1,[]},
>                 {init,start_em,1,[]}]}}
> 
> Has anyone seen this before / have any tips for me to resolve the
> issue?
> 
> Thanks!
> 
> - Joe
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From marcus_rubeus at hotmail.com  Tue Jan 17 20:20:03 2012
From: marcus_rubeus at hotmail.com (MarcusR)
Date: Tue, 17 Jan 2012 12:20:03 -0800 (PST)
Subject: [rabbitmq-discuss] X-expires not working in 0-8-0 clients
In-Reply-To: <4F154B67.4090303@rabbitmq.com>
References: <776164fc-e66b-479d-8cd2-db8009926122@g27g2000yqa.googlegroups.com>
	<4F154B67.4090303@rabbitmq.com>
Message-ID: <53e7b733-8138-4415-8ac2-0cfce3e84374@u20g2000yqb.googlegroups.com>

Hello, I upgraded and everything works great. Thanks!

On Jan 17, 5:20?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Marcus,
>
> On 16/01/12 23:19, MarcusR wrote:
>
> > It seems that the x-expires argument for declaring queues is not
> > accepted from 0-8 clients. The error message I receive is this:
>
> > PRECONDITION_FAILED - invalid arg 'x-expires' for queue
>
> I don't think the version of the client matters. What version of the
> broker are you using? V2.0.0 and v2.1.0 only accepted expiry values of
> type "long int", while you are using "int". If that is the problem then
> you should either supply a "long" value or use at least v2.1.1 of the
> broker (preferably the latest version).
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From marcus_rubeus at hotmail.com  Tue Jan 17 20:27:35 2012
From: marcus_rubeus at hotmail.com (MarcusR)
Date: Tue, 17 Jan 2012 12:27:35 -0800 (PST)
Subject: [rabbitmq-discuss] Keeping track of exchanges -- Any Advice
Message-ID: <ab66f90c-2e4e-49ff-987e-425a493e4b68@t8g2000yqg.googlegroups.com>

I have a  setup where I need to use a LOT of unique exchanges /
queues.

To explain. Essentially, think that every "user" has their own
exchange and then 3 queues on that exchange. These users may be active
for a few minutes to days. The time they exist is unknown (depends on
the user). There are hundreds of thousands of users at a time.
Periodically, another user may send a message to a user. However, that
user may or may not be active (have an exchange / queue associated
with it).

The x-expires feature is great for the queue. If a user is not active
in 15 minutes, then all their queues can be deleted. If I set
auto_delete on exchanges to be true, it is my understanding that that
exchanges will also be deleted once the queues are. Thats great too.

The problem is when user A sends a message to user B and user B has
had their exchange deleted. This will create an error. Ideally, what
would happen is rabbitmq would just ignore the message. If the user is
not active, then it does not matter if the message just goes to /dev/
null.

Is there a way around this or a way to get the desired behavior? If
not, what strategies do people use to determine in real time what
exchanges are active or not or what exchanges need to be deleted or
not?

From j.14159 at gmail.com  Tue Jan 17 20:57:46 2012
From: j.14159 at gmail.com (Jeremy Pierre)
Date: Tue, 17 Jan 2012 12:57:46 -0800
Subject: [rabbitmq-discuss] RabbitMQ load issues
In-Reply-To: <4F156DDE.8030408@rabbitmq.com>
References: <CAHtD+9P9-7_hgHf8vcwZn3BGQEviRHZvFjn1kwnVEGy4_v7wag@mail.gmail.com>
	<4F156DDE.8030408@rabbitmq.com>
Message-ID: <CAHtD+9NnX9HPYPWk9RJdd9sojj68ch4=Tj6-is66ZtdTU1TNtw@mail.gmail.com>

Hi Simon,

Thanks for your reply.  I'll try to clarify/respond in kind below:

<SNIP>

> Hmm. While RabbitMQ is designed to scale :-) 100k queues and 700k bindings
> does start to sound like "a lot".
>
> Having said that I was able to create that number of queues / bindings on my
> desktop machine in half an hour or so without *too* much trouble.
>
> Some tips:
>
> * If you're declaring queues in bulk, make sure you do so synchonously (i.e.
> nowait=false).

To be perfectly honest, I can't find this (with a relatively cursory
investigation) in the APIs I'm using(Akka 1.2 AMQP module that
leverages RabbitMQ's Java lib iirc).  Having said that, I'm creating
queues one at a time(albeit quickly) - not sure if this addresses the
bulk queue declaration you're referring to?  I'll dig further into the
APIs on my side.

> * If you're going to have that many queues and that few routing keys then
> presumably every message published will be delivered to huge numbers of
> queues. I assume you expect your publishing rate to be small. Publishing a
> couple of messages per second is a lot if they're delivered to 50k queues.

The number of routing keys is actually fairly high given that the
userId and actual message categories are completely variable.  With
the example I gave(~100k queues), each queue is bound to a unique
routing key(topic) and a message typically is delivered to a very
small number of queues(20-30 would be a theoretical maximum and a very
rare situation).  As additional applications are built on top of the
base collection layer and RabbitMQ, the queue count will go much
higher(obviously).

For what it's worth, our testing load(30k "users", 6 queues per user
in my original posting though we never got that high before rabbit
choked) generates an easy 150-200 messages per second going into
RabbitMQ and this can spike higher.  Production will see 200k-300k
users at least I expect.

> * Every queue process consumes a fixed small amount of memory. Spreading
> queues out over a cluster will help.

We're experimenting with a 3-node cluster as of today though I've
reduced the queue count by determining the update type at my
application layer and using topics with wildcards, e.g.
"<source>.<userId>.*"

> * Every queue and binding creates a row in an Mnesia table. Mnesia tables
> always reside in RAM, so for huge numbers of queues in a cluster expect to
> use lots of RAM. Therefore instead of clustering you will probably find it
> better to shard the queues out over independent brokers and connect them
> with federation. The case of huge numbers of queues and very few routing
> keys could almost be made for federation. For the massive fanout case you
> probably want to build a (maybe multi-layered) federation tree rather than
> the complete graph people use more often with federation.

Thanks for suggesting this!  We may go this route but I'm wary of
putting sharding logic in our application layer(perhaps unjustifiably
so).  Truth be told I was kind of hoping for a "silver bullet" with
RabbitMQ ;)  In the meantime, we'll bump the RAM for our cluster nodes
and see what happens.

> * For every active queue (one that has sent or received a message in the
> last few seconds) there is a small CPU cost when using the management
> plugin. With huge numbers of queues per node it may be helpful to disable
> mgmt. On the other hand "rabbitmqctl list_queues" will contact all the
> queues synchronously (maybe waking them up). Monitoring will be an issue.

Good to know, we'll keep that in mind while testing load, etc.

Thanks for the feedback!  Any other ideas based on my above responses
are *most* welcome!

Regards,

Jeremy Pierre

From u2.storm at gmail.com  Tue Jan 17 23:06:04 2012
From: u2.storm at gmail.com (st0rm)
Date: Tue, 17 Jan 2012 15:06:04 -0800 (PST)
Subject: [rabbitmq-discuss]  Lost messages in cluster
Message-ID: <33157833.post@talk.nabble.com>


Hello.

I have a cluster with 4 disk nodes.
Topology is similar to many-to-many:
The only exchange distributed over all nodes. Two queues(one of them is
durable) declared per node and bound to above mentioned exchange.
So each node is able to publish messages and they will be delivered to other
nodes of cluster.

Recently I've discovered some problems when I have network failures.
If node lose network connection (or network device is down) for approx. 1
minute ( or net_ticktime period of time), this node doesn't receive message
that were published to exchange while network was down.

I've read that "RabbitMQ clustering does not tolerate network partions
well". I suppose that federation plugin can help me, but I can't understand
what network topology have to be built to preserve current functionality -
what upstreams should exist and etc.

Could somebody help me to avoid losing messages?
-- 
View this message in context: http://old.nabble.com/Lost-messages-in-cluster-tp33157833p33157833.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From static.void.dev at gmail.com  Wed Jan 18 01:03:07 2012
From: static.void.dev at gmail.com (Mark)
Date: Tue, 17 Jan 2012 17:03:07 -0800
Subject: [rabbitmq-discuss] Ruby Gem with Unicorn server
In-Reply-To: <8C7EA923-CBD7-49E2-A5C4-7E6B07281B92@gmail.com>
References: <4F15B280.1070201@gmail.com>
	<8C7EA923-CBD7-49E2-A5C4-7E6B07281B92@gmail.com>
Message-ID: <4F161A4B.8040403@gmail.com>

Do I need both statements?

AMQP::Utilities::EventLoopHelper.run

AMQP::Integration::Rails.start do |connection|
    AMQP.channel = AMQP::Channel.new(connection)
end

On 1/17/12 10:10 AM, Michael Klishin wrote:
> Mark:
>
>> Is this all that is required?
> Yes. In 0.9.0 (possibly in 0.8.4 as well) there is a helper that reads config/amqp.yml similarly to config/database.yml:
>
>    require "amqp/utilities/event_loop_helper"
>    require "amqp/integration/rails"
>
>    # this helper detects what app server (if any) is being used and starts EventMachine reactor in a separate
>    # thread or just uses .next_tick (for example, with Thin).
>    AMQP::Utilities::EventLoopHelper.run
>
>    # reads config/amqp.yml, takes environment-specific key out of it (e.g. :development) and
>    # merges whatever you pass to .start with it.
>    AMQP::Integration::Rails.start do |connection|
>      puts "Connected to AMQP broker"
>      # this is just an accessor for 1 channel. It has no special properties, just a placeholder for
>      # applications that only need one channel
>      AMQP.channel    = AMQP::Channel.new(connection)
>    end
>
> I would like to try to make it detect Unicorn forking, that's why it is not not yet in the documentation: it may slightly change
> for 1.0. Your suggestions about what you want it to do are very welcome.
>
>
>> How come in the example we are connecting to a channel/queue in the after_fork hook? Is this for debugging purposes?
> Channels are typically opened when applications boot. Messages are published there just so that people can see messages flow.
> More on what role channels play: http://rubyamqp.info/articles/amqp_9_1_model_explained/#amqp_channels
>
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>

From taylste at gmail.com  Wed Jan 18 06:03:29 2012
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 18 Jan 2012 06:03:29 +0000
Subject: [rabbitmq-discuss] [.net client] exception using IBasicProperties
Message-ID: <CA+zYriRLEGHMBHkBw9ukkhYvCHN5u9nPGBAD==opDQB+D90X2Q@mail.gmail.com>

So basic properties gets set in a message processing loop.  Now I want to
query it.  Looks like the sender forgot to set basic properties correctly.

            IBasicProperties basicProperties = ...;
            if (basicProperties.ReplyToAddress != null)
            {
                ...
            }


... but... do you think that I should receive an
ArgumentNullException?  The easy way around this would be to create a
wrapper.  Just thought I'd mention it.

System.ArgumentNullException: Value cannot be null.
Parameter name: input
   at System.Text.RegularExpressions.Regex.Match(String input)
   at RabbitMQ.Client.PublicationAddress.Parse(String uriLikeString)
   at RabbitMQ.Client.Impl.BasicProperties.get_ReplyToAddress()
...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/67b13745/attachment.htm>

From brian.newsgroup at gmail.com  Wed Jan 18 06:11:03 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Wed, 18 Jan 2012 17:11:03 +1100
Subject: [rabbitmq-discuss] About RabbitMQ federation plugin
In-Reply-To: <4F1554CD.9080300@rabbitmq.com>
References: <CALD4NQbiL9n6rGyY0frdsB9jmF4CYFZTiZZTeZvHNBArsuZ_gw@mail.gmail.com>
	<4F1554CD.9080300@rabbitmq.com>
Message-ID: <CALD4NQYtBZYWaZ4syHtnU7qGytXpNaGuAcJLnv-XWJkxCqXVkA@mail.gmail.com>

Hi Simon and Simone,

Thanks very much for your clarification! Now it works for me!

The reason why it didn't work before was that I sent messages inside the
callback on_queue_declared, which didn't get executed when I removed the
queue declaration (thats why I thought declaring the queue on upstream
server was required). What I did to resolve it was to create a random
exclusive queue in order to get the callback invoked.

Thanks again!

Brian

On Tue, Jan 17, 2012 at 10:00 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 17/01/12 06:50, Brian Jing wrote:
>
>> I've played with the federation plugin a little. It seems that in order
>> to send a message to a queue on the downstream server, the same queue
>> has to be declared on the upstream server for federation to work?
>>
>
> No, that should definitely not be the case.
>
> The federation plugin is meant to send bindings upstream automatically (so
> that it does not just send all messages upstream -> downstream, but only
> the ones that will be routed once they get downstream).
>
> When you bind a queue to the downstream exchange with routing key A, you
> should see a similar binding appear between the upstream exchange and the
> intermediate upstream exchange (called something like "federation: name ->
> name {A|B}". Is that happening?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/8e5cb8a8/attachment.htm>

From michael.s.klishin at gmail.com  Wed Jan 18 06:26:46 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 18 Jan 2012 10:26:46 +0400
Subject: [rabbitmq-discuss] Ruby Gem with Unicorn server
In-Reply-To: <4F161A4B.8040403@gmail.com>
References: <4F15B280.1070201@gmail.com>
	<8C7EA923-CBD7-49E2-A5C4-7E6B07281B92@gmail.com>
	<4F161A4B.8040403@gmail.com>
Message-ID: <49F12353-C077-46C6-9F69-CAC91861492A@gmail.com>

Mark:

> Do I need both statements?
> 
> AMQP::Utilities::EventLoopHelper.run
> 
> AMQP::Integration::Rails.start do |connection|
>   AMQP.channel = AMQP::Channel.new(connection)
> end

Yes. You need to both start EventMachine (this part depends on application server, hence the helper) and
connect to the broker, then open channel(s) you need.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From mspetrovic at gmail.com  Wed Jan 18 06:50:30 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Tue, 17 Jan 2012 22:50:30 -0800
Subject: [rabbitmq-discuss] Questions on consumerTags and basicConsume
Message-ID: <D92A9D1A-EE1F-4F4D-A6F1-2AFF2FD3F73B@gmail.com>

Hello.

- Is a consumer tag a token that should be unique on a per call basis to Java basic.Consume()?  And what exactly is a consumer tag good for?  

- I've seen some evidence that basic.Consume() does not block in the absence of messages to consume.  Is that to be expected?

Thank you.

From brian.newsgroup at gmail.com  Wed Jan 18 06:53:05 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Wed, 18 Jan 2012 17:53:05 +1100
Subject: [rabbitmq-discuss] How to check the ack for a particular message
	that's sent using Pika?
Message-ID: <CALD4NQb-_p1TqsAP1-a_eH6QF2=KN+UAaGVZ-aLX1jnkUToSiQ@mail.gmail.com>

Hi there,

I'd like to be able to check whether I've received an ack for a particular
message when using publisher delivery confirm mode. Was wondering if it's
possible to do this using Pika.

Reason why I'd like to do this: my RabbitMQ client receives messages from a
local daemon (using rpc) and sends those messages asynchronously to a
RabbitMQ server. Since the messages received from the daemon are stored in
memory, if the client crashes, it will lose them. Hence I'd like to improve
robustness of the client by making the client store messages to disk. If
the client fails to receive an ack for a message, it resends the message,
otherwise it removes the message from the local disk store.

So basically how it works is:
1. daemon sends a message to local client
2. client stores the message to disk
3. client sends the message to server
4. client resends the message periodically until it receives the ack, then
it removes the message from the disk.

By doing it this way, I will have to know whether I've received an ack.
However, from some experiments done by a colleague recently, it appears
that the server may send an ack for multiple messages (if it's correct).
I've looked around and only saw a Java example trying to retrieve sequence
number for a message from a frame. I would like to know whether it's
possible to check whether I've got an ack for a particular message using
Pika, and the way how to do it.

Cheers,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/3797eb2c/attachment.htm>

From michael.s.klishin at gmail.com  Wed Jan 18 07:10:39 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 18 Jan 2012 11:10:39 +0400
Subject: [rabbitmq-discuss] Questions on consumerTags and basicConsume
In-Reply-To: <D92A9D1A-EE1F-4F4D-A6F1-2AFF2FD3F73B@gmail.com>
References: <D92A9D1A-EE1F-4F4D-A6F1-2AFF2FD3F73B@gmail.com>
Message-ID: <46FF6B11-88F6-4B04-BF55-10AF84ADF5C7@gmail.com>

Mark Petrovic:

> - Is a consumer tag a token that should be unique on a per call basis to Java basic.Consume()?  And what exactly is a consumer tag good for?  
> 

Consumer tag is a subscription identifier, applications use to cancel the subscription. AMQP clients use it to know what handler to use when messages are delivered.
It has to be unique in the vhost you are using. There are versions of basicConsume that will generate consumer tag for you.

> - I've seen some evidence that basic.Consume() does not block in the absence of messages to consume. Is that to be expected?

basicConsume registers a consumer that rabbitmq will push messages to as soon as they are available in the queue. It is "push API".
For "pull API" (fetching messages on demand), see basicGet.

MK


From taylste at gmail.com  Wed Jan 18 09:50:25 2012
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 18 Jan 2012 09:50:25 +0000
Subject: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to be transferred
Message-ID: <CA+zYriQdiq=ig-T4dOWTbg=iOXU5x18GyMnk9zEKY2jzk+SVRQ@mail.gmail.com>

under .net client ReplyTo and ReplyToAddress fail to be transerred to the
consmer.  I thought that that was what BasicProperteris were for.  I'm a
little confused because I think that I've seen these working before.

-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/e58fd8ce/attachment.htm>

From emile at rabbitmq.com  Wed Jan 18 10:01:20 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Jan 2012 10:01:20 +0000
Subject: [rabbitmq-discuss] Issue Enabling Plugins on OS X 10.7
In-Reply-To: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>
References: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>
Message-ID: <4F169870.7070906@rabbitmq.com>

Hi,

On 17/01/12 18:25, joefitzgerald wrote:
> Now, I get this error:
> 
> Joes-MacBook-Pro:/ joe$ sudo rabbitmq-plugins enable
> rabbitmq_management
> Error: {'EXIT',{{case_clause,{ok,[]}},
>                 [{rabbit_plugins,read_enabled_plugins,1,
>                                  [{file,"src/rabbit_plugins.erl"},

The file should contain the 3 characters "[]."
The second error you see is consistent with an empty file.



-Emile

From kbaltrinic at bericotechnologies.com  Tue Jan 17 17:27:41 2012
From: kbaltrinic at bericotechnologies.com (Ken Baltrinic)
Date: Tue, 17 Jan 2012 09:27:41 -0800 (PST)
Subject: [rabbitmq-discuss] app_stop fails on RHEL SE-Linux
Message-ID: <e4fd9427-90d6-4193-b613-34dafd9ad2a7@l16g2000vbl.googlegroups.com>

I am tasked with installing a rabbit cluster on RHEL (release 5.7
Tikanga) w/SE-Linux (actually the DoDIIS build 2.1.5).  I can
successfully install a single node rabbit instance using the rabbitmq-
server-2.7.1-1.noarch.rpm after installing erlang R15B from source.
However when I attempt to cluster my rabbit2 server with my rabbit1
server, I am unable so successfully execute the rabbitmqctl app_stop
command on rabbit2.  Rather I get the below output.  Thereafter
running rabbitmqctl status shows that the node is still up and
running.  Any ideas?

sh-3.2# rabbitmqctl app_stop
Error: {'EXIT',
           {function_clause,
               [{rabbit_control,action,
                    [app_stop,rabbit at rabbit2,[],
                     [{"-p","/"},{"-n","rabbit at rabbit2"},{"-
q",false}],
                     #Fun<rabbit_control.1.115240681>],
                    []},
                {rabbit_control,start,0,[]},
                {init,start_it,1,[]},
                {init,start_em,1,[]}]}}

From roberts.john at gmail.com  Wed Jan 18 01:04:30 2012
From: roberts.john at gmail.com (jrob)
Date: Tue, 17 Jan 2012 17:04:30 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ HA
In-Reply-To: <CACOPnvfhbpPdKrNhyE5bbeowBhWeMi+W3wM+Vt5hs0a9PenkZA@mail.gmail.com>
References: <4F0F18BB.7080508@gmail.com>
	<CACOPnvfhbpPdKrNhyE5bbeowBhWeMi+W3wM+Vt5hs0a9PenkZA@mail.gmail.com>
Message-ID: <11354968.2215.1326848670369.JavaMail.geo-discussion-forums@prdv33>

In order to do this in our setup, we use HAProxy <http://haproxy.1wt.eu/> in 
front of three virtual machines (our systems are all deployed on RackSpace 
Cloud VMs).  All of our software only knows about the Virtual IP that 
points at our HAProxy installation; HAProxy knows about the three VMs, each 
of which is running one node of a RabbitMQ cluster.  All of our Queues are 
created as HA queues so that messages are replicated across all nodes in 
the event of a single node failure.

This method allows us to simply add another VM and bring it into the 
cluster if we want to expand capacity, and no updates are required to our 
code base as it continues to interact with HAProxy for connections.  The 
trick was to make sure we set everything up properly to automatically 
reconnect in our code in the event of a disconnection, as HAProxy times out 
connections at an interval determined by your settings.

Having said all that, we have yet to move this into production, so I can't 
speak to whether or not it will behave as anticipated in the wild. 
 However, initial testing is very promising, and when we force a node to 
fail, HAProxy automatically detects that it has gone down, and just stops 
handing out connections to that node.  Just in case anyone complains about 
the single point of failure that is HAProxy, that has also been setup to 
failover on a Virtual IP; should our main HAProxy machine ever go down, the 
other HAProxy instance will take over and continue handing out node 
connections.

This has been an interesting experiment, feel free to bug me if you want 
more details on our setup.

- jrob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/ef7f62c1/attachment.htm>

From roberts.john at gmail.com  Wed Jan 18 01:15:01 2012
From: roberts.john at gmail.com (jrob)
Date: Tue, 17 Jan 2012 17:15:01 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ HA
In-Reply-To: <11354968.2215.1326848670369.JavaMail.geo-discussion-forums@prdv33>
References: <4F0F18BB.7080508@gmail.com>
	<CACOPnvfhbpPdKrNhyE5bbeowBhWeMi+W3wM+Vt5hs0a9PenkZA@mail.gmail.com>
	<11354968.2215.1326848670369.JavaMail.geo-discussion-forums@prdv33>
Message-ID: <21871097.2232.1326849301680.JavaMail.geo-discussion-forums@prfc16>

Sorry for the multi-post, but I meant to give props to the book RabbitMQ in 
Action which provides a very detailed example of the setup I described.  I 
really only had to plug in the Ruby equivalents in our environment, and 
stomp a few bugs, and we were good to go.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120117/4e15987c/attachment.htm>

From simon at rabbitmq.com  Wed Jan 18 10:14:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jan 2012 10:14:38 +0000
Subject: [rabbitmq-discuss] Issue Enabling Plugins on OS X 10.7
In-Reply-To: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>
References: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>
Message-ID: <4F169B8E.8000001@rabbitmq.com>

On 17/01/12 18:25, joefitzgerald wrote:
> So, I created the /opt/local/etc/rabbitmq directory and touched the /
> opt/local/etc/rabbitmq/enabled_plugins file.
>
> Now, I get this error:
>
> Joes-MacBook-Pro:/ joe$ sudo rabbitmq-plugins enable
> rabbitmq_management
> Error: {'EXIT',{{case_clause,{ok,[]}},
>                  [{rabbit_plugins,read_enabled_plugins,1,
>                                   [{file,"src/rabbit_plugins.erl"},

Ah, the file is never expected to be empty. (But maybe we could handle 
that better).

The directory just needs to be writeable by rabbitmq-plugins.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 18 10:18:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jan 2012 10:18:57 +0000
Subject: [rabbitmq-discuss] app_stop fails on RHEL SE-Linux
In-Reply-To: <e4fd9427-90d6-4193-b613-34dafd9ad2a7@l16g2000vbl.googlegroups.com>
References: <e4fd9427-90d6-4193-b613-34dafd9ad2a7@l16g2000vbl.googlegroups.com>
Message-ID: <4F169C91.6050300@rabbitmq.com>

On 17/01/12 17:27, Ken Baltrinic wrote:
> sh-3.2# rabbitmqctl app_stop
> Error: {'EXIT',
>             {function_clause,
>                 [{rabbit_control,action,
>                      [app_stop,rabbit at rabbit2,[],

It's stop_app, not app_stop.

Unfortunately the "invalid command" error message in rabbitmqctl is 
broken with Erlang R15B, leading to the error you saw...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Jan 18 10:20:22 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Jan 2012 10:20:22 +0000
Subject: [rabbitmq-discuss] app_stop fails on RHEL SE-Linux
In-Reply-To: <e4fd9427-90d6-4193-b613-34dafd9ad2a7@l16g2000vbl.googlegroups.com>
References: <e4fd9427-90d6-4193-b613-34dafd9ad2a7@l16g2000vbl.googlegroups.com>
Message-ID: <4F169CE6.6090707@rabbitmq.com>

Hi Ken,

On 17/01/12 17:27, Ken Baltrinic wrote:
> sh-3.2# rabbitmqctl app_stop

The command should be "stop_app".


-Emile

From emile at rabbitmq.com  Wed Jan 18 10:25:39 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Jan 2012 10:25:39 +0000
Subject: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to be
	transferred
In-Reply-To: <CA+zYriQdiq=ig-T4dOWTbg=iOXU5x18GyMnk9zEKY2jzk+SVRQ@mail.gmail.com>
References: <CA+zYriQdiq=ig-T4dOWTbg=iOXU5x18GyMnk9zEKY2jzk+SVRQ@mail.gmail.com>
Message-ID: <4F169E23.2050800@rabbitmq.com>

Hi Steven,

On 18/01/12 09:50, Steven Taylor wrote:
> under .net client ReplyTo and ReplyToAddress fail to be transerred to
> the consmer.  I thought that that was what BasicProperteris were for. 
> I'm a little confused because I think that I've seen these working before.

The most likely explanation is that publishers are failing to set the
field. Can you confirm that this is not the case?



-Emile

From simon at rabbitmq.com  Wed Jan 18 10:38:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jan 2012 10:38:08 +0000
Subject: [rabbitmq-discuss] Keeping track of exchanges -- Any Advice
In-Reply-To: <ab66f90c-2e4e-49ff-987e-425a493e4b68@t8g2000yqg.googlegroups.com>
References: <ab66f90c-2e4e-49ff-987e-425a493e4b68@t8g2000yqg.googlegroups.com>
Message-ID: <4F16A110.6000205@rabbitmq.com>

First of all, can you get the routing you need without every user 
requiring their own exchange? What routing do you need to do?

Cheers, Simon

On 17/01/12 20:27, MarcusR wrote:
> I have a  setup where I need to use a LOT of unique exchanges /
> queues.
>
> To explain. Essentially, think that every "user" has their own
> exchange and then 3 queues on that exchange. These users may be active
> for a few minutes to days. The time they exist is unknown (depends on
> the user). There are hundreds of thousands of users at a time.
> Periodically, another user may send a message to a user. However, that
> user may or may not be active (have an exchange / queue associated
> with it).
>
> The x-expires feature is great for the queue. If a user is not active
> in 15 minutes, then all their queues can be deleted. If I set
> auto_delete on exchanges to be true, it is my understanding that that
> exchanges will also be deleted once the queues are. Thats great too.
>
> The problem is when user A sends a message to user B and user B has
> had their exchange deleted. This will create an error. Ideally, what
> would happen is rabbitmq would just ignore the message. If the user is
> not active, then it does not matter if the message just goes to /dev/
> null.
>
> Is there a way around this or a way to get the desired behavior? If
> not, what strategies do people use to determine in real time what
> exchanges are active or not or what exchanges need to be deleted or
> not?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Wed Jan 18 11:17:56 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 18 Jan 2012 15:17:56 +0400
Subject: [rabbitmq-discuss] RabbitMQ HA
In-Reply-To: <21871097.2232.1326849301680.JavaMail.geo-discussion-forums@prfc16>
References: <4F0F18BB.7080508@gmail.com>
	<CACOPnvfhbpPdKrNhyE5bbeowBhWeMi+W3wM+Vt5hs0a9PenkZA@mail.gmail.com>
	<11354968.2215.1326848670369.JavaMail.geo-discussion-forums@prdv33>
	<21871097.2232.1326849301680.JavaMail.geo-discussion-forums@prfc16>
Message-ID: <167F935B-26B4-429E-8756-413BF8B036A2@gmail.com>

jrob:

>  I really only had to plug in the Ruby equivalents in our environment, and stomp a few bugs, and we were good to go.

John,

Does this include automatic recovery mode that amqp gem supports for publishers in 0.9.0? I am always curious how well it works in
for other people.

Thanks.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From taylste at gmail.com  Wed Jan 18 12:04:40 2012
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 18 Jan 2012 12:04:40 +0000
Subject: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to be
	transferred
In-Reply-To: <4F169E23.2050800@rabbitmq.com>
References: <CA+zYriQdiq=ig-T4dOWTbg=iOXU5x18GyMnk9zEKY2jzk+SVRQ@mail.gmail.com>
	<4F169E23.2050800@rabbitmq.com>
Message-ID: <CA+zYriThYu_G=VzZgJeZ1VZ3Qqr0g-f5s4ZE2Cm6=Q=D+v=dOw@mail.gmail.com>

Hi Emile,

confirmed.  Going to put "reply-to" in the body of the message for now.
Will drop you an email if I find out any more.  An issue with the .net
client?


var stringAddr = new PublicationAddress("topic", "exchangeName",
"rout.ing.key").ToString()

>> topic://exchangeName/rout.ing.key

Time to dig out a regular expression.

-Steven


On 18 January 2012 10:25, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Steven,
>
> On 18/01/12 09:50, Steven Taylor wrote:
> > under .net client ReplyTo and ReplyToAddress fail to be transerred to
> > the consmer.  I thought that that was what BasicProperteris were for.
> > I'm a little confused because I think that I've seen these working
> before.
>
> The most likely explanation is that publishers are failing to set the
> field. Can you confirm that this is not the case?
>
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/6f87ff14/attachment.htm>

From Simone.Busoli at ferrari.com  Wed Jan 18 12:23:59 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 18 Jan 2012 12:23:59 +0000
Subject: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to
	betransferred
In-Reply-To: <CA+zYriThYu_G=VzZgJeZ1VZ3Qqr0g-f5s4ZE2Cm6=Q=D+v=dOw@mail.gmail.com>
References: <CA+zYriQdiq=ig-T4dOWTbg=iOXU5x18GyMnk9zEKY2jzk+SVRQ@mail.gmail.com><4F169E23.2050800@rabbitmq.com>
	<CA+zYriThYu_G=VzZgJeZ1VZ3Qqr0g-f5s4ZE2Cm6=Q=D+v=dOw@mail.gmail.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520DFD5C@GSVCLU04.ges.ferlan.it>

No issues here with setting the ReplyTo field, never tried with the PublicationAddress honestly.
Aren't you getting any errors when publishing? If the client API for any reason cannot serialize the properties you should be getting an exception.

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Steven Taylor
Sent: mercoled? 18 gennaio 2012 13:05
To: Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to be transferred

Hi Emile,

confirmed.  Going to put "reply-to" in the body of the message for now.  Will drop you an email if I find out any more.  An issue with the .net client?




var stringAddr = new PublicationAddress("topic", "exchangeName", "rout.ing.key").ToString()

>> topic://exchangeName/rout.ing.key
Time to dig out a regular expression.

-Steven

On 18 January 2012 10:25, Emile Joubert <emile at rabbitmq.com<mailto:emile at rabbitmq.com>> wrote:
Hi Steven,

On 18/01/12 09:50, Steven Taylor wrote:
> under .net client ReplyTo and ReplyToAddress fail to be transerred to
> the consmer.  I thought that that was what BasicProperteris were for.
> I'm a little confused because I think that I've seen these working before.
The most likely explanation is that publishers are failing to set the
field. Can you confirm that this is not the case?



-Emile


_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/e34c96c4/attachment.htm>

From taylste at gmail.com  Wed Jan 18 12:34:30 2012
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 18 Jan 2012 12:34:30 +0000
Subject: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to
	betransferred
In-Reply-To: <88E590DC4586974D825FC82AE798294E520DFD5C@GSVCLU04.ges.ferlan.it>
References: <CA+zYriQdiq=ig-T4dOWTbg=iOXU5x18GyMnk9zEKY2jzk+SVRQ@mail.gmail.com>
	<4F169E23.2050800@rabbitmq.com>
	<CA+zYriThYu_G=VzZgJeZ1VZ3Qqr0g-f5s4ZE2Cm6=Q=D+v=dOw@mail.gmail.com>
	<88E590DC4586974D825FC82AE798294E520DFD5C@GSVCLU04.ges.ferlan.it>
Message-ID: <CA+zYriROSa_jiSnXd_JPyWZT_ji_4ymQLxekKR9o6vNyw5Nc9Q@mail.gmail.com>

I tried with publication address which is there for convenience method if I
remember correctly and also reply-to.  The info just isn't turning up in
the subscriber.  It is set successfully in the publisher.  No exceptions.

On 18 January 2012 12:23, Busoli, Simone <Simone.Busoli at ferrari.com> wrote:

>  No issues here with setting the ReplyTo field, never tried with the
> PublicationAddress honestly.****
>
> Aren?t you getting any errors when publishing? If the client API for any
> reason cannot serialize the properties you should be getting an exception.
> ****
>
> ** **
>
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Steven Taylor
> *Sent:* mercoled? 18 gennaio 2012 13:05
> *To:* Emile Joubert
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to be
> transferred****
>
> ** **
>
> Hi Emile,****
>
>  ****
>
> confirmed.  Going to put "reply-to" in the body of the message for now.
> Will drop you an email if I find out any more.  An issue with the .net
> client?  ****
>
>  ****
>
> ** **
>
> var stringAddr = new PublicationAddress("topic", "exchangeName", "rout.ing.key").ToString()****
>
> >> topic://exchangeName/rout.ing.key****
>
>  Time to dig out a regular expression.****
>
>  ****
>
> -Steven****
>
> ** **
>
> On 18 January 2012 10:25, Emile Joubert <emile at rabbitmq.com> wrote:****
>
> Hi Steven,****
>
>
> On 18/01/12 09:50, Steven Taylor wrote:
> > under .net client ReplyTo and ReplyToAddress fail to be transerred to
> > the consmer.  I thought that that was what BasicProperteris were for.
> > I'm a little confused because I think that I've seen these working
> before.****
>
> The most likely explanation is that publishers are failing to set the
> field. Can you confirm that this is not the case?
>
>
>
> -Emile****
>
> ** **
>
>
> _________________________________________________________________________________________________________________
> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e
> pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
> messaggio non ? il destinatario designato, o il dipendente/agente
> responsabile
> per la consegna del messaggio al destinatario designato, si informa che
> ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
>
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain
> information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the
> intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
> immediately by return e-mail and delete this e-mail and all attachments
> from
> your system.
>
> _________________________________________________________________________________________________________________
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/5ded8926/attachment.htm>

From emile at rabbitmq.com  Wed Jan 18 12:55:47 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Jan 2012 12:55:47 +0000
Subject: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to
	betransferred
In-Reply-To: <CA+zYriROSa_jiSnXd_JPyWZT_ji_4ymQLxekKR9o6vNyw5Nc9Q@mail.gmail.com>
References: <CA+zYriQdiq=ig-T4dOWTbg=iOXU5x18GyMnk9zEKY2jzk+SVRQ@mail.gmail.com>
	<4F169E23.2050800@rabbitmq.com>
	<CA+zYriThYu_G=VzZgJeZ1VZ3Qqr0g-f5s4ZE2Cm6=Q=D+v=dOw@mail.gmail.com>
	<88E590DC4586974D825FC82AE798294E520DFD5C@GSVCLU04.ges.ferlan.it>
	<CA+zYriROSa_jiSnXd_JPyWZT_ji_4ymQLxekKR9o6vNyw5Nc9Q@mail.gmail.com>
Message-ID: <4F16C153.9060307@rabbitmq.com>

Hi Steven,

On 18/01/12 12:34, Steven Taylor wrote:
> I tried with publication address which is there for convenience method
> if I remember correctly and also reply-to.  The info just isn't turning
> up in the subscriber.  It is set successfully in the publisher.  No
> exceptions.

To solve this issue can you supply a minimal example that exhibits the
faulty behaviour?

Another useful diagnostic aid is to connect to the broker via the
protocol tracer, or to observe the network traffic with Wireshark (which
has an AMQP protocol analyser). This will confirm whether the producer,
broker or consumer are at fault.



-Emile

From mnkpdon.32 at gmail.com  Wed Jan 18 13:39:59 2012
From: mnkpdon.32 at gmail.com (mayank)
Date: Wed, 18 Jan 2012 05:39:59 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ subricption closing
Message-ID: <f2ebd401-8d6c-4800-a1a8-6c47720fcee1@o12g2000vbd.googlegroups.com>

Hi

I have written a windows service which subscribes to a RabbitMQ queue.
The process creates object of Subscription class and waits for
messages to arrive. This is the bit of code I am talking about :

using (_subscription = new Subscription(_channel, _queue, false))
            {
                foreach (BasicDeliverEventArgs e in _subscription)
                {
                    yield return e;
                }
            }

I all works fine when I am running it in development and testing
environment.  But when I am deploying the same windows service in
production which has rabbitmq deployed as cluster of 2 nodes with HA
queues, the channel is getting closed and the service stops if there
is considerable(around an hour) idle time on the queues. If there
messages being published to queues continuously, it works fine. I was
wondering if this has to do with some RabbitMQ configuration(allowed
idle time for channel or queue)  ?

Thanks
Mayank

From emile at rabbitmq.com  Wed Jan 18 13:54:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Jan 2012 13:54:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ subricption closing
In-Reply-To: <f2ebd401-8d6c-4800-a1a8-6c47720fcee1@o12g2000vbd.googlegroups.com>
References: <f2ebd401-8d6c-4800-a1a8-6c47720fcee1@o12g2000vbd.googlegroups.com>
Message-ID: <4F16CF0F.7020201@rabbitmq.com>

Hi,

On 18/01/12 13:39, mayank wrote:

> I all works fine when I am running it in development and testing
> environment.  But when I am deploying the same windows service in
> production which has rabbitmq deployed as cluster of 2 nodes with HA
> queues, the channel is getting closed and the service stops if there
> is considerable(around an hour) idle time on the queues. If there
> messages being published to queues continuously, it works fine. I was
> wondering if this has to do with some RabbitMQ configuration(allowed
> idle time for channel or queue)  ?

Is the channel being closed with an error? Does anything get logged in
the broker logfile? If the network configuration differs between the two
environments then you might try to enable AMQP heartbeats to prevent and
detect timeouts.



-Emile

From kbaltrinic at bericotechnologies.com  Wed Jan 18 15:22:27 2012
From: kbaltrinic at bericotechnologies.com (Ken Baltrinic)
Date: Wed, 18 Jan 2012 07:22:27 -0800 (PST)
Subject: [rabbitmq-discuss] app_stop fails on RHEL SE-Linux
In-Reply-To: <4F169CE6.6090707@rabbitmq.com>
References: <e4fd9427-90d6-4193-b613-34dafd9ad2a7@l16g2000vbl.googlegroups.com>
	<4F169CE6.6090707@rabbitmq.com>
Message-ID: <8ae4ad8d-eaa8-4060-bfee-f8d576f40a42@o9g2000yqa.googlegroups.com>

Doh!  Okay I feel stupid.  With all the obscure issues you can run
into on DoDISS, I guess I forgot to look for the obvious. :)

I now have clustering working but... if I try to uncluster the servers
it looks like I am getting bitten by that broken "invalid command"
that simon spoke of.  Can anyone figure out what is going on in the
below command transcript?  This is not too important.  I only need to
uncluster for testing purposes and these are VMs and I have a pre-
cluster snapshot I can roll back to, but still, it seems like
something is amiss and thats a little worrisome.

Starting with a successfully clustered server pair rabbit1 and rabbit2
(both disk nodes):

[root at rabbit1 usr]# rabbitmqctl stop_app
Stopping node rabbit at rabbit1 ...
...done.
[root at rabbit1 usr]# rabbitmqctl reset
Resetting node rabbit at rabbit1 ...
...done.
[root at rabbit1 usr]# rabbitmqctl start_app
Starting node rabbit at rabbit1 ...
Error: {cannot_start_application,rabbitmq_management,
           {bad_return,
               {{rabbit_mgmt_app,start,[normal,[]]},
                {'EXIT',
                    {shutdown,
                        {gen_server2,call,
                            [<5135.22427.3>,
                             {init,<5135.22425.3>},
                             infinity]}}}}}}

If it matters, the only plugins that are enabled are
rabbitmq_management and its dependencies.


On Jan 18, 5:20?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Ken,
>
> On 17/01/12 17:27, Ken Baltrinic wrote:
>
> > sh-3.2# rabbitmqctl app_stop
>
> The command should be "stop_app".
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From daverstevens at gmail.com  Wed Jan 18 16:24:14 2012
From: daverstevens at gmail.com (Dave Stevens)
Date: Wed, 18 Jan 2012 08:24:14 -0800 (PST)
Subject: [rabbitmq-discuss] 404,
	"NOT_FOUND - no queue 'foo' in vhost '/'"
In-Reply-To: <CB166107.2507D%mpietrek@skytap.com>
References: <CB166107.2507D%mpietrek@skytap.com>
Message-ID: <253aa322-eae5-48a1-bcbb-a34d49eaa65d@v14g2000vbc.googlegroups.com>

I'm having a similar issue with 2.7.1 installed on ubuntu.

I'm running a cluster of three nodes. I have three consumers consuming
from a non-mirrored, non-exclusive queue. When I take down the node
containing the queue with rabbitmqctl stop_app, occasionally one of
the clients receives the following when attempting to reconnect and re-
declare the queue.

{#method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no
queue 'foo' in vhost '/', class-id=50, method-id=10),null,""}

Is this a race condition caused by the clients all trying to redeclare
the queue at the same time? I'm using the spring-amqp java client,
although I'm probably going to ditch it soon for other reasons.

On Dec 20 2011, 6:58?pm, Matt Pietrek <mpiet... at skytap.com> wrote:
> Indeed! In my hour or so of testing I just did, 2.7.1 seems much happier,
> and appears to handle VIP failover reasonably well in my scenario.
>
> Thanks much!
>
> Matt
>
> On 12/20/11 3:12 PM, "Matthias Radestock" <matth... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
>
>
> >On 20/12/11 22:44, Matt Pietrek wrote:
> >> In addition, in the rabbit@<nodename>.log, I see a whole bunch of spew,
> >> including many instances of this:
>
> >> =WARNING REPORT==== 20-Dec-2011::14:09:17 ===
> >> Non-AMQP exit reason '{{{function_clause,
> >> [{gb_trees,lookup,
> >> [<<150,83,52,247,194,247,140,35,130,167,168,
> >> 35,224,203,183,186>>,
> >> {dict,0,16,16,8,80,48,
> >> {[],[],[],[],[],[],[],[],[],[],[],[],[],
> >> [],[],[]},
> >> {{[],[],[],[],[],[],[],[],[],[],[],[],
> >> [],[],[],[]}}}]},
> >> {rabbit_amqqueue_process,
> >> '-confirm_messages/2-fun-0-',2},
> >> [...]
> >> Again, this is a stock 2.7.0 install.
>
> >The above got fixed in 2.7.1.
>
> >Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From daverstevens at gmail.com  Wed Jan 18 16:32:04 2012
From: daverstevens at gmail.com (Dave Stevens)
Date: Wed, 18 Jan 2012 08:32:04 -0800 (PST)
Subject: [rabbitmq-discuss] 404,
	"NOT_FOUND - no queue 'foo' in vhost '/'"
In-Reply-To: <253aa322-eae5-48a1-bcbb-a34d49eaa65d@v14g2000vbc.googlegroups.com>
References: <CB166107.2507D%mpietrek@skytap.com>
	<253aa322-eae5-48a1-bcbb-a34d49eaa65d@v14g2000vbc.googlegroups.com>
Message-ID: <069c164a-6ac6-4dc8-86d8-24f67eb36ccb@m4g2000vbc.googlegroups.com>

It is important to note that the queue is durable. I just read after
sending this that none of the clients should have been allowed to
reconnect. I'm curious why two out of the three clients were able to
come up when they apparently should have also received the same error.
I will experiment some more with this knowledge about how durable
queues work. I originally wrote this assuming we would be using HA
queues and I have them on my brain...

On Jan 18, 11:24?am, Dave Stevens <daverstev... at gmail.com> wrote:
> I'm having a similar issue with 2.7.1 installed on ubuntu.
>
> I'm running a cluster of three nodes. I have three consumers consuming
> from a non-mirrored, non-exclusive queue. When I take down the node
> containing the queue with rabbitmqctl stop_app, occasionally one of
> the clients receives the following when attempting to reconnect and re-
> declare the queue.
>
> {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no
> queue 'foo' in vhost '/', class-id=50, method-id=10),null,""}
>
> Is this a race condition caused by the clients all trying to redeclare
> the queue at the same time? I'm using the spring-amqp java client,
> although I'm probably going to ditch it soon for other reasons.
>
> On Dec 20 2011, 6:58?pm, Matt Pietrek <mpiet... at skytap.com> wrote:
>
>
>
>
>
>
>
> > Indeed! In my hour or so of testing I just did, 2.7.1 seems much happier,
> > and appears to handle VIP failover reasonably well in my scenario.
>
> > Thanks much!
>
> > Matt
>
> > On 12/20/11 3:12 PM, "Matthias Radestock" <matth... at rabbitmq.com> wrote:
>
> > >On 20/12/11 22:44, Matt Pietrek wrote:
> > >> In addition, in the rabbit@<nodename>.log, I see a whole bunch of spew,
> > >> including many instances of this:
>
> > >> =WARNING REPORT==== 20-Dec-2011::14:09:17 ===
> > >> Non-AMQP exit reason '{{{function_clause,
> > >> [{gb_trees,lookup,
> > >> [<<150,83,52,247,194,247,140,35,130,167,168,
> > >> 35,224,203,183,186>>,
> > >> {dict,0,16,16,8,80,48,
> > >> {[],[],[],[],[],[],[],[],[],[],[],[],[],
> > >> [],[],[]},
> > >> {{[],[],[],[],[],[],[],[],[],[],[],[],
> > >> [],[],[],[]}}}]},
> > >> {rabbit_amqqueue_process,
> > >> '-confirm_messages/2-fun-0-',2},
> > >> [...]
> > >> Again, this is a stock 2.7.0 install.
>
> > >The above got fixed in 2.7.1.
>
> > >Matthias.
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From roberts.john at gmail.com  Wed Jan 18 17:16:22 2012
From: roberts.john at gmail.com (jrob)
Date: Wed, 18 Jan 2012 09:16:22 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ HA
In-Reply-To: <167F935B-26B4-429E-8756-413BF8B036A2@gmail.com>
References: <4F0F18BB.7080508@gmail.com>
	<CACOPnvfhbpPdKrNhyE5bbeowBhWeMi+W3wM+Vt5hs0a9PenkZA@mail.gmail.com>
	<11354968.2215.1326848670369.JavaMail.geo-discussion-forums@prdv33>
	<21871097.2232.1326849301680.JavaMail.geo-discussion-forums@prfc16>
	<167F935B-26B4-429E-8756-413BF8B036A2@gmail.com>
Message-ID: <24684219.1780.1326906982618.JavaMail.geo-discussion-forums@prlk31>

Yup, that was it exactly.  I just had the diff up, so here are the two 
major changes I had to make:

-    channel.queue( @queue, :durable => true ).subscribe(:ack=>true) do 
|header,message|
+    channel.queue( @queue, :durable => true, :arguments => {'x-ha-policy' 
=> 'all'} ).subscribe(:ack=>true) do |header,message|

   def self.get_channel(host)
     connection = AMQP.connect( :host=>host )
+    connection.on_connection_interruption do |conn, settings|
+      conn.reconnect(false,1)
+    end
+
     channel    = AMQP::Channel.new( connection )
+    channel.auto_recovery = true
+
+    channel
   end

As I said, this hasn't gone into production yet, but it seems to be doing 
well in our staging environment.  I don't think our message rate is high 
enough to really exercise this setup in staging, so I can't really comment 
on performance yet.  (We're holding off moving this into production as we 
are trying to provide high availability for our applications and services 
across the board, which in some cases means we will be using one VM for 
multiple services.  Since the other services aren't ready to go yet, we 
haven't pushed this up.)

- jrob

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/63fd7f23/attachment.htm>

From roberts.john at gmail.com  Wed Jan 18 17:19:41 2012
From: roberts.john at gmail.com (jrob)
Date: Wed, 18 Jan 2012 09:19:41 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ subricption closing
In-Reply-To: <f2ebd401-8d6c-4800-a1a8-6c47720fcee1@o12g2000vbd.googlegroups.com>
References: <f2ebd401-8d6c-4800-a1a8-6c47720fcee1@o12g2000vbd.googlegroups.com>
Message-ID: <8914180.2455.1326907181100.JavaMail.geo-discussion-forums@prmu37>

I saw a similar error when connecting to nodes through a proxy, which 
automatically timed out the connection after 2 minutes.  The AMQP gem I use 
allows me to set up reconnection logic in the event of a disconnection, 
does your client library allow for the same?

- jrob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/63580b0f/attachment.htm>

From jerryk at vmware.com  Wed Jan 18 18:53:34 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 18 Jan 2012 10:53:34 -0800 (PST)
Subject: [rabbitmq-discuss] Lost messages in cluster
In-Reply-To: <33157833.post@talk.nabble.com>
Message-ID: <bed11f07-ea23-4c32-94ff-b9b6a2c411dd@strongmad.batnest.org>

Hi, st0rm...

I'm a bit confused by parts of your post...  Could we walk through
your configuration a bit so that I might get a handle on what you're
doing and what you're having trouble with?

> I have a cluster with 4 disk nodes. Topology is similar to
> many-to-many:

When you say the "topology" in this context, what do you mean exactly?

> The only exchange distributed over all nodes.

Exchanges in a clustered RabbitMQ environment are recorded in the
Mnesia database that's distributed amongst the nodes that participate
in the cluster, so in some sense any exchange in a cluster is always
"distributed over all nodes."  Note that the exchange is basically
static data in Mnesia; all of the active work done in routing messages
through exchanges actually happens on a channel process associated
with a connection, as there's no exchange process per se.

> Two
> queues(one of them is durable) declared per node and bound to above
> mentioned exchange. So each node is able to publish messages and they
> will be delivered to other nodes of cluster.

Are you using the new HA/mirrored-queues feature, and have declared
replication of queues across cluster nodes explicitly? Or are you
using "regular" clustering of the older type? If the latter then the
queue processes and queue contents will 'really' live only on a single
node in the cluster, although of course they can be published by, or
delivered to clients who happen to be connected to any node in the
cluster.

> Recently I've discovered some problems when I have network failures.
> If node lose network connection (or network device is down) for
> approx. 1 minute ( or net_ticktime period of time), this node doesn't
> receive message that were published to exchange while network was
> down.

By "node" do you mean one of your producers or consumers, or one of
the Rabbit cluster members? If you mean a Rabbit cluster member then
you can't publish to, or consume from, a queue as long as the node on
which it lives is down. If you use the new active-active,
mirrored-queues HA system then you can specify that a queue be
replicated across multiple nodes in a cluster, and the loss of the
master queue replica leads to one of the replicated slaves taking
over.  There's also an older active-passive HA system where you use
something like Pacemaker to switch over from a failed cluster node to
a hot standby, that was sharing storage with its backup brethren.

> I've read that "RabbitMQ clustering does not tolerate network partions
> well".

When people say that, they usually mean that the Mnesia database that
holds the metadata defining queues, bindings, exchanges and the like
doesn't handle partitions well, as a Rabbit cluster relies on a
consistent view of this information to do its work sensibly.  Hence,
we don't try to Rabbit cluster over wide areas and high latency or low
reliability links, because those don't play well with the assumptions
that Mnesia's design makes.

> I suppose that federation plugin can help me, but I can't
> understand what network topology have to be built to preserve current
> functionality - what upstreams should exist and etc.

Again I'm a bit confused when you say "network topology."  One often
uses the Federation or Shovel plugins to bridge between brokers (or
clusters of brokers) over a potentially high-latency, and low
reliability WAN connection, typically between geographically disparate
locations.  Is this the scenario you have, i.e. brokers or clusters
thereof in geographically separate datacenters?  If so, the first
task is to identify which parts of your message traffic you need
moved from one site to the other and think through the setup of your
federations or shovels from that starting point...

> Could somebody help me to avoid losing messages?

Answering this fully depends on what potential causes of message loss
you want to immunize yourself against.  If you're worried about the
failure of a cluster node on which a queue resides rendering that
queue unavailable, your options are either:

  - the new active/active mirrored queues HA

  - the old active/passive system with shared storage and something
    like Pacemaker handling the failover

If you need messages to be moved over potentially high latency or
flaky WAN links, then you want to consider Shovel or Federation for
bridging the wild network waters between the islands on which your
clusters live.

Both are documented on the RabbitMQ website, and the latter is
discussed in the Manning book "RabbitMQ in Action" (currently
available as a preview eBook, final print version due out later this
Spring).

Does this help at all?

Best regards,
Jerry

From james.poole at rsa.com  Wed Jan 18 20:52:51 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Wed, 18 Jan 2012 15:52:51 -0500
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
 under Load
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6005@MX36A.corp.emc.com>
	<b5bb2957-b046-4f4e-ad4f-af0d6d55d842@StrongMad.local> 
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6E47@MX36A.corp.emc.com>

Has anyone had a chance to investigate this crash?  I can re-send the repro source files if needed.

Thanks,
James

-----Original Message-----
From: Poole, James 
Sent: Friday, January 13, 2012 3:45 PM
To: Kuch, Jerry (VMware)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

Jerry,

I have modified the EmitLog.java and ReceiveLogs.java from the tutorials on the website to reproduce the crash (attached).  If the mailing list strips these attachments out, just ping me if anyone wants a copy and I'll send them directly.

Both files will need to be modified to change the address on the factory.setHost() call to your specific broker, and you will need to pass the path to a 2 MB+ file as an argument to the EmitLog process.

Thanks for looking into this.

-James



-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

James:  Out of curiousity have you tried the new 64-bit release of Erlang for Windows in your environment?  The address space size limitations of the 32-bit version have been associated with crashy Rabbits in the past (although bringing your memory high watermark value down so that the back-pressure mechanisms engage when the broker is in less trouble may help).  I think you can scare up the new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on 64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine and a virtualized one, with one showing a "clean" Erlang VM crash and the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a large or proprietary app, or can you extract a bare minimum piece of code that brings the pain and share it with us?  If you could do the latter we could more easily investigate the situation within VMware since the difference in behavior between baremetal and virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/0562966d/attachment.bin>

From jerryk at vmware.com  Wed Jan 18 21:08:41 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 18 Jan 2012 13:08:41 -0800 (PST)
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens
	under Load
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E35F6E47@MX36A.corp.emc.com>
Message-ID: <78dee82e-9c95-4ff2-b869-9ff03bda3a4c@strongmad.batnest.org>

Hi, James...

Sorry, not yet meaningfully but it's on my list to hopefully get
to in the next couple of days...

Jerry

----- Original Message -----
From: "James Poole" <james.poole at rsa.com>
To: "James Poole" <james.poole at rsa.com>, "Jerry Kuch (VMware)" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 18, 2012 12:52:51 PM
Subject: RE: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

Has anyone had a chance to investigate this crash?  I can re-send the repro source files if needed.

Thanks,
James

-----Original Message-----
From: Poole, James
Sent: Friday, January 13, 2012 3:45 PM
To: Kuch, Jerry (VMware)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

Jerry,

I have modified the EmitLog.java and ReceiveLogs.java from the tutorials on the website to reproduce the crash (attached).  If the mailing list strips these attachments out, just ping me if anyone wants a copy and I'll send them directly.

Both files will need to be modified to change the address on the factory.setHost() call to your specific broker, and you will need to pass the path to a 2 MB+ file as an argument to the EmitLog process.

Thanks for looking into this.

-James



-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Wednesday, January 11, 2012 1:44 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under Load

James:  Out of curiousity have you tried the new 64-bit release of Erlang for Windows in your environment?  The address space size limitations of the 32-bit version have been associated with crashy Rabbits in the past (although bringing your memory high watermark value down so that the back-pressure mechanisms engage when the broker is in less trouble may help).  I think you can scare up the new Erlang here:

http://www.erlang.org/download/otp_win64_R15B.exe

Until recently there was no 64-bit Erlang, so even those running on 64-bit Windows boxes were still relegated to 32-bit VMs.

I am curious about the different results between a physical machine and a virtualized one, with one showing a "clean" Erlang VM crash and the other exhibiting a blue-screen, fatal OS-wrecker...

Is the traffic you're using to bring these systems down part of a large or proprietary app, or can you extract a bare minimum piece of code that brings the pain and share it with us?  If you could do the latter we could more easily investigate the situation within VMware since the difference in behavior between baremetal and virtualization is disquieting...

Best regards,
Jerry

----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, January 11, 2012 10:32:23 AM
Subject: [rabbitmq-discuss] Windows RabbitMQ Crashes and Blue Screens under	Load





We?ve let loose one of our testing ninjas on RabbitMQ for load testing, and we?re consistently running into issues when the high memory watermark is hit.



Windows Server 2003 32-bit , Erlang R15B 32-bit, Rabbit 2.7.1



2,000 Consumers each with their own queue bound to a direct exchange

1 Producer, publishing a 2 MB message to the exchange, once every second, for a total of 50 seconds



Everything behaves as expected, until the memory footprint hits the high watermark, at which point:

On a physical machine: ERL process crashes and dump file is created

On a Virtual Machine: Blue Screen of Death is shown and server reboots



VM environment = VMware, Inc.? vCenter Lab Manager 4.0 (4.0.3.1318) 



One other note is that we see the same problem with ERL R14B04 and Rabbit 2.7.0.



I have looked through the log file and also turned on the console debug output, and nothing seems to be jumping out as an error. If needed, I can upload the minidump from the Blue Screen and the ERL crash dump file, just point me where to do it.



Let me know if there is anything else I can do to try and help get this fixed.







In the rabbit log, there are no errors, and only a few warnings 20 seconds before the crash:



=INFO REPORT==== 11-Jan-2012::10:55:53 ===

closing TCP connection <0.4405.0> from 10.6.64.104:57830



=WARNING REPORT==== 11-Jan-2012::10:55:53 ===

exception on TCP connection <0.20552.0> from 10.6.64.104:59521

connection_closed_abruptly





In the console output log file for the physical machine, this is the only message I see:



starting direct_client ...done

starting notify cluster nodes ...done



broker running

Eshell V5.9 (abort with ^G)

(rabbit at QEDLP082)1>

Crash dump was written to: C:/Documents and Settings/Administrator.QEDLP/Application Data/RabbitMQ/erl_crash.dump

eheap_alloc: Cannot allocate 6731340 bytes of memory (of type "heap").

in message_loop

win32sysinfo:Erlang has closed.




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From iain.hull at workday.com  Wed Jan 18 21:59:45 2012
From: iain.hull at workday.com (Iain Hull)
Date: Wed, 18 Jan 2012 15:59:45 -0600
Subject: [rabbitmq-discuss] Acked Message getting redelivered
Message-ID: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com>

Hi,

 

We are using RabbitMQ 2.5.1 with the java client.  Our application
requires at quite reliable at most once delivery QoS Semantics. We
achieve this by using persistent messages and calling basic_ack just
before processing each message (using the channel that delivered the
message).  If the ack fails we discard the message and try the next
message from the consumers internal in memory queue.  If a channel or
connection is closed, a management thread re-establishes the channel or
connection and reconnects the consumer asynchronously, so all unacked
messages get redelivered to the consumer.  The original version of these
messages might still be in the consumers internal queue, but since we
try to ack them before processing they will be silently ignored.

 

The problem is some messages are getting processed twice.  This means
that a message that is acked successfully by the client is getting
redelivered when the connection drops at the same time as the ack.  We
currently have some network conditions that we haven't figured out yet
that cause the connection to drop every 15 minutes.  When this happens
the message sometimes gets redelivered to consumer on a different
system.

 

I have attached a network diagram to explain our topology.  We have two
rabbitmq boxed in a cluster, but they are not involved in any HA or
automatic failover.  Failover is handled by the clients on the producer
and consumer systems.  The queues and exchanges are duplicated across
each server (with a server identifier added).  We have multiple producer
systems each connecting to one rabbitmq server (chosen at random).
There are two ESB servers forming a cluster that consume the messages
from the queues on both rabbitmq servers.  The consumers on each ESB
merge the queues from each rabbitmq server and present it as one queue
to the application layer.  The application layer does not get the
message until after it is acked. 

 

Obviously we have to fix our network issues.  However we would also like
to understand how we can process messages twice when a connection drops.
Is the ack asynchronous? Or is there a chance of a race condition when a
connection is dropped during an ack where the client considers the
message acked but the server does not?  Or does this look like a bug?

 

I haven't yet made a small application to reproduce this but should be
able to if required.

 

Regards,

Iain.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/18dbeb3c/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rabbit_Topology.png
Type: image/png
Size: 19483 bytes
Desc: Rabbit_Topology.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120118/18dbeb3c/attachment.png>

From ekirpichov at gmail.com  Wed Jan 18 22:05:57 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 19 Jan 2012 02:05:57 +0400
Subject: [rabbitmq-discuss] Acked Message getting redelivered
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com>

Hi Iain,

Acks are indeed asynchronous.

On Thu, Jan 19, 2012 at 1:59 AM, Iain Hull <iain.hull at workday.com> wrote:

> Hi,****
>
> ** **
>
> We are using RabbitMQ 2.5.1 with the java client.  Our application
> requires at quite reliable at most once delivery QoS Semantics. We achieve
> this by using persistent messages and calling basic_ack just before
> processing each message (using the channel that delivered the message).  If
> the ack fails we discard the message and try the next message from the
> consumers internal in memory queue.  If a channel or connection is closed,
> a management thread re-establishes the channel or connection and reconnects
> the consumer asynchronously, so all unacked messages get redelivered to the
> consumer.  The original version of these messages might still be in the
> consumers internal queue, but since we try to ack them before processing
> they will be silently ignored.****
>
> ** **
>
> The problem is some messages are getting processed twice.  This means that
> a message that is acked successfully by the client is getting redelivered
> when the connection drops at the same time as the ack.  We currently have
> some network conditions that we haven?t figured out yet that cause the
> connection to drop every 15 minutes.  When this happens the message
> sometimes gets redelivered to consumer on a different system.****
>
> ** **
>
> I have attached a network diagram to explain our topology.  We have two
> rabbitmq boxed in a cluster, but they are not involved in any HA or
> automatic failover.  Failover is handled by the clients on the producer and
> consumer systems.  The queues and exchanges are duplicated across each
> server (with a server identifier added).  We have multiple producer systems
> each connecting to one rabbitmq server (chosen at random).  There are two
> ESB servers forming a cluster that consume the messages from the queues on
> both rabbitmq servers.  The consumers on each ESB merge the queues from
> each rabbitmq server and present it as one queue to the application layer.
> The application layer does not get the message until after it is acked. **
> **
>
> ** **
>
> Obviously we have to fix our network issues.  However we would also like
> to understand how we can process messages twice when a connection drops.
>  Is the ack asynchronous? Or is there a chance of a race condition when a
> connection is dropped during an ack where the client considers the message
> acked but the server does not?  Or does this look like a bug?****
>
> ** **
>
> I haven?t yet made a small application to reproduce this but should be
> able to if required.****
>
> ** **
>
> Regards,****
>
> Iain.****
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/26cf4255/attachment.htm>

From u2.storm at gmail.com  Wed Jan 18 23:03:26 2012
From: u2.storm at gmail.com (Artsiom Gulin)
Date: Thu, 19 Jan 2012 02:03:26 +0300
Subject: [rabbitmq-discuss] Lost messages in cluster
In-Reply-To: <bed11f07-ea23-4c32-94ff-b9b6a2c411dd@strongmad.batnest.org>
References: <bed11f07-ea23-4c32-94ff-b9b6a2c411dd@strongmad.batnest.org>
Message-ID: <4F174FBE.50301@gmail.com>

Hello, Jerry.

> When you say the "topology" in this context, what do you mean exactly?
I mean a set of brokers, exchanges and queues and relations between them.

> Are you using the new HA/mirrored-queues feature, and have declared
> replication of queues across cluster nodes explicitly? Or are you
> using "regular" clustering of the older type? If the latter then the
> queue processes and queue contents will 'really' live only on a single
> node in the cluster, although of course they can be published by, or
> delivered to clients who happen to be connected to any node in the
> cluster.
Not, I dont use mirrored queues.

> By "node" do you mean one of your producers or consumers, or one of
> the Rabbit cluster members? If you mean a Rabbit cluster member then
> you can't publish to, or consume from, a queue as long as the node on
> which it lives is down. If you use the new active-active,
> mirrored-queues HA system then you can specify that a queue be
> replicated across multiple nodes in a cluster, and the loss of the
> master queue replica leads to one of the replicated slaves taking
> over.  There's also an older active-passive HA system where you use
> something like Pacemaker to switch over from a failed cluster node to
> a hot standby, that was sharing storage with its backup brethren.
Each node is physical/virtual machine with installed rabbitmq broker,
consumer and producer. Consumer and producer always connect to local broker.
Consumer receives messages only from queues that were declared on local 
broker.
Producer publishes messages to fanout exchange to which all queues are 
bound.

> Answering this fully depends on what potential causes of message loss
> you want to immunize yourself against.  If you're worried about the
> failure of a cluster node on which a queue resides rendering that
> queue unavailable, your options are either:
>
>    - the new active/active mirrored queues HA
>
>    - the old active/passive system with shared storage and something
>      like Pacemaker handling the failover
>
> If you need messages to be moved over potentially high latency or
> flaky WAN links, then you want to consider Shovel or Federation for
> bridging the wild network waters between the islands on which your
> clusters live.
>
> Both are documented on the RabbitMQ website, and the latter is
> discussed in the Manning book "RabbitMQ in Action" (currently
> available as a preview eBook, final print version due out later this
> Spring).
>
> Does this help at all?
Number of brokers is unlimited.
All brokers are in the same datacenter, but any broker may become
unavailable to others. And if that period of time is less than net_ticktime,
queue, declared on that broker, misses messages.

I tried to use active/active mirrored queues, declaring them
with "x-ha-policy" = "all" and faced some unpleasant issue:
If any node become unavailable, the command
# rabbitmqctl list_queues
hangs and I cant get any information.

Thats why I looked at federation plugin.

I'll continue playing with HA queues and hope this solution will help
to solve my problem. I will keep you informed of the results of my 
experiments.

--
Best regards,
Artsiom



From jerryk at vmware.com  Thu Jan 19 00:48:36 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 18 Jan 2012 16:48:36 -0800 (PST)
Subject: [rabbitmq-discuss] Lost messages in cluster
In-Reply-To: <4F174FBE.50301@gmail.com>
Message-ID: <25cd13fb-515c-4817-8b51-3855869124cb@strongmad.batnest.org>

Hi, Artsiom:

> I mean a set of brokers, exchanges and queues and relations between them.

Gotcha.  Sometimes it's helpful to keep the actual network topology of
the brokers and how the networks connect them mentally separate from
the implicit topology of exchanges, bindings, and queues that live
within the brokers, since, as we've seen earlier in this thread, they
often aren't quite the same thing, depending on how things are
configured. :-)

> Not, I dont use mirrored queues.

Gotcha.

> Each node is physical/virtual machine with installed rabbitmq broker,
> consumer and producer. Consumer and producer always connect to local
> broker.
> Consumer receives messages only from queues that were
> declared on local broker.  Producer publishes messages to fanout
> exchange to which all queues are bound.

So your consumers and producers live on the same machine as the broker
they're using and essentially use Rabbit as an IPC mechanism?  Or am I
misreading you?  As for the fanout exchanges into which you're
publishing, are you expecting messages pushed into them ever to be
seen on other hosts/nodes?  I'm trying to guess what the nature of
your application is and make sure I'm not misunderstanding you.  It
sounds from the above paragraph that you're not currently looking at a
clustering scenario at all?

> All brokers are in the same
> datacenter, but any broker may become unavailable to others. And if
> that period of time is less than net_ticktime, queue, declared on that
> broker, misses messages.

So at minimum you have a network environment that you believe is
sufficiently hostile or unreliable that you can't cluster your brokers
using the regular Rabbit/Erlang distribution mechanisms?

> I tried to use active/active mirrored queues, declaring them
> with "x-ha-policy" = "all" and faced some unpleasant issue:
> If any node become unavailable, the command
> # rabbitmqctl list_queues
> hangs and I cant get any information.

Ah, now *that* shouldn't be happening.  Which version of RabbitMQ were
you using and are you sure your cluster was set up OK?  Does the
broker appear to actually be alive and listening on port 5672 (the
default AMQP port; elsewhere if you've changed it).  Having
rabbitmqctl hang is generally a sign that something is misconfigured...

> Thats why I looked at federation plugin.

With federation you'd be able to have messages published to one broker
or cluster thereof automatically sent downstream to other
brokers/clusters.  If you're all in a single LAN type deployment this
may be overkill-ish for what you need.

Can you say a bit more about your application and what sorts of things
are communicating and what they're passing amongst one another?  Are
you sure clustering, with an appropriate HA solution, whether the
original active-passive or the new active-active definitely doesn't
meet your needs?

> I'll continue playing with HA queues and hope this solution will help
> to solve my problem. I will keep you informed of the results of my
> experiments.

Please do.  If I'm missing the structure of your intended use class,
please also disabuse me of my misunderstanding so I can try to help
more coherently... :-)

Best regards,
Jerry

From mspetrovic at gmail.com  Thu Jan 19 02:08:07 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Wed, 18 Jan 2012 18:08:07 -0800
Subject: [rabbitmq-discuss] Questions on consumerTags and basicConsume
In-Reply-To: <46FF6B11-88F6-4B04-BF55-10AF84ADF5C7@gmail.com>
References: <D92A9D1A-EE1F-4F4D-A6F1-2AFF2FD3F73B@gmail.com>
	<46FF6B11-88F6-4B04-BF55-10AF84ADF5C7@gmail.com>
Message-ID: <CABMnSbGVjLn72LxBAEDpHOxPmOnUFCQ-CoLUP7Ut+ySCxb9aVA@mail.gmail.com>

Thank you for the kind response.

I realize and understand now that

channel.basicConsume()

is called once per desired consumer registration.   In that sense I
wish the method were called something like

channel.registerConsumer()

which would have kept me from thinking that I need to call
basicConsume() more than once.

But, I got it now.  Thanks.

On Tue, Jan 17, 2012 at 11:10 PM, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
> Mark Petrovic:
>
>> - Is a consumer tag a token that should be unique on a per call basis to Java basic.Consume()? ?And what exactly is a consumer tag good for?
>>
>
> Consumer tag is a subscription identifier, applications use to cancel the subscription. AMQP clients use it to know what handler to use when messages are delivered.
> It has to be unique in the vhost you are using. There are versions of basicConsume that will generate consumer tag for you.
>
>> - I've seen some evidence that basic.Consume() does not block in the absence of messages to consume. Is that to be expected?
>
> basicConsume registers a consumer that rabbitmq will push messages to as soon as they are available in the queue. It is "push API".
> For "pull API" (fetching messages on demand), see basicGet.
>
> MK
>



-- 
Mark

From iain.hull at workday.com  Thu Jan 19 08:45:53 2012
From: iain.hull at workday.com (Iain Hull)
Date: Thu, 19 Jan 2012 02:45:53 -0600
Subject: [rabbitmq-discuss] Acked Message getting redelivered
In-Reply-To: <CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com>
References: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com>
	<CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>

Thanks Eugene,

From: Eugene Kirpichov [mailto:ekirpichov at gmail.com] 
> Acks are indeed asynchronous.

So this means that the only reliable way to implement "at most once
delivery" is to remember the messages uuids that you have processed,
which won't work for clustered consumers.  Is this correct or is there
another way to achieve this?

Regards,
Iain.

From Simone.Busoli at ferrari.com  Thu Jan 19 08:49:36 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 19 Jan 2012 08:49:36 +0000
Subject: [rabbitmq-discuss] Acked Message getting redelivered
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com><CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com>
	<925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520E0FAD@GSVCLU04.ges.ferlan.it>

As far as my experience goes it's correct, you have to implement it at a higher level.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Iain Hull
Sent: gioved? 19 gennaio 2012 09:46
To: Eugene Kirpichov
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Acked Message getting redelivered

Thanks Eugene,

From: Eugene Kirpichov [mailto:ekirpichov at gmail.com] 
> Acks are indeed asynchronous.

So this means that the only reliable way to implement "at most once delivery" is to remember the messages uuids that you have processed, which won't work for clustered consumers.  Is this correct or is there another way to achieve this?

Regards,
Iain.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From sophiewenxizhang at googlemail.com  Thu Jan 19 12:04:22 2012
From: sophiewenxizhang at googlemail.com (TZHA)
Date: Thu, 19 Jan 2012 04:04:22 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in
	production environment.
In-Reply-To: <CAAt2poJD20QZiebR+crY6OxxK4QZHRztjibwmCHwWjZFKYjeBw@mail.gmail.com>
References: <7f328139-e23a-4946-8932-fc728aad3021@a17g2000yqj.googlegroups.com>
	<CAAt2poJD20QZiebR+crY6OxxK4QZHRztjibwmCHwWjZFKYjeBw@mail.gmail.com>
Message-ID: <1a2bd242-be09-4c75-9b94-ba214b9b6cb1@a40g2000vbu.googlegroups.com>

Thanks for the reply.

I am now in the position to get the cancellation notification
following your advice.

On 17 Jan., 16:52, Alan Antonuk <alan.anto... at gmail.com> wrote:
> Responses inlined
>
> On Mon, Jan 16, 2012 at 5:02 AM, TZHA <sophiewenxizh... at googlemail.com>wrote:
>
>
>
>
>
>
>
>
>
> > Hi,
>
> > i am working with rabbitmq-c (downloaded from github/newest version -
> > cmake/VS2010 rebuild under windows) and would like to prepare a
> > rabbitmq/c/c++ based solution for a production environment.
>
> > However for a real application, we still have some reliability
> > requirements that are apparently not yet supported by rabbitmq-c.
>
> > The first requirement is to get ?cancellation notification? in case,
> > e.g. whenever a queue is down ? so that the client/consumer can
> > reconnect to the broker.
>
> > For this purpose ? as I understood, the client has to send ?the
> > ?client-capabilities? with
>
> > ? ...
> > ? consumer_cancel_notify = true,
> > ? publisher_confirms = true
>
> > For the consumer_cancel_notify - the client does need to tell the broker
>
> that it wants to turn this on.
>
> For the publisher_confirms - the client is not required to tell the broker
> to enable this. ?To enabled it on a channel you should send send a
> confirm.select to enable publisher_confirms for a channel. You can send the
> client capabilities to query the broker to see if it supports this
> extension before continuing connecting to a broker.
>
> For some more info how rabbit supports these extensions:http://www.rabbitmq.com/extensions.html
>
> for the connection setup. In ?case of of rabbitmq-c, I saw that one
>
> > shall set the capabilities in amqp_login (amqp_socket.c) ?method.
> > Current this is set to NULL.
>
> > ?amqp_connection_open_t s
> > ?s.capabilities.len = 0;
> > ?s.capabilities.bytes = NULL;
>
> The format of that field is I believe a shortstr. ?However that's not where
> you want to send capabilities. ?When you get the connection.start method
> from the broker, you need to examine the server-properties (which is a
> table) parameter to see if the broker supports the extensions you want.
> ?When you respond with a connection.start-ok, you need to put the
> extensions you want to enable in the client-properties parameter, which is
> also a table.
>
>
>
> > Can some expert tell me what kind of syntax can be used for the
> > s.capabilities.bytes field?
>
> > The next requirement is to receive publisher_confirms. I guess that
> > the client-capabilities is also a pre-condition, and I have to set the
> > ?mandatory? parameter for the amqp_basic_publish method to 1. Is there
> > anything else I have to set?
>
> In order to enable publisher confirms,
>
> You need to do the confirm.select (amqp_confirm_select(...) ) method on the
> channel you want to enable publisher confirms on.
> After which anytime you do a basic.publish, (amqp_basic_publish(...)) you
> will eventually get a basic.ack back from the broker once the message has
> been processed*.
> * Note: processed does not mean delivered, it just means that the broker
> received it and did something with it (routed to a queue, returned it,
> dropped it etc). ?If you want ensure that the message got routed a queue -
> send the mandatory flag. ?If the message isn't routed to a queue the
> message will returned to the client with a basic.return, then you will be a
> basic.ack.
>
> More information on publisher confirms:http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.confirm
> More information on the basic publish fields:http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish
> Finally an example client that leverages rabbitmq-c and uses publisher
> confirms:https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cp...
>
>
>
>
>
>
>
> > Thanks in advance for any advices.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Jan 19 12:16:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jan 2012 12:16:07 +0000
Subject: [rabbitmq-discuss] 404,
 "NOT_FOUND - no queue 'foo' in vhost '/'"
In-Reply-To: <069c164a-6ac6-4dc8-86d8-24f67eb36ccb@m4g2000vbc.googlegroups.com>
References: <CB166107.2507D%mpietrek@skytap.com>	<253aa322-eae5-48a1-bcbb-a34d49eaa65d@v14g2000vbc.googlegroups.com>
	<069c164a-6ac6-4dc8-86d8-24f67eb36ccb@m4g2000vbc.googlegroups.com>
Message-ID: <4F180987.9010106@rabbitmq.com>

On 18/01/12 16:32, Dave Stevens wrote:
> I just read after
> sending this that none of the clients should have been allowed to
> reconnect.

None of them should be allowed to declare the queue, yes. So if you can 
reliably reproduce this I'd like to hear from you...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan 19 12:33:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jan 2012 12:33:06 +0000
Subject: [rabbitmq-discuss] Acked Message getting redelivered
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com>	<CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com>
	<925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <4F180D82.4090204@rabbitmq.com>

On 19/01/12 08:45, Iain Hull wrote:
> From: Eugene Kirpichov [mailto:ekirpichov at gmail.com]
>> Acks are indeed asynchronous.
>
> So this means that the only reliable way to implement "at most once
> delivery" is to remember the messages uuids that you have processed,
> which won't work for clustered consumers.  Is this correct or is there
> another way to achieve this?

It sounds like you find losing messages slightly acceptable (certainly 
better than getting dups) and are thus only using acks because you are 
using qos. Is that right?

If so then the simple thing to do would be to just ignore (after acking) 
any messages which have the "redelivered" flag set.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Thu Jan 19 15:08:01 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 19 Jan 2012 19:08:01 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.9.1 is released
Message-ID: <8CC5148C-062E-44A8-9A77-4A483331BE93@gmail.com>

amqp gem 0.9.1 is released to rubygems.org [1].

This is a bug fix release:

* Channels that use publisher confirms now correctly keep track of the count of published messages

Have a good day.

1. https://rubygems.org/gems/amqp/versions/0.9.1


MK


From iain.hull at workday.com  Thu Jan 19 16:08:09 2012
From: iain.hull at workday.com (Iain Hull)
Date: Thu, 19 Jan 2012 10:08:09 -0600
Subject: [rabbitmq-discuss] Acked Message getting redelivered
In-Reply-To: <4F180D82.4090204@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com>	<CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com><925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>
	<4F180D82.4090204@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A3670567C829@34093-C5-EVS1.exchange.rackspace.com>

>It sounds like you find losing messages slightly acceptable (certainly 
>better than getting dups) and are thus only using acks because you are 
>using QoS. Is that right?
Yes in this case I would prefer to drop some (very small amount of)
messages
instead of getting dups.

>If so then the simple thing to do would be to just ignore (after
acking) 
>any messages which have the "redelivered" flag set.
This could work but we would have to reduce the channel prefetch down to
1, to ensure that each channel only lost one message when a connection
dies.  

Currently the channel's prefetch is 50 with a maybe 50 queues (each of
these are merged down to a single in memory queue - one per rabbitmq
host and one per tenant).  This queue could contain hundreds of
messages.  I would not like to lose all these messages when a connection
drops, One or two messages near the head would be ok however.
 
Regards,
Iain.

From iain.hull at workday.com  Thu Jan 19 16:17:09 2012
From: iain.hull at workday.com (Iain Hull)
Date: Thu, 19 Jan 2012 10:17:09 -0600
Subject: [rabbitmq-discuss] Acked Message getting redelivered
In-Reply-To: <88E590DC4586974D825FC82AE798294E520E0FAD@GSVCLU04.ges.ferlan.it>
References: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com><CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com>
	<925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>
	<88E590DC4586974D825FC82AE798294E520E0FAD@GSVCLU04.ges.ferlan.it>
Message-ID: <925DDDE9D69E7143B3252E2D4680A3670567C84E@34093-C5-EVS1.exchange.rackspace.com>

> As far as my experience goes it's correct, you have to implement it at a higher level.
Yes but this is hard when messages are consumed by a cluster, they would have to share a single store to track processed messages or use a local store and ensure that certain messages are only processed by specific hosts in the cluster.

-----Original Message-----
From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com] 
Sent: 19 January 2012 08:50
To: Iain Hull; Eugene Kirpichov
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] Acked Message getting redelivered

As far as my experience goes it's correct, you have to implement it at a higher level.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Iain Hull
Sent: gioved? 19 gennaio 2012 09:46
To: Eugene Kirpichov
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Acked Message getting redelivered

Thanks Eugene,

From: Eugene Kirpichov [mailto:ekirpichov at gmail.com] 
> Acks are indeed asynchronous.

So this means that the only reliable way to implement "at most once delivery" is to remember the messages uuids that you have processed, which won't work for clustered consumers.  Is this correct or is there another way to achieve this?

Regards,
Iain.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From pbell at syncsort.com  Thu Jan 19 16:17:59 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Thu, 19 Jan 2012 11:17:59 -0500
Subject: [rabbitmq-discuss] FW:  One Producer, Many Consumers,
 Many physical nodes
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447296@MAILCCR.us.syncsort.com>

Michael,

Thanks for the reply.

I have finished working through a few of the tutorials you referenced. Either I missed something or haven't yet gotten to the right tutorial.

You've told me that it's possible to leave a message in a queue, i.e., that a message can persist in its queue even after it has been received by a consumer. Can you tell me how this is done?

Also, such an approach suggests the need to explicitly delete the message from the queue. Is there a way to do this?

Cordially,

Paul

>Paul,

>Looking through the tutorials will obviate many further questions.

>On this specifically,

>> When a consumer pulls a message from the queue, is there a way to
>> leave that message in queue? If so, can queue elements be updated
>> in-place, e.g., with "status" info about the state of the work that
>> the message (task) represents?

>No. You can leave it in the queue, but you can't change it. You'd have to post another message.

>-Michael




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From videlalvaro at gmail.com  Thu Jan 19 16:24:12 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Jan 2012 17:24:12 +0100
Subject: [rabbitmq-discuss] FW: One Producer, Many Consumers,
 Many physical nodes
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447296@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447296@MAILCCR.us.syncsort.com>
Message-ID: <CAMcAHLWudN81AuaHaCVMxhiTgh4MN_=CShWvuBvexSTERY59oQ@mail.gmail.com>

Hi,

RE - Keeping messages:

RabbitMQ takes care of queueing messages, that is, of keeping them in
queues. The only thing you have to do as a user is publishing them.

RE - Deleting messages:

When the message is delivered to a consumer and then that messages is asked
back to the server, then the message is automatically deleted by RabbitMQ
(this is an oversimplification BTW, there are many options that might
modify message durability).

Regards,

Alvaro

On Thu, Jan 19, 2012 at 5:17 PM, Bell, Paul M. <pbell at syncsort.com> wrote:

> Michael,
>
> Thanks for the reply.
>
> I have finished working through a few of the tutorials you referenced.
> Either I missed something or haven't yet gotten to the right tutorial.
>
> You've told me that it's possible to leave a message in a queue, i.e.,
> that a message can persist in its queue even after it has been received by
> a consumer. Can you tell me how this is done?
>
> Also, such an approach suggests the need to explicitly delete the message
> from the queue. Is there a way to do this?
>
> Cordially,
>
> Paul
>
> >Paul,
>
> >Looking through the tutorials will obviate many further questions.
>
> >On this specifically,
>
> >> When a consumer pulls a message from the queue, is there a way to
> >> leave that message in queue? If so, can queue elements be updated
> >> in-place, e.g., with "status" info about the state of the work that
> >> the message (task) represents?
>
> >No. You can leave it in the queue, but you can't change it. You'd have to
> post another message.
>
> >-Michael
>
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted
> with this message) may contain proprietary, trade secret or other
>  confidential and/or legally privileged information. Any pricing
> information contained in this message or in any files transmitted with this
> message is always confidential and cannot be shared with any third parties
> without prior written approval from Syncsort. This message is intended to
> be read only by the individual or entity to whom it is addressed or by
> their designee. If the reader of this message is not the intended
> recipient, you are on notice that any use, disclosure, copying or
> distribution of this message, in any form, is strictly prohibited. If you
> have received this message in error, please immediately notify the sender
> and/or Syncsort and destroy all copies of this message in your possession,
> custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/8371d68f/attachment.htm>

From pbell at syncsort.com  Thu Jan 19 16:46:18 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Thu, 19 Jan 2012 11:46:18 -0500
Subject: [rabbitmq-discuss] FW: One Producer, Many Consumers,
 Manyphysical nodes
In-Reply-To: <CAMcAHLWudN81AuaHaCVMxhiTgh4MN_=CShWvuBvexSTERY59oQ@mail.gmail.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447296@MAILCCR.us.syncsort.com>
	<CAMcAHLWudN81AuaHaCVMxhiTgh4MN_=CShWvuBvexSTERY59oQ@mail.gmail.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044729C@MAILCCR.us.syncsort.com>

Thank you, Alvaro.

I had assumed (but Michael corrected me) that once a consumer retrieved a message, that message would disappear from the queue. Can you point me to examples/docs that show how to 1) cause a message to persist despite its retrieval by a consumer; 2) how explicitly to delete such a persisted message from a queue?

-Paul

PS: looking forward to your book. Any chance Amazon will have it before March?



From: Alvaro Videla [mailto:videlalvaro at gmail.com]
Sent: Thursday, January 19, 2012 11:24 AM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] FW: One Producer, Many Consumers, Manyphysical nodes

Hi,

RE - Keeping messages:

RabbitMQ takes care of queueing messages, that is, of keeping them in queues. The only thing you have to do as a user is publishing them.

RE - Deleting messages:

When the message is delivered to a consumer and then that messages is asked back to the server, then the message is automatically deleted by RabbitMQ (this is an oversimplification BTW, there are many options that might modify message durability).

Regards,

Alvaro

On Thu, Jan 19, 2012 at 5:17 PM, Bell, Paul M. <pbell at syncsort.com<mailto:pbell at syncsort.com>> wrote:
Michael,

Thanks for the reply.

I have finished working through a few of the tutorials you referenced. Either I missed something or haven't yet gotten to the right tutorial.

You've told me that it's possible to leave a message in a queue, i.e., that a message can persist in its queue even after it has been received by a consumer. Can you tell me how this is done?

Also, such an approach suggests the need to explicitly delete the message from the queue. Is there a way to do this?

Cordially,

Paul

>Paul,

>Looking through the tutorials will obviate many further questions.

>On this specifically,

>> When a consumer pulls a message from the queue, is there a way to
>> leave that message in queue? If so, can queue elements be updated
>> in-place, e.g., with "status" info about the state of the work that
>> the message (task) represents?

>No. You can leave it in the queue, but you can't change it. You'd have to post another message.

>-Michael




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/222679f7/attachment.htm>

From roshanbhave at gmail.com  Thu Jan 19 16:51:21 2012
From: roshanbhave at gmail.com (Roshan Bhave)
Date: Thu, 19 Jan 2012 11:51:21 -0500
Subject: [rabbitmq-discuss] {"Kernel pid terminated", application_controller,
	"{application_start_failure, rabbit, {bad_return, {{rabbit,
	start, [normal, []]}, {'EXIT', {rabbit, failure_during_boot}}}}}"}^
Message-ID: <CAA8Fy2xDDnG6T3OEAvXRoNtJnX4AcK5v6jWr+Y70KszyFmSGKg@mail.gmail.com>

Hey guys,

I'm having problems running RabbitMQ. I am using Centos 6.2

I have tried uninstalling and reinstalling (through yum), but the error
remains the same.

I have no rabbitmq.conf anywhere.

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
...done
starting database
...done
starting codec correctness check
...done
-- external infrastructure ready
starting plugin registry
...done
starting auth mechanism cr-demo
...done
starting auth mechanism amqplain
...done
starting auth mechanism plain
...done
starting statistics event manager
...done
starting logging server
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
...done
starting exchange type topic
...done
-- kernel ready
starting alarm handler
...done
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange, queue and binding recovery
...done
starting mirror queue slave sup
...done
starting adding mirrors to queues
...done
-- message delivery logic ready
starting error log relay
...done
starting networking
...BOOT ERROR: FAILED
Reason: {badmatch,
            {error,
                {shutdown,
                    {child,undefined,'rabbit_tcp_listener_sup_:::5672',
                        {tcp_listener_sup,start_link,
                            [{0,0,0,0,0,0,0,0},
                             5672,
                             [inet6,binary,
                              {packet,raw},
                              {reuseaddr,true},
                              {backlog,128},
                              {nodelay,true},
                              {exit_on_close,false}],

{rabbit_networking,tcp_listener_started,[amqp]},

{rabbit_networking,tcp_listener_stopped,[amqp]},
                             {rabbit_networking,start_client,[]},
                             "TCP Listener"]},
                        transient,infinity,supervisor,
                        [tcp_listener_sup]}}}}
Stacktrace: [{rabbit_networking,start_listener0,4},
             {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4},
             {rabbit_networking,start_listener,4},
             {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
             {rabbit_networking,boot_tcp,0},
             {rabbit_networking,boot,0},

{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1}]
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}^M


Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/c85e962e/attachment.htm>

From simon at rabbitmq.com  Thu Jan 19 16:54:56 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jan 2012 16:54:56 +0000
Subject: [rabbitmq-discuss] {"Kernel pid terminated",
 application_controller, "{application_start_failure, rabbit, {bad_return,
 {{rabbit, start, [normal, []]}, {'EXIT', {rabbit,
 failure_during_boot}}}}}"}^
In-Reply-To: <CAA8Fy2xDDnG6T3OEAvXRoNtJnX4AcK5v6jWr+Y70KszyFmSGKg@mail.gmail.com>
References: <CAA8Fy2xDDnG6T3OEAvXRoNtJnX4AcK5v6jWr+Y70KszyFmSGKg@mail.gmail.com>
Message-ID: <4F184AE0.6010009@rabbitmq.com>

This is a not very clear message indicating that port 5672 is already in 
use.

Are you running another AMQP broker? qpid? If so you can uninstall it, 
or put RabbitMQ on another port (see 
http://www.rabbitmq.com/configure.html#configuration-file)

Cheers, Simon

On 19/01/12 16:51, Roshan Bhave wrote:
> Hey guys,
>
> I'm having problems running RabbitMQ. I am using Centos 6.2
>
> I have tried uninstalling and reinstalling (through yum), but the error
> remains the same.
>
> I have no rabbitmq.conf anywhere.
>
> -- rabbit boot start
> starting file handle cache server
> ...done
> starting worker pool
> ...done
> starting database
> ...done
> starting codec correctness check
> ...done
> -- external infrastructure ready
> starting plugin registry
> ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism amqplain
> ...done
> starting auth mechanism plain
> ...done
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
> ...done
> starting exchange type topic
> ...done
> -- kernel ready
> starting alarm handler
> ...done
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting exchange, queue and binding recovery
> ...done
> starting mirror queue slave sup
> ...done
> starting adding mirrors to queues
> ...done
> -- message delivery logic ready
> starting error log relay
> ...done
> starting networking
> ...BOOT ERROR: FAILED
> Reason: {badmatch,
>              {error,
>                  {shutdown,
>                      {child,undefined,'rabbit_tcp_listener_sup_:::5672',
>                          {tcp_listener_sup,start_link,
>                              [{0,0,0,0,0,0,0,0},
>                               5672,
>                               [inet6,binary,
>                                {packet,raw},
>                                {reuseaddr,true},
>                                {backlog,128},
>                                {nodelay,true},
>                                {exit_on_close,false}],
>
> {rabbit_networking,tcp_listener_started,[amqp]},
>
> {rabbit_networking,tcp_listener_stopped,[amqp]},
>                               {rabbit_networking,start_client,[]},
> "TCP Listener"]},
>                          transient,infinity,supervisor,
>                          [tcp_listener_sup]}}}}
> Stacktrace: [{rabbit_networking,start_listener0,4},
>               {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4},
>               {rabbit_networking,start_listener,4},
>               {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
>               {rabbit_networking,boot_tcp,0},
>               {rabbit_networking,boot,0},
>
> {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>               {rabbit,run_boot_step,1}]
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}^M
>
>
> Thanks,
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From ts_venu at yahoo.com  Thu Jan 19 16:59:29 2012
From: ts_venu at yahoo.com (RabbitMQ_User)
Date: Thu, 19 Jan 2012 08:59:29 -0800 (PST)
Subject: [rabbitmq-discuss] Message Characters length more than 50000 are
 truncated
Message-ID: <33169185.post@talk.nabble.com>


Please let me know if any of you had this issue and possible solution of
truncated messages when the message characters size exceeded 50000.

I am using .NET Client to publish the message with BasicPublish method of
RabbitMQ.Client.IModel by passing in the message body as an byte[] array.

After successful publish, and view the Auto String/Base64 message from Web
UI Management Plugin it only shows 50000 characters and rest are truncated
nor have been written to the queue. 

Thanks.
-- 
View this message in context: http://old.nabble.com/Message-Characters-length-more-than-50000-are-truncated-tp33169185p33169185.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/f31205da/attachment.htm>

From steve at rabbitmq.com  Thu Jan 19 17:20:03 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 19 Jan 2012 17:20:03 +0000
Subject: [rabbitmq-discuss] Rabbitmq-C and SSL
Message-ID: <BD8927A5-4C06-489D-87B6-4BCAD65CB0C5@rabbitmq.com>

Avinash Kaul asks, on rabbitmq-info:

> Are there any efforts currently around adding SSL support to "rabbitmq-c"? We are planning to use that for our Linux SVMs, and since we absolutely need SSL, we are looking to use "Stunnel" as an SSL wrapper. However native SSL support would be highly desirable.

Is anyone out there working on rabbitmq-c and is there SSL? (*)

Steve Powell  (a query bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

(*) Stands the code rabbitmq-c?
And is there SSL for tea?
(Apologies to Rupert Brooke.)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/c4de1109/attachment.htm>

From static.void.dev at gmail.com  Thu Jan 19 17:25:19 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 19 Jan 2012 09:25:19 -0800
Subject: [rabbitmq-discuss] Database lag and delayed processing of messages
Message-ID: <4F1851FF.8070105@gmail.com>

Is there anyway I could configure an exchange/queue/consumer to 
route/deliver/consume a message in the future?

For example we have run into a situation whereas we produce a message 
for a record that was just inserted into our master database. When our 
consumer tries to act upon this message the record has not be replicated 
to the slaves yet so the message consumption fails. Is there any way we 
can queue up this message in say 5 seconds? Of course we could always 
requeue a failed consumed message but that would lead us to a situation 
where the we could be consume/producing in an infinite loop. How do 
people typically handle this situation?

Thanks

From simon at rabbitmq.com  Thu Jan 19 17:25:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jan 2012 17:25:26 +0000
Subject: [rabbitmq-discuss] Message Characters length more than 50000
 are truncated
In-Reply-To: <33169185.post@talk.nabble.com>
References: <33169185.post@talk.nabble.com>
Message-ID: <4F185206.2020305@rabbitmq.com>

On 19/01/12 16:59, RabbitMQ_User wrote:
> Please let me know if any of you had this issue and possible solution of
> truncated messages when the message characters size exceeded 50000. I am
> using .NET Client to publish the message with BasicPublish method of
> RabbitMQ.Client.IModel by passing in the message body as an byte[]
> array. After successful publish, and view the Auto String/Base64 message
> from Web UI Management Plugin it only shows 50000 characters and rest
> are truncated nor have been written to the queue. Thanks.

The *web UI* will truncate messages you've pulled from a queue to 50000 
bytes (basically so you don't crash your browser).

The HTTP API allows you to ask for messages to be truncated in this way 
(which is what the web UI does). Other HTTP API users can get the full 
message (although due to the way it's base 64 encoded and stuffed in 
JSON you probably don't want to receive huge messages this way).

Messages are not truncated in the queue, or in any other API.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ekirpichov at gmail.com  Thu Jan 19 17:25:34 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 19 Jan 2012 21:25:34 +0400
Subject: [rabbitmq-discuss] |Spam| Re:  Acked Message getting redelivered
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A3670567C829@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com>
	<CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com>
	<925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>
	<4F180D82.4090204@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A3670567C829@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <3AE576CB-5D3C-409B-9739-3F964065F00D@gmail.com>





19.01.2012, ? 20:08, "Iain Hull" <iain.hull at workday.com> ???????(?):

>> It sounds like you find losing messages slightly acceptable (certainly 
>> better than getting dups) and are thus only using acks because you are 
>> using QoS. Is that right?
> Yes in this case I would prefer to drop some (very small amount of)
> messages
> instead of getting dups.
> 
>> If so then the simple thing to do would be to just ignore (after
> acking) 
>> any messages which have the "redelivered" flag set.
> This could work but we would have to reduce the channel prefetch down to
> 1, to ensure that each channel only lost one message when a connection
> dies.  
Is this (1 message prefetch) a problem in your case?

> 
> Currently the channel's prefetch is 50 with a maybe 50 queues (each of
> these are merged down to a single in memory queue - one per rabbitmq
> host and one per tenant).  This queue could contain hundreds of
> messages.  I would not like to lose all these messages when a connection
> drops, One or two messages near the head would be ok however.
> 
> Regards,
> Iain.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Jan 19 17:30:05 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jan 2012 17:30:05 +0000
Subject: [rabbitmq-discuss] Database lag and delayed processing of
	messages
In-Reply-To: <4F1851FF.8070105@gmail.com>
References: <4F1851FF.8070105@gmail.com>
Message-ID: <4F18531D.9080904@rabbitmq.com>

On 19/01/12 17:25, Mark wrote:
> Is there anyway I could configure an exchange/queue/consumer to
> route/deliver/consume a message in the future?
>
> For example we have run into a situation whereas we produce a message
> for a record that was just inserted into our master database. When our
> consumer tries to act upon this message the record has not be replicated
> to the slaves yet so the message consumption fails. Is there any way we
> can queue up this message in say 5 seconds? Of course we could always
> requeue a failed consumed message but that would lead us to a situation
> where the we could be consume/producing in an infinite loop. How do
> people typically handle this situation?

Not right now.

In the near future we hope to have dead lettering. When that happens you 
could publish to a queue with a 5 second message TTL, and have that 
queue dead letter to the "real" queue.

But not yet I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From roshanbhave at gmail.com  Thu Jan 19 17:33:47 2012
From: roshanbhave at gmail.com (Roshan Bhave)
Date: Thu, 19 Jan 2012 12:33:47 -0500
Subject: [rabbitmq-discuss] {"Kernel pid terminated",
 application_controller, "{application_start_failure, rabbit, {bad_return,
 {{rabbit, start, [normal, []]}, {'EXIT', {rabbit,
 failure_during_boot}}}}}"}^
In-Reply-To: <4F184AE0.6010009@rabbitmq.com>
References: <CAA8Fy2xDDnG6T3OEAvXRoNtJnX4AcK5v6jWr+Y70KszyFmSGKg@mail.gmail.com>
	<4F184AE0.6010009@rabbitmq.com>
Message-ID: <CAA8Fy2w=opwk3H5bi3g1L+1aR4KsksGTiNk0bLo+=6E64w7Hsw@mail.gmail.com>

Thanks for the quick  response..

I found qpid was running on the server. I stopped that process and now
RabbitMQ started sucessfully

/etc/init.d/rabbitmq-server start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.

Thank a ton




On Thu, Jan 19, 2012 at 11:54 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> This is a not very clear message indicating that port 5672 is already in
> use.
>
> Are you running another AMQP broker? qpid? If so you can uninstall it, or
> put RabbitMQ on another port (see http://www.rabbitmq.com/**
> configure.html#configuration-**file<http://www.rabbitmq.com/configure.html#configuration-file>
> )
>
> Cheers, Simon
>
>
> On 19/01/12 16:51, Roshan Bhave wrote:
>
>> Hey guys,
>>
>> I'm having problems running RabbitMQ. I am using Centos 6.2
>>
>> I have tried uninstalling and reinstalling (through yum), but the error
>> remains the same.
>>
>> I have no rabbitmq.conf anywhere.
>>
>> -- rabbit boot start
>> starting file handle cache server
>> ...done
>> starting worker pool
>> ...done
>> starting database
>> ...done
>> starting codec correctness check
>> ...done
>> -- external infrastructure ready
>> starting plugin registry
>> ...done
>> starting auth mechanism cr-demo
>> ...done
>> starting auth mechanism amqplain
>> ...done
>> starting auth mechanism plain
>> ...done
>> starting statistics event manager
>> ...done
>> starting logging server
>> ...done
>> starting exchange type direct
>> ...done
>> starting exchange type fanout
>> ...done
>> starting exchange type headers
>> ...done
>> starting exchange type topic
>> ...done
>> -- kernel ready
>> starting alarm handler
>> ...done
>> starting node monitor
>> ...done
>> starting cluster delegate
>> ...done
>> starting guid generator
>> ...done
>> starting memory monitor
>> ...done
>> -- core initialized
>> starting empty DB check
>> ...done
>> starting exchange, queue and binding recovery
>> ...done
>> starting mirror queue slave sup
>> ...done
>> starting adding mirrors to queues
>> ...done
>> -- message delivery logic ready
>> starting error log relay
>> ...done
>> starting networking
>> ...BOOT ERROR: FAILED
>> Reason: {badmatch,
>>             {error,
>>                 {shutdown,
>>                     {child,undefined,'rabbit_tcp_**listener_sup_:::5672',
>>                         {tcp_listener_sup,start_link,
>>                             [{0,0,0,0,0,0,0,0},
>>                              5672,
>>                              [inet6,binary,
>>                               {packet,raw},
>>                               {reuseaddr,true},
>>                               {backlog,128},
>>                               {nodelay,true},
>>                               {exit_on_close,false}],
>>
>> {rabbit_networking,tcp_**listener_started,[amqp]},
>>
>> {rabbit_networking,tcp_**listener_stopped,[amqp]},
>>                              {rabbit_networking,start_**client,[]},
>> "TCP Listener"]},
>>                         transient,infinity,supervisor,
>>                         [tcp_listener_sup]}}}}
>> Stacktrace: [{rabbit_networking,start_**listener0,4},
>>              {rabbit_networking,'-start_**listener/4-lc$^0/1-0-',4},
>>              {rabbit_networking,start_**listener,4},
>>              {rabbit_networking,'-boot_tcp/**0-lc$^0/1-0-',1},
>>              {rabbit_networking,boot_tcp,0}**,
>>              {rabbit_networking,boot,0},
>>
>> {rabbit,'-run_boot_step/1-lc$^**1/1-1-',1},
>>              {rabbit,run_boot_step,1}]
>> {"Kernel pid
>> terminated",application_**controller,"{application_**
>> start_failure,rabbit,{bad_**return,{{rabbit,start,[normal,**
>> []]},{'EXIT',{rabbit,failure_**during_boot}}}}}"}^M
>>
>>
>> Thanks,
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/a2fb13da/attachment.htm>

From static.void.dev at gmail.com  Thu Jan 19 17:54:25 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 19 Jan 2012 09:54:25 -0800
Subject: [rabbitmq-discuss] Pushing events to browser
Message-ID: <4F1858D1.80301@gmail.com>

We would like for each one of our users to subscribe to their own 
personal queue. When a message is delivered to this queue we would like 
to send this notification to the user in real-time. I was wondering the 
preferred way of doing this.

For example with Faye Pub/Sub server (http://faye.jcoglan.com/) they 
include a javascript file that can be used to subscribe to events from 
the front-end. Is there anything like this with RabbitMQ or AMQP in general?

varclient =newFaye.Client('http://localhost:8000/faye',{
     timeout:120
});

varsubscription =client.subscribe('/foo',function(message){
     // handle message
});

This also leads me to my next question. What is the upper bound of 
unique queues one RabittMQ machine can reasonably manage. I know its 
hardware dependent but can someone throw out a ballpark figure... 
hundreds, thousands, 10's of thousands... etc

Thanks in advance
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/8d4a4a52/attachment.htm>

From static.void.dev at gmail.com  Thu Jan 19 18:01:10 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 19 Jan 2012 10:01:10 -0800
Subject: [rabbitmq-discuss] Database lag and delayed processing of
	messages
In-Reply-To: <4F18531D.9080904@rabbitmq.com>
References: <4F1851FF.8070105@gmail.com> <4F18531D.9080904@rabbitmq.com>
Message-ID: <4F185A66.7040200@gmail.com>

Are there any alternative methods/workarounds for these type of problems?

Also is there any documentation out there on the dead-letter queue?

On 1/19/12 9:30 AM, Simon MacMullen wrote:
> On 19/01/12 17:25, Mark wrote:
>> Is there anyway I could configure an exchange/queue/consumer to
>> route/deliver/consume a message in the future?
>>
>> For example we have run into a situation whereas we produce a message
>> for a record that was just inserted into our master database. When our
>> consumer tries to act upon this message the record has not be replicated
>> to the slaves yet so the message consumption fails. Is there any way we
>> can queue up this message in say 5 seconds? Of course we could always
>> requeue a failed consumed message but that would lead us to a situation
>> where the we could be consume/producing in an infinite loop. How do
>> people typically handle this situation?
>
> Not right now.
>
> In the near future we hope to have dead lettering. When that happens 
> you could publish to a queue with a 5 second message TTL, and have 
> that queue dead letter to the "real" queue.
>
> But not yet I'm afraid.
>
> Cheers, Simon
>

From simon at rabbitmq.com  Thu Jan 19 18:03:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Jan 2012 18:03:13 +0000
Subject: [rabbitmq-discuss] Database lag and delayed processing
	of	messages
In-Reply-To: <4F185A66.7040200@gmail.com>
References: <4F1851FF.8070105@gmail.com> <4F18531D.9080904@rabbitmq.com>
	<4F185A66.7040200@gmail.com>
Message-ID: <4F185AE1.50709@rabbitmq.com>

On 19/01/12 18:01, Mark wrote:
> Are there any alternative methods/workarounds for these type of problems?

Not right now, short of building some special client that consumes 
messages and republishes them later.

> Also is there any documentation out there on the dead-letter queue?

Not until we've finished writing it I'm afraid...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jerryk at vmware.com  Thu Jan 19 18:46:29 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 19 Jan 2012 10:46:29 -0800 (PST)
Subject: [rabbitmq-discuss] FW: One Producer, Many Consumers,
	Manyphysical nodes
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044729C@MAILCCR.us.syncsort.com>
Message-ID: <cf8c1078-dc07-4c05-b687-fd6d2027d904@strongmad.batnest.org>

Hi, Paul...

A tiny typo in Alvaro's mail me be throwing you off.  He 
meant:

"When the message is delivered to a consumer and then that message
 is *ACKed* back to the server, then the message is automatically 
 deleted by RabbitMQ."

The reason that Rabbit doesn't consign the delivered message to
oblivion until a client has ACKed it is to guard against the lost
message you'd experience if Rabbit delivered a message to a client,
destroyed its local copies (regardless of whether it's current living
in RAM, on disk, or both), and then the client crashed before
completing whatever meaningful action it intended to perform with
the received message.  The disappearance of the client connection
lets Rabbit know that the message needs to be re-queued for
re-delivery.

If I'm reading you correctly that covers scenario 2 in your mail
below.  In scenario 1, are you wanting to have some permanent record
somewhere of messages that have passed through Rabbit for some
application specific reason?  If so, there are a couple of options
for doing that.

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Alvaro Videla" <videlalvaro at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, January 19, 2012 8:46:18 AM
Subject: Re: [rabbitmq-discuss] FW: One Producer, Many Consumers, Manyphysical nodes





Thank you, Alvaro. 



I had assumed (but Michael corrected me) that once a consumer retrieved a message, that message would disappear from the queue. Can you point me to examples/docs that show how to 1) cause a message to persist despite its retrieval by a consumer; 2) how explicitly to delete such a persisted message from a queue? 



-Paul 



PS: looking forward to your book. Any chance Amazon will have it before March? 








From: Alvaro Videla [mailto:videlalvaro at gmail.com] 
Sent: Thursday, January 19, 2012 11:24 AM 
To: Bell, Paul M. 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Subject: Re: [rabbitmq-discuss] FW: One Producer, Many Consumers, Manyphysical nodes 



Hi, 





RE - Keeping messages: 





RabbitMQ takes care of queueing messages, that is, of keeping them in queues. The only thing you have to do as a user is publishing them. 





RE - Deleting messages: 





When the message is delivered to a consumer and then that messages is asked back to the server, then the message is automatically deleted by RabbitMQ (this is an oversimplification BTW, there are many options that might modify message durability). 





Regards, 





Alvaro 





On Thu, Jan 19, 2012 at 5:17 PM, Bell, Paul M. < pbell at syncsort.com > wrote: 

Michael, 

Thanks for the reply. 

I have finished working through a few of the tutorials you referenced. Either I missed something or haven't yet gotten to the right tutorial. 

You've told me that it's possible to leave a message in a queue, i.e., that a message can persist in its queue even after it has been received by a consumer. Can you tell me how this is done? 

Also, such an approach suggests the need to explicitly delete the message from the queue. Is there a way to do this? 

Cordially, 

Paul 

>Paul, 

>Looking through the tutorials will obviate many further questions. 

>On this specifically, 

>> When a consumer pulls a message from the queue, is there a way to 
>> leave that message in queue? If so, can queue elements be updated 
>> in-place, e.g., with "status" info about the state of the work that 
>> the message (task) represents? 

>No. You can leave it in the queue, but you can't change it. You'd have to post another message. 

>-Michael 




ATTENTION: ----- 

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control. 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Thu Jan 19 18:49:05 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Jan 2012 19:49:05 +0100
Subject: [rabbitmq-discuss] FW: One Producer, Many Consumers,
	Manyphysical nodes
In-Reply-To: <cf8c1078-dc07-4c05-b687-fd6d2027d904@strongmad.batnest.org>
References: <cf8c1078-dc07-4c05-b687-fd6d2027d904@strongmad.batnest.org>
Message-ID: <FC2E5A67-7AB1-4515-9846-7DDBE1319C9E@gmail.com>

Hi,

On Jan 19, 2012, at 7:46 PM, Jerry Kuch wrote:

> Hi, Paul...
> 
> A tiny typo in Alvaro's mail me be throwing you off.  He 
> meant:
> 
> "When the message is delivered to a consumer and then that message
> is *ACKed* back to the server, then the message is automatically 
> deleted by RabbitMQ."

Jerry is right,

Cheers,

Alvaro

From ts_venu at yahoo.com  Thu Jan 19 18:51:33 2012
From: ts_venu at yahoo.com (RabbitMQ_User)
Date: Thu, 19 Jan 2012 10:51:33 -0800 (PST)
Subject: [rabbitmq-discuss] Message Characters length more than 50000
 are truncated
In-Reply-To: <4F185206.2020305@rabbitmq.com>
References: <33169185.post@talk.nabble.com> <4F185206.2020305@rabbitmq.com>
Message-ID: <33169927.post@talk.nabble.com>


Thank you Simon. Your are right, after I consume the message it does have the
full message (all 50000+). Its only in web UI the messages show truncated.

Thanks,
Venu



Simon MacMullen-2 wrote:
> 
> On 19/01/12 16:59, RabbitMQ_User wrote:
>> Please let me know if any of you had this issue and possible solution of
>> truncated messages when the message characters size exceeded 50000. I am
>> using .NET Client to publish the message with BasicPublish method of
>> RabbitMQ.Client.IModel by passing in the message body as an byte[]
>> array. After successful publish, and view the Auto String/Base64 message
>> from Web UI Management Plugin it only shows 50000 characters and rest
>> are truncated nor have been written to the queue. Thanks.
> 
> The *web UI* will truncate messages you've pulled from a queue to 50000 
> bytes (basically so you don't crash your browser).
> 
> The HTTP API allows you to ask for messages to be truncated in this way 
> (which is what the web UI does). Other HTTP API users can get the full 
> message (although due to the way it's base 64 encoded and stuffed in 
> JSON you probably don't want to receive huge messages this way).
> 
> Messages are not truncated in the queue, or in any other API.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Message-Characters-length-more-than-50000-are-truncated-tp33169185p33169927.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simone.busoli at gmail.com  Thu Jan 19 20:31:05 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 19 Jan 2012 21:31:05 +0100
Subject: [rabbitmq-discuss] Acked Message getting redelivered
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A3670567C84E@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A3670567C1CF@34093-C5-EVS1.exchange.rackspace.com>
	<CANVKUrUVAFrkmYMUhLJYhykYs+dj0DG-0kxLSb-En+=x8ZvXMQ@mail.gmail.com>
	<925DDDE9D69E7143B3252E2D4680A3670567C4A1@34093-C5-EVS1.exchange.rackspace.com>
	<88E590DC4586974D825FC82AE798294E520E0FAD@GSVCLU04.ges.ferlan.it>
	<925DDDE9D69E7143B3252E2D4680A3670567C84E@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <CAOn7oW-Ah=BBWdpJ=8LwD=jgoXwVLW=oT_8_wF0CAbcYS+0z6Q@mail.gmail.com>

If you need to have messages delivered in a at least once or exactly once
fashion I don't think there is any other way, but if you are ok with
loosing messages then looking at the redelivered flag will be much easier.
On Jan 19, 2012 5:17 PM, "Iain Hull" <iain.hull at workday.com> wrote:

> > As far as my experience goes it's correct, you have to implement it at a
> higher level.
> Yes but this is hard when messages are consumed by a cluster, they would
> have to share a single store to track processed messages or use a local
> store and ensure that certain messages are only processed by specific hosts
> in the cluster.
>
> -----Original Message-----
> From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com]
> Sent: 19 January 2012 08:50
> To: Iain Hull; Eugene Kirpichov
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: [rabbitmq-discuss] Acked Message getting redelivered
>
> As far as my experience goes it's correct, you have to implement it at a
> higher level.
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Iain Hull
> Sent: gioved? 19 gennaio 2012 09:46
> To: Eugene Kirpichov
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Acked Message getting redelivered
>
> Thanks Eugene,
>
> From: Eugene Kirpichov [mailto:ekirpichov at gmail.com]
> > Acks are indeed asynchronous.
>
> So this means that the only reliable way to implement "at most once
> delivery" is to remember the messages uuids that you have processed, which
> won't work for clustered consumers.  Is this correct or is there another
> way to achieve this?
>
> Regards,
> Iain.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _________________________________________________________________________________________________________________
> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e
> pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
> messaggio non ? il destinatario designato, o il dipendente/agente
> responsabile
> per la consegna del messaggio al destinatario designato, si informa che
> ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
>
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain
> information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the
> intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
> immediately by return e-mail and delete this e-mail and all attachments from
> your system.
>
> _________________________________________________________________________________________________________________
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/7762e5ed/attachment.htm>

From djacobfeuerborn at gmail.com  Thu Jan 19 20:33:13 2012
From: djacobfeuerborn at gmail.com (Dennis Jacobfeuerborn)
Date: Thu, 19 Jan 2012 12:33:13 -0800 (PST)
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
Message-ID: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>

Hi,
we have a two-system cluster set up and the processing of messages works 
fine except that beam.smp keeps growing until it hits the high watermark 
and then stops working.
When I list the queues they all show mostly 0 messages and the message rate 
is about 90msgs/sec so not really that high and there are no messages 
piling up in the queues.
So why is the memory consumption hitting 800mb even though the queues are 
empty? Any idea what this could be or how I can find out what that memory 
is used for?
The memory growth isn't strictly linear and sometimes goes down a few MB 
but over the day it grows consistently. I checked the number of channels, 
connections, etc. and they are pretty much constant.

This is on an up-to-date centos 6.2 with RabbitMQ 1.7.1 and Erlang R14B04.

Right now we will probably have to resort to restarting the rabbitmq 
service every two or three hours on both systems just to keep things 
working but this is obviously just a workaround and no solution.

Regards,
  Dennis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/6e44e1ae/attachment.htm>

From djacobfeuerborn at gmail.com  Thu Jan 19 20:48:27 2012
From: djacobfeuerborn at gmail.com (Dennis Jacobfeuerborn)
Date: Thu, 19 Jan 2012 12:48:27 -0800 (PST)
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>
Message-ID: <32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>

I meant version 2.7.1 obviously. Also the 30 queues are mirrored and the 
average message size is about 1kb.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/48a78d96/attachment.htm>

From pbell at syncsort.com  Thu Jan 19 21:02:44 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Thu, 19 Jan 2012 16:02:44 -0500
Subject: [rabbitmq-discuss] FW: One Producer, Many Consumers,
 Manyphysical nodes
In-Reply-To: <cf8c1078-dc07-4c05-b687-fd6d2027d904@strongmad.batnest.org>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044729C@MAILCCR.us.syncsort.com>
	<cf8c1078-dc07-4c05-b687-fd6d2027d904@strongmad.batnest.org>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B404472EA@MAILCCR.us.syncsort.com>

Thanks, guys.

So, as long as I defer the ACK, the message remains in queue.

In re (1): exactly Jerry, application specific. I see the queue as containing useful information about the application's progress and its current state. Hence, I didn't want a message to be deleted "merely" because the worker consumer pulled it from the queue. 

As noted earlier, I am (but for some modest "academic" exposure) new to MOM. Using a queue as a persistence store may not be the best design idea. My thinking is that the data is there in the queue, so why incur the overhead of copying it to the lowest layer database store? I envision an external bit of software, e.g., a reporting tool, being able to query the contents of a queue. I suppose it would suffice if the reporting tool could read through the queue sequentially (though the ability to access a single message directly would be nice).

But maybe I am thinking about this the wrong way. Perhaps the only way to obtain messages from a queue is to be a proper consumer...?

I appreciate the guidance.

-Paul 

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Thursday, January 19, 2012 1:46 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com; Alvaro Videla
Subject: Re: [rabbitmq-discuss] FW: One Producer, Many Consumers, Manyphysical nodes

Hi, Paul...

A tiny typo in Alvaro's mail me be throwing you off.  He 
meant:

"When the message is delivered to a consumer and then that message
 is *ACKed* back to the server, then the message is automatically 
 deleted by RabbitMQ."

The reason that Rabbit doesn't consign the delivered message to
oblivion until a client has ACKed it is to guard against the lost
message you'd experience if Rabbit delivered a message to a client,
destroyed its local copies (regardless of whether it's current living
in RAM, on disk, or both), and then the client crashed before
completing whatever meaningful action it intended to perform with
the received message.  The disappearance of the client connection
lets Rabbit know that the message needs to be re-queued for
re-delivery.

If I'm reading you correctly that covers scenario 2 in your mail
below.  In scenario 1, are you wanting to have some permanent record
somewhere of messages that have passed through Rabbit for some
application specific reason?  If so, there are a couple of options
for doing that.

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Alvaro Videla" <videlalvaro at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, January 19, 2012 8:46:18 AM
Subject: Re: [rabbitmq-discuss] FW: One Producer, Many Consumers, Manyphysical nodes





Thank you, Alvaro. 



I had assumed (but Michael corrected me) that once a consumer retrieved a message, that message would disappear from the queue. Can you point me to examples/docs that show how to 1) cause a message to persist despite its retrieval by a consumer; 2) how explicitly to delete such a persisted message from a queue? 



-Paul 



PS: looking forward to your book. Any chance Amazon will have it before March? 








From: Alvaro Videla [mailto:videlalvaro at gmail.com] 
Sent: Thursday, January 19, 2012 11:24 AM 
To: Bell, Paul M. 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Subject: Re: [rabbitmq-discuss] FW: One Producer, Many Consumers, Manyphysical nodes 



Hi, 





RE - Keeping messages: 





RabbitMQ takes care of queueing messages, that is, of keeping them in queues. The only thing you have to do as a user is publishing them. 





RE - Deleting messages: 





When the message is delivered to a consumer and then that messages is asked back to the server, then the message is automatically deleted by RabbitMQ (this is an oversimplification BTW, there are many options that might modify message durability). 





Regards, 





Alvaro 





On Thu, Jan 19, 2012 at 5:17 PM, Bell, Paul M. < pbell at syncsort.com > wrote: 

Michael, 

Thanks for the reply. 

I have finished working through a few of the tutorials you referenced. Either I missed something or haven't yet gotten to the right tutorial. 

You've told me that it's possible to leave a message in a queue, i.e., that a message can persist in its queue even after it has been received by a consumer. Can you tell me how this is done? 

Also, such an approach suggests the need to explicitly delete the message from the queue. Is there a way to do this? 

Cordially, 

Paul 

>Paul, 

>Looking through the tutorials will obviate many further questions. 

>On this specifically, 

>> When a consumer pulls a message from the queue, is there a way to 
>> leave that message in queue? If so, can queue elements be updated 
>> in-place, e.g., with "status" info about the state of the work that 
>> the message (task) represents? 

>No. You can leave it in the queue, but you can't change it. You'd have to post another message. 

>-Michael 




ATTENTION: ----- 

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control. 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Thu Jan 19 21:03:27 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 19 Jan 2012 22:03:27 +0100
Subject: [rabbitmq-discuss] Database lag and delayed processing of
	messages
In-Reply-To: <4F185A66.7040200@gmail.com>
References: <4F1851FF.8070105@gmail.com> <4F18531D.9080904@rabbitmq.com>
	<4F185A66.7040200@gmail.com>
Message-ID: <CAOn7oW8oZ5JgnGWLA1Z6sFTthRyuoUKbGL3LhJGAY-RX=U_KuA@mail.gmail.com>

It shouldn't be too bard to write a client which does the scheduling, I
think Mike Hadlow did something similar in his .NET library EasyNetQ.
On Jan 19, 2012 7:01 PM, "Mark" <static.void.dev at gmail.com> wrote:

> Are there any alternative methods/workarounds for these type of problems?
>
> Also is there any documentation out there on the dead-letter queue?
>
> On 1/19/12 9:30 AM, Simon MacMullen wrote:
>
>> On 19/01/12 17:25, Mark wrote:
>>
>>> Is there anyway I could configure an exchange/queue/consumer to
>>> route/deliver/consume a message in the future?
>>>
>>> For example we have run into a situation whereas we produce a message
>>> for a record that was just inserted into our master database. When our
>>> consumer tries to act upon this message the record has not be replicated
>>> to the slaves yet so the message consumption fails. Is there any way we
>>> can queue up this message in say 5 seconds? Of course we could always
>>> requeue a failed consumed message but that would lead us to a situation
>>> where the we could be consume/producing in an infinite loop. How do
>>> people typically handle this situation?
>>>
>>
>> Not right now.
>>
>> In the near future we hope to have dead lettering. When that happens you
>> could publish to a queue with a 5 second message TTL, and have that queue
>> dead letter to the "real" queue.
>>
>> But not yet I'm afraid.
>>
>> Cheers, Simon
>>
>>  ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/b8e990c3/attachment.htm>

From jerryk at vmware.com  Thu Jan 19 21:28:26 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 19 Jan 2012 13:28:26 -0800 (PST)
Subject: [rabbitmq-discuss] FW: One Producer, Many Consumers,
	Manyphysical nodes
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B404472EA@MAILCCR.us.syncsort.com>
Message-ID: <9ab3f440-e4c0-4810-9202-5fe273ad22f5@strongmad.batnest.org>

Hi, Paul... 




In re (1): exactly Jerry, application specific. I see the queue as containing useful information about the application's progress and its current state. Hence, I didn't want a message to be deleted "merely" because the worker consumer pulled it from the queue. 

Gotcha. The right conceptual way to think of the deliver-ACK-dequeue lifecycle for a message is 
as implementing a "transfer of responsibility" so that things are left, in the case of client failure, 
in a state that will allow life to meaningfully go on. Thus, the RabbitMQ broker secretes away its 
knowledge of a delivered message until the client sends its ACK, thereby saying "I've got this, you 
can stop worrying about it" at which point Rabbit knows it's no longer under any obligation to 
deliver that message in the future and can dispense with whatever record of it that it has. 


As noted earlier, I am (but for some modest "academic" exposure) new to MOM. Using a queue as a persistence store may not be the best design idea. My thinking is that the data is there in the queue, so why incur the overhead of copying it to the lowest layer database store? I envision an external bit of software, e.g., a reporting tool, being able to query the contents of a queue. I suppose it would suffice if the reporting tool could read through the queue sequentially (though the ability to access a single message directly would be nice). 

Although it might seem that there's some initial economy in this mode of thinking, it's probably 
not an approach that will serve your distributed app design super well as you go forward. 
Rabbit's good at accepting and delivering messages, and providing understandable (although 
not always totally obvious without some study or reflection) guarantees of what conditions that 
will happen under. 

If you're wanting to persist data for the ages, or for offline batch processing, or for generating 
interesting reports or analytics, you're best off using a data store suited to feeding whatever 
systems or engines are doing that work. Rabbit makes a fine way to transport such stuff 
between the various systems that need to handle it, e.g. things that write into logs or databases, 
workers processing jobs represented by messages out of a queue, etc. Think of Rabbit as 
being a tool you can use for creating sort of the "peripheral nervous system" of your application, 
ferrying tasks, events, notifications and the like between whatever your system's eyes, hands, 
feet, brains, tentacles, etc. might be. It's likely your various applications requiring long term 
persistence, or richer querying and processing, aren't going to map well on to the message 
transport system itself, and you might find yourself painted into strange corners if you try 
to conflate the intention of these different types of systems too readily. Make sense? 


But maybe I am thinking about this the wrong way. Perhaps the only way to obtain messages from a queue is to be a proper consumer...? 

This is basically the case. Sneak and peek tricks on queues, e.g. by consuming a batch of 
messages, not ACK-ing them, and then rejecting them so that they requeue can quickly 
lead to systems whose behavior isn't that easy to reason about. If you think about Rabbit 
as a way of loosening the coupling between systems that produce and eat data, you'll find 
your cutting with the grain much more of the time and it will probably become easier to 
focus on the parts of your system that do the work, as you let Rabbit gracefully move into 
the background keeping things tied together and running, as producers and consumers may 
be coming and going, starting and crashing, etc. 

Best regards, 
Jerry 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/6efb3321/attachment.htm>

From swarajya.pothuri at wipro.com  Fri Jan 20 04:18:17 2012
From: swarajya.pothuri at wipro.com (swarajya.pothuri at wipro.com)
Date: Fri, 20 Jan 2012 04:18:17 +0000
Subject: [rabbitmq-discuss] Persistant Messages in TopicExchange
Message-ID: <E5DDB9D2-DD47-4E32-9CCB-DA1843316646@wipro.com>

Hi,
I'm new to RabbitMQ.
When i use TopicExchange, and trying to push messages to from producer to consumer.
Consumer is able to consume messages only if if it is alive and running when the producer is sending the message.
When consumer is down when producer is started, all those messages were lost.
I tried to make messages Persistant by passing parameter as MessageProperties.PERSISTANT_TEXT_PLAIN.
Still messages were lost.

Someone please help 
Please do not print this email unless it is absolutely necessary. 

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. 

WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. 

www.wipro.com

From simone.busoli at gmail.com  Fri Jan 20 06:22:00 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 20 Jan 2012 07:22:00 +0100
Subject: [rabbitmq-discuss] Persistant Messages in TopicExchange
In-Reply-To: <E5DDB9D2-DD47-4E32-9CCB-DA1843316646@wipro.com>
References: <E5DDB9D2-DD47-4E32-9CCB-DA1843316646@wipro.com>
Message-ID: <CAOn7oW-x0aeoDyyUffQc-3d23OPHLwUoMAgTFmXoVFf5ZMkNug@mail.gmail.com>

The messages are persisted only if a durable queue exists bound to the
exchange where the messages are published, with a binding key which would
route those messages to the queue.
On Jan 20, 2012 5:19 AM, <swarajya.pothuri at wipro.com> wrote:

> Hi,
> I'm new to RabbitMQ.
> When i use TopicExchange, and trying to push messages to from producer to
> consumer.
> Consumer is able to consume messages only if if it is alive and running
> when the producer is sending the message.
> When consumer is down when producer is started, all those messages were
> lost.
> I tried to make messages Persistant by passing parameter as
> MessageProperties.PERSISTANT_TEXT_PLAIN.
> Still messages were lost.
>
> Someone please help
> Please do not print this email unless it is absolutely necessary.
>
> The information contained in this electronic message and any attachments
> to this message are intended for the exclusive use of the addressee(s) and
> may contain proprietary, confidential or privileged information. If you are
> not the intended recipient, you should not disseminate, distribute or copy
> this e-mail. Please notify the sender immediately and destroy all copies of
> this message and any attachments.
>
> WARNING: Computer viruses can be transmitted via email. The recipient
> should check this email and any attachments for the presence of viruses.
> The company accepts no liability for any damage caused by any virus
> transmitted by this email.
>
> www.wipro.com
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120120/76a7ab7c/attachment.htm>

From acheremukhin.digitalguard at gmail.com  Fri Jan 20 07:06:01 2012
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Thu, 19 Jan 2012 23:06:01 -0800 (PST)
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.9.1 is released
In-Reply-To: <8CC5148C-062E-44A8-9A77-4A483331BE93@gmail.com>
References: <8CC5148C-062E-44A8-9A77-4A483331BE93@gmail.com>
Message-ID: <2822600.657.1327043161942.JavaMail.geo-discussion-forums@yqlp13>

Good news! Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120119/589cad47/attachment.htm>

From majek04 at gmail.com  Fri Jan 20 11:52:49 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 20 Jan 2012 11:52:49 +0000
Subject: [rabbitmq-discuss] Pushing events to browser
In-Reply-To: <4F1858D1.80301@gmail.com>
References: <4F1858D1.80301@gmail.com>
Message-ID: <CABzX+qwFLte-Zi_4YG=kTJuWTvOx0K8xByxbDidRf-pwQvPW8w@mail.gmail.com>

On Thu, Jan 19, 2012 at 17:54, Mark <static.void.dev at gmail.com> wrote:
> We would like for each one of our users to subscribe to their own personal
> queue. When a message is delivered to this queue we would like to send this
> notification to the user in real-time. I was wondering the preferred way of
> doing this.
>
> For example with Faye Pub/Sub server (http://faye.jcoglan.com/) they include
> a javascript file that can be used to subscribe to events from the
> front-end. Is there anything like this with RabbitMQ or AMQP in general?

Take a look at our recent project - SockJS:
   https://github.com/sockjs/sockjs-client

You would still need to write a bridge between RabbitMQ and SockJS,
but I personally think it's desired, and gives you more flexibility in the
future.

> This also leads me to my next question. What is the upper bound of unique
> queues one RabittMQ machine can reasonably manage. I know its hardware
> dependent but can someone throw out a ballpark figure... hundreds,
> thousands, 10's of thousands... etc

RabbitMQ is surprisingly good at handling large number of relatively unused
queues. But if you want to keep them busy and push messages often -
well, that's another story. I think you should expect that a single rabbitmq
box should be able to output around 30k msg/sec. Probably less with
a large number of active queues. But this really depends very much
on your access patterns.

Hope that helps!

Marek

From simon at rabbitmq.com  Fri Jan 20 12:06:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jan 2012 12:06:07 +0000
Subject: [rabbitmq-discuss] Pushing events to browser
In-Reply-To: <4F1858D1.80301@gmail.com>
References: <4F1858D1.80301@gmail.com>
Message-ID: <4F1958AF.50107@rabbitmq.com>

On 19/01/12 17:54, Mark wrote:
> This also leads me to my next question. What is the upper bound of
> unique queues one RabittMQ machine can reasonably manage. I know its
> hardware dependent but can someone throw out a ballpark figure...
> hundreds, thousands, 10's of thousands... etc

Gut feeling: 10k is nothing special. 100k starts to get into the realm 
of "special consideration needed". See a little bit of discussion here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017426.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 20 12:32:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jan 2012 12:32:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ load issues
In-Reply-To: <CAHtD+9NnX9HPYPWk9RJdd9sojj68ch4=Tj6-is66ZtdTU1TNtw@mail.gmail.com>
References: <CAHtD+9P9-7_hgHf8vcwZn3BGQEviRHZvFjn1kwnVEGy4_v7wag@mail.gmail.com>	<4F156DDE.8030408@rabbitmq.com>
	<CAHtD+9NnX9HPYPWk9RJdd9sojj68ch4=Tj6-is66ZtdTU1TNtw@mail.gmail.com>
Message-ID: <4F195EFA.5050909@rabbitmq.com>

On 17/01/12 20:57, Jeremy Pierre wrote:
>> * If you're declaring queues in bulk, make sure you do so synchonously (i.e.
>> nowait=false).
>
> To be perfectly honest, I can't find this (with a relatively cursory
> investigation) in the APIs I'm using(Akka 1.2 AMQP module that
> leverages RabbitMQ's Java lib iirc).  Having said that, I'm creating
> queues one at a time(albeit quickly) - not sure if this addresses the
> bulk queue declaration you're referring to?  I'll dig further into the
> APIs on my side.

Synchronous queue.declare (i.e. with a response) is the default in most 
APIs - in general you want to know when the queue is declared.

>> * If you're going to have that many queues and that few routing keys then
>> presumably every message published will be delivered to huge numbers of
>> queues. I assume you expect your publishing rate to be small. Publishing a
>> couple of messages per second is a lot if they're delivered to 50k queues.
>
> The number of routing keys is actually fairly high given that the
> userId and actual message categories are completely variable.  With
> the example I gave(~100k queues), each queue is bound to a unique
> routing key(topic) and a message typically is delivered to a very
> small number of queues(20-30 would be a theoretical maximum and a very
> rare situation).  As additional applications are built on top of the
> base collection layer and RabbitMQ, the queue count will go much
> higher(obviously).
>
> For what it's worth, our testing load(30k "users", 6 queues per user
> in my original posting though we never got that high before rabbit
> choked) generates an easy 150-200 messages per second going into
> RabbitMQ and this can spike higher.  Production will see 200k-300k
> users at least I expect.

Ah OK. 200 msg/s in is fine as long as they're not going to 50k queues 
each :)

>> * Every queue process consumes a fixed small amount of memory. Spreading
>> queues out over a cluster will help.
>
> We're experimenting with a 3-node cluster as of today though I've
> reduced the queue count by determining the update type at my
> application layer and using topics with wildcards, e.g.
> "<source>.<userId>.*"
>
>> * Every queue and binding creates a row in an Mnesia table. Mnesia tables
>> always reside in RAM, so for huge numbers of queues in a cluster expect to
>> use lots of RAM. Therefore instead of clustering you will probably find it
>> better to shard the queues out over independent brokers and connect them
>> with federation. The case of huge numbers of queues and very few routing
>> keys could almost be made for federation. For the massive fanout case you
>> probably want to build a (maybe multi-layered) federation tree rather than
>> the complete graph people use more often with federation.
>
> Thanks for suggesting this!  We may go this route but I'm wary of
> putting sharding logic in our application layer(perhaps unjustifiably
> so).  Truth be told I was kind of hoping for a "silver bullet" with
> RabbitMQ ;)  In the meantime, we'll bump the RAM for our cluster nodes
> and see what happens.

Hopefully you should not need (much) sharding logic in your app - just 
enough to pick a broker to connect to (which you'd need for clustering 
anyway). Set up the federation correctly and you could just publish to 
one broker / an arbitrary broker and get the messages routed accordingly.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 20 12:38:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jan 2012 12:38:14 +0000
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>
	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>
Message-ID: <4F196036.3050708@rabbitmq.com>

On 19/01/12 20:48, Dennis Jacobfeuerborn wrote:
> I meant version 2.7.1 obviously. Also the 30 queues are mirrored and the
> average message size is about 1kb.

Can you invoke:


rabbitmqctl eval 'lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
memory), Pid, process_info(Pid)} || Pid <- processes()])), 30).'

(all one line)

and send me the results? This should let us see where the memory is going.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 20 12:47:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jan 2012 12:47:04 +0000
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
In-Reply-To: <384f67bd-c561-4728-8796-7528863d9176@k3g2000pbn.googlegroups.com>
References: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>	<4F144193.5040109@rabbitmq.com>
	<384f67bd-c561-4728-8796-7528863d9176@k3g2000pbn.googlegroups.com>
Message-ID: <4F196248.7050400@rabbitmq.com>

On 16/01/12 15:56, Yogesh Ketkar wrote:
> I would like to delete the queue with no messages in it and so asked
> the question.

I see.

> Can you suggest an alternative to achieve
> 1. Delete the queue when last event processed from the queue has
> <Action>Delete</Action>  as this implies that
>     no more events with same<AppId>  would ever get created.

Well, you could have your client do that.

> 2. Delete the queue when it is IDLE for certain period, meaning it is
> empty and no more event was added to it for certain time period.

Hmm. Well there's nothing built in to do this, but you could have 
something from outside poking the mgmt API every few minutes - look at 
the output of (e.g.)

rabbitmqadmin list queues name messages consumers idle_since

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sunil at armor5.com  Thu Jan 19 22:29:43 2012
From: sunil at armor5.com (Sunil Agrawal)
Date: Thu, 19 Jan 2012 14:29:43 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ newbie question
Message-ID: <bf969a6f-ed0b-463a-82f7-af26daae98ae@rk3g2000pbb.googlegroups.com>

Hi,

I have a question about RabbitMQ and JSON RPC channel on Windows. I
installed RabbitMQ 2.7.1 on Windows and enabled the JSON RPC channel
as described on github (https://github.com/rabbitmq/rabbitmq-jsonrpc-
channel). When I enabled the plugin it shows that the plugin has been
configured.  Below are the results of the rabbitmqctl status command.
However when using the browser I go to http://localhost:5672/rpc/rabbitmq
I do NOT get the message described in GitHub, rather only 'AMQP.

Any insights where is my installation going wrong?
Thanks, Sunil

[{pid,1032},
 {running_applications,
     [{rabbitmq_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","2.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.8"},
      {sasl,"SASL  CXC 138 11","2.2"},
      {rabbitmq_jsonrpc,"Rabbit JSON-RPC","2.7.1"},
      {rfc4627_jsonrpc,"JSON RPC Service","2.7.1-git"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.8"},
      {mnesia,"MNESIA  CXC 138 12","4.6"},
      {stdlib,"ERTS  CXC 138 10","1.18"},
      {kernel,"ERTS  CXC 138 10","2.15"}]},
 {os,{win32,nt}},
 {erlang_version,"Erlang R15B (erts-5.9) [smp:2:2] [async-threads:
30]\n"},
 {memory,
     [{total,17088656},
      {processes,6005645},
      {processes_used,6005630},
      {system,11083011},
      {atom,424265},
      {atom_used,399111},
      {binary,52168},
      {code,7989972},
      {ets,585852}]},
 {vm_memory_high_watermark,0.26719464674914045},
 {vm_memory_limit,858993459}]
...done.

From sunil at armor5.com  Fri Jan 20 02:50:52 2012
From: sunil at armor5.com (Sunil Agrawal)
Date: Thu, 19 Jan 2012 18:50:52 -0800 (PST)
Subject: [rabbitmq-discuss] Error installing/configuring Jsonrpc Channel
	plugin
Message-ID: <8911cdcf-ef15-469a-b36d-89d84061f80a@q7g2000pbg.googlegroups.com>

Hi,
I just installed version 2.7.1 of RabbitMQ and enabled the plugin
rabbitmq-jsonrpc-channel. Then using a browser I browsed to
http://localhost:5672/rpc/rabbitmq and instead of getting the message
mentioned here (https://github.com/rabbitmq/rabbitmq-jsonrpc-
channel/), I just got 'AMQP 0.0.9.1.

Looking at the status using rabbitmqctl status, does show that the
plugin is installed and running :
[{pid,1656},
 {running_applications,
     [{rabbitmq_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","2.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.8"},
      {sasl,"SASL  CXC 138 11","2.2"},
      {rabbitmq_jsonrpc,"Rabbit JSON-RPC","2.7.1"},
      {rfc4627_jsonrpc,"JSON RPC Service","2.7.1-git"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.8"},
      {mnesia,"MNESIA  CXC 138 12","4.6"},
      {stdlib,"ERTS  CXC 138 10","1.18"},
      {kernel,"ERTS  CXC 138 10","2.15"}]},
 {os,{win32,nt}},
 {erlang_version,"Erlang R15B (erts-5.9) [smp:2:2] [async-threads:
30]\n"},
 {memory,
     [{total,17072208},
      {processes,5881777},
      {processes_used,5881762},
      {system,11190431},
      {atom,424265},
      {atom_used,398041},
      {binary,182512},
      {code,7973732},
      {ets,585116}]},
 {vm_memory_high_watermark,0.26719464674914045},
 {vm_memory_limit,858993459}]
...done.

Any suggestions on how to fix it?

Thanks, Sunil

P.S. Excuse me if this a duplicate message from me shows up, the
previous one didn't make it through, so resending it.

From simon at rabbitmq.com  Fri Jan 20 13:41:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jan 2012 13:41:47 +0000
Subject: [rabbitmq-discuss] Error installing/configuring Jsonrpc Channel
 plugin
In-Reply-To: <8911cdcf-ef15-469a-b36d-89d84061f80a@q7g2000pbg.googlegroups.com>
References: <8911cdcf-ef15-469a-b36d-89d84061f80a@q7g2000pbg.googlegroups.com>
Message-ID: <4F196F1B.3090909@rabbitmq.com>

The port is 56720, not 5672.

Cheers, Simon

On 20/01/12 02:50, Sunil Agrawal wrote:
> Hi,
> I just installed version 2.7.1 of RabbitMQ and enabled the plugin
> rabbitmq-jsonrpc-channel. Then using a browser I browsed to
> http://localhost:5672/rpc/rabbitmq and instead of getting the message
> mentioned here (https://github.com/rabbitmq/rabbitmq-jsonrpc-
> channel/), I just got 'AMQP 0.0.9.1.
>
> Looking at the status using rabbitmqctl status, does show that the
> plugin is installed and running :
> [{pid,1656},
>   {running_applications,
>       [{rabbitmq_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","2.7.1"},
>        {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>        {rabbit,"RabbitMQ","2.7.1"},
>        {os_mon,"CPO  CXC 138 46","2.2.8"},
>        {sasl,"SASL  CXC 138 11","2.2"},
>        {rabbitmq_jsonrpc,"Rabbit JSON-RPC","2.7.1"},
>        {rfc4627_jsonrpc,"JSON RPC Service","2.7.1-git"},
>        {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
>        {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
>        {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
>        {inets,"INETS  CXC 138 49","5.8"},
>        {mnesia,"MNESIA  CXC 138 12","4.6"},
>        {stdlib,"ERTS  CXC 138 10","1.18"},
>        {kernel,"ERTS  CXC 138 10","2.15"}]},
>   {os,{win32,nt}},
>   {erlang_version,"Erlang R15B (erts-5.9) [smp:2:2] [async-threads:
> 30]\n"},
>   {memory,
>       [{total,17072208},
>        {processes,5881777},
>        {processes_used,5881762},
>        {system,11190431},
>        {atom,424265},
>        {atom_used,398041},
>        {binary,182512},
>        {code,7973732},
>        {ets,585116}]},
>   {vm_memory_high_watermark,0.26719464674914045},
>   {vm_memory_limit,858993459}]
> ...done.
>
> Any suggestions on how to fix it?
>
> Thanks, Sunil
>
> P.S. Excuse me if this a duplicate message from me shows up, the
> previous one didn't make it through, so resending it.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 20 13:43:05 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Jan 2012 13:43:05 +0000
Subject: [rabbitmq-discuss] Error installing/configuring Jsonrpc Channel
 plugin
In-Reply-To: <4F196F1B.3090909@rabbitmq.com>
References: <8911cdcf-ef15-469a-b36d-89d84061f80a@q7g2000pbg.googlegroups.com>
	<4F196F1B.3090909@rabbitmq.com>
Message-ID: <4F196F69.7040004@rabbitmq.com>

Ahem, 55670. D'oh!

Cheers, Simon

On 20/01/12 13:41, Simon MacMullen wrote:
> The port is 56720, not 5672.
>
> Cheers, Simon
>
> On 20/01/12 02:50, Sunil Agrawal wrote:
>> Hi,
>> I just installed version 2.7.1 of RabbitMQ and enabled the plugin
>> rabbitmq-jsonrpc-channel. Then using a browser I browsed to
>> http://localhost:5672/rpc/rabbitmq and instead of getting the message
>> mentioned here (https://github.com/rabbitmq/rabbitmq-jsonrpc-
>> channel/), I just got 'AMQP 0.0.9.1.
>>
>> Looking at the status using rabbitmqctl status, does show that the
>> plugin is installed and running :
>> [{pid,1656},
>> {running_applications,
>> [{rabbitmq_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","2.7.1"},
>> {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>> {rabbit,"RabbitMQ","2.7.1"},
>> {os_mon,"CPO CXC 138 46","2.2.8"},
>> {sasl,"SASL CXC 138 11","2.2"},
>> {rabbitmq_jsonrpc,"Rabbit JSON-RPC","2.7.1"},
>> {rfc4627_jsonrpc,"JSON RPC Service","2.7.1-git"},
>> {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
>> {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
>> {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
>> {inets,"INETS CXC 138 49","5.8"},
>> {mnesia,"MNESIA CXC 138 12","4.6"},
>> {stdlib,"ERTS CXC 138 10","1.18"},
>> {kernel,"ERTS CXC 138 10","2.15"}]},
>> {os,{win32,nt}},
>> {erlang_version,"Erlang R15B (erts-5.9) [smp:2:2] [async-threads:
>> 30]\n"},
>> {memory,
>> [{total,17072208},
>> {processes,5881777},
>> {processes_used,5881762},
>> {system,11190431},
>> {atom,424265},
>> {atom_used,398041},
>> {binary,182512},
>> {code,7973732},
>> {ets,585116}]},
>> {vm_memory_high_watermark,0.26719464674914045},
>> {vm_memory_limit,858993459}]
>> ...done.
>>
>> Any suggestions on how to fix it?
>>
>> Thanks, Sunil
>>
>> P.S. Excuse me if this a duplicate message from me shows up, the
>> previous one didn't make it through, so resending it.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Fri Jan 20 14:25:35 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 20 Jan 2012 14:25:35 +0000
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
In-Reply-To: <4F196248.7050400@rabbitmq.com>
References: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>	<4F144193.5040109@rabbitmq.com>
	<384f67bd-c561-4728-8796-7528863d9176@k3g2000pbn.googlegroups.com>
	<4F196248.7050400@rabbitmq.com>
Message-ID: <6A25D10C-5951-4153-A190-8A574D2B1905@rabbitmq.com>

Just a thought,

If you go the way Simon says and have something from outside poking the mgmt API
every few minutes, make sure you issue queueDelete with the if-empty bit set. 
There is a window between the poking and the deleting in which messages may
arrive on the queue (i.e. it's not idle anymore), and it may even not be in-use
(have consumers) by the time you get to it.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 20 Jan 2012, at 12:47, Simon MacMullen wrote:

> On 16/01/12 15:56, Yogesh Ketkar wrote:
>> I would like to delete the queue with no messages in it and so asked
>> the question.
> 
> I see.
> 
>> Can you suggest an alternative to achieve
>> 1. Delete the queue when last event processed from the queue has
>> <Action>Delete</Action>  as this implies that
>>    no more events with same<AppId>  would ever get created.
> 
> Well, you could have your client do that.
> 
>> 2. Delete the queue when it is IDLE for certain period, meaning it is
>> empty and no more event was added to it for certain time period.
> 
> Hmm. Well there's nothing built in to do this, but you could have something from outside poking the mgmt API every few minutes - look at the output of (e.g.)
> 
> rabbitmqadmin list queues name messages consumers idle_since
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120120/bd7c1ad6/attachment.htm>

From emile at rabbitmq.com  Fri Jan 20 14:27:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 20 Jan 2012 14:27:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ newbie question
In-Reply-To: <bf969a6f-ed0b-463a-82f7-af26daae98ae@rk3g2000pbb.googlegroups.com>
References: <bf969a6f-ed0b-463a-82f7-af26daae98ae@rk3g2000pbb.googlegroups.com>
Message-ID: <4F1979D1.8010409@rabbitmq.com>

Hi Sunil,

On 19/01/12 22:29, Sunil Agrawal wrote:
> Hi,
> 
> I have a question about RabbitMQ and JSON RPC channel on Windows. I
> installed RabbitMQ 2.7.1 on Windows and enabled the JSON RPC channel
> as described on github (https://github.com/rabbitmq/rabbitmq-jsonrpc-
> channel). When I enabled the plugin it shows that the plugin has been
> configured.  Below are the results of the rabbitmqctl status command.
> However when using the browser I go to http://localhost:5672/rpc/rabbitmq
> I do NOT get the message described in GitHub, rather only 'AMQP.

You are probably using the wrong port. The JSON RPC plugin uses 55672 by
default, while you seem to be using the AMQP port.

You can visit http://dev.rabbitmq.com/www-examples/test/index.html to
get a better idea of how the tests are supposed to behave.


-Emile

From emile at rabbitmq.com  Fri Jan 20 14:56:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 20 Jan 2012 14:56:48 +0000
Subject: [rabbitmq-discuss] RabbitMQ newbie question
In-Reply-To: <4F1979D1.8010409@rabbitmq.com>
References: <bf969a6f-ed0b-463a-82f7-af26daae98ae@rk3g2000pbb.googlegroups.com>
	<4F1979D1.8010409@rabbitmq.com>
Message-ID: <4F1980B0.6000707@rabbitmq.com>

On 20/01/12 14:27, Emile Joubert wrote:
> Hi Sunil,
> 
> On 19/01/12 22:29, Sunil Agrawal wrote:
>> Hi,
>>
>> I have a question about RabbitMQ and JSON RPC channel on Windows. I
>> installed RabbitMQ 2.7.1 on Windows and enabled the JSON RPC channel
>> as described on github (https://github.com/rabbitmq/rabbitmq-jsonrpc-
>> channel). When I enabled the plugin it shows that the plugin has been
>> configured.  Below are the results of the rabbitmqctl status command.
>> However when using the browser I go to http://localhost:5672/rpc/rabbitmq
>> I do NOT get the message described in GitHub, rather only 'AMQP.
> 
> You are probably using the wrong port.

Please ignore my response. I see Simon has already answered your
question correctly.


-Emile

From djacobfeuerborn at gmail.com  Fri Jan 20 16:58:52 2012
From: djacobfeuerborn at gmail.com (Dennis Jacobfeuerborn)
Date: Fri, 20 Jan 2012 08:58:52 -0800 (PST)
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <4F196036.3050708@rabbitmq.com>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>
	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>
	<4F196036.3050708@rabbitmq.com>
Message-ID: <2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>

The dump is 1.8M big. Should I send this to a specific email address? I can 
also put the file on a web server.

It seems the memory is consumed by the queues. Notice how this queue 
consumes 142mb event though there are no messages queued.

...
<rabbit@ rabbitmq1.2.464.0>      Exactag.Click.MySql.Stat        true    
false   []                                              0       0       
0       4       142211320       [{q1,0}, {q2,0}, 
{delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, 
{pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, 
{ram_ack_count,0}, {next_seq_id,741980}, {persistent_count,0}, 
{avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, 
{avg_ack_egress_rate,0.0}]
...

Regards,
  Dennis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120120/5f53618f/attachment.htm>

From dawgtool at aol.com  Fri Jan 20 22:14:21 2012
From: dawgtool at aol.com (DawgTool)
Date: Fri, 20 Jan 2012 17:14:21 -0500
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures on
	Queue Bind - 2012-01-20
Message-ID: <4F19E73D.9080107@aol.com>

Hi All,

Trying to setup Federation across two RabbitMQ clusters (2.7.1, R15B).
Everything seems to start up fine, but then I have a constant stream of 
disconnects, in some cases it doesn't clear the connection, just keeps 
adding more (killed it after reaching several hundred).
It seems to start once I bind a queue to the exchange (dc001-exchange-d) 
on the DOWNSTREAM server.


******************** CONFIG on UPSTREAM ********************
==> enabled_plugins <==
[rabbitmq_management,rabbitmq_management_agent,rabbitmq_management_visualiser,rabbitmq_federation].

==> rabbitmq.config <==
[
   {rabbit,                    [{vm_memory_high_watermark, 0.6},
                                {collect_statistics_interval, 5000},
                                {hipe_compile, true}
                               ]
   },
   {mnesia,                    [{dc_dump_limit, 40},
                                {dump_log_write_threshold, 50000},
                                {send_compressed, 9},
                                {snmp, true}
                               ]
   },
   {rabbitmq_management,       [ {http_log_dir, 
"/data/rabbitmq/dc001/rabbit-mgmt"} ] },
   {rabbitmq_management_agent, [ {force_fine_statistics, true} ] },

   {rabbitmq_federation,       [{exchanges, [
                                       [{exchange, "dc001-exchange-d"}, 
{virtual_host, "/"}, {type, "fanout"}, {durable, true}, {auto_delete, 
false}, {internal, false}, {upstream_set, "dc001-servers"} ]
                                      ]},
                                {upstream_sets, [
                                           {"dc001-servers", [
                                            [{connection, "host-001"}, 
{exchange, "dc001-exchange-u"}, {max_hops, 1}]
                                           ]}
                                          ]},
                                {connections,   [
                                           {"host-001", [{host, 
"host-001.domain.com"}, {protocol, "amqp"}, {port, 5672},
                                                           {mechanism, 
default}, {prefetch_count, 1000}, {virtual_host, "/"},
                                                           {username, 
"guest"}, {password, "guest"}, {reconnect_delay, 10},
                                                           {heartbeat, 5}]}
                                          ]},
                                {local_username, "guest"}
                               ]}
].

==> rabbitmq-env.conf <==
NODENAME=dc001
BASE=/data/rabbitmq/dc001
MNESIA_BASE=/data/rabbitmq/dc001/mnesia
LOG_BASE=/data/rabbitmq/dc001/log
SERVER_START_ARGS="+K true -smp enable"


******************** Log on UPSTREAM ********************
=INFO REPORT==== 20-Jan-2012::16:15:27 ===
accepted TCP connection on 0.0.0.0:5672 from 192.168.0.48:49407

=INFO REPORT==== 20-Jan-2012::16:15:27 ===
starting TCP connection <0.32601.22> from 192.168.0.48:49407

=ERROR REPORT==== 20-Jan-2012::16:15:27 ===
connection <0.32601.22>, channel 2 - error:
{amqp_error,not_found,
             "no exchange 'federation: dc001-exchange-u -> 
dc001 at host-007.domain.com:dc001-exchange-d A' in vhost '/'",
             'exchange.delete'}

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
connection <0.32601.22>, channel 1 - error:
{amqp_error,not_found,"no exchange 'dc001-exchange-u' in vhost '/'",
             'exchange.bind'}

=INFO REPORT==== 20-Jan-2012::16:30:42 ===
closing TCP connection <0.32601.22> from 192.168.0.48:49407

=INFO REPORT==== 20-Jan-2012::16:30:42 ===
accepted TCP connection on 0.0.0.0:5672 from 192.168.0.48:55900

=INFO REPORT==== 20-Jan-2012::16:30:42 ===
starting TCP connection <0.7666.23> from 192.168.0.48:55900

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
connection <0.7666.23>, channel 2 - error:
{amqp_error,not_found,
             "no exchange 'federation: dc001-exchange-u -> 
dc001 at host-007.domain.com:dc001-exchange-d A' in vhost '/'",
             'exchange.delete'}

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
connection <0.7666.23>, channel 1 - error:
{amqp_error,not_found,"no exchange 'dc001-exchange-u' in vhost '/'",
             'exchange.bind'}





******************** Log on DOWNSTREAM ********************
=INFO REPORT==== 20-Jan-2012::16:15:27 ===
Federation exchange 'dc001-exchange-d' in vhost '/' connected to 
host-001.domain.com:5672:/:dc001-exchange-u

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
** Generic server <0.4323.0> terminating
** Last message in was {'$gen_cast',
                         {enqueue,1,
                          {add_binding,
                           {binding,
                            
{resource,<<"/">>,exchange,<<"dc001-exchange-d">>},
<<>>,
                            {resource,<<"/">>,queue,
<<"dc.omniture:mongodb:all">>},
                            []}}}}
** When Server state == {state,
                             {upstream,
                                 
{amqp_params_network,<<"guest">>,<<"guest">>,
<<"/">>,"host-001.domain.com",5672,0,0,
                                     5,infinity,none,
                                     [#Fun<amqp_auth_mechanisms.plain.3>,
                                      
#Fun<amqp_auth_mechanisms.amqplain.3>],
                                     [],[]},
<<"dc001-exchange-u">>,1000,1,10,none,none,
                                 "host-001"},
<0.4340.0>,<0.4350.0>,
<<"federation: dc001-exchange-u -> 
dc001 at host-007.domain.com:dc001-exchange-d">>,
<<"federation: dc001-exchange-u -> 
dc001 at host-007.domain.com:dc001-exchange-d B">>,
                             {0,nil},
                             1,
                             {dict,0,16,16,8,80,48,
                                 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  []},
                                 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
<0.4327.0>,<0.4335.0>,
                             
{resource,<<"/">>,exchange,<<"dc001-exchange-d">>},
                             {0,nil}}
** Reason for termination ==
** {{shutdown,
         {server_initiated_close,404,
<<"NOT_FOUND - no exchange 'dc001-exchange-u' in vhost '/'">>}},
     {gen_server,call,
         [<0.4350.0>,
          {call,
              {'exchange.bind',0,
<<"federation: dc001-exchange-u -> 
dc001 at host-007.domain.com:dc001-exchange-d B">>,
<<"dc001-exchange-u">>,<<>>,false,[]},
              none,<0.4323.0>},
          infinity]}}

=ERROR REPORT==== 20-Jan-2012::16:30:42 ===
** Generic server <0.12029.0> terminating
** Last message in was {'$gen_cast',maybe_go}
** When Server state == {not_started,
                             {{upstream,
                                  {amqp_params_network,<<"guest">>,
<<"guest">>,<<"/">>,
                                      "host-001.domain.com",5672,0,0,5,
                                      infinity,none,
                                      [#Fun<amqp_auth_mechanisms.plain.3>,
                                       
#Fun<amqp_auth_mechanisms.amqplain.3>],
                                      [],[]},
<<"dc001-exchange-u">>,1000,1,10,none,none,
                                  "host-001"},
                              {resource,<<"/">>,exchange,
<<"dc001-exchange-d">>}}}
** Reason for termination ==
** {{shutdown,
         {server_initiated_close,404,
<<"NOT_FOUND - no exchange 'dc001-exchange-u' in vhost '/'">>}},
     {gen_server,call,
         [<0.12056.0>,
          {call,
              {'exchange.bind',0,
<<"federation: dc001-exchange-u -> 
dc001 at host-007.domain.com:dc001-exchange-d A">>,
<<"dc001-exchange-u">>,<<>>,false,[]},
              none,<0.12029.0>},
          infinity]}}


From sunil at armor5.com  Sat Jan 21 00:35:16 2012
From: sunil at armor5.com (Sunil Agrawal)
Date: Fri, 20 Jan 2012 16:35:16 -0800 (PST)
Subject: [rabbitmq-discuss] Error installing/configuring Jsonrpc Channel
	plugin
In-Reply-To: <4F196F69.7040004@rabbitmq.com>
References: <8911cdcf-ef15-469a-b36d-89d84061f80a@q7g2000pbg.googlegroups.com>
	<4F196F1B.3090909@rabbitmq.com> <4F196F69.7040004@rabbitmq.com>
Message-ID: <c1cff976-5eb9-4e54-a27d-95d2260b1c58@q7g2000pbg.googlegroups.com>

Thanks Simon, that did the trick. Who can update the instructions on
github so that it doesn't stumble the next guy. Hopefully should be a
quick one.

Where can I find information on all the commands and their arguments
supported by JsonRpcChannel? Immediately I am looking for how to
'reject' or 'nack' a message and didn't find anything looking through
the source code.

Thanks in advance,
Sunil

On Jan 20, 5:43?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> Ahem, 55670. D'oh!
>
> Cheers, Simon
>
> On 20/01/12 13:41, Simon MacMullen wrote:
>
> > The port is 56720, not 5672.
>
> > Cheers, Simon
>
> > On 20/01/12 02:50, Sunil Agrawal wrote:
> >> Hi,
> >> I just installed version 2.7.1 of RabbitMQ and enabled the plugin
> >> rabbitmq-jsonrpc-channel. Then using a browser I browsed to
> >>http://localhost:5672/rpc/rabbitmqand instead of getting the message
> >> mentioned here (https://github.com/rabbitmq/rabbitmq-jsonrpc-
> >> channel/), I just got 'AMQP 0.0.9.1.
>
> >> Looking at the status using rabbitmqctl status, does show that the
> >> plugin is installed and running :
> >> [{pid,1656},
> >> {running_applications,
> >> [{rabbitmq_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","2.7.1"},
> >> {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
> >> {rabbit,"RabbitMQ","2.7.1"},
> >> {os_mon,"CPO CXC 138 46","2.2.8"},
> >> {sasl,"SASL CXC 138 11","2.2"},
> >> {rabbitmq_jsonrpc,"Rabbit JSON-RPC","2.7.1"},
> >> {rfc4627_jsonrpc,"JSON RPC Service","2.7.1-git"},
> >> {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
> >> {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
> >> {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
> >> {inets,"INETS CXC 138 49","5.8"},
> >> {mnesia,"MNESIA CXC 138 12","4.6"},
> >> {stdlib,"ERTS CXC 138 10","1.18"},
> >> {kernel,"ERTS CXC 138 10","2.15"}]},
> >> {os,{win32,nt}},
> >> {erlang_version,"Erlang R15B (erts-5.9) [smp:2:2] [async-threads:
> >> 30]\n"},
> >> {memory,
> >> [{total,17072208},
> >> {processes,5881777},
> >> {processes_used,5881762},
> >> {system,11190431},
> >> {atom,424265},
> >> {atom_used,398041},
> >> {binary,182512},
> >> {code,7973732},
> >> {ets,585116}]},
> >> {vm_memory_high_watermark,0.26719464674914045},
> >> {vm_memory_limit,858993459}]
> >> ...done.
>
> >> Any suggestions on how to fix it?
>
> >> Thanks, Sunil
>
> >> P.S. Excuse me if this a duplicate message from me shows up, the
> >> previous one didn't make it through, so resending it.
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.com
> >>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From taylste at gmail.com  Sat Jan 21 10:19:11 2012
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 21 Jan 2012 10:19:11 +0000
Subject: [rabbitmq-discuss] ReplyTo / ReplyToAddress fail to
	betransferred
In-Reply-To: <4F16C153.9060307@rabbitmq.com>
References: <CA+zYriQdiq=ig-T4dOWTbg=iOXU5x18GyMnk9zEKY2jzk+SVRQ@mail.gmail.com>
	<4F169E23.2050800@rabbitmq.com>
	<CA+zYriThYu_G=VzZgJeZ1VZ3Qqr0g-f5s4ZE2Cm6=Q=D+v=dOw@mail.gmail.com>
	<88E590DC4586974D825FC82AE798294E520DFD5C@GSVCLU04.ges.ferlan.it>
	<CA+zYriROSa_jiSnXd_JPyWZT_ji_4ymQLxekKR9o6vNyw5Nc9Q@mail.gmail.com>
	<4F16C153.9060307@rabbitmq.com>
Message-ID: <CA+zYriTuOgk9UNF724HizrV9rKgKqrNaRAzf4ixu5LvMY7wVPA@mail.gmail.com>

possible cause... prior to adopting the rabbit url-style format for queue
identification

e.g. exhangeType://exchange/routing.key

I was using "exchange::routing.key" in the reply-to property.  *Perhaps*
the rabbit client got intollerant of my naming scheme while I wasn't
looking.  Not sure.  It is working now.  Just thought I'd email this note
as a follow up.




On 18 January 2012 12:55, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Steven,
>
> On 18/01/12 12:34, Steven Taylor wrote:
> > I tried with publication address which is there for convenience method
> > if I remember correctly and also reply-to.  The info just isn't turning
> > up in the subscriber.  It is set successfully in the publisher.  No
> > exceptions.
>
> To solve this issue can you supply a minimal example that exhibits the
> faulty behaviour?
>
> Another useful diagnostic aid is to connect to the broker via the
> protocol tracer, or to observe the network traffic with Wireshark (which
> has an AMQP protocol analyser). This will confirm whether the producer,
> broker or consumer are at fault.
>
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120121/acd41ce0/attachment.htm>

From static.void.dev at gmail.com  Sat Jan 21 17:37:21 2012
From: static.void.dev at gmail.com (Mark)
Date: Sat, 21 Jan 2012 09:37:21 -0800
Subject: [rabbitmq-discuss] AMQP, Bunny and Carrot Gems
Message-ID: <4F1AF7D1.5040109@gmail.com>

Sorry for my ignorance but can someone please explain why someone would 
use the Bunny or Carrot synchronous gems over the standard Ruby-AMQP 
gem? Is it more safe because the call to the broker is blocked until it 
receives a response while as the ruby-amqp could fail? How much of a 
performance penalty is there for using amqp synchronously. Typically 
which is used more... Carrot or Bunny and why?

Thanks for the input

From pbell at syncsort.com  Sat Jan 21 21:57:55 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sat, 21 Jan 2012 16:57:55 -0500
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>

Hi,

Suppose I have a producer on NodeP, a broker on NodeB, and a consumer on NodeC. Suppose further that explicit acks are required (i.e., if I've understood the docs, that "noack" is not in effect) and that after consuming a message from the queue, NodeC.consumer dispatches some other work in order to process that message. IOW: NodeC.consumer doesn't respond immediately with an ack.

So, from NodeB.broker's point of view, the message has been moved from the exchange to the queue, consumed, but not yet ack-ed.

What will happen under these two scenarios:

1. NodeB.broker bounces - when broker restarts what will he do with un-acked messages that have been delivered to queue and haven't been ack-ed; e.g., will these be again delivered to the queue?


2. NodeC.consumer bounces - when consumer restarts is there any way he can again consume the un-acked message, and begin again the work that this message represents? (I suppose that NodeB.broker might be implicated here because it might detect the loss of connection to the NodeC.consumer....).


When I say "bounces," I mean at a minimum that the application (broker, consumer) crashed and restarted. But I am also interested in the case where the node's OS is for whatever reason rebooted. Perhaps it looks no different.

Thanks for your help.

-Paul



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From jasonjwwilliams at gmail.com  Sat Jan 21 22:05:55 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sat, 21 Jan 2012 15:05:55 -0700
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>
Message-ID: <19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>

Hi Paul,

If the messages were published with the durable flag and the queues are durable, the messages will survive the broker restart and be re-presented to consumers. If the messages or the queues were not durable they will disappear after restart. 

-J

Sent via iPhone

Is your email Premiere?

On Jan 21, 2012, at 14:57, "Bell, Paul M." <pbell at syncsort.com> wrote:

> Hi,
> 
> Suppose I have a producer on NodeP, a broker on NodeB, and a consumer on NodeC. Suppose further that explicit acks are required (i.e., if I've understood the docs, that "noack" is not in effect) and that after consuming a message from the queue, NodeC.consumer dispatches some other work in order to process that message. IOW: NodeC.consumer doesn't respond immediately with an ack.
> 
> So, from NodeB.broker's point of view, the message has been moved from the exchange to the queue, consumed, but not yet ack-ed.
> 
> What will happen under these two scenarios:
> 
> 1. NodeB.broker bounces - when broker restarts what will he do with un-acked messages that have been delivered to queue and haven't been ack-ed; e.g., will these be again delivered to the queue?
> 
> 
> 2. NodeC.consumer bounces - when consumer restarts is there any way he can again consume the un-acked message, and begin again the work that this message represents? (I suppose that NodeB.broker might be implicated here because it might detect the loss of connection to the NodeC.consumer....).
> 
> 
> When I say "bounces," I mean at a minimum that the application (broker, consumer) crashed and restarted. But I am also interested in the case where the node's OS is for whatever reason rebooted. Perhaps it looks no different.
> 
> Thanks for your help.
> 
> -Paul
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pbell at syncsort.com  Sat Jan 21 22:18:58 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sat, 21 Jan 2012 17:18:58 -0500
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>,
	<19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com>

I apologize. I should have stated up front that the queues and messages are durable.

What happens in case 2, where the consumer bounces?

Thanks, Jason.

-Paul

________________________________________
From: Jason J. W. Williams [jasonjwwilliams at gmail.com]
Sent: Saturday, January 21, 2012 5:05 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery

Hi Paul,

If the messages were published with the durable flag and the queues are durable, the messages will survive the broker restart and be re-presented to consumers. If the messages or the queues were not durable they will disappear after restart.

-J

Sent via iPhone

Is your email Premiere?

On Jan 21, 2012, at 14:57, "Bell, Paul M." <pbell at syncsort.com> wrote:

> Hi,
>
> Suppose I have a producer on NodeP, a broker on NodeB, and a consumer on NodeC. Suppose further that explicit acks are required (i.e., if I've understood the docs, that "noack" is not in effect) and that after consuming a message from the queue, NodeC.consumer dispatches some other work in order to process that message. IOW: NodeC.consumer doesn't respond immediately with an ack.
>
> So, from NodeB.broker's point of view, the message has been moved from the exchange to the queue, consumed, but not yet ack-ed.
>
> What will happen under these two scenarios:
>
> 1. NodeB.broker bounces - when broker restarts what will he do with un-acked messages that have been delivered to queue and haven't been ack-ed; e.g., will these be again delivered to the queue?
>
>
> 2. NodeC.consumer bounces - when consumer restarts is there any way he can again consume the un-acked message, and begin again the work that this message represents? (I suppose that NodeB.broker might be implicated here because it might detect the loss of connection to the NodeC.consumer....).
>
>
> When I say "bounces," I mean at a minimum that the application (broker, consumer) crashed and restarted. But I am also interested in the case where the node's OS is for whatever reason rebooted. Perhaps it looks no different.
>
> Thanks for your help.
>
> -Paul
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Sat Jan 21 22:24:56 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 21 Jan 2012 23:24:56 +0100
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>
	<19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com>
Message-ID: <CAOn7oW-y1iUDxj5yvCPpH7nb0XU2=5zp6Lq8oisvB84UK5-7Sw@mail.gmail.com>

Also in case 2 the broker will redeliver all messages that were not acked,
although it doesn't necessarily mean that the consumer didn't really
consume them already. For that you should look at the redelivered flag.
On Jan 21, 2012 11:20 PM, "Bell, Paul M." <pbell at syncsort.com> wrote:

> I apologize. I should have stated up front that the queues and messages
> are durable.
>
> What happens in case 2, where the consumer bounces?
>
> Thanks, Jason.
>
> -Paul
>
> ________________________________________
> From: Jason J. W. Williams [jasonjwwilliams at gmail.com]
> Sent: Saturday, January 21, 2012 5:05 PM
> To: Bell, Paul M.
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
>
> Hi Paul,
>
> If the messages were published with the durable flag and the queues are
> durable, the messages will survive the broker restart and be re-presented
> to consumers. If the messages or the queues were not durable they will
> disappear after restart.
>
> -J
>
> Sent via iPhone
>
> Is your email Premiere?
>
> On Jan 21, 2012, at 14:57, "Bell, Paul M." <pbell at syncsort.com> wrote:
>
> > Hi,
> >
> > Suppose I have a producer on NodeP, a broker on NodeB, and a consumer on
> NodeC. Suppose further that explicit acks are required (i.e., if I've
> understood the docs, that "noack" is not in effect) and that after
> consuming a message from the queue, NodeC.consumer dispatches some other
> work in order to process that message. IOW: NodeC.consumer doesn't respond
> immediately with an ack.
> >
> > So, from NodeB.broker's point of view, the message has been moved from
> the exchange to the queue, consumed, but not yet ack-ed.
> >
> > What will happen under these two scenarios:
> >
> > 1. NodeB.broker bounces - when broker restarts what will he do with
> un-acked messages that have been delivered to queue and haven't been
> ack-ed; e.g., will these be again delivered to the queue?
> >
> >
> > 2. NodeC.consumer bounces - when consumer restarts is there any way he
> can again consume the un-acked message, and begin again the work that this
> message represents? (I suppose that NodeB.broker might be implicated here
> because it might detect the loss of connection to the NodeC.consumer....).
> >
> >
> > When I say "bounces," I mean at a minimum that the application (broker,
> consumer) crashed and restarted. But I am also interested in the case where
> the node's OS is for whatever reason rebooted. Perhaps it looks no
> different.
> >
> > Thanks for your help.
> >
> > -Paul
> >
> >
> >
> > ATTENTION: -----
> >
> > The information contained in this message (including any files
> transmitted with this message) may contain proprietary, trade secret or
> other  confidential and/or legally privileged information. Any pricing
> information contained in this message or in any files transmitted with this
> message is always confidential and cannot be shared with any third parties
> without prior written approval from Syncsort. This message is intended to
> be read only by the individual or entity to whom it is addressed or by
> their designee. If the reader of this message is not the intended
> recipient, you are on notice that any use, disclosure, copying or
> distribution of this message, in any form, is strictly prohibited. If you
> have received this message in error, please immediately notify the sender
> and/or Syncsort and destroy all copies of this message in your possession,
> custody or control.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120121/5c64b035/attachment.htm>

From pbell at syncsort.com  Sat Jan 21 22:39:03 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sat, 21 Jan 2012 17:39:03 -0500
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <CAOn7oW-y1iUDxj5yvCPpH7nb0XU2=5zp6Lq8oisvB84UK5-7Sw@mail.gmail.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>
	<19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com> <
	AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com>
	<CAOn7oW-y1iUDxj5yvCPpH7nb0XU2=5zp6Lq8oisvB84UK5-7Sw@mail.gmail.com>
Message-ID: <C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com>

Thank you both.

-Paul

On Jan 21, 2012, at 5:24 PM, "Simone Busoli" <simone.busoli at gmail.com<mailto:simone.busoli at gmail.com>> wrote:


Also in case 2 the broker will redeliver all messages that were not acked, although it doesn't necessarily mean that the consumer didn't really consume them already. For that you should look at the redelivered flag.

On Jan 21, 2012 11:20 PM, "Bell, Paul M." <<mailto:pbell at syncsort.com>pbell at syncsort.com<mailto:pbell at syncsort.com>> wrote:
I apologize. I should have stated up front that the queues and messages are durable.

What happens in case 2, where the consumer bounces?

Thanks, Jason.

-Paul

________________________________________
From: Jason J. W. Williams [<mailto:jasonjwwilliams at gmail.com>jasonjwwilliams at gmail.com<mailto:jasonjwwilliams at gmail.com>]
Sent: Saturday, January 21, 2012 5:05 PM
To: Bell, Paul M.
Cc: <mailto:rabbitmq-discuss at lists.rabbitmq.com> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery

Hi Paul,

If the messages were published with the durable flag and the queues are durable, the messages will survive the broker restart and be re-presented to consumers. If the messages or the queues were not durable they will disappear after restart.

-J

Sent via iPhone

Is your email Premiere?

On Jan 21, 2012, at 14:57, "Bell, Paul M." <<mailto:pbell at syncsort.com>pbell at syncsort.com<mailto:pbell at syncsort.com>> wrote:

> Hi,
>
> Suppose I have a producer on NodeP, a broker on NodeB, and a consumer on NodeC. Suppose further that explicit acks are required (i.e., if I've understood the docs, that "noack" is not in effect) and that after consuming a message from the queue, NodeC.consumer dispatches some other work in order to process that message. IOW: NodeC.consumer doesn't respond immediately with an ack.
>
> So, from NodeB.broker's point of view, the message has been moved from the exchange to the queue, consumed, but not yet ack-ed.
>
> What will happen under these two scenarios:
>
> 1. NodeB.broker bounces - when broker restarts what will he do with un-acked messages that have been delivered to queue and haven't been ack-ed; e.g., will these be again delivered to the queue?
>
>
> 2. NodeC.consumer bounces - when consumer restarts is there any way he can again consume the un-acked message, and begin again the work that this message represents? (I suppose that NodeB.broker might be implicated here because it might detect the loss of connection to the NodeC.consumer....).
>
>
> When I say "bounces," I mean at a minimum that the application (broker, consumer) crashed and restarted. But I am also interested in the case where the node's OS is for whatever reason rebooted. Perhaps it looks no different.
>
> Thanks for your help.
>
> -Paul
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> <mailto:rabbitmq-discuss at lists.rabbitmq.com> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
<mailto:rabbitmq-discuss at lists.rabbitmq.com>rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120121/5ab97e7b/attachment.htm>

From simone.busoli at gmail.com  Sat Jan 21 22:47:44 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 21 Jan 2012 23:47:44 +0100
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>
	<19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>
	<CAOn7oW-y1iUDxj5yvCPpH7nb0XU2=5zp6Lq8oisvB84UK5-7Sw@mail.gmail.com>
	<C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com>
Message-ID: <CAOn7oW_j8qmHhmmtg+8gnUTy3MZ2N1m+eiBc05x8jJZ+Gy_EFw@mail.gmail.com>

By the way, I suggest you to set up some exploratory tests, they are very
useful to figure out how the broker behaves under certain circumstances. In
this case it may not be obvious the order in which unacked messages will be
redelivered. Just recently the behavior of the broker has changed whereby
messages are put at the top of the queue, while it used to be at the end.
On Jan 21, 2012 11:39 PM, "Bell, Paul M." <pbell at syncsort.com> wrote:

> Thank you both.
>
> -Paul
>
> On Jan 21, 2012, at 5:24 PM, "Simone Busoli" <simone.busoli at gmail.com>
> wrote:
>
> Also in case 2 the broker will redeliver all messages that were not acked,
> although it doesn't necessarily mean that the consumer didn't really
> consume them already. For that you should look at the redelivered flag.
> On Jan 21, 2012 11:20 PM, "Bell, Paul M." <pbell at syncsort.com> wrote:
>
>> I apologize. I should have stated up front that the queues and messages
>> are durable.
>>
>> What happens in case 2, where the consumer bounces?
>>
>> Thanks, Jason.
>>
>> -Paul
>>
>> ________________________________________
>> From: Jason J. W. Williams [jasonjwwilliams at gmail.com]
>> Sent: Saturday, January 21, 2012 5:05 PM
>> To: Bell, Paul M.
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
>>
>> Hi Paul,
>>
>> If the messages were published with the durable flag and the queues are
>> durable, the messages will survive the broker restart and be re-presented
>> to consumers. If the messages or the queues were not durable they will
>> disappear after restart.
>>
>> -J
>>
>> Sent via iPhone
>>
>> Is your email Premiere?
>>
>> On Jan 21, 2012, at 14:57, "Bell, Paul M." <pbell at syncsort.com> wrote:
>>
>> > Hi,
>> >
>> > Suppose I have a producer on NodeP, a broker on NodeB, and a consumer
>> on NodeC. Suppose further that explicit acks are required (i.e., if I've
>> understood the docs, that "noack" is not in effect) and that after
>> consuming a message from the queue, NodeC.consumer dispatches some other
>> work in order to process that message. IOW: NodeC.consumer doesn't respond
>> immediately with an ack.
>> >
>> > So, from NodeB.broker's point of view, the message has been moved from
>> the exchange to the queue, consumed, but not yet ack-ed.
>> >
>> > What will happen under these two scenarios:
>> >
>> > 1. NodeB.broker bounces - when broker restarts what will he do with
>> un-acked messages that have been delivered to queue and haven't been
>> ack-ed; e.g., will these be again delivered to the queue?
>> >
>> >
>> > 2. NodeC.consumer bounces - when consumer restarts is there any way he
>> can again consume the un-acked message, and begin again the work that this
>> message represents? (I suppose that NodeB.broker might be implicated here
>> because it might detect the loss of connection to the NodeC.consumer....).
>> >
>> >
>> > When I say "bounces," I mean at a minimum that the application (broker,
>> consumer) crashed and restarted. But I am also interested in the case where
>> the node's OS is for whatever reason rebooted. Perhaps it looks no
>> different.
>> >
>> > Thanks for your help.
>> >
>> > -Paul
>> >
>> >
>> >
>> > ATTENTION: -----
>> >
>> > The information contained in this message (including any files
>> transmitted with this message) may contain proprietary, trade secret or
>> other  confidential and/or legally privileged information. Any pricing
>> information contained in this message or in any files transmitted with this
>> message is always confidential and cannot be shared with any third parties
>> without prior written approval from Syncsort. This message is intended to
>> be read only by the individual or entity to whom it is addressed or by
>> their designee. If the reader of this message is not the intended
>> recipient, you are on notice that any use, disclosure, copying or
>> distribution of this message, in any form, is strictly prohibited. If you
>> have received this message in error, please immediately notify the sender
>> and/or Syncsort and destroy all copies of this message in your possession,
>> custody or control.
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120121/31fecda0/attachment.htm>

From fearsome.lucidity at gmail.com  Sat Jan 21 22:58:37 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Sat, 21 Jan 2012 14:58:37 -0800
Subject: [rabbitmq-discuss] Shovel questions
Message-ID: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>

We are thinking of exposing a portion of our message bus to customers.  To
do we we will be creating a new cluster that can be exposed and will be
linking it to our existing cluster.

I've looked a the Federation plug-in, but it has a feature disqualifies it
for our purposes.   We'd like to keep communications from our existing
cluster to the new exposed cluster unidirectional.  That means now allowing
incoming connections into the existing cluster, in case there is ever a
RabbitMQ vulnerability (or say, an Erlang or OpenSSL vulnerability) that
would allow the external cluster to be compromised.  Since both cluster are
running RabbitMQ, we don't want an attacker to be able to jump from the
external cluster to the internal one.  From what I've gathered, the AMQP
client that the Federation plug-in uses executed within the downstream
broker, and thus it has to be able to make an AMQP connection to the
upstream broker.

Is that correct?  Any plans to allow for the opposite behavior (upstream
connects to the downstream broker)?

That leaves us with the Shovel plug-in, which can be configured to run on
either the upstream or downstream broker.

One problem with the Shovel plug-in is that it appears you can only manage
the shovels within the configuration file.  Is there no way to manage
shovels online, either through AMQP or a management plug-in?

If neither of those are possible, can RabbitMQ reload its configuration
without restarting?

Finally, its unclear whether you should only define a shovel in a single
node in a cluster or in multiple ones?  If you define it in multiple ones,
does it create multiple shovel clients competing for messages?  If not,
will a shovel fail over if the node with the existing client fails?

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120121/c5fcd934/attachment.htm>

From yogimogi at gmail.com  Sun Jan 22 07:40:03 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Sat, 21 Jan 2012 23:40:03 -0800 (PST)
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
In-Reply-To: <6A25D10C-5951-4153-A190-8A574D2B1905@rabbitmq.com>
References: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>
	<4F144193.5040109@rabbitmq.com>
	<384f67bd-c561-4728-8796-7528863d9176@k3g2000pbn.googlegroups.com>
	<4F196248.7050400@rabbitmq.com>
	<6A25D10C-5951-4153-A190-8A574D2B1905@rabbitmq.com>
Message-ID: <5dd265e5-8315-47aa-a65b-6b9852745986@k3g2000pbn.googlegroups.com>

Thanks Steve and Simon.

I checked that rabbitmqadmin.py uses http calls (RESTful APIs)
provided by RabbitMQ to perform the operations.
Can you provide me a sample
- (either using rabbitmqadmin or using RESTful client) to delete a
queue say "Yogesh" with isEmpty and isUnused flags set to True?
  I could delete the queue using DELETE http request on
http://localhost:55672/api/queues/%2f/Yogesh
  But couldn't figure out a way to specify isEmpty and isUnused flags.
- I was able to do this in a Java client using interface
com.rabbitmq.client.Channel { queueDelete("Yogesh", true, true) }.
  But then, how do I get list of queues using com.rabbitmq.client?

regards, Yogesh



On Jan 20, 7:25?pm, Steve Powell <st... at rabbitmq.com> wrote:
> Just a thought,
>
> If you go the way Simon says and have something from outside poking the mgmt API
> every few minutes, make sure you issue queueDelete with the if-empty bit set.
> There is a window between the poking and the deleting in which messages may
> arrive on the queue (i.e. it's not idle anymore), and it may even not be in-use
> (have consumers) by the time you get to it.
>
> Steve Powell
> st... at rabbitmq.com
> [wrk:+44-2380-111-528begin_of_the_skype_highlighting????????????+44-2380-111-528??????] [mob:+44-7815-838-558begin_of_the_skype_highlighting????????????+44-7815-838-558??????]
>
> On 20 Jan 2012, at 12:47, Simon MacMullen wrote:
>
>
>
>
>
>
>
> > On 16/01/12 15:56, Yogesh Ketkar wrote:
> >> I would like to delete the queue with no messages in it and so asked
> >> the question.
>
> > I see.
>
> >> Can you suggest an alternative to achieve
> >> 1. Delete the queue when last event processed from the queue has
> >> <Action>Delete</Action> ?as this implies that
> >> ? ?no more events with same<AppId> ?would ever get created.
>
> > Well, you could have your client do that.
>
> >> 2. Delete the queue when it is IDLE for certain period, meaning it is
> >> empty and no more event was added to it for certain time period.
>
> > Hmm. Well there's nothing built in to do this, but you could have something from outside poking the mgmt API every few minutes - look at the output of (e.g.)
>
> > rabbitmqadmin list queues name messages consumers idle_since
>
> > Cheers, Simon
>
> > --
> > Simon MacMullen
> > RabbitMQ, VMware
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Sun Jan 22 12:46:15 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sun, 22 Jan 2012 13:46:15 +0100
Subject: [rabbitmq-discuss] Shovel questions
In-Reply-To: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>
References: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>
Message-ID: <CAOn7oW_az9BeOcSxkW25uUrepyz57Y19XgrsmxVSOP9xDuGHHg@mail.gmail.com>

On Sat, Jan 21, 2012 at 23:58, Elias Levy <fearsome.lucidity at gmail.com>wrote:

> We are thinking of exposing a portion of our message bus to customers.  To
> do we we will be creating a new cluster that can be exposed and will be
> linking it to our existing cluster.
>
> I've looked a the Federation plug-in, but it has a feature disqualifies it
> for our purposes.   We'd like to keep communications from our existing
> cluster to the new exposed cluster unidirectional.  That means now allowing
> incoming connections into the existing cluster, in case there is ever a
> RabbitMQ vulnerability (or say, an Erlang or OpenSSL vulnerability) that
> would allow the external cluster to be compromised.  Since both cluster are
> running RabbitMQ, we don't want an attacker to be able to jump from the
> external cluster to the internal one.  From what I've gathered, the AMQP
> client that the Federation plug-in uses executed within the downstream
> broker, and thus it has to be able to make an AMQP connection to the
> upstream broker.
>
> Is that correct?  Any plans to allow for the opposite behavior (upstream
> connects to the downstream broker)?
>

I don't know the internals of the federation plugin well enough to be able
to answer this question. I know that it uses exchange-exchange bindings and
I'm not sure if it's even feasible to have it work in the way you describe.


>
> That leaves us with the Shovel plug-in, which can be configured to run on
> either the upstream or downstream broker.
>
> One problem with the Shovel plug-in is that it appears you can only manage
> the shovels within the configuration file.  Is there no way to manage
> shovels online, either through AMQP or a management plug-in?
>

No, there is no way to do that except in the configuration file.


>
> If neither of those are possible, can RabbitMQ reload its configuration
> without restarting?
>

No, you cannot do that. Nonetheless be aware that shovel is not hard to set
up manually as an external component from the broker, although with some
gotchas. We've been doing that for some time before the federation plugin
was published.


>
> Finally, its unclear whether you should only define a shovel in a single
> node in a cluster or in multiple ones?  If you define it in multiple ones,
> does it create multiple shovel clients competing for messages?  If not,
> will a shovel fail over if the node with the existing client fails?
>

Shovel is a low level mechanis, so whatever you configure it, it will do
what you told it to, i.e. pick messages from one queue and publish them to
some exchange. How you set it up is then up to you according to what you
want to accomplish.


>
> Elias
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120122/7b6da4b9/attachment.htm>

From yogimogi at gmail.com  Sun Jan 22 17:38:40 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Sun, 22 Jan 2012 09:38:40 -0800 (PST)
Subject: [rabbitmq-discuss] Sequential message processing guarantee
Message-ID: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>

Running the code below, gives
channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
    	new DefaultConsumer(channel)  {
        @Override
        public void handleDelivery(String consumerTag, Envelope
envelope, BasicProperties properties, byte[] body) {
                System.out.println(Thread.currentThread().getName());
         }
}

o/p like
pool-1-thread-1
pool-1-thread-2
pool-1-thread-3
etc

There are multiple consumer threads consuming the messages.
Though multiple threads are consuming the messages, I observed that
messages still get processed sequentially.
Is that the case and if NOT, what is the way to guarantee sequential
processing of messages on one queue?

regards, Yogesh


From yogimogi at gmail.com  Sun Jan 22 18:31:03 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Sun, 22 Jan 2012 10:31:03 -0800 (PST)
Subject: [rabbitmq-discuss] Sequential message processing guarantee
Message-ID: <d6db0ae6-e228-42c9-b252-e984931fe24d@pj4g2000pbc.googlegroups.com>

Is basicGet only way to guarantee sequential processing of the
messages on a queue?

while(true) {
	GetResponse res = channel.basicGet(QUEUE_NAME, false);
	if(res != null) {
		// process message
	}
}

regards, Yogesh

From vveludan at gmail.com  Mon Jan 23 00:39:27 2012
From: vveludan at gmail.com (Venkat)
Date: Sun, 22 Jan 2012 16:39:27 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <7DCEDEF1-71CE-495F-A476-5937273CFFC2@rabbitmq.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
	<3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>
	<bf3cdd0c-bd13-4205-9bca-ba77cd179aa1@cs7g2000vbb.googlegroups.com>
	<0CF971BF-82C1-4D62-BB41-2628875837AE@rabbitmq.com>
	<03877dc9-66c8-473b-a99a-6f8c8bf4bb59@d10g2000vbh.googlegroups.com>
	<6ff0e474-a026-449f-994d-f062203175ca@w4g2000vbc.googlegroups.com>
	<C173C983-48CC-4AC1-ADC8-336E9F99B1F4@rabbitmq.com>
	<16d4069e-726a-4121-b412-341cff384c4b@ck5g2000vbb.googlegroups.com>
	<7DCEDEF1-71CE-495F-A476-5937273CFFC2@rabbitmq.com>
Message-ID: <01432630-2a5e-463e-8a41-01e9addc9886@j42g2000vbt.googlegroups.com>

Hi Steve, sorry for the delayed response. Please find the following:
is it still true that the rabbitmqctl report
> command is failing on t-2? I wondered if this might be something to do with the
> user you are running the rabbitmqctl command under? ?Try it with and without
> sudo, for example.
I was running the command without sudo. I will try with sudo and let
you know.

> Your message rate of 40k with only one exception/loss is good, isn't it? I'm not
> certain that the recreate connection code you have used is all necessary, but if
> it works for you, that's fine. What made you put in a 2-second delay (why a
> delay and why 2 seconds)?

Steve in HA Proxy config the check interval was set to 2 seconds.
Therefore I have set 2 seconds delay.
While posting 40K messages, one message was sent with retry option
when I brought down the broker. In other words all 40K messages were
posted to the queue.
But the consumer was losing 4K to 5K messages. I have run several
tests. Consistently 4K-5K messages were lost.
Finally I used channel transaction while posting messages as follows:
	@Bean
	public RabbitTemplate rabbitTemplate() {
		RabbitTemplate template = new RabbitTemplate(connectionFactory());
		template.setChannelTransacted(true);
		template.setMessageConverter(messageConverter());
		configureMDBTemplate(template);
		return template;
	}

Steve I am not sure if I could use confirms with spring-amqp. That's
why I used channel transaction.
Even after using channel transaction, 4K to 5K messages were lost.
This loss was consistent from 10-15 runs.
I have verified the loss of messages having the queue consumer stopped
so that I could track received message count.

Thanks
Venkat





On Jan 16, 10:21?am, Steve Powell <st... at rabbitmq.com> wrote:
> Hi Venkat,
>
> I'm not at all sure what is happening with the cluster nodes. But it is hard to
> tell with the information provided. ?It looks as though your nodes are both
> running as disc nodes happily -- is it still true that the rabbitmqctl report
> command is failing on t-2? I wondered if this might be something to do with the
> user you are running the rabbitmqctl command under? ?Try it with and without
> sudo, for example.
>
> Your message rate of 40k with only one exception/loss is good, isn't it? I'm not
> certain that the recreate connection code you have used is all necessary, but if
> it works for you, that's fine. What made you put in a 2-second delay (why a
> delay and why 2 seconds)?
>
> The only other thing I might suggest is that you investigate publisher confirms.
> This is a lightweight way of knowing that a publish actually got through to the
> rabbitmq node and was successfully passed on (or stored). See
> [http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/] for an
> introduction using Java, and
> [http://www.rabbitmq.com/extensions.html#publishing] for the AMQP details. It
> may be just what you want to know when wondering if your message is lost.
>
> Steve Powell ?(a happy bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 13 Jan 2012, at 05:03, Venkat wrote:
>
> (You did start_app after the cluster command, didn't you??? ?:-))
>
> Hi Steve I did restart the the app.
> Following are the steps I have performed on both nodes:
>
> Starting the second node t-4:
> ./rabbitmq-server -detached
>
> Steps to join t-4 node to t-2:
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl stop_app
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl reset
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster rabbit at t-2 rabbit at t-4
> Clustering node 'rabbit at t-4' with ['rabbit at t-2',
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 'rabbit at t-4'] ...
> ...done.
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl start_app
> Starting node 'rabbit at t-4' ...
> ...done.
>
> Running cluster_status on t-4 node:
> [ecloud at t-4 sbin]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster_status
> Cluster status of node 'rabbit at t-4' ...
> [{nodes,[{disc,['rabbit at t-4','rabbit at t-2']}]},
> {running_nodes,['rabbit at t-2','rabbit at t-4']}]
> ...done.
>
> Running cluster_status on t-2 node (to which t-4 is joined):
> [ecloud at t-2 vv]$ /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/rabbitmqctl cluster_status
> Cluster status of node 'rabbit at t-2' ...
> [{nodes,[{disc,['rabbit at t-4','rabbit at t-2']}]},
> {running_nodes,['rabbit at t-4','rabbit at t-2']}]
> ...done.
>
> --------------------------------------------------------------------------- -----
> I have been testing with HA feature with different scenario.
> In my previous test the messages were pumped in with a SOAP service.
> This was pumping messages at slow rate.
> I have used a test that pumps in messages by calling plain Java
> Service. I have also increased messages pumping in from 20K to 40K.
> I am finding that messages are lost while pumping into the queue.
> As you mentioned earlier this could be due to connecting to dead
> broker.
> I modified the producer code by giving 2 seconds lapse of time and
> setting a fresh ConnectionFactory as follows:
>
> @Override
> public void convertAndSend(final Object message) throws AmqpException
> {
> ? MessageProperties props = null;
> ? try {
> ? ? props = new MessageProperties();
> ? ? props.setDeliveryMode(MessageDeliveryMode.PERSISTENT); ? //setting delivery mode as PERSISTENT
> ? ? send(getMessageConverter().toMessage(message, props));
> ? } catch (AmqpException amqpe) {
> ? ? System.out.println("Exception occurred while sending:"+amqpe.getMessage());
> ? ? try {
> ? ? ? Thread.sleep(2000);
> ? ? } catch (InterruptedException e) {
> ? ? ? e.printStackTrace();
> ? ? }
> ? ? Properties props1 = FrameworkServiceLocator.getInstance().
> ? ? ? getCommonsConfigurationService(ServiceConstants.DMB_COMMONS_CONFIG_SERVICE) .
> ? ? ? getProperties(CommonsConfigurationConstants.RABBIT_MQ_CONFIG_NAME);
> ? ? String rabbitMQUser = props1.getProperty(CommonsConfigurationConstants.RABBITMQ_USER);
> ? ? String rabbitMQPassword = props1.getProperty(CommonsConfigurationConstants.RABBITMQ_PASSWORD);
> ? ? String rabbitMQHost = props1.getProperty(CommonsConfigurationConstants.RABBITMQ_HOST);
> ? ? String rabbitMQChannelCacheSize = props1.getProperty(CommonsConfigurationConstants.RABBITMQ_CHANNEL_CACHE_SIZ E);
> ? ? CachingConnectionFactory connectionFactory = new CachingConnectionFactory(rabbitMQHost);
> ? ? connectionFactory.setChannelCacheSize(Integer.parseInt(rabbitMQChannelCache Size));
> ? ? connectionFactory.setUsername(rabbitMQUser);
> ? ? connectionFactory.setPassword(rabbitMQPassword);
> ? ? setConnectionFactory(connectionFactory);
> ? ? try {
> ? ? ? send(getMessageConverter().toMessage(message, props));
> ? ? } catch(AmqpException e1) {
> ? ? ? e1.printStackTrace();
> ? ? }
> ? }
>
> }
>
> After this change is made, I saw an exception occurred once while
> sending 40K messages which is as follows:
> java.net.SocketException: Broken pipe.
> I have run the test 10-15 times each time 5K-6K messages were lost
> but this exception was occurring only once.
>
> Thanks
> Venkat
>
> On Jan 11, 12:55 pm, Steve Powell <st... at rabbitmq.com> wrote:
> Hi Venkat,
>
> This time there were no messages lost. All 20K messages were
> processed.
>
> That's great.
>
> I'm trying to figure out what might be wrong with
> rabbitmqctl report; I'll get back to you.
>
> Meanwhile, running
> ? ? ? ?rabbitmqctl -n rabbit at t-2 status
> ON NODE t-4 might be interesting.
>
> Also, can you tell us the output from
> ? ? ? ?rabbitmqctl cluster_status
> on both nodes, please.
>
> It is not clear if you have issued the stop_app and start_app and
> reset/force_reset commands properly (you probably have), so could you follow
> the steps as described in the clustering guide, and issue
> rabbitmqctl cluster_status on both nodes after each cluster change?
> We should be able to see where things went wrong, then.
>
> (You did start_app after the cluster command, didn't you??? ?:-))
>
> Cheers,
>
> Steve Powell ?(a hoppy bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 11 Jan 2012, at 01:22, Venkat wrote:> ...
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rclayton at bericotechnologies.com  Sat Jan 21 19:50:58 2012
From: rclayton at bericotechnologies.com (Richard-Clayton)
Date: Sat, 21 Jan 2012 11:50:58 -0800 (PST)
Subject: [rabbitmq-discuss] Wrong Version of Commons IO Bundled with RabbitMQ
Message-ID: <33180852.post@talk.nabble.com>


Hello All,

I was in the process of rolling RabbitMQ into Apache Felix, and ran into an
"unsatisfied dependency" error:

ERROR: Bundle com.rabbitmq.client [11] Error starting
file:/Users/rclayton/Server/felix-framework-4.0.2/bundle/rabbitmq-client.jar
(org.osgi.framework.BundleException: Unresolved constraint in bundle
com.rabbitmq.client [11]: Unable to resolve 11.0: missing requirement [11.0]
osgi.wiring.package;
(&(osgi.wiring.package=org.apache.commons.io)(version>=1.4.0)(!(version>=2.0.0))))
org.osgi.framework.BundleException: Unresolved constraint in bundle
com.rabbitmq.client [11]: Unable to resolve 11.0: missing requirement [11.0]
osgi.wiring.package;
(&(osgi.wiring.package=org.apache.commons.io)(version>=1.4.0)(!(version>=2.0.0)))
        at
org.apache.felix.framework.Felix.resolveBundleRevision(Felix.java:3826)
        at org.apache.felix.framework.Felix.startBundle(Felix.java:1868)
        at
org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1191)
        at
org.apache.felix.framework.FrameworkStartLevelImpl.run(FrameworkStartLevelImpl.java:295)
        at java.lang.Thread.run(Thread.java:680)
____________________________
Welcome to Apache Felix Gogo


The RabbitMQ Java Client API is currently including the old version of
Apache Commons IO (1.2.0) and your bundle manifest is requiring a version
greater than or equal to 1.4.0 and less than 2.0.0.  This error is resolved
by including Commons IO 1.4.0.

Thanks,

Richard
-- 
View this message in context: http://old.nabble.com/Wrong-Version-of-Commons-IO-Bundled-with-RabbitMQ-tp33180852p33180852.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alex at purefiction.net  Sun Jan 22 14:23:45 2012
From: alex at purefiction.net (Alexander Staubo)
Date: Sun, 22 Jan 2012 15:23:45 +0100
Subject: [rabbitmq-discuss] Determining age of queue contents
Message-ID: <91B22DD70758443E8B45B1B44739CE7E@gmail.com>

[Please CC as I am not on the list.]

The fine-grained stats plugin provides information about message processing rate and queue lengths, which can be used to infer whether a queue is "lagging". Two problems:

1. The only way to reliably infer the true processing rate of a queue is to implement a stateful watching algorithm, being a function both of the current processing rate as well as the *growth rate* of the queue; a queue that grows faster than messages are processes is a potential bottleneck. While fairly trivial to write, when you merely want to monitor queues from a Nagios plugin, I would wish this was something built into RabbitMQ itself, closest to where the information is stored. A Nagios plugin would have to store state data in the file system.

2. Even when looking at processing rate and growth rate, there is not enough sufficient information to determine a realistic churn rate. What's really needed is to track the age of the newest and last messages in the queue. If you have this age difference, you can define acceptables deadline for message processing in a monitoring system, which is a better heuristic than the processing rate.

Would it be possible to implement a way to extract a per-queue age value (in a performant way)?

From prasadk.6585 at gmail.com  Mon Jan 23 10:51:27 2012
From: prasadk.6585 at gmail.com (Prasad Kulkarni)
Date: Mon, 23 Jan 2012 16:21:27 +0530
Subject: [rabbitmq-discuss] Single Queue Multiple Consumers
Message-ID: <CAOzgPkyYbcRR6FQ+oXoV4QX+VbfpFdnNKDYBfWtumMNpYBRgxg@mail.gmail.com>

Hi,

I have a Single Queue and a Single message on the queue, so please help me
in configuring RabbitMQ such a way that, all the consumers to should listen
to this message from the same queue.

Please help me with a sample code snippet.

-- 
Thanks and Regards
Prasad Kulkarni
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/a8436782/attachment.htm>

From alexandru at rabbitmq.com  Mon Jan 23 10:51:35 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 23 Jan 2012 10:51:35 +0000
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
Message-ID: <20120123105135.GP3543@southbank.Home>

Hi Yogesh,

In the absence of consumer failures, RabbitMQ will deliver messages from
a queue in order.

So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
them to consumers in the same order (1, 2, 3).

But, if consumers fail before acknowledging the messages (or if they
reject the messages), those messages will requeued at the end of the
queue.  So, if the consumer that got message 1 rejects it, the new
order of messages will be 2, 3, 1.

This all deals with message *delivery*.

> There are multiple consumer threads consuming the messages.
> Though multiple threads are consuming the messages, I observed that
> messages still get processed sequentially.
> Is that the case and if NOT, what is the way to guarantee sequential
> processing of messages on one queue?

The library makes no guarantees about the order in which you process
messages, only about the order in which they're delivered.

If you want to process all the messages on a queue in order, only
consume from one thread (doing basic.get from one thread like you
suggested in the other email would work, but would also be highly
inefficient).

Does this answer your question?

Cheers,
Alex

On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
> Running the code below, gives
> channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
>     	new DefaultConsumer(channel)  {
>         @Override
>         public void handleDelivery(String consumerTag, Envelope
> envelope, BasicProperties properties, byte[] body) {
>                 System.out.println(Thread.currentThread().getName());
>          }
> }
> 
> o/p like
> pool-1-thread-1
> pool-1-thread-2
> pool-1-thread-3
> etc
> 
> There are multiple consumer threads consuming the messages.
> Though multiple threads are consuming the messages, I observed that
> messages still get processed sequentially.
> Is that the case and if NOT, what is the way to guarantee sequential
> processing of messages on one queue?
> 
> regards, Yogesh
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ekirpichov at gmail.com  Mon Jan 23 10:53:07 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 23 Jan 2012 14:53:07 +0400
Subject: [rabbitmq-discuss] Single Queue Multiple Consumers
In-Reply-To: <CAOzgPkyYbcRR6FQ+oXoV4QX+VbfpFdnNKDYBfWtumMNpYBRgxg@mail.gmail.com>
References: <CAOzgPkyYbcRR6FQ+oXoV4QX+VbfpFdnNKDYBfWtumMNpYBRgxg@mail.gmail.com>
Message-ID: <CANVKUrWxP_v+5T9HAb9xrfuRFOSJ_3U3EtCHjrV=UFGZDv6mUA@mail.gmail.com>

Hi,
Please read about queues and exchanges - I believe it should answer your
question.  http://www.rabbitmq.com/tutorials/tutorial-three-python.html

On Mon, Jan 23, 2012 at 2:51 PM, Prasad Kulkarni <prasadk.6585 at gmail.com>wrote:

> Hi,
>
> I have a Single Queue and a Single message on the queue, so please help me
> in configuring RabbitMQ such a way that, all the consumers to should listen
> to this message from the same queue.
>
> Please help me with a sample code snippet.
>
> --
> Thanks and Regards
> Prasad Kulkarni
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/1cd27bb7/attachment.htm>

From simon at rabbitmq.com  Mon Jan 23 10:55:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jan 2012 10:55:11 +0000
Subject: [rabbitmq-discuss] Error installing/configuring Jsonrpc Channel
 plugin
In-Reply-To: <c1cff976-5eb9-4e54-a27d-95d2260b1c58@q7g2000pbg.googlegroups.com>
References: <8911cdcf-ef15-469a-b36d-89d84061f80a@q7g2000pbg.googlegroups.com>	<4F196F1B.3090909@rabbitmq.com>
	<4F196F69.7040004@rabbitmq.com>
	<c1cff976-5eb9-4e54-a27d-95d2260b1c58@q7g2000pbg.googlegroups.com>
Message-ID: <4F1D3C8F.10005@rabbitmq.com>

On 21/01/12 00:35, Sunil Agrawal wrote:
> Thanks Simon, that did the trick. Who can update the instructions on
> github so that it doesn't stumble the next guy. Hopefully should be a
> quick one.

I have done so.

> Where can I find information on all the commands and their arguments
> supported by JsonRpcChannel? Immediately I am looking for how to
> 'reject' or 'nack' a message and didn't find anything looking through
> the source code.

To be honest I haven't looked at JSON-RPC channel in ages but it aims to 
be a fairly close copy of AMQP.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Jan 23 10:55:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 23 Jan 2012 10:55:57 +0000
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
Message-ID: <4F1D3CBD.5070506@rabbitmq.com>

Hi Yogesh,

On 22/01/12 17:38, Yogesh Ketkar wrote:
> Is that the case and if NOT, what is the way to guarantee sequential
> processing of messages on one queue?

If I understand your question correctly, you want to know whether
messages will always be delivered in order. This page has relevant info:
http://www.rabbitmq.com/semantics.html#ordering :

"""
messages published in one channel, passing through one exchange and one
queue and one outgoing channel will be received in the same order that
they were sent
"""

This remains true whether you use basic.get or basic.consume. A consumer
may observe messages out of order if there are multiple consumers
consuming from the same queue and some of them perform requeues.


-Emile

From simon at rabbitmq.com  Mon Jan 23 10:56:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jan 2012 10:56:33 +0000
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures
 on	Queue Bind - 2012-01-20
In-Reply-To: <4F19E73D.9080107@aol.com>
References: <4F19E73D.9080107@aol.com>
Message-ID: <4F1D3CE1.6060701@rabbitmq.com>

On 20/01/12 22:14, DawgTool wrote:
> <<"NOT_FOUND - no exchange 'dc001-exchange-u' in vhost '/'">>}},

Does the upstream exchange exist? The federation plugin will not create 
it for you.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jan 23 11:26:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jan 2012 11:26:03 +0000
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>	<4F196036.3050708@rabbitmq.com>
	<2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>
Message-ID: <4F1D43CB.2070709@rabbitmq.com>

On 20/01/12 16:58, Dennis Jacobfeuerborn wrote:
> The dump is 1.8M big. Should I send this to a specific email address? I
> can also put the file on a web server.

Either would be fine - if you want to email it, info at rabbitmq.com would 
be good.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jan 23 11:37:20 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jan 2012 11:37:20 +0000
Subject: [rabbitmq-discuss] Determining age of queue contents
In-Reply-To: <91B22DD70758443E8B45B1B44739CE7E@gmail.com>
References: <91B22DD70758443E8B45B1B44739CE7E@gmail.com>
Message-ID: <4F1D4670.5070702@rabbitmq.com>

On 22/01/12 14:23, Alexander Staubo wrote:
> [Please CC as I am not on the list.]
>
> The fine-grained stats plugin provides information about message
> processing rate and queue lengths, which can be used to infer whether
> a queue is "lagging". Two problems:
>
> 1. The only way to reliably infer the true processing rate of a queue
> is to implement a stateful watching algorithm, being a function both
> of the current processing rate as well as the *growth rate* of the
> queue; a queue that grows faster than messages are processes is a
> potential bottleneck. While fairly trivial to write, when you merely
> want to monitor queues from a Nagios plugin, I would wish this was
> something built into RabbitMQ itself, closest to where the
> information is stored. A Nagios plugin would have to store state data
> in the file system.

Why would such a plugin need to be stateful? Note that growth rate (only 
since the last sample, like all the rates we show) is available from 
mgmt as of 2.7.1. Was that what you meant? If not can you explain what 
calculation you would want?

> 2. Even when looking at processing rate and growth rate, there is not
> enough sufficient information to determine a realistic churn rate.
> What's really needed is to track the age of the newest and last
> messages in the queue. If you have this age difference, you can
> define acceptables deadline for message processing in a monitoring
> system, which is a better heuristic than the processing rate.
>
> Would it be possible to implement a way to extract a per-queue age
> value (in a performant way)?

This could potentially happen, but it'd be quite intrusive so there are 
other things higher up the priority list right now...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From swarajya.pothuri at wipro.com  Mon Jan 23 11:40:22 2012
From: swarajya.pothuri at wipro.com (swarajya.pothuri at wipro.com)
Date: Mon, 23 Jan 2012 11:40:22 +0000
Subject: [rabbitmq-discuss] RabbitMQ on JBoss
Message-ID: <4543F753-29F9-46AB-8467-9A07B956B8F9@wipro.com>

Hi,

 I want to use RabbitMQ on JBoss server.
Can anyone help me, about the configuration  

Please do not print this email unless it is absolutely necessary. 

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. 

WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. 

www.wipro.com

From alex at purefiction.net  Mon Jan 23 11:40:23 2012
From: alex at purefiction.net (Alexander Staubo)
Date: Mon, 23 Jan 2012 12:40:23 +0100
Subject: [rabbitmq-discuss] Determining age of queue contents
In-Reply-To: <4F1D4670.5070702@rabbitmq.com>
References: <91B22DD70758443E8B45B1B44739CE7E@gmail.com>
	<4F1D4670.5070702@rabbitmq.com>
Message-ID: <7631BD587EC847B1A5E5A7ED1A6781D8@gmail.com>

On Monday, January 23, 2012 at 12:37 , Simon MacMullen wrote:
> On 22/01/12 14:23, Alexander Staubo wrote:
> 1. The only way to reliably infer the true processing rate of a queue
> > is to implement a stateful watching algorithm, being a function both
> > of the current processing rate as well as the *growth rate* of the
> > queue ...
> 
> 
> Why would such a plugin need to be stateful? Note that growth rate (only 
> since the last sample, like all the rates we show) is available from 
> mgmt as of 2.7.1. Was that what you meant? If not can you explain what 
> calculation you would want?


I didn't know that the growth rate had been exposed. That helps. Thanks.

From steve at rabbitmq.com  Mon Jan 23 12:23:43 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 23 Jan 2012 12:23:43 +0000
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
In-Reply-To: <5dd265e5-8315-47aa-a65b-6b9852745986@k3g2000pbn.googlegroups.com>
References: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>
	<4F144193.5040109@rabbitmq.com>
	<384f67bd-c561-4728-8796-7528863d9176@k3g2000pbn.googlegroups.com>
	<4F196248.7050400@rabbitmq.com>
	<6A25D10C-5951-4153-A190-8A574D2B1905@rabbitmq.com>
	<5dd265e5-8315-47aa-a65b-6b9852745986@k3g2000pbn.googlegroups.com>
Message-ID: <CAD59333-CC5B-4C0A-957D-85115324B4A8@rabbitmq.com>

Yogesh,

rabbitmqadmin can delete the queue but without the checks that it might not be
empty and might be being used.  If you can be sure that the queue is dead, then
a rabbitmqadmin check followed by a delete would be quite adequate.

However, if it is possible that the queue might not be dead (just usage being
slow) or it might be reused, then it is imperative that the delete be
conditional.  The java client interface (or some other client interface) should
be used to make the delete conditional.

We notice here that the rabbitmqadmin interface doesn't allow you to
conditionally delete. We have raised a bug to do this -- but in the meantime, I
would code a script that issues the rabbitmqadmin calls to determine which
queues to conditionally delete, and then invoke simple stand-alone client app to
do the conditional deletes.   It's a bit klunky, but reasonably safe.

Hope this helps.
Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 22 Jan 2012, at 07:40, Yogesh Ketkar wrote:

> Thanks Steve and Simon.
> 
> I checked that rabbitmqadmin.py uses http calls (RESTful APIs)
> provided by RabbitMQ to perform the operations.
> Can you provide me a sample
> - (either using rabbitmqadmin or using RESTful client) to delete a
> queue say "Yogesh" with isEmpty and isUnused flags set to True?
>  I could delete the queue using DELETE http request on
> http://localhost:55672/api/queues/%2f/Yogesh
>  But couldn't figure out a way to specify isEmpty and isUnused flags.
> - I was able to do this in a Java client using interface
> com.rabbitmq.client.Channel { queueDelete("Yogesh", true, true) }.
>  But then, how do I get list of queues using com.rabbitmq.client?
> 
> regards, Yogesh
> 
> 
> 
> On Jan 20, 7:25 pm, Steve Powell <st... at rabbitmq.com> wrote:
>> Just a thought,
>> 
>> If you go the way Simon says and have something from outside poking the mgmt API
>> every few minutes, make sure you issue queueDelete with the if-empty bit set.
>> There is a window between the poking and the deleting in which messages may
>> arrive on the queue (i.e. it's not idle anymore), and it may even not be in-use
>> (have consumers) by the time you get to it.
>> 
>> Steve Powell
>> st... at rabbitmq.com
>> [wrk:+44-2380-111-528begin_of_the_skype_highlighting            +44-2380-111-528      ] [mob:+44-7815-838-558begin_of_the_skype_highlighting            +44-7815-838-558      ]
>> 
>> On 20 Jan 2012, at 12:47, Simon MacMullen wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> On 16/01/12 15:56, Yogesh Ketkar wrote:
>>>> I would like to delete the queue with no messages in it and so asked
>>>> the question.
>> 
>>> I see.
>> 
>>>> Can you suggest an alternative to achieve
>>>> 1. Delete the queue when last event processed from the queue has
>>>> <Action>Delete</Action>  as this implies that
>>>>    no more events with same<AppId>  would ever get created.
>> 
>>> Well, you could have your client do that.
>> 
>>>> 2. Delete the queue when it is IDLE for certain period, meaning it is
>>>> empty and no more event was added to it for certain time period.
>> 
>>> Hmm. Well there's nothing built in to do this, but you could have something from outside poking the mgmt API every few minutes - look at the output of (e.g.)
>> 
>>> rabbitmqadmin list queues name messages consumers idle_since
>> 
>>> Cheers, Simon
>> 
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/85a4060e/attachment.htm>

From yogimogi at gmail.com  Mon Jan 23 14:33:08 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Mon, 23 Jan 2012 06:33:08 -0800 (PST)
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
In-Reply-To: <CAD59333-CC5B-4C0A-957D-85115324B4A8@rabbitmq.com>
References: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>
	<4F144193.5040109@rabbitmq.com>
	<384f67bd-c561-4728-8796-7528863d9176@k3g2000pbn.googlegroups.com>
	<4F196248.7050400@rabbitmq.com>
	<6A25D10C-5951-4153-A190-8A574D2B1905@rabbitmq.com>
	<5dd265e5-8315-47aa-a65b-6b9852745986@k3g2000pbn.googlegroups.com>
	<CAD59333-CC5B-4C0A-957D-85115324B4A8@rabbitmq.com>
Message-ID: <e373a182-82a1-4008-bb71-01ff42a4833b@b10g2000pbd.googlegroups.com>

Thanks Steve.

I am planning to write a Java Client which will get list of queues
using something like
Process proc = Runtime.getRuntime().exec("rabbitmqadmin.py list queues
name -f bash") and then iterate over each queue name
and call
channel1.queueDelete(queueName, true, true)

Just one question.
Assume that this client is trying to delete the queue on one channel
and and some other client is trying to do
channel2.queueDeclare as it wants to publish a message on the same
queue.
Is there a chance of deadlock due to timing of these 2 calls, on two
different channels, channel1.queueDelete and channel2.queueDeclare?

regards, Yogesh


On Jan 23, 5:23?pm, Steve Powell <st... at rabbitmq.com> wrote:
> Yogesh,
>
> rabbitmqadmin can delete the queue but without the checks that it might not be
> empty and might be being used. ?If you can be sure that the queue is dead, then
> a rabbitmqadmin check followed by a delete would be quite adequate.
>
> However, if it is possible that the queue might not be dead (just usage being
> slow) or it might be reused, then it is imperative that the delete be
> conditional. ?The java client interface (or some other client interface) should
> be used to make the delete conditional.
>
> We notice here that the rabbitmqadmin interface doesn't allow you to
> conditionally delete. We have raised a bug to do this -- but in the meantime, I
> would code a script that issues the rabbitmqadmin calls to determine which
> queues to conditionally delete, and then invoke simple stand-alone client app to
> do the conditional deletes. ? It's a bit klunky, but reasonably safe.
>
> Hope this helps.
> Steve Powell ?(a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 22 Jan 2012, at 07:40, Yogesh Ketkar wrote:
>
>
>
>
>
>
>
> > Thanks Steve and Simon.
>
> > I checked that rabbitmqadmin.py uses http calls (RESTful APIs)
> > provided by RabbitMQ to perform the operations.
> > Can you provide me a sample
> > - (either using rabbitmqadmin or using RESTful client) to delete a
> > queue say "Yogesh" with isEmpty and isUnused flags set to True?
> > ?I could delete the queue using DELETE http request on
> >http://localhost:55672/api/queues/%2f/Yogesh
> > ?But couldn't figure out a way to specify isEmpty and isUnused flags.
> > - I was able to do this in a Java client using interface
> > com.rabbitmq.client.Channel { queueDelete("Yogesh", true, true) }.
> > ?But then, how do I get list of queues using com.rabbitmq.client?
>
> > regards, Yogesh
>
> > On Jan 20, 7:25 pm, Steve Powell <st... at rabbitmq.com> wrote:
> >> Just a thought,
>
> >> If you go the way Simon says and have something from outside poking the mgmt API
> >> every few minutes, make sure you issue queueDelete with the if-empty bit set.
> >> There is a window between the poking and the deleting in which messages may
> >> arrive on the queue (i.e. it's not idle anymore), and it may even not be in-use
> >> (have consumers) by the time you get to it.
>
> >> Steve Powell
> >> st... at rabbitmq.com
> >> [wrk:+44-2380-111-528begin_of_the_skype_highlighting????????????+44-2380-111-528??????begin_of_the_skype_highlighting ? ? ? ? ? ?+44-2380-111-528 ? ? ?] [mob:+44-7815-838-558begin_of_the_skype_highlighting????????????+44-7815-838-558??????begin_of_the_skype_highlighting ? ? ? ? ? ?+44-7815-838-558 ? ? ?]
>
> >> On 20 Jan 2012, at 12:47, Simon MacMullen wrote:
>
> >>> On 16/01/12 15:56, Yogesh Ketkar wrote:
> >>>> I would like to delete the queue with no messages in it and so asked
> >>>> the question.
>
> >>> I see.
>
> >>>> Can you suggest an alternative to achieve
> >>>> 1. Delete the queue when last event processed from the queue has
> >>>> <Action>Delete</Action> ?as this implies that
> >>>> ? ?no more events with same<AppId> ?would ever get created.
>
> >>> Well, you could have your client do that.
>
> >>>> 2. Delete the queue when it is IDLE for certain period, meaning it is
> >>>> empty and no more event was added to it for certain time period.
>
> >>> Hmm. Well there's nothing built in to do this, but you could have something from outside poking the mgmt API every few minutes - look at the output of (e.g.)
>
> >>> rabbitmqadmin list queues name messages consumers idle_since
>
> >>> Cheers, Simon
>
> >>> --
> >>> Simon MacMullen
> >>> RabbitMQ, VMware
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-disc... at lists.rabbitmq.com
> >>>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discussTh

From yogimogi at gmail.com  Mon Jan 23 14:38:37 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Mon, 23 Jan 2012 20:08:37 +0530
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <20120123105135.GP3543@southbank.Home>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
Message-ID: <CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>

Thanks Alex.

I think, for sequential message processing, rather than this pattern
while(true) {
    GetResponse res = channel.basicGet(QUEUE_NAME, false);
    if(res != null) {
        // process and ack message
   }
}

using channel.basicConsume on the channel which is created like this
ExecutorService es = Executors.newSingleThreadExecutor();
Connection connection = factory.newConnection(es);
final Channel channel = connection.createChannel();

is probably a better approach.
Any comments on this?

regards, Yogesh

2012/1/23 Alexandru Scvor?ov <alexandru at rabbitmq.com>

> Hi Yogesh,
>
> In the absence of consumer failures, RabbitMQ will deliver messages from
> a queue in order.
>
> So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
> them to consumers in the same order (1, 2, 3).
>
> But, if consumers fail before acknowledging the messages (or if they
> reject the messages), those messages will requeued at the end of the
> queue.  So, if the consumer that got message 1 rejects it, the new
> order of messages will be 2, 3, 1.
>
> This all deals with message *delivery*.
>
> > There are multiple consumer threads consuming the messages.
> > Though multiple threads are consuming the messages, I observed that
> > messages still get processed sequentially.
> > Is that the case and if NOT, what is the way to guarantee sequential
> > processing of messages on one queue?
>
> The library makes no guarantees about the order in which you process
> messages, only about the order in which they're delivered.
>
> If you want to process all the messages on a queue in order, only
> consume from one thread (doing basic.get from one thread like you
> suggested in the other email would work, but would also be highly
> inefficient).
>
> Does this answer your question?
>
> Cheers,
> Alex
>
> On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
> > Running the code below, gives
> > channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
> >       new DefaultConsumer(channel)  {
> >         @Override
> >         public void handleDelivery(String consumerTag, Envelope
> > envelope, BasicProperties properties, byte[] body) {
> >                 System.out.println(Thread.currentThread().getName());
> >          }
> > }
> >
> > o/p like
> > pool-1-thread-1
> > pool-1-thread-2
> > pool-1-thread-3
> > etc
> >
> > There are multiple consumer threads consuming the messages.
> > Though multiple threads are consuming the messages, I observed that
> > messages still get processed sequentially.
> > Is that the case and if NOT, what is the way to guarantee sequential
> > processing of messages on one queue?
> >
> > regards, Yogesh
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/70745d4d/attachment.htm>

From alexandru at rabbitmq.com  Mon Jan 23 14:48:09 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 23 Jan 2012 14:48:09 +0000
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
	<CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>
Message-ID: <20120123144809.GU3543@southbank.Home>

Hi Yogesh,

> using channel.basicConsume on the channel which is created like this
> ExecutorService es = Executors.newSingleThreadExecutor();
> Connection connection = factory.newConnection(es);
> final Channel channel = connection.createChannel();
> 
> is probably a better approach.
> Any comments on this?

I don't quite see the point of the ExecutorService.

Just doing this:

> Connection connection = factory.newConnection(es);
> final Channel channel = connection.createChannel();

Then, calling basicConsume with your own subclass of DefaultConsumer
should be fine.

Cheers,
Alex

On Mon, Jan 23, 2012 at 08:08:37PM +0530, Yogesh Ketkar wrote:
> Thanks Alex.
> 
> I think, for sequential message processing, rather than this pattern
> while(true) {
>     GetResponse res = channel.basicGet(QUEUE_NAME, false);
>     if(res != null) {
>         // process and ack message
>    }
> }
> 
> using channel.basicConsume on the channel which is created like this
> ExecutorService es = Executors.newSingleThreadExecutor();
> Connection connection = factory.newConnection(es);
> final Channel channel = connection.createChannel();
> 
> is probably a better approach.
> Any comments on this?
> 
> regards, Yogesh
> 
> 2012/1/23 Alexandru Scvor?ov <alexandru at rabbitmq.com>
> 
> > Hi Yogesh,
> >
> > In the absence of consumer failures, RabbitMQ will deliver messages from
> > a queue in order.
> >
> > So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
> > them to consumers in the same order (1, 2, 3).
> >
> > But, if consumers fail before acknowledging the messages (or if they
> > reject the messages), those messages will requeued at the end of the
> > queue.  So, if the consumer that got message 1 rejects it, the new
> > order of messages will be 2, 3, 1.
> >
> > This all deals with message *delivery*.
> >
> > > There are multiple consumer threads consuming the messages.
> > > Though multiple threads are consuming the messages, I observed that
> > > messages still get processed sequentially.
> > > Is that the case and if NOT, what is the way to guarantee sequential
> > > processing of messages on one queue?
> >
> > The library makes no guarantees about the order in which you process
> > messages, only about the order in which they're delivered.
> >
> > If you want to process all the messages on a queue in order, only
> > consume from one thread (doing basic.get from one thread like you
> > suggested in the other email would work, but would also be highly
> > inefficient).
> >
> > Does this answer your question?
> >
> > Cheers,
> > Alex
> >
> > On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
> > > Running the code below, gives
> > > channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
> > >       new DefaultConsumer(channel)  {
> > >         @Override
> > >         public void handleDelivery(String consumerTag, Envelope
> > > envelope, BasicProperties properties, byte[] body) {
> > >                 System.out.println(Thread.currentThread().getName());
> > >          }
> > > }
> > >
> > > o/p like
> > > pool-1-thread-1
> > > pool-1-thread-2
> > > pool-1-thread-3
> > > etc
> > >
> > > There are multiple consumer threads consuming the messages.
> > > Though multiple threads are consuming the messages, I observed that
> > > messages still get processed sequentially.
> > > Is that the case and if NOT, what is the way to guarantee sequential
> > > processing of messages on one queue?
> > >
> > > regards, Yogesh
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >

From yogimogi at gmail.com  Mon Jan 23 14:54:15 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Mon, 23 Jan 2012 06:54:15 -0800 (PST)
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <20120123144809.GU3543@southbank.Home>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
	<CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>
	<20120123144809.GU3543@southbank.Home>
Message-ID: <7fdbb511-c8b4-45c7-aef7-adb6ba80ffdf@v6g2000pba.googlegroups.com>

Hello Alex,

I thought, using default Connection con = factory.newConnection(),
ThreadPool which gets created will have more than one thread and
calling basicConsume will result in processing of messages on multiple
threads.

But if we explicitly provide Executors.newSingleThreadExecutor() to
newConnection method, only single thread will come into play with
basicConsume.

Is my understanding correct?

regards, Yogesh


On Jan 23, 7:48?pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> Hi Yogesh,
>
> > using channel.basicConsume on the channel which is created like this
> > ExecutorService es = Executors.newSingleThreadExecutor();
> > Connection connection = factory.newConnection(es);
> > final Channel channel = connection.createChannel();
>
> > is probably a better approach.
> > Any comments on this?
>
> I don't quite see the point of the ExecutorService.
>
> Just doing this:
>
> > Connection connection = factory.newConnection(es);
> > final Channel channel = connection.createChannel();
>
> Then, calling basicConsume with your own subclass of DefaultConsumer
> should be fine.
>
> Cheers,
> Alex
>
>
>
>
>
>
>
>
>
> On Mon, Jan 23, 2012 at 08:08:37PM +0530, Yogesh Ketkar wrote:
> > Thanks Alex.
>
> > I think, for sequential message processing, rather than this pattern
> > while(true) {
> > ? ? GetResponse res = channel.basicGet(QUEUE_NAME, false);
> > ? ? if(res != null) {
> > ? ? ? ? // process and ack message
> > ? ?}
> > }
>
> > using channel.basicConsume on the channel which is created like this
> > ExecutorService es = Executors.newSingleThreadExecutor();
> > Connection connection = factory.newConnection(es);
> > final Channel channel = connection.createChannel();
>
> > is probably a better approach.
> > Any comments on this?
>
> > regards, Yogesh
>
> > 2012/1/23 Alexandru Scvor?ov <alexan... at rabbitmq.com>
>
> > > Hi Yogesh,
>
> > > In the absence of consumer failures, RabbitMQ will deliver messages from
> > > a queue in order.
>
> > > So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
> > > them to consumers in the same order (1, 2, 3).
>
> > > But, if consumers fail before acknowledging the messages (or if they
> > > reject the messages), those messages will requeued at the end of the
> > > queue. ?So, if the consumer that got message 1 rejects it, the new
> > > order of messages will be 2, 3, 1.
>
> > > This all deals with message *delivery*.
>
> > > > There are multiple consumer threads consuming the messages.
> > > > Though multiple threads are consuming the messages, I observed that
> > > > messages still get processed sequentially.
> > > > Is that the case and if NOT, what is the way to guarantee sequential
> > > > processing of messages on one queue?
>
> > > The library makes no guarantees about the order in which you process
> > > messages, only about the order in which they're delivered.
>
> > > If you want to process all the messages on a queue in order, only
> > > consume from one thread (doing basic.get from one thread like you
> > > suggested in the other email would work, but would also be highly
> > > inefficient).
>
> > > Does this answer your question?
>
> > > Cheers,
> > > Alex
>
> > > On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
> > > > Running the code below, gives
> > > > channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
> > > > ? ? ? new DefaultConsumer(channel) ?{
> > > > ? ? ? ? @Override
> > > > ? ? ? ? public void handleDelivery(String consumerTag, Envelope
> > > > envelope, BasicProperties properties, byte[] body) {
> > > > ? ? ? ? ? ? ? ? System.out.println(Thread.currentThread().getName());
> > > > ? ? ? ? ?}
> > > > }
>
> > > > o/p like
> > > > pool-1-thread-1
> > > > pool-1-thread-2
> > > > pool-1-thread-3
> > > > etc
>
> > > > There are multiple consumer threads consuming the messages.
> > > > Though multiple threads are consuming the messages, I observed that
> > > > messages still get processed sequentially.
> > > > Is that the case and if NOT, what is the way to guarantee sequential
> > > > processing of messages on one queue?
>
> > > > regards, Yogesh
>
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Jan 23 15:11:31 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 23 Jan 2012 15:11:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ on JBoss
In-Reply-To: <4543F753-29F9-46AB-8467-9A07B956B8F9@wipro.com>
References: <4543F753-29F9-46AB-8467-9A07B956B8F9@wipro.com>
Message-ID: <4F1D78A3.9040804@rabbitmq.com>

Hi Swarajya,

On 23/01/12 11:40, swarajya.pothuri at wipro.com wrote:
> Hi,
> 
> I want to use RabbitMQ on JBoss server. Can anyone help me, about the
> configuration

Can you explain what you are trying to accomplish, what you have tried
so far and where you got stuck? The Spring-AMQP project may be of
interest to you: http://www.springsource.org/spring-amqp


-Emile

From sahmed1020 at gmail.com  Mon Jan 23 15:13:16 2012
From: sahmed1020 at gmail.com (S Ahmed)
Date: Mon, 23 Jan 2012 10:13:16 -0500
Subject: [rabbitmq-discuss] default timeout on server
Message-ID: <CAG2rwuOzJRT6=BfzTHLCsV9Qc17SXxTG8HwVH7rxH1oitJAGnw@mail.gmail.com>

Does rabbit server have a default time-out for connections that has to
be overridden?

i.e. Our clients are opening connections for x days (persistant connections
into rabbit), and connections are timing out on our client applications
within a few minutes.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/7c80a465/attachment.htm>

From simon at rabbitmq.com  Mon Jan 23 15:16:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jan 2012 15:16:33 +0000
Subject: [rabbitmq-discuss] default timeout on server
In-Reply-To: <CAG2rwuOzJRT6=BfzTHLCsV9Qc17SXxTG8HwVH7rxH1oitJAGnw@mail.gmail.com>
References: <CAG2rwuOzJRT6=BfzTHLCsV9Qc17SXxTG8HwVH7rxH1oitJAGnw@mail.gmail.com>
Message-ID: <4F1D79D1.2020004@rabbitmq.com>

On 23/01/12 15:13, S Ahmed wrote:
> Does rabbit server have a default time-out for connections that has to
> be overridden?

No.

> i.e. Our clients are opening connections for x days (persistant
> connections into rabbit), and connections are timing out on our client
> applications within a few minutes.

Whenever this question has come up in the past it turns out that some 
piece of networking hardware is causing the problem.

You may find that turning on AMQP heartbeats in your clients creates 
enough network traffic to fool your infrastructure...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexandru at rabbitmq.com  Mon Jan 23 15:22:13 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 23 Jan 2012 15:22:13 +0000
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <7fdbb511-c8b4-45c7-aef7-adb6ba80ffdf@v6g2000pba.googlegroups.com>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
	<CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>
	<20120123144809.GU3543@southbank.Home>
	<7fdbb511-c8b4-45c7-aef7-adb6ba80ffdf@v6g2000pba.googlegroups.com>
Message-ID: <20120123152213.GV3543@southbank.Home>

> Is my understanding correct?

Almost.  Deliveries will happen serially on a channel, so, as long as you
only have one consumer, everything should be fine.

On Mon, Jan 23, 2012 at 06:54:15AM -0800, Yogesh Ketkar wrote:
> Hello Alex,
> 
> I thought, using default Connection con = factory.newConnection(),
> ThreadPool which gets created will have more than one thread and
> calling basicConsume will result in processing of messages on multiple
> threads.
> 
> But if we explicitly provide Executors.newSingleThreadExecutor() to
> newConnection method, only single thread will come into play with
> basicConsume.
> 
> Is my understanding correct?
> 
> regards, Yogesh
> 
> 
> On Jan 23, 7:48?pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> > Hi Yogesh,
> >
> > > using channel.basicConsume on the channel which is created like this
> > > ExecutorService es = Executors.newSingleThreadExecutor();
> > > Connection connection = factory.newConnection(es);
> > > final Channel channel = connection.createChannel();
> >
> > > is probably a better approach.
> > > Any comments on this?
> >
> > I don't quite see the point of the ExecutorService.
> >
> > Just doing this:
> >
> > > Connection connection = factory.newConnection(es);
> > > final Channel channel = connection.createChannel();
> >
> > Then, calling basicConsume with your own subclass of DefaultConsumer
> > should be fine.
> >
> > Cheers,
> > Alex
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > On Mon, Jan 23, 2012 at 08:08:37PM +0530, Yogesh Ketkar wrote:
> > > Thanks Alex.
> >
> > > I think, for sequential message processing, rather than this pattern
> > > while(true) {
> > > ? ? GetResponse res = channel.basicGet(QUEUE_NAME, false);
> > > ? ? if(res != null) {
> > > ? ? ? ? // process and ack message
> > > ? ?}
> > > }
> >
> > > using channel.basicConsume on the channel which is created like this
> > > ExecutorService es = Executors.newSingleThreadExecutor();
> > > Connection connection = factory.newConnection(es);
> > > final Channel channel = connection.createChannel();
> >
> > > is probably a better approach.
> > > Any comments on this?
> >
> > > regards, Yogesh
> >
> > > 2012/1/23 Alexandru Scvor?ov <alexan... at rabbitmq.com>
> >
> > > > Hi Yogesh,
> >
> > > > In the absence of consumer failures, RabbitMQ will deliver messages from
> > > > a queue in order.
> >
> > > > So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
> > > > them to consumers in the same order (1, 2, 3).
> >
> > > > But, if consumers fail before acknowledging the messages (or if they
> > > > reject the messages), those messages will requeued at the end of the
> > > > queue. ?So, if the consumer that got message 1 rejects it, the new
> > > > order of messages will be 2, 3, 1.
> >
> > > > This all deals with message *delivery*.
> >
> > > > > There are multiple consumer threads consuming the messages.
> > > > > Though multiple threads are consuming the messages, I observed that
> > > > > messages still get processed sequentially.
> > > > > Is that the case and if NOT, what is the way to guarantee sequential
> > > > > processing of messages on one queue?
> >
> > > > The library makes no guarantees about the order in which you process
> > > > messages, only about the order in which they're delivered.
> >
> > > > If you want to process all the messages on a queue in order, only
> > > > consume from one thread (doing basic.get from one thread like you
> > > > suggested in the other email would work, but would also be highly
> > > > inefficient).
> >
> > > > Does this answer your question?
> >
> > > > Cheers,
> > > > Alex
> >
> > > > On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
> > > > > Running the code below, gives
> > > > > channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
> > > > > ? ? ? new DefaultConsumer(channel) ?{
> > > > > ? ? ? ? @Override
> > > > > ? ? ? ? public void handleDelivery(String consumerTag, Envelope
> > > > > envelope, BasicProperties properties, byte[] body) {
> > > > > ? ? ? ? ? ? ? ? System.out.println(Thread.currentThread().getName());
> > > > > ? ? ? ? ?}
> > > > > }
> >
> > > > > o/p like
> > > > > pool-1-thread-1
> > > > > pool-1-thread-2
> > > > > pool-1-thread-3
> > > > > etc
> >
> > > > > There are multiple consumer threads consuming the messages.
> > > > > Though multiple threads are consuming the messages, I observed that
> > > > > messages still get processed sequentially.
> > > > > Is that the case and if NOT, what is the way to guarantee sequential
> > > > > processing of messages on one queue?
> >
> > > > > regards, Yogesh
> >
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.com
> > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From static.void.dev at gmail.com  Mon Jan 23 15:55:37 2012
From: static.void.dev at gmail.com (StaticVoid)
Date: Mon, 23 Jan 2012 07:55:37 -0800 (PST)
Subject: [rabbitmq-discuss] AMQP, Bunny and Carrot Gems
Message-ID: <46f5718a-0a17-4e13-93c6-d6ae4b56cc93@k10g2000yqk.googlegroups.com>

Sorry for my ignorance but can someone please explain why someone
would use the Bunny or Carrot synchronous gems over the standard Ruby-
AMQP gem? Is it more safe because the call to the broker is blocked
until it receives a response while as the ruby-amqp could fail? How
much of a performance penalty is there for using amqp synchronously.
Typically which is used more... Carrot or Bunny and why?

Thanks for the input

From steve at rabbitmq.com  Mon Jan 23 16:38:58 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 23 Jan 2012 16:38:58 +0000
Subject: [rabbitmq-discuss] Wrong Version of Commons IO Bundled with
	RabbitMQ
In-Reply-To: <33180852.post@talk.nabble.com>
References: <33180852.post@talk.nabble.com>
Message-ID: <19C0E08F-CBC5-4E1A-B151-0EA8493F3635@rabbitmq.com>

Richard,

Thank you for pointing this out -- for some reason our builds didn't
spot this. I have raised a bug for this (bug24701) and it will be fixed in the
next release.

In the meantime, you could patch the MANIFEST.MF in the bundle jar so that the

 Import-Package:

header includes the import:

 org.apache.commons.io;version="[1.2,2)"

Since this is a one character change it ought not to disturb the lines or the
lengths thereof. Be careful not to do so as the format of
MANIFEST.MF files is quite restrictive.

Thank you for pointing this out. If other versions of the commons-io packages
are present in the repository that the felix resolver uses, it ought to use them
if they fall into the original range.

We are presently looking to eliminate the dependency upon org.apache.commons.io
in run-time code.

Regards
Steve Powell  (a hapless bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 21 Jan 2012, at 19:50, Richard-Clayton wrote:
http://old.nabble.com/Wrong-Version-of-Commons-IO-Bundled-with-RabbitMQ-td33180852.html#a33180852
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/061016f1/attachment.htm>

From developer at dnsplus.net  Mon Jan 23 16:42:23 2012
From: developer at dnsplus.net (dnsplus)
Date: Mon, 23 Jan 2012 08:42:23 -0800 (PST)
Subject: [rabbitmq-discuss]  Architecture Question: 2 Brokers,
 or Not 2 Brokers ?
Message-ID: <33189279.post@talk.nabble.com>


Hello Wizards, 

I need some help. I need to decide whether my system will have a central
broker that routes messages to individual remote brokers (where there is a
single consumer running on a timed interval), or whether to have a central
broker with a queue for each remote site. Number of remote sites: ~8000. 

I believe this is the kind of problem that would benefit from an interactive
discussion, however this does not appear to be very available at this time. 

I am sure there will be necessary questions to clarify scope and objective,
and I am happy to answer them. The discourse will likely help other people
as well. 

Thanks !
-- 
View this message in context: http://old.nabble.com/Architecture-Question%3A-2-Brokers%2C-or-Not-2-Brokers---tp33189279p33189279.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From ekirpichov at gmail.com  Mon Jan 23 16:48:38 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 23 Jan 2012 20:48:38 +0400
Subject: [rabbitmq-discuss] Architecture Question: 2 Brokers,
 or Not 2 Brokers ?
In-Reply-To: <33189279.post@talk.nabble.com>
References: <33189279.post@talk.nabble.com>
Message-ID: <CANVKUrW7UUvJ8dXkRP2sJG0+gMgs_ojbzP8Xo72ZSKf9_BYx6w@mail.gmail.com>

On Mon, Jan 23, 2012 at 8:42 PM, dnsplus <developer at dnsplus.net> wrote:

>
> Hello Wizards,
>
> I need some help. I need to decide whether my system will have a central
> broker that routes messages to individual remote brokers (where there is a
> single consumer running on a timed interval), or whether to have a central
> broker with a queue for each remote site. Number of remote sites: ~8000.
>
> I believe this is the kind of problem that would benefit from an
> interactive
> discussion, however this does not appear to be very available at this time.
>
> I am sure there will be necessary questions to clarify scope and objective,
> and I am happy to answer them. The discourse will likely help other people
> as well.
>
Yup; it would be nice if you described what you're trying to do.


>
> Thanks !
> --
> View this message in context:
> http://old.nabble.com/Architecture-Question%3A-2-Brokers%2C-or-Not-2-Brokers---tp33189279p33189279.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/ee757027/attachment.htm>

From steve at rabbitmq.com  Mon Jan 23 16:54:32 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 23 Jan 2012 16:54:32 +0000
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <20120123152213.GV3543@southbank.Home>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
	<CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>
	<20120123144809.GU3543@southbank.Home>
	<7fdbb511-c8b4-45c7-aef7-adb6ba80ffdf@v6g2000pba.googlegroups.com>
	<20120123152213.GV3543@southbank.Home>
Message-ID: <4400DD7F-0926-41AE-965A-3C5752A0A280@rabbitmq.com>

Hi Yogesh,

What Alex says is perfectly correct.

The executor service is set on the connection, and is there to allow multiple
channels to execute consumers simultaneously, and without blocking the channel
thread. By default you get an executor service which has five threads.

From the point of view of a single channel, the consumers are driven serially,
one delivery at a time, upon one of the executor service threads. The same
thread is not guaranteed to be used each time for each consumer call for a
channel (so don't try to use ThreadLocal objects).

The reason we provide this, is so that clients with many, many channels are not
forced to have a Consumer thread per channel -- something that is quite
expensive -- but have the option of allocating as many threads as they wish if
they need it. At the same time we guarantee that no Consumer calls can
'overtake' each other on any one channel, and that Consumer processing runs on a
distinct thread from the channel and the app, so that channel calls in the
Consumer code will not deadlock.

I hope this clarifies rather than obscures the situation,

Regards,
Steve Powell  (a hoppy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 23 Jan 2012, at 15:22, Alexandru Scvor?ov wrote:

>> Is my understanding correct?
> 
> Almost.  Deliveries will happen serially on a channel, so, as long as you
> only have one consumer, everything should be fine.
> 
> On Mon, Jan 23, 2012 at 06:54:15AM -0800, Yogesh Ketkar wrote:
>> Hello Alex,
>> 
>> I thought, using default Connection con = factory.newConnection(),
>> ThreadPool which gets created will have more than one thread and
>> calling basicConsume will result in processing of messages on multiple
>> threads.
>> 
>> But if we explicitly provide Executors.newSingleThreadExecutor() to
>> newConnection method, only single thread will come into play with
>> basicConsume.
>> 
>> Is my understanding correct?
>> 
>> regards, Yogesh
>> 
>> 
>> On Jan 23, 7:48 pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
>>> Hi Yogesh,
>>> 
>>>> using channel.basicConsume on the channel which is created like this
>>>> ExecutorService es = Executors.newSingleThreadExecutor();
>>>> Connection connection = factory.newConnection(es);
>>>> final Channel channel = connection.createChannel();
>>> 
>>>> is probably a better approach.
>>>> Any comments on this?
>>> 
>>> I don't quite see the point of the ExecutorService.
>>> 
>>> Just doing this:
>>> 
>>>> Connection connection = factory.newConnection(es);
>>>> final Channel channel = connection.createChannel();
>>> 
>>> Then, calling basicConsume with your own subclass of DefaultConsumer
>>> should be fine.
>>> 
>>> Cheers,
>>> Alex
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> On Mon, Jan 23, 2012 at 08:08:37PM +0530, Yogesh Ketkar wrote:
>>>> Thanks Alex.
>>> 
>>>> I think, for sequential message processing, rather than this pattern
>>>> while(true) {
>>>>     GetResponse res = channel.basicGet(QUEUE_NAME, false);
>>>>     if(res != null) {
>>>>         // process and ack message
>>>>    }
>>>> }
>>> 
>>>> using channel.basicConsume on the channel which is created like this
>>>> ExecutorService es = Executors.newSingleThreadExecutor();
>>>> Connection connection = factory.newConnection(es);
>>>> final Channel channel = connection.createChannel();
>>> 
>>>> is probably a better approach.
>>>> Any comments on this?
>>> 
>>>> regards, Yogesh
>>> 
>>>> 2012/1/23 Alexandru Scvor?ov <alexan... at rabbitmq.com>
>>> 
>>>>> Hi Yogesh,
>>> 
>>>>> In the absence of consumer failures, RabbitMQ will deliver messages from
>>>>> a queue in order.
>>> 
>>>>> So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
>>>>> them to consumers in the same order (1, 2, 3).
>>> 
>>>>> But, if consumers fail before acknowledging the messages (or if they
>>>>> reject the messages), those messages will requeued at the end of the
>>>>> queue.  So, if the consumer that got message 1 rejects it, the new
>>>>> order of messages will be 2, 3, 1.
>>> 
>>>>> This all deals with message *delivery*.
>>> 
>>>>>> There are multiple consumer threads consuming the messages.
>>>>>> Though multiple threads are consuming the messages, I observed that
>>>>>> messages still get processed sequentially.
>>>>>> Is that the case and if NOT, what is the way to guarantee sequential
>>>>>> processing of messages on one queue?
>>> 
>>>>> The library makes no guarantees about the order in which you process
>>>>> messages, only about the order in which they're delivered.
>>> 
>>>>> If you want to process all the messages on a queue in order, only
>>>>> consume from one thread (doing basic.get from one thread like you
>>>>> suggested in the other email would work, but would also be highly
>>>>> inefficient).
>>> 
>>>>> Does this answer your question?
>>> 
>>>>> Cheers,
>>>>> Alex
>>> 
>>>>> On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
>>>>>> Running the code below, gives
>>>>>> channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
>>>>>>       new DefaultConsumer(channel)  {
>>>>>>         @Override
>>>>>>         public void handleDelivery(String consumerTag, Envelope
>>>>>> envelope, BasicProperties properties, byte[] body) {
>>>>>>                 System.out.println(Thread.currentThread().getName());
>>>>>>          }
>>>>>> }
>>> 
>>>>>> o/p like
>>>>>> pool-1-thread-1
>>>>>> pool-1-thread-2
>>>>>> pool-1-thread-3
>>>>>> etc
>>> 
>>>>>> There are multiple consumer threads consuming the messages.
>>>>>> Though multiple threads are consuming the messages, I observed that
>>>>>> messages still get processed sequentially.
>>>>>> Is that the case and if NOT, what is the way to guarantee sequential
>>>>>> processing of messages on one queue?
>>> 
>>>>>> regards, Yogesh
>>> 
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/60749c13/attachment.htm>

From djacobfeuerborn at gmail.com  Mon Jan 23 17:18:18 2012
From: djacobfeuerborn at gmail.com (Dennis Jacobfeuerborn)
Date: Mon, 23 Jan 2012 09:18:18 -0800 (PST)
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <4F1D43CB.2070709@rabbitmq.com>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>	<4F196036.3050708@rabbitmq.com>
	<2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>
	<4F1D43CB.2070709@rabbitmq.com>
Message-ID: <5955234.1287.1327339099047.JavaMail.geo-discussion-forums@vbed2>

I put two archives here containing the output of your command and a 
rabbitmqctl report:

http://www.conversis.de/exac/rabbitmq-dump.tar.gz
http://www.conversis.de/exac/rabbitmq-dump2.tar.gz

Thanks,
  Dennis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/994b8949/attachment.htm>

From steve at rabbitmq.com  Mon Jan 23 17:27:26 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 23 Jan 2012 17:27:26 +0000
Subject: [rabbitmq-discuss] Queue Lease (x-expires)
In-Reply-To: <e373a182-82a1-4008-bb71-01ff42a4833b@b10g2000pbd.googlegroups.com>
References: <78d1459f-11a3-42cc-ae52-cfbb632c4f31@lr19g2000pbb.googlegroups.com>
	<4F144193.5040109@rabbitmq.com>
	<384f67bd-c561-4728-8796-7528863d9176@k3g2000pbn.googlegroups.com>
	<4F196248.7050400@rabbitmq.com>
	<6A25D10C-5951-4153-A190-8A574D2B1905@rabbitmq.com>
	<5dd265e5-8315-47aa-a65b-6b9852745986@k3g2000pbn.googlegroups.com>
	<CAD59333-CC5B-4C0A-957D-85115324B4A8@rabbitmq.com>
	<e373a182-82a1-4008-bb71-01ff42a4833b@b10g2000pbd.googlegroups.com>
Message-ID: <DE73113C-23E2-407C-95C7-59D30DC861C1@rabbitmq.com>

Yogesh,

I don't believe there is a possibility of deadlock in this situation. It is
possible that the second client will declare the queue and that it is then
deleted (by the first client) before it can start using it, but no deadlock will
occur.

However, there is a window between Declaring a queue and it being 'in use'
(which means there is a Consumer subscribed), so that publishers that declare
before use, and consumers that declare before use, might have the queue removed
from them just when they don't want it removed.

The Consume will fail if the queue disappears, so some retry logic is all that
is needed on the Consumer client app.

Publishing to a non-existent queue is quite OK -- no failure there, so some
options on the publish would need to be employed to ensure that the message
reaches its destination.

I'm not sure what a fail-safe solution to the declare-publish window is, so I'll
ask my colleagues.

Hope this is useful,
Steve Powell  (a loppy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 23 Jan 2012, at 14:33, Yogesh Ketkar wrote:

> Thanks Steve.
> 
> I am planning to write a Java Client which will get list of queues
> using something like
> Process proc = Runtime.getRuntime().exec("rabbitmqadmin.py list queues
> name -f bash") and then iterate over each queue name
> and call
> channel1.queueDelete(queueName, true, true)
> 
> Just one question.
> Assume that this client is trying to delete the queue on one channel
> and and some other client is trying to do
> channel2.queueDeclare as it wants to publish a message on the same
> queue.
> Is there a chance of deadlock due to timing of these 2 calls, on two
> different channels, channel1.queueDelete and channel2.queueDeclare?
> 
> regards, Yogesh
> 
> 
> On Jan 23, 5:23 pm, Steve Powell <st... at rabbitmq.com> wrote:
>> Yogesh,
>> 
>> rabbitmqadmin can delete the queue but without the checks that it might not be
>> empty and might be being used.  If you can be sure that the queue is dead, then
>> a rabbitmqadmin check followed by a delete would be quite adequate.
>> 
>> However, if it is possible that the queue might not be dead (just usage being
>> slow) or it might be reused, then it is imperative that the delete be
>> conditional.  The java client interface (or some other client interface) should
>> be used to make the delete conditional.
>> 
>> We notice here that the rabbitmqadmin interface doesn't allow you to
>> conditionally delete. We have raised a bug to do this -- but in the meantime, I
>> would code a script that issues the rabbitmqadmin calls to determine which
>> queues to conditionally delete, and then invoke simple stand-alone client app to
>> do the conditional deletes.   It's a bit klunky, but reasonably safe.
>> 
>> Hope this helps.
>> Steve Powell  (a happy bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>> On 22 Jan 2012, at 07:40, Yogesh Ketkar wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> Thanks Steve and Simon.
>> 
>>> I checked that rabbitmqadmin.py uses http calls (RESTful APIs)
>>> provided by RabbitMQ to perform the operations.
>>> Can you provide me a sample
>>> - (either using rabbitmqadmin or using RESTful client) to delete a
>>> queue say "Yogesh" with isEmpty and isUnused flags set to True?
>>>  I could delete the queue using DELETE http request on
>>> http://localhost:55672/api/queues/%2f/Yogesh
>>>  But couldn't figure out a way to specify isEmpty and isUnused flags.
>>> - I was able to do this in a Java client using interface
>>> com.rabbitmq.client.Channel { queueDelete("Yogesh", true, true) }.
>>>  But then, how do I get list of queues using com.rabbitmq.client?
>> 
>>> regards, Yogesh
>> 
>>> On Jan 20, 7:25 pm, Steve Powell <st... at rabbitmq.com> wrote:
>>>> Just a thought,
>> 
>>>> If you go the way Simon says and have something from outside poking the mgmt API
>>>> every few minutes, make sure you issue queueDelete with the if-empty bit set.
>>>> There is a window between the poking and the deleting in which messages may
>>>> arrive on the queue (i.e. it's not idle anymore), and it may even not be in-use
>>>> (have consumers) by the time you get to it.
>> 
>>>> Steve Powell
>>>> st... at rabbitmq.com
>>>> [wrk:+44-2380-111-528begin_of_the_skype_highlighting            +44-2380-111-528      begin_of_the_skype_highlighting            +44-2380-111-528      ] [mob:+44-7815-838-558begin_of_the_skype_highlighting            +44-7815-838-558      begin_of_the_skype_highlighting            +44-7815-838-558      ]
>> 
>>>> On 20 Jan 2012, at 12:47, Simon MacMullen wrote:
>> 
>>>>> On 16/01/12 15:56, Yogesh Ketkar wrote:
>>>>>> I would like to delete the queue with no messages in it and so asked
>>>>>> the question.
>> 
>>>>> I see.
>> 
>>>>>> Can you suggest an alternative to achieve
>>>>>> 1. Delete the queue when last event processed from the queue has
>>>>>> <Action>Delete</Action>  as this implies that
>>>>>>    no more events with same<AppId>  would ever get created.
>> 
>>>>> Well, you could have your client do that.
>> 
>>>>>> 2. Delete the queue when it is IDLE for certain period, meaning it is
>>>>>> empty and no more event was added to it for certain time period.
>> 
>>>>> Hmm. Well there's nothing built in to do this, but you could have something from outside poking the mgmt API every few minutes - look at the output of (e.g.)
>> 
>>>>> rabbitmqadmin list queues name messages consumers idle_since
>> 
>>>>> Cheers, Simon
>> 
>>>>> --
>>>>> Simon MacMullen
>>>>> RabbitMQ, VMware
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discussTh
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/d4f7893d/attachment.htm>

From jerryk at vmware.com  Mon Jan 23 17:41:32 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 23 Jan 2012 09:41:32 -0800 (PST)
Subject: [rabbitmq-discuss] Architecture Question: 2 Brokers,
	or Not 2 Brokers ?
In-Reply-To: <33189279.post@talk.nabble.com>
Message-ID: <c3654422-21c9-40f4-a29a-a57eed647228@StrongMad.local>

Hi, dnsplus:

Could you perhaps clarify a bit what you mean by "remote?"  Are you
talking about systems that are geographically separated from your
"central broker" for some reason external to your application?  Or
are you just talking about having 8,000 consumers?  The latter
shouldn't be a daunting number at all for even fairly modest Rabbit
deployments.

Best regards,
Jerry

----- Original Message -----
From: "dnsplus" <developer at dnsplus.net>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, January 23, 2012 8:42:23 AM
Subject: [rabbitmq-discuss]  Architecture Question: 2 Brokers, or Not 2 Brokers ?


Hello Wizards, 

I need some help. I need to decide whether my system will have a central
broker that routes messages to individual remote brokers (where there is a
single consumer running on a timed interval), or whether to have a central
broker with a queue for each remote site. Number of remote sites: ~8000. 

I believe this is the kind of problem that would benefit from an interactive
discussion, however this does not appear to be very available at this time. 

I am sure there will be necessary questions to clarify scope and objective,
and I am happy to answer them. The discourse will likely help other people
as well. 

Thanks !
-- 
View this message in context: http://old.nabble.com/Architecture-Question%3A-2-Brokers%2C-or-Not-2-Brokers---tp33189279p33189279.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Mon Jan 23 17:45:46 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 23 Jan 2012 17:45:46 +0000
Subject: [rabbitmq-discuss] Performance on ec2
In-Reply-To: <E3DA278C-ECCD-4D84-BDE2-1DA52B432D05@burtcorp.com>
References: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
	<CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>
	<29734019-3327-406D-9338-596565E8C8DB@burtcorp.com>
	<CACOPnvdCKOmyn96EHqirYDmeiYNFcH-BMV4MGGxRVm6WJD1RBQ@mail.gmail.com>
	<B6C9B5CE-77B8-49A1-AD18-0745B6C1B5D5@burtcorp.com>
	<E3DA278C-ECCD-4D84-BDE2-1DA52B432D05@burtcorp.com>
Message-ID: <20120123174546.GA5753@rabbitmq.com>

Hi Srdan,

In short, "yes, that's about it", especially on EC2. It would be worth
checking your results with the hipe_compile option turned on with the
latest Rabbit (2.7.1) and the latest Erlang (R15B). Search for
hipe_compile on http://www.rabbitmq.com/configure.html

Over loopback, with very very small message payloads, with hipe turned
on, Rabbit can read off a single socket and throw the data away (i.e.
no bindings from an exchange) at somewhere around 100kHz. Obviously
depending on hardware. Also that figure might be a little old these
days. As payload increases, and non-loopback, and non-hipe, and EC2
issues, plus actually doing something with the messages such sending
them first into queues, buffering them, and then sending them out to
consumers, an overall throughput of around 20kHz is not unexpected.

When we do a simple one-publisher, one-queue, one-consumer benchmark,
until recently, the figures were something like 16kHz with 1-ack per
message (no qos) and 25kHz with noAck turned on (autoack). Those figures
are both in and out - i.e. 25kHz msgs in, and 25kHz msgs out. It's only
due to a bunch of quite recent optimisations and getting hipe to work
for us that those figures have improved a bit.

If increasing publishing rate decreases consuming rate then you've hit a
bottleneck somewhere. Either your CPUs are maxed out (or, if not then
there must somewhere be some other reason why Rabbit can't utilise more
CPU) or you've hit a network bottleneck or a disk bottleneck or
something else.

On a single machine, I'd be surprised if you can get close to 100kHz.
Across a cluster it should be possible provided the load is spread
across all the machines - don't forget a queue is a single process on a
single node within the cluster so the maximum speed of an individual
queue is determined by the speed of a single core on one machine. Thus
if you need to go faster than a single core, then you have to spread the
load across multiple queues. Once you max out the cores on a single
machine, you'll need to go to multiple nodes.

Matthew

From static.void.dev at gmail.com  Mon Jan 23 17:46:24 2012
From: static.void.dev at gmail.com (Mark)
Date: Mon, 23 Jan 2012 09:46:24 -0800
Subject: [rabbitmq-discuss] AMQP, Bunny and Carrot Gems
In-Reply-To: <34E317D5-80AC-4C43-9202-AABFC528F353@gmail.com>
References: <46f5718a-0a17-4e13-93c6-d6ae4b56cc93@k10g2000yqk.googlegroups.com>
	<34E317D5-80AC-4C43-9202-AABFC528F353@gmail.com>
Message-ID: <4F1D9CF0.9050004@gmail.com>

Thanks for the insight. From the gist of it it sounds like there really 
isn't a good reason to use any of those other gems.

As for your example can't you skip the asynchronous "complexity" by 
simply using a block?

channel.queue("", :auto_delete => true, :exclusive => true) do |queue, 
declare_ok|
     puts "Broker generated name: #{queue.name}"
     queue.bind(exchange).subscribe(&method(:handle_reply))
end

Thanks

On 1/23/12 8:28 AM, Michael Klishin wrote:
> StaticVoid:
>
>> Sorry for my ignorance but can someone please explain why someone
>> would use the Bunny or Carrot synchronous gems over the standard Ruby-
>> AMQP gem?
> Simplicity. Some people, especially in the Ruby community, value "the simplest thing out there"
> more than anything else. In some cases, that's a good reason.
>
> For example, even though amqp gem lets you write pseudo synchronous code like
>
> q = ch.queue("", :auto_delete =>  true)
> # for this method to work, we need to know queue name
> # but it is server-generated and will be assigned asynchronously.
> # so consumer registration is delayed until after we know the name.
> q.subscribe(&method(:handle_reply))
>
> it is not synchronous and in some rare cases, this has to be taken into account. Some developers
> find this "too complex" and will ignore all the features, documentation guides, performance and error handling/recovery
> support amqp gem offers just because using it requires some basic understanding of how
> asynchronous libraries work and what downsides they have.
>
> Another reason may be that amqp gem 0.8.0 and later version requires RabbitMQ 2.0+. Tools like
> Chef want to support stock rabbitmq versions in ubuntu and debian repositories and that often means
> 1.7.x versions.
>
>> Is it more safe because the call to the broker is blocked
>> until it receives a response while as the ruby-amqp could fail? How
>> much of a performance penalty is there for using amqp synchronously.
>> Typically which is used more... Carrot or Bunny and why?
>>
>> Thanks for the input
> Definitely Bunny. Bunny is not actively maintained at the moment but I haven't met
> a single Carrot user in over a year.
>
> MK
>

From alan.antonuk at gmail.com  Mon Jan 23 17:48:46 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 23 Jan 2012 12:48:46 -0500
Subject: [rabbitmq-discuss] [announce] rabbitmq-c client build procedure for
	OpenVMS
Message-ID: <CAAt2poLFSrQYAoABBqF9HRsj-hf8=Ku==i0DJmH1spADHNHqAQ@mail.gmail.com>

I've created a set of MMS/MMK descrip files so that the rabbitmq-c client
can be built and run on OpenVMS.  The source can be found here:

https://github.com/alanxz/rabbitmq-c/tree/vms_build

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/5f3dadbc/attachment.htm>

From developer at dnsplus.net  Mon Jan 23 18:54:21 2012
From: developer at dnsplus.net (dnsplus)
Date: Mon, 23 Jan 2012 10:54:21 -0800 (PST)
Subject: [rabbitmq-discuss] Architecture Question: 2 Brokers,
 or Not 2 Brokers ?
In-Reply-To: <c3654422-21c9-40f4-a29a-a57eed647228@StrongMad.local>
References: <33189279.post@talk.nabble.com>
	<c3654422-21c9-40f4-a29a-a57eed647228@StrongMad.local>
Message-ID: <33190235.post@talk.nabble.com>




Jerry Kuch wrote:
> 
> Hi, dnsplus:
> 
> Could you perhaps clarify a bit what you mean by "remote?"  Are you
> talking about systems that are geographically separated from your
> "central broker" for some reason external to your application?  Or
> are you just talking about having 8,000 consumers?  The latter
> shouldn't be a daunting number at all for even fairly modest Rabbit
> deployments.
> 
> Best regards,
> Jerry
> 
> 

Its a little complicated, but I'll give it my best shot:

Jerry, for you ... Definition of a Site:  A retail store location, from 1 to
~1800 miles away from the data center where the Central Broker runs). 

I am working with a large environment which has no guarantee of a stable
network, or guaranteed bandwidth to the remote sites. The typical CIR is
384Kbps, with a 1.544Mbps MAX (yep, fractional T1s). To mitigate the
possibility that network connectivity to a site, or region, can be
unavailable for an undetermined period of time, at any time, and for any
reason ... we think guaranteed message delivery with RabbitMQ is the
foundation we need for this 'application' to work. 

The message payload for this application will be well formatted XML which
contains instructions that will be parsed, interpreted, and executed via a
consumer at each client site, implemented in PERL. 

So ... should I be using a Central Broker, which forwards a message to a
queue at a remote broker, which is consumed by the client process?

Or, do I leverage the Central Broker with a Queue for each remote site, and
configure the consumers to talk to the Central Broker for message collection
and processing. 


From simon at rabbitmq.com  Mon Jan 23 19:06:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Jan 2012 19:06:11 +0000
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <5955234.1287.1327339099047.JavaMail.geo-discussion-forums@vbed2>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>	<4F196036.3050708@rabbitmq.com>	<2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>	<4F1D43CB.2070709@rabbitmq.com>
	<5955234.1287.1327339099047.JavaMail.geo-discussion-forums@vbed2>
Message-ID: <4F1DAFA3.9090809@rabbitmq.com>

On 23/01/12 17:18, Dennis Jacobfeuerborn wrote:
> I put two archives here containing the output of your command and a
> rabbitmqctl report:
>
> http://www.conversis.de/exac/rabbitmq-dump.tar.gz
> http://www.conversis.de/exac/rabbitmq-dump2.tar.gz

Unfortunately they don't contain enough information (apart from to 
confirm that all the memory is being used by queues).

Please can you send us the result of:

rabbitmqctl eval 
'lists:sublist(lists:reverse(lists:sort([{process_info(Pid,memory), Pid, 
sys:get_status(Pid,infinity)} || Pid <- [element(7, Q) || Q <- 
rabbit_amqqueue:list()]])), 10).'

BUT BEWARE: This command will use several times more memory than the 
queues are themselves using - it sounds like you are able to replicate 
this state quite easily so please run this command when memory use is 
still comparatively low (but growing).

Thanks, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Mon Jan 23 19:33:32 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 23 Jan 2012 19:33:32 +0000
Subject: [rabbitmq-discuss] [announce] rabbitmq-c client build procedure
 for OpenVMS
In-Reply-To: <CAAt2poLFSrQYAoABBqF9HRsj-hf8=Ku==i0DJmH1spADHNHqAQ@mail.gmail.com>
References: <CAAt2poLFSrQYAoABBqF9HRsj-hf8=Ku==i0DJmH1spADHNHqAQ@mail.gmail.com>
Message-ID: <CACOPnvdQAmWBEMtNdjh+4XR5AfoBHZOOJpWj3Ki8QwNH3dv0Yw@mail.gmail.com>

Cool!  Thank-you.


On Mon, Jan 23, 2012 at 5:48 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:
> I've created a set of MMS/MMK descrip files so that the rabbitmq-c client
> can be built and run on OpenVMS. ?The source can be found here:
>
> https://github.com/alanxz/rabbitmq-c/tree/vms_build
>
> -Alan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From dawgtool at aol.com  Mon Jan 23 19:46:57 2012
From: dawgtool at aol.com (DawgTool)
Date: Mon, 23 Jan 2012 14:46:57 -0500
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures
 on	Queue Bind - 2012-01-20
In-Reply-To: <4F1D3CE1.6060701@rabbitmq.com>
References: <4F19E73D.9080107@aol.com> <4F1D3CE1.6060701@rabbitmq.com>
Message-ID: <4F1DB931.4020501@aol.com>

Hi Simon,

ok, created the exchange before starting the downstream server.  
Federation exchange is created, but it is not bound to the dc001-exchange-u.
Am I missing something?


On 1/23/12 5:56 AM, Simon MacMullen wrote:
> On 20/01/12 22:14, DawgTool wrote:
>> <<"NOT_FOUND - no exchange 'dc001-exchange-u' in vhost '/'">>}},
>
> Does the upstream exchange exist? The federation plugin will not 
> create it for you.
>
> Cheers, Simon
>


From adamrabung at gmail.com  Mon Jan 23 20:39:52 2012
From: adamrabung at gmail.com (Adam Rabung)
Date: Mon, 23 Jan 2012 15:39:52 -0500
Subject: [rabbitmq-discuss] Confirmation listeners and closing a channel
Message-ID: <CAAN_EDrChfHHebcD9xH6Pin_ONOfw-gnMQX524Yui=Gb985vkQ@mail.gmail.com>

Hello,
I am trying to understand the effect ConfirmationListeners have on channel
closing.  It looks like if messages are published with "mandatory=true",
the corresponding Channel.close will block until all notifications have
been received (unsure of any timeout, I've seen it block for over a
minute).  I understand "mandatory" to mean "return the message to all
Return/Confirm listeners".  Is this blocking behavior also part of
mandatory behavior, or should close() happen immediately?

Something else interesting happens when you close a channel with pending
callbacks: listeners are immediately removed.  The consequence is you block
until all confirmations/returns have happened, but your listeners don't
receive them.

Here's some example code:
https://gist.github.com/1665378

If you call this with
RabbitTest.publish(0, exchange, routingKey, msg, brokerAddress);
prints "0 callbacks, waited 0ms before close, close took 5959"

RabbitTest.publish(5000, exchange, routingKey, msg, brokerAddress);
prints "427 callbacks, waited 5000ms before close, close took 833"

Note how both take roughly 5800ms.  On the first call, we don't pause
before calling close, and receive 0 callbacks. However, the second one,
which waits 5000ms before trying to call close, gets most of the callbacks.
 A longer pause before close results in all callbacks being handled.

To reproduce this, I use a roughly 200 character string as my message.
 It's also important that the message be published as "persistent" - I
think transient messages are too fast to reveal this :)

Should callbacks block close?  If so, should listeners continue to receive
callbacks as close happens?

Thank you,
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/b641b023/attachment.htm>

From simone.busoli at gmail.com  Mon Jan 23 20:40:58 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 23 Jan 2012 21:40:58 +0100
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <20120123105135.GP3543@southbank.Home>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
Message-ID: <CAOn7oW9nrE7JkQZ3zDHPZa-ccNfWNPPND4HH1qEda0aQxSDa+g@mail.gmail.com>

Alex, I'm quite confident that since 2.7.0 messages are kept in queues in
the same order in which they reached the queue in the first place.

On Mon, Jan 23, 2012 at 11:51, Alexandru Scvor?ov <alexandru at rabbitmq.com>wrote:

> But, if consumers fail before acknowledging the messages (or if they
> reject the messages), those messages will requeued at the end of the
> queue.  So, if the consumer that got message 1 rejects it, the new
> order of messages will be 2, 3, 1.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/d0c1a5fa/attachment.htm>

From simone.busoli at gmail.com  Mon Jan 23 20:50:21 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 23 Jan 2012 21:50:21 +0100
Subject: [rabbitmq-discuss] Confirmation listeners and closing a channel
In-Reply-To: <CAAN_EDrChfHHebcD9xH6Pin_ONOfw-gnMQX524Yui=Gb985vkQ@mail.gmail.com>
References: <CAAN_EDrChfHHebcD9xH6Pin_ONOfw-gnMQX524Yui=Gb985vkQ@mail.gmail.com>
Message-ID: <CAOn7oW95tXpmtKGvbHQaNjcb=dztRSsb95q=u7GtPMkEQxjKMw@mail.gmail.com>

I'm not confident with the Java API but although ideally it would make
sense to be able to configure whether the channel waits for confirms before
closing, it is sensible for it to wait, as it appears it is doing here.
Also mandatory doesn't have anything to do with this, check the protocol
specification for that; you can see that even without the mandatory flag
you'll experience the same behavior.
What seems to be happening here is that when you call close your listeners
are removed but the channel, since in confirm mode, will still wait for all
confirms to arrive. It probably has its own listeners inside and until all
messages are either acked or nacked it will wait.
Finally, I noticed that version 2.7.1 of the broker (at least), publication
rate being equal will send confirms in batches when messages are persistent
and one by one when messages are transient, if that's on any help to you.

Simone

On Mon, Jan 23, 2012 at 21:39, Adam Rabung <adamrabung at gmail.com> wrote:

> Hello,
> I am trying to understand the effect ConfirmationListeners have on channel
> closing.  It looks like if messages are published with "mandatory=true",
> the corresponding Channel.close will block until all notifications have
> been received (unsure of any timeout, I've seen it block for over a
> minute).  I understand "mandatory" to mean "return the message to all
> Return/Confirm listeners".  Is this blocking behavior also part of
> mandatory behavior, or should close() happen immediately?
>
> Something else interesting happens when you close a channel with pending
> callbacks: listeners are immediately removed.  The consequence is you block
> until all confirmations/returns have happened, but your listeners don't
> receive them.
>
> Here's some example code:
> https://gist.github.com/1665378
>
> If you call this with
> RabbitTest.publish(0, exchange, routingKey, msg, brokerAddress);
> prints "0 callbacks, waited 0ms before close, close took 5959"
>
> RabbitTest.publish(5000, exchange, routingKey, msg, brokerAddress);
> prints "427 callbacks, waited 5000ms before close, close took 833"
>
> Note how both take roughly 5800ms.  On the first call, we don't pause
> before calling close, and receive 0 callbacks. However, the second one,
> which waits 5000ms before trying to call close, gets most of the callbacks.
>  A longer pause before close results in all callbacks being handled.
>
> To reproduce this, I use a roughly 200 character string as my message.
>  It's also important that the message be published as "persistent" - I
> think transient messages are too fast to reveal this :)
>
> Should callbacks block close?  If so, should listeners continue to receive
> callbacks as close happens?
>
> Thank you,
> Adam
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/76be9b7e/attachment.htm>

From stu3b3 at gmail.com  Mon Jan 23 20:37:48 2012
From: stu3b3 at gmail.com (David Stuebe)
Date: Mon, 23 Jan 2012 12:37:48 -0800 (PST)
Subject: [rabbitmq-discuss] Management plugin calls bindings routing keys
Message-ID: <2569406.2208.1327351068669.JavaMail.geo-discussion-forums@yqia35>



Hey RabbitMQ folks

The web admin plugin is fantastic for development debugging, but some of 
the dev team I work with are having a hard time because it seems like the 
web UI is using the wrong name for bindings - it is calling them routing 
keys. 


<https://img.skitch.com/20120120-xhcfhnm6x12gm7it1skya2sa5p.jpg>

Can that be filed as a bug? Should be a minor change...

David

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/79708ca6/attachment.htm>

From simone.busoli at gmail.com  Mon Jan 23 21:18:42 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 23 Jan 2012 22:18:42 +0100
Subject: [rabbitmq-discuss] Architecture Question: 2 Brokers,
 or Not 2 Brokers ?
In-Reply-To: <33190235.post@talk.nabble.com>
References: <33189279.post@talk.nabble.com>
	<c3654422-21c9-40f4-a29a-a57eed647228@StrongMad.local>
	<33190235.post@talk.nabble.com>
Message-ID: <CAOn7oW9NZMc003BHQDfZKDsfKLT2beVV7x=oeoHn4MsT6j2zDA@mail.gmail.com>

Hi dns, I'll try to bring my own experience on the subject. When you
federate exchanges between brokers you are in the loose sense having the
downstream exchange acting as a consumer for the upstream exchange. I may
have misunderstood you but I think that having 8000 brokers rather 8000
remote consumers on the central broker doesn't solve the consistency
problem you are describing.

Let's make an example with federated brokers on the happy path:

   1. One message is published on the upstream exchange and reaches the
   downstream exchange, and in turn the queue and then the consumer on the
   downstream broker
   2. The downstream broker confirms the message to the upstream broker so
   the upstream broker can forget about it
   3. The connection between the brokers goes down
   4. The consumer on the downstream broker processes the message,
   acknowledges it and everyone's happy

Here's the sad path with federated brokers:

   1. same as above
   2. The connection between the brokers is lost before the downstream can
   confirm the message to the upstream (unlikely, but can definitely happen)
   3. The consumer on the downstream broker processes the message and
   acknowledges it to its local broker
   4. The connection between the two brokers is restored, and thus the
   upstream will resend the unconfirmed messages once again
   5. The consumer on the downstream will receive the same message it has
   already consumed, therefore it will need a way to deduplicate it

Now the safe path with just the central broker:

   1. One message is published on the central broker and reaches a remote
   consumers
   2. The consumer processes the message but the connection to the central
   broker will go down before it can ack the message
   3. Once the connection is restored the consumer will receive the unacked
   message again, so also in this case it will need to deduplicate it

Some observations:

   - in any case your consumer will need to be somewhat aware of the fact
   that it is quite distant from the original broker and cope with what this
   implies in some way (message duplication, for one)
   - with the central broker the remote consumers will have to handle
   connection failures themselves, something which is less likely to happen
   with a local broker, although not impossible of course. This is handled by
   the federation plugin in case of federated brokers instead
   - Having 8000 brokers rather than 8000 consumers is going to require
   quite some maintenance, and I'm not sure how well the federation plugin
   RabbitMQ can handle that, I am under the impression that it was not
   designed for this many federated exchanges, but I may be wrong
   - You mention synchronicity between the central location and the remote
   consumers. Consider that even if you federate brokers and you see all
   messages delivered and acked on the federation queues, it doesn't tell you
   anything about whether the remote consumers have processed the messages or
   not


On Mon, Jan 23, 2012 at 19:54, dnsplus <developer at dnsplus.net> wrote:

>
>
>
> Jerry Kuch wrote:
> >
> > Hi, dnsplus:
> >
> > Could you perhaps clarify a bit what you mean by "remote?"  Are you
> > talking about systems that are geographically separated from your
> > "central broker" for some reason external to your application?  Or
> > are you just talking about having 8,000 consumers?  The latter
> > shouldn't be a daunting number at all for even fairly modest Rabbit
> > deployments.
> >
> > Best regards,
> > Jerry
> >
> >
>
> Its a little complicated, but I'll give it my best shot:
>
> Jerry, for you ... Definition of a Site:  A retail store location, from 1
> to
> ~1800 miles away from the data center where the Central Broker runs).
>
> I am working with a large environment which has no guarantee of a stable
> network, or guaranteed bandwidth to the remote sites. The typical CIR is
> 384Kbps, with a 1.544Mbps MAX (yep, fractional T1s). To mitigate the
> possibility that network connectivity to a site, or region, can be
> unavailable for an undetermined period of time, at any time, and for any
> reason ... we think guaranteed message delivery with RabbitMQ is the
> foundation we need for this 'application' to work.
>
> The message payload for this application will be well formatted XML which
> contains instructions that will be parsed, interpreted, and executed via a
> consumer at each client site, implemented in PERL.
>
> So ... should I be using a Central Broker, which forwards a message to a
> queue at a remote broker, which is consumed by the client process?
>
> Or, do I leverage the Central Broker with a Queue for each remote site, and
> configure the consumers to talk to the Central Broker for message
> collection
> and processing.
>
> From an accounting perspective, I am thinking the Central Broker is going
> to
> be easier to query for unconsumed messages, or query a common error queue
> which is written to by the remote client, when things go amiss.
>
> But, should there be a network interruption between the time a client
> collects the message from Central, and starts the execution of instructions
> it contains, the Central Que would fail to get an ACK, or possible error
> message from the client. This could result in a lack of synchronicity
> between reality as understood by the remote client consumer, and the
> accounting and reporting mechanisms at Central.
>
> Hopefully I have conveyed more than my own confusion about this project.
>
> Thanks !
>
>
>
> --
> View this message in context:
> http://old.nabble.com/Architecture-Question%3A-2-Brokers%2C-or-Not-2-Brokers---tp33189279p33190235.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/6fbff298/attachment.htm>

From fearsome.lucidity at gmail.com  Mon Jan 23 21:44:42 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Mon, 23 Jan 2012 13:44:42 -0800
Subject: [rabbitmq-discuss] Shovel questions
In-Reply-To: <CAOn7oW_az9BeOcSxkW25uUrepyz57Y19XgrsmxVSOP9xDuGHHg@mail.gmail.com>
References: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>
	<CAOn7oW_az9BeOcSxkW25uUrepyz57Y19XgrsmxVSOP9xDuGHHg@mail.gmail.com>
Message-ID: <CAFDmHdNb_UbPrS2=ePhqr3MVX1b4SuYvyU6jXKjYfy-SOBnRVg@mail.gmail.com>

On Sun, Jan 22, 2012 at 4:46 AM, Simone Busoli <simone.busoli at gmail.com>wrote:

> On Sat, Jan 21, 2012 at 23:58, Elias Levy <fearsome.lucidity at gmail.com>wrote:
>
>> We are thinking of exposing a portion of our message bus to customers.
>>  To do we we will be creating a new cluster that can be exposed and will be
>> linking it to our existing cluster.
>>
>> I've looked a the Federation plug-in, but it has a feature disqualifies
>> it for our purposes.   We'd like to keep communications from our existing
>> cluster to the new exposed cluster unidirectional.  That means now allowing
>> incoming connections into the existing cluster, in case there is ever a
>> RabbitMQ vulnerability (or say, an Erlang or OpenSSL vulnerability) that
>> would allow the external cluster to be compromised.  Since both cluster are
>> running RabbitMQ, we don't want an attacker to be able to jump from the
>> external cluster to the internal one.  From what I've gathered, the AMQP
>> client that the Federation plug-in uses executed within the downstream
>> broker, and thus it has to be able to make an AMQP connection to the
>> upstream broker.
>>
>> Is that correct?  Any plans to allow for the opposite behavior (upstream
>> connects to the downstream broker)?
>>
>
> I don't know the internals of the federation plugin well enough to be able
> to answer this question. I know that it uses exchange-exchange bindings and
> I'm not sure if it's even feasible to have it work in the way you describe.
>

I think you are wrong.  The Federation plug-in does not use
exchange-to-exchange bindings.  Such bindings are not supported across
virtual hosts, never mind across clusters.  The Federation plug-in merely
provides a nice illusion of such binding by using an internal AMQP client
as I described.

Any other takers?

That leaves us with the Shovel plug-in, which can be configured to run on
>> either the upstream or downstream broker.
>>
>> One problem with the Shovel plug-in is that it appears you can only
>> manage the shovels within the configuration file.  Is there no way to
>> manage shovels online, either through AMQP or a management plug-in?
>>
>
> No, there is no way to do that except in the configuration file.
>

That's too bad.


> If neither of those are possible, can RabbitMQ reload its configuration
>> without restarting?
>>
>
> No, you cannot do that. Nonetheless be aware that shovel is not hard to
> set up manually as an external component from the broker, although with
> some gotchas. We've been doing that for some time before the federation
> plugin was published.
>

Interesting.  Do you have any documentation on how one may go about doing
so?  Or are you merely standing up a new RabbitMQ instance with the shovel
configured, and not using the broker in those new instances?

One disadvantage of running the shovel appart from the downstream and
upstream brokers is that now the messages must cross the network twice,
once from the upstream to the shovel, and then from the shovel to the
downstream.  With the shovel within the upstream or downstream broker only
one network transfer is needed.


> Finally, its unclear whether you should only define a shovel in a single
>> node in a cluster or in multiple ones?  If you define it in multiple ones,
>> does it create multiple shovel clients competing for messages?  If not,
>> will a shovel fail over if the node with the existing client fails?
>>
>
> Shovel is a low level mechanis, so whatever you configure it, it will do
> what you told it to, i.e. pick messages from one queue and publish them to
> some exchange. How you set it up is then up to you according to what you
> want to accomplish.
>

I understand that.  My question is whether the shovel is cluster aware,
like the federation plug-in.

The federation plug-in, when configured on all nodes, will only make a
single connection to the upstream broker, and if the nodes with the
connection dies, another node will create a new one.

My understanding is that the shovel is not cluster aware.  If you configure
the shovel on each node in your cluster, you'll end up with as many shovels
and connections as there are nodes.  That's not particularly bad, as it
will give you load balancing across nodes, but I want to confirm my
understanding.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/212f988e/attachment.htm>

From simone.busoli at gmail.com  Mon Jan 23 21:48:03 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 23 Jan 2012 22:48:03 +0100
Subject: [rabbitmq-discuss] Shovel questions
In-Reply-To: <CAFDmHdNb_UbPrS2=ePhqr3MVX1b4SuYvyU6jXKjYfy-SOBnRVg@mail.gmail.com>
References: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>
	<CAOn7oW_az9BeOcSxkW25uUrepyz57Y19XgrsmxVSOP9xDuGHHg@mail.gmail.com>
	<CAFDmHdNb_UbPrS2=ePhqr3MVX1b4SuYvyU6jXKjYfy-SOBnRVg@mail.gmail.com>
Message-ID: <CAOn7oW-VwcESWChefoHbtP4jvt73sm64bo8_a2dX1iQ0=BJZzA@mail.gmail.com>

What I was trying to say is that it uses ex-ex bindings internally, not
across brokers

On Mon, Jan 23, 2012 at 22:44, Elias Levy <fearsome.lucidity at gmail.com>wrote:

> I think you are wrong.  The Federation plug-in does not use
> exchange-to-exchange bindings
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/3d513b32/attachment.htm>

From fearsome.lucidity at gmail.com  Mon Jan 23 22:15:27 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Mon, 23 Jan 2012 14:15:27 -0800
Subject: [rabbitmq-discuss] Shovel questions
In-Reply-To: <CAOn7oW-VwcESWChefoHbtP4jvt73sm64bo8_a2dX1iQ0=BJZzA@mail.gmail.com>
References: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>
	<CAOn7oW_az9BeOcSxkW25uUrepyz57Y19XgrsmxVSOP9xDuGHHg@mail.gmail.com>
	<CAFDmHdNb_UbPrS2=ePhqr3MVX1b4SuYvyU6jXKjYfy-SOBnRVg@mail.gmail.com>
	<CAOn7oW-VwcESWChefoHbtP4jvt73sm64bo8_a2dX1iQ0=BJZzA@mail.gmail.com>
Message-ID: <CAFDmHdOhMD4ZwouG7y1Aqq6LOjdORdF4OipiSiyiCiAZoMwX5w@mail.gmail.com>

On Mon, Jan 23, 2012 at 1:48 PM, Simone Busoli <simone.busoli at gmail.com>wrote:

> What I was trying to say is that it uses ex-ex bindings internally, not
> across brokers
>

In what context does it do that?  Are you referring to an ex-ex binding
between the x-federated exchange and its backing exchange (the exchange of
the selected type)?

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/c119555d/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jan 23 22:22:43 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 24 Jan 2012 02:22:43 +0400
Subject: [rabbitmq-discuss] AMQP, Bunny and Carrot Gems
In-Reply-To: <4F1D9CF0.9050004@gmail.com>
References: <46f5718a-0a17-4e13-93c6-d6ae4b56cc93@k10g2000yqk.googlegroups.com>
	<34E317D5-80AC-4C43-9202-AABFC528F353@gmail.com>
	<4F1D9CF0.9050004@gmail.com>
Message-ID: <26997F24-E350-4EBF-8B64-D5B39E5799CA@gmail.com>

Mark:

> Thanks for the insight. From the gist of it it sounds like there really isn't a good reason to use any of those other gems.
> 

In my opinion, yes, but I can see why dealing with EventMachine in a separate thread + reconnection on Unicorn and Passenger may be an annoyance for developers.

> As for your example can't you skip the asynchronous "complexity" by simply using a block?
> 
> channel.queue("", :auto_delete => true, :exclusive => true) do |queue, declare_ok|
>    puts "Broker generated name: #{queue.name}"
>    queue.bind(exchange).subscribe(&method(:handle_reply))
> end
> 
> Thanks

Using blocks is the recommended way to go. However, many developers don't like
it for "the callback soup". It may require a certain mental shift, too. Purely from the familiarity
perspective, my original snippet looks "simpler" and relatively attractive to newcomers. That's one of the reasons why
we had to do extra work to make it work in 0.8.0+ (primary reason is backwards compatibility) and add
this documentation section to the Getting Started guide:

http://rubyamqp.info/articles/getting_started/#integration_with_objects

I like the middle road Java client and Hot Bunnies [1] take: they are synchronous/blocking for operations used when applications
boot (like queue.declare) but asynchronous for operations used further in application lifecycle (basic.publish, basic.consume and so on). In part for that reason I recommend Hot Bunnies to people who can use JRuby.

1. https://github.com/ruby-amqp/hot_bunnies

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From simone.busoli at gmail.com  Mon Jan 23 22:33:28 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 23 Jan 2012 23:33:28 +0100
Subject: [rabbitmq-discuss] Shovel questions
In-Reply-To: <CAFDmHdOhMD4ZwouG7y1Aqq6LOjdORdF4OipiSiyiCiAZoMwX5w@mail.gmail.com>
References: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>
	<CAOn7oW_az9BeOcSxkW25uUrepyz57Y19XgrsmxVSOP9xDuGHHg@mail.gmail.com>
	<CAFDmHdNb_UbPrS2=ePhqr3MVX1b4SuYvyU6jXKjYfy-SOBnRVg@mail.gmail.com>
	<CAOn7oW-VwcESWChefoHbtP4jvt73sm64bo8_a2dX1iQ0=BJZzA@mail.gmail.com>
	<CAFDmHdOhMD4ZwouG7y1Aqq6LOjdORdF4OipiSiyiCiAZoMwX5w@mail.gmail.com>
Message-ID: <CAOn7oW8TYV3N+Pq8p+fSYE8Fj08-d1ep6hGDL5sTiHMcGOa1tA@mail.gmail.com>

exactly, but as I said I don't know much more about the internals of the
mechanism

On Mon, Jan 23, 2012 at 23:15, Elias Levy <fearsome.lucidity at gmail.com>wrote:

> On Mon, Jan 23, 2012 at 1:48 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>
>> What I was trying to say is that it uses ex-ex bindings internally, not
>> across brokers
>>
>
> In what context does it do that?  Are you referring to an ex-ex binding
> between the x-federated exchange and its backing exchange (the exchange of
> the selected type)?
>
> Elias
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/5482388c/attachment.htm>

From djacobfeuerborn at gmail.com  Mon Jan 23 22:34:23 2012
From: djacobfeuerborn at gmail.com (Dennis Jacobfeuerborn)
Date: Mon, 23 Jan 2012 14:34:23 -0800 (PST)
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <4F1DAFA3.9090809@rabbitmq.com>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>	<4F196036.3050708@rabbitmq.com>	<2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>	<4F1D43CB.2070709@rabbitmq.com>
	<5955234.1287.1327339099047.JavaMail.geo-discussion-forums@vbed2>
	<4F1DAFA3.9090809@rabbitmq.com>
Message-ID: <24758975.860.1327358063919.JavaMail.geo-discussion-forums@vbue14>

Here is the new output (2.5mb):
http://www.conversis.de/exac/memory.txt.bz2

It seems the memory issue has something to to with the clustering. When 
doing another test I saw in the management interface that the second node 
wasn't online (probably shut down by a co-worker). I ran the script with 
just the one node and after the message where consumed all the memory was 
returned properly. So I started the second node and tried again. This time 
the memory wasn't returned at the end on the first node but on the second 
one it was. Then I shut down the second node again and shortly after that 
the first node went back to almost the initial memory consumption level.
The new dump shows the state when both cluster nodes are online and the 
second node has returned its memory but the first one hasn't. The command 
was run on the first node.

Regards,
  Dennis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/02e034a5/attachment.htm>

From alan.antonuk at gmail.com  Mon Jan 23 22:46:54 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 23 Jan 2012 17:46:54 -0500
Subject: [rabbitmq-discuss] rabbitmq-c API improvements for multiple
	channels
In-Reply-To: <CACOPnvdd=svYgtoP33J+ntpbQzNKS9GONcx_tTvFou8cJdK14A@mail.gmail.com>
References: <CAAt2poJqy+pwASwhbChmAbF569w3xHM02sFJwNJ3ZSVKX8MoxA@mail.gmail.com>
	<CACOPnvfx14ctnj2j+aE00icET7VugteBN6Vw5EgikROJMHh0_Q@mail.gmail.com>
	<CAAt2poKSx8MFP9ORT5L7auA3w7g6JpLXdPdw99ujOJv1PSnyqg@mail.gmail.com>
	<CACOPnvdd=svYgtoP33J+ntpbQzNKS9GONcx_tTvFou8cJdK14A@mail.gmail.com>
Message-ID: <CAAt2poJepTCJj1_sOfBkE0NTPiEhExaK88mJyyB0pTH6+=wa8g@mail.gmail.com>

Ok, I've gone ahead and implemented what I think should be a channel-based
memory pooling, which you can find here:

https://github.com/alanxz/rabbitmq-c/tree/channel_owns_memory_pool

Its not quite API/ABI backwards compatible, the change that breaks things
being adding an extra field to the amqp_pool_t struct:
https://github.com/alanxz/rabbitmq-c/commit/2bc1dc9e22152506cf07f21d10e6a79e7ed2ccc3#diff-2

This could be fixed easy enough, the trade-off being some complexity
internally.

The change isn't a small patch, and should probably have a few more pairs
of eyes look at it, despite having a few unit tests written for
the machinery that moves the internal memory pools around.

For an explanation of what my implementation tries to do:
https://github.com/alanxz/rabbitmq-c/commit/2bc1dc9e22152506cf07f21d10e6a79e7ed2ccc3#L5R119

I have no idea how this will scale, especially to things like embedded
devices.  Hopefully I have not created a monster.

If the overarching idea looks sane to people, I will create a pull request
and we can see about merging this in.

-Alan


On Fri, Jan 13, 2012 at 5:15 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Alan,
>
> I'm afraid everyone has been distracted.
>
> Could anyone on the list opine?
>
> alexis
>
>
> On Fri, Jan 13, 2012 at 9:19 PM, Alan Antonuk <alan.antonuk at gmail.com>
> wrote:
> > I haven't really had a huge amount of time to work on it since I sent the
> > first message message, with the holidays and starting up a new project at
> > work.
> >
> > Also I was hoping to get some input from the rabbitmq guys so that any
> > changes I make would have a better chance of being accepted.
> >
> > Taking a quick look at what I wrote a month ago, today my plan would be
> to
> > implement having a amqp_pool_t associated with each amqp_channel_t and
> see
> > how far I could get with that.
> >
> > -Alan
> >
> > On Thu, Jan 12, 2012 at 11:39 AM, Alexis Richardson <alexis at rabbitmq.com
> >
> > wrote:
> >>
> >> Alan
> >>
> >> It appears that you stunned everyone into silence ;-)
> >>
> >> How are you getting on with this?
> >>
> >> alexis
> >>
> >>
> >> On Wed, Dec 14, 2011 at 8:15 PM, Alan Antonuk <alan.antonuk at gmail.com>
> >> wrote:
> >> > I've been working on a c++ wrapper around rabbitmq-c that presents a
> >> > "humane" API to the programmer heavily inspired by the Puka project.
> >> > (see: https://github.com/alanxz/SimpleAmqpClient).
> >> >
> >> > In developing this library I've run across several limitations of the
> >> > rabbitmq-c when working with multiple channels, the biggest issue
> being:
> >> >
> >> > - There is no way to wait for a list of methods on a channel.
> >> > There is amqp_simple_wait_method() - however this suffers from some
> >> > serious
> >> > drawbacks:
> >> > + you can only specify one method to listen for
> >> > + it calls abort() if a different method, or a method on a different
> >> > channel
> >> > is received
> >> > A use case for this might be: doing a basic.publish, and you want to
> >> > want to
> >> > wait for a basic.ack or a basic.return on a channel with confirms
> >> > enabled
> >> >
> >> > The way I got around this in SimpleAmqpClient was to only use
> >> > amqp_simple_wait_frame() and maintain queues of amqp_frame_t for each
> >> > channel that I have open.
> >> >
> >> > However, this comes with one serious drawback: memory management. Each
> >> > decoded frame is allocated in a connection-wide amqp_pool_t.  Because
> of
> >> > this - it is impossible to recycle the pool and release memory unless
> >> > you
> >> > have dealt with all of your pending amqp_frame_t's.  This becomes a
> >> > problem
> >> > in pathological cases where you have two consumers sending
> >> > simultaneously,
> >> > you can get in the situation that even though the client program
> >> > eventually
> >> > deals with every consumed message, memory never gets released, because
> >> > there
> >> > is always at least one frame queued up.
> >> >
> >> > The above demonstrates the second biggest issue with the rabbitmq-c
> API:
> >> > memory management when dealing with multiple channels.  There is no
> way
> >> > to
> >> > separate out memory allocation on, for example, a per-channel basis
> >> > (with
> >> > the library client keeping track of the memory pools used for
> example).
> >> >
> >> > Before I go on I'd like to mention one feature that I find useful with
> >> > the
> >> > current API: it is possible to use something like select() before
> >> > calling
> >> > amqp_simple_wait_frame() to setup a timeout while waiting for a
> >> > consumer,
> >> > which is useful when developing single-threaded RPC apps.
> >> >
> >> >
> >> > So now the interesting part: how could the API be improved?
> >> >
> >> > Some thoughts I've had dealing with the memory management:
> >> > 1. Create a amqp_simple_wait_frame() variant that as one of the
> >> > parameters
> >> > provides a callback to allocate memory, either something like a
> malloc()
> >> > call, which the client would then be responsible for freeing, or
> perhaps
> >> > something like get_amqp_pool(amqp_frame_t) which allows the client to
> >> > return
> >> > a memory pool which rabbitmq-c would use to allocate memory for that
> >> > frame.
> >> >  The amqp_frame_t would have to have some minimal amount of
> information
> >> > filled in - such as frame type and channel to be useful.
> >> >
> >> > 2. amqp_channel_t becomes a struct containing both the the channel_id
> >> > and a
> >> > amqp_pool_t.  The amqp_pool would be used by the library to allocate
> >> > frames
> >> > received on that channel.  The client would then be responsible for
> >> > calling
> >> > amqp_pool_recycle at an appropriate point.
> >> >
> >> > Some thoughts on improving the API to deal with multiple channels:
> >> > 1. Add the following to the API:
> >> > amqp_simple_wait_frame_on_channel - wait for a frame on a specified
> >> > channel
> >> > amqp_simple_wait_methods - wait for multiple methods on a specified
> >> > channel.
> >> > Don't abort() if the wrong method, or channel is received, instead
> queue
> >> > up
> >> > the frame as is done in amqp_simple_rpc
> >> > amqp_frames_enqueued_for_channel to add feature parity with
> >> > amqp_frames_enqueued
> >> > I started to code this up at one point but abandoned it as it didn't
> >> > support
> >> > the interesting property of being able to use select() to specify a
> >> > timeout
> >> > when calling amqp_simple_wait_frame_on_channel.  At least not without
> >> > adding
> >> > timeout to the rabbitmq-c api, which didn't fit with how the current
> >> > rabbitmq-c api. Here's the implementation I came up with before I
> >> > abandoned
> >> > it. I can't guarantee is completely free of
> >> > bugs. https://github.com/alanxz/rabbitmq-c/commits/simple_wait_frame/
> >> >
> >> > 2. Continue to duck the issue and allow clients to write their own
> code
> >> > to
> >> > deal with multiple channels (fixing the memory management issue using
> >> > one of
> >> > the above techniques)
> >> >
> >> > 3. Something I haven't thought of yet.
> >> >
> >> > So anyone have any thoughts on all of this?
> >> >
> >> > -Alan
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120123/62151982/attachment.htm>

From developer at dnsplus.net  Mon Jan 23 22:57:44 2012
From: developer at dnsplus.net (dnsplus)
Date: Mon, 23 Jan 2012 14:57:44 -0800 (PST)
Subject: [rabbitmq-discuss] Architecture Question: 2 Brokers,
 or Not 2 Brokers ?
In-Reply-To: <CAOn7oW9NZMc003BHQDfZKDsfKLT2beVV7x=oeoHn4MsT6j2zDA@mail.gmail.com>
References: <33189279.post@talk.nabble.com>
	<c3654422-21c9-40f4-a29a-a57eed647228@StrongMad.local>
	<33190235.post@talk.nabble.com>
	<CAOn7oW9NZMc003BHQDfZKDsfKLT2beVV7x=oeoHn4MsT6j2zDA@mail.gmail.com>
Message-ID: <33191832.post@talk.nabble.com>




simone_b wrote:
> 
> Hi dns, I'll try to bring my own experience on the subject. When you
> federate exchanges between brokers you are in the loose sense having the
> downstream exchange acting as a consumer for the upstream exchange. I may
> have misunderstood you but I think that having 8000 brokers rather 8000
> remote consumers on the central broker doesn't solve the consistency
> problem you are describing.
> 
> Let's make an example with federated brokers on the happy path:
> 
>    1. One message is published on the upstream exchange and reaches the
>    downstream exchange, and in turn the queue and then the consumer on the
>    downstream broker
>    2. The downstream broker confirms the message to the upstream broker so
>    the upstream broker can forget about it
>    3. The connection between the brokers goes down
>    4. The consumer on the downstream broker processes the message,
>    acknowledges it and everyone's happy
> 
> Here's the sad path with federated brokers:
> 
>    1. same as above
>    2. The connection between the brokers is lost before the downstream can
>    confirm the message to the upstream (unlikely, but can definitely
> happen)
>    3. The consumer on the downstream broker processes the message and
>    acknowledges it to its local broker
>    4. The connection between the two brokers is restored, and thus the
>    upstream will resend the unconfirmed messages once again
>    5. The consumer on the downstream will receive the same message it has
>    already consumed, therefore it will need a way to deduplicate it
> 
> Now the safe path with just the central broker:
> 
>    1. One message is published on the central broker and reaches a remote
>    consumers
>    2. The consumer processes the message but the connection to the central
>    broker will go down before it can ack the message
>    3. Once the connection is restored the consumer will receive the
> unacked
>    message again, so also in this case it will need to deduplicate it
> 
> Some observations:
> 
>    - in any case your consumer will need to be somewhat aware of the fact
>    that it is quite distant from the original broker and cope with what
> this
>    implies in some way (message duplication, for one)
>    - with the central broker the remote consumers will have to handle
>    connection failures themselves, something which is less likely to
> happen
>    with a local broker, although not impossible of course. This is handled
> by
>    the federation plugin in case of federated brokers instead
>    - Having 8000 brokers rather than 8000 consumers is going to require
>    quite some maintenance, and I'm not sure how well the federation plugin
>    RabbitMQ can handle that, I am under the impression that it was not
>    designed for this many federated exchanges, but I may be wrong
>    - You mention synchronicity between the central location and the remote
>    consumers. Consider that even if you federate brokers and you see all
>    messages delivered and acked on the federation queues, it doesn't tell
> you
>    anything about whether the remote consumers have processed the messages
> or
>    not
> 
> 

Thank you for all this. If I were inclined to use central and remote
exchanges/brokers, then SHOVEL is the missing piece I have been looking for.
However ... oh, the overhead with maintaining it all !

I suppose I am inclined to go with a Central Broker and have remote
consumers, and was wondering if someone might convince me otherwise.
However, this has not yet happened. 

Seeing as how my application is more of a "task distribution and management
system" where all sites are processing the same tasks (with RabbitMQ making
sure that the tasks are received), it has occurred to me that I might want a
database component at the central data center as well. I am working on a
conceptual workflow to flush this idea out.

I keep coming back around to keeping as much intelligence as possible at
Central, and keeping the consumer side as lean as I can. 

Thoughts ?


-- 
View this message in context: http://old.nabble.com/Architecture-Question%3A-2-Brokers%2C-or-Not-2-Brokers---tp33189279p33191832.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simone.busoli at gmail.com  Mon Jan 23 23:14:32 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 24 Jan 2012 00:14:32 +0100
Subject: [rabbitmq-discuss] Architecture Question: 2 Brokers,
 or Not 2 Brokers ?
In-Reply-To: <33191832.post@talk.nabble.com>
References: <33189279.post@talk.nabble.com>
	<c3654422-21c9-40f4-a29a-a57eed647228@StrongMad.local>
	<33190235.post@talk.nabble.com>
	<CAOn7oW9NZMc003BHQDfZKDsfKLT2beVV7x=oeoHn4MsT6j2zDA@mail.gmail.com>
	<33191832.post@talk.nabble.com>
Message-ID: <CAOn7oW8_72RLxB-fdMjVHYNvhGXYbsQ8pZZVjT_zAEAwZj8m0w@mail.gmail.com>

On Mon, Jan 23, 2012 at 23:57, dnsplus <developer at dnsplus.net> wrote:

>
> Thank you for all this. If I were inclined to use central and remote
> exchanges/brokers, then SHOVEL is the missing piece I have been looking
> for.
> However ... oh, the overhead with maintaining it all !
>

Yes, I mentioned federation but in this context shovel is pretty much the
same thing, although perhaps a little lighter than federation. Going down
the route of several brokers, indeed, I see it becoming a pain quite soon.


>
> I suppose I am inclined to go with a Central Broker and have remote
> consumers, and was wondering if someone might convince me otherwise.
> However, this has not yet happened.
>

Perhaps some guys of the dev team can shed some light given their greater
experience.


>
> Seeing as how my application is more of a "task distribution and management
> system" where all sites are processing the same tasks (with RabbitMQ making
> sure that the tasks are received), it has occurred to me that I might want
> a
> database component at the central data center as well. I am working on a
> conceptual workflow to flush this idea out.
>

I never used it personally, but if you're going to require a central store
anyway you may consider some messaging solutions that come with the storage
itself, after all according to what you describe you would be leveraging
just a very small part of what RabbitMQ provides. For instance MS SQL
Server ships with a built-in message broker, I don't know how it works but
it may be worth investigating, and I'm sure other storages provide that as
well. Some googling of "distributed work queues" may turn up something
interesting too.


>
> I keep coming back around to keeping as much intelligence as possible at
> Central, and keeping the consumer side as lean as I can.
>
> Thoughts ?
>
>
> --
> View this message in context:
> http://old.nabble.com/Architecture-Question%3A-2-Brokers%2C-or-Not-2-Brokers---tp33189279p33191832.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120124/76c637d5/attachment.htm>

From yogimogi at gmail.com  Tue Jan 24 03:56:31 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Mon, 23 Jan 2012 19:56:31 -0800 (PST)
Subject: [rabbitmq-discuss] erroneous basicGet closing the channel?
Message-ID: <fece839f-da4f-4e2f-aebc-f96e0e4363c1@pj4g2000pbc.googlegroups.com>

Doing channel.basicGet(queueName, false); where queueName does not
exist, throws an exception

by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason: {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND -
no queue 'foobar' in vhost '/' ........

And after that doing any operation on the channel results in
com.rabbitmq.client.AlreadyClosedException

Is this expected behaviour? Are there any other calls on channel which
end up throwing an exception also close the channel?

regards, Yogesh

From yogimogi at gmail.com  Tue Jan 24 05:29:01 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Tue, 24 Jan 2012 10:59:01 +0530
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <4400DD7F-0926-41AE-965A-3C5752A0A280@rabbitmq.com>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
	<CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>
	<20120123144809.GU3543@southbank.Home>
	<7fdbb511-c8b4-45c7-aef7-adb6ba80ffdf@v6g2000pba.googlegroups.com>
	<20120123152213.GV3543@southbank.Home>
	<4400DD7F-0926-41AE-965A-3C5752A0A280@rabbitmq.com>
Message-ID: <CAAdHZhoCSNvyfXYkFGbaQ0NyzZ_2X8SgF1Vk63GT9hJ3iitc+Q@mail.gmail.com>

Hello Steve/Alex,

Thanks a lot for the help. It's pretty clear now.
So basically for a queue, as long as there is going to be only one
consumer, it hardly matters if ThreadPool with
com.rabbitmq.client.Connection underneath the channel has 1 thread or many
threads.
Well, having more threads will help if same channel is going to be used to
consume messages from other queues.

regards, Yogesh

2012/1/23 Steve Powell <steve at rabbitmq.com>

> Hi Yogesh,
>
> What Alex says is perfectly correct.
>
> The executor service is set on the connection, and is there to allow
> multiple
> channels to execute consumers simultaneously, and without blocking the
> channel
> thread. By default you get an executor service which has five threads.
>
> From the point of view of a single channel, the consumers are driven
> serially,
> one delivery at a time, upon one of the executor service threads. The same
> thread is not guaranteed to be used each time for each consumer call for a
> channel (so don't try to use ThreadLocal objects).
>
> The reason we provide this, is so that clients with many, many channels
> are not
> forced to have a Consumer thread per channel -- something that is quite
> expensive -- but have the option of allocating as many threads as they
> wish if
> they need it. At the same time we guarantee that no Consumer calls can
> 'overtake' each other on any one channel, and that Consumer processing
> runs on a
> distinct thread from the channel and the app, so that channel calls in the
> Consumer code will not deadlock.
>
> I hope this clarifies rather than obscures the situation,
>
> Regards,
> Steve Powell  (*a hoppy bunny*)
> *----------some more definitions from the SPD----------*
> *vermin* (*v.*) Treating the dachshund for roundworm.
> *chinchilla* (*n.*) Cooling device for the lower jaw.
> *socialcast* (*n.*) Someone to whom everyone is speaking but nobody likes.
>
> On 23 Jan 2012, at 15:22, Alexandru Scvor?ov wrote:
>
> Is my understanding correct?
>
>
> Almost.  Deliveries will happen serially on a channel, so, as long as you
> only have one consumer, everything should be fine.
>
> On Mon, Jan 23, 2012 at 06:54:15AM -0800, Yogesh Ketkar wrote:
>
> Hello Alex,
>
>
> I thought, using default Connection con = factory.newConnection(),
>
> ThreadPool which gets created will have more than one thread and
>
> calling basicConsume will result in processing of messages on multiple
>
> threads.
>
>
> But if we explicitly provide Executors.newSingleThreadExecutor() to
>
> newConnection method, only single thread will come into play with
>
> basicConsume.
>
>
> Is my understanding correct?
>
>
> regards, Yogesh
>
>
>
> On Jan 23, 7:48 pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
>
> Hi Yogesh,
>
>
> using channel.basicConsume on the channel which is created like this
>
> ExecutorService es = Executors.newSingleThreadExecutor();
>
> Connection connection = factory.newConnection(es);
>
> final Channel channel = connection.createChannel();
>
>
> is probably a better approach.
>
> Any comments on this?
>
>
> I don't quite see the point of the ExecutorService.
>
>
> Just doing this:
>
>
> Connection connection = factory.newConnection(es);
>
> final Channel channel = connection.createChannel();
>
>
> Then, calling basicConsume with your own subclass of DefaultConsumer
>
> should be fine.
>
>
> Cheers,
>
> Alex
>
>
>
>
>
>
>
>
>
>
> On Mon, Jan 23, 2012 at 08:08:37PM +0530, Yogesh Ketkar wrote:
>
> Thanks Alex.
>
>
> I think, for sequential message processing, rather than this pattern
>
> while(true) {
>
>     GetResponse res = channel.basicGet(QUEUE_NAME, false);
>
>     if(res != null) {
>
>         // process and ack message
>
>    }
>
> }
>
>
> using channel.basicConsume on the channel which is created like this
>
> ExecutorService es = Executors.newSingleThreadExecutor();
>
> Connection connection = factory.newConnection(es);
>
> final Channel channel = connection.createChannel();
>
>
> is probably a better approach.
>
> Any comments on this?
>
>
> regards, Yogesh
>
>
> 2012/1/23 Alexandru Scvor?ov <alexan... at rabbitmq.com>
>
>
> Hi Yogesh,
>
>
> In the absence of consumer failures, RabbitMQ will deliver messages from
>
> a queue in order.
>
>
> So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
>
> them to consumers in the same order (1, 2, 3).
>
>
> But, if consumers fail before acknowledging the messages (or if they
>
> reject the messages), those messages will requeued at the end of the
>
> queue.  So, if the consumer that got message 1 rejects it, the new
>
> order of messages will be 2, 3, 1.
>
>
> This all deals with message *delivery*.
>
>
> There are multiple consumer threads consuming the messages.
>
> Though multiple threads are consuming the messages, I observed that
>
> messages still get processed sequentially.
>
> Is that the case and if NOT, what is the way to guarantee sequential
>
> processing of messages on one queue?
>
>
> The library makes no guarantees about the order in which you process
>
> messages, only about the order in which they're delivered.
>
>
> If you want to process all the messages on a queue in order, only
>
> consume from one thread (doing basic.get from one thread like you
>
> suggested in the other email would work, but would also be highly
>
> inefficient).
>
>
> Does this answer your question?
>
>
> Cheers,
>
> Alex
>
>
> On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
>
> Running the code below, gives
>
> channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
>
>       new DefaultConsumer(channel)  {
>
>         @Override
>
>         public void handleDelivery(String consumerTag, Envelope
>
> envelope, BasicProperties properties, byte[] body) {
>
>                 System.out.println(Thread.currentThread().getName());
>
>          }
>
> }
>
>
> o/p like
>
> pool-1-thread-1
>
> pool-1-thread-2
>
> pool-1-thread-3
>
> etc
>
>
> There are multiple consumer threads consuming the messages.
>
> Though multiple threads are consuming the messages, I observed that
>
> messages still get processed sequentially.
>
> Is that the case and if NOT, what is the way to guarantee sequential
>
> processing of messages on one queue?
>
>
> regards, Yogesh
>
>
> _______________________________________________
>
> rabbitmq-discuss mailing list
>
> rabbitmq-disc... at lists.rabbitmq.com
>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
>
> rabbitmq-discuss mailing list
>
> rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
>
> rabbitmq-discuss mailing list
>
> rabbitmq-discuss at lists.rabbitmq.com
>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120124/59f58372/attachment.htm>

From yogimogi at gmail.com  Tue Jan 24 05:32:48 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Mon, 23 Jan 2012 21:32:48 -0800 (PST)
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <CAAdHZhoCSNvyfXYkFGbaQ0NyzZ_2X8SgF1Vk63GT9hJ3iitc+Q@mail.gmail.com>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
	<CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>
	<20120123144809.GU3543@southbank.Home>
	<7fdbb511-c8b4-45c7-aef7-adb6ba80ffdf@v6g2000pba.googlegroups.com>
	<20120123152213.GV3543@southbank.Home>
	<4400DD7F-0926-41AE-965A-3C5752A0A280@rabbitmq.com>
	<CAAdHZhoCSNvyfXYkFGbaQ0NyzZ_2X8SgF1Vk63GT9hJ3iitc+Q@mail.gmail.com>
Message-ID: <c3ecab9a-2674-4c4e-bb8c-493d0d5e834e@pt5g2000pbb.googlegroups.com>

> Well, having more threads will help if same channel is going to be used to
> consume messages from other queues.
Actually more appropriate would be, having more threads will help if
same Connection is going to be used
with different channels.

On Jan 24, 10:29?am, Yogesh Ketkar <yogim... at gmail.com> wrote:
> Hello Steve/Alex,
>
> Thanks a lot for the help. It's pretty clear now.
> So basically for a queue, as long as there is going to be only one
> consumer, it hardly matters if ThreadPool with
> com.rabbitmq.client.Connection underneath the channel has 1 thread or many
> threads.
> Well, having more threads will help if same channel is going to be used to
> consume messages from other queues.
>
> regards, Yogesh
>
> 2012/1/23 Steve Powell <st... at rabbitmq.com>
>
>
>
>
>
>
>
> > Hi Yogesh,
>
> > What Alex says is perfectly correct.
>
> > The executor service is set on the connection, and is there to allow
> > multiple
> > channels to execute consumers simultaneously, and without blocking the
> > channel
> > thread. By default you get an executor service which has five threads.
>
> > From the point of view of a single channel, the consumers are driven
> > serially,
> > one delivery at a time, upon one of the executor service threads. The same
> > thread is not guaranteed to be used each time for each consumer call for a
> > channel (so don't try to use ThreadLocal objects).
>
> > The reason we provide this, is so that clients with many, many channels
> > are not
> > forced to have a Consumer thread per channel -- something that is quite
> > expensive -- but have the option of allocating as many threads as they
> > wish if
> > they need it. At the same time we guarantee that no Consumer calls can
> > 'overtake' each other on any one channel, and that Consumer processing
> > runs on a
> > distinct thread from the channel and the app, so that channel calls in the
> > Consumer code will not deadlock.
>
> > I hope this clarifies rather than obscures the situation,
>
> > Regards,
> > Steve Powell ?(*a hoppy bunny*)
> > *----------some more definitions from the SPD----------*
> > *vermin* (*v.*) Treating the dachshund for roundworm.
> > *chinchilla* (*n.*) Cooling device for the lower jaw.
> > *socialcast* (*n.*) Someone to whom everyone is speaking but nobody likes.
>
> > On 23 Jan 2012, at 15:22, Alexandru Scvor?ov wrote:
>
> > Is my understanding correct?
>
> > Almost. ?Deliveries will happen serially on a channel, so, as long as you
> > only have one consumer, everything should be fine.
>
> > On Mon, Jan 23, 2012 at 06:54:15AM -0800, Yogesh Ketkar wrote:
>
> > Hello Alex,
>
> > I thought, using default Connection con = factory.newConnection(),
>
> > ThreadPool which gets created will have more than one thread and
>
> > calling basicConsume will result in processing of messages on multiple
>
> > threads.
>
> > But if we explicitly provide Executors.newSingleThreadExecutor() to
>
> > newConnection method, only single thread will come into play with
>
> > basicConsume.
>
> > Is my understanding correct?
>
> > regards, Yogesh
>
> > On Jan 23, 7:48 pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
>
> > Hi Yogesh,
>
> > using channel.basicConsume on the channel which is created like this
>
> > ExecutorService es = Executors.newSingleThreadExecutor();
>
> > Connection connection = factory.newConnection(es);
>
> > final Channel channel = connection.createChannel();
>
> > is probably a better approach.
>
> > Any comments on this?
>
> > I don't quite see the point of the ExecutorService.
>
> > Just doing this:
>
> > Connection connection = factory.newConnection(es);
>
> > final Channel channel = connection.createChannel();
>
> > Then, calling basicConsume with your own subclass of DefaultConsumer
>
> > should be fine.
>
> > Cheers,
>
> > Alex
>
> > On Mon, Jan 23, 2012 at 08:08:37PM +0530, Yogesh Ketkar wrote:
>
> > Thanks Alex.
>
> > I think, for sequential message processing, rather than this pattern
>
> > while(true) {
>
> > ? ? GetResponse res = channel.basicGet(QUEUE_NAME, false);
>
> > ? ? if(res != null) {
>
> > ? ? ? ? // process and ack message
>
> > ? ?}
>
> > }
>
> > using channel.basicConsume on the channel which is created like this
>
> > ExecutorService es = Executors.newSingleThreadExecutor();
>
> > Connection connection = factory.newConnection(es);
>
> > final Channel channel = connection.createChannel();
>
> > is probably a better approach.
>
> > Any comments on this?
>
> > regards, Yogesh
>
> > 2012/1/23 Alexandru Scvor?ov <alexan... at rabbitmq.com>
>
> > Hi Yogesh,
>
> > In the absence of consumer failures, RabbitMQ will deliver messages from
>
> > a queue in order.
>
> > So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
>
> > them to consumers in the same order (1, 2, 3).
>
> > But, if consumers fail before acknowledging the messages (or if they
>
> > reject the messages), those messages will requeued at the end of the
>
> > queue. ?So, if the consumer that got message 1 rejects it, the new
>
> > order of messages will be 2, 3, 1.
>
> > This all deals with message *delivery*.
>
> > There are multiple consumer threads consuming the messages.
>
> > Though multiple threads are consuming the messages, I observed that
>
> > messages still get processed sequentially.
>
> > Is that the case and if NOT, what is the way to guarantee sequential
>
> > processing of messages on one queue?
>
> > The library makes no guarantees about the order in which you process
>
> > messages, only about the order in which they're delivered.
>
> > If you want to process all the messages on a queue in order, only
>
> > consume from one thread (doing basic.get from one thread like you
>
> > suggested in the other email would work, but would also be highly
>
> > inefficient).
>
> > Does this answer your question?
>
> > Cheers,
>
> > Alex
>
> > On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
>
> > Running the code below, gives
>
> > channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
>
> > ? ? ? new DefaultConsumer(channel) ?{
>
> > ? ? ? ? @Override
>
> > ? ? ? ? public void handleDelivery(String consumerTag, Envelope
>
> > envelope, BasicProperties properties, byte[] body) {
>
> > ? ? ? ? ? ? ? ? System.out.println(Thread.currentThread().getName());
>
> > ? ? ? ? ?}
>
> > }
>
> > o/p like
>
> > pool-1-thread-1
>
> > pool-1-thread-2
>
> > pool-1-thread-3
>
> > etc
>
> > There are multiple consumer threads consuming the messages.
>
> > Though multiple threads are consuming the messages, I observed that
>
> > messages still get processed sequentially.
>
> > Is that the case and if NOT, what is the way to guarantee sequential
>
> > processing of messages on one queue?
>
> > regards, Yogesh
>
> > _______________________________________________
>
> > rabbitmq-discuss mailing list
>
> > rabbitmq-disc... at lists.rabbitmq.com
>
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
>
> > rabbitmq-discuss mailing list
>
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
>
> > rabbitmq-discuss mailing list
>
> > rabbitmq-disc... at lists.rabbitmq.com
>
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lucooo at gmail.com  Tue Jan 24 09:32:54 2012
From: lucooo at gmail.com (LuCo)
Date: Tue, 24 Jan 2012 01:32:54 -0800 (PST)
Subject: [rabbitmq-discuss] Mnesia crash after RabbitMQ node machine restart
	(clustered)
Message-ID: <fca8dc17-ec6b-41d4-b0bf-5bc213d54469@e27g2000vbu.googlegroups.com>

Hello.

We have a RabbitMQ cluster across 2 machines. Machine 1 is created as
a disc node, and Machine 2 as a memory node.

These machines are restarted on the weekend every week. This has not
been a problem over the last 5 weeks (since trialling RabbitMQ) and
during this time the nodes have been little used, however the weekend
just passed resulted in the error below on the disc node just after
the machine on which the node runs was restarted:

"
=ERROR REPORT==== 22-Jan-2012::01:17:37 ===
Mnesia('rabbit at MACHINE1'): ** ERROR ** (core dumped to file: "c:/
Documents and Settings/user/Application Data/RabbitMQ/
MnesiaCore.rabbit at MACHINE1_1327_195058_860060")
 ** FATAL ** Failed to merge schema: Bad cookie in table definition
mirrored_sup_childspec: 'rabbit at MACHINE1' =
{cstruct,mirrored_sup_childspec,ordered_set,
['rabbit at MACHINE2,'rabbit at MACHINE1'],[],[],0,read_write,false,[],
[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],
{{1324,33984,878002},'rabbit at MACHINE1'},{{5,0},{'rabbit at MACHINE2',
{1324,34466,491790}}}}, 'rabbit at MACHINE2' =
{cstruct,mirrored_sup_childspec,ordered_set,['rabbit at MACHINE2'],[],[],
0,read_write,false,[],[],false,mirrored_sup_childspec,
[key,mirroring_pid,childspec],[],[],
{{1327,194914,615072},'rabbit at MACHINE2'},{{2,0},[]}}
=ERROR REPORT==== 22-Jan-2012::01:17:44 ===
** Generic server mnesia_subscr terminating
** Last message in was {'EXIT',<0.51.0>,killed}
** When Server state == {state,<0.51.0>,57361}
** Reason for termination ==
** killed
=ERROR REPORT==== 22-Jan-2012::01:17:44 ===
** Generic server mnesia_monitor terminating
** Last message in was {'EXIT',<0.51.0>,killed}
** When Server state == {state,<0.51.0>,[],[],true,[],undefined,[]}
** Reason for termination ==
** killed
=ERROR REPORT==== 22-Jan-2012::01:17:44 ===
** Generic server mnesia_recover terminating
** Last message in was {'EXIT',<0.51.0>,killed}
** When Server state == {state,<0.51.0>,undefined,undefined,undefined,
0,false,
                               true,[]}
** Reason for termination ==
** killed
=ERROR REPORT==== 22-Jan-2012::01:17:44 ===
** Generic server mnesia_snmp_sup terminating
** Last message in was {'EXIT',<0.51.0>,killed}
** When Server state == {state,
                            {local,mnesia_snmp_sup},
                            simple_one_for_one,
                            [{child,undefined,mnesia_snmp_sup,
                                 {mnesia_snmp_hook,start,[]},
                                 transient,3000,worker,
                                 [mnesia_snmp_sup,mnesia_snmp_hook,
                                  supervisor]}],
                            undefined,0,86400000,[],mnesia_snmp_sup,
[]}
** Reason for termination ==
** killed
=INFO REPORT==== 22-Jan-2012::01:17:44 ===
    application: mnesia
    exited: {shutdown,{mnesia_sup,start,[normal,[]]}}
    type: permanent
"

The memory node then had this error in the log just after the machine
on which the node runs was restarted:
"
=INFO REPORT==== 22-Jan-2012::01:12:08 ===
node 'rabbit at G1SVR2-IIS' lost 'rabbit'
=INFO REPORT==== 22-Jan-2012::01:12:08 ===
Statistics database started.
=INFO REPORT==== 22-Jan-2012::01:15:13 ===
Limiting to approx 924 file handles (829 sockets)
=INFO REPORT==== 22-Jan-2012::01:15:14 ===
    application: mnesia
    exited: stopped
    type: permanent
=INFO REPORT==== 22-Jan-2012::01:15:14 ===
Memory limit set to 818MB of 2047MB total.
...<log continues with default initialisation of the node>...
"

As mentioned, the nodes have been seldom used and contained only 2
durable queues. This crash resulted in the nodes resuming their
default configuration (lost previously configured users).

The times on the machines above are the same so I am a little confused
at the messages on the MACHINE 2 (memory) which seems to have crashed
before MACHINE 1?

I can understand why this has possibly happened (one node up/one node
down when attempting to cluster on restart) but why has it not
happened the previous 5 restarts? What actually happens on a Rabbit
restart (following server restart) in a cluster scenario? Do I need a
custom start up script to cover all bases?

Any thoughts?

Daniel


From lucooo at gmail.com  Tue Jan 24 09:48:51 2012
From: lucooo at gmail.com (Daniel Lucas)
Date: Tue, 24 Jan 2012 01:48:51 -0800
Subject: [rabbitmq-discuss] WCF bindings connection drop outs
Message-ID: <-1373692063019933580@unknownmsgid>

The heartbeat does solve the connection drop outs thanks. I added this
to the RabbitMQTransportBindingElement as you suggested.

Related, but not causing a noticeable issue is a message in a RabbitMQ
trace that I was using to investigate drop outs that is:

"Due to a user abort the reliable session cannot continue" (wrapped in
a message on the client queue)

This message is sent to the client queue after periods of inactivity. I
understand what this message means and have played around with the
timeout settings (receive,inactivity) on the RabbitMQ WCF binding to no
avail. This message is always raised even though keep alive messages
(ack requests/acknowledgements) are exchanged between client and server
queues at a frequency that matches timeout settings (or half of in the
case of the inactivity timeout) as seen in the trace.

As I said, there is no noticeable affect on sending/receiving messages
but am curious why the message appears in the trace at all?

Daniel
From: Emile Joubert
Sent: 13/01/2012 12:10
To: LuCo
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] WCF bindings connection drop outs
On 13/01/12 10:27, LuCo wrote:
> Hi there.
>
> I am using the RabbitMQ.ServiceModel WCF bindings with a .Net client
> talking to a standard WCF service (two way) and am having a problem
> with a long running connection which seems to stop responding after a
> long period of time (vague, but it happens without fail if I leave the
> client open overnight) only when I next try to use the WCF client
> channel.

Thanks for your very detailed message. Could you try to enable
heartbeats for the RabbitMQ channels that are established for WCF? The
internal RabbitMQTransportBindingElement.ConnectionFactory() method
looks like the correct place to add this. AMQP heartbeats will probably
help if a network device is causing long-lived connections to drop
silently and peers are unaware of this.

The ghost queues are a consequence of declaring the internal WCF queues
as durable. It seldom makes sense to declare server-named queues as
durable, unless the name is recorded somewhere.



-Emile

From michael.s.klishin at gmail.com  Tue Jan 24 09:59:36 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 24 Jan 2012 13:59:36 +0400
Subject: [rabbitmq-discuss] erroneous basicGet closing the channel?
In-Reply-To: <fece839f-da4f-4e2f-aebc-f96e0e4363c1@pj4g2000pbc.googlegroups.com>
References: <fece839f-da4f-4e2f-aebc-f96e0e4363c1@pj4g2000pbc.googlegroups.com>
Message-ID: <4DE6C3C7-5C8A-4B17-8166-DC7E8D3DBA45@gmail.com>

Yogesh Ketkar:

> And after that doing any operation on the channel results in
> com.rabbitmq.client.AlreadyClosedException
> 
> Is this expected behaviour? Are there any other calls on channel which
> end up throwing an exception also close the channel?

It is. RabbitMQ closes channels after noticing an exception (like trying to fetch
messages from a non-existing queue).

MK


From gperrot at ubikod.com  Tue Jan 24 10:13:38 2012
From: gperrot at ubikod.com (Guillaume Perrot)
Date: Tue, 24 Jan 2012 10:13:38 +0000 (UTC)
Subject: [rabbitmq-discuss] Java client blocked when opening channel
References: <20110223105638.11791vt2j7bhgb8g@webmail.active24.cz>
	<4D64DE19.9000906@rabbitmq.com>
Message-ID: <loom.20120124T110944-591@post.gmane.org>

Matthias Radestock <matthias at ...> writes:

> 
> Jiri,
> 
> On 23/02/11 09:56, Jiri Krutil wrote:
> > One of our threads got stuck inside AMQConnection.createChannel() and
> > would not return.
> > [...]
> > We are running RabbitMQ 2.1.0 (both server and Java client).
> 
> A fix for a bug with similar symptoms appeared in the 2.3.x Java client, 
> so I suggest you upgrade the client to 2.3.1. Might as well upgrade the 
> server at the same time, though that's not strictly necessary.
> 
> Matthias.
> 

I have the same problem with v2.5.1
createChannel does not have a timeout ?
When the problem happens, consuming stops on already running 
channels for this connection.


From emile at rabbitmq.com  Tue Jan 24 10:56:32 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 24 Jan 2012 10:56:32 +0000
Subject: [rabbitmq-discuss] WCF bindings connection drop outs
In-Reply-To: <-1373692063019933580@unknownmsgid>
References: <-1373692063019933580@unknownmsgid>
Message-ID: <4F1E8E60.4010800@rabbitmq.com>


Hi Daniel,

On 24/01/12 09:48, Daniel Lucas wrote:
> "Due to a user abort the reliable session cannot continue" (wrapped in
> a message on the client queue)
> 
> This message is sent to the client queue after periods of inactivity. I
> understand what this message means and have played around with the
> timeout settings (receive,inactivity) on the RabbitMQ WCF binding to no
> avail. This message is always raised even though keep alive messages

What is the period of inactivity that precedes the error? If it is 10
minutes then you may need to adjust "Inactivity Timeout". If you have
already tried that can you show how you changed the binding or the
config file?


-Emile

From michael.s.klishin at gmail.com  Tue Jan 24 11:02:08 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 24 Jan 2012 15:02:08 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.9.2 is released
Message-ID: <C917299F-4E6A-44C3-A002-1831F67E6941@gmail.com>

amqp gem 0.9.2 is released to rubygems.org [1]. This is a bug fix release:

* Automatic recovery mode now recovers (non-predefined) exchanges again. The regression [2] was introduced between 0.9.0.pre3 and 0.9.0.

Kudos to Lele Forzani for bringing this issue up to my attention.

Have a good day.


1. https://rubygems.org/gems/amqp/versions/0.9.2
2. https://github.com/ruby-amqp/amqp/commit/80a86610de58699332ccd478a3b4dd66139131e6

MK


From simon at rabbitmq.com  Tue Jan 24 11:10:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 11:10:47 +0000
Subject: [rabbitmq-discuss] Mnesia crash after RabbitMQ node machine
 restart (clustered)
In-Reply-To: <fca8dc17-ec6b-41d4-b0bf-5bc213d54469@e27g2000vbu.googlegroups.com>
References: <fca8dc17-ec6b-41d4-b0bf-5bc213d54469@e27g2000vbu.googlegroups.com>
Message-ID: <4F1E91B7.7040605@rabbitmq.com>

We could probably do with better error reporting / handling in this 
case, but I think this is what happened (certainly I did this and saw 
the same errors)...

* Build a cluster with node1 = disc and node2 = ram
* Stop both nodes
* Start node2 *first*

At this point node2 does not have any disc nodes to catch up from... so 
it initialises a fresh copy of the mnesia database in RAM and starts up 
by itself.

* Start node1

At this point node1 knows that it needs to cluster with node2, but node2 
doesn't agree, and has a different version of the database anyway. Hence 
the error message.

At this point I was able to recover by stopping node2 again, and 
starting node1 first, then node2.

I'll file a bug to make the errors clearer in this case, but for the 
time being you should make sure to always bring at least one disc node 
up first in any cluster.

In your case you should consider switching to a cluster with two disc 
nodes anyway - only having one disc node is a SPOF.

Cheers, Simon

On 24/01/12 09:32, LuCo wrote:
> Hello.
>
> We have a RabbitMQ cluster across 2 machines. Machine 1 is created as
> a disc node, and Machine 2 as a memory node.
>
> These machines are restarted on the weekend every week. This has not
> been a problem over the last 5 weeks (since trialling RabbitMQ) and
> during this time the nodes have been little used, however the weekend
> just passed resulted in the error below on the disc node just after
> the machine on which the node runs was restarted:
>
> "
> =ERROR REPORT==== 22-Jan-2012::01:17:37 ===
> Mnesia('rabbit at MACHINE1'): ** ERROR ** (core dumped to file: "c:/
> Documents and Settings/user/Application Data/RabbitMQ/
> MnesiaCore.rabbit at MACHINE1_1327_195058_860060")
>   ** FATAL ** Failed to merge schema: Bad cookie in table definition
> mirrored_sup_childspec: 'rabbit at MACHINE1' =
> {cstruct,mirrored_sup_childspec,ordered_set,
> ['rabbit at MACHINE2,'rabbit at MACHINE1'],[],[],0,read_write,false,[],
> [],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],
> {{1324,33984,878002},'rabbit at MACHINE1'},{{5,0},{'rabbit at MACHINE2',
> {1324,34466,491790}}}}, 'rabbit at MACHINE2' =
> {cstruct,mirrored_sup_childspec,ordered_set,['rabbit at MACHINE2'],[],[],
> 0,read_write,false,[],[],false,mirrored_sup_childspec,
> [key,mirroring_pid,childspec],[],[],
> {{1327,194914,615072},'rabbit at MACHINE2'},{{2,0},[]}}
> =ERROR REPORT==== 22-Jan-2012::01:17:44 ===
> ** Generic server mnesia_subscr terminating
> ** Last message in was {'EXIT',<0.51.0>,killed}
> ** When Server state == {state,<0.51.0>,57361}
> ** Reason for termination ==
> ** killed
> =ERROR REPORT==== 22-Jan-2012::01:17:44 ===
> ** Generic server mnesia_monitor terminating
> ** Last message in was {'EXIT',<0.51.0>,killed}
> ** When Server state == {state,<0.51.0>,[],[],true,[],undefined,[]}
> ** Reason for termination ==
> ** killed
> =ERROR REPORT==== 22-Jan-2012::01:17:44 ===
> ** Generic server mnesia_recover terminating
> ** Last message in was {'EXIT',<0.51.0>,killed}
> ** When Server state == {state,<0.51.0>,undefined,undefined,undefined,
> 0,false,
>                                 true,[]}
> ** Reason for termination ==
> ** killed
> =ERROR REPORT==== 22-Jan-2012::01:17:44 ===
> ** Generic server mnesia_snmp_sup terminating
> ** Last message in was {'EXIT',<0.51.0>,killed}
> ** When Server state == {state,
>                              {local,mnesia_snmp_sup},
>                              simple_one_for_one,
>                              [{child,undefined,mnesia_snmp_sup,
>                                   {mnesia_snmp_hook,start,[]},
>                                   transient,3000,worker,
>                                   [mnesia_snmp_sup,mnesia_snmp_hook,
>                                    supervisor]}],
>                              undefined,0,86400000,[],mnesia_snmp_sup,
> []}
> ** Reason for termination ==
> ** killed
> =INFO REPORT==== 22-Jan-2012::01:17:44 ===
>      application: mnesia
>      exited: {shutdown,{mnesia_sup,start,[normal,[]]}}
>      type: permanent
> "
>
> The memory node then had this error in the log just after the machine
> on which the node runs was restarted:
> "
> =INFO REPORT==== 22-Jan-2012::01:12:08 ===
> node 'rabbit at G1SVR2-IIS' lost 'rabbit'
> =INFO REPORT==== 22-Jan-2012::01:12:08 ===
> Statistics database started.
> =INFO REPORT==== 22-Jan-2012::01:15:13 ===
> Limiting to approx 924 file handles (829 sockets)
> =INFO REPORT==== 22-Jan-2012::01:15:14 ===
>      application: mnesia
>      exited: stopped
>      type: permanent
> =INFO REPORT==== 22-Jan-2012::01:15:14 ===
> Memory limit set to 818MB of 2047MB total.
> ...<log continues with default initialisation of the node>...
> "
>
> As mentioned, the nodes have been seldom used and contained only 2
> durable queues. This crash resulted in the nodes resuming their
> default configuration (lost previously configured users).
>
> The times on the machines above are the same so I am a little confused
> at the messages on the MACHINE 2 (memory) which seems to have crashed
> before MACHINE 1?
>
> I can understand why this has possibly happened (one node up/one node
> down when attempting to cluster on restart) but why has it not
> happened the previous 5 restarts? What actually happens on a Rabbit
> restart (following server restart) in a cluster scenario? Do I need a
> custom start up script to cover all bases?
>
> Any thoughts?
>
> Daniel
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 24 11:41:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 11:41:28 +0000
Subject: [rabbitmq-discuss] Management plugin calls bindings routing keys
In-Reply-To: <2569406.2208.1327351068669.JavaMail.geo-discussion-forums@yqia35>
References: <2569406.2208.1327351068669.JavaMail.geo-discussion-forums@yqia35>
Message-ID: <4F1E98E8.2020803@rabbitmq.com>

On 23/01/12 20:37, David Stuebe wrote:
> The web admin plugin is fantastic for development debugging, but some of
> the dev team I work with are having a hard time because it seems like
> the web UI is using the wrong name for bindings - it is calling them
> routing keys.

Hi David.

Bindings have routing keys, but they also have arguments. In many cases 
the routing key is used and the arguments aren't - but not all, for 
example headers exchanges.

Does this make it clearer?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 24 11:43:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 11:43:01 +0000
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures
 on	Queue Bind - 2012-01-20
In-Reply-To: <4F1DB931.4020501@aol.com>
References: <4F19E73D.9080107@aol.com> <4F1D3CE1.6060701@rabbitmq.com>
	<4F1DB931.4020501@aol.com>
Message-ID: <4F1E9945.7060503@rabbitmq.com>

On 23/01/12 19:46, DawgTool wrote:
> ok, created the exchange before starting the downstream server.
> Federation exchange is created, but it is not bound to the
> dc001-exchange-u.
> Am I missing something?

What do you mean by not bound? The exchanges should be on different 
machines so they can't be bound in the usual sense of the word. What 
were you expecting to see, and what did you see instead?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 24 11:55:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 11:55:03 +0000
Subject: [rabbitmq-discuss] Shovel questions
In-Reply-To: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>
References: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>
Message-ID: <4F1E9C17.8090006@rabbitmq.com>

On 21/01/12 22:58, Elias Levy wrote:
> We are thinking of exposing a portion of our message bus to customers.
>   To do we we will be creating a new cluster that can be exposed and
> will be linking it to our existing cluster.
>
> I've looked a the Federation plug-in, but it has a feature disqualifies
> it for our purposes.   We'd like to keep communications from our
> existing cluster to the new exposed cluster unidirectional.  That means
> now allowing incoming connections into the existing cluster, in case
> there is ever a RabbitMQ vulnerability (or say, an Erlang or OpenSSL
> vulnerability) that would allow the external cluster to be compromised.
>   Since both cluster are running RabbitMQ, we don't want an attacker to
> be able to jump from the external cluster to the internal one.  From
> what I've gathered, the AMQP client that the Federation plug-in uses
> executed within the downstream broker, and thus it has to be able to
> make an AMQP connection to the upstream broker.
>
> Is that correct?  Any plans to allow for the opposite behavior (upstream
> connects to the downstream broker)?

Not really. Although that could be useful in some situations it does 
mean the plugin wouldn't be able to be smart about which messages to 
send over gap, so it would start to look a lot more like the shovel.

> That leaves us with the Shovel plug-in, which can be configured to run
> on either the upstream or downstream broker.
>
> One problem with the Shovel plug-in is that it appears you can only
> manage the shovels within the configuration file.  Is there no way to
> manage shovels online, either through AMQP or a management plug-in?

Not now, we'd like to do that in the future.

> If neither of those are possible, can RabbitMQ reload its configuration
> without restarting?

Not now, we'd like to do that in the future.

> Finally, its unclear whether you should only define a shovel in a single
> node in a cluster or in multiple ones?  If you define it in multiple
> ones, does it create multiple shovel clients competing for messages?

Yes.

> If
> not, will a shovel fail over if the node with the existing client fails?

No.

(Maybe we should look at that...)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 24 11:55:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 11:55:12 +0000
Subject: [rabbitmq-discuss] Shovel questions
In-Reply-To: <CAFDmHdOhMD4ZwouG7y1Aqq6LOjdORdF4OipiSiyiCiAZoMwX5w@mail.gmail.com>
References: <CAFDmHdOHUZ1CqASK9sPZBj9SeN6xAYHkA1yOTMgL6ohsx264wA@mail.gmail.com>	<CAOn7oW_az9BeOcSxkW25uUrepyz57Y19XgrsmxVSOP9xDuGHHg@mail.gmail.com>	<CAFDmHdNb_UbPrS2=ePhqr3MVX1b4SuYvyU6jXKjYfy-SOBnRVg@mail.gmail.com>	<CAOn7oW-VwcESWChefoHbtP4jvt73sm64bo8_a2dX1iQ0=BJZzA@mail.gmail.com>
	<CAFDmHdOhMD4ZwouG7y1Aqq6LOjdORdF4OipiSiyiCiAZoMwX5w@mail.gmail.com>
Message-ID: <4F1E9C20.2090903@rabbitmq.com>

On 23/01/12 22:15, Elias Levy wrote:
> On Mon, Jan 23, 2012 at 1:48 PM, Simone Busoli <simone.busoli at gmail.com
> <mailto:simone.busoli at gmail.com>> wrote:
>
>     What I was trying to say is that it uses ex-ex bindings internally,
>     not across brokers
>
>
> In what context does it do that?  Are you referring to an ex-ex binding
> between the x-federated exchange and its backing exchange (the exchange
> of the selected type)?

Federation requires e-e bindings in the upstream, it creates an internal 
exchange (that it uses to be able to create a load of bindings atomically).

The connection between the federation exchange and the backing exchange 
is not really a binding.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 24 12:06:25 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 12:06:25 +0000
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <24758975.860.1327358063919.JavaMail.geo-discussion-forums@vbue14>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>	<4F196036.3050708@rabbitmq.com>	<2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>	<4F1D43CB.2070709@rabbitmq.com>	<5955234.1287.1327339099047.JavaMail.geo-discussion-forums@vbed2>	<4F1DAFA3.9090809@rabbitmq.com>
	<24758975.860.1327358063919.JavaMail.geo-discussion-forums@vbue14>
Message-ID: <4F1E9EC1.5020107@rabbitmq.com>

On 23/01/12 22:34, Dennis Jacobfeuerborn wrote:
> Here is the new output (2.5mb):
> http://www.conversis.de/exac/memory.txt.bz2

Thanks!

So memory use is growing when there isn't much state in the queue. Hmm. 
Maybe your broker is not GCing often enough.

Can you try editing

   /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/bin/rabbitmq-server

and adding

   export ERL_FULLSWEEP_AFTER=10

just before the exec erl line at the end?

Failing that, you mentioned a script you were using - does it reliably 
reproduce this behaviour? If so, would you be able to share it?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 24 12:22:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 12:22:35 +0000
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <4F1E9EC1.5020107@rabbitmq.com>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>	<4F196036.3050708@rabbitmq.com>	<2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>	<4F1D43CB.2070709@rabbitmq.com>	<5955234.1287.1327339099047.JavaMail.geo-discussion-forums@vbed2>	<4F1DAFA3.9090809@rabbitmq.com>	<24758975.860.1327358063919.JavaMail.geo-discussion-forums@vbue14>
	<4F1E9EC1.5020107@rabbitmq.com>
Message-ID: <4F1EA28B.5030605@rabbitmq.com>

On 24/01/12 12:06, Simon MacMullen wrote:
> Can you try editing
>
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/bin/rabbitmq-server
>
> and adding
>
> export ERL_FULLSWEEP_AFTER=10
>
> just before the exec erl line at the end?

Alternatively you can stick this in /etc/rabbitmq/rabbitmq-env.conf, d'oh!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From u2.storm at gmail.com  Tue Jan 24 13:37:29 2012
From: u2.storm at gmail.com (Artsiom Gulin)
Date: Tue, 24 Jan 2012 16:37:29 +0300
Subject: [rabbitmq-discuss] rabbitmq-c for a reliable rabbitmq client in
 production environment.
In-Reply-To: <1a2bd242-be09-4c75-9b94-ba214b9b6cb1@a40g2000vbu.googlegroups.com>
References: <7f328139-e23a-4946-8932-fc728aad3021@a17g2000yqj.googlegroups.com>
	<CAAt2poJD20QZiebR+crY6OxxK4QZHRztjibwmCHwWjZFKYjeBw@mail.gmail.com>
	<1a2bd242-be09-4c75-9b94-ba214b9b6cb1@a40g2000vbu.googlegroups.com>
Message-ID: <4F1EB419.7090103@gmail.com>

Hello.

Have enabled cancellation notification using librabbitmq-c?
Could you provide me with code snippets?

On 01/19/2012 03:04 PM, TZHA wrote:
> Thanks for the reply.
>
> I am now in the position to get the cancellation notification
> following your advice.
--
Artsiom

From clark.upd at gmail.com  Tue Jan 24 14:56:29 2012
From: clark.upd at gmail.com (cupdike)
Date: Tue, 24 Jan 2012 06:56:29 -0800 (PST)
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <4EE8B5FC.6020709@rabbitmq.com>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
	<4EE8B5FC.6020709@rabbitmq.com>
Message-ID: <5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>

What would be the best way to monitor RabbitMQ's plans regarding a 1.0
adoption decision?

Also, why would RabbitMQ consider not supporting 1.0?  Is the thinking
that it may not see industry adoption, or something else?

Just seems a little odd since 1.0 is on it's way to ISO
standardization.

Thanks,
Clark

From lucooo at gmail.com  Tue Jan 24 16:48:44 2012
From: lucooo at gmail.com (LuCo)
Date: Tue, 24 Jan 2012 08:48:44 -0800 (PST)
Subject: [rabbitmq-discuss] WCF bindings connection drop outs
In-Reply-To: <addc9143-80f0-4ee0-bd06-4b072df61543@f33g2000yqh.googlegroups.com>
References: <5acc550d-1f04-4063-95ea-f43ec47b4d14@f11g2000yql.googlegroups.com>
	<4F101F83.2040302@rabbitmq.com>
	<addc9143-80f0-4ee0-bd06-4b072df61543@f33g2000yqh.googlegroups.com>
Message-ID: <b5d0a2b1-1a9b-4c7b-8973-962ebb02df99@i25g2000vbt.googlegroups.com>

>>The heartbeat does solve the connection drop outs thanks. I added this to the RabbitMQTransportBindingElement as you suggested.
>>
>>Related, but not causing a noticeable issue is a message in a RabbitMQ trace that I was using to investigate drop outs that is:
>>
>>"Due to a user abort the reliable session cannot continue" (wrapped in a message on the client queue)
>>
>>This message is sent to the client queue after periods of inactivity. I understand what this message means and have played around with the timeout >>settings (receive,inactivity) on the RabbitMQ WCF binding to no avail. This message is always raised even though keep alive messages (ack >>requests/acknowledgements) are exchanged between client and server queues at a frequency that matches timeout settings (or half of in the case of >>the inactivity timeout) as seen in the trace.
>>
>>As I said, there is no noticeable affect on sending/receiving messages but am curious why the message appears in the trace at all?
>>

>What is the period of inactivity that precedes the error? If it is 10 minutes then you may need to adjust "Inactivity Timeout". If you have already tried >that can you show how you changed the binding or the config file?

The actual problem is the ReceiveTimeout. If the period of inactivity
exceeds the ReceiveTimeout on the service, the message below is sent
to the client queue:

Node:         rabbit at MACHINE2
Exchange:     amq.direct
Routing keys: [<<"/439a2420-2369-4d00-8e23-704b4d31dda1">>]
Properties:   []
Payload:
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope"
xmlns:a="http://www.w3.org/2005/08/addressing"><s:Header><a:Action
s:mustUnderstand="1">http://www.w3.org/2005/08/addressing/soap/fault</
a:Action><a:To s:mustUnderstand="1">soap.amqp:///
439a2420-2369-4d00-8e23-704b4d31dda1</a:To></
s:Header><s:Body><s:Fault><s:Code><s:Value>s:Receiver</
s:Value><s:Subcode><s:Value xmlns:a="http://schemas.xmlsoap.org/ws/
2005/02/rm">a:SequenceTerminated</s:Value></s:Subcode></
s:Code><s:Reason><s:Text xml:lang="en-GB">Due to a user abort the
reliable session cannot continue.</s:Text></
s:Reason><s:Detail><r:Identifier xmlns:r="http://schemas.xmlsoap.org/
ws/2005/02/rm">urn:uuid:e4415296-97ff-4b1a-9b3c-e43b862037ca</
r:Identifier></s:Detail></s:Fault></s:Body></s:Envelope>

I have added to the
RabbitMQ.ServiceModel.RabbitMQBindingConfigurationElement class (I can
send you the code if you wish) ...

[ConfigurationProperty("inactivityTimeout", DefaultValue="00:10:00")]
public TimeSpan InactivityTimeout ... (etc.)
[ConfigurationProperty("receiveTimeout", DefaultValue = "00:10:00")]
public new TimeSpan ReceiveTimeout ... (etc.)

... to capture configured values. The OnApplyConfiguration method in
the above class will then use values from the above properties to set
the relevant properties on the RabbitMQ.ServiceModel.RabbitMQBinding
class (InitializeFrom also modified to set on 'binding' parameter). By
setting the InactivityTimeout I am effectively getting infrastructure
ack messages sent to the client and server queues and I can see this
in the messages below (first message is to service queue, second
message is to client queue):

================================================================================
2012-1-24 14:6:0: Message published

Node:         rabbit at MACHINE2
Exchange:     amq.direct
Routing keys: [<<"/Service">>]
Properties:   []
Payload:
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope"
xmlns:r="http://schemas.xmlsoap.org/ws/2005/02/rm" xmlns:a="http://
www.w3.org/2005/08/addressing"><s:Header><r:AckRequested><r:Identifier>urn:uuid:e4415296-97ff-4b1a-9b3c-e43b862037ca</r:Identifier></r:AckRequested><a:Action
s:mustUnderstand="1">http://schemas.xmlsoap.org/ws/2005/02/rm/
AckRequested</a:Action></s:Header><s:Body/></s:Envelope>

================================================================================
2012-1-24 14:6:0: Message published

Node:         rabbit at MACHINE2
Exchange:     amq.direct
Routing keys: [<<"/439a2420-2369-4d00-8e23-704b4d31dda1">>]
Properties:   []
Payload:
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope"
xmlns:r="http://schemas.xmlsoap.org/ws/2005/02/rm" xmlns:a="http://
www.w3.org/2005/08/addressing"><s:Header><r:SequenceAcknowledgement><r:Identifier>urn:uuid:e4415296-97ff-4b1a-9b3c-e43b862037ca</r:Identifier><r:AcknowledgementRange
Lower="1" Upper="2"/><netrm:BufferRemaining xmlns:netrm="http://
schemas.microsoft.com/ws/2006/05/rm">8</netrm:BufferRemaining></
r:SequenceAcknowledgement><a:Action s:mustUnderstand="1">http://
schemas.xmlsoap.org/ws/2005/02/rm/SequenceAcknowledgement</
a:Action><a:To s:mustUnderstand="1">soap.amqp:///
439a2420-2369-4d00-8e23-704b4d31dda1</a:To></s:Header><s:Body/></
s:Envelope>

For example, if I set the InactivityTimeout and ReceiveTimeout
properties to 2 minutes I am seeing an ack message sent at 1 minute
(after initial call - as expected as the infrastructure message is
fired every half of the inactivity value), but then at 2 minutes the
error message above is sent to the client queue (when the
receivetimeout expires). So even though messages are being exchanged,
the connection still aborts as it has not received any application
messages during this time.

After some Googling I came across this (http://msdn.microsoft.com/en-
us/library/system.servicemodel.channels.binding.receivetimeout.aspx)
which answers the question I believe. The ReceiveTimeout listens for
application messages, and if none are received within the duration
specified it will fault the channel. The InactivityTimeout listens for
application AND infrastructure messages. I think I will need to set
the ReceiveTimeout value on the service to a sufficiently large value
for real world scenarios (max is 24 days I think).

Anyway, I have added some new config fields to the binding
configuration (as described above) which should enable toggling of
these values to provide the best fit.

Daniel.



From dawgtool at aol.com  Tue Jan 24 17:19:17 2012
From: dawgtool at aol.com (DawgTool)
Date: Tue, 24 Jan 2012 12:19:17 -0500
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures
 on	Queue Bind - 2012-01-20
In-Reply-To: <4F1E9945.7060503@rabbitmq.com>
References: <4F19E73D.9080107@aol.com> <4F1D3CE1.6060701@rabbitmq.com>
	<4F1DB931.4020501@aol.com> <4F1E9945.7060503@rabbitmq.com>
Message-ID: <4F1EE815.4010501@aol.com>

Hi Simon,

It appears there was a delay on dc001-exchange-u binding to federation: 
dc001........

Not sure the exact time it took before I could send messages to that 
exchange (complained about no route), but eventually it started working.
I'll run some additional test and respond back to this thread.

Thank you.


On 1/24/12 6:43 AM, Simon MacMullen wrote:
> On 23/01/12 19:46, DawgTool wrote:
>> ok, created the exchange before starting the downstream server.
>> Federation exchange is created, but it is not bound to the
>> dc001-exchange-u.
>> Am I missing something?
>
> What do you mean by not bound? The exchanges should be on different 
> machines so they can't be bound in the usual sense of the word. What 
> were you expecting to see, and what did you see instead?
>
> Cheers, Simon
>


From emile at rabbitmq.com  Tue Jan 24 17:28:53 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 24 Jan 2012 17:28:53 +0000
Subject: [rabbitmq-discuss] WCF bindings connection drop outs
In-Reply-To: <b5d0a2b1-1a9b-4c7b-8973-962ebb02df99@i25g2000vbt.googlegroups.com>
References: <5acc550d-1f04-4063-95ea-f43ec47b4d14@f11g2000yql.googlegroups.com>
	<4F101F83.2040302@rabbitmq.com>
	<addc9143-80f0-4ee0-bd06-4b072df61543@f33g2000yqh.googlegroups.com>
	<b5d0a2b1-1a9b-4c7b-8973-962ebb02df99@i25g2000vbt.googlegroups.com>
Message-ID: <4F1EEA55.2060803@rabbitmq.com>

Hi,

On 24/01/12 16:48, LuCo wrote:
> Anyway, I have added some new config fields to the binding
> configuration (as described above) which should enable toggling of
> these values to provide the best fit.

Thanks for your detailed investigation, which might prove useful for
others experiencing the same problem. At this point I'm not sure whether
your requirements are sufficiently general to warrant updates to the
code. If you think there are things that we could change to make your
life easier (once you have a solution that you are happy with) then
please let us know.


-Emile


From andrea.rosa at hp.com  Tue Jan 24 17:39:29 2012
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Tue, 24 Jan 2012 17:39:29 +0000
Subject: [rabbitmq-discuss] Deregister a consumer
Message-ID: <5F389C517756284F80239F55BCA5DDDD3691DCAE@G9W0721.americas.hpqcorp.net>

Hi

Is it possible to force the deregistration of a consumer using some commands?
Thanks
--
Andrea Rosa

From simon at rabbitmq.com  Tue Jan 24 17:43:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 17:43:13 +0000
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>	<4EE8B5FC.6020709@rabbitmq.com>
	<5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>
Message-ID: <4F1EEDB1.5040007@rabbitmq.com>

On 24/01/12 14:56, cupdike wrote:
> What would be the best way to monitor RabbitMQ's plans regarding a 1.0
> adoption decision?

Probably to watch this list.

> Also, why would RabbitMQ consider not supporting 1.0?  Is the thinking
> that it may not see industry adoption, or something else?

Well, obviously we'd like to support everything and have every feature. 
But we live in a world of limited resources.

The thing is, it's such a big difference from 0-9-1 that I view it as a 
different protocol really, despite the name. In some ways it's more like 
a super-STOMP - giving you less connection with broker internals but 
being more focussed on interoperability.

So yes, I'd like to support it, but I'd also like to support MQTT and 
SQS and something-cool-over-websockets (and resurrect our support for 
XMPP and 0MQ and SMTP, and improve our support for REST and STOMP and...).

And it may not see much industry adoption, the way all those other 
things already have. And without wanting to complain too much, it is 
rather heavy and complicated, so to support it properly we'd be looking 
at *not* doing quite a lot of other stuff we want to.

Of course, if AMQP 1.0 takes off substantially then that could well 
change things.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Tue Jan 24 17:46:25 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 24 Jan 2012 18:46:25 +0100
Subject: [rabbitmq-discuss] Deregister a consumer
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3691DCAE@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3691DCAE@G9W0721.americas.hpqcorp.net>
Message-ID: <CAMcAHLXjegsJ9gNhhttRiWivqQbUuUfs7Q23woMELLXZ2+xXkw@mail.gmail.com>

Hi,

I think on the management plugin you can force close a channel. You can
probably do the same from rabbitmqctl

-Alvaro

On Tue, Jan 24, 2012 at 6:39 PM, Rosa, Andrea <andrea.rosa at hp.com> wrote:

> Hi
>
> Is it possible to force the deregistration of a consumer using some
> commands?
> Thanks
> --
> Andrea Rosa
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120124/3c462205/attachment.htm>

From fearsome.lucidity at gmail.com  Tue Jan 24 18:05:59 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 24 Jan 2012 10:05:59 -0800
Subject: [rabbitmq-discuss] Shovel questions
Message-ID: <CAFDmHdPQAdPHB7eQJruTe6SYAc9xCA62_634UAh8owo_E3Q1+Q@mail.gmail.com>

From: Simon MacMullen <simon at rabbitmq.com>

> Federation requires e-e bindings in the upstream, it creates an internal
> exchange (that it uses to be able to create a load of bindings
atomically).


Simon,

Interesting.  I suppose you create a new exchange, create a number of
bindings against the exchange, then create an exchange-to-exchange binding
against the new exchange to apply all those bindings atomically, yes?

That's a good trick to know, since AMQP does not give you a way to create
multiple bindings atomically.

I am curious as to whether this helps at all with binding churn.  I know
its recommended to long term bindings to avoid binding churn, but this is
often not possible, as a client may need to change its bindings
dynamically.  Would making use private client exchange, creating the
dynamic bindings against it, and the creating the single e2e binding help
with binding churn?

I imagine it would not, since the additional bindings still will cause lots
of changes to the distributed Mnesia DB.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120124/f2e47629/attachment.htm>

From simon at rabbitmq.com  Tue Jan 24 18:08:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 Jan 2012 18:08:29 +0000
Subject: [rabbitmq-discuss] Deregister a consumer
In-Reply-To: <CAMcAHLXjegsJ9gNhhttRiWivqQbUuUfs7Q23woMELLXZ2+xXkw@mail.gmail.com>
References: <5F389C517756284F80239F55BCA5DDDD3691DCAE@G9W0721.americas.hpqcorp.net>
	<CAMcAHLXjegsJ9gNhhttRiWivqQbUuUfs7Q23woMELLXZ2+xXkw@mail.gmail.com>
Message-ID: <4F1EF39D.2030807@rabbitmq.com>

On 24/01/12 17:46, Alvaro Videla wrote:
> I think on the management plugin you can force close a channel. You can
> probably do the same from rabbitmqctl

Connection, not channel. But yes, rabbitmqctl can do that too.

There's currently no way to do the same thing with channels or consumers 
though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dawgtool at aol.com  Tue Jan 24 18:37:08 2012
From: dawgtool at aol.com (DawgTool)
Date: Tue, 24 Jan 2012 13:37:08 -0500
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures
 on	Queue Bind - 2012-01-20
In-Reply-To: <4F1EE815.4010501@aol.com>
References: <4F19E73D.9080107@aol.com> <4F1D3CE1.6060701@rabbitmq.com>
	<4F1DB931.4020501@aol.com> <4F1E9945.7060503@rabbitmq.com>
	<4F1EE815.4010501@aol.com>
Message-ID: <4F1EFA54.2000406@aol.com>

Hi Simon,

On a side note; the performance I am seeing between cluster is very 
unexpected.
Publishing to the federated exchange seems to consume about ~4 times the 
CPU as a typical exchange.
The downstream cluster also sees about the same level of cpu usage.

Setup:
Cluster(001) dc001-exchange-u (fanout)
Cluster(002) dc001-exchange-d (fanout) -> dc001-queue-d

Test 1:
Messages: ~3K/sec
Network:  8.5KB/sec
Cluster(001) CPUs: 45% consumed
Cluster(002) CPUs: 47% consumed

Test 2:
Messages: ~11K/sec
Network: 38KB/sec
Cluster(001) CPUs: 97% consumed
Cluster(002) CPUs: 97% consumed

What I was hoping to see that Cluster(002) would be about half the cpu 
consumption as Cluster(001).
Or something like the scenario of publishing to a cluster on host 1 with 
the queue on host 2.
Host 1 would take on the message handling from the publisher and hand it 
off to host 2 which writes to the queue (spreads the load across the 
cluster, but adds a little overhead).

Please let me know if I have missed something, or if you can think of 
any tricks to reduce the cpu usage.
Thanks



On 1/24/12 12:19 PM, DawgTool wrote:
> Hi Simon,
>
> It appears there was a delay on dc001-exchange-u binding to 
> federation: dc001........
>
> Not sure the exact time it took before I could send messages to that 
> exchange (complained about no route), but eventually it started working.
> I'll run some additional test and respond back to this thread.
>
> Thank you.
>
>
> On 1/24/12 6:43 AM, Simon MacMullen wrote:
>> On 23/01/12 19:46, DawgTool wrote:
>>> ok, created the exchange before starting the downstream server.
>>> Federation exchange is created, but it is not bound to the
>>> dc001-exchange-u.
>>> Am I missing something?
>>
>> What do you mean by not bound? The exchanges should be on different 
>> machines so they can't be bound in the usual sense of the word. What 
>> were you expecting to see, and what did you see instead?
>>
>> Cheers, Simon
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From fearsome.lucidity at gmail.com  Tue Jan 24 20:02:53 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 24 Jan 2012 12:02:53 -0800
Subject: [rabbitmq-discuss] Federation plug-in and HA queues
Message-ID: <CAFDmHdPvLjne0kPh3EJesT40o521wYsM2jpDR--1ET+kw7jQgw@mail.gmail.com>

Looking through the source of the federation plug-in it would seem that is
does not make use of HA queues, which makes it vulnerable to message loss
in the case of loosing the node hosting the federation queue on the
downstream broker.

Is my reading correct?

Are there any plans to optionally being able to configure the federation
plug-in to use HA queues?

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120124/1ae0b7b1/attachment.htm>

From mpietrek at skytap.com  Tue Jan 24 20:43:18 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 24 Jan 2012 12:43:18 -0800
Subject: [rabbitmq-discuss] Determining if two clustered brokers are in sync
Message-ID: <CB4457E6.2A02D%mpietrek@skytap.com>

Just looking for some quick confirmation that I'm not trying to do the
impossible.

I'm crafting some custom tooling that queries the sync status of a mirrored
queue on RabbitMQ 2.71/Ubuntu 10.04.

I've been successfully using the HTTP API via the rabbitmqadmin module and
been able to get some of the info I need . However,  the "slave_pids" and
"synchronised_slave_pids" values don't seem to be available.

The primary question is thus:  Are "slave_pids" and
"synchronised_slave_pids" available via the rabbitmq HTTP API?


Additional Background Information for the curious:
=====================

Per the rabbitmqctl cmd-line help, "slave_pids" and
"synchronised_slave_pids" are valid queueinfoitems.

In my experience, queueinfoitems are valid additional arguments to
"rabbitmqadmin list queues"

I've simplified the repro case down to the following difference between
rabbitmqctl vs. rabbitmqadmin:

Rabbitmqctl displays certain queueinfoitem fields as expected:

mpietrek at play:~/work/$rabbitmqctl list_queues consumers messages name
slave_pids synchronised_slave_pids
Listing queues ...
0 0 fake_munger_queue [<rabbit at play2.1.248.0>] [<rabbit at play2.1.248.0>]
0 0 fake_service_2 [<rabbit at play2.1.250.0>] [<rabbit at play2.1.250.0>]
...done.


However, rabbitmqadmin doesn't:

mpietrek at play:~/work/$rabbitmqadmin.py list queues consumers messages name
slave_pids synchronised_slave_pids
+-----------+----------+----------------------+------------+----------------
---------+
| consumers | messages |         name         | slave_pids |
synchronised_slave_pids |
+-----------+----------+----------------------+------------+----------------
---------+
| 0         | 0        | fake_munger_queue    |            |
|
| 0         | 0        | fake_service_2       |            |
|
+-----------+----------+----------------------+------------+----------------
---------+



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120124/6659d234/attachment.htm>

From simone.busoli at gmail.com  Tue Jan 24 21:34:32 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 24 Jan 2012 22:34:32 +0100
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <4F1EEDB1.5040007@rabbitmq.com>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
	<4EE8B5FC.6020709@rabbitmq.com>
	<5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>
	<4F1EEDB1.5040007@rabbitmq.com>
Message-ID: <CAOn7oW9Z+T+pS92c5646uZO6rt9BfomDa4xHaZSTnMAZG29-WQ@mail.gmail.com>

For the little I've read about 1.0 it's really weird that it's called with
the same name. I mean, migrating systems working on 0-9-1 to 1.0 sounds
nearly impossible given the differences in the protocol.
That's a bit worrying to think that development on 0-9-1 might be halted in
case of take off of 1.0, considering the effort you might have put on
developing something to target the current version.

On Tue, Jan 24, 2012 at 18:43, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 24/01/12 14:56, cupdike wrote:
>
>> What would be the best way to monitor RabbitMQ's plans regarding a 1.0
>> adoption decision?
>>
>
> Probably to watch this list.
>
>
>  Also, why would RabbitMQ consider not supporting 1.0?  Is the thinking
>> that it may not see industry adoption, or something else?
>>
>
> Well, obviously we'd like to support everything and have every feature.
> But we live in a world of limited resources.
>
> The thing is, it's such a big difference from 0-9-1 that I view it as a
> different protocol really, despite the name. In some ways it's more like a
> super-STOMP - giving you less connection with broker internals but being
> more focussed on interoperability.
>
> So yes, I'd like to support it, but I'd also like to support MQTT and SQS
> and something-cool-over-websockets (and resurrect our support for XMPP and
> 0MQ and SMTP, and improve our support for REST and STOMP and...).
>
> And it may not see much industry adoption, the way all those other things
> already have. And without wanting to complain too much, it is rather heavy
> and complicated, so to support it properly we'd be looking at *not* doing
> quite a lot of other stuff we want to.
>
> Of course, if AMQP 1.0 takes off substantially then that could well change
> things.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120124/673250cd/attachment.htm>

From alexis at rabbitmq.com  Tue Jan 24 21:58:28 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 24 Jan 2012 21:58:28 +0000
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <CAOn7oW9Z+T+pS92c5646uZO6rt9BfomDa4xHaZSTnMAZG29-WQ@mail.gmail.com>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
	<4EE8B5FC.6020709@rabbitmq.com>
	<5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>
	<4F1EEDB1.5040007@rabbitmq.com>
	<CAOn7oW9Z+T+pS92c5646uZO6rt9BfomDa4xHaZSTnMAZG29-WQ@mail.gmail.com>
Message-ID: <CACOPnvdeTgWfvEFZo=jWpgV=kUPEQAubEvPCU3nPB9DkCevxLw@mail.gmail.com>

We demonstrated a migration concept at the AMQP conference in New
York, using federation, and two rabbits one of which ran the 1.0
plugin (not prod ready).

About the rest of it..  Lots of things are possible.


On Tue, Jan 24, 2012 at 9:34 PM, Simone Busoli <simone.busoli at gmail.com> wrote:
> For the little I've read about 1.0 it's really weird that it's called with
> the same name. I mean, migrating systems working on 0-9-1 to 1.0 sounds
> nearly impossible given the differences in the protocol.
> That's a bit worrying to think that development on 0-9-1 might be halted in
> case of take off of 1.0, considering the effort you might have put on
> developing something to target the current version.
>
> On Tue, Jan 24, 2012 at 18:43, Simon MacMullen <simon at rabbitmq.com> wrote:
>>
>> On 24/01/12 14:56, cupdike wrote:
>>>
>>> What would be the best way to monitor RabbitMQ's plans regarding a 1.0
>>> adoption decision?
>>
>>
>> Probably to watch this list.
>>
>>
>>> Also, why would RabbitMQ consider not supporting 1.0? ?Is the thinking
>>> that it may not see industry adoption, or something else?
>>
>>
>> Well, obviously we'd like to support everything and have every feature.
>> But we live in a world of limited resources.
>>
>> The thing is, it's such a big difference from 0-9-1 that I view it as a
>> different protocol really, despite the name. In some ways it's more like a
>> super-STOMP - giving you less connection with broker internals but being
>> more focussed on interoperability.
>>
>> So yes, I'd like to support it, but I'd also like to support MQTT and SQS
>> and something-cool-over-websockets (and resurrect our support for XMPP and
>> 0MQ and SMTP, and improve our support for REST and STOMP and...).
>>
>> And it may not see much industry adoption, the way all those other things
>> already have. And without wanting to complain too much, it is rather heavy
>> and complicated, so to support it properly we'd be looking at *not* doing
>> quite a lot of other stuff we want to.
>>
>> Of course, if AMQP 1.0 takes off substantially then that could well change
>> things.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From pacesysjosh at gmail.com  Tue Jan 24 23:39:11 2012
From: pacesysjosh at gmail.com (Josh Stone)
Date: Tue, 24 Jan 2012 15:39:11 -0800 (PST)
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
	related to workload distribution
Message-ID: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>

We're looking at using rabbitmq with the consistent hash exchange to
distribute workload to a set of workers with each worker subscribing
to one or more topics. It looks like this will work well, until a
worker along with its topics either comes or leaves, which will
disrupt the hashing.

Particularly, if a new worker enters and creates some topics on the
exchange, messages that previously would have been delivered to
another topic will be directed to the new topic. And if an existing
worker was operating on some data from a previous message and a new
message to operate on that data is sent to a new topic, we could have
a race condition.

I'm wondering how other users are handling this? With other systems
that use consistent hashing such as Dynamo, when the hashing changes
data that would have previously been stored on one node is sent to
another node. When using consistent hashing to distribute workload
though, we can't very easily suspend processing on one worker and send
it to another. Any input on how other users are dealing with this
would be appreciated.

Cheers,
Josh

From codevally at gmail.com  Wed Jan 25 00:38:01 2012
From: codevally at gmail.com (Codevally)
Date: Tue, 24 Jan 2012 16:38:01 -0800 (PST)
Subject: [rabbitmq-discuss] Queue item limits
Message-ID: <c82ef2fa-5879-4d1a-ad37-044b3e6f805f@b10g2000pbd.googlegroups.com>

Hi

I have a declared queue and want to know how can I limit the number of
items in that queue. For example, the define queue is "sms_gateway"
and that queue can maximum allow to receive 500 items.

Many Thanks.

From codevally at gmail.com  Wed Jan 25 00:42:44 2012
From: codevally at gmail.com (Codevally)
Date: Tue, 24 Jan 2012 16:42:44 -0800 (PST)
Subject: [rabbitmq-discuss] Queue item limits
In-Reply-To: <c82ef2fa-5879-4d1a-ad37-044b3e6f805f@b10g2000pbd.googlegroups.com>
References: <c82ef2fa-5879-4d1a-ad37-044b3e6f805f@b10g2000pbd.googlegroups.com>
Message-ID: <0bd1da48-5895-4072-b8fc-f070bb8fc8f6@3g2000pbd.googlegroups.com>

This is something like  restrict the size of the queue. Please help.

On Jan 25, 11:38?am, Codevally <codeva... at gmail.com> wrote:
> Hi
>
> I have a declared queue and want to know how can I limit the number of
> items in that queue. For example, the define queue is "sms_gateway"
> and that queue can maximum allow to receive 500 items.
>
> Many Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From macar at cloudmark.com  Wed Jan 25 00:47:21 2012
From: macar at cloudmark.com (Mike Acar)
Date: Tue, 24 Jan 2012 16:47:21 -0800
Subject: [rabbitmq-discuss] State-of-the-art Perl client?
Message-ID: <4F1F5119.9020407@cloudmark.com>

Hi,

I've done some searching and haven't found a consensus answer: What's 
the state-of-the-art Perl client for RabbitMQ?

Thanks!

-- 
Mike Acar -                                 - macar at cloudmark dot com

From toby.corkindale at strategicdata.com.au  Wed Jan 25 05:30:11 2012
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 25 Jan 2012 16:30:11 +1100
Subject: [rabbitmq-discuss] State-of-the-art Perl client?
In-Reply-To: <4F1F5119.9020407@cloudmark.com>
References: <4F1F5119.9020407@cloudmark.com>
Message-ID: <4F1F9363.8050405@strategicdata.com.au>

On 25/01/12 11:47, Mike Acar wrote:
> Hi,
>
> I've done some searching and haven't found a consensus answer: What's
> the state-of-the-art Perl client for RabbitMQ?


The only decent one I've found is Net::STOMP::Client.
The author is active on this list and responds to bug reports.

I filed bugs against the others on CPAN ages ago and have been ignored 
by their authors.

-Toby

From toby.corkindale at strategicdata.com.au  Wed Jan 25 05:31:58 2012
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 25 Jan 2012 16:31:58 +1100
Subject: [rabbitmq-discuss] State-of-the-art Perl client?
In-Reply-To: <4F1F9363.8050405@strategicdata.com.au>
References: <4F1F5119.9020407@cloudmark.com>
	<4F1F9363.8050405@strategicdata.com.au>
Message-ID: <4F1F93CE.8050702@strategicdata.com.au>

On 25/01/12 16:30, Toby Corkindale wrote:
> On 25/01/12 11:47, Mike Acar wrote:
>> Hi,
>>
>> I've done some searching and haven't found a consensus answer: What's
>> the state-of-the-art Perl client for RabbitMQ?
>
>
> The only decent one I've found is Net::STOMP::Client.
> The author is active on this list and responds to bug reports.
>
> I filed bugs against the others on CPAN ages ago and have been ignored
> by their authors.


PS. The STOMP adaptor doesn't expose the full functionality of RabbitMQ, 
unfortunately.

So I use the module Net::RabbitMQ::Management::API to create the actual 
queues and exchanges.

From simone.busoli at gmail.com  Wed Jan 25 07:11:31 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 25 Jan 2012 08:11:31 +0100
Subject: [rabbitmq-discuss] Queue item limits
In-Reply-To: <0bd1da48-5895-4072-b8fc-f070bb8fc8f6@3g2000pbd.googlegroups.com>
References: <c82ef2fa-5879-4d1a-ad37-044b3e6f805f@b10g2000pbd.googlegroups.com>
	<0bd1da48-5895-4072-b8fc-f070bb8fc8f6@3g2000pbd.googlegroups.com>
Message-ID: <CAOn7oW9OxJAs8c_5jgQHQ5zfgkM=sPRYnWNHuFQrSm3ptY+=sA@mail.gmail.com>

There is no such feature in the broker, perhaps if you explain what you are
trying to do there may be other ways.
On Jan 25, 2012 1:43 AM, "Codevally" <codevally at gmail.com> wrote:

> This is something like  restrict the size of the queue. Please help.
>
> On Jan 25, 11:38 am, Codevally <codeva... at gmail.com> wrote:
> > Hi
> >
> > I have a declared queue and want to know how can I limit the number of
> > items in that queue. For example, the define queue is "sms_gateway"
> > and that queue can maximum allow to receive 500 items.
> >
> > Many Thanks.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/016f25ee/attachment.htm>

From yogimogi at gmail.com  Wed Jan 25 08:30:54 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Wed, 25 Jan 2012 00:30:54 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)
Message-ID: <8fc9ce15-481d-42ab-8aab-0062443c1d3b@o4g2000pbc.googlegroups.com>

This is what I played around with.
Had around 5000 messages (each with 20 bytes of payload) pumped on a
queue say MainQueue.

MainQueue has a single consumer which reads messages from the queue
and based on payload does
queueDeclare and routes the messages to newly/already declared queue.
There would at most be 100 queues with name
Queue-1 to Queue-100 which would get generated based on the payload.

There is a threadpool (with 10 threads) which is under control of a
ExecutorService.
Each thread is provided a queue name to work on. Thread reads all the
messages from that queue (using basicGet) and in the end
deletes the queue. Each thread creates a new channel and closes it in
the end.
So overall at any point of time at the most 11 channels are in use (1
by MainQueue consumer and 10 by threads), which I
verified by running rabbitmqadmin.py list channels.

This worked for 5000 messages, but moment I pumped in another 10000
messages on MainQueue, things fell apart.
It started taking 5-10 seconds just for consumer to consume a message
from MainQueue and deliver it to appropriate queue.
When this starts happening erl.exe process is still taking 100% CPU no
matter what you do (killing all consumer Java programs, deleting all
the queues, with rabbitmqadmin.py), CPU usage by erl.exe is still 100%
and now unless you restart the service
RabbitMQ is almost unusable.

I even checked rabbitmqadmin.py list (channels, queues, connections),
everything showed 0. But still CPU consumption was 100%.

Environment: Windowns 7, RAM 4GB

Any clues how to debug this?

regards, Yogesh

From andrea.rosa at hp.com  Wed Jan 25 09:21:01 2012
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Wed, 25 Jan 2012 09:21:01 +0000
Subject: [rabbitmq-discuss] Deregister a consumer
In-Reply-To: <4F1EF39D.2030807@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD3691DCAE@G9W0721.americas.hpqcorp.net>
	<CAMcAHLXjegsJ9gNhhttRiWivqQbUuUfs7Q23woMELLXZ2+xXkw@mail.gmail.com>
	<4F1EF39D.2030807@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3691DE4E@G9W0721.americas.hpqcorp.net>

Hi 

Thanks for your reply.
I know that I can close the connection but it's not what I want to do.
On the same connection there are different channels used by different consumers, I'd like to know if it would possible to have a command to call the "basic.channel_cancel(consumer_tag)" to deliberately deregister a consumer.
All this just for debugging/testing purpose.

Thanks both for your time
--
Andrea Rosa

>-----Original Message-----
>From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
>discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
>Sent: 24 January 2012 18:08
>To: rabbitmq-discuss at lists.rabbitmq.com
>Subject: Re: [rabbitmq-discuss] Deregister a consumer
>
>On 24/01/12 17:46, Alvaro Videla wrote:
>> I think on the management plugin you can force close a channel. You
>can
>> probably do the same from rabbitmqctl
>
>Connection, not channel. But yes, rabbitmqctl can do that too.
>
>There's currently no way to do the same thing with channels or consumers
>though.
>
>Cheers, Simon
>
>--
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From smetj.net at gmail.com  Wed Jan 25 09:50:00 2012
From: smetj.net at gmail.com (Jelle Smet)
Date: Wed, 25 Jan 2012 01:50:00 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ/Shovel & Compression
Message-ID: <27476394.1285.1327485000061.JavaMail.geo-discussion-forums@yqlw12>

Hi all,

I was wondering whether there would be any chance that Shovel or RabbitMQ 
itself gets a compression functionality anytime in the future?
I have multiple RabbitMQ's which shovel messages over WAN to each 
other,which is working great. I realize compression would be really nice to 
have in order to reduce the amount of traffic going over WAN.
I would like to avoid letting my clients handle compression and 
decompression.

Any idea anyone? 

Thanks,

Jelle
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/5a7d2859/attachment.htm>

From simon at rabbitmq.com  Wed Jan 25 10:57:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 10:57:47 +0000
Subject: [rabbitmq-discuss] Determining if two clustered brokers are in
 sync
In-Reply-To: <CB4457E6.2A02D%mpietrek@skytap.com>
References: <CB4457E6.2A02D%mpietrek@skytap.com>
Message-ID: <4F1FE02B.8080107@rabbitmq.com>

On 24/01/12 20:43, Matt Pietrek wrote:
> Just looking for some quick confirmation that I'm not trying to do the
> impossible.

I answered your question twice before:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017146.html

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017155.html

Are you looking at the list? CCed in case you're not.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 25 11:02:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 11:02:39 +0000
Subject: [rabbitmq-discuss] Federation plug-in and HA queues
In-Reply-To: <CAFDmHdPvLjne0kPh3EJesT40o521wYsM2jpDR--1ET+kw7jQgw@mail.gmail.com>
References: <CAFDmHdPvLjne0kPh3EJesT40o521wYsM2jpDR--1ET+kw7jQgw@mail.gmail.com>
Message-ID: <4F1FE14F.8050100@rabbitmq.com>

On 24/01/12 20:02, Elias Levy wrote:
> Looking through the source of the federation plug-in it would seem that
> is does not make use of HA queues, which makes it vulnerable to message
> loss in the case of loosing the node hosting the federation queue on the
> downstream broker.
>
> Is my reading correct?

That is correct unfortunately yes.

> Are there any plans to optionally being able to configure the federation
> plug-in to use HA queues?

It might happen. Or we might make it possible to make queues HA by default.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 25 11:10:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 11:10:44 +0000
Subject: [rabbitmq-discuss] RabbitMQ/Shovel & Compression
In-Reply-To: <27476394.1285.1327485000061.JavaMail.geo-discussion-forums@yqlw12>
References: <27476394.1285.1327485000061.JavaMail.geo-discussion-forums@yqlw12>
Message-ID: <4F1FE334.30203@rabbitmq.com>

On 25/01/12 09:50, Jelle Smet wrote:
> I was wondering whether there would be any chance that Shovel or
> RabbitMQ itself gets a compression functionality anytime in the future?

It would be a nice feature, but pretty low priority TBH.

> I have multiple RabbitMQ's which shovel messages over WAN to each
> other,which is working great. I realize compression would be really nice
> to have in order to reduce the amount of traffic going over WAN.
> I would like to avoid letting my clients handle compression and
> decompression.
>
> Any idea anyone?

Set up a compressed SSH tunnel? Or if the overhead of encryption is too 
great, hook up netcat and gzip in front of Rabbit?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 25 11:13:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 11:13:59 +0000
Subject: [rabbitmq-discuss] Shovel questions
In-Reply-To: <CAFDmHdPQAdPHB7eQJruTe6SYAc9xCA62_634UAh8owo_E3Q1+Q@mail.gmail.com>
References: <CAFDmHdPQAdPHB7eQJruTe6SYAc9xCA62_634UAh8owo_E3Q1+Q@mail.gmail.com>
Message-ID: <4F1FE3F7.1050608@rabbitmq.com>

On 24/01/12 18:05, Elias Levy wrote:
> I am curious as to whether this helps at all with binding churn.  I know
> its recommended to long term bindings to avoid binding churn, but this
> is often not possible, as a client may need to change its bindings
> dynamically.  Would making use private client exchange, creating the
> dynamic bindings against it, and the creating the single e2e binding
> help with binding churn?

No, it's still the same underlying operation. Of course "avoid binding 
churn" is just a special case of "avoid unnecessary work" - if the work 
is necessary you can't avoid it...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 25 11:29:23 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 11:29:23 +0000
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <CAOn7oW9Z+T+pS92c5646uZO6rt9BfomDa4xHaZSTnMAZG29-WQ@mail.gmail.com>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
	<4EE8B5FC.6020709@rabbitmq.com>
	<5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>
	<4F1EEDB1.5040007@rabbitmq.com>
	<CAOn7oW9Z+T+pS92c5646uZO6rt9BfomDa4xHaZSTnMAZG29-WQ@mail.gmail.com>
Message-ID: <4F1FE793.1080607@rabbitmq.com>

On 24/01/12 21:34, Simone Busoli wrote:
> That's a bit worrying to think that development on 0-9-1 might be halted
> in case of take off of 1.0, considering the effort you might have put on
> developing something to target the current version.

Obviously I can't predict the future, but you *really* should not worry 
that we're going to leave all our 0-9-1 users high and dry.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Jan 25 11:31:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Jan 2012 11:31:09 +0000
Subject: [rabbitmq-discuss] Queue item limits
In-Reply-To: <CAOn7oW9OxJAs8c_5jgQHQ5zfgkM=sPRYnWNHuFQrSm3ptY+=sA@mail.gmail.com>
References: <c82ef2fa-5879-4d1a-ad37-044b3e6f805f@b10g2000pbd.googlegroups.com>
	<0bd1da48-5895-4072-b8fc-f070bb8fc8f6@3g2000pbd.googlegroups.com>
	<CAOn7oW9OxJAs8c_5jgQHQ5zfgkM=sPRYnWNHuFQrSm3ptY+=sA@mail.gmail.com>
Message-ID: <4F1FE7FD.2090601@rabbitmq.com>

Hi,

On 25/01/12 07:11, Simone Busoli wrote:
> There is no such feature in the broker, perhaps if you explain what you
> are trying to do there may be other ways.
>
> On Jan 25, 2012 1:43 AM, "Codevally" <codevally at gmail.com
> <mailto:codevally at gmail.com>> wrote:
>
>     This is something like  restrict the size of the queue. Please help.
>
>     On Jan 25, 11:38 am, Codevally <codeva... at gmail.com
>     <mailto:codeva... at gmail.com>> wrote:
>      > Hi
>      >
>      > I have a declared queue and want to know how can I limit the
>     number of
>      > items in that queue. For example, the define queue is "sms_gateway"
>      > and that queue can maximum allow to receive 500 items.


As Simone says, there is no way of limiting the number of messages in a 
queue. The closest approximation is to limit the time that messages may 
spend in a queue.

http://www.rabbitmq.com/extensions.html#lifetimes



-Emile

From matthew at rabbitmq.com  Wed Jan 25 11:50:53 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 25 Jan 2012 11:50:53 +0000
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <4F1FE793.1080607@rabbitmq.com>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
	<4EE8B5FC.6020709@rabbitmq.com>
	<5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>
	<4F1EEDB1.5040007@rabbitmq.com>
	<CAOn7oW9Z+T+pS92c5646uZO6rt9BfomDa4xHaZSTnMAZG29-WQ@mail.gmail.com>
	<4F1FE793.1080607@rabbitmq.com>
Message-ID: <20120125115052.GA16645@rabbitmq.com>

On Wed, Jan 25, 2012 at 11:29:23AM +0000, Simon MacMullen wrote:
> On 24/01/12 21:34, Simone Busoli wrote:
> >That's a bit worrying to think that development on 0-9-1 might be halted
> >in case of take off of 1.0, considering the effort you might have put on
> >developing something to target the current version.
> 
> Obviously I can't predict the future, but you *really* should not
> worry that we're going to leave all our 0-9-1 users high and dry.

It's also worth pointing out that we have made a substantial number of
extensions and improvements to 0-9-1 - publisher confirms,
exchange-to-exchange bindings, nacks etc - thus it should be fairly
clear that we're more than happy to extend and improve the existing spec
to meet the needs of our users. This makes it even less likely that
0-9-1 will get abandoned in any way by Rabbit.

Matthew

From pbell at syncsort.com  Wed Jan 25 14:05:55 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Wed, 25 Jan 2012 09:05:55 -0500
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com><19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com><CAOn7oW-y1iUDxj5yvCPpH7nb0XU2=5zp6Lq8oisvB84UK5-7Sw@mail.g
	mail.com> <C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B404474FA@MAILCCR.us.syncsort.com>

Hello again,

I?m working my way through several recovery scenarios. I think we?ve established the following:


a.       If broker bounces, durable messages in the durable queue that have been consumed ? but not acked ? will be redelivered.

b.      Such redelivered messages will have the ?redelivered? flag set.

c.       If consumer bounces, both (a) and (b) still hold.

In re (a): is redelivery accomplished by placing another copy of the message in the queue (thus, two copies of same message are in the  queue ? one consumed but not acked, the other brand new); OR does the broker simply know that it?s OK to redeliver the original message?

In re (b): the redelivered flag seems to enable the creation of what Hohpe calls an ?idempotent receiver.? That is, the consumer can use this flag to decide how to dispose of the redelivered message. Consider a scenario wherein the consumers, all pulling from a single queue, dispatch the work to a lower layer service. If there are multiple consumer nodes (even multiple consumer threads), they will need some means of coordinating the disposition of the redelivered message. For example, NodeA consumes (but doesn?t ack) message 1. But it does dispatch the work represented by message 1 to a lower layer service. If the broker bounces and message 1 is redelivered, it might be consumed by NodeB. But the message 1 task is already in-flight on NodeA. So, depending on both the idempotency of the task and application specific functionality, NodeB might want to discard the redelivered message 1. Such intra-consumer/intra-consumer node coordination suggests that the first consumer of the message needs to record something, probably in the persistence layer, that says ?I?ve started this particular task (using a unique request ID). Does this seem right?

In re (c): does redelivery after consumer bounce work because the broker detects the loss of connection?

Please confirm, clarify, or correct as you see fit!

Thanks for your help.

-Paul

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Bell, Paul M.
Sent: Saturday, January 21, 2012 5:39 PM
To: Simone Busoli
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery

Thank you both.

-Paul

On Jan 21, 2012, at 5:24 PM, "Simone Busoli" <simone.busoli at gmail.com<mailto:simone.busoli at gmail.com>> wrote:

Also in case 2 the broker will redeliver all messages that were not acked, although it doesn't necessarily mean that the consumer didn't really consume them already. For that you should look at the redelivered flag.
On Jan 21, 2012 11:20 PM, "Bell, Paul M." <pbell at syncsort.com<mailto:pbell at syncsort.com>> wrote:
I apologize. I should have stated up front that the queues and messages are durable.

What happens in case 2, where the consumer bounces?

Thanks, Jason.

-Paul

________________________________________
From: Jason J. W. Williams [jasonjwwilliams at gmail.com<mailto:jasonjwwilliams at gmail.com>]
Sent: Saturday, January 21, 2012 5:05 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery

Hi Paul,

If the messages were published with the durable flag and the queues are durable, the messages will survive the broker restart and be re-presented to consumers. If the messages or the queues were not durable they will disappear after restart.

-J

Sent via iPhone

Is your email Premiere?

On Jan 21, 2012, at 14:57, "Bell, Paul M." <pbell at syncsort.com<mailto:pbell at syncsort.com>> wrote:

> Hi,
>
> Suppose I have a producer on NodeP, a broker on NodeB, and a consumer on NodeC. Suppose further that explicit acks are required (i.e., if I've understood the docs, that "noack" is not in effect) and that after consuming a message from the queue, NodeC.consumer dispatches some other work in order to process that message. IOW: NodeC.consumer doesn't respond immediately with an ack.
>
> So, from NodeB.broker's point of view, the message has been moved from the exchange to the queue, consumed, but not yet ack-ed.
>
> What will happen under these two scenarios:
>
> 1. NodeB.broker bounces - when broker restarts what will he do with un-acked messages that have been delivered to queue and haven't been ack-ed; e.g., will these be again delivered to the queue?
>
>
> 2. NodeC.consumer bounces - when consumer restarts is there any way he can again consume the un-acked message, and begin again the work that this message represents? (I suppose that NodeB.broker might be implicated here because it might detect the loss of connection to the NodeC.consumer....).
>
>
> When I say "bounces," I mean at a minimum that the application (broker, consumer) crashed and restarted. But I am also interested in the case where the node's OS is for whatever reason rebooted. Perhaps it looks no different.
>
> Thanks for your help.
>
> -Paul
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/8140bd90/attachment.htm>

From simon at rabbitmq.com  Wed Jan 25 14:21:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 14:21:21 +0000
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B404474FA@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com><19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com><CAOn7oW-y1iUDxj5yvCPpH7nb0XU2=5zp6Lq8oisvB84UK5-7Sw@mail.g	mail.com>
	<C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B404474FA@MAILCCR.us.syncsort.com>
Message-ID: <4F200FE1.5020600@rabbitmq.com>

On 25/01/12 14:05, Bell, Paul M. wrote:
> Hello again,
>
> I?m working my way through several recovery scenarios. I think we?ve
> established the following:
>
> a.If broker bounces, durable messages in the durable queue that have
> been consumed ? but not acked ? will be redelivered.
>
> b.Such redelivered messages will have the ?redelivered? flag set.
>
> c.If consumer bounces, both (a) and (b) still hold.
>
> In re (a): is redelivery accomplished by placing another copy of the
> message in the queue (thus, two copies of same message are in the  queue
> ? one consumed but not acked, the other brand new); OR does the broker
> simply know that it?s OK to redeliver the original message?

The broker just knows it's OK to redeliver the original message.

> In re (b): the redelivered flag seems to enable the creation of what
> Hohpe calls an ?idempotent receiver.? That is, the consumer can use this
> flag to decide how to dispose of the redelivered message. Consider a
> scenario wherein the consumers, all pulling from a single queue,
> dispatch the work to a lower layer service. If there are multiple
> consumer nodes (even multiple consumer threads), they will need some
> means of coordinating the disposition of the redelivered message. For
> example, NodeA consumes (but doesn?t ack) message 1. But it does
> dispatch the work represented by message 1 to a lower layer service. If
> the broker bounces and message 1 is redelivered, it might be consumed by
> NodeB. But the message 1 task is already in-flight on NodeA. So,
> depending on both the idempotency of the task and application specific
> functionality, NodeB might want to discard the redelivered message 1.
> Such intra-consumer/intra-consumer node coordination suggests that the
> first consumer of the message needs to record something, probably in the
> persistence layer, that says ?I?ve started this particular task (using a
> unique request ID). Does this seem right?

Yes, depending on what exactly your requirements are. The redelivered 
flag is there as an optimisation, so you don't have to check every message.

> In re (c): does redelivery after consumer bounce work because the broker
> detects the loss of connection?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 25 14:23:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 14:23:11 +0000
Subject: [rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)
In-Reply-To: <8fc9ce15-481d-42ab-8aab-0062443c1d3b@o4g2000pbc.googlegroups.com>
References: <8fc9ce15-481d-42ab-8aab-0062443c1d3b@o4g2000pbc.googlegroups.com>
Message-ID: <4F20104F.9010102@rabbitmq.com>

On 25/01/12 08:30, Yogesh Ketkar wrote:
> Any clues how to debug this?

That sounds odd. 10k messages should be nothing.

Can you share your code somehow so I can try to replicate this?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Wed Jan 25 14:42:53 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 25 Jan 2012 14:42:53 +0000
Subject: [rabbitmq-discuss] Sequential message processing guarantee
In-Reply-To: <c3ecab9a-2674-4c4e-bb8c-493d0d5e834e@pt5g2000pbb.googlegroups.com>
References: <a902e7e0-4157-4d51-8d6a-c9115d8ac1c0@m4g2000pbc.googlegroups.com>
	<20120123105135.GP3543@southbank.Home>
	<CAAdHZhq9pGKcv5AeF6xmKZ=iM_aN3C0iyrbN1LKPQ+XT=XdOxw@mail.gmail.com>
	<20120123144809.GU3543@southbank.Home>
	<7fdbb511-c8b4-45c7-aef7-adb6ba80ffdf@v6g2000pba.googlegroups.com>
	<20120123152213.GV3543@southbank.Home>
	<4400DD7F-0926-41AE-965A-3C5752A0A280@rabbitmq.com>
	<CAAdHZhoCSNvyfXYkFGbaQ0NyzZ_2X8SgF1Vk63GT9hJ3iitc+Q@mail.gmail.com>
	<c3ecab9a-2674-4c4e-bb8c-493d0d5e834e@pt5g2000pbb.googlegroups.com>
Message-ID: <63B7A33A-F252-4E77-BC1B-D16533EEFAEE@rabbitmq.com>

Not only more appropriate, but also more true :-)

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 24 Jan 2012, at 05:32, Yogesh Ketkar wrote:

>> Well, having more threads will help if same channel is going to be used to
>> consume messages from other queues.
> Actually more appropriate would be, having more threads will help if
> same Connection is going to be used
> with different channels.
> 
> On Jan 24, 10:29 am, Yogesh Ketkar <yogim... at gmail.com> wrote:
>> Hello Steve/Alex,
>> 
>> Thanks a lot for the help. It's pretty clear now.
>> So basically for a queue, as long as there is going to be only one
>> consumer, it hardly matters if ThreadPool with
>> com.rabbitmq.client.Connection underneath the channel has 1 thread or many
>> threads.
>> Well, having more threads will help if same channel is going to be used to
>> consume messages from other queues.
>> 
>> regards, Yogesh
>> 
>> 2012/1/23 Steve Powell <st... at rabbitmq.com>
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> Hi Yogesh,
>> 
>>> What Alex says is perfectly correct.
>> 
>>> The executor service is set on the connection, and is there to allow
>>> multiple
>>> channels to execute consumers simultaneously, and without blocking the
>>> channel
>>> thread. By default you get an executor service which has five threads.
>> 
>>> From the point of view of a single channel, the consumers are driven
>>> serially,
>>> one delivery at a time, upon one of the executor service threads. The same
>>> thread is not guaranteed to be used each time for each consumer call for a
>>> channel (so don't try to use ThreadLocal objects).
>> 
>>> The reason we provide this, is so that clients with many, many channels
>>> are not
>>> forced to have a Consumer thread per channel -- something that is quite
>>> expensive -- but have the option of allocating as many threads as they
>>> wish if
>>> they need it. At the same time we guarantee that no Consumer calls can
>>> 'overtake' each other on any one channel, and that Consumer processing
>>> runs on a
>>> distinct thread from the channel and the app, so that channel calls in the
>>> Consumer code will not deadlock.
>> 
>>> I hope this clarifies rather than obscures the situation,
>> 
>>> Regards,
>>> Steve Powell  (*a hoppy bunny*)
>>> *----------some more definitions from the SPD----------*
>>> *vermin* (*v.*) Treating the dachshund for roundworm.
>>> *chinchilla* (*n.*) Cooling device for the lower jaw.
>>> *socialcast* (*n.*) Someone to whom everyone is speaking but nobody likes.
>> 
>>> On 23 Jan 2012, at 15:22, Alexandru Scvor?ov wrote:
>> 
>>> Is my understanding correct?
>> 
>>> Almost.  Deliveries will happen serially on a channel, so, as long as you
>>> only have one consumer, everything should be fine.
>> 
>>> On Mon, Jan 23, 2012 at 06:54:15AM -0800, Yogesh Ketkar wrote:
>> 
>>> Hello Alex,
>> 
>>> I thought, using default Connection con = factory.newConnection(),
>> 
>>> ThreadPool which gets created will have more than one thread and
>> 
>>> calling basicConsume will result in processing of messages on multiple
>> 
>>> threads.
>> 
>>> But if we explicitly provide Executors.newSingleThreadExecutor() to
>> 
>>> newConnection method, only single thread will come into play with
>> 
>>> basicConsume.
>> 
>>> Is my understanding correct?
>> 
>>> regards, Yogesh
>> 
>>> On Jan 23, 7:48 pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
>> 
>>> Hi Yogesh,
>> 
>>> using channel.basicConsume on the channel which is created like this
>> 
>>> ExecutorService es = Executors.newSingleThreadExecutor();
>> 
>>> Connection connection = factory.newConnection(es);
>> 
>>> final Channel channel = connection.createChannel();
>> 
>>> is probably a better approach.
>> 
>>> Any comments on this?
>> 
>>> I don't quite see the point of the ExecutorService.
>> 
>>> Just doing this:
>> 
>>> Connection connection = factory.newConnection(es);
>> 
>>> final Channel channel = connection.createChannel();
>> 
>>> Then, calling basicConsume with your own subclass of DefaultConsumer
>> 
>>> should be fine.
>> 
>>> Cheers,
>> 
>>> Alex
>> 
>>> On Mon, Jan 23, 2012 at 08:08:37PM +0530, Yogesh Ketkar wrote:
>> 
>>> Thanks Alex.
>> 
>>> I think, for sequential message processing, rather than this pattern
>> 
>>> while(true) {
>> 
>>>     GetResponse res = channel.basicGet(QUEUE_NAME, false);
>> 
>>>     if(res != null) {
>> 
>>>         // process and ack message
>> 
>>>    }
>> 
>>> }
>> 
>>> using channel.basicConsume on the channel which is created like this
>> 
>>> ExecutorService es = Executors.newSingleThreadExecutor();
>> 
>>> Connection connection = factory.newConnection(es);
>> 
>>> final Channel channel = connection.createChannel();
>> 
>>> is probably a better approach.
>> 
>>> Any comments on this?
>> 
>>> regards, Yogesh
>> 
>>> 2012/1/23 Alexandru Scvor?ov <alexan... at rabbitmq.com>
>> 
>>> Hi Yogesh,
>> 
>>> In the absence of consumer failures, RabbitMQ will deliver messages from
>> 
>>> a queue in order.
>> 
>>> So, if messages 1, 2, 3 reach a queue in order, RabbitMQ will deliver
>> 
>>> them to consumers in the same order (1, 2, 3).
>> 
>>> But, if consumers fail before acknowledging the messages (or if they
>> 
>>> reject the messages), those messages will requeued at the end of the
>> 
>>> queue.  So, if the consumer that got message 1 rejects it, the new
>> 
>>> order of messages will be 2, 3, 1.
>> 
>>> This all deals with message *delivery*.
>> 
>>> There are multiple consumer threads consuming the messages.
>> 
>>> Though multiple threads are consuming the messages, I observed that
>> 
>>> messages still get processed sequentially.
>> 
>>> Is that the case and if NOT, what is the way to guarantee sequential
>> 
>>> processing of messages on one queue?
>> 
>>> The library makes no guarantees about the order in which you process
>> 
>>> messages, only about the order in which they're delivered.
>> 
>>> If you want to process all the messages on a queue in order, only
>> 
>>> consume from one thread (doing basic.get from one thread like you
>> 
>>> suggested in the other email would work, but would also be highly
>> 
>>> inefficient).
>> 
>>> Does this answer your question?
>> 
>>> Cheers,
>> 
>>> Alex
>> 
>>> On Sun, Jan 22, 2012 at 09:38:40AM -0800, Yogesh Ketkar wrote:
>> 
>>> Running the code below, gives
>> 
>>> channel.basicConsume(QUEUE_NAME, autoAck, CONSUMER_TAG,
>> 
>>>       new DefaultConsumer(channel)  {
>> 
>>>         @Override
>> 
>>>         public void handleDelivery(String consumerTag, Envelope
>> 
>>> envelope, BasicProperties properties, byte[] body) {
>> 
>>>                 System.out.println(Thread.currentThread().getName());
>> 
>>>          }
>> 
>>> }
>> 
>>> o/p like
>> 
>>> pool-1-thread-1
>> 
>>> pool-1-thread-2
>> 
>>> pool-1-thread-3
>> 
>>> etc
>> 
>>> There are multiple consumer threads consuming the messages.
>> 
>>> Though multiple threads are consuming the messages, I observed that
>> 
>>> messages still get processed sequentially.
>> 
>>> Is that the case and if NOT, what is the way to guarantee sequential
>> 
>>> processing of messages on one queue?
>> 
>>> regards, Yogesh
>> 
>>> _______________________________________________
>> 
>>> rabbitmq-discuss mailing list
>> 
>>> rabbitmq-disc... at lists.rabbitmq.com
>> 
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>>> _______________________________________________
>> 
>>> rabbitmq-discuss mailing list
>> 
>>> rabbitmq-disc... at lists.rabbitmq.comhttps://
>>> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>>> _______________________________________________
>> 
>>> rabbitmq-discuss mailing list
>> 
>>> rabbitmq-disc... at lists.rabbitmq.com
>> 
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/cec3dc74/attachment.htm>

From steve at rabbitmq.com  Wed Jan 25 14:49:33 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 25 Jan 2012 14:49:33 +0000
Subject: [rabbitmq-discuss] Java client blocked when opening channel
In-Reply-To: <loom.20120124T110944-591@post.gmane.org>
References: <20110223105638.11791vt2j7bhgb8g@webmail.active24.cz>
	<4D64DE19.9000906@rabbitmq.com>
	<loom.20120124T110944-591@post.gmane.org>
Message-ID: <11048E61-CF6C-4D97-B745-12E774C4CD1A@rabbitmq.com>

Guillaume,

Starting in 2.7.0, the threading model (for channels and Consumers) changed, so
I would expect the behaviour to be quite different now.

Have you tried upgrading to 2.7.1?

If you still experience the problem, some more information would be useful --
like a 'rabbitmqctl report' after the hang has taken place, and a thread stack
trace of the java app which is blocked, and so on.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 24 Jan 2012, at 10:13, Guillaume Perrot wrote:

> Matthias Radestock <matthias at ...> writes:
> 
>> 
>> Jiri,
>> 
>> On 23/02/11 09:56, Jiri Krutil wrote:
>>> One of our threads got stuck inside AMQConnection.createChannel() and
>>> would not return.
>>> [...]
>>> We are running RabbitMQ 2.1.0 (both server and Java client).
>> 
>> A fix for a bug with similar symptoms appeared in the 2.3.x Java client, 
>> so I suggest you upgrade the client to 2.3.1. Might as well upgrade the 
>> server at the same time, though that's not strictly necessary.
>> 
>> Matthias.
>> 
> 
> I have the same problem with v2.5.1
> createChannel does not have a timeout ?
> When the problem happens, consuming stops on already running 
> channels for this connection.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/125ab8d7/attachment.htm>

From eurie at rosettastone.com  Wed Jan 25 14:45:31 2012
From: eurie at rosettastone.com (Urie, Ethan)
Date: Wed, 25 Jan 2012 09:45:31 -0500
Subject: [rabbitmq-discuss] Publishing to or consuming from a node that's
	mirroring queues fails
Message-ID: <2475AAC4-5E03-4122-8834-F16449803658@rosettastone.com>

Hi all,
I'm attempting to set up a 2-node cluster with mirrored queues. I've tried it twice with different machines and have seen the same result.

My first attempt was with 2 Macs running 10.6.8 and Rabbit 2.7.1 with Erlang R15B.

I was able to successfully cluster the two machines, and verified that the queues were mirrored via the admin and rabbitmqctl. 

In my test, I had one exchange (fanout) with one queue that was declared with x-ha-policy = all. The exchange and queue were declared by a consumer connecting to node 1 after the nodes were clustered and both were running. 

Publishing and consuming work fine when connecting to node 1. However, if I connect to node 2, published messages don't show up in the queue and I get no error messages on the publisher or the logs. 

Connecting a consumer to node 2, however, causes the connection to error out. The following shows up in the logs:

=ERROR REPORT==== 25-Jan-2012::09:10:48 ===
** Generic server <0.29257.1> terminating
** Last message in was {'$gen_cast',
                          {method,
                              {'queue.declare',0,<<"RaiderAgent">>,false,
                                  true,false,false,false,
                                  [{<<"x-ha-policy">>,longstr,<<"all">>}]},
                              none}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.29253.1>,
                           <0.29255.1>,<0.29253.1>,
                           {token,<0.29256.1>,false},
                           none,1,
                           {[],[]},
                           {[],[]},
                           [],
                           {user,<<"sappy_development">>,[],
                               rabbit_auth_backend_internal,
                               {internal_user,<<"sappy_development">>,
                                   <<45,57,22,84,184,35,204,58,106,148,26,227,
                                     153,72,42,191,26,208,27,25>>,
                                   []}},
                           <<"/sappy_development">>,<<>>,
                           {dict,0,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 [],[]}}},
                           {dict,0,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 [],[]}}},
                           {set,0,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 [],[]}}},
                           {dict,0,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 [],[]}}},
                           <0.29251.1>,
                           {state,fine,5000,#Ref<0.0.0.38570>},
                           false,1,
                           {0,nil},
                           {0,nil},
                           [],[],none}
** Reason for termination == 
** {{case_clause,badarg},
   [{rabbit_channel,handle_method,3},
    {rabbit_channel,handle_cast,2},
    {gen_server2,handle_msg,2},
    {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 25-Jan-2012::09:10:48 ===
connection <0.29253.1>, channel 1 - error:
{{case_clause,badarg},
[{rabbit_channel,handle_method,3},
 {rabbit_channel,handle_cast,2},
 {gen_server2,handle_msg,2},
 {proc_lib,init_p_do_apply,3}]}

=WARNING REPORT==== 25-Jan-2012::09:10:48 ===
Non-AMQP exit reason '{{case_clause,badarg},
                      [{rabbit_channel,handle_method,3},
                       {rabbit_channel,handle_cast,2},
                       {gen_server2,handle_msg,2},
                       {proc_lib,init_p_do_apply,3}]}'


If I have messages in the queue, and stop rabbit on node 1, consumers can connect and consume fine from node 2.

My understanding of how the clustering is meant to work with mirroring is that a consumer may consume from a queue regardless of what node "owns" it and a producer may publish to any node in the cluster and the messages get routed to the proper queues. Is this understanding wrong? Or do I have something wrong in my set up?


Thanks in advance,
Ethan


From gperrot at ubikod.com  Wed Jan 25 14:53:55 2012
From: gperrot at ubikod.com (Guillaume PERROT)
Date: Wed, 25 Jan 2012 06:53:55 -0800 (PST)
Subject: [rabbitmq-discuss] Java client blocked when opening channel
In-Reply-To: <11048E61-CF6C-4D97-B745-12E774C4CD1A@rabbitmq.com>
References: <20110223105638.11791vt2j7bhgb8g@webmail.active24.cz>
	<4D64DE19.9000906@rabbitmq.com>
	<loom.20120124T110944-591@post.gmane.org>
	<11048E61-CF6C-4D97-B745-12E774C4CD1A@rabbitmq.com>
Message-ID: <bbf98d4b-05cf-4148-8a64-2169c1f78e3a@w4g2000vbc.googlegroups.com>

My bad, it was a deadlock caused by a thread blocking in
handleDelivery.
I can't upgrade now but I fixed my code by using an executor like in
the new version of the rabbitmq client.

On 25 jan, 15:49, Steve Powell <st... at rabbitmq.com> wrote:
> Guillaume,
>
> Starting in 2.7.0, the threading model (for channels and Consumers) changed, so
> I would expect the behaviour to be quite different now.
>
> Have you tried upgrading to 2.7.1?
>
> If you still experience the problem, some more information would be useful --
> like a 'rabbitmqctl report' after the hang has taken place, and a thread stack
> trace of the java app which is blocked, and so on.
>
> Steve Powell ?(a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 24 Jan 2012, at 10:13, Guillaume Perrot wrote:
>
>
>
>
>
>
>
> > Matthias Radestock <matthias at ...> writes:
>
> >> Jiri,
>
> >> On 23/02/11 09:56, Jiri Krutil wrote:
> >>> One of our threads got stuck inside AMQConnection.createChannel() and
> >>> would not return.
> >>> [...]
> >>> We are running RabbitMQ 2.1.0 (both server and Java client).
>
> >> A fix for a bug with similar symptoms appeared in the 2.3.x Java client,
> >> so I suggest you upgrade the client to 2.3.1. Might as well upgrade the
> >> server at the same time, though that's not strictly necessary.
>
> >> Matthias.
>
> > I have the same problem with v2.5.1
> > createChannel does not have a timeout ?
> > When the problem happens, consuming stops on already running
> > channels for this connection.
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From steve at rabbitmq.com  Wed Jan 25 15:11:04 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 25 Jan 2012 15:11:04 +0000
Subject: [rabbitmq-discuss] Management plugin calls bindings routing keys
In-Reply-To: <4F1E98E8.2020803@rabbitmq.com>
References: <2569406.2208.1327351068669.JavaMail.geo-discussion-forums@yqia35>
	<4F1E98E8.2020803@rabbitmq.com>
Message-ID: <CCB00AF3-FAD3-4F41-8EE5-1FA8EBC28438@rabbitmq.com>

David,

It may not be obvious, but what's happening here is that the bindings section
lists the bindings, ONE PER LINE.

Each binding is shown as the queue it binds, the routing key, and the arguments.
The columns are correctly labelled.

Does that help?

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 24 Jan 2012, at 11:41, Simon MacMullen wrote:

> On 23/01/12 20:37, David Stuebe wrote:
>> The web admin plugin is fantastic for development debugging, but some of
>> the dev team I work with are having a hard time because it seems like
>> the web UI is using the wrong name for bindings - it is calling them
>> routing keys.
> 
> Hi David.
> 
> Bindings have routing keys, but they also have arguments. In many cases the routing key is used and the arguments aren't - but not all, for example headers exchanges.
> 
> Does this make it clearer?
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/12dfd425/attachment.htm>

From simon at rabbitmq.com  Wed Jan 25 16:11:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 16:11:24 +0000
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures
 on	Queue Bind - 2012-01-20
In-Reply-To: <4F1EFA54.2000406@aol.com>
References: <4F19E73D.9080107@aol.com>
	<4F1D3CE1.6060701@rabbitmq.com>	<4F1DB931.4020501@aol.com>
	<4F1E9945.7060503@rabbitmq.com>	<4F1EE815.4010501@aol.com>
	<4F1EFA54.2000406@aol.com>
Message-ID: <4F2029AC.6010502@rabbitmq.com>

On 24/01/12 18:37, DawgTool wrote:
> What I was hoping to see that Cluster(002) would be about half the cpu
> consumption as Cluster(001).
> Or something like the scenario of publishing to a cluster on host 1 with
> the queue on host 2.
> Host 1 would take on the message handling from the publisher and hand it
> off to host 2 which writes to the queue (spreads the load across the
> cluster, but adds a little overhead).

Remember that when you publish across federation there is more than one 
publish involved! The federation plugin:

* Binds a queue to the upstream exchange
* Consumes messages from this queue
* Republishes them downstream

and then presumably something consumes them downstream too.

So there is more work going on. I'm surprised it's 4x though, but the 
federation plugin has not received any performance testing yet.

I'm also surprised both nodes in both clusters were equally busy - or 
does your test load balance across them?

> Please let me know if I have missed something, or if you can think of
> any tricks to reduce the cpu usage.

Have you turned on hipe_compile? That should help at least.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mpietrek at skytap.com  Wed Jan 25 16:33:49 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 25 Jan 2012 08:33:49 -0800
Subject: [rabbitmq-discuss] Determining if two clustered brokers are in
	sync
In-Reply-To: <4F1FE02B.8080107@rabbitmq.com>
References: <CB4457E6.2A02D%mpietrek@skytap.com>
	<4F1FE02B.8080107@rabbitmq.com>
Message-ID: <CACLE7iyot8pyAeSe=74NVVKoBdgB=u5NG7z-wQ-wdpquPYNHqg@mail.gmail.com>

Thanks so much Simon! These are very helpful and useful responses.

Regarding your prior replies, I'm somewhat embarrassed to say that I didn't
specifically check the list via the web. In my defense, all my prior posts
to rabbitmq-discuss had been replied to, and those replies came directly to
my company's gmail-based inbox. Just to be sure I didn't somehow overlook
your replies, I went back and searched gmail for all emails with
rabbitmq-discuss in them. I saw all messages from prior interactions, but
no reply from you. In any event, I'll make every effort to remember to
check the list's web page next time. :-)

Thanks again,

Matt

On Wed, Jan 25, 2012 at 2:57 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 24/01/12 20:43, Matt Pietrek wrote:
>
>> Just looking for some quick confirmation that I'm not trying to do the
>> impossible.
>>
>
> I answered your question twice before:
>
> http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
> 2012-January/017146.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017146.html>
>
> http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
> 2012-January/017155.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017155.html>
>
> Are you looking at the list? CCed in case you're not.
>
> Cheers, Simon
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/3e77b649/attachment.htm>

From simon at rabbitmq.com  Wed Jan 25 16:41:16 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 16:41:16 +0000
Subject: [rabbitmq-discuss] Determining if two clustered brokers are in
 sync
In-Reply-To: <CACLE7iyot8pyAeSe=74NVVKoBdgB=u5NG7z-wQ-wdpquPYNHqg@mail.gmail.com>
References: <CB4457E6.2A02D%mpietrek@skytap.com>	<4F1FE02B.8080107@rabbitmq.com>
	<CACLE7iyot8pyAeSe=74NVVKoBdgB=u5NG7z-wQ-wdpquPYNHqg@mail.gmail.com>
Message-ID: <4F2030AC.1040803@rabbitmq.com>

On 25/01/12 16:33, Matt Pietrek wrote:
> Regarding your prior replies, I'm somewhat embarrassed to say that I
> didn't specifically check the list via the web. In my defense, all my
> prior posts to rabbitmq-discuss had been replied to, and those replies
> came directly to my company's gmail-based inbox. Just to be sure I
> didn't somehow overlook your replies, I went back and searched gmail for
> all emails with rabbitmq-discuss in them. I saw all messages from prior
> interactions, but no reply from you. In any event, I'll make every
> effort to remember to check the list's web page next time. :-)

Hmm, you really shouldn't have to though if you're subscribed - are you 
in general getting rabbitmq-discuss mails?

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From dawgtool at aol.com  Wed Jan 25 16:56:48 2012
From: dawgtool at aol.com (DawgTool)
Date: Wed, 25 Jan 2012 11:56:48 -0500
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures
 on	Queue Bind - 2012-01-20
In-Reply-To: <4F2029AC.6010502@rabbitmq.com>
References: <4F19E73D.9080107@aol.com>
	<4F1D3CE1.6060701@rabbitmq.com>	<4F1DB931.4020501@aol.com>
	<4F1E9945.7060503@rabbitmq.com>	<4F1EE815.4010501@aol.com>
	<4F1EFA54.2000406@aol.com> <4F2029AC.6010502@rabbitmq.com>
Message-ID: <4F203450.7080409@aol.com>

Hi Simon,

Thanks for the details, I am no expert (greenish would be the word) in 
the internals of RabbitMQ.
I am running if HIPE:
   {rabbit,                    [{vm_memory_high_watermark, 0.6},
                                {collect_statistics_interval, 5000},
                                {hipe_compile, true}
                               ]
   },
   {mnesia,                    [{dc_dump_limit, 40},
                                {dump_log_write_threshold, 50000},
                                {send_compressed, 9},
                                {snmp, true}
                               ]
   },

SERVER_START_ARGS="+K true -smp enable"

I was also surprised on the performance numbers compared to other tests.
I downgraded both clusters to single nodes and still have the same 
percentages.
I'm tempted to start testing the shovel plugin (I need all messages to 
travel between sites),
but I really like the setup of Federation and the fail-over of the 
exchange (haven't tested
that yet, but assume it works. LOL).

Thanks



On 1/25/12 11:11 AM, Simon MacMullen wrote:
> On 24/01/12 18:37, DawgTool wrote:
>> What I was hoping to see that Cluster(002) would be about half the cpu
>> consumption as Cluster(001).
>> Or something like the scenario of publishing to a cluster on host 1 with
>> the queue on host 2.
>> Host 1 would take on the message handling from the publisher and hand it
>> off to host 2 which writes to the queue (spreads the load across the
>> cluster, but adds a little overhead).
>
> Remember that when you publish across federation there is more than 
> one publish involved! The federation plugin:
>
> * Binds a queue to the upstream exchange
> * Consumes messages from this queue
> * Republishes them downstream
>
> and then presumably something consumes them downstream too.
>
> So there is more work going on. I'm surprised it's 4x though, but the 
> federation plugin has not received any performance testing yet.
>
> I'm also surprised both nodes in both clusters were equally busy - or 
> does your test load balance across them?
>
>> Please let me know if I have missed something, or if you can think of
>> any tricks to reduce the cpu usage.
>
> Have you turned on hipe_compile? That should help at least.
>
> Cheers, Simon
>


From mpietrek at skytap.com  Wed Jan 25 17:37:12 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 25 Jan 2012 09:37:12 -0800
Subject: [rabbitmq-discuss] slave_nodes and synchronised_slave_nodes from
 HTTP API - Something's odd:
Message-ID: <CB457DC8.2A087%mpietrek@skytap.com>

Following on to an earlier thread
(http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017146.ht
ml) (Thanks Simon!), I've found something interesting.

I've modified my tool code to call rabbitmqadmin.py "list queues" using
"slave_nodes" and  "synchronised_slave_nodes" as suggested by SimonM, and it
mostly works as expected. (I'm using raw_json as output, for what it's
worth.)

In one case (the "VMMunger" queue below), the returned 'slave_nodes' field
is empty, while the 'synchronised_slave_nodes' field is 'rabbit at play2'. In
other words, exactly the *opposite* of what you'd expect if the queue was
not in sync. The strangeness is further corroborated by the copy/paste
results of the Queues tab in the Web management UI, which reports that the
VMMunger queue *is* in sync:

ConfigurationManager
<http://192.168.78.50:55672/#/queues/%2F/ConfigurationManager>   rabbit at play
+1      HA D   Idle 0 0 0
VMMunger <http://192.168.78.50:55672/#/queues/%2F/VMMunger>   rabbit at play +1
HA D   Idle 0 0 0
fake_configmgr <http://192.168.78.50:55672/#/queues/%2F/fake_configmgr>
rabbit at play +1      HA D   Idle 0 0 0
fake_munger_queue 
<http://192.168.78.50:55672/#/queues/%2F/fake_munger_queue>   rabbit at play +1
HA D   Idle 0 0 0
fake_service_2 <http://192.168.78.50:55672/#/queues/%2F/fake_service_2>
rabbit at play +1      HA D   Idle 0 0 0

The 'slave_nodes' and 'synchronised_slave_nodes' fields of the four other
queues as returned by "list queues" are exactly what I'd expect them to be,
and match up with the Web Mgmt UI.

Here's the returned JSON string, FWIW.

str: [
{"synchronised_slave_nodes":["rabbit at play2"],"messages":0,"slave_nodes":["ra
bbit at play2"],"name":" ConfigurationManager"},
{"synchronised_slave_nodes":["rabbit at play2"],"messages":0,"slave_nodes":[],"
name":"VMMunger"},
{"synchronised_slave_nodes":["rabbit at play2"],"messages":0,"slave_nodes":
["rabbit at play2"],"name":"fake_configmgr"},
{"synchronised_slave_nodes":["rabbit at play2"],"messages":0,"
slave_nodes":["rabbit at play2"],"name":"fake_munger_queue"},
{"synchronised_slave_nodes":
["rabbit at play2"],"messages":0,"slave_nodes":["rabbit at play2"],"name":"fake_se
rvice_2"}
]

Any ideas?

Thanks much,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/06c3f1fe/attachment.htm>

From simon at rabbitmq.com  Wed Jan 25 18:00:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 18:00:28 +0000
Subject: [rabbitmq-discuss] Publishing to or consuming from a node
 that's mirroring queues fails
In-Reply-To: <2475AAC4-5E03-4122-8834-F16449803658@rosettastone.com>
References: <2475AAC4-5E03-4122-8834-F16449803658@rosettastone.com>
Message-ID: <4F20433C.5040003@rabbitmq.com>

On 25/01/12 14:45, Urie, Ethan wrote:
> My understanding of how the clustering is meant to work with
> mirroring is that a consumer may consume from a queue regardless of
> what node "owns" it and a producer may publish to any node in the
> cluster and the messages get routed to the proper queues. Is this
> understanding wrong? Or do I have something wrong in my set up?

Yes, that's absolutely correct.

So the behaviour you are seeing does not make much sense, especially 
since it sounds like you are doing something very simple. I know this 
probably sounds very obvious but is it absolutely the case that you're 
using the same version of Erlang / RabbitMQ on each cluster node? Does 
any other error show up in the logs before this one?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Wed Jan 25 18:05:39 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 25 Jan 2012 18:05:39 +0000
Subject: [rabbitmq-discuss] Management plugin calls bindings routing keys
In-Reply-To: <CAAr1QLLLXp1vivOWVVsypto9fYb_Jof-w2Gfgjv_+0PPrG44RA@mail.gmail.com>
References: <2569406.2208.1327351068669.JavaMail.geo-discussion-forums@yqia35>
	<4F1E98E8.2020803@rabbitmq.com>
	<CCB00AF3-FAD3-4F41-8EE5-1FA8EBC28438@rabbitmq.com>
	<CAAr1QLLLXp1vivOWVVsypto9fYb_Jof-w2Gfgjv_+0PPrG44RA@mail.gmail.com>
Message-ID: <A6AAFF7C-7B2E-4667-A006-56F0DCB320BE@rabbitmq.com>

David,

Yes, the term binding-key is used in the tutorials, though this is not the term
used by the AMQP specification. Both on the bind Method, and the publish Method
the term used is routing-key. This is unfortunate, but, in general, it is
entirely correct.

The semantics of these keys is entirely up to the exchange. It happens to be the
case that topic exchanges use the bind routing-key as a 'pattern' to match
against the explicit routing-keys that publishers put on their messages.

However, there is no reason why one couldn't implement an exchange type
('cipot'?) where the bindings used explicit keys and the publisher published
with a pattern key. In general, the key on the publication and the keys on the
bindings are used collectively by the exchange to determine where to route the
message. They are both types of 'key' used to route the message.

On the other hand, I agree wholeheartedly that the bind verb ought to have
called it a binding key.

Steve Powell  (a lippy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 25 Jan 2012, at 16:54, David Stuebe wrote:

> 
> Hi Steve
> 
> That does make sense. And the content of each line is exactly what I would expect. Now that I understand the labels it is fine, but I am still troubled by the idea that the binding contains a routing key. For me, in a topic exchange, the routing key in the message header is a separate and distinct concept from the attribute of the binding that expresses the routing rule. To me it is analogous to an XML doc and an xpath query - two different things.
> 
> Sorry if I have made a mountain out of a mole hill - but the dev team on my project have had a tough time with the semantics of rabbitMQ/AMQP and the overloaded terms that we use in the pubsub model of our application. Calling both of those things 'routing key' was making the distinction more difficult.
> 
> David
> 
> 
> On Wed, Jan 25, 2012 at 10:11 AM, Steve Powell <steve at rabbitmq.com> wrote:
> David,
> 
> It may not be obvious, but what's happening here is that the bindings section
> lists the bindings, ONE PER LINE.
> 
> Each binding is shown as the queue it binds, the routing key, and the arguments.
> The columns are correctly labelled.
> 
> Does that help?
> 
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> 
> On 24 Jan 2012, at 11:41, Simon MacMullen wrote:
> 
>> On 23/01/12 20:37, David Stuebe wrote:
>>> The web admin plugin is fantastic for development debugging, but some of
>>> the dev team I work with are having a hard time because it seems like
>>> the web UI is using the wrong name for bindings - it is calling them
>>> routing keys.
>> 
>> Hi David.
>> 
>> Bindings have routing keys, but they also have arguments. In many cases the routing key is used and the arguments aren't - but not all, for example headers exchanges.
>> 
>> Does this make it clearer?
>> 
>> Cheers, Simon
>> 
>> -- 
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/e76c97ac/attachment.htm>

From simon at rabbitmq.com  Wed Jan 25 18:15:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 18:15:15 +0000
Subject: [rabbitmq-discuss] slave_nodes and synchronised_slave_nodes
 from HTTP API - Something's odd:
In-Reply-To: <CB457DC8.2A087%mpietrek@skytap.com>
References: <CB457DC8.2A087%mpietrek@skytap.com>
Message-ID: <4F2046B3.5010404@rabbitmq.com>

On 25/01/12 17:37, Matt Pietrek wrote:
> Following on to an earlier thread
> (http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017146.html)
> (Thanks Simon!), I've found something interesting.

Hmm...

> In one case (the "VMMunger" queue below), the returned 'slave_nodes'
> field is empty, while the 'synchronised_slave_nodes' field is
> 'rabbit at play2'. In other words, exactly the *opposite* of what you'd
> expect if the queue was not in sync. The strangeness is further
> corroborated by the copy/paste results of the Queues tab in the Web
> management UI, which reports that the VMMunger queue *is* in sync:

Well, the UI is just basing that on what it got from the HTTP API. In 
general synchronised_slave_nodes should be a subset of slave_nodes.

However the mgmt plugin gets the data from different sources, so you may 
have found a bug. What does rabbitmqctl show in this situation? (It goes 
via a different route.) Can you reproduce it?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 25 18:16:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Jan 2012 18:16:41 +0000
Subject: [rabbitmq-discuss] Federation Issues: Disconnects and Failures
 on	Queue Bind - 2012-01-20
In-Reply-To: <4F203450.7080409@aol.com>
References: <4F19E73D.9080107@aol.com>	<4F1D3CE1.6060701@rabbitmq.com>	<4F1DB931.4020501@aol.com>	<4F1E9945.7060503@rabbitmq.com>	<4F1EE815.4010501@aol.com>	<4F1EFA54.2000406@aol.com>
	<4F2029AC.6010502@rabbitmq.com> <4F203450.7080409@aol.com>
Message-ID: <4F204709.3030808@rabbitmq.com>

On 25/01/12 16:56, DawgTool wrote:
> I was also surprised on the performance numbers compared to other tests.
> I downgraded both clusters to single nodes and still have the same
> percentages.

Hmm. That is odd. I don't think there's been any performance testing of 
federation + clustering yet; I'll have to do some at some point.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Jan 25 18:31:31 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Jan 2012 18:31:31 +0000
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
 related to workload distribution
In-Reply-To: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>
References: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>
Message-ID: <4F204A83.5020803@rabbitmq.com>


Hi Josh,

On 24/01/12 23:39, Josh Stone wrote:
> We're looking at using rabbitmq with the consistent hash exchange to
> distribute workload to a set of workers with each worker subscribing
> to one or more topics. It looks like this will work well, until a
> worker along with its topics either comes or leaves, which will
> disrupt the hashing.

Keep in mind that when binding a queue to a consistent hash exchange you
don't bind with a topic. You bind with a number that indicates what
share of messages the queue will receive. Those messages can have any
routing key. If you want workers to handle only particular topics then
you should use a topic exchange.

> Particularly, if a new worker enters and creates some topics on the
> exchange, messages that previously would have been delivered to
> another topic will be directed to the new topic. And if an existing
> worker was operating on some data from a previous message and a new
> message to operate on that data is sent to a new topic, we could have
> a race condition.

For the consistent hash exchange some keys will be unavoidably be
remapped when the bindings change. The advantage is that not all keys
need to be remapped. If your workers can only deal with one or a limited
number of topics then you should not be using a consistent hash exchange.




-Emile

From fearsome.lucidity at gmail.com  Wed Jan 25 18:44:07 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Wed, 25 Jan 2012 10:44:07 -0800
Subject: [rabbitmq-discuss] RabbitMQ/Shovel & Compression
Message-ID: <CAFDmHdPLnZNBcdvunyx7KfM=db7wt-h84t+r0Z014Ao642VZpA@mail.gmail.com>

On Wed, Jan 25, 2012 at 4:00 AM, <
rabbitmq-discuss-request at lists.rabbitmq.com> wrote:

>
> It would be a nice feature, but pretty low priority TBH.
>

You should be able to do this already, out of the box, presuming that the
Erlang SSL library supports it.


> Set up a compressed SSH tunnel? Or if the overhead of encryption is too
> great, hook up netcat and gzip in front of Rabbit?
>

Instead of using SSH, you could use the built-in SSL functionality. If
SSLv2 is disabled and both the client and server are compiled against zlib,
then OpenSSL should negociate compression, and if you select a cipher with
no encryption or authentication, you can avoid the crypto overhead.

Don't know enough about the Erlang ssl library to know how you'd go about
specifying what cipher it should use.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/b59b9d7e/attachment.htm>

From pacesysjosh at gmail.com  Wed Jan 25 19:33:41 2012
From: pacesysjosh at gmail.com (Josh Stone)
Date: Wed, 25 Jan 2012 11:33:41 -0800 (PST)
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
	related to workload distribution
In-Reply-To: <4F204A83.5020803@rabbitmq.com>
References: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>
	<4F204A83.5020803@rabbitmq.com>
Message-ID: <e3ab17d5-9f76-490e-b12d-5b0073dfa0d6@i18g2000yqf.googlegroups.com>

Thanks for the response Emile,

Key remapping is ok and expected. I'm just curious how users deal with
that when using the consistent hash exchange to distribute work. Do
you have any insight into what those strategies might look like?

Cheers,
Josh

On Jan 25, 10:31?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Josh,
>
> On 24/01/12 23:39, Josh Stone wrote:
>
> > We're looking at using rabbitmq with the consistent hash exchange to
> > distribute workload to a set of workers with each worker subscribing
> > to one or more topics. It looks like this will work well, until a
> > worker along with its topics either comes or leaves, which will
> > disrupt the hashing.
>
> Keep in mind that when binding a queue to a consistent hash exchange you
> don't bind with a topic. You bind with a number that indicates what
> share of messages the queue will receive. Those messages can have any
> routing key. If you want workers to handle only particular topics then
> you should use a topic exchange.
>
> > Particularly, if a new worker enters and creates some topics on the
> > exchange, messages that previously would have been delivered to
> > another topic will be directed to the new topic. And if an existing
> > worker was operating on some data from a previous message and a new
> > message to operate on that data is sent to a new topic, we could have
> > a race condition.
>
> For the consistent hash exchange some keys will be unavoidably be
> remapped when the bindings change. The advantage is that not all keys
> need to be remapped. If your workers can only deal with one or a limited
> number of topics then you should not be using a consistent hash exchange.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Wed Jan 25 19:49:45 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 25 Jan 2012 11:49:45 -0800
Subject: [rabbitmq-discuss] Determining if two clustered brokers are in
 sync
In-Reply-To: <4F2030AC.1040803@rabbitmq.com>
Message-ID: <CB459C52.2A0B3%mpietrek@skytap.com>

As far as I recall, I don't remember subscribing to the list, although
it's possible.

On 1/25/12 8:41 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 25/01/12 16:33, Matt Pietrek wrote:
>> Regarding your prior replies, I'm somewhat embarrassed to say that I
>> didn't specifically check the list via the web. In my defense, all my
>> prior posts to rabbitmq-discuss had been replied to, and those replies
>> came directly to my company's gmail-based inbox. Just to be sure I
>> didn't somehow overlook your replies, I went back and searched gmail for
>> all emails with rabbitmq-discuss in them. I saw all messages from prior
>> interactions, but no reply from you. In any event, I'll make every
>> effort to remember to check the list's web page next time. :-)
>
>Hmm, you really shouldn't have to though if you're subscribed - are you
>in general getting rabbitmq-discuss mails?
>
>Cheers, Simon
>-- 
>Simon MacMullen
>RabbitMQ, VMware



From alexx.todorov at gmail.com  Wed Jan 25 20:22:18 2012
From: alexx.todorov at gmail.com (Alexander Todorov)
Date: Wed, 25 Jan 2012 22:22:18 +0200
Subject: [rabbitmq-discuss] Install RabbitMQ 2.6.1 on Amazon Linux
Message-ID: <4F20647A.8020003@gmail.com>

Hi guys,
I've read this:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/015326.html

and the corresponding Amazon Forums thread. I don't like pointing my distros at 
3rd party repositories which don't guarantee any level of compatibility and 
building all the dependencies is hell. If there were less dependencies I would 
be happy to maintain them myself.



My question is what are the exact dependencies for RabbitMQ server ? I don't 
think it will ever need wxGTK or friends for example.

If you can point me at which erlang packages are actually needed by RabbitMQ or 
a way I can extract the info I will make a patch to the spec file and test the 
resulting package on Amazon Linux and on RHEL.

Regards,
Alex.

From pbell at syncsort.com  Wed Jan 25 20:25:20 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Wed, 25 Jan 2012 15:25:20 -0500
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <4F200FE1.5020600@rabbitmq.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com><19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com><CAOn7oW-y1iUDxj5yvCPpH7nb0XU2=5zp6Lq8oisvB84UK5-7Sw@mail.g
	mail.com><C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com><AF4AD4ADFB23054CB4C75F50FF8C40B73B404474FA@MAILCCR.us.syncsort.com
	> <4F200FE1.5020600@rabbitmq.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044755E@MAILCCR.us.syncsort.com>

Thank you, Simon.

-Paul

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Wednesday, January 25, 2012 9:21 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery

On 25/01/12 14:05, Bell, Paul M. wrote:
> Hello again,
>
> I?m working my way through several recovery scenarios. I think we?ve
> established the following:
>
> a.If broker bounces, durable messages in the durable queue that have
> been consumed ? but not acked ? will be redelivered.
>
> b.Such redelivered messages will have the ?redelivered? flag set.
>
> c.If consumer bounces, both (a) and (b) still hold.
>
> In re (a): is redelivery accomplished by placing another copy of the
> message in the queue (thus, two copies of same message are in the  queue
> ? one consumed but not acked, the other brand new); OR does the broker
> simply know that it?s OK to redeliver the original message?

The broker just knows it's OK to redeliver the original message.

> In re (b): the redelivered flag seems to enable the creation of what
> Hohpe calls an ?idempotent receiver.? That is, the consumer can use this
> flag to decide how to dispose of the redelivered message. Consider a
> scenario wherein the consumers, all pulling from a single queue,
> dispatch the work to a lower layer service. If there are multiple
> consumer nodes (even multiple consumer threads), they will need some
> means of coordinating the disposition of the redelivered message. For
> example, NodeA consumes (but doesn?t ack) message 1. But it does
> dispatch the work represented by message 1 to a lower layer service. If
> the broker bounces and message 1 is redelivered, it might be consumed by
> NodeB. But the message 1 task is already in-flight on NodeA. So,
> depending on both the idempotency of the task and application specific
> functionality, NodeB might want to discard the redelivered message 1.
> Such intra-consumer/intra-consumer node coordination suggests that the
> first consumer of the message needs to record something, probably in the
> persistence layer, that says ?I?ve started this particular task (using a
> unique request ID). Does this seem right?

Yes, depending on what exactly your requirements are. The redelivered
flag is there as an optimisation, so you don't have to check every message.

> In re (c): does redelivery after consumer bounce work because the broker
> detects the loss of connection?

Yes.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From pacesysjosh at gmail.com  Wed Jan 25 21:29:35 2012
From: pacesysjosh at gmail.com (Josh Stone)
Date: Wed, 25 Jan 2012 13:29:35 -0800 (PST)
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
	related to workload distribution
In-Reply-To: <4F204A83.5020803@rabbitmq.com>
References: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>
	<4F204A83.5020803@rabbitmq.com>
Message-ID: <7356781e-69fa-4616-bb3a-5e446aacc801@j15g2000yqb.googlegroups.com>

Hi Emile -

A followup question. When a new queue is created and a key-remapping
occurs, is there any way I could learn which keys were re-mapped? This
would allow me to migrate and data/work corresponding to those keys.
Perhaps a message could be published to a common queue indicating
which keys were re-mapped.

Cheers,
Josh

On Jan 25, 10:31?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Josh,
>
> On 24/01/12 23:39, Josh Stone wrote:
>
> > We're looking at using rabbitmq with the consistent hash exchange to
> > distribute workload to a set of workers with each worker subscribing
> > to one or more topics. It looks like this will work well, until a
> > worker along with its topics either comes or leaves, which will
> > disrupt the hashing.
>
> Keep in mind that when binding a queue to a consistent hash exchange you
> don't bind with a topic. You bind with a number that indicates what
> share of messages the queue will receive. Those messages can have any
> routing key. If you want workers to handle only particular topics then
> you should use a topic exchange.
>
> > Particularly, if a new worker enters and creates some topics on the
> > exchange, messages that previously would have been delivered to
> > another topic will be directed to the new topic. And if an existing
> > worker was operating on some data from a previous message and a new
> > message to operate on that data is sent to a new topic, we could have
> > a race condition.
>
> For the consistent hash exchange some keys will be unavoidably be
> remapped when the bindings change. The advantage is that not all keys
> need to be remapped. If your workers can only deal with one or a limited
> number of topics then you should not be using a consistent hash exchange.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Wed Jan 25 22:21:38 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 25 Jan 2012 23:21:38 +0100
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <20120125115052.GA16645@rabbitmq.com>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
	<4EE8B5FC.6020709@rabbitmq.com>
	<5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>
	<4F1EEDB1.5040007@rabbitmq.com>
	<CAOn7oW9Z+T+pS92c5646uZO6rt9BfomDa4xHaZSTnMAZG29-WQ@mail.gmail.com>
	<4F1FE793.1080607@rabbitmq.com> <20120125115052.GA16645@rabbitmq.com>
Message-ID: <CAOn7oW88WK6EFJzSW8pt3ikyhA=gdfWQBOgUpY+rBjg+=WGOYg@mail.gmail.com>

Hi Simon, Matthew,

let me clarify that I wasn't trying to imply that work on 0-9-1 would be
abandoned in case of success of 1.0, but I think it's fair to assume that
in case the latter happens, assuming the same quantity of resources, effort
currently being expended on 0-9-1 would be partially stolen away by the
work on 1.0. In my opinion users who are not planning to "upgrade" anytime
soon would legitimately perceive it as less effort being dedicated to the
product on which they have invested. But I'd be glad to be proven wrong.

On Wed, Jan 25, 2012 at 12:50, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Wed, Jan 25, 2012 at 11:29:23AM +0000, Simon MacMullen wrote:
> > On 24/01/12 21:34, Simone Busoli wrote:
> > >That's a bit worrying to think that development on 0-9-1 might be halted
> > >in case of take off of 1.0, considering the effort you might have put on
> > >developing something to target the current version.
> >
> > Obviously I can't predict the future, but you *really* should not
> > worry that we're going to leave all our 0-9-1 users high and dry.
>
> It's also worth pointing out that we have made a substantial number of
> extensions and improvements to 0-9-1 - publisher confirms,
> exchange-to-exchange bindings, nacks etc - thus it should be fairly
> clear that we're more than happy to extend and improve the existing spec
> to meet the needs of our users. This makes it even less likely that
> 0-9-1 will get abandoned in any way by Rabbit.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/bb16b5e1/attachment.htm>

From simone.busoli at gmail.com  Wed Jan 25 22:41:14 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 25 Jan 2012 23:41:14 +0100
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B404474FA@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>
	<19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com>
	<C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B404474FA@MAILCCR.us.syncsort.com>
Message-ID: <CAOn7oW8AGhZyn0=qwqo6WxWdBHPdkUX-7jFFKG6Xb6556QhM9w@mail.gmail.com>

Hi Paul, I'll throw my 2c too

On Wed, Jan 25, 2012 at 15:05, Bell, Paul M. <pbell at syncsort.com> wrote:

> Hello again,****
>
> ** **
>
> I?m working my way through several recovery scenarios. I think we?ve
> established the following:****
>
> ** **
>
> **a.       **If broker bounces, durable messages in the durable queue
> that have been consumed ? but not acked ? will be redelivered. ****
>
> **b.      **Such redelivered messages will have the ?redelivered? flag
> set.****
>
> **c.       **If consumer bounces, both (a) and (b) still hold. ****
>
> ** **
>
> In re (a): is redelivery accomplished by placing another copy of the
> message in the queue (thus, two copies of same message are in the  queue ?
> one consumed but not acked, the other brand new); OR does the broker simply
> know that it?s OK to redeliver the original message?****
>
> ** **
>
> In re (b): the redelivered flag seems to enable the creation of what Hohpe
> calls an ?idempotent receiver.? That is, the consumer can use this flag to
> decide how to dispose of the redelivered message. Consider a scenario
> wherein the consumers, all pulling from a single queue, dispatch the work
> to a lower layer service. If there are multiple consumer nodes (even
> multiple consumer threads), they will need some means of coordinating the
> disposition of the redelivered message. For example, NodeA consumes (but
> doesn?t ack) message 1. But it does dispatch the work represented by
> message 1 to a lower layer service. If the broker bounces and message 1 is
> redelivered, it might be consumed by NodeB. But the message 1 task is
> already in-flight on NodeA. So, depending on both the idempotency of the
> task and application specific functionality, NodeB might want to discard
> the redelivered message 1. Such intra-consumer/intra-consumer node
> coordination suggests that the first consumer of the message needs to
> record something, probably in the persistence layer, that says ?I?ve
> started this particular task (using a unique request ID). Does this seem
> right?
>

Yes, according to my experience message deduplication is something that you
need to carry out at the application level as it depends on how you consume
your messages within your application. The broker is only able to make sure
that messages reached a consumer in the application, what the application
does with the messages is completely up to the application itself.


> ****
>
> ** **
>
> In re (c): does redelivery after consumer bounce work because the broker
> detects the loss of connection?
>

That's just one of the scenarios in which messages are redelivered. Take
this with a grain of salt as I'm not completely sure of all the cases in
which this happens with these exact semantics but in general whenever
messages are not acked and, loosely speaking, a consumer goes away and a
new one comes on the same queue, those messages will be redelivered.

Off the top of my mind:

   - connection consumer-broker bounces
   - broker bounces (with durable ex and queues and persistent messages)
   - consumer is cancelled and another basic consume is issued
   - consumer channel is closed an another channel with a new consumer on
   the same queue is created
   - consumer issues a recover command to the broker
   - consumer rejects or nacks messages with requeue flag



>
> ****
>
> Please confirm, clarify, or correct as you see fit!****
>
> ** **
>
> Thanks for your help.****
>
> ** **
>
> -Paul****
>
> ** **
>
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Bell, Paul M.
> *Sent:* Saturday, January 21, 2012 5:39 PM
> *To:* Simone Busoli
>
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery****
>
> ** **
>
> Thank you both.****
>
> ** **
>
> -Paul
>
> On Jan 21, 2012, at 5:24 PM, "Simone Busoli" <simone.busoli at gmail.com>
> wrote:****
>
> Also in case 2 the broker will redeliver all messages that were not acked,
> although it doesn't necessarily mean that the consumer didn't really
> consume them already. For that you should look at the redelivered flag.***
> *
>
> On Jan 21, 2012 11:20 PM, "Bell, Paul M." <pbell at syncsort.com> wrote:****
>
> I apologize. I should have stated up front that the queues and messages
> are durable.
>
> What happens in case 2, where the consumer bounces?
>
> Thanks, Jason.
>
> -Paul
>
> ________________________________________
> From: Jason J. W. Williams [jasonjwwilliams at gmail.com]
> Sent: Saturday, January 21, 2012 5:05 PM
> To: Bell, Paul M.
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
>
> Hi Paul,
>
> If the messages were published with the durable flag and the queues are
> durable, the messages will survive the broker restart and be re-presented
> to consumers. If the messages or the queues were not durable they will
> disappear after restart.
>
> -J
>
> Sent via iPhone
>
> Is your email Premiere?
>
> On Jan 21, 2012, at 14:57, "Bell, Paul M." <pbell at syncsort.com> wrote:
>
> > Hi,
> >
> > Suppose I have a producer on NodeP, a broker on NodeB, and a consumer on
> NodeC. Suppose further that explicit acks are required (i.e., if I've
> understood the docs, that "noack" is not in effect) and that after
> consuming a message from the queue, NodeC.consumer dispatches some other
> work in order to process that message. IOW: NodeC.consumer doesn't respond
> immediately with an ack.
> >
> > So, from NodeB.broker's point of view, the message has been moved from
> the exchange to the queue, consumed, but not yet ack-ed.
> >
> > What will happen under these two scenarios:
> >
> > 1. NodeB.broker bounces - when broker restarts what will he do with
> un-acked messages that have been delivered to queue and haven't been
> ack-ed; e.g., will these be again delivered to the queue?
> >
> >
> > 2. NodeC.consumer bounces - when consumer restarts is there any way he
> can again consume the un-acked message, and begin again the work that this
> message represents? (I suppose that NodeB.broker might be implicated here
> because it might detect the loss of connection to the NodeC.consumer....).
> >
> >
> > When I say "bounces," I mean at a minimum that the application (broker,
> consumer) crashed and restarted. But I am also interested in the case where
> the node's OS is for whatever reason rebooted. Perhaps it looks no
> different.
> >
> > Thanks for your help.
> >
> > -Paul
> >
> >
> >
> > ATTENTION: -----
> >
> > The information contained in this message (including any files
> transmitted with this message) may contain proprietary, trade secret or
> other  confidential and/or legally privileged information. Any pricing
> information contained in this message or in any files transmitted with this
> message is always confidential and cannot be shared with any third parties
> without prior written approval from Syncsort. This message is intended to
> be read only by the individual or entity to whom it is addressed or by
> their designee. If the reader of this message is not the intended
> recipient, you are on notice that any use, disclosure, copying or
> distribution of this message, in any form, is strictly prohibited. If you
> have received this message in error, please immediately notify the sender
> and/or Syncsort and destroy all copies of this message in your possession,
> custody or control.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/357e7360/attachment.htm>

From matthew at rabbitmq.com  Wed Jan 25 23:33:41 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 25 Jan 2012 23:33:41 +0000
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
 related to workload distribution
In-Reply-To: <7356781e-69fa-4616-bb3a-5e446aacc801@j15g2000yqb.googlegroups.com>
References: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>
	<4F204A83.5020803@rabbitmq.com>
	<7356781e-69fa-4616-bb3a-5e446aacc801@j15g2000yqb.googlegroups.com>
Message-ID: <20120125233340.GA17447@wellquite.org>

On Wed, Jan 25, 2012 at 01:29:35PM -0800, Josh Stone wrote:
> A followup question. When a new queue is created and a key-remapping
> occurs, is there any way I could learn which keys were re-mapped? This
> would allow me to migrate and data/work corresponding to those keys.
> Perhaps a message could be published to a common queue indicating
> which keys were re-mapped.

The binding (and thus queue) selected by the consistent hash exachange
is selected by hashing the message's routing key, and then finding the
nearest higher binding. Given an infinite number of routing keys will
hash to the same result, no such message could be constructed to say
which routing keys have been remapped. The best you could do would be to
somehow keep track of every routing key the exchange has ever seen, and
from that figure out which of those would have been routed differently
in light of the additional-or-loss-of queue/binding. That also isn't
feasible.

In general, you should probably assume you have relatively little churn
off such an exchange, and thus if a worker does see a message with a
routing key it's not expected (caused by eg loss of a queue) then
propogate the error further up and restart the corresponding session on
the publishing side so that the entire set of messages with that routing
key get resent.

Matthew

From matthew at rabbitmq.com  Wed Jan 25 23:35:17 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 25 Jan 2012 23:35:17 +0000
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <CAOn7oW88WK6EFJzSW8pt3ikyhA=gdfWQBOgUpY+rBjg+=WGOYg@mail.gmail.com>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
	<4EE8B5FC.6020709@rabbitmq.com>
	<5b90aa72-183f-4f12-ba01-c65ebf47e9fa@dp8g2000vbb.googlegroups.com>
	<4F1EEDB1.5040007@rabbitmq.com>
	<CAOn7oW9Z+T+pS92c5646uZO6rt9BfomDa4xHaZSTnMAZG29-WQ@mail.gmail.com>
	<4F1FE793.1080607@rabbitmq.com>
	<20120125115052.GA16645@rabbitmq.com>
	<CAOn7oW88WK6EFJzSW8pt3ikyhA=gdfWQBOgUpY+rBjg+=WGOYg@mail.gmail.com>
Message-ID: <20120125233517.GB17447@wellquite.org>

On Wed, Jan 25, 2012 at 11:21:38PM +0100, Simone Busoli wrote:
> let me clarify that I wasn't trying to imply that work on 0-9-1 would be
> abandoned in case of success of 1.0, but I think it's fair to assume that
> in case the latter happens, assuming the same quantity of resources, effort
> currently being expended on 0-9-1 would be partially stolen away by the
> work on 1.0. In my opinion users who are not planning to "upgrade" anytime
> soon would legitimately perceive it as less effort being dedicated to the
> product on which they have invested.

Indeed. If 1.0 shows any sign of being a success then I'm sure it'll be
made clear to all how we're dividing our time and to what purpose.

Matthew

From pacesysjosh at gmail.com  Wed Jan 25 23:47:35 2012
From: pacesysjosh at gmail.com (Josh Stone)
Date: Wed, 25 Jan 2012 15:47:35 -0800 (PST)
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
	related to workload distribution
In-Reply-To: <20120125233340.GA17447@wellquite.org>
References: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>
	<4F204A83.5020803@rabbitmq.com>
	<7356781e-69fa-4616-bb3a-5e446aacc801@j15g2000yqb.googlegroups.com>
	<20120125233340.GA17447@wellquite.org>
Message-ID: <94c214ac-239b-4de0-87f9-0fcada595db9@18g2000yqe.googlegroups.com>

Matthew - That is very true about the hash keys.

Regarding workers seeing a message with a routing key they're not
expecting, I'm not sure how a worker would know if a message is
acceptable for them without knowing what the hash ring looks like. If
our workers did mirror the hash algorithm, when a re-mapping occurred
they could check locally to see what work was effected. This brings us
closer to something like Dynamo where each node maintains a view of
the hash ring. In our case, each worker's view of the hash ring would
match that on the consistent hash exchange. This is likely the only
way they could handle key-remappings.

Has anyone gone down this road?

Josh

On Jan 25, 3:33?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Wed, Jan 25, 2012 at 01:29:35PM -0800, Josh Stone wrote:
> > A followup question. When a new queue is created and a key-remapping
> > occurs, is there any way I could learn which keys were re-mapped? This
> > would allow me to migrate and data/work corresponding to those keys.
> > Perhaps a message could be published to a common queue indicating
> > which keys were re-mapped.
>
> The binding (and thus queue) selected by the consistent hash exachange
> is selected by hashing the message's routing key, and then finding the
> nearest higher binding. Given an infinite number of routing keys will
> hash to the same result, no such message could be constructed to say
> which routing keys have been remapped. The best you could do would be to
> somehow keep track of every routing key the exchange has ever seen, and
> from that figure out which of those would have been routed differently
> in light of the additional-or-loss-of queue/binding. That also isn't
> feasible.
>
> In general, you should probably assume you have relatively little churn
> off such an exchange, and thus if a worker does see a message with a
> routing key it's not expected (caused by eg loss of a queue) then
> propogate the error further up and restart the corresponding session on
> the publishing side so that the entire set of messages with that routing
> key get resent.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Wes_Smith at echopass.com  Thu Jan 26 00:23:07 2012
From: Wes_Smith at echopass.com (Wes Smith)
Date: Wed, 25 Jan 2012 17:23:07 -0700
Subject: [rabbitmq-discuss] Archetecture for multi-datacenters
Message-ID: <094044328C95D248A8E9678F35A6ACB54463C847F7@SLC-MAILBOX.echopass.com>

Situation:
Each RabbitMQ cluster has multiple nodes (2). My platform I'm working with has 2 datacenters each with a RabbitMQ cluster. I need to configure RabbitMQ such that any message published to any exchange on any node can be consumed by a queue on either cluster.


From emile at rabbitmq.com  Thu Jan 26 00:28:38 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jan 2012 00:28:38 +0000
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
 related to workload distribution
In-Reply-To: <94c214ac-239b-4de0-87f9-0fcada595db9@18g2000yqe.googlegroups.com>
References: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>
	<4F204A83.5020803@rabbitmq.com>
	<7356781e-69fa-4616-bb3a-5e446aacc801@j15g2000yqb.googlegroups.com>
	<20120125233340.GA17447@wellquite.org>
	<94c214ac-239b-4de0-87f9-0fcada595db9@18g2000yqe.googlegroups.com>
Message-ID: <4F209E36.3030504@rabbitmq.com>

Hi Josh,

On 25/01/12 23:47, Josh Stone wrote:
> Regarding workers seeing a message with a routing key they're not
> expecting, I'm not sure how a worker would know if a message is
> acceptable for them without knowing what the hash ring looks like. If
> our workers did mirror the hash algorithm, when a re-mapping occurred
> they could check locally to see what work was effected. This brings us
> closer to something like Dynamo where each node maintains a view of
> the hash ring. In our case, each worker's view of the hash ring would
> match that on the consistent hash exchange. This is likely the only
> way they could handle key-remappings.
> 
> Has anyone gone down this road?

I doubt it, because the consistent hash exchange uses a random number
generator to ensure a fair distribution among all the bindings. What you
are proposing will require workers to have access to the same random
number stream and therefore infeasible.

If you share more details about the problem you are trying to solve then
we may be able to make alternative suggestions. Is there any reason why
your problem cannot be solved by having multiple workers subscribe to
the same queue and sharing the load in that way?



-Emile

From pbell at syncsort.com  Thu Jan 26 01:50:52 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Wed, 25 Jan 2012 20:50:52 -0500
Subject: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery
In-Reply-To: <CAOn7oW8AGhZyn0=qwqo6WxWdBHPdkUX-7jFFKG6Xb6556QhM9w@mail.gmail.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C3@MAILCCR.us.syncsort.com>
	<19E62ECA-F80B-47F8-9F52-A9A263A714DF@gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1C4@MAILCCR.us.syncsort.com>
	<C4EB8552-CC3C-4FE9-9FF9-EBE3834DBA68@syncsort.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B404474FA@MAILCCR.us.syncsort.com>
	<CAOn7oW8AGhZyn0=qwqo6WxWdBHPdkUX-7jFFKG6Xb6556QhM9w@mail.gmail.com>
Message-ID: <8DC7AC48-8AC6-4683-89B6-A1E80FB257E1@syncsort.com>

Hi Simone,

Most helpful. :)

Thank you much.

-Paul

On Jan 25, 2012, at 5:42 PM, "Simone Busoli" <simone.busoli at gmail.com<mailto:simone.busoli at gmail.com>> wrote:

Hi Paul, I'll throw my 2c too

On Wed, Jan 25, 2012 at 15:05, Bell, Paul M. <<mailto:pbell at syncsort.com>pbell at syncsort.com<mailto:pbell at syncsort.com>> wrote:
Hello again,

I?m working my way through several recovery scenarios. I think we?ve established the following:


a.       If broker bounces, durable messages in the durable queue that have been consumed ? but not acked ? will be redelivered.

b.      Such redelivered messages will have the ?redelivered? flag set.

c.       If consumer bounces, both (a) and (b) still hold.

In re (a): is redelivery accomplished by placing another copy of the message in the queue (thus, two copies of same message are in the  queue ? one consumed but not acked, the other brand new); OR does the broker simply know that it?s OK to redeliver the original message?

In re (b): the redelivered flag seems to enable the creation of what Hohpe calls an ?idempotent receiver.? That is, the consumer can use this flag to decide how to dispose of the redelivered message. Consider a scenario wherein the consumers, all pulling from a single queue, dispatch the work to a lower layer service. If there are multiple consumer nodes (even multiple consumer threads), they will need some means of coordinating the disposition of the redelivered message. For example, NodeA consumes (but doesn?t ack) message 1. But it does dispatch the work represented by message 1 to a lower layer service. If the broker bounces and message 1 is redelivered, it might be consumed by NodeB. But the message 1 task is already in-flight on NodeA. So, depending on both the idempotency of the task and application specific functionality, NodeB might want to discard the redelivered message 1. Such intra-consumer/intra-consumer node coordination suggests that the first consumer of the message needs to record something, probably in the persistence layer, that says ?I?ve started this particular task (using a unique request ID). Does this seem right?

Yes, according to my experience message deduplication is something that you need to carry out at the application level as it depends on how you consume your messages within your application. The broker is only able to make sure that messages reached a consumer in the application, what the application does with the messages is completely up to the application itself.


In re (c): does redelivery after consumer bounce work because the broker detects the loss of connection?

That's just one of the scenarios in which messages are redelivered. Take this with a grain of salt as I'm not completely sure of all the cases in which this happens with these exact semantics but in general whenever messages are not acked and, loosely speaking, a consumer goes away and a new one comes on the same queue, those messages will be redelivered.

Off the top of my mind:

 *   connection consumer-broker bounces
 *   broker bounces (with durable ex and queues and persistent messages)
 *   consumer is cancelled and another basic consume is issued
 *   consumer channel is closed an another channel with a new consumer on the same queue is created
 *   consumer issues a recover command to the broker
 *   consumer rejects or nacks messages with requeue flag



Please confirm, clarify, or correct as you see fit!

Thanks for your help.

-Paul

From: <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> [mailto:<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Bell, Paul M.
Sent: Saturday, January 21, 2012 5:39 PM
To: Simone Busoli

Cc: <mailto:rabbitmq-discuss at lists.rabbitmq.com> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery

Thank you both.

-Paul

On Jan 21, 2012, at 5:24 PM, "Simone Busoli" <<mailto:simone.busoli at gmail.com>simone.busoli at gmail.com<mailto:simone.busoli at gmail.com>> wrote:

Also in case 2 the broker will redeliver all messages that were not acked, although it doesn't necessarily mean that the consumer didn't really consume them already. For that you should look at the redelivered flag.
On Jan 21, 2012 11:20 PM, "Bell, Paul M." <<mailto:pbell at syncsort.com>pbell at syncsort.com<mailto:pbell at syncsort.com>> wrote:
I apologize. I should have stated up front that the queues and messages are durable.

What happens in case 2, where the consumer bounces?

Thanks, Jason.

-Paul

________________________________________
From: Jason J. W. Williams [<mailto:jasonjwwilliams at gmail.com>jasonjwwilliams at gmail.com<mailto:jasonjwwilliams at gmail.com>]
Sent: Saturday, January 21, 2012 5:05 PM
To: Bell, Paul M.
Cc: <mailto:rabbitmq-discuss at lists.rabbitmq.com> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Lack of Ack, Failure and Re-delivery

Hi Paul,

If the messages were published with the durable flag and the queues are durable, the messages will survive the broker restart and be re-presented to consumers. If the messages or the queues were not durable they will disappear after restart.

-J

Sent via iPhone

Is your email Premiere?

On Jan 21, 2012, at 14:57, "Bell, Paul M." <<mailto:pbell at syncsort.com>pbell at syncsort.com<mailto:pbell at syncsort.com>> wrote:

> Hi,
>
> Suppose I have a producer on NodeP, a broker on NodeB, and a consumer on NodeC. Suppose further that explicit acks are required (i.e., if I've understood the docs, that "noack" is not in effect) and that after consuming a message from the queue, NodeC.consumer dispatches some other work in order to process that message. IOW: NodeC.consumer doesn't respond immediately with an ack.
>
> So, from NodeB.broker's point of view, the message has been moved from the exchange to the queue, consumed, but not yet ack-ed.
>
> What will happen under these two scenarios:
>
> 1. NodeB.broker bounces - when broker restarts what will he do with un-acked messages that have been delivered to queue and haven't been ack-ed; e.g., will these be again delivered to the queue?
>
>
> 2. NodeC.consumer bounces - when consumer restarts is there any way he can again consume the un-acked message, and begin again the work that this message represents? (I suppose that NodeB.broker might be implicated here because it might detect the loss of connection to the NodeC.consumer....).
>
>
> When I say "bounces," I mean at a minimum that the application (broker, consumer) crashed and restarted. But I am also interested in the case where the node's OS is for whatever reason rebooted. Perhaps it looks no different.
>
> Thanks for your help.
>
> -Paul
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> <mailto:rabbitmq-discuss at lists.rabbitmq.com> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
<mailto:rabbitmq-discuss at lists.rabbitmq.com>rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120125/95923d1f/attachment.htm>

From commonzenpython at gmail.com  Thu Jan 26 02:37:00 2012
From: commonzenpython at gmail.com (czpython)
Date: Wed, 25 Jan 2012 18:37:00 -0800 (PST)
Subject: [rabbitmq-discuss] Vhost concept
Message-ID: <1c22706c-acf0-45d4-83ef-8481402f004b@f12g2000yqo.googlegroups.com>

Hey Guys,

Im pretty new to RabbitMQ and the whole AMPQ protocol.

I have read and done a few tutorials on RabbitMQ using a python
client. But i keep seeing people creating vhosts like so :

rabbitmqctl add_vhost myhost

My question is, what are the vhosts for, are they required ? If not
then what are the advantages of using them ?

From simone.busoli at gmail.com  Thu Jan 26 06:47:34 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 26 Jan 2012 07:47:34 +0100
Subject: [rabbitmq-discuss] Archetecture for multi-datacenters
In-Reply-To: <094044328C95D248A8E9678F35A6ACB54463C847F7@SLC-MAILBOX.echopass.com>
References: <094044328C95D248A8E9678F35A6ACB54463C847F7@SLC-MAILBOX.echopass.com>
Message-ID: <CAOn7oW-Y-e6FuBR2dHLXJSX+Lg1U7d3nNQBYfV2brzKaOotfWw@mail.gmail.com>

Hi Wes, shovel will indeed enter an endless loop if you set it up
symmetrically between two brokers. Federation instead has been designed
with an option maxHops which prevents messages from looping. You should
check it out.
On Jan 26, 2012 1:23 AM, "Wes Smith" <Wes_Smith at echopass.com> wrote:

> Situation:****
>
> Each RabbitMQ cluster has multiple nodes (2). My platform I?m working with
> has 2 datacenters each with a RabbitMQ cluster. I need to configure
> RabbitMQ such that any message published to any exchange on any node can be
> consumed by a queue on either cluster.****
>
> ** **
>
> From the web and also a support ticket/question with VMWare I am to
> understand that clustering across the WAN should not be done. I?ve been
> pointed at the shovel plugin to handle communications from one data center
> to the other. I?ve been experimenting with shovel a little to figure out
> how to do this, but I seem to have a loop going on where a published
> message from datacenter A goes to datacenter B, but then B goes ahead and
> shovels it right back to A (more than 800 times per second).****
>
> ** **
>
> I?ve seen a video from 2009 (Tony Garnock-Jones) that discusses this and
> indicated that shovel was being modified to only handle this scenario to
> look at some labels to determine if the message has been to the current
> node, and just drop it if it has.  This change does not appear to have
> happened, unless I?m missing something.****
>
> ** **
>
> Does anyone have a similar scenario or know how to handle high
> availability peer-to-peer connections across a WAN with RabbitMQ?****
>
> ** **
>
> -Wes****
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/023797fe/attachment.htm>

From alexandru at rabbitmq.com  Thu Jan 26 07:39:07 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 26 Jan 2012 07:39:07 +0000
Subject: [rabbitmq-discuss] Vhost concept
In-Reply-To: <1c22706c-acf0-45d4-83ef-8481402f004b@f12g2000yqo.googlegroups.com>
References: <1c22706c-acf0-45d4-83ef-8481402f004b@f12g2000yqo.googlegroups.com>
Message-ID: <20120126073907.GB3599@southbank.Home>

> what are the vhosts for

Vhosts are a way to group queues, exchanges, bindings and user
permissions.  They're like namespaces in which the above are declared.

> are they required 

You need at least one vhost.  It's usually called '/'.

Cheers,
Alex

On Wed, Jan 25, 2012 at 06:37:00PM -0800, czpython wrote:
> Hey Guys,
> 
> Im pretty new to RabbitMQ and the whole AMPQ protocol.
> 
> I have read and done a few tutorials on RabbitMQ using a python
> client. But i keep seeing people creating vhosts like so :
> 
> rabbitmqctl add_vhost myhost
> 
> My question is, what are the vhosts for, are they required ? If not
> then what are the advantages of using them ?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Jan 26 10:52:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 26 Jan 2012 10:52:17 +0000
Subject: [rabbitmq-discuss] RabbitMQ/Shovel & Compression
In-Reply-To: <CAFDmHdPLnZNBcdvunyx7KfM=db7wt-h84t+r0Z014Ao642VZpA@mail.gmail.com>
References: <CAFDmHdPLnZNBcdvunyx7KfM=db7wt-h84t+r0Z014Ao642VZpA@mail.gmail.com>
Message-ID: <4F213061.6050408@rabbitmq.com>

On 25/01/12 18:44, Elias Levy wrote:
> Instead of using SSH, you could use the built-in SSL functionality. If
> SSLv2 is disabled and both the client and server are compiled against
> zlib, then OpenSSL should negociate compression, and if you select a
> cipher with no encryption or authentication, you can avoid the crypto
> overhead.

Yeah, I did wonder about saying this but...

> Don't know enough about the Erlang ssl library to know how you'd go
> about specifying what cipher it should use.

...nor do I.

Jelle, if go this route and get it working, do let us know...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Jan 26 12:57:27 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jan 2012 12:57:27 +0000
Subject: [rabbitmq-discuss] Install RabbitMQ 2.6.1 on Amazon Linux
In-Reply-To: <4F20647A.8020003@gmail.com>
References: <4F20647A.8020003@gmail.com>
Message-ID: <4F214DB7.4060709@rabbitmq.com>

Hi Alexander,

On 25/01/12 20:22, Alexander Todorov wrote:
> My question is what are the exact dependencies for RabbitMQ server ?

You will require Erlang. Breaking that down further gets complicated. It
depends on what you mean by RabbitMQ server and on your operating
system. The question is hard to answer in general, because not all
distributions / operating systems package Erlang in the same way and
answer will depend on the version of RabbitMQ and plugins, which may
have more dependencies.

The base broker declares dependencies on these Erlang applications in
the application resource file: kernel, stdlib, sasl, mnesia, os_mon.

If you use SSL then you will also need public_key and ssl.
If you use HiPE then you may also need hipe.
If you want to test or compile the broker then you will need quite a few
more.

Also see this page
http://www.rabbitmq.com/which-erlang.html
for information on which versions of Erlang are required for various
features.



-Emile

From emile at rabbitmq.com  Thu Jan 26 13:55:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jan 2012 13:55:14 +0000
Subject: [rabbitmq-discuss] Install RabbitMQ 2.6.1 on Amazon Linux
In-Reply-To: <4F214DB7.4060709@rabbitmq.com>
References: <4F20647A.8020003@gmail.com> <4F214DB7.4060709@rabbitmq.com>
Message-ID: <4F215B42.9000302@rabbitmq.com>

On 26/01/12 12:57, Emile Joubert wrote:
> Hi Alexander,
> 
> On 25/01/12 20:22, Alexander Todorov wrote:
>> My question is what are the exact dependencies for RabbitMQ server ?

You could also look at how other Erlang packages define a non-X version.
erlang-nox (R14B02) in Debian declares the following dependencies beyond
the base package. This is more than strictly required, but RabbitMQ is
known to run with erlang-nox, and it avoids any dependency on wxGTK and
friends:

erlang-asn1
erlang-corba
erlang-crypto
erlang-docbuilder
erlang-edoc
erlang-erl-docgen
erlang-eunit
erlang-ic
erlang-inets
erlang-inviso
erlang-mnesia
erlang-odbc
erlang-os-mon
erlang-parsetools
erlang-percept
erlang-public-key
erlang-runtime-tools
erlang-snmp
erlang-ssh
erlang-ssl
erlang-syntax-tools
erlang-tools
erlang-webtool
erlang-xmerl



-Emile

From Jim.Langston at compuware.com  Thu Jan 26 14:16:45 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Thu, 26 Jan 2012 14:16:45 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
Message-ID: <CB46CA64.E785%jim.langston@compuware.com>

Hi all,

Any recommendations on doing an upgrade from 14
to 15 ? Is it a good thing to do ? Any performance gains ?

I'm on 14B, with RHEL6.1 , even though 15 is the latest,
I'm not looking to run on Windows

http://www.rabbitmq.com/which-erlang.html


Thanks,

Jim

http://www.compuware.com/
The contents of this e-mail are intended for the named addressee only. It contains information that may be confidential. Unless you are the named addressee or an authorized designee, you may not copy or use it, or disclose it to anyone else. If you received it in error please notify us immediately and then destroy it.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/07a54130/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: CPWRsig_04_11-03-2010.jpg
Type: image/jpeg
Size: 9440 bytes
Desc: CPWRsig_04_11-03-2010.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/07a54130/attachment.jpg>

From emile at rabbitmq.com  Thu Jan 26 14:32:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jan 2012 14:32:09 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
In-Reply-To: <CB46CA64.E785%jim.langston@compuware.com>
References: <CB46CA64.E785%jim.langston@compuware.com>
Message-ID: <4F2163E9.5020309@rabbitmq.com>

Hi Jim,

On 26/01/12 14:16, Langston, Jim wrote:
> Hi all,
> 
> Any recommendations on doing an upgrade from 14
> to 15 ? Is it a good thing to do ? Any performance gains ?
> 
> I'm on 14B, with RHEL6.1 , even though 15 is the latest,
> I'm not looking to run on Windows

Erlang is continually improving and we recommend the latest non-alpha
version. The latest version includes line numbers in stack traces, which
makes it easier for us to help you in case things go wrong.

The Erlang website has more documentation for the release you are
considering: http://www.erlang.org/download/otp_src_R15B.readme

In my own tests I have not observed a big performance gain, but that is
not the only consideration that should guide your decision.


-Emile

From Simone.Busoli at ferrari.com  Thu Jan 26 14:38:06 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 26 Jan 2012 14:38:06 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
In-Reply-To: <4F2163E9.5020309@rabbitmq.com>
References: <CB46CA64.E785%jim.langston@compuware.com>
	<4F2163E9.5020309@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520E7754@GSVCLU04.ges.ferlan.it>

Anyone tried it out on Windows?

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Emile Joubert
Sent: gioved? 26 gennaio 2012 15:32
To: Langston, Jim
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang 14 -> 15

Hi Jim,

On 26/01/12 14:16, Langston, Jim wrote:
> Hi all,
> 
> Any recommendations on doing an upgrade from 14 to 15 ? Is it a good 
> thing to do ? Any performance gains ?
> 
> I'm on 14B, with RHEL6.1 , even though 15 is the latest, I'm not 
> looking to run on Windows

Erlang is continually improving and we recommend the latest non-alpha version. The latest version includes line numbers in stack traces, which makes it easier for us to help you in case things go wrong.

The Erlang website has more documentation for the release you are
considering: http://www.erlang.org/download/otp_src_R15B.readme

In my own tests I have not observed a big performance gain, but that is not the only consideration that should guide your decision.


-Emile
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From mnkpdon.32 at gmail.com  Thu Jan 26 15:07:16 2012
From: mnkpdon.32 at gmail.com (mayank)
Date: Thu, 26 Jan 2012 07:07:16 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ publish
Message-ID: <06618c55-4ec6-4946-9174-23df44a76a0c@b23g2000yqn.googlegroups.com>

Hi

I want make sure that message are published to the exchange while
doing basic publish. As of now in my code the basic publish is
returning successfully but message is not getting published in because
of some network issues. It only the next when the client tries to
publish message the basicpublish gives error.

Is there a way where message has been published before doing anything
in the code. I am using .net client.

From Jim.Langston at compuware.com  Thu Jan 26 15:15:03 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Thu, 26 Jan 2012 15:15:03 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
In-Reply-To: <4F2163E9.5020309@rabbitmq.com>
Message-ID: <CB46D7C6.E83E%jim.langston@compuware.com>

Thanks Emile, that's a loooonnnnggg list ... is there anything
in particular that Rabbit takes advantage of between 14 and 15 ?

Jim

On 1/26/12 9:32 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi Jim,
>
>On 26/01/12 14:16, Langston, Jim wrote:
>> Hi all,
>> 
>> Any recommendations on doing an upgrade from 14
>> to 15 ? Is it a good thing to do ? Any performance gains ?
>> 
>> I'm on 14B, with RHEL6.1 , even though 15 is the latest,
>> I'm not looking to run on Windows
>
>Erlang is continually improving and we recommend the latest non-alpha
>version. The latest version includes line numbers in stack traces, which
>makes it easier for us to help you in case things go wrong.
>
>The Erlang website has more documentation for the release you are
>considering: http://www.erlang.org/download/otp_src_R15B.readme
>
>In my own tests I have not observed a big performance gain, but that is
>not the only consideration that should guide your decision.
>
>
>-Emile
>
http://www.compuware.com/
The contents of this e-mail are intended for the named addressee only. It contains information that may be confidential. Unless you are the named addressee or an authorized designee, you may not copy or use it, or disclose it to anyone else. If you received it in error please notify us immediately and then destroy it.

>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From emile at rabbitmq.com  Thu Jan 26 15:21:46 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jan 2012 15:21:46 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
In-Reply-To: <CB46D7C6.E83E%jim.langston@compuware.com>
References: <CB46D7C6.E83E%jim.langston@compuware.com>
Message-ID: <4F216F8A.5030208@rabbitmq.com>

Hi Jim,

On 26/01/12 15:15, Langston, Jim wrote:
> Thanks Emile, that's a loooonnnnggg list ... is there anything
> in particular that Rabbit takes advantage of between 14 and 15 ?

In retaining compatibility with R12B3, Rabbit does not make use of any
newer version-specific features. And in the case of line numbers in
stack traces, that advantage is only realised when you compile rabbit
with R15B.



-Emile

From dseltzer at tveyes.com  Thu Jan 26 16:04:22 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Thu, 26 Jan 2012 11:04:22 -0500
Subject: [rabbitmq-discuss] Uneven file descriptor use on HA Cluster
Message-ID: <2f82902763de2bc896f99d626169d5aa@mail.gmail.com>

Hello Everyone,



My google-fu is failing me, so maybe someone can help me out with an issue
I?ve been having.



I have two RabbitMQ 2.6.1 servers running on Centos 5.7. The two servers
(QueuePool01 and QueuePool02) are running as a cluster as we have a number
of durable HA queues. I?m load-balancing client-interactions using HAproxy
on a third server.



I started noticing that QueuePool02was using ~800 out of 1024 file
descriptors (while QueuePool01 was only using ~50). So to decrease the risk
of running out of descriptors I increase the number to 4096 and restarted
the node.



Now, again I see the number of file descriptors on QueuePool02 increasing
even though QueuePool01 is remaining steady. Is it possible there is some
sort of leak? Should the two servers tend to use the same number of file
descriptors?



Here is what the current load looks like



Dave S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/03b59cba/attachment.htm>

From dseltzer at tveyes.com  Thu Jan 26 16:07:01 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Thu, 26 Jan 2012 11:07:01 -0500
Subject: [rabbitmq-discuss] Uneven file descriptor use on HA Cluster
In-Reply-To: 2f82902763de2bc896f99d626169d5aa@mail.gmail.com
References: 2f82902763de2bc896f99d626169d5aa@mail.gmail.com
Message-ID: <4ad547ee4cb817d9e600ac2efb81f7ef@mail.gmail.com>

>> Oops, forgot to attach the link below:



Hello Everyone,



My google-fu is failing me, so maybe someone can help me out with an issue
I?ve been having.



I have two RabbitMQ 2.6.1 servers running on Centos 5.7. The two servers
(QueuePool01 and QueuePool02) are running as a cluster as we have a number
of durable HA queues. I?m load-balancing client-interactions using HAproxy
on a third server.



I started noticing that QueuePool02was using ~800 out of 1024 file
descriptors (while QueuePool01 was only using ~50). So to decrease the risk
of running out of descriptors I increase the number to 4096 and restarted
the node.



Now, again I see the number of file descriptors on QueuePool02 increasing
even though QueuePool01 is remaining steady. Is it possible there is some
sort of leak? Should the two servers tend to use the same number of file
descriptors?



Here is what the current load looks like:
http://farm8.staticflickr.com/7142/6766043407_fef95d1c23_o.jpg



Dave S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/6e5c234b/attachment.htm>

From ymoya at uci.cu  Thu Jan 26 16:26:57 2012
From: ymoya at uci.cu (Yurisleidy =?utf-8?Q?Hern=C3=A1ndez?= Moya)
Date: Thu, 26 Jan 2012 11:26:57 -0500 (CST)
Subject: [rabbitmq-discuss] priority of the messages
In-Reply-To: <e94dffdf-d31e-4e72-b4c8-d354e4f0bece@ucimail1.uci.cu>
Message-ID: <75291187-3a52-4ebc-9815-27389c2a66e1@ucimail1.uci.cu>

Hello 
i'm new in rabbitmq. can i to send messages with a specific priority of the producer for the consumer? 

that is, if the queue has more than one message, the consumer must first receive the message that has the highest priority 

we tested the property of the message "priority" but i not obtained a good result. i send my code. 

Producer.java 
public class Producer { 

private static final String TASK_QUEUE_NAME = "task_queue"; 

public static void main(String[] argv) 
throws java.io.IOException { 

ConnectionFactory factory = new ConnectionFactory(); 
factory.setHost("localhost"); 
Connection connection = factory.newConnection(); 
Channel channel = connection.createChannel(); 
boolean durable = true; 
channel.queueDeclare(TASK_QUEUE_NAME, durable, false, false, null); 
BasicProperties props = new BasicProperties.Builder().priority(0).build(); 

String message; 

for (int i = 0; i < 3; i++) { 
message = "cerooo"; 

channel.basicPublish("", TASK_QUEUE_NAME, props, message.getBytes()); 

System.out.println(" [x] Sent '" + message + "'"); 
} 
channel.close(); 
connection.close(); 
} 
} 

Consumer.java 
public class Consumer { 

private static final String TASK_QUEUE_NAME = "task_queue"; 

public static void main(String[] argv) 
throws java.io.IOException, 
java.lang.InterruptedException { 

ConnectionFactory factory = new ConnectionFactory(); 
factory.setHost("localhost"); 
Connection connection = factory.newConnection(); 
Channel channel = connection.createChannel(); 

channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null); 
System.out.println(" [*] Waiting for messages. To exit press CTRL+C"); 

channel.basicQos(1); 

QueueingConsumer consumer = new QueueingConsumer(channel); 
channel.basicConsume(TASK_QUEUE_NAME, false, consumer); 

while (true) { 
QueueingConsumer.Delivery delivery = consumer.nextDelivery(); 
String message = new String(delivery.getBody()); 

System.out.println(" [x] Received '" + message + "'"); 
Thread.sleep(2000); 
System.out.println(" [x] Done"); 

channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false); 
} 
} 
} 


Any ideas how I can do this? 

thanks in advance. 



Saludos, 
Yuri. 





Fin a la injusticia, LIBERTAD AHORA A NUESTROS CINCO COMPATRIOTAS QUE SE ENCUENTRAN INJUSTAMENTE EN PRISIONES DE LOS EEUU!
http://www.antiterroristas.cu
http://justiciaparaloscinco.wordpress.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/00d22603/attachment.htm>

From jerryk at vmware.com  Thu Jan 26 16:53:34 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 26 Jan 2012 08:53:34 -0800 (PST)
Subject: [rabbitmq-discuss] priority of the messages
In-Reply-To: <75291187-3a52-4ebc-9815-27389c2a66e1@ucimail1.uci.cu>
Message-ID: <440df365-f522-47bb-9749-2e951b6d02d8@StrongMad.local>

Hi, Yuri:

Rabbit doesn't currently implement priorities, but you might consider an
approach like the following, which some people have found helpful:

http://dougbarth.github.com/2011/07/01/approximating-priority-with-rabbitmq.html

Best regards,
Jerry

----- Original Message -----
From: "Yurisleidy Hern?ndez Moya" <ymoya at uci.cu>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, January 26, 2012 8:26:57 AM
Subject: [rabbitmq-discuss] priority of the messages



Hello
i'm new in rabbitmq. can i to send messages with a specific priority of the producer for the consumer?

that is, if the queue has more than one message, the consumer must first receive the message that has the highest priority

we tested the property of the message "priority" but i not obtained a good result. i send my code.

Producer.java
public class Producer {

private static final String TASK_QUEUE_NAME = "task_queue";

public static void main(String[] argv)
throws java.io.IOException {

ConnectionFactory factory = new ConnectionFactory();
factory.setHost("localhost");
Connection connection = factory.newConnection();
Channel channel = connection.createChannel();
boolean durable = true;
channel.queueDeclare(TASK_QUEUE_NAME, durable, false, false, null);
BasicProperties props = new BasicProperties.Builder().priority(0).build();

String message;

for (int i = 0; i < 3; i++) {
message = "cerooo";

channel.basicPublish("", TASK_QUEUE_NAME, props, message.getBytes());

System.out.println(" [x] Sent '" + message + "'");
}
channel.close();
connection.close();
}
}

Consumer.java
public class Consumer {

private static final String TASK_QUEUE_NAME = "task_queue";

public static void main(String[] argv)
throws java.io.IOException,
java.lang.InterruptedException {

ConnectionFactory factory = new ConnectionFactory();
factory.setHost("localhost");
Connection connection = factory.newConnection();
Channel channel = connection.createChannel();

channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);
System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

channel.basicQos(1);

QueueingConsumer consumer = new QueueingConsumer(channel);
channel.basicConsume(TASK_QUEUE_NAME, false, consumer);

while (true) {
QueueingConsumer.Delivery delivery = consumer.nextDelivery();
String message = new String(delivery.getBody());

System.out.println(" [x] Received '" + message + "'");
Thread.sleep(2000);
System.out.println(" [x] Done");

channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
}
}
}


Any ideas how I can do this?

thanks in advance.



Saludos,
Yuri.





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pacesysjosh at gmail.com  Thu Jan 26 17:05:06 2012
From: pacesysjosh at gmail.com (Josh Stone)
Date: Thu, 26 Jan 2012 09:05:06 -0800 (PST)
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
	related to workload distribution
In-Reply-To: <4F209E36.3030504@rabbitmq.com>
References: <77349218-cfb4-4182-907d-60818d21daa5@18g2000yqe.googlegroups.com>
	<4F204A83.5020803@rabbitmq.com>
	<7356781e-69fa-4616-bb3a-5e446aacc801@j15g2000yqb.googlegroups.com>
	<20120125233340.GA17447@wellquite.org>
	<94c214ac-239b-4de0-87f9-0fcada595db9@18g2000yqe.googlegroups.com>
	<4F209E36.3030504@rabbitmq.com>
Message-ID: <6a935635-e22f-4c0c-a76e-cf70f1bab30c@p13g2000yqd.googlegroups.com>

Hi Emile,

Our requirements are to distribute our workload while preventing race
conditions. Using round-robin workload distribution, two workers could
receive concurrent requests to operate on the same data, causing a
race. We can deal with this using distributed locks or consistent
hashing where messages for the same data item are routed to the same
worker. Consistent hashing is ideal, but as we've discussed here we
would need to deal with key-remappings that result from new workers
joining.

Josh

On Jan 25, 4:28?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Josh,
>
> On 25/01/12 23:47, Josh Stone wrote:
>
> > Regarding workers seeing a message with a routing key they're not
> > expecting, I'm not sure how a worker would know if a message is
> > acceptable for them without knowing what the hash ring looks like. If
> > our workers did mirror the hash algorithm, when a re-mapping occurred
> > they could check locally to see what work was effected. This brings us
> > closer to something like Dynamo where each node maintains a view of
> > the hash ring. In our case, each worker's view of the hash ring would
> > match that on the consistent hash exchange. This is likely the only
> > way they could handle key-remappings.
>
> > Has anyone gone down this road?
>
> I doubt it, because the consistent hash exchange uses a random number
> generator to ensure a fair distribution among all the bindings. What you
> are proposing will require workers to have access to the same random
> number stream and therefore infeasible.
>
> If you share more details about the problem you are trying to solve then
> we may be able to make alternative suggestions. Is there any reason why
> your problem cannot be solved by having multiple workers subscribe to
> the same queue and sharing the load in that way?
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jon at jbrisbin.com  Thu Jan 26 17:31:41 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 26 Jan 2012 11:31:41 -0600 (CST)
Subject: [rabbitmq-discuss] [rabbitmq-consistent-hash-exchange] Question
	related to workload distribution
In-Reply-To: <4F209E36.3030504@rabbitmq.com>
Message-ID: <82ed354d-d9ad-4848-a828-8e8f46180875@jbrisbin.local>


----- Original Message -----
> Hi Josh,
> 
> On 25/01/12 23:47, Josh Stone wrote:
> > Regarding workers seeing a message with a routing key they're not
> > expecting, I'm not sure how a worker would know if a message is
> > acceptable for them without knowing what the hash ring looks like.
> > If
> > our workers did mirror the hash algorithm, when a re-mapping
> > occurred
> > they could check locally to see what work was effected. This brings
> > us
> > closer to something like Dynamo where each node maintains a view of
> > the hash ring. In our case, each worker's view of the hash ring
> > would
> > match that on the consistent hash exchange. This is likely the only
> > way they could handle key-remappings.
> > 
> > Has anyone gone down this road?
> 
> I doubt it, because the consistent hash exchange uses a random number
> generator to ensure a fair distribution among all the bindings. What
> you
> are proposing will require workers to have access to the same random
> number stream and therefore infeasible.


Actually I think one could use statebox for this:

https://github.com/mochi/statebox


Thanks! 

Jon Brisbin 
http://about.me/jbrisbin 
http//jbrisbin.com 


> 
> If you share more details about the problem you are trying to solve
> then
> we may be able to make alternative suggestions. Is there any reason
> why
> your problem cannot be solved by having multiple workers subscribe to
> the same queue and sharing the load in that way?
> 
> 
> 
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

From fearsome.lucidity at gmail.com  Thu Jan 26 17:48:47 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Thu, 26 Jan 2012 09:48:47 -0800
Subject: [rabbitmq-discuss] Vhost concept
Message-ID: <CAFDmHdMYvJJ2zoBxr0qVF7vHzQ2m_8xnuC5d0L5OYvjdqYd6+g@mail.gmail.com>

On Thu, Jan 26, 2012 at 4:00 AM, <
rabbitmq-discuss-request at lists.rabbitmq.com> wrote:

> My question is, what are the vhosts for, are they required ? If not
> then what are the advantages of using them ?
>

Virtual hosts give you namespace separation.  All users, exchanges, queues
and bindings in each virtual host are unreachable from all other virtual
hosts.  This is a good feature to use if you want ensure
compartmentalization.

Alas, if you are like us, you'd like to compartmentalize customer data
using virtual hosts, but you'd also like to shuffle some data among those
virtual hosts (e.g. from a a primary VH to individual customer VHs), but
this becomes impractical in a dynamic environment.

The only want to shuffle that data among VHs it to use the shovel or
federation plugins, and both require that you restart the nodes hosting
them to make any changes (e.g. add a customer and thus add a shovel to
their own virtual host).

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/b39e6b69/attachment.htm>

From alexandru at rabbitmq.com  Thu Jan 26 17:55:12 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 26 Jan 2012 17:55:12 +0000
Subject: [rabbitmq-discuss] Vhost concept
In-Reply-To: <CAFDmHdMYvJJ2zoBxr0qVF7vHzQ2m_8xnuC5d0L5OYvjdqYd6+g@mail.gmail.com>
References: <CAFDmHdMYvJJ2zoBxr0qVF7vHzQ2m_8xnuC5d0L5OYvjdqYd6+g@mail.gmail.com>
Message-ID: <20120126175512.GB3590@southbank>

> The only want to shuffle that data among VHs it to use the shovel or
> federation plugins,

That's not entirely true.  The shovel is just a thin wrapper around the
Erlang client.  You can use any of the clients to do what the shovel
does (but that requires a bit of coding).

Alex

On Thu, Jan 26, 2012 at 09:48:47AM -0800, Elias Levy wrote:
> On Thu, Jan 26, 2012 at 4:00 AM, <
> rabbitmq-discuss-request at lists.rabbitmq.com> wrote:
> 
> > My question is, what are the vhosts for, are they required ? If not
> > then what are the advantages of using them ?
> >
> 
> Virtual hosts give you namespace separation.  All users, exchanges, queues
> and bindings in each virtual host are unreachable from all other virtual
> hosts.  This is a good feature to use if you want ensure
> compartmentalization.
> 
> Alas, if you are like us, you'd like to compartmentalize customer data
> using virtual hosts, but you'd also like to shuffle some data among those
> virtual hosts (e.g. from a a primary VH to individual customer VHs), but
> this becomes impractical in a dynamic environment.
> 
> The only want to shuffle that data among VHs it to use the shovel or
> federation plugins, and both require that you restart the nodes hosting
> them to make any changes (e.g. add a customer and thus add a shovel to
> their own virtual host).
> 
> Elias

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From fearsome.lucidity at gmail.com  Thu Jan 26 18:00:47 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Thu, 26 Jan 2012 10:00:47 -0800
Subject: [rabbitmq-discuss] Vhost concept
In-Reply-To: <20120126175512.GB3590@southbank>
References: <CAFDmHdMYvJJ2zoBxr0qVF7vHzQ2m_8xnuC5d0L5OYvjdqYd6+g@mail.gmail.com>
	<20120126175512.GB3590@southbank>
Message-ID: <CAFDmHdPZZ06OM890r+8PygW7zx3aviMTaAr8x4eY1KwVxpje=A@mail.gmail.com>

On Thu, Jan 26, 2012 at 9:55 AM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> > The only want to shuffle that data among VHs it to use the shovel or
> > federation plugins,
>
> That's not entirely true.  The shovel is just a thin wrapper around the
> Erlang client.  You can use any of the clients to do what the shovel
> does (but that requires a bit of coding).
>

You are correct. I should have said, doing so within Rabbit itself.
 Obviously, an external client can consume and republish wherever it wants.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/e8b18e04/attachment.htm>

From Jim.Langston at compuware.com  Thu Jan 26 19:27:02 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Thu, 26 Jan 2012 19:27:02 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
In-Reply-To: <4F216F8A.5030208@rabbitmq.com>
Message-ID: <CB47126C.EB2A%jim.langston@compuware.com>

What is the latest version available for RedHat 6?

the peter repo has 14B, and is a not a good repo for RHEL 6,
is 15B available for a repo pull, or do I need to go to Erlang

Thanks,

Jim

On 1/26/12 10:21 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi Jim,
>
>On 26/01/12 15:15, Langston, Jim wrote:
>> Thanks Emile, that's a loooonnnnggg list ... is there anything
>> in particular that Rabbit takes advantage of between 14 and 15 ?
>
>In retaining compatibility with R12B3, Rabbit does not make use of any
>newer version-specific features. And in the case of line numbers in
>stack traces, that advantage is only realised when you compile rabbit
>with R15B.
>
>
>
>-Emile


http://www.compuware.com/
The contents of this e-mail are intended for the named addressee only. It contains information that may be confidential. Unless you are the named addressee or an authorized designee, you may not copy or use it, or disclose it to anyone else. If you received it in error please notify us immediately and then destroy it.


From RSutherland at BroadViewNet.com  Thu Jan 26 21:18:33 2012
From: RSutherland at BroadViewNet.com (Sutherland, Rob)
Date: Thu, 26 Jan 2012 16:18:33 -0500
Subject: [rabbitmq-discuss] Stuck log rotation in linux?
Message-ID: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>

Several times now I've run into the issue of rabbitmq getting "stuck"
during log rotation. Log rotation is done via the usual logrotate daily
cron using the default logrotate configutaion. This is not simply a case
of log rotation taking too long as this condition can persist for
months. This cause log rotation to freeze for the entire system (since
logrotate correctly refuses to be invoked if there's already a log
rotation in progress) and results in log files growing out of control
(e.g. a 900 MB /var/log/messages file).

 

Here's an example of such a process tree (a snippet from ps axjf):

 

PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND

    1 25352 25352 25352 ?           -1 Ss       0   0:00 sh -c
/usr/sbin/rabbitmq-server > /var/log/rabbitmq/startup_log 2>
/var/log/rabbitmq/startup_err

25352 25356 25352 25352 ?           -1 S        0   0:00  \_ /bin/sh
/usr/sbin/rabbitmq-server

25356 25363 25352 25352 ?           -1 S        0   0:00      \_ su
rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmq-server 

25363 25367 25367 25367 ?           -1 Ssl    105   3:56          \_
/usr/lib64/erlang/erts-5.8.1/bin/beam.smp -W w -K true -A30 -P 1048576
-- -root /usr/lib64/erlang -prognam

25367 25479 25479 25479 ?           -1 Ss     105   0:00              \_
/usr/lib64/erlang/lib/os_mon-2.2.5/priv/bin/cpu_sup

25367 25480 25480 25480 ?           -1 Ss     105   0:00              \_
inet_gethost 4

25480 25481 25480 25480 ?           -1 S      105   0:00
\_ inet_gethost 4

 

 

Any ideas? I have yet to find a pattern to the appearance of this issue.

 

Thanks in advance,

 

Rob

 

OS: SUSE Linux Enterprise System version 11 SP1

# uname -a

Linux PVHA30node1 2.6.32.46-0.3-default #1 SMP 2011-09-29 17:49:31 +0200
x86_64 x86_64 x86_64 GNU/Linux

 

# cat /etc/logrotate.d/ rabbitmq-server

/var/log/rabbitmq/*.log {

        weekly

        missingok

        rotate 20

        compress

        delaycompress

        notifempty

        sharedscripts

        postrotate

            /sbin/service rabbitmq-server rotate-logs > /dev/null

        endscript

}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/c62792ec/attachment.htm>

From simone.busoli at gmail.com  Thu Jan 26 21:22:30 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 26 Jan 2012 22:22:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ publish
In-Reply-To: <06618c55-4ec6-4946-9174-23df44a76a0c@b23g2000yqn.googlegroups.com>
References: <06618c55-4ec6-4946-9174-23df44a76a0c@b23g2000yqn.googlegroups.com>
Message-ID: <CAOn7oW-TvN9zRdTzYc=zQPq0Spyx1jQZAkBfy=5xix00+5DHmg@mail.gmail.com>

Hi, basic publish is an asynchronous operation, at least in the .NET
client, therefore you won't spot issues until you do something else with
the channel (called model in the .NET client), like another publish.
In general you should:

   - subscribe to shutdown events on connection and model to spot that
   something went wrong and for example attempt a reconnection
   - to ensure the broker takes responsibility for the messages either put
   the channel in confirm mode or enable transactions

The second point with publisher confirms has one gotcha, that is, if
connection shuts down while you're waiting for acks from the broker you
should republish all unconfirmed messages. This is the only way to ensure
that messages will eventually reach their destinations, but it obviously
introduces the chance of messages being duplicated.

On Thu, Jan 26, 2012 at 16:07, mayank <mnkpdon.32 at gmail.com> wrote:

> Hi
>
> I want make sure that message are published to the exchange while
> doing basic publish. As of now in my code the basic publish is
> returning successfully but message is not getting published in because
> of some network issues. It only the next when the client tries to
> publish message the basicpublish gives error.
>
> Is there a way where message has been published before doing anything
> in the code. I am using .net client.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120126/a2e03602/attachment.htm>

From codevally at gmail.com  Thu Jan 26 23:30:18 2012
From: codevally at gmail.com (Codevally)
Date: Thu, 26 Jan 2012 15:30:18 -0800 (PST)
Subject: [rabbitmq-discuss] Queue item limits
In-Reply-To: <4F1FE7FD.2090601@rabbitmq.com>
References: <c82ef2fa-5879-4d1a-ad37-044b3e6f805f@b10g2000pbd.googlegroups.com>
	<0bd1da48-5895-4072-b8fc-f070bb8fc8f6@3g2000pbd.googlegroups.com>
	<CAOn7oW9OxJAs8c_5jgQHQ5zfgkM=sPRYnWNHuFQrSm3ptY+=sA@mail.gmail.com>
	<4F1FE7FD.2090601@rabbitmq.com>
Message-ID: <55a5f303-ad99-4fb8-9237-2c47b66fb0ad@uc9g2000pbc.googlegroups.com>

Thanks Emile and Simone for your replies.

But I want to limit the number of items in the queue and not their
live in the queue.

Basically my requirement is, I have a queue (called sms_gateway) and I
have several companies publishing messages to that queue. But want to
allocate some big number of size to higher priority companies. Like:

ABC Company can have maximum of 1000 messages in the sms_gateway
XYZ Company can have maximum of 200  messages in the sms_gateway
PQR Company can have maximum of 100  messages in the sms_gateway

Thanks.

On Jan 25, 10:31?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 25/01/12 07:11, Simone Busoli wrote:
>
>
>
>
>
>
>
>
>
> > There is no such feature in the broker, perhaps if you explain what you
> > are trying to do there may be other ways.
>
> > On Jan 25, 2012 1:43 AM, "Codevally" <codeva... at gmail.com
> > <mailto:codeva... at gmail.com>> wrote:
>
> > ? ? This is something like ?restrict the size of the queue. Please help.
>
> > ? ? On Jan 25, 11:38 am, Codevally <codeva... at gmail.com
> > ? ? <mailto:codeva... at gmail.com>> wrote:
> > ? ? ?> Hi
>
> > ? ? ?> I have a declared queue and want to know how can I limit the
> > ? ? number of
> > ? ? ?> items in that queue. For example, the define queue is "sms_gateway"
> > ? ? ?> and that queue can maximum allow to receive 500 items.
>
> As Simone says, there is no way of limiting the number of messages in a
> queue. The closest approximation is to limit the time that messages may
> spend in a queue.
>
> http://www.rabbitmq.com/extensions.html#lifetimes
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Thu Jan 26 23:40:04 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 27 Jan 2012 00:40:04 +0100
Subject: [rabbitmq-discuss] Queue item limits
In-Reply-To: <55a5f303-ad99-4fb8-9237-2c47b66fb0ad@uc9g2000pbc.googlegroups.com>
References: <c82ef2fa-5879-4d1a-ad37-044b3e6f805f@b10g2000pbd.googlegroups.com>
	<0bd1da48-5895-4072-b8fc-f070bb8fc8f6@3g2000pbd.googlegroups.com>
	<CAOn7oW9OxJAs8c_5jgQHQ5zfgkM=sPRYnWNHuFQrSm3ptY+=sA@mail.gmail.com>
	<4F1FE7FD.2090601@rabbitmq.com>
	<55a5f303-ad99-4fb8-9237-2c47b66fb0ad@uc9g2000pbc.googlegroups.com>
Message-ID: <CAOn7oW86+iK5yKg--hwoyxT9cmm0EexY8D69+siyL7emy80eGg@mail.gmail.com>

This is not supported out of the box, you'd have to write something at a
higher level to do that. There may be workarounds if you explain a bit more
about your architecture. For example the declare-ok reply when you declare
a queue carries the number of messages in the queue, or you may be able to
leverage the prefetch-count option to limit the number of messages
delivered to a consumer before it acks them, or else use the channel flow
control, but the feasibility of each depends a lot on how you have set up
your system.

On Fri, Jan 27, 2012 at 00:30, Codevally <codevally at gmail.com> wrote:

> Thanks Emile and Simone for your replies.
>
> But I want to limit the number of items in the queue and not their
> live in the queue.
>
> Basically my requirement is, I have a queue (called sms_gateway) and I
> have several companies publishing messages to that queue. But want to
> allocate some big number of size to higher priority companies. Like:
>
> ABC Company can have maximum of 1000 messages in the sms_gateway
> XYZ Company can have maximum of 200  messages in the sms_gateway
> PQR Company can have maximum of 100  messages in the sms_gateway
>
> Thanks.
>
> On Jan 25, 10:31 pm, Emile Joubert <em... at rabbitmq.com> wrote:
> > Hi,
> >
> > On 25/01/12 07:11, Simone Busoli wrote:
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > > There is no such feature in the broker, perhaps if you explain what you
> > > are trying to do there may be other ways.
> >
> > > On Jan 25, 2012 1:43 AM, "Codevally" <codeva... at gmail.com
> > > <mailto:codeva... at gmail.com>> wrote:
> >
> > >     This is something like  restrict the size of the queue. Please
> help.
> >
> > >     On Jan 25, 11:38 am, Codevally <codeva... at gmail.com
> > >     <mailto:codeva... at gmail.com>> wrote:
> > >      > Hi
> >
> > >      > I have a declared queue and want to know how can I limit the
> > >     number of
> > >      > items in that queue. For example, the define queue is
> "sms_gateway"
> > >      > and that queue can maximum allow to receive 500 items.
> >
> > As Simone says, there is no way of limiting the number of messages in a
> > queue. The closest approximation is to limit the time that messages may
> > spend in a queue.
> >
> > http://www.rabbitmq.com/extensions.html#lifetimes
> >
> > -Emile
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120127/4954cf9c/attachment.htm>

From yogimogi at gmail.com  Fri Jan 27 08:52:18 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Fri, 27 Jan 2012 00:52:18 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)
In-Reply-To: <4F20104F.9010102@rabbitmq.com>
References: <8fc9ce15-481d-42ab-8aab-0062443c1d3b@o4g2000pbc.googlegroups.com>
	<4F20104F.9010102@rabbitmq.com>
Message-ID: <313aecd4-bc49-4c67-a1a6-1127cdbd012e@kn4g2000pbc.googlegroups.com>

Hello Simon,
This is how code looks like
main(String[] argv) {
? ? // Read messages from MainQueue
? ? Channel ch = c.createChannel();
? ? ch.basicConsume("MainQueue", false, "", new
MainQueueConsumer(ch));

? ? // Read messages from dynamically declared queues
? ? ExecutorService es = Executors.newFixedThreadPool(tpSize);
? ? Collection<QueueProcessor> vAppProcessorCollection = new
ArrayList<QueueProcessor>();
? ? while(true) {
? ? ? ? // Get the queues currently present using
? ? ? ? // http://<rabbitmq-server>:55672/api/queues/%2f/
? ? ? ? List<String> qs = AMQPUtil.getvAppQueues();
? ? ? ? vAppProcessorCollection.clear();
? ? ? ? for(String q : qs) {
? ? ? ? ? ? QueueProcessor p = new QueueProcessor(c, q);
? ? ? ? ? ? vAppProcessorCollection.add(p);
? ? ? ? }
? ? ? ? es.invokeAll(vAppProcessorCollection);
? ? }
}
MainQueueConsumer, in handleDelivery does something like
public void handleDelivery() {
? ? // Get Queue name from payload
? ? c.queueDeclare(queueName, true, false, false,
getQueueProperties());
? ? c.queueBind(queueName, exchange, routingKey);
? ? c.basicPublish(exchange, routingKey, props, body);
? ? ch.basicAck(envelope.getDeliveryTag(), false);
}

And QueueProcessor does this in call() method
public Boolean call() {
? ? try {
? ? ? ? Channel ch = c.createChannel();
? ? ? ? while(true) {
? ? ? ? ? ? GetResponse r = ch.basicGet(queue, false);
? ? ? ? ? ? if(r != null) {
? ? ? ? ? ? ? ? // process message
? ? ? ? ? ? ? ? ch.basicAck(r.getEnvelope().getDeliveryTag(), false);
? ? ? ? ? ? } else break;
? ? ? ? }
? ? ? ? Util.queueDelete(ch, queue, true, true);
? ? ? ? if(ch.isOpen()) ch.close();
? ? } catch(Throwable th) {
? ? ? ? BaseUtil.logException(logger, th);
? ? }
}

Just couple of things
- If I don't delete the queue in call() method, things are much better
  and I am even able to 50000 messages on MainQueue without much
issues
- Ideally I would like to get rid of while(true) { ... basicGet ... }.
  Is there any pattern where I can do
  basicConsume() on the dynamically generated queue and
  remove the consumer and the queue when number of message on it are 0

regards, Yogesh

On Jan 25, 7:23?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 25/01/12 08:30, Yogesh Ketkar wrote:
>
> > Any clues how to debug this?
>
> That sounds odd. 10k messages should be nothing.
>
> Can you share your code somehow so I can try to replicate this?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Fri Jan 27 10:12:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 27 Jan 2012 10:12:37 +0000
Subject: [rabbitmq-discuss] Queue item limits
In-Reply-To: <55a5f303-ad99-4fb8-9237-2c47b66fb0ad@uc9g2000pbc.googlegroups.com>
References: <c82ef2fa-5879-4d1a-ad37-044b3e6f805f@b10g2000pbd.googlegroups.com>
	<0bd1da48-5895-4072-b8fc-f070bb8fc8f6@3g2000pbd.googlegroups.com>
	<CAOn7oW9OxJAs8c_5jgQHQ5zfgkM=sPRYnWNHuFQrSm3ptY+=sA@mail.gmail.com>
	<4F1FE7FD.2090601@rabbitmq.com>
	<55a5f303-ad99-4fb8-9237-2c47b66fb0ad@uc9g2000pbc.googlegroups.com>
Message-ID: <4F227895.4080603@rabbitmq.com>

Hi,

On 26/01/12 23:30, Codevally wrote:
> Basically my requirement is, I have a queue (called sms_gateway) and I
> have several companies publishing messages to that queue. But want to
> allocate some big number of size to higher priority companies. Like:
> 
> ABC Company can have maximum of 1000 messages in the sms_gateway
> XYZ Company can have maximum of 200  messages in the sms_gateway
> PQR Company can have maximum of 100  messages in the sms_gateway

You can emulate priorities by declaring a queue for each company. On the
consumer side you then consume in the ratio 10:2:1 from queues for ABC,
XYZ and PQR.


-Emile





From emile at rabbitmq.com  Fri Jan 27 11:17:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 27 Jan 2012 11:17:23 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
In-Reply-To: <CB47126C.EB2A%jim.langston@compuware.com>
References: <CB47126C.EB2A%jim.langston@compuware.com>
Message-ID: <4F2287C3.9070409@rabbitmq.com>


Hi Jim,

On 26/01/12 19:27, Langston, Jim wrote:
> the peter repo has 14B, and is a not a good repo for RHEL 6,
> is 15B available for a repo pull, or do I need to go to Erlang

Can you explain the difficulty with the EPEL repository that hosts
Erlang R14B?

As you mention, it is possible to download a source archive from
erlang.org  and build it.


-Emile

From simon at rabbitmq.com  Fri Jan 27 11:48:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jan 2012 11:48:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)
In-Reply-To: <313aecd4-bc49-4c67-a1a6-1127cdbd012e@kn4g2000pbc.googlegroups.com>
References: <8fc9ce15-481d-42ab-8aab-0062443c1d3b@o4g2000pbc.googlegroups.com>	<4F20104F.9010102@rabbitmq.com>
	<313aecd4-bc49-4c67-a1a6-1127cdbd012e@kn4g2000pbc.googlegroups.com>
Message-ID: <4F228F15.2080405@rabbitmq.com>

I can't run code that is incomplete :-) but some things stand out:

You are declaring and binding queues on every delivery, and then 
deleting them shortly after as well. On a system where a lot's going on 
in parallel this might lead to lots of retried transactions, which could 
lead to high CPU use. It's not clear when call() gets called but if that 
is in a tight loop then you could be declaring and immediately deleting 
queues constantly.

You said in your original message that there would only ever be 100 
queues - if that is the case then can they just be created once? Or use 
  queue leases (http://www.rabbitmq.com/extensions.html#queue-leases) to 
make sure they get tidied up after some period of inactivity?

You might want to connect your application through the Tracer 
(http://www.rabbitmq.com/api-guide.html#tracer) to see what is happening 
at the protocol level.

Cheers, Simon

On 27/01/12 08:52, Yogesh Ketkar wrote:
> Hello Simon,
> This is how code looks like
> main(String[] argv) {
>      // Read messages from MainQueue
>      Channel ch = c.createChannel();
>      ch.basicConsume("MainQueue", false, "", new
> MainQueueConsumer(ch));
>
>      // Read messages from dynamically declared queues
>      ExecutorService es = Executors.newFixedThreadPool(tpSize);
>      Collection<QueueProcessor>  vAppProcessorCollection = new
> ArrayList<QueueProcessor>();
>      while(true) {
>          // Get the queues currently present using
>          // http://<rabbitmq-server>:55672/api/queues/%2f/
>          List<String>  qs = AMQPUtil.getvAppQueues();
>          vAppProcessorCollection.clear();
>          for(String q : qs) {
>              QueueProcessor p = new QueueProcessor(c, q);
>              vAppProcessorCollection.add(p);
>          }
>          es.invokeAll(vAppProcessorCollection);
>      }
> }
> MainQueueConsumer, in handleDelivery does something like
> public void handleDelivery() {
>      // Get Queue name from payload
>      c.queueDeclare(queueName, true, false, false,
> getQueueProperties());
>      c.queueBind(queueName, exchange, routingKey);
>      c.basicPublish(exchange, routingKey, props, body);
>      ch.basicAck(envelope.getDeliveryTag(), false);
> }
>
> And QueueProcessor does this in call() method
> public Boolean call() {
>      try {
>          Channel ch = c.createChannel();
>          while(true) {
>              GetResponse r = ch.basicGet(queue, false);
>              if(r != null) {
>                  // process message
>                  ch.basicAck(r.getEnvelope().getDeliveryTag(), false);
>              } else break;
>          }
>          Util.queueDelete(ch, queue, true, true);
>          if(ch.isOpen()) ch.close();
>      } catch(Throwable th) {
>          BaseUtil.logException(logger, th);
>      }
> }
>
> Just couple of things
> - If I don't delete the queue in call() method, things are much better
>    and I am even able to 50000 messages on MainQueue without much
> issues
> - Ideally I would like to get rid of while(true) { ... basicGet ... }.
>    Is there any pattern where I can do
>    basicConsume() on the dynamically generated queue and
>    remove the consumer and the queue when number of message on it are 0
>
> regards, Yogesh
>
> On Jan 25, 7:23 pm, Simon MacMullen<si... at rabbitmq.com>  wrote:
>> On 25/01/12 08:30, Yogesh Ketkar wrote:
>>
>>> Any clues how to debug this?
>>
>> That sounds odd. 10k messages should be nothing.
>>
>> Can you share your code somehow so I can try to replicate this?
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 27 11:51:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jan 2012 11:51:39 +0000
Subject: [rabbitmq-discuss] Stuck log rotation in linux?
In-Reply-To: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>
References: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>
Message-ID: <4F228FCB.1030402@rabbitmq.com>

Hi Rob.

The ps snippet you show just shows the tree of processes launched by a 
running RabbitMQ server - nothing out of the ordinary there.

If logrotate is getting stuck, presumably this is due to its invocation 
of /etc/init.d/rabbitmq-server rotate-logs hanging. When it's in the 
stuck state, what does this command return? The logrotate configuration 
file pipes the output of that command to /dev/null - can you redirect it 
somewhere else so we can see what it's doing?

Cheers, Simon

On 26/01/12 21:18, Sutherland, Rob wrote:
> Several times now I?ve run into the issue of rabbitmq getting ?stuck?
> during log rotation. Log rotation is done via the usual logrotate daily
> cron using the default logrotate configutaion. This is not simply a case
> of log rotation taking too long as this condition can persist for
> months. This cause log rotation to freeze for the entire system (since
> logrotate correctly refuses to be invoked if there?s already a log
> rotation in progress) and results in log files growing out of control
> (e.g. a 900 MB /var/log/messages file).
>
> Here?s an example of such a process tree (a snippet from ps axjf):
>
> PPID PID PGID SID TTY TPGID STAT UID TIME COMMAND
>
> 1 25352 25352 25352 ? -1 Ss 0 0:00 sh -c /usr/sbin/rabbitmq-server >
> /var/log/rabbitmq/startup_log 2> /var/log/rabbitmq/startup_err
>
> 25352 25356 25352 25352 ? -1 S 0 0:00 \_ /bin/sh /usr/sbin/rabbitmq-server
>
> 25356 25363 25352 25352 ? -1 S 0 0:00 \_ su rabbitmq -s /bin/sh -c
> /usr/lib/rabbitmq/bin/rabbitmq-server
>
> 25363 25367 25367 25367 ? -1 Ssl 105 3:56 \_
> /usr/lib64/erlang/erts-5.8.1/bin/beam.smp -W w -K true -A30 -P 1048576
> -- -root /usr/lib64/erlang -prognam
>
> 25367 25479 25479 25479 ? -1 Ss 105 0:00 \_
> /usr/lib64/erlang/lib/os_mon-2.2.5/priv/bin/cpu_sup
>
> 25367 25480 25480 25480 ? -1 Ss 105 0:00 \_ inet_gethost 4
>
> 25480 25481 25480 25480 ? -1 S 105 0:00 \_ inet_gethost 4
>
> Any ideas? I have yet to find a pattern to the appearance of this issue.
>
> Thanks in advance,
>
> Rob
>
> OS: SUSE Linux Enterprise System version 11 SP1
>
> # uname -a
>
> Linux PVHA30node1 2.6.32.46-0.3-default #1 SMP 2011-09-29 17:49:31 +0200
> x86_64 x86_64 x86_64 GNU/Linux
>
> # cat /etc/logrotate.d/ rabbitmq-server
>
> /var/log/rabbitmq/*.log {
>
> weekly
>
> missingok
>
> rotate 20
>
> compress
>
> delaycompress
>
> notifempty
>
> sharedscripts
>
> postrotate
>
> /sbin/service rabbitmq-server rotate-logs > /dev/null
>
> endscript
>
> }
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From u2.storm at gmail.com  Fri Jan 27 12:03:43 2012
From: u2.storm at gmail.com (Artsiom Gulin)
Date: Fri, 27 Jan 2012 15:03:43 +0300
Subject: [rabbitmq-discuss] Disc node clustering
Message-ID: <4F22929F.2050801@gmail.com>

Hello.

I have some unpleasant issues while clustering disc nodes.
Two brokers located on two hosts.
Steps to reproduce:

1. Cluster *second* machine *with first* as disc node. 
(RABBITMQ_NODENAME=wosnfs).
[root at epbyminw2482t3 ~]#  rabbitmqctl stop_app && rabbitmqctl reset && 
rabbitmqctl cluster wosnfs@`hostname -s` wosnfs at epbyminw2482t2 && 
rabbitmqctl start_app

2. Remove first node
[root at epbyminw2482t2]# rabbitmqctl stop_app && rabbitmqctl cluster 
wosnfs@`hostname -s` && rabbitmqctl reset && rabbitmqctl start_app

3. Restart rabbitmq-server service on second node.
[root at epbyminw2482t3 ~]# service rabbitmq-server restart
Restarting rabbitmq-server: FAILED - check 
/var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.

[root at epbyminw2482t3 ~]# cat /var/log/rabbitmq/startup_err
Erlang has closed

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
[root at epbyminw2482t3 ~]# cat /var/log/rabbitmq/startup_log
Activating RabbitMQ plugins ...
0 plugins activated:

/<-CUT->/
erlang version : 5.8.4

-- rabbit boot start
starting file handle cache server                                     
...done
starting worker pool                                                  
...done
starting database                                                     
...BOOT ERROR: FAILED
Reason: {error,
             {unable_to_join_cluster,
                 [wosnfs at epbyminw2482t3,wosnfs at epbyminw2482t2],
                 {merge_schema_failed,
                     "Bad cookie in table definition 
mirrored_sup_childspec: wosnfs at epbyminw2482t3 = 
{cstruct,mirrored_sup_childspec,ordered_set,[wosnfs at epbyminw2482t3],[],[],0,read_write,false,[],[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],{{1327,663993,999525},*wosnfs at epbyminw2482t2*},{{3,1},{wosnfs at epbyminw2482t3,{1327,664433,471064}}}}, 
*wosnfs at epbyminw2482t2* = 
{cstruct,mirrored_sup_childspec,ordered_set,[*wosnfs at epbyminw2482t2*],[],[],0,read_write,false,[],[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],{{1327,664434,761441},*wosnfs at epbyminw2482t2*},{{2,0},[]}}\n"}}}
Stacktrace: [{rabbit_mnesia,init_db,3},
              {rabbit_mnesia,init,0},
              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
              {rabbit,run_boot_step,1},
              {rabbit,'-start/2-lc$^0/1-0-',1},
              {rabbit,start,2},
              {application_master,start_it_old,4}]
{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

All commands finished successfully except the last.
Could you help me to find out what kind of error appeared and why?
It seems that first node (epbyminw2482t2) has already been removed from 
the cluster, why some information about the one left in mnesia on 
another node and appears in error log? I suppose that that correct 
removing of any node from cluster should not influence on others.
Problem is reproducible with arbitrary number of disc nodes.

It is interesting, that if we change an order joining to cluster - join 
first node to second,  then no error will appear.

Environment:
CentOS 6.0
Erlang R1403
RabbitMQ 2.7.1

--
Best regards,
Artsiom

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120127/08026af7/attachment.htm>

From simon at rabbitmq.com  Fri Jan 27 12:01:42 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jan 2012 12:01:42 +0000
Subject: [rabbitmq-discuss] Uneven file descriptor use on HA Cluster
In-Reply-To: <2f82902763de2bc896f99d626169d5aa@mail.gmail.com>
References: <2f82902763de2bc896f99d626169d5aa@mail.gmail.com>
Message-ID: <4F229226.7090408@rabbitmq.com>

Hi.

First of all, a few points: RabbitMQ will try to be smart about its use 
of file descriptors for actual files - while one descriptor will be used 
for each *connection*, it will keep file descriptors open until it 
starts to run out, at which point it will start to swap them.

So seeing high numbers of file descriptors used with low numbers of 
connections open is not a cause to panic - especially if you have lots 
of queues.

Having said that, if you don't have lots of queues then that number of 
FDs used is odd. And the asymmetry is odd too, unless you have lots of 
non-mirrored queues on one node.

What does lsof say?

Finally, lots of bugs got fixed around HA between 2.6.1 and 2.7.1 so it 
might be worth upgrading in case that helps.

Cheers, Simon

On 26/01/12 16:04, Dave Seltzer wrote:
> Hello Everyone,
>
> My google-fu is failing me, so maybe someone can help me out with an
> issue I?ve been having.
>
> I have two RabbitMQ 2.6.1 servers running on Centos 5.7. The two servers
> (QueuePool01 and QueuePool02) are running as a cluster as we have a
> number of durable HA queues. I?m load-balancing client-interactions
> using HAproxy on a third server.
>
> I started noticing that QueuePool02was using ~800 out of 1024 file
> descriptors (while QueuePool01 was only using ~50). So to decrease the
> risk of running out of descriptors I increase the number to 4096 and
> restarted the node.
>
> Now, again I see the number of file descriptors on QueuePool02
> increasing even though QueuePool01 is remaining steady. Is it possible
> there is some sort of leak? Should the two servers tend to use the same
> number of file descriptors?
>
> Here is what the current load looks like
>
> Dave S
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Jan 27 12:19:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 27 Jan 2012 12:19:11 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
In-Reply-To: <4F2287C3.9070409@rabbitmq.com>
References: <CB47126C.EB2A%jim.langston@compuware.com>
	<4F2287C3.9070409@rabbitmq.com>
Message-ID: <4F22963F.5090802@rabbitmq.com>

Hi Jim,

On 27/01/12 11:17, Emile Joubert wrote:
> On 26/01/12 19:27, Langston, Jim wrote:
>> the peter repo has 14B, and is a not a good repo for RHEL 6,
>> is 15B available for a repo pull, or do I need to go to Erlang
> 
> Can you explain the difficulty with the EPEL repository that hosts
> Erlang R14B?

Apologies, it has just been pointed out to me that this repo
http://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo
doesn't work with RHEL 6. The instructions here:
http://www.rabbitmq.com/install-rpm.html
indicate that you should use EPEL, which has a sufficiently recent
version of Erlang.



-Emile



From yogimogi at gmail.com  Fri Jan 27 12:49:28 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Fri, 27 Jan 2012 04:49:28 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ server performance issue (erl.exe)
In-Reply-To: <4F228F15.2080405@rabbitmq.com>
References: <8fc9ce15-481d-42ab-8aab-0062443c1d3b@o4g2000pbc.googlegroups.com>
	<4F20104F.9010102@rabbitmq.com>
	<313aecd4-bc49-4c67-a1a6-1127cdbd012e@kn4g2000pbc.googlegroups.com>
	<4F228F15.2080405@rabbitmq.com>
Message-ID: <f69e4587-0af7-46a7-896c-755730763a5c@c9g2000pbh.googlegroups.com>

> You said in your original message that there would only ever be 100 queues
Actually this is my test-bed. I wouldn't bother deleting the queues if
there were only 100.
Real life scenario, there could be thousands of queues with 5 to 10
messages on
each queue. And that is why I want to delete a queue, once all the
messages on it are consumed.

> It's not clear when call() gets called but
call() gets called by ExecutorService.

> You are declaring and binding queues on every delivery,
I don't have a choice, when delivery of message happens, destination
queue might have been deleted.
Is there a way in client API to find out
- If queue is already declared
- Is there a binding to the queue?

> http://www.rabbitmq.com/extensions.html#queue-leases
I had thought about this, but with x-expires, queues get deleted even
if they have
messages.

> http://www.rabbitmq.com/api-guide.html#tracer
I will and try and debug using this.

I will try and give you runnable code by removing all the scaffolding
code.

regards, Yogesh


On Jan 27, 4:48?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> I can't run code that is incomplete :-) but some things stand out:
>
> You are declaring and binding queues on every delivery, and then
> deleting them shortly after as well. On a system where a lot's going on
> in parallel this might lead to lots of retried transactions, which could
> lead to high CPU use. It's not clear when call() gets called but if that
> is in a tight loop then you could be declaring and immediately deleting
> queues constantly.
>
> You said in your original message that there would only ever be 100
> queues - if that is the case then can they just be created once? Or use
> ? queue leases (http://www.rabbitmq.com/extensions.html#queue-leases) to
> make sure they get tidied up after some period of inactivity?
>
> You might want to connect your application through the Tracer
> (http://www.rabbitmq.com/api-guide.html#tracer) to see what is happening
> at the protocol level.
>
> Cheers, Simon
>
> On 27/01/12 08:52, Yogesh Ketkar wrote:
>
>
>
>
>
>
>
>
>
> > Hello Simon,
> > This is how code looks like
> > main(String[] argv) {
> > ? ? ?// Read messages from MainQueue
> > ? ? ?Channel ch = c.createChannel();
> > ? ? ?ch.basicConsume("MainQueue", false, "", new
> > MainQueueConsumer(ch));
>
> > ? ? ?// Read messages from dynamically declared queues
> > ? ? ?ExecutorService es = Executors.newFixedThreadPool(tpSize);
> > ? ? ?Collection<QueueProcessor> ?vAppProcessorCollection = new
> > ArrayList<QueueProcessor>();
> > ? ? ?while(true) {
> > ? ? ? ? ?// Get the queues currently present using
> > ? ? ? ? ?// http://<rabbitmq-server>:55672/api/queues/%2f/
> > ? ? ? ? ?List<String> ?qs = AMQPUtil.getvAppQueues();
> > ? ? ? ? ?vAppProcessorCollection.clear();
> > ? ? ? ? ?for(String q : qs) {
> > ? ? ? ? ? ? ?QueueProcessor p = new QueueProcessor(c, q);
> > ? ? ? ? ? ? ?vAppProcessorCollection.add(p);
> > ? ? ? ? ?}
> > ? ? ? ? ?es.invokeAll(vAppProcessorCollection);
> > ? ? ?}
> > }
> > MainQueueConsumer, in handleDelivery does something like
> > public void handleDelivery() {
> > ? ? ?// Get Queue name from payload
> > ? ? ?c.queueDeclare(queueName, true, false, false,
> > getQueueProperties());
> > ? ? ?c.queueBind(queueName, exchange, routingKey);
> > ? ? ?c.basicPublish(exchange, routingKey, props, body);
> > ? ? ?ch.basicAck(envelope.getDeliveryTag(), false);
> > }
>
> > And QueueProcessor does this in call() method
> > public Boolean call() {
> > ? ? ?try {
> > ? ? ? ? ?Channel ch = c.createChannel();
> > ? ? ? ? ?while(true) {
> > ? ? ? ? ? ? ?GetResponse r = ch.basicGet(queue, false);
> > ? ? ? ? ? ? ?if(r != null) {
> > ? ? ? ? ? ? ? ? ?// process message
> > ? ? ? ? ? ? ? ? ?ch.basicAck(r.getEnvelope().getDeliveryTag(), false);
> > ? ? ? ? ? ? ?} else break;
> > ? ? ? ? ?}
> > ? ? ? ? ?Util.queueDelete(ch, queue, true, true);
> > ? ? ? ? ?if(ch.isOpen()) ch.close();
> > ? ? ?} catch(Throwable th) {
> > ? ? ? ? ?BaseUtil.logException(logger, th);
> > ? ? ?}
> > }
>
> > Just couple of things
> > - If I don't delete the queue in call() method, things are much better
> > ? ?and I am even able to 50000 messages on MainQueue without much
> > issues
> > - Ideally I would like to get rid of while(true) { ... basicGet ... }.
> > ? ?Is there any pattern where I can do
> > ? ?basicConsume() on the dynamically generated queue and
> > ? ?remove the consumer and the queue when number of message on it are 0
>
> > regards, Yogesh
>
> > On Jan 25, 7:23 pm, Simon MacMullen<si... at rabbitmq.com> ?wrote:
> >> On 25/01/12 08:30, Yogesh Ketkar wrote:
>
> >>> Any clues how to debug this?
>
> >> That sounds odd. 10k messages should be nothing.
>
> >> Can you share your code somehow so I can try to replicate this?
>
> >> Cheers, Simon
>
> >> --
> >> Simon MacMullen
> >> RabbitMQ, VMware
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Fri Jan 27 13:35:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jan 2012 13:35:27 +0000
Subject: [rabbitmq-discuss] Disc node clustering
In-Reply-To: <4F22929F.2050801@gmail.com>
References: <4F22929F.2050801@gmail.com>
Message-ID: <4F22A81F.6050405@rabbitmq.com>

On 27/01/12 12:03, Artsiom Gulin wrote:
> [root at epbyminw2482t2]# rabbitmqctl stop_app && rabbitmqctl cluster
> wosnfs@`hostname -s` && rabbitmqctl reset && rabbitmqctl start_app

So it looks like you are leaving the cluster and then resetting, rather 
than the other way around (which is more normal). It looks like the 
request to leave the cluster gets ignored in this case. I'll file a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From u2.storm at gmail.com  Fri Jan 27 13:43:55 2012
From: u2.storm at gmail.com (Artsiom Gulin)
Date: Fri, 27 Jan 2012 16:43:55 +0300
Subject: [rabbitmq-discuss] Disc node clustering
In-Reply-To: <4F22A81F.6050405@rabbitmq.com>
References: <4F22929F.2050801@gmail.com> <4F22A81F.6050405@rabbitmq.com>
Message-ID: <4F22AA1B.3060507@gmail.com>

Another sequence of commands to leave cluster leads to the same results:
[root at epbyminw2482t2]# rabbitmqctl stop_app && rabbitmqctl reset && 
rabbitmqctl start_app

On 01/27/2012 04:35 PM, Simon MacMullen wrote:
> On 27/01/12 12:03, Artsiom Gulin wrote:
>> [root at epbyminw2482t2]# rabbitmqctl stop_app && rabbitmqctl cluster
>> wosnfs@`hostname -s` && rabbitmqctl reset && rabbitmqctl start_app
>
> So it looks like you are leaving the cluster and then resetting, 
> rather than the other way around (which is more normal). It looks like 
> the request to leave the cluster gets ignored in this case. I'll file 
> a bug.
>
> Cheers, Simon
>


From simon at rabbitmq.com  Fri Jan 27 13:45:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jan 2012 13:45:36 +0000
Subject: [rabbitmq-discuss] Disc node clustering
In-Reply-To: <4F22AA1B.3060507@gmail.com>
References: <4F22929F.2050801@gmail.com> <4F22A81F.6050405@rabbitmq.com>
	<4F22AA1B.3060507@gmail.com>
Message-ID: <4F22AA80.5040407@rabbitmq.com>

On 27/01/12 13:43, Artsiom Gulin wrote:
> Another sequence of commands to leave cluster leads to the same results:
> [root at epbyminw2482t2]# rabbitmqctl stop_app && rabbitmqctl reset &&
> rabbitmqctl start_app

Hmm - I can't replicate that one.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Jim.Langston at compuware.com  Fri Jan 27 13:50:03 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Fri, 27 Jan 2012 13:50:03 +0000
Subject: [rabbitmq-discuss] Erlang 14 -> 15
In-Reply-To: <4F22963F.5090802@rabbitmq.com>
Message-ID: <CB48134B.ED5F%jim.langston@compuware.com>

Hi Emile,

For RHEL6, you need to find a version of erlang that
will install. The documented repo pointer is for 14B
and for RHEL5, which is why it fails for RHEL6, google for:

erlang-hipe-R14B-04.1.el6.x86_64.rpm

This will get you to several locations which have
a version of erlang 14B that will install on RHEL6.

I have not found a version of R15B yet, but I did pull
the 15B source from erlang yesterday and it did build
successfully. I have not installed and tested it yet.
At this point, I don't if it is worth the effort to get
on 15B since you indicated there are no performance gains,
and you are not making use of any new 15B functionality.

Jim


On 1/27/12 7:19 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi Jim,
>
>On 27/01/12 11:17, Emile Joubert wrote:
>> On 26/01/12 19:27, Langston, Jim wrote:
>>> the peter repo has 14B, and is a not a good repo for RHEL 6,
>>> is 15B available for a repo pull, or do I need to go to Erlang
>> 
>> Can you explain the difficulty with the EPEL repository that hosts
>> Erlang R14B?
>
>Apologies, it has just been pointed out to me that this repo
>http://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo
>doesn't work with RHEL 6. The instructions here:
>http://www.rabbitmq.com/install-rpm.html
>indicate that you should use EPEL, which has a sufficiently recent
>version of Erlang.
>
>
>
>-Emile
>
>


http://www.compuware.com/
The contents of this e-mail are intended for the named addressee only. It contains information that may be confidential. Unless you are the named addressee or an authorized designee, you may not copy or use it, or disclose it to anyone else. If you received it in error please notify us immediately and then destroy it.


From u2.storm at gmail.com  Fri Jan 27 13:56:54 2012
From: u2.storm at gmail.com (Artsiom Gulin)
Date: Fri, 27 Jan 2012 16:56:54 +0300
Subject: [rabbitmq-discuss] Disc node clustering
In-Reply-To: <4F22AA80.5040407@rabbitmq.com>
References: <4F22929F.2050801@gmail.com> <4F22A81F.6050405@rabbitmq.com>
	<4F22AA1B.3060507@gmail.com> <4F22AA80.5040407@rabbitmq.com>
Message-ID: <4F22AD26.9050105@gmail.com>

I've tried one more sequence:
stop_app, reset, cluster with itselt, start_app.

other broker(s), that joined in cluster via above mentioned are not able 
to restart successfully.

Maybe I do something wrong?



From rob_sutherland at alumni.uwaterloo.ca  Fri Jan 27 14:05:11 2012
From: rob_sutherland at alumni.uwaterloo.ca (Rob Sutherland)
Date: Fri, 27 Jan 2012 06:05:11 -0800 (PST)
Subject: [rabbitmq-discuss] Stuck log rotation in linux?
In-Reply-To: <4F228FCB.1030402@rabbitmq.com>
References: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>
	<4F228FCB.1030402@rabbitmq.com>
Message-ID: <e5f110f4-12ea-4c98-856e-b63ecda13fc9@m2g2000vbc.googlegroups.com>

Simon,

I will try your suggestion.

Thanks,

Rob

On Jan 27, 6:51?am, Simon MacMullen <si... at rabbitmq.com> wrote:

>  The logrotate configuration
> file pipes the output of that command to /dev/null - can you redirect it
> somewhere else so we can see what it's doing?

From victor.poon at amd.com  Fri Jan 27 15:40:55 2012
From: victor.poon at amd.com (victor.poon at amd.com)
Date: Fri, 27 Jan 2012 07:40:55 -0800 (PST)
Subject: [rabbitmq-discuss] Add RabbitMQ Binding to existing Application
	Config
Message-ID: <9d8dd653-b930-4b1a-9fa4-904031930d9d@h3g2000yqe.googlegroups.com>

I am using
RaabitMQ 2.7.1 under .Net 4.0 , Visual Studio 2010 Ultimate.

I copied the WCF config file from your HelloWorld examcple under wcf
folder.
However, when I try to edit WCF configuration file using
It complains that rabbitmqbinding could not be found. I point it back
to RabbitMQ.ServiceModel.dll under
my folder C:\Users\vpoon\Downloads\rabbitmq-dotnet-client-2.7.1-
dotnet-3.0\bin.

But it compalins that the assmbly is not valid.

Any idea? I tried reload the zip from web site again and it still got
the same error.

From emile at rabbitmq.com  Fri Jan 27 15:59:27 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 27 Jan 2012 15:59:27 +0000
Subject: [rabbitmq-discuss] Add RabbitMQ Binding to existing Application
 Config
In-Reply-To: <9d8dd653-b930-4b1a-9fa4-904031930d9d@h3g2000yqe.googlegroups.com>
References: <9d8dd653-b930-4b1a-9fa4-904031930d9d@h3g2000yqe.googlegroups.com>
Message-ID: <4F22C9DF.7060502@rabbitmq.com>

Hi Victor,

On 27/01/12 15:40, victor.poon at amd.com wrote:
> I am using
> RaabitMQ 2.7.1 under .Net 4.0 , Visual Studio 2010 Ultimate.
> 
> I copied the WCF config file from your HelloWorld examcple under wcf
> folder.
> However, when I try to edit WCF configuration file using
> It complains that rabbitmqbinding could not be found. I point it back
> to RabbitMQ.ServiceModel.dll under
> my folder C:\Users\vpoon\Downloads\rabbitmq-dotnet-client-2.7.1-
> dotnet-3.0\bin.
> 
> But it compalins that the assmbly is not valid.

I've not seen that error before. You should be able to use the existing
project structure of the source at
http://hg.rabbitmq.com/rabbitmq-dotnet-client/ as a template for setting
up your own. Do you get a similar error when you open (and upgrade) the
solution file in that repository first?


-Emile

From dan at canddi.com  Fri Jan 27 16:00:18 2012
From: dan at canddi.com (Dan Dart)
Date: Fri, 27 Jan 2012 16:00:18 +0000
Subject: [rabbitmq-discuss] Specifying channel_max
Message-ID: <CAECZ8532=kiArhSW4sq2ERt-ZMuY=biV-wLkJnhhCkhbOE=Ebw@mail.gmail.com>

We're after being able to increase channel_max so that Rabbit can
handle more and not give us errors about not having enough channel
ids.
According to Rabbit documentation on AMQP:

current status in rabbit: planned
Type: MUST
Actor: server
Reference: connection / tune-ok / channel-max / upper-limit	
Text: If the client specifies a channel max that is higher than the
value provided by the server, the server MUST close the connection
without attempting a negotiated close. The server may report the error
in some fashion to assist implementors.

It would seem the server has to specify this too. But it is not
implemented in Rabbit right now.

Am I right? Is there no other way of increasing the load handled and
getting rid of the channel ids problem?

We're using this PHP library which specifies channel_max in
src/main/php/Rabbit/AMQP/Connection.php:69.
The exception we're getting occurs on line 154 of the same file.

https://github.com/Canddi/Zend_RabbitMQ

From simon at rabbitmq.com  Fri Jan 27 16:06:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jan 2012 16:06:04 +0000
Subject: [rabbitmq-discuss] Specifying channel_max
In-Reply-To: <CAECZ8532=kiArhSW4sq2ERt-ZMuY=biV-wLkJnhhCkhbOE=Ebw@mail.gmail.com>
References: <CAECZ8532=kiArhSW4sq2ERt-ZMuY=biV-wLkJnhhCkhbOE=Ebw@mail.gmail.com>
Message-ID: <4F22CB6C.70609@rabbitmq.com>

On 27/01/12 16:00, Dan Dart wrote:
> We're after being able to increase channel_max so that Rabbit can
> handle more and not give us errors about not having enough channel
> ids.
> According to Rabbit documentation on AMQP:

This controls the number of channels allowed per single TCP connection. 
RabbitMQ by default will negotiate a channel_max of 65535 (and in fact 
AMQP won't allow more, it's an unsigned short).

But this is a very rare limit to run into. Are you running into a limit 
on the number of *connections* you can open? This is affected by the 
number of file descriptors available to the user running RabbitMQ - for 
example, on a Debian based system you'll need to edit 
/etc/security/limits.conf.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gmr at myyearbook.com  Fri Jan 27 16:13:08 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 27 Jan 2012 11:13:08 -0500
Subject: [rabbitmq-discuss] Specifying channel_max
In-Reply-To: <CAECZ8532=kiArhSW4sq2ERt-ZMuY=biV-wLkJnhhCkhbOE=Ebw@mail.gmail.com>
References: <CAECZ8532=kiArhSW4sq2ERt-ZMuY=biV-wLkJnhhCkhbOE=Ebw@mail.gmail.com>
Message-ID: <CAL_e=0r=56USmNAGFbGMcKRbO6cu4o0UuAC4OdcEKAwQfT=9sQ@mail.gmail.com>

I would look to minimize your channel usage. There is overhead per-channel
on a connection basis. Having run into issues due to unintentionally having
too many channels open recently, I'd offer that if you can use one channel
on one connection instead of two or more channels on one connection, you
should.

Regards,

Gavin

On Fri, Jan 27, 2012 at 11:00 AM, Dan Dart <dan at canddi.com> wrote:

> We're after being able to increase channel_max so that Rabbit can
> handle more and not give us errors about not having enough channel
> ids.
> According to Rabbit documentation on AMQP:
>
> current status in rabbit: planned
> Type: MUST
> Actor: server
> Reference: connection / tune-ok / channel-max / upper-limit
> Text: If the client specifies a channel max that is higher than the
> value provided by the server, the server MUST close the connection
> without attempting a negotiated close. The server may report the error
> in some fashion to assist implementors.
>
> It would seem the server has to specify this too. But it is not
> implemented in Rabbit right now.
>
> Am I right? Is there no other way of increasing the load handled and
> getting rid of the channel ids problem?
>
> We're using this PHP library which specifies channel_max in
> src/main/php/Rabbit/AMQP/Connection.php:69.
> The exception we're getting occurs on line 154 of the same file.
>
> https://github.com/Canddi/Zend_RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120127/9fa808f1/attachment.htm>

From dseltzer at tveyes.com  Fri Jan 27 16:30:31 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Fri, 27 Jan 2012 11:30:31 -0500
Subject: [rabbitmq-discuss] Uneven file descriptor use on HA Cluster
In-Reply-To: <4F229226.7090408@rabbitmq.com>
References: <2f82902763de2bc896f99d626169d5aa@mail.gmail.com>
	<4F229226.7090408@rabbitmq.com>
Message-ID: <CAHW0W4NV=E4OMSiGuL_myhmcq4tn=DdQFprH-bZ_J3R9DfxjdA@mail.gmail.com>

Hi Simon,

Thanks for the reply.

We have about 20 queues currently holding a total of 1.5 million messages.
New messages come in at around 400 messages/second and stale messages are
removed by TTL. All of the queues are set to x-ha-policy: all.

Given that, I'm not surprised by volume of the File Handles and I've never
once run out of them. So Rabbit is definitely doing something right!

I was just a bit concerned about the discrepancy.

I think I will upgrade to rule out any of the bugs fixed between 2.6.1 and
2.7.1. Is there a way to do a live upgrade of an HA cluster? The
documentation I've read says to Stop Server1, then Stop Server 2. Upgrade
Server1 and Start it, then upgrade Server2 and Start it.

I'm currently running RabbitMQ on Centos, installed from RPMS. Should I
just do an RPM upgrade?
I'm running on Erlang OTP R14B03. Is it important that I update the version
of Erlang I'm running on?

Thanks for your time!

-Dave S

On Fri, Jan 27, 2012 at 7:01 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi.
>
> First of all, a few points: RabbitMQ will try to be smart about its use of
> file descriptors for actual files - while one descriptor will be used for
> each *connection*, it will keep file descriptors open until it starts to
> run out, at which point it will start to swap them.
>
> So seeing high numbers of file descriptors used with low numbers of
> connections open is not a cause to panic - especially if you have lots of
> queues.
>
> Having said that, if you don't have lots of queues then that number of FDs
> used is odd. And the asymmetry is odd too, unless you have lots of
> non-mirrored queues on one node.
>
> What does lsof say?
>
> Finally, lots of bugs got fixed around HA between 2.6.1 and 2.7.1 so it
> might be worth upgrading in case that helps.
>
> Cheers, Simon
>
>
> On 26/01/12 16:04, Dave Seltzer wrote:
>
>> Hello Everyone,
>>
>> My google-fu is failing me, so maybe someone can help me out with an
>> issue I?ve been having.
>>
>> I have two RabbitMQ 2.6.1 servers running on Centos 5.7. The two servers
>> (QueuePool01 and QueuePool02) are running as a cluster as we have a
>> number of durable HA queues. I?m load-balancing client-interactions
>> using HAproxy on a third server.
>>
>> I started noticing that QueuePool02was using ~800 out of 1024 file
>> descriptors (while QueuePool01 was only using ~50). So to decrease the
>> risk of running out of descriptors I increase the number to 4096 and
>> restarted the node.
>>
>> Now, again I see the number of file descriptors on QueuePool02
>> increasing even though QueuePool01 is remaining steady. Is it possible
>> there is some sort of leak? Should the two servers tend to use the same
>> number of file descriptors?
>>
>> Here is what the current load looks like
>>
>> Dave S
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Dave Seltzer <dseltzer at tveyes.com>
Chief Systems Architect
TVEyes
(203) 254-3600 x222
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120127/2d37cd47/attachment.htm>

From roberts.john at gmail.com  Fri Jan 27 17:06:17 2012
From: roberts.john at gmail.com (jrob)
Date: Fri, 27 Jan 2012 09:06:17 -0800 (PST)
Subject: [rabbitmq-discuss] Uneven file descriptor use on HA Cluster
In-Reply-To: <CAHW0W4NV=E4OMSiGuL_myhmcq4tn=DdQFprH-bZ_J3R9DfxjdA@mail.gmail.com>
References: <2f82902763de2bc896f99d626169d5aa@mail.gmail.com>
	<4F229226.7090408@rabbitmq.com>
	<CAHW0W4NV=E4OMSiGuL_myhmcq4tn=DdQFprH-bZ_J3R9DfxjdA@mail.gmail.com>
Message-ID: <24859168.1711.1327683977477.JavaMail.geo-discussion-forums@prdh15>

Hello,

Is it possible that the proxy is not handing out connections in a balanced 
manner as well?  I'm interested to see what happens when you upgrade, as I 
seem to recall this same issue when I was testing our HAProxy, 3 node 
cluster set up...  I need to spin up the VMs again and see if I'm 
remembering correctly, but I know we're testing this setup with 2.7.1...

- jrob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120127/69ccbc56/attachment.htm>

From simon at rabbitmq.com  Fri Jan 27 17:07:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jan 2012 17:07:13 +0000
Subject: [rabbitmq-discuss] Uneven file descriptor use on HA Cluster
In-Reply-To: <CAHW0W4NV=E4OMSiGuL_myhmcq4tn=DdQFprH-bZ_J3R9DfxjdA@mail.gmail.com>
References: <2f82902763de2bc896f99d626169d5aa@mail.gmail.com>	<4F229226.7090408@rabbitmq.com>
	<CAHW0W4NV=E4OMSiGuL_myhmcq4tn=DdQFprH-bZ_J3R9DfxjdA@mail.gmail.com>
Message-ID: <4F22D9C1.6080302@rabbitmq.com>

Hi. I'm afraid there's no way to do a live upgrade; all nodes must run 
the same version of RabbitMQ.

In general we prefer newer Erlang versions but R14B03 -> R15B will not 
make much of a difference.

RPM upgrade should be fine.

Cheers, Simon

On 27/01/12 16:30, Dave Seltzer wrote:
> Hi Simon,
>
> Thanks for the reply.
>
> We have about 20 queues currently holding a total of 1.5 million
> messages. New messages come in at around 400 messages/second and stale
> messages are removed by TTL. All of the queues are set to x-ha-policy: all.
>
> Given that, I'm not surprised by volume of the File Handles and I've
> never once run out of them. So Rabbit is definitely doing something right!
>
> I was just a bit concerned about the discrepancy.
>
> I think I will upgrade to rule out any of the bugs fixed between 2.6.1
> and 2.7.1. Is there a way to do a live upgrade of an HA cluster? The
> documentation I've read says to Stop Server1, then Stop Server 2.
> Upgrade Server1 and Start it, then upgrade Server2 and Start it.
>
> I'm currently running RabbitMQ on Centos, installed from RPMS. Should I
> just do an RPM upgrade?
> I'm running on Erlang OTP R14B03. Is it important that I update the
> version of Erlang I'm running on?
>
> Thanks for your time!
>
> -Dave S
>
> On Fri, Jan 27, 2012 at 7:01 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi.
>
>     First of all, a few points: RabbitMQ will try to be smart about its
>     use of file descriptors for actual files - while one descriptor will
>     be used for each *connection*, it will keep file descriptors open
>     until it starts to run out, at which point it will start to swap them.
>
>     So seeing high numbers of file descriptors used with low numbers of
>     connections open is not a cause to panic - especially if you have
>     lots of queues.
>
>     Having said that, if you don't have lots of queues then that number
>     of FDs used is odd. And the asymmetry is odd too, unless you have
>     lots of non-mirrored queues on one node.
>
>     What does lsof say?
>
>     Finally, lots of bugs got fixed around HA between 2.6.1 and 2.7.1 so
>     it might be worth upgrading in case that helps.
>
>     Cheers, Simon
>
>
>     On 26/01/12 16:04, Dave Seltzer wrote:
>
>         Hello Everyone,
>
>         My google-fu is failing me, so maybe someone can help me out with an
>         issue I?ve been having.
>
>         I have two RabbitMQ 2.6.1 servers running on Centos 5.7. The two
>         servers
>         (QueuePool01 and QueuePool02) are running as a cluster as we have a
>         number of durable HA queues. I?m load-balancing client-interactions
>         using HAproxy on a third server.
>
>         I started noticing that QueuePool02was using ~800 out of 1024 file
>         descriptors (while QueuePool01 was only using ~50). So to
>         decrease the
>         risk of running out of descriptors I increase the number to 4096 and
>         restarted the node.
>
>         Now, again I see the number of file descriptors on QueuePool02
>         increasing even though QueuePool01 is remaining steady. Is it
>         possible
>         there is some sort of leak? Should the two servers tend to use
>         the same
>         number of file descriptors?
>
>         Here is what the current load looks like
>
>         Dave S
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>
> --
> Dave Seltzer <mailto:dseltzer at tveyes.com>
> Chief Systems Architect
> TVEyes
> (203) 254-3600 x222
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 27 17:08:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Jan 2012 17:08:08 +0000
Subject: [rabbitmq-discuss] Uneven file descriptor use on HA Cluster
In-Reply-To: <24859168.1711.1327683977477.JavaMail.geo-discussion-forums@prdh15>
References: <2f82902763de2bc896f99d626169d5aa@mail.gmail.com>	<4F229226.7090408@rabbitmq.com>	<CAHW0W4NV=E4OMSiGuL_myhmcq4tn=DdQFprH-bZ_J3R9DfxjdA@mail.gmail.com>
	<24859168.1711.1327683977477.JavaMail.geo-discussion-forums@prdh15>
Message-ID: <4F22D9F8.40500@rabbitmq.com>

On 27/01/12 17:06, jrob wrote:
> Is it possible that the proxy is not handing out connections in a
> balanced manner as well?

The image Dave posted showed that very few of the file descriptors we 
going on connections.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dan at canddi.com  Fri Jan 27 17:12:14 2012
From: dan at canddi.com (Dan Dart)
Date: Fri, 27 Jan 2012 17:12:14 +0000
Subject: [rabbitmq-discuss] Specifying channel_max
In-Reply-To: <CAL_e=0r=56USmNAGFbGMcKRbO6cu4o0UuAC4OdcEKAwQfT=9sQ@mail.gmail.com>
References: <CAECZ8532=kiArhSW4sq2ERt-ZMuY=biV-wLkJnhhCkhbOE=Ebw@mail.gmail.com>
	<CAL_e=0r=56USmNAGFbGMcKRbO6cu4o0UuAC4OdcEKAwQfT=9sQ@mail.gmail.com>
Message-ID: <CAECZ853jcTo9Paiiy7g5veCBDm-DLCkzRweEFi9DydWmjw0xdQ@mail.gmail.com>

> But this is a very rare limit to run into.

Do you know why we might be hitting it?

> Are you running into a limit on the number of *connections* you can open?
Maybe so - we are just hitting it a lot - we have one IP sending stuff
constantly - but we don't have anything like "keepalive" so it's
trying to make a new connection each time.
Is this what's killing it? Can we just raise ulimit and you think it'll fix it?

From djacobfeuerborn at gmail.com  Fri Jan 27 17:25:45 2012
From: djacobfeuerborn at gmail.com (Dennis Jacobfeuerborn)
Date: Fri, 27 Jan 2012 09:25:45 -0800 (PST)
Subject: [rabbitmq-discuss] beam.smp memory consumption keeps growing
In-Reply-To: <4F1EA28B.5030605@rabbitmq.com>
References: <14792372.1644.1327005193049.JavaMail.geo-discussion-forums@vbek1>	<32499241.696.1327006107121.JavaMail.geo-discussion-forums@vbfy15>	<4F196036.3050708@rabbitmq.com>	<2537050.301.1327078732894.JavaMail.geo-discussion-forums@vbiq27>	<4F1D43CB.2070709@rabbitmq.com>	<5955234.1287.1327339099047.JavaMail.geo-discussion-forums@vbed2>	<4F1DAFA3.9090809@rabbitmq.com>	<24758975.860.1327358063919.JavaMail.geo-discussion-forums@vbue14>
	<4F1E9EC1.5020107@rabbitmq.com> <4F1EA28B.5030605@rabbitmq.com>
Message-ID: <11165447.763.1327685146255.JavaMail.geo-discussion-forums@vbcj7>

After adding the "export ERL_FULLSWEEP_AFTER=10" I still see node1 sitting 
there with a consumption of 400mb after all messages have been consumed and 
the system being idle. Once I stop node2 though a short while later the 
consumption on node1 will drop to 40mb which is what I would expect.

Regards,
  Dennis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120127/f550e7ec/attachment.htm>

From christopher.grebs at native-instruments.de  Fri Jan 27 17:49:05 2012
From: christopher.grebs at native-instruments.de (Christopher Grebs)
Date: Fri, 27 Jan 2012 18:49:05 +0100
Subject: [rabbitmq-discuss] Problem in high availability setup together with
	corosync
Message-ID: <4F22E391.5060908@native-instruments.de>

Hey there,

today we experimented with some high availability setup featuring 
RabbitMQ + HA-Queues and Corosync.  Currently we have this setup:

  * 2 nodes named mq01ha and mq02ha

Both nodes have ha-ip addresses that move to the other node that is not 
down so that all services can proceed, no matter to what node they are 
connected.

Our test scenario:

One producer is pushing to mq01ha and one consumer is consuming from 
mq01ha, the consumer is a bit slower so that messages pile up unacked.

Now we kill mq01ha by pusing the virtual power button (virtual maschines 
are great!), corosync moves the ip from mq01ha to mq02ha and the 
consumers and producers proceed with their work.  This works great and 
everything is fine again.

Now (and this is the part where I need your knowledge) we currently have 
the setup that if mq01 starts up again the ip address moves back to mq01.

Now mq01 is back up, all consumers and producers are proceeding with 
their work.  But unfortunately in mq01 and mq02 all messages that were 
unacked while mq01 gone down are still unacked and there is some not 
existing connection open in the connections view on rabbitmq. This is 
true for both, the web interface and for rabbitmqctl. Even if I shutdown 
all consumers and producers this connection exists, so it's not related 
to any real TCP connection.

I think that rabbitmq is not designed for this kind of scenario, but 
maybe you can tell me more about what rabbitmq does.  Maybe we found 
some bug, I don't know.

What we are now planning is a simple setup with only one ha-ip that 
moves from host to host only in failover so that - in theory - 
everything should work properly again.  But we have to check if then 
again we have the problem that unacked messages stay unacked.

Hopefully I described this stuff clear enough :)


Thanks!

Cheers,
Christopher.

-- 
Christopher Grebs
Data Processing Developer

Tel +49-30-611035-1664
Fax -49-30-611035-2652
christopher.grebs at native-instruments.de

NATIVE INSTRUMENTS GmbH
Schlesische Strasse 29-30
10997 Berlin, Germany

http://www.native-instruments.com



***

KOMPLETE 8 ULTIMATE - the premium NI producer collection
=>   http://www.native-instruments.com/komplete8

TRAKTOR KONTROL S2 - the professional 2.1 DJ system
=>   http://www.native-instruments.com/s2

->>>>>>  NATIVE INSTRUMENTS - The Future of Sound<<<<<<-

Registergericht: Amtsgericht Charlottenburg
Registernummer: HRB 72458
UST.-ID.-Nr. DE 20 374 7747

Gesch?ftsf?hrung: Daniel Haver (CEO), Mate Galic


From christopher.grebs at native-instruments.de  Fri Jan 27 17:50:57 2012
From: christopher.grebs at native-instruments.de (Christopher Grebs)
Date: Fri, 27 Jan 2012 18:50:57 +0100
Subject: [rabbitmq-discuss] Problem in high availability setup together
 with corosync
In-Reply-To: <4F22E391.5060908@native-instruments.de>
References: <4F22E391.5060908@native-instruments.de>
Message-ID: <4F22E401.9040606@native-instruments.de>

Hey there,

I just missed to say that we are running RabbitMQ 2.7.1.

Regards,
Christopher.

On 01/27/2012 06:49 PM, Christopher Grebs wrote:
> Hey there,
>
> today we experimented with some high availability setup featuring 
> RabbitMQ + HA-Queues and Corosync.  Currently we have this setup:
>
>  * 2 nodes named mq01ha and mq02ha
>
> Both nodes have ha-ip addresses that move to the other node that is 
> not down so that all services can proceed, no matter to what node they 
> are connected.
>
> Our test scenario:
>
> One producer is pushing to mq01ha and one consumer is consuming from 
> mq01ha, the consumer is a bit slower so that messages pile up unacked.
>
> Now we kill mq01ha by pusing the virtual power button (virtual 
> maschines are great!), corosync moves the ip from mq01ha to mq02ha and 
> the consumers and producers proceed with their work.  This works great 
> and everything is fine again.
>
> Now (and this is the part where I need your knowledge) we currently 
> have the setup that if mq01 starts up again the ip address moves back 
> to mq01.
>
> Now mq01 is back up, all consumers and producers are proceeding with 
> their work.  But unfortunately in mq01 and mq02 all messages that were 
> unacked while mq01 gone down are still unacked and there is some not 
> existing connection open in the connections view on rabbitmq. This is 
> true for both, the web interface and for rabbitmqctl. Even if I 
> shutdown all consumers and producers this connection exists, so it's 
> not related to any real TCP connection.
>
> I think that rabbitmq is not designed for this kind of scenario, but 
> maybe you can tell me more about what rabbitmq does.  Maybe we found 
> some bug, I don't know.
>
> What we are now planning is a simple setup with only one ha-ip that 
> moves from host to host only in failover so that - in theory - 
> everything should work properly again.  But we have to check if then 
> again we have the problem that unacked messages stay unacked.
>
> Hopefully I described this stuff clear enough :)
>
>
> Thanks!
>
> Cheers,
> Christopher.
>


-- 
Christopher Grebs
Data Processing Developer

Tel +49-30-611035-1664
Fax -49-30-611035-2652
christopher.grebs at native-instruments.de

NATIVE INSTRUMENTS GmbH
Schlesische Strasse 29-30
10997 Berlin, Germany

http://www.native-instruments.com



***

KOMPLETE 8 ULTIMATE - the premium NI producer collection
=>   http://www.native-instruments.com/komplete8

TRAKTOR KONTROL S2 - the professional 2.1 DJ system
=>   http://www.native-instruments.com/s2

->>>>>>  NATIVE INSTRUMENTS - The Future of Sound<<<<<<-

Registergericht: Amtsgericht Charlottenburg
Registernummer: HRB 72458
UST.-ID.-Nr. DE 20 374 7747

Gesch?ftsf?hrung: Daniel Haver (CEO), Mate Galic


From rob_sutherland at alumni.uwaterloo.ca  Fri Jan 27 21:21:40 2012
From: rob_sutherland at alumni.uwaterloo.ca (Rob Sutherland)
Date: Fri, 27 Jan 2012 13:21:40 -0800 (PST)
Subject: [rabbitmq-discuss] Stuck log rotation in linux?
In-Reply-To: <e5f110f4-12ea-4c98-856e-b63ecda13fc9@m2g2000vbc.googlegroups.com>
References: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>
	<4F228FCB.1030402@rabbitmq.com>
	<e5f110f4-12ea-4c98-856e-b63ecda13fc9@m2g2000vbc.googlegroups.com>
Message-ID: <2eaaf2b5-f7d6-41a9-b6ec-bcf2fac9630b@j14g2000vba.googlegroups.com>

OK, I finally figured out what was going on. If rabbitmq-server is NOT
running, the postrotate action will start up the service. Not as a
spawned process but directly from logrotate. The logrotate process
will wait for the server to stop which is rather pointless. In my
opinion, the postrotate action should check for that condition. What
if log rotation occurs during scheduled maintenance when the server
isn't running?

From preetisp_83 at yahoo.com  Sat Jan 28 08:16:12 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Sat, 28 Jan 2012 00:16:12 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <CAM8fPiQtXcXm8R-ih4KwG9ETx0h8e+L+TbeeiacQR1C6k9gmUg@mail.gmail.com>
Message-ID: <1327738572.59767.YahooMailClassic@web39303.mail.mud.yahoo.com>

Hi

I need some help.

I want to perform RabbitMQ Installation on Ubuntu 11.10 and RHEL 5. If I try to Install RabbitMQ Ubuntu debian package or RabbitMQ RHEL rpm package, I am required to have root access. 

I do not have root access to Perform Installation. If I Install generic unix tar version (which probably does not require root privilege or does it ?), will I have any Issues going forward by Installing a generic unix tax version or is it as good as Installing rpm/deb packages?

Are there any differences in tar/deb/rpm version Installable meant for specific Operation Systems? Please confirm!

Thanks,
Preeti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120128/9927f91a/attachment.htm>

From pbell at syncsort.com  Sat Jan 28 16:40:33 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sat, 28 Jan 2012 11:40:33 -0500
Subject: [rabbitmq-discuss] Securing RabbitMQ
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>

Hello again,



I have started reading http://www.rabbitmq.com/ssl.html, and it looks....reassuring. :)



Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a "roll your own" approach.



I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.



Thanks.



-Paul

________________________________


ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120128/b81ff427/attachment.htm>

From alexandru at rabbitmq.com  Sat Jan 28 17:11:56 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Sat, 28 Jan 2012 17:11:56 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
Message-ID: <20120128171156.GD3692@southbank.Home>

Hi Paul,

> Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a "roll your own" approach.

No, there isn't any in-built RabbitMQ feature to encrypt at-rest
messages.  You'll have to roll your own.  As a rule, RabbitMQ does *not*
modify (or inspect) the contents of received messages.

If you use SSL on both the producer and consumer sides, the only way for
an attacker to get the messages would be to gain access to machine
hosting RabbitMQ or to the network the RabbitMQ cluster is running on
(if there is a cluster).

So, are you planning against an attacker who has gotten his hands on an
offline machine with RabbitMQ on it?  I haven't tried, but I suppose you
could use an encrypted file system.  RabbitMQ stores messages and state
only in its mnesia database directory, so if you encrypt that, you
should be secure.

> I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.

I'm not quite sure I follow.  Could you elaborate?

Cheers,
Alex


On Sat, Jan 28, 2012 at 11:40:33AM -0500, Bell, Paul M. wrote:
> Hello again,
> 
> 
> 
> I have started reading http://www.rabbitmq.com/ssl.html, and it looks....reassuring. :)
> 
> 
> 
> Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a "roll your own" approach.
> 
> 
> 
> I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.
> 
> 
> 
> Thanks.
> 
> 
> 
> -Paul
> 
> ________________________________
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From preetisp_83 at yahoo.com  Sun Jan 29 04:56:26 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Sat, 28 Jan 2012 20:56:26 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <1327738572.59767.YahooMailClassic@web39303.mail.mud.yahoo.com>
Message-ID: <1327812986.34796.YahooMailClassic@web39301.mail.mud.yahoo.com>

Can anyone help answer below query?

Thanks,
Preeti

--- On Sat, 1/28/12, preeti sp <preetisp_83 at yahoo.com> wrote:

From: preeti sp <preetisp_83 at yahoo.com>
Subject: RabbitMQ Installation as non-root user
To: "Tony Garnock-Jones" <tonygarnockjones+rabbitmq at gmail.com>
Cc: "RabbitMQ Discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Date: Saturday, January 28, 2012, 12:16 AM

Hi

I need some help.

I want to perform RabbitMQ Installation on Ubuntu 11.10 and RHEL 5. If I try to Install RabbitMQ Ubuntu debian package or RabbitMQ RHEL rpm package, I am required to have root access. 

I do not have root access to Perform Installation. If I Install generic unix tar version (which probably does not require root privilege or does it ?), will I have any Issues going forward by Installing a generic unix tax version or is it as good as Installing rpm/deb packages?

Are there any differences in tar/deb/rpm version Installable meant for specific Operation Systems? Please confirm!

Thanks,
Preeti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120128/96e5528f/attachment.htm>

From syst3m.w0rm at gmail.com  Sun Jan 29 14:08:50 2012
From: syst3m.w0rm at gmail.com (Aamir Khan)
Date: Sun, 29 Jan 2012 19:38:50 +0530
Subject: [rabbitmq-discuss] Pika + Tornado Example
Message-ID: <CAOb12VUyb2DE-Qe26ynT_uvANZJjNv9K7=oQUBYJZYPJNFdvGg@mail.gmail.com>

Hi

I am trying to implement Pub/Sub model using Pika and Tornado. First step
is to create queues with random names assigned by rabbitMQ. I have tried to
change the code of demo_tornado.py[0] little bit so as to have random queue
names. But it didn't work.
My changed source code is here[1].

[0] => https://github.com/pika/pika/blob/master/examples/demo_tornado.py
[1] =>
https://github.com/syst3mw0rm/pika/blob/master/examples/demo_tornado.py

Am i doing something wrong ?




Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120129/c702d126/attachment.htm>

From pbell at syncsort.com  Sun Jan 29 16:58:25 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sun, 29 Jan 2012 11:58:25 -0500
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <20120128171156.GD3692@southbank.Home>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>,
	<20120128171156.GD3692@southbank.Home>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>

Hi Alex,

Thanks very much for your instructive reply.

By way of background, I am working on a layered architecture. One of these layers, sitting just above the business services, is an AMQP consumer as it faces up. Facing down, it is a REST web service client. Suppose that the enqueued messages look pretty much like RESTful URIs (e.g., http://<host>:<port>/<appContextPath>/users meaning something like "return a list of users"). The consumer pulls such a message and presents it via customary servlet container infrastructure (e.g., Tomcat + Spring) to the appropriate business service where the real work is done.

Such messages were produced in the first place by an authenticated user at a UI. (It is interesting to me that, despite the significant advantages of decoupling layers via a queue, the queue itself becomes almost like another login point. That is, just as input can come from the UI, input can come also from the queue.) Ideally, only an authenticated user (or process) can place messages into the queue. And that's where one of the security issues arises.

If an attacker has access to queue storage (the Mnesia directory?) he might be able to deconstruct the clear text messages and reconstruct spurious messages of his own making. If he then had access to RabbitMQ, i.e., could connect and login to it, he could insert spurious messages into the queue.

So that's why I was thinking along the lines of messages being encrypted in the queue. 

But there are other security issues here: 

a. securing the broker password. I routinely see the "guest/guest" examples where the password is stored in code. I know these are examples and, as such, provide needful and simple instruction. But in the real world, we can't be storing passwords in code. As usual, the storing/securing of keys and passwords is the hard part of security.

b. then there's the matter of the web services themselves: they are, presumably, publicly accessible via  a web browser. If you know the URL you can try to invoke these services, whether or not you put anything in the queue via an authenticated log in.

I would like to hear your and others' thoughts about these issues.

Thanks again.

-Paul 
________________________________________
From: Alexandru Scvor?ov [scvalex at gmail.com] On Behalf Of Alexandru Scvor?ov [alexandru at rabbitmq.com]
Sent: Saturday, January 28, 2012 12:11 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Securing RabbitMQ

Hi Paul,

> Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a "roll your own" approach.

No, there isn't any in-built RabbitMQ feature to encrypt at-rest
messages.  You'll have to roll your own.  As a rule, RabbitMQ does *not*
modify (or inspect) the contents of received messages.

If you use SSL on both the producer and consumer sides, the only way for
an attacker to get the messages would be to gain access to machine
hosting RabbitMQ or to the network the RabbitMQ cluster is running on
(if there is a cluster).

So, are you planning against an attacker who has gotten his hands on an
offline machine with RabbitMQ on it?  I haven't tried, but I suppose you
could use an encrypted file system.  RabbitMQ stores messages and state
only in its mnesia database directory, so if you encrypt that, you
should be secure.

> I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.

I'm not quite sure I follow.  Could you elaborate?

Cheers,
Alex


On Sat, Jan 28, 2012 at 11:40:33AM -0500, Bell, Paul M. wrote:
> Hello again,
>
>
>
> I have started reading http://www.rabbitmq.com/ssl.html, and it looks....reassuring. :)
>
>
>
> Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a "roll your own" approach.
>
>
>
> I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.
>
>
>
> Thanks.
>
>
>
> -Paul
>
> ________________________________
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at myyearbook.com  Sun Jan 29 17:04:34 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 29 Jan 2012 12:04:34 -0500
Subject: [rabbitmq-discuss] Pika + Tornado Example
In-Reply-To: <CAOb12VUyb2DE-Qe26ynT_uvANZJjNv9K7=oQUBYJZYPJNFdvGg@mail.gmail.com>
References: <CAOb12VUyb2DE-Qe26ynT_uvANZJjNv9K7=oQUBYJZYPJNFdvGg@mail.gmail.com>
Message-ID: <FE39F9CED6C346E0AB48F73D291EDFEE@myyearbook.com>

Looping in from an off-list discussion, the solution was to move the queue name assignment to the on_queue_declared method (line 83 of Aamir's code) using the frame object passed into the function to get the queue name from the method frame object associated with the frame argument. 


On Sunday, January 29, 2012 at 9:08 AM, Aamir Khan wrote:

> Hi
> 
> I am trying to implement Pub/Sub model using Pika and Tornado. First step is to create queues with random names assigned by rabbitMQ. I have tried to change the code of demo_tornado.py[0] little bit so as to have random queue names. But it didn't work.
> My changed source code is here[1].
> 
> [0] => https://github.com/pika/pika/blob/master/examples/demo_tornado.py 
> [1] => https://github.com/syst3mw0rm/pika/blob/master/examples/demo_tornado.py
> 
> Am i doing something wrong ?
> 
> 
> 
> 
> Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120129/3aa6b0aa/attachment.htm>

From alexandru at rabbitmq.com  Sun Jan 29 20:23:48 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Sun, 29 Jan 2012 20:23:48 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
Message-ID: <20120129202348.GI3692@southbank.Home>

Hi Paul,

Cool architecture.

> If an attacker has access to queue storage (the Mnesia directory?) 

Yes, the queues are stored in the Mnesia directory (but they're not
really a Mnesia database; it doesn't matter in this case).

> If an attacker has access to queue storage (the Mnesia directory?) he might be able to deconstruct the clear text messages and reconstruct spurious messages of his own making. 

I'd like to point out that if he actually has access to the machine and
rabbitmq account (and not just the disk), he could do a lot worse; for
instance, he could stop RabbitMQ, reconfigure it or replace it with
something else; or he could create new RabbitMQ users to facilitate
further attacks.  I don't think there's much you could do in this
situation.

If you're just protecting the disks, an encrypted file system is
probably the way to go.

> If he then had access to RabbitMQ, i.e., could connect and login to it, he could insert spurious messages into the queue.

Ok, I see.

> But there are other security issues here: 
> 
> a. securing the broker password. I routinely see the "guest/guest" examples where the password is stored in code. I know these are examples and, as such, provide needful and simple instruction. But in the real world, we can't be storing passwords in code. As usual, the storing/securing of keys and passwords is the hard part of security.

You could just not use passwords.  If you use SSL connections, RabbitMQ
can authenticate users by the certificate they provide.

See the auth-mechanism-ssl plugin for details:
  http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README

If you still decide to use username/passwords, you could make the system
more flexible by delegating the task of authenticating users to an LDAP
server.  See the auth-backend-ldap plugin for details:
  http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/default/README

These don't solve the problem, but they make it a lot harder for an
attacker to forge user credentials.

That said, yes, securing credentials on user's systems is hard.  But is
RabbitMQ dealing with users directly here?  My understanding is that
your broker only talks to consumers that are under your control (and are
driven by events from the REST web service).  So you'd only have to
authenticate the consumers (let's call them clients from now on) and 
trust that they speak on behalf of users.

I don't think there's much you can do preventively in order to stop
a compromised consumer from sending spurious messages to the queues.
You could use the access control features to limit the damage an attacker
could cause.  See the access control guide for more details:
  http://www.rabbitmq.com/access-control.html

If it's acceptable, you could also set a TTL for messages on the queues.
That way, RabbitMQ will discard messages not consumed in some time-frame
(this is giving in to the DoS, but at least it limits the extent of the
overloaded services):
  http://www.rabbitmq.com/extensions.html#lifetimes

> b. then there's the matter of the web services themselves: they are, presumably, publicly accessible via  a web browser. If you know the URL you can try to invoke these services, whether or not you put anything in the queue via an authenticated log in.

No comments on that.  The web messaging people would be more qualified
to comment.

Cheers,
Alex

On Sun, Jan 29, 2012 at 11:58:25AM -0500, Bell, Paul M. wrote:
> Hi Alex,
> 
> Thanks very much for your instructive reply.
> 
> By way of background, I am working on a layered architecture. One of these layers, sitting just above the business services, is an AMQP consumer as it faces up. Facing down, it is a REST web service client. Suppose that the enqueued messages look pretty much like RESTful URIs (e.g., http://<host>:<port>/<appContextPath>/users meaning something like "return a list of users"). The consumer pulls such a message and presents it via customary servlet container infrastructure (e.g., Tomcat + Spring) to the appropriate business service where the real work is done.
> 
> Such messages were produced in the first place by an authenticated user at a UI. (It is interesting to me that, despite the significant advantages of decoupling layers via a queue, the queue itself becomes almost like another login point. That is, just as input can come from the UI, input can come also from the queue.) Ideally, only an authenticated user (or process) can place messages into the queue. And that's where one of the security issues arises.
> 
> If an attacker has access to queue storage (the Mnesia directory?) he might be able to deconstruct the clear text messages and reconstruct spurious messages of his own making. If he then had access to RabbitMQ, i.e., could connect and login to it, he could insert spurious messages into the queue.
> 
> So that's why I was thinking along the lines of messages being encrypted in the queue. 
> 
> But there are other security issues here: 
> 
> a. securing the broker password. I routinely see the "guest/guest" examples where the password is stored in code. I know these are examples and, as such, provide needful and simple instruction. But in the real world, we can't be storing passwords in code. As usual, the storing/securing of keys and passwords is the hard part of security.
> 
> b. then there's the matter of the web services themselves: they are, presumably, publicly accessible via  a web browser. If you know the URL you can try to invoke these services, whether or not you put anything in the queue via an authenticated log in.
> 
> I would like to hear your and others' thoughts about these issues.
> 
> Thanks again.
> 
> -Paul 
> ________________________________________
> From: Alexandru Scvor?ov [scvalex at gmail.com] On Behalf Of Alexandru Scvor?ov [alexandru at rabbitmq.com]
> Sent: Saturday, January 28, 2012 12:11 PM
> To: Bell, Paul M.
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Securing RabbitMQ
> 
> Hi Paul,
> 
> > Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a "roll your own" approach.
> 
> No, there isn't any in-built RabbitMQ feature to encrypt at-rest
> messages.  You'll have to roll your own.  As a rule, RabbitMQ does *not*
> modify (or inspect) the contents of received messages.
> 
> If you use SSL on both the producer and consumer sides, the only way for
> an attacker to get the messages would be to gain access to machine
> hosting RabbitMQ or to the network the RabbitMQ cluster is running on
> (if there is a cluster).
> 
> So, are you planning against an attacker who has gotten his hands on an
> offline machine with RabbitMQ on it?  I haven't tried, but I suppose you
> could use an encrypted file system.  RabbitMQ stores messages and state
> only in its mnesia database directory, so if you encrypt that, you
> should be secure.
> 
> > I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.
> 
> I'm not quite sure I follow.  Could you elaborate?
> 
> Cheers,
> Alex
> 
> 
> On Sat, Jan 28, 2012 at 11:40:33AM -0500, Bell, Paul M. wrote:
> > Hello again,
> >
> >
> >
> > I have started reading http://www.rabbitmq.com/ssl.html, and it looks....reassuring. :)
> >
> >
> >
> > Is there any in-built support for encrypting/decrypting the at-rest messages in the queue? I suppose that producer could encrypt and consumer decrypt. But I was hoping to avoid a "roll your own" approach.
> >
> >
> >
> > I am trying to think about a rogue producer injecting meaningful messages into the queue, i.e., a message whose processing might return a valuable data resource. Then there's also the need to prevent someone from inspecting the queue with an eye to reverse-engineering message syntax.
> >
> >
> >
> > Thanks.
> >
> >
> >
> > -Paul
> >
> > ________________________________
> >
> >
> > ATTENTION: -----
> >
> > The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From codevally at gmail.com  Mon Jan 30 01:47:28 2012
From: codevally at gmail.com (Codevally)
Date: Sun, 29 Jan 2012 17:47:28 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ cluster issue
Message-ID: <a7ef542f-1747-40ca-90c1-a414f74fec34@3g2000pbd.googlegroups.com>

Hi

I have a 2 node RabbitMQ cluster and want to add another node to it.
All 3 nodes are running on Linux.

The rabbit at app1 and rabbit at app2 are already in the cluster and working
fine. I want to integrate rabbit at app9 as well to the cluster.

rabbit at app9 is working file in the standalone mode, but if I follow
the below commands, it says "Error: {no_running_cluster_nodes,
[rabbit at app1],[rabbit at app1]}".


From preetisp_83 at yahoo.com  Mon Jan 30 03:15:07 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Sun, 29 Jan 2012 19:15:07 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <1327812986.34796.YahooMailClassic@web39301.mail.mud.yahoo.com>
Message-ID: <1327893307.28451.YahooMailClassic@web39305.mail.mud.yahoo.com>

Is there any way to Install RHEL RabbitMQ RPM Package with a non-root user? And, Ubuntu RabbitMQ DEB Package with a non-root user?
Thanks,Preeti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120129/52782be1/attachment.htm>

From yogimogi at gmail.com  Mon Jan 30 04:33:32 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Sun, 29 Jan 2012 20:33:32 -0800 (PST)
Subject: [rabbitmq-discuss] ShutdownSignalException second 'channel.open'
Message-ID: <5fe26671-e654-48e6-80a6-05a181a8f814@kg1g2000pbb.googlegroups.com>

Only operations I ever do with com.rabbitmq.client.Connection in the
code are
    c.addShutdownListener
    c.createChannel

What does this error signify?

2012-01-30 09:44:45,158 ERROR  [ConnectionShutdownHandler]
ShutdownListener
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
{#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID
- second 'channel.open' seen, class-id=20, method-id=10), null,
"[B at 105691e"}
	at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:
641)
	at
com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection.java:
599)
	at
com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection.java:
571)
	at com.rabbitmq.client.impl.AMQConnection
$1.processAsync(AMQConnection.java:88)
	at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:
144)
	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:
91)
	at com.rabbitmq.client.impl.AMQConnection
$MainLoop.run(AMQConnection.java:500)

Some additional info.
I create and close thousands of channels in the code. But at any point
of time there are not more than 20/21 channels open.
This is how I handle doing basicPublish and basicGet on potentially
non-existent queues
- publish involves 3 steps
  queueDeclare
  queueBind
  basicPublish
  If some other thread deletes the queue after either queueDeclare or
queueBind, basicPublish fails and I again create a new
  channel and do these operations
- if basicGet fails, I simply ignore it

regards, Yogesh

From marcus_rubeus at hotmail.com  Mon Jan 30 06:31:34 2012
From: marcus_rubeus at hotmail.com (MarcusR)
Date: Sun, 29 Jan 2012 22:31:34 -0800 (PST)
Subject: [rabbitmq-discuss] Keeping track of exchanges -- Any Advice
In-Reply-To: <4F16A110.6000205@rabbitmq.com>
References: <ab66f90c-2e4e-49ff-987e-425a493e4b68@t8g2000yqg.googlegroups.com>
	<4F16A110.6000205@rabbitmq.com>
Message-ID: <94a5f80b-b18a-4a7e-aa6f-de7a74cd2f22@m5g2000yqk.googlegroups.com>

Hello Simon, thanks for the response.

I am not really sure to be honest. I am not very familiar with message
brokers and their performance characteristics. I suppose I could have
a topic exchange and then bind queues to various topics... Such as
have a queue for user1.queu1, user2.queue1, user3.queue1, etc

My question is how expensive is routing? Also, regarding the routing,
is it more performant to have one master topic exchange for all the
users or to distribute users across multiple topic exchanges or does
it not matter?

I assume rabbitmq first looks up the exchange and then goes through
each queue to see if there is a match for routing. If this is the
case, I imagine it would be more performant to create a thousand such
topic exchanges and divide all the users across them as opposed to one
topic exchange for all users.


In the end, I plan to run several rabbitmq nodes with a bucket of
users assigned to each rabbit node. Assigning each user to a node
based on a hash. Is this best practice for scaling rabbitmq for this
type of scenerio? Currently rabbitmq is the bottle neck in my
application benchmarks so this was my plan to scale it. Please correct
me if there is a better practice.


On Jan 18, 5:38 am, Simon MacMullen <si... at rabbitmq.com> wrote:
> First of all, can you get the routing you need without every user
> requiring their own exchange? What routing do you need to do?
>
> Cheers, Simon
>
> On 17/01/12 20:27,MarcusRwrote:
>
>
>
>
>
>
>
>
>
> > I have a  setup where I need to use a LOT of unique exchanges /
> > queues.
>
> > To explain. Essentially, think that every "user" has their own
> > exchange and then 3 queues on that exchange. These users may be active
> > for a few minutes to days. The time they exist is unknown (depends on
> > the user). There are hundreds of thousands of users at a time.
> > Periodically, another user may send a message to a user. However, that
> > user may or may not be active (have an exchange / queue associated
> > with it).
>
> > The x-expires feature is great for the queue. If a user is not active
> > in 15 minutes, then all their queues can be deleted. If I set
> > auto_delete on exchanges to be true, it is my understanding that that
> > exchanges will also be deleted once the queues are. Thats great too.
>
> > The problem is when user A sends a message to user B and user B has
> > had their exchange deleted. This will create an error. Ideally, what
> > would happen is rabbitmq would just ignore the message. If the user is
> > not active, then it does not matter if the message just goes to /dev/
> > null.
>
> > Is there a way around this or a way to get the desired behavior? If
> > not, what strategies do people use to determine in real time what
> > exchanges are active or not or what exchanges need to be deleted or
> > not?
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yupeijie1012 at gmail.com  Mon Jan 30 02:10:23 2012
From: yupeijie1012 at gmail.com (=?UTF-8?B?5Z+55p2wIOS/ng==?=)
Date: Sun, 29 Jan 2012 18:10:23 -0800 (PST)
Subject: [rabbitmq-discuss] Client Connection Issue
Message-ID: <af958a95-afb7-40d9-8127-19ff8ec9099f@p12g2000yqe.googlegroups.com>

Hi all,
    I have met a problem; Once I have a client node connection
RabbitMQ server, the connection will be list in the RabbitMQ
management Web UI, and also the corresponding connection could be see
in the server by netstat which state is ESTABLISHED; But while the
client node reboot, the connection still be alive form the RabbitMQ's
view from Web UI and netstat:
tcp        0      0 virt15-njhx-kvm-19:35673    virt15-njhx-
kvm-18:52893    ESTABLISHED 27069/beam.smp      off (0.00/0/0)
   By netstat --timer, the connection's timer is at off state;

   Thus, how to fix this or how to config the timeout value?

Thx

From andrea.rosa at hp.com  Mon Jan 30 09:43:40 2012
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 30 Jan 2012 09:43:40 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <20120129202348.GI3692@southbank.Home>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
Message-ID: <5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>

Hi

>You could just not use passwords.  If you use SSL connections, RabbitMQ
>can authenticate users by the certificate they provide.
>
>See the auth-mechanism-ssl plugin for details:
>  http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README

I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team. 
Is there some news about that?

Cheers
--
Andrea Rosa

From alexandru at rabbitmq.com  Mon Jan 30 10:07:55 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 30 Jan 2012 10:07:55 +0000
Subject: [rabbitmq-discuss] Client Connection Issue
In-Reply-To: <af958a95-afb7-40d9-8127-19ff8ec9099f@p12g2000yqe.googlegroups.com>
References: <af958a95-afb7-40d9-8127-19ff8ec9099f@p12g2000yqe.googlegroups.com>
Message-ID: <20120130100755.GJ3692@southbank.Home>

Hi,

I guess that the problem is that the client didn't close the socket when
rebooting, so the broker won't find out that the client is missing until
it tries to send something to it.

The client should enable heartbeats when connecting to the broker (see
the various heartbeat methods in the connection factory classes).
Heartbeats are empty frames that get sent between the broker and client
periodically; if either doesn't respond to a few heartbeats in a row,
the other knows that the connection has failed for some reason and will
close it.

Cheers,
Alex

On Sun, Jan 29, 2012 at 06:10:23PM -0800, ?? ? wrote:
> Hi all,
>     I have met a problem; Once I have a client node connection
> RabbitMQ server, the connection will be list in the RabbitMQ
> management Web UI, and also the corresponding connection could be see
> in the server by netstat which state is ESTABLISHED; But while the
> client node reboot, the connection still be alive form the RabbitMQ's
> view from Web UI and netstat:
> tcp        0      0 virt15-njhx-kvm-19:35673    virt15-njhx-
> kvm-18:52893    ESTABLISHED 27069/beam.smp      off (0.00/0/0)
>    By netstat --timer, the connection's timer is at off state;
> 
>    Thus, how to fix this or how to config the timeout value?
> 
> Thx
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Mon Jan 30 10:12:27 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 30 Jan 2012 10:12:27 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
Message-ID: <20120130101227.GK3692@southbank.Home>

> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team. 
> Is there some news about that?

As of R15B (released a month ago), they still don't support CRLs.

Cheers,
Alex

On Mon, Jan 30, 2012 at 09:43:40AM +0000, Rosa, Andrea wrote:
> Hi
> 
> >You could just not use passwords.  If you use SSL connections, RabbitMQ
> >can authenticate users by the certificate they provide.
> >
> >See the auth-mechanism-ssl plugin for details:
> >  http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README
> 
> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team. 
> Is there some news about that?
> 
> Cheers
> --
> Andrea Rosa

From alexandru at rabbitmq.com  Mon Jan 30 10:20:03 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 30 Jan 2012 10:20:03 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster issue
In-Reply-To: <a7ef542f-1747-40ca-90c1-a414f74fec34@3g2000pbd.googlegroups.com>
References: <a7ef542f-1747-40ca-90c1-a414f74fec34@3g2000pbd.googlegroups.com>
Message-ID: <20120130102003.GL3692@southbank.Home>

Hi,

> rabbit at app9 is working file in the standalone mode, but if I follow
> the below commands, it says "Error: {no_running_cluster_nodes,
> [rabbit at app1],[rabbit at app1]}".

Unfortunately, that means exactly that rabbit at app9 can't connect to
rabbit at app1.

Just to make sure, was rabbit at app1 started when you tried this?
Because, I always forget to 'start_app' after 'stop_app'/'reset'/'cluster'.

If it was, try connecting to it from *app9*:
  $ rabbitmqctl status -n rabbit at app1

If that command is unsuccessful, the cookie isn't the same or there are
connectivity issues between nodes.

> I am using same erlang cookie value on all the nodes and pass the
> erlang cookie using -setcookie in rabbitmq-server.sh and
> rabbitmqctl.sh scripts. 

Oh.  Does that mean you edited the scripts?

Cheers,
Alex

On Sun, Jan 29, 2012 at 05:47:28PM -0800, Codevally wrote:
> Hi
> 
> I have a 2 node RabbitMQ cluster and want to add another node to it.
> All 3 nodes are running on Linux.
> 
> The rabbit at app1 and rabbit at app2 are already in the cluster and working
> fine. I want to integrate rabbit at app9 as well to the cluster.
> 
> rabbit at app9 is working file in the standalone mode, but if I follow
> the below commands, it says "Error: {no_running_cluster_nodes,
> [rabbit at app1],[rabbit at app1]}".
> 
> From rabbit at app9
> 1. $ sh rabbitmqctl stop_app
> 2. $ sh rabbitmqctl reset
> 3. $ sh rabbitmqctl cluster rabbit at app1  >>> ERROR
> Clustering node rabbit at app9 with [rabbit at app1] ...
> Error: {no_running_cluster_nodes,[rabbit at app1],[rabbit at app1]}
> 
> I am using same erlang cookie value on all the nodes and pass the
> erlang cookie using -setcookie in rabbitmq-server.sh and
> rabbitmqctl.sh scripts. All three nodes (app1, app2 and app9) in the
> same network and there is no any network issues.
> 
> Please help me to solve this. Any help is appreciated.
> 
> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Jan 30 10:47:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Jan 2012 10:47:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <1327893307.28451.YahooMailClassic@web39305.mail.mud.yahoo.com>
References: <1327893307.28451.YahooMailClassic@web39305.mail.mud.yahoo.com>
Message-ID: <4F267541.2070400@rabbitmq.com>

Hi Preeti,

On 30/01/12 03:15, preeti sp wrote:
> Is there any way to Install RHEL RabbitMQ RPM Package with a non-root
> user? And, Ubuntu RabbitMQ DEB Package with a non-root user?

Yes, you can perform any operation that requires root privileges as long
as you have the appropriate sudo permission - see the "sudoers" and
"sudo" man pages.

Some RPM packages are relocatable and can be installed with an arbitrary
prefix. The RabbitMQ RPM package is not relocatable and Debian packages
are not relocatable in general.

As you suggest in your original email, it is possible to install the
Generic Unix binary package in the location of your choosing. This
method will not install an init.d script. If you are not root and don't
have sudo permission then this is your only option, but keep in mind
that you will need to start RabbitMQ after each reboot without an init.d
script.


-Emile

From alepolia at yahoo.it  Mon Jan 30 11:17:25 2012
From: alepolia at yahoo.it (Alessandra Poliandri)
Date: Mon, 30 Jan 2012 11:17:25 +0000 (GMT)
Subject: [rabbitmq-discuss] RabbitMQ++
Message-ID: <1327922245.45505.YahooMailNeo@web29701.mail.ird.yahoo.com>

Hi,
I tried to install the amppq-rest module on Linux (Ubuntu 10.04). After installation of the Rabbit MQ server, I successfully installed:
- libevent
- amqpcpp

The problem arises when the makefile ampq-rest try searching RabbitMQ ++... What is that?? RabbitMQ + + is not there and I do not know what it is. I tried to delete it or rename it in the Makefile as amqpcpp library, but compiling the result still provides too many mistakes.

Someone could kindly help me understand what is the problem or how to fix it?

Thank you very much in advance.
Alessandra
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/5c6c092d/attachment.htm>

From alepolia at tin.it  Mon Jan 30 11:27:01 2012
From: alepolia at tin.it (alepolia at tin.it)
Date: Mon, 30 Jan 2012 12:27:01 +0100 (CET)
Subject: [rabbitmq-discuss] RabbitMQ++
Message-ID: <1352e5e399a.alepolia@tin.it>

 Hi,
I tried to install the amppq-rest module on Linux (Ubuntu 10.04). After installation of the Rabbit MQ server, I successfully installed:
- libevent
- amqpcpp

The problem arises when the makefile ampq-rest try searching RabbitMQ ++... What is that?? RabbitMQ + + is not there and I do not know what it is. I tried to delete it or rename it in the Makefile as amqpcpp library, but compiling the result still provides too many mistakes.

Someone could kindly help me understand what is the problem or how to fix it?

Thank you very much in advance.
Alessandra 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/ef63f76a/attachment.htm>

From poliandri at intre.it  Mon Jan 30 11:17:12 2012
From: poliandri at intre.it (Poliandri Alessandra (Pol))
Date: Mon, 30 Jan 2012 11:17:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ++
Message-ID: <3A8C9B0330F16948B447A41BAF120D300AE91A94@sleepy.fables.local>

Hi,
I tried to install the amppq-rest module on Linux (Ubuntu 10.04). After installation of the Rabbit MQ server, I successfully installed:
- libevent
- amqpcpp

The problem arises when the makefile ampq-rest try searching RabbitMQ ++... What is that?? RabbitMQ + + is not there and I do not know what it is. I tried to delete it or rename it in the Makefile as amqpcpp library, but compiling the result still provides too many mistakes.

Someone could kindly help me understand what is the problem or how to fix it?

Thank you very much in advance.
Alessandra

[cid:logo29.jpg]

Dr. Alessandra Poliandri
INTRE' S.r.l.
Via Gaslini, 2 - 20900 MONZA (MB) - ITALY
Tel. +39-039-28.45.774 - Fax +39-039-28.40.734
http://www.intre.it e-mail: poliandri at intre.it

Nota informativa:
In ottemperanza della Legge 196/2003 sulla tutela dei dati personali, le informazioni contenute in questo messaggio sono strettamente riservate e sono esclusivamente indirizzate al destinatario indicato (oppure alla persona responsabile di rimetterlo al destinatario), tenendo presente che qualsiasi uso, riproduzione o divulgazione di questo messaggio e' vietata. Nel caso in cui aveste ricevuto questa e-mail per errore, vogliate avvertire il mittente al piu' presto a mezzo posta elettronica e distruggere il presente messaggio.
 Please note:
This email transmission including its attachments, are intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  Any views or opinions are solely those of the author and do not necessarily represent those of Intr? S.r.l., unless specifically stated.  Any review, retransmission, dissemination or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited.   If you received this email in error, please contact the sender and delete the email transmission immediately.

P Please consider the environment before printing this e-mail!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/26289890/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: logo29.jpg
Type: image/jpeg
Size: 2485 bytes
Desc: logo29.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/26289890/attachment.jpg>

From simon at rabbitmq.com  Mon Jan 30 11:42:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jan 2012 11:42:18 +0000
Subject: [rabbitmq-discuss] Keeping track of exchanges -- Any Advice
In-Reply-To: <94a5f80b-b18a-4a7e-aa6f-de7a74cd2f22@m5g2000yqk.googlegroups.com>
References: <ab66f90c-2e4e-49ff-987e-425a493e4b68@t8g2000yqg.googlegroups.com>	<4F16A110.6000205@rabbitmq.com>
	<94a5f80b-b18a-4a7e-aa6f-de7a74cd2f22@m5g2000yqk.googlegroups.com>
Message-ID: <4F26821A.4040001@rabbitmq.com>

On 30/01/12 06:31, MarcusR wrote:
> Hello Simon, thanks for the response.
>
> I am not really sure to be honest. I am not very familiar with message
> brokers and their performance characteristics. I suppose I could have
> a topic exchange and then bind queues to various topics... Such as
> have a queue for user1.queu1, user2.queue1, user3.queue1, etc

Unless you need wildcards you may not even need a topic exchange. *If* 
routing turns out to be an expensive thing for you then a direct 
exchange can give a notable performance boost.

> My question is how expensive is routing?

Depends :) If you're sending lots of small non-persistent messages fast 
then it can become a somewhat significant factor, just because RabbitMQ 
isn't doing mush *else* per message.

Usually making routing simpler will make it faster.

> Also, regarding the routing,
> is it more performant to have one master topic exchange for all the
> users or to distribute users across multiple topic exchanges or does
> it not matter?

It doesn't matter.

> I assume rabbitmq first looks up the exchange and then goes through
> each queue to see if there is a match for routing. If this is the
> case, I imagine it would be more performant to create a thousand such
> topic exchanges and divide all the users across them as opposed to one
> topic exchange for all users.

No, it's not quite like that - topic routing is O(log(n)). But I think 
the n there is the total number of topic bindings, not per exchange.

> In the end, I plan to run several rabbitmq nodes with a bucket of
> users assigned to each rabbit node. Assigning each user to a node
> based on a hash. Is this best practice for scaling rabbitmq for this
> type of scenerio? Currently rabbitmq is the bottle neck in my
> application benchmarks so this was my plan to scale it. Please correct
> me if there is a better practice.

This sort of sharding is probably the most scalable solution if it's 
practical. If it's not practical then clustering or federation would be 
alternative routes...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jan 30 11:59:23 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jan 2012 11:59:23 +0000
Subject: [rabbitmq-discuss] Stuck log rotation in linux?
In-Reply-To: <2eaaf2b5-f7d6-41a9-b6ec-bcf2fac9630b@j14g2000vba.googlegroups.com>
References: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>	<4F228FCB.1030402@rabbitmq.com>	<e5f110f4-12ea-4c98-856e-b63ecda13fc9@m2g2000vbc.googlegroups.com>
	<2eaaf2b5-f7d6-41a9-b6ec-bcf2fac9630b@j14g2000vba.googlegroups.com>
Message-ID: <4F26861B.40505@rabbitmq.com>

On 27/01/12 21:21, Rob Sutherland wrote:
> If rabbitmq-server is NOT
> running, the postrotate action will start up the service.

I'm having trouble replicating this. I just see the usual nodedown error 
message. Is this on 2.7.1?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jan 30 12:12:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jan 2012 12:12:37 +0000
Subject: [rabbitmq-discuss] Specifying channel_max
In-Reply-To: <CAECZ853jcTo9Paiiy7g5veCBDm-DLCkzRweEFi9DydWmjw0xdQ@mail.gmail.com>
References: <CAECZ8532=kiArhSW4sq2ERt-ZMuY=biV-wLkJnhhCkhbOE=Ebw@mail.gmail.com>	<CAL_e=0r=56USmNAGFbGMcKRbO6cu4o0UuAC4OdcEKAwQfT=9sQ@mail.gmail.com>
	<CAECZ853jcTo9Paiiy7g5veCBDm-DLCkzRweEFi9DydWmjw0xdQ@mail.gmail.com>
Message-ID: <4F268935.9040707@rabbitmq.com>

On 27/01/12 17:12, Dan Dart wrote:
>> But this is a very rare limit to run into.
>
> Do you know why we might be hitting it?

I was talking about the limit on the number of channels per connection 
(channel_max) - you'd only run into that if you tried to open 65536 
channels in one connection, which I doubt you are doing.

>> Are you running into a limit on the number of *connections* you can open?
> Maybe so - we are just hitting it a lot - we have one IP sending stuff
> constantly - but we don't have anything like "keepalive" so it's
> trying to make a new connection each time.

OK, you will have to be clearer about what exact problem you are seeing. 
Would you expect there to be lots of connections open simultaneously? Or 
is your client app leaving connections open when it shouldn't? Do you 
see all these connections in mgmt / rabbitmqctl?

> Is this what's killing it? Can we just raise ulimit and you think it'll fix it?

If you need to have large numbers of connections open at the same time, 
yes. If you are leaking connections, this would only delay the problem.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jan 30 12:27:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jan 2012 12:27:07 +0000
Subject: [rabbitmq-discuss] Problem in high availability setup together
 with	corosync
In-Reply-To: <4F22E391.5060908@native-instruments.de>
References: <4F22E391.5060908@native-instruments.de>
Message-ID: <4F268C9B.10702@rabbitmq.com>

On 27/01/12 17:49, Christopher Grebs wrote:
> Now we kill mq01ha by pusing the virtual power button (virtual maschines
> are great!), corosync moves the ip from mq01ha to mq02ha and the
> consumers and producers proceed with their work. This works great and
> everything is fine again.
>
> Now (and this is the part where I need your knowledge) we currently have
> the setup that if mq01 starts up again the ip address moves back to mq01.

Just to be clear here: are you *powering off* the first VM, such that 
when it comes back it needs to boot up again, or *pausing* it, such that 
it comes back immediately with RabbitMQ on that VM unaware that anything 
has happened?

Cheers Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From u2.storm at gmail.com  Mon Jan 30 13:03:37 2012
From: u2.storm at gmail.com (Artsiom Gulin)
Date: Mon, 30 Jan 2012 16:03:37 +0300
Subject: [rabbitmq-discuss] Disc node clustering
In-Reply-To: <4F22A81F.6050405@rabbitmq.com>
References: <4F22929F.2050801@gmail.com> <4F22A81F.6050405@rabbitmq.com>
Message-ID: <4F269529.8070200@gmail.com>

Hi, Simon.
> So it looks like you are leaving the cluster and then resetting, 
> rather than the other way around (which is more normal). It looks like 
> the request to leave the cluster gets ignored in this case. I'll file 
> a bug.

I've tried scenario, when removing node from cluster is performed like this:

1) join machine B (epbyminw2482t3) to machine A (epbyminw2482t2).

[root at epbyminw2482t3 ~]# rabbitmqctl stop_app && rabbitmqctl reset && 
rabbitmqctl cluster wosnfs@`hostname -s` wosnfs at epbyminw2482t2 && 
rabbitmqctl start_app
<-CUT->
Clustering node wosnfs at epbyminw2482t3 with [wosnfs at epbyminw2482t3,
                                             wosnfs at epbyminw2482t2] ...
...done.
Starting node wosnfs at epbyminw2482t3 ...
...done.

Everything is ok.

2) remove node A from cluster

[root at epbyminw2482t2 ~]# *rabbitmqctl stop_app && rabbitmqctl reset && 
rabbitmqctl start_app*
Stopping node wosnfs at epbyminw2482t2 ...
...done.
Resetting node wosnfs at epbyminw2482t2 ...
...done.
Starting node wosnfs at epbyminw2482t2 ...
...done.

 From now node A and B are standalone, and operate/independently./

3) restart broker on node B.
Restarting rabbitmq-server: FAILED - check 
/var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.

[root at epbyminw2482t3 ~]# cat /var/log/rabbitmq/startup_log
Activating RabbitMQ plugins ...
0 plugins activated:
<-CUT->
node           : wosnfs at epbyminw2482t3
app descriptor : 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
<-CUT->
erlang version : 5.8.4

-- rabbit boot start
starting file handle cache server                                     
...done
starting worker pool                                                  
...done
starting database                                                     
...BOOT ERROR: FAILED
Reason: {error,
             {unable_to_join_cluster,
                 [wosnfs at epbyminw2482t3,wosnfs at epbyminw2482t2],
                 {merge_schema_failed,
                     "Bad cookie in table definition 
mirrored_sup_childspec: wosnfs at epbyminw2482t3 = 
{cstruct,mirrored_sup_childspec,ordered_set,[wosnfs at epbyminw2482t3],[],[],0,read_write,false,[],[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],{{1327,927347,889571},wosnfs at epbyminw2482t2},{{3,1},{wosnfs at epbyminw2482t3,{1327,927549,609065}}}}, 
wosnfs at epbyminw2482t2 = 
{cstruct,mirrored_sup_childspec,ordered_set,[wosnfs at epbyminw2482t2],[],[],0,read_write,false,[],[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],{{1327,927550,935402},wosnfs at epbyminw2482t2},{{2,0},[]}}\n"}}}
Stacktrace: [{rabbit_mnesia,init_db,3},
              {rabbit_mnesia,init,0},
              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
              {rabbit,run_boot_step,1},
              {rabbit,'-start/2-lc$^0/1-0-',1},
              {rabbit,start,2},
              {application_master,start_it_old,4}]
{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

We got this error.

3.1) But, if we stop application on node A
[root at epbyminw2482t2 ~]# rabbitmqctl stop_app

3.2)[root at epbyminw2482t3 ~]# service rabbitmq-server restart
Restarting rabbitmq-server: RabbitMQ is not running
SUCCESS
rabbitmq-server.

Rabbitmq broker on node B(!) restarts successfully.
Until broker(or application) on node A is down, node B work fine.
When broker on node A is up, node  B faces above mentioned troubles on 
restart (or `rabbitmqctl reset`).
Workaround is to remove mnesia db on node B, but it is bad idea, while 
node B is still joined to the cluster.
It seems that there is some kind of rule about order of joining and 
removing nodes from cluster...

In our application all rabbitmq brokers have to joined in cluster as 
disk nodes, and it have to be possible
to add\remove any node at any time. Could you suggest me, have to 
achieve that and avoid "bad cookie" problem?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/9e40c04f/attachment.htm>

From christopher.grebs at native-instruments.de  Mon Jan 30 13:23:06 2012
From: christopher.grebs at native-instruments.de (Christopher Grebs)
Date: Mon, 30 Jan 2012 14:23:06 +0100
Subject: [rabbitmq-discuss] Problem in high availability setup together
 with	corosync
In-Reply-To: <4F268C9B.10702@rabbitmq.com>
References: <4F22E391.5060908@native-instruments.de>
	<4F268C9B.10702@rabbitmq.com>
Message-ID: <4F2699BA.8020202@native-instruments.de>

Hey Simon,

we power it off, so that when it comes back it needs to boot up again.

Cheers, Christopher.

On 01/30/2012 01:27 PM, Simon MacMullen wrote:
> On 27/01/12 17:49, Christopher Grebs wrote:
>> Now we kill mq01ha by pusing the virtual power button (virtual maschines
>> are great!), corosync moves the ip from mq01ha to mq02ha and the
>> consumers and producers proceed with their work. This works great and
>> everything is fine again.
>>
>> Now (and this is the part where I need your knowledge) we currently have
>> the setup that if mq01 starts up again the ip address moves back to 
>> mq01.
>
> Just to be clear here: are you *powering off* the first VM, such that 
> when it comes back it needs to boot up again, or *pausing* it, such 
> that it comes back immediately with RabbitMQ on that VM unaware that 
> anything has happened?
>
> Cheers Simon
>


-- 
Christopher Grebs
Data Processing Developer

Tel +49-30-611035-1664
Fax -49-30-611035-2652
christopher.grebs at native-instruments.de

NATIVE INSTRUMENTS GmbH
Schlesische Strasse 29-30
10997 Berlin, Germany

http://www.native-instruments.com



***

KOMPLETE 8 ULTIMATE - the premium NI producer collection
=>   http://www.native-instruments.com/komplete8

TRAKTOR KONTROL S2 - the professional 2.1 DJ system
=>   http://www.native-instruments.com/s2

->>>>>>  NATIVE INSTRUMENTS - The Future of Sound<<<<<<-

Registergericht: Amtsgericht Charlottenburg
Registernummer: HRB 72458
UST.-ID.-Nr. DE 20 374 7747

Gesch?ftsf?hrung: Daniel Haver (CEO), Mate Galic


From rob_sutherland at alumni.uwaterloo.ca  Mon Jan 30 13:41:28 2012
From: rob_sutherland at alumni.uwaterloo.ca (Rob Sutherland)
Date: Mon, 30 Jan 2012 05:41:28 -0800 (PST)
Subject: [rabbitmq-discuss] Stuck log rotation in linux?
In-Reply-To: <4F26861B.40505@rabbitmq.com>
References: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>
	<4F228FCB.1030402@rabbitmq.com>
	<e5f110f4-12ea-4c98-856e-b63ecda13fc9@m2g2000vbc.googlegroups.com>
	<2eaaf2b5-f7d6-41a9-b6ec-bcf2fac9630b@j14g2000vba.googlegroups.com>
	<4F26861B.40505@rabbitmq.com>
Message-ID: <db64dc08-44c6-4f10-96ff-668288dde252@o14g2000vbo.googlegroups.com>

I'm running rabbitmq-server-2.4.0

Rob

On Jan 30, 6:59?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 27/01/12 21:21, Rob Sutherland wrote:
>
> > If rabbitmq-server is NOT
> > running, the postrotate action will start up the service.
>
> I'm having trouble replicating this. I just see the usual nodedown error
> message. Is this on 2.7.1?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Jan 30 13:45:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jan 2012 13:45:06 +0000
Subject: [rabbitmq-discuss] Stuck log rotation in linux?
In-Reply-To: <db64dc08-44c6-4f10-96ff-668288dde252@o14g2000vbo.googlegroups.com>
References: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>	<4F228FCB.1030402@rabbitmq.com>	<e5f110f4-12ea-4c98-856e-b63ecda13fc9@m2g2000vbc.googlegroups.com>	<2eaaf2b5-f7d6-41a9-b6ec-bcf2fac9630b@j14g2000vba.googlegroups.com>	<4F26861B.40505@rabbitmq.com>
	<db64dc08-44c6-4f10-96ff-668288dde252@o14g2000vbo.googlegroups.com>
Message-ID: <4F269EE2.3020308@rabbitmq.com>

On 30/01/12 13:41, Rob Sutherland wrote:
> I'm running rabbitmq-server-2.4.0

Ah, right. That makes much more sense.

This was a bug introduced in 2.4.0 and fixed in 2.5.0. I recommend an 
upgrade.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From rob_sutherland at alumni.uwaterloo.ca  Mon Jan 30 14:03:57 2012
From: rob_sutherland at alumni.uwaterloo.ca (Rob Sutherland)
Date: Mon, 30 Jan 2012 06:03:57 -0800 (PST)
Subject: [rabbitmq-discuss] Stuck log rotation in linux?
In-Reply-To: <4F269EE2.3020308@rabbitmq.com>
References: <4B393627EE3CE74A9F189B639F857D2E071CE197@BVNYMAIL.bvn.com>
	<4F228FCB.1030402@rabbitmq.com>
	<e5f110f4-12ea-4c98-856e-b63ecda13fc9@m2g2000vbc.googlegroups.com>
	<2eaaf2b5-f7d6-41a9-b6ec-bcf2fac9630b@j14g2000vba.googlegroups.com>
	<4F26861B.40505@rabbitmq.com>
	<db64dc08-44c6-4f10-96ff-668288dde252@o14g2000vbo.googlegroups.com>
	<4F269EE2.3020308@rabbitmq.com>
Message-ID: <e93942ac-5eda-42dd-8762-20e4c1c0feb7@o12g2000vbd.googlegroups.com>

Thanks Simon!

On Jan 30, 8:45?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 30/01/12 13:41, Rob Sutherland wrote:
>
> > I'm running rabbitmq-server-2.4.0
>
> Ah, right. That makes much more sense.
>
> This was a bug introduced in 2.4.0 and fixed in 2.5.0. I recommend an
> upgrade.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From preetisp_83 at yahoo.com  Mon Jan 30 14:36:47 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Mon, 30 Jan 2012 06:36:47 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <4F267541.2070400@rabbitmq.com>
Message-ID: <1327934207.98593.YahooMailClassic@web39305.mail.mud.yahoo.com>

Hi Emile,

Thanks for your response.

I got your point. Just as an additional confirmation, RabbitMQ behavior would not change in any sense other than the start up behavior you have Indicated below (For either Clustering, Mirroring, Performance, Memory) whether I Install tar version or RPM version? Correct? 

Thanks,
Preeti

--- On Mon, 1/30/12, Emile Joubert <emile at rabbitmq.com> wrote:

From: Emile Joubert <emile at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ Installation as non-root user
To: "preeti sp" <preetisp_83 at yahoo.com>
Cc: "RabbitMQ Discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Date: Monday, January 30, 2012, 2:47 AM

Hi Preeti,

On 30/01/12 03:15, preeti sp wrote:
> Is there any way to Install RHEL RabbitMQ RPM Package with a non-root
> user? And, Ubuntu RabbitMQ DEB Package with a non-root user?

Yes, you can perform any operation that requires root privileges as long
as you have the appropriate sudo permission - see the "sudoers" and
"sudo" man pages.

Some RPM packages are relocatable and can be installed with an arbitrary
prefix. The RabbitMQ RPM package is not relocatable and Debian packages
are not relocatable in general.

As you suggest in your original email, it is possible to install the
Generic Unix binary package in the location of your choosing. This
method will not install an init.d script. If you are not root and don't
have sudo permission then this is your only option, but keep in mind
that you will need to start RabbitMQ after each reboot without an init.d
script.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/e4ed96b2/attachment.htm>

From emile at rabbitmq.com  Mon Jan 30 14:55:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Jan 2012 14:55:00 +0000
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <1327934207.98593.YahooMailClassic@web39305.mail.mud.yahoo.com>
References: <1327934207.98593.YahooMailClassic@web39305.mail.mud.yahoo.com>
Message-ID: <4F26AF44.7020806@rabbitmq.com>

Hi Preeti,

On 30/01/12 14:36, preeti sp wrote:
> I got your point. Just as an additional confirmation, RabbitMQ behavior
> would not change in any sense other than the start up behavior you have
> Indicated below (For either Clustering, Mirroring, Performance, Memory)
> whether I Install tar version or RPM version? Correct?

Yes, that is correct. The binary packages and the Generic Unix archive
all contain the same Erlang .beam files and the behaviour should be the
same on all platforms.


-Emile

From preetisp_83 at yahoo.com  Mon Jan 30 14:57:37 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Mon, 30 Jan 2012 06:57:37 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <4F26AF44.7020806@rabbitmq.com>
Message-ID: <1327935457.57713.YahooMailClassic@web39304.mail.mud.yahoo.com>

Thank you so much Emile!

Regards,
Preeti

--- On Mon, 1/30/12, Emile Joubert <emile at rabbitmq.com> wrote:

From: Emile Joubert <emile at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ Installation as non-root user
To: "preeti sp" <preetisp_83 at yahoo.com>
Cc: "RabbitMQ Discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Date: Monday, January 30, 2012, 6:55 AM

Hi Preeti,

On 30/01/12 14:36, preeti sp wrote:
> I got your point. Just as an additional confirmation, RabbitMQ behavior
> would not change in any sense other than the start up behavior you have
> Indicated below (For either Clustering, Mirroring, Performance, Memory)
> whether I Install tar version or RPM version? Correct?

Yes, that is correct. The binary packages and the Generic Unix archive
all contain the same Erlang .beam files and the behaviour should be the
same on all platforms.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/7d001a1b/attachment.htm>

From preetisp_83 at yahoo.com  Mon Jan 30 15:19:39 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Mon, 30 Jan 2012 07:19:39 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <4F26AF44.7020806@rabbitmq.com>
Message-ID: <1327936779.39363.YahooMailClassic@web39302.mail.mud.yahoo.com>

Hi Emile,

One more quick question. 

I am not well-versed with RPM Installables. So, when I Install using RPM Package as a sudoer, does it go over the Internet to get appropriate Installable or dependent libraries. Like, in the case of Debian package Installation, it actually goes and gets all the required packages recursively.

The reason I am asking this is - On Production Machines, we would not want to Install things randomly from Internet! And, my Prod Environment would be RHEL 5. So, just wanted to check on how RPM works internally for Installation!

Do folks generally Install tar RabbitMQ versions on Production Machines? I am just a little concerned on downside that it does not auto restart RabbitMQ on re-boot! So, just checking on right Installable for my Prod Environment just in case I manage to get at least the SUDO access If not root!

Thanks,
Preeti

--- On Mon, 1/30/12, Emile Joubert <emile at rabbitmq.com> wrote:

From: Emile Joubert <emile at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ Installation as non-root user
To: "preeti sp" <preetisp_83 at yahoo.com>
Cc: "RabbitMQ Discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Date: Monday, January 30, 2012, 6:55 AM

Hi Preeti,

On 30/01/12 14:36, preeti sp wrote:
> I got your point. Just as an additional confirmation, RabbitMQ behavior
> would not change in any sense other than the start up behavior you have
> Indicated below (For either Clustering, Mirroring, Performance, Memory)
> whether I Install tar version or RPM version? Correct?

Yes, that is correct. The binary packages and the Generic Unix archive
all contain the same Erlang .beam files and the behaviour should be the
same on all platforms.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/f15a00c6/attachment.htm>

From emile at rabbitmq.com  Mon Jan 30 15:29:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Jan 2012 15:29:52 +0000
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <1327936779.39363.YahooMailClassic@web39302.mail.mud.yahoo.com>
References: <1327936779.39363.YahooMailClassic@web39302.mail.mud.yahoo.com>
Message-ID: <4F26B770.2000802@rabbitmq.com>


Hi Preeti,

On 30/01/12 15:19, preeti sp wrote:
> I am not well-versed with RPM Installables. So, when I Install using RPM
> Package as a sudoer, does it go over the Internet to get appropriate
> Installable or dependent libraries. Like, in the case of Debian package
> Installation, it actually goes and gets all the required packages
> recursively.

Whether dependencies are resolved from the Internet or from other media
is a matter of package manager and repository configuration.

> Do folks generally Install tar RabbitMQ versions on Production Machines?
> I am just a little concerned on downside that it does not auto restart
> RabbitMQ on re-boot! So, just checking on right Installable for my Prod
> Environment just in case I manage to get at least the SUDO access If not
> root!

That would depend on production policies. If I had to venture a guess,
the Generic Unix binary archive is probably used in a minority of
production environments, because it lacks start-up scripts to launch the
broker after reboot.


-Emile


From preetisp_83 at yahoo.com  Mon Jan 30 15:33:28 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Mon, 30 Jan 2012 07:33:28 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <4F26B770.2000802@rabbitmq.com>
Message-ID: <1327937608.53309.YahooMailClassic@web39302.mail.mud.yahoo.com>

Hi Emile,

Okay. So, If I Install a specific RPM, is it guaranteed to get me same version of beam files every time I run. Or, it will try to get me latest versions? Please let me know on that.

If I Install via RPM approach, Is there a way I could get a list of all the files it is Installing on my machine and in which location just for tracking purposes?

Thanks,
Preeti
--- On Mon, 1/30/12, Emile Joubert <emile at rabbitmq.com> wrote:

From: Emile Joubert <emile at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ Installation as non-root user
To: "preeti sp" <preetisp_83 at yahoo.com>
Cc: "RabbitMQ Discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Date: Monday, January 30, 2012, 7:29 AM


Hi Preeti,

On 30/01/12 15:19, preeti sp wrote:
> I am not well-versed with RPM Installables. So, when I Install using RPM
> Package as a sudoer, does it go over the Internet to get appropriate
> Installable or dependent libraries. Like, in the case of Debian package
> Installation, it actually goes and gets all the required packages
> recursively.

Whether dependencies are resolved from the Internet or from other media
is a matter of package manager and repository configuration.

> Do folks generally Install tar RabbitMQ versions on Production Machines?
> I am just a little concerned on downside that it does not auto restart
> RabbitMQ on re-boot! So, just checking on right Installable for my Prod
> Environment just in case I manage to get at least the SUDO access If not
> root!

That would depend on production policies. If I had to venture a guess,
the Generic Unix binary archive is probably used in a minority of
production environments, because it lacks start-up scripts to launch the
broker after reboot.


-Emile

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/1c4f4c98/attachment.htm>

From simon at rabbitmq.com  Mon Jan 30 15:39:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Jan 2012 15:39:34 +0000
Subject: [rabbitmq-discuss] RabbitMQ Installation as non-root user
In-Reply-To: <1327937608.53309.YahooMailClassic@web39302.mail.mud.yahoo.com>
References: <1327937608.53309.YahooMailClassic@web39302.mail.mud.yahoo.com>
Message-ID: <4F26B9B6.9080500@rabbitmq.com>

On 30/01/12 15:33, preeti sp wrote:
> Okay. So, If I Install a specific RPM, is it guaranteed to get me same
> version of beam files every time I run. Or, it will try to get me latest
> versions? Please let me know on that.
>
> If I Install via RPM approach, Is there a way I could get a list of all
> the files it is Installing on my machine and in which location just for
> tracking purposes?

This is not really the place to ask basic questions about your 
distribution's package manager. I suggest you check the RHEL 
documentation, or

   http://rpm.org/wiki/Docs#UserDocumentation

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From john.doe44210 at gmail.com  Mon Jan 30 18:11:37 2012
From: john.doe44210 at gmail.com (john doe)
Date: Mon, 30 Jan 2012 19:11:37 +0100
Subject: [rabbitmq-discuss] dirty consumer shutdown,
	shared queues and hearbeats
Message-ID: <CALbPevnK9Bko-2c-z0uPp1fhVDkyO0gsLySKWmEwD0dOmva4mw@mail.gmail.com>

Hello,

I am struggling with an issue here, not sure I got everything right.

I've got a consumer on server A consuming from queue Q (with manual
acks). As soon as (for some reason) I shutdown server A, another
consumer on server B is spawned, consuming from the same queue Q. I
have reasons for not having these two consumers alive at the same
time.

I have set up connection heartbeat to 600s. What I observe is:
a) at t=600s, channel from server A disappears from rabbitmqctl output
b) at t=2*600s, consumer on server B is able to get messages from Q


From mpietrek at skytap.com  Mon Jan 30 19:11:51 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 30 Jan 2012 11:11:51 -0800
Subject: [rabbitmq-discuss] Forcing mirrored queue synchronization?
Message-ID: <CB4C2B76.2A7BD%mpietrek@skytap.com>

We're moving towards a production deployment of mirrored queues for our
platform using RabbitMQ 2.71 on Ubuntu 10.04. One of the things we need to
support is rolling upgrades. Thus, while running in a mirrored cluster, we
plan to bring down one node at a time while leaving at least one node
running.

The potential problem arises in that our queue client may drain the queue
very slowly, e.g., a single message may take hours to execute, and we only
process one message at a time per client.

After completing the maintenance on a node and having it rejoin the cluster,
it might be a long time before the queues are synched again.  (I'm aware
that there's no eager synchronization, and that message synchronization
occurs only on message publish.) As a workaround to speed up
synchronization, I'm thinking of a small "synchronize now" app that
transactionally reads all current messages from the master's queue and
republishes them.

Our code is designed to handle duplicate messages, but we really want to
avoid losing messages.

Questions: Are there any potential pitfalls with this approach? And is there
some optimal way to do this that's better than "read/re-publish/ack"  for
each message in a loop?

Thanks,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/a3ca40c5/attachment.htm>

From pbell at syncsort.com  Mon Jan 30 19:47:00 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Mon, 30 Jan 2012 14:47:00 -0500
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <20120130101227.GK3692@southbank.Home>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home> <AF4AD4ADFB
	23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home> <5F389C517756284F80239F55BCA5DDD
	D36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
Message-ID: <D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com>

Thank you both.

Quick q: does RabbitMQ allow presenting a hashed password?

For example, you can configure a filer to accept MD5 hashed passwords. The principal that wants to authenticate with the filer hashes its password via MD5 and places the hashed password on the wire to the filer.

-paul

On Jan 30, 2012, at 5:13 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:

>> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
>> Is there some news about that?
>
> As of R15B (released a month ago), they still don't support CRLs.
>
> Cheers,
> Alex
>
> On Mon, Jan 30, 2012 at 09:43:40AM +0000, Rosa, Andrea wrote:
>> Hi
>>
>>> You could just not use passwords.  If you use SSL connections, RabbitMQ
>>> can authenticate users by the certificate they provide.
>>>
>>> See the auth-mechanism-ssl plugin for details:
>>> http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README
>>
>> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
>> Is there some news about that?
>>
>> Cheers
>> --
>> Andrea Rosa
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From roberts.john at gmail.com  Mon Jan 30 20:29:32 2012
From: roberts.john at gmail.com (jrob)
Date: Mon, 30 Jan 2012 12:29:32 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ cluster issue
In-Reply-To: <20120130102003.GL3692@southbank.Home>
References: <a7ef542f-1747-40ca-90c1-a414f74fec34@3g2000pbd.googlegroups.com>
	<20120130102003.GL3692@southbank.Home>
Message-ID: <12300621.980.1327955372335.JavaMail.geo-discussion-forums@prhb20>

Verify that app1 resolves correctly from your app9 machine.  I seem to 
remember having to add entries into my hosts file when a similar issue 
occurred for me.

- jrob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120130/1f2e60b9/attachment.htm>

From pablomolnar at gmail.com  Mon Jan 30 21:01:36 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Mon, 30 Jan 2012 13:01:36 -0800 (PST)
Subject: [rabbitmq-discuss] Clients reconnection logic
Message-ID: <b4738edf-e8b1-4e07-a3be-c3c7a29b73cd@t2g2000yqk.googlegroups.com>

Hi everyone,
I've successfully set up a 3 instances cluster and now I'm dealing
with reconnect logic in my java clients.

Before reinventing the wheel, I'm aware of this 2 projects:
- https://github.com/joshdevins/rabbitmq-ha-client
- http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/

Anyone have tried this code? Both seems a little outdated...

I'm just wanna the simplest logic giving a fixed list of nodes to
successfully reconnect my clients in a transparent manner.

I'd appreciate any info regarding clients reconnection.

Cheers,
Pablo Molnar

From alexandru at rabbitmq.com  Mon Jan 30 23:36:56 2012
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Mon, 30 Jan 2012 23:36:56 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com>
Message-ID: <20120130233656.GB3968@southbank.Home>

(posting again to the m/l)

> Quick q: does RabbitMQ allow presenting a hashed password?

No.  The authentication system is pluggable, though, so you could
easily write your own mechanism (see the src/rabbit_auth_mechanism_*
files in the broker source tree for examples).

Cheers,
Alex


On Mon, Jan 30, 2012 at 02:47:00PM -0500, Bell, Paul M. wrote:
> Thank you both.
> 
> Quick q: does RabbitMQ allow presenting a hashed password?
> 
> For example, you can configure a filer to accept MD5 hashed passwords. The principal that wants to authenticate with the filer hashes its password via MD5 and places the hashed password on the wire to the filer.
> 
> -paul
> 
> On Jan 30, 2012, at 5:13 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:
> 
> >> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
> >> Is there some news about that?
> >
> > As of R15B (released a month ago), they still don't support CRLs.
> >
> > Cheers,
> > Alex
> >
> > On Mon, Jan 30, 2012 at 09:43:40AM +0000, Rosa, Andrea wrote:
> >> Hi
> >>
> >>> You could just not use passwords.  If you use SSL connections, RabbitMQ
> >>> can authenticate users by the certificate they provide.
> >>>
> >>> See the auth-mechanism-ssl plugin for details:
> >>> http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README
> >>
> >> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
> >> Is there some news about that?
> >>
> >> Cheers
> >> --
> >> Andrea Rosa
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From taylste at gmail.com  Tue Jan 31 05:21:46 2012
From: taylste at gmail.com (Steven Taylor)
Date: Tue, 31 Jan 2012 05:21:46 +0000
Subject: [rabbitmq-discuss] queue discovery
Message-ID: <CA+zYriRCehrasUqSHDzrCMn2dJatKWfNQCZWmeYwMtfUmzL-dQ@mail.gmail.com>

Hi,

chicken and egg situation here.

Sender expects that receiver will have created a queue, only, the sender is
in this case the first to exist, and so sends a message to a non-existant
queue.

Result: rabbit throws away the message.  Is the only way forward to always
assert queue existance, or is there a lighter weight alternative?   i.e.
it'd be nice to get a status or exception back stating if the message got
routed or not.

Same situation could occur if queue is defined with non durable and
autodelete.  i.e. rabbit goes down and then comes back up.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/e62757c2/attachment.htm>

From dksayers at gmail.com  Tue Jan 31 03:47:01 2012
From: dksayers at gmail.com (dksayers)
Date: Mon, 30 Jan 2012 19:47:01 -0800 (PST)
Subject: [rabbitmq-discuss] plugins not loading.
Message-ID: <cfc89fda-3fe1-465e-881a-a658b57c7899@lr19g2000pbb.googlegroups.com>

I am trying to get the administration plugin working with
rabbitmq-2.7.0 on
my FreeBSD 8.2-STABLE amd64 machine. I install via the FreeBSD ports
tree where erlang-lite-r14b04_1,1 is also built and installed as a
dependancy. I then did the following:

# rabbitmq-plugins enable rabbitmq_management
The following plugins have been enabled:
  mochiweb
  webmachine
  rabbitmq_mochiweb
  amqp_client
  rabbitmq_management_agent
  rabbitmq_management

Plugin configuration has changed. Restart RabbitMQ for changes to take
effect.
# cat /etc/rabbitmq/enabled_plugins
[rabbitmq_management].

# /usr/local/etc/rc.d/rabbitmq start
Activating RabbitMQ plugins ...
0 plugins activated:

#

When I try to access port 55672 I am told 'Unable to connect'. It
seems
that my plugins are not loading but I have no idea why. The log files
provide no beneficial information. What have I missed.

From jerryk at vmware.com  Tue Jan 31 05:49:49 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 30 Jan 2012 21:49:49 -0800 (PST)
Subject: [rabbitmq-discuss] queue discovery
In-Reply-To: <CA+zYriRCehrasUqSHDzrCMn2dJatKWfNQCZWmeYwMtfUmzL-dQ@mail.gmail.com>
Message-ID: <2587929e-5361-4f2f-8a89-2d8a13025c74@strongmad.batnest.org>

Hi, Steven

Asserting the queue existence probably may not be heavyweight enough for you
to worry about.  That said, you could consider setting the 'mandatory' flag
when you publish, in which case you'll get an asynchronous notification if the
message cannot be routed to any queue (e.g. if no queues are bound to the 
exchange you published too, or your routing key didn't match one that was, etc.)

Best regards, 
Jerry


----- Original Message -----
From: "Steven Taylor" <taylste at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, January 30, 2012 9:21:46 PM
Subject: [rabbitmq-discuss] queue discovery



Hi, 

chicken and egg situation here. 

Sender expects that receiver will have created a queue, only, the sender is in this case the first to exist, and so sends a message to a non-existant queue. 

Result: rabbit throws away the message. Is the only way forward to always assert queue existance, or is there a lighter weight alternative? i.e. it'd be nice to get a status or exception back stating if the message got routed or not. 

Same situation could occur if queue is defined with non durable and autodelete. i.e. rabbit goes down and then comes back up. 

thanks, 
-Steven 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james at 2600hz.com  Tue Jan 31 05:50:37 2012
From: james at 2600hz.com (James Aimonetti)
Date: Mon, 30 Jan 2012 21:50:37 -0800
Subject: [rabbitmq-discuss] Federation and QoS
Message-ID: <4F27812D.1090907@2600hz.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

We have a federated setup that we're testing, and I'm wondering about
queues and de-duping.

We have a number of named queues that have multiple consumers attached,
with QoS to 1 so things are round-robined among those consumers.
Assuming bi-directional federation, and consumers on both brokers, will
it be possible that a publisher's payload on broker1 will reach both a
consumer on broker1 and be published to broker2 to be consumed there as
well?

If not, is there a way to figure out whether to actually federate the
message across brokers? Any pointers, in general, on how messaging
changes from non-federated to federated, given non-federated messaging
patterns?

We're really excited to start pushing the federation out, but we need to
get these patterns solidified.

Thanks,

James

- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJPJ4EtAAoJENc77s1OYoGgQCgIAIii42FPpWAPgov6XhyZR6oM
iu9YmxajrNuL9wFNvjWXuGTQey9g2Ub2pp2Ltn85M+6LIT61jVZiNKJzWroIFhrl
E7iRT7ZvGUGJ1ZNGInKwl3Ynu/nlX6DxJpQ6pvCElwAJy9DFWGnO1IJur/zX1vyY
GhL+6L8l+w6gbBSnM3ASIBiUUSlmw8lrKoqYNdYr99/V/2C/AgOXNEv0BWDfA2pe
ASxfP16yW98/bU1VqFGNx2nr/x15DqlcU/ZkcjZbZqVApH8jokNPt79o11odZ5RG
xPvpREC/AiiOZVclYyBf/nvDqc5nZAo7aEB0duinFiZq0Ioqihtue3RTIkmHpFk=
=36kg
-----END PGP SIGNATURE-----

From taylste at gmail.com  Tue Jan 31 06:25:38 2012
From: taylste at gmail.com (Steven Taylor)
Date: Tue, 31 Jan 2012 06:25:38 +0000
Subject: [rabbitmq-discuss] queue discovery
In-Reply-To: <2587929e-5361-4f2f-8a89-2d8a13025c74@strongmad.batnest.org>
References: <CA+zYriRCehrasUqSHDzrCMn2dJatKWfNQCZWmeYwMtfUmzL-dQ@mail.gmail.com>
	<2587929e-5361-4f2f-8a89-2d8a13025c74@strongmad.batnest.org>
Message-ID: <CA+zYriS4bgpGohM_R4q8JZr-R++Q1TUWtvWDbKrsKR1p7Mo7iA@mail.gmail.com>

Hi Jerry,

under the .net client, would that come through on the below?

event BasicAckEventHandler BasicAcks;

thanks,
-Steven



On 31 January 2012 05:49, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Steven
>
> Asserting the queue existence probably may not be heavyweight enough for
> you
> to worry about.  That said, you could consider setting the 'mandatory' flag
> when you publish, in which case you'll get an asynchronous notification if
> the
> message cannot be routed to any queue (e.g. if no queues are bound to the
> exchange you published too, or your routing key didn't match one that was,
> etc.)
>
> Best regards,
> Jerry
>
>
> ----- Original Message -----
> From: "Steven Taylor" <taylste at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Monday, January 30, 2012 9:21:46 PM
> Subject: [rabbitmq-discuss] queue discovery
>
>
>
> Hi,
>
> chicken and egg situation here.
>
> Sender expects that receiver will have created a queue, only, the sender
> is in this case the first to exist, and so sends a message to a
> non-existant queue.
>
> Result: rabbit throws away the message. Is the only way forward to always
> assert queue existance, or is there a lighter weight alternative? i.e. it'd
> be nice to get a status or exception back stating if the message got routed
> or not.
>
> Same situation could occur if queue is defined with non durable and
> autodelete. i.e. rabbit goes down and then comes back up.
>
> thanks,
> -Steven
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/8e1f7aab/attachment.htm>

From taylste at gmail.com  Tue Jan 31 06:40:55 2012
From: taylste at gmail.com (Steven Taylor)
Date: Tue, 31 Jan 2012 06:40:55 +0000
Subject: [rabbitmq-discuss] queue discovery
In-Reply-To: <CA+zYriS4bgpGohM_R4q8JZr-R++Q1TUWtvWDbKrsKR1p7Mo7iA@mail.gmail.com>
References: <CA+zYriRCehrasUqSHDzrCMn2dJatKWfNQCZWmeYwMtfUmzL-dQ@mail.gmail.com>
	<2587929e-5361-4f2f-8a89-2d8a13025c74@strongmad.batnest.org>
	<CA+zYriS4bgpGohM_R4q8JZr-R++Q1TUWtvWDbKrsKR1p7Mo7iA@mail.gmail.com>
Message-ID: <CA+zYriQ6YO0osmXSbApR6TYW02rOP06rzfca0oiNgVFB-w3YCA@mail.gmail.com>

decided to assert that the queue exists for now.  Got a weird publish
issue.  I am publishing to a queue that exists and the message isn't
turning up.

I confirmed this by looking at "rabbitmqctl.bat list_queues" and also, via
the management plugin.

Have you seen this before?  What's a good way to troubleshoot?

thanks,
-Steven

On 31 January 2012 06:25, Steven Taylor <taylste at gmail.com> wrote:

> Hi Jerry,
>
> under the .net client, would that come through on the below?
>
> event BasicAckEventHandler BasicAcks;
>
> thanks,
> -Steven
>
>
>
> On 31 January 2012 05:49, Jerry Kuch <jerryk at vmware.com> wrote:
>
>> Hi, Steven
>>
>> Asserting the queue existence probably may not be heavyweight enough for
>> you
>> to worry about.  That said, you could consider setting the 'mandatory'
>> flag
>> when you publish, in which case you'll get an asynchronous notification
>> if the
>> message cannot be routed to any queue (e.g. if no queues are bound to the
>> exchange you published too, or your routing key didn't match one that
>> was, etc.)
>>
>> Best regards,
>> Jerry
>>
>>
>> ----- Original Message -----
>> From: "Steven Taylor" <taylste at gmail.com>
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Monday, January 30, 2012 9:21:46 PM
>> Subject: [rabbitmq-discuss] queue discovery
>>
>>
>>
>> Hi,
>>
>> chicken and egg situation here.
>>
>> Sender expects that receiver will have created a queue, only, the sender
>> is in this case the first to exist, and so sends a message to a
>> non-existant queue.
>>
>> Result: rabbit throws away the message. Is the only way forward to always
>> assert queue existance, or is there a lighter weight alternative? i.e. it'd
>> be nice to get a status or exception back stating if the message got routed
>> or not.
>>
>> Same situation could occur if queue is defined with non durable and
>> autodelete. i.e. rabbit goes down and then comes back up.
>>
>> thanks,
>> -Steven
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/c7ab3ef5/attachment.htm>

From liuzhuofu at huawei.com  Tue Jan 31 07:36:16 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Tue, 31 Jan 2012 07:36:16 +0000
Subject: [rabbitmq-discuss] What's the best way to monitor the client exit
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E39913CBD@szxeml524-mbs.china.huawei.com>

In my system, many client will connect to the rabbit server, and they send msg to eachother.

My problem is: when one client coredown (lost the connection with rabbit server), I must catch this event quickly, and broad this event to all the other clients as soon as I can. What's is the best way to get the event (one client coredown)?

Do I need to develop a plugin and add it to rabbit server?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/551b932e/attachment.htm>

From yogimogi at gmail.com  Tue Jan 31 09:56:38 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Tue, 31 Jan 2012 01:56:38 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Client Memory issues
Message-ID: <e5e42d8c-cc74-48d0-87bc-f43078fd1105@kn4g2000pbc.googlegroups.com>

After running a java client for a while (15-20 minutes), it runs out
of memory with OutOfMemoryError.
I probably can postpone the problem by giving high values for -Xmx.

Doing jmap and jhat gave following info.

173233 instances of class com.rabbitmq.client.impl.AMQCommand
173233 instances of class com.rabbitmq.client.impl.CommandAssembler
173132 instances of class com.rabbitmq.client.impl.ChannelN
173132 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
173096 instances of class com.rabbitmq.client.ShutdownSignalException
173096 instances of class com.rabbitmq.client.impl.AMQImpl$Channel
$Close

I create a channel at the beginning of run() method of the thread and
close() it in the finally block.
But seems like all see all the instances of
com.rabbitmq.client.impl.ChannelN

any idea, what can be going wrong?

regards, Yogesh

From dan at canddi.com  Tue Jan 31 10:07:26 2012
From: dan at canddi.com (Dan Dart)
Date: Tue, 31 Jan 2012 10:07:26 +0000
Subject: [rabbitmq-discuss] Clustering - communication
Message-ID: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>

Hi all,

I'm having trouble getting two nodes talking. For reference they're
called backend and back2 - and each is in each other's hosts file
(with and without a FQDN).

Each can connect to each other on ports 4369 and 5672 - and have the
same .erlang.cookie file (had to hexedit to get it exact).
They're not connecting through the same network but they're not far
away (<1ms ping)
When I try to cluster (taking the node down using stop_app first) - I
get the error:

Error: {no_running_cluster_nodes,[rabbit at backend],[rabbit at backend]}

When I try to use rabbitmqctl -n rabbit at back2 status, from backend, I get:

Status of node rabbit at back2 ...
Error: unable to connect to node rabbit at back2: nodedown
diagnostics:
- nodes and their ports on back2: [{rabbit,48765}]
- current node: rabbitmqctl18870 at localhost
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: (the same each time)

and vice versa.

Can anyone give me some pointers? Do both servers need to be
stop_app'd at the same time for this to succeed or is it something
else?
Also, will stop_app kill any messages? I'm looking not to.

From aar at cpan.org  Tue Jan 31 10:25:59 2012
From: aar at cpan.org (Alessandro Ranellucci)
Date: Tue, 31 Jan 2012 11:25:59 +0100
Subject: [rabbitmq-discuss] State-of-the-art Perl client?
In-Reply-To: <4F1F9363.8050405@strategicdata.com.au>
Message-ID: <r422Ps-1068i-9A551F2ACC2343F5A5A6A6707A3C0181@thelonious.lan>

On 25-01-2012 at 6:30, Toby Corkindale wrote:

  >>I've done some searching and haven't found a consensus 
answer: What's
  >>the state-of-the-art Perl client for RabbitMQ?
  >
  >The only decent one I've found is Net::STOMP::Client.
  >The author is active on this list and responds to bug reports.
  >I filed bugs against the others on CPAN ages ago and have 
been ignored
  >by their authors.

I published this module one year ago and I'm still using it:

https://metacpan.org/module/Net::RabbitMQ::Java

It exposes the *full* RabbitMQ API as available through the 
official Java client. While some may dislike to run a Java 
library in a Perl environment, it has proven to be fairly 
reliable without a single issue.

- Alessandro


From simon at rabbitmq.com  Tue Jan 31 10:40:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 Jan 2012 10:40:33 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <20120130233656.GB3968@southbank.Home>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>	<20120128171156.GD3692@southbank.Home>	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>	<20120129202348.GI3692@southbank.Home>	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>	<20120130101227.GK3692@southbank.Home>	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com>
	<20120130233656.GB3968@southbank.Home>
Message-ID: <4F27C521.3030703@rabbitmq.com>

On 30/01/12 23:36, Alexandru Scvortov wrote:
> (posting again to the m/l)
>
>> Quick q: does RabbitMQ allow presenting a hashed password?
>
> No.  The authentication system is pluggable, though, so you could
> easily write your own mechanism (see the src/rabbit_auth_mechanism_*
> files in the broker source tree for examples).

More specifically I didn't think it worth doing this since it would tie 
authentication to the current password hashing scheme, and if you want 
to avoid sending passwords in plaintext you probably want to avoid 
sending anything in plaintext - so you should use SSL.

Actually, you don't want to just "present a hashed password" since that 
implies you are storing the hashed password at the client, which implies 
that it's not really hashed any more - you actually want something like 
CRAM-MD5. But CRAM-MD5 requires unsalted hashes and isn't even 
considered secure these days.

At one point I tried to invent a challenge response protocol that would 
work with salted hashes, but then I came to my senses and realised I 
should leave crypto protocol design to people who know what they're doing.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 31 10:51:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 Jan 2012 10:51:26 +0000
Subject: [rabbitmq-discuss] Forcing mirrored queue synchronization?
In-Reply-To: <CB4C2B76.2A7BD%mpietrek@skytap.com>
References: <CB4C2B76.2A7BD%mpietrek@skytap.com>
Message-ID: <4F27C7AE.8060109@rabbitmq.com>

On 30/01/12 19:11, Matt Pietrek wrote:
> We're moving towards a production deployment of mirrored queues for our
> platform using RabbitMQ 2.71 on Ubuntu 10.04. One of the things we need
> to support is rolling upgrades. Thus, while running in a mirrored
> cluster, we plan to bring down one node at a time while leaving at least
> one node running.

You may not want to hear this but: please be aware that all nodes in a 
cluster must run the same version of RabbitMQ.

> Questions: Are there any potential pitfalls with this approach?

Only the ones you'd think of - consuming from or publishing to the queue 
while this is going on could lead to your republisher getting confused.

If you have the same large messages routed to many queues from one 
publish, RabbitMQ will ensure the message body is only stored once in 
the broker. Republishing would break this.

> And is
> there some optimal way to do this that's better than
> "read/re-publish/ack" for each message in a loop?

I don't think so.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 31 10:53:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 Jan 2012 10:53:51 +0000
Subject: [rabbitmq-discuss] What's the best way to monitor the client
 exit
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E39913CBD@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39913CBD@szxeml524-mbs.china.huawei.com>
Message-ID: <4F27C83F.9040801@rabbitmq.com>

On 31/01/12 07:36, Liuzhuofu wrote:
> In my system, many client will connect to the rabbit server, and they 
> send msg to eachother.
> 
> My problem is: when one client coredown (lost the connection with rabbit 
> server), I must catch this event quickly, and broad this event to all 
> the other clients as soon as I can. What's is the best way to get the 
> event (one client coredown)?
> 
> Do I need to develop a plugin and add it to rabbit server?

Possibly. We've never developed this sort of feature lragely due to it
not being clear what would be a good set of semantics that would work
for everyone.

Tony Garnock-Jones has already written a plugin which might do the job
for you:

https://github.com/tonyg/presence-exchange

I'm not sure how up to date it is but it looks like there are recent
enough commits.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 31 10:59:23 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 Jan 2012 10:59:23 +0000
Subject: [rabbitmq-discuss] plugins not loading.
In-Reply-To: <cfc89fda-3fe1-465e-881a-a658b57c7899@lr19g2000pbb.googlegroups.com>
References: <cfc89fda-3fe1-465e-881a-a658b57c7899@lr19g2000pbb.googlegroups.com>
Message-ID: <4F27C98B.70502@rabbitmq.com>

Hmm, interesting. I know absolutely nothing about the FreeBSD port, it's 
possible it's just broken since plugin activation is a new concept in 2.7.0.

(Is the packager around on this list?)

So it looks like rabbitmq-plugins is finding the plugins and writing the 
file in the correct location. RabbitMQ is then *not* complaining about 
the plugins not being found, it's not even trying to activate them. 
Presumably therefore it's not seeing the enabled plugins file.

So it's possible that the environment variable ENABLED_PLUGINS_FILE is 
getting set to some bogus value by /usr/local/etc/rc.d/rabbitmq. In 
theory that script should not need to set that variable at all, assuming 
it starts rabbit via rabbitmq-server. Which it should, but like I said, 
I don't know about the FreeBSD packaging...

Cheers, Simon

On 31/01/12 03:47, dksayers wrote:
> I am trying to get the administration plugin working with
> rabbitmq-2.7.0 on
> my FreeBSD 8.2-STABLE amd64 machine. I install via the FreeBSD ports
> tree where erlang-lite-r14b04_1,1 is also built and installed as a
> dependancy. I then did the following:
>
> # rabbitmq-plugins enable rabbitmq_management
> The following plugins have been enabled:
>    mochiweb
>    webmachine
>    rabbitmq_mochiweb
>    amqp_client
>    rabbitmq_management_agent
>    rabbitmq_management
>
> Plugin configuration has changed. Restart RabbitMQ for changes to take
> effect.
> # cat /etc/rabbitmq/enabled_plugins
> [rabbitmq_management].
>
> # /usr/local/etc/rc.d/rabbitmq start
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> #
>
> When I try to access port 55672 I am told 'Unable to connect'. It
> seems
> that my plugins are not loading but I have no idea why. The log files
> provide no beneficial information. What have I missed.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 31 11:11:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 Jan 2012 11:11:45 +0000
Subject: [rabbitmq-discuss] Federation and QoS
In-Reply-To: <4F27812D.1090907@2600hz.com>
References: <4F27812D.1090907@2600hz.com>
Message-ID: <4F27CC71.6030707@rabbitmq.com>

It's important to remember that the RabbitMQ federation plugin federates 
*exchanges*, not queues. The idea is that any message that gets 
federated will get sent to all the brokers in the federation.

If you want to ensure that each message only gets consumed in one broker 
you will need to send messages around using the shovel at the moment by 
having multiple shovels consume from a single queue.

Cheers, Simon

On 31/01/12 05:50, James Aimonetti wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> We have a federated setup that we're testing, and I'm wondering about
> queues and de-duping.
>
> We have a number of named queues that have multiple consumers attached,
> with QoS to 1 so things are round-robined among those consumers.
> Assuming bi-directional federation, and consumers on both brokers, will
> it be possible that a publisher's payload on broker1 will reach both a
> consumer on broker1 and be published to broker2 to be consumed there as
> well?
>
> If not, is there a way to figure out whether to actually federate the
> message across brokers? Any pointers, in general, on how messaging
> changes from non-federated to federated, given non-federated messaging
> patterns?
>
> We're really excited to start pushing the federation out, but we need to
> get these patterns solidified.
>
> Thanks,
>
> James
>
> - --
> James Aimonetti
> Distributed Systems Engineer / DJ MC_
>
> 2600hz | http://2600hz.com
> sip:james at 2600hz.com
> tel: 415.886.7905
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
> iQEcBAEBAgAGBQJPJ4EtAAoJENc77s1OYoGgQCgIAIii42FPpWAPgov6XhyZR6oM
> iu9YmxajrNuL9wFNvjWXuGTQey9g2Ub2pp2Ltn85M+6LIT61jVZiNKJzWroIFhrl
> E7iRT7ZvGUGJ1ZNGInKwl3Ynu/nlX6DxJpQ6pvCElwAJy9DFWGnO1IJur/zX1vyY
> GhL+6L8l+w6gbBSnM3ASIBiUUSlmw8lrKoqYNdYr99/V/2C/AgOXNEv0BWDfA2pe
> ASxfP16yW98/bU1VqFGNx2nr/x15DqlcU/ZkcjZbZqVApH8jokNPt79o11odZ5RG
> xPvpREC/AiiOZVclYyBf/nvDqc5nZAo7aEB0duinFiZq0Ioqihtue3RTIkmHpFk=
> =36kg
> -----END PGP SIGNATURE-----
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From alexandru at rabbitmq.com  Tue Jan 31 11:30:48 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 31 Jan 2012 11:30:48 +0000
Subject: [rabbitmq-discuss] Clustering - communication
In-Reply-To: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
References: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
Message-ID: <20120131113048.GA3572@southbank.eng.vmware.com>

Hi Dan,

> Can anyone give me some pointers? 

You seem to have done everything right.

> Do both servers need to be
> stop_app'd at the same time for this to succeed or is it something
> else?

Well, one of them has to be.  If you run 'stop_app' on a RabbitMQ
broker, it stops.  It stays loaded into memory, but otherwise it's
completely stopped, so it closes open connections and doesn't open new
ones.

When you cluster, the database on the clustering node needs to be
stopped, so it has to be stop_app'd.  The database on the target node
generally has to be started, so that node has to be started.

The *target* nodes also have to be started for rabbitmqctl to work.

> Also, will stop_app kill any messages? I'm looking not to.

Stop_app is the equivalent of a clean shutdown, so, it will kill
transient messages/queues, but save to disc persistent messages/durable
queues/any other configuration.  Again, when it's stopped, it won't have
any connections, so it won't get new messages.

> have the
> same .erlang.cookie file (had to hexedit to get it exact).

That sounds a bit worrying.  Could you just put some human readable text
in both (e.g. "test"), make sure that both nodes are started, and try
the rabbitmqctl status command from one to the other?

Cheers,
Alex

On Tue, Jan 31, 2012 at 10:07:26AM +0000, Dan Dart wrote:
> Hi all,
> 
> I'm having trouble getting two nodes talking. For reference they're
> called backend and back2 - and each is in each other's hosts file
> (with and without a FQDN).
> 
> Each can connect to each other on ports 4369 and 5672 - and have the
> same .erlang.cookie file (had to hexedit to get it exact).
> They're not connecting through the same network but they're not far
> away (<1ms ping)
> When I try to cluster (taking the node down using stop_app first) - I
> get the error:
> 
> Error: {no_running_cluster_nodes,[rabbit at backend],[rabbit at backend]}
> 
> When I try to use rabbitmqctl -n rabbit at back2 status, from backend, I get:
> 
> Status of node rabbit at back2 ...
> Error: unable to connect to node rabbit at back2: nodedown
> diagnostics:
> - nodes and their ports on back2: [{rabbit,48765}]
> - current node: rabbitmqctl18870 at localhost
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: (the same each time)
> 
> and vice versa.
> 
> Can anyone give me some pointers? Do both servers need to be
> stop_app'd at the same time for this to succeed or is it something
> else?
> Also, will stop_app kill any messages? I'm looking not to.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Tue Jan 31 11:54:53 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 31 Jan 2012 11:54:53 +0000
Subject: [rabbitmq-discuss] RabbitMQ Client Memory issues
In-Reply-To: <e5e42d8c-cc74-48d0-87bc-f43078fd1105@kn4g2000pbc.googlegroups.com>
References: <e5e42d8c-cc74-48d0-87bc-f43078fd1105@kn4g2000pbc.googlegroups.com>
Message-ID: <4F27D68D.10802@rabbitmq.com>

Hi Yogesh,

On 31/01/12 09:56, Yogesh Ketkar wrote:
> After running a java client for a while (15-20 minutes), it runs out
> of memory with OutOfMemoryError.
> I probably can postpone the problem by giving high values for -Xmx.
> 
> Doing jmap and jhat gave following info.
> 
> 173233 instances of class com.rabbitmq.client.impl.AMQCommand
> 173233 instances of class com.rabbitmq.client.impl.CommandAssembler
> 173132 instances of class com.rabbitmq.client.impl.ChannelN
> 173132 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
> 173096 instances of class com.rabbitmq.client.ShutdownSignalException
> 173096 instances of class com.rabbitmq.client.impl.AMQImpl$Channel
> $Close
> 
> I create a channel at the beginning of run() method of the thread and
> close() it in the finally block.
> But seems like all see all the instances of
> com.rabbitmq.client.impl.ChannelN
> 
> any idea, what can be going wrong?

It is possible that you are creating channels that aren't being garbage
collected by the Java VM. If possible you should use only a small number
of channels and then this problem won't occur. For performance reasons
also you should avoid establishing a new channel for each message as
this introduces network overhead and delay.



-Emile

From steve at rabbitmq.com  Tue Jan 31 12:19:10 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 31 Jan 2012 12:19:10 +0000
Subject: [rabbitmq-discuss] ShutdownSignalException second 'channel.open'
In-Reply-To: <5fe26671-e654-48e6-80a6-05a181a8f814@kg1g2000pbb.googlegroups.com>
References: <5fe26671-e654-48e6-80a6-05a181a8f814@kg1g2000pbb.googlegroups.com>
Message-ID: <32E33686-2FCA-4800-BF2B-7B5953786B63@rabbitmq.com>

Yogesh,

Please can you provide some information about your environment? And your
application? What version of RabbitMQ (and client) are you using?

In your stack trace the ShutdownListener you registered is apparently being
called, because the Connection is being shut down. It is not clear why this
exception (and its associated stack trace) appears, it seems to come from your
Listener code, but perhaps that does nothing.

The Shutdown seems to be being called because the channel is being opened twice.
The broker complains about this and closes the connection. Are you creating
channels on different threads simultaneously? (Looking at your app 'design' you
might be.) Depending upon the version of RabbitMQ this might cause a problem.

I'm afraid your application design is unclear:

> This is how I handle doing basicPublish and basicGet on potentially
> non-existent queues
> - publish involves 3 steps
>  queueDeclare
>  queueBind
>  basicPublish
>  If some other thread deletes the queue after either queueDeclare or
> queueBind, basicPublish fails and I again create a new
>  channel and do these operations

I don't think the basicPublish will fail if the queue doesn't exist. Why would
you create a new channel in this case?

Please explain why you expect the queue might be deleted by some other thread.

> - if basicGet fails, I simply ignore it

What do you mean by ignoring it? Do you poll the queue periodically? Why aren't
you using basicConsume and a Consumer to get messages (which will be notified if
the queue is deleted)?

Steve Powell  (a loopy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 30 Jan 2012, at 04:33, Yogesh Ketkar wrote:

> Only operations I ever do with com.rabbitmq.client.Connection in the
> code are
>    c.addShutdownListener
>    c.createChannel
> 
> What does this error signify?
> 
> 2012-01-30 09:44:45,158 ERROR  [ConnectionShutdownHandler]
> ShutdownListener
> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
> {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID
> - second 'channel.open' seen, class-id=20, method-id=10), null,
> "[B at 105691e"}
> 	at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:
> 641)
> 	at
> com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection.java:
> 599)
> 	at
> com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection.java:
> 571)
> 	at com.rabbitmq.client.impl.AMQConnection
> $1.processAsync(AMQConnection.java:88)
> 	at
> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:
> 144)
> 	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:
> 91)
> 	at com.rabbitmq.client.impl.AMQConnection
> $MainLoop.run(AMQConnection.java:500)
> 
> Some additional info.
> I create and close thousands of channels in the code. But at any point
> of time there are not more than 20/21 channels open.
> This is how I handle doing basicPublish and basicGet on potentially
> non-existent queues
> - publish involves 3 steps
>  queueDeclare
>  queueBind
>  basicPublish
>  If some other thread deletes the queue after either queueDeclare or
> queueBind, basicPublish fails and I again create a new
>  channel and do these operations
> - if basicGet fails, I simply ignore it
> 
> regards, Yogesh
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Tue Jan 31 13:43:41 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 31 Jan 2012 13:43:41 +0000
Subject: [rabbitmq-discuss] Clustering - communication
In-Reply-To: <CAECZ853KT-OkM6Q1_3cbz3R0=4NVZJP7qV9DtaFzzz50-uC7ng@mail.gmail.com>
References: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
	<20120131113048.GA3572@southbank.eng.vmware.com>
	<CAECZ853KT-OkM6Q1_3cbz3R0=4NVZJP7qV9DtaFzzz50-uC7ng@mail.gmail.com>
Message-ID: <20120131134341.GA4567@southbank.eng.vmware.com>

> But I think I have it: backend is on 2.4.1 and back2 is on 2.7.1. They
> both use the same 0-9-1 protocol but that'll be it, won't it?

They both need to be the same version.  AMQP is used to talk to the
clients; Erlang messages are used to communicate inside the cluster.  As
a rule, all nodes need to run the same version of Erlang and the same
version of RabbitMQ.  If they don't, it might work, but the behaviour is
undefined.

> > Well, one of them has to be.
> Well - for example - if backend is started (and processing messages)
> and back2 is stopped - and I run the command:
> rabbitmqctl -n rabbit at backend status
> or:
> rabbitmqctl cluster rabbit at backend
>  on back2 - that should be OK?

Yes.

> > Stop_app is the equivalent of a clean shutdown, so, it will kill
> > transient messages/queues, but save to disc persistent messages/durable
> > queues/any other configuration.
> So the solution is to make everything durable I want to keep?

Yes.

> Is the same true when I just do:
> /etc/init.d/rabitmq-server stop

Yes.

> >?Again, when it's stopped, it won't have
> > any connections, so it won't get new messages.
> That's why we're trying to do it as fast as possible.

Bear in mind that the more persistent things you have (messages and
queues), the longer it will take for RabbitMQ to shutdown and to recover
from unclean shutdowns (caused by killing the rabbitmq-server process,
for instance).

The problem you're seeing is probably caused by the version mismatch.

Cheers,
Alex

On Tue, Jan 31, 2012 at 01:21:49PM +0000, Dan Dart wrote:
> > You seem to have done everything right.
> Ouch.
> 
> > Well, one of them has to be.
> Well - for example - if backend is started (and processing messages)
> and back2 is stopped - and I run the command:
> rabbitmqctl -n rabbit at backend status
> or:
> rabbitmqctl cluster rabbit at backend
>  on back2 - that should be OK?
> 
>  > The *target* nodes also have to be started for rabbitmqctl to work.
> The ones you're trying to cluster into - they are started.
> 
> > Stop_app is the equivalent of a clean shutdown, so, it will kill
> > transient messages/queues, but save to disc persistent messages/durable
> > queues/any other configuration.
> So the solution is to make everything durable I want to keep?
> Is the same true when I just do:
> /etc/init.d/rabitmq-server stop
> 
> 
> >?Again, when it's stopped, it won't have
> > any connections, so it won't get new messages.
> That's why we're trying to do it as fast as possible.
> 
> > That sounds a bit worrying. ?Could you just put some human readable text
> > in both (e.g. "test"), make sure that both nodes are started, and try
> > the rabbitmqctl status command from one to the other?
> Well - yes - it reads the same on each. No more carriage returns - the
> hex is exact.
> and the current node cookie hash is also the same.
> 
> But I think I have it: backend is on 2.4.1 and back2 is on 2.7.1. They
> both use the same 0-9-1 protocol but that'll be it, won't it?
> 
> Cheers
> Dan

From alexandru at rabbitmq.com  Tue Jan 31 13:48:47 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 31 Jan 2012 13:48:47 +0000
Subject: [rabbitmq-discuss] Clustering - communication
In-Reply-To: <CAECZ853t3GMh9Qj_hNWqg8u7GBwP4Yoovsp9Ju9N_r=U8BaRZA@mail.gmail.com>
References: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
	<20120131113048.GA3572@southbank.eng.vmware.com>
	<CAECZ853KT-OkM6Q1_3cbz3R0=4NVZJP7qV9DtaFzzz50-uC7ng@mail.gmail.com>
	<CAECZ853t3GMh9Qj_hNWqg8u7GBwP4Yoovsp9Ju9N_r=U8BaRZA@mail.gmail.com>
Message-ID: <20120131134847.GB4567@southbank.eng.vmware.com>

> Turns out that didn't help them recognise each other - any other pointers?

Mhm.

Try this: on backend, run:
  erl -sname foo

On the other, run:
  erl -sname bar -remsh foo at backend

If you see something like "ERROR: Shell process terminated!", it's an
Erlang connectivity problem.  Otherwise, it's a RabbitMQ-related problem.

Alex

On Tue, Jan 31, 2012 at 01:38:42PM +0000, Dan Dart wrote:
> > But I think I have it: backend is on 2.4.1 and back2 is on 2.7.1. They
> > both use the same 0-9-1 protocol but that'll be it, won't it?
> 
> Turns out that didn't help them recognise each other - any other pointers?

From simon at rabbitmq.com  Tue Jan 31 13:53:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 Jan 2012 13:53:44 +0000
Subject: [rabbitmq-discuss] Clustering - communication
In-Reply-To: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
References: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
Message-ID: <4F27F268.1090604@rabbitmq.com>

On 31/01/12 10:07, Dan Dart wrote:
> Each can connect to each other on ports 4369 and 5672

Do you mean *only* those ports?

Erlang will by default open an arbitrary port for inter-node 
communication - to change this see:

http://www.erlang.org/faq/how_do_i.html#id55164

For RabbitMQ use at least you can set min and max to the same value, eg:

{kernel, [{inet_dist_listen_min, 9100},
           {inet_dist_listen_max, 9100}]}

in your config file.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From yogimogi at gmail.com  Tue Jan 31 13:56:55 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Tue, 31 Jan 2012 05:56:55 -0800 (PST)
Subject: [rabbitmq-discuss] ShutdownSignalException second 'channel.open'
In-Reply-To: <32E33686-2FCA-4800-BF2B-7B5953786B63@rabbitmq.com>
References: <5fe26671-e654-48e6-80a6-05a181a8f814@kg1g2000pbb.googlegroups.com>
	<32E33686-2FCA-4800-BF2B-7B5953786B63@rabbitmq.com>
Message-ID: <137381af-f9d8-4871-90d3-d60f478aa39b@x6g2000pbk.googlegroups.com>

I am using RabbitMQ server version 2.7.1.
Java Client Jar used is
rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar

> The Shutdown seems to be being called because the channel is being opened twice.
> The broker complains about this and closes the connection. Are you creating
> channels on different threads simultaneously?
Yes indeed, I am creating channels on different threads.

> I don't think the basicPublish will fail if the queue doesn't exist. Why would
> you create a new channel in this case?
Yes, you are right. I will basically lose the message in this case.

Now about overall problem statement.
My application has a main queue which looks like
MainQueue
  - App1-Event1
  - App2-Event1
  - App1-Event2
  - App1-Event3
  - App3-Event1
  - App3-Event2
  - App2-Event2

Basically there are going to be events from different Apps (there can
be thousands of apps) and events belonging to an App must
be processed sequentially. Events across different apps can and should
be be processed in parallel.
So I have only one consumer on MainQueue (using basicConsume) which
reads events from MainQueue and just moves it to appropriate declared/
redeclared queue.
So this is how new queue structure would look like.

App1
  - App1-Event1
  - App1-Event2
  - App1-Event3

App2
  - App2-Event1
  - App2-Event2

App3
  - App3-Event1
  - App3-Event2


Now again when Event1 is processed from Queue App1, Event2 of App1
can't be processed unless processing of Event1 is complete.
Processing of event involves asynchronous communication with external
systems, so once Event1 is fetched (and acknowledged) from queue
App1,
I create another queue like
App1_Return
  - App1-Event1-TaskId

I need to query external system using TaskId after certain time
interval, to check status of event processing of Event1. Once I get
the status (either sucess or failure)
I discard App1-Event1-TaskId and ready to process App1-Event2. So all
_Return queues will only have one event at any point of time.

An event on an app might even occur once a day. So I don't want to
keep so many queues (potentially 20000 if there are 10000 apps)
hanging around.
Both auto_delete and x-expires are not very useful as in both the
schemes, queues get deleted even when they have messages.
Ideally whenever last message from any Queue (except MainQueue) is
consumed, I want to delete that queue. Of course, one has to make sure
while a queue is getting deleted, there might be an event destined for
that. So if one guy is doing
queueDelete('somequeue', true, true) and other guy is doing
queueDeclare, queueBind, basicPublish. If queueDelete gets executed
after
queueBind, message will be lost.

One of the reasons, I don't do basicConsume on queues is, I am going
to have thousands of queues. I rather thought it would be easier to
have a thread pool, each consuming just one message from a queue in
round-robin fashion.

As was mentioned in some other response, I will certainly not create a
new channel in every thread, but would rather try and reuse them.


Thanks for all the help.
Regards, Yogesh



On Jan 31, 5:19?pm, Steve Powell <st... at rabbitmq.com> wrote:
> Yogesh,
>
> Please can you provide some information about your environment? And your
> application? What version of RabbitMQ (and client) are you using?
>
> In your stack trace the ShutdownListener you registered is apparently being
> called, because the Connection is being shut down. It is not clear why this
> exception (and its associated stack trace) appears, it seems to come from your
> Listener code, but perhaps that does nothing.
>
> The Shutdown seems to be being called because the channel is being opened twice.
> The broker complains about this and closes the connection. Are you creating
> channels on different threads simultaneously? (Looking at your app 'design' you
> might be.) Depending upon the version of RabbitMQ this might cause a problem.
>
> I'm afraid your application design is unclear:
>
> > This is how I handle doing basicPublish and basicGet on potentially
> > non-existent queues
> > - publish involves 3 steps
> > ?queueDeclare
> > ?queueBind
> > ?basicPublish
> > ?If some other thread deletes the queue after either queueDeclare or
> > queueBind, basicPublish fails and I again create a new
> > ?channel and do these operations
>
> I don't think the basicPublish will fail if the queue doesn't exist. Why would
> you create a new channel in this case?
>
> Please explain why you expect the queue might be deleted by some other thread.
>
> > - if basicGet fails, I simply ignore it
>
> What do you mean by ignoring it? Do you poll the queue periodically? Why aren't
> you using basicConsume and a Consumer to get messages (which will be notified if
> the queue is deleted)?
>
> Steve Powell ?(a loopy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 30 Jan 2012, at 04:33, Yogesh Ketkar wrote:
>
>
>
>
>
>
>
>
>
> > Only operations I ever do with com.rabbitmq.client.Connection in the
> > code are
> > ? ?c.addShutdownListener
> > ? ?c.createChannel
>
> > What does this error signify?
>
> > 2012-01-30 09:44:45,158 ERROR ?[ConnectionShutdownHandler]
> > ShutdownListener
> > com.rabbitmq.client.ShutdownSignalException: connection error; reason:
> > {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID
> > - second 'channel.open' seen, class-id=20, method-id=10), null,
> > "[B at 105691e"}
> > ? ?at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:
> > 641)
> > ? ?at
> > com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection. java:
> > 599)
> > ? ?at
> > com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection. java:
> > 571)
> > ? ?at com.rabbitmq.client.impl.AMQConnection
> > $1.processAsync(AMQConnection.java:88)
> > ? ?at
> > com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel .java:
> > 144)
> > ? ?at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:
> > 91)
> > ? ?at com.rabbitmq.client.impl.AMQConnection
> > $MainLoop.run(AMQConnection.java:500)
>
> > Some additional info.
> > I create and close thousands of channels in the code. But at any point
> > of time there are not more than 20/21 channels open.
> > This is how I handle doing basicPublish and basicGet on potentially
> > non-existent queues
> > - publish involves 3 steps
> > ?queueDeclare
> > ?queueBind
> > ?basicPublish
> > ?If some other thread deletes the queue after either queueDeclare or
> > queueBind, basicPublish fails and I again create a new
> > ?channel and do these operations
> > - if basicGet fails, I simply ignore it
>
> > regards, Yogesh
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dan at canddi.com  Tue Jan 31 13:58:32 2012
From: dan at canddi.com (Dan Dart)
Date: Tue, 31 Jan 2012 13:58:32 +0000
Subject: [rabbitmq-discuss] Clustering - communication
In-Reply-To: <4F27F268.1090604@rabbitmq.com>
References: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
	<4F27F268.1090604@rabbitmq.com>
Message-ID: <CAECZ8528nx61t6mygCKqvtbbe8KUVprMK0BGs9NqFKGQw3nC-g@mail.gmail.com>

> If you see something like "ERROR: Shell process terminated!", it's an
> Erlang connectivity problem.

I do, so it is.
They both have the same version of Erlang (which is a good start).

> Do you mean *only* those ports?
Yes - as it says in the docs.

Thanks - I'll make sure the Erlangs can talk properly.

From dan at canddi.com  Tue Jan 31 14:02:34 2012
From: dan at canddi.com (Dan Dart)
Date: Tue, 31 Jan 2012 14:02:34 +0000
Subject: [rabbitmq-discuss] Clustering - communication
In-Reply-To: <CAECZ8528nx61t6mygCKqvtbbe8KUVprMK0BGs9NqFKGQw3nC-g@mail.gmail.com>
References: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
	<4F27F268.1090604@rabbitmq.com>
	<CAECZ8528nx61t6mygCKqvtbbe8KUVprMK0BGs9NqFKGQw3nC-g@mail.gmail.com>
Message-ID: <CAECZ851jKDwzHJ3+0xU9e_jgwvDk460=bYLAdWv3HYNosFW_gA@mail.gmail.com>

> in your config file.
Where will this be in a default Ubuntu package? Is there none by default?

From simon at rabbitmq.com  Tue Jan 31 14:04:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 Jan 2012 14:04:01 +0000
Subject: [rabbitmq-discuss] Clustering - communication
In-Reply-To: <CAECZ851jKDwzHJ3+0xU9e_jgwvDk460=bYLAdWv3HYNosFW_gA@mail.gmail.com>
References: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>	<4F27F268.1090604@rabbitmq.com>	<CAECZ8528nx61t6mygCKqvtbbe8KUVprMK0BGs9NqFKGQw3nC-g@mail.gmail.com>
	<CAECZ851jKDwzHJ3+0xU9e_jgwvDk460=bYLAdWv3HYNosFW_gA@mail.gmail.com>
Message-ID: <4F27F4D1.10302@rabbitmq.com>

On 31/01/12 14:02, Dan Dart wrote:
> Where will this be in a default Ubuntu package? Is there none by default?

/etc/rabbitmq/rabbitmq.config, and it needs to be created - see 
http://www.rabbitmq.com/configure.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dan at canddi.com  Tue Jan 31 14:43:37 2012
From: dan at canddi.com (Dan Dart)
Date: Tue, 31 Jan 2012 14:43:37 +0000
Subject: [rabbitmq-discuss] Clustering - communication
In-Reply-To: <4F27F4D1.10302@rabbitmq.com>
References: <CAECZ8514mRD89av88Z1wWt4m69_4r6DK_HCLyZKW7eY_MyoKeA@mail.gmail.com>
	<4F27F268.1090604@rabbitmq.com>
	<CAECZ8528nx61t6mygCKqvtbbe8KUVprMK0BGs9NqFKGQw3nC-g@mail.gmail.com>
	<CAECZ851jKDwzHJ3+0xU9e_jgwvDk460=bYLAdWv3HYNosFW_gA@mail.gmail.com>
	<4F27F4D1.10302@rabbitmq.com>
Message-ID: <CAECZ850NY_1qrRYEyw4gT_uOBaz57oNL5Zq80T8xgtEHMMESfg@mail.gmail.com>

Got it!

For reference,
I had to set /etc/rabbitmq/rabbitmq.config to look like:

[
    {mnesia, [{dump_log_write_threshold, 1000}]},
    {kernel, [{inet_dist_listen_min, 9100},{inet_dist_listen_max, 9105}]}
].

& unfirewall 9100-9105 on each server for each other.

From michael.justin at gmx.net  Tue Jan 31 17:09:04 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 31 Jan 2012 18:09:04 +0100
Subject: [rabbitmq-discuss] ANN: Habari Client for RabbitMQ 1.2 - for Delphi
	and Free Pascal
Message-ID: <jg977i$ij$1@dough.gmane.org>

January 31, 2012 - Habarisoft released 1.2 of Habari RabbitMQ Client, a 
library which provides easy access from Delphi and Free Pascal to RabbitMQ.

Habari Client for RabbitMQ uses a plug-in style architecture for 
communication libraries and message transformers for XML and JSON object 
serialization, and loosely follows the specification of the JMS (Java 
Message Service) API for Message Oriented Middleware, to provide a high 
level of abstraction which allows to implement messaging patterns, by 
writing very little code.

New in version 1.2:

* Tested with RabbitMQ 2.6.1 and 2.7.1
* More than 12500 outgoing messages per second
* Improved Throughput Demo, Chat Demo, GUI Demo applications
* Improvements in the Indy and Synapse communication adapter

Home page:
http://www.habarisoft.com/habari_rabbitmq.html

API:
http://www.habarisoft.com/habari_rabbitmq/1.2/docs/api/index.html

Getting Started Guide (PDF):
http://www.habarisoft.com/download/HabariRabbitMQGettingStarted.pdf

Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From alexis at rabbitmq.com  Tue Jan 31 17:22:21 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 31 Jan 2012 17:22:21 +0000
Subject: [rabbitmq-discuss] ANN: Habari Client for RabbitMQ 1.2 - for
 Delphi and Free Pascal
In-Reply-To: <jg977i$ij$1@dough.gmane.org>
References: <jg977i$ij$1@dough.gmane.org>
Message-ID: <CACOPnvd+5Z3SH091AwwTYA5o79QM3r4F63LjahuUe+sh7hoOMQ@mail.gmail.com>

Thanks Michael!

On Tue, Jan 31, 2012 at 5:09 PM, Michael Justin <michael.justin at gmx.net> wrote:
> January 31, 2012 - Habarisoft released 1.2 of Habari RabbitMQ Client, a
> library which provides easy access from Delphi and Free Pascal to RabbitMQ.
>
> Habari Client for RabbitMQ uses a plug-in style architecture for
> communication libraries and message transformers for XML and JSON object
> serialization, and loosely follows the specification of the JMS (Java
> Message Service) API for Message Oriented Middleware, to provide a high
> level of abstraction which allows to implement messaging patterns, by
> writing very little code.
>
> New in version 1.2:
>
> * Tested with RabbitMQ 2.6.1 and 2.7.1
> * More than 12500 outgoing messages per second
> * Improved Throughput Demo, Chat Demo, GUI Demo applications
> * Improvements in the Indy and Synapse communication adapter
>
> Home page:
> http://www.habarisoft.com/habari_rabbitmq.html
>
> API:
> http://www.habarisoft.com/habari_rabbitmq/1.2/docs/api/index.html
>
> Getting Started Guide (PDF):
> http://www.habarisoft.com/download/HabariRabbitMQGettingStarted.pdf
>
> Regards
> --
> Michael Justin
> habarisoft - Enterprise Messaging Software for Delphi
> http://www.habarisoft.com/
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yogimogi at gmail.com  Tue Jan 31 17:49:11 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Tue, 31 Jan 2012 09:49:11 -0800 (PST)
Subject: [rabbitmq-discuss] Problem with RabbitMQ Java Client (Memory leak)
Message-ID: <fd4945fc-14a3-4efb-9016-c78a9cae8043@vh10g2000pbc.googlegroups.com>

I am using rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar with
RabbitMQ 2.7.1 Server.

Just run this code

public static void main(String[] argv) throws IOException {
    ConnectionFactory f = new ConnectionFactory();
    Connection c = f.newConnection();
    for(int i = 0; i < 20000; ++i) {
        Channel ch = c.createChannel();
        ch.close();
    }
    System.gc();
    while(true) {}
}

While program is running, observe the memory usage, it keeps on
increasing
Get process id and do following
jmap -dump:format=b,file=yo.bin  <pid>
jhat jhat -J-mx768m -stack false yo.bin
Once jhat brings up http server, go here
http://localhost:7000/showInstanceCounts/

20001 instances of class com.rabbitmq.client.impl.AMQCommand
20001 instances of class com.rabbitmq.client.impl.CommandAssembler
20000 instances of class com.rabbitmq.client.ShutdownSignalException
20000 instances of class com.rabbitmq.client.impl.AMQImpl$Channel
$Close
20000 instances of class com.rabbitmq.client.impl.ChannelN
20000 instances of class com.rabbitmq.client.impl.ConsumerDispatcher

In-spite of closing all the channels, not only channels but associated
objects (ShutdownSignalException, ChannelClose) continue to consume
memory.
For sure, knowing this now, I will use channelCreate call sparingly.

Is there a way to remedy this situation?
What is also worrying is instances of AMQCommand, so would this be the
case for each and every call of client library?

regards, Yogesh


From jerryk at vmware.com  Tue Jan 31 19:26:05 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 31 Jan 2012 11:26:05 -0800 (PST)
Subject: [rabbitmq-discuss] queue discovery
In-Reply-To: <CA+zYriS4bgpGohM_R4q8JZr-R++Q1TUWtvWDbKrsKR1p7Mo7iA@mail.gmail.com>
Message-ID: <3576a5aa-6abc-44e2-8304-62651cfe0d3a@strongmad.batnest.org>

Hi, Steven...

If you publish using the 'mandatory' flag (or the 'immediate' flag for
that matter) and the message can't be delivered (for the notion of 
'delivered' enforced by the respective flag), the Rabbit broker will
hand the message back to the sending client using the basic.return
AMQP command.

You'd catch this by subscribing to the IModel.BasicReturn event with
something like:

channel.BasicReturn += new RabbitMQ.Client.Events.BasicReturnEventHandler( whatever_args );

If you've not go any listeners attached to that event, the failed
delivery of your message will pass by unnoticed...

(NOTE:  Please double check the real docs when I give .NET advice; I'm far from 
an expert on that client and not regularly immersed in the .NET world with
sufficient intensity :-) )

Best regards,
Jerry

----- Original Message -----
From: "Steven Taylor" <taylste at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, January 30, 2012 10:25:38 PM
Subject: Re: [rabbitmq-discuss] queue discovery


Hi Jerry, 

under the .net client, would that come through on the below? event BasicAckEventHandler BasicAcks; 
thanks, 
-Steven 




On 31 January 2012 05:49, Jerry Kuch < jerryk at vmware.com > wrote: 


Hi, Steven 

Asserting the queue existence probably may not be heavyweight enough for you 
to worry about. That said, you could consider setting the 'mandatory' flag 
when you publish, in which case you'll get an asynchronous notification if the 
message cannot be routed to any queue (e.g. if no queues are bound to the 
exchange you published too, or your routing key didn't match one that was, etc.) 

Best regards, 
Jerry 




----- Original Message ----- 
From: "Steven Taylor" < taylste at gmail.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, January 30, 2012 9:21:46 PM 
Subject: [rabbitmq-discuss] queue discovery 



Hi, 

chicken and egg situation here. 

Sender expects that receiver will have created a queue, only, the sender is in this case the first to exist, and so sends a message to a non-existant queue. 

Result: rabbit throws away the message. Is the only way forward to always assert queue existance, or is there a lighter weight alternative? i.e. it'd be nice to get a status or exception back stating if the message got routed or not. 

Same situation could occur if queue is defined with non durable and autodelete. i.e. rabbit goes down and then comes back up. 

thanks, 
-Steven 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


From jerryk at vmware.com  Tue Jan 31 19:29:30 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 31 Jan 2012 11:29:30 -0800 (PST)
Subject: [rabbitmq-discuss] queue discovery
In-Reply-To: <CA+zYriQ6YO0osmXSbApR6TYW02rOP06rzfca0oiNgVFB-w3YCA@mail.gmail.com>
Message-ID: <f25f3fd6-6b13-47ec-89a8-5e68063e3fb0@strongmad.batnest.org>

Hi, Steven...

Usually this is a mishap at the publication end, but a good way to get
insight during debugging is to use the firehose tracer feature of Rabbit.
See here for details:

http://www.rabbitmq.com/firehose.html

Using firehose you'll be able to see every message published and every
message delivered at a "close to the wire" level of detail that will enable
you to catch things like messages that weren't published to where you thought
they were going, messages that weren't properly ACKed at the consumer side,
etc.

Give it a try as it may yield insight.  Also, double check your bindings,
and the details of how you're publishing somewhat meticulously...

Best regards,
Jerry

----- Original Message -----
From: "Steven Taylor" <taylste at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: "Jerry Kuch" <jerryk at vmware.com>
Sent: Monday, January 30, 2012 10:40:55 PM
Subject: Re: [rabbitmq-discuss] queue discovery


decided to assert that the queue exists for now. Got a weird publish issue. I am publishing to a queue that exists and the message isn't turning up. 

I confirmed this by looking at "rabbitmqctl.bat list_queues" and also, via the management plugin. 

Have you seen this before? What's a good way to troubleshoot? 

thanks, 
-Steven 


On 31 January 2012 06:25, Steven Taylor < taylste at gmail.com > wrote: 



Hi Jerry, 

under the .net client, would that come through on the below? event BasicAckEventHandler BasicAcks; 
thanks, 
-Steven 






On 31 January 2012 05:49, Jerry Kuch < jerryk at vmware.com > wrote: 


Hi, Steven 

Asserting the queue existence probably may not be heavyweight enough for you 
to worry about. That said, you could consider setting the 'mandatory' flag 
when you publish, in which case you'll get an asynchronous notification if the 
message cannot be routed to any queue (e.g. if no queues are bound to the 
exchange you published too, or your routing key didn't match one that was, etc.) 

Best regards, 
Jerry 




----- Original Message ----- 
From: "Steven Taylor" < taylste at gmail.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, January 30, 2012 9:21:46 PM 
Subject: [rabbitmq-discuss] queue discovery 



Hi, 

chicken and egg situation here. 

Sender expects that receiver will have created a queue, only, the sender is in this case the first to exist, and so sends a message to a non-existant queue. 

Result: rabbit throws away the message. Is the only way forward to always assert queue existance, or is there a lighter weight alternative? i.e. it'd be nice to get a status or exception back stating if the message got routed or not. 

Same situation could occur if queue is defined with non durable and autodelete. i.e. rabbit goes down and then comes back up. 

thanks, 
-Steven 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 



From jerryk at vmware.com  Tue Jan 31 19:41:20 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 31 Jan 2012 11:41:20 -0800 (PST)
Subject: [rabbitmq-discuss] Clients reconnection logic
In-Reply-To: <b4738edf-e8b1-4e07-a3be-c3c7a29b73cd@t2g2000yqk.googlegroups.com>
Message-ID: <6bee8090-ae63-49a9-aa11-d31dcff138bf@strongmad.batnest.org>

Hi, Pablo...

I confess I'm not up on the current state of the projects that you're looking
at, but the reconnect logic doesn't have to be much more exotic than catching
the connection failure and opening a new one (plus possibly recreating your
message fabric elements if appropriate) when it occurs.  Probably the most 
annoying part is making your client code aware of all the nodes in your cluster,
keeping track of those nodes that have spurned it in the past, and choosing other
ones to try (plus maybe re-trying a spurner at some point).

One thing you might consider to make that last part less annoying is putting
some sort of load balancer, like HAproxy, in front of your cluster.  Then it
can do the dirty work of making sure to wire your connection to a live cluster
node, and your clients only need to know one place to connect to...  Sure, it's
more of a deployment/infrastructural change, but it can make things simpler in
production...

Best regards,
Jerry

----- Original Message -----
From: "Pablo Molnar" <pablomolnar at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, January 30, 2012 1:01:36 PM
Subject: [rabbitmq-discuss] Clients reconnection logic

Hi everyone,
I've successfully set up a 3 instances cluster and now I'm dealing
with reconnect logic in my java clients.

Before reinventing the wheel, I'm aware of this 2 projects:
- https://github.com/joshdevins/rabbitmq-ha-client
- http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/

Anyone have tried this code? Both seems a little outdated...

I'm just wanna the simplest logic giving a fixed list of nodes to
successfully reconnect my clients in a transparent manner.

I'd appreciate any info regarding clients reconnection.

Cheers,
Pablo Molnar
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From grussx at gmail.com  Tue Jan 31 20:04:01 2012
From: grussx at gmail.com (garyrussell)
Date: Tue, 31 Jan 2012 12:04:01 -0800 (PST)
Subject: [rabbitmq-discuss] Clients reconnection logic
In-Reply-To: <6bee8090-ae63-49a9-aa11-d31dcff138bf@strongmad.batnest.org>
References: <6bee8090-ae63-49a9-aa11-d31dcff138bf@strongmad.batnest.org>
Message-ID: <158b55d5-0033-41df-bbb1-9d174f524ba2@v14g2000vbc.googlegroups.com>

You may be aware that there is a Spring abstraction on top of the
Rabbit client here http://www.springsource.org/spring-amqp

We are currently working on adding HA features on this branch
https://github.com/garyrussell/spring-amqp/tree/AMQP-206a

This allows things like providing the connection factory with a list
of servers enabling failover - you catch an exception on
template.send() and resubmit and it will reconnect on the next attempt
(selecting one of the other servers). Listeners detect cancels from
brokers (essential if a consumer is receiving from a copy of an HA
queue, and not the master).

Also, we have AMQP adapters in the Spring Integration project
http://www.springsource.org/spring-integration

We are also working on enhancements there to automatically retry in
the event of a failiure.

From alan.antonuk at gmail.com  Tue Jan 31 20:28:44 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 31 Jan 2012 15:28:44 -0500
Subject: [rabbitmq-discuss] [announce] New maintainer for the rabbitmq-c
	library
Message-ID: <CAAt2poL=pO8eCZ7Yze-+8avbjwCKMU7W_5eLBmm-e9rAqrCuqQ@mail.gmail.com>

Hi;

I am happy to announce that with the blessing of the RabbitMQ team, I have
taken the lead on further development of the C RabbitMQ client library,
also known as rabbitmq-c.

The new home for the code is now on github:
https://github.com/alanxz/rabbitmq-c

My long term goal with the library is to have simple, stable, and scalable
library that has feature-parity of that of the Java and .NET clients.

Some near term goals I have for the library include:
- Documenting the APIs presented by the library
- Merging in channel-oriented memory management
https://github.com/alanxz/rabbitmq-c/pull/5
- Providing some patterns for consuming messages to reduce the amount of
boiler plate code users have to write.


I want to encourage users of the library to get involved in the development
of the library. Good ways to get involved include:
 - Forking <https://github.com/alanxz/rabbitmq-c/fork> the library on
github and submitting a pull request
 - Submitting any bugs, or feature requests to the issue tracker on github
https://github.com/alanxz/rabbitmq-c/issues
 - Sparking up a discussion or simply asking questions on usage on the
rabbitmq-discuss listserv

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/c95a81f9/attachment.htm>

From dathan at schoolfeed.com  Tue Jan 31 20:52:55 2012
From: dathan at schoolfeed.com (Dathan Pattishall)
Date: Tue, 31 Jan 2012 12:52:55 -0800
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get some
	help
Message-ID: <CA+22WDRAgsB3iuXMne4PxgRr4z0=fbQZthZgGbAyYPQRVGofAQ@mail.gmail.com>

Let me first describe my setup.

root at webnode1]# rabbitmqadmin.py show overview
+--------------------+-----------------+--------------------+------------------+
| management_version |      node       | statistics_db_node |
statistics_level |
+--------------------+-----------------+--------------------+------------------+
| 2.7.1              | rabbit at webnode1 | rabbit at webnode1    | fine
    |
+--------------------+-----------------+--------------------+------------------+

Rabbit MQ's producers comes from PHP 5.3.8
http://www.php.net/manual/en/book.amqp.php. Each apache process could
produce a rabbit message, I am producing around 1000 messages a second on
 c1.xtralarge instance at ec2.

My erlang version is

/usr/local/bin/erl -v
Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe]
[kernel-poll:false]


The PROBLEM:

After about 40 mins of rabbit accepting messages all connections block
causing a rather bad error on the front ends killing traffic. Turning
rabbit off and restarting the web servers forces a recovery.

Stats from Rabbit:

Roughly 5000 queues are made
Roughly 3600 exchanges are made
Each exchange can have at most 1200 queues bound to it.
Each Queue is setup for autodelete and so is the exchanges with delivery
type 1.
All data passed is JSON

The consumer is NODE and its keeping up with the consumption

RabbitMQ memlimit is around 5.3G
RabbitMQ mem used hits around 1.9G when it freezes produces
RabbitMQ proc used hits around 220K
RabbitMQ fd_total is 50K
RabbitMQ socks_total is around 45K and Socks used is 4K
mem_ets hists 100M // not sure what this is

Any idea what is going on? What limit am I hitting? Why does RabbitMQ
block? How can I detect that I am about to hit a block state? Any
suggestions or request of additional data would be great.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/1331150d/attachment.htm>

From jerryk at vmware.com  Tue Jan 31 20:56:46 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 31 Jan 2012 12:56:46 -0800 (PST)
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get
	some	help
In-Reply-To: <CA+22WDRAgsB3iuXMne4PxgRr4z0=fbQZthZgGbAyYPQRVGofAQ@mail.gmail.com>
Message-ID: <1b398974-be7f-4061-b26f-6cd808ca9425@strongmad.batnest.org>

Hi, Dathan...

What are your consumers doing with the published messages?  If you use rabbitmqctl or 
the management plugin to look at what's going on in your queues, do you see messages
accumulating but not being delivered?  Or delivered but not ACKed?  If messages are 
building up (either undelivered or unACKed) faster than consumers are draining them,
you might be hitting memory-based flow control, which will use TCP back pressure to
stop the publishers.

See here for more information:

http://www.rabbitmq.com/memory.html

To get an idea whether this is happening to you, check out your queue contents as 
suggested above, and see if memory alarms are being set in your rabbit logs.../

Best regards,
Jerry

----- Original Message -----
From: "Dathan Pattishall" <dathan at schoolfeed.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, January 31, 2012 12:52:55 PM
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get some	help




Let me first describe my setup. 

root at webnode1]# rabbitmqadmin.py show overview 
+--------------------+-----------------+--------------------+------------------+ 
| management_version | node | statistics_db_node | statistics_level | 
+--------------------+-----------------+--------------------+------------------+ 
| 2.7.1 | rabbit at webnode1 | rabbit at webnode1 | fine | 
+--------------------+-----------------+--------------------+------------------+ 



Rabbit MQ's producers comes from PHP 5.3.8 http://www.php.net/manual/en/book.amqp.php . Each apache process could produce a rabbit message, I am producing around 1000 messages a second on c1.xtralarge instance at ec2. 


My erlang version is 


/usr/local/bin/erl -v 
Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe] [kernel-poll:false] 




The PROBLEM: 


After about 40 mins of rabbit accepting messages all connections block causing a rather bad error on the front ends killing traffic. Turning rabbit off and restarting the web servers forces a recovery. 


Stats from Rabbit: 


Roughly 5000 queues are made 
Roughly 3600 exchanges are made 
Each exchange can have at most 1200 queues bound to it. 
Each Queue is setup for autodelete and so is the exchanges with delivery type 1. 
All data passed is JSON 


The consumer is NODE and its keeping up with the consumption 


RabbitMQ memlimit is around 5.3G 
RabbitMQ mem used hits around 1.9G when it freezes produces 
RabbitMQ proc used hits around 220K 
RabbitMQ fd_total is 50K 
RabbitMQ socks_total is around 45K and Socks used is 4K 
mem_ets hists 100M // not sure what this is 


Any idea what is going on? What limit am I hitting? Why does RabbitMQ block? How can I detect that I am about to hit a block state? Any suggestions or request of additional data would be great. 






_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dathan at schoolfeed.com  Tue Jan 31 21:05:39 2012
From: dathan at schoolfeed.com (Dathan Pattishall)
Date: Tue, 31 Jan 2012 13:05:39 -0800
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get
	some help
In-Reply-To: <1b398974-be7f-4061-b26f-6cd808ca9425@strongmad.batnest.org>
References: <CA+22WDRAgsB3iuXMne4PxgRr4z0=fbQZthZgGbAyYPQRVGofAQ@mail.gmail.com>
	<1b398974-be7f-4061-b26f-6cd808ca9425@strongmad.batnest.org>
Message-ID: <CA+22WDQ1s3jdsTC279cfFX-s-nbTngvxqF1hMz6dCXriBK+1Lg@mail.gmail.com>

Hi Jerry,

I neglected to mentioned that I am not hitting the memory-based flow
control according to my memory alarm stat from
rabbitmqadmin.py list nodes

What threshold would the TCP back pressure logic hit? I assume when the
memory limit is reached rabbit pushes back on the publishers? Rabbit did
not use more then 2G of RAM out of the 5G allowed for it, if that is the
case.

Also is there a way to tell rabbit drop the messages instead of block?


On Tue, Jan 31, 2012 at 12:56 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Dathan...
>
> What are your consumers doing with the published messages?  If you use
> rabbitmqctl or
> the management plugin to look at what's going on in your queues, do you
> see messages
> accumulating but not being delivered?  Or delivered but not ACKed?  If
> messages are
> building up (either undelivered or unACKed) faster than consumers are
> draining them,
> you might be hitting memory-based flow control, which will use TCP back
> pressure to
> stop the publishers.
>
> See here for more information:
>
> http://www.rabbitmq.com/memory.html
>
> To get an idea whether this is happening to you, check out your queue
> contents as
> suggested above, and see if memory alarms are being set in your rabbit
> logs.../
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Dathan Pattishall" <dathan at schoolfeed.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, January 31, 2012 12:52:55 PM
> Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get some
>      help
>
>
>
>
> Let me first describe my setup.
>
> root at webnode1]# rabbitmqadmin.py show overview
>
> +--------------------+-----------------+--------------------+------------------+
> | management_version | node | statistics_db_node | statistics_level |
>
> +--------------------+-----------------+--------------------+------------------+
> | 2.7.1 | rabbit at webnode1 | rabbit at webnode1 | fine |
>
> +--------------------+-----------------+--------------------+------------------+
>
>
>
> Rabbit MQ's producers comes from PHP 5.3.8
> http://www.php.net/manual/en/book.amqp.php . Each apache process could
> produce a rabbit message, I am producing around 1000 messages a second on
> c1.xtralarge instance at ec2.
>
>
> My erlang version is
>
>
> /usr/local/bin/erl -v
> Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0]
> [hipe] [kernel-poll:false]
>
>
>
>
> The PROBLEM:
>
>
> After about 40 mins of rabbit accepting messages all connections block
> causing a rather bad error on the front ends killing traffic. Turning
> rabbit off and restarting the web servers forces a recovery.
>
>
> Stats from Rabbit:
>
>
> Roughly 5000 queues are made
> Roughly 3600 exchanges are made
> Each exchange can have at most 1200 queues bound to it.
> Each Queue is setup for autodelete and so is the exchanges with delivery
> type 1.
> All data passed is JSON
>
>
> The consumer is NODE and its keeping up with the consumption
>
>
> RabbitMQ memlimit is around 5.3G
> RabbitMQ mem used hits around 1.9G when it freezes produces
> RabbitMQ proc used hits around 220K
> RabbitMQ fd_total is 50K
> RabbitMQ socks_total is around 45K and Socks used is 4K
> mem_ets hists 100M // not sure what this is
>
>
> Any idea what is going on? What limit am I hitting? Why does RabbitMQ
> block? How can I detect that I am about to hit a block state? Any
> suggestions or request of additional data would be great.
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/b5eec2c9/attachment.htm>

From jerryk at vmware.com  Tue Jan 31 21:13:56 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 31 Jan 2012 13:13:56 -0800 (PST)
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get
	some help
In-Reply-To: <CA+22WDQ1s3jdsTC279cfFX-s-nbTngvxqF1hMz6dCXriBK+1Lg@mail.gmail.com>
Message-ID: <b7e4a872-a432-4492-807d-333416ed261e@strongmad.batnest.org>

Hi, Dathan...

For dropping messages, you might consider setting message TTLs, but that
may not give you quite what you want in all cases.

What does the CPU consumption of your Rabbit node look like when you're 
seeing these pauses?  If you wait, do they relent, with things getting
moving again?

Best regards,
Jerry

----- Original Message -----
From: "Dathan Pattishall" <dathan at schoolfeed.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, January 31, 2012 1:05:39 PM
Subject: Re: [rabbitmq-discuss] Problems with rabbit and hoping I can get some help

Hi Jerry, 


I neglected to mentioned that I am not hitting the memory-based flow control according to my memory alarm stat from 
rabbitmqadmin.py list nodes 


What threshold would the TCP back pressure logic hit? I assume when the memory limit is reached rabbit pushes back on the publishers? Rabbit did not use more then 2G of RAM out of the 5G allowed for it, if that is the case. 


Also is there a way to tell rabbit drop the messages instead of block? 



On Tue, Jan 31, 2012 at 12:56 PM, Jerry Kuch < jerryk at vmware.com > wrote: 


Hi, Dathan... 

What are your consumers doing with the published messages? If you use rabbitmqctl or 
the management plugin to look at what's going on in your queues, do you see messages 
accumulating but not being delivered? Or delivered but not ACKed? If messages are 
building up (either undelivered or unACKed) faster than consumers are draining them, 
you might be hitting memory-based flow control, which will use TCP back pressure to 
stop the publishers. 

See here for more information: 

http://www.rabbitmq.com/memory.html 

To get an idea whether this is happening to you, check out your queue contents as 
suggested above, and see if memory alarms are being set in your rabbit logs.../ 

Best regards, 
Jerry 


----- Original Message ----- 
From: "Dathan Pattishall" < dathan at schoolfeed.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, January 31, 2012 12:52:55 PM 
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get some help 




Let me first describe my setup. 

root at webnode1]# rabbitmqadmin.py show overview 
+--------------------+-----------------+--------------------+------------------+ 
| management_version | node | statistics_db_node | statistics_level | 
+--------------------+-----------------+--------------------+------------------+ 
| 2.7.1 | rabbit at webnode1 | rabbit at webnode1 | fine | 
+--------------------+-----------------+--------------------+------------------+ 



Rabbit MQ's producers comes from PHP 5.3.8 http://www.php.net/manual/en/book.amqp.php . Each apache process could produce a rabbit message, I am producing around 1000 messages a second on c1.xtralarge instance at ec2. 



My erlang version is 


/usr/local/bin/erl -v 
Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe] [kernel-poll:false] 




The PROBLEM: 


After about 40 mins of rabbit accepting messages all connections block causing a rather bad error on the front ends killing traffic. Turning rabbit off and restarting the web servers forces a recovery. 


Stats from Rabbit: 


Roughly 5000 queues are made 
Roughly 3600 exchanges are made 
Each exchange can have at most 1200 queues bound to it. 
Each Queue is setup for autodelete and so is the exchanges with delivery type 1. 
All data passed is JSON 


The consumer is NODE and its keeping up with the consumption 


RabbitMQ memlimit is around 5.3G 
RabbitMQ mem used hits around 1.9G when it freezes produces 
RabbitMQ proc used hits around 220K 
RabbitMQ fd_total is 50K 
RabbitMQ socks_total is around 45K and Socks used is 4K 
mem_ets hists 100M // not sure what this is 


Any idea what is going on? What limit am I hitting? Why does RabbitMQ block? How can I detect that I am about to hit a block state? Any suggestions or request of additional data would be great. 






_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


From dksayers at gmail.com  Tue Jan 31 21:18:16 2012
From: dksayers at gmail.com (dksayers)
Date: Tue, 31 Jan 2012 13:18:16 -0800 (PST)
Subject: [rabbitmq-discuss] plugins not loading.
In-Reply-To: <4F27C98B.70502@rabbitmq.com>
References: <cfc89fda-3fe1-465e-881a-a658b57c7899@lr19g2000pbb.googlegroups.com>
	<4F27C98B.70502@rabbitmq.com>
Message-ID: <ea17b4bf-c409-4ab6-95a8-0d97324c375a@b10g2000pbd.googlegroups.com>

Thanks for the hints. I checked /usr/local/etc/rc.d/rabbitmq for
anything unusual but nothing
was to be found. I did add the line:
ENABLED_PLUGINS_FILE="/etc/rabbitmq/enabled_plugins"
but this also failed with the same '0 plugins activated:'

On Jan 31, 9:59?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> Hmm, interesting. I know absolutely nothing about the FreeBSD port, it's
> possible it's just broken since plugin activation is a new concept in 2.7.0.
>
> (Is the packager around on this list?)
>
> So it looks like rabbitmq-plugins is finding the plugins and writing the
> file in the correct location. RabbitMQ is then *not* complaining about
> the plugins not being found, it's not even trying to activate them.
> Presumably therefore it's not seeing the enabled plugins file.
>
> So it's possible that the environment variable ENABLED_PLUGINS_FILE is
> getting set to some bogus value by /usr/local/etc/rc.d/rabbitmq. In
> theory that script should not need to set that variable at all, assuming
> it starts rabbit via rabbitmq-server. Which it should, but like I said,
> I don't know about the FreeBSD packaging...
>
> Cheers, Simon
>
> On 31/01/12 03:47,dksayerswrote:
>
>
>
> > I am trying to get the administration plugin working with
> > rabbitmq-2.7.0 on
> > my FreeBSD 8.2-STABLE amd64 machine. I install via the FreeBSD ports
> > tree where erlang-lite-r14b04_1,1 is also built and installed as a
> > dependancy. I then did the following:
>
> > # rabbitmq-plugins enable rabbitmq_management
> > The following plugins have been enabled:
> > ? ?mochiweb
> > ? ?webmachine
> > ? ?rabbitmq_mochiweb
> > ? ?amqp_client
> > ? ?rabbitmq_management_agent
> > ? ?rabbitmq_management
>
> > Plugin configuration has changed. Restart RabbitMQ for changes to take
> > effect.
> > # cat /etc/rabbitmq/enabled_plugins
> > [rabbitmq_management].
>
> > # /usr/local/etc/rc.d/rabbitmq start
> > Activating RabbitMQ plugins ...
> > 0 plugins activated:
>
> > #
>
> > When I try to access port 55672 I am told 'Unable to connect'. It
> > seems
> > that my plugins are not loading but I have no idea why. The log files
> > provide no beneficial information. What have I missed.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dathan at schoolfeed.com  Tue Jan 31 21:19:29 2012
From: dathan at schoolfeed.com (Dathan Pattishall)
Date: Tue, 31 Jan 2012 13:19:29 -0800
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get
	some help
In-Reply-To: <b7e4a872-a432-4492-807d-333416ed261e@strongmad.batnest.org>
References: <CA+22WDQ1s3jdsTC279cfFX-s-nbTngvxqF1hMz6dCXriBK+1Lg@mail.gmail.com>
	<b7e4a872-a432-4492-807d-333416ed261e@strongmad.batnest.org>
Message-ID: <CA+22WDSMG8N+2FHs_YtK8Up7OZzJj2JGOSofU_KYWV7C56-K4A@mail.gmail.com>

CPU is rather Idle,
6% CPU system on average
8% CPU User on average

No CPU wait IO


so plenty of CPU / plenty of Memory


On Tue, Jan 31, 2012 at 1:13 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Dathan...
>
> For dropping messages, you might consider setting message TTLs, but that
> may not give you quite what you want in all cases.
>
> What does the CPU consumption of your Rabbit node look like when you're
> seeing these pauses?  If you wait, do they relent, with things getting
> moving again?
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Dathan Pattishall" <dathan at schoolfeed.com>
> To: "Jerry Kuch" <jerryk at vmware.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, January 31, 2012 1:05:39 PM
> Subject: Re: [rabbitmq-discuss] Problems with rabbit and hoping I can get
> some help
>
> Hi Jerry,
>
>
> I neglected to mentioned that I am not hitting the memory-based flow
> control according to my memory alarm stat from
> rabbitmqadmin.py list nodes
>
>
> What threshold would the TCP back pressure logic hit? I assume when the
> memory limit is reached rabbit pushes back on the publishers? Rabbit did
> not use more then 2G of RAM out of the 5G allowed for it, if that is the
> case.
>
>
> Also is there a way to tell rabbit drop the messages instead of block?
>
>
>
> On Tue, Jan 31, 2012 at 12:56 PM, Jerry Kuch < jerryk at vmware.com > wrote:
>
>
> Hi, Dathan...
>
> What are your consumers doing with the published messages? If you use
> rabbitmqctl or
> the management plugin to look at what's going on in your queues, do you
> see messages
> accumulating but not being delivered? Or delivered but not ACKed? If
> messages are
> building up (either undelivered or unACKed) faster than consumers are
> draining them,
> you might be hitting memory-based flow control, which will use TCP back
> pressure to
> stop the publishers.
>
> See here for more information:
>
> http://www.rabbitmq.com/memory.html
>
> To get an idea whether this is happening to you, check out your queue
> contents as
> suggested above, and see if memory alarms are being set in your rabbit
> logs.../
>
> Best regards,
> Jerry
>
>
> ----- Original Message -----
> From: "Dathan Pattishall" < dathan at schoolfeed.com >
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, January 31, 2012 12:52:55 PM
> Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get some
> help
>
>
>
>
> Let me first describe my setup.
>
> root at webnode1]# rabbitmqadmin.py show overview
>
> +--------------------+-----------------+--------------------+------------------+
> | management_version | node | statistics_db_node | statistics_level |
>
> +--------------------+-----------------+--------------------+------------------+
> | 2.7.1 | rabbit at webnode1 | rabbit at webnode1 | fine |
>
> +--------------------+-----------------+--------------------+------------------+
>
>
>
> Rabbit MQ's producers comes from PHP 5.3.8
> http://www.php.net/manual/en/book.amqp.php . Each apache process could
> produce a rabbit message, I am producing around 1000 messages a second on
> c1.xtralarge instance at ec2.
>
>
>
> My erlang version is
>
>
> /usr/local/bin/erl -v
> Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0]
> [hipe] [kernel-poll:false]
>
>
>
>
> The PROBLEM:
>
>
> After about 40 mins of rabbit accepting messages all connections block
> causing a rather bad error on the front ends killing traffic. Turning
> rabbit off and restarting the web servers forces a recovery.
>
>
> Stats from Rabbit:
>
>
> Roughly 5000 queues are made
> Roughly 3600 exchanges are made
> Each exchange can have at most 1200 queues bound to it.
> Each Queue is setup for autodelete and so is the exchanges with delivery
> type 1.
> All data passed is JSON
>
>
> The consumer is NODE and its keeping up with the consumption
>
>
> RabbitMQ memlimit is around 5.3G
> RabbitMQ mem used hits around 1.9G when it freezes produces
> RabbitMQ proc used hits around 220K
> RabbitMQ fd_total is 50K
> RabbitMQ socks_total is around 45K and Socks used is 4K
> mem_ets hists 100M // not sure what this is
>
>
> Any idea what is going on? What limit am I hitting? Why does RabbitMQ
> block? How can I detect that I am about to hit a block state? Any
> suggestions or request of additional data would be great.
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/34a924e9/attachment.htm>

From santiagomonttco at gmail.com  Tue Jan 31 21:48:38 2012
From: santiagomonttco at gmail.com (CURSO CERRADO)
Date: Tue, 31 Jan 2012 18:48:38 -0300
Subject: [rabbitmq-discuss] =?windows-1252?q?ACCIDENTES_DEL_TRABAJO_=22RES?=
	=?windows-1252?q?PONSABILIDAD_CIVIL_Y_PENAL=22_Consulte_precio_esp?=
	=?windows-1252?q?ecial_por_el_mes_de_Febrero?=
Message-ID: <730c5c9ccba1713f355d11890019d1c9@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/24fb511b/attachment.htm>

From abdullahsaima at yahoo.com  Tue Jan 31 22:06:25 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Tue, 31 Jan 2012 22:06:25 +0000 (GMT)
Subject: [rabbitmq-discuss] help required: bind function
Message-ID: <1328047585.29815.YahooMailNeo@web29701.mail.ird.yahoo.com>

Hi All,

I am going to understand AMQP version 0-9 at simpler level, The binding function definition is problem for me. First issue isHow I can randomly define the messages, if I did that How a message knows to go to which exchange, so that exchange can move to particular queue. I have defined queue and exchange as a class. I have defined routing key as well. I have implemented the queues that store such messages. But I need your help in defining bind() and How to route message to exchanges.

I am using visual C++, can send the code if required but its not in its refined form.
Thanks
Any help would be highly appreciated. Sorry if I am not following your format of writing emails. I am new to this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/c1610926/attachment.htm>

From jerryk at vmware.com  Tue Jan 31 22:12:22 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 31 Jan 2012 14:12:22 -0800 (PST)
Subject: [rabbitmq-discuss] help required: bind function
In-Reply-To: <1328047585.29815.YahooMailNeo@web29701.mail.ird.yahoo.com>
Message-ID: <a21cf204-83cd-482a-87f0-c142eea7186a@strongmad.batnest.org>

Hi, Saima.

To address some of your questions.

A producer publishes *to* an exchange.  It's a decision a producer makes
when publishing, much as you might decide which mailbox you plant to drop
you post card in while you're on vacation.

A queue is *bound* to an exchange.  Depending on the type of the exchange,
certain rules, and the properties of the message, determine whether or not
a given message follows that binding into a particular destination queue.
Think of the action is being like that of the postal worker, who pulls your
postcard from the mailbox, looks at it, and determines where to take it.
How a routing key is interpreted depends on the exchange type in this context.

I'm not sure what you mean by having implemented classes for exchanges, and queues.
Are you writing an AMQP client that you intend to use with someone else's broker?
Or are you wrapping these entities up in some way that is convenient for the needs
of your C++ application?  Or are you implementing an actual AMQP broker, perhaps
for teaching purposes?

Best regards,
Jerry

----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, January 31, 2012 2:06:25 PM
Subject: [rabbitmq-discuss] help required: bind function




Hi All, 


I am going to understand AMQP version 0-9 at simpler level, The binding function definition is problem for me. First issue isHow I can randomly define the messages, if I did that How a message knows to go to which exchange, so that exchange can move to particular queue. I have defined queue and exchange as a class. I have defined routing key as well. I have implemented the queues that store such messages. But I need your help in defining bind() and How to route message to exchanges. 

I am using visual C++, can send the code if required but its not in its refined form. 
Thanks 
Any help would be highly appreciated. Sorry if I am not following your format of writing emails. I am new to this. 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From abdullahsaima at yahoo.com  Tue Jan 31 22:23:47 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Tue, 31 Jan 2012 22:23:47 +0000 (GMT)
Subject: [rabbitmq-discuss] help required: bind function
In-Reply-To: <a21cf204-83cd-482a-87f0-c142eea7186a@strongmad.batnest.org>
References: <1328047585.29815.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<a21cf204-83cd-482a-87f0-c142eea7186a@strongmad.batnest.org>
Message-ID: <1328048627.2699.YahooMailNeo@web29706.mail.ird.yahoo.com>

Hi Jerry,

I am student , and my supervisor and I have chosen to implement and study it at very simpler level. my classes are not refined. There is one class "message" which has a routing key.
I need your help how can I write Bind() function for this. How can exchanges and queues are already have relation, before sending messages by publisher. My program wants to send messgae to exchange and then exchanges routes to queues, But how can I do this in C++. means I am not understanding logic. you all are experts and having a good conversation while I am at very initial level of understanding. if you can help me in writing my code.

Thanks
?
Saima


________________________________
 From: Jerry Kuch <jerryk at vmware.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, 31 January 2012, 22:12
Subject: Re: [rabbitmq-discuss] help required: bind function
 
Hi, Saima.

To address some of your questions.

A producer publishes *to* an exchange.? It's a decision a producer makes
when publishing, much as you might decide which mailbox you plant to drop
you post card in while you're on vacation.

A queue is *bound* to an exchange.? Depending on the type of the exchange,
certain rules, and the properties of the message, determine whether or not
a given message follows that binding into a particular destination queue.
Think of the action is being like that of the postal worker, who pulls your
postcard from the mailbox, looks at it, and determines where to take it.
How a routing key is interpreted depends on the exchange type in this context.

I'm not sure what you mean by having implemented classes for exchanges, and queues.
Are you writing an AMQP client that you intend to use with someone else's broker?
Or are you wrapping these entities up in some way that is convenient for the needs
of your C++ application?? Or are you implementing an actual AMQP broker, perhaps
for teaching purposes?

Best regards,
Jerry

----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, January 31, 2012 2:06:25 PM
Subject: [rabbitmq-discuss] help required: bind function




Hi All, 


I am going to understand AMQP version 0-9 at simpler level, The binding function definition is problem for me. First issue isHow I can randomly define the messages, if I did that How a message knows to go to which exchange, so that exchange can move to particular queue. I have defined queue and exchange as a class. I have defined routing key as well. I have implemented the queues that store such messages. But I need your help in defining bind() and How to route message to exchanges. 

I am using visual C++, can send the code if required but its not in its refined form. 
Thanks 
Any help would be highly appreciated. Sorry if I am not following your format of writing emails. I am new to this. 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/b285814c/attachment.htm>

From pablomolnar at gmail.com  Tue Jan 31 22:51:44 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Tue, 31 Jan 2012 19:51:44 -0300
Subject: [rabbitmq-discuss] Lost messages in HA tests in a cluster
Message-ID: <CANVSfpLnE=0+51PvMz7vB2L+3UEv-CSoNndEsC4edwy96PGOnA@mail.gmail.com>

Hi all!

I'm doing some HA tests stressing my cluster and I'm experimenting lost
messages ONLY when the publisher lost the connection due a kill -9.

*Test OK*: Kill node while consuming:
1 - Setup a clean 3 node's cluster
2 - Execute producer with 10.000 messages connected to node A
3 - Wait producer to finish
4 - Execute consumer connected to node A
5 - While consumer is running kill node A

Result: The consumer reconnects to another node and consume the rest of
messages ok. All 10.000 messages were consumed ok.

*Test FAILED*: Kill node while producing:
1 - Setup a clean 3 node's cluster
2 - Execute consumer to start listening connected node A
3 - Execute producer with 10.000 messages connected to node A
4 - While producer is running kill node A

Result: The producer reconnects fine (the consumer too) and keep publishing
but some of the messages* already published* to node A are lost.


These are my settings:

rabbitmqctl status
Status of node 'rabbit at i-00000007-asm' ...
[{pid,11339},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2] [rq:2]
[async-threads:0] [hipe] [kernel-poll:false]\n"},
 {memory,
     [{total,92565608},
      {processes,4004968},
      {processes_used,3996224},
      {system,88560640},
      {atom,1322033},
      {atom_used,1291462},
      {binary,32496},
      {code,15264387},
      {ets,1174192}]},
 {vm_memory_high_watermark,0.3999999999362281},
 {vm_memory_limit,2508940902}]
...done.



rabbitmqctl cluster_status
Cluster status of node 'rabbit at i-00000007-asm' ...
[{nodes,[{disc,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']},
         {ram,['rabbit at i-00000009-asm']}]},
 {running_nodes,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']}]
...done.


*
Java amqp-client 2.7.1*


- Producer.groovy (java amqp-client 2.7.1)

import com.rabbitmq.client.*
try{

// Get rabbitmq config
def config = new ConfigSlurper().parse(new
File('../rabbitmq.properties').toURL())

def rabbit = new RabbitHA(config)
rabbit.init = { channel ->
  channel.exchangeDeclare('myExchange', "direct", true) // Durable exchange
  channel.queueDeclare('myQueue', true, false, false, ["x-ha-policy":
"all"]) // Durable exchange and HA policy
  channel.queueBind('myQueue', 'myExchange', '')
  channel.confirmSelect()
}

10000.times { idx ->
  rabbit.publish { channel ->
    def properties = new
AMQP.BasicProperties.Builder().deliveryMode(2).build() // Delivery mode 2:
persistent
    def msg = "Message $idx"
    channel.basicPublish('myExchange', '', properties, msg.getBytes())
    println msg
  }
}

rabbit.close()

} catch(e){e.printStackTrace()}


- Consumer.groovy

import com.rabbitmq.client.*

try{

  // Get rabbitmq config
  def config = new ConfigSlurper().parse(new
File('../rabbitmq.properties').toURL())

  // Connect
  def rabbit = new RabbitHA(config)
  rabbit.onDelivery('myQueue'){ delivery, channel ->
  def msg = new String(delivery.body)
  println msg

  // Manual ack
  channel.basicAck(delivery.envelope.deliveryTag, false)

} catch(e){e.printStackTrace()}


- RabbitHA.groovy

import com.rabbitmq.client.*

/**
 *
 * RabbitMQ highly available proxy.
 * Basic implementation of a basic suscriber/publisher with reconnect logic.
 *
 */
class RabbitHA {
    ConnectionFactory connectionFactory
    Address[] addresses
    Closure init

    Connection connection
    Channel channel
    QueueingConsumer consumer

    public RabbitHA(Map config) {
        this(config, null)
    }

    public RabbitHA(Map config, Closure init){
        this.connectionFactory = new ConnectionFactory([username:
config.username, password: config.password, virtualHost:
config.virtualHost])
        this.addresses = Address.parseAddresses(config.addresses)
        this.init = init
        connectChannel()
    }

    void onDelivery(String queueName, Closure closure) {
        basicConsume(queueName)
        int i = 0

        while(true) {
            try {
                QueueingConsumer.Delivery delivery = consumer.nextDelivery()
                closure(delivery, channel)
                i = 0
            } catch(e) {
                // Only handle exceptions
                if(!(e in ShutdownSignalException || e in IOException || e
in AlreadyClosedException)) throw e

                i++
                e.printStackTrace()
                println "ShutdownSignalException recieved! Reconnection
attempt #$i"
                connectChannel()
                basicConsume(queueName)
            }
        }
    }

    void publish(Closure closure) {
        int i = 0
        boolean retry = true
        while(retry) {
            try {
                closure(channel)
                i = 0
                retry = false
            } catch(e) {
                // Only handle exceptions
                if(!(e in ShutdownSignalException || e in IOException || e
in AlreadyClosedException)) throw e

                i++
                retry = true
                e.printStackTrace()
                println "ShutdownSignalException recieved! Reconnection
attempt #$i"
                connectChannel()
            }
        }
    }


    void connectChannel() {
        connection = connectionFactory.newConnection(addresses)
        channel = connection.createChannel()

        println "Succesfully connected to $connection.address"

        if(init) {
            init(channel)
        }
    }

    void basicConsume(queueName) {
        consumer = new QueueingConsumer(channel)
        channel.basicConsume(queueName, false, consumer)
    }

    void close() {
        channel.waitForConfirmsOrDie()
        channel.close()
        connection.close()
    }
}



Output:

cat consumer-output.txt |grep Message | wc
   9957   19914  128330

cat producer-output.txt | grep Message | wc
  10000   20000  128890

*Note that consumer lost 43 messages*

Output from producer :
...
Message 1466
Message 1467
Message 1468
Message 1469
Message 1470
ShutdownSignalException recieved! Reconnection attempt #1
Succesfully connected to i-0000001a-zsm/172.16.158.46
Message 1471
Message 1472
Message 1473
Message 1474
Message 1475
Message 1476
...

*
Note messages [1471..1476] were consumed ok, but [1466..1470] are missing
in consumer output.*

The complete outputs are in
https://github.com/pablomolnar/rabbitmq_samples/tree/master/out. There you
can see reconnection log of both parts.
I've a strong feeling the publisher confirms is not well configured.

Please anyone could shed some light on the issue?

Cheers,
Pablo Molnar

PD: Also I take the opportunity to share a lot of groovy examples I've been
working in the last days: https://github.com/pablomolnar/rabbitmq_samples
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/778556da/attachment.htm>

From simone.busoli at gmail.com  Tue Jan 31 23:43:53 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 1 Feb 2012 00:43:53 +0100
Subject: [rabbitmq-discuss] Lost messages in HA tests in a cluster
In-Reply-To: <CANVSfpLnE=0+51PvMz7vB2L+3UEv-CSoNndEsC4edwy96PGOnA@mail.gmail.com>
References: <CANVSfpLnE=0+51PvMz7vB2L+3UEv-CSoNndEsC4edwy96PGOnA@mail.gmail.com>
Message-ID: <CAOn7oW9D9XEfrDxWyLnWc=tPB4xb2Wqy8To_R3odbHCOD4ZW1A@mail.gmail.com>

Hi Pablo, looking at your code I can't see where you are republishing
messages which have not been confirmed by the broker. If you want to make
sure that publishes will eventually be delivered you have to keep track of
them and re-issue them in case an ack doesn't arrive from the broker, which
usually happens when the broker dies.
On Jan 31, 2012 11:52 PM, "Pablo Molnar" <pablomolnar at gmail.com> wrote:

> Hi all!
>
> I'm doing some HA tests stressing my cluster and I'm experimenting lost
> messages ONLY when the publisher lost the connection due a kill -9.
>
> *Test OK*: Kill node while consuming:
> 1 - Setup a clean 3 node's cluster
> 2 - Execute producer with 10.000 messages connected to node A
> 3 - Wait producer to finish
> 4 - Execute consumer connected to node A
> 5 - While consumer is running kill node A
>
> Result: The consumer reconnects to another node and consume the rest of
> messages ok. All 10.000 messages were consumed ok.
>
> *Test FAILED*: Kill node while producing:
> 1 - Setup a clean 3 node's cluster
> 2 - Execute consumer to start listening connected node A
> 3 - Execute producer with 10.000 messages connected to node A
> 4 - While producer is running kill node A
>
> Result: The producer reconnects fine (the consumer too) and keep
> publishing but some of the messages* already published* to node A are
> lost.
>
>
> These are my settings:
>
> rabbitmqctl status
> Status of node 'rabbit at i-00000007-asm' ...
> [{pid,11339},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>       {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
>       {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
>       {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
>       {inets,"INETS  CXC 138 49","5.2"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2] [rq:2]
> [async-threads:0] [hipe] [kernel-poll:false]\n"},
>  {memory,
>      [{total,92565608},
>       {processes,4004968},
>       {processes_used,3996224},
>       {system,88560640},
>       {atom,1322033},
>       {atom_used,1291462},
>       {binary,32496},
>       {code,15264387},
>       {ets,1174192}]},
>  {vm_memory_high_watermark,0.3999999999362281},
>  {vm_memory_limit,2508940902}]
> ...done.
>
>
>
> rabbitmqctl cluster_status
> Cluster status of node 'rabbit at i-00000007-asm' ...
> [{nodes,[{disc,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']},
>          {ram,['rabbit at i-00000009-asm']}]},
>  {running_nodes,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']}]
> ...done.
>
>
> *
> Java amqp-client 2.7.1*
>
>
> - Producer.groovy (java amqp-client 2.7.1)
>
> import com.rabbitmq.client.*
> try{
>
> // Get rabbitmq config
> def config = new ConfigSlurper().parse(new
> File('../rabbitmq.properties').toURL())
>
> def rabbit = new RabbitHA(config)
> rabbit.init = { channel ->
>   channel.exchangeDeclare('myExchange', "direct", true) // Durable exchange
>   channel.queueDeclare('myQueue', true, false, false, ["x-ha-policy":
> "all"]) // Durable exchange and HA policy
>   channel.queueBind('myQueue', 'myExchange', '')
>   channel.confirmSelect()
> }
>
> 10000.times { idx ->
>   rabbit.publish { channel ->
>     def properties = new
> AMQP.BasicProperties.Builder().deliveryMode(2).build() // Delivery mode 2:
> persistent
>     def msg = "Message $idx"
>     channel.basicPublish('myExchange', '', properties, msg.getBytes())
>     println msg
>   }
> }
>
> rabbit.close()
>
> } catch(e){e.printStackTrace()}
>
>
> - Consumer.groovy
>
> import com.rabbitmq.client.*
>
> try{
>
>   // Get rabbitmq config
>   def config = new ConfigSlurper().parse(new
> File('../rabbitmq.properties').toURL())
>
>   // Connect
>   def rabbit = new RabbitHA(config)
>   rabbit.onDelivery('myQueue'){ delivery, channel ->
>   def msg = new String(delivery.body)
>   println msg
>
>   // Manual ack
>   channel.basicAck(delivery.envelope.deliveryTag, false)
>
> } catch(e){e.printStackTrace()}
>
>
> - RabbitHA.groovy
>
> import com.rabbitmq.client.*
>
> /**
>  *
>  * RabbitMQ highly available proxy.
>  * Basic implementation of a basic suscriber/publisher with reconnect
> logic.
>  *
>  */
> class RabbitHA {
>     ConnectionFactory connectionFactory
>     Address[] addresses
>     Closure init
>
>     Connection connection
>     Channel channel
>     QueueingConsumer consumer
>
>     public RabbitHA(Map config) {
>         this(config, null)
>     }
>
>     public RabbitHA(Map config, Closure init){
>         this.connectionFactory = new ConnectionFactory([username:
> config.username, password: config.password, virtualHost:
> config.virtualHost])
>         this.addresses = Address.parseAddresses(config.addresses)
>         this.init = init
>         connectChannel()
>     }
>
>     void onDelivery(String queueName, Closure closure) {
>         basicConsume(queueName)
>         int i = 0
>
>         while(true) {
>             try {
>                 QueueingConsumer.Delivery delivery =
> consumer.nextDelivery()
>                 closure(delivery, channel)
>                 i = 0
>             } catch(e) {
>                 // Only handle exceptions
>                 if(!(e in ShutdownSignalException || e in IOException ||
> e in AlreadyClosedException)) throw e
>
>                 i++
>                 e.printStackTrace()
>                 println "ShutdownSignalException recieved! Reconnection
> attempt #$i"
>                 connectChannel()
>                 basicConsume(queueName)
>             }
>         }
>     }
>
>     void publish(Closure closure) {
>         int i = 0
>         boolean retry = true
>         while(retry) {
>             try {
>                 closure(channel)
>                 i = 0
>                 retry = false
>             } catch(e) {
>                 // Only handle exceptions
>                 if(!(e in ShutdownSignalException || e in IOException ||
> e in AlreadyClosedException)) throw e
>
>                 i++
>                 retry = true
>                 e.printStackTrace()
>                 println "ShutdownSignalException recieved! Reconnection
> attempt #$i"
>                 connectChannel()
>             }
>         }
>     }
>
>
>     void connectChannel() {
>         connection = connectionFactory.newConnection(addresses)
>         channel = connection.createChannel()
>
>         println "Succesfully connected to $connection.address"
>
>         if(init) {
>             init(channel)
>         }
>     }
>
>     void basicConsume(queueName) {
>         consumer = new QueueingConsumer(channel)
>         channel.basicConsume(queueName, false, consumer)
>     }
>
>     void close() {
>         channel.waitForConfirmsOrDie()
>         channel.close()
>         connection.close()
>     }
> }
>
>
>
> Output:
>
> cat consumer-output.txt |grep Message | wc
>    9957   19914  128330
>
> cat producer-output.txt | grep Message | wc
>   10000   20000  128890
>
> *Note that consumer lost 43 messages*
>
> Output from producer :
> ...
> Message 1466
> Message 1467
> Message 1468
> Message 1469
> Message 1470
> ShutdownSignalException recieved! Reconnection attempt #1
> Succesfully connected to i-0000001a-zsm/172.16.158.46
> Message 1471
> Message 1472
> Message 1473
> Message 1474
> Message 1475
> Message 1476
> ...
>
> *
> Note messages [1471..1476] were consumed ok, but [1466..1470] are missing
> in consumer output.*
>
> The complete outputs are in
> https://github.com/pablomolnar/rabbitmq_samples/tree/master/out. There
> you can see reconnection log of both parts.
> I've a strong feeling the publisher confirms is not well configured.
>
> Please anyone could shed some light on the issue?
>
> Cheers,
> Pablo Molnar
>
> PD: Also I take the opportunity to share a lot of groovy examples I've
> been working in the last days:
> https://github.com/pablomolnar/rabbitmq_samples
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120201/92cc3e5b/attachment.htm>

