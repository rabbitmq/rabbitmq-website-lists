<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ C library function	amqp_simple_wait_frame takes 400 ms
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20C%20library%20function%0A%09amqp_simple_wait_frame%20takes%20400%20ms&In-Reply-To=%3Cyrv4cfx0aact0.fsf%40dwragg.eng.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007774.html">
   <LINK REL="Next"  HREF="007776.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ C library function	amqp_simple_wait_frame takes 400 ms</H1>
    <B>David Wragg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20C%20library%20function%0A%09amqp_simple_wait_frame%20takes%20400%20ms&In-Reply-To=%3Cyrv4cfx0aact0.fsf%40dwragg.eng.vmware.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ C library function	amqp_simple_wait_frame takes 400 ms">david at rabbitmq.com
       </A><BR>
    <I>Sat Jun 26 00:54:19 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007774.html">[rabbitmq-discuss] RabbitMQ C library function	amqp_simple_wait_frame takes 400 ms
</A></li>
        <LI>Next message: <A HREF="007776.html">[rabbitmq-discuss] RabbitMQ C library function	amqp_simple_wait_frame takes 400 ms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7775">[ date ]</a>
              <a href="thread.html#7775">[ thread ]</a>
              <a href="subject.html#7775">[ subject ]</a>
              <a href="author.html#7775">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jim,

Jim Irrer &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&gt; writes:
&gt;<i> I'm working on two functions that act as a client-server pair.  They
</I>&gt;<i> use two amq.direct queues to communicate.  When ever either of
</I>&gt;<i> them calls the amqp_simple_wait_frame function, it does not return
</I>&gt;<i> for 436618 microseconds.
</I>&gt;<i>
</I>&gt;<i> Some other background info that might be relevant:
</I>&gt;<i>
</I>&gt;<i> If I only send messages in one direction it's really fast.
</I>&gt;<i>
</I>&gt;<i> Both processes are using separate connectors and different sockets.
</I>&gt;<i>
</I>&gt;<i> I used the amqp_consumer.c amqp_producer.c code in
</I>&gt;<i> the examples directory as a reference.
</I>&gt;<i>
</I>&gt;<i> Is there a way to avoid this delay?
</I>
I'm not sure what you are really asking here.  As its name suggests,
amqp_simple_wait_frame waits for a frame to arrive.  It will typically
attempt to read from the socket connected to the AMQP server.  If no
data is available, it will block until data is available.  The resulting
delays are thus an intrinsic feature of amqp_simple_wait_frame.

Are you sure that the 400ms delay does not simply reflect the wait for a
message to arrive?

I'm guessing, but perhaps the problem is that you want a single
application to publish and consume messages concurrently, and you are
finding that the synchronous nature of amqp_simple_wait_frame is an
obstacle?  If so, the simplest work around would be to have two threads,
one to publish and one to consume, and open a separate AMQP connection
in each thread.

&gt;<i> Also ...
</I>&gt;<i>
</I>&gt;<i> Could I use the same socket in each program as long as it was only
</I>&gt;<i> used by one thread at a time?
</I>&gt;<i>
</I>&gt;<i> Could I use the same connection in each program if it was only
</I>&gt;<i> used by one thread at a time?
</I>
What's the distinction between socket and connection here?

librabbitmq does not do anything to explicitly support multithreading,
but neither does it do anything to conflict with it.  If you, the
application programmer, ensure that for a given connection, only one
thread uses librabbitmq at a time, you should be safe.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007774.html">[rabbitmq-discuss] RabbitMQ C library function	amqp_simple_wait_frame takes 400 ms
</A></li>
	<LI>Next message: <A HREF="007776.html">[rabbitmq-discuss] RabbitMQ C library function	amqp_simple_wait_frame takes 400 ms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7775">[ date ]</a>
              <a href="thread.html#7775">[ thread ]</a>
              <a href="subject.html#7775">[ subject ]</a>
              <a href="author.html#7775">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
