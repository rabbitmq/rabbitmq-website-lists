<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq Crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20Crash&In-Reply-To=%3C1276779263.2386.49.camel%40waqas-desktop%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007621.html">
   <LINK REL="Next"  HREF="007624.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq Crash</H1>
    <B>Waqas Badar</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20Crash&In-Reply-To=%3C1276779263.2386.49.camel%40waqas-desktop%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq Crash">waqas.badar at panasiangroup.com
       </A><BR>
    <I>Thu Jun 17 13:54:23 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007621.html">[rabbitmq-discuss] Rabbitmq Crash
</A></li>
        <LI>Next message: <A HREF="007624.html">[rabbitmq-discuss] Rabbitmq Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7623">[ date ]</a>
              <a href="thread.html#7623">[ thread ]</a>
              <a href="subject.html#7623">[ subject ]</a>
              <a href="author.html#7623">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Our server has 32GB ram. And most of the time 25GB is free. Please note
that it is occurring on production system. We try to reproduce it on
different machines but unable to do so. Ubuntu Server 9.04 is installed
on server. Please note that if we delete mnesia files then we are able
to start rabbitmq server. We suspect that mnesia files get corrupted due
to which rabbitmq server does not start. Can you please guide us on
exactly what log files do you need us to provide you?

On Thu, 2010-06-17 at 13:27 +0100, Matthew Sackman wrote:

&gt;<i> Hi Waqas,
</I>&gt;<i> 
</I>&gt;<i> Please try and keep the mailing list CC'd.
</I>&gt;<i> 
</I>&gt;<i> On Thu, Jun 17, 2010 at 05:13:23PM +0500, Waqas Badar wrote:
</I>&gt;<i> &gt; We are using RabbitMQ 1.7.1 and we are
</I>&gt;<i> &gt; using Java client 1.7.1 and for python pyamqp 0.6.1 and txamqp 0.3.
</I>&gt;<i> 
</I>&gt;<i> Ok. 1.7.1 was less capable about dealing with situations in which it was
</I>&gt;<i> running out of memory. I'd recommend upgrading to 1.8.0, though be aware
</I>&gt;<i> that none of your queues, exchanges, bindings or messages will be
</I>&gt;<i> retained when you upgrade.
</I>&gt;<i> 
</I>&gt;<i> &gt; Please note that most of the time it crashes after 200000 messages.
</I>&gt;<i> &gt; Following crash reports are found in rabbit-sasl.log file.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; =CRASH REPORT==== 15-Jun-2010::22:41:10 ===
</I>&gt;<i> &gt;   crasher:
</I>&gt;<i> &gt;     pid: &lt;0.155.0&gt;
</I>&gt;<i> &gt;     registered_name: rabbit_persister
</I>&gt;<i> &gt;     exception exit: {{badmatch,eof},
</I>&gt;<i> &gt;                      [{rabbit_persister,internal_load_snapshot,2},
</I>&gt;<i> &gt;                       {rabbit_persister,init,1},
</I>&gt;<i> &gt;                       {gen_server,init_it,6},
</I>&gt;<i> &gt;                       {proc_lib,init_p_do_apply,3}]}
</I>&gt;<i> &gt;       in function  gen_server:init_it/6
</I>&gt;<i> &gt;     initial call: rabbit_persister:init/1
</I>&gt;<i> &gt;     ancestors: [rabbit_sup,&lt;0.109.0&gt;]
</I>&gt;<i> &gt;     messages: []
</I>&gt;<i> &gt;     links: [&lt;0.112.0&gt;,&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">support at rabbitmq.com</A> 0.156.0&gt;]
</I>&gt;<i> &gt;     dictionary: []
</I>&gt;<i> &gt;     trap_exit: true
</I>&gt;<i> &gt;     status: running
</I>&gt;<i> &gt;     heap_size: 987
</I>&gt;<i> &gt;     stack_size: 23
</I>&gt;<i> &gt;     reductions: 431
</I>&gt;<i> &gt;   neighbours:
</I>&gt;<i> 
</I>&gt;<i> Err, this looks like it crashing when it's starting up, not it crashing
</I>&gt;<i> when it's just run out of memory. The eof is interesting though. This
</I>&gt;<i> could just be an old bug where you needed to move the old persister log
</I>&gt;<i> out of the way:
</I>&gt;<i> 
</I>&gt;<i> In /var/lib/rabbitmq/mnesia/$NODENAME/ you should find a
</I>&gt;<i> rabbit_persister.LOG and a rabbit_persister.LOG.previous file. It's
</I>&gt;<i> likely the .previous version is much bigger than the non .previous
</I>&gt;<i> version. You could try moving the rabbit_persister.LOG out of the way,
</I>&gt;<i> and then renaming rabbit_persister.LOG.previous to rabbit_persister.LOG
</I>&gt;<i> and see if it starts up.
</I>&gt;<i> 
</I>&gt;<i> Again, I *think* this was a bug that was reported quite often with 1.7.1
</I>&gt;<i> and older and something that we've subsequently fixed, so again, you
</I>&gt;<i> might have better luck after upgrading Rabbit to 1.8.0.
</I>&gt;<i> 
</I>&gt;<i> I am still curious to see the logs of rabbit as it crashes on you if you
</I>&gt;<i> can find/produce those. What platform are you running on, and how much
</I>&gt;<i> RAM is available in the machine?
</I>&gt;<i> 
</I>&gt;<i> Matthew
</I>&gt;<i> 
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100617/32ca0c66/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100617/32ca0c66/attachment.htm</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007621.html">[rabbitmq-discuss] Rabbitmq Crash
</A></li>
	<LI>Next message: <A HREF="007624.html">[rabbitmq-discuss] Rabbitmq Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7623">[ date ]</a>
              <a href="thread.html#7623">[ thread ]</a>
              <a href="subject.html#7623">[ subject ]</a>
              <a href="author.html#7623">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
