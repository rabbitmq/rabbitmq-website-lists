<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] list_queues times out
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20list_queues%20times%20out&In-Reply-To=%3C20100610185249.GA2141%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007539.html">
   <LINK REL="Next"  HREF="007541.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] list_queues times out</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20list_queues%20times%20out&In-Reply-To=%3C20100610185249.GA2141%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] list_queues times out">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Jun 10 19:52:50 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007539.html">[rabbitmq-discuss] list_queues times out
</A></li>
        <LI>Next message: <A HREF="007541.html">[rabbitmq-discuss] list_queues times out
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7540">[ date ]</a>
              <a href="thread.html#7540">[ thread ]</a>
              <a href="subject.html#7540">[ subject ]</a>
              <a href="author.html#7540">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tyler,

On Thu, Jun 10, 2010 at 02:17:56PM -0400, Tyler Williams wrote:
&gt;<i> I'm having a problem where after running for a while, and with a very large number of messages (10M+, using about 4G RAM), rabbit will get into a state where it is still working, but I cannot list queues. I've been using the rabbitmq-status plugin, and this also stops working, with this message in the logs when I hit the status page:
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 8-Jun-2010::01:29:00 ===
</I>&gt;<i> {mochiweb_socket_server,235,
</I>&gt;<i>     {child_error,
</I>&gt;<i>         {timeout,{gen_server2,call,[rabbit_status_web,get_context]}}}}
</I>&gt;<i> 
</I>&gt;<i> Can I do anything else to debug this? Is this a known issue?
</I>
That's a coding error either in rabbit_status. It should not be doing any
gen_server2:calls without setting the optional timeout to infinity.

I would advise not using rabbit_status if this issue is causing rabbit
to crash.

The rabbitmqctl correctly sets timeouts and will not crash.

There are times when rabbit can be unresponsive and can take a long time
to respond to even rabbitmqctl - on the order of several minutes. This
is easily considered a bug, and fixing this sort of issue is on our todo
list. However, unresponsiveness does not mean anything's gone wrong -
especially on the 21673 branch. Rabbit should always be able to recover
eventually and eventually move to a state where it can accept more
messages.

That said, if you do have 4GB RAM and over 10M messages, you may need to
start using the rabbitmq-toke plugin which cuts down the per-message RAM
cost to very little (in combination with the 21673 branch), by using
tokyo cabinet for a particular index table which otherwise can take a
couple of hundred bytes per entry. Basically, if you see the high
watermark set in the logs, and then a while later Rabbit reaches a point
where it is inactive (no CPU and no disk use) but the high watermark has
not been cleared, then it's likely you need to start investigating the
toke plugin.

Best wishes,

Matthew
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007539.html">[rabbitmq-discuss] list_queues times out
</A></li>
	<LI>Next message: <A HREF="007541.html">[rabbitmq-discuss] list_queues times out
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7540">[ date ]</a>
              <a href="thread.html#7540">[ thread ]</a>
              <a href="subject.html#7540">[ subject ]</a>
              <a href="author.html#7540">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
