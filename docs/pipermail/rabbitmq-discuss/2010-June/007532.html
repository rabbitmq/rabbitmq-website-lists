<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in	the same order
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20-%20Not%20able%20to%20get%20sets%20of%20messages%0A%20in%09the%20same%20order&In-Reply-To=%3C1FE1E824-89AB-48BA-B104-90252B5AE334%40vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007531.html">
   <LINK REL="Next"  HREF="007534.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in	the same order</H1>
    <B>Oleg Zhurakousky</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20-%20Not%20able%20to%20get%20sets%20of%20messages%0A%20in%09the%20same%20order&In-Reply-To=%3C1FE1E824-89AB-48BA-B104-90252B5AE334%40vmware.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in	the same order">ozhurakousky at vmware.com
       </A><BR>
    <I>Thu Jun 10 15:38:31 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007531.html">[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in	the same order
</A></li>
        <LI>Next message: <A HREF="007534.html">[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages	in the same order
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7532">[ date ]</a>
              <a href="thread.html#7532">[ thread ]</a>
              <a href="subject.html#7532">[ subject ]</a>
              <a href="author.html#7532">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Not sure about C# API, and how you are building the next set of messages, but here is what I belive is happening.

Channel prefetch messages. That is different then invoking a consumer. THis means that you might have 1000 prefetched messages in your channel, while you are still processing 21st message. Whatever you un-acknowledge is put back into the queue once the channel is closed. AMQO does not define an ordering of messages for re-queueing.
One way to leverage this scenario is to set prefetchCount to 1. This way there will never me more then one prefetched messages in your channel.

Oleg

On Jun 10, 2010, at 10:24 AM, Srijanani Srinivasan wrote:


Hi,

I am using Rabbit MQ in C#. This is my scenario
1.               A separate process publishes messages to the queue
2.               Client has to read set of N messages from queue
3.               Process the N messages
4.               Acknowledge the N messages
5.               Repeat steps 2 to 4 continuously to process all sets of messages
Under the same channel, I receive the messages and then process them and then acknowledge them. The server process keeps publishing messages. The problem I am facing is, when I try to get next set of messages, they do not come in the same order as it was published by the publishing process. The messages come in a random order. Only the first set of messages comes in the correct order.

Does any one what is going wrong here? Is creating a new channel to access the next set of messages not right? Or is there a problem caused because of acknowledging multiple messages? Please help me understand why this does not work correctly.

Below is the sample code:
while (true)
            {
                using (IModel getChannel = MQConnection.CreateModel())
                {
                    // Create a consumer
                    QueueingBasicConsumer consumer = CreateQueueConsumer(getChannel, exchangeName, queueName);
                    int numberOfMessages = 100;
                    // Next Recieve
                    List&lt;object&gt; msgSet = GetNextSetOfMessages(consumer, getChannel, exchangeName, queueName, numberOfMessages,             out finalDeliverytag);
                    // Do some processing
                    //Acknowledge finished messages by passing in the delivery tag.
                    // calls the method BasicAck with multiple param=true
                    if (finalDeliverytag &gt; 0)
                        AckFinishedMessages(exchangeName, queueName, finalDeliverytag, getChannel);
                    if (finalDeliverytag == 0)
                        break;
                }
            }

Thanks for your help in advance!
Srijanani

&lt;ATT00001..txt&gt;

</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007531.html">[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in	the same order
</A></li>
	<LI>Next message: <A HREF="007534.html">[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages	in the same order
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7532">[ date ]</a>
              <a href="thread.html#7532">[ thread ]</a>
              <a href="subject.html#7532">[ subject ]</a>
              <a href="author.html#7532">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
