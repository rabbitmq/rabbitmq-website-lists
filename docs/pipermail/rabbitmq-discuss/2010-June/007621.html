<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq Crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20Crash&In-Reply-To=%3C20100617122757.GJ17204%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007616.html">
   <LINK REL="Next"  HREF="007623.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq Crash</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20Crash&In-Reply-To=%3C20100617122757.GJ17204%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq Crash">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Jun 17 13:27:58 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007616.html">[rabbitmq-discuss]  Config File
</A></li>
        <LI>Next message: <A HREF="007623.html">[rabbitmq-discuss] Rabbitmq Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7621">[ date ]</a>
              <a href="thread.html#7621">[ thread ]</a>
              <a href="subject.html#7621">[ subject ]</a>
              <a href="author.html#7621">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Waqas,

Please try and keep the mailing list CC'd.

On Thu, Jun 17, 2010 at 05:13:23PM +0500, Waqas Badar wrote:
&gt;<i> We are using RabbitMQ 1.7.1 and we are
</I>&gt;<i> using Java client 1.7.1 and for python pyamqp 0.6.1 and txamqp 0.3.
</I>
Ok. 1.7.1 was less capable about dealing with situations in which it was
running out of memory. I'd recommend upgrading to 1.8.0, though be aware
that none of your queues, exchanges, bindings or messages will be
retained when you upgrade.

&gt;<i> Please note that most of the time it crashes after 200000 messages.
</I>&gt;<i> Following crash reports are found in rabbit-sasl.log file.
</I>&gt;<i> 
</I>&gt;<i> =CRASH REPORT==== 15-Jun-2010::22:41:10 ===
</I>&gt;<i>   crasher:
</I>&gt;<i>     pid: &lt;0.155.0&gt;
</I>&gt;<i>     registered_name: rabbit_persister
</I>&gt;<i>     exception exit: {{badmatch,eof},
</I>&gt;<i>                      [{rabbit_persister,internal_load_snapshot,2},
</I>&gt;<i>                       {rabbit_persister,init,1},
</I>&gt;<i>                       {gen_server,init_it,6},
</I>&gt;<i>                       {proc_lib,init_p_do_apply,3}]}
</I>&gt;<i>       in function  gen_server:init_it/6
</I>&gt;<i>     initial call: rabbit_persister:init/1
</I>&gt;<i>     ancestors: [rabbit_sup,&lt;0.109.0&gt;]
</I>&gt;<i>     messages: []
</I>&gt;<i>     links: [&lt;0.112.0&gt;,&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">support at rabbitmq.com</A> 0.156.0&gt;]
</I>&gt;<i>     dictionary: []
</I>&gt;<i>     trap_exit: true
</I>&gt;<i>     status: running
</I>&gt;<i>     heap_size: 987
</I>&gt;<i>     stack_size: 23
</I>&gt;<i>     reductions: 431
</I>&gt;<i>   neighbours:
</I>
Err, this looks like it crashing when it's starting up, not it crashing
when it's just run out of memory. The eof is interesting though. This
could just be an old bug where you needed to move the old persister log
out of the way:

In /var/lib/rabbitmq/mnesia/$NODENAME/ you should find a
rabbit_persister.LOG and a rabbit_persister.LOG.previous file. It's
likely the .previous version is much bigger than the non .previous
version. You could try moving the rabbit_persister.LOG out of the way,
and then renaming rabbit_persister.LOG.previous to rabbit_persister.LOG
and see if it starts up.

Again, I *think* this was a bug that was reported quite often with 1.7.1
and older and something that we've subsequently fixed, so again, you
might have better luck after upgrading Rabbit to 1.8.0.

I am still curious to see the logs of rabbit as it crashes on you if you
can find/produce those. What platform are you running on, and how much
RAM is available in the machine?

Matthew
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007616.html">[rabbitmq-discuss]  Config File
</A></li>
	<LI>Next message: <A HREF="007623.html">[rabbitmq-discuss] Rabbitmq Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7621">[ date ]</a>
              <a href="thread.html#7621">[ thread ]</a>
              <a href="subject.html#7621">[ subject ]</a>
              <a href="author.html#7621">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
