<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] how does the rabbitmq transport cope with	WAN links?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20how%20does%20the%20rabbitmq%20transport%20cope%20with%0A%09WAN%20links%3F&In-Reply-To=%3CE6AC2562-CDBB-4503-B9B5-9BB85D0B4953%40adconion.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007437.html">
   <LINK REL="Next"  HREF="007567.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] how does the rabbitmq transport cope with	WAN links?</H1>
    <B>Nikos Michalakis</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20how%20does%20the%20rabbitmq%20transport%20cope%20with%0A%09WAN%20links%3F&In-Reply-To=%3CE6AC2562-CDBB-4503-B9B5-9BB85D0B4953%40adconion.com%3E"
       TITLE="[rabbitmq-discuss] how does the rabbitmq transport cope with	WAN links?">nmichalakis at adconion.com
       </A><BR>
    <I>Tue Jun  1 20:05:13 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007437.html">[rabbitmq-discuss] how does the rabbitmq transport cope with WAN links?
</A></li>
        <LI>Next message: <A HREF="007567.html">[rabbitmq-discuss] how does the rabbitmq transport cope with WAN links?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7439">[ date ]</a>
              <a href="thread.html#7439">[ thread ]</a>
              <a href="subject.html#7439">[ subject ]</a>
              <a href="author.html#7439">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the info, Matthew.

It seems to me that the only difference between the cluster and the shovel is that you have one WAN connection vs multiple ones. The failure detection and reconnect mechanisms seem to be the same. Assuming my messages fit in a single TCP frame (about 100-200 bytes) and I have a throughput of 20-100 messages/sec with 3 nodes on each side of the WAN link, would the cluster have serious performance issues compared to the shovel set up? I'm assuming that the sender has one &quot;thread&quot; per outgoing queue so the 3 copies that need to go over the WAN are sent at nearly the same time (since I have enough bandwidth over the link). Is that not the case?

nikos

On Jun 1, 2010, at 11:52 AM, Matthew Sackman wrote:

&gt;<i> Hi Nikos,
</I>&gt;<i> 
</I>&gt;<i> On Tue, Jun 01, 2010 at 11:46:59AM -0400, Nikos Michalakis wrote:
</I>&gt;&gt;<i> I was reading the RabbitMQ docs, but couldn't find many details on what exactly the underlying protocol is for sending messages between cluster nodes.
</I>&gt;<i> 
</I>&gt;<i> AMQP over TCP.
</I>&gt;<i> 
</I>&gt;&gt;<i> I 've seen that RabbitMQ relies on distributed Erlang over TCP, but is there more specific information on how links are made reliable in RabbitMQ? More particularly I'm looking to find out more details on how RabbitMQ configures its transports between cluster nodes. 
</I>&gt;<i> 
</I>&gt;<i> Clustering is intended for scalability only, and really needs to work in
</I>&gt;<i> a LAN situation, given the all-to-all connections made between erlang
</I>&gt;<i> nodes in a cluster. I think it's more likely you'll find utility in the
</I>&gt;<i> rabbitmq-shovel, which makes a broker look like a client, hence makes it
</I>&gt;<i> very easy to do store-and-forward (amongst other things).
</I>&gt;<i> 
</I>&gt;<i> We always rely on TCP.
</I>&gt;<i> 
</I>&gt;&gt;<i> Are there single or multiple TCP connections between nodes? 
</I>&gt;<i> 
</I>&gt;<i> Normally single, in a clustering environment. But if you're using the
</I>&gt;<i> shovel then it'll be one per shovel configuration.
</I>&gt;<i> 
</I>&gt;&gt;<i> What happens when a TCP connection fails? Do nodes detect that event and try to reestablish the connection automatically? Distributed Erlang has APIs for detecting a node is down. Is that used in Rabbit?
</I>&gt;<i> 
</I>&gt;<i> Yes and yes. And the shovel does that too.
</I>&gt;<i> 
</I>&gt;&gt;<i> Do connections rely on TCP to deal with packet loss or is there some Rabbit magic as well?
</I>&gt;<i> 
</I>&gt;<i> TCP is a reliable transport by definition, and sorts out packet loss and
</I>&gt;<i> reording itself. We rely on that.
</I>&gt;<i> 
</I>&gt;&gt;<i> How are messages serialized into AMQP packets?
</I>&gt;<i> 
</I>&gt;<i> The AMQP payload is totally opaque. The client APIs tend to present just
</I>&gt;<i> byte arrays to set a message payload.
</I>&gt;<i> 
</I>&gt;<i> Matthew
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007437.html">[rabbitmq-discuss] how does the rabbitmq transport cope with WAN links?
</A></li>
	<LI>Next message: <A HREF="007567.html">[rabbitmq-discuss] how does the rabbitmq transport cope with WAN links?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7439">[ date ]</a>
              <a href="thread.html#7439">[ thread ]</a>
              <a href="subject.html#7439">[ subject ]</a>
              <a href="author.html#7439">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
