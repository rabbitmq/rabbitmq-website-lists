<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ - Not able to get sets of messages	in the same order
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20-%20Not%20able%20to%20get%20sets%20of%20messages%0A%09in%20the%20same%20order&In-Reply-To=%3CAANLkTimdU7SRDQIl08drbXAF-fM0Y9daaJhCmKZ58Gbf%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007532.html">
   <LINK REL="Next"  HREF="007572.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages	in the same order</H1>
    <B>Srijanani Srinivasan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20-%20Not%20able%20to%20get%20sets%20of%20messages%0A%09in%20the%20same%20order&In-Reply-To=%3CAANLkTimdU7SRDQIl08drbXAF-fM0Y9daaJhCmKZ58Gbf%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages	in the same order">srijanani.s at gmail.com
       </A><BR>
    <I>Thu Jun 10 15:53:04 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007532.html">[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in	the same order
</A></li>
        <LI>Next message: <A HREF="007572.html">[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in the same order
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7534">[ date ]</a>
              <a href="thread.html#7534">[ thread ]</a>
              <a href="subject.html#7534">[ subject ]</a>
              <a href="author.html#7534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your response. What you said makes sense. When the messages that
have not been acknowledged are put back to the queue, then
the other messages added in the meantime should be the ones to be de-queued
first right in the FIFO manner? But like you said, i guess thats not how it
works.

The same problem occurs, when I get a set of messages and don't acknowledge
them and close the channel (in the event of any exceptions). When we get the
messages, they do not come in the correct order.

I guess, if i want to get sets of messages instead of one at a time, I must
try to use the same channel. Is that right?

On Thu, Jun 10, 2010 at 9:38 AM, Oleg Zhurakousky
&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ozhurakousky at vmware.com</A>&gt;wrote:

&gt;<i> Not sure about C# API, and how you are building the next set of messages,
</I>&gt;<i> but here is what I belive is happening.
</I>&gt;<i>
</I>&gt;<i> Channel prefetch messages. That is different then invoking a consumer. THis
</I>&gt;<i> means that you might have 1000 prefetched messages in your channel, while
</I>&gt;<i> you are still processing 21st message. Whatever you un-acknowledge is put
</I>&gt;<i> back into the queue once the channel is closed. AMQO does not define an
</I>&gt;<i> ordering of messages for re-queueing.
</I>&gt;<i> One way to leverage this scenario is to set prefetchCount to 1. This way
</I>&gt;<i> there will never me more then one prefetched messages in your channel.
</I>&gt;<i>
</I>&gt;<i> Oleg
</I>&gt;<i>
</I>&gt;<i> On Jun 10, 2010, at 10:24 AM, Srijanani Srinivasan wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I am using Rabbit MQ in C#. This is my scenario
</I>&gt;<i> 1.               A separate process publishes messages to the queue
</I>&gt;<i> 2.               Client has to read set of N messages from queue
</I>&gt;<i> 3.               Process the N messages
</I>&gt;<i> 4.               Acknowledge the N messages
</I>&gt;<i> 5.               Repeat steps 2 to 4 continuously to process all sets of
</I>&gt;<i> messages
</I>&gt;<i> Under the same channel, I receive the messages and then process them and
</I>&gt;<i> then acknowledge them. The server process keeps publishing messages. The
</I>&gt;<i> problem I am facing is, when I try to get next set of messages, they do not
</I>&gt;<i> come in the same order as it was published by the publishing process. The
</I>&gt;<i> messages come in a random order. Only the first set of messages comes in the
</I>&gt;<i> correct order.
</I>&gt;<i>
</I>&gt;<i> Does any one what is going wrong here? Is creating a new channel to access
</I>&gt;<i> the next set of messages not right? Or is there a problem caused because of
</I>&gt;<i> acknowledging multiple messages? Please help me understand why this does not
</I>&gt;<i> work correctly.
</I>&gt;<i>
</I>&gt;<i> Below is the sample code:
</I>&gt;<i> while (true)
</I>&gt;<i>            {
</I>&gt;<i>                using (IModel getChannel = MQConnection.CreateModel())
</I>&gt;<i>                {
</I>&gt;<i>                    // Create a consumer
</I>&gt;<i>                    QueueingBasicConsumer consumer =
</I>&gt;<i> CreateQueueConsumer(getChannel, exchangeName, queueName);
</I>&gt;<i>                    int numberOfMessages = 100;
</I>&gt;<i>                    // Next Recieve
</I>&gt;<i>                    List&lt;object&gt; msgSet = GetNextSetOfMessages(consumer,
</I>&gt;<i> getChannel, exchangeName, queueName, numberOfMessages,             out
</I>&gt;<i> finalDeliverytag);
</I>&gt;<i>                    // Do some processing
</I>&gt;<i>                    //Acknowledge finished messages by passing in the
</I>&gt;<i> delivery tag.
</I>&gt;<i>                    // calls the method BasicAck with multiple param=true
</I>&gt;<i>                    if (finalDeliverytag &gt; 0)
</I>&gt;<i>                        AckFinishedMessages(exchangeName, queueName,
</I>&gt;<i> finalDeliverytag, getChannel);
</I>&gt;<i>                    if (finalDeliverytag == 0)
</I>&gt;<i>                        break;
</I>&gt;<i>                }
</I>&gt;<i>            }
</I>&gt;<i>
</I>&gt;<i> Thanks for your help in advance!
</I>&gt;<i> Srijanani
</I>&gt;<i>
</I>&gt;<i> &lt;ATT00001..txt&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100610/207d0fd1/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100610/207d0fd1/attachment.htm</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007532.html">[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in	the same order
</A></li>
	<LI>Next message: <A HREF="007572.html">[rabbitmq-discuss] RabbitMQ - Not able to get sets of messages in the same order
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7534">[ date ]</a>
              <a href="thread.html#7534">[ thread ]</a>
              <a href="subject.html#7534">[ subject ]</a>
              <a href="author.html#7534">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
