<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Consumes Very Slow
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Consumes%20Very%20Slow&In-Reply-To=%3C20100601230934.GA28451%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007440.html">
   <LINK REL="Next"  HREF="007442.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Consumes Very Slow</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Consumes%20Very%20Slow&In-Reply-To=%3C20100601230934.GA28451%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Consumes Very Slow">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Jun  2 00:09:34 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007440.html">[rabbitmq-discuss] RabbitMQ Consumes Very Slow
</A></li>
        <LI>Next message: <A HREF="007442.html">[rabbitmq-discuss] RabbitMQ Consumes Very Slow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7441">[ date ]</a>
              <a href="thread.html#7441">[ thread ]</a>
              <a href="subject.html#7441">[ subject ]</a>
              <a href="author.html#7441">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Bradford,

On Tue, Jun 01, 2010 at 03:27:51PM -0700, Bradford Stephens wrote:
&gt;<i> I'm having pretty nasty speed issues on Fedora. I'm running Fedora 8,
</I>&gt;<i> 64-bit on EC2. I have a 8core/8GB RAM server. I'm able to insert
</I>&gt;<i> thousands of messages a second, but I can only consume about 3/sec.
</I>&gt;<i> Each is ~1k.
</I>
Well for starters, don't use basic.get, set up a consumer using
basic.consume. Secondly, think about whether you need to acknowledge
messages - if they're relatively unimportant messages (i.e. if a client
crashes whilst processing messages, do you want those messages to be
lost, or to automatically be requeued) then you might consider turning
on noAck (looks like you already do in your example code), which helps
speed.

Finally, you're bascially writing a poor version of the QueueingConsumer
(the major difference being that QueueingConsumer permits a jump across
threads, meaning that you can process received messages in a different
thread, and not impact the rate at which you receive messages from the
broker). I'd recommend you try using the QueueingConsumer instead as it
would then mean that you don't block the client whilst you're processing
the messages (in this case just adding messages into a queue -- err
which is what the QueueingConsumer does for you automatically).

As always with performance issues, once you're using the right API and
right algorithms (and asking here is definitely the right thing to do),
careful use of a profiler is a good idea to pick up where any further
bottlenecks are.

Matthew

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007440.html">[rabbitmq-discuss] RabbitMQ Consumes Very Slow
</A></li>
	<LI>Next message: <A HREF="007442.html">[rabbitmq-discuss] RabbitMQ Consumes Very Slow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7441">[ date ]</a>
              <a href="thread.html#7441">[ thread ]</a>
              <a href="subject.html#7441">[ subject ]</a>
              <a href="author.html#7441">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
