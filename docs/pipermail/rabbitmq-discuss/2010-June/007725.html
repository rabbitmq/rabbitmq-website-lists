<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Debugging rabbitmq crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Debugging%20rabbitmq%20crash&In-Reply-To=%3CAANLkTimQ7E9M_ag_JBaa82e9IWJ8QgKI7XqvmKcj5WCG%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007721.html">
   <LINK REL="Next"  HREF="007726.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Debugging rabbitmq crash</H1>
    <B>Scott Brooks</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Debugging%20rabbitmq%20crash&In-Reply-To=%3CAANLkTimQ7E9M_ag_JBaa82e9IWJ8QgKI7XqvmKcj5WCG%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Debugging rabbitmq crash">scott at beamdog.com
       </A><BR>
    <I>Wed Jun 23 16:09:45 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007721.html">[rabbitmq-discuss] Debugging rabbitmq crash
</A></li>
        <LI>Next message: <A HREF="007726.html">[rabbitmq-discuss] Debugging rabbitmq crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7725">[ date ]</a>
              <a href="thread.html#7725">[ thread ]</a>
              <a href="subject.html#7725">[ subject ]</a>
              <a href="author.html#7725">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Which version of erlang are you running?  If you are not &gt;= R13B03,
I'd recommend the upgrade.

Even though you are fully consuming all the messages, at that rate the
GC may not be aggressive enough to clean up that memory.
The erlang GC has seen some huge improvements, and if you are on R12,
that may be the problem.

Here is a post from lshift about even the differences between R13B02 and R13B03
<A HREF="http://www.lshift.net/blog/2009/12/01/garbage-collection-in-erlang">http://www.lshift.net/blog/2009/12/01/garbage-collection-in-erlang</A>

As far as debugging steps, I guess you could look at the memory usage
of your beam process and see how fast it is growing,
and also use
rabbitmqctl list_queues name messages messages_ready
messages_unacknowledged messages_uncommited memory
to watch the stats as far as RabbitMQ is concerned.

Scott

On Wed, Jun 23, 2010 at 4:48 AM, Matt Calder &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mvcalder at gmail.com</A>&gt; wrote:
&gt;<i> I am looking for guidance on how to debug a crash of rabbit. The
</I>&gt;<i> situation is this. There is a pair of processes running on a single
</I>&gt;<i> machine. One process sends a message to the other, and the other
</I>&gt;<i> responds. This is happening at ~20 message pairs per second. There is
</I>&gt;<i> a single direct exchange and two queues, one for messages going one
</I>&gt;<i> way, the other for messages going the other way. The queues are not
</I>&gt;<i> durable, and not auto delete. The processes run for ~15 hours without
</I>&gt;<i> issue over a single connection. Then the connection closes. Here is
</I>&gt;<i> the rabbit.log:
</I>&gt;<i>
</I>&gt;<i> &#160;=INFO REPORT==== 22-Jun-2010::18:03:03 ===
</I>&gt;<i> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:55824
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 22-Jun-2010::18:03:03 ===
</I>&gt;<i> starting TCP connection &lt;0.15621.0&gt; from 127.0.0.1:55824
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 23-Jun-2010::01:59:00 ===
</I>&gt;<i> &#160; &#160;alarm_handler: {set,{system_memory_high_watermark,[]}}
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 23-Jun-2010::02:02:55 ===
</I>&gt;<i> &#160; &#160;alarm_handler: {clear,system_memory_high_watermark}
</I>&gt;<i>
</I>&gt;<i> =WARNING REPORT==== 23-Jun-2010::06:27:37 ===
</I>&gt;<i> exception on TCP connection &lt;0.15425.0&gt; from 127.0.0.1:47025
</I>&gt;<i> connection_closed_abruptly
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 23-Jun-2010::06:27:37 ===
</I>&gt;<i> closing TCP connection &lt;0.15425.0&gt; from 127.0.0.1:47025
</I>&gt;<i>
</I>&gt;<i> =WARNING REPORT==== 23-Jun-2010::06:27:37 ===
</I>&gt;<i> exception on TCP connection &lt;0.15621.0&gt; from 127.0.0.1:55824
</I>&gt;<i> connection_closed_abruptly
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 23-Jun-2010::06:27:37 ===
</I>&gt;<i> closing TCP connection &lt;0.15621.0&gt; from 127.0.0.1:55824
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So, there appeared to be a memory issue, but it also appeared to pass.
</I>&gt;<i> I watched the process on and off and it seemed to be using a steady
</I>&gt;<i> 15% of available memory according to top. All the other logs are
</I>&gt;<i> either old, or empty. Specifically, rabbit-sasl.log was touched
</I>&gt;<i> apparently at the time of the crash.
</I>&gt;<i>
</I>&gt;<i> -rw-r--r-- 1 rabbitmq rabbitmq &#160; &#160; 0 2010-06-23 06:27 rabbit-sasl.log
</I>&gt;<i>
</I>&gt;<i> I can reproduce this, though it takes the 15 hours or so.
</I>&gt;<i>
</I>&gt;<i> If anyone can guide me through the steps necessary to debugging this I
</I>&gt;<i> would appreciate it. Specific suggestions, like, &quot;your problem is X&quot;,
</I>&gt;<i> are of course welcome, but I am also interested in process. Thank you,
</I>&gt;<i>
</I>&gt;<i> Matt
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007721.html">[rabbitmq-discuss] Debugging rabbitmq crash
</A></li>
	<LI>Next message: <A HREF="007726.html">[rabbitmq-discuss] Debugging rabbitmq crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7725">[ date ]</a>
              <a href="thread.html#7725">[ thread ]</a>
              <a href="subject.html#7725">[ subject ]</a>
              <a href="author.html#7725">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
