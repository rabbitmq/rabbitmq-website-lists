<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publish to queue fails but publish to direct	exchange works
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publish%20to%20queue%20fails%20but%20publish%20to%20direct%0A%09exchange%20works&In-Reply-To=%3CAANLkTimwPk2WFnDAXaNF01ljp7DuAZ9B_WKA_95eiVte%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007640.html">
   <LINK REL="Next"  HREF="007642.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publish to queue fails but publish to direct	exchange works</H1>
    <B>Raphael Simon</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publish%20to%20queue%20fails%20but%20publish%20to%20direct%0A%09exchange%20works&In-Reply-To=%3CAANLkTimwPk2WFnDAXaNF01ljp7DuAZ9B_WKA_95eiVte%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Publish to queue fails but publish to direct	exchange works">raphael at rightscale.com
       </A><BR>
    <I>Fri Jun 18 07:34:03 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007640.html">[rabbitmq-discuss] Publish to queue fails but publish to direct exchange works
</A></li>
        <LI>Next message: <A HREF="007642.html">[rabbitmq-discuss] Publish to queue fails but publish to direct	exchange works
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7641">[ date ]</a>
              <a href="thread.html#7641">[ thread ]</a>
              <a href="subject.html#7641">[ subject ]</a>
              <a href="author.html#7641">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias, thanks for following up.  Please see my answers inline.

On Thu, Jun 17, 2010 at 10:52 PM, Matthias Radestock
&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt;wrote:

&gt;<i> Raphael,
</I>&gt;<i>
</I>&gt;<i> Raphael Simon wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Running some queries on the broker shows that the queue route is indeed
</I>&gt;&gt;<i> gone from mnesia while the exchange route still exists:  [...]
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Simply running 'rabbitmqctl list_bindings' should give the same results.
</I>&gt;<i> Please do that, just to check.
</I>&gt;<i>
</I>
Yes indeed but where is the fun in doing that? OK more seriously I did not
understand the subtlety of the empty spaces, now I do (as a side note it
would be nice to have something rather than blank in this case maybe *** or
---).


&gt;<i>
</I>&gt;<i> It looks like the binding to the default exchange has vanished. That really
</I>&gt;<i> should only ever happen if the queue is deleted or that binding is removed
</I>&gt;<i> explicitly. Could the latter have happened? It's actually a grey area of the
</I>&gt;<i> spec; imo it should not be allowed, but rabbit does currently permit it.
</I>&gt;<i>
</I>
No I can't think of a place where we would delete a binding. We only ever
delete queues.


&gt;<i>
</I>&gt;<i> Is the default exchange itself still there? Check with 'rabbitmqctl
</I>&gt;<i> list_exchanges'.
</I>&gt;<i>
</I>
Yes the exchange still exists.


&gt;<i>
</I>&gt;<i> Is this reproducible at all? I suspect not :(
</I>&gt;<i>
</I>
No it has only happens about 15 times on the course of two days. During
these two days our system was having issues and weird things could have
happened on the broker (e.g. the queue could have been deleted and
recreated).


&gt;<i>
</I>&gt;<i> What version of rabbit are you running?
</I>

1.7.2


&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  I still don't understand what scenario could cause this to happen though
</I>&gt;&gt;<i> especially since the exchange is auto-delete
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Interesting. auto-delete exchanges are very rare. In fact I do not know of
</I>&gt;<i> anybody else using them. So it's possible there is a bug in that code that
</I>&gt;<i> has laid dormant for years. Can you explain your use-case for auto-delete
</I>&gt;<i> exchanges?
</I>&gt;<i>
</I>
Embarrassingly enough, I can't :) The fact that we are using direct
exchanges for these queues was a bug we introduced, we will be removing
them.


&gt;<i>
</I>&gt;<i> Also, what version of rabbit are you running?
</I>&gt;<i>
</I>
1.7.2


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i>
</I>
I recreated some bindings from within the broker (directly in mnesia) and
now things started working again. Is there a better way to re-create the
binding to the default exchange without having to re-create the queue?

Obviously I'm still very much interested in finding out what could have
caused the binding to be deleted in the first place.

Thanks,

--
Raphael.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100617/bc131267/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100617/bc131267/attachment.htm</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007640.html">[rabbitmq-discuss] Publish to queue fails but publish to direct exchange works
</A></li>
	<LI>Next message: <A HREF="007642.html">[rabbitmq-discuss] Publish to queue fails but publish to direct	exchange works
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7641">[ date ]</a>
              <a href="thread.html#7641">[ thread ]</a>
              <a href="subject.html#7641">[ subject ]</a>
              <a href="author.html#7641">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
