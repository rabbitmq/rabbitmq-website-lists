<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%203.0.4%20extremely%20unstable%20in%20production...%3F&In-Reply-To=%3Ca3b2aa1d-b3f7-4093-9047-00bb579179c3%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026489.html">
   <LINK REL="Next"  HREF="026495.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 3.0.4 extremely unstable in production...?</H1>
    <B>Matt Wise</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%203.0.4%20extremely%20unstable%20in%20production...%3F&In-Reply-To=%3Ca3b2aa1d-b3f7-4093-9047-00bb579179c3%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] 3.0.4 extremely unstable in production...?">matt at nextdoor.com
       </A><BR>
    <I>Fri Apr 12 19:36:22 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026489.html">[rabbitmq-discuss] Dead Letter, TTL and Cycle
</A></li>
        <LI>Next message: <A HREF="026495.html">[rabbitmq-discuss] 3.0.4 extremely unstable in production...?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26490">[ date ]</a>
              <a href="thread.html#26490">[ thread ]</a>
              <a href="subject.html#26490">[ subject ]</a>
              <a href="author.html#26490">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We've been running RabbitMQ 2.8.x in production in Amazon for about 16 
months now without very many issues. Last week we ran into an issue where 
our 2.8.5 cluster nodes hit their high-memory-limit and stopped processing 
jobs, effectively taking down our entire Celery task queue. We decided to 
upgrade the software to 3.0.4 (which had been running in staging for a few 
weeks, as a single instance, without issue) and at the same time beef up 
the size and redundancy of our farm to 3 machines that were m1.larges.

Old Farm:
  server1: m1.small, 2.8.5, us-west-1c
  server2: m1.small, 2.8.5, us-west-1c

New Farm:
  server1: m1.large, 3.0.4, us-west-1a
  server2: m1.large, 3.0.4, us-west-1c
  server3: m1.large, 3.0.4, us-west-1c

Since creating the new server farm though we've had 3 outages. In the first 
two outages we received a Network Partition Split, and effectively all 3 of 
the systems decided to run their own queues independently of the other 
servers. This was the first time we'd ever seen this failure, ever. In the 
most recent failure we had 2 machines split off, and the 3rd rabbitmq 
service effectively became unresponsive entirely.

For sanity sake, at this point we've backed down to the following 
configuration:

New-New Farm:
  server1: m1.large, 2.8.5, us-west-1c
  server2: m1.large, 2.8.5, us-west-1a

Up until recently though I had felt extremely comfortable with RabbitMQ's 
clustering technology and reliability... now ... not so much. Has anyone 
else seen similar behaviors? Is it simply due to the fact that we're 
running cross-zone now in Amazon, or is it more likely the 3 servers that 
caused the problem? Or the 3.0.x upgrade?

--Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/e2ce6f06/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/e2ce6f06/attachment.htm</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026489.html">[rabbitmq-discuss] Dead Letter, TTL and Cycle
</A></li>
	<LI>Next message: <A HREF="026495.html">[rabbitmq-discuss] 3.0.4 extremely unstable in production...?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26490">[ date ]</a>
              <a href="thread.html#26490">[ thread ]</a>
              <a href="subject.html#26490">[ subject ]</a>
              <a href="author.html#26490">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
