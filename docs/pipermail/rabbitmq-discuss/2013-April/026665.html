<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] memory usage reporting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20memory%20usage%20reporting&In-Reply-To=%3C112637221.74930.1366811359010.JavaMail.root%400b10.mx%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026706.html">
   <LINK REL="Next"  HREF="026671.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] memory usage reporting</H1>
    <B>Kyle O'Donnell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20memory%20usage%20reporting&In-Reply-To=%3C112637221.74930.1366811359010.JavaMail.root%400b10.mx%3E"
       TITLE="[rabbitmq-discuss] memory usage reporting">kyleo at 0b10.mx
       </A><BR>
    <I>Wed Apr 24 14:49:19 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026706.html">[rabbitmq-discuss] ConnectionFactory.newConnection(Address[] addrs) is very slow
</A></li>
        <LI>Next message: <A HREF="026671.html">[rabbitmq-discuss] memory usage reporting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26665">[ date ]</a>
              <a href="thread.html#26665">[ thread ]</a>
              <a href="subject.html#26665">[ subject ]</a>
              <a href="author.html#26665">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've built rabbit (2.8.7 and 3.0.4) from source using R15B03, here are the build time options:

make RABBITMQ_BASE=/x/s/rabbitmq-server-3.0.4 RABBITMQ_LOG_BASE=/x/s/rabbitmq-server-3.0.4/var/log RABBITMQ_CONFIG_FILE=/x/s/rabbitmq-server-3.0.4/etc/rabbitmq RABBITMQ_MNESIA_DIR=/x/s/rabbitmq-server-3.0.4/var/lib/mnesia TARGET_DIR=/x/s/rabbitmq-server-3.0.4 SBIN_DIR=/x/s/rabbitmq-server-3.0.4/sbin MAN_DIR=/x/s/rabbitmq-server-3.0.4/man

When I start my app rabbit quickly reports that it's reached the high watermark for memory usage, and it counts virtual memory not resident memory:

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+ COMMAND                                                                                                                29723 prod      20   0 17.9g 269m 2752 S    4  0.8   2:40.80 /x/s/erlang-R15B03/lib/erlang/erts-5.9.3.1/bin/beam.smp -W w -K true -A30 -P 1048576 -- -root /x/s/erlang-R15B03/lib/erlang -progname erl -- -home /home/prod -- -pa /x/s/rabbitmq

There is plenty of free memory on the machine

$ free -m
             total       used       free     shared    buffers     cached
Mem:         32178       2992      29186          0        242       1929
-/+ buffers/cache:        820      31358
Swap:         5719          0       5719

Is this normal? Curious why rabbit cares about the virtual memory size when there is so much actual memory available.

below is the output from rabbitmqctl status

Thanks,
Kyle


rabbitmqctl status
Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at p1-amqp-j101</A>' ...
[{pid,29723},
 {running_applications,
     [{rabbitmq_management_visualiser,&quot;RabbitMQ Visualiser&quot;,&quot;0.0.0&quot;},
      {rabbitmq_management,&quot;RabbitMQ Management Console&quot;,&quot;0.0.0&quot;},
      {rabbitmq_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;0.0.0&quot;},
      {rabbit,&quot;RabbitMQ&quot;,&quot;3.0.4&quot;},
      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.7.1&quot;},
      {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.10&quot;},
      {rabbitmq_web_dispatch,&quot;RabbitMQ Web Dispatcher&quot;,&quot;0.0.0&quot;},
      {webmachine,&quot;webmachine&quot;,&quot;1.9.1-rmq0.0.0-git52e62bc&quot;},
      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;2.3.1-rmq0.0.0-gitd541e9a&quot;},
      {xmerl,&quot;XML parser&quot;,&quot;1.3.2&quot;},
      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.9.2&quot;},
      {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;0.0.0&quot;},
      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.2.1&quot;},
      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.18.3&quot;},
      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.15.3&quot;}]},
 {os,{unix,linux}},
 {erlang_version,
     &quot;Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:4:4] [async-threads:30] [hipe] [kernel-poll:true]\n&quot;},
 {memory,
     [{total,15536914264},
      {connection_procs,89537888},
      {queue_procs,18333416},
      {plugins,1170400},
      {other_proc,6548309},
      {mnesia,2538168},
      {mgmt_db,32239752},
      {msg_index,615120},
      {other_ets,3557064},
      {binary,15276878352},
      {code,20248995},
      {atom,801697},
      {other_system,84445103}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,13496687001},
 {disk_free_limit,1000000000},
 {disk_free,22007357440},
 {file_descriptors,
     [{total_limit,130970},
      {total_used,1828},
      {sockets_limit,117871},
      {sockets_used,1826}]},
 {processes,[{limit,1048576},{used,20875}]},
 {run_queue,0},
 {uptime,1620}]
...done.
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026706.html">[rabbitmq-discuss] ConnectionFactory.newConnection(Address[] addrs) is very slow
</A></li>
	<LI>Next message: <A HREF="026671.html">[rabbitmq-discuss] memory usage reporting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26665">[ date ]</a>
              <a href="thread.html#26665">[ thread ]</a>
              <a href="subject.html#26665">[ subject ]</a>
              <a href="author.html#26665">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
