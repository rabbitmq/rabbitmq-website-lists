<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20consumers%20on%20multiple%0A%09servers%20%21&In-Reply-To=%3C0948EB5F-B5A7-4C46-962A-E4D57AB6BA65%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026282.html">
   <LINK REL="Next"  HREF="026284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20consumers%20on%20multiple%0A%09servers%20%21&In-Reply-To=%3C0948EB5F-B5A7-4C46-962A-E4D57AB6BA65%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !">tim at rabbitmq.com
       </A><BR>
    <I>Mon Apr  1 13:42:59 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026282.html">[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
</A></li>
        <LI>Next message: <A HREF="026284.html">[rabbitmq-discuss] RabbitMQ and AMQP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26283">[ date ]</a>
              <a href="thread.html#26283">[ thread ]</a>
              <a href="subject.html#26283">[ subject ]</a>
              <a href="author.html#26283">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>tluck,

On 1 Apr 2013, at 10:16, tluck wrote:

&gt;<i> The real problem seems is the working fashion of rabbitmq (round robin). If
</I>&gt;<i> there are 2 consumers on a queue then I should see 2 unacknowledged messages
</I>&gt;<i> at a time (meaning, 2 consumers are consuming messages).
</I>
No that is just not correct, or at the very least you're phrasing it in a way
that doesn't make any sense to me. Are you saying that you want a per-queue (rather
than per-consumer) prefetch count?

&gt;<i> But, I see only 1
</I>&gt;<i> unacknowledged message even there are plenty of messages in queue waiting to
</I>&gt;<i> be consumed.
</I>
You 'see only 1 unacknowledged message' where? In one consumer, or across all
consumers, or what!? How are you determining this - are you using the management console?

* How many consumers connected to the one queue?
* What prefetch setting (if any) for each consumer? Is it set to '1' per-chance?

&gt;<i> If both the consumers are running on different threads then how
</I>&gt;<i> could this possible ? why only 1 consumer is consuming message and other one
</I>&gt;<i> is in idle state ? 
</I>
Do you have the prefetch count set explicitly (or does your client library do this)? It appears
that you do:

&quot;$channel-&gt;basic_qos(null, 1, null);&quot;

This tells rabbit not to give that consumer more than 1 un-acked message at a time. Where are
these other consumers getting created? If they're on a separate connection (and machine) then
can you see them in the management console?

&gt;<i> 
</I>&gt;<i> Is there any other way by which I can make consumers to consume next
</I>&gt;<i> messages from the queue as soon as they finish their last job/message ?  
</I>&gt;<i> 
</I>
What? That's what happens as soon as they send an ACK - are you forgetting to ACK or something?
Perhaps someone who understands the PHP client better than I do can comment on what might be
going on here, because this just doesn't make any sense to me. Are these second consumers by
any chance running in the same PHP application? Isn't PHP single threaded? Could that be why your
application isn't progressing the way you'd expect it to?

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026282.html">[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
</A></li>
	<LI>Next message: <A HREF="026284.html">[rabbitmq-discuss] RabbitMQ and AMQP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26283">[ date ]</a>
              <a href="thread.html#26283">[ thread ]</a>
              <a href="subject.html#26283">[ subject ]</a>
              <a href="author.html#26283">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
