<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ manager and Idle queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20manager%20and%20Idle%20queues&In-Reply-To=%3C516D4FBB.5000602%40sophiacom.fr%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026512.html">
   <LINK REL="Next"  HREF="026547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ manager and Idle queues</H1>
    <B>Antoine Berry</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20manager%20and%20Idle%20queues&In-Reply-To=%3C516D4FBB.5000602%40sophiacom.fr%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ manager and Idle queues">aberry at sophiacom.fr
       </A><BR>
    <I>Tue Apr 16 14:18:51 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026512.html">[rabbitmq-discuss] RabbitMQ manager and Idle queues
</A></li>
        <LI>Next message: <A HREF="026547.html">[rabbitmq-discuss] RabbitMQ Queues memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26513">[ date ]</a>
              <a href="thread.html#26513">[ thread ]</a>
              <a href="subject.html#26513">[ subject ]</a>
              <a href="author.html#26513">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon,

Thank you for the quick answer. We will upgrade !
It was in the patch note indeed, but we hadn't seen it.
About the queue ttl, we saw it too, but the problem is that it doesn't 
seem to check if there still are some messages in the queue, and no 
consumer on it (for exemple), so it will be deleted anyway. Or that's 
not the behavior we wanted, if we understood it well.

Cheers

Antoine

Le 16/04/13 15:00, Simon MacMullen a &#233;crit :
&gt;<i> Hi. There was a bug introduced in 3.0.0 and fixed in 3.0.2 where 
</I>&gt;<i> queues would sometimes not hibernate when idle (which is what drives 
</I>&gt;<i> those &quot;last_event&quot; fields and the &quot;active&quot; flag). So the short answer 
</I>&gt;<i> is &quot;please upgrade&quot;.
</I>&gt;<i>
</I>&gt;<i> But you should be cautious about driving anything from those 
</I>&gt;<i> &quot;last_event&quot; fields anyway - you're essentially looking at when the 
</I>&gt;<i> queue process last woke up, and something as trivial as &quot;rabbitmqctl 
</I>&gt;<i> list_queues&quot; will wake the queue process up.
</I>&gt;<i>
</I>&gt;<i> You might want to look at <A HREF="http://www.rabbitmq.com/ttl.html#queue-ttl">http://www.rabbitmq.com/ttl.html#queue-ttl</A> 
</I>&gt;<i> as an alternative.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> On 16/04/13 13:50, Antoine Berry wrote:
</I>&gt;&gt;<i> Hello everybody,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We have a little problem with the rabbitMQ management plugin. Basically
</I>&gt;&gt;<i> we would want to delete the Idle queues. So to do that we send a http
</I>&gt;&gt;<i> request to the rabbitMQ management plugin REST API, to get the value of
</I>&gt;&gt;<i> the &quot;last_event&quot; field.
</I>&gt;&gt;<i> But we always get last_event = now, even though we haven't used the
</I>&gt;&gt;<i> queue nor the virtual host in general for a day... Plus these queues
</I>&gt;&gt;<i> don't even have any consumers, and the application is not even running.
</I>&gt;&gt;<i> And all the queues are marked as active in the web management page too.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here are an exemple of request, and a screen shot of the web manager
</I>&gt;&gt;<i> page, which shows a queue without any consumers but marked as active :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> HTTP/1.1 200 OK
</I>&gt;&gt;<i> Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
</I>&gt;&gt;<i> Date: Tue, 16 Apr 2013 09:54:44 GMT
</I>&gt;&gt;<i> Content-Type: application/json
</I>&gt;&gt;<i> Content-Length: 909
</I>&gt;&gt;<i> Cache-Control: no-cache
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {&quot;policy&quot;:&quot;&quot;,&quot;exclusive_consumer_tag&quot;:&quot;&quot;,&quot;messages_ready&quot;:0,&quot;messages_unacknowledged&quot;:0,&quot;messages&quot;:0,&quot;consumers&quot;:0,&quot;active_consumers&quot;:0,&quot;memory&quot;:44356,&quot;backing_queue_status&quot;:{&quot;q1&quot;:0,&quot;q2&quot;:0,&quot;delta&quot;&quot;delta&quot;,&quot;undefined&quot;,0,&quot;undefined&quot;],&quot;q3&quot;:0,&quot;q4&quot;:0,&quot;len&quot;:0,&quot;pending_acks&quot;:0,&quot;target_ram_count&quot;:&quot;infinity&quot;,&quot;ram_msg_count&quot;:0,&quot;ram_ack_count&quot;:0,&quot;next_seq_id&quot;:66,&quot;persistent_count&quot;:0,&quot;avg_ingress_rate&quot;:0.0,&quot;avg_egress_rate&quot;:0.0,&quot;avg_ack_ingress_rate&quot;:0.0,&quot;avg_ack_egress_rate&quot;:0.0},&quot;messages_details&quot;:{&quot;rate&quot;:0.0,&quot;interval&quot;:10001924,&quot;last_event&quot;:1366106079385},&quot;messages_ready_details&quot;:{&quot;rate&quot;:0.0,&quot;interval&quot;:10001924,&quot;last_event&quot;:1366106079385},&quot;messages_unacknowledged_details&quot;:{&quot;rate&quot;:0.0,&quot;interval&quot;:10001924,&quot;last_event&quot;:1366106079385},&quot;consumer_details&quot;],&quot;name&quot;:&quot;theQueue&quot;,&quot;vhost&quot;:&quot;myHost&quot;,&quot;durable&quot;:true,&quot;auto_delete&quot;:false,&quot;arguments&quot;:{},&quot;node&quot;:&quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at myServer</A>&quot;} 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does anybody ever had this kind of problem? We're using RabbitMQ 3.0.1,
</I>&gt;&gt;<i> with the java client.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026512.html">[rabbitmq-discuss] RabbitMQ manager and Idle queues
</A></li>
	<LI>Next message: <A HREF="026547.html">[rabbitmq-discuss] RabbitMQ Queues memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26513">[ date ]</a>
              <a href="thread.html#26513">[ thread ]</a>
              <a href="subject.html#26513">[ subject ]</a>
              <a href="author.html#26513">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
