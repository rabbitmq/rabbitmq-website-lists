<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Proposed change to shovel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Proposed%20change%20to%20shovel&In-Reply-To=%3C8E733FE2-8F92-46D2-B38D-065966001E6F%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026550.html">
   <LINK REL="Next"  HREF="026552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Proposed change to shovel</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Proposed%20change%20to%20shovel&In-Reply-To=%3C8E733FE2-8F92-46D2-B38D-065966001E6F%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Proposed change to shovel">tim at rabbitmq.com
       </A><BR>
    <I>Thu Apr 18 16:14:19 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026550.html">[rabbitmq-discuss] Proposed change to shovel
</A></li>
        <LI>Next message: <A HREF="026552.html">[rabbitmq-discuss] Proposed change to shovel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26551">[ date ]</a>
              <a href="thread.html#26551">[ thread ]</a>
              <a href="subject.html#26551">[ subject ]</a>
              <a href="author.html#26551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Fred,

So this looks reasonable enough to me, although it's not really 'failover' as such. Perhaps 'robust endpoint selection' is a better description. 

On 18 Apr 2013, at 16:04, Fred Dushin wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I would like to consider a change to the shovel plugin, to allow the shovel to failover more predictably against the list of broker endpoints in the rabbitmq_shovel configuration.  Essentially, the idea is to try each endpoint in order of the declaration, and to use the first endpoint to which a connection can be made, instead of selecting an endpoint at random.
</I>&gt;<i> 
</I>&gt;<i> This does slightly violate the spirit of Erlang's &quot;let it fail&quot; philosophy, and I am not sure if the random endpoint selection in the current code is really more designed for clustered environments.  Perhaps it would make more sense to make the iterative failover strategy an &quot;opt-in&quot; feature, if not simply for the sake of backwards-compatibility.
</I>
I'm not sure why random endpoint selection was previously selected. I'll do some hg archeology and try to figure that out at some point...

BTW have you see this: <A HREF="http://hg.rabbitmq.com/rabbitmq-shovel/rev/81231b905a3f">http://hg.rabbitmq.com/rabbitmq-shovel/rev/81231b905a3f</A> ?

That allows for proper 'failover' when shovels are used in a cluster, but also means that a named shovel can only run on one node at once. With that in place, a shovel worker can fail over (i.e., migrate) to another node if it's node crashes. The two things are clearly orthogonal, but it's worth being aware of.

&gt;<i> 
</I>&gt;<i> I am providing a patch, but not suggesting that this actual change go into production code, as I really did the change for testing purposes.  I'm really more interested in whether others would find the patch useful, and whether there would be a way for us to fold a feature like this into the shovel.  If there is interest, I would be happy to contribute something more production-worthy, for review.
</I>&gt;<i> 
</I>
If there is sufficient interest, then we could certainly consider a patch. Let's see how this plays out for now... 

Cheers,
Tim
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026550.html">[rabbitmq-discuss] Proposed change to shovel
</A></li>
	<LI>Next message: <A HREF="026552.html">[rabbitmq-discuss] Proposed change to shovel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26551">[ date ]</a>
              <a href="thread.html#26551">[ thread ]</a>
              <a href="subject.html#26551">[ subject ]</a>
              <a href="author.html#26551">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
