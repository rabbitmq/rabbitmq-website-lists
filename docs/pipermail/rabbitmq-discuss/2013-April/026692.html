<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] no next heap size found after crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20no%20next%20heap%20size%20found%20after%20crash&In-Reply-To=%3C5178CBB0.6010801%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026691.html">
   <LINK REL="Next"  HREF="026708.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] no next heap size found after crash</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20no%20next%20heap%20size%20found%20after%20crash&In-Reply-To=%3C5178CBB0.6010801%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] no next heap size found after crash">matthias at rabbitmq.com
       </A><BR>
    <I>Thu Apr 25 07:22:40 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026691.html">[rabbitmq-discuss] no next heap size found after crash
</A></li>
        <LI>Next message: <A HREF="026708.html">[rabbitmq-discuss] no next heap size found after crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26692">[ date ]</a>
              <a href="thread.html#26692">[ thread ]</a>
              <a href="subject.html#26692">[ subject ]</a>
              <a href="author.html#26692">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gilles,

On 25/04/13 07:04, Gilles Danycan wrote:
&gt;<i> Unfortunately i have a new problem now :(
</I>&gt;<i> i'm still on : RabbitMQ 3.0.4.40411, Erlang R14A
</I>&gt;<i> server: 1To disk , 48Go ram , bi xeon 16 cores
</I>&gt;<i>
</I>&gt;<i> the server just reboot without reason apparently but the rabbitmq is not
</I>&gt;<i> able to start after the reboot...
</I>&gt;<i> i have the message :
</I>&gt;<i>
</I>&gt;<i> Crash dump was written to: erl_crash.dump
</I>&gt;<i> no next heap size found: -2063447786, offset 0
</I>&gt;<i> or
</I>&gt;<i> Crash dump was written to: erl_crash.dump
</I>&gt;<i> eheap_alloc: Cannot allocate 18446744065900154288 bytes of memory (of
</I>&gt;<i> type &quot;heap&quot;).
</I>&gt;<i>
</I>&gt;<i> i tried to change the vm_memory_high_watermark in the config file but
</I>&gt;<i> the second message appears.
</I>
I suggest upgrading Erlang. To R16B if you can. That will certainly get 
rid of the negative number reported.

This has come up before - see 
<A HREF="http://rabbitmq.1065348.n5.nabble.com/Rabbit-won-t-restart-no-next-heap-size-found-td22195.html">http://rabbitmq.1065348.n5.nabble.com/Rabbit-won-t-restart-no-next-heap-size-found-td22195.html</A> 
- and at the time we also identified an issue we excessive memory usage 
on recovery after an unclean shutdown. That got fixed in 3.0.0 though.

So let's see whether an Erlang upgrade makes a difference. If not we can 
look at other options.

&gt;<i> unforutnatly the partition of the rabbit is :
</I>&gt;<i> /dev/sda2             910G  864G 1006M 100% /var
</I>&gt;<i>
</I>&gt;<i> i don't understand because we have only 5millions of messages in all
</I>&gt;<i> queues... the last night i deleted some messages (more than 1millions)
</I>&gt;<i> but the space disk available didn't change...
</I>&gt;<i> is there some problem with erlang or indexes? we consume and requeue
</I>&gt;<i> messages and when we don't requeue message the space disk used is still
</I>&gt;<i> the same.
</I>
Disk space is reclaimed by a garbage collector. That only kicks in when 
garbage exceeds 50% of the allocated space, so deleting 1m out of 5m 
messages won't be enough to trigger a gc.

Regards,

Matthias.
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026691.html">[rabbitmq-discuss] no next heap size found after crash
</A></li>
	<LI>Next message: <A HREF="026708.html">[rabbitmq-discuss] no next heap size found after crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26692">[ date ]</a>
              <a href="thread.html#26692">[ thread ]</a>
              <a href="subject.html#26692">[ subject ]</a>
              <a href="author.html#26692">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
