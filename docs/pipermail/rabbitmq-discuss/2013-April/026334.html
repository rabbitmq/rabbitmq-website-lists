<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] memory consumption during message delivery
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20memory%20consumption%20during%20message%20delivery&In-Reply-To=%3CF1A539826FC33E4CA602BB52E5C4502222B6F005%40FR44EX3004.global.ds.honeywell.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026333.html">
   <LINK REL="Next"  HREF="026335.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] memory consumption during message delivery</H1>
    <B>Cermak, Marek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20memory%20consumption%20during%20message%20delivery&In-Reply-To=%3CF1A539826FC33E4CA602BB52E5C4502222B6F005%40FR44EX3004.global.ds.honeywell.com%3E"
       TITLE="[rabbitmq-discuss] memory consumption during message delivery">Marek.Cermak at Honeywell.com
       </A><BR>
    <I>Wed Apr  3 13:16:22 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026333.html">[rabbitmq-discuss] rabbitmq management custom port
</A></li>
        <LI>Next message: <A HREF="026335.html">[rabbitmq-discuss] memory consumption during message delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26334">[ date ]</a>
              <a href="thread.html#26334">[ thread ]</a>
              <a href="subject.html#26334">[ subject ]</a>
              <a href="author.html#26334">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everybody,
I did some measurements of memory consumption of RMQ (v3.0.2) during sending and delivering messages and found an interesting behaviour during delivery. In short: messages were stored in mnesia transient storage on disk and when a consumer starts to consume them all of them were read to memory in one chunk which was almost deadly for RMQ and the server.

The scenario was 1+2+8+10 pairs of bound direct exchanges and queues each received messages of particular size (1kB, 64 kB, 1 MB and 8MB) and after a while consumer was started to 'empty' each of the queues. The consumer of the queue with biggest messages triggered the avalanche of data being transferred from disk to memory. Similar behaviour can be seen always when you fill the queue up to the roof with bigger messages and start the consumer. I've created the chart where you can see it clearly.

Tested with 1G of memory, 64b Debian GNU/linux, Erlang R15B, RMQ v3.0.2.

Is it an expected behaviour? Can it be somehow tuned/adjusted? Thanks.

Marek


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/73bf1903/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/73bf1903/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: combo_020.gif
Type: image/gif
Size: 29688 bytes
Desc: combo_020.gif
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/73bf1903/attachment.gif">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/73bf1903/attachment.gif</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026333.html">[rabbitmq-discuss] rabbitmq management custom port
</A></li>
	<LI>Next message: <A HREF="026335.html">[rabbitmq-discuss] memory consumption during message delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26334">[ date ]</a>
              <a href="thread.html#26334">[ thread ]</a>
              <a href="subject.html#26334">[ subject ]</a>
              <a href="author.html#26334">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
