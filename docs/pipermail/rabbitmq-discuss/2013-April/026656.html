<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20EXT%20%3ARe%3A%20%20Memory%20not%20flushing%20to%20disk&In-Reply-To=%3C51769DF5.1080501%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026653.html">
   <LINK REL="Next"  HREF="026659.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] EXT :Re:  Memory not flushing to disk</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20EXT%20%3ARe%3A%20%20Memory%20not%20flushing%20to%20disk&In-Reply-To=%3C51769DF5.1080501%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] EXT :Re:  Memory not flushing to disk">emile at rabbitmq.com
       </A><BR>
    <I>Tue Apr 23 15:43:01 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026653.html">[rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
</A></li>
        <LI>Next message: <A HREF="026659.html">[rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26656">[ date ]</a>
              <a href="thread.html#26656">[ thread ]</a>
              <a href="subject.html#26656">[ subject ]</a>
              <a href="author.html#26656">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Logan,

On 23/04/13 15:04, Rodrian, Logan P (IS) wrote:

&gt;<i> Attached (text file) is the output from when this happens.  My
</I>&gt;<i> previous snippets were from when this happens as well, I just didn't
</I>&gt;<i> include the entire report.
</I>&gt;<i> 
</I>&gt;<i> The issue is exactly as you stated--the memory alarm remains set
</I>&gt;<i> indefinitely while ram_msg_counts remain high.  This causes the
</I>&gt;<i> publisher to be unable to send anything further to the broker.
</I>

I think you simply have run out of memory. Queue processes only account
for 360Mb of the total 2.6Gb in use, which is not very much. The bulk of
the RAM is being used by the message index. Even when message bodies are
saved to disk, accounting information will amounts to about 170 bytes
per message which has to stay in RAM. In your case queue lengths total
over 14million and this per-message overhead is the dominating term.

It is not possible to queue an indefinite number of messages on a server
with a finite amount of RAM. The broker documentation should be clearer
about that limitation.

You may be able to relive the memory pressure by setting the vm memory
limit above 40% temporarily while disconnecting publishers:

&quot;rabbitmqctl set_vm_memory_high_watermark 0.5&quot; might be enough.

If you expect the broker to queue that many messages regularly then you
will need to provision more RAM, in line with the 170 byte overhead.






-Emile





</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026653.html">[rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
</A></li>
	<LI>Next message: <A HREF="026659.html">[rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26656">[ date ]</a>
              <a href="thread.html#26656">[ thread ]</a>
              <a href="subject.html#26656">[ subject ]</a>
              <a href="author.html#26656">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
