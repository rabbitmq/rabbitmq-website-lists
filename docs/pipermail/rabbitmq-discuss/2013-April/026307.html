<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ server connections close issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20server%20connections%20close%20issue&In-Reply-To=%3CCAHWt7w07Rtw5jvB-7tGspgTLwSG0eNWNTwWQPw-MscVrN3SQRg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026297.html">
   <LINK REL="Next"  HREF="026298.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ server connections close issue</H1>
    <B>Dmitry Saprykin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20server%20connections%20close%20issue&In-Reply-To=%3CCAHWt7w07Rtw5jvB-7tGspgTLwSG0eNWNTwWQPw-MscVrN3SQRg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ server connections close issue">saprykin.dmitry at gmail.com
       </A><BR>
    <I>Tue Apr  2 13:23:23 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026297.html">[rabbitmq-discuss] RabbitMQ server connections close issue
</A></li>
        <LI>Next message: <A HREF="026298.html">[rabbitmq-discuss] rabbitmq-java-messagepatterns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26307">[ date ]</a>
              <a href="thread.html#26307">[ thread ]</a>
              <a href="subject.html#26307">[ subject ]</a>
              <a href="author.html#26307">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you for reply,

Unfortunately our client library does not support heartbeats so it is being
disabled on connect.
But problem disappeared after we upgraded RabbitMQ to 3.0.4 AND changed
system tcp_keepalive_time to reasonable small value.

Now we have
$ cat /proc/sys/net/ipv4/tcp_keepalive_time
14
$ cat /proc/sys/net/ipv4/tcp_keepalive_intvl
14
$ cat /proc/sys/net/ipv4/tcp_keepalive_probes
4
 and everything is fine with connection counts.

Thank you


On 2 April 2013 13:56, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> On 29/03/13 08:45, Dmitry Saprykin wrote:
</I>&gt;<i> &gt; When everything goes bad  (rabbitmqctl list_connections | wc -l) twice
</I>&gt;<i> &gt; as much connections than (netstat -nt | wc -l)
</I>&gt;<i>
</I>&gt;<i> Does the logfile contain anything beyond the handshake time-out message?
</I>&gt;<i> Are there any entries from the time when the counts start to diverge?
</I>&gt;<i>
</I>&gt;<i> What state are the connections in when the failure occurs? Can you show
</I>&gt;<i> some representative output from &quot;rabbitmqctl list_connections&quot; during
</I>&gt;<i> the error?
</I>&gt;<i>
</I>&gt;<i> Have you tried using AMQP heartbeats instead of TCP keepalives?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/53a8bb98/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/53a8bb98/attachment.htm</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026297.html">[rabbitmq-discuss] RabbitMQ server connections close issue
</A></li>
	<LI>Next message: <A HREF="026298.html">[rabbitmq-discuss] rabbitmq-java-messagepatterns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26307">[ date ]</a>
              <a href="thread.html#26307">[ thread ]</a>
              <a href="subject.html#26307">[ subject ]</a>
              <a href="author.html#26307">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
