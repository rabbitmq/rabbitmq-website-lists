<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mechanism to Add Nodes to the Mirror Queue	actively
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mechanism%20to%20Add%20Nodes%20to%20the%20Mirror%20Queue%0A%09actively&In-Reply-To=%3CCAHNOpyQrjEoYHGRFikKc2w2_b_X0oRxe9JKPOTbP3zxssmgUcQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026470.html">
   <LINK REL="Next"  HREF="026414.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mechanism to Add Nodes to the Mirror Queue	actively</H1>
    <B>Lujin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mechanism%20to%20Add%20Nodes%20to%20the%20Mirror%20Queue%0A%09actively&In-Reply-To=%3CCAHNOpyQrjEoYHGRFikKc2w2_b_X0oRxe9JKPOTbP3zxssmgUcQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Mechanism to Add Nodes to the Mirror Queue	actively">clujin at gmail.com
       </A><BR>
    <I>Tue Apr  9 01:50:34 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026470.html">[rabbitmq-discuss] Federation Over SSL with Intermediate Certificate Authority
</A></li>
        <LI>Next message: <A HREF="026414.html">[rabbitmq-discuss] Mechanism to Add Nodes to the Mirror Queue actively
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26403">[ date ]</a>
              <a href="thread.html#26403">[ thread ]</a>
              <a href="subject.html#26403">[ subject ]</a>
              <a href="author.html#26403">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello RabbitMQ Devs,

In recent days, I've been experimenting with RabbitMQ's HA mechanism to get
messages mirrored to different nodes. I am concerned mainly with fail over
scenarios where the message would be lost if all the nodes for Queue X goes
down.

What I have observed is that as it is right now (3.0.0), the broker doesn't
actively find a node in the cluster to mirror the queue whenever a node
fails over.*

However, I have find a trick/bug/scheme I can employ to have a node added.

What I did was to have the following policies:
(In the scenario that I only want to mirror to 2 other nodes)

rabbitmqctl set_policy HA-1 &quot;^two\.&quot; '{&quot;ha-mode&quot;:&quot;exactly&quot;,&quot;ha-params&quot;:2}' 1

rabbitmqctl set_policy HA-2 &quot;^two\.&quot; '{&quot;ha-mode&quot;:&quot;exactly&quot;,&quot;ha-params&quot;:3}' 2

So from the beginning, upon creation,  a queue follows the HA-2 policy with
the highest priority which matched the &quot;pattern&quot;. If that policy is
deleted, it will either default to a lower priority policy or none. In this
case it wouldn't matter, because there's a fail over. However, I noticed
that if I add a 'new' policy right afterwards, the queue will retroactively
follow the new policy!

So what I do is, whenever a node fails over, I immediately delete the HA-2
policy and then immediately add the same HA-2 policy right back. This is
the only way that I know of that allows the queue to pick up a node from my
cluster for mirroring. (Without bringing the node back up) Yes, the new
node will be unsynchronized but with active synchronization, this is not a
big problem.

*So my question is: Are there other ways for a mirrored queue to actively
find node(s) in the cluster to mirror to without some intricate steps like
the ones above? Perhaps there's a plugin in the works or some new feature
in a upcoming version relaese?

I look forward to hearing what interesting plans you guys have in store for
RabbitMQ!

Regards,
Lujin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130408/b2654d48/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130408/b2654d48/attachment.htm</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026470.html">[rabbitmq-discuss] Federation Over SSL with Intermediate Certificate Authority
</A></li>
	<LI>Next message: <A HREF="026414.html">[rabbitmq-discuss] Mechanism to Add Nodes to the Mirror Queue actively
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26403">[ date ]</a>
              <a href="thread.html#26403">[ thread ]</a>
              <a href="subject.html#26403">[ subject ]</a>
              <a href="author.html#26403">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
