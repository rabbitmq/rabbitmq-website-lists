<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ with many queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20with%20many%20queues&In-Reply-To=%3CCAL8idP3xQuAU5Lr9zkRgncUgQfVKGnZETX%3D1PJnXXWhznTQh6w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026524.html">
   <LINK REL="Next"  HREF="026622.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ with many queues</H1>
    <B>Eric Berg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20with%20many%20queues&In-Reply-To=%3CCAL8idP3xQuAU5Lr9zkRgncUgQfVKGnZETX%3D1PJnXXWhznTQh6w%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ with many queues">ehberg at gmail.com
       </A><BR>
    <I>Thu Apr 18 14:23:24 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026524.html">[rabbitmq-discuss] RabbitMQ with many queues
</A></li>
        <LI>Next message: <A HREF="026622.html">[rabbitmq-discuss] RabbitMQ with many queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26549">[ date ]</a>
              <a href="thread.html#26549">[ thread ]</a>
              <a href="subject.html#26549">[ subject ]</a>
              <a href="author.html#26549">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the reply Emile. Right now we have a 4 node cluster with primary
and failover haproxy round robin load balancers, so dynamic generation of
queues tend to be pretty well distributed especially with a 2 node ha
policy. I guess it will just take some close monitoring to verify that the
resources are not being exhausted, though even adding new nodes to the
cluster would not help in that case correct? Since in a 4 node cluster with
a 2 node ha policy, only newly created queues would be replicated to the
new node? How do others handle situations like this?

- PHP -
On a related note, we have had some unfortunate experiences when testing a
few different php libraries and Rabbit kicks in its flow control. It looks
like that our producers using various php libs in an Apache setting dont
handle the flow control well, while the php connection dies Rabbit still
thinks they are active even though no producing is coming across, filling
up the file descriptors.

Thanks guys!




On Wed, Apr 17, 2013 at 11:23 AM, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Hi Eric,
</I>&gt;<i>
</I>&gt;<i> On 15/04/13 22:31, Eric Berg wrote:
</I>&gt;<i> &gt; I am curious about those of you who have run Rabbit clusters with
</I>&gt;<i> &gt; many thousands of queues
</I>&gt;<i>
</I>&gt;<i> I have only used that many queues under testing conditions, rather than
</I>&gt;<i> production.
</I>&gt;<i>
</I>&gt;<i> This is more relevant if you are using non-HA queues, but can be
</I>&gt;<i> relevant even for HA queues that are not mirrored to all nodes: make
</I>&gt;<i> sure you achieve a balanced load by not defining all queues on a single
</I>&gt;<i> node.
</I>&gt;<i>
</I>&gt;<i> Make sure you provision adequate resources. It is possible to declare an
</I>&gt;<i> enormous number of idle queues without difficulty, but the broker will
</I>&gt;<i> grind to a halt if many queues on an under-resourced node start
</I>&gt;<i> consuming CPU and RAM. Use realistic workloads to estimate the required
</I>&gt;<i> resources.
</I>&gt;<i>
</I>&gt;<i> Use a sensible naming scheme for queues so that you can easily manage a
</I>&gt;<i> subset. Consider binding queues via internal exchanges if that makes the
</I>&gt;<i> management of bindings easier.
</I>&gt;<i>
</I>&gt;<i> Don't perform &quot;rabbitmqctl list_queues&quot; in a tight loop for monitoring
</I>&gt;<i> as this will generate significant load and slow down the broker.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Please report back anything you learn from your experience that other
</I>&gt;<i> may benefit from.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/87c3cdea/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/87c3cdea/attachment.htm</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026524.html">[rabbitmq-discuss] RabbitMQ with many queues
</A></li>
	<LI>Next message: <A HREF="026622.html">[rabbitmq-discuss] RabbitMQ with many queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26549">[ date ]</a>
              <a href="thread.html#26549">[ thread ]</a>
              <a href="subject.html#26549">[ subject ]</a>
              <a href="author.html#26549">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
