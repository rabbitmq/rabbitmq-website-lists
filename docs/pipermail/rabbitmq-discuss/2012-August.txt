From pbell at syncsort.com  Wed Aug  1 04:10:50 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Tue, 31 Jul 2012 23:10:50 -0400
Subject: [rabbitmq-discuss] Two questions: max bindings and handling no
	consumer present
In-Reply-To: <4F42B29E.8060802@rabbitmq.com>
References: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com>
	<4F4282B1.8080109@rabbitmq.com> <21fbf71a-d0b1-4a60
	-98e3-e277ff4f00c4@t15g2000yqi.googlegroups.com>
	<4F42B29E.8060802@rabbitmq.com>
Message-ID: <43F987BC-39A1-41FD-8574-FFF32406C771@syncsort.com>

Hi All,

Is there a limit on the number of distinct bindings a consumer can establish when binding a queue to a topic exchange with a binding key?

It's my understanding, based on what I've learned here, that if a publisher publishes a message to an exchange and outbound from that exchange there is no binding, then the broker will simply discard the message. If there's no one listening (as it were) at the time of publication, then no one gets the message.

Around this phenomenon arises the question of somehow determining that there's an active consumer before publishing a message. The use case here is that these messages represent tasks that need to be run by the consumer. Perhaps these messages will be written by some kind of task scheduler. The point is that I don't want to publish the messages unless I know that a consumer is present and can act upon them.

I suppose this is where the "mandatory" flag comes in. But I'm wondering if there's a way to query  the broker about its infrastructure, e.g., the existence of a queue/binding that would indicate the presence of the consumer.

Thank you.

-Paul



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From roger.maillist at gmail.com  Wed Aug  1 04:52:40 2012
From: roger.maillist at gmail.com (luo roger)
Date: Wed, 1 Aug 2012 11:52:40 +0800
Subject: [rabbitmq-discuss] after enable management, rabbitMQ cant work
Message-ID: <CA+JXe07rh1bp4D+E5SzZg8U8tLRuE0vJAGEb8HE-3xWYtGgfoQ@mail.gmail.com>

debian 5.0
erlang version : 5.6.3
rabbitmq 2.8.4

whitout management, everything is ok,
after enable management, rabbitMQ cant start
in the console, after echo" broker running,"
echo "{"Kernel pid terminated............

in the startup_log:

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
Memory limit set to 3198MB of 7996MB total.

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
Disk free limit set to 953MB

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
Management agent started.

=ERROR REPORT==== 1-Aug-2012::10:49:28 ===
** Generic server rabbit_mochiweb_registry terminating
** Last message in was {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.886060>,
                            #Fun<rabbit_mochiweb.0.69727660>,
                            {[],"RabbitMQ Management"}}
** When Server state == undefined
** Reason for termination ==
** {{case_clause,
        {error,
            {{'EXIT',
                 {undef,
                     [{lists,keyfind,
                          [name,1,
                           [{loop,#Fun<mochiweb_http.0.65037361>},
                            {name,rabbit_mochiweb_web_mgmt},
                            {port,55672}]]},
                      {mochilists,is_defined,2},
                      {mochilists,set_default,2},
                      {lists,foldl,3},
                      {mochiweb_http,start,1},
                      {supervisor,do_start_child,2},
                      {supervisor,handle_start_child,2},
                      {supervisor,handle_call,3}]}},
             {child,undefined,
                 {rabbit_mochiweb_web,mgmt},
                 {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
                 transient,5000,worker,dynamic}}}},
    [{rabbit_mochiweb_sup,ensure_listener,1},
     {rabbit_mochiweb_registry,handle_call,3},
     {gen_server,handle_msg,5},
     {proc_lib,init_p,5}]}

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
    application: rabbitmq_management
    exited: {bad_return,
             {{rabbit_mgmt_app,start,[normal,[]]},
              {'EXIT',
               {{{case_clause,
                  {error,
                   {{'EXIT',
                     {undef,
                      [{lists,keyfind,
                        [name,1,
                         [{loop,#Fun<mochiweb_http.0.65037361>},
                          {name,rabbit_mochiweb_web_mgmt},
                          {port,55672}]]},
                       {mochilists,is_defined,2},
                       {mochilists,set_default,2},
                       {lists,foldl,3},
                       {mochiweb_http,start,1},
                       {supervisor,do_start_child,2},
                       {supervisor,handle_start_child,2},
                       {supervisor,handle_call,3}]}},
                    {child,undefined,
                     {rabbit_mochiweb_web,mgmt},
                     {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
                     transient,5000,worker,dynamic}}}},
                 [{rabbit_mochiweb_sup,ensure_listener,1},
                  {rabbit_mochiweb_registry,handle_call,3},
                  {gen_server,handle_msg,5},
                  {proc_lib,init_p,5}]},
                {gen_server,call,
                 [rabbit_mochiweb_registry,
                  {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.886060>,
                   #Fun<rabbit_mochiweb.0.69727660>,
                   {[],"RabbitMQ Management"}},
                  infinity]}}}}}
    type: permanent

=INFO REPORT==== 1-Aug-2012::10:49:28 ===
stopped TCP Listener on 0.0.0.0:5672

Is there somethin worng?

Thanks,
roger

From alexis at rabbitmq.com  Wed Aug  1 07:56:32 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 1 Aug 2012 07:56:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ in a WCF webservice,
	model usage and performance
In-Reply-To: <733e1dca-3306-4865-a342-1b3265045523@googlegroups.com>
References: <733e1dca-3306-4865-a342-1b3265045523@googlegroups.com>
Message-ID: <CACOPnvd3+MK4mrMMD6qT+KxoHg5M1Gqkd-C9WCqFF_-XYuQUWg@mail.gmail.com>

Noel

I see that folks have answered on SO..
http://stackoverflow.com/questions/11414019/rabbitmq-in-a-wcf-webservice-model-usage-and-performance

Does that suffice for now?

alexis

On Tue, Jul 31, 2012 at 12:55 PM, Bigtoe <noel.lysaght at gmail.com> wrote:
> Hi Folks, I have a query about performance and IModel usage in a .NET WCF
> service. I posted this question on Stackoverflow  and received no answers. I
> was hoping that maybe you had some suggestions. I can repost the full
> question here the link is not appropriate.
>
> Kind Regards
> Noel
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From watson.timothy at gmail.com  Wed Aug  1 08:23:45 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 1 Aug 2012 08:23:45 +0100
Subject: [rabbitmq-discuss] Two questions: max bindings and handling no
	consumer present
In-Reply-To: <43F987BC-39A1-41FD-8574-FFF32406C771@syncsort.com>
References: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com>
	<4F4282B1.8080109@rabbitmq.com> <21fbf71a-d0b1-4a60
	-98e3-e277ff4f00c4@t15g2000yqi.googlegroups.com>
	<4F42B29E.8060802@rabbitmq.com>
	<43F987BC-39A1-41FD-8574-FFF32406C771@syncsort.com>
Message-ID: <D0AE5493-654F-4C7D-BA9A-95D35BA2D248@rabbitmq.com>


On 1 Aug 2012, at 04:10, "Bell, Paul M." <pbell at syncsort.com> .
> 
> I suppose this is where the "mandatory" flag comes in. But I'm wondering if there's a way to query  the broker about its infrastructure, e.g., the existence of a queue/binding that would indicate the presence of the consumer.
> 

There are ways to query the infrastructure, but these rare generally not exposed to client APIs. What client are you using? 

> Thank you.
> 
> -Paul
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Wed Aug  1 08:28:45 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 1 Aug 2012 08:28:45 +0100
Subject: [rabbitmq-discuss] after enable management, rabbitMQ cant work
In-Reply-To: <CA+JXe07rh1bp4D+E5SzZg8U8tLRuE0vJAGEb8HE-3xWYtGgfoQ@mail.gmail.com>
References: <CA+JXe07rh1bp4D+E5SzZg8U8tLRuE0vJAGEb8HE-3xWYtGgfoQ@mail.gmail.com>
Message-ID: <A1596F13-5D36-4D77-8772-D1F391AD8ED6@rabbitmq.com>


On 1 Aug 2012, at 04:52, luo roger <roger.maillist at gmail.com> wrote:

> debian 5.0
> erlang version : 5.6.3

lists:keyfind/3 was added in OTP stdlib 1.6 iirc so it's probable that you need a later version of erlang. I also seem to remember this is documented for the plugin on the compatibility page of the website, though I'll check that once I get into the office.

> rabbitmq 2.8.4
> 
> whitout management, everything is ok,
> after enable management, rabbitMQ cant start
> in the console, after echo" broker running,"
> echo "{"Kernel pid terminated............
> 
> in the startup_log:
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> Limiting to approx 924 file handles (829 sockets)
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> Memory limit set to 3198MB of 7996MB total.
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> Disk free limit set to 953MB
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> Management plugin upgraded statistics to fine.
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> started TCP Listener on 0.0.0.0:5672
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> Management agent started.
> 
> =ERROR REPORT==== 1-Aug-2012::10:49:28 ===
> ** Generic server rabbit_mochiweb_registry terminating
> ** Last message in was {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.886060>,
>                            #Fun<rabbit_mochiweb.0.69727660>,
>                            {[],"RabbitMQ Management"}}
> ** When Server state == undefined
> ** Reason for termination ==
> ** {{case_clause,
>        {error,
>            {{'EXIT',
>                 {undef,
>                     [{lists,keyfind,
>                          [name,1,
>                           [{loop,#Fun<mochiweb_http.0.65037361>},
>                            {name,rabbit_mochiweb_web_mgmt},
>                            {port,55672}]]},
>                      {mochilists,is_defined,2},
>                      {mochilists,set_default,2},
>                      {lists,foldl,3},
>                      {mochiweb_http,start,1},
>                      {supervisor,do_start_child,2},
>                      {supervisor,handle_start_child,2},
>                      {supervisor,handle_call,3}]}},
>             {child,undefined,
>                 {rabbit_mochiweb_web,mgmt},
>                 {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
>                 transient,5000,worker,dynamic}}}},
>    [{rabbit_mochiweb_sup,ensure_listener,1},
>     {rabbit_mochiweb_registry,handle_call,3},
>     {gen_server,handle_msg,5},
>     {proc_lib,init_p,5}]}
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
>    application: rabbitmq_management
>    exited: {bad_return,
>             {{rabbit_mgmt_app,start,[normal,[]]},
>              {'EXIT',
>               {{{case_clause,
>                  {error,
>                   {{'EXIT',
>                     {undef,
>                      [{lists,keyfind,
>                        [name,1,
>                         [{loop,#Fun<mochiweb_http.0.65037361>},
>                          {name,rabbit_mochiweb_web_mgmt},
>                          {port,55672}]]},
>                       {mochilists,is_defined,2},
>                       {mochilists,set_default,2},
>                       {lists,foldl,3},
>                       {mochiweb_http,start,1},
>                       {supervisor,do_start_child,2},
>                       {supervisor,handle_start_child,2},
>                       {supervisor,handle_call,3}]}},
>                    {child,undefined,
>                     {rabbit_mochiweb_web,mgmt},
>                     {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
>                     transient,5000,worker,dynamic}}}},
>                 [{rabbit_mochiweb_sup,ensure_listener,1},
>                  {rabbit_mochiweb_registry,handle_call,3},
>                  {gen_server,handle_msg,5},
>                  {proc_lib,init_p,5}]},
>                {gen_server,call,
>                 [rabbit_mochiweb_registry,
>                  {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.886060>,
>                   #Fun<rabbit_mochiweb.0.69727660>,
>                   {[],"RabbitMQ Management"}},
>                  infinity]}}}}}
>    type: permanent
> 
> =INFO REPORT==== 1-Aug-2012::10:49:28 ===
> stopped TCP Listener on 0.0.0.0:5672
> 
> Is there somethin worng?
> 
> Thanks,
> roger
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From francesco at rabbitmq.com  Wed Aug  1 08:31:14 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 01 Aug 2012 08:31:14 +0100
Subject: [rabbitmq-discuss] after enable management, rabbitMQ cant work
In-Reply-To: <CA+JXe07rh1bp4D+E5SzZg8U8tLRuE0vJAGEb8HE-3xWYtGgfoQ@mail.gmail.com>
References: <CA+JXe07rh1bp4D+E5SzZg8U8tLRuE0vJAGEb8HE-3xWYtGgfoQ@mail.gmail.com>
Message-ID: <87r4rr5arh.wl%francesco@rabbitmq.com>

At Wed, 1 Aug 2012 11:52:40 +0800,
luo roger wrote:
> 
> debian 5.0
> erlang version : 5.6.3
> rabbitmq 2.8.4
> 
> whitout management, everything is ok,
> after enable management, rabbitMQ cant start
> in the console, after echo" broker running,"
> echo "{"Kernel pid terminated............
> 
> in the startup_log:
> [...]

What version of Erlang do you have?  `lists:keyfind/3' was introduced in R13A.
The minimum version required to run the management plugin is R13B01, see
http://www.rabbitmq.com/which-erlang.html .

--
Francesco * Often in error, never in doubt

From brendan at soundcloud.com  Wed Aug  1 08:47:41 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 1 Aug 2012 09:47:41 +0200
Subject: [rabbitmq-discuss] Management API Send/Receive Event Measurements
Message-ID: <CAHZsVQb2516YoX0=JtrdpH0RJ11kcnFjRUb=LHN-Y-k2qVMztA@mail.gmail.com>

Hola bandidas/bandidos,

In the /api/connections/<name> endpoint, I'd (previously/naively) presumed
that recv_oct_details.last_event and send_oct_details.last_event
would correlate to some sort of activity on the connection in general ..
including underlying channels - although this appears to not be the case,
example:

   - Connection:
   https://gist.github.com/23455d60bea127bca57c#file_connection.json
   - Channel: https://gist.github.com/23455d60bea127bca57c#file_channel.json

In the above example, the connection shows *.last_event timestamps as when
the connection was established / handshake occurred,
and the channel shows current and consistent throughput + updated events.

Q's:
- Intended behaviour?
- Is there any way to determine if a connection is idle from just the data
available in the /api/connections endpoint?


Cheers,
Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/038a45e4/attachment.htm>

From francesco at rabbitmq.com  Wed Aug  1 09:07:18 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 01 Aug 2012 09:07:18 +0100
Subject: [rabbitmq-discuss] Disallow clients without heartbeat
In-Reply-To: <CAAqmy6Pkg7uPYnKjm38-_cDMf6g2zgdCyKEJe9vbMHtgj-ijuw@mail.gmail.com>
References: <CAAqmy6Pkg7uPYnKjm38-_cDMf6g2zgdCyKEJe9vbMHtgj-ijuw@mail.gmail.com>
Message-ID: <87obmv593d.wl%francesco@rabbitmq.com>

At Tue, 31 Jul 2012 17:23:45 -0400,
Dave Curylo wrote:
> I would like all my clients to specify a heartbeat so the server will
> disconnect them automatically if they become unresponsive.?Is there any way on
> the message broker to require that clients set a heartbeat, and disallow
> connections from clients that don't?

No, you can't.  You might be able to hack something up with a plugin.  The code
that accepts the `tune_ok' frames and sets up the heartbeats is in
`rabbit_reader.erl'.

--
Francesco * Often in error, never in doubt

From matthias at rabbitmq.com  Wed Aug  1 09:08:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 09:08:56 +0100
Subject: [rabbitmq-discuss] Two questions: max bindings and handling no
 consumer present
In-Reply-To: <D0AE5493-654F-4C7D-BA9A-95D35BA2D248@rabbitmq.com>
References: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com>
	<4F4282B1.8080109@rabbitmq.com> <21fbf71a-d0b1-4a60
	-98e3-e277ff4f00c4@t15g2000yqi.googlegroups.com>
	<4F42B29E.8060802@rabbitmq.com>
	<43F987BC-39A1-41FD-8574-FFF32406C771@syncsort.com>
	<D0AE5493-654F-4C7D-BA9A-95D35BA2D248@rabbitmq.com>
Message-ID: <5018E418.8090306@rabbitmq.com>

On 01/08/12 08:23, Tim Watson wrote:
>
> On 1 Aug 2012, at 04:10, "Bell, Paul M." <pbell at syncsort.com> .
>>
>> I suppose this is where the "mandatory" flag comes in. But I'm
>> wondering if there's a way to query  the broker about its
>> infrastructure, e.g., the existence of a queue/binding that would
>> indicate the presence of the consumer.
>>
>
> There are ways to query the infrastructure, but these rare generally
> not exposed to client APIs. What client are you using?

Moreover, performing such a "does a consumer exists?" query before 
publishing is racy, since the consumer might well vanish between the 
query and the publishing event.

What are you actually trying to accomplish? Is the idea that in the 
absence of consumers the producer would hang on to the message and retry 
later? In that case you may want to consider alternative routing 
topologies. E.g. perhaps the consumer queues could be declared ahead of 
time. Or you could use an alternate exchange to route messages to 
holding queue where they are then picked up from consumers when they 
join. Or you could do something even more sophisticated and configure 
said holding queue with a message-ttl and set the original exchange as 
the dead-letter exchange of the queue - that way messages will be 
retried periodically automatically.

Matthias.

From matthias at rabbitmq.com  Wed Aug  1 09:18:30 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 09:18:30 +0100
Subject: [rabbitmq-discuss] Disallow clients without heartbeat
In-Reply-To: <87obmv593d.wl%francesco@rabbitmq.com>
References: <CAAqmy6Pkg7uPYnKjm38-_cDMf6g2zgdCyKEJe9vbMHtgj-ijuw@mail.gmail.com>
	<87obmv593d.wl%francesco@rabbitmq.com>
Message-ID: <5018E656.6060503@rabbitmq.com>

Dave,

On 01/08/12 09:07, Francesco Mazzoli wrote:
> At Tue, 31 Jul 2012 17:23:45 -0400,
> Dave Curylo wrote:
>> I would like all my clients to specify a heartbeat so the server
>> will disconnect them automatically if they become unresponsive. Is
>> there  any way on
>> the message broker to require that clients set a heartbeat, and
>> disallow connections from clients that don't?
 >
> No, you can't.  You might be able to hack something up with a plugin.
> The code that accepts the `tune_ok' frames and sets up the heartbeats
> is in `rabbit_reader.erl'.

As an aside, we are planning to let a server admin set a default 
heartbeat interval in the config. Most clients will just accept that 
but, as per the AMQP spec, they are under no obligation to do so.

Matthias.

From brendan at soundcloud.com  Wed Aug  1 09:34:49 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 1 Aug 2012 10:34:49 +0200
Subject: [rabbitmq-discuss] Management API Send/Receive Event
	Measurements
In-Reply-To: <CAHZsVQb2516YoX0=JtrdpH0RJ11kcnFjRUb=LHN-Y-k2qVMztA@mail.gmail.com>
References: <CAHZsVQb2516YoX0=JtrdpH0RJ11kcnFjRUb=LHN-Y-k2qVMztA@mail.gmail.com>
Message-ID: <CAHZsVQbsA8ytEFFnvFot9qdTOGqjaO4Cn=A30JY+y0F24uqNAA@mail.gmail.com>

Just to follow up .. the example I posted is using no-ack .. I noticed
other connection/channel combos that are using ack/prefetch=N update the
connection events in tandem?

On Wed, Aug 1, 2012 at 9:47 AM, Brendan Hay <brendan at soundcloud.com> wrote:

> Hola bandidas/bandidos,
>
> In the /api/connections/<name> endpoint, I'd (previously/naively) presumed
> that recv_oct_details.last_event and send_oct_details.last_event
> would correlate to some sort of activity on the connection in general ..
> including underlying channels - although this appears to not be the case,
> example:
>
>    - Connection:
>    https://gist.github.com/23455d60bea127bca57c#file_connection.json
>    - Channel:
>    https://gist.github.com/23455d60bea127bca57c#file_channel.json
>
> In the above example, the connection shows *.last_event timestamps as when
> the connection was established / handshake occurred,
> and the channel shows current and consistent throughput + updated events.
>
> Q's:
> - Intended behaviour?
> - Is there any way to determine if a connection is idle from just the data
> available in the /api/connections endpoint?
>
>
> Cheers,
> Brendan
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/1b710b58/attachment.htm>

From matthias at rabbitmq.com  Wed Aug  1 09:46:43 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 09:46:43 +0100
Subject: [rabbitmq-discuss] Management API Send/Receive Event
	Measurements
In-Reply-To: <CAHZsVQbsA8ytEFFnvFot9qdTOGqjaO4Cn=A30JY+y0F24uqNAA@mail.gmail.com>
References: <CAHZsVQb2516YoX0=JtrdpH0RJ11kcnFjRUb=LHN-Y-k2qVMztA@mail.gmail.com>
	<CAHZsVQbsA8ytEFFnvFot9qdTOGqjaO4Cn=A30JY+y0F24uqNAA@mail.gmail.com>
Message-ID: <5018ECF3.3020309@rabbitmq.com>

Brendan,

On 01/08/12 09:34, Brendan Hay wrote:
> Just to follow up .. the example I posted is using no-ack .. I noticed
> other connection/channel combos that are using ack/prefetch=N update the
> connection events in tandem?

Management stats for connections only get updated while those 
connections are *receiving* data. I have filed a bug.

Matthias.

From brendan at soundcloud.com  Wed Aug  1 09:58:38 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 1 Aug 2012 10:58:38 +0200
Subject: [rabbitmq-discuss] Management API Send/Receive Event
	Measurements
In-Reply-To: <5018ECF3.3020309@rabbitmq.com>
References: <CAHZsVQb2516YoX0=JtrdpH0RJ11kcnFjRUb=LHN-Y-k2qVMztA@mail.gmail.com>
	<CAHZsVQbsA8ytEFFnvFot9qdTOGqjaO4Cn=A30JY+y0F24uqNAA@mail.gmail.com>
	<5018ECF3.3020309@rabbitmq.com>
Message-ID: <CAHZsVQa_KkEGJnZA7Pa52JqC=gorEzmcH8__riQHRkhVUB3=6A@mail.gmail.com>

Vielen Dank, Matthias!

On Wed, Aug 1, 2012 at 10:46 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Brendan,
>
>
> On 01/08/12 09:34, Brendan Hay wrote:
>
>> Just to follow up .. the example I posted is using no-ack .. I noticed
>> other connection/channel combos that are using ack/prefetch=N update the
>> connection events in tandem?
>>
>
> Management stats for connections only get updated while those connections
> are *receiving* data. I have filed a bug.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/d0ba3869/attachment.htm>

From matthias at rabbitmq.com  Wed Aug  1 10:01:02 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 10:01:02 +0100
Subject: [rabbitmq-discuss] Management API Send/Receive Event
	Measurements
In-Reply-To: <CAHZsVQa_KkEGJnZA7Pa52JqC=gorEzmcH8__riQHRkhVUB3=6A@mail.gmail.com>
References: <CAHZsVQb2516YoX0=JtrdpH0RJ11kcnFjRUb=LHN-Y-k2qVMztA@mail.gmail.com>
	<CAHZsVQbsA8ytEFFnvFot9qdTOGqjaO4Cn=A30JY+y0F24uqNAA@mail.gmail.com>
	<5018ECF3.3020309@rabbitmq.com>
	<CAHZsVQa_KkEGJnZA7Pa52JqC=gorEzmcH8__riQHRkhVUB3=6A@mail.gmail.com>
Message-ID: <5018F04E.5000105@rabbitmq.com>

On 01/08/12 09:58, Brendan Hay wrote:
> Vielen Dank, Matthias!
>
> On Wed, Aug 1, 2012 at 10:46 AM, Matthias Radestock
> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>     Management stats for connections only get updated while those
>     connections are *receiving* data. I have filed a bug.

It turns out we've had a bug filed for this since 2010. I don't recall 
anybody ever running into this - I guess most people use acks or 
heartbeats or have producers on the same connection.

Matthias.


From emile at rabbitmq.com  Wed Aug  1 10:09:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 01 Aug 2012 10:09:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ in a WCF webservice,
 model usage and performance
In-Reply-To: <733e1dca-3306-4865-a342-1b3265045523@googlegroups.com>
References: <733e1dca-3306-4865-a342-1b3265045523@googlegroups.com>
Message-ID: <5018F231.6010605@rabbitmq.com>

Hi,

On 31/07/12 12:55, Bigtoe wrote:
> Hi Folks, I have a query about performance and IModel usage in a .NET

> "IModel should not be shared between threads"

Though not recommended, an IModel can be shared. You would need to
synchronise access to it, because you risk framing errors if you
interleave access. All threads will need to be aware of channel-scoped
state (e.g. whether transactions or publisher confirms are in use).

> in RabbitMQ an IModel is actually a socket connection

Many IModel instances may share a connection.

> using a connection pool of IModels between threads.

Pooling is not normally used, because an IModel is cheap to establish.



-Emile



From brendan at soundcloud.com  Wed Aug  1 10:05:08 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 1 Aug 2012 11:05:08 +0200
Subject: [rabbitmq-discuss] Management API Send/Receive Event
	Measurements
In-Reply-To: <5018F04E.5000105@rabbitmq.com>
References: <CAHZsVQb2516YoX0=JtrdpH0RJ11kcnFjRUb=LHN-Y-k2qVMztA@mail.gmail.com>
	<CAHZsVQbsA8ytEFFnvFot9qdTOGqjaO4Cn=A30JY+y0F24uqNAA@mail.gmail.com>
	<5018ECF3.3020309@rabbitmq.com>
	<CAHZsVQa_KkEGJnZA7Pa52JqC=gorEzmcH8__riQHRkhVUB3=6A@mail.gmail.com>
	<5018F04E.5000105@rabbitmq.com>
Message-ID: <CAHZsVQa0dHKCvvDt82nq_8xR89a6AdcHxjVH4cWtfbeEMRucQw@mail.gmail.com>

I'm sure it's getting old by now but: +1 for public access to the bug
tracker =)

On Wed, Aug 1, 2012 at 11:01 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 01/08/12 09:58, Brendan Hay wrote:
>
>> Vielen Dank, Matthias!
>>
>> On Wed, Aug 1, 2012 at 10:46 AM, Matthias Radestock
>> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>**> wrote:
>>     Management stats for connections only get updated while those
>>     connections are *receiving* data. I have filed a bug.
>>
>
> It turns out we've had a bug filed for this since 2010. I don't recall
> anybody ever running into this - I guess most people use acks or heartbeats
> or have producers on the same connection.
>
> Matthias.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/978d9d12/attachment.htm>

From matthias at rabbitmq.com  Wed Aug  1 10:07:39 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 10:07:39 +0100
Subject: [rabbitmq-discuss] Management API Send/Receive Event
	Measurements
In-Reply-To: <CAHZsVQa0dHKCvvDt82nq_8xR89a6AdcHxjVH4cWtfbeEMRucQw@mail.gmail.com>
References: <CAHZsVQb2516YoX0=JtrdpH0RJ11kcnFjRUb=LHN-Y-k2qVMztA@mail.gmail.com>
	<CAHZsVQbsA8ytEFFnvFot9qdTOGqjaO4Cn=A30JY+y0F24uqNAA@mail.gmail.com>
	<5018ECF3.3020309@rabbitmq.com>
	<CAHZsVQa_KkEGJnZA7Pa52JqC=gorEzmcH8__riQHRkhVUB3=6A@mail.gmail.com>
	<5018F04E.5000105@rabbitmq.com>
	<CAHZsVQa0dHKCvvDt82nq_8xR89a6AdcHxjVH4cWtfbeEMRucQw@mail.gmail.com>
Message-ID: <5018F1DB.5010004@rabbitmq.com>

On 01/08/12 10:05, Brendan Hay wrote:
> I'm sure it's getting old by now but: +1 for public access to the bug
> tracker =)

We've have a bug filed that since February 2007 :)

Matthias.

From noel.lysaght at gmail.com  Wed Aug  1 10:40:22 2012
From: noel.lysaght at gmail.com (Bigtoe)
Date: Wed, 1 Aug 2012 02:40:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ in a WCF webservice,
 model usage and performance
In-Reply-To: <CACOPnvd3+MK4mrMMD6qT+KxoHg5M1Gqkd-C9WCqFF_-XYuQUWg@mail.gmail.com>
References: <733e1dca-3306-4865-a342-1b3265045523@googlegroups.com>
	<CACOPnvd3+MK4mrMMD6qT+KxoHg5M1Gqkd-C9WCqFF_-XYuQUWg@mail.gmail.com>
Message-ID: <26c6e677-35b6-4156-9766-88ca41753e96@googlegroups.com>

Thanks Alexis, that does indeed suffice. I've also recently just found the 
that there is a "RabbitMQ in Action" book which I have just ordered also, 
hopefully that will give me more of the technical details and understanding 
of how it all works. It's a funny old world; I waited a couple of weeks 
before posting here and then I get a couple of answers that morning on SO.


Kind Regards
Noel

On Wednesday, August 1, 2012 7:56:32 AM UTC+1, Alexis Richardson wrote:
>
> Noel 
>
> I see that folks have answered on SO.. 
>
> http://stackoverflow.com/questions/11414019/rabbitmq-in-a-wcf-webservice-model-usage-and-performance 
>
> Does that suffice for now? 
>
> alexis 
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/81d02666/attachment.htm>

From emile at rabbitmq.com  Wed Aug  1 11:07:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 01 Aug 2012 11:07:02 +0100
Subject: [rabbitmq-discuss] basicPublish() Hangs on the Upstream Node in
 a Federation
In-Reply-To: <SNT127-W189232D7C87742955A45C6D5C50@phx.gbl>
References: <SNT127-W15555B836D172E6F1F0C49D5C20@phx.gbl>,
	<50166944.1050900@rabbitmq.com>
	<SNT127-W189232D7C87742955A45C6D5C50@phx.gbl>
Message-ID: <5018FFC6.5020009@rabbitmq.com>

Hi,

On 31/07/12 23:49, Chris Judkins-Fisher wrote:
> I can see the appropriate exchange and queue when list_exchanges or
> list_queues. Also, this exact code works on rabbit1, and also on my own
> computer.

A possible reason for a publish operation hanging is that a memory or
disk free space alarm has triggered. Is there anything in the broker
logfile about either alarm? The solution to this problem is to change
the threshold or provide more resource.


-Emile



From emile at rabbitmq.com  Wed Aug  1 11:28:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 01 Aug 2012 11:28:11 +0100
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <017701cd6e51$1c5dd450$55197cf0$@saseco.dk>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
	<5011401A.7070000@rabbitmq.com>
	<00c501cd6b2f$bcceb230$366c1690$@saseco.dk>
	<501143CD.3030505@rabbitmq.com>
	<017701cd6e51$1c5dd450$55197cf0$@saseco.dk>
Message-ID: <501904BB.9050201@rabbitmq.com>

Hi Bernhard,

On 30/07/12 13:44, Bernhard Mogens Ege wrote:
> I have now looked at the SendMap example and replicated its function in my
> own program, but I still receive header fields as Byte[].
> 
> How do I make RabbitMQ decode my header fields to the correct type?

The combination of the SendMap.exe and SingleGet.exe examples show how
arbitrary types of header can be sent and received, and that AMQP types
are mapped to .net types. In particular look at
DumpUtil.DumpProperties() which illustrate how to recognise different types.

If you are still only seeing byte arrays then make sure you aren't
implicitly casting to that type somewhere.


-Emile



From bme at saseco.dk  Wed Aug  1 12:07:19 2012
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Wed, 1 Aug 2012 13:07:19 +0200
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <501904BB.9050201@rabbitmq.com>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
	<5011401A.7070000@rabbitmq.com>
	<00c501cd6b2f$bcceb230$366c1690$@saseco.dk>
	<501143CD.3030505@rabbitmq.com>
	<017701cd6e51$1c5dd450$55197cf0$@saseco.dk>
	<501904BB.9050201@rabbitmq.com>
Message-ID: <023001cd6fd5$d4cb68b0$7e623a10$@saseco.dk>

I have looked at SingleGet, but I don't think I understand AMQP messages at
all if BasicGet return just 1 object which can be string, int, etc. How is
the header of the message accessed?

Anyway, I am not using BasicGet, but EventingBasicConsumer (callback)
provided to BasicConsume. My callback method gets the BsicDeliverEventArgs
where I can access BasicComsumer and through that, the Headers, where I
extract, using my key, the Value I seek. But GetType() always says the value
is of type System.Byte[].

I have a method like this (I'll make it use string,object instead of
string,string eventually):

        public void sendMessage(string routingKey, Dictionary<string,string>
headers, byte[] payload)
        {
            lock (channel)
            {
                IMapMessageBuilder b = new MapMessageBuilder(channel);
                foreach (var header in headers)
                {
                    b.Headers[header.Key] = header.Value;
                }
                channel.BasicPublish(ExchangeName, routingKey, false, true,
(IBasicProperties)b.GetContentHeader(), payload);
            }
        }

And could be call like this:

sendMessage("myroutingkey", new Dictionary<string, string> { { "languageid",
"1" } }, null);

And when received in the callback, printed like this:

Console.Write("type of languageid: " +
e.BasicProperties.Headers["languageid"].GetType());

And it prints: System.Byte[]

I must have missed something somewhere. :-/

I appreciate the help. :)

-- 
Bernhard

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 1. august 2012 12:28
To: bme at saseco.dk
Cc: 'Discussions about RabbitMQ'
Subject: Re: [rabbitmq-discuss] Decoding header fields

Hi Bernhard,

On 30/07/12 13:44, Bernhard Mogens Ege wrote:
> I have now looked at the SendMap example and replicated its function 
> in my own program, but I still receive header fields as Byte[].
> 
> How do I make RabbitMQ decode my header fields to the correct type?

The combination of the SendMap.exe and SingleGet.exe examples show how
arbitrary types of header can be sent and received, and that AMQP types are
mapped to .net types. In particular look at
DumpUtil.DumpProperties() which illustrate how to recognise different types.

If you are still only seeing byte arrays then make sure you aren't
implicitly casting to that type somewhere.


-Emile



From wsmith at tacc.utexas.edu  Wed Aug  1 14:39:47 2012
From: wsmith at tacc.utexas.edu (Warren Smith)
Date: Wed, 1 Aug 2012 13:39:47 +0000
Subject: [rabbitmq-discuss] error loading some CA certificates
Message-ID: <4B5D885B77E8CC43852B8F0315AD03BA1AC30EC6@EXMBX01.austin.utexas.edu>


I'm getting errors when I try to use some CA certificates with RabbitMQ 2.8.4 and Erlang R15B01. The message in the var/log/rabbit/rabbit at HOST.log file is:

SSL WARNING: Ignoring a CA cert as it could not be correctly decoded.

And then I get quite long error messages after this warning in the log file when the client is connecting using a certificate from one of the ignored CAs. The relevant part of the error message seems to be:

** Reason for termination =
** {{badmatch,
        {error,
            {asn1,
                {{case_clause,22},
                 [{'OTP-PUB-KEY',check_and_convert_restricted_string,5,
                      [{file,"OTP-PUB-KEY.erl"},{line,14128}]},
                  {'OTP-PUB-KEY',decode,2,
                      [{file,"OTP-PUB-KEY.erl"},{line,499}]},
                  {pubkey_cert_records,transform,2,
                      [{file,"pubkey_cert_records.erl"},{line,60}]},
                  {lists,map,2,[{file,"lists.erl"},{line,1173}]},
                  {pubkey_cert_records,transform,2,
                      [{file,"pubkey_cert_records.erl"},{line,72}]},
                  {pubkey_cert_records,decode_tbs,1,
                      [{file,"pubkey_cert_records.erl"},{line,189}]},
                  {pubkey_cert_records,decode_cert,1,
                      [{file,"pubkey_cert_records.erl"},{line,40}]},
                  {public_key,pkix_decode_cert,2,
                      [{file,"public_key.erl"},{line,211}]}]}}}},
    [{public_key,pkix_decode_cert,2,[{file,"public_key.erl"},{line,215}]},
     {ssl_certificate,trusted_cert_and_path,3,
         [{file,"ssl_certificate.erl"},{line,58}]},
     {ssl_handshake,certify,7,[{file,"ssl_handshake.erl"},{line,216}]},
     {ssl_connection,certify,2,[{file,"ssl_connection.erl"},{line,514}]},
     {ssl_connection,next_state,4,[{file,"ssl_connection.erl"},{line,1929}]},
     {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
     {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}


These are CA certificates that work fine with OpenSSL and I believe they work fine in Java, too. Example certificates that get ignored are the Root and Classic ones from http://www.tacc.utexas.edu/CA/.
 
The above error seems to indicate that the cause is in the code/asn.1 specs that erlang is using to decode certificates. Before I dig more into the erlang code and take this to the erlang list, I thought I'd record this problem on the RabbitMQ list and see if anyone here has any thoughts or a fix.

Thanks,


Warren



From francesco at rabbitmq.com  Wed Aug  1 14:55:58 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 01 Aug 2012 14:55:58 +0100
Subject: [rabbitmq-discuss] error loading some CA certificates
In-Reply-To: <4B5D885B77E8CC43852B8F0315AD03BA1AC30EC6@EXMBX01.austin.utexas.edu>
References: <4B5D885B77E8CC43852B8F0315AD03BA1AC30EC6@EXMBX01.austin.utexas.edu>
Message-ID: <87obmuaf81.wl%francesco@rabbitmq.com>

Hi Warren,
At Wed, 1 Aug 2012 13:39:47 +0000,
Warren Smith wrote:
> 
> 
> I'm getting errors when I try to use some CA certificates with RabbitMQ 2.8.4
> and Erlang R15B01. The message in the var/log/rabbit/rabbit at HOST.log file is:
> 
> SSL WARNING: Ignoring a CA cert as it could not be correctly decoded.
> 
> And then I get quite long error messages after this warning in the log file
> when the client is connecting using a certificate from one of the ignored
> CAs. The relevant part of the error message seems to be:
> 
> [...]
> 
> These are CA certificates that work fine with OpenSSL and I believe they work
> fine in Java, too. Example certificates that get ignored are the Root and
> Classic ones from http://www.tacc.utexas.edu/CA/.
>  
> The above error seems to indicate that the cause is in the code/asn.1 specs
> that erlang is using to decode certificates. Before I dig more into the erlang
> code and take this to the erlang list, I thought I'd record this problem on
> the RabbitMQ list and see if anyone here has any thoughts or a fix.

Yes, the warning message is generated by the ssl library (see the `add_certs/3'
function in `lib/ssl/src/ssl_certificate_db.erl') and the second message is due
to the fact that adding the certificate failed.

I did a quick search in the bug tracker and I don't think we've seen this
before.  As you say, this looks like an OTP issue, so moving the discussion to
`erlang-discuss' would probably be useful.

--
Francesco * Often in error, never in doubt

From monish.unni at gmail.com  Wed Aug  1 17:00:00 2012
From: monish.unni at gmail.com (cogitate)
Date: Wed, 1 Aug 2012 09:00:00 -0700 (PDT)
Subject: [rabbitmq-discuss] dead-letter-exchange behaviour
Message-ID: <1343836800368-21167.post@n5.nabble.com>

hi mathias:

i am trying to get dead-letter-exchange work.. 
 steps below: 
[0] s2.direct is an exchange that declares a dead-letter-exchange(DLE)
called s2.dlx ( rabbitmq ) 
[1] setup DLE consumer -  declares a DLQ (pyDlxQueue) binds to DLE(s2.dlx) 
[2] setup a consumer listening to queue (EchoPayMe) binds to
s2.direct(exchange) 
    queue EchoPayMe setup with arguments x-message-ttl=10 and DLE=s2.dlx 
    the consumer also sleeps for 100 seconds ( to simulate
long-running/hanging service) 
    the idea is a producer puts 10 messages in it's queue will only have
message 1 served, 
    the rest of the messages should go to DLE(s2.dlx) when the DLE consumer
replies. 
[3] the producer - publish messages to s2.direct exchange w/ rk="EchoPayMe" 

the problem is no messages are received by the DLQ or get routed to the DLE
consumer. 
the code for the DLE consumer, App consumer and App Producer in python/pika
below. 

i am sure there's a fundamental error in what i am doing, cause, i can get
it working (somewhat) with java 
code (the x-message-ttl = 10 doesn't really hold the messages for 10 ms only
before returning, so i am somewhat puzzled by that, but at least the DLE
consumer gets the message) 

regards, 
-monish 


-- DLE Consumer-- 
connection = pika.BlockingConnection(pika.ConnectionParameters( 
        host='localhost')) 

channel = connection.channel() 

result = channel.queue_declare(queue='pyDlxQueue') 
queue_name = result.method.queue 
channel.queue_bind(exchange='s2.dlx', 
                   queue=queue_name) 
                   #routing_key='pyDlxQueue') 

def on_request(ch, method, props, body): 
    print " [x] pyDLX Got %r " % (body,) 
    response = "ERROR FROM pyDLX" 

    ch.basic_publish(exchange='', 
                     routing_key=props.reply_to, 
                     properties=pika.BasicProperties(correlation_id = \ 
                                                     props.correlation_id), 
                     body=str(response)) 
    ch.basic_ack(delivery_tag = method.delivery_tag) 

channel.basic_consume(on_request, queue='pyDlxQueue',no_ack=False) 

print " [x] pyDLX consumer started " 
channel.start_consuming() 

--  Consumer --- 
connection = pika.BlockingConnection(pika.ConnectionParameters( 
        host='localhost')) 
channel = connection.channel() 
result =
channel.queue_declare(queue='EchoPayMe',exclusive=False,auto_delete=True,durable=False,arguments={'x-dead-letter-exchange':'s2.dlx','x-message-ttl':10}) 

queue_name = result.method.queue 
channel.queue_bind(exchange='s2.direct', 
                   queue=queue_name, 
                   routing_key='EchoPayMe') 

def on_request(ch, method, props, body): 
    sleep_time = 100 
    print " [x] Got %r with corr_id=%r \n ======Sleeping for %s seconds
=============" % (body,props.correlation_id,sleep_time) 
    time.sleep(sleep_time) 
    response = "Got "+ body 
    print "[x] Returning response %r" %(response,) 

    ch.basic_publish(exchange='', 
                     routing_key=props.reply_to, 
                     properties=pika.BasicProperties(correlation_id = \ 
                                                     props.correlation_id), 
                     body=str(response)) 
    ch.basic_ack(delivery_tag = method.delivery_tag) 

#channel.basic_qos(prefetch_count=1) 
channel.basic_consume(on_request, queue='EchoPayMe') 

print " [x] Awaiting service requests" 
channel.start_consuming() 


-- Producer -- 
class EchoClient(object): 
    def __init__(self): 
        self.connection = pika.BlockingConnection(pika.ConnectionParameters( 
                host='localhost')) 
        self.channel = self.connection.channel() 

    def call(self, request): 
        self.response = None 
        self.corr_id = str(uuid.uuid4()) 
        self.channel.basic_publish(exchange='s2.direct', 
                                   routing_key='EchoPayMe', 
                                   properties=pika.BasicProperties( 
                                   correlation_id=self.corr_id,), 
                                   body=request) 

echoClient = EchoClient() 
total_count = 10 
for i in xrange(total_count): 
    print " [x] Calling echoService %d"%(i,) 
    request=str(i) 
    echoClient.call(request) 




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/dead-letter-exchange-behaviour-tp21167.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From squall1386 at hotmail.com  Wed Aug  1 17:43:16 2012
From: squall1386 at hotmail.com (Chris Judkins-Fisher)
Date: Wed, 1 Aug 2012 11:43:16 -0500
Subject: [rabbitmq-discuss] basicPublish() Hangs on the Upstream Node in
 a Federation
In-Reply-To: <5018FFC6.5020009@rabbitmq.com>
References: <SNT127-W15555B836D172E6F1F0C49D5C20@phx.gbl>,
	<50166944.1050900@rabbitmq.com>
	<SNT127-W189232D7C87742955A45C6D5C50@phx.gbl>,
	<5018FFC6.5020009@rabbitmq.com>
Message-ID: <SNT127-W2050CA02F751BF320FB536D5C40@phx.gbl>


The problem was a disk space alarm. Thanks for your help! 

> Date: Wed, 1 Aug 2012 11:07:02 +0100
> From: emile at rabbitmq.com
> To: squall1386 at hotmail.com
> CC: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] basicPublish() Hangs on the Upstream Node in a Federation
> 
> Hi,
> 
> On 31/07/12 23:49, Chris Judkins-Fisher wrote:
> > I can see the appropriate exchange and queue when list_exchanges or
> > list_queues. Also, this exact code works on rabbit1, and also on my own
> > computer.
> 
> A possible reason for a publish operation hanging is that a memory or
> disk free space alarm has triggered. Is there anything in the broker
> logfile about either alarm? The solution to this problem is to change
> the threshold or provide more resource.
> 
> 
> -Emile
> 
> 
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/230ff4d7/attachment.htm>

From roger.maillist at gmail.com  Wed Aug  1 18:14:38 2012
From: roger.maillist at gmail.com (luo roger)
Date: Thu, 2 Aug 2012 01:14:38 +0800
Subject: [rabbitmq-discuss] after enable management, rabbitMQ cant work
Message-ID: <CA+JXe05FFJD0kO_2cp_4Q-jWNMj7+XX=0m2GjuRAyJyxeDp68w@mail.gmail.com>

>> erlang version : 5.6.3
>lists:keyfind/3 was added in OTP stdlib 1.6 iirc so it's probable that you need a later version of erlang. I also seem to remember this is documented for the plugin on the compatibility page of the website, though I'll check that once I get into the office.

>What version of Erlang do you have?  `lists:keyfind/3' was introduced in R13A.The minimum version required to run the management plugin is R13B01, see http://www.rabbitmq.com/which-erlang.html .


I think you are right, the erlang vesrion must be too low. I will
upgrade to the last version of erlang on debian 5.0.

thank everyone

From dbrown at prmllc.com  Wed Aug  1 18:20:44 2012
From: dbrown at prmllc.com (David Brown)
Date: Wed, 1 Aug 2012 12:20:44 -0500
Subject: [rabbitmq-discuss] Mnesia corrupting after node joining cluster
References: <CAFDmHdMLD1F1hsOtUi4zvEVQatXaU=jUzSR_4KohQ=X70MvW2g@mail.gmail.com>
	<4F96E330.3060902@rabbitmq.com>
Message-ID: <C9A9D46BD1CE455E9DF136DB4308D59D@lakehp165>

Hi Francesco,

has there been any work on this issue (i.e. errors when doing admin work on 
a cluster)?  I've got a tiny, two node development cluster.  Removing the 
ram node caused the remaining (disc) node to fail on startup with a mnesia 
related error when I restarted it.  Eventually, the remaining (disc) node 
started up, but it still thinks the other node is clustered with it.  I've 
tried everything to try and get this node to realize it is the only node 
left in the cluster, nothing works.  FWIW the removed node does realize it 
is no longer part of the two node cluster.

I was very careful in terms of following the exact steps in the 'Breaking up 
a cluster' section on the rabbitmq web site.  At this point, I'm a bit 
concerned about basing our production systems around rabbitmq (we're a small 
hedge fund) when it seems to fail on the simplest of tasks.  The only thing 
I can think of to solve this problem would be to reinstall rabbitmq on all 
nodes in the cluster (similar to what Eli had to do) which is from a 
production point of view unacceptible.

Well any help/insight woudl be greatly appreciated

Thanks in advance
David

----- Original Message ----- 
From: "Francesco Mazzoli" <francesco at rabbitmq.com>
To: <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Tuesday, April 24, 2012 12:30 PM
Subject: Re: [rabbitmq-discuss] Mnesia corrupting after node joining cluster


> Hi Eli,
>
>> That left the new node thinking it was not a member of the
>> cluster, but the existing cluster still thought it was a RAM node.
>
> Uhm, if you mean that the cluster still thought that the reseted node was 
> still part of the cluster, than that is weird and shouldn't happen. Can 
> you reproduce this?
>
> If you force_reseted the node, than that behavior is to be expected.
>
>> We figured we could try taking down each node in the existing cluster
>> one at a time, reseting it, and having it rejoin the cluster, hoping
>> that it would clear whatever issue it had.  So long as we kept at least
>> one disk node in the existing cluster our state should be maintained
>> (mines any non-HA queues and messages in them).  Apparently we choose
>> the wrong node.  When we tried to have it rejoin the remaining node in
>> the existing cluster it failed.  It seems Mnesia on the remaining node
>> was corrupted somehow.
>
> If the cluster doesn't know that the other node left (which seems to be 
> the case here) than it will try to sync its tables with the node it thinks 
> is still in the cluster. However since the other node has been reset its 
> tables will have different cookies and Mnesia will blow up. Posting the 
> specific error would help in confirming that this was the problem.
>
>> Can we please have a command that allows you to remove a node from a
>> cluster from a node other than the node you a trying to remove? Bring
>> back up a node just to remove it from the cluster is time consuming and
>> potentially error prone.
>
> This is definitely a feature we're planning to implement. In general we 
> want to make clustering more user friendly, and part of the work will be 
> more clustering rabbitmqctl commands ("join_cluster", "depart_cluster", 
> etc.).
>
>> Can we please have some tools that will analyze Mnesia on each node and
>> give us an idea of its health?  Whether its corrupted or somehow out of
>> sync with other nodes in the cluster.
>
> If I understood correctly in this case the problem wasn't corrupted Mnesia 
> tables, but the cluster not being aware of which nodes were part of the 
> cluster. What's definitely needed is better error reporting when this kind 
> of things happen, since right now the Mnesia error are particularly ugly. 
> Again, we're working on that.
>
> Francesco.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MnesiaCore.zip
Type: application/x-zip-compressed
Size: 20702 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/caa18fc0/attachment.bin>

From matthias at rabbitmq.com  Wed Aug  1 18:46:25 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 18:46:25 +0100
Subject: [rabbitmq-discuss] Mnesia corrupting after node joining cluster
In-Reply-To: <C9A9D46BD1CE455E9DF136DB4308D59D@lakehp165>
References: <CAFDmHdMLD1F1hsOtUi4zvEVQatXaU=jUzSR_4KohQ=X70MvW2g@mail.gmail.com>
	<4F96E330.3060902@rabbitmq.com>
	<C9A9D46BD1CE455E9DF136DB4308D59D@lakehp165>
Message-ID: <50196B71.1010009@rabbitmq.com>

David,

On 01/08/12 18:20, David Brown wrote:
> has there been any work on this issue (i.e. errors when doing admin work
> on a cluster)?

yes, but it will likely be a few months before these changes make it 
into a release.

> I've got a tiny, two node development cluster.  Removing
> the ram node caused the remaining (disc) node to fail on startup with a
> mnesia related error when I restarted it.  Eventually, the remaining
> (disc) node started up, but it still thinks the other node is clustered
> with it.  I've tried everything to try and get this node to realize it
> is the only node left in the cluster, nothing works.  FWIW the removed
> node does realize it is no longer part of the two node cluster.
>
> I was very careful in terms of following the exact steps in the
> 'Breaking up a cluster' section on the rabbitmq web site.

Hmm. It certainly looks like the disk node still thinks it is clustered 
with the ram node, and consequently it will fail to merge its schema 
with it when starting. That really shouldn't happen if you indeed 
followed the documented steps when breaking up the cluster, in 
particular the disk node was up and running when removing the ram node.

If you can reproduce the problem then please post a transcript of the 
commands.

> At this point, I'm a bit concerned about basing our production
> systems around rabbitmq (we're a small hedge fund) when it seems to
> fail on the simplest of tasks.

Clustering is hardly the "simplest of tasks" - sending and receiving 
messages is ;)

The clustering code hasn't changed much in 4+ years. It is stable but 
suffers from little mistakes resulting in situations that are hard to 
recover from - that's what Francesco is addressing.

I suggest you conduct some more experiments and keep transcripts of 
everything you are doing. Then, if you do encounter a weird situation it 
will be much easier to reproduce and diagnose the problem.

Also, are you sure you actually *need* clustering? It does, by 
necessity, add a significant amount of complexity and possible failure 
modes, so only use it if you have to.

Regards,

Matthias.

From dbrown at prmllc.com  Wed Aug  1 19:15:42 2012
From: dbrown at prmllc.com (David Brown)
Date: Wed, 1 Aug 2012 13:15:42 -0500
Subject: [rabbitmq-discuss] Mnesia corrupting after node joining cluster
Message-ID: <87CC0207EBEE49D487AC6DF33F0F628B@lakehp165>


 Hi Matthias,

 thanks for the quick answers.

> Also, are you sure you actually *need* clustering? It does, by necessity, 
> add a significant amount of complexity and possible failure modes, so only 
> use it if you have to.

 To implement distributed messaging, my understanding is I've got three
 options, cluster, federation, shovel.  In my case I've got a simple office
 network with 16 machines.  The apps that
 run on the machines need to see all the messages that get published, so I
 have a simple fanout exchange.  Each app instantiates it's own distinct, 
non
 persistant queue.  So a cluster seemed to be the simplest choice, in that
 there is just a single fanout exchange and a simple transient queue for 
each
 app.

 Is there any non clustered way to enable distribuited messaging in a single
 location (other than Federation and the Shovel)?

 Thanks much
David




> ----- Original Message ----- 
> From: "Matthias Radestock" <matthias at rabbitmq.com>
> To: "David Brown" <dbrown at prmllc.com>; "Discussions about RabbitMQ" 
> <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Wednesday, August 01, 2012 12:46 PM
> Subject: Re: [rabbitmq-discuss] Mnesia corrupting after node joining 
> cluster
>
>
>> David,
>>
>> On 01/08/12 18:20, David Brown wrote:
>>> has there been any work on this issue (i.e. errors when doing admin work
>>> on a cluster)?
>>
>> yes, but it will likely be a few months before these changes make it into 
>> a release.
>>
>>> I've got a tiny, two node development cluster.  Removing
>>> the ram node caused the remaining (disc) node to fail on startup with a
>>> mnesia related error when I restarted it.  Eventually, the remaining
>>> (disc) node started up, but it still thinks the other node is clustered
>>> with it.  I've tried everything to try and get this node to realize it
>>> is the only node left in the cluster, nothing works.  FWIW the removed
>>> node does realize it is no longer part of the two node cluster.
>>>
>>> I was very careful in terms of following the exact steps in the
>>> 'Breaking up a cluster' section on the rabbitmq web site.
>>
>> Hmm. It certainly looks like the disk node still thinks it is clustered 
>> with the ram node, and consequently it will fail to merge its schema with 
>> it when starting. That really shouldn't happen if you indeed followed the 
>> documented steps when breaking up the cluster, in particular the disk 
>> node was up and running when removing the ram node.
>>
>> If you can reproduce the problem then please post a transcript of the 
>> commands.
>>
>>> At this point, I'm a bit concerned about basing our production
>>> systems around rabbitmq (we're a small hedge fund) when it seems to
>>> fail on the simplest of tasks.
>>
>> Clustering is hardly the "simplest of tasks" - sending and receiving 
>> messages is ;)
>>
>> The clustering code hasn't changed much in 4+ years. It is stable but 
>> suffers from little mistakes resulting in situations that are hard to 
>> recover from - that's what Francesco is addressing.
>>
>> I suggest you conduct some more experiments and keep transcripts of 
>> everything you are doing. Then, if you do encounter a weird situation it 
>> will be much easier to reproduce and diagnose the problem.
>>
>> Also, are you sure you actually *need* clustering? It does, by necessity, 
>> add a significant amount of complexity and possible failure modes, so 
>> only use it if you have to.
>>
>> Regards,
>>
>> Matthias.
>>
>>
> 


From kristen.stewart at stonybrook.edu  Wed Aug  1 19:45:03 2012
From: kristen.stewart at stonybrook.edu (Kristen Stewart)
Date: Wed, 1 Aug 2012 14:45:03 -0400
Subject: [rabbitmq-discuss] Using ldap when connecting to management plugin
Message-ID: <CAB_hqn9se7Ho9fJ+_TxYR6Dp=pZxQyv94+jpaC7GVDVyDwRHDw@mail.gmail.com>

I am trying to authenticate users signing in to the management plugin using
Ldap.  I am running RabbitMQ 2.8.4 as a service on Windows 7 64 bit. Currently
my config file looks like this:

[{listeners, [{mgmt, [{port, 55672}]}]},
> {default_listener, [{port, 55670}]},
> {contexts, [{rabbit_mgmt, mgmt}]},
> {log_levels, [{connection, info}]},
> {rabbit, [{auth_backends, [rabbit_auth_backend_internal,
> rabbit_auth_backend_ldap]}]},
> {
> rabbitmq_auth_backend_ldap,
> [
> {servers,["my-server"]},
> {user_dn_pattern, "CN=${username},OU=Users,DC=mydomain,DC=com"},
> {tag_queries, [{administrator, {constant, true}}]},
> {resource_access_query, {constant, true}},
> {vhost_access_query, {constant, true}},
> {use_ssl,false},
> {port,389},
> {log,true}
> ]
> }].


This does allow the users who authenticate using ldap to sign in to the
management UI, but whenever I try to edit, create, or delete queues and
exchanges, it returns an error. I have tried similar operations using the
cli tool and it gives the same error, but I can get it to list exchanges
and queues. Logging in with the default local user "guest" works and the
user can edit everything.

I am wondering if I am missing something in the config file to give users
who authenticate with ldap write and configure access or if there is some
other error happening.

This is the error returned from the management UI:

{error,
    {exit,
        {{{case_clause,
              {badrpc,
                  {'EXIT',
                      {as_user_no_password,
                          {gen_server,call,
                              [rabbit_auth_backend_ldap,
                               {login,<<"knstewart">>},
                               infinity]}}}}},
          [{amqp_direct_connection,connect,4,[]},
           {amqp_gen_connection,handle_call,3,[]},
           {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,588}]},
           {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]},
         {gen_server,call,[<0.21766.0>,connect,infinity]}},
        [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
         {rabbit_mgmt_util,with_channel,5,[]},
         {rabbit_mgmt_util,with_decode,5,[]},
         {rabbit_mgmt_wm_exchange_publish,process_post,2,[]},
         {webmachine_resource,resource_call,3,[]},
         {webmachine_resource,do,3,[]},
         {webmachine_decision_core,resource_call,1,[]},
         {webmachine_decision_core,decision,1,[]}]}}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/aeed1202/attachment.htm>

From matthias at rabbitmq.com  Wed Aug  1 20:23:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 20:23:37 +0100
Subject: [rabbitmq-discuss] Mnesia corrupting after node joining cluster
In-Reply-To: <87CC0207EBEE49D487AC6DF33F0F628B@lakehp165>
References: <87CC0207EBEE49D487AC6DF33F0F628B@lakehp165>
Message-ID: <50198239.6030204@rabbitmq.com>

David,

On 01/08/12 19:15, David Brown wrote:
> To implement distributed messaging, my understanding is I've got three
> options, cluster, federation, shovel.

I guess the title of http://www.rabbitmq.com/distributed.html might have 
given you the impression that to get a message flowing from an app on 
one machine to an app on another machine you'd need brokers on both 
machines and connect them with clustering, federation, or shovel.

That is not the case.

AMQP is inherently distributed - it is a network protocol, so it's quite 
typical to have a single broker to which apps connect from wherever they 
are running. Apps and brokers do *not* have to reside on the same 
machine (and, typically don't).


Regards,

Matthias.

From dbrown at prmllc.com  Wed Aug  1 21:20:36 2012
From: dbrown at prmllc.com (David Brown)
Date: Wed, 1 Aug 2012 15:20:36 -0500
Subject: [rabbitmq-discuss] Mnesia corrupting after node joining cluster
References: <87CC0207EBEE49D487AC6DF33F0F628B@lakehp165>
	<50198239.6030204@rabbitmq.com>
Message-ID: <D5CB59A6667E471D8A0529BF92FCBCDD@lakehp165>

Matthias,

thanks so much for your info on this.  I assumed from the start that I 
didn't need to cluster, but I never ran across any documentation that 
referred to using a single broker, the '...distributed.html' was misleading 
and the 'RabbitMQ In Action' book never pointed this out.

I'm developing using the .Net client in C#, this is my method to connect to 
rabbit:


   public bool connectToRabbitMQ()

    {

        bool r = true;

        try

        {

            var connectionFactory = new ConnectionFactory();

            connectionFactory.HostName = mServer;

            mConnection = connectionFactory.CreateConnection();

            mModel = mConnection.CreateModel();

            mModel.BasicQos(0, 1, false);

            mExchanges = new List<string>();

        }

        catch (BrokerUnreachableException e)

        {

            r = false;

        }



        return r;

    }



So all I need to do is have the variable mServer contain the name of the 
Host that is running the RabbitMQ broker, right?



Thanks again



David







----- Original Message ----- 
From: "Matthias Radestock" <matthias at rabbitmq.com>
To: "David Brown" <dbrown at prmllc.com>; "Discussions about RabbitMQ" 
<rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, August 01, 2012 2:23 PM
Subject: Re: [rabbitmq-discuss] Mnesia corrupting after node joining cluster


> David,
>
> On 01/08/12 19:15, David Brown wrote:
>> To implement distributed messaging, my understanding is I've got three
>> options, cluster, federation, shovel.
>
> I guess the title of http://www.rabbitmq.com/distributed.html might have 
> given you the impression that to get a message flowing from an app on one 
> machine to an app on another machine you'd need brokers on both machines 
> and connect them with clustering, federation, or shovel.
>
> That is not the case.
>
> AMQP is inherently distributed - it is a network protocol, so it's quite 
> typical to have a single broker to which apps connect from wherever they 
> are running. Apps and brokers do *not* have to reside on the same machine 
> (and, typically don't).
>
>
> Regards,
>
> Matthias.
>
> 


From matthias at rabbitmq.com  Wed Aug  1 22:44:52 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 22:44:52 +0100
Subject: [rabbitmq-discuss] Mnesia corrupting after node joining cluster
In-Reply-To: <D5CB59A6667E471D8A0529BF92FCBCDD@lakehp165>
References: <87CC0207EBEE49D487AC6DF33F0F628B@lakehp165>
	<50198239.6030204@rabbitmq.com>
	<D5CB59A6667E471D8A0529BF92FCBCDD@lakehp165>
Message-ID: <5019A354.4070907@rabbitmq.com>

David,

On 01/08/12 21:20, David Brown wrote:
> thanks so much for your info on this.  I assumed from the start that I
> didn't need to cluster, but I never ran across any documentation that
> referred to using a single broker, the '...distributed.html' was
> misleading and the 'RabbitMQ In Action' book never pointed this out.

I'll see whether we can be clearer about this on the web site. As for 
RiA, Alvaro (cc'ed) may want to comment.

> So all I need to do is have the variable mServer contain the name of the
> Host that is running the RabbitMQ broker, right?

Yep.

Matthias.

From matthias at rabbitmq.com  Wed Aug  1 23:44:10 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 23:44:10 +0100
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <4665d2e3-f27d-4890-b4fb-7099f3f1a4c1@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
	<4665d2e3-f27d-4890-b4fb-7099f3f1a4c1@googlegroups.com>
Message-ID: <5019B13A.5080305@rabbitmq.com>

Mark,

On 31/07/12 17:54, Mark Ward wrote:
> I also find that I am getting a crash report

I have filed a bug report with the Erlang folks - see 
http://erlang.org/pipermail/erlang-bugs/2012-August/002980.html.

I am pretty sure that process crash is harmless in the sense that it 
happens in a code path where the connection is being torn down anyway, 
ostensibly due to there being no certificate.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Aug  1 23:47:54 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Aug 2012 23:47:54 +0100
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <f7728ce5-c6ae-44ee-9fd1-a884cfe46cc8@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
	<f7728ce5-c6ae-44ee-9fd1-a884cfe46cc8@googlegroups.com>
Message-ID: <5019B21A.3010507@rabbitmq.com>

Mark,

On 31/07/12 14:24, Mark Ward wrote:
> I have my server's configuration set to false for the
> fail_if_no_peer_cert setting.

You should also try setting {verify,verify_none}.

And, as Emile suggested, you may want to experiment with stunnel.

> A side note not all posts seem to make it into the google group but I
> find the posts either in email or in nabble.com

We have no control over the google group, unfortunately.

Matthias.

From matthias at rabbitmq.com  Thu Aug  2 00:03:11 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Aug 2012 00:03:11 +0100
Subject: [rabbitmq-discuss] dead-letter-exchange behaviour
In-Reply-To: <1343836800368-21167.post@n5.nabble.com>
References: <1343836800368-21167.post@n5.nabble.com>
Message-ID: <5019B5AF.1090303@rabbitmq.com>

Monish,

On 01/08/12 17:00, cogitate wrote:
> i am trying to get dead-letter-exchange work..
>   steps below:
> [0] s2.direct is an exchange that declares a dead-letter-exchange(DLE)
> called s2.dlx ( rabbitmq )
> [1] setup DLE consumer -  declares a DLQ (pyDlxQueue) binds to DLE(s2.dlx)
> [2] setup a consumer listening to queue (EchoPayMe) binds to
> s2.direct(exchange)
>      queue EchoPayMe setup with arguments x-message-ttl=10 and DLE=s2.dlx
>      the consumer also sleeps for 100 seconds ( to simulate
> long-running/hanging service)
>      the idea is a producer puts 10 messages in it's queue will only have
> message 1 served,
>      the rest of the messages should go to DLE(s2.dlx) when the DLE consumer
> replies.
> [3] the producer - publish messages to s2.direct exchange w/ rk="EchoPayMe"
>
> the problem is no messages are received by the DLQ or get routed to the DLE
> consumer.
> the code for the DLE consumer, App consumer and App Producer in python/pika
> below.

ok.

> i am sure there's a fundamental error in what i am doing

yep.

> --  Consumer ---
> [...]
> #channel.basic_qos(prefetch_count=1)

Try uncommenting that. Without a prefetch set, the broker will happily 
send all messages straight to the consumer as soon as they enter the 
queue, as explained in the "Fair dispatch" section of 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html. If the 
client is busy then he messages will be buffered in the network / the 
client, but as far as the broker is concerned they have been delivered 
straight away and so won't be expired & dead-lettered.

Regards,

Matthias.

From mikeb at rabbitmq.com  Thu Aug  2 00:08:42 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 02 Aug 2012 00:08:42 +0100
Subject: [rabbitmq-discuss] Rabbit.js and x-ha-policy
In-Reply-To: <fbcc81d0-5160-4e33-8a83-7bfceb6efa50@googlegroups.com>
References: <fbcc81d0-5160-4e33-8a83-7bfceb6efa50@googlegroups.com>
Message-ID: <5019B6FA.60309@rabbitmq.com>

Hi, Arnaud,

> I'm wondering how to set arguments to a queue in rabbit.js.
>
> I'want to use this option: {'arguments': {'x-ha-policy': 'all'}
>
> //rabbitMq connection ready
> context.on('ready', function () {
>      var pubStatSub = context.socket('PUSH');
>      pubStatSub.connect('statsub_queue');
>
> });
>
> Is that possible?
> Do I have to switch to an other library like node-amqp? (if it's possible)

Currently yes, you'd have to switch to node-amqp for that. It's not 
/that/ painful, just a bit more complicated than rabbit.js.

My feeling about HA policy is that it ought to be policy, rather than an 
ad-hoc setting. Maybe that's changed in RabbitMQ now, I guess I could 
ask. In any case, my inclination is that in rabbit.js it would be an 
argument given in the context, to be applied to all PUSH/PULL and 
REQ/REP queues. What do you think? Want to submit a pull request?

-Michael (squaremo)

From matthias at rabbitmq.com  Thu Aug  2 00:12:16 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Aug 2012 00:12:16 +0100
Subject: [rabbitmq-discuss] Rabbit.js and x-ha-policy
In-Reply-To: <5019B6FA.60309@rabbitmq.com>
References: <fbcc81d0-5160-4e33-8a83-7bfceb6efa50@googlegroups.com>
	<5019B6FA.60309@rabbitmq.com>
Message-ID: <5019B7D0.7010100@rabbitmq.com>

On 02/08/12 00:08, Michael Bridgen wrote:
> My feeling about HA policy is that it ought to be policy, rather than an
> ad-hoc setting. Maybe that's changed in RabbitMQ now, I guess I could
> ask.

We are planning to change this in the not too distant future.

Matthias.

From Bin.Chen at kla-tencor.com  Thu Aug  2 04:15:50 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Wed, 1 Aug 2012 20:15:50 -0700
Subject: [rabbitmq-discuss] vm_memory_high_watermark of RabbitMQ
Message-ID: <BCC407A444557E41B0D8B0260D684992053AE43B@CA1EXCLV07.adcorp.kla-tencor.com>

Hi All,

 

I have a question on the setting "vm_memory_high_watermark" of RabbitMQ.

 

Be default, "vm_memory_high_watermark" is set to 800 MB.

Based on the document, this means the fraction is 0.4.

My system is Windows 2008 Server 64-bit. It has 24 GB ram installed.

When I ran "rabbitmqctl status", I got a different fraction for
"vm_memory_high_watermark".

It is much smaller than 0.4, and it seems equal to 800 MB / 24 GB. 

However when I tried to use "rabbitmqctl set_vm_memory_high_watermark",
I have to use 0.4 in order to get 800 MB VM.

This is inconsistent.

 

I notice that the erl.exe has /LARGEADDRESSAWARE flag ON. 

This means the Erlang VM can use up to 4 GB ram instead of 2 GB on a
64-bit Windows.

It is safe to raise vm_memory_high_watermark to 1.6 GB in this case?

 

 

Thanks,

--Bin Chen

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120801/a976a678/attachment.htm>

From bhamidipatimadhav at gmail.com  Wed Aug  1 19:15:06 2012
From: bhamidipatimadhav at gmail.com (Madhav)
Date: Wed, 1 Aug 2012 11:15:06 -0700 (PDT)
Subject: [rabbitmq-discuss] OSGi and RabbitMQ Service layer
Message-ID: <1343844906660-21172.post@n5.nabble.com>

Hi All,

RabbitMQ claims that is OSGi Ready, where can I find the list of services
offered by the serivce layer?
Any examples which are using service layer APIs is highly appreciated.


Thanks & regards.
MaBh.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/OSGi-and-RabbitMQ-Service-layer-tp21172.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From toby.riley at rekoop.com  Thu Aug  2 12:05:30 2012
From: toby.riley at rekoop.com (Toby Riley)
Date: Thu, 2 Aug 2012 12:05:30 +0100
Subject: [rabbitmq-discuss] Acknowledging messages using the
	EventingBasicConsumer
Message-ID: <84B3D44AADE2D843994ED89240B2DFA2FCC38954@mailbox1b.gmsuk.net>

Hi,

I have a question I could not find a proper answer to anywhere, and it is to do with the Acknowledging messages using the  EventingBasicConsumer, I?m using ??_channel.BasicAck(e.DeliveryTag, false); but there is one for o.Model. BasicAck(e.DeliveryTag, false) but the sender object (o) is null.
?
What is the proper way to Acknowledge message from the Received event when using the EventingBasicConsumer when you inside the delegate?
?
Thanks in advance
?
Toby
?
public void Subscribe(string queueName)
{

    var consumer = new EventingBasicConsumer();
    
    consumer.Received += (o, e) =>
        {

            string data = Encoding.ASCII.GetString(e.Body);
            Console.WriteLine(data);

            byte[] body = e.Body;

            body = Encoding.Convert(Encoding.GetEncoding("iso-8859-1"), Encoding.UTF8, body);
            var tempString = Encoding.UTF8.GetString(body, 0, body.Count());

            // raise my event here
            //
            OnMessageDataReceived(new MessageDataEventArgs { MessageCallData = tempString, CallData = CallDataRecord.FromXml(tempString) });

            // ack message to remove from queue. (TODO : NOT SURE IF CORRECT BUT WORKS as the _channel is created by the consumer)
            //
            _channel.BasicAck(e.DeliveryTag, false);
            
            // this does not work becuase o is null - what's the correct way of acking the message inside the delegate?
            // o.Model.BasicAck(e.DeliveryTag, false); 
        };

    var consumerTag = _channel.BasicConsume(queueName, false, consumer);

}


From steve at rabbitmq.com  Thu Aug  2 12:05:41 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 2 Aug 2012 12:05:41 +0100
Subject: [rabbitmq-discuss] OSGi and RabbitMQ Service layer
In-Reply-To: <1343844906660-21172.post@n5.nabble.com>
References: <1343844906660-21172.post@n5.nabble.com>
Message-ID: <A6F65D7D-9C6C-4787-B759-9C5BB83E8467@rabbitmq.com>

Hi MaBh,

OSGi Ready
The RabbitMQ Java AMQP library jar comes ready with an OSGi manifest (with bundle version and package dependencies correctly set) so it can be deployed in an OSGi environment. This means it is no longer necessary to bundleise or OSGiefy the jar prior to using it in an OSGi container.

This does not mean that it publishes OSGi services.

I believe that, back in 2009, Neil Bartlett did some work[1] towards this end, but that pre-dates the re-packaging of the RabbitMQ Java Client as an OSGi bundle jar, and I don't know of any further work in this area.

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

[1] https://github.com/njbartlett/rabbitosgi

On 1 Aug 2012, at 19:15, Madhav wrote:

> Hi All,
> 
> RabbitMQ claims that is OSGi Ready, where can I find the list of services
> offered by the serivce layer?
> Any examples which are using service layer APIs is highly appreciated.
> 
> 
> Thanks & regards.
> MaBh.
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/OSGi-and-RabbitMQ-Service-layer-tp21172.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/fb37faa5/attachment.htm>

From thiagoburgo at gmail.com  Thu Aug  2 13:46:24 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Thu, 2 Aug 2012 09:46:24 -0300
Subject: [rabbitmq-discuss] Running 2 instances (not clustered) in same
	machine
Message-ID: <CABjKUK8s7vLQHxTfdoF9JOv5sEJGByoD7OdSYdHEwMzGnwdkSw@mail.gmail.com>

Hi all,

There is a way to run  2 rabbit instances (not clustered) in same machine?
The VirtualHost is to do this (isolate instances)?

Thanks,

Thiago Burgo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/b38688c9/attachment.htm>

From emile at rabbitmq.com  Thu Aug  2 14:06:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 02 Aug 2012 14:06:29 +0100
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <023001cd6fd5$d4cb68b0$7e623a10$@saseco.dk>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
	<5011401A.7070000@rabbitmq.com>
	<00c501cd6b2f$bcceb230$366c1690$@saseco.dk>
	<501143CD.3030505@rabbitmq.com>
	<017701cd6e51$1c5dd450$55197cf0$@saseco.dk>
	<501904BB.9050201@rabbitmq.com>
	<023001cd6fd5$d4cb68b0$7e623a10$@saseco.dk>
Message-ID: <501A7B55.7060403@rabbitmq.com>

Hi,

On 01/08/12 12:07, Bernhard Mogens Ege wrote:
> sendMessage("myroutingkey", new Dictionary<string, string> { { "languageid",
> "1" } }, null);

If you only ever send strings values then you will only ever receive
byte array values (via the intermediate 'S'-prefixed table value). See
Wireformatting.WriteFieldValue() and ReadFieldValue(). The string "1" is
still a string and won't automatically be recognised as a number.

If the producer sends other types of values then the consumer will
receive other types of values.

-Emile


From bme at saseco.dk  Thu Aug  2 14:25:06 2012
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Thu, 2 Aug 2012 15:25:06 +0200
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <501A7B55.7060403@rabbitmq.com>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
	<5011401A.7070000@rabbitmq.com>
	<00c501cd6b2f$bcceb230$366c1690$@saseco.dk>
	<501143CD.3030505@rabbitmq.com>
	<017701cd6e51$1c5dd450$55197cf0$@saseco.dk>
	<501904BB.9050201@rabbitmq.com>
	<023001cd6fd5$d4cb68b0$7e623a10$@saseco.dk>
	<501A7B55.7060403@rabbitmq.com>
Message-ID: <02b601cd70b2$3e83d850$bb8b88f0$@saseco.dk>

I already said I was looking to send other types but started with a string.
That is contains a number is of no importance here.
But I did not expect that the string object would be received as a byte[]
object. But if that is how RabbitMQ is designed, so be it. 
It just doesn't make sense to me.

I'll try sending other types to see if they arrive as intended (int as int,
double as double, etc.).

[testing time passes]

It does appear that at least the type double does get passed through
unharmed. Only strings are passed as byte[]. 

Is  this be because RabbitMQ doesn't know the encoding to use when receiving
a string? If so, that would make sense. 
Hmm looking at WireFormatting.cs, UTF8 is already assumed when converting a
string to byte[]. Why not assume UTF8 
when receiving the byte[] and return a string instead of a byte[] (offending
method: ReadLongstr)?
-- 
Bernhard

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 2. august 2012 15:06
To: bme at saseco.dk; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Decoding header fields

Hi,

On 01/08/12 12:07, Bernhard Mogens Ege wrote:
> sendMessage("myroutingkey", new Dictionary<string, string> { { 
> "languageid", "1" } }, null);

If you only ever send strings values then you will only ever receive byte
array values (via the intermediate 'S'-prefixed table value). See
Wireformatting.WriteFieldValue() and ReadFieldValue(). The string "1" is
still a string and won't automatically be recognised as a number.

If the producer sends other types of values then the consumer will receive
other types of values.

-Emile


From tonygarnockjones+rabbitmq at gmail.com  Thu Aug  2 14:39:43 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 2 Aug 2012 09:39:43 -0400
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <02b601cd70b2$3e83d850$bb8b88f0$@saseco.dk>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
	<5011401A.7070000@rabbitmq.com>
	<00c501cd6b2f$bcceb230$366c1690$@saseco.dk>
	<501143CD.3030505@rabbitmq.com>
	<017701cd6e51$1c5dd450$55197cf0$@saseco.dk>
	<501904BB.9050201@rabbitmq.com>
	<023001cd6fd5$d4cb68b0$7e623a10$@saseco.dk>
	<501A7B55.7060403@rabbitmq.com>
	<02b601cd70b2$3e83d850$bb8b88f0$@saseco.dk>
Message-ID: <CAM8fPiRMpaWu9RTnQyHLq9d2H6-8AfY-OkhAhdKXWRVazByY4w@mail.gmail.com>

On 2 August 2012 09:25, Bernhard Mogens Ege <bme at saseco.dk> wrote:

> Hmm looking at WireFormatting.cs, UTF8 is already assumed when converting a
> string to byte[]. Why not assume UTF8
> when receiving the byte[] and return a string instead of a byte[]
> (offending
> method: ReadLongstr)?
>

Because not all byte[]s are valid UTF-8, AMQP doesn't provide a way of
giving an interpretation for a particular byte vector, and it'd be Bad to
not support transmission of arbitrary binary content over AMQP.

The table writer can cope with Strings by using UTF-8 encoding as a
convenience because C# has given the table writer enough to work with: it
can distinguish byte[]s from Strings. This doesn't hold in the other
direction. The table reader would have to guess.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/ec3f6a14/attachment.htm>

From tim at rabbitmq.com  Thu Aug  2 14:36:21 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 02 Aug 2012 14:36:21 +0100
Subject: [rabbitmq-discuss] Running 2 instances (not clustered) in same
 machine
In-Reply-To: <CABjKUK8s7vLQHxTfdoF9JOv5sEJGByoD7OdSYdHEwMzGnwdkSw@mail.gmail.com>
References: <CABjKUK8s7vLQHxTfdoF9JOv5sEJGByoD7OdSYdHEwMzGnwdkSw@mail.gmail.com>
Message-ID: <501A8255.5080007@rabbitmq.com>

On 08/02/2012 01:46 PM, Thiago Burgo Belo wrote:
> Hi all,
>
> There is a way to run  2 rabbit instances (not clustered) in same 
> machine? The VirtualHost is to do this (isolate instances)?
>

Sure, if what you mean is to have two distinct brokers running on the 
same machine. Just give them different node names using the 
RABBITMQ_NODENAME environment variable. Virtual host is not required for 
this.

> Thanks,
>
> Thiago Burgo
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/f4dea56c/attachment.htm>

From emile at rabbitmq.com  Thu Aug  2 14:57:28 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 02 Aug 2012 14:57:28 +0100
Subject: [rabbitmq-discuss] vm_memory_high_watermark of RabbitMQ
In-Reply-To: <BCC407A444557E41B0D8B0260D684992053AE43B@CA1EXCLV07.adcorp.kla-tencor.com>
References: <BCC407A444557E41B0D8B0260D684992053AE43B@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <501A8748.6040605@rabbitmq.com>

Hi,

On 02/08/12 04:15, Chen, Bin wrote:
> Be default, "vm_memory_high_watermark" is set to 800 MB.
> Based on the document, this means the fraction is 0.4.

Actually it's the other way around. The default is 0.4, which means that
the total RAM detected on your system is 2Gb. Confirm with
rabbitmqctl eval 'erlang:memory().'
or "rabbitmqctl status" as you have done.

> My system is Windows 2008 Server 64-bit. It has 24 GB ram installed.

That's alot more than the 32bit version of Erlang can address.

> When I ran "rabbitmqctl status", I got a different fraction for
> "vm_memory_high_watermark".

The fraction should still be 0.4, and I would expect the watermark to be
about 10Gb, provided the maximum RAM is detected correctly and you are
using the 64bit version of Erlang.

> It is much smaller than 0.4, and it seems equal to 800 MB / 24 GB.

Can you please provide the output of
rabbitmqctl eval 'os_mon_sysinfo:get_mem_info().'
It may be that the total memory rather than the total addressable memory
is being used. You should consider using the 64bit version of Erlang though.


-Emile





From tim at rabbitmq.com  Thu Aug  2 14:49:58 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 02 Aug 2012 14:49:58 +0100
Subject: [rabbitmq-discuss] Running 2 instances (not clustered) in same
 machine
In-Reply-To: <501A8255.5080007@rabbitmq.com>
References: <CABjKUK8s7vLQHxTfdoF9JOv5sEJGByoD7OdSYdHEwMzGnwdkSw@mail.gmail.com>
	<501A8255.5080007@rabbitmq.com>
Message-ID: <501A8586.5070503@rabbitmq.com>

On 08/02/2012 02:36 PM, Tim Watson wrote:
> On 08/02/2012 01:46 PM, Thiago Burgo Belo wrote:
>> Hi all,
>>
>> There is a way to run  2 rabbit instances (not clustered) in same 
>> machine? The VirtualHost is to do this (isolate instances)?
>>
>
> Sure, if what you mean is to have two distinct brokers running on the 
> same machine. Just give them different node names using the 
> RABBITMQ_NODENAME environment variable. Virtual host is not required 
> for this.

Oh yes - you'll want different listening ports as well, and possibly 
won't want to share other things either (mnesia dir, plugins dirs, etc). 
Please see http://www.rabbitmq.com/configure.html for an exhaustive list.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/32dd2371/attachment.htm>

From tim at rabbitmq.com  Thu Aug  2 14:54:13 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 02 Aug 2012 14:54:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.5 released
Message-ID: <501A8685.7090003@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 2.8.5.

This is primarily a bugfix release, with several improvements to HA queues.

See the attached release notes for more details.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)

-- 
Tim Watson
RabbitMQ, VMware

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.8.5.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/580e4125/attachment.txt>

From thiagoburgo at gmail.com  Thu Aug  2 15:13:34 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Thu, 2 Aug 2012 11:13:34 -0300
Subject: [rabbitmq-discuss] Running 2 instances (not clustered) in same
	machine
In-Reply-To: <501A8586.5070503@rabbitmq.com>
References: <CABjKUK8s7vLQHxTfdoF9JOv5sEJGByoD7OdSYdHEwMzGnwdkSw@mail.gmail.com>
	<501A8255.5080007@rabbitmq.com> <501A8586.5070503@rabbitmq.com>
Message-ID: <CABjKUK_gEe6BnD=eU0My+gKf-6-2fGiU9cW3V06OFLe9PC7sqA@mail.gmail.com>

Thanks Tim!

Thiago Burgo

2012/8/2 Tim Watson <tim at rabbitmq.com>

>  On 08/02/2012 02:36 PM, Tim Watson wrote:
>
> On 08/02/2012 01:46 PM, Thiago Burgo Belo wrote:
>
> Hi all,
>
>  There is a way to run  2 rabbit instances (not clustered) in same
> machine? The VirtualHost is to do this (isolate instances)?
>
>
> Sure, if what you mean is to have two distinct brokers running on the same
> machine. Just give them different node names using the RABBITMQ_NODENAME
> environment variable. Virtual host is not required for this.
>
>
> Oh yes - you'll want different listening ports as well, and possibly won't
> want to share other things either (mnesia dir, plugins dirs, etc). Please
> see http://www.rabbitmq.com/configure.html for an exhaustive list.
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/2ecbddf2/attachment.htm>

From emile at rabbitmq.com  Thu Aug  2 15:19:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 02 Aug 2012 15:19:50 +0100
Subject: [rabbitmq-discuss] Acknowledging messages using the
	EventingBasicConsumer
In-Reply-To: <84B3D44AADE2D843994ED89240B2DFA2FCC38954@mailbox1b.gmsuk.net>
References: <84B3D44AADE2D843994ED89240B2DFA2FCC38954@mailbox1b.gmsuk.net>
Message-ID: <501A8C86.9060501@rabbitmq.com>

Hi Toby,

On 02/08/12 12:05, Toby Riley wrote:
> I have a question I could not find a proper answer to anywhere, and
> it is to do with the Acknowledging messages using the
> EventingBasicConsumer, I?m using   _channel.BasicAck(e.DeliveryTag,
> false); but there is one for o.Model. BasicAck(e.DeliveryTag, false)
> but the sender object (o) is null.
> 
> What is the proper way to Acknowledge message from the Received event
> when using the EventingBasicConsumer when you inside the delegate?

You should first make sure that it is correct to acknowledge the
message. If there were any asynchronous events that could fail and that
were triggered as a result of the message then you might as well use
automatic acknowledgements.

I'm not sure why the event sender is null in your example. That may well
be a bug in EventingBasicConsumer, which is classed as experimental.
Using the sender would be the preferable approach. I will file a bug to
investigate why the value is null. Thanks for reporting this.


-Emile


From ward.mark at gmail.com  Thu Aug  2 15:22:54 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 07:22:54 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <051fce24-dff2-4754-820a-86f49f7b49a7@googlegroups.com>

Matthias,

stunnel may not be a viable option for our deployment requirements.  I will 
continue to investigate my situation.  I am in the process of setting up 
rabbitmq on a linux box to see if I obtain different results.

I have tested {verify, verify_none} and things turned out a little 
different.  The .NET client continues to give the exception "None of the 
specified endpoints were reachable" but on the server side I see this in 
the log.

=INFO REPORT==== 2-Aug-2012::09:01:08 ===
accepting AMQP connection <0.16578.0> ([FE80::9CF9:E6C8:AAA2:E95E]:60232 -> 
[FE80::DC90:8492:EDEA:F29F]:443)

=WARNING REPORT==== 2-Aug-2012::09:01:08 ===
closing AMQP connection <0.16578.0> ([FE80::9CF9:E6C8:AAA2:E95E]:60232 -> 
[FE80::DC90:8492:EDEA:F29F]:443):
connection_closed_abruptly

The Java client continues to connect and transmit fine through the server.

The following is the packet trace of the connection attempt between the 
server and the .net client with verify, verify_none
No.     Time           Source                Destination           Protocol 
Length Info
     11 0.005181000    fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      82     60223 > https [SYN] Seq=0 Win=8192 Len=0 MSS=1440 
SACK_PERM=1

Frame 11: 82 bytes on wire (656 bits), 82 bytes captured (656 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 60223 (60223), Dst Port: https 
(443), Seq: 0, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     12 0.005238000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
TCP      82     https > 60223 [SYN, ACK] Seq=0 Ack=1 Win=8192 Len=0 
MSS=1440 SACK_PERM=1

Frame 12: 82 bytes on wire (656 bits), 82 bytes captured (656 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 0, Ack: 1, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     13 0.005970000    fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     60223 > https [ACK] Seq=1 Ack=1 Win=64800 Len=0

Frame 13: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 60223 (60223), Dst Port: https 
(443), Seq: 1, Ack: 1, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     14 0.047390000    fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
SSLv3    132    Client Hello

Frame 14: 132 bytes on wire (1056 bits), 132 bytes captured (1056 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 60223 (60223), Dst Port: https 
(443), Seq: 1, Ack: 1, Len: 58
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Client Hello
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 53
        Handshake Protocol: Client Hello

No.     Time           Source                Destination           Protocol 
Length Info
     15 0.048333000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    160    Server Hello

Frame 15: 160 bytes on wire (1280 bits), 160 bytes captured (1280 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 1, Ack: 59, Len: 86
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Server Hello
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 81
        Handshake Protocol: Server Hello

No.     Time           Source                Destination           Protocol 
Length Info
     16 0.048506000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
TCP      1514   [TCP segment of a reassembled PDU]

Frame 16: 1514 bytes on wire (12112 bits), 1514 bytes captured (12112 bits) 
on interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 87, Ack: 59, Len: 1440

No.     Time           Source                Destination           Protocol 
Length Info
     17 0.048511000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    112    Certificate

Frame 17: 112 bytes on wire (896 bits), 112 bytes captured (896 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 1527, Ack: 59, Len: 38
[2 Reassembled TCP Segments (1478 bytes): #16(1440), #17(38)]
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Certificate
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 1473
        Handshake Protocol: Certificate

No.     Time           Source                Destination           Protocol 
Length Info
     18 0.048541000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    83     Server Hello Done

Frame 18: 83 bytes on wire (664 bits), 83 bytes captured (664 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 1565, Ack: 59, Len: 9
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Server Hello Done
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 4
        Handshake Protocol: Server Hello Done

No.     Time           Source                Destination           Protocol 
Length Info
     19 0.048982000    fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     60223 > https [ACK] Seq=59 Ack=1574 Win=64800 Len=0

Frame 19: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 60223 (60223), Dst Port: https 
(443), Seq: 59, Ack: 1574, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     20 0.051362000    fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
SSLv3    410    Client Key Exchange, Change Cipher Spec, Encrypted 
Handshake Message

Frame 20: 410 bytes on wire (3280 bits), 410 bytes captured (3280 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 60223 (60223), Dst Port: https 
(443), Seq: 59, Ack: 1574, Len: 336
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Client Key Exchange
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 260
        Handshake Protocol: Client Key Exchange
    SSLv3 Record Layer: Change Cipher Spec Protocol: Change Cipher Spec
        Content Type: Change Cipher Spec (20)
        Version: SSL 3.0 (0x0300)
        Length: 1
        Change Cipher Spec Message
    SSLv3 Record Layer: Handshake Protocol: Encrypted Handshake Message
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 60
        Handshake Protocol: Encrypted Handshake Message

No.     Time           Source                Destination           Protocol 
Length Info
     21 0.128285000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    80     Change Cipher Spec

Frame 21: 80 bytes on wire (640 bits), 80 bytes captured (640 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 1574, Ack: 395, Len: 6
Secure Sockets Layer
    SSLv3 Record Layer: Change Cipher Spec Protocol: Change Cipher Spec
        Content Type: Change Cipher Spec (20)
        Version: SSL 3.0 (0x0300)
        Length: 1
        Change Cipher Spec Message

No.     Time           Source                Destination           Protocol 
Length Info
     22 0.128335000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    139    Encrypted Handshake Message

Frame 22: 139 bytes on wire (1112 bits), 139 bytes captured (1112 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 1580, Ack: 395, Len: 65
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Encrypted Handshake Message
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 60
        Handshake Protocol: Encrypted Handshake Message

No.     Time           Source                Destination           Protocol 
Length Info
     23 0.131355000    fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     60223 > https [ACK] Seq=395 Ack=1645 Win=64729 Len=0

Frame 23: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 60223 (60223), Dst Port: https 
(443), Seq: 395, Ack: 1645, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     24 0.399464000    fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     60223 > https [FIN, ACK] Seq=395 Ack=1645 Win=64729 Len=0

Frame 24: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 60223 (60223), Dst Port: https 
(443), Seq: 395, Ack: 1645, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     25 0.399522000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
TCP      74     https > 60223 [ACK] Seq=1645 Ack=396 Win=64464 Len=0

Frame 25: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 1645, Ack: 396, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     26 0.432068000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    101    Encrypted Alert

Frame 26: 101 bytes on wire (808 bits), 101 bytes captured (808 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 1645, Ack: 396, Len: 27
Secure Sockets Layer
    SSLv3 Record Layer: Encrypted Alert
        Content Type: Alert (21)
        Version: SSL 3.0 (0x0300)
        Length: 22
        Alert Message: Encrypted Alert

No.     Time           Source                Destination           Protocol 
Length Info
     27 0.432113000    fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
TCP      74     https > 60223 [FIN, ACK] Seq=1672 Ack=396 Win=64464 Len=0

Frame 27: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 60223 
(60223), Seq: 1672, Ack: 396, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     28 0.433512000    fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     60223 > https [RST, ACK] Seq=396 Ack=1672 Win=0 Len=0

Frame 28: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 60223 (60223), Dst Port: https 
(443), Seq: 396, Ack: 1672, Len: 0


Mark, 

On 31/07/12 14:24, Mark Ward wrote: 
> I have my server's configuration set to false for the 
> fail_if_no_peer_cert setting. 

You should also try setting {verify,verify_none}. 

And, as Emile suggested, you may want to experiment with stunnel. 

> A side note not all posts seem to make it into the google group but I 
> find the posts either in email or in nabble.com 

We have no control over the google group, unfortunately. 

Matthias.  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/ab66a70a/attachment.htm>

From matthias at rabbitmq.com  Thu Aug  2 15:43:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Aug 2012 15:43:04 +0100
Subject: [rabbitmq-discuss] Running 2 instances (not clustered) in same
 machine
In-Reply-To: <501A8586.5070503@rabbitmq.com>
References: <CABjKUK8s7vLQHxTfdoF9JOv5sEJGByoD7OdSYdHEwMzGnwdkSw@mail.gmail.com>
	<501A8255.5080007@rabbitmq.com> <501A8586.5070503@rabbitmq.com>
Message-ID: <501A91F8.4070901@rabbitmq.com>

On 02/08/12 14:49, Tim Watson wrote:
> On 08/02/2012 02:36 PM, Tim Watson wrote:
>> On 08/02/2012 01:46 PM, Thiago Burgo Belo wrote:
>>> Hi all,
>>>
>>> There is a way to run  2 rabbit instances (not clustered) in same
>>> machine? The VirtualHost is to do this (isolate instances)?
>>>
>>
>> Sure, if what you mean is to have two distinct brokers running on the
>> same machine. Just give them different node names using the
>> RABBITMQ_NODENAME environment variable. Virtual host is not required
>> for this.
>
> Oh yes - you'll want different listening ports as well, and possibly
> won't want to share other things either (mnesia dir, plugins dirs, etc).
> Please see http://www.rabbitmq.com/configure.html for an exhaustive list.

See also http://www.rabbitmq.com/clustering.html#single-machine

And just to be clear, AMQP virtual hosts have absolutely nothing to do 
with that. Their purpose is to create logical partitions of resources 
within a *single* broker.


Matthias.

From matthias at rabbitmq.com  Thu Aug  2 15:47:52 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Aug 2012 15:47:52 +0100
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <051fce24-dff2-4754-820a-86f49f7b49a7@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
	<051fce24-dff2-4754-820a-86f49f7b49a7@googlegroups.com>
Message-ID: <501A9318.2000303@rabbitmq.com>

Mark,

On 02/08/12 15:22, Mark Ward wrote:
> stunnel may not be a viable option for our deployment requirements.

Emile was only suggesting that as a troubleshooting step, not the 
ultimate solution.

Matthias.

From ward.mark at gmail.com  Thu Aug  2 15:50:21 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 07:50:21 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <bd574c26-e8e3-4dcb-8eec-46c25eb33faa@googlegroups.com>

Hi,

I will see how to use stunnel to trouble shoot the situation. I have never 
used it.

If I run the .net client with a client certificate the .net client errors 
out the same.  It gives me the exception "None of the specified endpoints 
were reachable".  Although, the server is a little different.  The server 
does not error out and perform a dump.  It gives the following error that 
the connection_closed_abruptly.  This is the same error regardless of how I 
change the verify and fail_if_no_peer_cert settings in my server's 
configuration.  The Java client continues to connect appropriately. 

=INFO REPORT==== 2-Aug-2012::09:45:46 ===
accepting AMQP connection <0.613.0> ([FE80::9CF9:E6C8:AAA2:E95E]:60317 -> 
[FE80::DC90:8492:EDEA:F29F]:443)

=WARNING REPORT==== 2-Aug-2012::09:45:46 ===
closing AMQP connection <0.613.0> ([FE80::9CF9:E6C8:AAA2:E95E]:60317 -> 
[FE80::DC90:8492:EDEA:F29F]:443):
connection_closed_abruptly

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/5bd3713b/attachment.htm>

From ward.mark at gmail.com  Thu Aug  2 15:58:51 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 07:58:51 -0700 (PDT)
Subject: [rabbitmq-discuss] subscriber failed to detect closed connection
Message-ID: <a4ba58d0-0a0e-44e1-a864-93b8d0114240@googlegroups.com>

Hi,

I am performing tests to a server across the internet.  During the night 
our firewall is rebooted and it appears the basic consumer is not detecting 
this and does not throw any exceptions on the connection.  When I arrive to 
the office each morning the subscriber client is still running and in the 
block state waiting for a message.  If I send messages to the server the 
client will not receive messages unless I restart the client.  The client 
works all day long as I push millions of messages through for testing.  It 
is after the firewall reset that the client does not continue to work or 
fail out.  This does appear to be a repeatable issue for the past two days 
it has performed this same issue.  I am going to continue tonight to see if 
it repeats.

Is there something I need to enable to have the client detect the 
connection closure?  The testing I have manually performed on closing the 
network connection, shutting down the server, restarting the server have 
all caused the client to properly throw and exception that the connection 
was closed.  It is only when the firewall resets that the client does not 
detect the failed connection. 

This is the .NET client connecting to the port 5672.  It is not using SSL.

below is the example code I am working with.

var connectionFactory = new ConnectionFactory();
            connectionFactory.HostName = hostName;
            connectionFactory.Port = port;

            IConnection connection = connectionFactory.CreateConnection();
            IModel channel = connection.CreateModel();

            QueueingBasicConsumer consumer = new 
QueueingBasicConsumer(channel);
            String consumer_tag = channel.BasicConsume("QueueOne", false, 
consumer);

            Console.WriteLine("ctrl+c to exit");
            while (true)
            {
                BasicDeliverEventArgs evt_args = 
(BasicDeliverEventArgs)consumer.Queue.Dequeue();
                IBasicProperties msg_props = evt_args.BasicProperties;
                string message = Encoding.UTF8.GetString(evt_args.Body);

                channel.BasicAck(evt_args.DeliveryTag, false);

                Console.WriteLine("Message Body: " + message);
            }

            channel.Close();
            connection.Close();
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/63cb4afa/attachment.htm>

From tim at rabbitmq.com  Thu Aug  2 16:04:41 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 02 Aug 2012 16:04:41 +0100
Subject: [rabbitmq-discuss] subscriber failed to detect closed connection
In-Reply-To: <a4ba58d0-0a0e-44e1-a864-93b8d0114240@googlegroups.com>
References: <a4ba58d0-0a0e-44e1-a864-93b8d0114240@googlegroups.com>
Message-ID: <501A9709.3030606@rabbitmq.com>

Hi Mark,

You should try enabling AMQP heartbeats, as this should resolve the 
issue of detecting the connection is being closed.

On 08/02/2012 03:58 PM, Mark Ward wrote:
> Hi,
>
> I am performing tests to a server across the internet.  During the 
> night our firewall is rebooted and it appears the basic consumer is 
> not detecting this and does not throw any exceptions on the 
> connection.  When I arrive to the office each morning the subscriber 
> client is still running and in the block state waiting for a message. 
>  If I send messages to the server the client will not receive messages 
> unless I restart the client.  The client works all day long as I push 
> millions of messages through for testing.  It is after the firewall 
> reset that the client does not continue to work or fail out.  This 
> does appear to be a repeatable issue for the past two days it has 
> performed this same issue.  I am going to continue tonight to see if 
> it repeats.
>
> Is there something I need to enable to have the client detect the 
> connection closure?  The testing I have manually performed on closing 
> the network connection, shutting down the server, restarting the 
> server have all caused the client to properly throw and exception that 
> the connection was closed.  It is only when the firewall resets that 
> the client does not detect the failed connection.
>
> This is the .NET client connecting to the port 5672.  It is not using SSL.
>
> below is the example code I am working with.
>
> var connectionFactory = new ConnectionFactory();
>             connectionFactory.HostName = hostName;
>             connectionFactory.Port = port;
>
>             IConnection connection = connectionFactory.CreateConnection();
>             IModel channel = connection.CreateModel();
>
>             QueueingBasicConsumer consumer = new 
> QueueingBasicConsumer(channel);
>             String consumer_tag = channel.BasicConsume("QueueOne", 
> false, consumer);
>
>             Console.WriteLine("ctrl+c to exit");
>             while (true)
>             {
>                 BasicDeliverEventArgs evt_args = 
> (BasicDeliverEventArgs)consumer.Queue.Dequeue();
>                 IBasicProperties msg_props = evt_args.BasicProperties;
>                 string message = Encoding.UTF8.GetString(evt_args.Body);
>
>                 channel.BasicAck(evt_args.DeliveryTag, false);
>
>                 Console.WriteLine("Message Body: " + message);
>             }
>
>             channel.Close();
>             connection.Close();
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/6399e88a/attachment.htm>

From ward.mark at gmail.com  Thu Aug  2 16:24:36 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 08:24:36 -0700 (PDT)
Subject: [rabbitmq-discuss] subscriber failed to detect closed connection
In-Reply-To: <a4ba58d0-0a0e-44e1-a864-93b8d0114240@googlegroups.com>
References: <a4ba58d0-0a0e-44e1-a864-93b8d0114240@googlegroups.com>
Message-ID: <2293eda1-e3e6-49b6-8ad6-348fca831f0e@googlegroups.com>

Hi Tim,

Thanks, I found the heartbeat property on the connection class. 
connectionFactory.RequestedHeartbeat   I didn't realize it was default off 
(0) and will test with a value.

-Mark

Hi Mark,

You should try enabling AMQP heartbeats, as this should resolve the issue 
of detecting the connection is being closed.  

On Thursday, August 2, 2012 9:58:51 AM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I am performing tests to a server across the internet.  During the night 
> our firewall is rebooted and it appears the basic consumer is not detecting 
> this and does not throw any exceptions on the connection.  When I arrive to 
> the office each morning the subscriber client is still running and in the 
> block state waiting for a message.  If I send messages to the server the 
> client will not receive messages unless I restart the client.  The client 
> works all day long as I push millions of messages through for testing.  It 
> is after the firewall reset that the client does not continue to work or 
> fail out.  This does appear to be a repeatable issue for the past two days 
> it has performed this same issue.  I am going to continue tonight to see if 
> it repeats.
>
> Is there something I need to enable to have the client detect the 
> connection closure?  The testing I have manually performed on closing the 
> network connection, shutting down the server, restarting the server have 
> all caused the client to properly throw and exception that the connection 
> was closed.  It is only when the firewall resets that the client does not 
> detect the failed connection. 
>
> This is the .NET client connecting to the port 5672.  It is not using SSL.
>
> below is the example code I am working with.
>
> var connectionFactory = new ConnectionFactory();
>             connectionFactory.HostName = hostName;
>             connectionFactory.Port = port;
>
>             IConnection connection = connectionFactory.CreateConnection();
>             IModel channel = connection.CreateModel();
>
>             QueueingBasicConsumer consumer = new 
> QueueingBasicConsumer(channel);
>             String consumer_tag = channel.BasicConsume("QueueOne", false, 
> consumer);
>
>             Console.WriteLine("ctrl+c to exit");
>             while (true)
>             {
>                 BasicDeliverEventArgs evt_args = 
> (BasicDeliverEventArgs)consumer.Queue.Dequeue();
>                 IBasicProperties msg_props = evt_args.BasicProperties;
>                 string message = Encoding.UTF8.GetString(evt_args.Body);
>
>                 channel.BasicAck(evt_args.DeliveryTag, false);
>
>                 Console.WriteLine("Message Body: " + message);
>             }
>
>             channel.Close();
>             connection.Close();
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/ded1b46b/attachment.htm>

From thiagoburgo at gmail.com  Thu Aug  2 16:40:48 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Thu, 2 Aug 2012 12:40:48 -0300
Subject: [rabbitmq-discuss] Running 2 instances (not clustered) in same
	machine
In-Reply-To: <501A91F8.4070901@rabbitmq.com>
References: <CABjKUK8s7vLQHxTfdoF9JOv5sEJGByoD7OdSYdHEwMzGnwdkSw@mail.gmail.com>
	<501A8255.5080007@rabbitmq.com> <501A8586.5070503@rabbitmq.com>
	<501A91F8.4070901@rabbitmq.com>
Message-ID: <CABjKUK98vqvYqBT8x3DMs-Hy0UpNLG7Ye3Ccu6WzGqN+7Rk55g@mail.gmail.com>

Ok, Matthias,  I understand (I think =)),

When I create a VirtualHost, are created separate resources like queues,
exchanges etc. but share memory, process etc...I'm right?

Thanks,

Thiago Burgo

2012/8/2 Matthias Radestock <matthias at rabbitmq.com>

> On 02/08/12 14:49, Tim Watson wrote:
>
>> On 08/02/2012 02:36 PM, Tim Watson wrote:
>>
>>> On 08/02/2012 01:46 PM, Thiago Burgo Belo wrote:
>>>
>>>> Hi all,
>>>>
>>>> There is a way to run  2 rabbit instances (not clustered) in same
>>>> machine? The VirtualHost is to do this (isolate instances)?
>>>>
>>>>
>>> Sure, if what you mean is to have two distinct brokers running on the
>>> same machine. Just give them different node names using the
>>> RABBITMQ_NODENAME environment variable. Virtual host is not required
>>> for this.
>>>
>>
>> Oh yes - you'll want different listening ports as well, and possibly
>> won't want to share other things either (mnesia dir, plugins dirs, etc).
>> Please see http://www.rabbitmq.com/**configure.html<http://www.rabbitmq.com/configure.html>for an exhaustive list.
>>
>
> See also http://www.rabbitmq.com/**clustering.html#single-machine<http://www.rabbitmq.com/clustering.html#single-machine>
>
> And just to be clear, AMQP virtual hosts have absolutely nothing to do
> with that. Their purpose is to create logical partitions of resources
> within a *single* broker.
>
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/339de0de/attachment.htm>

From ward.mark at gmail.com  Thu Aug  2 17:14:25 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 09:14:25 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <7c9b9f1c-38a2-477a-b9f0-b1c093c46287@googlegroups.com>

Hi,

I have setup a rabbitmq with ssl on Ubuntu workstation.  RabbitMQ 2.8.4 on 
Erlang R14B04.  The Java client connects and communicates via SSL just 
fine.  When I connected the .NET client with no client certificate I 
received the same error as the windows version.  The client errors out with 
"None of the specified endpoints were reachable" and the rabbitmq server 
logs the error report for the amqp connection ssl_upgrade_failure.

I am in the process of testing the .net client on mono and eventually 
figuring out how to use stunnel.  I don't know enough of the SSL protocol 
to evaluate any errors in the packet trace.

-Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/1d6b2ad9/attachment.htm>

From ward.mark at gmail.com  Thu Aug  2 17:58:21 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 09:58:21 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <10c7d66e-dd95-4f1e-9911-2e78210c030b@googlegroups.com>

Hi,

I here is the output of the exceptions I get from .NET and Mono.  The Mono 
exception appears to provide more information.  I followed the ssl 
instructions for setting up the rabbitmq certificate.  I will double check 
its settings. Although openssl and java do not appear to have problems 
connecting.  I know there are notes about some of the issues with mono and 
I will visit them again.

When I test with openssl i execute it like the following $ openssl s_client 
-connect localhost:5671 -CAfile /home/mark/rabbitmqCert/testca/cacert.pem 
and the verify result is 0 (ok)

.NET exception: note, this did not provide an inner exception.

RabbitMQ.Client.Exceptions.BrokerUnreachableException was unhandled
  Message=None of the specified endpoints were reachable
  Source=RabbitMQ.Client
  StackTrace:
       at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 
maxRedirects)
       at RabbitMQ.Client.ConnectionFactory.CreateConnection()
       at ProducerOne.Program.Main(String[] args) in 
C:\FirstRabbitMQ\ProducerOne\Program.cs:line 40
       at System.AppDomain._nExecuteAssembly(RuntimeAssembly assembly, 
String[] args)
       at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence 
assemblySecurity, String[] args)
       at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()
       at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
       at System.Threading.ExecutionContext.Run(ExecutionContext 
executionContext, ContextCallback callback, Object state, Boolean 
ignoreSyncCtx)
       at System.Threading.ExecutionContext.Run(ExecutionContext 
executionContext, ContextCallback callback, Object state)
       at System.Threading.ThreadHelper.ThreadStart()
  InnerException: 

Mono

Unhandled Exception: None of the specified endpoints were reachable
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://192.168.10.166:5671, attempts=1
System.IO.IOException: The authentication or decryption has failed. ---> 
Mono.Se
curity.Protocol.Tls.TlsException: Invalid certificate received from server.
  at 
Mono.Security.Protocol.Tls.Handshake.Client.TlsServerCertificate.validateCe
rtificates (Mono.Security.X509.X509CertificateCollection certificates) 
[0x00000]
 in <filename unknown>:0
  at 
Mono.Security.Protocol.Tls.Handshake.Client.TlsServerCertificate.ProcessAsT
ls1 () [0x00000] in <filename unknown>:0
  at 
Mono.Security.Protocol.Tls.Handshake.Client.TlsServerCertificate.ProcessAsS
sl3 () [0x00000] in <filename unknown>:0
  at Mono.Security.Protocol.Tls.Handshake.HandshakeMessage.Process () 
[0x00000]
in <filename unknown>:0
  at (wrapper remoting-invoke-with-check) 
Mono.Security.Protocol.Tls.Handshake.H
andshakeMessage:Process ()
  at 
Mono.Security.Protocol.Tls.ClientRecordProtocol.ProcessHandshakeMessage (Mo
no.Security.Protocol.Tls.TlsStream handMsg) [0x00000] in <filename 
unknown>:0
  at 
Mono.Security.Protocol.Tls.RecordProtocol.InternalReceiveRecordCallback (IA
syncResult asyncResult) [0x00000] in <filename unknown>:0
  --- End of inner exception stack trace ---
  at Mono.Security.Protocol.Tls.SslStreamBase.AsyncHandshakeCallback 
(IAsyncResu
lt asyncResult) [0x00000] in <filename unknown>:0
================================================
Stack trace:
  at RabbitMQ.Client.ConnectionFactory.CreateConnection (Int32 
maxRedirects) [0x
00000] in <filename unknown>:0
  at RabbitMQ.Client.ConnectionFactory.CreateConnection () [0x00000] in 
<filenam
e unknown>:0
  at ProducerOne.Program.Main (System.String[] args) [0x00000] in <filename 
unkn
own>:0
[ERROR] FATAL UNHANDLED EXCEPTION: None of the specified endpoints were 
reachabl
e
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://192.168.10.166:5671, attempts=1
System.IO.IOException: The authentication or decryption has failed. ---> 
Mono.Se
curity.Protocol.Tls.TlsException: Invalid certificate received from server.
  at 
Mono.Security.Protocol.Tls.Handshake.Client.TlsServerCertificate.validateCe
rtificates (Mono.Security.X509.X509CertificateCollection certificates) 
[0x00000]
 in <filename unknown>:0
  at 
Mono.Security.Protocol.Tls.Handshake.Client.TlsServerCertificate.ProcessAsT
ls1 () [0x00000] in <filename unknown>:0
  at 
Mono.Security.Protocol.Tls.Handshake.Client.TlsServerCertificate.ProcessAsS
sl3 () [0x00000] in <filename unknown>:0
  at Mono.Security.Protocol.Tls.Handshake.HandshakeMessage.Process () 
[0x00000]
in <filename unknown>:0
  at (wrapper remoting-invoke-with-check) 
Mono.Security.Protocol.Tls.Handshake.H
andshakeMessage:Process ()
  at 
Mono.Security.Protocol.Tls.ClientRecordProtocol.ProcessHandshakeMessage (Mo
no.Security.Protocol.Tls.TlsStream handMsg) [0x00000] in <filename 
unknown>:0
  at 
Mono.Security.Protocol.Tls.RecordProtocol.InternalReceiveRecordCallback (IA
syncResult asyncResult) [0x00000] in <filename unknown>:0
  --- End of inner exception stack trace ---
  at Mono.Security.Protocol.Tls.SslStreamBase.AsyncHandshakeCallback 
(IAsyncResu
lt asyncResult) [0x00000] in <filename unknown>:0
================================================
Stack trace:
  at RabbitMQ.Client.ConnectionFactory.CreateConnection (Int32 
maxRedirects) [0x
00000] in <filename unknown>:0
  at RabbitMQ.Client.ConnectionFactory.CreateConnection () [0x00000] in 
<filenam
e unknown>:0
  at ProducerOne.Program.Main (System.String[] args) [0x00000] in <filename 
unkn
own>:0


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/111a41ba/attachment.htm>

From ward.mark at gmail.com  Thu Aug  2 19:03:02 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 11:03:02 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <558ade2c-2169-4e44-a75a-ce960018507e@googlegroups.com>

Hi,

I have just tested stunnel.  I have setup a connection from my .net client 
to connect as a client to the rabbitmq server.  the client connects with 
no-ssl and stunnel is set to connect via SSL to the rabbitmq server.  I had 
to set verify, verify_none because stunnel was sending a client cert the 
server did not trust.

I am attempting to get stunnel to work the other way where the client 
connects via SSL and stunnel connects via no-ssl to the rabbitmq server.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/5cdaa27c/attachment.htm>

From ward.mark at gmail.com  Thu Aug  2 19:23:14 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 11:23:14 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <558ade2c-2169-4e44-a75a-ce960018507e@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
	<558ade2c-2169-4e44-a75a-ce960018507e@googlegroups.com>
Message-ID: <c90faadc-6f96-4617-b49a-3a97799d01d7@googlegroups.com>

My results from setting up stunnel to listen as a server for ssl 
connections and forward non-ssl to the rabbitmq appear to fail.  I get the 
following.  I am not sure if this is still a user error in setting up 
stunnel.

2012.08.02 13:01:29 LOG5[7704:3988]: Service [amqp-ssl] accepted connection 
from 192.168.10.160:60813
2012.08.02 13:01:29 LOG3[7704:3988]: SSL_accept: 1408A10B: 
error:1408A10B:SSL routines:SSL3_GET_CLIENT_HELLO:wrong version number
2012.08.02 13:01:29 LOG5[7704:3988]: Connection reset: 0 byte(s) sent to 
SSL, 0 byte(s) sent to socket

Running on mono gives the same error.  I will keep checking if it is 
something I have wrong with stunnel.  Based off the network trace between 
rabbitmq and the client the handshake does not error out this way.

On Thursday, August 2, 2012 1:03:02 PM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I have just tested stunnel.  I have setup a connection from my .net client 
> to connect as a client to the rabbitmq server.  the client connects with 
> no-ssl and stunnel is set to connect via SSL to the rabbitmq server.  I had 
> to set verify, verify_none because stunnel was sending a client cert the 
> server did not trust.
>
> I am attempting to get stunnel to work the other way where the client 
> connects via SSL and stunnel connects via no-ssl to the rabbitmq server.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/0ff8e373/attachment.htm>

From matthias at rabbitmq.com  Thu Aug  2 19:29:13 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Aug 2012 19:29:13 +0100
Subject: [rabbitmq-discuss] Running 2 instances (not clustered) in same
 machine
In-Reply-To: <CABjKUK98vqvYqBT8x3DMs-Hy0UpNLG7Ye3Ccu6WzGqN+7Rk55g@mail.gmail.com>
References: <CABjKUK8s7vLQHxTfdoF9JOv5sEJGByoD7OdSYdHEwMzGnwdkSw@mail.gmail.com>
	<501A8255.5080007@rabbitmq.com> <501A8586.5070503@rabbitmq.com>
	<501A91F8.4070901@rabbitmq.com>
	<CABjKUK98vqvYqBT8x3DMs-Hy0UpNLG7Ye3Ccu6WzGqN+7Rk55g@mail.gmail.com>
Message-ID: <501AC6F9.1000409@rabbitmq.com>

On 02/08/12 16:40, Thiago Burgo Belo wrote:
> Ok, Matthias,  I understand (I think =)),
>
> When I create a VirtualHost, are created separate resources like queues,
> exchanges etc. but share memory, process etc...I'm right?

Correct; vhosts contain exchanges, queues, bindings and user 
permissions. The underlying o/s resources are shared.

Matthias.

From Bin.Chen at kla-tencor.com  Thu Aug  2 19:33:24 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Thu, 2 Aug 2012 11:33:24 -0700
Subject: [rabbitmq-discuss] vm_memory_high_watermark of RabbitMQ
In-Reply-To: <501A8748.6040605@rabbitmq.com>
References: <BCC407A444557E41B0D8B0260D684992053AE43B@CA1EXCLV07.adcorp.kla-tencor.com>
	<501A8748.6040605@rabbitmq.com>
Message-ID: <BCC407A444557E41B0D8B0260D684992053AE572@CA1EXCLV07.adcorp.kla-tencor.com>

Hi Emile,

Here is the output of rabbitmqctl eval 'os_mon_sysinfo:get_mem_info().'
:


["14 25760477184 22026973184 51519008768 47093096448 4294836224
4282273792\n"]
...done.


Here is the output of rabbitmqctl status :


Status of node rabbit at SERVER001 ...
[{pid,14920},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.3"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
      {stdlib,"ERTS  CXC 138 10","1.17.3"},
      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {os,{win32,nt}},
 {erlang_version,
     "Erlang R14B02 (erts-5.8.3) [smp:12:12] [rq:12]
[async-threads:30]\n"},
 {memory,
     [{total,43200816},
      {processes,13395088},
      {processes_used,7180168},
      {system,29805728},
      {atom,896677},
      {atom_used,872806},
      {binary,10742872},
      {code,7786932},
      {ets,721700}]},
 {vm_memory_high_watermark,0.0333454016734413},
 {vm_memory_limit,858993459}]
...done.



Note that the vm_memory_high_watermark fraction in status report is much
smaller than 0.4.
I have to give 0.4 in command "rabbitmqctl set_vm_memory_high_watermark
0.4" in order to get the above status result.
The fraction used in rabbitmqctl command is not consistent with the
value in status report.

Thanks,
--Bin Chen

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Thursday, August 02, 2012 6:57 AM
To: Discussions about RabbitMQ
Cc: Chen, Bin
Subject: Re: [rabbitmq-discuss] vm_memory_high_watermark of RabbitMQ

Hi,

On 02/08/12 04:15, Chen, Bin wrote:
> Be default, "vm_memory_high_watermark" is set to 800 MB.
> Based on the document, this means the fraction is 0.4.

Actually it's the other way around. The default is 0.4, which means that
the total RAM detected on your system is 2Gb. Confirm with rabbitmqctl
eval 'erlang:memory().'
or "rabbitmqctl status" as you have done.

> My system is Windows 2008 Server 64-bit. It has 24 GB ram installed.

That's alot more than the 32bit version of Erlang can address.

> When I ran "rabbitmqctl status", I got a different fraction for 
> "vm_memory_high_watermark".

The fraction should still be 0.4, and I would expect the watermark to be
about 10Gb, provided the maximum RAM is detected correctly and you are
using the 64bit version of Erlang.

> It is much smaller than 0.4, and it seems equal to 800 MB / 24 GB.

Can you please provide the output of
rabbitmqctl eval 'os_mon_sysinfo:get_mem_info().'
It may be that the total memory rather than the total addressable memory
is being used. You should consider using the 64bit version of Erlang
though.


-Emile





From ward.mark at gmail.com  Thu Aug  2 19:59:40 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 2 Aug 2012 11:59:40 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <e545e844-383d-4d1b-8d62-a98340072715@googlegroups.com>

Solution,

It appears the best instructions to use are the command line certmgr for 
each Windows/Mono platform.  It seems using the gui certmgr I did not 
register the ca certificate into the proper location for the applications 
to find it.  Mono came the closest to give me an indication this was the 
problem.  The .net version of the client failed out with an exception that 
had me, as you can see from this thread, on a wild hunt for the problem.

I used the command line certmgr and inserted the ca certificate into the 
machine certificate store.  Things appear to be working with SSL.

I thank you guys for your assistance and I am sorry to have taken your time 
on this issue.

-Mark

On Monday, July 30, 2012 1:06:19 PM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I might have the same problem as this post.  
> https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ
>
> The setup
> Windows 2008r2
> rabbitmq server 2.8.4 
> Erlang R15B01
>
> .NET 4.0
> RabbitMQ client 2.8.4 (installed from NuGet)
>
> When I run my test .NET publisher I get the following exception "None of 
> the specified endpoints were reachable".
>
> I have gone through the SSL setup tutorial and I am stumped on why the 
> .NET client cannot connect or even fail out with an SSL trust exception.
> I have tested the connection to the server over SSL with the following 
> tools. openssl s_client and the Java example.  The openssl and the java 
> client connect and work.  It is the .NET client that I cannot get working 
> and it is the one I need to have working.
>
> I have setup my rabbitmq server to run the ssl over port 443 on my server. 
>  This you will find in my log output and I have specified in each of my 
> clients.
>
> The following is the C# client that I am trying to connect and publish 
> data into rabbitmq.  The client works when I am not attempting a SSL 
> connection.
>
> using System;
> using System.Collections.Generic;
> using System.Linq;
> using System.Text;
> using RabbitMQ.Client;
>
> namespace ProducerOne
> {
>     class Program
>     {
>         static void Main(string[] args)
>         {
>             string hostName = "riooverlord-1";
>             int port = 443;
>
>             int count;
>             if (args != null && args.Length == 1)
>                 count = int.Parse(args[0]);
>             else
>                 count = 1;
>
>             var connectionFactory = new ConnectionFactory();
>             connectionFactory.HostName = hostName;
>             connectionFactory.Port = port;
>             connectionFactory.Ssl.Enabled = true;
>             connectionFactory.Ssl.AcceptablePolicyErrors = 
> System.Net.Security.SslPolicyErrors.None;
>             
>             IConnection connection = connectionFactory.CreateConnection(); 
>             
>             IModel channel = connection.CreateModel();
>
>             for (int i = 0; i < count; i++)
>             {
>                 byte[] message = 
> Encoding.UTF8.GetBytes(string.Format("message {0} - {1}", i.ToString(), 
> DateTime.Now.ToString()));
>                 channel.BasicPublish(string.Empty, "QueueOne", null, 
> message);
>             }
>
>             channel.Close(); 
>             connection.Close();
>         }
>     }
> }
>
>
> The following is a dump of my rabbitMQ log file.  I have grouped the log 
> lines between xml like tags to group the different client attempts. 
>  openssl, java, and .NET
>
>
> =INFO REPORT==== 30-Jul-2012::11:28:01 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 30-Jul-2012::11:28:01 ===
> Memory limit set to 409MB of 1023MB total.
>
> =INFO REPORT==== 30-Jul-2012::11:28:03 ===
> Disk free limit set to 953MB
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> Management plugin upgraded statistics to fine.
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =WARNING REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_persistent: rebuilding indices from scratch
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> started TCP Listener on [::]:5672
>
> =INFO REPORT==== 30-Jul-2012::11:28:05 ===
> started TCP Listener on 0.0.0.0:5672
>
> =INFO REPORT==== 30-Jul-2012::11:28:06 ===
> started SSL Listener on [::]:443
>
> =INFO REPORT==== 30-Jul-2012::11:28:06 ===
> started SSL Listener on 0.0.0.0:443
>
> =INFO REPORT==== 30-Jul-2012::11:28:07 ===
> Management agent started.
>
> =INFO REPORT==== 30-Jul-2012::11:28:08 ===
> Management plugin started. Port: 55672, path: /
>
> =INFO REPORT==== 30-Jul-2012::11:28:08 ===
> Statistics database started.
>
> <openssl s_client test>
> =INFO REPORT==== 30-Jul-2012::12:08:46 ===
> accepting AMQP connection <0.19749.0> (192.168.10.157:53209 -> 
> 192.168.10.107:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:08:56 ===
> closing AMQP connection <0.19749.0> (192.168.10.157:53209 -> 
> 192.168.10.107:443):
> {handshake_timeout,handshake}
> </openssl s_client test> 
>
> <java client>
> =INFO REPORT==== 30-Jul-2012::12:30:58 ===
> accepting AMQP connection <0.30363.0> (192.168.10.157:53426 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:30:59 ===
> closing AMQP connection <0.30363.0> (192.168.10.157:53426 -> 
> 192.168.10.107:443)
> </java client>
>
> <java client>
> =INFO REPORT==== 30-Jul-2012::12:32:17 ===
> accepting AMQP connection <0.31021.0> (192.168.10.157:53436 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:32:18 ===
> closing AMQP connection <0.31021.0> (192.168.10.157:53436 -> 
> 192.168.10.107:443)
> </java client>
>
> <.net>
> =INFO REPORT==== 30-Jul-2012::12:33:01 ===
> accepting AMQP connection <0.31385.0> ([FE80::9CF9:E6C8:AAA2:E95E]:57009 
> -> [FE80::DC90:8492:EDEA:F29F]:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:33:01 ===
> ** State machine <0.31386.0> terminating 
> ** Last message in was {tcp,#Port<0.8637>,
>                             
> <<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,37,221,141,
>                               
> 253,17,32,217,19,107,158,219,100,18,72,74,101,
>                               
> 84,128,197,33,49,0,114,104,195,15,49,53,77,36,
>                               
> 199,164,103,80,172,225,140,196,41,237,52,94,192,
>                               
> 237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,
>                               
> 84,239,236,14,94,95,81,214,243,162,206,220,188,
>                               
> 94,158,6,115,212,126,162,103,173,87,166,4,48,53,
>                               50,150,185,97,176,225,0,73,247,114,66,191,88,
>                               
> 143,29,252,2,155,92,204,233,244,199,52,122,55,
>                               
> 130,100,70,122,145,184,131,116,118,196,2,179,50,
>                               
> 61,68,124,192,145,169,147,42,49,126,32,69,25,36,
>                               
> 57,217,75,204,54,156,34,217,117,139,164,114,118,
>                               
> 251,62,106,242,208,111,184,117,189,71,224,239,
>                               
> 20,92,253,137,74,191,110,114,95,129,206,58,78,
>                               
> 141,136,190,206,53,7,146,104,216,241,137,28,137,
>                               
> 20,133,25,240,230,127,70,254,228,162,130,190,53,
>                               250,227,136,156,71,192,142,184,51,124,86,203,
>                               108,235,25,32,235,83,144,185,184,208,190,238,
>                               
> 133,1,253,184,101,162,231,40,109,144,35,218,161,
>                               
> 26,4,87,13,117,249,60,35,117,112,213,236,163,18,
>                               
> 128,61,187,20,3,0,0,1,1,22,3,0,0,60,186,95,216,
>                               
> 229,210,105,198,105,85,45,183,110,174,206,104,
>                               
> 133,35,254,108,108,57,13,137,138,151,100,178,23,
>                               
> 189,147,85,254,17,117,168,182,255,204,234,195,6,
>                               
> 0,248,93,238,47,172,80,5,153,138,161,91,231,83,
>                               251,42,192,80,179>>}
> ** When State == certify
> **      Data  == {state,server,
>                      {#Ref<0.0.0.50272>,<0.31385.0>},
>                      gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                      #Port<0.8637>,
>                      {ssl_options,[],verify_peer,
>                          {#Fun<ssl.3.54384637>,
>                           #Fun<rabbit_networking.0.89858908>},
>                          false,false,undefined,1,
>                          "C:/certstore/server/cert.pem",undefined,
>                          "C:/certstore/server/key.pem",undefined,undefined,
>                         
>  undefined,"C:/certstore/testca/cacert.pem",undefined,
>                          undefined,
>                          [<<0,57>>,
>                           <<0,56>>,
>                           <<0,53>>,
>                           <<0,22>>,
>                           <<0,19>>,
>                           <<0,10>>,
>                           <<0,51>>,
>                           <<0,50>>,
>                           <<0,47>>,
>                           <<0,5>>,
>                           <<0,4>>,
>                           <<0,21>>,
>                           <<0,9>>],
>                          #Fun<ssl.0.54384637>,true,268435456,false,[],
>                          undefined,false},
>                      {socket_options,binary,0,0,0,false},
>                      {connection_states,
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,1,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,
>                                   
>  177,209,163,174,99,56,24,71,199,106,49,91,
>                                    186,189,199,117,68,234,215>>,
>                                 
>  <<80,22,197,77,73,19,16,200,132,120,47,224,
>                                   
>  160,79,3,106,44,134,25,30,170,200,151,96,89,
>                                    3,64,53,236,247,30,107>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,4,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,
>                                   
>  177,209,163,174,99,56,24,71,199,106,49,91,
>                                    186,189,199,117,68,234,215>>,
>                                 
>  <<80,22,197,77,73,19,16,200,132,120,47,224,
>                                   
>  160,79,3,106,44,134,25,30,170,200,151,96,89,
>                                    3,64,53,236,247,30,107>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined}},
>                      [],<<>>,<<>>,
>                     
>  {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
>                         
>  182,188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
>                         
>  0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                         
>  8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
>                        <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
>                          124,157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,
>                         
>  252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
>                         
>  48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
>                          0,0,0>>},
>                       
> {<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
>                         
>  182,188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
>                         
>  0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                         
>  8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
>                        <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
>                          124,157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,
>                         
>  252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
>                         
>  48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          38,0,0,0>>}},
>                      [],262221,
>                      {session,
>                         
>  <<32,144,115,251,110,148,117,72,252,193,200,232,234,
>                           
>  193,127,229,114,142,20,246,109,56,190,101,113,75,
>                            232,227,237,6,105,251>>,
>                          undefined,
>                         
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
>                           
>  9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
>                           
>  6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
>                           
>  23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
>                           
>  49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
>                           
>  48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
>                           
>  108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
>                           
>  115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
>                           
>  134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
>                           
>  10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
>                           
>  242,229,252,214,101,34,15,190,61,32,23,69,175,49,
>                           
>  141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
>                           
>  106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                           
>  104,157,167,92,224,120,142,28,102,218,176,245,195,
>                           
>  212,83,251,182,49,60,172,62,12,51,164,181,246,88,
>                           
>  136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
>                           
>  246,62,142,238,140,226,125,194,135,210,234,107,18,
>                           
>  128,76,113,52,34,199,134,34,140,80,84,35,205,142,
>                           
>  207,230,104,37,226,58,32,253,248,156,220,244,151,11,
>                           
>  22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
>                           
>  139,230,40,224,66,224,140,89,175,200,198,15,30,202,
>                           
>  248,69,32,159,182,234,202,82,247,91,75,129,24,242,
>                           
>  250,172,34,107,44,39,177,73,125,204,232,146,190,41,
>                           
>  239,6,154,165,197,220,227,183,190,17,114,215,232,
>                           
>  235,67,159,222,247,110,133,191,142,154,6,99,200,37,
>                           
>  59,120,252,161,54,91,223,191,85,104,9,121,14,184,
>                           
>  105,75,162,181,90,233,48,195,87,151,172,23,119,42,
>                           
>  211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
>                           
>  3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
>                           
>  48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                           
>  48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
>                           
>  0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
>                           
>  249,227,153,3,154,114,189,224,23,172,222,204,213,89,
>                           
>  202,98,202,252,34,116,104,112,18,98,136,6,133,201,
>                           
>  165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
>                           
>  222,154,33,131,183,215,250,104,240,205,213,224,56,
>                           
>  201,76,226,250,166,136,68,224,195,215,149,224,255,
>                           
>  162,11,156,74,159,108,185,153,46,116,32,182,58,192,
>                           
>  42,77,78,249,153,29,40,105,199,192,192,14,230,169,
>                           
>  223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                           
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
>                           
>  134,211,89,211,47,183,79,202,162,128,196,45,44,85,
>                           
>  122,172,122,58,170,117,116,151,187,96,109,186,207,
>                           
>  188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
>                           
>  154,254,145,75,227,182,44,152,36,81,103,234,99,135,
>                           
>  223,62,152,94,109,109,202,223,114,90,71,131,48,180,
>                           
>  74,83,145,93,85,218,225,135,141,226,127,85,243,186,
>                           
>  10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
>                           
>  250,152,166,230,144,155,164,240,234,78,55,198,137,
>                            227,164,67,70>>,
>                          0,
>                          <<0,5>>,
>                          undefined,new,63510870781},
>                      274512,ssl_session_cache,
>                      {3,0},
>                      undefined,true,rsa,undefined,
>                      {'RSAPrivateKey','two-prime',
>                         
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                          65537,
>                         
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                         
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                         
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                         
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                         
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                         
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                          asn1_NOVALUE},
>                      {'DHParameter',
>                         
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                          2,asn1_NOVALUE},
>                      undefined,undefined,#Ref<0.0.0.50276>,
>                      {<0.31385.0>,#Ref<0.0.0.50285>},
>                      0,<<>>,true,
>                      {false,first},
>                      undefined,
>                      {[],[]},
>                      false,true}
> ** Reason for termination = 
> ** {function_clause,
>        [{ssl_connection,handle_alert,
>             [{alert,1,41,{"ssl_connection.erl",1678}},
>              certify,
>              {state,server,
>                  {#Ref<0.0.0.50272>,<0.31385.0>},
>                  gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                  #Port<0.8637>,
>                  {ssl_options,[],verify_peer,
>                     
>  {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
>                     
>  false,false,undefined,1,"C:/certstore/server/cert.pem",
>                      undefined,"C:/certstore/server/key.pem",undefined,
>                      undefined,undefined,"C:/certstore/testca/cacert.pem",
>                      undefined,undefined,
>                      [<<0,57>>,
>                       <<0,56>>,
>                       <<0,53>>,
>                       <<0,22>>,
>                       <<0,19>>,
>                       <<0,10>>,
>                       <<0,51>>,
>                       <<0,50>>,
>                       <<0,47>>,
>                       <<0,5>>,
>                       <<0,4>>,
>                       <<0,21>>,
>                       <<0,9>>],
>                     
>  #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
>                      false},
>                  {socket_options,binary,0,0,0,false},
>                  {connection_states,
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,2,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
>                               
>  209,163,174,99,56,24,71,199,106,49,91,186,189,
>                                199,117,68,234,215>>,
>                             
>  <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
>                               
>  3,106,44,134,25,30,170,200,151,96,89,3,64,53,
>                                236,247,30,107>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,4,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
>                               
>  209,163,174,99,56,24,71,199,106,49,91,186,189,
>                                199,117,68,234,215>>,
>                             
>  <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
>                               
>  3,106,44,134,25,30,170,200,151,96,89,3,64,53,
>                                236,247,30,107>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined}},
>                  [],<<>>,<<>>,
>                 
>  {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
>                     
>  188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
>                     
>  1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
>                     
>  101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,42,0,0,0>>,
>                    <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
>                      157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,252,231,
>                     
>  192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,
>                     
>  4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                   
> {<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
>                     
>  188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
>                     
>  1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
>                     
>  101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,38,0,0,0>>,
>                    <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
>                      157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,252,231,
>                      192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,
>                     
>  85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
>                  [{ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<16,0,1,0,37,221,141,253,17,32,217,19,107,158,219,100,
>                         
> 18,72,74,101,84,128,197,33,49,0,114,104,195,15,49,53,
>                         
> 77,36,199,164,103,80,172,225,140,196,41,237,52,94,192,
>                         
> 237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,84,239,
>                         
> 236,14,94,95,81,214,243,162,206,220,188,94,158,6,115,
>                         
> 212,126,162,103,173,87,166,4,48,53,50,150,185,97,176,
>                         225,0,73,247,114,66,191,88,143,29,252,2,155,92,204,
>                         
> 233,244,199,52,122,55,130,100,70,122,145,184,131,116,
>                         
> 118,196,2,179,50,61,68,124,192,145,169,147,42,49,126,
>                         
> 32,69,25,36,57,217,75,204,54,156,34,217,117,139,164,
>                         
> 114,118,251,62,106,242,208,111,184,117,189,71,224,239,
>                         
> 20,92,253,137,74,191,110,114,95,129,206,58,78,141,136,
>                         
> 190,206,53,7,146,104,216,241,137,28,137,20,133,25,240,
>                         
> 230,127,70,254,228,162,130,190,53,250,227,136,156,71,
>                         192,142,184,51,124,86,203,108,235,25,32,235,83,144,
>                         
> 185,184,208,190,238,133,1,253,184,101,162,231,40,109,
>                         
> 144,35,218,161,26,4,87,13,117,249,60,35,117,112,213,
>                         236,163,18,128,61,187>>},
>                   {ssl_tls,undefined,20,{3,0},<<1>>},
>                   {ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<186,95,216,229,210,105,198,105,85,45,183,110,174,206,
>                         
> 104,133,35,254,108,108,57,13,137,138,151,100,178,23,
>                         189,147,85,254,17,117,168,182,255,204,234,195,6,0,
>                         
> 248,93,238,47,172,80,5,153,138,161,91,231,83,251,42,
>                         192,80,179>>}],
>                  262221,
>                  {session,
>                     
>  <<32,144,115,251,110,148,117,72,252,193,200,232,234,193,
>                       
>  127,229,114,142,20,246,109,56,190,101,113,75,232,227,
>                        237,6,105,251>>,
>                      undefined,
>                     
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
>                       
>  42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
>                       
>  4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
>                       
>  48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
>                       
>  48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
>                       
>  13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
>                       
>  15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
>                       
>  130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
>                       
>  1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
>                       
>  190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
>                       
>  69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
>                       
>  60,106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                       
>  104,157,167,92,224,120,142,28,102,218,176,245,195,212,
>                       
>  83,251,182,49,60,172,62,12,51,164,181,246,88,136,122,
>                       
>  208,186,96,220,62,57,137,103,4,26,67,30,132,246,62,142,
>                       
>  238,140,226,125,194,135,210,234,107,18,128,76,113,52,34,
>                       
>  199,134,34,140,80,84,35,205,142,207,230,104,37,226,58,
>                       
>  32,253,248,156,220,244,151,11,22,43,188,14,177,227,4,
>                       
>  188,97,24,83,79,40,16,150,139,230,40,224,66,224,140,89,
>                       
>  175,200,198,15,30,202,248,69,32,159,182,234,202,82,247,
>                       
>  91,75,129,24,242,250,172,34,107,44,39,177,73,125,204,
>                       
>  232,146,190,41,239,6,154,165,197,220,227,183,190,17,114,
>                       
>  215,232,235,67,159,222,247,110,133,191,142,154,6,99,200,
>                       
>  37,59,120,252,161,54,91,223,191,85,104,9,121,14,184,105,
>                       
>  75,162,181,90,233,48,195,87,151,172,23,119,42,211,2,3,
>                       
>  130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,
>                       
>  4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
>                       
>  29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,
>                       
>  72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,
>                       
>  222,29,196,80,45,112,118,52,202,249,227,153,3,154,114,
>                       
>  189,224,23,172,222,204,213,89,202,98,202,252,34,116,104,
>                       
>  112,18,98,136,6,133,201,165,220,4,130,95,247,113,200,31,
>                       
>  36,105,22,27,24,197,222,154,33,131,183,215,250,104,240,
>                       
>  205,213,224,56,201,76,226,250,166,136,68,224,195,215,
>                       
>  149,224,255,162,11,156,74,159,108,185,153,46,116,32,182,
>                       
>  58,192,42,77,78,249,153,29,40,105,199,192,192,14,230,
>                       
>  169,223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                       
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,134,
>                       
>  211,89,211,47,183,79,202,162,128,196,45,44,85,122,172,
>                       
>  122,58,170,117,116,151,187,96,109,186,207,188,10,72,138,
>                       
>  17,2,60,52,236,72,68,203,229,144,164,154,254,145,75,227,
>                       
>  182,44,152,36,81,103,234,99,135,223,62,152,94,109,109,
>                       
>  202,223,114,90,71,131,48,180,74,83,145,93,85,218,225,
>                       
>  135,141,226,127,85,243,186,10,50,216,220,110,91,48,135,
>                       
>  32,83,253,201,62,47,163,250,152,166,230,144,155,164,240,
>                        234,78,55,198,137,227,164,67,70>>,
>                      0,
>                      <<0,5>>,
>                      undefined,new,63510870781},
>                  274512,ssl_session_cache,
>                  {3,0},
>                  undefined,true,rsa,undefined,
>                  {'RSAPrivateKey','two-prime',
>                     
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                      65537,
>                     
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                     
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                     
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                     
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                     
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                     
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                      asn1_NOVALUE},
>                  {'DHParameter',
>                     
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                      2,asn1_NOVALUE},
>                  undefined,undefined,#Ref<0.0.0.50276>,
>                  {<0.31385.0>,#Ref<0.0.0.50285>},
>                  0,<<>>,true,
>                  {false,first},
>                  undefined,
>                  {[],[]},
>                  false,true}],
>             [{file,"ssl_connection.erl"},{line,2179}]},
>         {ssl_connection,handle_alerts,2,
>             [{file,"ssl_connection.erl"},{line,2177}]},
>         {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>
> =ERROR REPORT==== 30-Jul-2012::12:33:01 ===
> error on AMQP connection <0.31385.0>: {ssl_upgrade_failure,
>                                        {{function_clause,
>                                          [{ssl_connection,handle_alert,
>                                            [{alert,1,41,
>                                              {"ssl_connection.erl",1678}},
>                                             certify,
>                                             {state,server,
>                                             
>  {#Ref<0.0.0.50272>,<0.31385.0>},
>                                             
>  gen_tcp,tcp,tcp_closed,tcp_error,
>                                              "localhost",443,#Port<0.8637>,
>                                              {ssl_options,[],verify_peer,
>                                               {#Fun<ssl.3.54384637>,
>                                               
>  #Fun<rabbit_networking.0.89858908>},
>                                               false,false,undefined,1,
>                                               
> "C:/certstore/server/cert.pem",
>                                               undefined,
>                                               
> "C:/certstore/server/key.pem",
>                                               
> undefined,undefined,undefined,
>                                               
> "C:/certstore/testca/cacert.pem",
>                                               undefined,undefined,
>                                               [<<0,57>>,
>                                                <<0,56>>,
>                                                <<0,53>>,
>                                                <<0,22>>,
>                                                <<0,19>>,
>                                                <<0,10>>,
>                                                <<0,51>>,
>                                                <<0,50>>,
>                                                <<0,47>>,
>                                                <<0,5>>,
>                                                <<0,4>>,
>                                                <<0,21>>,
>                                                <<0,9>>],
>                                               #Fun<ssl.0.54384637>,true,
>                                               268435456,false,[],undefined,
>                                               false},
>                                              {socket_options,binary,0,0,0,
>                                               false},
>                                              {connection_states,
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,0>>,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,undefined,
>                                                 
> undefined,undefined,undefined},
>                                               
>  undefined,undefined,undefined,
>                                                2,true,undefined,undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,5>>,
>                                                 0,1,0,0,128,16,16,2,20,0,
>                                                 undefined,
>                                                 
> <<80,22,197,78,29,58,72,186,12,
>                                                   
> 107,61,151,17,177,209,163,
>                                                   
> 174,99,56,24,71,199,106,49,
>                                                   
> 91,186,189,199,117,68,234,215>>,
>                                                 
> <<80,22,197,77,73,19,16,200,
>                                                   
> 132,120,47,224,160,79,3,106,
>                                                   
> 44,134,25,30,170,200,151,96,
>                                                   
> 89,3,64,53,236,247,30,107>>,
>                                                 undefined},
>                                               
>  undefined,undefined,undefined,
>                                                undefined,true,undefined,
>                                                undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,0>>,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,undefined,
>                                                 
> undefined,undefined,undefined},
>                                               
>  undefined,undefined,undefined,
>                                                4,true,undefined,undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,5>>,
>                                                 0,1,0,0,128,16,16,2,20,0,
>                                                 undefined,
>                                                 
> <<80,22,197,78,29,58,72,186,12,
>                                                   
> 107,61,151,17,177,209,163,
>                                                   
> 174,99,56,24,71,199,106,49,
>                                                   
> 91,186,189,199,117,68,234,215>>,
>                                                 
> <<80,22,197,77,73,19,16,200,
>                                                   
> 132,120,47,224,160,79,3,106,
>                                                   
> 44,134,25,30,170,200,151,96,
>                                                   
> 89,3,64,53,236,247,30,107>>,
>                                                 undefined},
>                                               
>  undefined,undefined,undefined,
>                                                undefined,true,undefined,
>                                                undefined}},
>                                              [],<<>>,<<>>,
>                                             
>  {{<<107,195,247,68,168,208,252,17,
>                                                 
>  160,186,113,157,135,198,182,
>                                                 
>  188,80,51,0,0,0,0,0,0,24,54,
>                                                 
>  90,252,231,192,148,13,0,0,27,
>                                                 
>  1,1,0,23,0,21,48,19,49,17,48,
>                                                 
>  15,6,3,85,4,3,19,8,77,121,84,
>                                                 
>  101,115,116,67,65,14,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,0,42,0,0,0>>,
>                                               
>  <<164,73,160,132,230,249,118,
>                                                 
>  68,17,25,226,99,197,97,124,
>                                                 
>  157,16,251,186,197,80,51,0,0,
>                                                 
>  0,0,0,0,24,54,90,252,231,192,
>                                                 
>  148,13,0,0,27,1,1,0,23,0,21,
>                                                 
>  48,19,49,17,48,15,6,3,85,4,3,
>                                                 
>  19,8,77,121,84,101,115,116,
>                                                 
>  67,65,14,0,0,0,0,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,42,0,0,0>>},
>                                               
> {<<107,195,247,68,168,208,252,17,
>                                                 
>  160,186,113,157,135,198,182,
>                                                 
>  188,48,51,0,0,0,0,0,0,24,54,
>                                                 
>  90,252,231,192,148,13,0,0,27,
>                                                 
>  1,1,0,23,0,21,48,19,49,17,48,
>                                                 
>  15,6,3,85,4,3,19,8,77,121,84,
>                                                 
>  101,115,116,67,65,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,38,0,0,0>>,
>                                               
>  <<164,73,160,132,230,249,118,
>                                                 
>  68,17,25,226,99,197,97,124,
>                                                 
>  157,16,251,186,197,48,51,0,
>                                                 
>  0,0,0,0,0,24,54,90,252,231,
>                                                 
>  192,148,13,0,0,27,1,1,0,23,
>                                                 
>  0,21,48,19,49,17,48,15,6,3,
>                                                  85,4,3,19,8,77,121,84,101,
>                                                 
>  115,116,67,65,0,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,38,0,0,0>>}},
>                                              [{ssl_tls,undefined,22,
>                                                {3,0},
>                                               
>  <<16,0,1,0,37,221,141,253,17,
>                                                 
>  32,217,19,107,158,219,100,18,
>                                                 
>  72,74,101,84,128,197,33,49,0,
>                                                 
>  114,104,195,15,49,53,77,36,
>                                                 
>  199,164,103,80,172,225,140,
>                                                 
>  196,41,237,52,94,192,237,8,8,
>                                                 
>  60,9,59,19,181,87,174,84,219,
>                                                 
>  50,35,22,84,239,236,14,94,95,
>                                                 
>  81,214,243,162,206,220,188,
>                                                 
>  94,158,6,115,212,126,162,103,
>                                                  173,87,166,4,48,53,50,150,
>                                                 
>  185,97,176,225,0,73,247,114,
>                                                 
>  66,191,88,143,29,252,2,155,
>                                                 
>  92,204,233,244,199,52,122,55,
>                                                 
>  130,100,70,122,145,184,131,
>                                                 
>  116,118,196,2,179,50,61,68,
>                                                  124,192,145,169,147,42,49,
>                                                  126,32,69,25,36,57,217,75,
>                                                  204,54,156,34,217,117,139,
>                                                 
>  164,114,118,251,62,106,242,
>                                                 
>  208,111,184,117,189,71,224,
>                                                 
>  239,20,92,253,137,74,191,110,
>                                                 
>  114,95,129,206,58,78,141,136,
>                                                 
>  190,206,53,7,146,104,216,241,
>                                                 
>  137,28,137,20,133,25,240,230,
>                                                 
>  127,70,254,228,162,130,190,
>                                                  53,250,227,136,156,71,192,
>                                                  142,184,51,124,86,203,108,
>                                                 
>  235,25,32,235,83,144,185,184,
>                                                  208,190,238,133,1,253,184,
>                                                  101,162,231,40,109,144,35,
>                                                 
>  218,161,26,4,87,13,117,249,
>                                                 
>  60,35,117,112,213,236,163,18,
>                                                  128,61,187>>},
>                                               {ssl_tls,undefined,20,
>                                                {3,0},
>                                                <<1>>},
>                                               {ssl_tls,undefined,22,
>                                                {3,0},
>                                               
>  <<186,95,216,229,210,105,198,
>                                                  105,85,45,183,110,174,206,
>                                                  104,133,35,254,108,108,57,
>                                                  13,137,138,151,100,178,23,
>                                                  189,147,85,254,17,117,168,
>                                                 
>  182,255,204,234,195,6,0,248,
>                                                 
>  93,238,47,172,80,5,153,138,
>                                                 
>  161,91,231,83,251,42,192,80,
>                                                  179>>}],
>                                              262221,
>                                              {session,
>                                               
> <<32,144,115,251,110,148,117,72,
>                                                 
> 252,193,200,232,234,193,127,
>                                                 
> 229,114,142,20,246,109,56,190,
>                                                 
> 101,113,75,232,227,237,6,105,
>                                                 251>>,
>                                               undefined,
>                                               
> <<48,130,2,230,48,130,1,206,160,
>                                                 
> 3,2,1,2,2,1,1,48,13,6,9,42,134,
>                                                 
> 72,134,247,13,1,1,5,5,0,48,19,
>                                                 
> 49,17,48,15,6,3,85,4,3,19,8,77,
>                                                 
> 121,84,101,115,116,67,65,48,30,
>                                                 
> 23,13,49,50,48,55,51,48,49,50,
>                                                 
> 53,54,52,54,90,23,13,49,51,48,
>                                                 
> 55,51,48,49,50,53,54,52,54,90,
>                                                 
> 48,41,49,22,48,20,6,3,85,4,3,
>                                                 
> 12,13,114,105,111,111,118,101,
>                                                 
> 114,108,111,114,100,45,49,49,
>                                                 
> 15,48,13,6,3,85,4,10,12,6,115,
>                                                 
> 101,114,118,101,114,48,130,1,
>                                                 
> 34,48,13,6,9,42,134,72,134,247,
>                                                 
> 13,1,1,1,5,0,3,130,1,15,0,48,
>                                                 
> 130,1,10,2,130,1,1,0,163,99,
>                                                 
> 255,119,11,217,190,17,106,102,
>                                                 
> 242,229,252,214,101,34,15,190,
>                                                 
> 61,32,23,69,175,49,141,78,38,
>                                                 
> 16,202,80,88,96,12,88,193,17,
>                                                 
> 57,226,60,106,35,93,184,216,
>                                                 
> 167,217,0,102,117,69,97,209,60,
>                                                 
> 27,104,157,167,92,224,120,142,
>                                                 
> 28,102,218,176,245,195,212,83,
>                                                 
> 251,182,49,60,172,62,12,51,164,
>                                                 
> 181,246,88,136,122,208,186,96,
>                                                 
> 220,62,57,137,103,4,26,67,30,
>                                                 
> 132,246,62,142,238,140,226,125,
>                                                 
> 194,135,210,234,107,18,128,76,
>                                                 
> 113,52,34,199,134,34,140,80,84,
>                                                 
> 35,205,142,207,230,104,37,226,
>                                                 
> 58,32,253,248,156,220,244,151,
>                                                 
> 11,22,43,188,14,177,227,4,188,
>                                                 
> 97,24,83,79,40,16,150,139,230,
>                                                 
> 40,224,66,224,140,89,175,200,
>                                                 
> 198,15,30,202,248,69,32,159,
>                                                 
> 182,234,202,82,247,91,75,129,
>                                                 
> 24,242,250,172,34,107,44,39,
>                                                 
> 177,73,125,204,232,146,190,41,
>                                                 
> 239,6,154,165,197,220,227,183,
>                                                 
> 190,17,114,215,232,235,67,159,
>                                                 
> 222,247,110,133,191,142,154,6,
>                                                 
> 99,200,37,59,120,252,161,54,91,
>                                                 
> 223,191,85,104,9,121,14,184,
>                                                 
> 105,75,162,181,90,233,48,195,
>                                                 
> 87,151,172,23,119,42,211,2,3,
>                                                 
> 130,228,61,83,2,3,1,0,1,163,47,
>                                                 
> 48,45,48,9,6,3,85,29,19,4,2,48,
>                                                 
> 0,48,11,6,3,85,29,15,4,4,3,2,5,
>                                                 
> 32,48,19,6,3,85,29,37,4,12,48,
>                                                 
> 10,6,8,43,6,1,5,5,7,3,1,48,13,
>                                                 
> 6,9,42,134,72,134,247,13,1,1,5,
>                                                 
> 5,0,3,130,1,1,0,222,44,95,61,
>                                                 
> 253,222,29,196,80,45,112,118,
>                                                 
> 52,202,249,227,153,3,154,114,
>                                                 
> 189,224,23,172,222,204,213,89,
>                                                 
> 202,98,202,252,34,116,104,112,
>                                                 
> 18,98,136,6,133,201,165,220,4,
>                                                 
> 130,95,247,113,200,31,36,105,
>                                                 
> 22,27,24,197,222,154,33,131,
>                                                 
> 183,215,250,104,240,205,213,
>                                                 
> 224,56,201,76,226,250,166,136,
>                                                 
> 68,224,195,215,149,224,255,162,
>                                                 
> 11,156,74,159,108,185,153,46,
>                                                 
> 116,32,182,58,192,42,77,78,249,
>                                                 
> 153,29,40,105,199,192,192,14,
>                                                 
> 230,169,223,199,172,53,122,145,
>                                                 
> 127,57,110,56,67,139,94,115,57,
>                                                 
> 55,116,11,212,76,212,44,180,72,
>                                                 
> 244,150,141,6,207,134,211,89,
>                                                 
> 211,47,183,79,202,162,128,196,
>                                                 
> 45,44,85,122,172,122,58,170,
>                                                 
> 117,116,151,187,96,109,186,207,
>                                                 
> 188,10,72,138,17,2,60,52,236,
>                                                 
> 72,68,203,229,144,164,154,254,
>                                                 
> 145,75,227,182,44,152,36,81,
>                                                 
> 103,234,99,135,223,62,152,94,
>                                                 
> 109,109,202,223,114,90,71,131,
>                                                 
> 48,180,74,83,145,93,85,218,225,
>                                                 
> 135,141,226,127,85,243,186,10,
>                                                 
> 50,216,220,110,91,48,135,32,83,
>                                                 
> 253,201,62,47,163,250,152,166,
>                                                 
> 230,144,155,164,240,234,78,55,
>                                                 198,137,227,164,67,70>>,
>                                               0,
>                                               <<0,5>>,
>                                               undefined,new,63510870781},
>                                              274512,ssl_session_cache,
>                                              {3,0},
>                                              undefined,true,rsa,undefined,
>                                              {'RSAPrivateKey','two-prime',
>                                               
> 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                                               65537,
>                                               
> 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                                               
> 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                                               
> 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                                               
> 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                                               
> 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                                               
> 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                                               asn1_NOVALUE},
>                                              {'DHParameter',
>                                               
> 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                                               2,asn1_NOVALUE},
>                                              undefined,undefined,
>                                              #Ref<0.0.0.50276>,
>                                             
>  {<0.31385.0>,#Ref<0.0.0.50285>},
>                                              0,<<>>,true,
>                                              {false,first},
>                                              undefined,
>                                              {[],[]},
>                                              false,true}],
>                                            [{file,"ssl_connection.erl"},
>                                             {line,2179}]},
>                                           {ssl_connection,handle_alerts,2,
>                                            [{file,"ssl_connection.erl"},
>                                             {line,2177}]},
>                                           {gen_fsm,handle_msg,7,
>                                           
>  [{file,"gen_fsm.erl"},{line,494}]},
>                                           {proc_lib,init_p_do_apply,3,
>                                            [{file,"proc_lib.erl"},
>                                             {line,227}]}]},
>                                         {gen_fsm,sync_send_all_state_event,
>                                          [<0.31386.0>,start,5000]}}}
> </.net>
>
> <java>
> =INFO REPORT==== 30-Jul-2012::12:36:39 ===
> accepting AMQP connection <0.342.1> (192.168.10.157:53463 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:36:40 ===
> closing AMQP connection <0.342.1> (192.168.10.157:53463 -> 
> 192.168.10.107:443)
> </java>
>
> <openssl>
> =INFO REPORT==== 30-Jul-2012::12:36:46 ===
> accepting AMQP connection <0.419.1> (192.168.10.157:53464 -> 
> 192.168.10.107:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:36:51 ===
> closing AMQP connection <0.419.1> (192.168.10.157:53464 -> 
> 192.168.10.107:443):
> {bad_version,10,10,10,10}
> </openssl>
>
> <.net>
> =INFO REPORT==== 30-Jul-2012::12:43:58 ===
> accepting AMQP connection <0.3888.1> ([FE80::9CF9:E6C8:AAA2:E95E]:57040 -> 
> [FE80::DC90:8492:EDEA:F29F]:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:43:58 ===
> ** State machine <0.3889.1> terminating 
> ** Last message in was {tcp,#Port<0.8968>,
>                             
> <<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,13,149,79,
>                               
> 68,242,219,55,33,132,16,78,131,203,216,134,82,
>                               
> 174,2,104,224,25,10,69,244,189,175,235,223,106,
>                               
> 45,186,155,55,99,237,33,164,234,55,53,210,3,243,
>                               
> 167,173,216,218,142,61,49,55,108,94,229,157,57,
>                               
> 65,152,150,104,244,4,248,47,159,188,27,115,22,
>                               
> 176,202,177,230,100,242,152,230,216,64,87,7,88,
>                               
> 206,101,137,11,61,214,170,45,226,106,24,133,184,
>                               53,215,16,85,173,26,76,22,71,236,163,220,163,
>                               
> 198,105,253,57,252,199,21,111,171,20,59,238,66,
>                               
> 255,32,129,232,2,110,140,48,215,124,215,101,193,
>                               
> 77,70,48,12,192,100,149,167,33,214,90,232,214,
>                               
> 188,72,182,193,115,137,185,198,135,213,168,214,
>                               
> 68,180,170,204,32,157,92,121,79,219,215,147,140,
>                               21,215,151,41,254,22,64,224,33,217,40,66,213,
>                               175,157,29,114,38,133,252,112,102,104,185,76,
>                               
> 231,12,236,87,176,162,138,29,15,168,220,218,231,
>                               
> 131,230,243,106,157,193,42,63,8,9,49,203,208,76,
>                               
> 250,159,76,187,179,2,183,83,199,70,237,161,192,
>                               221,12,4,228,227,107,196,161,231,171,118,233,
>                               
> 240,24,122,209,118,132,27,20,3,0,0,1,1,22,3,0,0,
>                               
> 60,202,190,24,80,89,105,254,68,94,146,20,33,11,
>                               8,52,82,120,141,183,75,210,23,34,29,85,28,45,
>                               
> 236,35,40,199,167,111,94,144,170,240,48,75,136,
>                               
> 116,63,197,216,54,26,61,171,134,80,82,163,26,75,
>                               50,152,15,181,218,235>>}
> ** When State == certify
> **      Data  == {state,server,
>                      {#Ref<0.0.0.58837>,<0.3888.1>},
>                      gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                      #Port<0.8968>,
>                      {ssl_options,[],verify_peer,
>                          {#Fun<ssl.3.54384637>,
>                           #Fun<rabbit_networking.0.89858908>},
>                          false,false,undefined,1,
>                          "C:/certstore/server/cert.pem",undefined,
>                          "C:/certstore/server/key.pem",undefined,undefined,
>                         
>  undefined,"C:/certstore/testca/cacert.pem",undefined,
>                          undefined,
>                          [<<0,57>>,
>                           <<0,56>>,
>                           <<0,53>>,
>                           <<0,22>>,
>                           <<0,19>>,
>                           <<0,10>>,
>                           <<0,51>>,
>                           <<0,50>>,
>                           <<0,47>>,
>                           <<0,5>>,
>                           <<0,4>>,
>                           <<0,21>>,
>                           <<0,9>>],
>                          #Fun<ssl.0.54384637>,true,268435456,false,[],
>                          undefined,false},
>                      {socket_options,binary,0,0,0,false},
>                      {connection_states,
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,1,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,199,223,40,186,235,18,229,68,117,41,
>                                   
>  146,137,237,216,114,239,54,7,165,33,37,94,
>                                    57,110,228,3,62,87,25,210>>,
>                                 
>  <<80,22,199,222,169,174,5,18,190,32,21,236,
>                                   
>  199,246,168,19,117,78,229,208,48,132,253,20,
>                                    180,170,31,49,53,31,120,40>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,4,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,199,223,40,186,235,18,229,68,117,41,
>                                   
>  146,137,237,216,114,239,54,7,165,33,37,94,
>                                    57,110,228,3,62,87,25,210>>,
>                                 
>  <<80,22,199,222,169,174,5,18,190,32,21,236,
>                                   
>  199,246,168,19,117,78,229,208,48,132,253,20,
>                                    180,170,31,49,53,31,120,40>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined}},
>                      [],<<>>,<<>>,
>                     
>  {{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,
>                         
>  209,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,
>                         
>  27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,
>                         
>  121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
>                       
>  <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,
>                         
>  137,71,51,20,230,80,51,0,0,0,0,0,0,24,54,90,252,231,
>                         
>  192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,
>                         
>  3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                       
> {<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,
>                         
>  209,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,
>                         
>  27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,
>                         
>  121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
>                        <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,
>                         
>  128,137,71,51,20,230,48,51,0,0,0,0,0,0,24,54,90,252,
>                         
>  231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,
>                         
>  15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,
>                          0,0,0>>}},
>                      [],262221,
>                      {session,
>                         
>  <<120,172,49,23,82,227,196,133,69,243,102,137,72,209,
>                           
>  109,38,212,150,216,237,102,171,222,27,8,24,94,130,
>                            47,132,52,140>>,
>                          undefined,
>                         
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
>                           
>  9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
>                           
>  6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
>                           
>  23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
>                           
>  49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
>                           
>  48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
>                           
>  108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
>                           
>  115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
>                           
>  134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
>                           
>  10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
>                           
>  242,229,252,214,101,34,15,190,61,32,23,69,175,49,
>                           
>  141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
>                           
>  106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                           
>  104,157,167,92,224,120,142,28,102,218,176,245,195,
>                           
>  212,83,251,182,49,60,172,62,12,51,164,181,246,88,
>                           
>  136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
>                           
>  246,62,142,238,140,226,125,194,135,210,234,107,18,
>                           
>  128,76,113,52,34,199,134,34,140,80,84,35,205,142,
>                           
>  207,230,104,37,226,58,32,253,248,156,220,244,151,11,
>                           
>  22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
>                           
>  139,230,40,224,66,224,140,89,175,200,198,15,30,202,
>                           
>  248,69,32,159,182,234,202,82,247,91,75,129,24,242,
>                           
>  250,172,34,107,44,39,177,73,125,204,232,146,190,41,
>                           
>  239,6,154,165,197,220,227,183,190,17,114,215,232,
>                           
>  235,67,159,222,247,110,133,191,142,154,6,99,200,37,
>                           
>  59,120,252,161,54,91,223,191,85,104,9,121,14,184,
>                           
>  105,75,162,181,90,233,48,195,87,151,172,23,119,42,
>                           
>  211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
>                           
>  3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
>                           
>  48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                           
>  48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
>                           
>  0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
>                           
>  249,227,153,3,154,114,189,224,23,172,222,204,213,89,
>                           
>  202,98,202,252,34,116,104,112,18,98,136,6,133,201,
>                           
>  165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
>                           
>  222,154,33,131,183,215,250,104,240,205,213,224,56,
>                           
>  201,76,226,250,166,136,68,224,195,215,149,224,255,
>                           
>  162,11,156,74,159,108,185,153,46,116,32,182,58,192,
>                           
>  42,77,78,249,153,29,40,105,199,192,192,14,230,169,
>                           
>  223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                           
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
>                           
>  134,211,89,211,47,183,79,202,162,128,196,45,44,85,
>                           
>  122,172,122,58,170,117,116,151,187,96,109,186,207,
>                           
>  188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
>                           
>  154,254,145,75,227,182,44,152,36,81,103,234,99,135,
>                           
>  223,62,152,94,109,109,202,223,114,90,71,131,48,180,
>                           
>  74,83,145,93,85,218,225,135,141,226,127,85,243,186,
>                           
>  10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
>                           
>  250,152,166,230,144,155,164,240,234,78,55,198,137,
>                            227,164,67,70>>,
>                          0,
>                          <<0,5>>,
>                          undefined,new,63510871438},
>                      274512,ssl_session_cache,
>                      {3,0},
>                      undefined,true,rsa,undefined,
>                      {'RSAPrivateKey','two-prime',
>                         
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                          65537,
>                         
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                         
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                         
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                         
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                         
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                         
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                          asn1_NOVALUE},
>                      {'DHParameter',
>                         
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                          2,asn1_NOVALUE},
>                      undefined,undefined,#Ref<0.0.0.58841>,
>                      {<0.3888.1>,#Ref<0.0.0.58850>},
>                      0,<<>>,true,
>                      {false,first},
>                      undefined,
>                      {[],[]},
>                      false,true}
> ** Reason for termination = 
> ** {function_clause,
>        [{ssl_connection,handle_alert,
>             [{alert,1,41,{"ssl_connection.erl",1678}},
>              certify,
>              {state,server,
>                  {#Ref<0.0.0.58837>,<0.3888.1>},
>                  gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                  #Port<0.8968>,
>                  {ssl_options,[],verify_peer,
>                     
>  {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
>                     
>  false,false,undefined,1,"C:/certstore/server/cert.pem",
>                      undefined,"C:/certstore/server/key.pem",undefined,
>                      undefined,undefined,"C:/certstore/testca/cacert.pem",
>                      undefined,undefined,
>                      [<<0,57>>,
>                       <<0,56>>,
>                       <<0,53>>,
>                       <<0,22>>,
>                       <<0,19>>,
>                       <<0,10>>,
>                       <<0,51>>,
>                       <<0,50>>,
>                       <<0,47>>,
>                       <<0,5>>,
>                       <<0,4>>,
>                       <<0,21>>,
>                       <<0,9>>],
>                     
>  #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
>                      false},
>                  {socket_options,binary,0,0,0,false},
>                  {connection_states,
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,2,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,199,223,40,186,235,18,229,68,117,41,146,
>                               
>  137,237,216,114,239,54,7,165,33,37,94,57,110,
>                                228,3,62,87,25,210>>,
>                             
>  <<80,22,199,222,169,174,5,18,190,32,21,236,199,
>                               
>  246,168,19,117,78,229,208,48,132,253,20,180,170,
>                                31,49,53,31,120,40>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,4,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,199,223,40,186,235,18,229,68,117,41,146,
>                               
>  137,237,216,114,239,54,7,165,33,37,94,57,110,
>                                228,3,62,87,25,210>>,
>                             
>  <<80,22,199,222,169,174,5,18,190,32,21,236,199,
>                               
>  246,168,19,117,78,229,208,48,132,253,20,180,170,
>                                31,49,53,31,120,40>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined}},
>                  [],<<>>,<<>>,
>                 
>  {{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,209,
>                     
>  80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,1,1,
>                     
>  0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,
>                     
>  115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,42,0,0,0>>,
>                   
>  <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,137,
>                     
>  71,51,20,230,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,
>                     
>  13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                     
>  8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                   
> {<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,209,
>                     
>  48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,1,1,
>                     
>  0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,
>                     
>  115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,38,0,0,0>>,
>                    <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,
>                     
>  137,71,51,20,230,48,51,0,0,0,0,0,0,24,54,90,252,231,192,
>                     
>  148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,
>                     
>  3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
>                  [{ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<16,0,1,0,13,149,79,68,242,219,55,33,132,16,78,131,203,
>                         
> 216,134,82,174,2,104,224,25,10,69,244,189,175,235,223,
>                         
> 106,45,186,155,55,99,237,33,164,234,55,53,210,3,243,
>                         
> 167,173,216,218,142,61,49,55,108,94,229,157,57,65,152,
>                         150,104,244,4,248,47,159,188,27,115,22,176,202,177,
>                         
> 230,100,242,152,230,216,64,87,7,88,206,101,137,11,61,
>                         
> 214,170,45,226,106,24,133,184,53,215,16,85,173,26,76,
>                         
> 22,71,236,163,220,163,198,105,253,57,252,199,21,111,
>                         
> 171,20,59,238,66,255,32,129,232,2,110,140,48,215,124,
>                         
> 215,101,193,77,70,48,12,192,100,149,167,33,214,90,232,
>                         
> 214,188,72,182,193,115,137,185,198,135,213,168,214,68,
>                         
> 180,170,204,32,157,92,121,79,219,215,147,140,21,215,
>                         
> 151,41,254,22,64,224,33,217,40,66,213,175,157,29,114,
>                         
> 38,133,252,112,102,104,185,76,231,12,236,87,176,162,
>                         
> 138,29,15,168,220,218,231,131,230,243,106,157,193,42,
>                         
> 63,8,9,49,203,208,76,250,159,76,187,179,2,183,83,199,
>                         
> 70,237,161,192,221,12,4,228,227,107,196,161,231,171,
>                         118,233,240,24,122,209,118,132,27>>},
>                   {ssl_tls,undefined,20,{3,0},<<1>>},
>                   {ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<202,190,24,80,89,105,254,68,94,146,20,33,11,8,52,82,
>                         120,141,183,75,210,23,34,29,85,28,45,236,35,40,199,
>                         167,111,94,144,170,240,48,75,136,116,63,197,216,54,
>                         
> 26,61,171,134,80,82,163,26,75,50,152,15,181,218,235>>}],
>                  262221,
>                  {session,
>                     
>  <<120,172,49,23,82,227,196,133,69,243,102,137,72,209,109,
>                       
>  38,212,150,216,237,102,171,222,27,8,24,94,130,47,132,52,
>                        140>>,
>                      undefined,
>                     
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
>                       
>  42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
>                       
>  4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
>                       
>  48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
>                       
>  48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
>                       
>  13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
>                       
>  15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
>                       
>  130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
>                       
>  1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
>                       
>  190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
>                       
>  69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
>                       
>  60,106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                       
>  104,157,167,92,224,120,142,28,102,218,176,245,195,212,
>                       
>  83,251,182,49,60,172,62,12,51,164,181,246,88,136,122,
>                       
>  208,186,96,220,62,57,137,103,4,26,67,30,132,246,62,142,
>                       
>  238,140,226,125,194,135,210,234,107,18,128,76,113,52,34,
>                       
>  199,134,34,140,80,84,35,205,142,207,230,104,37,226,58,
>                       
>  32,253,248,156,220,244,151,11,22,43,188,14,177,227,4,
>                       
>  188,97,24,83,79,40,16,150,139,230,40,224,66,224,140,89,
>                       
>  175,200,198,15,30,202,248,69,32,159,182,234,202,82,247,
>                       
>  91,75,129,24,242,250,172,34,107,44,39,177,73,125,204,
>                       
>  232,146,190,41,239,6,154,165,197,220,227,183,190,17,114,
>                       
>  215,232,235,67,159,222,247,110,133,191,142,154,6,99,200,
>                       
>  37,59,120,252,161,54,91,223,191,85,104,9,121,14,184,105,
>                       
>  75,162,181,90,233,48,195,87,151,172,23,119,42,211,2,3,
>                       
>  130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,
>                       
>  4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
>                       
>  29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,
>                       
>  72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,
>                       
>  222,29,196,80,45,112,118,52,202,249,227,153,3,154,114,
>                       
>  189,224,23,172,222,204,213,89,202,98,202,252,34,116,104,
>                       
>  112,18,98,136,6,133,201,165,220,4,130,95,247,113,200,31,
>                       
>  36,105,22,27,24,197,222,154,33,131,183,215,250,104,240,
>                       
>  205,213,224,56,201,76,226,250,166,136,68,224,195,215,
>                       
>  149,224,255,162,11,156,74,159,108,185,153,46,116,32,182,
>                       
>  58,192,42,77,78,249,153,29,40,105,199,192,192,14,230,
>                       
>  169,223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                       
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,134,
>                       
>  211,89,211,47,183,79,202,162,128,196,45,44,85,122,172,
>                       
>  122,58,170,117,116,151,187,96,109,186,207,188,10,72,138,
>                       
>  17,2,60,52,236,72,68,203,229,144,164,154,254,145,75,227,
>                       
>  182,44,152,36,81,103,234,99,135,223,62,152,94,109,109,
>                       
>  202,223,114,90,71,131,48,180,74,83,145,93,85,218,225,
>                       
>  135,141,226,127,85,243,186,10,50,216,220,110,91,48,135,
>                       
>  32,83,253,201,62,47,163,250,152,166,230,144,155,164,240,
>                        234,78,55,198,137,227,164,67,70>>,
>                      0,
>                      <<0,5>>,
>                      undefined,new,63510871438},
>                  274512,ssl_session_cache,
>                  {3,0},
>                  undefined,true,rsa,undefined,
>                  {'RSAPrivateKey','two-prime',
>                     
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                      65537,
>                     
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                     
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                     
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                     
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                     
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                     
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                      asn1_NOVALUE},
>                  {'DHParameter',
>                     
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                      2,asn1_NOVALUE},
>                  undefined,undefined,#Ref<0.0.0.58841>,
>                  {<0.3888.1>,#Ref<0.0.0.58850>},
>                  0,<<>>,true,
>                  {false,first},
>                  undefined,
>                  {[],[]},
>                  false,true}],
>             [{file,"ssl_connection.erl"},{line,2179}]},
>         {ssl_connection,handle_alerts,2,
>             [{file,"ssl_connection.erl"},{line,2177}]},
>         {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>
> =ERROR REPORT==== 30-Jul-2012::12:43:58 ===
> error on AMQP connection <0.3888.1>: {ssl_upgrade_failure,
>                                       {{function_clause,
>                                         [{ssl_connection,handle_alert,
>                                           [{alert,1,41,
>                                             {"ssl_connection.erl",1678}},
>                                            certify,
>                                            {state,server,
>                                             {#Ref<0.0.0.58837>,<0.3888.1>},
>                                             
> gen_tcp,tcp,tcp_closed,tcp_error,
>                                             "localhost",443,#Port<0.8968>,
>                                             {ssl_options,[],verify_peer,
>                                              {#Fun<ssl.3.54384637>,
>                                               
> #Fun<rabbit_networking.0.89858908>},
>                                              false,false,undefined,1,
>                                             
>  "C:/certstore/server/cert.pem",
>                                              undefined,
>                                              "C:/certstore/server/key.pem",
>                                              undefined,undefined,undefined,
>                                             
>  "C:/certstore/testca/cacert.pem",
>                                              undefined,undefined,
>                                              [<<0,57>>,
>                                               <<0,56>>,
>                                               <<0,53>>,
>                                               <<0,22>>,
>                                               <<0,19>>,
>                                               <<0,10>>,
>                                               <<0,51>>,
>                                               <<0,50>>,
>                                               <<0,47>>,
>                                               <<0,5>>,
>                                               <<0,4>>,
>                                               <<0,21>>,
>                                               <<0,9>>],
>                                              #Fun<ssl.0.54384637>,true,
>                                              268435456,false,[],undefined,
>                                              false},
>                                             {socket_options,binary,0,0,0,
>                                              false},
>                                             {connection_states,
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,0>>,
>                                               
>  0,0,0,0,0,0,0,0,0,0,undefined,
>                                               
>  undefined,undefined,undefined},
>                                               
> undefined,undefined,undefined,2,
>                                               true,undefined,undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,5>>,
>                                                0,1,0,0,128,16,16,2,20,0,
>                                                undefined,
>                                               
>  <<80,22,199,223,40,186,235,18,
>                                                 
>  229,68,117,41,146,137,237,216,
>                                                 
>  114,239,54,7,165,33,37,94,57,
>                                                  110,228,3,62,87,25,210>>,
>                                               
>  <<80,22,199,222,169,174,5,18,
>                                                 
>  190,32,21,236,199,246,168,19,
>                                                 
>  117,78,229,208,48,132,253,20,
>                                                 
>  180,170,31,49,53,31,120,40>>,
>                                                undefined},
>                                               
> undefined,undefined,undefined,
>                                               undefined,true,undefined,
>                                               undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,0>>,
>                                               
>  0,0,0,0,0,0,0,0,0,0,undefined,
>                                               
>  undefined,undefined,undefined},
>                                               
> undefined,undefined,undefined,4,
>                                               true,undefined,undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,5>>,
>                                                0,1,0,0,128,16,16,2,20,0,
>                                                undefined,
>                                               
>  <<80,22,199,223,40,186,235,18,
>                                                 
>  229,68,117,41,146,137,237,216,
>                                                 
>  114,239,54,7,165,33,37,94,57,
>                                                  110,228,3,62,87,25,210>>,
>                                               
>  <<80,22,199,222,169,174,5,18,
>                                                 
>  190,32,21,236,199,246,168,19,
>                                                 
>  117,78,229,208,48,132,253,20,
>                                                 
>  180,170,31,49,53,31,120,40>>,
>                                                undefined},
>                                               
> undefined,undefined,undefined,
>                                               undefined,true,undefined,
>                                               undefined}},
>                                             [],<<>>,<<>>,
>                                             
> {{<<31,32,233,180,58,12,212,253,
>                                                 
> 218,229,84,250,254,74,36,209,
>                                                 
> 80,51,0,0,0,0,0,0,24,54,90,252,
>                                                 
> 231,192,148,13,0,0,27,1,1,0,23,
>                                                 
> 0,21,48,19,49,17,48,15,6,3,85,
>                                                 
> 4,3,19,8,77,121,84,101,115,116,
>                                                 
> 67,65,14,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
>                                                 0,0,0>>,
>                                               <<225,51,90,230,223,74,48,11,
>                                                 
> 240,71,28,159,160,170,128,137,
>                                                 
> 71,51,20,230,80,51,0,0,0,0,0,
>                                                 
> 0,24,54,90,252,231,192,148,13,
>                                                 
> 0,0,27,1,1,0,23,0,21,48,19,49,
>                                                 
> 17,48,15,6,3,85,4,3,19,8,77,
>                                                 
> 121,84,101,115,116,67,65,14,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                                             
>  {<<31,32,233,180,58,12,212,253,
>                                                 
> 218,229,84,250,254,74,36,209,
>                                                 
> 48,51,0,0,0,0,0,0,24,54,90,252,
>                                                 
> 231,192,148,13,0,0,27,1,1,0,23,
>                                                 
> 0,21,48,19,49,17,48,15,6,3,85,
>                                                 
> 4,3,19,8,77,121,84,101,115,116,
>                                                 
> 67,65,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,
>                                                 0,0,0>>,
>                                               <<225,51,90,230,223,74,48,11,
>                                                 240,71,28,159,160,170,128,
>                                                 
> 137,71,51,20,230,48,51,0,0,0,
>                                                 0,0,0,24,54,90,252,231,192,
>                                                 
> 148,13,0,0,27,1,1,0,23,0,21,
>                                                 
> 48,19,49,17,48,15,6,3,85,4,3,
>                                                 19,8,77,121,84,101,115,116,
>                                                 
> 67,65,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 0,38,0,0,0>>}},
>                                             [{ssl_tls,undefined,22,
>                                               {3,0},
>                                               
> <<16,0,1,0,13,149,79,68,242,219,
>                                                 
> 55,33,132,16,78,131,203,216,
>                                                 
> 134,82,174,2,104,224,25,10,69,
>                                                 244,189,175,235,223,106,45,
>                                                 
> 186,155,55,99,237,33,164,234,
>                                                 
> 55,53,210,3,243,167,173,216,
>                                                 
> 218,142,61,49,55,108,94,229,
>                                                 
> 157,57,65,152,150,104,244,4,
>                                                 
> 248,47,159,188,27,115,22,176,
>                                                 
> 202,177,230,100,242,152,230,
>                                                 
> 216,64,87,7,88,206,101,137,11,
>                                                 
> 61,214,170,45,226,106,24,133,
>                                                 
> 184,53,215,16,85,173,26,76,22,
>                                                 71,236,163,220,163,198,105,
>                                                 
> 253,57,252,199,21,111,171,20,
>                                                 59,238,66,255,32,129,232,2,
>                                                 110,140,48,215,124,215,101,
>                                                 
> 193,77,70,48,12,192,100,149,
>                                                 
> 167,33,214,90,232,214,188,72,
>                                                 
> 182,193,115,137,185,198,135,
>                                                 
> 213,168,214,68,180,170,204,32,
>                                                 
> 157,92,121,79,219,215,147,140,
>                                                 
> 21,215,151,41,254,22,64,224,
>                                                 
> 33,217,40,66,213,175,157,29,
>                                                 114,38,133,252,112,102,104,
>                                                 
> 185,76,231,12,236,87,176,162,
>                                                 
> 138,29,15,168,220,218,231,131,
>                                                 
> 230,243,106,157,193,42,63,8,9,
>                                                 
> 49,203,208,76,250,159,76,187,
>                                                 
> 179,2,183,83,199,70,237,161,
>                                                 
> 192,221,12,4,228,227,107,196,
>                                                 161,231,171,118,233,240,24,
>                                                 122,209,118,132,27>>},
>                                              {ssl_tls,undefined,20,
>                                               {3,0},
>                                               <<1>>},
>                                              {ssl_tls,undefined,22,
>                                               {3,0},
>                                               
> <<202,190,24,80,89,105,254,68,
>                                                 
> 94,146,20,33,11,8,52,82,120,
>                                                 141,183,75,210,23,34,29,85,
>                                                 
> 28,45,236,35,40,199,167,111,
>                                                 
> 94,144,170,240,48,75,136,116,
>                                                 
> 63,197,216,54,26,61,171,134,
>                                                 80,82,163,26,75,50,152,15,
>                                                 181,218,235>>}],
>                                             262221,
>                                             {session,
>                                             
>  <<120,172,49,23,82,227,196,133,69,
>                                               
>  243,102,137,72,209,109,38,212,
>                                               
>  150,216,237,102,171,222,27,8,24,
>                                                94,130,47,132,52,140>>,
>                                              undefined,
>                                             
>  <<48,130,2,230,48,130,1,206,160,3,
>                                               
>  2,1,2,2,1,1,48,13,6,9,42,134,72,
>                                               
>  134,247,13,1,1,5,5,0,48,19,49,
>                                               
>  17,48,15,6,3,85,4,3,19,8,77,121,
>                                               
>  84,101,115,116,67,65,48,30,23,
>                                               
>  13,49,50,48,55,51,48,49,50,53,
>                                               
>  54,52,54,90,23,13,49,51,48,55,
>                                               
>  51,48,49,50,53,54,52,54,90,48,
>                                               
>  41,49,22,48,20,6,3,85,4,3,12,13,
>                                               
>  114,105,111,111,118,101,114,108,
>                                               
>  111,114,100,45,49,49,15,48,13,6,
>                                               
>  3,85,4,10,12,6,115,101,114,118,
>                                               
>  101,114,48,130,1,34,48,13,6,9,
>                                               
>  42,134,72,134,247,13,1,1,1,5,0,
>                                               
>  3,130,1,15,0,48,130,1,10,2,130,
>                                               
>  1,1,0,163,99,255,119,11,217,190,
>                                               
>  17,106,102,242,229,252,214,101,
>                                               
>  34,15,190,61,32,23,69,175,49,
>                                               
>  141,78,38,16,202,80,88,96,12,88,
>                                               
>  193,17,57,226,60,106,35,93,184,
>                                               
>  216,167,217,0,102,117,69,97,209,
>                                               
>  60,27,104,157,167,92,224,120,
>                                               
>  142,28,102,218,176,245,195,212,
>                                               
>  83,251,182,49,60,172,62,12,51,
>                                               
>  164,181,246,88,136,122,208,186,
>                                               
>  96,220,62,57,137,103,4,26,67,30,
>                                               
>  132,246,62,142,238,140,226,125,
>                                               
>  194,135,210,234,107,18,128,76,
>                                               
>  113,52,34,199,134,34,140,80,84,
>                                               
>  35,205,142,207,230,104,37,226,
>                                               
>  58,32,253,248,156,220,244,151,
>                                               
>  11,22,43,188,14,177,227,4,188,
>                                               
>  97,24,83,79,40,16,150,139,230,
>                                               
>  40,224,66,224,140,89,175,200,
>                                               
>  198,15,30,202,248,69,32,159,182,
>                                               
>  234,202,82,247,91,75,129,24,242,
>                                               
>  250,172,34,107,44,39,177,73,125,
>                                               
>  204,232,146,190,41,239,6,154,
>                                               
>  165,197,220,227,183,190,17,114,
>                                               
>  215,232,235,67,159,222,247,110,
>                                               
>  133,191,142,154,6,99,200,37,59,
>                                               
>  120,252,161,54,91,223,191,85,
>                                               
>  104,9,121,14,184,105,75,162,181,
>                                               
>  90,233,48,195,87,151,172,23,119,
>                                               
>  42,211,2,3,130,228,61,83,2,3,1,
>                                               
>  0,1,163,47,48,45,48,9,6,3,85,29,
>                                               
>  19,4,2,48,0,48,11,6,3,85,29,15,
>                                               
>  4,4,3,2,5,32,48,19,6,3,85,29,37,
>                                               
>  4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                                               
>  48,13,6,9,42,134,72,134,247,13,
>                                               
>  1,1,5,5,0,3,130,1,1,0,222,44,95,
>                                               
>  61,253,222,29,196,80,45,112,118,
>                                               
>  52,202,249,227,153,3,154,114,
>                                               
>  189,224,23,172,222,204,213,89,
>                                               
>  202,98,202,252,34,116,104,112,
>                                               
>  18,98,136,6,133,201,165,220,4,
>                                               
>  130,95,247,113,200,31,36,105,22,
>                                               
>  27,24,197,222,154,33,131,183,
>                                               
>  215,250,104,240,205,213,224,56,
>                                               
>  201,76,226,250,166,136,68,224,
>                                               
>  195,215,149,224,255,162,11,156,
>                                               
>  74,159,108,185,153,46,116,32,
>                                               
>  182,58,192,42,77,78,249,153,29,
>                                               
>  40,105,199,192,192,14,230,169,
>                                               
>  223,199,172,53,122,145,127,57,
>                                               
>  110,56,67,139,94,115,57,55,116,
>                                               
>  11,212,76,212,44,180,72,244,150,
>                                               
>  141,6,207,134,211,89,211,47,183,
>                                               
>  79,202,162,128,196,45,44,85,122,
>                                               
>  172,122,58,170,117,116,151,187,
>                                               
>  96,109,186,207,188,10,72,138,17,
>                                               
>  2,60,52,236,72,68,203,229,144,
>                                               
>  164,154,254,145,75,227,182,44,
>                                               
>  152,36,81,103,234,99,135,223,62,
>                                               
>  152,94,109,109,202,223,114,90,
>                                               
>  71,131,48,180,74,83,145,93,85,
>                                               
>  218,225,135,141,226,127,85,243,
>                                               
>  186,10,50,216,220,110,91,48,135,
>                                               
>  32,83,253,201,62,47,163,250,152,
>                                               
>  166,230,144,155,164,240,234,78,
>                                                55,198,137,227,164,67,70>>,
>                                              0,
>                                              <<0,5>>,
>                                              undefined,new,63510871438},
>                                             274512,ssl_session_cache,
>                                             {3,0},
>                                             undefined,true,rsa,undefined,
>                                             {'RSAPrivateKey','two-prime',
>                                             
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                                              65537,
>                                             
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                                             
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                                             
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                                             
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                                             
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                                             
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                                              asn1_NOVALUE},
>                                             {'DHParameter',
>                                             
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                                              2,asn1_NOVALUE},
>                                             undefined,undefined,
>                                             #Ref<0.0.0.58841>,
>                                             {<0.3888.1>,#Ref<0.0.0.58850>},
>                                             0,<<>>,true,
>                                             {false,first},
>                                             undefined,
>                                             {[],[]},
>                                             false,true}],
>                                           [{file,"ssl_connection.erl"},
>                                            {line,2179}]},
>                                          {ssl_connection,handle_alerts,2,
>                                           [{file,"ssl_connection.erl"},
>                                            {line,2177}]},
>                                          {gen_fsm,handle_msg,7,
>                                           
> [{file,"gen_fsm.erl"},{line,494}]},
>                                          {proc_lib,init_p_do_apply,3,
>                                           [{file,"proc_lib.erl"},
>                                            {line,227}]}]},
>                                        {gen_fsm,sync_send_all_state_event,
>                                         [<0.3889.1>,start,5000]}}}
> </.net>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/9d19b95f/attachment.htm>

From monish.unni at gmail.com  Thu Aug  2 20:13:44 2012
From: monish.unni at gmail.com (cogitate)
Date: Thu, 2 Aug 2012 12:13:44 -0700 (PDT)
Subject: [rabbitmq-discuss] dead-letter-exchange behaviour
In-Reply-To: <5019B5AF.1090303@rabbitmq.com>
References: <1343836800368-21167.post@n5.nabble.com>
	<5019B5AF.1090303@rabbitmq.com>
Message-ID: <1343934824935-21211.post@n5.nabble.com>

mathias : 
Totally indebted to you! Thank you Much!
That works like a gem! 

just a note:
  when the server received messages ( with default prefetch) and 10 messages
were dispatched from the client, the management console displayed "10 Unackd
and 10 Total" on the server queue. this confused me because, if it's in the
server queue why doesn't rabbit honor the x-message-ttl of the queue? 
this was not very clear in the "Fair Dispatch" section. 

Thanks for throwing the *light*!
kind regards,
-monish


Matthias Radestock-3 wrote
> 
> Monish,
> 
> On 01/08/12 17:00, cogitate wrote:
>> i am trying to get dead-letter-exchange work..
>>   steps below:
>> [0] s2.direct is an exchange that declares a dead-letter-exchange(DLE)
>> called s2.dlx ( rabbitmq )
>> [1] setup DLE consumer -  declares a DLQ (pyDlxQueue) binds to
>> DLE(s2.dlx)
>> [2] setup a consumer listening to queue (EchoPayMe) binds to
>> s2.direct(exchange)
>>      queue EchoPayMe setup with arguments x-message-ttl=10 and DLE=s2.dlx
>>      the consumer also sleeps for 100 seconds ( to simulate
>> long-running/hanging service)
>>      the idea is a producer puts 10 messages in it's queue will only have
>> message 1 served,
>>      the rest of the messages should go to DLE(s2.dlx) when the DLE
>> consumer
>> replies.
>> [3] the producer - publish messages to s2.direct exchange w/
>> rk="EchoPayMe"
>>
>> the problem is no messages are received by the DLQ or get routed to the
>> DLE
>> consumer.
>> the code for the DLE consumer, App consumer and App Producer in
>> python/pika
>> below.
> 
> ok.
> 
>> i am sure there's a fundamental error in what i am doing
> 
> yep.
> 
>> --  Consumer ---
>> [...]
>> #channel.basic_qos(prefetch_count=1)
> 
> Try uncommenting that. Without a prefetch set, the broker will happily 
> send all messages straight to the consumer as soon as they enter the 
> queue, as explained in the "Fair dispatch" section of 
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html. If the 
> client is busy then he messages will be buffered in the network / the 
> client, but as far as the broker is concerned they have been delivered 
> straight away and so won't be expired & dead-lettered.
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at .rabbitmq
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/dead-letter-exchange-behaviour-tp21167p21211.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From thiagoburgo at gmail.com  Thu Aug  2 20:58:42 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Thu, 2 Aug 2012 16:58:42 -0300
Subject: [rabbitmq-discuss] Queue with x-expires not expires after timeout
Message-ID: <CABjKUK_uit50A1mgMVHYxxAohtvSSXs+VQfjK0L_s61imj=s4A@mail.gmail.com>

Hi People,

My queue with x-expires not expires after timeout, the follow queue was
created and not accessed since (2012-08-02 14:00), and not expired until
now.

Parameters x-ha-policy:allx-expires:9000arguments:x-match:anydurable:trueExclusive
owner None Status Idle since
2012-08-02 16:16:58
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120802/df3d8699/attachment.htm>

From matthias at rabbitmq.com  Thu Aug  2 23:00:20 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Aug 2012 23:00:20 +0100
Subject: [rabbitmq-discuss] Queue with x-expires not expires after
	timeout
In-Reply-To: <CABjKUK_uit50A1mgMVHYxxAohtvSSXs+VQfjK0L_s61imj=s4A@mail.gmail.com>
References: <CABjKUK_uit50A1mgMVHYxxAohtvSSXs+VQfjK0L_s61imj=s4A@mail.gmail.com>
Message-ID: <501AF874.1060304@rabbitmq.com>

On 02/08/12 20:58, Thiago Burgo Belo wrote:
> My queue with x-expires not expires after timeout, the follow queue was
> created and not accessed since (2012-08-02 14:00), and not expired until
> now.
>
> Parameters
> x-ha-policy:	all
> x-expires:	9000
> arguments:	
> x-match:	any
>
> durable:	true
>
> Exclusive owner None Status Idle since
> 2012-08-02 16:16:58

Does the queue have a consumer? From 
http://www.rabbitmq.com/extensions.html#queue-leases
<quote>
"Unused means the queue has no consumers, the queue has not been 
redeclared, and basic.get has not been invoked for a duration of at 
least the expiration period."
</quote>

Matthias.

From matthias at rabbitmq.com  Thu Aug  2 23:11:54 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Aug 2012 23:11:54 +0100
Subject: [rabbitmq-discuss] dead-letter-exchange behaviour
In-Reply-To: <1343934824935-21211.post@n5.nabble.com>
References: <1343836800368-21167.post@n5.nabble.com>
	<5019B5AF.1090303@rabbitmq.com>
	<1343934824935-21211.post@n5.nabble.com>
Message-ID: <501AFB2A.1040504@rabbitmq.com>

On 02/08/12 20:13, cogitate wrote:
> just a note:
>    when the server received messages ( with default prefetch) and 10 messages
> were dispatched from the client, the management console displayed "10 Unackd
> and 10 Total" on the server queue. this confused me because, if it's in the
> server queue why doesn't rabbit honor the x-message-ttl of the queue?
> this was not very clear in the "Fair Dispatch" section.

Well, the unacked messages have to remain *somewhere*, and that 
somewhere happens to be the queue. I suppose we could point out that 
unacked messages do not expire, but that's actually kinda misleading, 
for if they are nack'ed / requeued and the ttl has been exceeded then 
they *do* expire.

Matthias.

From matthias at rabbitmq.com  Thu Aug  2 23:22:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Aug 2012 23:22:56 +0100
Subject: [rabbitmq-discuss] vm_memory_high_watermark of RabbitMQ
In-Reply-To: <BCC407A444557E41B0D8B0260D684992053AE572@CA1EXCLV07.adcorp.kla-tencor.com>
References: <BCC407A444557E41B0D8B0260D684992053AE43B@CA1EXCLV07.adcorp.kla-tencor.com>
	<501A8748.6040605@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D684992053AE572@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <501AFDC0.50307@rabbitmq.com>

On 02/08/12 19:33, Chen, Bin wrote:
> Here is the output of rabbitmqctl status :
>
>
> Status of node rabbit at SERVER001 ...
> [{pid,14920},
>   {running_applications,
>       [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
>        {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>        {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>        {rabbit,"RabbitMQ","2.7.1"},
>        {os_mon,"CPO  CXC 138 46","2.2.5"},
>        {sasl,"SASL  CXC 138 11","2.1.9.3"},
>        {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
>        {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
>        {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
>        {inets,"INETS  CXC 138 49","5.5.2"},
>        {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>        {stdlib,"ERTS  CXC 138 10","1.17.3"},
>        {kernel,"ERTS  CXC 138 10","2.14.3"}]},
>   {memory,
>       [{total,43200816},
>        {processes,13395088},
>        {processes_used,7180168},
>        {system,29805728},
>        {atom,896677},
>        {atom_used,872806},
>        {binary,10742872},
>        {code,7786932},
>        {ets,721700}]},
>   {vm_memory_high_watermark,0.0333454016734413},
>   {vm_memory_limit,858993459}]
> ...done.
>
>
>
> Note that the vm_memory_high_watermark fraction in status report is much
> smaller than 0.4.

Right. That's a bug in the reporting. Doesn't cause any harm otherwise.

As Emile pointed out, if you want to take advantage of all that memory 
you have then you need to run the 64 bit version of Erlang, which 
evidently you are not:

>   {os,{win32,nt}},
>   {erlang_version,
>       "Erlang R14B02 (erts-5.8.3) [smp:12:12] [rq:12]
> [async-threads:30]\n"},

The 64 bit Windows version of Erlang only became available in R15B, so 
you'll need to upgrade and make sure you grab the win64 flavour of the 
download (http://www.erlang.org/download/otp_win64_R15B01.exe at present).

While you are at it, you might as well upgrade rabbit to the latest and 
greatest 2.8.5.

Regards,

Matthias.

From yogeeta.p at gmail.com  Fri Aug  3 06:30:38 2012
From: yogeeta.p at gmail.com (Yogita Patil)
Date: Fri, 3 Aug 2012 11:00:38 +0530
Subject: [rabbitmq-discuss] Automation testing tools for rabbitmq
Message-ID: <CADaq4BrymLeSa2Cscuw4a=-ZkHvHBNhyKv+1BsV=vBg2PbYhtA@mail.gmail.com>

HI,

Are there any Automation testing (preferably in Java) tools for rabbitmq

-- 
Regards,
Yogita.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/5271752e/attachment.htm>

From watson.timothy at gmail.com  Fri Aug  3 06:53:43 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 3 Aug 2012 06:53:43 +0100
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <e545e844-383d-4d1b-8d62-a98340072715@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
	<e545e844-383d-4d1b-8d62-a98340072715@googlegroups.com>
Message-ID: <72023458-80D5-4817-A2C8-D48671AF3702@rabbitmq.com>

Thanks for posting back the solution Mark. Where was the GUI certmgr putting the cert then?

On 2 Aug 2012, at 19:59, Mark Ward <ward.mark at gmail.com> wrote:

> Solution,
> 
> It appears the best instructions to use are the command line certmgr for each Windows/Mono platform.  It seems using the gui certmgr I did not register the ca certificate into the proper location for the applications to find it.  Mono came the closest to give me an indication this was the problem.  The .net version of the client failed out with an exception that had me, as you can see from this thread, on a wild hunt for the problem.
> 
> I used the command line certmgr and inserted the ca certificate into the machine certificate store.  Things appear to be working with SSL.
> 
> I thank you guys for your assistance and I am sorry to have taken your time on this issue.
> 
> -Mark
> 
> On Monday, July 30, 2012 1:06:19 PM UTC-5, Mark Ward wrote:
> Hi,
> 
> I might have the same problem as this post.  https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ
> 
> The setup
> Windows 2008r2
> rabbitmq server 2.8.4 
> Erlang R15B01
> 
> .NET 4.0
> RabbitMQ client 2.8.4 (installed from NuGet)
> 
> When I run my test .NET publisher I get the following exception "None of the specified endpoints were reachable".
> 
> I have gone through the SSL setup tutorial and I am stumped on why the .NET client cannot connect or even fail out with an SSL trust exception.
> I have tested the connection to the server over SSL with the following tools. openssl s_client and the Java example.  The openssl and the java client connect and work.  It is the .NET client that I cannot get working and it is the one I need to have working.
> 
> I have setup my rabbitmq server to run the ssl over port 443 on my server.  This you will find in my log output and I have specified in each of my clients.
> 
> The following is the C# client that I am trying to connect and publish data into rabbitmq.  The client works when I am not attempting a SSL connection.
> 
> using System;
> using System.Collections.Generic;
> using System.Linq;
> using System.Text;
> using RabbitMQ.Client;
> 
> namespace ProducerOne
> {
>     class Program
>     {
>         static void Main(string[] args)
>         {
>             string hostName = "riooverlord-1";
>             int port = 443;
> 
>             int count;
>             if (args != null && args.Length == 1)
>                 count = int.Parse(args[0]);
>             else
>                 count = 1;
> 
>             var connectionFactory = new ConnectionFactory();
>             connectionFactory.HostName = hostName;
>             connectionFactory.Port = port;
>             connectionFactory.Ssl.Enabled = true;
>             connectionFactory.Ssl.AcceptablePolicyErrors = System.Net.Security.SslPolicyErrors.None;
>             
>             IConnection connection = connectionFactory.CreateConnection(); 
>             
>             IModel channel = connection.CreateModel();
> 
>             for (int i = 0; i < count; i++)
>             {
>                 byte[] message = Encoding.UTF8.GetBytes(string.Format("message {0} - {1}", i.ToString(), DateTime.Now.ToString()));
>                 channel.BasicPublish(string.Empty, "QueueOne", null, message);
>             }
> 
>             channel.Close(); 
>             connection.Close();
>         }
>     }
> }
> 
> 
> The following is a dump of my rabbitMQ log file.  I have grouped the log lines between xml like tags to group the different client attempts.  openssl, java, and .NET
> 
> 
> =INFO REPORT==== 30-Jul-2012::11:28:01 ===
> Limiting to approx 924 file handles (829 sockets)
> 
> =INFO REPORT==== 30-Jul-2012::11:28:01 ===
> Memory limit set to 409MB of 1023MB total.
> 
> =INFO REPORT==== 30-Jul-2012::11:28:03 ===
> Disk free limit set to 953MB
> 
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> Management plugin upgraded statistics to fine.
> 
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
> 
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
> 
> =WARNING REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_persistent: rebuilding indices from scratch
> 
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> started TCP Listener on [::]:5672
> 
> =INFO REPORT==== 30-Jul-2012::11:28:05 ===
> started TCP Listener on 0.0.0.0:5672
> 
> =INFO REPORT==== 30-Jul-2012::11:28:06 ===
> started SSL Listener on [::]:443
> 
> =INFO REPORT==== 30-Jul-2012::11:28:06 ===
> started SSL Listener on 0.0.0.0:443
> 
> =INFO REPORT==== 30-Jul-2012::11:28:07 ===
> Management agent started.
> 
> =INFO REPORT==== 30-Jul-2012::11:28:08 ===
> Management plugin started. Port: 55672, path: /
> 
> =INFO REPORT==== 30-Jul-2012::11:28:08 ===
> Statistics database started.
> 
> <openssl s_client test>
> =INFO REPORT==== 30-Jul-2012::12:08:46 ===
> accepting AMQP connection <0.19749.0> (192.168.10.157:53209 -> 192.168.10.107:443)
> 
> =ERROR REPORT==== 30-Jul-2012::12:08:56 ===
> closing AMQP connection <0.19749.0> (192.168.10.157:53209 -> 192.168.10.107:443):
> {handshake_timeout,handshake}
> </openssl s_client test> 
> 
> <java client>
> =INFO REPORT==== 30-Jul-2012::12:30:58 ===
> accepting AMQP connection <0.30363.0> (192.168.10.157:53426 -> 192.168.10.107:443)
> 
> =INFO REPORT==== 30-Jul-2012::12:30:59 ===
> closing AMQP connection <0.30363.0> (192.168.10.157:53426 -> 192.168.10.107:443)
> </java client>
> 
> <java client>
> =INFO REPORT==== 30-Jul-2012::12:32:17 ===
> accepting AMQP connection <0.31021.0> (192.168.10.157:53436 -> 192.168.10.107:443)
> 
> =INFO REPORT==== 30-Jul-2012::12:32:18 ===
> closing AMQP connection <0.31021.0> (192.168.10.157:53436 -> 192.168.10.107:443)
> </java client>
> 
> <.net>
> =INFO REPORT==== 30-Jul-2012::12:33:01 ===
> accepting AMQP connection <0.31385.0> ([FE80::9CF9:E6C8:AAA2:E95E]:57009 -> [FE80::DC90:8492:EDEA:F29F]:443)
> 
> =ERROR REPORT==== 30-Jul-2012::12:33:01 ===
> ** State machine <0.31386.0> terminating 
> ** Last message in was {tcp,#Port<0.8637>,
>                             <<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,37,221,141,
>                               253,17,32,217,19,107,158,219,100,18,72,74,101,
>                               84,128,197,33,49,0,114,104,195,15,49,53,77,36,
>                               199,164,103,80,172,225,140,196,41,237,52,94,192,
>                               237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,
>                               84,239,236,14,94,95,81,214,243,162,206,220,188,
>                               94,158,6,115,212,126,162,103,173,87,166,4,48,53,
>                               50,150,185,97,176,225,0,73,247,114,66,191,88,
>                               143,29,252,2,155,92,204,233,244,199,52,122,55,
>                               130,100,70,122,145,184,131,116,118,196,2,179,50,
>                               61,68,124,192,145,169,147,42,49,126,32,69,25,36,
>                               57,217,75,204,54,156,34,217,117,139,164,114,118,
>                               251,62,106,242,208,111,184,117,189,71,224,239,
>                               20,92,253,137,74,191,110,114,95,129,206,58,78,
>                               141,136,190,206,53,7,146,104,216,241,137,28,137,
>                               20,133,25,240,230,127,70,254,228,162,130,190,53,
>                               250,227,136,156,71,192,142,184,51,124,86,203,
>                               108,235,25,32,235,83,144,185,184,208,190,238,
>                               133,1,253,184,101,162,231,40,109,144,35,218,161,
>                               26,4,87,13,117,249,60,35,117,112,213,236,163,18,
>                               128,61,187,20,3,0,0,1,1,22,3,0,0,60,186,95,216,
>                               229,210,105,198,105,85,45,183,110,174,206,104,
>                               133,35,254,108,108,57,13,137,138,151,100,178,23,
>                               189,147,85,254,17,117,168,182,255,204,234,195,6,
>                               0,248,93,238,47,172,80,5,153,138,161,91,231,83,
>                               251,42,192,80,179>>}
> ** When State == certify
> **      Data  == {state,server,
>                      {#Ref<0.0.0.50272>,<0.31385.0>},
>                      gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                      #Port<0.8637>,
>                      {ssl_options,[],verify_peer,
>                          {#Fun<ssl.3.54384637>,
>                           #Fun<rabbit_networking.0.89858908>},
>                          false,false,undefined,1,
>                          "C:/certstore/server/cert.pem",undefined,
>                          "C:/certstore/server/key.pem",undefined,undefined,
>                          undefined,"C:/certstore/testca/cacert.pem",undefined,
>                          undefined,
>                          [<<0,57>>,
>                           <<0,56>>,
>                           <<0,53>>,
>                           <<0,22>>,
>                           <<0,19>>,
>                           <<0,10>>,
>                           <<0,51>>,
>                           <<0,50>>,
>                           <<0,47>>,
>                           <<0,5>>,
>                           <<0,4>>,
>                           <<0,21>>,
>                           <<0,9>>],
>                          #Fun<ssl.0.54384637>,true,268435456,false,[],
>                          undefined,false},
>                      {socket_options,binary,0,0,0,false},
>                      {connection_states,
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                              undefined,undefined,undefined,1,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                  <<80,22,197,78,29,58,72,186,12,107,61,151,17,
>                                    177,209,163,174,99,56,24,71,199,106,49,91,
>                                    186,189,199,117,68,234,215>>,
>                                  <<80,22,197,77,73,19,16,200,132,120,47,224,
>                                    160,79,3,106,44,134,25,30,170,200,151,96,89,
>                                    3,64,53,236,247,30,107>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                              undefined,undefined,undefined,4,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                  <<80,22,197,78,29,58,72,186,12,107,61,151,17,
>                                    177,209,163,174,99,56,24,71,199,106,49,91,
>                                    186,189,199,117,68,234,215>>,
>                                  <<80,22,197,77,73,19,16,200,132,120,47,224,
>                                    160,79,3,106,44,134,25,30,170,200,151,96,89,
>                                    3,64,53,236,247,30,107>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined}},
>                      [],<<>>,<<>>,
>                      {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
>                          182,188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
>                          0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                          8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
>                        <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
>                          124,157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,
>                          252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
>                          48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
>                          0,0,0>>},
>                       {<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
>                          182,188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
>                          0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                          8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
>                        <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
>                          124,157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,
>                          252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
>                          48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          38,0,0,0>>}},
>                      [],262221,
>                      {session,
>                          <<32,144,115,251,110,148,117,72,252,193,200,232,234,
>                            193,127,229,114,142,20,246,109,56,190,101,113,75,
>                            232,227,237,6,105,251>>,
>                          undefined,
>                          <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
>                            9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
>                            6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
>                            23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
>                            49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
>                            48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
>                            108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
>                            115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
>                            134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
>                            10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
>                            242,229,252,214,101,34,15,190,61,32,23,69,175,49,
>                            141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
>                            106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                            104,157,167,92,224,120,142,28,102,218,176,245,195,
>                            212,83,251,182,49,60,172,62,12,51,164,181,246,88,
>                            136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
>                            246,62,142,238,140,226,125,194,135,210,234,107,18,
>                            128,76,113,52,34,199,134,34,140,80,84,35,205,142,
>                            207,230,104,37,226,58,32,253,248,156,220,244,151,11,
>                            22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
>                            139,230,40,224,66,224,140,89,175,200,198,15,30,202,
>                            248,69,32,159,182,234,202,82,247,91,75,129,24,242,
>                            250,172,34,107,44,39,177,73,125,204,232,146,190,41,
>                            239,6,154,165,197,220,227,183,190,17,114,215,232,
>                            235,67,159,222,247,110,133,191,142,154,6,99,200,37,
>                            59,120,252,161,54,91,223,191,85,104,9,121,14,184,
>                            105,75,162,181,90,233,48,195,87,151,172,23,119,42,
>                            211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
>                            3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
>                            48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                            48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
>                            0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
>                            249,227,153,3,154,114,189,224,23,172,222,204,213,89,
>                            202,98,202,252,34,116,104,112,18,98,136,6,133,201,
>                            165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
>                            222,154,33,131,183,215,250,104,240,205,213,224,56,
>                            201,76,226,250,166,136,68,224,195,215,149,224,255,
>                            162,11,156,74,159,108,185,153,46,116,32,182,58,192,
>                            42,77,78,249,153,29,40,105,199,192,192,14,230,169,
>                            223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                            57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
>                            134,211,89,211,47,183,79,202,162,128,196,45,44,85,
>                            122,172,122,58,170,117,116,151,187,96,109,186,207,
>                            188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
>                            154,254,145,75,227,182,44,152,36,81,103,234,99,135,
>                            223,62,152,94,109,109,202,223,114,90,71,131,48,180,
>                            74,83,145,93,85,218,225,135,141,226,127,85,243,186,
>                            10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
>                            250,152,166,230,144,155,164,240,234,78,55,198,137,
>                            227,164,67,70>>,
>                          0,
>                          <<0,5>>,
>                          undefined,new,63510870781},
>                      274512,ssl_session_cache,
>                      {3,0},
>                      undefined,true,rsa,undefined,
>                      {'RSAPrivateKey','two-prime',
>                          20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                          65537,
>                          15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                          147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                          139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                          83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                          118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                          129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                          asn1_NOVALUE},
>                      {'DHParameter',
>                          179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                          2,asn1_NOVALUE},
>                      undefined,undefined,#Ref<0.0.0.50276>,
>                      {<0.31385.0>,#Ref<0.0.0.50285>},
>                      0,<<>>,true,
>                      {false,first},
>                      undefined,
>                      {[],[]},
>                      false,true}
> ** Reason for termination = 
> ** {function_clause,
>        [{ssl_connection,handle_alert,
>             [{alert,1,41,{"ssl_connection.erl",1678}},
>              certify,
>              {state,server,
>                  {#Ref<0.0.0.50272>,<0.31385.0>},
>                  gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                  #Port<0.8637>,
>                  {ssl_options,[],verify_peer,
>                      {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
>                      false,false,undefined,1,"C:/certstore/server/cert.pem",
>                      undefined,"C:/certstore/server/key.pem",undefined,
>                      undefined,undefined,"C:/certstore/testca/cacert.pem",
>                      undefined,undefined,
>                      [<<0,57>>,
>                       <<0,56>>,
>                       <<0,53>>,
>                       <<0,22>>,
>                       <<0,19>>,
>                       <<0,10>>,
>                       <<0,51>>,
>                       <<0,50>>,
>                       <<0,47>>,
>                       <<0,5>>,
>                       <<0,4>>,
>                       <<0,21>>,
>                       <<0,9>>],
>                      #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
>                      false},
>                  {socket_options,binary,0,0,0,false},
>                  {connection_states,
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,2,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                              <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
>                                209,163,174,99,56,24,71,199,106,49,91,186,189,
>                                199,117,68,234,215>>,
>                              <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
>                                3,106,44,134,25,30,170,200,151,96,89,3,64,53,
>                                236,247,30,107>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,4,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                              <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
>                                209,163,174,99,56,24,71,199,106,49,91,186,189,
>                                199,117,68,234,215>>,
>                              <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
>                                3,106,44,134,25,30,170,200,151,96,89,3,64,53,
>                                236,247,30,107>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined}},
>                  [],<<>>,<<>>,
>                  {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
>                      188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
>                      1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
>                      101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,42,0,0,0>>,
>                    <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
>                      157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,252,231,
>                      192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,
>                      4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                   {<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
>                      188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
>                      1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
>                      101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,38,0,0,0>>,
>                    <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
>                      157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,252,231,
>                      192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,
>                      85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
>                  [{ssl_tls,undefined,22,
>                       {3,0},
>                       <<16,0,1,0,37,221,141,253,17,32,217,19,107,158,219,100,
>                         18,72,74,101,84,128,197,33,49,0,114,104,195,15,49,53,
>                         77,36,199,164,103,80,172,225,140,196,41,237,52,94,192,
>                         237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,84,239,
>                         236,14,94,95,81,214,243,162,206,220,188,94,158,6,115,
>                         212,126,162,103,173,87,166,4,48,53,50,150,185,97,176,
>                         225,0,73,247,114,66,191,88,143,29,252,2,155,92,204,
>                         233,244,199,52,122,55,130,100,70,122,145,184,131,116,
>                         118,196,2,179,50,61,68,124,192,145,169,147,42,49,126,
>                         32,69,25,36,57,217,75,204,54,156,34,217,117,139,164,
>                         114,118,251,62,106,242,208,111,184,117,189,71,224,239,
>                         20,92,253,137,74,191,110,114,95,129,206,58,78,141,136,
>                         190,206,53,7,146,104,216,241,137,28,137,20,133,25,240,
>                         230,127,70,254,228,162,130,190,53,250,227,136,156,71,
>                         192,142,184,51,124,86,203,108,235,25,32,235,83,144,
>                         185,184,208,190,238,133,1,253,184,101,162,231,40,109,
>                         144,35,218,161,26,4,87,13,117,249,60,35,117,112,213,
>                         236,163,18,128,61,187>>},
>                   {ssl_tls,undefined,20,{3,0},<<1>>},
>                   {ssl_tls,undefined,22,
>                       {3,0},
>                       <<186,95,216,229,210,105,198,105,85,45,183,110,174,206,
>                         104,133,35,254,108,108,57,13,137,138,151,100,178,23,
>                         189,147,85,254,17,117,168,182,255,204,234,195,6,0,
>                         248,93,238,47,172,80,5,153,138,161,91,231,83,251,42,
>                         192,80,179>>}],
>                  262221,
>                  {session,
>                      <<32,144,115,251,110,148,117,72,252,193,200,232,234,193,
>                        127,229,114,142,20,246,109,56,190,101,113,75,232,227,
>                        237,6,105,251>>,
>                      undefined,
>                      <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
>                        42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
>                        4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
>                        48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
>                        48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
>                        13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
>                        15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
>                        130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
>                        1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
>                        190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
>                        69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,</
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/4310a301/attachment.htm>

From watson.timothy at gmail.com  Fri Aug  3 06:56:42 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 3 Aug 2012 06:56:42 +0100
Subject: [rabbitmq-discuss] Automation testing tools for rabbitmq
In-Reply-To: <CADaq4BrymLeSa2Cscuw4a=-ZkHvHBNhyKv+1BsV=vBg2PbYhtA@mail.gmail.com>
References: <CADaq4BrymLeSa2Cscuw4a=-ZkHvHBNhyKv+1BsV=vBg2PbYhtA@mail.gmail.com>
Message-ID: <A0496A22-AC4A-462D-86FC-30FC90F94FE3@rabbitmq.com>

There is a performance testing tool bundled with the java client. I can't remember the exact sub folder it's in, but I'll look it up in a few mins when I arrive at the office and let you know.

On 3 Aug 2012, at 06:30, Yogita Patil <yogeeta.p at gmail.com> wrote:

> HI,
> 
> Are there any Automation testing (preferably in Java) tools for rabbitmq
> 
> -- 
> Regards,
> Yogita.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jaaaelpumuki at gmail.com  Fri Aug  3 08:20:40 2012
From: jaaaelpumuki at gmail.com (=?UTF-8?Q?F=C3=A9lix?=)
Date: Fri, 3 Aug 2012 00:20:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Install a plugin in the broker
Message-ID: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>

Has anyone tried to put in production a plugin?

I'm trying to install this plugin 
https://github.com/flopezluis/rabbitmq-throttling-exchange in the broker, 
under Macosx and Rabbitmq 2.8.5. 

The plugin is working well in development with make run-in-broker,  in 
production   the plugin is activated well, but when you try to publish a 
message with the exchange, the message is lost. If you tried to publish the 
message through the web site you can see the following error 
http://pastebin.com/YSHHASYt

I've tried another plugins like 
https://github.com/videlalvaro/rabbitmq-recent-history-exchange and even 
i've created a very simple one like:
http://pastebin.com/ds6ihMFa

But the result is always the same
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/179cb0fb/attachment.htm>

From matthias at rabbitmq.com  Fri Aug  3 08:36:35 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 08:36:35 +0100
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
Message-ID: <501B7F83.40901@rabbitmq.com>

On 03/08/12 08:20, F?lix wrote:
> Has anyone tried to put in production a plugin?
>
> I'm trying to install this plugin
> https://github.com/flopezluis/rabbitmq-throttling-exchange in the
> broker, under Macosx and Rabbitmq 2.8.5.
>
> The plugin is working well in development with make run-in-broker,  in
> production   the plugin is activated well, but when you try to publish a
> message with the exchange, the message is lost. If you tried to publish
> the message through the web site you can see the following error
> http://pastebin.com/YSHHASYt

The error is somewhat obscure, but if you look at the line it's failing 
at - 
https://github.com/flopezluis/rabbitmq-throttling-exchange/blob/master/src/rabbit_exchange_type_throttling.erl#L70 
-you'll see a call to lists:keyfind/3, which was introduced only in 
Erlang R13B01. Are you perhaps running an older version in production?

Matthias.

From jaaaelpumuki at gmail.com  Fri Aug  3 08:46:16 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 09:46:16 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <501B7F83.40901@rabbitmq.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
Message-ID: <CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>

thanks for answering.

The erlang version is "R15B01"

2012/8/3 Matthias Radestock <matthias at rabbitmq.com>

> On 03/08/12 08:20, F?lix wrote:
>
>> Has anyone tried to put in production a plugin?
>>
>> I'm trying to install this plugin
>> https://github.com/flopezluis/**rabbitmq-throttling-exchange<https://github.com/flopezluis/rabbitmq-throttling-exchange>in the
>> broker, under Macosx and Rabbitmq 2.8.5.
>>
>> The plugin is working well in development with make run-in-broker,  in
>> production   the plugin is activated well, but when you try to publish a
>> message with the exchange, the message is lost. If you tried to publish
>> the message through the web site you can see the following error
>> http://pastebin.com/YSHHASYt
>>
>
> The error is somewhat obscure, but if you look at the line it's failing at
> - https://github.com/flopezluis/**rabbitmq-throttling-exchange/**
> blob/master/src/rabbit_**exchange_type_throttling.erl#**L70<https://github.com/flopezluis/rabbitmq-throttling-exchange/blob/master/src/rabbit_exchange_type_throttling.erl#L70>-you'll see a call to lists:keyfind/3, which was introduced only in Erlang
> R13B01. Are you perhaps running an older version in production?
>
> Matthias.
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/edb97791/attachment.htm>

From jaaaelpumuki at gmail.com  Fri Aug  3 08:51:39 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 09:51:39 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
Message-ID: <CAFdw231LmT7fvODYn+OvDRRDzqJU4C6CwuPsikxQLvbtWYoEcg@mail.gmail.com>

the trace is much bigger that I posted, here is the real one:
http://pastebin.com/bBQs2vm0

2012/8/3 F?lix L?pez <jaaaelpumuki at gmail.com>

> thanks for answering.
>
> The erlang version is "R15B01"
>
>
> 2012/8/3 Matthias Radestock <matthias at rabbitmq.com>
>
>> On 03/08/12 08:20, F?lix wrote:
>>
>>> Has anyone tried to put in production a plugin?
>>>
>>> I'm trying to install this plugin
>>> https://github.com/flopezluis/**rabbitmq-throttling-exchange<https://github.com/flopezluis/rabbitmq-throttling-exchange>in the
>>> broker, under Macosx and Rabbitmq 2.8.5.
>>>
>>> The plugin is working well in development with make run-in-broker,  in
>>> production   the plugin is activated well, but when you try to publish a
>>> message with the exchange, the message is lost. If you tried to publish
>>> the message through the web site you can see the following error
>>> http://pastebin.com/YSHHASYt
>>>
>>
>> The error is somewhat obscure, but if you look at the line it's failing
>> at - https://github.com/flopezluis/**rabbitmq-throttling-exchange/**
>> blob/master/src/rabbit_**exchange_type_throttling.erl#**L70<https://github.com/flopezluis/rabbitmq-throttling-exchange/blob/master/src/rabbit_exchange_type_throttling.erl#L70>-you'll see a call to lists:keyfind/3, which was introduced only in Erlang
>> R13B01. Are you perhaps running an older version in production?
>>
>> Matthias.
>>
>
>
>
> --
> http://www.linkedin.com/in/flopezluis
>
> It's easier to ask forgiveness than it is to get permission
>
>
> ".....it doesn't matter how many times you fail. It doesn't matter how
> many times you almost get it right. No one is going to know or care about
> your failures, and either should you. All you have to do is learn from them
> and those around you because...All that matters in business is that you get
> it right once. Then everyone can tell you how lucky you are."
> --Mark Cuban"
>
> "Always be the worst guy in every band you're in." If you're the best guy
> there, you need to be in a different band. And I think that works for
> almost everything that's out there as well." Pat Metheny
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/1d8fef3b/attachment.htm>

From matthias at rabbitmq.com  Fri Aug  3 08:52:32 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 08:52:32 +0100
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
Message-ID: <501B8340.8030005@rabbitmq.com>

On 03/08/12 08:46, F?lix L?pez wrote:
> thanks for answering.
>
> The erlang version is "R15B01"

I see. Do you get any errors in the logs when publishing to the exchange 
normally, rather than through management?


Matthias.

From jaaaelpumuki at gmail.com  Fri Aug  3 09:03:05 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 10:03:05 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <501B8340.8030005@rabbitmq.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
Message-ID: <CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>

Yes, this is the trace, I connect a consumer and one publisher, when I
publish a message with:
channel.basic_publish(exchange='testing',routing_key='',body='Hello
World!', properties=data)

The broker throws the following:
http://pastebin.com/hP9Z2iUv



2012/8/3 Matthias Radestock <matthias at rabbitmq.com>

> On 03/08/12 08:46, F?lix L?pez wrote:
>
>> thanks for answering.
>>
>> The erlang version is "R15B01"
>>
>
> I see. Do you get any errors in the logs when publishing to the exchange
> normally, rather than through management?
>
>
> Matthias.
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/2fe7ad00/attachment.htm>

From matthias at rabbitmq.com  Fri Aug  3 09:09:05 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 09:09:05 +0100
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
Message-ID: <501B8721.3080400@rabbitmq.com>

On 03/08/12 09:03, F?lix L?pez wrote:
> Yes, this is the trace, I connect a consumer and one publisher, when I
> publish a message with:
> channel.basic_publish(exchange='testing',routing_key='',body='Hello
> World!', properties=data)
>
> The broker throws the following:
> http://pastebin.com/hP9Z2iUv

That stack trace doesn't match the code on github - it's failing at 
rabbit_exchange_type_throttling.erl:68, which is a blank line.

Matthias.

From jaaaelpumuki at gmail.com  Fri Aug  3 09:13:14 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 10:13:14 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <501B8721.3080400@rabbitmq.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
Message-ID: <CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>

sorry, I've made modifications in order to see what's happening. Here is
the file
https://gist.github.com/3245699

2012/8/3 Matthias Radestock <matthias at rabbitmq.com>

> On 03/08/12 09:03, F?lix L?pez wrote:
>
>> Yes, this is the trace, I connect a consumer and one publisher, when I
>> publish a message with:
>> channel.basic_publish(**exchange='testing',routing_**key='',body='Hello
>> World!', properties=data)
>>
>> The broker throws the following:
>> http://pastebin.com/hP9Z2iUv
>>
>
> That stack trace doesn't match the code on github - it's failing at
> rabbit_exchange_type_**throttling.erl:68, which is a blank line.
>
> Matthias.
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/b902c747/attachment.htm>

From matthias at rabbitmq.com  Fri Aug  3 09:18:43 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 09:18:43 +0100
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
Message-ID: <501B8963.6080403@rabbitmq.com>

On 03/08/12 09:13, F?lix L?pez wrote:
> sorry, I've made modifications in order to see what's happening. Here is
> the file
> https://gist.github.com/3245699

Are you running the same version of rabbit in dev and prod? The error 
has all the hallmarks of the plugin having been built with, say, the 
head-of-default of our development tree.


Matthias.

From jaaaelpumuki at gmail.com  Fri Aug  3 09:31:45 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 10:31:45 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <501B8963.6080403@rabbitmq.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
	<501B8963.6080403@rabbitmq.com>
Message-ID: <CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>

I'm with the tag
2b15e92cadcd (rabbitmq_v2_8_x) rabbitmq_v2_8_5

The only thing I do, it's to copy the plugin into rabbitmq-public-umbrella,
enter into the plugin and then make

2012/8/3 Matthias Radestock <matthias at rabbitmq.com>

> On 03/08/12 09:13, F?lix L?pez wrote:
>
>> sorry, I've made modifications in order to see what's happening. Here is
>> the file
>> https://gist.github.com/**3245699 <https://gist.github.com/3245699>
>>
>
> Are you running the same version of rabbit in dev and prod? The error has
> all the hallmarks of the plugin having been built with, say, the
> head-of-default of our development tree.
>
>
> Matthias.
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/8b6c3c0d/attachment.htm>

From tim at rabbitmq.com  Fri Aug  3 09:28:08 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 03 Aug 2012 09:28:08 +0100
Subject: [rabbitmq-discuss] Automation testing tools for rabbitmq
In-Reply-To: <A0496A22-AC4A-462D-86FC-30FC90F94FE3@rabbitmq.com>
References: <CADaq4BrymLeSa2Cscuw4a=-ZkHvHBNhyKv+1BsV=vBg2PbYhtA@mail.gmail.com>
	<A0496A22-AC4A-462D-86FC-30FC90F94FE3@rabbitmq.com>
Message-ID: <501B8B98.9040101@rabbitmq.com>

On 08/03/2012 06:56 AM, Tim Watson wrote:
> There is a performance testing tool bundled with the java client. I can't remember the exact sub folder it's in, but I'll look it up in a few mins when I arrive at the office and let you know.
>

Take a look in test/src/com/rabbitmq/examples/perf.

From matthias at rabbitmq.com  Fri Aug  3 09:34:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 09:34:29 +0100
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <501B7F83.40901@rabbitmq.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
Message-ID: <501B8D15.7040709@rabbitmq.com>

On 03/08/12 08:36, Matthias Radestock wrote:
> On 03/08/12 08:20, F?lix wrote:
>> Has anyone tried to put in production a plugin?
>>
>> I'm trying to install this plugin
>> https://github.com/flopezluis/rabbitmq-throttling-exchange in the
>> broker, under Macosx and Rabbitmq 2.8.5.

btw, note that your throttling exchange...

- does not preserve message order
- bypasses internal flow control
- does not enforce the rate limit correctly in the presence of multiple 
concurrent publishers

Matthias.

From matthias at rabbitmq.com  Fri Aug  3 09:41:31 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 09:41:31 +0100
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
	<501B8963.6080403@rabbitmq.com>
	<CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>
Message-ID: <501B8EBB.2070500@rabbitmq.com>

On 03/08/12 09:31, F?lix L?pez wrote:
> I'm with the tag
> 2b15e92cadcd (rabbitmq_v2_8_x) rabbitmq_v2_8_5

That's the public-umbrella revision. Are you sure that you are on the 
2.8.5 branch *for all the sub repositories*, in particular rabbitmq-server?

Matthias.

From jaaaelpumuki at gmail.com  Fri Aug  3 09:45:41 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 10:45:41 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <501B8EBB.2070500@rabbitmq.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
	<501B8963.6080403@rabbitmq.com>
	<CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>
	<501B8EBB.2070500@rabbitmq.com>
Message-ID: <CAFdw232gU_nqLJRznDTomLsyC_5CCpJwf4ZzKpnXgc7FOT=v1g@mail.gmail.com>

Let me check.

Regarding the throttling:
It's a temporary solution, I'd like to try to do good one with credit flow,
but later.

It preserves the order in what they arrive, so when a message for the
exchange Test1 arrives a process is spawned with a timeout, the next
message for the same exchange takes into that time, so it calculates its
timeout basing on it.

About the rate limit with multiple concurrent publishers, why not? It
stores the next timeout in a transaction, so the next message should
calculate its timeout taking into account the previous message.

and thanks for the answers, they're very helpful for  understanding how
rabbitmq works.

2012/8/3 Matthias Radestock <matthias at rabbitmq.com>

> On 03/08/12 09:31, F?lix L?pez wrote:
>
>> I'm with the tag
>> 2b15e92cadcd (rabbitmq_v2_8_x) rabbitmq_v2_8_5
>>
>
> That's the public-umbrella revision. Are you sure that you are on the
> 2.8.5 branch *for all the sub repositories*, in particular rabbitmq-server?
>
> Matthias.
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/ccd2c05d/attachment.htm>

From emile at rabbitmq.com  Fri Aug  3 09:56:03 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Aug 2012 09:56:03 +0100
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <e545e844-383d-4d1b-8d62-a98340072715@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
	<e545e844-383d-4d1b-8d62-a98340072715@googlegroups.com>
Message-ID: <501B9223.9030101@rabbitmq.com>

Hi,

On 02/08/12 19:59, Mark Ward wrote:
> It appears the best instructions to use are the command line certmgr for
> each Windows/Mono platform.

I see that the SSL guide does say to import the certificate of the root
Certificate Authority into the "Root" store. If you can identify any
diagnostic markers to help people solve this problem easier in the
future then please let us know so we can add it to the SSL
troubleshooting guide.



-Emile


From matthias at rabbitmq.com  Fri Aug  3 09:52:14 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 09:52:14 +0100
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <CAFdw232gU_nqLJRznDTomLsyC_5CCpJwf4ZzKpnXgc7FOT=v1g@mail.gmail.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
	<501B8963.6080403@rabbitmq.com>
	<CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>
	<501B8EBB.2070500@rabbitmq.com>
	<CAFdw232gU_nqLJRznDTomLsyC_5CCpJwf4ZzKpnXgc7FOT=v1g@mail.gmail.com>
Message-ID: <501B913E.60404@rabbitmq.com>

On 03/08/12 09:45, F?lix L?pez wrote:
> Let me check.
>
> Regarding the throttling:
> It's a temporary solution, I'd like to try to do good one with credit
> flow, but later.
>
> It preserves the order in what they arrive, so when a message for the
> exchange Test1 arrives a process is spawned with a timeout, the next
> message for the same exchange takes into that time, so it calculates its
> timeout basing on it.

In your code each message is passed on via a freshly spawned process. 
Erlang only guarantees message order between pairs of processes. What 
you have will work most of the time, particularly when message rates are 
low, but there is no guarantee.

> About the rate limit with multiple concurrent publishers, why not? It
> stores the next timeout in a transaction, so the next message should
> calculate its timeout taking into account the previous message.

The reading of the previous timeout and writing of the new timeout 
happen in different transactions. So multiple concurrent publishers 
could all read the same value.

Matthias.

From jaaaelpumuki at gmail.com  Fri Aug  3 09:54:50 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 10:54:50 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <CAFdw232gU_nqLJRznDTomLsyC_5CCpJwf4ZzKpnXgc7FOT=v1g@mail.gmail.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
	<501B8963.6080403@rabbitmq.com>
	<CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>
	<501B8EBB.2070500@rabbitmq.com>
	<CAFdw232gU_nqLJRznDTomLsyC_5CCpJwf4ZzKpnXgc7FOT=v1g@mail.gmail.com>
Message-ID: <CAFdw231h7NGJ1n60H75Z7q-1b4udJnDbYM_ZBNU=jVjo9p3+Og@mail.gmail.com>

You we're right!!!!! absolutely right!! Thank you very much, that was the
problem. I'm going to explain how I did the checkout so other people can
avoid make this mistake:

First I did: hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella/
Then: cd rabbitmq-public-umbrella
next: hg checkout rabbitmq_v2_8_5
next:  make co

And that's it, I thought that when this all the projects inside the
rabbitmq-public-umbrella
would be from the same tag/branch, but apparently they don't, so you have
to enter in the rabbitmq-server and do hg checkout rabbitmq_v2_8_5

I really appreciate the time you devote to this.

2012/8/3 F?lix L?pez <jaaaelpumuki at gmail.com>

> Let me check.
>
> Regarding the throttling:
> It's a temporary solution, I'd like to try to do good one with credit
> flow, but later.
>
> It preserves the order in what they arrive, so when a message for the
> exchange Test1 arrives a process is spawned with a timeout, the next
> message for the same exchange takes into that time, so it calculates its
> timeout basing on it.
>
> About the rate limit with multiple concurrent publishers, why not? It
> stores the next timeout in a transaction, so the next message should
> calculate its timeout taking into account the previous message.
>
> and thanks for the answers, they're very helpful for  understanding how
> rabbitmq works.
>
> 2012/8/3 Matthias Radestock <matthias at rabbitmq.com>
>
>> On 03/08/12 09:31, F?lix L?pez wrote:
>>
>>> I'm with the tag
>>> 2b15e92cadcd (rabbitmq_v2_8_x) rabbitmq_v2_8_5
>>>
>>
>> That's the public-umbrella revision. Are you sure that you are on the
>> 2.8.5 branch *for all the sub repositories*, in particular rabbitmq-server?
>>
>> Matthias.
>>
>
>
>
> --
> http://www.linkedin.com/in/flopezluis
>
> It's easier to ask forgiveness than it is to get permission
>
>
> ".....it doesn't matter how many times you fail. It doesn't matter how
> many times you almost get it right. No one is going to know or care about
> your failures, and either should you. All you have to do is learn from them
> and those around you because...All that matters in business is that you get
> it right once. Then everyone can tell you how lucky you are."
> --Mark Cuban"
>
> "Always be the worst guy in every band you're in." If you're the best guy
> there, you need to be in a different band. And I think that works for
> almost everything that's out there as well." Pat Metheny
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/b02081f0/attachment.htm>

From jaaaelpumuki at gmail.com  Fri Aug  3 09:57:15 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 10:57:15 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <501B913E.60404@rabbitmq.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
	<501B8963.6080403@rabbitmq.com>
	<CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>
	<501B8EBB.2070500@rabbitmq.com>
	<CAFdw232gU_nqLJRznDTomLsyC_5CCpJwf4ZzKpnXgc7FOT=v1g@mail.gmail.com>
	<501B913E.60404@rabbitmq.com>
Message-ID: <CAFdw2311ytdj9EKaxCmUzN53VjNe27NaMqVBAiwoZBx=1iqAvA@mail.gmail.com>

I understand, thank you. I'll try to improve it until I can do something
better with credit flow.

2012/8/3 Matthias Radestock <matthias at rabbitmq.com>

> On 03/08/12 09:45, F?lix L?pez wrote:
>
>> Let me check.
>>
>> Regarding the throttling:
>> It's a temporary solution, I'd like to try to do good one with credit
>> flow, but later.
>>
>> It preserves the order in what they arrive, so when a message for the
>> exchange Test1 arrives a process is spawned with a timeout, the next
>> message for the same exchange takes into that time, so it calculates its
>> timeout basing on it.
>>
>
> In your code each message is passed on via a freshly spawned process.
> Erlang only guarantees message order between pairs of processes. What you
> have will work most of the time, particularly when message rates are low,
> but there is no guarantee.
>
>
>  About the rate limit with multiple concurrent publishers, why not? It
>> stores the next timeout in a transaction, so the next message should
>> calculate its timeout taking into account the previous message.
>>
>
> The reading of the previous timeout and writing of the new timeout happen
> in different transactions. So multiple concurrent publishers could all read
> the same value.
>
> Matthias.
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/a32a3a15/attachment.htm>

From emile at rabbitmq.com  Fri Aug  3 10:10:15 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Aug 2012 10:10:15 +0100
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <CAFdw231h7NGJ1n60H75Z7q-1b4udJnDbYM_ZBNU=jVjo9p3+Og@mail.gmail.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
	<501B8963.6080403@rabbitmq.com>
	<CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>
	<501B8EBB.2070500@rabbitmq.com>
	<CAFdw232gU_nqLJRznDTomLsyC_5CCpJwf4ZzKpnXgc7FOT=v1g@mail.gmail.com>
	<CAFdw231h7NGJ1n60H75Z7q-1b4udJnDbYM_ZBNU=jVjo9p3+Og@mail.gmail.com>
Message-ID: <501B9577.3090600@rabbitmq.com>

Hi F?lix,

On 03/08/12 09:54, F?lix L?pez wrote:
> And that's it, I thought that when this all the projects inside the  
>  rabbitmq-public-umbrella would be from the same tag/branch, but
> apparently they don't, so you have to enter in the rabbitmq-server and
> do hg checkout rabbitmq_v2_8_5

You can set all repositories to the same branch with the named_update
make target like this:

make BRANCH=rabbitmq_v2_8_5 named_update


-Emile


From jaaaelpumuki at gmail.com  Fri Aug  3 10:08:09 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Fri, 3 Aug 2012 11:08:09 +0200
Subject: [rabbitmq-discuss] Install a plugin in the broker
In-Reply-To: <501B9577.3090600@rabbitmq.com>
References: <6026b1bb-ce5d-4628-8a7d-cb14deb0b693@googlegroups.com>
	<501B7F83.40901@rabbitmq.com>
	<CAFdw231Dy7afqVQ-4fJGQrGhQ2gm1v6om4cgT6fyfYhig8_HRw@mail.gmail.com>
	<501B8340.8030005@rabbitmq.com>
	<CAFdw2338EZmcR9xjsFHJZRHt4RABWO7uObW7EjGtGs7HKs=Kig@mail.gmail.com>
	<501B8721.3080400@rabbitmq.com>
	<CAFdw232FKCjfSn+NuVXV0mq=oX4mh+CTykVeSASTmHnWHOFZEw@mail.gmail.com>
	<501B8963.6080403@rabbitmq.com>
	<CAFdw232OnPsjvT5p4+Ym=ewASKNVO_Pzv2ZT=gq4+VDppCCQ5w@mail.gmail.com>
	<501B8EBB.2070500@rabbitmq.com>
	<CAFdw232gU_nqLJRznDTomLsyC_5CCpJwf4ZzKpnXgc7FOT=v1g@mail.gmail.com>
	<CAFdw231h7NGJ1n60H75Z7q-1b4udJnDbYM_ZBNU=jVjo9p3+Og@mail.gmail.com>
	<501B9577.3090600@rabbitmq.com>
Message-ID: <CAFdw231SHe6xgFTzjf6vFM-7yTco0+D=yqW+y8pBW+wDHEXSXA@mail.gmail.com>

thanks, that's better ;)

2012/8/3 Emile Joubert <emile at rabbitmq.com>

> Hi F?lix,
>
> On 03/08/12 09:54, F?lix L?pez wrote:
> > And that's it, I thought that when this all the projects inside the
> >  rabbitmq-public-umbrella would be from the same tag/branch, but
> > apparently they don't, so you have to enter in the rabbitmq-server and
> > do hg checkout rabbitmq_v2_8_5
>
> You can set all repositories to the same branch with the named_update
> make target like this:
>
> make BRANCH=rabbitmq_v2_8_5 named_update
>
>
> -Emile
>
>


-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/041ff273/attachment.htm>

From hendy at soluvas.com  Fri Aug  3 11:56:37 2012
From: hendy at soluvas.com (Hendy Irawan)
Date: Fri, 3 Aug 2012 03:56:37 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.8.5 released
In-Reply-To: <501A8685.7090003@rabbitmq.com>
References: <501A8685.7090003@rabbitmq.com>
Message-ID: <1343991397309-21239.post@n5.nabble.com>

Thank you for the release!

Thank you also for including the web_stomp plugin.

However rabbitmq_web_stomp version 2.8.5 is not working. stomp.js can
subscribe to topics but no messages are received.

Using the rabbitmq_web_stomp plugin version 2.8.2 works fine, even with
RabbitMQ 2.8.5.

Shall I report a bug ? where..

Thank you

Hendy



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-2-8-5-released-tp21193p21239.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Fri Aug  3 12:22:28 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 12:22:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.5 released
In-Reply-To: <1343991397309-21239.post@n5.nabble.com>
References: <501A8685.7090003@rabbitmq.com>
	<1343991397309-21239.post@n5.nabble.com>
Message-ID: <501BB474.3010909@rabbitmq.com>

On 03/08/12 11:56, Hendy Irawan wrote:
> However rabbitmq_web_stomp version 2.8.5 is not working. stomp.js can
> subscribe to topics but no messages are received.

That plug-in was not supposed to have been included in the release. 
Ignore it and continue using the 2.8.2 plugin.

Matthias.


From thiagoburgo at gmail.com  Fri Aug  3 18:10:36 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Fri, 3 Aug 2012 14:10:36 -0300
Subject: [rabbitmq-discuss] Queue with x-expires not expires after
	timeout
In-Reply-To: <501AF874.1060304@rabbitmq.com>
References: <CABjKUK_uit50A1mgMVHYxxAohtvSSXs+VQfjK0L_s61imj=s4A@mail.gmail.com>
	<501AF874.1060304@rabbitmq.com>
Message-ID: <CABjKUK-Zeo-TLUf9zPHF0H3F-6FqsN=nfiXCVyFCBMsOLoSwzQ@mail.gmail.com>

Matthias,

Has 2 consumers, but this is more strange, because I closed all connections
with Rabbit (.NEt Client) and the consumers are Idle since 2012-08-02
15:05:56, the consumers will never die?
Note 1:  I already turned off my computer (client) and the consumer keep
alive.
Note 1: I'm using a non default virtual host, something like /myVirtualHost

See the attachment.

Thanks,

Thiago Burgo

2012/8/2 Matthias Radestock <matthias at rabbitmq.com>

> On 02/08/12 20:58, Thiago Burgo Belo wrote:
>
>> My queue with x-expires not expires after timeout, the follow queue was
>> created and not accessed since (2012-08-02 14:00), and not expired until
>> now.
>>
>> Parameters
>> x-ha-policy:    all
>> x-expires:      9000
>> arguments:
>> x-match:        any
>>
>> durable:        true
>>
>> Exclusive owner None Status Idle since
>> 2012-08-02 16:16:58
>>
>
> Does the queue have a consumer? From http://www.rabbitmq.com/**
> extensions.html#queue-leases<http://www.rabbitmq.com/extensions.html#queue-leases>
> <quote>
> "Unused means the queue has no consumers, the queue has not been
> redeclared, and basic.get has not been invoked for a duration of at least
> the expiration period."
> </quote>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/456b236e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.png
Type: image/png
Size: 27288 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/456b236e/attachment.png>

From curylod at asme.org  Fri Aug  3 18:58:25 2012
From: curylod at asme.org (Dave Curylo)
Date: Fri, 3 Aug 2012 13:58:25 -0400
Subject: [rabbitmq-discuss] Queue with x-expires not expires after
	timeout
In-Reply-To: <CABjKUK-Zeo-TLUf9zPHF0H3F-6FqsN=nfiXCVyFCBMsOLoSwzQ@mail.gmail.com>
References: <CABjKUK_uit50A1mgMVHYxxAohtvSSXs+VQfjK0L_s61imj=s4A@mail.gmail.com>
	<501AF874.1060304@rabbitmq.com>
	<CABjKUK-Zeo-TLUf9zPHF0H3F-6FqsN=nfiXCVyFCBMsOLoSwzQ@mail.gmail.com>
Message-ID: <913EFBEE-263B-4413-ACFE-515D998BF423@asme.org>

Thiago,

Regarding your consumers, when using the .NET client, you should make sure to set the RequestedHeartbeat property on your ConnectionFactory to a non-zero value.  If you don't do this, then should a process die without a chance to clean up the connection, it may never get disconnected and you will have to close the connections manually either through the management web interface or rabbitmqctl.  Rabbit seems to hold on to the connections if you don't do this.

Here is a helpful script if you have a lot of connections and find it tedious to close them using the web UI.

#!/bin/bash
peerToDisconnect=1.2.3.4
for c in `rabbitmqctl list_connections peer_address pid | grep $peerToDisconnect`;
do
if [ $c != $peerToDisconnect ];
then rabbitmqctl close_connection $c "Orphaned - disconnecting";
fi;
done
-Dave

On Aug 3, 2012, at 1:10 PM, Thiago Burgo Belo wrote:

> Matthias, 
> 
> Has 2 consumers, but this is more strange, because I closed all connections with Rabbit (.NEt Client) and the consumers are Idle since 2012-08-02 15:05:56, the consumers will never die?
> Note 1:  I already turned off my computer (client) and the consumer keep alive.
> Note 1: I'm using a non default virtual host, something like /myVirtualHost
> 
> See the attachment.
> 
> Thanks, 
> 
> Thiago Burgo
> 
> 2012/8/2 Matthias Radestock <matthias at rabbitmq.com>
> On 02/08/12 20:58, Thiago Burgo Belo wrote:
> My queue with x-expires not expires after timeout, the follow queue was
> created and not accessed since (2012-08-02 14:00), and not expired until
> now.
> 
> Parameters
> x-ha-policy:    all
> x-expires:      9000
> arguments:      
> x-match:        any
> 
> durable:        true
> 
> Exclusive owner None Status Idle since
> 2012-08-02 16:16:58
> 
> Does the queue have a consumer? From http://www.rabbitmq.com/extensions.html#queue-leases
> <quote>
> "Unused means the queue has no consumers, the queue has not been redeclared, and basic.get has not been invoked for a duration of at least the expiration period."
> </quote>
> 
> Matthias.
> 
> <rabbit.png>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/72c986ee/attachment.htm>

From thiagoburgo at gmail.com  Fri Aug  3 19:23:25 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Fri, 3 Aug 2012 15:23:25 -0300
Subject: [rabbitmq-discuss] Queue with x-expires not expires after
	timeout
In-Reply-To: <913EFBEE-263B-4413-ACFE-515D998BF423@asme.org>
References: <CABjKUK_uit50A1mgMVHYxxAohtvSSXs+VQfjK0L_s61imj=s4A@mail.gmail.com>
	<501AF874.1060304@rabbitmq.com>
	<CABjKUK-Zeo-TLUf9zPHF0H3F-6FqsN=nfiXCVyFCBMsOLoSwzQ@mail.gmail.com>
	<913EFBEE-263B-4413-ACFE-515D998BF423@asme.org>
Message-ID: <CABjKUK9uUZbq8NsU6dGiJ9QOvmCtSw0zm7y_P4W0K=NG933agQ@mail.gmail.com>

Thanks Dave,

But this behavior is right? Why the rabbit dont disconnect client when
connection/socket timeout.

Thiago Burgo

2012/8/3 Dave Curylo <curylod at asme.org>

> Thiago,
>
> Regarding your consumers, when using the .NET client, you should make sure
> to set the RequestedHeartbeat property on your ConnectionFactory to a
> non-zero value.  If you don't do this, then should a process die without a
> chance to clean up the connection, it may never get disconnected and you
> will have to close the connections manually either through the management
> web interface or rabbitmqctl.  Rabbit seems to hold on to the connections
> if you don't do this.
>
> Here is a helpful script if you have a lot of connections and find it
> tedious to close them using the web UI.
>
> #!/bin/bash
> peerToDisconnect=1.2.3.4
> for c in `rabbitmqctl list_connections peer_address pid | grep $peerToDisconnect`;
> do
> if [ $c != $peerToDisconnect ];
> then rabbitmqctl close_connection $c "Orphaned - disconnecting";
> fi;
> done
>
> -Dave
>
> On Aug 3, 2012, at 1:10 PM, Thiago Burgo Belo wrote:
>
> Matthias,
>
> Has 2 consumers, but this is more strange, because I closed all
> connections with Rabbit (.NEt Client) and the consumers are Idle since
> 2012-08-02 15:05:56, the consumers will never die?
> Note 1:  I already turned off my computer (client) and the consumer keep
> alive.
> Note 1: I'm using a non default virtual host, something like /myVirtualHost
>
> See the attachment.
>
> Thanks,
>
> Thiago Burgo
>
> 2012/8/2 Matthias Radestock <matthias at rabbitmq.com>
>
>> On 02/08/12 20:58, Thiago Burgo Belo wrote:
>>
>>> My queue with x-expires not expires after timeout, the follow queue was
>>> created and not accessed since (2012-08-02 14:00), and not expired until
>>> now.
>>>
>>> Parameters
>>> x-ha-policy:    all
>>> x-expires:      9000
>>> arguments:
>>> x-match:        any
>>>
>>> durable:        true
>>>
>>> Exclusive owner None Status Idle since
>>> 2012-08-02 16:16:58
>>>
>>
>> Does the queue have a consumer? From http://www.rabbitmq.com/**
>> extensions.html#queue-leases<http://www.rabbitmq.com/extensions.html#queue-leases>
>> <quote>
>> "Unused means the queue has no consumers, the queue has not been
>> redeclared, and basic.get has not been invoked for a duration of at least
>> the expiration period."
>> </quote>
>>
>> Matthias.
>>
>
> <rabbit.png>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/e6877baa/attachment.htm>

From ruben at fiadmin.com  Fri Aug  3 19:29:38 2012
From: ruben at fiadmin.com (Ruben Rotteveel)
Date: Fri, 3 Aug 2012 18:29:38 +0000
Subject: [rabbitmq-discuss] Disaster Recovery
Message-ID: <D805D38E96E2514DA975AE0F5416C8DA036A9A@FIEXMB00.natinc.com>

Hi All,

What is your recommendation for how to  mirror a rabbitmq installation in a DR site?

Thanks,
Ruben Rotteveel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/50b08518/attachment.htm>

From jerryk at rbcon.com  Fri Aug  3 19:54:24 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 3 Aug 2012 11:54:24 -0700
Subject: [rabbitmq-discuss] Disaster Recovery
In-Reply-To: <D805D38E96E2514DA975AE0F5416C8DA036A9A@FIEXMB00.natinc.com>
References: <D805D38E96E2514DA975AE0F5416C8DA036A9A@FIEXMB00.natinc.com>
Message-ID: <CAE0Sz=wTwEdbwiOOhQzejAoYDGDRcvPdojKGjpEDh-S5mNiz5g@mail.gmail.com>

Hi, Ruben:

We have users that make use of Rabbit/AMQP messaging as part of cross-site
DR scenarios, but one has to be thoughtful about what one is trying to do.

*What* is it that you want replicated between sites for DR?  Presumably
more than just broker and cluster configs and their metadata since that's
relatively straightforward...  Usually the question is what data, effects
and business processes do you want to be able to fail over to a
geographically separated site, and what sorts of guarantees do you want for
the failover.  This naturally affects the design of your application and
its deployment fairly intimately.

If you feel comfortable talking more about what you want from your scenario
we can probably make some suggestions based on things we've seen done...

Best regards,
Jerry


On Fri, Aug 3, 2012 at 11:29 AM, Ruben Rotteveel <ruben at fiadmin.com> wrote:

> Hi All,****
>
> ** **
>
> What is your recommendation for how to  mirror a rabbitmq installation in
> a DR site?****
>
> ** **
>
> Thanks,****
>
> Ruben Rotteveel****
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/18a8b403/attachment.htm>

From matthias at rabbitmq.com  Fri Aug  3 20:18:06 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 03 Aug 2012 20:18:06 +0100
Subject: [rabbitmq-discuss] Queue with x-expires not expires after
	timeout
In-Reply-To: <CABjKUK9uUZbq8NsU6dGiJ9QOvmCtSw0zm7y_P4W0K=NG933agQ@mail.gmail.com>
References: <CABjKUK_uit50A1mgMVHYxxAohtvSSXs+VQfjK0L_s61imj=s4A@mail.gmail.com>
	<501AF874.1060304@rabbitmq.com>
	<CABjKUK-Zeo-TLUf9zPHF0H3F-6FqsN=nfiXCVyFCBMsOLoSwzQ@mail.gmail.com>
	<913EFBEE-263B-4413-ACFE-515D998BF423@asme.org>
	<CABjKUK9uUZbq8NsU6dGiJ9QOvmCtSw0zm7y_P4W0K=NG933agQ@mail.gmail.com>
Message-ID: <501C23EE.8050401@rabbitmq.com>

On 03/08/12 19:23, Thiago Burgo Belo wrote:
> But this behavior is right? Why the rabbit dont disconnect client when
> connection/socket timeout.

There is nothing rabbit can do about it. As far as the network stack at 
the server is concerned the connection is still alive. The network layer 
will eventually time out, but that can take a long time.

Matthias.

From thiagoburgo at gmail.com  Fri Aug  3 20:57:42 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Fri, 3 Aug 2012 16:57:42 -0300
Subject: [rabbitmq-discuss] Queue with x-expires not expires after
	timeout
In-Reply-To: <501C23EE.8050401@rabbitmq.com>
References: <CABjKUK_uit50A1mgMVHYxxAohtvSSXs+VQfjK0L_s61imj=s4A@mail.gmail.com>
	<501AF874.1060304@rabbitmq.com>
	<CABjKUK-Zeo-TLUf9zPHF0H3F-6FqsN=nfiXCVyFCBMsOLoSwzQ@mail.gmail.com>
	<913EFBEE-263B-4413-ACFE-515D998BF423@asme.org>
	<CABjKUK9uUZbq8NsU6dGiJ9QOvmCtSw0zm7y_P4W0K=NG933agQ@mail.gmail.com>
	<501C23EE.8050401@rabbitmq.com>
Message-ID: <CABjKUK-YhV7Tpkhzd5gtQ8ieCKO9barht9iMsezNxdzxTdmxAw@mail.gmail.com>

Ok! Thanks again  Matthias and Dave

2012/8/3 Matthias Radestock <matthias at rabbitmq.com>

> On 03/08/12 19:23, Thiago Burgo Belo wrote:
>
>> But this behavior is right? Why the rabbit dont disconnect client when
>> connection/socket timeout.
>>
>
> There is nothing rabbit can do about it. As far as the network stack at
> the server is concerned the connection is still alive. The network layer
> will eventually time out, but that can take a long time.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/29f1ee0c/attachment.htm>

From ruben at fiadmin.com  Fri Aug  3 21:36:00 2012
From: ruben at fiadmin.com (Ruben Rotteveel)
Date: Fri, 3 Aug 2012 20:36:00 +0000
Subject: [rabbitmq-discuss] Disaster Recovery
In-Reply-To: <CAE0Sz=wTwEdbwiOOhQzejAoYDGDRcvPdojKGjpEDh-S5mNiz5g@mail.gmail.com>
References: <D805D38E96E2514DA975AE0F5416C8DA036A9A@FIEXMB00.natinc.com>
	<CAE0Sz=wTwEdbwiOOhQzejAoYDGDRcvPdojKGjpEDh-S5mNiz5g@mail.gmail.com>
Message-ID: <D805D38E96E2514DA975AE0F5416C8DA036E1D@FIEXMB00.natinc.com>

Hi Jerry,

In terms of acceptable data loss, for our db's we accept 15 minutes worth of data loss, the same level of tolerance would be acceptable for rabbitmq.

The assumption is that the failover will not be automatic but that it will have to be manually flipped to the DR site and that back ground processes would have to be started up manually.

Thanks,
Ruben.

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jerry Kuch
Sent: Friday, August 03, 2012 1:54 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Disaster Recovery

Hi, Ruben:

We have users that make use of Rabbit/AMQP messaging as part of cross-site DR scenarios, but one has to be thoughtful about what one is trying to do.

*What* is it that you want replicated between sites for DR?  Presumably more than just broker and cluster configs and their metadata since that's relatively straightforward...  Usually the question is what data, effects and business processes do you want to be able to fail over to a geographically separated site, and what sorts of guarantees do you want for the failover.  This naturally affects the design of your application and its deployment fairly intimately.

If you feel comfortable talking more about what you want from your scenario we can probably make some suggestions based on things we've seen done...

Best regards,
Jerry

On Fri, Aug 3, 2012 at 11:29 AM, Ruben Rotteveel <ruben at fiadmin.com<mailto:ruben at fiadmin.com>> wrote:
Hi All,

What is your recommendation for how to  mirror a rabbitmq installation in a DR site?

Thanks,
Ruben Rotteveel

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/d3c834bf/attachment.htm>

From Glen.Cox at echostar.com  Fri Aug  3 22:46:24 2012
From: Glen.Cox at echostar.com (Cox, Glen)
Date: Fri, 3 Aug 2012 21:46:24 +0000
Subject: [rabbitmq-discuss] Shovel Plugin: How to create an auto-delete
	queue on source broker
Message-ID: <1304222FCC14C044AE4583D3C94F54400D67D19D@INWPIEXC02.SATS.CORP>

We have a production broker and frequently use the shovel plugin to move traffic to our testing environment.  Frequently our test environment gets into a bad state (crashes, disconnects), and this causes messages to build up on the production queue.  Due to our heavy throughput, this scenario then crashes production.

Is there a way to specify auto-delete as one of the queue.declare parameters within the shovel plugin?  I've tried the obvious permutations to no avail.

Both brokers are 2.8.2 on erlang R15B01.

Thanks in advance,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120803/c60fb227/attachment.htm>

From toby.riley at rekoop.com  Sat Aug  4 14:51:50 2012
From: toby.riley at rekoop.com (Toby Riley)
Date: Sat, 4 Aug 2012 14:51:50 +0100
Subject: [rabbitmq-discuss] Acknowledging messages using the
 EventingBasicConsumer
In-Reply-To: <501A8C86.9060501@rabbitmq.com>
References: <84B3D44AADE2D843994ED89240B2DFA2FCC38954@mailbox1b.gmsuk.net>
	<501A8C86.9060501@rabbitmq.com>
Message-ID: <84B3D44AADE2D843994ED89240B2DFA2FCC389DC@mailbox1b.gmsuk.net>

Thanks Emile,

I'll probably go with the auto ack for now or _channel.BasicAck as it's quite legal to access the property within the anonymous delegate. However it would make sense to use the BasicAck on the sender as it seems cleaner and more obvious.

Regards

Toby

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 02 August 2012 15:20
To: Discussions about RabbitMQ
Cc: Toby Riley
Subject: Re: [rabbitmq-discuss] Acknowledging messages using the EventingBasicConsumer

Hi Toby,

On 02/08/12 12:05, Toby Riley wrote:
> I have a question I could not find a proper answer to anywhere, and it 
> is to do with the Acknowledging messages using the
> EventingBasicConsumer, I?m using   _channel.BasicAck(e.DeliveryTag,
> false); but there is one for o.Model. BasicAck(e.DeliveryTag, false) 
> but the sender object (o) is null.
> 
> What is the proper way to Acknowledge message from the Received event 
> when using the EventingBasicConsumer when you inside the delegate?

You should first make sure that it is correct to acknowledge the message. If there were any asynchronous events that could fail and that were triggered as a result of the message then you might as well use automatic acknowledgements.

I'm not sure why the event sender is null in your example. That may well be a bug in EventingBasicConsumer, which is classed as experimental.
Using the sender would be the preferable approach. I will file a bug to investigate why the value is null. Thanks for reporting this.


-Emile


From roger.maillist at gmail.com  Sat Aug  4 20:37:12 2012
From: roger.maillist at gmail.com (luo roger)
Date: Sun, 5 Aug 2012 03:37:12 +0800
Subject: [rabbitmq-discuss] How a basic cusumer of WAN know the internet
	connection is break?
Message-ID: <CA+JXe07kEQtafvgkdwcxgXBDYMENgAk44Q7J7+2cZ3Npb=uA7A@mail.gmail.com>

I am using pika lib.

When I creat basic cusumer using a callback function, the broker push
messsages to the client,.

client connect to the broker throught internent, but the WAN is unstable.
when the WAN is break, new message can't be pushed to client,but client
think everything is ok just no new message. Then my app REST here.

If client use baisc get in loop, it pull message from broker, when the
connection is break,   exception of AMQPConnectionError be caused.
The client can know internet is error.

How a basic cusumer of WAN know the connection is break?

Roger

From watson.timothy at gmail.com  Sun Aug  5 10:37:59 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Sun, 5 Aug 2012 10:37:59 +0100
Subject: [rabbitmq-discuss] How a basic cusumer of WAN know the internet
	connection is break?
In-Reply-To: <CA+JXe07kEQtafvgkdwcxgXBDYMENgAk44Q7J7+2cZ3Npb=uA7A@mail.gmail.com>
References: <CA+JXe07kEQtafvgkdwcxgXBDYMENgAk44Q7J7+2cZ3Npb=uA7A@mail.gmail.com>
Message-ID: <4A71FCE8-9E62-482D-AE9D-BEEA8FC96797@rabbitmq.com>

Hi 
On 4 Aug 2012, at 20:37, luo roger <roger.maillist at gmail.com> wrote:

> I am using pika lib.
> 
> When I creat basic cusumer using a callback function, the broker push
> messsages to the client,.
> 
> client connect to the broker throught internent, but the WAN is unstable.
> when the WAN is break, new message can't be pushed to client,but client
> think everything is ok just no new message. Then my app REST here.
> 
> If client use baisc get in loop, it pull message from broker, when the
> connection is break,   exception of AMQPConnectionError be caused.
> The client can know internet is error.
> 
> How a basic cusumer of WAN know the connection is break?
> 

First of all, you should look to enable AMQP heartbeats on the channel, which will detect a broken connection quicker than waiting for the underlying tcp/ip layers to figure out what's going on.

HTH

Tim

> Roger
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From monish.unni at gmail.com  Mon Aug  6 04:21:25 2012
From: monish.unni at gmail.com (cogitate)
Date: Sun, 5 Aug 2012 20:21:25 -0700 (PDT)
Subject: [rabbitmq-discuss] request, reply connections and channels
Message-ID: <1344223285254-21254.post@n5.nabble.com>

hi mathias:

#using rabbitmq java client :
  for the sake of concurrency, i use one connection for publish( using a
channel assoc. to that conn.) and another for reply ( use a different
channel assoc. to reply conn.).

i'd like to throw an exception/error when basicPublish is called on a
non-existent exchange [on the broker].
it seems setting mandatory=true, and registering a returnListener on the
channel won't work (since, the connection for req and reply are different )
- which i verified by registering returnListeners(for req/reply channels
associated to the two different connections). 

what are my options besides switching to using the same connection for
req/reply? any configuration on the broker that might help will be quite
useful.

# using python client:
not sure why, but it simply works! i don't even set mandatory=true. the pika
client simply doesn't allow me to publish to a non-existent exchange on the
broker.

thanks and regards,
-monish





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/request-reply-connections-and-channels-tp21254.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From monish.unni at gmail.com  Mon Aug  6 04:44:49 2012
From: monish.unni at gmail.com (cogitate)
Date: Sun, 5 Aug 2012 20:44:49 -0700 (PDT)
Subject: [rabbitmq-discuss] request, reply connections and channels
In-Reply-To: <1344223285254-21254.post@n5.nabble.com>
References: <1344223285254-21254.post@n5.nabble.com>
Message-ID: <1344224689614-21255.post@n5.nabble.com>

hi mathias:
 it seems i can solve the problem by
reqChannel.exchangeDeclarePassive(<non_existent_exchange>)
is this advisable for every call from a performance point-of-view?

maybe, i can write a broker plugin, but will that have the same performance
hit?

regards,
-monish




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/request-reply-connections-and-channels-tp21254p21255.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From master at clevertech.ru  Sat Aug  4 06:21:49 2012
From: master at clevertech.ru (Vitali Makarov)
Date: Fri, 3 Aug 2012 22:21:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Metronome: How easy delivery messages from
	plugin?
Message-ID: <1344057709863-21250.post@n5.nabble.com>

Hi.
I`m developing custom plugin for RabbitMQ.
How I can easy get messages from channel or exchange into plugin?
I looked through a bunch of sources, and anyway can not understand.
Please show an example metronome.

For example:
Metronome send messages in rabbit.
Me need easy metronome receiver in second plugin.

name: rabbitmq-metronome-receiver
desc: plugin get messages from metronome and write it in log 

rabbit_log:info("Metronome-receiver: routing_key: ~p, message: ~p~n",
[RoutingKey,Message]),



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Metronome-How-easy-delivery-messages-from-plugin-tp21250.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Aug  6 10:07:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Aug 2012 10:07:02 +0100
Subject: [rabbitmq-discuss] Metronome: How easy delivery messages from
 plugin?
In-Reply-To: <1344057709863-21250.post@n5.nabble.com>
References: <1344057709863-21250.post@n5.nabble.com>
Message-ID: <501F8936.8010702@rabbitmq.com>


Hi Vitali,

On 04/08/12 06:21, Vitali Makarov wrote:
> How I can easy get messages from channel or exchange into plugin?

The simplest way is to get messages is to use the Erlang direct client
and subscribe to a queue. See

http://www.rabbitmq.com/erlang-client-user-guide.html#receiving

> I looked through a bunch of sources, and anyway can not understand.
> Please show an example metronome.

The metronome is used as a "hello world" example that sends messages:

http://www.rabbitmq.com/plugin-development.html#plugin-hello-world
http://hg.rabbitmq.com/rabbitmq-metronome/

> For example:
> Metronome send messages in rabbit.
> Me need easy metronome receiver in second plugin.
> 
> name: rabbitmq-metronome-receiver
> desc: plugin get messages from metronome and write it in log 
> 
> rabbit_log:info("Metronome-receiver: routing_key: ~p, message: ~p~n",
> [RoutingKey,Message]),

If you want a record of all messages passing through the broker then
also look at the firehose tracer:

http://www.rabbitmq.com/firehose.html



-Emile


From emile at rabbitmq.com  Mon Aug  6 11:12:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Aug 2012 11:12:06 +0100
Subject: [rabbitmq-discuss] Shovel Plugin: How to create an auto-delete
 queue on source broker
In-Reply-To: <1304222FCC14C044AE4583D3C94F54400D67D19D@INWPIEXC02.SATS.CORP>
References: <1304222FCC14C044AE4583D3C94F54400D67D19D@INWPIEXC02.SATS.CORP>
Message-ID: <501F9876.3040506@rabbitmq.com>


Hi Glen,

On 03/08/12 22:46, Cox, Glen wrote:
> Is there a way to specify auto-delete as one of the queue.declare
> parameters within the shovel plugin?

Yes it is possible, using a declaration stanza like this:

{declarations,[{'queue.declare',[{queue,<<"queue_name">>},
                                 durable,auto_delete]}]}

You can also declare the queue independently with any parameters and
arguments, and then tell the shovel plugin to use the queue that you
declared.


-Emile


From emile at rabbitmq.com  Mon Aug  6 11:39:44 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Aug 2012 11:39:44 +0100
Subject: [rabbitmq-discuss] request, reply connections and channels
In-Reply-To: <1344224689614-21255.post@n5.nabble.com>
References: <1344223285254-21254.post@n5.nabble.com>
	<1344224689614-21255.post@n5.nabble.com>
Message-ID: <501F9EF0.7040506@rabbitmq.com>


Hi,

On 06/08/12 04:44, cogitate wrote:
> i'd like to throw an exception/error when basicPublish is called on a
> non-existent exchange [on the broker].
> it seems setting mandatory=true, and registering a returnListener on the
> channel won't work (since, the connection for req and reply are different )

The mandatory option is relevant when a message cannot be routed to a
queue. Attempting to publish to a non-existent exchange is a very
different issue and the return-listener is not used to report this
condition.

> what are my options besides switching to using the same connection for
> req/reply? any configuration on the broker that might help will be quite
> useful.

A possible option is to guarantee that the exchange cannot be absent.
Assign permissions in a way that guarantees exchanges cannot be deleted.

Another option is to use publisher confirms:
www.rabbitmq.com/extensions.html#confirms
These should inform the client of a channel exception, though I don't
know exactly how this gets reported in Pika.

> # using python client:
> not sure why, but it simply works! i don't even set mandatory=true. the pika
> client simply doesn't allow me to publish to a non-existent exchange on the
> broker.

I'm not familiar enough with Pika to explain this, but regardless of the
AMQP client you choose to use, is is impossible to use the same channel
to do useful work after a channel exception was raised. The mandatory
flag is unlikely to play any part.

>  it seems i can solve the problem by
> reqChannel.exchangeDeclarePassive(<non_existent_exchange>)
> is this advisable for every call from a performance point-of-view?

When you publish to a non-existent exchange a channel exception is
raised, closing the channel. Publishing is an asynchronous operation, so
the caller is unaware of this until the next synchronous operation.
Issuing an exchange passive declare is a synchronous operation which
will alert the caller if the channel has closed. You could use any other
synchronous operation.

Interspersing publishes with synchronous operations is likely to reduce
the maximum possible publish speed dramatically.


-Emile

From matthias at rabbitmq.com  Mon Aug  6 11:53:45 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 06 Aug 2012 11:53:45 +0100
Subject: [rabbitmq-discuss] How a basic cusumer of WAN know the internet
 connection is break?
In-Reply-To: <4A71FCE8-9E62-482D-AE9D-BEEA8FC96797@rabbitmq.com>
References: <CA+JXe07kEQtafvgkdwcxgXBDYMENgAk44Q7J7+2cZ3Npb=uA7A@mail.gmail.com>
	<4A71FCE8-9E62-482D-AE9D-BEEA8FC96797@rabbitmq.com>
Message-ID: <501FA239.7070707@rabbitmq.com>

On 05/08/12 10:37, Tim Watson wrote:
> Hi On 4 Aug 2012, at 20:37, luo roger <roger.maillist at gmail.com>
> wrote:
>
>> I am using pika lib.
>>
>> When I creat basic cusumer using a callback function, the broker
>> push messsages to the client,.
>>
>> client connect to the broker throught internent, but the WAN is
>> unstable. when the WAN is break, new message can't be pushed to
>> client,but client think everything is ok just no new message. Then
>> my app REST here.
>>
>> If client use baisc get in loop, it pull message from broker, when
>> the connection is break,   exception of AMQPConnectionError be
>> caused. The client can know internet is error.
>>
>> How a basic cusumer of WAN know the connection is break?
>>
>
> First of all, you should look to enable AMQP heartbeats on the
> channel, which will detect a broken connection quicker than waiting
> for the underlying tcp/ip layers to figure out what's going on.

heartbeats are probably a red herring here, since the OP *does* see 
AMQPConnectionErrors when using basic.get, so clearly broken connections 
do get detected in a reasonably timely manner.

The question is how such exceptions get reported in the case of 
basic.consume.

I am not familiar with pika so don't have a definitive answer, but 
looking at the API docs I can see an add_on_close_callback function on 
connection objects; I'd suggest giving that a try. If that doesn't work 
then please contact the pika authors (see https://github.com/pika).

Matthias.

From raphael.degiusti at gmail.com  Mon Aug  6 15:29:00 2012
From: raphael.degiusti at gmail.com (=?UTF-8?Q?Rapha=C3=ABl_De_Giusti?=)
Date: Mon, 6 Aug 2012 07:29:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Wrapping pika callbacks, why ?
Message-ID: <09ce0f5e-cb1a-4580-a9ce-68724604c987@googlegroups.com>

Hi everyone,

I'm interested in running pika's IOLoop in a thread and I came across this 
code sample : 
http://cms02.phys.ntu.edu.tw/tracs/env/browser/trunk/messaging/pika/mon.py

I was wondering why and what could be the advantages of wrapping the 
callbacks in methods (I can understand the on_exchange_declared() method 
that returns a different callback according to thread's name) ?

Another question is why considering multiprocessing over threading in this 
case ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120806/601c9d1f/attachment.htm>

From gmr at meetme.com  Mon Aug  6 16:55:58 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Mon, 6 Aug 2012 11:55:58 -0400
Subject: [rabbitmq-discuss] Wrapping pika callbacks, why ?
In-Reply-To: <09ce0f5e-cb1a-4580-a9ce-68724604c987@googlegroups.com>
References: <09ce0f5e-cb1a-4580-a9ce-68724604c987@googlegroups.com>
Message-ID: <D90D4904377A44179C39C4DBB2D99C63@meetme.com>


On Monday, August 6, 2012 at 10:29 AM, Rapha?l De Giusti wrote:  
> Hi everyone,
>  
> I'm interested in running pika's IOLoop in a thread and I came across this code sample : http://cms02.phys.ntu.edu.tw/tracs/env/browser/trunk/messaging/pika/mon.py
>  
> I was wondering why and what could be the advantages of wrapping the callbacks in methods (I can understand the on_exchange_declared() method that returns a different callback according to thread's name) ?
As opposed to doing lambda's for callbacks? I'm not sure of the context of what you're comparing callback passing style to.
> Another question is why considering multiprocessing over threading in this case ?
>  
>  

The IOLoop is a singleton instance and you will run into contention issues and non-thread safe behaviors in use of the IOLoop and event processing.  

I'm not sure what threading buys you in an asynchronous event based model of processing but needless complexity.

Gavin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120806/892657d7/attachment.htm>

From monish.unni at gmail.com  Mon Aug  6 17:06:09 2012
From: monish.unni at gmail.com (cogitate)
Date: Mon, 6 Aug 2012 09:06:09 -0700 (PDT)
Subject: [rabbitmq-discuss] request, reply connections and channels
In-Reply-To: <501F9EF0.7040506@rabbitmq.com>
References: <1344223285254-21254.post@n5.nabble.com>
	<1344224689614-21255.post@n5.nabble.com>
	<501F9EF0.7040506@rabbitmq.com>
Message-ID: <1344269169077-21262.post@n5.nabble.com>

thanks much emily. 
and yes, i was making an error with queue_name instead of exchange (w/
mandatory=true). 

will try to design around these restrictions - won't use sync calls.
also, if this :
http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/
is anything to go by, i should simply turn off "mandatory" flag ( we use
alternate-exchange and dead-letter-exchanges w/ x-message-ttl on queues )
since, it seems there's a 40% drop in performance.

much regards,
-monish



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/request-reply-connections-and-channels-tp21254p21262.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From monish.unni at gmail.com  Mon Aug  6 23:39:59 2012
From: monish.unni at gmail.com (cogitate)
Date: Mon, 6 Aug 2012 15:39:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <4FFF0727.909@vmware.com>
References: <1341938859568-20687.post@n5.nabble.com>
	<CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
	<1342030568666-20721.post@n5.nabble.com>
	<4FFDCBAA.1070001@vmware.com>
	<1342042707718-20725.post@n5.nabble.com>
	<4FFEC4A0.1010107@vmware.com>
	<1342112585500-20761.post@n5.nabble.com> <4FFF0727.909@vmware.com>
Message-ID: <1344292799149-21263.post@n5.nabble.com>

hi gary:
 using spring-amqp 1.1.1.RELEASE it seems i have to change the version of
spring-rabbit to 1.0.0.RELEASE

	 <dependency>
            <groupId>org.springframework.amqp</groupId>
            <artifactId>spring-amqp</artifactId>
            <version>1.1.1.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.amqp</groupId>
            <artifactId>spring-rabbit</artifactId>
            
            <version>1.0.0.RELEASE</version>
        </dependency>

the problem is this forms the core to a spring-integration webapp for which
i need spring-rabbit:1.1.0.RELEASE which has support for
dead-letter-exchange. 

even when i upgrade spring-rabbit:1.1.1.RELEASE i get the same error as with
1.1.0.RELEASE of spring-rabbit.

the error is :
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException:
No bean named 'replies' is defined
	at
org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanDefinition(DefaultListableBeanFactory.java:527)


what would you recommend we do?

thanks and regards,
-monish






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687p21263.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bme at saseco.dk  Tue Aug  7 08:17:05 2012
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Tue, 7 Aug 2012 09:17:05 +0200
Subject: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby
Message-ID: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>

I am still seeing an issue with RabbitMQ service (no clients) having high
cpu usage when returning from standby. It does not happen every time,
though.

 

Using Process Explorer I see a new cmd.exe being spawned by erl.exe over and
over again, never stopping.

 

Restarting RabbitMQ Service stops this behavior.

 

Using Erlang R15B01 (x64) on Windows 7.

-- 

Bernhard

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120807/f0db00e2/attachment.htm>

From Ramachandrarao.K at saint-gobain.com  Tue Aug  7 08:42:18 2012
From: Ramachandrarao.K at saint-gobain.com (Ramachandrarao, K [ SGGI - IT ])
Date: Tue, 7 Aug 2012 13:12:18 +0530
Subject: [rabbitmq-discuss] Reg: Nodes and Exchanges
Message-ID: <8A9DF2095351E74AB39CF6BF78F20CC904A0ED3D@L00EXCEC1.zl.if.atcsg.net>

Hello,

 

Requesting your help for the following issue..

 

Currently I am trying to publish message and get message from the
RabbitMQ management.. When we trying to publish message, the message get
published..

And the following error is displayed in the screen.

 

Requesting you to help me to sort out the issue..

 

TypeError: 'nodes' is undefined

TypeError: 'Exchanges' is undefined

 

 

Thanks and Regards

 

Ramachandra Rao K

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120807/09f6acbb/attachment.htm>

From Ramachandrarao.K at saint-gobain.com  Tue Aug  7 08:47:49 2012
From: Ramachandrarao.K at saint-gobain.com (Ramachandrarao, K [ SGGI - IT ])
Date: Tue, 7 Aug 2012 13:17:49 +0530
Subject: [rabbitmq-discuss] Reg: Nodes and Exchanges
Message-ID: <8A9DF2095351E74AB39CF6BF78F20CC904A0ED43@L00EXCEC1.zl.if.atcsg.net>

Hello,

 

Requesting your help for the following issue..

 

Currently I am trying to publish message and get message from the
RabbitMQ management.. When we trying to publish message, the message get
published..

And the following error is displayed in the screen.

 

Requesting you to help me to sort out the issue..

 

TypeError: 'nodes' is undefined

TypeError: 'Exchanges' is undefined

 

 

Thanks and Regards

 

Ramachandra Rao K

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120807/04422729/attachment.htm>

From superjodash at gmail.com  Mon Aug  6 23:01:03 2012
From: superjodash at gmail.com (John Kemp)
Date: Mon, 6 Aug 2012 15:01:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Typical physical setup questions
Message-ID: <d9e79592-b91a-4a3a-aa61-459afaab2e90@googlegroups.com>

Hello,

As I dig around the interwebs for information on setting up RabbitMQ in an 
enterprise scenario, I am having trouble understanding a few things.
Specifically, how do I set up the "bus" from a physical standpoint? Please 
assume the following scenario (for completeness, I'm also using MassTransit 
on top of RabbitMQ):

Server A - ecommerce web server
Server B - app server running order processing (reads from queue) - also 
assum RabbitMQ broker

* Should both Server A and Server B be running local instances of RabbitMQ?
- If Yes
* If yes, how do I get Server A RabbitMQ to talk with Server B RabbitMQ? - 
this may be a MassTransit quesion
* Can I set up both servers to persist to the same db instance?
- If NO
* If only Server B needs an instance, what happens if Server B goes down? 
Are all messages lost on Server A?
* How do you handle message loss?

Thank you for any insight. I have a solution working for Server A sending 
messages to Server B but I'm concerned about network outages or server 
failures.

Thanks!
John

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120806/0ec324b9/attachment.htm>

From raphael.degiusti at guardis.com  Tue Aug  7 08:55:03 2012
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Tue, 7 Aug 2012 09:55:03 +0200
Subject: [rabbitmq-discuss] Wrapping pika callbacks, why ?
In-Reply-To: <D90D4904377A44179C39C4DBB2D99C63@meetme.com>
References: <09ce0f5e-cb1a-4580-a9ce-68724604c987@googlegroups.com>
	<D90D4904377A44179C39C4DBB2D99C63@meetme.com>
Message-ID: <CAFw-diks3+EXia61j4eduHQhrCNCLk41vZmCy6yRghrSksvP8Q@mail.gmail.com>

Hi Gavin,

Hi everyone,
>
> I'm interested in running pika's IOLoop in a thread and I came across this
> code sample :
> http://cms02.phys.ntu.edu.tw/tracs/env/browser/trunk/messaging/pika/mon.py
>
> I was wondering why and what could be the advantages of wrapping the
> callbacks in methods (I can understand the on_exchange_declared() method
> that returns a different callback according to thread's name) ?
>
> As opposed to doing lambda's for callbacks? I'm not sure of the context of
> what you're comparing callback passing style to.
>


For instance, for this callback: connection.callbacks.add(0,
'_on_connection_open', self._on_connected() , one_shot=True )

The on_connected callback function in wrapped in the _on_connected() method

 def _on_connected(self):
        def on_connected(connection):
            pika.log.info("%s: connected : %r " % ( self.tag , connection) )
            connection.channel(self._on_channel_open() )
            self.connection = connection
        return on_connected

Why not: connection.callbacks.add(0, '_on_connection_open',
self.on_connected , one_shot=True )

 def on_connected(self, connection):
        pika.log.info("%s: connected : %r " % ( self.tag , connection) )
        connection.channel(self._on_channel_open() )
        self.connection = connection

> Another question is why considering multiprocessing over threading in this
> case ?
>
> The IOLoop is a singleton instance and you will run into contention issues
> and non-thread safe behaviors in use of the IOLoop and event processing.
>
> I'm not sure what threading buys you in an asynchronous event based model
> of processing but needless complexity.
>
>
My goal is to have an AMQP transport layer inside my application, running
"in background", that handles incoming messages and put them into a python
queue. I also want to be able to publish messages from other threads.
I've got it to work with threads and python queues in a thread-safe way. I
was wondering what could be the benefits for me to use multiprocessing over
threading.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120807/d5f8c044/attachment.htm>

From emile at rabbitmq.com  Tue Aug  7 10:33:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Aug 2012 10:33:50 +0100
Subject: [rabbitmq-discuss] Typical physical setup questions
In-Reply-To: <d9e79592-b91a-4a3a-aa61-459afaab2e90@googlegroups.com>
References: <d9e79592-b91a-4a3a-aa61-459afaab2e90@googlegroups.com>
Message-ID: <5020E0FE.5020200@rabbitmq.com>


Hi John,

On 06/08/12 23:01, John Kemp wrote:
> Server A - ecommerce web server
> Server B - app server running order processing (reads from queue) - also
> assum RabbitMQ broker
> 
> * Should both Server A and Server B be running local instances of RabbitMQ?

That is not be required for simple messaging. A and B can communicate
via a single logical message broker (or "Transport").

> * Can I set up both servers to persist to the same db instance?

There's only one message broker, so no need for multiple persistent
message stores. The broker has a persistent store for messages.

> * If only Server B needs an instance, what happens if Server B goes
> down? Are all messages lost on Server A?

If A or B are unavailable or disconnected then the message flow between
them is interrupted. But because the broker forwards messages on their
behalf, it provides continuity. Messages that are not completely
processed can be redelivered.

> * How do you handle message loss?

The risk of message loss can be minimised. Publishers can obtain
confirmation that messages were received by the broker and subscribers
can acknowledge messages when processing completed successfully. And
RabbitMQ provides high-availability features to protect against broker
failure.

I'm not sure if all of these features are available via Mass Transit.
You should consult the Mass Transit documentation for specific on how to
set that up.




-Emile

From simon at rabbitmq.com  Tue Aug  7 10:30:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Aug 2012 10:30:34 +0100
Subject: [rabbitmq-discuss] Reg: Nodes and Exchanges
In-Reply-To: <8A9DF2095351E74AB39CF6BF78F20CC904A0ED43@L00EXCEC1.zl.if.atcsg.net>
References: <8A9DF2095351E74AB39CF6BF78F20CC904A0ED43@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <5020E03A.3080202@rabbitmq.com>

On 07/08/12 08:47, Ramachandrarao, K [ SGGI - IT ] wrote:
> TypeError: 'nodes' is undefined
> TypeError: 'Exchanges' is undefined

Which Rabbit version? Which browser?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Ramachandrarao.K at saint-gobain.com  Tue Aug  7 10:33:53 2012
From: Ramachandrarao.K at saint-gobain.com (Ramachandrarao, K [ SGGI - IT ])
Date: Tue, 7 Aug 2012 15:03:53 +0530
Subject: [rabbitmq-discuss] Reg: Nodes and Exchanges
In-Reply-To: <5020E03A.3080202@rabbitmq.com>
References: <8A9DF2095351E74AB39CF6BF78F20CC904A0ED43@L00EXCEC1.zl.if.atcsg.net>
	<5020E03A.3080202@rabbitmq.com>
Message-ID: <8A9DF2095351E74AB39CF6BF78F20CC904A0EE5D@L00EXCEC1.zl.if.atcsg.net>

Hello,

We are using RabbitMQ 2.8.4 and Internet Explorer 8

Thanks and Regards
 
Ramachandra Rao K

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Tuesday, August 07, 2012 3:01 PM
To: Discussions about RabbitMQ
Cc: Ramachandrarao, K [ SGGI - IT ]
Subject: Re: [rabbitmq-discuss] Reg: Nodes and Exchanges

On 07/08/12 08:47, Ramachandrarao, K [ SGGI - IT ] wrote:
> TypeError: 'nodes' is undefined
> TypeError: 'Exchanges' is undefined

Which Rabbit version? Which browser?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Aug  7 10:46:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Aug 2012 10:46:50 +0100
Subject: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby
In-Reply-To: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>
References: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>
Message-ID: <5020E40A.8070801@rabbitmq.com>

Hi Bernhard,

On 07/08/12 08:17, Bernhard Mogens Ege wrote:
> Using Process Explorer I see a new cmd.exe being spawned by erl.exe over
> and over again, never stopping.

Thanks for reporting this issue. In order to help us track down this
problem can you please let us know:

Is there anything in the broker logfile or the sasl logfile or the
eventlog at the same time? Can you provide the entries from just before
and after the standby?

Is "tasklist" on the PATH? Do you have the management plugin installed,
and have you installed "handle.exe"?

It would be helpful to know the arguments of the cmd process when it
fails. Are you able to replace the real command shell with an
intermediary that captures this information when the failure occurs?


-Emile


From simon at rabbitmq.com  Tue Aug  7 10:48:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Aug 2012 10:48:02 +0100
Subject: [rabbitmq-discuss] Reg: Nodes and Exchanges
In-Reply-To: <8A9DF2095351E74AB39CF6BF78F20CC904A0EE5D@L00EXCEC1.zl.if.atcsg.net>
References: <8A9DF2095351E74AB39CF6BF78F20CC904A0ED43@L00EXCEC1.zl.if.atcsg.net>
	<5020E03A.3080202@rabbitmq.com>
	<8A9DF2095351E74AB39CF6BF78F20CC904A0EE5D@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <5020E452.1030202@rabbitmq.com>

On 07/08/12 10:33, Ramachandrarao, K [ SGGI - IT ] wrote:
> We are using RabbitMQ 2.8.4 and Internet Explorer 8

Hmm - I just tried that combination and did not see any such errors. Can 
you try the usual tedious web browser stuff? (Clear cache, restart 
browser.) Also: does anything actually break?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Aug  7 11:53:18 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Aug 2012 11:53:18 +0100
Subject: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby
In-Reply-To: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>
References: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>
Message-ID: <5020F39E.20007@rabbitmq.com>

Hi Bernhard,

On 07/08/12 08:17, Bernhard Mogens Ege wrote:
> I am still seeing an issue with RabbitMQ service (no clients) having
> high cpu usage when returning from standby. It does not happen every
> time, though.

I've now been able to reproduce the results you see with OS-initiated
standby. I have filed a bug.

In the meantime I would suggest not using standby for long periods, but
to shut down the OS instead.


-Emile



From bme at saseco.dk  Tue Aug  7 13:29:06 2012
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Tue, 7 Aug 2012 14:29:06 +0200
Subject: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby
In-Reply-To: <5020F39E.20007@rabbitmq.com>
References: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>
	<5020F39E.20007@rabbitmq.com>
Message-ID: <041701cd7498$3c9a0430$b5ce0c90$@saseco.dk>

Nice. Do you still require the input you requested from me?

-- 
Bernhard

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 7. august 2012 12:53
To: bme at saseco.dk; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby

Hi Bernhard,

On 07/08/12 08:17, Bernhard Mogens Ege wrote:
> I am still seeing an issue with RabbitMQ service (no clients) having 
> high cpu usage when returning from standby. It does not happen every 
> time, though.

I've now been able to reproduce the results you see with OS-initiated
standby. I have filed a bug.

In the meantime I would suggest not using standby for long periods, but to
shut down the OS instead.


-Emile



From emile at rabbitmq.com  Tue Aug  7 14:25:27 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Aug 2012 14:25:27 +0100
Subject: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby
In-Reply-To: <041701cd7498$3c9a0430$b5ce0c90$@saseco.dk>
References: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>
	<5020F39E.20007@rabbitmq.com>
	<041701cd7498$3c9a0430$b5ce0c90$@saseco.dk>
Message-ID: <50211747.20002@rabbitmq.com>

On 07/08/12 13:29, Bernhard Mogens Ege wrote:
> Nice. Do you still require the input you requested from me?

No thanks, I think we have a pretty good handle on the cause, which is
related to the way timers behave after a temporal discontinuity. Feel
free to report any other neat workarounds or relevant observations though.

From mkirbsn at gmail.com  Tue Aug  7 14:25:27 2012
From: mkirbsn at gmail.com (Michel Kapel)
Date: Tue, 07 Aug 2012 15:25:27 +0200
Subject: [rabbitmq-discuss] Sorry for the noob question :$
Message-ID: <50211747.7010709@gmail.com>

Ok, I'm not getting out of this so I humbly ask for your help.

I Am programming in Groovy and I am trying to use rabbitmq.
I have set up a small test program using Spring
Since I had little success I reduced all the Spring stuff to almost 
nothing so I guess it does not hav muche to do with it.

Basically the rabbitmq is deployed and it works.
I can tell that from the rabbitmqctl but also from the Web interface 
plugin which shows me the queues and settings.
The Test starts OK and I get no Exception

The problem is I get nothing in my queue "rqqueue" from virtualhost either.
I can see theconnection in the rabbitmq logs but no publishing.

But If I publish something myself from the WebApp, it works ...

Any idea is welcome.

==== Spring ====

     <bean id="connectionFactory"
class="org.springframework.amqp.rabbit.connection.CachingConnectionFactory">
     <constructor-arg value="data-desktop"/>
         <property name="username" value="user"/>
         <property name="password" value="passwd"/>
         <property name="virtualHost" value="vhost"/>
     </bean>

==== Groovy File ====

import com.rabbitmq.client.Channel
import com.rabbitmq.client.AMQP
import com.rabbitmq.client.AMQP.BasicProperties

import org.springframework.amqp.rabbit.connection.Connection
import org.springframework.amqp.rabbit.connection.ConnectionFactory
import org.springframework.amqp.core.ExchangeTypes

log.info "Connection test logging message"
ConnectionFactory connf = ctx.getBean("connectionFactory")
Connection conn = connf.createConnection()
Channel chan = conn.createChannel(true)
String message = "Yet another message!"
chan.queueDeclare("rqqueue", true, false, false, null)
chan.exchangeDeclare("rqexchange", ExchangeTypes.DIRECT, true)
chan.queueBind ("rqqueue","rqexchange","rqbind_rkey")
chan.basicPublish("rqexchange",
     "rqbind_rkey",
     new AMQP.BasicProperties.Builder()
         .contentType("text/plain").deliveryMode(2)
         .priority(2)
         .build(),
     message.getBytes())
log.debug(" [x] Sent {}",message)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mkirbsn.vcf
Type: text/x-vcard
Size: 280 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120807/41fdd451/attachment.vcf>

From mkirbsn at gmail.com  Tue Aug  7 16:35:58 2012
From: mkirbsn at gmail.com (Michel Kapel)
Date: Tue, 07 Aug 2012 17:35:58 +0200
Subject: [rabbitmq-discuss] Sorry for noob question
Message-ID: <502135DE.5050803@gmail.com>

OK, so it WAS a really simple noob question :$

//Channel chan = conn.createChannel(true)

works better like that

Channel chan = conn.createChannel(false)

:-(

-------------- next part --------------
A non-text attachment was scrubbed...
Name: mkirbsn.vcf
Type: text/x-vcard
Size: 280 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120807/c08da0e8/attachment.vcf>

From ward.mark at gmail.com  Tue Aug  7 18:05:32 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 7 Aug 2012 10:05:32 -0700 (PDT)
Subject: [rabbitmq-discuss] BrokerUnreachableException on MS Framework
Message-ID: <e94090ac-286f-4465-876f-ed38211b0288@googlegroups.com>

It appears depending on which framework the .net client is executed upon 
the BrokerUnreachableException exception will have more information to help 
identify why "None of the specified endpoints were unreachable" was thrown.

When the .NET client is executed on the Microsoft .NET Framework 4.0 the 
RabbitMQ.Client.Exceptions.BrokerUnreachableException is thrown but does 
not contain any information in the inner exception on why an endpoint was 
unreachable.  I have found in the RabbitMQDotNetClient source the 
BrokerUnreachableException contains parameters to collect the connection 
errors via a dictionary class.  This information is hidden unless 
.ToString() is called on the class.  When running on the Microsoft .NET 
framework 4.0 the .ToString() does not output any detailed information as 
to why the exception occurred.  

When the Mono 2.10.8 runtime is used the client will throw the same 
exception but the .ToString() does output detailed information about the 
possible cause of the exception.  The inner exception is also set.

I am working through learning how the Access Control works in RabbitMQ and 
to validate some of my assumptions I am setting up unit tests to make sure 
the access control settings restrict my test clients from performing the 
restricted action.  This means I am expecting the exceptions and I am not 
to worried about getting them. What I am worried about is once in 
production I will not have a controlled environment and will need more 
information about the connection failure. We will not be running on the 
mono framework.

Is there a bug with the BrokerUnreachableException running on the .NET 
framework?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120807/6a77f497/attachment.htm>

From dla.it.service at gmail.com  Tue Aug  7 20:01:40 2012
From: dla.it.service at gmail.com (DT)
Date: Tue, 7 Aug 2012 19:01:40 +0000 (UTC)
Subject: [rabbitmq-discuss] rabbitmq.config - ssl & management plugin
Message-ID: <loom.20120807T205232-390@post.gmane.org>

Hi,

Has anyone configured the ssl access for management plugin?

This is what I have in the rabbitmq.config file to access plugin management with
SSL.



{rabbit, [
 {ssl_listeners, [5671]},
 {ssl_options, [{cacertfile,"c:/testca/cacert.pem"},
 {certfile,"c:/server/cert.pem"},
 {keyfile,"C:/server/key.pem"},
 {verify,verify_peer},
 {fail_if_no_peer_cert,false}]}
 ]}
 {rabbitmq_mochiweb,
 [{listeners, [{'*', [{port, 55670}]},
 {mgmt, [{port, 55672},
 {ssl, true},
 {ssl_opts, [{cacertfile, "c:/testca/cacert.pem"},
 {certfile, "C:/server/cert.pem"},
 {keyfile, "C:/server/key.pem"}]}
            ]}
       ]}
 ]}
 ].

Thanks in Advance,
DT


From matthias at rabbitmq.com  Wed Aug  8 03:42:09 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 03:42:09 +0100
Subject: [rabbitmq-discuss] rabbitmq.config - ssl & management plugin
In-Reply-To: <loom.20120807T205232-390@post.gmane.org>
References: <loom.20120807T205232-390@post.gmane.org>
Message-ID: <5021D201.4020104@rabbitmq.com>

On 07/08/12 20:01, DT wrote:
> Has anyone configured the ssl access for management plugin?
>
> This is what I have in the rabbitmq.config file to access plugin management with
> SSL.

You are missing...

1) a '[' here

> {rabbit, [
>   {ssl_listeners, [5671]},
>   {ssl_options, [{cacertfile,"c:/testca/cacert.pem"},
>   {certfile,"c:/server/cert.pem"},
>   {keyfile,"C:/server/key.pem"},
>   {verify,verify_peer},
>   {fail_if_no_peer_cert,false}]}
>   ]}

2) a trailing ',' here

>   {rabbitmq_mochiweb,
>   [{listeners, [{'*', [{port, 55670}]},
>   {mgmt, [{port, 55672},
>   {ssl, true},
>   {ssl_opts, [{cacertfile, "c:/testca/cacert.pem"},
>   {certfile, "C:/server/cert.pem"},
>   {keyfile, "C:/server/key.pem"}]}
>              ]}
>         ]}
>   ]}
>   ].

Matthias.


From russa.nayak at tcs.com  Wed Aug  8 07:10:15 2012
From: russa.nayak at tcs.com (Russa Nayak)
Date: Tue, 7 Aug 2012 23:10:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ WCF Client
Message-ID: <1344406215652-21282.post@n5.nabble.com>

Hello,

I am a biztalk developer. I am trying to integrate biztalk and rabbitmq. I
have successfully done it but need some insight about how actually the
RabbitMQ Client code works.

I need to know what is the exact procedure that occurs when any message is
passed on from a durable rabbitmq queue to a biztalk application. Is a
polling factor involved or "fire and forget" procedure is involved? Does the
biztalk receive port continuosly listen for the message or does the rabbitmq
push the message into the biztalk port when the message arrives?

I need this information of performance tunning.

Please could you provide me some details of this process.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-WCF-Client-tp21282.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From berthold at exactag.com  Wed Aug  8 08:19:44 2012
From: berthold at exactag.com (Ulli Berthold - Exactag GmbH)
Date: Wed, 8 Aug 2012 07:19:44 +0000
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
Message-ID: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>

Hello All,

i'm looking for a stable way to capture TCP backpressure / flow control events in a high load C# producer, how exactly should I handle that?

Thanks in advance

Ulli
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120808/9eee7412/attachment.htm>

From matthias at rabbitmq.com  Wed Aug  8 08:45:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 08:45:33 +0100
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
	producer
In-Reply-To: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
Message-ID: <5022191D.1060203@rabbitmq.com>

On 08/08/12 08:19, Ulli Berthold - Exactag GmbH wrote:
> i?m looking for a stable way to capture TCP backpressure / flow control
> events in a high load C# producer, how exactly should I handle that?

Why would you want to "capture" events relating to TCP back pressure? 
It's something that happens all the time - many times a second - on any 
TCP connection.

Matthias.

From berthold at exactag.com  Wed Aug  8 08:51:21 2012
From: berthold at exactag.com (Ulli Berthold - Exactag GmbH)
Date: Wed, 8 Aug 2012 07:51:21 +0000
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <5022191D.1060203@rabbitmq.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
Message-ID: <F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>

Hi Matthias,

Well, because i got a producer that frequently puts more data into the queue than is processed at that time (will processed be at later, quieter, intervals though). Frequently that puts the producer into flow mode, slowing it down, which is not an option in our case. The producer has to be freed again within milliseconds to accept the next event. If the queue doesn't accept data as fast as I produce it I need to see that and switch over to an alternative (local file-based cache) which again will be processed later.

Regards

Ulli

-----Urspr?ngliche Nachricht-----
Von: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Gesendet: Mittwoch, 8. August 2012 09:46
An: Discussions about RabbitMQ
Cc: Ulli Berthold - Exactag GmbH
Betreff: Re: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

On 08/08/12 08:19, Ulli Berthold - Exactag GmbH wrote:
> i'm looking for a stable way to capture TCP backpressure / flow 
> control events in a high load C# producer, how exactly should I handle that?

Why would you want to "capture" events relating to TCP back pressure? 
It's something that happens all the time - many times a second - on any TCP connection.

Matthias.



From matthias at rabbitmq.com  Wed Aug  8 08:57:38 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 08:57:38 +0100
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
Message-ID: <50221BF2.6030600@rabbitmq.com>

Ulli,

On 08/08/12 08:51, Ulli Berthold - Exactag GmbH wrote:
> Well, because i got a producer that frequently puts more data into
> the queue than is processed at that time (will processed be at later,
> quieter, intervals though). Frequently that puts the producer into
> flow mode, slowing it down, which is not an option in our case. The
> producer has to be freed again within milliseconds to accept the next
> event. If the queue doesn't accept data as fast as I produce it I
> need to see that and switch over to an alternative (local file-based
> cache) which again will be processed later.

I suggest you introduce a second thread and connect that to the producer 
thread via a one-place buffer or a queue data structure. The second 
thread pulls items off that queue and publishes them to RabbitMQ. The 
publisher thread can look at the queue's length before deciding whether 
to place another item in it or write to disk.

Matthias.

From matthias at rabbitmq.com  Wed Aug  8 08:59:45 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 08:59:45 +0100
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <1344292799149-21263.post@n5.nabble.com>
References: <1341938859568-20687.post@n5.nabble.com>
	<CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
	<1342030568666-20721.post@n5.nabble.com>
	<4FFDCBAA.1070001@vmware.com>
	<1342042707718-20725.post@n5.nabble.com>
	<4FFEC4A0.1010107@vmware.com>
	<1342112585500-20761.post@n5.nabble.com> <4FFF0727.909@vmware.com>
	<1344292799149-21263.post@n5.nabble.com>
Message-ID: <50221C71.5030403@rabbitmq.com>

On 06/08/12 23:39, cogitate wrote:
>   using spring-amqp 1.1.1.RELEASE it seems i have to change the version of
> spring-rabbit to 1.0.0.RELEASE [...]

I see you have asked the same question on the spring-amqp forum, which 
is the right place for it so please continue the discussion there.

Matthias.

From berthold at exactag.com  Wed Aug  8 09:03:45 2012
From: berthold at exactag.com (Ulli Berthold - Exactag GmbH)
Date: Wed, 8 Aug 2012 08:03:45 +0000
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <50221BF2.6030600@rabbitmq.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
Message-ID: <F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>

Hi Matthias (german name?)

My problem is that we are talking web tracking here, so it's at least 500 events per second, originating from 4 different web servers running 8 threads each on average. Data stream will increase to over 3.000/s as soon as we can handle that load. The basic understanding so far was that rabbit would cache the message queue on disk when there is too much incoming data, so we could use the quieter night times to handle the data that didn't make it in time.

I didn't see an easy way to check the queue length, except maybe for rest requests?

With kind regards

Ulli

-----Urspr?ngliche Nachricht-----
Von: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Gesendet: Mittwoch, 8. August 2012 09:58
An: Ulli Berthold - Exactag GmbH
Cc: Discussions about RabbitMQ
Betreff: Re: AW: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

Ulli,

On 08/08/12 08:51, Ulli Berthold - Exactag GmbH wrote:
> Well, because i got a producer that frequently puts more data into the 
> queue than is processed at that time (will processed be at later, 
> quieter, intervals though). Frequently that puts the producer into 
> flow mode, slowing it down, which is not an option in our case. The 
> producer has to be freed again within milliseconds to accept the next 
> event. If the queue doesn't accept data as fast as I produce it I need 
> to see that and switch over to an alternative (local file-based
> cache) which again will be processed later.

I suggest you introduce a second thread and connect that to the producer thread via a one-place buffer or a queue data structure. The second thread pulls items off that queue and publishes them to RabbitMQ. The publisher thread can look at the queue's length before deciding whether to place another item in it or write to disk.

Matthias.



From matthias at rabbitmq.com  Wed Aug  8 09:21:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 09:21:22 +0100
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
Message-ID: <50222182.4070407@rabbitmq.com>

Ulli,

On 08/08/12 09:03, Ulli Berthold - Exactag GmbH wrote:
> My problem is that we are talking web tracking here, so it's at least
> 500 events per second, originating from 4 different web servers
> running 8 threads each on average. Data stream will increase to over
> 3.000/s as soon as we can handle that load.

RabbitMQ should be able to handle that easily, even when writing to disk.

> The basic understanding
> so far was that rabbit would cache the message queue on disk when
> there is too much incoming data, so we could use the quieter night
> times to handle the data that didn't make it in time.

Right.

> I didn't see an easy way to check the queue length, except maybe for
> rest requests?

I wasn't talking about an AMQP queue. I suggested that at the client you 
have the following setup:

publisher thread -> .net queue -> shoveling thread

The helper thread pulls items off the .net queue and publishes them to
RabbitMQ. The publisher thread can look at the queue's length before 
deciding whether to place another item in it or write to disk. 
Effectively the length of the .net queue becomes a measure of the TCP 
back pressure experienced by the shoveling thread.

Matthias.

From lostdogs101 at gmail.com  Wed Aug  8 01:49:06 2012
From: lostdogs101 at gmail.com (Alex Lord)
Date: Tue, 7 Aug 2012 17:49:06 -0700
Subject: [rabbitmq-discuss] Having trouble with Web-Stomp
Message-ID: <CABjdGM5=m5DKvKN5hky4GwvP=WXUNq_MteVtBXnk7fabNVbfaA@mail.gmail.com>

Hello, my name is Alex and I'm having trouble getting the web-stomp
examples to run. I'm running windows server 2003 with the latest version of
rabbitmq (2.8.5 as of writing). I enabled the stomp plugin, the web-stomp
plugin, and the web-stomp-examples plugin. There was no error and I
restarted the AMQP windows service. I tried using the echo message
boardcasting example and can only see things on the log side of the screen.

My management plugin shows these windows under ports and context.
ProtocolBound toPortamqp0.0.0.05672stomp0.0.0.061613

ContextBound toPortSSLPathRabbitMQ Management0.0.0.055672?/WEB-STOMP:
examples0.0.0.055670?/web-stomp-examples
I'm a little at a loss as to what I should do from here.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120807/c8e25efb/attachment.htm>

From berthold at exactag.com  Wed Aug  8 09:35:01 2012
From: berthold at exactag.com (Ulli Berthold - Exactag GmbH)
Date: Wed, 8 Aug 2012 08:35:01 +0000
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <50222182.4070407@rabbitmq.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
Message-ID: <F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>

Matthias,

Rabbit does handle it, yes, but it slows down the inbound messages at some point (like several million messages in queue, with lots of disk space still available).

And we are using rabbit so we don't have to implement our very own queueing system which would likely just add much more complexity, again, we're talking millions of messages per hour. Just a single minute of backlog in the local queue means 30.000+ messages stored locally... We considered RabbitMQ / Shovel but I'm not too sure that would keep up with the load.

We would love a way to disable (or better, suppress) the whole backpressure system until the server is really at its memory and disk limit. Currently it seems to partially depend on the processing speed of the queue readers and the queue sizes. Again, an alternative to just know when backpressure is applied would help us too because we could temporarily send the next messages through an alternate route. An in-program queue would definitely increase complexity almost beyond the point of usefulness of the queueing system - why use an existing one if I got to build one anyways?

Regards

Ulli

-----Urspr?ngliche Nachricht-----
Von: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Gesendet: Mittwoch, 8. August 2012 10:21
An: Ulli Berthold - Exactag GmbH
Cc: Discussions about RabbitMQ
Betreff: Re: AW: AW: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

Ulli,

On 08/08/12 09:03, Ulli Berthold - Exactag GmbH wrote:
> My problem is that we are talking web tracking here, so it's at least
> 500 events per second, originating from 4 different web servers 
> running 8 threads each on average. Data stream will increase to over 
> 3.000/s as soon as we can handle that load.

RabbitMQ should be able to handle that easily, even when writing to disk.

> The basic understanding
> so far was that rabbit would cache the message queue on disk when 
> there is too much incoming data, so we could use the quieter night 
> times to handle the data that didn't make it in time.

Right.

> I didn't see an easy way to check the queue length, except maybe for 
> rest requests?

I wasn't talking about an AMQP queue. I suggested that at the client you have the following setup:

publisher thread -> .net queue -> shoveling thread

The helper thread pulls items off the .net queue and publishes them to RabbitMQ. The publisher thread can look at the queue's length before deciding whether to place another item in it or write to disk. 
Effectively the length of the .net queue becomes a measure of the TCP back pressure experienced by the shoveling thread.

Matthias.



From matthias at rabbitmq.com  Wed Aug  8 09:36:24 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 09:36:24 +0100
Subject: [rabbitmq-discuss] Having trouble with Web-Stomp
In-Reply-To: <CABjdGM5=m5DKvKN5hky4GwvP=WXUNq_MteVtBXnk7fabNVbfaA@mail.gmail.com>
References: <CABjdGM5=m5DKvKN5hky4GwvP=WXUNq_MteVtBXnk7fabNVbfaA@mail.gmail.com>
Message-ID: <50222508.7030302@rabbitmq.com>

On 08/08/12 01:49, Alex Lord wrote:
> Hello, my name is Alex and I'm having trouble getting the web-stomp
> examples to run. I'm running windows server 2003 with the latest version
> of rabbitmq (2.8.5 as of writing). I enabled the stomp plugin, the
> web-stomp plugin, and the web-stomp-examples plugin.

The web-stomp plugin was not supposed to have been included in 2.8.5. 
Remove it and install the 2.8.2 version we released a while ago.

Matthias.

From emile at rabbitmq.com  Wed Aug  8 09:43:42 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 08 Aug 2012 09:43:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ WCF Client
In-Reply-To: <1344406215652-21282.post@n5.nabble.com>
References: <1344406215652-21282.post@n5.nabble.com>
Message-ID: <502226BE.5000902@rabbitmq.com>

Hi Russa,

On 08/08/12 07:10, Russa Nayak wrote:
> Please could you provide me some details of this process.

I would suggest that you first take a look at the available .net
documentation here:

http://www.rabbitmq.com/clients.html

If any specific questions remain then please ask.


-Emile



From matthias at rabbitmq.com  Wed Aug  8 09:51:58 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 09:51:58 +0100
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
Message-ID: <502228AE.3030608@rabbitmq.com>

Ulli,

On 08/08/12 09:35, Ulli Berthold - Exactag GmbH wrote:
> Rabbit does handle it, yes, but it slows down the inbound messages at
> some point (like several million messages in queue, with lots of disk
> space still available).

With several million messages in the queue you may be hitting the memory 
limit - the rabbit logs should tell you. Messages have some in-memory 
footprint *even when paged to disk*.

> We would love a way to disable (or better, suppress) the whole
> backpressure system until the server is really at its memory and disk
> limit.

Significant durations of backpressure should only occur when the broker 
is getting close to the configured limits. You may want to adjust the 
limits though, as per the docs.

Btw, you are running rabbit 2.8.x, right? Flow control in that is much 
improved over earlier version.

Also, if you are on Windows, make sure you run the 64-bit version of 
Erlang R15B01, otherwise memory will be capped at 2GB.

> an alternative to just know when backpressure is applied would help
> us too because we could temporarily send the next messages through an
> alternate route.

What I proposed is precisely that - a way to detect backpressure.

> An in-program queue would definitely increase complexity almost
> beyond the point of usefulness of the queueing system - why use an
> existing one if I got to build one anyways?

We are talking fifty lines of code here, most of which are boilerplate.

Matthias.

From berthold at exactag.com  Wed Aug  8 10:29:59 2012
From: berthold at exactag.com (Ulli Berthold - Exactag GmbH)
Date: Wed, 8 Aug 2012 09:29:59 +0000
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <502228AE.3030608@rabbitmq.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<502228AE.3030608@rabbitmq.com>
Message-ID: <F216F12DEE15B7429FB03C58643375521C4C39EB@AMXPRD0410MB377.eurprd04.prod.outlook.com>

Matthias,

we're running rabbit 2.8.4 / 2.8.5 on 64bit linux servers with 64bit erlang and plenty of memory, and there was no "high watermark" warning in the logs either.
Just to make sure i'm not erring to much - if the rabbit web ui shows a connection as "flow" instead of "running" or "blocked" that does mean it is in flow control (backpressure), correct?

Regards

Ulli

-----Urspr?ngliche Nachricht-----
Von: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Gesendet: Mittwoch, 8. August 2012 10:52
An: Ulli Berthold - Exactag GmbH
Cc: Discussions about RabbitMQ
Betreff: Re: AW: AW: AW: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

Ulli,

On 08/08/12 09:35, Ulli Berthold - Exactag GmbH wrote:
> Rabbit does handle it, yes, but it slows down the inbound messages at 
> some point (like several million messages in queue, with lots of disk 
> space still available).

With several million messages in the queue you may be hitting the memory limit - the rabbit logs should tell you. Messages have some in-memory footprint *even when paged to disk*.

> We would love a way to disable (or better, suppress) the whole 
> backpressure system until the server is really at its memory and disk 
> limit.

Significant durations of backpressure should only occur when the broker is getting close to the configured limits. You may want to adjust the limits though, as per the docs.

Btw, you are running rabbit 2.8.x, right? Flow control in that is much improved over earlier version.

Also, if you are on Windows, make sure you run the 64-bit version of Erlang R15B01, otherwise memory will be capped at 2GB.

> an alternative to just know when backpressure is applied would help us 
> too because we could temporarily send the next messages through an 
> alternate route.

What I proposed is precisely that - a way to detect backpressure.

> An in-program queue would definitely increase complexity almost beyond 
> the point of usefulness of the queueing system - why use an existing 
> one if I got to build one anyways?

We are talking fifty lines of code here, most of which are boilerplate.

Matthias.



From matthias at rabbitmq.com  Wed Aug  8 10:49:42 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 10:49:42 +0100
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <F216F12DEE15B7429FB03C58643375521C4C39EB@AMXPRD0410MB377.eurprd04.prod.outlook.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<502228AE.3030608@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C39EB@AMXPRD0410MB377.eurprd04.prod.outlook.com>
Message-ID: <50223636.5010305@rabbitmq.com>

Ulli,

On 08/08/12 10:29, Ulli Berthold - Exactag GmbH wrote:
> we're running rabbit 2.8.4 / 2.8.5 on 64bit linux servers with 64bit
> erlang and plenty of memory, and there was no "high watermark"
> warning in the logs either. Just to make sure i'm not erring to much
> - if the rabbit web ui shows a connection as "flow" instead of
> "running" or "blocked" that does mean it is in flow control
> (backpressure), correct?

Correct, but as noted at 
http://www.rabbitmq.com/memory.html#per-connection, this kind of flow 
control is triggered many times a second.

It's really not something an application should need to worry about. And 
it does *not* mean the producer is blocked, since there are many buffers 
between the application and the broker connection handler that need to 
fill up first. That way spikes can be absorbed.

Obviously if producers attempt to publish at a *sustained* rate that is 
higher than the broker can handle then backpressure will propagate to 
the client and slow them down. The point at which that happens should be 
way higher than the 3kHz rate you anticipate.

Matthias.

From colinbul at gmail.com  Wed Aug  8 10:58:01 2012
From: colinbul at gmail.com (Colin Bull)
Date: Wed, 8 Aug 2012 02:58:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Irregular service failure
In-Reply-To: <CAFHLqDJSGhpfXf1UwD0PcLh0=7khdcOhFX4seotrku9LkCNFiw@mail.gmail.com>
References: <CAFHLqDJSGhpfXf1UwD0PcLh0=7khdcOhFX4seotrku9LkCNFiw@mail.gmail.com>
Message-ID: <0cbcf212-3a16-4dfb-80b7-322514cfcade@googlegroups.com>

Hi, 

I have exactly the same situation. Although the message volumes are 
slightly less probably 10,000 msg/day.. I am currently running on RabbitMQ 
2.8.4. I have tried looking in the logs and I cannot see anything strange. 
Any other ideas?

Thanks Colin

On Thursday, January 5, 2012 11:57:21 PM UTC, Michael Nye wrote:
>
> Hello,
>
> I am currently using RabbitMQ in a reasonably high throughput manner, I 
> would guess 100,000+ messages per day being sent through it.  The install 
> is on a Windows Server 2008 R2 box and all applications are in C# with 
> everything running on the same machine.
>
> The service will run fine for weeks, months but then randomly (so far it 
> has happened 2 or 3 times) it appears the service just stops working.  All 
> applications will start throwing an exception AlreadyClosedException, and 
> stop being able to send messages.  To get things working again, I stop all 
> applications, restart the rabbitmq service, and start the applications 
> again.
>
> I am not sure where to start in terms of debugging this, so am interested 
> in hearing what people would suggest to try to track down why this is 
> happening (I am only a basic user of rabbit).  I believe the RabbitMQ 
> service install is a stock standard install of version 2.6.1, so 
> potentially an upgrade to 2.7.1 may clear things up.
>
> For the record here is the exception being thrown,
>
> The AMQP operation was interrupted: AMQP close-reason, initiated by 
> Library, code=541, text="Unexpected Exception", classId=0, methodId=0, 
> cause=System.IO.IOException: Unable to read data from the transport 
> connection: An existing connection was forcibly closed by the remote host. 
> ---> System.Net.Sockets.SocketException: An existing connection was 
> forcibly closed by the remote host
>   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset, 
> Int32 size)
>   --- End of inner exception stack trace ---
>   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
>   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
>   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
>   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
>  Source = RabbitMQ.Client
>
>  StackTrace:
>       at RabbitMQ.Client.Impl.SessionBase.Transmit(Command cmd)
>   at RabbitMQ.Client.Impl.ModelBase.ModelSend(MethodBase method, 
> ContentHeaderBase header, Byte[] body)
>   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String 
> routingKey, Boolean mandatory, Boolean immediate, IBasicProperties 
> basicProperties, Byte[] body)
>   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String 
> routingKey, IBasicProperties basicProperties, Byte[] body)
>   at ...
>
> Any help to track down the cause of this problem is appreciated!
>
> Thanks,
>
> Michael.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120808/37f4e75e/attachment.htm>

From berthold at exactag.com  Wed Aug  8 12:55:59 2012
From: berthold at exactag.com (Ulli Berthold - Exactag GmbH)
Date: Wed, 8 Aug 2012 11:55:59 +0000
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <50223636.5010305@rabbitmq.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<502228AE.3030608@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C39EB@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50223636.5010305@rabbitmq.com>
Message-ID: <F216F12DEE15B7429FB03C58643375521C4C3C52@AMXPRD0410MB377.eurprd04.prod.outlook.com>

Hi Matthias,

well, it does happen here... There are times when our queues grow to a couple of million messages (which actually was not a problem in 2.7.1), in 2.8.4 it went into flow control mode when the CPU load got higher though not limiting out.

Our problem is that we constantly produce lots of messages which have to be forwarded within milliseconds or we will run into frontend delays which should not occur.
I'm looking for a way to keep the queueing server accepting messages at the highest possible rate no matter what, for as long as it's not "full" (memory, disk, cpu). There is no real way for us to limit the input. And we know that the consumers will clear out the queues sooner or later, just not in real time.

And when we finally reach a point where the server is almost full, I'd curious if the flow control events of the C# driver will ever be fired? As I said, that would enable us to use a file-based fallback that's mostly intended for queuing server downtimes.

channel = connection.CreateModel();
    channel.ChannelFlow(true);
    channel.FlowControl += new RabbitMQ.Client.Events.FlowControlEventHandler(channel_FlowControl);

Regards from Germany

Ulli

-----Urspr?ngliche Nachricht-----
Von: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Gesendet: Mittwoch, 8. August 2012 11:50
An: Ulli Berthold - Exactag GmbH
Cc: Discussions about RabbitMQ
Betreff: Re: AW: AW: AW: AW: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

Ulli,

On 08/08/12 10:29, Ulli Berthold - Exactag GmbH wrote:
> we're running rabbit 2.8.4 / 2.8.5 on 64bit linux servers with 64bit 
> erlang and plenty of memory, and there was no "high watermark"
> warning in the logs either. Just to make sure i'm not erring to much
> - if the rabbit web ui shows a connection as "flow" instead of 
> "running" or "blocked" that does mean it is in flow control 
> (backpressure), correct?

Correct, but as noted at
http://www.rabbitmq.com/memory.html#per-connection, this kind of flow control is triggered many times a second.

It's really not something an application should need to worry about. And it does *not* mean the producer is blocked, since there are many buffers between the application and the broker connection handler that need to fill up first. That way spikes can be absorbed.

Obviously if producers attempt to publish at a *sustained* rate that is higher than the broker can handle then backpressure will propagate to the client and slow them down. The point at which that happens should be way higher than the 3kHz rate you anticipate.

Matthias.



From matthias at rabbitmq.com  Wed Aug  8 13:29:45 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 13:29:45 +0100
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <F216F12DEE15B7429FB03C58643375521C4C3C52@AMXPRD0410MB377.eurprd04.prod.outlook.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<502228AE.3030608@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C39EB@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50223636.5010305@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3C52@AMXPRD0410MB377.eurprd04.prod.outlook.com>
Message-ID: <50225BB9.9010006@rabbitmq.com>

Ulli,

On 08/08/12 12:55, Ulli Berthold - Exactag GmbH wrote:
> well, it does happen here... There are times when our queues grow to
> a couple of million messages (which actually was not a problem in
> 2.7.1), in 2.8.4 it went into flow control mode when the CPU load got
> higher though not limiting out.

When the management plug-in says that a connection is in 'flow' mode, 
that does *not* mean that it is no longer accepting messages. It only 
indicates that in the last ~10 seconds flow control got triggered at 
least once.

Also, when you say the CPU load wasn't limiting out, bear in mind that 
on a multi-core machine rabbit will not necessarily be able to utilise 
all cores - depends very much on the workload.

Are you actually experiencing publishing delays at the client?

> Our problem is that we constantly produce lots of messages which have
> to be forwarded within milliseconds or we will run into frontend
> delays which should not occur.

Yes, I understand that.

> I'm looking for a way to keep the queueing server accepting messages
> at the highest possible rate no matter what, for as long as it's not
> "full" (memory, disk, cpu).

One way to increase the buffering capacity is to increase the tcp buffer 
sizes in the kernel.

> And when we finally reach a point where the server is almost full,
> I'd curious if the flow control events of the C# driver will ever be
> fired? As I said, that would enable us to use a file-based fallback
> that's mostly intended for queuing server downtimes.
>
> channel = connection.CreateModel(); channel.ChannelFlow(true);
> channel.FlowControl += new
> RabbitMQ.Client.Events.FlowControlEventHandler(channel_FlowControl);

RabbitMQ does not send channel.flow commands, so no, these events won't 
fire.

We were sending channel.flow from rabbit a few years ago but had to 
abandon that because a) it proved to be way too slow to react to 
critical server conditions, and b) many clients weren't handling 
channel.flow correctly.


I still think my client-side mini queue idea would work well for you. It 
provides a high degree of control over when to trigger a fallback 
publishing path and has the added advantage that it will also cope with 
temporary network disruptions - i.e. conditions that stall (but not 
kill) tcp connections - which no server-generated signal could do.


Regards,

Matthias.

From berthold at exactag.com  Wed Aug  8 13:36:06 2012
From: berthold at exactag.com (Ulli Berthold - Exactag GmbH)
Date: Wed, 8 Aug 2012 12:36:06 +0000
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <50225BB9.9010006@rabbitmq.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<502228AE.3030608@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C39EB@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50223636.5010305@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3C52@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50225BB9.9010006@rabbitmq.com>
Message-ID: <F216F12DEE15B7429FB03C58643375521C4C3D1D@AMXPRD0410MB377.eurprd04.prod.outlook.com>

Hi Matthias,

yes, we are experiencing major delays at the client in some (non-reproductible) cases.
So if I understand this correctly there is no predefined event to catch delays like that with the default client, instead I have to create a custom way to react on delays and flow limits? For example using the "internal" queuing you proposed?

With kind regards

Ulli

-----Urspr?ngliche Nachricht-----
Von: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Gesendet: Mittwoch, 8. August 2012 14:30
An: Ulli Berthold - Exactag GmbH
Cc: Discussions about RabbitMQ
Betreff: Re: AW: AW: AW: AW: AW: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

Ulli,

On 08/08/12 12:55, Ulli Berthold - Exactag GmbH wrote:
> well, it does happen here... There are times when our queues grow to a 
> couple of million messages (which actually was not a problem in 
> 2.7.1), in 2.8.4 it went into flow control mode when the CPU load got 
> higher though not limiting out.

When the management plug-in says that a connection is in 'flow' mode, that does *not* mean that it is no longer accepting messages. It only indicates that in the last ~10 seconds flow control got triggered at least once.

Also, when you say the CPU load wasn't limiting out, bear in mind that on a multi-core machine rabbit will not necessarily be able to utilise all cores - depends very much on the workload.

Are you actually experiencing publishing delays at the client?

> Our problem is that we constantly produce lots of messages which have 
> to be forwarded within milliseconds or we will run into frontend 
> delays which should not occur.

Yes, I understand that.

> I'm looking for a way to keep the queueing server accepting messages 
> at the highest possible rate no matter what, for as long as it's not 
> "full" (memory, disk, cpu).

One way to increase the buffering capacity is to increase the tcp buffer sizes in the kernel.

> And when we finally reach a point where the server is almost full, I'd 
> curious if the flow control events of the C# driver will ever be 
> fired? As I said, that would enable us to use a file-based fallback 
> that's mostly intended for queuing server downtimes.
>
> channel = connection.CreateModel(); channel.ChannelFlow(true); 
> channel.FlowControl += new 
> RabbitMQ.Client.Events.FlowControlEventHandler(channel_FlowControl);

RabbitMQ does not send channel.flow commands, so no, these events won't fire.

We were sending channel.flow from rabbit a few years ago but had to abandon that because a) it proved to be way too slow to react to critical server conditions, and b) many clients weren't handling channel.flow correctly.


I still think my client-side mini queue idea would work well for you. It provides a high degree of control over when to trigger a fallback publishing path and has the added advantage that it will also cope with temporary network disruptions - i.e. conditions that stall (but not
kill) tcp connections - which no server-generated signal could do.


Regards,

Matthias.



From matthias at rabbitmq.com  Wed Aug  8 13:44:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 13:44:07 +0100
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <F216F12DEE15B7429FB03C58643375521C4C3D1D@AMXPRD0410MB377.eurprd04.prod.outlook.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<502228AE.3030608@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C39EB@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50223636.5010305@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3C52@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50225BB9.9010006@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3D1D@AMXPRD0410MB377.eurprd04.prod.outlook.com>
Message-ID: <50225F17.3010702@rabbitmq.com>

Ulli,

On 08/08/12 13:36, Ulli Berthold - Exactag GmbH wrote:
> yes, we are experiencing major delays at the client in some
> (non-reproductible) cases.

Interesting. And there is nothing unusual in the logs? E.g. those cases 
don't, say, correspond to memory alarms being triggered?

> So if I understand this correctly there is no predefined event to
> catch delays like that with the default client, instead I have to
> create a custom way to react on delays and flow limits?

Correct.

Matthias.

From berthold at exactag.com  Wed Aug  8 14:20:21 2012
From: berthold at exactag.com (Ulli Berthold - Exactag GmbH)
Date: Wed, 8 Aug 2012 13:20:21 +0000
Subject: [rabbitmq-discuss] TCP Backpressure / Flow Control in C#
 producer
In-Reply-To: <50225F17.3010702@rabbitmq.com>
References: <F216F12DEE15B7429FB03C58643375521C4C36C0@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<5022191D.1060203@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3768@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50221BF2.6030600@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3815@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50222182.4070407@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C38FA@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<502228AE.3030608@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C39EB@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50223636.5010305@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3C52@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50225BB9.9010006@rabbitmq.com>
	<F216F12DEE15B7429FB03C58643375521C4C3D1D@AMXPRD0410MB377.eurprd04.prod.outlook.com>
	<50225F17.3010702@rabbitmq.com>
Message-ID: <F216F12DEE15B7429FB03C58643375521C4C3DCD@AMXPRD0410MB377.eurprd04.prod.outlook.com>

Hi Matthias,

no, there were not, though i'll try and grab a load of logs next time it happens.

Thanks for your help

Regards

Ulli

-----Urspr?ngliche Nachricht-----
Von: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Gesendet: Mittwoch, 8. August 2012 14:44
An: Ulli Berthold - Exactag GmbH
Cc: Discussions about RabbitMQ
Betreff: Re: AW: AW: AW: AW: AW: AW: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

Ulli,

On 08/08/12 13:36, Ulli Berthold - Exactag GmbH wrote:
> yes, we are experiencing major delays at the client in some
> (non-reproductible) cases.

Interesting. And there is nothing unusual in the logs? E.g. those cases don't, say, correspond to memory alarms being triggered?

> So if I understand this correctly there is no predefined event to 
> catch delays like that with the default client, instead I have to 
> create a custom way to react on delays and flow limits?

Correct.

Matthias.



From emile at rabbitmq.com  Wed Aug  8 15:38:38 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 08 Aug 2012 15:38:38 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on MS Framework
In-Reply-To: <e94090ac-286f-4465-876f-ed38211b0288@googlegroups.com>
References: <e94090ac-286f-4465-876f-ed38211b0288@googlegroups.com>
Message-ID: <502279EE.6070705@rabbitmq.com>

Hi Mark,

On 07/08/12 18:05, Mark Ward wrote:
> errors via a dictionary class.  This information is hidden unless
> .ToString() is called on the class.  When running on the Microsoft .NET
> framework 4.0 the .ToString() does not output any detailed information
> as to why the exception occurred.  

If you are concerned about the way that ToString() treats Dictionaries
in your chosen .net framework then you should consider providing your
own output function that formats the information appropriately. Please
let us know if you think the exception structure should accommodate your
use better.


-Emile


From simon at rabbitmq.com  Wed Aug  8 15:36:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Aug 2012 15:36:58 +0100
Subject: [rabbitmq-discuss] Using ldap when connecting to management
	plugin
In-Reply-To: <CAB_hqn9se7Ho9fJ+_TxYR6Dp=pZxQyv94+jpaC7GVDVyDwRHDw@mail.gmail.com>
References: <CAB_hqn9se7Ho9fJ+_TxYR6Dp=pZxQyv94+jpaC7GVDVyDwRHDw@mail.gmail.com>
Message-ID: <5022798A.7010107@rabbitmq.com>

On 01/08/12 19:45, Kristen Stewart wrote:
> This is the error returned from the management UI:
>
> {error,
>      {exit,
>          {{{case_clause,
>                {badrpc,
>                    {'EXIT',
>                        {as_user_no_password,
>                            {gen_server,call,
>                                [rabbit_auth_backend_ldap,
>                                 {login,<<"knstewart">>},

Ah. Thanks for the report.

So it seems that there is an incompatibility between the AMQP direct 
client and the LDAP plugin's {other_bind, as_user} mode. This will 
affect bits of the management plugin and some other plugins (STOMP for 
example).

This is especially noticeable since {other_bind, as_user} is the default 
since 2.8.0.

If it's acceptable to you, you can work around this by setting 
{other_bind, anon} or {other_bind, {"username", "password"}} under 
rabbitmq_auth_backend_ldap in your configuration file.

For an explanation of other_bind, see:

http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/d76afaf44415/README#l100

A fix for this will appear in a future release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gobadiah at gmail.com  Wed Aug  8 17:03:25 2012
From: gobadiah at gmail.com (=?iso-8859-1?Q?Micha=EBl_Journo?=)
Date: Wed, 8 Aug 2012 18:03:25 +0200
Subject: [rabbitmq-discuss] rabbitmq location
Message-ID: <185A1FA2-EBAD-4055-8A05-5F72E521D70F@gmail.com>

Hello everyone,

I'm a new user to rabbitmq and I'm running into a disk usage problem.

Rabbitmq is not running properly because of a disk usage limit, which I don't want to turn down. Instead I would like to move relevant files into some directory in /home (e.g. /home/rabbitmq) since /home is the main partition of my server.
Which files should I move and which configuration files should I change in order to do that ?

Thank you all for your help.

Michael

From simon at rabbitmq.com  Wed Aug  8 17:13:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Aug 2012 17:13:47 +0100
Subject: [rabbitmq-discuss] rabbitmq location
In-Reply-To: <185A1FA2-EBAD-4055-8A05-5F72E521D70F@gmail.com>
References: <185A1FA2-EBAD-4055-8A05-5F72E521D70F@gmail.com>
Message-ID: <5022903B.4000506@rabbitmq.com>

On 08/08/12 17:03, Micha?l Journo wrote:
> Hello everyone,

Hi Micha?l.

> I'm a new user to rabbitmq and I'm running into a disk usage
> problem.
>
> Rabbitmq is not running properly because of a disk usage limit, which
> I don't want to turn down. Instead I would like to move relevant
> files into some directory in /home (e.g. /home/rabbitmq) since /home
> is the main partition of my server. Which files should I move and
> which configuration files should I change in order to do that ?

You don't say which packaging you're using; I shall assume deb or RPM.

You can put

MNESIA_BASE=/home/rabbitmq/db
LOG_BASE=/home/rabbitmq/logs

into /etc/rabbitmq/rabbitmq-env.conf and restart RabbitMQ, this will 
start afresh in the new location (make sure it is owned by the rabbitmq 
user!)

If you need to move over the existing DB, it will be found in 
/var/lib/rabbitmq/mnesia.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dla.it.service at gmail.com  Wed Aug  8 21:45:09 2012
From: dla.it.service at gmail.com (DT)
Date: Wed, 8 Aug 2012 20:45:09 +0000 (UTC)
Subject: [rabbitmq-discuss] rabbitmq.config - ssl & management plugin
References: <loom.20120807T205232-390@post.gmane.org>
	<5021D201.4020104@rabbitmq.com>
Message-ID: <loom.20120808T221335-473@post.gmane.org>

Matthias Radestock <matthias at ...> writes:

> 
> On 07/08/12 20:01, DT wrote:
> > Has anyone configured the ssl access for management plugin?
> >
> > This is what I have in the rabbitmq.config file to access plugin 
management with
> > SSL.
> 
> You are missing...
> 
> 1) a '[' here
> 
> > {rabbit, [
> >   {ssl_listeners, [5671]},
> >   {ssl_options, [{cacertfile,"c:/testca/cacert.pem"},
> >   {certfile,"c:/server/cert.pem"},
> >   {keyfile,"C:/server/key.pem"},
> >   {verify,verify_peer},
> >   {fail_if_no_peer_cert,false}]}
> >   ]}
> 
> 2) a trailing ',' here
> 
> >   {rabbitmq_mochiweb,
> >   [{listeners, [{'*', [{port, 55670}]},
> >   {mgmt, [{port, 55672},
> >   {ssl, true},
> >   {ssl_opts, [{cacertfile, "c:/testca/cacert.pem"},
> >   {certfile, "C:/server/cert.pem"},
> >   {keyfile, "C:/server/key.pem"}]}
> >              ]}
> >         ]}
> >   ]}
> >   ].
> 
> Matthias.
> 
> 

Thanks for responding.  

Actually this is what I have in the rabbitmq.config.  I get an unexpected error
when executing 'rabbitmq-service start'

C:\Program Files\erl5.9.1\erts-5.9.1\bin\erlsrv: Failed to start service 
RabbitMQ.
Error: The process terminated unexpectedly.

[
  {rabbit, [
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"c:/testca/cacert.pem"},
                    {certfile,  "c:/server/cert.pem"},
                    {keyfile,   "c:/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}
   ]}
   {rabbitmq_mochiweb,  [
       {listeners, [{'*', [{port, 55670}]},
         {mgmt, [{port, 55672},
            {ssl,      true},
            {ssl_opts, [{cacertfile, "c:/testca/cacert.pem"},
                        {certfile,   "c:/server/cert.pem"},
                        {keyfile,    "c:/server/key.pem"}]}
                       ]}
               ]}
   ]}
].


DT.





From matthias at rabbitmq.com  Wed Aug  8 21:50:54 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Aug 2012 21:50:54 +0100
Subject: [rabbitmq-discuss] rabbitmq.config - ssl & management plugin
In-Reply-To: <loom.20120808T221335-473@post.gmane.org>
References: <loom.20120807T205232-390@post.gmane.org>
	<5021D201.4020104@rabbitmq.com>
	<loom.20120808T221335-473@post.gmane.org>
Message-ID: <5022D12E.2080804@rabbitmq.com>

On 08/08/12 21:45, DT wrote:
> Actually this is what I have in the rabbitmq.config.  I get an unexpected error
> when executing 'rabbitmq-service start'

You are still missing a comma ...

> [
>    {rabbit, [
>       {ssl_listeners, [5671]},
>       {ssl_options, [{cacertfile,"c:/testca/cacert.pem"},
>                      {certfile,  "c:/server/cert.pem"},
>                      {keyfile,   "c:/server/key.pem"},
>                      {verify,verify_peer},
>                      {fail_if_no_peer_cert,false}]}
>     ]}

right here.

>     {rabbitmq_mochiweb,  [
>         {listeners, [{'*', [{port, 55670}]},
>           {mgmt, [{port, 55672},
>              {ssl,      true},
>              {ssl_opts, [{cacertfile, "c:/testca/cacert.pem"},
>                          {certfile,   "c:/server/cert.pem"},
>                          {keyfile,    "c:/server/key.pem"}]}
>                         ]}
>                 ]}
>     ]}
> ].


Matthias.


From pbell at syncsort.com  Wed Aug  8 23:06:48 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Wed, 8 Aug 2012 18:06:48 -0400
Subject: [rabbitmq-discuss] Two questions: max bindings and handling
 noconsumer present
In-Reply-To: <5018E418.8090306@rabbitmq.com>
References: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com><4F4282B1.8080109@rabbitmq.com>
	<21fbf71a-d0b1-4a60-98e3-e277ff4f00c4@t15g2000yqi.googlegroups.com><4F42B29E.8060802@rabbitmq.com><43F987BC-39A1-41FD-8574-FFF3
	2406C771@syncsort.com><D0AE5493-654F-4C7D-BA9A-95D35BA2D248@rabbitmq.com>
	<5018E418.8090306@rabbitmq.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B610E741D@MAILCCR.us.syncsort.com>

Tim and Matthias,

Thank you for your replies. Sorry I didn't get back to you sooner.

I do understand that the instant I determine (query the infrastructure) that the consumer is up, it might go down.

I am trying to prevent a "job start" message from being published when there is no consumer to receive that message. In the normal course of events, with the consumer up, receipt of such a message would cause the consumer to run the job requested by the message.

It is far more preferable to complain up front that there is no consumer (and that therefore the job won't be run) than it is to have the broker silently discard the message.

I will think about the alternative routing topologies Matthias suggests. But what's wrong with using the mandatory flag - is it not applicable for the case I describe?

Cordially,

Paul

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthias Radestock
Sent: Wednesday, August 01, 2012 4:09 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Two questions: max bindings and handling noconsumer present

On 01/08/12 08:23, Tim Watson wrote:
>
> On 1 Aug 2012, at 04:10, "Bell, Paul M." <pbell at syncsort.com> .
>>
>> I suppose this is where the "mandatory" flag comes in. But I'm
>> wondering if there's a way to query  the broker about its
>> infrastructure, e.g., the existence of a queue/binding that would
>> indicate the presence of the consumer.
>>
>
> There are ways to query the infrastructure, but these rare generally
> not exposed to client APIs. What client are you using?

Moreover, performing such a "does a consumer exists?" query before
publishing is racy, since the consumer might well vanish between the
query and the publishing event.

What are you actually trying to accomplish? Is the idea that in the
absence of consumers the producer would hang on to the message and retry
later? In that case you may want to consider alternative routing
topologies. E.g. perhaps the consumer queues could be declared ahead of
time. Or you could use an alternate exchange to route messages to
holding queue where they are then picked up from consumers when they
join. Or you could do something even more sophisticated and configure
said holding queue with a message-ttl and set the original exchange as
the dead-letter exchange of the queue - that way messages will be
retried periodically automatically.

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From vinichadha at gmail.com  Thu Aug  9 01:51:35 2012
From: vinichadha at gmail.com (Vineet Chadha)
Date: Wed, 8 Aug 2012 17:51:35 -0700
Subject: [rabbitmq-discuss] reply-code=406,
	reply-text=PRECONDITION_FAILED - unknown delivery tag
Message-ID: <CA+5hJbhemPDt3XztORpxha08yhQd2tExQNXDFv3LfaUEkT2SAw@mail.gmail.com>

Hello,

We are using rabbit cluster for a few months now and things have been
working fine until now.

ENVIORNMENT
=============
RabbitMQ Server version 2.8.2
RabbitMQ Client 2.7.1

One of our applications is consuming messages from RabbitMQ server over WAN.
This was a recent introduction i.e. going over WAN to a diff. RabbitMQ
cluster than the local one.
After a few hours of being up and consuming messages, one of the many
channels in the application
is closed by the server with the following message.

{#method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED -
unknown delivery tag 1073743883, class-id=60, method-id=80), null,
"[B at 607daec3"}


From matthias at rabbitmq.com  Thu Aug  9 08:58:18 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 09 Aug 2012 08:58:18 +0100
Subject: [rabbitmq-discuss] Two questions: max bindings and handling
 noconsumer present
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B610E741D@MAILCCR.us.syncsort.com>
References: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com><4F4282B1.8080109@rabbitmq.com>
	<21fbf71a-d0b1-4a60-98e3-e277ff4f00c4@t15g2000yqi.googlegroups.com><4F42B29E.8060802@rabbitmq.com><43F987BC-39A1-41FD-8574-FFF3
	2406C771@syncsort.com><D0AE5493-654F-4C7D-BA9A-95D35BA2D248@rabbitmq.com>
	<5018E418.8090306@rabbitmq.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B610E741D@MAILCCR.us.syncsort.com>
Message-ID: <50236D9A.1030600@rabbitmq.com>

On 08/08/12 23:06, Bell, Paul M. wrote:
> I will think about the alternative routing topologies Matthias
> suggests. But what's wrong with using the mandatory flag - is it not
> applicable for the case I describe?

The problem is that it's racy. There may be a connected consumer and 
associated queue at the time the message is routed - which is what 
'mandatory' is checking - but then said consumer might disconnect before 
rabbit had a chance to send it the message.

Thinking about it though, employing an alternate exchange suffers from 
the same problem.

Not deleting the queues when consumers disconnect (i.e. not using 
exclusive queues), is about the only solution I can think of that won't 
result in the message being silently discarded in the above scenario, 
but that may not fit in with what you want to accomplish.

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Aug  9 09:40:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 09 Aug 2012 09:40:29 +0100
Subject: [rabbitmq-discuss] reply-code=406,
 reply-text=PRECONDITION_FAILED - unknown delivery tag
In-Reply-To: <CA+5hJbhemPDt3XztORpxha08yhQd2tExQNXDFv3LfaUEkT2SAw@mail.gmail.com>
References: <CA+5hJbhemPDt3XztORpxha08yhQd2tExQNXDFv3LfaUEkT2SAw@mail.gmail.com>
Message-ID: <5023777D.9080007@rabbitmq.com>

Vineet,

On 09/08/12 01:51, Vineet Chadha wrote:
> {#method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED -
> unknown delivery tag 1073743883, class-id=60, method-id=80), null,
> "[B at 607daec3"}
>
>  From what i have read so far it seems like a problem of double ack. but
> it could be something totally different.

Apart from the unlikely scenario of the client application randomly 
inventing delivery tags and submitting acks, the probable causes are:

- ack'ing the same message twice

- ack'ing on a channel other than the one the messages was received on (*)

- ack'ing a message when it was consumed in no-ack mode

- all the above but using basic.reject, basic.nack instead of basic.ack, 
or a combination of the three (e.g. rejecting a message and then ack'ing it)

(*) this is a common occurrence in applications with naive error 
recovery logic that re-establishes connections&channels transparently 
behind the scenes.

> Our application is connecting to the cluster through a netscaler VIP.
>
> We have not seen this problem when consuming from a local cluster with
> the same application.

The local/remote difference does not change anything logically, but it 
does affect timing which thus can reveal race conditions in the application.

Regards,

Matthias.

From james.r.carr at gmail.com  Thu Aug  9 16:59:27 2012
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 9 Aug 2012 10:59:27 -0500
Subject: [rabbitmq-discuss] Upstream-set of upstream-sets in federation?
Message-ID: <CAJreXKDo0Jciv+gN4iwQh4GXpUYxOrCVZgESu-ZWbgMc2EQ3nw@mail.gmail.com>

Hi,

Is it possible to define a set of upstream-sets in federation? For
example, if I have 3 locations (say TX, VA, CA) and have an
upstream-set for each individual one is it possible to group those
sets so that a particular federated exchange can just federate from
all of them?


Thanks,
James

From dla.it.service at gmail.com  Thu Aug  9 17:11:45 2012
From: dla.it.service at gmail.com (DT)
Date: Thu, 9 Aug 2012 16:11:45 +0000 (UTC)
Subject: [rabbitmq-discuss] rabbitmq.config - ssl & management plugin
References: <loom.20120807T205232-390@post.gmane.org>
	<5021D201.4020104@rabbitmq.com>
	<loom.20120808T221335-473@post.gmane.org>
	<5022D12E.2080804@rabbitmq.com>
Message-ID: <loom.20120809T181026-798@post.gmane.org>

Matthias Radestock <matthias at ...> writes:

> 
> On 08/08/12 21:45, DT wrote:
> > Actually this is what I have in the rabbitmq.config.  I get an unexpected 
error
> > when executing 'rabbitmq-service start'
> 
> You are still missing a comma ...
> 
> 
> Matthias.
> 
> 

Thanks for pointing out the missing comma, again!



From wamrewam at googlemail.com  Thu Aug  9 14:58:44 2012
From: wamrewam at googlemail.com (PierreW)
Date: Thu, 9 Aug 2012 06:58:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Temporary callback queues: scaling issues?
Message-ID: <4028ba2f-910c-4072-8367-3cf22bd7d1cc@h5g2000vbl.googlegroups.com>

Hi guys,

We are considering migrating our app to a service architecture +
RabbitMQ to help with scaling. We will need to create a lot of
temporary callback queues (as described in the tutorials, RPC setup)
since we need to create some temporary "bindings" between services. Is
this considered a bad idea? It is difficult to quantify "a lot" but we
could have 500 to 1000 queues at the same time.

At the moment we use a simple key/value solution for this.

Thanks!
Pierre

From haenisch at dhbw-heidenheim.de  Thu Aug  9 15:18:17 2012
From: haenisch at dhbw-heidenheim.de (=?iso-8859-1?Q?Till_H=E4nisch?=)
Date: Thu, 9 Aug 2012 16:18:17 +0200
Subject: [rabbitmq-discuss] Java Client Error handling: How to detect
	deleted queue
Message-ID: <1D734451-691D-47BA-86FB-709311FB6EE8@dhbw-heidenheim.de>

Hi,

I wonder how a client program can find out if a queue got deleted (after the client connected). 
Neither the registered ReturnListener nor the ShutdownListener get's called (at least in my sample program).

Any help ?

Greetings Till Haenisch

-------------------------------------------------------------

Till H?nisch

imari - Zentrum f?r Innovative Marketingsysteme und Risikomanagement

Department of Business Information Systems

University of Cooperative Education Heidenheim
Duale Hochschule Baden Wuerttemberg - Heidenheim
www.dhbw-heidenheim.de

haenisch at dhbw-heidenheim.de
Tel: (++49) 7321/2722-292






From wamrewam at googlemail.com  Thu Aug  9 16:16:39 2012
From: wamrewam at googlemail.com (wam rewam)
Date: Thu, 9 Aug 2012 16:16:39 +0100
Subject: [rabbitmq-discuss] Temporary callback queues: scaling issues?
Message-ID: <CAOyt7Yc-Cmej-4712HF1Jb+g9n2704jPOYmrz2Dy=9YaY-JiJg@mail.gmail.com>

Hi guys,

We are considering migrating our app to a service architecture + RabbitMQ
to help with scaling. We will need to create a lot of temporary callback
queues (as described in the tutorials, RPC setup) since we need to create
some temporary "bindings" between services. Is this considered a bad idea?
It is difficult to quantify "a lot" but we could have 500 to 1000 queues at
the same time.

At the moment we use a simple key/value solution for this.

Thanks!
Pierre
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120809/9f0f6086/attachment.htm>

From matthias at rabbitmq.com  Thu Aug  9 23:20:46 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 09 Aug 2012 23:20:46 +0100
Subject: [rabbitmq-discuss] Java Client Error handling: How to detect
 deleted queue
In-Reply-To: <1D734451-691D-47BA-86FB-709311FB6EE8@dhbw-heidenheim.de>
References: <1D734451-691D-47BA-86FB-709311FB6EE8@dhbw-heidenheim.de>
Message-ID: <502437BE.7000006@rabbitmq.com>

Till,

On 09/08/12 15:18, Till H?nisch wrote:
> I wonder how a client program can find out if a queue got deleted
> (after the client connected). Neither the registered ReturnListener
> nor the ShutdownListener get's called (at least in my sample
> program).

If you are consuming from the queue then there is
http://www.rabbitmq.com/extensions.html#onsumer-cancel-notify

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Aug  9 23:22:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 09 Aug 2012 23:22:44 +0100
Subject: [rabbitmq-discuss] Java Client Error handling: How to detect
 deleted queue
In-Reply-To: <502437BE.7000006@rabbitmq.com>
References: <1D734451-691D-47BA-86FB-709311FB6EE8@dhbw-heidenheim.de>
	<502437BE.7000006@rabbitmq.com>
Message-ID: <50243834.5000600@rabbitmq.com>

On 09/08/12 23:20, Matthias Radestock wrote:
> If you are consuming from the queue then there is
> http://www.rabbitmq.com/extensions.html#onsumer-cancel-notify

Er, http://www.rabbitmq.com/extensions.html#consumer-cancel-notify

Matthias.


From david.myllykangas at ericsson.com  Fri Aug 10 07:42:18 2012
From: david.myllykangas at ericsson.com (David Myllykangas)
Date: Fri, 10 Aug 2012 08:42:18 +0200
Subject: [rabbitmq-discuss] Rabbit 2.8.5 enable plugins,
	cannot_write_enabled_plugins_file
Message-ID: <9819C11BC6C68B4F820C87D7C7AC7A303BE17B8807@ESESSCMS0365.eemea.ericsson.se>


Hi

I just downloaded rabbit 2.8.5 and compiled from source.

when I try to run scripts/rabbitmq-plugins enable rabbitmq_management I get the following error:
Error: {cannot_write_enabled_plugins_file,"/etc/rabbitmq/enabled_plugins",
           enoent}

I have set the environment-variables;
RABBITMQ_BASE
RABBITMQ_MNESIA_DIR
RABBITMQ_LOG_BASE
RABBITMQ_PLUGINS_DIR
RABBITMQ_PLUGINS_EXPAND_DIR

Is there any other environment variable I need to set to get this to work? (I need rabbit to have all configrations in a separate directory)

Thanks

-David

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120810/b6ff0c0e/attachment.htm>

From haenisch at dhbw-heidenheim.de  Fri Aug 10 07:51:57 2012
From: haenisch at dhbw-heidenheim.de (=?iso-8859-1?Q?Till_H=E4nisch?=)
Date: Fri, 10 Aug 2012 08:51:57 +0200
Subject: [rabbitmq-discuss] Java Client Error handling: How to detect
	deleted queue
In-Reply-To: <50243834.5000600@rabbitmq.com>
References: <1D734451-691D-47BA-86FB-709311FB6EE8@dhbw-heidenheim.de>
	<502437BE.7000006@rabbitmq.com> <50243834.5000600@rabbitmq.com>
Message-ID: <E77941A7-DDB0-4229-8D68-C3F7B9F49EAC@dhbw-heidenheim.de>

Hi Matthias,

sorry for being not precise: My problem is how the producer finds out, that the queue was deleted, not the consumer.

Greetings Till

Am 10.08.2012 um 00:22 schrieb Matthias Radestock:

> On 09/08/12 23:20, Matthias Radestock wrote:
>> If you are consuming from the queue then there is
>> http://www.rabbitmq.com/extensions.html#onsumer-cancel-notify
> 
> Er, http://www.rabbitmq.com/extensions.html#consumer-cancel-notify
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------------------------------------------------------

Till H?nisch

imari - Zentrum f?r Innovative Marketingsysteme und Risikomanagement

Department of Business Information Systems

University of Cooperative Education Heidenheim
Duale Hochschule Baden Wuerttemberg - Heidenheim
www.dhbw-heidenheim.de

haenisch at dhbw-heidenheim.de
Tel: (++49) 7321/2722-292






From matthias at rabbitmq.com  Fri Aug 10 08:27:58 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 10 Aug 2012 08:27:58 +0100
Subject: [rabbitmq-discuss] Java Client Error handling: How to detect
 deleted queue
In-Reply-To: <E77941A7-DDB0-4229-8D68-C3F7B9F49EAC@dhbw-heidenheim.de>
References: <1D734451-691D-47BA-86FB-709311FB6EE8@dhbw-heidenheim.de>
	<502437BE.7000006@rabbitmq.com> <50243834.5000600@rabbitmq.com>
	<E77941A7-DDB0-4229-8D68-C3F7B9F49EAC@dhbw-heidenheim.de>
Message-ID: <5024B7FE.7080506@rabbitmq.com>

Till,

On 10/08/12 07:51, Till H?nisch wrote:
> sorry for being not precise: My problem is how the producer finds
> out, that the queue was deleted, not the consumer.

There's the 'mandatory' flag on basic.publish, which will trigger a 
basic.return on publish if the message could not be routed to *any* queue.

Or you could issue a passive queue.declare every now and then to check 
whether the queue exists.

Neither of these are w/o problems. There was a thread with a similar 
question just a few days ago: 
http://rabbitmq.1065348.n5.nabble.com/Android-unable-to-open-stack-traces-error-tt20136.html#a21144


Matthias.

From matthias at rabbitmq.com  Fri Aug 10 08:40:26 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 10 Aug 2012 08:40:26 +0100
Subject: [rabbitmq-discuss] Rabbit 2.8.5 enable plugins,
	cannot_write_enabled_plugins_file
In-Reply-To: <9819C11BC6C68B4F820C87D7C7AC7A303BE17B8807@ESESSCMS0365.eemea.ericsson.se>
References: <9819C11BC6C68B4F820C87D7C7AC7A303BE17B8807@ESESSCMS0365.eemea.ericsson.se>
Message-ID: <5024BAEA.9080401@rabbitmq.com>

Did,

On 10/08/12 07:42, David Myllykangas wrote:
> I just downloaded rabbit 2.8.5 and compiled from source.

I recommend downloading the generic binary instead of compiling from source.

> when I try to run scripts/rabbitmq-plugins enable rabbitmq_management I
> get the following error:
> Error: {cannot_write_enabled_plugins_file,"/etc/rabbitmq/enabled_plugins",
>             enoent}
> I have set the environment-variables;
> RABBITMQ_BASE
> RABBITMQ_MNESIA_DIR
> RABBITMQ_LOG_BASE
> RABBITMQ_PLUGINS_DIR
> RABBITMQ_PLUGINS_EXPAND_DIR
> Is there any other environment variable I need to set to get this to
> work? (I need rabbit to have all configrations in a separate directory)

RABBITMQ_ENABLED_PLUGINS_FILE, as per 
http://www.rabbitmq.com/relocate.html#generic-unix.

Matthias.

From matthias at rabbitmq.com  Fri Aug 10 09:37:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 10 Aug 2012 09:37:07 +0100
Subject: [rabbitmq-discuss] Temporary callback queues: scaling issues?
In-Reply-To: <CAOyt7Yc-Cmej-4712HF1Jb+g9n2704jPOYmrz2Dy=9YaY-JiJg@mail.gmail.com>
References: <CAOyt7Yc-Cmej-4712HF1Jb+g9n2704jPOYmrz2Dy=9YaY-JiJg@mail.gmail.com>
Message-ID: <5024C833.8080207@rabbitmq.com>

On 09/08/12 16:16, wam rewam wrote:
> We are considering migrating our app to a service architecture +
> RabbitMQ to help with scaling. We will need to create a lot of temporary
> callback queues (as described in the tutorials, RPC setup) since we need
> to create some temporary "bindings" between services. Is this considered
> a bad idea? It is difficult to quantify "a lot" but we could have 500 to
> 1000 queues at the same time.

A typical rabbit installation can easily accommodate tens of thousands 
of queues.

Matthias.

From david.myllykangas at ericsson.com  Fri Aug 10 11:46:47 2012
From: david.myllykangas at ericsson.com (David Myllykangas)
Date: Fri, 10 Aug 2012 12:46:47 +0200
Subject: [rabbitmq-discuss] Change rabbitmq_mochiweb listning port for
 management plugin
In-Reply-To: <5024BAEA.9080401@rabbitmq.com>
References: <9819C11BC6C68B4F820C87D7C7AC7A303BE17B8807@ESESSCMS0365.eemea.ericsson.se>
	<5024BAEA.9080401@rabbitmq.com>
Message-ID: <9819C11BC6C68B4F820C87D7C7AC7A303BE17B89B2@ESESSCMS0365.eemea.ericsson.se>


I am trying to modify the port for the management plugin;

I got the plugin to work on the default port, but when I create a rabbitmq.config file, it does not work. It does not even work if I specify 55672 as port in this configfile. If I remove the configfile and restart rabbitmq, it works again.

$ cat > etc/rabbitmq/rabbitmq.config
[
  {rabbitmq_mochiweb, [{listeners, [{mgmt, [{port, 8004}]}]}]}, ]. 
$

Any idea what I do wrong?

Thanks,
 David

From matthias at rabbitmq.com  Fri Aug 10 11:59:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 10 Aug 2012 11:59:04 +0100
Subject: [rabbitmq-discuss] Change rabbitmq_mochiweb listning port for
 management plugin
In-Reply-To: <9819C11BC6C68B4F820C87D7C7AC7A303BE17B89B2@ESESSCMS0365.eemea.ericsson.se>
References: <9819C11BC6C68B4F820C87D7C7AC7A303BE17B8807@ESESSCMS0365.eemea.ericsson.se>
	<5024BAEA.9080401@rabbitmq.com>
	<9819C11BC6C68B4F820C87D7C7AC7A303BE17B89B2@ESESSCMS0365.eemea.ericsson.se>
Message-ID: <5024E978.6000905@rabbitmq.com>

On 10/08/12 11:46, David Myllykangas wrote:
> $ cat > etc/rabbitmq/rabbitmq.config
> [
>    {rabbitmq_mochiweb, [{listeners, [{mgmt, [{port, 8004}]}]}]}, ].
> $

That last comma shouldn't be there. I suggest you donate it to DT (see 
http://rabbitmq.1065348.n5.nabble.com/rabbitmq-config-ssl-amp-management-plugin-tt21280.html#a21308) 
;)

Matthias.

From m.luchak at smartasking.com  Fri Aug 10 16:12:19 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 10 Aug 2012 11:12:19 -0400 (EDT)
Subject: [rabbitmq-discuss] Disbale "#" binding key on an exchange
Message-ID: <1344611539.96579337@apps.rackspace.com>


Hi All,
 
Is there a way (for security reasons) to deny an exchange subscribing with the "#" binding key in an exchange to exchange bind?
 
thanks,
Matthew
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120810/db53243a/attachment.htm>

From curylod at asme.org  Fri Aug 10 16:19:43 2012
From: curylod at asme.org (Dave Curylo)
Date: Fri, 10 Aug 2012 11:19:43 -0400
Subject: [rabbitmq-discuss] Exchange to exchange bindings in python (pika)
Message-ID: <CAAqmy6M+J6dwUsdCmuXMbPs63k51MDP=k2BfWEVKR=YU5LXFAA@mail.gmail.com>

Has anyone got an example of performing exchange to exchange bindings in
pika? I'm not sure this extension to AMQP has been implemented. If not,
does anyone know of a python module that supports this?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120810/136ae5a9/attachment.htm>

From gmr at meetme.com  Fri Aug 10 16:27:26 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 10 Aug 2012 11:27:26 -0400
Subject: [rabbitmq-discuss] Exchange to exchange bindings in python
 (pika)
In-Reply-To: <CAAqmy6M+J6dwUsdCmuXMbPs63k51MDP=k2BfWEVKR=YU5LXFAA@mail.gmail.com>
References: <CAAqmy6M+J6dwUsdCmuXMbPs63k51MDP=k2BfWEVKR=YU5LXFAA@mail.gmail.com>
Message-ID: <D9E68005B2F84C8AA41BB29546F31959@meetme.com>

Pika 0.9.5 does support this with the Channel.exchange_bind and Channel.exchange.unbind commands.

On Friday, August 10, 2012 at 11:19 AM, Dave Curylo wrote:

> Has anyone got an example of performing exchange to exchange bindings in pika? I'm not sure this extension to AMQP has been implemented. If not, does anyone know of a python module that supports this? 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120810/5616bc24/attachment.htm>

From m.luchak at smartasking.com  Fri Aug 10 16:28:27 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 10 Aug 2012 11:28:27 -0400 (EDT)
Subject: [rabbitmq-discuss] Disbale "#" binding key on an exchange
In-Reply-To: <1344611539.96579337@apps.rackspace.com>
References: <1344611539.96579337@apps.rackspace.com>
Message-ID: <1344612507.933816856@apps.rackspace.com>


err... sorry ... direct exchanges are all about this...
 
-----Original Message-----
From: m.luchak at smartasking.com
Sent: Friday, August 10, 2012 11:12am
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Disbale "#" binding key on an exchange



Hi All,
 
Is there a way (for security reasons) to deny an exchange subscribing with the "#" binding key in an exchange to exchange bind?
 
thanks,
Matthew
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120810/8d576fe4/attachment.htm>

From curylod at asme.org  Fri Aug 10 16:33:24 2012
From: curylod at asme.org (Dave Curylo)
Date: Fri, 10 Aug 2012 11:33:24 -0400
Subject: [rabbitmq-discuss] Exchange to exchange bindings in python
	(pika)
In-Reply-To: <D9E68005B2F84C8AA41BB29546F31959@meetme.com>
References: <CAAqmy6M+J6dwUsdCmuXMbPs63k51MDP=k2BfWEVKR=YU5LXFAA@mail.gmail.com>
	<D9E68005B2F84C8AA41BB29546F31959@meetme.com>
Message-ID: <CAAqmy6MD7DgdHGf9_8MR1fJ=Yybv1aQkR=2=_uKz+R4ePNMWjQ@mail.gmail.com>

Excellent, thanks. It appears the pika documentation at
http://pika.github.com/channel.html is a little out of date and doesn't
show that.

Thanks for your help.

On Fri, Aug 10, 2012 at 11:27 AM, Gavin M. Roy <gmr at meetme.com> wrote:

> Pika 0.9.5 does support this with the Channel.exchange_bind and
> Channel.exchange.unbind commands.
>
> On Friday, August 10, 2012 at 11:19 AM, Dave Curylo wrote:
>
> Has anyone got an example of performing exchange to exchange bindings in
> pika? I'm not sure this extension to AMQP has been implemented. If not,
> does anyone know of a python module that supports this?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120810/2299d701/attachment.htm>

From Ramachandrarao.K at saint-gobain.com  Sat Aug 11 07:14:15 2012
From: Ramachandrarao.K at saint-gobain.com (Ramachandrarao, K [ SGGI - IT ])
Date: Sat, 11 Aug 2012 11:44:15 +0530
Subject: [rabbitmq-discuss] Reg: RabbitMQ
Message-ID: <8A9DF2095351E74AB39CF6BF78F20CC904A77D46@L00EXCEC1.zl.if.atcsg.net>

Hello,

 

We are new to RabbitMQ, and we started installing the RabbitMQ 2.8.4 in
a Windows Server.

 

Actually we are looking the functionalities from RabbitMQ

 

Our Internal Application like .Net Applications, ERP Applications and
Oracle Applications are creating Interface transfer files (*.xml, *.csv,
*.pdf, *.txt)

 

All the interface files should transfer to the respective system (to and
fro)

 

When I go through the RabbitMQ Overview and details, The RabbitMQ does
not Pull any message or file from the Producer and Push to the
Consumer..

 

The Producer Client will send the message to the RabbitMQ Queue and the
consumer Client will retrieve the Message by using the same Queue name.

 

Please provide Information, whether RabbitMQ will pull message or file
from Source System (A) and push the message or file to the Destination
System (B)

 

Requesting any other open source which will do this activity..

 

 

Thanks and Regards

 

Ramachandra Rao K

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120811/457d8894/attachment.htm>

From edward.wax at troppussoftware.com  Fri Aug 10 17:30:53 2012
From: edward.wax at troppussoftware.com (Wax, Edward)
Date: Fri, 10 Aug 2012 16:30:53 +0000
Subject: [rabbitmq-discuss] RabbitMQ failover/recovery
Message-ID: <1C9888BB42C16344B1C280C07DC8D78D03FA2AAC@INWPIEXC01.SATS.CORP>

I?m working with a RabbitMQ HA Cluster and have a question regarding failover/recovery.



RabbitMQ in Action has a section on rethinking code layout to accommodate for RabbitMQ failures.  It uses a standard consumer/producer model.  Does anybody have experience with RabbitMQ failover in an event-driven, asynchronous application.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120810/a362c438/attachment.htm>

From emile at rabbitmq.com  Sat Aug 11 09:40:26 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Sat, 11 Aug 2012 09:40:26 +0100
Subject: [rabbitmq-discuss] Reg: RabbitMQ
In-Reply-To: <8A9DF2095351E74AB39CF6BF78F20CC904A77D46@L00EXCEC1.zl.if.atcsg.net>
References: <8A9DF2095351E74AB39CF6BF78F20CC904A77D46@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <50261A7A.3020705@rabbitmq.com>

Hi,

On 11/08/12 07:14, Ramachandrarao, K [ SGGI - IT ] wrote:
> The Producer Client will send the message to the RabbitMQ Queue and the
> consumer Client will retrieve the Message by using the same Queue name.

The first tutorial explains step-by-step how to set that up:

http://www.rabbitmq.com/tutorials/tutorial-one-java.html

The tutorials have been implemented in a number of languages, including C#:

https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/dotnet

The AMQP model overview should answer many of your questions:

http://www.rabbitmq.com/tutorials/amqp-concepts.html






-Emile


From slickqt at gmail.com  Sun Aug 12 13:01:09 2012
From: slickqt at gmail.com (jun yang)
Date: Sun, 12 Aug 2012 20:01:09 +0800
Subject: [rabbitmq-discuss] rabbitmq web stomp plugin broken in 2.8.5?
Message-ID: <CALkN2oyWBtKQs1=5YUKKejD+PLdcN0ENKfCqaJWPDMCc1Cs3hQ@mail.gmail.com>

it's great that web stomp plugin has been included in 2.8.5. but it
seems broken,it does work with 2.8.2. could someone verify this?

test on win7 with erlang r15b01

-- 
yangjun

From matthias at rabbitmq.com  Sun Aug 12 13:17:55 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 12 Aug 2012 13:17:55 +0100
Subject: [rabbitmq-discuss] rabbitmq web stomp plugin broken in 2.8.5?
In-Reply-To: <CALkN2oyWBtKQs1=5YUKKejD+PLdcN0ENKfCqaJWPDMCc1Cs3hQ@mail.gmail.com>
References: <CALkN2oyWBtKQs1=5YUKKejD+PLdcN0ENKfCqaJWPDMCc1Cs3hQ@mail.gmail.com>
Message-ID: <50279EF3.2010501@rabbitmq.com>

On 12/08/12 13:01, jun yang wrote:
> it's great that web stomp plugin has been included in 2.8.5. but it
> seems broken,it does work with 2.8.2. could someone verify this?

See 
http://rabbitmq.1065348.n5.nabble.com/Having-trouble-with-Web-Stomp-td21290.html

Matthias.

From baishuwei at gmail.com  Sun Aug 12 14:08:58 2012
From: baishuwei at gmail.com (Bai Shuwei)
Date: Sun, 12 Aug 2012 21:08:58 +0800
Subject: [rabbitmq-discuss] how to get consumer number
Message-ID: <CAAKG=-i4ixrem_GGwp2JgN+sSwaGfxuML4mUPXH+JpFOSP9u7g@mail.gmail.com>

Hi, Guys:
    I use the rabbitmq-c now. I send my message to the MyQueue, and i want
how to get the consumers number on the queue, but i cannot find the related
routines. Could somebody to help me to get the consumers number, thanks
very much!

Hawey

-- 
Love other people, as same as love yourself!
Don't think all the time, do it by your hands!

E-Mail: baishuwei at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120812/2d84b81b/attachment.htm>

From baishuwei at gmail.com  Sun Aug 12 14:35:27 2012
From: baishuwei at gmail.com (Bai Shuwei)
Date: Sun, 12 Aug 2012 21:35:27 +0800
Subject: [rabbitmq-discuss] Get the latest consumer read time
Message-ID: <CAAKG=-jBtqAcQzt9hHJbNtgqUyKbpu6iwLRKkcjLp8UHT69iyQ@mail.gmail.com>

Hi, Guys,
       I write a system which write the data to the queue when there are
some consumer(s) listening on it. But i cannot find the routine which can
help me, could somebody can tell me how to check whether there are some
consumer listening on it? Thanks very much!

Best Regards

Hawey

-- 
Love other people, as same as love yourself!
Don't think all the time, do it by your hands!

E-Mail: baishuwei at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120812/36db3eaa/attachment.htm>

From heut2008 at gmail.com  Sun Aug 12 14:47:04 2012
From: heut2008 at gmail.com (heut2008)
Date: Sun, 12 Aug 2012 21:47:04 +0800
Subject: [rabbitmq-discuss] Get the latest consumer read time
In-Reply-To: <CAAKG=-jBtqAcQzt9hHJbNtgqUyKbpu6iwLRKkcjLp8UHT69iyQ@mail.gmail.com>
References: <CAAKG=-jBtqAcQzt9hHJbNtgqUyKbpu6iwLRKkcjLp8UHT69iyQ@mail.gmail.com>
Message-ID: <CAPP2CaWMn=+Ldt42WsUuswQdSoigKsLnxa7U+99616xDt4kYwA@mail.gmail.com>

try  use   rabbitmqctl list_queues name consumer to see consumers for
the  queues.

2012/8/12 Bai Shuwei <baishuwei at gmail.com>:
> Hi, Guys,
>        I write a system which write the data to the queue when there are
> some consumer(s) listening on it. But i cannot find the routine which can
> help me, could somebody can tell me how to check whether there are some
> consumer listening on it? Thanks very much!
>
> Best Regards
>
> Hawey
>
> --
> Love other people, as same as love yourself!
> Don't think all the time, do it by your hands!
>
> E-Mail: baishuwei at gmail.com
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Sun Aug 12 14:53:24 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 12 Aug 2012 14:53:24 +0100
Subject: [rabbitmq-discuss] how to get consumer number
In-Reply-To: <CAAKG=-i4ixrem_GGwp2JgN+sSwaGfxuML4mUPXH+JpFOSP9u7g@mail.gmail.com>
References: <CAAKG=-i4ixrem_GGwp2JgN+sSwaGfxuML4mUPXH+JpFOSP9u7g@mail.gmail.com>
Message-ID: <5027B554.8030804@rabbitmq.com>

On 12/08/12 14:08, Bai Shuwei wrote:
>      I use the rabbitmq-c now. I send my message to the MyQueue, and i
> want how to get the consumers number on the queue, but i cannot find the
> related routines. Could somebody to help me to get the consumers number,
> thanks very much!

The reply to queue.declare contains a consumer-count. See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok. I 
have no idea what the C code for accessing that would look like, but it 
hopefully is pretty obvious.

Matthias.

From baishuwei at gmail.com  Sun Aug 12 15:46:47 2012
From: baishuwei at gmail.com (Bai Shuwei)
Date: Sun, 12 Aug 2012 22:46:47 +0800
Subject: [rabbitmq-discuss] how to get consumer number
In-Reply-To: <5027B554.8030804@rabbitmq.com>
References: <CAAKG=-i4ixrem_GGwp2JgN+sSwaGfxuML4mUPXH+JpFOSP9u7g@mail.gmail.com>
	<5027B554.8030804@rabbitmq.com>
Message-ID: <CAAKG=-gZrvzXKDz0xjf_A+7JCM-+w5StCndvx_K-+Vu0zU77yQ@mail.gmail.com>

I  use the amqp_queue_declare() routine, i can get the message count but
the consumer count is zero all the time. one consumer is reading data in my
test environment. more ideas?

On 12 August 2012 21:53, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 12/08/12 14:08, Bai Shuwei wrote:
>
>>      I use the rabbitmq-c now. I send my message to the MyQueue, and i
>> want how to get the consumers number on the queue, but i cannot find the
>> related routines. Could somebody to help me to get the consumers number,
>> thanks very much!
>>
>
> The reply to queue.declare contains a consumer-count. See
> http://www.rabbitmq.com/amqp-**0-9-1-reference.html#queue.**declare-ok<http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok>.
> I have no idea what the C code for accessing that would look like, but it
> hopefully is pretty obvious.
>
> Matthias.
>



-- 
Love other people, as same as love yourself!
Don't think all the time, do it by your hands!

E-Mail: baishuwei at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120812/bb8fda6e/attachment.htm>

From matthias at rabbitmq.com  Sun Aug 12 17:54:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 12 Aug 2012 17:54:44 +0100
Subject: [rabbitmq-discuss] how to get consumer number
In-Reply-To: <CAAKG=-gZrvzXKDz0xjf_A+7JCM-+w5StCndvx_K-+Vu0zU77yQ@mail.gmail.com>
References: <CAAKG=-i4ixrem_GGwp2JgN+sSwaGfxuML4mUPXH+JpFOSP9u7g@mail.gmail.com>
	<5027B554.8030804@rabbitmq.com>
	<CAAKG=-gZrvzXKDz0xjf_A+7JCM-+w5StCndvx_K-+Vu0zU77yQ@mail.gmail.com>
Message-ID: <5027DFD4.3020003@rabbitmq.com>

On 12/08/12 15:46, Bai Shuwei wrote:
> I  use the amqp_queue_declare() routine, i can get the message count but
> the consumer count is zero all the time. one consumer is reading data in
> my test environment. more ideas?

How is your consumer "reading data"? Using basic.consume or basic.get? 
The latter obviously won't show up as a queue consumer as it's a one-off 
request/response operation.

Also, consumers to which no messages can be sent at present because they 
are blocked (e.g. the client is using basic.qos prefetch and the 
prefetch count has been reached), are excluded.

Matthias.

From liuhaobupt at gmail.com  Mon Aug 13 02:53:31 2012
From: liuhaobupt at gmail.com (Liu Hao)
Date: Mon, 13 Aug 2012 09:53:31 +0800
Subject: [rabbitmq-discuss] The RabbitMQ uses very much memory in the
	cluster pattern
Message-ID: <CAGd7T32_Fz+my6WdAk_SMSNcAD-yQ5gu6yGxxKRo2bU7gOZMvQ@mail.gmail.com>

Hi, all,

      I am a RabbitMQ user in China. When we use in cluster pattern,  we
have found a problem. The problem is that if we use many producers (such as
fifty) to send messages to the same queue ceaselessly and the connection to
the RabbitMQ cluster is not the server which the queue is , the memory
increases very quickly. If we use less producers (such as five) or we use
the connection to the server which the queue is, the memory is the normal.
The consumers have enough power to consume the message. The version of
RabbitMQ is 2.8.1.

      Has  anyone  met the same problem?

      The attachment is the monitor interface.

      Thank all of you very much.

-- 
-------------------------------------------------------------
??
??????????????
??????
????: liuhaobupt at gmail.com
-------------------------------------------------------------
Liu Hao
State Key Laboratory of Networking & Switching Technology
Beijing University of Posts & Telecommunications
Email&Gtalk: liuhaobupt at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/1afa186e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screenshot.png
Type: image/png
Size: 57798 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/1afa186e/attachment.png>

From mark.feeney at gmail.com  Sun Aug 12 20:58:34 2012
From: mark.feeney at gmail.com (Mark Feeney)
Date: Sun, 12 Aug 2012 15:58:34 -0400
Subject: [rabbitmq-discuss] Task queues: use rabbitmq to build one,
	or use rabbitmq AS one
Message-ID: <CAFkgJvmCn901e7pFCMoG4K8kfR2HL65SfLQUKQPa6RmPpZhhSw@mail.gmail.com>

Hi all.  I'm new to rabbit, but have read all the docs and tinkered
around a bit.  So far I am very impressed.

I have a system where we've built a number of custom, postgres-backed
task queues.  We keep adding similar functionality, so I'm evaluating
whether a messaging system might let us drop a bunch of code and get
us a more uniform system and some additional features.

Most of the tasks that get queued are of the "never lose this" variety
(durable everything, persistent messages).  The producers are very
bursty: there may be no work for days, then "suddenly" 10M tasks are
queued and worked through over a period of days.  In this sort of use
case apps treat the broker more like a database: a durable place to
put and get work items.  So... is it wise to plan to use rabbitmq as a
datastore (huge, long-lived, durable queues), or is it better to think
of it strictly as an IPC mechanism (try to keep its queues empty all
the time)?

Hope this question makes some sense.  Thanks,


Mark Feeney

From liuhaobupt at gmail.com  Mon Aug 13 02:45:12 2012
From: liuhaobupt at gmail.com (Liu Hao)
Date: Mon, 13 Aug 2012 09:45:12 +0800
Subject: [rabbitmq-discuss] The RabbitMQ uses very much memory in the
	cluster pattern
Message-ID: <CAGd7T30+SDyu8b8zTXQwEpxsi6JRnZxnjxxJJtp82C_u7j0F+w@mail.gmail.com>

Hi, all,

      I am a RabbitMQ user in China. When we use in cluster pattern,  we
have found a problem. The problem is that if we use many producers (such as
fifty) to send messages to the same queue ceaselessly and the connection to
the RabbitMQ cluster is not the server which the queue is , the memory
increases very quickly. If we use less producers (such as five) or we use
the connection to the server which the queue is, the memory is the normal.
The consumers have enough power to consume the message. The version of
RabbitMQ is 2.8.1.

      Has  anyone  met the same problem?

      The attachment is the monitor interface.

      Thank all of you very much.

-- 
-------------------------------------------------------------
??
??????????????
??????
????: liuhaobupt at gmail.com
-------------------------------------------------------------
Liu Hao
State Key Laboratory of Networking & Switching Technology
Beijing University of Posts & Telecommunications
Email&Gtalk: liuhaobupt at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/83d208c2/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screenshot.png
Type: image/png
Size: 57798 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/83d208c2/attachment.png>

From matthias at rabbitmq.com  Mon Aug 13 08:21:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 13 Aug 2012 08:21:04 +0100
Subject: [rabbitmq-discuss] The RabbitMQ uses very much memory in the
 cluster pattern
In-Reply-To: <CAGd7T32_Fz+my6WdAk_SMSNcAD-yQ5gu6yGxxKRo2bU7gOZMvQ@mail.gmail.com>
References: <CAGd7T32_Fz+my6WdAk_SMSNcAD-yQ5gu6yGxxKRo2bU7gOZMvQ@mail.gmail.com>
Message-ID: <5028AAE0.8030706@rabbitmq.com>

On 13/08/12 02:53, Liu Hao wrote:
>        I am a RabbitMQ user in China. When we use in cluster pattern,
>   we have found a problem. The problem is that if we use many producers
> (such as fifty) to send messages to the same queue ceaselessly and the
> connection to the RabbitMQ cluster is not the server which the queue is
> , the memory increases very quickly. If we use less producers (such as
> five) or we use the connection to the server which the queue is, the
> memory is the normal. The consumers have enough power to consume the
> message. The version of RabbitMQ is 2.8.1.

Please post the output of 'rabbitmqctl report' for all three machines in 
your cluster at the time the memory threshold has been exceeded on the 
queue node.


Matthias.

From lionel.cons at cern.ch  Mon Aug 13 09:46:41 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 13 Aug 2012 10:46:41 +0200
Subject: [rabbitmq-discuss] RabbitMQ Monitoring
Message-ID: <20120813103756.6683.abe10f7e5afbbb3a79ce619739541149@cern.ch>

I'm trying to find a simple way to monitor RabbitMQ usage in terms of number
of messages received and sent. I've looked on [1] at the REST API, the
Nagios Plugin, Alice and the SNMP plugin (which does not seem to exist
anymore on GitHub [2]) and none of these expose this information.

Would it be possible to extend the REST API to expose counters representing
the total number of messages received and sent so that this could be fed
into Nagios or Graphite?

Cheers,

Lionel Cons

[1] http://www.rabbitmq.com/how.html
[2] https://github.com/epicadvertising/rabbitmq_snmp_plugin

From dgillies at brandscreen.com  Mon Aug 13 09:54:11 2012
From: dgillies at brandscreen.com (David Gillies)
Date: Mon, 13 Aug 2012 18:54:11 +1000
Subject: [rabbitmq-discuss] RabbitMQ Monitoring
In-Reply-To: <20120813103756.6683.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120813103756.6683.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <CAO70Nwt3JGqCb9Px_a=xLzvM5kK+s8X3rJ2sx8ep3zLtEMc3dA@mail.gmail.com>

Hi Lionel,

I've used this script to monitor the number of messages in a queue in
nagios just last week:

http://bitkickers.blogspot.com.au/2011/07/checking-rabbitmq-queue-sizeage-with.html

Cheers,
Dave.

On 13 August 2012 18:46, Lionel Cons <lionel.cons at cern.ch> wrote:

> I'm trying to find a simple way to monitor RabbitMQ usage in terms of
> number
> of messages received and sent. I've looked on [1] at the REST API, the
> Nagios Plugin, Alice and the SNMP plugin (which does not seem to exist
> anymore on GitHub [2]) and none of these expose this information.
>
> Would it be possible to extend the REST API to expose counters representing
> the total number of messages received and sent so that this could be fed
> into Nagios or Graphite?
>
> Cheers,
>
> Lionel Cons
>
> [1] http://www.rabbitmq.com/how.html
> [2] https://github.com/epicadvertising/rabbitmq_snmp_plugin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
David Gillies
Senior Systems Engineer, Brandscreen
+61 419 470 716 | dgillies at brandscreen.com

Australia: Level 2, 30 Alfred Street, Milsons Point NSW 2061 Australia
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/df487ae8/attachment.htm>

From brendan at soundcloud.com  Mon Aug 13 10:38:46 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 13 Aug 2012 11:38:46 +0200
Subject: [rabbitmq-discuss] RabbitMQ Monitoring
In-Reply-To: <CAO70Nwt3JGqCb9Px_a=xLzvM5kK+s8X3rJ2sx8ep3zLtEMc3dA@mail.gmail.com>
References: <20120813103756.6683.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAO70Nwt3JGqCb9Px_a=xLzvM5kK+s8X3rJ2sx8ep3zLtEMc3dA@mail.gmail.com>
Message-ID: <CAHZsVQbEvrEy-Azfj92==au_D01k8sEDBrSFs65AAO1v7WWGLQ@mail.gmail.com>

Hi Lionel,

I'm currently in the process of polishing a multi-mode Haskell binary which
communicates metrics to oneof(Ganglia, Graphite, Statsd), and emits Nagios
plugin check output, all from the HTTP API.

You can find it here: https://github.com/brendanhay/gamekeeper

It's under active development and I will be deploying it production for my
own use within a week or two, if you can wait that long for a prebuilt
binary + README.

Regards,
Brendan


On Mon, Aug 13, 2012 at 10:54 AM, David Gillies <dgillies at brandscreen.com>wrote:

> Hi Lionel,
>
> I've used this script to monitor the number of messages in a queue in
> nagios just last week:
>
>
> http://bitkickers.blogspot.com.au/2011/07/checking-rabbitmq-queue-sizeage-with.html
>
> Cheers,
> Dave.
>
>
> On 13 August 2012 18:46, Lionel Cons <lionel.cons at cern.ch> wrote:
>
>> I'm trying to find a simple way to monitor RabbitMQ usage in terms of
>> number
>> of messages received and sent. I've looked on [1] at the REST API, the
>> Nagios Plugin, Alice and the SNMP plugin (which does not seem to exist
>> anymore on GitHub [2]) and none of these expose this information.
>>
>> Would it be possible to extend the REST API to expose counters
>> representing
>> the total number of messages received and sent so that this could be fed
>> into Nagios or Graphite?
>>
>> Cheers,
>>
>> Lionel Cons
>>
>> [1] http://www.rabbitmq.com/how.html
>> [2] https://github.com/epicadvertising/rabbitmq_snmp_plugin
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> David Gillies
> Senior Systems Engineer, Brandscreen
> +61 419 470 716 | dgillies at brandscreen.com
>
> Australia: Level 2, 30 Alfred Street, Milsons Point NSW 2061 Australia
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/10bce052/attachment.htm>

From lionel.cons at cern.ch  Mon Aug 13 12:29:44 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 13 Aug 2012 13:29:44 +0200
Subject: [rabbitmq-discuss] RabbitMQ Monitoring
In-Reply-To: <CAO70Nwt3JGqCb9Px_a=xLzvM5kK+s8X3rJ2sx8ep3zLtEMc3dA@mail.gmail.com>
	(David Gillies's message of "Mon, 13 Aug 2012 18:54:11 +1000")
References: <20120813103756.6683.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAO70Nwt3JGqCb9Px_a=xLzvM5kK+s8X3rJ2sx8ep3zLtEMc3dA@mail.gmail.com>
Message-ID: <bw7393ruj13.fsf@mail.cern.ch>

David Gillies <dgillies at brandscreen.com> writes:
> I've used this script to monitor the number of messages in a queue in nagios just last week:
> http://bitkickers.blogspot.com.au/2011/07/checking-rabbitmq-queue-sizeage-with.html

Thanks for the pointer.

The monitoring information being mostly present, the main questions are:

Would it be possible to get an absolute counter rather than a rate and
let the monitoring application (Nagios, Graphite...) decide on how
frequently to probe the broker?

Would it be possible to get the number of received/sent messages by the
broker without enabling fine grain statistics that, according to the
doc, have a significant performance impact? After all, total numbers per
broker are not really fine grain ;-)

Cheers,

Lionel

From lionel.cons at cern.ch  Mon Aug 13 12:32:58 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 13 Aug 2012 13:32:58 +0200
Subject: [rabbitmq-discuss] RabbitMQ Monitoring
In-Reply-To: <CAHZsVQbEvrEy-Azfj92==au_D01k8sEDBrSFs65AAO1v7WWGLQ@mail.gmail.com>
	(Brendan Hay's message of "Mon, 13 Aug 2012 11:38:46 +0200")
References: <20120813103756.6683.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAO70Nwt3JGqCb9Px_a=xLzvM5kK+s8X3rJ2sx8ep3zLtEMc3dA@mail.gmail.com>
	<CAHZsVQbEvrEy-Azfj92==au_D01k8sEDBrSFs65AAO1v7WWGLQ@mail.gmail.com>
Message-ID: <bw7y5ljt4b9.fsf@mail.cern.ch>

Brendan Hay <brendan at soundcloud.com> writes:
> I'm currently in the process of polishing a multi-mode Haskell binary
> which communicates metrics to oneof(Ganglia, Graphite, Statsd), and
> emits Nagios plugin check output, all from the HTTP API.
>
> You can find it here: https://github.com/brendanhay/gamekeeper
>
> It's under active development and I will be deploying it production
> for my own use within a week or two, if you can wait that long for a
> prebuilt binary + README.

Thanks.

I'll keep an eye on it...

Cheers,

Lionel

From emile at rabbitmq.com  Mon Aug 13 12:53:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 13 Aug 2012 12:53:17 +0100
Subject: [rabbitmq-discuss] Task queues: use rabbitmq to build one,
 or use rabbitmq AS one
In-Reply-To: <CAFkgJvmCn901e7pFCMoG4K8kfR2HL65SfLQUKQPa6RmPpZhhSw@mail.gmail.com>
References: <CAFkgJvmCn901e7pFCMoG4K8kfR2HL65SfLQUKQPa6RmPpZhhSw@mail.gmail.com>
Message-ID: <5028EAAD.40805@rabbitmq.com>

Hi Mark,

On 12/08/12 20:58, Mark Feeney wrote:
> So... is it wise to plan to use rabbitmq as a
> datastore (huge, long-lived, durable queues), or is it better to think
> of it strictly as an IPC mechanism (try to keep its queues empty all
> the time)?

If you find yourself performing SELECT queries on the messages, and
their order is less important then consider using a relational database
instead.

If not all messages are routed in an identical way, or you find yourself
writing lots of database trigger code then I would suggest using a
message broker. RabbitMQ can cope with long persistent queues, with
messages of variable sizes.

If performance is a consideration then you should run some benchmarks
for your expected workload.

-Emile

From tonygarnockjones+rabbitmq at gmail.com  Mon Aug 13 13:00:16 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 13 Aug 2012 08:00:16 -0400
Subject: [rabbitmq-discuss] Task queues: use rabbitmq to build one,
 or use rabbitmq AS one
In-Reply-To: <CAFkgJvmCn901e7pFCMoG4K8kfR2HL65SfLQUKQPa6RmPpZhhSw@mail.gmail.com>
References: <CAFkgJvmCn901e7pFCMoG4K8kfR2HL65SfLQUKQPa6RmPpZhhSw@mail.gmail.com>
Message-ID: <CAM8fPiRgpSxYZZJb9WBpwOp9CL_Nk085PGNV6zLOSbOnOSODWw@mail.gmail.com>

Hi Mark,

On 12 August 2012 15:58, Mark Feeney <mark.feeney at gmail.com> wrote:

> Most of the tasks that get queued are of the "never lose this" variety
> (durable everything, persistent messages).
>

Emile has already given some sensible advice, and since you've been writing
your own database-backed pseudoqueues you probably have a pretty good
handle on this anyway, but in case it helps I wrote a little on options for
task queueing (for the special case of "transactional" tasks, but most of
the ideas generalise) using RabbitMQ last year:
http://www.eighty-twenty.org/index.cgi/tech/rabbitmq/tasks-within-transactions-20111218.html

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/aee786ba/attachment.htm>

From list2012 at lunch.za.net  Mon Aug 13 13:08:09 2012
From: list2012 at lunch.za.net (Andrew McGill)
Date: Mon, 13 Aug 2012 14:08:09 +0200
Subject: [rabbitmq-discuss] Timeout for hung connection on rabbitmq server?
Message-ID: <20120813140809.290f73f6@beans.lunch.za.net>

Hi rabbitmq list folks,

I have a rabbitmq client on a dynamic IP address.  This client connects to a rabbitmq server, and the connection is in ESTABLISHED state.  Some time later, the IP address of the client changes (without prior notice to the client), and the client makes a new connection to the rabbitmq server.  The trouble is that messages for the queue are sent to the OLD IP address, which is pretty much a black hole.  As far as the rabbitmq server is concerned nothing has occurred to indicate that the connection is down.  This situation seems to persist for quite a long time (at least 20 minutes) until some kind of timeout happens on the server.  

 * Is there a way to set the timeout value for a failed keepalive (assuming keepalive packets are in fact being sent... I see the default tcp timeout for Linux is two hours + 11 minutes, which is not quite what I need.)

 * Alternatively, is there something in this configuration which will stop keepalive from noticing that a connection has died?  (e.g. something to do with the SSL connection parameters?) 

 * Even more alternatively, is there some way that the newest client connection can identify itself as the best and most suitable instance of itself when it makes the new connection?  

If it makes any difference, the client software is AMQPlib for PHP, using SSL.

The server rabbitmq config says:

[
  {rabbit, [
    {tcp_listeners,[]},
    {tcp_listen_options, [binary,
                     {packet, raw},
                     {reuseaddr, true},
                     {backlog, 128},
                     {nodelay, true},
                     {exit_on_close, false},
                     {keepalive, true}]},
    {ssl_listeners,[5671]},
    {ssl_options, [{cacertfile,"/etc/rabbitmq/ca.crt"},
                    {certfile,"/etc/rabbitmq/rmq.crt"},
                    {keyfile,"/etc/rabbitmq/rmq.rsakey"},
                    {verify,verify_peer},
                    {keepalive, true},
                    {fail_if_no_peer_cert,true}]}
  ]}
].

&:-)

From kristen.stewart at stonybrook.edu  Mon Aug 13 13:52:46 2012
From: kristen.stewart at stonybrook.edu (Kristen Stewart)
Date: Mon, 13 Aug 2012 08:52:46 -0400
Subject: [rabbitmq-discuss] Using ldap when connecting to management
	plugin
In-Reply-To: <5022798A.7010107@rabbitmq.com>
References: <CAB_hqn9se7Ho9fJ+_TxYR6Dp=pZxQyv94+jpaC7GVDVyDwRHDw@mail.gmail.com>
	<5022798A.7010107@rabbitmq.com>
Message-ID: <CAB_hqn9VfwBijtj7DsAkVo9Ev2uM-_9QTirmG8JFwU5VVQF+jg@mail.gmail.com>

Thanks for the response. I think I'm going to have to use the internal
database, but I'll definitely keep an eye out for the fix.
Kristen

On Wed, Aug 8, 2012 at 10:36 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 01/08/12 19:45, Kristen Stewart wrote:
>
>> This is the error returned from the management UI:
>>
>> {error,
>>      {exit,
>>          {{{case_clause,
>>                {badrpc,
>>                    {'EXIT',
>>                        {as_user_no_password,
>>                            {gen_server,call,
>>                                [rabbit_auth_backend_ldap,
>>                                 {login,<<"knstewart">>},
>>
>
> Ah. Thanks for the report.
>
> So it seems that there is an incompatibility between the AMQP direct
> client and the LDAP plugin's {other_bind, as_user} mode. This will affect
> bits of the management plugin and some other plugins (STOMP for example).
>
> This is especially noticeable since {other_bind, as_user} is the default
> since 2.8.0.
>
> If it's acceptable to you, you can work around this by setting
> {other_bind, anon} or {other_bind, {"username", "password"}} under
> rabbitmq_auth_backend_ldap in your configuration file.
>
> For an explanation of other_bind, see:
>
> http://hg.rabbitmq.com/**rabbitmq-auth-backend-ldap/**
> file/d76afaf44415/README#l100<http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/d76afaf44415/README#l100>
>
> A fix for this will appear in a future release.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/5ea2fd16/attachment.htm>

From bobinbc at gmail.com  Mon Aug 13 14:09:10 2012
From: bobinbc at gmail.com (Bobin B. Cherian)
Date: Mon, 13 Aug 2012 18:39:10 +0530
Subject: [rabbitmq-discuss] Queue Message Count in C#
Message-ID: <CAOS6sjos_H1PaV262LOfJzmdi0-o6xam7dKU8dJ5a5XqtMJanQ@mail.gmail.com>

I wanted to be able to see what the queue's message count was, in my
application itself. I'm working on C#. Right now, the only way I see to do
this is through the management link, but wanted to incorporate the count
into my application. Is there anything in the API to do this?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/2d983dba/attachment.htm>

From emile at rabbitmq.com  Mon Aug 13 14:32:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 13 Aug 2012 14:32:35 +0100
Subject: [rabbitmq-discuss] Queue Message Count in C#
In-Reply-To: <CAOS6sjos_H1PaV262LOfJzmdi0-o6xam7dKU8dJ5a5XqtMJanQ@mail.gmail.com>
References: <CAOS6sjos_H1PaV262LOfJzmdi0-o6xam7dKU8dJ5a5XqtMJanQ@mail.gmail.com>
Message-ID: <502901F3.2050705@rabbitmq.com>

Hi Bobin,

On 13/08/12 14:09, Bobin B. Cherian wrote:
> I wanted to be able to see what the queue's message count was, in my
> application itself. I'm working on C#. Right now, the only way I see to
> do this is through the management link, but wanted to incorporate the
> count into my application. Is there anything in the API to do this?

In theory any of the methods that bear a message-count parameter could
be used. Searching the spec page for "message-count" that string will
produce a few results:
http://www.rabbitmq.com/amqp-0-9-1-reference.html

Passively declaring the queue and referencing the MessageCount field in
the QueueDeclareOk class is probably the simplest method. If you use
synchronous message retrieval then this information can also be found in
BasicGetResult.


-Emile


From stephen.t.young at gmail.com  Mon Aug 13 14:40:53 2012
From: stephen.t.young at gmail.com (Stephen Young)
Date: Mon, 13 Aug 2012 06:40:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Weird unicode error popping up in pika 0.9.6
Message-ID: <8469f196-e9e4-48d1-823c-9c792d04daae@googlegroups.com>

Hi there,

I've been using version 0.9,6 pika in a stable environment for about a 
month and am suddenly encountering a unicode error that looks like:

Traceback (most recent call last):
  File 
"/devel/lib/python2.7/site-packages/Twisted-12.0.0-py2.7-macosx-10.7-x86_64.egg/twisted/internet/selectreactor.py", 
line 150, in _doReadOrWrite
    why = getattr(selectable, method)()
  File 
"/devel/lib/python2.7/site-packages/Twisted-12.0.0-py2.7-macosx-10.7-x86_64.egg/twisted/internet/tcp.py", 
line 199, in doRead
    rval = self.protocol.dataReceived(data)
  File "/devel/src/pika/pika/adapters/twisted_connection.py", line 378, in 
dataReceived
    self._on_data_available(data)
  File "/devel/src/pika/pika/connection.py", line 701, in _on_data_available
    frame)                 # Args
  File "/devel/src/pika/pika/callback.py", line 161, in process
    callback(*args, **keywords)
  File "/devel/src/pika/pika/channel.py", line 152, in 
_on_synchronous_complete
    self.rpc(*method)
  File "/devel/src/pika/pika/channel.py", line 114, in rpc
    self.send_method(method)
  File "/devel/src/pika/pika/channel.py", line 121, in send_method
    self.connection._send_method(self.channel_number, method, content)
  File "/devel/src/pika/pika/connection.py", line 781, in _send_method
    self._send_frame(pika.frame.Method(channel_number, method))
  File "/devel/src/pika/pika/adapters/twisted_connection.py", line 355, in 
_send_frame
    marshalled_frame = frame.marshal()
  File "/devel/src/pika/pika/frame.py", line 65, in marshal
    return self._marshal(pieces)
  File "/devel/src/pika/pika/frame.py", line 40, in _marshal
    len(payload)) + payload + chr(spec.FRAME_END)
exceptions.UnicodeDecodeError: 'ascii' codec can't decode byte 0xce in 
position 0: ordinal not in range(128)


I'm using the twisted adapter, and I have a hunch that the problem is 
coming from there somewhere, but I'm pretty lost as far as what to do to 
fix this bug. Anyone have any ideas?

Cheers,
Stephen 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/ff68ee76/attachment.htm>

From stephen.t.young at gmail.com  Mon Aug 13 14:46:05 2012
From: stephen.t.young at gmail.com (Stephen Young)
Date: Mon, 13 Aug 2012 06:46:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Wrapping pika callbacks, why ?
In-Reply-To: <09ce0f5e-cb1a-4580-a9ce-68724604c987@googlegroups.com>
References: <09ce0f5e-cb1a-4580-a9ce-68724604c987@googlegroups.com>
Message-ID: <550b623e-e09a-409d-999e-a8961f6bc735@googlegroups.com>

On Monday, August 6, 2012 10:29:00 AM UTC-4, Rapha?l De Giusti wrote:
>
> Hi everyone,
>
> I'm interested in running pika's IOLoop in a thread and I came across this 
> code sample : 
> http://cms02.phys.ntu.edu.tw/tracs/env/browser/trunk/messaging/pika/mon.py
>
> I was wondering why and what could be the advantages of wrapping the 
> callbacks in methods (I can understand the on_exchange_declared() method 
> that returns a different callback according to thread's name) ?
>

 Advantages would be allowing the class to have direct access to the 
connection object, and being able to add custom functionality to the 
callbacks as needed - for example, passing custom headers when declaring 
exchanges and queues (if you want to use some of the other awesome RabbitMQ 
features like high availability, ttl, dead letter exchanges)
 

> Another question is why considering multiprocessing over threading in this 
> case ?
>

Multiprocessing is a way of getting around the GIL, which can make your 
application actually act in parallel. Threaded python cannot actually 
execute concurrent threads.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/8690b7ca/attachment.htm>

From gmr at meetme.com  Mon Aug 13 15:41:24 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Mon, 13 Aug 2012 10:41:24 -0400
Subject: [rabbitmq-discuss] Weird unicode error popping up in pika 0.9.6
In-Reply-To: <8469f196-e9e4-48d1-823c-9c792d04daae@googlegroups.com>
References: <8469f196-e9e4-48d1-823c-9c792d04daae@googlegroups.com>
Message-ID: <CAKwdTWe6kwT=fgraPw+1j9T2RvGJ1qcSBM-aNYYiNDwykpnWOw@mail.gmail.com>

Please open a bug on the github repo: https://github.com/pika/pika.

It's worth noting 0.9.6 is not released, is not stable and I am currently
writing tests against 0.9.5 to vet 0.9.6 since there are so many different
patches to it that are not covered by existing tests.

On Mon, Aug 13, 2012 at 9:40 AM, Stephen Young <stephen.t.young at gmail.com>wrote:

> Hi there,
>
> I've been using version 0.9,6 pika in a stable environment for about a
> month and am suddenly encountering a unicode error that looks like:
>
> Traceback (most recent call last):
>   File
> "/devel/lib/python2.7/site-packages/Twisted-12.0.0-py2.7-macosx-10.7-x86_64.egg/twisted/internet/selectreactor.py",
> line 150, in _doReadOrWrite
>     why = getattr(selectable, method)()
>   File
> "/devel/lib/python2.7/site-packages/Twisted-12.0.0-py2.7-macosx-10.7-x86_64.egg/twisted/internet/tcp.py",
> line 199, in doRead
>     rval = self.protocol.dataReceived(data)
>   File "/devel/src/pika/pika/adapters/twisted_connection.py", line 378, in
> dataReceived
>     self._on_data_available(data)
>   File "/devel/src/pika/pika/connection.py", line 701, in
> _on_data_available
>     frame)                 # Args
>   File "/devel/src/pika/pika/callback.py", line 161, in process
>     callback(*args, **keywords)
>   File "/devel/src/pika/pika/channel.py", line 152, in
> _on_synchronous_complete
>     self.rpc(*method)
>   File "/devel/src/pika/pika/channel.py", line 114, in rpc
>     self.send_method(method)
>   File "/devel/src/pika/pika/channel.py", line 121, in send_method
>     self.connection._send_method(self.channel_number, method, content)
>   File "/devel/src/pika/pika/connection.py", line 781, in _send_method
>     self._send_frame(pika.frame.Method(channel_number, method))
>   File "/devel/src/pika/pika/adapters/twisted_connection.py", line 355, in
> _send_frame
>     marshalled_frame = frame.marshal()
>   File "/devel/src/pika/pika/frame.py", line 65, in marshal
>     return self._marshal(pieces)
>   File "/devel/src/pika/pika/frame.py", line 40, in _marshal
>     len(payload)) + payload + chr(spec.FRAME_END)
> exceptions.UnicodeDecodeError: 'ascii' codec can't decode byte 0xce in
> position 0: ordinal not in range(128)
>
>
> I'm using the twisted adapter, and I have a hunch that the problem is
> coming from there somewhere, but I'm pretty lost as far as what to do to
> fix this bug. Anyone have any ideas?
>
> Cheers,
> Stephen
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/a8e9bd69/attachment.htm>

From stephen.t.young at gmail.com  Mon Aug 13 16:22:17 2012
From: stephen.t.young at gmail.com (Stephen Young)
Date: Mon, 13 Aug 2012 08:22:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Weird unicode error popping up in pika 0.9.6
In-Reply-To: <8469f196-e9e4-48d1-823c-9c792d04daae@googlegroups.com>
References: <8469f196-e9e4-48d1-823c-9c792d04daae@googlegroups.com>
Message-ID: <c5e9ccf1-fdcc-4106-837f-09045044a757@googlegroups.com>

Update: was because my queue name and routing key were unicode strings - 
pulled the latest commit to pika which now checks for that, helped me 
debug. Looks like everything has to be a bytestring in order for the 
_marshal function to generate a valid payload, otherwise python tries to 
encode everything into unicode

On Monday, August 13, 2012 9:40:53 AM UTC-4, Stephen Young wrote:
>
> Hi there,
>
> I've been using version 0.9,6 pika in a stable environment for about a 
> month and am suddenly encountering a unicode error that looks like:
>
> Traceback (most recent call last):
>   File 
> "/devel/lib/python2.7/site-packages/Twisted-12.0.0-py2.7-macosx-10.7-x86_64.egg/twisted/internet/selectreactor.py", 
> line 150, in _doReadOrWrite
>     why = getattr(selectable, method)()
>   File 
> "/devel/lib/python2.7/site-packages/Twisted-12.0.0-py2.7-macosx-10.7-x86_64.egg/twisted/internet/tcp.py", 
> line 199, in doRead
>     rval = self.protocol.dataReceived(data)
>   File "/devel/src/pika/pika/adapters/twisted_connection.py", line 378, in 
> dataReceived
>     self._on_data_available(data)
>   File "/devel/src/pika/pika/connection.py", line 701, in 
> _on_data_available
>     frame)                 # Args
>   File "/devel/src/pika/pika/callback.py", line 161, in process
>     callback(*args, **keywords)
>   File "/devel/src/pika/pika/channel.py", line 152, in 
> _on_synchronous_complete
>     self.rpc(*method)
>   File "/devel/src/pika/pika/channel.py", line 114, in rpc
>     self.send_method(method)
>   File "/devel/src/pika/pika/channel.py", line 121, in send_method
>     self.connection._send_method(self.channel_number, method, content)
>   File "/devel/src/pika/pika/connection.py", line 781, in _send_method
>     self._send_frame(pika.frame.Method(channel_number, method))
>   File "/devel/src/pika/pika/adapters/twisted_connection.py", line 355, in 
> _send_frame
>     marshalled_frame = frame.marshal()
>   File "/devel/src/pika/pika/frame.py", line 65, in marshal
>     return self._marshal(pieces)
>   File "/devel/src/pika/pika/frame.py", line 40, in _marshal
>     len(payload)) + payload + chr(spec.FRAME_END)
> exceptions.UnicodeDecodeError: 'ascii' codec can't decode byte 0xce in 
> position 0: ordinal not in range(128)
>
>
> I'm using the twisted adapter, and I have a hunch that the problem is 
> coming from there somewhere, but I'm pretty lost as far as what to do to 
> fix this bug. Anyone have any ideas?
>
> Cheers,
> Stephen 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/b5fbba8b/attachment.htm>

From francesco at rabbitmq.com  Mon Aug 13 16:50:45 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 13 Aug 2012 16:50:45 +0100
Subject: [rabbitmq-discuss] Timeout for hung connection on rabbitmq
	server?
In-Reply-To: <20120813140809.290f73f6@beans.lunch.za.net>
References: <20120813140809.290f73f6@beans.lunch.za.net>
Message-ID: <87fw7qpz8q.wl%francesco@rabbitmq.com>

Hi Andrew,

At Mon, 13 Aug 2012 14:08:09 +0200,
Andrew McGill wrote:
>  * Is there a way to set the timeout value for a failed keepalive (assuming
>    keepalive packets are in fact being sent... I see the default tcp timeout
>    for Linux is two hours + 11 minutes, which is not quite what I need.)

Rabbit does not do anything to enable/disable TCP keepalives or change the
default values (also because per-socket tuning is not simple in everything but
Linux).  You can enable them via `tcp_listen_options', as you're correctly
doing.  To tune the keepalive parameters you must change them system-wide (see
http://www.tldp.org/HOWTO/html_single/TCP-Keepalive-HOWTO/ for some guidance).

However, AMQP itself provides a simpler solution to your problem: heartbeats -
see the `tune-ok' frame
<http://www.rabbitmq.com/amqp-0-9-1-reference.html#connection.tune-ok>.  On most
clients the heartbeats will be configurable when opening an AMQP connection.

>  * Alternatively, is there something in this configuration which will stop
>    keepalive from noticing that a connection has died?  (e.g. something to do
>    with the SSL connection parameters?)

Not that I can see.

>  * Even more alternatively, is there some way that the newest client
>    connection can identify itself as the best and most suitable instance of
>    itself when it makes the new connection?

It's not entirely clear to me what you mean here, but I'm reading it as
permitting connection to identify themselves as current incarnations of
previous, dead connections.  In that case, the answer is no.

--
Francesco * Often in error, never in doubt

From zilvinas.saltys at gmail.com  Mon Aug 13 17:23:50 2012
From: zilvinas.saltys at gmail.com (=?UTF-8?B?xb1pbHZpbmFzIMWgYWx0eXM=?=)
Date: Mon, 13 Aug 2012 17:23:50 +0100
Subject: [rabbitmq-discuss] highly available shovel in a cluster
Message-ID: <CAC3L7FehHJ7Y3S4MzKZayv-TJTzsRaQLigBGM0GzKNgx_nrw_w@mail.gmail.com>

Hi,

We have a cluster made of two nodes with 1 HA queue that has a shovel
on the master node that shovels messages to itself from another
RabbitMQ broker over WAN. The problem is if the master node goes down
the shovel plugin needs to become active on the slave and to keep
shoveling. How to solve this problem?

One way I see is to have the shovel active on both nodes. But due to
how rabbitmq cluster works the shovel on the slave node would just
forward everything to the master node which would replicate back to
the slave. This seems inefficient because of unnecessary connections
made by the slave when only the master node needs to be doing the
shoveling.

Another way is to monitor both slave/master nodes externally if one
goes down then switch the config with the right shovel config and
restart the broker service.

Has anyone dealt with this before or knows of an easy way to solve it?
Thanks

From francesco at rabbitmq.com  Mon Aug 13 17:57:04 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 13 Aug 2012 17:57:04 +0100
Subject: [rabbitmq-discuss] highly available shovel in a cluster
In-Reply-To: <CAC3L7FehHJ7Y3S4MzKZayv-TJTzsRaQLigBGM0GzKNgx_nrw_w@mail.gmail.com>
References: <CAC3L7FehHJ7Y3S4MzKZayv-TJTzsRaQLigBGM0GzKNgx_nrw_w@mail.gmail.com>
Message-ID: <87ehnapw67.wl%francesco@rabbitmq.com>

Hi ?ilvinas,

At Mon, 13 Aug 2012 17:23:50 +0100,
?ilvinas ?altys wrote:
> We have a cluster made of two nodes with 1 HA queue that has a shovel on the
> master node that shovels messages to itself from another RabbitMQ broker over
> WAN. The problem is if the master node goes down the shovel plugin needs to
> become active on the slave and to keep shoveling. How to solve this problem?

You can simply specify all the nodes in the cluster in the brokers list.  When a
node the shovel is consuming from goes down, shovel will try to reconnect to a
node at random, and hopefully will eventually connect to an online node.

--
Francesco * Often in error, never in doubt

From mark.feeney at gmail.com  Mon Aug 13 22:38:44 2012
From: mark.feeney at gmail.com (Mark Feeney)
Date: Mon, 13 Aug 2012 17:38:44 -0400
Subject: [rabbitmq-discuss] Task queues: use rabbitmq to build one,
 or use rabbitmq AS one
In-Reply-To: <5028EAAD.40805@rabbitmq.com>
References: <CAFkgJvmCn901e7pFCMoG4K8kfR2HL65SfLQUKQPa6RmPpZhhSw@mail.gmail.com>
	<5028EAAD.40805@rabbitmq.com>
Message-ID: <CAFkgJvnXZVu7kQBUpUS6QzQz=vB97f3UYwB6CiUUopR0ZqjTjw@mail.gmail.com>

Hi, Emile.

Thanks for the response!

> If you find yourself performing SELECT queries on the messages, and
> their order is less important then consider using a relational database
> instead.

I do have some fairly tricky SELECT statements to get the next item
form my current queue system, so this is a good point.

> If not all messages are routed in an identical way, or you find yourself
> writing lots of database trigger code then I would suggest using a
> message broker. RabbitMQ can cope with long persistent queues, with
> messages of variable sizes.

This sounds like another good guideline.  Right now I don't really
have any message routing on the ingress side of my ad-hoc queue
system.  The SELECT statement that gets the next message ends up doing
some fiddly logic to get the "correct" message out, and this can cause
issues, esp. with larger queues.  I'm considering routing messages to
the correct queue when they first arrive, so rabbit seems like a good
fit for this sort of thing.

> If performance is a consideration then you should run some benchmarks
> for your expected workload.

Of course.  Thanks again for your response, I'm getting a clearer
picture of how I might use rabbitmq.


Mark.

From jerryk at rbcon.com  Tue Aug 14 00:19:47 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Mon, 13 Aug 2012 16:19:47 -0700
Subject: [rabbitmq-discuss] Task queues: use rabbitmq to build one,
 or use rabbitmq AS one
In-Reply-To: <CAFkgJvnXZVu7kQBUpUS6QzQz=vB97f3UYwB6CiUUopR0ZqjTjw@mail.gmail.com>
References: <CAFkgJvmCn901e7pFCMoG4K8kfR2HL65SfLQUKQPa6RmPpZhhSw@mail.gmail.com>
	<5028EAAD.40805@rabbitmq.com>
	<CAFkgJvnXZVu7kQBUpUS6QzQz=vB97f3UYwB6CiUUopR0ZqjTjw@mail.gmail.com>
Message-ID: <CAE0Sz=wXv0Q1zJBGjsCX96rXi=rPkDku-C-3YO7Lwn1RYd0ZWQ@mail.gmail.com>

As general background to the conversation, the following summarizes some
nice anti-patterns in the area:

http://www.engineyard.com/blog/2011/5-subtle-ways-youre-using-mysql-as-a-queue-and-why-itll-bite-you/

These are good things to watch out for, since they almost spontaneously
self organize in a lot of systems we've seen. :-)

Best regards,
Jerry

On Mon, Aug 13, 2012 at 2:38 PM, Mark Feeney <mark.feeney at gmail.com> wrote:

> Hi, Emile.
>
> Thanks for the response!
>
> > If you find yourself performing SELECT queries on the messages, and
> > their order is less important then consider using a relational database
> > instead.
>
> I do have some fairly tricky SELECT statements to get the next item
> form my current queue system, so this is a good point.
>
> > If not all messages are routed in an identical way, or you find yourself
> > writing lots of database trigger code then I would suggest using a
> > message broker. RabbitMQ can cope with long persistent queues, with
> > messages of variable sizes.
>
> This sounds like another good guideline.  Right now I don't really
> have any message routing on the ingress side of my ad-hoc queue
> system.  The SELECT statement that gets the next message ends up doing
> some fiddly logic to get the "correct" message out, and this can cause
> issues, esp. with larger queues.  I'm considering routing messages to
> the correct queue when they first arrive, so rabbit seems like a good
> fit for this sort of thing.
>
> > If performance is a consideration then you should run some benchmarks
> > for your expected workload.
>
> Of course.  Thanks again for your response, I'm getting a clearer
> picture of how I might use rabbitmq.
>
>
> Mark.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/5da49f8d/attachment.htm>

From mpietrek at skytap.com  Tue Aug 14 01:25:42 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 13 Aug 2012 17:25:42 -0700
Subject: [rabbitmq-discuss] Queue disappears during high volume federation
Message-ID: <CACLE7iwUNu37g-7hTL-OY3-L1WK-7zrKnZK0H6XvhJvn1C6ixA@mail.gmail.com>

I'm hitting an issue where a queue disappears from underneath me in a high
volume federated scenario.

Background: I'm on RabbitMQ 2.8.5 on top of Ubuntu 10.04.

I have three brokers bi-directionally federated similarly to the "Small
complete Graph" example in http://www.rabbitmq.com/federation.html. My
exchange is called "Skytap", and is a topic exchange. One of the routing
key 'words' directs messages to the appropriate broker.

In my example, I have a single master sending "requests" to two slaves
which reply back to the master, simulating an RPC scenario. A client app on
the 'master' broker reads from an exclusive queue called 'master", while
client apps on the slave brokers read from an exclusive queue called
"slave'.

In the low volume case, everything works as expected: A steady stream of
request messages seen on the slaves and a steady stream of reply messages
seen on the master.

However, if I write "request" messages as fast as possible, in short order
I see the 'master' queue disappear. (I know this because I have mnesia
logging turned on.)

Here's the mnesia trace from the master client app startup:

--------
Mnesia(rabbit at mq1): write performed by {tid,16820,<0.154.0>} on record:
    {rabbit_queue,{resource,<<"/">>,queue,<<"master">>},
                      false,false,<0.3392.0>,[],<0.3398.0>,[],undefined}
Mnesia(rabbit at mq1): write performed by {tid,16820,<0.154.0>} on record:
    {rabbit_route,{binding,{resource,<<"/">>,exchange,<<>>},
                               <<"master">>,
                               {resource,<<"/">>,queue,<<"master">>},
                               []},
                      const}
Mnesia(rabbit at mq1): write performed by {tid,16820,<0.154.0>} on record:
    {rabbit_reverse_route,
            {reverse_binding,
                {resource,<<"/">>,queue,<<"master">>},
                <<"master">>,
                {resource,<<"/">>,exchange,<<>>},
                []},
            const}

Mnesia(rabbit at mq1): write performed by {tid,16821,<0.153.0>} on record:
    {rabbit_topic_trie_node,
            {trie_node,
                {resource,<<"/">>,exchange,<<"skytap">>},

<<167,162,233,102,38,77,235,139,202,148,84,98,202,70,145,209>>},
            0,3}
Mnesia(rabbit at mq1): write performed by {tid,16821,<0.153.0>} on record:
    {rabbit_exchange_serial,{resource,<<"/">>,exchange,<<"skytap">>},16}
Mnesia(rabbit at mq1): write performed by {tid,16821,<0.153.0>} on record:
    {rabbit_reverse_route,
            {reverse_binding,
                {resource,<<"/">>,queue,<<"master">>},
                <<"master.mgt">>,
                {resource,<<"/">>,exchange,<<"skytap">>},
                []},
            const}
Mnesia(rabbit at mq1): write performed by {tid,16821,<0.153.0>} on record:
    {rabbit_topic_trie_binding,
            {trie_binding,
                {resource,<<"/">>,exchange,<<"skytap">>},

<<167,162,233,102,38,77,235,139,202,148,84,98,202,70,145,209>>,
                {resource,<<"/">>,queue,<<"master">>}},
            const}
Mnesia(rabbit at mq1): write performed by {tid,16821,<0.153.0>} on record:
    {rabbit_route,{binding,{resource,<<"/">>,exchange,<<"skytap">>},
                               <<"master.mgt">>,
                               {resource,<<"/">>,queue,<<"master">>},
                               []},
                      const}
--------


And then some time later, after a bunch of successful requests/replies, I
get this:

--------
Mnesia(rabbit at mq1): write performed by {tid,16822,<0.154.0>} on record:
    {rabbit_topic_trie_node,
            {trie_node,
                {resource,<<"/">>,exchange,<<"skytap">>},

<<167,162,233,102,38,77,235,139,202,148,84,98,202,70,145,209>>},
            0,2}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_semi_durable_route,
            {binding,
                {resource,<<"/">>,exchange,<<>>},
                <<"master">>,
                {resource,<<"/">>,queue,<<"master">>},
                []},
            const}
Mnesia(rabbit at mq1): write performed by {tid,16822,<0.154.0>} on record:
    {rabbit_exchange_serial,{resource,<<"/">>,exchange,<<"skytap">>},17}
Mnesia(rabbit at mq1): delete performed by {tid,16822,<0.154.0>} on record:
    {rabbit_queue,{resource,<<"/">>,queue,<<"master">>}}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_reverse_route,
            {reverse_binding,
                {resource,<<"/">>,queue,<<"master">>},
                <<"master.mgt">>,
                {resource,<<"/">>,exchange,<<"skytap">>},
                []},
            const}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_topic_trie_binding,
            {trie_binding,
                {resource,<<"/">>,exchange,<<"skytap">>},

<<167,162,233,102,38,77,235,139,202,148,84,98,202,70,145,209>>,
                {resource,<<"/">>,queue,<<"master">>}},
            const}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_semi_durable_route,
            {binding,
                {resource,<<"/">>,exchange,<<"skytap">>},
                <<"master.mgt">>,
                {resource,<<"/">>,queue,<<"master">>},
                []},
            const}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_route,{binding,{resource,<<"/">>,exchange,<<>>},
                               <<"master">>,
                               {resource,<<"/">>,queue,<<"master">>},
                               []},
                      const}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_route,{binding,{resource,<<"/">>,exchange,<<"skytap">>},
                               <<"master.mgt">>,
                               {resource,<<"/">>,queue,<<"master">>},
                               []},
                      const}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_reverse_route,
            {reverse_binding,
                {resource,<<"/">>,queue,<<"master">>},
                <<"master">>,
                {resource,<<"/">>,exchange,<<>>},
                []},
            const}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_durable_route,
            {binding,
                {resource,<<"/">>,exchange,<<"skytap">>},
                <<"master.mgt">>,
                {resource,<<"/">>,queue,<<"master">>},
                []},
            const}
Mnesia(rabbit at mq1): delete_object performed by {tid,16822,<0.154.0>} on
record:
    {rabbit_durable_route,
            {binding,
                {resource,<<"/">>,exchange,<<>>},
                <<"master">>,
                {resource,<<"/">>,queue,<<"master">>},
                []},
            const}
Mnesia(rabbit at mq1): delete performed by {tid,16822,<0.154.0>} on record:
    {rabbit_durable_queue,{resource,<<"/">>,queue,<<"master">>}}
--------

The rabbit at mq1.log file shows nothing of any interest. Just the expected
AMQP connection accepting/closing.

Anything else useful I can provide?

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/bf2e6449/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 14 05:12:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Aug 2012 05:12:56 +0100
Subject: [rabbitmq-discuss] The RabbitMQ uses very much memory in the
 cluster pattern
In-Reply-To: <CAGd7T32FW24UMU6gZc0_n5-Dy14fOO-RPd3gkr43dAcp=S=q3A@mail.gmail.com>
References: <CAGd7T32_Fz+my6WdAk_SMSNcAD-yQ5gu6yGxxKRo2bU7gOZMvQ@mail.gmail.com>
	<5028AAE0.8030706@rabbitmq.com>
	<CAGd7T32FW24UMU6gZc0_n5-Dy14fOO-RPd3gkr43dAcp=S=q3A@mail.gmail.com>
Message-ID: <5029D048.5010704@rabbitmq.com>

On 14/08/12 03:40, Liu Hao wrote:
>       The destination queue's name is "mqclient_test_queue_1" and it is 
> on the cnbj-cuc-tst01-crl0015 node.
> 
>       The rabbitmqctl report output of cnbj-cuc-tst01-crl0015 node is 
> "cnbj-cuc-tst01-crl0015" attachment, the other two are similar.

Ah, I completely forgot that 'report' reports on all nodes. Sorry.

There are about 1100 connections and 8400 channels. Are those the
numbers you expect to see?

How big are the messages?

Please run the following on crl0015 when it is using lots of memory:

rabbitmqctl eval 'begin {L, Pid} =
lists:last(lists:sort([{length(element(2, process_info(P, binary))), P}
|| P <- processes()])), {L, Pid, process_info(Pid)} end.'

(all on one line) and post the output.


Regards,

Matthias.


From charles.law at openx.com  Tue Aug 14 06:16:18 2012
From: charles.law at openx.com (Charles Law)
Date: Mon, 13 Aug 2012 22:16:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Is there a pika bug with the prefetch?
Message-ID: <691d0de4-8e46-49d5-9e71-bce9b01af5a8@googlegroups.com>

I have a Python client that consumes from a set of queues with no_ack set 
to False.  I assumed that doing this would mean that single consumer would 
receive only 1 message until the consumer returned an acknowledgment.  By 
receive a message I mean my callback would be called.

I recently was testing support for messages that tell the consumer to 
declare additional queues.  I planned on doing this by acknowledging the 
original message after I ran my queue_declare and queue_bind calls.  While 
testing, I noticed that the on_message_receive callback function was 
receiving other messages *before* my consumer finished the declares/binds, 
and *before* I acknowledged the original message.  Is this how Rabbit is 
supposed to work?  Or is this a Pika bug?

When I set prefetch_count to 1, everything works how I expect.  I assumed 
with the default prefetch_count, or even a prefetch count > 1, that the 
client would receive messages, but should hold onto them until the 
acknowledgement for the original message goes out.  Is this correct?
Thanks,
Charles
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/e68482c6/attachment.htm>

From abarringer at gmail.com  Tue Aug 14 06:16:21 2012
From: abarringer at gmail.com (Andrew Barringer)
Date: Tue, 14 Aug 2012 00:16:21 -0500
Subject: [rabbitmq-discuss] Application Architecture Question (topic routing
	+ fanout broadcasting)?
Message-ID: <CA+CC+HN_9oL=zV8K0Whe=Y5aP5MBXf4iCKv4E=XQ5PniHwWauQ@mail.gmail.com>

All,

I'm new to Queuing so please be patient.

I'm trying to build an app to support the following scenario.

We have a database with keys like

state.zipcode.itemtype.details  as new items are entered we want all
subscribers to get the data.

A person can subscribe using wildcards(# or *) in any of the positions.

For instance given the following data entry keys

ny.12345.vehicles.cars
ny.12346.boats.jetskies
tn.37775.vehicles.trucks

We want many subscribers to have the ability to create a filters like
ny.#.cars to get all cars in NY. Or  they may want to say  #.jetskies or
ny.*.boats.# etc etc.. anyways end users need the ability to create complex
filters.

The hard part is with a topic exchange/queue only one subscriber is going
to get an item when it hits the exchange/queue. I really need a combination
of topic + fanout.

Can I create the exchange as a topic and route it to another fanout
exchange where the end user is a queue?  Does the ruby amqp gem support
exchange to exchange bindings?

Did any of that even make sense?  :D

Any help would be appreciated.

Thanks,
Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/311f568b/attachment.htm>

From Ryan at nutcracker.co.za  Tue Aug 14 06:45:05 2012
From: Ryan at nutcracker.co.za (Ryan Gunn)
Date: Tue, 14 Aug 2012 05:45:05 +0000
Subject: [rabbitmq-discuss] RabbitMQ - Service Crash
Message-ID: <A33D44D3C6F1D54AA679F7A3B0995E23237BA566@Nutdc.Nutcracker.local>

Good Day,

I've recently had a problem where the RabbitMQ service had stopped running. We are running RabbitMQ v2.8.2 and ErLang R15B on a Windows Server 2008 machine. I've attached below a snippet from the RabbitMQ log file as well as the windows event viewer and hope that someone can point me in the right direction. I don't know if the attached log file snippets have enough data to located the problem but any help would be much appreciated.

Thank You

Ryan Gunn



-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Crash_Report.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/188c0ea1/attachment.txt>

From liuhaobupt at gmail.com  Tue Aug 14 07:14:34 2012
From: liuhaobupt at gmail.com (Liu Hao)
Date: Tue, 14 Aug 2012 14:14:34 +0800
Subject: [rabbitmq-discuss] The RabbitMQ uses very much memory in the
 cluster pattern
In-Reply-To: <5029D048.5010704@rabbitmq.com>
References: <CAGd7T32_Fz+my6WdAk_SMSNcAD-yQ5gu6yGxxKRo2bU7gOZMvQ@mail.gmail.com>
	<5028AAE0.8030706@rabbitmq.com>
	<CAGd7T32FW24UMU6gZc0_n5-Dy14fOO-RPd3gkr43dAcp=S=q3A@mail.gmail.com>
	<5029D048.5010704@rabbitmq.com>
Message-ID: <CAGd7T31=zMWuPEpbYcdKtvH3VTqZv3Gq+WhoGa9+9S-H5pDF4w@mail.gmail.com>

Hi, Matthias,

     The connections and channels are actually too much. I decrease the
connections and channels. Now, I have 40 consumer connections (one
connection with one channel), and 50 producer connections (one connection
with 10 channels). The memory is the same , acquires a lot.

     But I find an interesting fact that If I use 50 producer connections
(one connection with only one channel) , the memory will be under 2G, but
the most connections are flowed and the publish rate is too slow.

     This is just a test demo, and one message is 10KB.

     The command report is so big(35M), and I give the beginning and the
end of the output to you as the attachment.

     Thank you very much.

2012/8/14 Matthias Radestock <matthias at rabbitmq.com>

> On 14/08/12 03:40, Liu Hao wrote:
> >       The destination queue's name is "mqclient_test_queue_1" and it is
> > on the cnbj-cuc-tst01-crl0015 node.
> >
> >       The rabbitmqctl report output of cnbj-cuc-tst01-crl0015 node is
> > "cnbj-cuc-tst01-crl0015" attachment, the other two are similar.
>
> Ah, I completely forgot that 'report' reports on all nodes. Sorry.
>
> There are about 1100 connections and 8400 channels. Are those the
> numbers you expect to see?
>
> How big are the messages?
>
> Please run the following on crl0015 when it is using lots of memory:
>
> rabbitmqctl eval 'begin {L, Pid} =
> lists:last(lists:sort([{length(element(2, process_info(P, binary))), P}
> || P <- processes()])), {L, Pid, process_info(Pid)} end.'
>
> (all on one line) and post the output.
>
>
> Regards,
>
> Matthias.
>
>


-- 
-------------------------------------------------------------
??
??????????????
??????
????: liuhaobupt at gmail.com
-------------------------------------------------------------
Liu Hao
State Key Laboratory of Networking & Switching Technology
Beijing University of Posts & Telecommunications
Email&Gtalk: liuhaobupt at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/9e826e7f/attachment.htm>
-------------- next part --------------
{239682,<4957.12911.0>,
 [{current_function,{gen,do_call,4}},
  {initial_call,{proc_lib,init_p,5}},
  {status,waiting},
  {message_queue_len,360},
  {messages,
      [{'$gen_cast',
           {deliver,
               {delivery,false,false,<5764.13952.0>,
                   {basic_message,
                       {resource,<<"/mqclient_test">>,exchange,
                           <<"mqclient_test_exchange">>},
                       [<<"mqclient_test_queue_1">>],
                       {content,60,
                           {'P_basic',undefined,undefined,undefined,2,
                               undefined,undefined,undefined,undefined,
                               undefined,undefined,undefined,undefined,
                               undefined,undefined},
                           <<16,0,2>>,
                           rabbit_framing_amqp_0_9_1,
                           [<<"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">>]},
                       <<153,48,157,168,137,243,43,9,165,132,42,8,238,118,239,
                         144>>,
                       true},
                   undefined},
               flow}},

......

  {dictionary,
      [{{ch_publisher,<5764.8461.0>},#Ref<4957.0.72.35567>},
       {{ch_publisher,<5764.8548.0>},#Ref<4957.0.72.35277>},
       {{ch_publisher,<5764.7410.0>},#Ref<4957.0.72.33795>},
       {{credit_to,<5764.7560.0>},29},
       {{ch_publisher,<5764.8392.0>},#Ref<4957.0.72.35152>},
       {{credit_to,<5764.7478.0>},30},
       {{credit_to,<5764.9471.0>},45},
       {{credit_to,<5764.8346.0>},32},
       {{ch,<5764.7101.0>},
        {cr,<5764.7101.0>,#Ref<4957.0.72.33652>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7096.0>,true},
            false,7}},
       {{ch_publisher,<5764.8111.0>},#Ref<4957.0.72.35273>},
       {{ch_publisher,<5764.8131.0>},#Ref<4957.0.72.34972>},
       {{credit_to,<5764.8741.0>},32},
       {{credit_to,<5764.9390.0>},47},
       {{credit_to,<5764.9383.0>},40},
       {{credit_to,<5764.8388.0>},29},
       {{ch_publisher,<5764.7872.0>},#Ref<4957.0.72.34930>},
       {{ch_publisher,<5764.7869.0>},#Ref<4957.0.72.35053>},
       {{ch_publisher,<5764.8187.0>},#Ref<4957.0.72.34876>},
       {{credit_to,<5764.7681.0>},26},
       {{ch_publisher,<5764.8744.0>},#Ref<4957.0.72.35830>},
       {{credit_to,<5764.8759.0>},31},
       {{ch_publisher,<5764.8875.0>},#Ref<4957.0.72.35860>},
       {{ch_publisher,<5764.8394.0>},#Ref<4957.0.72.35353>},
       {{ch_publisher,<5764.8614.0>},#Ref<4957.0.72.35137>},
       {{ch_publisher,<5764.8757.0>},#Ref<4957.0.72.35515>},
       {{credit_to,<5764.8090.0>},33},
       {{ch_publisher,<5764.7937.0>},#Ref<4957.0.72.35312>},
       {{ch_publisher,<5764.9227.0>},#Ref<4957.0.72.37196>},
       {{ch_publisher,<5764.9139.0>},#Ref<4957.0.72.36125>},
       {{ch_publisher,<5764.9035.0>},#Ref<4957.0.72.35517>},
       {{credit_to,<5764.7673.0>},26},
       {{credit_to,<5764.8725.0>},35},
       {{credit_to,<5764.9147.0>},43},
       {{ch_publisher,<5764.9491.0>},#Ref<4957.0.72.40300>},
       {{credit_to,<5764.9195.0>},43},
       {{credit_to,<5764.8603.0>},29},
       {{ch_publisher,<5764.9335.0>},#Ref<4957.0.72.40234>},
       {{credit_to,<5764.9399.0>},44},
       {{ch_publisher,<5764.7583.0>},#Ref<4957.0.72.34789>},
       {{ch_publisher,<5764.8514.0>},#Ref<4957.0.72.35076>},
       {{credit_to,<5764.9567.0>},47},
       {{credit_to,<5764.8427.0>},40},
       {{ch,<5764.6861.0>},
        {cr,<5764.6861.0>,#Ref<4957.0.72.33596>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6860.0>,true},
            false,8}},
       {{credit_to,<5764.8085.0>},33},
       {{ch_publisher,<5764.9114.0>},#Ref<4957.0.72.36174>},
       {{credit_to,<5764.8138.0>},42},
       {{credit_to,<5764.8405.0>},32},
       {{credit_to,<5764.8981.0>},45},
       {{credit_to,<5764.7758.0>},31},
       {{credit_to,<5764.8491.0>},31},
       {{ch_publisher,<5764.8985.0>},#Ref<4957.0.72.35504>},
       {{ch_publisher,<5764.8655.0>},#Ref<4957.0.72.35487>},
       {{ch_publisher,<5764.7561.0>},#Ref<4957.0.72.34672>},
       {{ch_publisher,<5764.7485.0>},#Ref<4957.0.72.33908>},
       {{credit_to,<5764.8339.0>},29},
       {{credit_to,<5764.8108.0>},45},
       {{credit_to,<5764.9114.0>},34},
       {{ch_publisher,<5764.9191.0>},#Ref<4957.0.72.36081>},
       {{ch_publisher,<5764.8261.0>},#Ref<4957.0.72.34992>},
       {{ch_publisher,<5764.9467.0>},#Ref<4957.0.72.40252>},
       {{ch_publisher,<5764.9539.0>},#Ref<4957.0.72.40204>},
       {{ch_publisher,<5764.8121.0>},#Ref<4957.0.72.34866>},
       {{credit_to,<5764.8098.0>},32},
       {{ch_publisher,<5764.8788.0>},#Ref<4957.0.72.35485>},
       {{credit_to,<5764.7781.0>},34},
       {{credit_to,<5764.9075.0>},31},
       {{ch_publisher,<5764.8654.0>},#Ref<4957.0.72.35538>},
       {{credit_to,<5764.8001.0>},30},
       {{ch_publisher,<5764.8773.0>},#Ref<4957.0.72.35548>},
       {{ch_publisher,<5764.7502.0>},#Ref<4957.0.72.33945>},
       {{credit_to,<5764.7397.0>},27},
       {{credit_to,<5764.9354.0>},44},
       {{credit_to,<5764.8874.0>},35},
       {{credit_to,<5764.8022.0>},31},
       {{credit_to,<5764.8854.0>},28},
       {{credit_to,<5764.8818.0>},42},
       {{credit_to,<5764.9544.0>},45},
       {{ch_publisher,<5764.7939.0>},#Ref<4957.0.72.34815>},
       {{credit_to,<5764.9467.0>},44},
       {{ch_publisher,<5764.8741.0>},#Ref<4957.0.72.35579>},
       {{credit_to,<5764.8622.0>},42},
       {{credit_to,<5764.8020.0>},32},
       {{ch_publisher,<5764.8615.0>},#Ref<4957.0.72.37107>},
       {{credit_to,<5764.8426.0>},35},
       {{credit_to,<5764.9495.0>},50},
       {{ch_publisher,<5764.8858.0>},#Ref<4957.0.72.35856>},
       {{credit_to,<5764.8961.0>},35},
       {{ch_publisher,<5764.7480.0>},#Ref<4957.0.72.33854>},
       {{ch_publisher,<5764.7478.0>},#Ref<4957.0.72.33925>},
       {{credit_to,<5764.8119.0>},39},
       {{ch_publisher,<5764.8341.0>},#Ref<4957.0.72.35142>},
       {{credit_to,<5764.9123.0>},34},
       {{credit_to,<5764.8111.0>},36},
       {{credit_to,<5764.7704.0>},29},
       {{credit_to,<5764.8651.0>},33},
       {{ch_publisher,<5764.9459.0>},#Ref<4957.0.72.39055>},
       {{ch_publisher,<5764.8933.0>},#Ref<4957.0.72.35525>},
       {'$initial_call',{gen,init_it,6}},
       {{ch_publisher,<5764.9487.0>},#Ref<4957.0.72.38934>},
       {{credit_to,<5764.8733.0>},45},
       {{ch_publisher,<5764.8753.0>},#Ref<4957.0.72.35842>},
       {{credit_to,<5764.7389.0>},29},
       {{credit_to,<5764.9491.0>},45},
       {{credit_to,<5764.8952.0>},40},
       {{ch_publisher,<5764.7589.0>},#Ref<4957.0.72.34802>},
       {{credit_to,<5764.8034.0>},25},
       {{ch,<5764.6845.0>},
        {cr,<5764.6845.0>,#Ref<4957.0.72.33592>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6843.0>,true},
            false,8}},
       {{ch,<5764.7006.0>},
        {cr,<5764.7006.0>,#Ref<4957.0.72.33632>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6998.0>,true},
            false,7}},
       {{credit_to,<5764.9231.0>},32},
       {{credit_to,<5764.8464.0>},33},
       {{ch_publisher,<5764.8994.0>},#Ref<4957.0.72.35506>},
       {{ch_publisher,<5764.7389.0>},#Ref<4957.0.72.33789>},
       {{credit_to,<5764.7949.0>},31},
       {{credit_to,<5764.7815.0>},41},
       {{credit_to,<5764.8654.0>},29},
       {{ch,<5764.7038.0>},
        {cr,<5764.7038.0>,#Ref<4957.0.72.33640>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7036.0>,true},
            false,7}},
       {{credit_to,<5764.7617.0>},30},
       {{ch_publisher,<5764.8934.0>},#Ref<4957.0.72.35314>},
       {{ch_publisher,<5764.9355.0>},#Ref<4957.0.72.40216>},
       {{ch_publisher,<5764.8289.0>},#Ref<4957.0.72.35330>},
       {{ch_publisher,<5764.8462.0>},#Ref<4957.0.72.35317>},
       {{credit_to,<5764.7601.0>},33},
       {{ch_publisher,<5764.9434.0>},#Ref<4957.0.72.38514>},
       {{ch_publisher,<5764.9419.0>},#Ref<4957.0.72.40317>},
       {{ch_publisher,<5764.9159.0>},#Ref<4957.0.72.36187>},
       {{ch_publisher,<5764.9075.0>},#Ref<4957.0.72.36016>},
       {{credit_to,<5764.7616.0>},35},
       {{credit_to,<5764.8877.0>},40},
       {{credit_to,<5764.8715.0>},45},
       {{credit_to,<5764.8626.0>},34},
       {{credit_to,<5764.7453.0>},29},
       {{ch_publisher,<5764.8956.0>},#Ref<4957.0.72.35850>},
       {{credit_to,<5764.7867.0>},33},
       {{ch_publisher,<5764.8626.0>},#Ref<4957.0.72.35577>},
       {{ch_publisher,<5764.9195.0>},#Ref<4957.0.72.37205>},
       {{credit_to,<5764.8512.0>},30},
       {{credit_to,<5764.8994.0>},35},
       {{ch_publisher,<5764.8756.0>},#Ref<4957.0.72.35804>},
       {{ch_publisher,<5764.8784.0>},#Ref<4957.0.72.35546>},
       {{credit_to,<5764.9427.0>},50},
       {{ch,<5764.6913.0>},
        {cr,<5764.6913.0>,#Ref<4957.0.72.33606>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6910.0>,true},
            false,8}},
       {{credit_to,<5764.8612.0>},29},
       {{credit_to,<5764.8655.0>},42},
       {{ch_publisher,<5764.9199.0>},#Ref<4957.0.72.37087>},
       {{credit_to,<5764.8865.0>},29},
       {{ch_publisher,<5764.7414.0>},#Ref<4957.0.72.33793>},
       {{credit_to,<5764.9203.0>},34},
       {{credit_to,<5764.9271.0>},30},
       {{credit_to,<5764.8951.0>},46},
       {{credit_to,<5764.7461.0>},25},
       {{credit_to,<5764.8866.0>},33},
       {{ch_publisher,<5764.7429.0>},#Ref<4957.0.72.33825>},
       {{credit_to,<5764.8169.0>},31},
       {{ch_publisher,<5764.8592.0>},#Ref<4957.0.72.35744>},
       {{credit_to,<5764.9359.0>},41},
       {{credit_to,<5764.7985.0>},33},
       {{credit_to,<5764.9115.0>},31},
       {{ch_publisher,<5764.8288.0>},#Ref<4957.0.72.34939>},
       {{credit_to,<5764.7938.0>},32},
       {{credit_to,<5764.7946.0>},41},
       {{ch_publisher,<5764.8868.0>},#Ref<4957.0.72.35291>},
       {{ch_publisher,<5764.9367.0>},#Ref<4957.0.72.38886>},
       {{credit_to,<5764.7379.0>},25},
       {{credit_to,<5764.7868.0>},32},
       {{ch_publisher,<5764.7456.0>},#Ref<4957.0.72.33862>},
       {{credit_to,<5764.8600.0>},33},
       {{ch_publisher,<5764.8623.0>},#Ref<4957.0.72.35184>},
       {{credit_to,<5764.7377.0>},29},
       {{credit_to,<5764.9339.0>},41},
       {{credit_to,<5764.9211.0>},33},
       {{ch_publisher,<5764.8134.0>},#Ref<4957.0.72.34918>},
       {{ch,<5764.7092.0>},
        {cr,<5764.7092.0>,#Ref<4957.0.72.33654>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7091.0>,true},
            false,7}},
       {{ch_publisher,<5764.7455.0>},#Ref<4957.0.72.33893>},
       {{ch_publisher,<5764.8712.0>},#Ref<4957.0.72.35294>},
       {{credit_to,<5764.7369.0>},29},
       {{credit_to,<5764.8935.0>},41},
       {{ch_publisher,<5764.7767.0>},#Ref<4957.0.72.34706>},
       {{credit_to,<5764.9139.0>},43},
       {{ch_publisher,<5764.9043.0>},#Ref<4957.0.72.35854>},
       {{credit_to,<5764.9155.0>},32},
       {{ch_publisher,<5764.7685.0>},#Ref<4957.0.72.34733>},
       {{ch_publisher,<5764.8846.0>},#Ref<4957.0.72.35862>},
       {{credit_to,<5764.7875.0>},30},
       {{ch_publisher,<5764.8721.0>},#Ref<4957.0.72.35527>},
       {{ch_publisher,<5764.8120.0>},#Ref<4957.0.72.35091>},
       {{ch_publisher,<5764.8339.0>},#Ref<4957.0.72.35168>},
       {{credit_to,<5764.9522.0>},45},
       {{ch_publisher,<5764.7991.0>},#Ref<4957.0.72.35063>},
       {{credit_to,<5764.8121.0>},34},
       {{credit_to,<5764.8972.0>},46},
       {{credit_to,<5764.8039.0>},31},
       {{ch_publisher,<5764.7461.0>},#Ref<4957.0.72.33882>},
       {{ch_publisher,<5764.8874.0>},#Ref<4957.0.72.35319>},
       {{credit_to,<5764.8602.0>},28},
       {{ch_publisher,<5764.9155.0>},#Ref<4957.0.72.36177>},
       {{ch_publisher,<5764.9050.0>},#Ref<4957.0.72.37190>},
       {{credit_to,<5764.7765.0>},26},
       {{ch_publisher,<5764.9203.0>},#Ref<4957.0.72.37148>},
       {{ch_publisher,<5764.7815.0>},#Ref<4957.0.72.34880>},
       {{ch_publisher,<5764.8633.0>},#Ref<4957.0.72.35832>},
       {{credit_to,<5764.7944.0>},28},
       {{credit_to,<5764.8023.0>},29},
       {{credit_to,<5764.9079.0>},31},
       {{credit_to,<5764.8490.0>},35},
       {{ch,<5764.7075.0>},
        {cr,<5764.7075.0>,#Ref<4957.0.72.33648>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7072.0>,true},
            false,7}},
       {{ch_publisher,<5764.7770.0>},#Ref<4957.0.72.34752>},
       {{ch_publisher,<5764.7479.0>},#Ref<4957.0.72.33901>},
       {{ch_publisher,<5764.8129.0>},#Ref<4957.0.72.35139>},
       {{credit_to,<5764.7881.0>},35},
       {{ch_publisher,<5764.8877.0>},#Ref<4957.0.72.35582>},
       {{credit_to,<5764.8442.0>},33},
       {{credit_to,<5764.8110.0>},30},
       {{credit_to,<5764.7735.0>},31},
       {{credit_to,<5764.9523.0>},50},
       {{ch_publisher,<5764.8348.0>},#Ref<4957.0.72.35256>},
       {{credit_to,<5764.9414.0>},45},
       {{ch_publisher,<5764.8017.0>},#Ref<4957.0.72.35147>},
       {{credit_to,<5764.8234.0>},42},
       {{credit_to,<5764.9179.0>},35},
       {{ch_publisher,<5764.9119.0>},#Ref<4957.0.72.35885>},
       {{credit_to,<5764.7583.0>},30},
       {{ch_publisher,<5764.9366.0>},#Ref<4957.0.72.38984>},
       {{ch_publisher,<5764.8951.0>},#Ref<4957.0.72.35787>},
       {{ch_publisher,<5764.7681.0>},#Ref<4957.0.72.34074>},
       {{credit_to,<5764.7609.0>},34},
       {{ch_publisher,<5764.8447.0>},#Ref<4957.0.72.35513>},
       {{ch_publisher,<5764.8973.0>},#Ref<4957.0.72.36023>},
       {{credit_to,<5764.8536.0>},38},
       {{ch,<5764.6963.0>},
        {cr,<5764.6963.0>,#Ref<4957.0.72.33612>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6955.0>,true},
            false,8}},
       {{ch_publisher,<5764.9059.0>},#Ref<4957.0.72.35710>},
       {{ch_publisher,<5764.8863.0>},#Ref<4957.0.72.35482>},
       {{credit_to,<5764.8723.0>},42},
       {{ch_publisher,<5764.8930.0>},#Ref<4957.0.72.35872>},
       {{credit_to,<5764.8344.0>},29},
       {{credit_to,<5764.9499.0>},45},
       {{credit_to,<5764.8780.0>},40},
       {{ch_publisher,<5764.9171.0>},#Ref<4957.0.72.36171>},
       {{ch_publisher,<5764.8613.0>},#Ref<4957.0.72.35879>},
       {{ch_publisher,<5764.7992.0>},#Ref<4957.0.72.34868>},
       {{credit_to,<5764.8755.0>},35},
       {{credit_to,<5764.8184.0>},26},
       {{ch_publisher,<5764.9187.0>},#Ref<4957.0.72.36134>},
       {{ch_publisher,<5764.9000.0>},#Ref<4957.0.72.35519>},
       {{ch_publisher,<5764.8755.0>},#Ref<4957.0.72.35558>},
       {{credit_to,<5764.8349.0>},33},
       {{ch_publisher,<5764.7808.0>},#Ref<4957.0.72.34878>},
       {{ch_publisher,<5764.8272.0>},#Ref<4957.0.72.35102>},
       {{credit_to,<5764.8613.0>},32},
       {{credit_to,<5764.8876.0>},45},
       {{credit_to,<5764.7433.0>},32},
       {{ch_publisher,<5764.9391.0>},#Ref<4957.0.72.39025>},
       {{credit_to,<5764.8223.0>},35},
       {{credit_to,<5764.8130.0>},33},
       {{ch_publisher,<5764.8503.0>},#Ref<4957.0.72.35057>},
       {{ch_publisher,<5764.9544.0>},#Ref<4957.0.72.40278>},
       {{credit_to,<5764.9143.0>},43},
       {{credit_to,<5764.7414.0>},27},
       {{credit_to,<5764.8534.0>},33},
       {{ch_publisher,<5764.9511.0>},#Ref<4957.0.72.40297>},
       {{credit_to,<5764.7942.0>},32},
       {{ch_publisher,<5764.8349.0>},#Ref<4957.0.72.35265>},
       {{ch_publisher,<5764.7511.0>},#Ref<4957.0.72.33951>},
       {{credit_to,<5764.9366.0>},47},
       {{ch_publisher,<5764.8612.0>},#Ref<4957.0.72.35154>},
       {{ch_publisher,<5764.9458.0>},#Ref<4957.0.72.38990>},
       {{credit_to,<5764.9367.0>},45},
       {{ch_publisher,<5764.9567.0>},#Ref<4957.0.72.40307>},
       {{ch_publisher,<5764.7629.0>},#Ref<4957.0.72.35769>},
       {{ch_publisher,<5764.9102.0>},#Ref<4957.0.72.36088>},
       {{credit_to,<5764.8347.0>},33},
       {{ch_publisher,<5764.8439.0>},#Ref<4957.0.72.37163>},
       {{credit_to,<5764.9275.0>},31},
       {{ch_publisher,<5764.8865.0>},#Ref<4957.0.72.35469>},
       {{ch_publisher,<5764.8818.0>},#Ref<4957.0.72.35877>},
       {{credit_to,<5764.8327.0>},33},
       {{ch_publisher,<5764.8397.0>},#Ref<4957.0.72.35275>},
       {{ch_publisher,<5764.8656.0>},#Ref<4957.0.72.35867>},
       {{ch_publisher,<5764.9535.0>},#Ref<4957.0.72.40222>},
       {{credit_to,<5764.9001.0>},39},
       {{ch_publisher,<5764.9346.0>},#Ref<4957.0.72.38904>},
       {{ch_publisher,<5764.7655.0>},#Ref<4957.0.72.33939>},
       {{ch_publisher,<5764.9167.0>},#Ref<4957.0.72.36169>},
       {{credit_to,<5764.8966.0>},35},
       {{ch,<5764.7125.0>},
        {cr,<5764.7125.0>,#Ref<4957.0.72.33662>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7124.0>,true},
            false,7}},
       {{ch,<5764.7064.0>},
        {cr,<5764.7064.0>,#Ref<4957.0.72.33646>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7062.0>,true},
            false,7}},
       {{credit_to,<5764.8393.0>},38},
       {{ch_publisher,<5764.7433.0>},#Ref<4957.0.72.33809>},
       {{ch_publisher,<5764.8440.0>},#Ref<4957.0.72.35036>},
       {{ch_publisher,<5764.9151.0>},#Ref<4957.0.72.36051>},
       {{credit_to,<5764.7525.0>},29},
       {{credit_to,<5764.9549.0>},1},
       {{credit_to,<5764.9403.0>},50},
       {{ch_publisher,<5764.7934.0>},#Ref<4957.0.72.34949>},
       {{ch,<5764.6964.0>},
        {cr,<5764.6964.0>,#Ref<4957.0.72.33620>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6947.0>,true},
            false,8}},
       {{credit_to,<5764.8224.0>},29},
       {{ch_publisher,<5764.8005.0>},#Ref<4957.0.72.34912>},
       {{ch_publisher,<5764.7765.0>},#Ref<4957.0.72.34932>},
       {{credit_to,<5764.8129.0>},32},
       {{credit_to,<5764.8394.0>},35},
       {{credit_to,<5764.7947.0>},29},
       {{credit_to,<5764.8631.0>},29},
       {{ch_publisher,<5764.8745.0>},#Ref<4957.0.72.35683>},
       {{ch_publisher,<5764.8469.0>},#Ref<4957.0.72.35341>},
       {{credit_to,<5764.9515.0>},44},
       {{ch_publisher,<5764.8223.0>},#Ref<4957.0.72.35074>},
       {{ch_publisher,<5764.8183.0>},#Ref<4957.0.72.35339>},
       {{credit_to,<5764.9071.0>},31},
       {{ch_publisher,<5764.9475.0>},#Ref<4957.0.72.40324>},
       {{credit_to,<5764.9239.0>},38},
       {{ch_publisher,<5764.8260.0>},#Ref<4957.0.72.37168>},
       {{credit_to,<5764.8752.0>},33},
       {{credit_to,<5764.8957.0>},28},
       {{ch_publisher,<5764.7517.0>},#Ref<4957.0.72.33931>},
       {{credit_to,<5764.8398.0>},34},
       {{credit_to,<5764.8864.0>},30},
       {{credit_to,<5764.7365.0>},28},
       {{credit_to,<5764.8400.0>},42},
       {{ch_publisher,<5764.8393.0>},#Ref<4957.0.72.35177>},
       {{ch_publisher,<5764.9165.0>},#Ref<4957.0.72.36144>},
       {{ch_publisher,<5764.7734.0>},#Ref<4957.0.72.34079>},
       {{credit_to,<5764.8904.0>},34},
       {{credit_to,<5764.8103.0>},41},
       {{credit_to,<5764.7629.0>},33},
       {{ch_publisher,<5764.9107.0>},#Ref<4957.0.72.35563>},
       {{credit_to,<5764.9183.0>},45},
       {{credit_to,<5764.8095.0>},34},
       {{credit_to,<5764.8537.0>},30},
       {{ch_publisher,<5764.8789.0>},#Ref<4957.0.72.35706>},
       {{credit_to,<5764.7717.0>},32},
       {{credit_to,<5764.9559.0>},47},
       {{credit_to,<5764.7511.0>},33},
       {{ch_publisher,<5764.7706.0>},#Ref<4957.0.72.33985>},
       {{credit_to,<5764.9391.0>},45},
       {{ch,<5764.7111.0>},
        {cr,<5764.7111.0>,#Ref<4957.0.72.33658>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7109.0>,true},
            false,7}},
       {{credit_to,<5764.9379.0>},50},
       {{ch_publisher,<5764.8957.0>},#Ref<4957.0.72.35776>},
       {{credit_to,<5764.7766.0>},32},
       {{credit_to,<5764.8856.0>},35},
       {{credit_to,<5764.8132.0>},29},
       {{ch_publisher,<5764.9398.0>},#Ref<4957.0.72.40284>},
       {{credit_to,<5764.7874.0>},29},
       {{ch_publisher,<5764.7536.0>},#Ref<4957.0.72.34010>},
       {{credit_to,<5764.8518.0>},42},
       {{ch_publisher,<5764.8116.0>},#Ref<4957.0.72.35088>},
       {{ch_publisher,<5764.8224.0>},#Ref<4957.0.72.35098>},
       {{credit_to,<5764.8260.0>},41},
       {{ch_publisher,<5764.8813.0>},#Ref<4957.0.72.35812>},
       {{credit_to,<5764.8784.0>},34},
       {{ch_publisher,<5764.8534.0>},#Ref<4957.0.72.35441>},
       {{ch_publisher,<5764.9447.0>},#Ref<4957.0.72.38972>},
       {{credit_to,<5764.8440.0>},28},
       {{ch_publisher,<5764.7560.0>},#Ref<4957.0.72.34670>},
       {{ch_publisher,<5764.8286.0>},#Ref<4957.0.72.35575>},
       {{credit_to,<5764.8131.0>},30},
       {{credit_to,<5764.7811.0>},32},
       {{ch_publisher,<5764.8584.0>},#Ref<4957.0.72.35309>},
       {{ch_publisher,<5764.8132.0>},#Ref<4957.0.72.34906>},
       {{ch_publisher,<5764.7584.0>},#Ref<4957.0.72.34750>},
       {{ch_publisher,<5764.8254.0>},#Ref<4957.0.72.35135>},
       {{credit_to,<5764.8521.0>},33},
       {{credit_to,<5764.9171.0>},45},
       {{credit_to,<5764.9059.0>},36},
       {{ch,<5764.7103.0>},
        {cr,<5764.7103.0>,#Ref<4957.0.72.33656>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7100.0>,true},
            false,7}},
       {{ch_publisher,<5764.7397.0>},#Ref<4957.0.72.33785>},
       {{ch_publisher,<5764.9483.0>},#Ref<4957.0.72.39053>},
       {{ch_publisher,<5764.7457.0>},#Ref<4957.0.72.33876>},
       {{ch_publisher,<5764.7601.0>},#Ref<4957.0.72.34783>},
       {{credit_to,<5764.7455.0>},30},
       {{credit_to,<5764.8751.0>},34},
       {{credit_to,<5764.8120.0>},32},
       {{credit_to,<5764.8183.0>},36},
       {{ch_publisher,<5764.8282.0>},#Ref<4957.0.72.35198>},
       {{credit_to,<5764.7714.0>},29},
       {{ch_publisher,<5764.8631.0>},#Ref<4957.0.72.35327>},
       {{credit_to,<5764.7991.0>},33},
       {{ch_publisher,<5764.7806.0>},#Ref<4957.0.72.34805>},
       {{ch_publisher,<5764.8490.0>},#Ref<4957.0.72.35298>},
       {{ch_publisher,<5764.9131.0>},#Ref<4957.0.72.35800>},
       {{credit_to,<5764.7605.0>},34},
       {{ch_publisher,<5764.9063.0>},#Ref<4957.0.72.35817>},
       {{credit_to,<5764.9407.0>},43},
       {{ch_publisher,<5764.8666.0>},#Ref<4957.0.72.35158>},
       {{ch_publisher,<5764.9115.0>},#Ref<4957.0.72.36189>},
       {{ch_publisher,<5764.9243.0>},#Ref<4957.0.72.37118>},
       {{ch_publisher,<5764.9415.0>},#Ref<4957.0.72.39030>},
       {{credit_to,<5764.9191.0>},45},
       {{credit_to,<5764.8459.0>},33},
       {{ch_publisher,<5764.8468.0>},#Ref<4957.0.72.35172>},
       {{credit_to,<5764.9015.0>},34},
       {{ch,<5764.7015.0>},
        {cr,<5764.7015.0>,#Ref<4957.0.72.33634>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7012.0>,true},
            false,7}},
       {{credit_to,<5764.8454.0>},42},
       {{xtype_to_module,direct},rabbit_exchange_type_direct},
       {{ch,<5764.6911.0>},
        {cr,<5764.6911.0>,#Ref<4957.0.72.33604>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6906.0>,true},
            false,8}},
       {{credit_to,<5764.7872.0>},31},
       {{credit_to,<5764.9103.0>},31},
       {{ch_publisher,<5764.9267.0>},#Ref<4957.0.72.37217>},
       {{ch_publisher,<5764.7402.0>},#Ref<4957.0.72.33801>},
       {{ch_publisher,<5764.8904.0>},#Ref<4957.0.72.35846>},
       {{ch_publisher,<5764.7987.0>},#Ref<4957.0.72.35047>},
       {{credit_to,<5764.8241.0>},41},
       {{credit_to,<5764.9175.0>},34},
       {{credit_to,<5764.8813.0>},35},
       {{"/var/lib/rabbitmq/mnesia/rabbit at cnbj-cuc-tst01-crl0015/queues/9KCPZKS0BPAPHGT9JYG3TX64X/journal.jif",
         fhc_file},
        {file,1,true}},
       {{ch_publisher,<5764.8452.0>},#Ref<4957.0.72.35767>},
       {{ch_publisher,<5764.9471.0>},#Ref<4957.0.72.39037>},
       {{credit_to,<5764.8955.0>},35},
       {{ch_publisher,<5764.8932.0>},#Ref<4957.0.72.35794>},
       {{ch_publisher,<5764.9215.0>},#Ref<4957.0.72.37150>},
       {{ch_publisher,<5764.9002.0>},#Ref<4957.0.72.37215>},
       {{credit_to,<5764.9051.0>},36},
       {{ch_publisher,<5764.7454.0>},#Ref<4957.0.72.33798>},
       {{ch_publisher,<5764.8856.0>},#Ref<4957.0.72.35789>},
       {{ch_publisher,<5764.8917.0>},#Ref<4957.0.72.37112>},
       {{credit_to,<5764.9039.0>},43},
       {{ch_publisher,<5764.8398.0>},#Ref<4957.0.72.35540>},
       {{credit_to,<5764.8916.0>},35},
       {{credit_to,<5764.8066.0>},34},
       {{ch_publisher,<5764.8184.0>},#Ref<4957.0.72.35332>},
       {{credit_to,<5764.8950.0>},35},
       {{credit_to,<5764.9480.0>},45},
       {{ch_publisher,<5764.7881.0>},#Ref<4957.0.72.34984>},
       {{ch_publisher,<5764.8441.0>},#Ref<4957.0.72.34926>},
       {{ch_publisher,<5764.7520.0>},#Ref<4957.0.72.34071>},
       {{ch_publisher,<5764.8723.0>},#Ref<4957.0.72.35771>},
       {{ch_publisher,<5764.8600.0>},#Ref<4957.0.72.35355>},
       {{ch_publisher,<5764.8039.0>},#Ref<4957.0.72.34843>},
       {{credit_to,<5764.8485.0>},30},
       {{credit_to,<5764.8977.0>},32},
       {{credit_to,<5764.7402.0>},29},
       {{ch_publisher,<5764.8340.0>},#Ref<4957.0.72.35467>},
       {{ch_publisher,<5764.7867.0>},#Ref<4957.0.72.34845>},
       {{ch_publisher,<5764.7621.0>},#Ref<4957.0.72.34851>},
       {{credit_to,<5764.8277.0>},29},
       {{ch_publisher,<5764.8602.0>},#Ref<4957.0.72.35477>},
       {{ch_publisher,<5764.8814.0>},#Ref<4957.0.72.35828>},
       {{ch_publisher,<5764.7482.0>},#Ref<4957.0.72.33903>},
       {{credit_to,<5764.8134.0>},28},
       {{ch_publisher,<5764.8258.0>},#Ref<4957.0.72.35114>},
       {{ch,<5764.6966.0>},
        {cr,<5764.6966.0>,#Ref<4957.0.72.33624>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6949.0>,true},
            false,8}},
       {{ch_publisher,<5764.8747.0>},#Ref<4957.0.72.37101>},
       {{credit_to,<5764.7808.0>},35},
       {{credit_to,<5764.8142.0>},32},
       {{ch_publisher,<5764.8767.0>},#Ref<4957.0.72.35360>},
       {{credit_to,<5764.8447.0>},42},
       {{credit_to,<5764.7500.0>},29},
       {{ch_publisher,<5764.8761.0>},#Ref<4957.0.72.35456>},
       {{ch_publisher,<5764.8544.0>},#Ref<4957.0.72.35694>},
       {{ch_publisher,<5764.8624.0>},#Ref<4957.0.72.35823>},
       {{credit_to,<5764.8461.0>},30},
       {{credit_to,<5764.9279.0>},32},
       {{ch_publisher,<5764.8110.0>},#Ref<4957.0.72.35000>},
       {{credit_to,<5764.7621.0>},34},
       {{credit_to,<5764.9447.0>},44},
       {{ch_publisher,<5764.8333.0>},#Ref<4957.0.72.35086>},
       {{ch_publisher,<5764.8262.0>},#Ref<4957.0.72.35049>},
       {{ch,<5764.7123.0>},
        {cr,<5764.7123.0>,#Ref<4957.0.72.33661>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7120.0>,true},
            false,7}},
       {{ch_publisher,<5764.8881.0>},#Ref<4957.0.72.36191>},
       {{ch_publisher,<5764.7714.0>},#Ref<4957.0.72.34107>},
       {{credit_to,<5764.7496.0>},30},
       {{credit_to,<5764.8338.0>},33},
       {{credit_to,<5764.8115.0>},33},
       {{ch_publisher,<5764.8636.0>},#Ref<4957.0.72.35192>},
       {{credit_to,<5764.8973.0>},42},
       {{ch_publisher,<5764.7758.0>},#Ref<4957.0.72.34776>},
       {{ch_publisher,<5764.9423.0>},#Ref<4957.0.72.38923>},
       {{credit_to,<5764.7579.0>},25},
       {{credit_to,<5764.8505.0>},40},
       {{ch_publisher,<5764.9407.0>},#Ref<4957.0.72.39022>},
       {{ch_publisher,<5764.8815.0>},#Ref<4957.0.72.35324>},
       {{credit_to,<5764.9167.0>},30},
       {{ch_publisher,<5764.8256.0>},#Ref<4957.0.72.35175>},
       {{ch_publisher,<5764.9334.0>},#Ref<4957.0.72.39073>},
       {{credit_to,<5764.7499.0>},33},
       {{ch_publisher,<5764.9499.0>},#Ref<4957.0.72.39084>},
       {{credit_to,<5764.7719.0>},31},
       {{ch_publisher,<5764.8812.0>},#Ref<4957.0.72.35738>},
       {{ch_publisher,<5764.9123.0>},#Ref<4957.0.72.36112>},
       {{ch_publisher,<5764.7453.0>},#Ref<4957.0.72.33888>},
       {{ch_publisher,<5764.9523.0>},#Ref<4957.0.72.40321>},
       {{ch_publisher,<5764.9219.0>},#Ref<4957.0.72.37202>},
       {{credit_to,<5764.9063.0>},31},
       {{credit_to,<5764.9487.0>},47},
       {{credit_to,<5764.9223.0>},31},
       {{ch_publisher,<5764.7531.0>},#Ref<4957.0.72.34035>},
       {{ch_publisher,<5764.7874.0>},#Ref<4957.0.72.34871>},
       {{credit_to,<5764.9102.0>},32},
       {{credit_to,<5764.9355.0>},50},
       {{credit_to,<5764.8614.0>},40},
       {{ch_publisher,<5764.7477.0>},#Ref<4957.0.72.33936>},
       {{#Ref<4957.0.42.154022>,fhc_handle},
        {handle,
            {file_descriptor,prim_file,{#Port<4957.6035>,167}},
            0,false,0,infinity,[],true,
            "/var/lib/rabbitmq/mnesia/rabbit at cnbj-cuc-tst01-crl0015/queues/9KCPZKS0BPAPHGT9JYG3TX64X/journal.jif",
            [write,binary,raw,read],
            [{write_buffer,infinity}],
            true,true,
            {1344,922970,90677}}},
       {{ch_publisher,<5764.7605.0>},#Ref<4957.0.72.34820>},
       {{ch_publisher,<5764.8138.0>},#Ref<4957.0.72.37207>},
       {{credit_to,<5764.7870.0>},29},
       {{credit_to,<5764.8744.0>},35},
       {'$ancestors',[rabbit_amqqueue_sup,rabbit_sup,<4957.472.0>]},
       {{ch_publisher,<5764.7369.0>},#Ref<4957.0.72.33781>},
       {{credit_to,<5764.7477.0>},29},
       {{ch_publisher,<5764.7585.0>},#Ref<4957.0.72.34068>},
       {{ch_publisher,<5764.8119.0>},#Ref<4957.0.72.34824>},
       {{credit_to,<5764.9435.0>},42},
       {{credit_to,<5764.7480.0>},33},
       {{ch_publisher,<5764.8457.0>},#Ref<4957.0.72.35414>},
       {{ch,<5764.7024.0>},
        {cr,<5764.7024.0>,#Ref<4957.0.72.33636>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7022.0>,true},
            false,7}},
       {{ch_publisher,<5764.8603.0>},#Ref<4957.0.72.35349>},
       {{ch_publisher,<5764.8090.0>},#Ref<4957.0.72.34849>},
       {{credit_to,<5764.8767.0>},41},
       {{credit_to,<5764.9398.0>},44},
       {{ch_publisher,<5764.9090.0>},#Ref<4957.0.72.35754>},
       {{credit_to,<5764.7482.0>},33},
       {{ch_publisher,<5764.8259.0>},#Ref<4957.0.72.35160>},
       {{credit_to,<5764.7596.0>},35},
       {{ch_publisher,<5764.8142.0>},#Ref<4957.0.72.35181>},
       {{credit_to,<5764.8592.0>},45},
       {{credit_to,<5764.9334.0>},44},
       {{credit_to,<5764.8229.0>},30},
       {{ch_publisher,<5764.9067.0>},#Ref<4957.0.72.35798>},
       {{ch_publisher,<5764.9530.0>},#Ref<4957.0.72.40275>},
       {{ch,<5764.6972.0>},
        {cr,<5764.6972.0>,#Ref<4957.0.72.33616>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6968.0>,true},
            false,8}},
       {{ch_publisher,<5764.7875.0>},#Ref<4957.0.72.35170>},
       {{ch_publisher,<5764.8491.0>},#Ref<4957.0.72.35852>},
       {{credit_to,<5764.9555.0>},45},
       {{ch_publisher,<5764.8001.0>},#Ref<4957.0.72.35287>},
       {{ch_publisher,<5764.8156.0>},#Ref<4957.0.72.34910>},
       {{ch_publisher,<5764.8095.0>},#Ref<4957.0.72.34934>},
       {{credit_to,<5764.8758.0>},33},
       {{ch_publisher,<5764.8275.0>},#Ref<4957.0.72.35347>},
       {{credit_to,<5764.8228.0>},29},
       {{ch_publisher,<5764.7579.0>},#Ref<4957.0.72.34773>},
       {{ch_publisher,<5764.8034.0>},#Ref<4957.0.72.34853>},
       {{ch_publisher,<5764.9403.0>},#Ref<4957.0.72.40330>},
       {{credit_to,<5764.8165.0>},34},
       {{ch_publisher,<5764.8733.0>},#Ref<4957.0.72.35814>},
       {{credit_to,<5764.8341.0>},38},
       {{credit_to,<5764.7536.0>},33},
       {{credit_to,<5764.9187.0>},35},
       {{credit_to,<5764.8254.0>},28},
       {{ch_publisher,<5764.7625.0>},#Ref<4957.0.72.35598>},
       {{ch_publisher,<5764.8489.0>},#Ref<4957.0.72.35727>},
       {{ch_publisher,<5764.7704.0>},#Ref<4957.0.72.34834>},
       {{credit_to,<5764.8453.0>},33},
       {{ch_publisher,<5764.9506.0>},#Ref<4957.0.72.40202>},
       {{credit_to,<5764.8259.0>},32},
       {{credit_to,<5764.7869.0>},41},
       {{ch,<5764.6837.0>},
        {cr,<5764.6837.0>,#Ref<4957.0.72.33590>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6836.0>,true},
            false,8}},
       {{ch,<5764.6903.0>},
        {cr,<5764.6903.0>,#Ref<4957.0.72.33602>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6901.0>,true},
            false,8}},
       {{ch_publisher,<5764.7525.0>},#Ref<4957.0.72.34038>},
       {{ch_publisher,<5764.8512.0>},#Ref<4957.0.72.35502>},
       {{ch_publisher,<5764.9175.0>},#Ref<4957.0.72.36078>},
       {{credit_to,<5764.8954.0>},31},
       {{ch_publisher,<5764.7617.0>},#Ref<4957.0.72.35573>},
       {{ch_publisher,<5764.8335.0>},#Ref<4957.0.72.35345>},
       {{ch_publisher,<5764.7866.0>},#Ref<4957.0.72.34793>},
       {{credit_to,<5764.8452.0>},45},
       {{credit_to,<5764.7443.0>},25},
       {{credit_to,<5764.7873.0>},32},
       {{credit_to,<5764.8623.0>},35},
       {{credit_to,<5764.7529.0>},34},
       {{credit_to,<5764.9475.0>},50},
       {{ch,<5764.7008.0>},
        {cr,<5764.7008.0>,#Ref<4957.0.72.33630>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7005.0>,true},
            false,7}},
       {{credit_to,<5764.7734.0>},35},
       {{credit_to,<5764.9199.0>},34},
       {{credit_to,<5764.8289.0>},29},
       {{ch_publisher,<5764.8277.0>},#Ref<4957.0.72.35530>},
       {{ch_publisher,<5764.9507.0>},#Ref<4957.0.72.38873>},
       {{credit_to,<5764.8286.0>},36},
       {{ch_publisher,<5764.8752.0>},#Ref<4957.0.72.35720>},
       {{credit_to,<5764.8584.0>},45},
       {{ch_publisher,<5764.8751.0>},#Ref<4957.0.72.35282>},
       {{ch_publisher,<5764.7499.0>},#Ref<4957.0.72.33896>},
       {{ch_publisher,<5764.8395.0>},#Ref<4957.0.72.35498>},
       {{ch_publisher,<5764.9079.0>},#Ref<4957.0.72.36085>},
       {{credit_to,<5764.9043.0>},41},
       {{ch_publisher,<5764.8400.0>},#Ref<4957.0.72.35821>},
       {{credit_to,<5764.8395.0>},27},
       {{ch_publisher,<5764.8329.0>},#Ref<4957.0.72.35569>},
       {{credit_to,<5764.8868.0>},41},
       {{credit_to,<5764.7485.0>},27},
       {{credit_to,<5764.7790.0>},31},
       {{credit_to,<5764.8615.0>},41},
       {{ch_publisher,<5764.8485.0>},#Ref<4957.0.72.35296>},
       {{ch_publisher,<5764.8388.0>},#Ref<4957.0.72.35858>},
       {{ch_publisher,<5764.8759.0>},#Ref<4957.0.72.35840>},
       {{ch_publisher,<5764.9439.0>},#Ref<4957.0.72.38958>},
       {{ch_publisher,<5764.7689.0>},#Ref<4957.0.72.34020>},
       {{credit_to,<5764.9423.0>},44},
       {{ch_publisher,<5764.9147.0>},#Ref<4957.0.72.36164>},
       {{ch_publisher,<5764.9023.0>},#Ref<4957.0.72.35714>},
       {{ch_publisher,<5764.9055.0>},#Ref<4957.0.72.35848>},
       {{ch_publisher,<5764.9563.0>},#Ref<4957.0.72.40311>},
       {{ch_publisher,<5764.8536.0>},#Ref<4957.0.72.35269>},
       {{ch_publisher,<5764.8038.0>},#Ref<4957.0.72.34928>},
       {{ch_publisher,<5764.9001.0>},#Ref<4957.0.72.35523>},
       {{ch_publisher,<5764.9451.0>},#Ref<4957.0.72.40194>},
       {{credit_to,<5764.7502.0>},34},
       {{ch_publisher,<5764.8427.0>},#Ref<4957.0.72.35078>},
       {{ch_publisher,<5764.7379.0>},#Ref<4957.0.72.33779>},
       {{ch_publisher,<5764.9103.0>},#Ref<4957.0.72.36132>},
       {{ch_publisher,<5764.9287.0>},#Ref<4957.0.72.37136>},
       {{credit_to,<5764.8956.0>},34},
       {{ch_publisher,<5764.9207.0>},#Ref<4957.0.72.36114>},
       {{ch_publisher,<5764.8009.0>},#Ref<4957.0.72.34924>},
       {{credit_to,<5764.8624.0>},33},
       {{credit_to,<5764.8666.0>},31},
       {{credit_to,<5764.8881.0>},33},
       {{ch_publisher,<5764.8267.0>},#Ref<4957.0.72.35156>},
       {{ch_publisher,<5764.9127.0>},#Ref<4957.0.72.35883>},
       {{credit_to,<5764.9506.0>},45},
       {{ch_publisher,<5764.8972.0>},#Ref<4957.0.72.35810>},
       {{ch_publisher,<5764.8182.0>},#Ref<4957.0.72.35051>},
       {{credit_to,<5764.7410.0>},29},
       {{credit_to,<5764.9483.0>},42},
       {{credit_to,<5764.8949.0>},39},
       {{ch_publisher,<5764.7947.0>},#Ref<4957.0.72.34893>},
       {{credit_to,<5764.7866.0>},29},
       {{ch,<5764.7133.0>},
        {cr,<5764.7133.0>,#Ref<4957.0.72.33666>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7132.0>,true},
            false,7}},
       {{ch_publisher,<5764.7443.0>},#Ref<4957.0.72.33829>},
       {{credit_to,<5764.8252.0>},33},
       {{credit_to,<5764.7655.0>},27},
       {{credit_to,<5764.9539.0>},44},
       {{credit_to,<5764.7456.0>},34},
       {{ch_publisher,<5764.8020.0>},#Ref<4957.0.72.34941>},
       {{ch_publisher,<5764.8754.0>},#Ref<4957.0.72.35779>},
       {{ch_publisher,<5764.9515.0>},#Ref<4957.0.72.40254>},
       {{ch_publisher,<5764.9399.0>},#Ref<4957.0.72.38916>},
       {{ch_publisher,<5764.9427.0>},#Ref<4957.0.72.40243>},
       {{credit_to,<5764.8754.0>},35},
       {{ch_publisher,<5764.9339.0>},#Ref<4957.0.72.38982>},
       {{credit_to,<5764.9443.0>},44},
       {{credit_to,<5764.8768.0>},33},
       {{ch_publisher,<5764.8018.0>},#Ref<4957.0.72.35279>},
       {{credit_to,<5764.8653.0>},29},
       {{credit_to,<5764.8278.0>},28},
       {{ch_publisher,<5764.7552.0>},#Ref<4957.0.72.33975>},
       {{credit_to,<5764.8503.0>},27},
       {{credit_to,<5764.8548.0>},42},
       {{ch_publisher,<5764.9379.0>},#Ref<4957.0.72.40206>},
       {{credit_to,<5764.8757.0>},29},
       {{ch_publisher,<5764.8234.0>},#Ref<4957.0.72.34980>},
       {{ch_publisher,<5764.8981.0>},#Ref<4957.0.72.36120>},
       {{credit_to,<5764.9287.0>},30},
       {{credit_to,<5764.8439.0>},41},
       {{ch_publisher,<5764.7377.0>},#Ref<4957.0.72.33787>},
       {{credit_to,<5764.9247.0>},34},
       {{ch_publisher,<5764.7945.0>},#Ref<4957.0.72.34882>},
       {{credit_to,<5764.8018.0>},41},
       {{ch_publisher,<5764.7673.0>},#Ref<4957.0.72.33990>},
       {{credit_to,<5764.7584.0>},34},
       {guid,{{2234412243,3557275008,1057695795,1450038783},1}},
       {{credit_to,<5764.8109.0>},42},
       {{ch_publisher,<5764.9522.0>},#Ref<4957.0.72.39047>},
       {{ch_publisher,<5764.8764.0>},#Ref<4957.0.72.35534>},
       {{credit_to,<5764.9165.0>},35},
       {{credit_to,<5764.7520.0>},30},
       {{credit_to,<5764.7904.0>},30},
       {{credit_to,<5764.9263.0>},38},
       {{credit_to,<5764.8656.0>},31},
       {{credit_to,<5764.7963.0>},41},
       {{ch_publisher,<5764.7963.0>},#Ref<4957.0.72.34841>},
       {{ch_publisher,<5764.8342.0>},#Ref<4957.0.72.35337>},
       {{credit_to,<5764.8504.0>},34},
       {{credit_to,<5764.8760.0>},42},
       {{credit_to,<5764.8348.0>},29},
       {{ch_publisher,<5764.7616.0>},#Ref<4957.0.72.34860>},
       {{ch_publisher,<5764.8758.0>},#Ref<4957.0.72.35500>},
       {{credit_to,<5764.8258.0>},33},
       {{ch_publisher,<5764.9179.0>},#Ref<4957.0.72.36057>},
       {{ch_publisher,<5764.8700.0>},#Ref<4957.0.72.35462>},
       {{credit_to,<5764.8809.0>},33},
       {{ch_publisher,<5764.8346.0>},#Ref<4957.0.72.35544>},
       {{ch_publisher,<5764.7597.0>},#Ref<4957.0.72.34721>},
       {{ch_publisher,<5764.7873.0>},#Ref<4957.0.72.34916>},
       {{ch_publisher,<5764.8426.0>},#Ref<4957.0.72.34982>},
       {{credit_to,<5764.8005.0>},28},
       {{credit_to,<5764.7685.0>},26},
       {{credit_to,<5764.8017.0>},36},
       {{credit_to,<5764.7582.0>},33},
       {{ch_publisher,<5764.9088.0>},#Ref<4957.0.72.35784>},
       {{credit_from,<4957.588.0>},1791},
       {{credit_to,<5764.8156.0>},38},
       {{credit_to,<5764.8333.0>},42},
       {{ch_publisher,<5764.9223.0>},#Ref<4957.0.72.37200>},
       {{credit_to,<5764.9439.0>},47},
       {{ch_publisher,<5764.8229.0>},#Ref<4957.0.72.35200>},
       {fhc_age_tree,{1,{{1344,922970,90677},#Ref<4957.0.42.154022>,nil,nil}}},
       {{credit_to,<5764.7597.0>},33},
       {{credit_to,<5764.9019.0>},43},
       {{credit_to,<5764.8469.0>},29},
       {{credit_to,<5764.8875.0>},33},
       {{credit_to,<5764.9346.0>},47},
       {{ch_publisher,<5764.7717.0>},#Ref<4957.0.72.34044>},
       {{ch_publisher,<5764.8338.0>},#Ref<4957.0.72.35419>},
       {{ch,<5764.7046.0>},
        {cr,<5764.7046.0>,#Ref<4957.0.72.33642>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7044.0>,true},
            false,7}},
       {{ch_publisher,<5764.8492.0>},#Ref<4957.0.72.35202>},
       {{credit_to,<5764.8627.0>},33},
       {{ch_publisher,<5764.8085.0>},#Ref<4957.0.72.35084>},
       {{credit_to,<5764.8457.0>},29},
       {{credit_to,<5764.9127.0>},42},
       {{credit_to,<5764.8342.0>},30},
       {{ch_publisher,<5764.9414.0>},#Ref<4957.0.72.38927>},
       {{credit_to,<5764.9090.0>},32},
       {{ch_publisher,<5764.7946.0>},#Ref<4957.0.72.35166>},
       {{ch_publisher,<5764.8066.0>},#Ref<4957.0.72.34975>},
       {{ch_publisher,<5764.7609.0>},#Ref<4957.0.72.34839>},
       {{ch_publisher,<5764.8966.0>},#Ref<4957.0.72.35475>},
       {{ch,<5764.6975.0>},
        {cr,<5764.6975.0>,#Ref<4957.0.72.33623>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6974.0>,true},
            false,8}},
       {{ch_publisher,<5764.8587.0>},#Ref<4957.0.72.35190>},
       {{ch_publisher,<5764.7904.0>},#Ref<4957.0.72.34822>},
       {{credit_to,<5764.8753.0>},42},
       {{ch_publisher,<5764.7404.0>},#Ref<4957.0.72.33791>},
       {{ch_publisher,<5764.8768.0>},#Ref<4957.0.72.35865>},
       {{ch_publisher,<5764.7811.0>},#Ref<4957.0.72.34813>},
       {{ch_publisher,<5764.9554.0>},#Ref<4957.0.72.39057>},
       {{credit_to,<5764.8812.0>},33},
       {{credit_to,<5764.9131.0>},43},
       {{ch_publisher,<5764.8244.0>},#Ref<4957.0.72.35055>},
       {{credit_to,<5764.9451.0>},50},
       {{ch,<5764.6919.0>},
        {cr,<5764.6919.0>,#Ref<4957.0.72.33608>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6916.0>,true},
            false,8}},
       {{credit_to,<5764.7428.0>},29},
       {{credit_to,<5764.7552.0>},33},
       {{credit_to,<5764.7992.0>},30},
       {{credit_to,<5764.8851.0>},29},
       {{ch_publisher,<5764.8537.0>},#Ref<4957.0.72.35565>},
       {{ch_publisher,<5764.8030.0>},#Ref<4957.0.72.34862>},
       {{ch_publisher,<5764.8169.0>},#Ref<4957.0.72.35145>},
       {{credit_to,<5764.9459.0>},42},
       {{credit_to,<5764.9030.0>},35},
       {{credit_to,<5764.8256.0>},33},
       {{ch_publisher,<5764.7555.0>},#Ref<4957.0.72.34727>},
       {{ch,<5764.6849.0>},
        {cr,<5764.6849.0>,#Ref<4957.0.72.33594>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6848.0>,true},
            false,8}},
       {{credit_to,<5764.9283.0>},35},
       {{ch_publisher,<5764.8463.0>},#Ref<4957.0.72.35263>},
       {{credit_to,<5764.8397.0>},31},
       {{ch_publisher,<5764.8953.0>},#Ref<4957.0.72.35802>},
       {{ch_publisher,<5764.9354.0>},#Ref<4957.0.72.39018>},
       {{ch_publisher,<5764.8103.0>},#Ref<4957.0.72.35300>},
       {{ch_publisher,<5764.8864.0>},#Ref<4957.0.72.35536>},
       {{ch_publisher,<5764.7710.0>},#Ref<4957.0.72.34005>},
       {{ch,<5764.7056.0>},
        {cr,<5764.7056.0>,#Ref<4957.0.72.33644>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7053.0>,true},
            false,7}},
       {{ch_publisher,<5764.8518.0>},#Ref<4957.0.72.35731>},
       {{credit_to,<5764.8930.0>},45},
       {{ch_publisher,<5764.9091.0>},#Ref<4957.0.72.35532>},
       {{ch_publisher,<5764.8760.0>},#Ref<4957.0.72.35454>},
       {{credit_to,<5764.9419.0>},43},
       {{ch_publisher,<5764.7550.0>},#Ref<4957.0.72.34086>},
       {{ch_publisher,<5764.7790.0>},#Ref<4957.0.72.34836>},
       {{ch_publisher,<5764.9347.0>},#Ref<4957.0.72.38911>},
       {{ch_publisher,<5764.7387.0>},#Ref<4957.0.72.33783>},
       {{ch_publisher,<5764.7428.0>},#Ref<4957.0.72.33851>},
       {{credit_to,<5764.8038.0>},29},
       {{ch_publisher,<5764.9373.0>},#Ref<4957.0.72.40315>},
       {{credit_to,<5764.8544.0>},31},
       {{ch_publisher,<5764.9263.0>},#Ref<4957.0.72.37156>},
       {{ch_publisher,<5764.7553.0>},#Ref<4957.0.72.34731>},
       {{credit_to,<5764.8747.0>},42},
       {{ch,<5764.6965.0>},
        {cr,<5764.6965.0>,#Ref<4957.0.72.33618>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6954.0>,true},
            false,8}},
       {{credit_to,<5764.7767.0>},32},
       {{ch,<5764.7082.0>},
        {cr,<5764.7082.0>,#Ref<4957.0.72.33650>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7080.0>,true},
            false,7}},
       {{ch_publisher,<5764.8715.0>},#Ref<4957.0.72.35480>},
       {{ch_publisher,<5764.9095.0>},#Ref<4957.0.72.36158>},
       {{credit_to,<5764.8936.0>},42},
       {{ch_publisher,<5764.8630.0>},#Ref<4957.0.72.35521>},
       {{credit_to,<5764.8917.0>},41},
       {{ch_publisher,<5764.7735.0>},#Ref<4957.0.72.34052>},
       {{credit_to,<5764.9219.0>},34},
       {{credit_to,<5764.8815.0>},34},
       {{ch_publisher,<5764.9235.0>},#Ref<4957.0.72.37198>},
       {{ch_publisher,<5764.8109.0>},#Ref<4957.0.72.34884>},
       {{ch_publisher,<5764.8022.0>},#Ref<4957.0.72.34961>},
       {{credit_to,<5764.9033.0>},42},
       {{credit_to,<5764.9335.0>},50},
       {{credit_to,<5764.8135.0>},29},
       {{ch_publisher,<5764.8950.0>},#Ref<4957.0.72.35781>},
       {{credit_to,<5764.7706.0>},30},
       {{credit_to,<5764.9023.0>},41},
       {{credit_to,<5764.8267.0>},29},
       {{credit_to,<5764.8919.0>},42},
       {{credit_to,<5764.8265.0>},34},
       {{credit_to,<5764.8933.0>},34},
       {{ch,<5764.6971.0>},
        {cr,<5764.6971.0>,#Ref<4957.0.72.33626>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6962.0>,true},
            false,8}},
       {{ch_publisher,<5764.8459.0>},#Ref<4957.0.72.35100>},
       {{credit_to,<5764.8745.0>},31},
       {{credit_to,<5764.9207.0>},33},
       {{credit_to,<5764.9563.0>},45},
       {{credit_to,<5764.7550.0>},34},
       {{ch_publisher,<5764.8035.0>},#Ref<4957.0.72.35093>},
       {{credit_to,<5764.9050.0>},42},
       {{credit_to,<5764.8625.0>},35},
       {{ch_publisher,<5764.9239.0>},#Ref<4957.0.72.37145>},
       {{ch_publisher,<5764.8442.0>},#Ref<4957.0.72.35289>},
       {{ch_publisher,<5764.8278.0>},#Ref<4957.0.72.34995>},
       {{ch_publisher,<5764.8657.0>},#Ref<4957.0.72.35304>},
       {{credit_to,<5764.7689.0>},31},
       {{credit_to,<5764.8288.0>},40},
       {{credit_to,<5764.9458.0>},45},
       {{credit_to,<5764.8630.0>},34},
       {{ch_publisher,<5764.8135.0>},#Ref<4957.0.72.34997>},
       {{ch_publisher,<5764.9279.0>},#Ref<4957.0.72.37192>},
       {{ch_publisher,<5764.8327.0>},#Ref<4957.0.72.35124>},
       {{credit_to,<5764.8985.0>},41},
       {{credit_to,<5764.7517.0>},33},
       {{ch_publisher,<5764.7949.0>},#Ref<4957.0.72.34987>},
       {{credit_to,<5764.9107.0>},42},
       {{ch_publisher,<5764.8977.0>},#Ref<4957.0.72.36118>},
       {{credit_to,<5764.7807.0>},27},
       {{credit_to,<5764.8636.0>},40},
       {{credit_to,<5764.8261.0>},35},
       {{ch_publisher,<5764.8876.0>},#Ref<4957.0.72.35556>},
       {{ch_publisher,<5764.7529.0>},#Ref<4957.0.72.34015>},
       {{ch_publisher,<5764.8098.0>},#Ref<4957.0.72.35196>},
       {{ch_publisher,<5764.9283.0>},#Ref<4957.0.72.37219>},
       {{credit_to,<5764.8465.0>},33},
       {{credit_to,<5764.9259.0>},32},
       {{ch_publisher,<5764.7792.0>},#Ref<4957.0.72.34847>},
       {{ch_publisher,<5764.8456.0>},#Ref<4957.0.72.35351>},
       {{ch_publisher,<5764.9383.0>},#Ref<4957.0.72.38953>},
       {{ch,<5764.6877.0>},
        {cr,<5764.6877.0>,#Ref<4957.0.72.33598>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6872.0>,true},
            false,8}},
       {{credit_to,<5764.8009.0>},31},
       {{ch_publisher,<5764.8541.0>},#Ref<4957.0.72.35561>},
       {{credit_to,<5764.8463.0>},29},
       {{ch_publisher,<5764.7596.0>},#Ref<4957.0.72.34818>},
       {{credit_to,<5764.8275.0>},32},
       {{ch_publisher,<5764.9259.0>},#Ref<4957.0.72.37176>},
       {{credit_to,<5764.7939.0>},29},
       {{credit_to,<5764.9005.0>},35},
       {{ch_publisher,<5764.8935.0>},#Ref<4957.0.72.35447>},
       {{ch_publisher,<5764.8627.0>},#Ref<4957.0.72.35472>},
       {{credit_to,<5764.8340.0>},41},
       {{ch,<5764.7009.0>},
        {cr,<5764.7009.0>,#Ref<4957.0.72.33628>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7003.0>,true},
            false,7}},
       {{ch_publisher,<5764.8347.0>},#Ref<4957.0.72.35042>},
       {{ch_publisher,<5764.8936.0>},#Ref<4957.0.72.35688>},
       {{ch_publisher,<5764.8854.0>},#Ref<4957.0.72.35321>},
       {{credit_to,<5764.9511.0>},47},
       {{ch_publisher,<5764.7571.0>},#Ref<4957.0.72.34791>},
       {{credit_to,<5764.9375.0>},44},
       {{credit_to,<5764.8493.0>},28},
       {{credit_to,<5764.8934.0>},32},
       {{credit_to,<5764.9554.0>},42},
       {{credit_to,<5764.8035.0>},31},
       {{credit_to,<5764.8114.0>},32},
       {{ch,<5764.6960.0>},
        {cr,<5764.6960.0>,#Ref<4957.0.72.33614>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6951.0>,true},
            false,8}},
       {{ch_publisher,<5764.8405.0>},#Ref<4957.0.72.35284>},
       {{ch_publisher,<5764.9271.0>},#Ref<4957.0.72.37139>},
       {{credit_to,<5764.7625.0>},30},
       {{credit_to,<5764.8514.0>},40},
       {{ch_publisher,<5764.7985.0>},#Ref<4957.0.72.34936>},
       {{ch_publisher,<5764.7935.0>},#Ref<4957.0.72.34914>},
       {{credit_to,<5764.8628.0>},30},
       {{credit_to,<5764.8329.0>},44},
       {{credit_to,<5764.8953.0>},35},
       {{credit_to,<5764.8814.0>},33},
       {{credit_to,<5764.7431.0>},29},
       {{credit_to,<5764.8282.0>},31},
       {{ch_publisher,<5764.8919.0>},#Ref<4957.0.72.36130>},
       {{ch_publisher,<5764.9183.0>},#Ref<4957.0.72.36152>},
       {{ch_publisher,<5764.8222.0>},#Ref<4957.0.72.35082>},
       {{ch_publisher,<5764.8628.0>},#Ref<4957.0.72.35508>},
       {{credit_to,<5764.9095.0>},31},
       {{credit_to,<5764.9000.0>},36},
       {{ch_publisher,<5764.9030.0>},#Ref<4957.0.72.36193>},
       {{credit_to,<5764.9151.0>},43},
       {{ch_publisher,<5764.7582.0>},#Ref<4957.0.72.34771>},
       {{credit_to,<5764.7934.0>},31},
       {{credit_to,<5764.7770.0>},35},
       {{ch_publisher,<5764.8629.0>},#Ref<4957.0.72.35445>},
       {{credit_to,<5764.8789.0>},34},
       {{ch_publisher,<5764.8852.0>},#Ref<4957.0.72.35870>},
       {{ch_publisher,<5764.9443.0>},#Ref<4957.0.72.40327>},
       {{credit_to,<5764.8788.0>},45},
       {{ch_publisher,<5764.8653.0>},#Ref<4957.0.72.35552>},
       {{ch_publisher,<5764.9531.0>},#Ref<4957.0.72.39041>},
       {{credit_to,<5764.8587.0>},34},
       {{ch_publisher,<5764.9549.0>},#Ref<4957.0.72.40268>},
       {{credit_to,<5764.9235.0>},39},
       {{credit_to,<5764.9251.0>},37},
       {{ch_publisher,<5764.8851.0>},#Ref<4957.0.72.35838>},
       {{ch_publisher,<5764.7641.0>},#Ref<4957.0.72.35881>},
       {{credit_to,<5764.8761.0>},39},
       {{ch_publisher,<5764.8464.0>},#Ref<4957.0.72.35306>},
       {{ch_publisher,<5764.7944.0>},#Ref<4957.0.72.34856>},
       {{ch_publisher,<5764.8949.0>},#Ref<4957.0.72.35550>},
       {{ch_publisher,<5764.9275.0>},#Ref<4957.0.72.37194>},
       {{credit_to,<5764.9243.0>},32},
       {{credit_to,<5764.8756.0>},33},
       {{credit_to,<5764.7806.0>},32},
       {{ch_publisher,<5764.7766.0>},#Ref<4957.0.72.34729>},
       {{credit_to,<5764.8456.0>},32},
       {{credit_to,<5764.7508.0>},25},
       {{ch,<5764.6833.0>},
        {cr,<5764.6833.0>,#Ref<4957.0.72.33586>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6832.0>,true},
            false,8}},
       {{credit_to,<5764.8468.0>},45},
       {{ch_publisher,<5764.9143.0>},#Ref<4957.0.72.36150>},
       {{credit_to,<5764.8657.0>},38},
       {{ch_publisher,<5764.9051.0>},#Ref<4957.0.72.35554>},
       {{credit_to,<5764.7553.0>},30},
       {{credit_to,<5764.9091.0>},42},
       {{credit_to,<5764.8721.0>},29},
       {{ch_publisher,<5764.8809.0>},#Ref<4957.0.72.35749>},
       {{credit_to,<5764.8334.0>},34},
       {{ch_publisher,<5764.8265.0>},#Ref<4957.0.72.35133>},
       {{credit_to,<5764.8820.0>},41},
       {{credit_to,<5764.9463.0>},47},
       {{credit_to,<5764.7531.0>},28},
       {{credit_to,<5764.8932.0>},31},
       {{credit_to,<5764.8492.0>},35},
       {{credit_to,<5764.7555.0>},29},
       {{credit_to,<5764.7964.0>},34},
       {{credit_to,<5764.8335.0>},33},
       {{credit_to,<5764.8541.0>},29},
       {{ch_publisher,<5764.9015.0>},#Ref<4957.0.72.35844>},
       {{ch_publisher,<5764.8651.0>},#Ref<4957.0.72.35490>},
       {{ch_publisher,<5764.8725.0>},#Ref<4957.0.72.35436>},
       {{ch_publisher,<5764.7719.0>},#Ref<4957.0.72.34104>},
       {{credit_to,<5764.7987.0>},32},
       {{credit_to,<5764.9035.0>},36},
       {{credit_to,<5764.8629.0>},35},
       {{ch_publisher,<5764.7365.0>},#Ref<4957.0.72.33775>},
       {{ch_publisher,<5764.8521.0>},#Ref<4957.0.72.35450>},
       {{credit_to,<5764.9215.0>},37},
       {{credit_to,<5764.8858.0>},35},
       {{credit_to,<5764.8182.0>},31},
       {{credit_to,<5764.8712.0>},40},
       {{ch_publisher,<5764.7942.0>},#Ref<4957.0.72.34858>},
       {{credit_to,<5764.8272.0>},32},
       {{ch_publisher,<5764.9255.0>},#Ref<4957.0.72.37173>},
       {{ch_publisher,<5764.7868.0>},#Ref<4957.0.72.34796>},
       {{credit_to,<5764.8773.0>},31},
       {{credit_to,<5764.7945.0>},29},
       {{credit_to,<5764.8418.0>},34},
       {{ch,<5764.7033.0>},
        {cr,<5764.7033.0>,#Ref<4957.0.72.33638>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7030.0>,true},
            false,7}},
       {{credit_to,<5764.7768.0>},29},
       {{ch_publisher,<5764.9135.0>},#Ref<4957.0.72.35826>},
       {{ch_publisher,<5764.9555.0>},#Ref<4957.0.72.40293>},
       {{credit_to,<5764.7457.0>},33},
       {{credit_to,<5764.9067.0>},31},
       {{credit_to,<5764.9159.0>},27},
       {{ch_publisher,<5764.9211.0>},#Ref<4957.0.72.37099>},
       {{credit_to,<5764.9055.0>},41},
       {{credit_to,<5764.9347.0>},44},
       {{credit_to,<5764.8441.0>},40},
       {{ch_publisher,<5764.7431.0>},#Ref<4957.0.72.33836>},
       {{credit_to,<5764.8489.0>},34},
       {{ch_publisher,<5764.8165.0>},#Ref<4957.0.72.35065>},
       {{credit_to,<5764.7479.0>},34},
       {{credit_to,<5764.8764.0>},33},
       {{credit_to,<5764.7965.0>},45},
       {{ch_publisher,<5764.8454.0>},#Ref<4957.0.72.35186>},
       {{ch,<5764.6893.0>},
        {cr,<5764.6893.0>,#Ref<4957.0.72.33600>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6890.0>,true},
            false,8}},
       {{credit_to,<5764.8462.0>},33},
       {{ch_publisher,<5764.7870.0>},#Ref<4957.0.72.34748>},
       {{ch_publisher,<5764.9005.0>},#Ref<4957.0.72.36136>},
       {{ch_publisher,<5764.8453.0>},#Ref<4957.0.72.35571>},
       {{ch_publisher,<5764.8766.0>},#Ref<4957.0.72.35343>},
       {{ch_publisher,<5764.7964.0>},#Ref<4957.0.72.34874>},
       {{ch_publisher,<5764.8334.0>},#Ref<4957.0.72.35357>},
       {{ch_publisher,<5764.7938.0>},#Ref<4957.0.72.34977>},
       {{credit_to,<5764.9530.0>},45},
       {{credit_to,<5764.8187.0>},40},
       {{credit_to,<5764.9227.0>},34},
       {{credit_to,<5764.8700.0>},32},
       {{ch_publisher,<5764.9559.0>},#Ref<4957.0.72.40261>},
       {{ch_publisher,<5764.7781.0>},#Ref<4957.0.72.34743>},
       {{ch_publisher,<5764.9019.0>},#Ref<4957.0.72.36166>},
       {{credit_to,<5764.8863.0>},39},
       {{ch_publisher,<5764.8625.0>},#Ref<4957.0.72.35700>},
       {{ch_publisher,<5764.7936.0>},#Ref<4957.0.72.35070>},
       {{ch_publisher,<5764.8916.0>},#Ref<4957.0.72.35836>},
       {{credit_to,<5764.9531.0>},42},
       {{ch_publisher,<5764.7876.0>},#Ref<4957.0.72.34922>},
       {{credit_to,<5764.9535.0>},48},
       {{credit_to,<5764.7641.0>},31},
       {{ch_publisher,<5764.8114.0>},#Ref<4957.0.72.35072>},
       {{ch_publisher,<5764.8504.0>},#Ref<4957.0.72.35542>},
       {{credit_to,<5764.7710.0>},35},
       {{credit_to,<5764.8262.0>},45},
       {{ch_publisher,<5764.9435.0>},#Ref<4957.0.72.39059>},
       {{ch_publisher,<5764.7768.0>},#Ref<4957.0.72.34769>},
       {{credit_to,<5764.7935.0>},33},
       {{ch_publisher,<5764.7496.0>},#Ref<4957.0.72.33979>},
       {{credit_to,<5764.7454.0>},33},
       {{ch_publisher,<5764.8961.0>},#Ref<4957.0.72.35834>},
       {{ch_publisher,<5764.9480.0>},#Ref<4957.0.72.39067>},
       {{credit_to,<5764.8116.0>},29},
       {{ch_publisher,<5764.7500.0>},#Ref<4957.0.72.33969>},
       {{credit_to,<5764.8392.0>},32},
       {{ch_publisher,<5764.8023.0>},#Ref<4957.0.72.35059>},
       {{ch_publisher,<5764.8108.0>},#Ref<4957.0.72.34920>},
       {{credit_to,<5764.8244.0>},38},
       {{ch_publisher,<5764.8952.0>},#Ref<4957.0.72.35874>},
       {{ch_publisher,<5764.9033.0>},#Ref<4957.0.72.37134>},
       {credit_blocked,[]},
       {{ch_publisher,<5764.7965.0>},#Ref<4957.0.72.34864>},
       {{ch_publisher,<5764.9039.0>},#Ref<4957.0.72.36162>},
       {{ch_publisher,<5764.8418.0>},#Ref<4957.0.72.35510>},
       {{credit_to,<5764.9415.0>},47},
       {{ch_publisher,<5764.9251.0>},#Ref<4957.0.72.37221>},
       {{credit_to,<5764.9255.0>},29},
       {{credit_to,<5764.7937.0>},27},
       {{ch_publisher,<5764.8780.0>},#Ref<4957.0.72.35602>},
       {{credit_to,<5764.9002.0>},42},
       {{ch_publisher,<5764.9071.0>},#Ref<4957.0.72.35791>},
       {{credit_to,<5764.9373.0>},43},
       {{ch_publisher,<5764.9495.0>},#Ref<4957.0.72.40212>},
       {{credit_to,<5764.9507.0>},42},
       {{ch_publisher,<5764.8465.0>},#Ref<4957.0.72.35673>},
       {{credit_to,<5764.8030.0>},33},
       {{credit_to,<5764.8769.0>},29},
       {{ch,<5764.6945.0>},
        {cr,<5764.6945.0>,#Ref<4957.0.72.33610>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.6939.0>,true},
            false,8}},
       {{ch_publisher,<5764.8252.0>},#Ref<4957.0.72.35163>},
       {{credit_to,<5764.9119.0>},42},
       {{credit_to,<5764.9267.0>},31},
       {{ch_publisher,<5764.8820.0>},#Ref<4957.0.72.37158>},
       {{credit_to,<5764.7589.0>},33},
       {{ch_publisher,<5764.8769.0>},#Ref<4957.0.72.35334>},
       {{ch_publisher,<5764.9231.0>},#Ref<4957.0.72.37160>},
       {{ch_publisher,<5764.8493.0>},#Ref<4957.0.72.35492>},
       {{credit_to,<5764.7561.0>},33},
       {{ch_publisher,<5764.8866.0>},#Ref<4957.0.72.35761>},
       {{credit_to,<5764.8852.0>},45},
       {{credit_to,<5764.7387.0>},32},
       {{ch_publisher,<5764.9390.0>},#Ref<4957.0.72.39044>},
       {{credit_to,<5764.8222.0>},34},
       {{ch_publisher,<5764.8228.0>},#Ref<4957.0.72.35080>},
       {{credit_to,<5764.7571.0>},29},
       {{credit_to,<5764.9434.0>},45},
       {{credit_to,<5764.8846.0>},42},
       {{credit_to,<5764.7792.0>},29},
       {{credit_to,<5764.7585.0>},33},
       {{credit_to,<5764.8766.0>},35},
       {{ch_publisher,<5764.9247.0>},#Ref<4957.0.72.37124>},
       {{ch_publisher,<5764.9375.0>},#Ref<4957.0.72.38880>},
       {{credit_to,<5764.9088.0>},32},
       {{ch_publisher,<5764.8241.0>},#Ref<4957.0.72.35460>},
       {{ch_publisher,<5764.8344.0>},#Ref<4957.0.72.35149>},
       {{ch_publisher,<5764.9463.0>},#Ref<4957.0.72.38941>},
       {{ch_publisher,<5764.8955.0>},#Ref<4957.0.72.35496>},
       {{ch_publisher,<5764.7807.0>},#Ref<4957.0.72.35032>},
       {{ch_publisher,<5764.9359.0>},#Ref<4957.0.72.39064>},
       {{ch_publisher,<5764.8130.0>},#Ref<4957.0.72.35039>},
       {{credit_to,<5764.8633.0>},42},
       {{ch_publisher,<5764.8954.0>},#Ref<4957.0.72.35600>},
       {{ch_publisher,<5764.8622.0>},#Ref<4957.0.72.35819>},
       {{credit_to,<5764.7936.0>},35},
       {{ch_publisher,<5764.8505.0>},#Ref<4957.0.72.35068>},
       {{credit_to,<5764.9135.0>},43},
       {{ch,<5764.7129.0>},
        {cr,<5764.7129.0>,#Ref<4957.0.72.33664>,
            {set,0,16,16,8,80,48,
                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
            1,
            {[],[]},
            {token,<5764.7128.0>,true},
            false,7}},
       {{credit_to,<5764.7429.0>},35},
       {{ch_publisher,<5764.8115.0>},#Ref<4957.0.72.35061>},
       {{credit_to,<5764.7876.0>},31},
       {{ch_publisher,<5764.7508.0>},#Ref<4957.0.72.33972>},
       {{credit_to,<5764.7404.0>},32}]},
  {trap_exit,true},
  {error_handler,error_handler},
  {priority,normal},
  {group_leader,<4957.471.0>},
  {total_heap_size,22220125},
  {heap_size,2629425},
  {stack_size,41},
  {reductions,3565790275},
  {garbage_collection,
      [{min_bin_vheap_size,46368},
       {min_heap_size,233},
       {fullsweep_after,65535},
       {minor_gcs,14}]},
  {suspending,[]}]}
...done.


From paddy.carman at gmail.com  Mon Aug 13 17:55:07 2012
From: paddy.carman at gmail.com (PC)
Date: Mon, 13 Aug 2012 09:55:07 -0700 (PDT)
Subject: [rabbitmq-discuss] How to determine originator of a message?
Message-ID: <f1758a8f-9f64-40d6-8ccb-eaf4290b091b@googlegroups.com>

Hi - 
    When a message is received at a client for a particular topic (or 
queue), is it possible to determine who was the originator of the message?
Thanks,
PC 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120813/d91e4fca/attachment.htm>

From emile at rabbitmq.com  Tue Aug 14 08:18:55 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 14 Aug 2012 08:18:55 +0100
Subject: [rabbitmq-discuss] How to determine originator of a message?
In-Reply-To: <f1758a8f-9f64-40d6-8ccb-eaf4290b091b@googlegroups.com>
References: <f1758a8f-9f64-40d6-8ccb-eaf4290b091b@googlegroups.com>
Message-ID: <5029FBDF.2060603@rabbitmq.com>

Hi,

On 13/08/12 17:55, PC wrote:
>     When a message is received at a client for a particular topic (or
> queue), is it possible to determine who was the originator of the message?

No, not unless the the publisher annotated the message in some way, but
publishers are under no obligation to disclose their identity. The
broker will validate the user-id property in messages, if the publisher
chooses to disclose its identity using that property. See

http://www.rabbitmq.com/validated-user-id.html



-Emile


From matthias at rabbitmq.com  Tue Aug 14 09:38:46 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Aug 2012 09:38:46 +0100
Subject: [rabbitmq-discuss] The RabbitMQ uses very much memory in the
 cluster pattern
In-Reply-To: <CAGd7T31=zMWuPEpbYcdKtvH3VTqZv3Gq+WhoGa9+9S-H5pDF4w@mail.gmail.com>
References: <CAGd7T32_Fz+my6WdAk_SMSNcAD-yQ5gu6yGxxKRo2bU7gOZMvQ@mail.gmail.com>
	<5028AAE0.8030706@rabbitmq.com>
	<CAGd7T32FW24UMU6gZc0_n5-Dy14fOO-RPd3gkr43dAcp=S=q3A@mail.gmail.com>
	<5029D048.5010704@rabbitmq.com>
	<CAGd7T31=zMWuPEpbYcdKtvH3VTqZv3Gq+WhoGa9+9S-H5pDF4w@mail.gmail.com>
Message-ID: <502A0E96.2000509@rabbitmq.com>

On 14/08/12 07:14, Liu Hao wrote:
>       The connections and channels are actually too much. I decrease the
> connections and channels. Now, I have 40 consumer connections (one
> connection with one channel), and 50 producer connections (one
> connection with 10 channels). The memory is the same , acquires a lot.
>
>       But I find an interesting fact that If I use 50 producer
> connections (one connection with only one channel) , the memory will be
> under 2G, but the most connections are flowed and the publish rate is
> too slow.
>
>       This is just a test demo, and one message is 10KB.
>
>       The command report is so big(35M), and I give the beginning and
> the end of the output to you as the attachment.

I think you are simply pushing rabbit beyond the limit of its 
capability. Internal flow control happens on a per-process-link basis, 
so when you increase the number of publishing channels that corresponds 
to a linear increase in the amount of internal buffer space that is 
potentially required. To the point where all memory is taken up by 
messages sitting in these buffers.

Publishing across nodes carries an extra cost, so the buffers will fill 
up at lower publishing rates.

If with 50 producer connections x 1 channel you see most connections 
flowed, then that is an indications that rabbit is already operating at 
capacity but is still able to keep overall memory use under control. 
Adding more producer connections/channels will not increase the 
sustainable sending rate but will degrade rabbit's ability to control 
memory use.


Btw, I suggest you upgrade to the latest rabbit version - the flow 
control code has changed somewhat and there have been some performance 
improvements.

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Aug 14 09:46:18 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Aug 2012 09:46:18 +0100
Subject: [rabbitmq-discuss] The RabbitMQ uses very much memory in the
 cluster pattern
In-Reply-To: <502A0E96.2000509@rabbitmq.com>
References: <CAGd7T32_Fz+my6WdAk_SMSNcAD-yQ5gu6yGxxKRo2bU7gOZMvQ@mail.gmail.com>
	<5028AAE0.8030706@rabbitmq.com>
	<CAGd7T32FW24UMU6gZc0_n5-Dy14fOO-RPd3gkr43dAcp=S=q3A@mail.gmail.com>
	<5029D048.5010704@rabbitmq.com>
	<CAGd7T31=zMWuPEpbYcdKtvH3VTqZv3Gq+WhoGa9+9S-H5pDF4w@mail.gmail.com>
	<502A0E96.2000509@rabbitmq.com>
Message-ID: <502A105A.305@rabbitmq.com>

On 14/08/12 09:38, Matthias Radestock wrote:
> Btw, I suggest you upgrade to the latest rabbit version - the flow
> control code has changed somewhat and there have been some performance
> improvements.

You may also want to enable hipe compilation - see 
http://www.rabbitmq.com/configure.html.

I doubt any of this will make much difference though since the 
bottleneck in your system are the queues, and hipe compilation and most 
of the performance improvements have little impact on queue performance.

Matthias.

From emile at rabbitmq.com  Tue Aug 14 10:02:12 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 14 Aug 2012 10:02:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ - Service Crash
In-Reply-To: <A33D44D3C6F1D54AA679F7A3B0995E23237BA566@Nutdc.Nutcracker.local>
References: <A33D44D3C6F1D54AA679F7A3B0995E23237BA566@Nutdc.Nutcracker.local>
Message-ID: <502A1414.9070306@rabbitmq.com>

Hi Ryan,

On 14/08/12 06:45, Ryan Gunn wrote:
> ** FATAL ** Cannot open log file
> "c:/Users/MyUser/AppData/Roaming/RabbitMQ/db/rabbit at SERVER001-mnesia/rabbit_durable_route.DCL":
> {file_error, 
> "c:/Users/MyUser/AppData/Roaming/RabbitMQ/db/rabbit at SERVER001-mnesia/rabbit_durable_route.DCL",
> system_limit}

Check the OS eventlog. Is there any reason why the OS might prevent a
process from creating the file in question? Try creating the same file
as the same user that the broker runs as and see if you get any errors.


-Emile


From minslovey at gmail.com  Tue Aug 14 08:54:53 2012
From: minslovey at gmail.com (Min Cha)
Date: Tue, 14 Aug 2012 16:54:53 +0900
Subject: [rabbitmq-discuss] When I declared mirrored queues using
 spring-rabbit API, one of them is sometimes failed.
Message-ID: <CA+_TFtGzfYZu=WSxs0Sk1XYFPsVXZWVO6uWopEfQjJLYPhqqUw@mail.gmail.com>

Hi all.
First of all, thanks for rabbitmq team & community. With rabbitmq, our
production environment has been improving.
I am very pleased if you help me.

*Environment*

1. rabbit-mq 2.8.4(and java client 2.8.4), spring-amqp 1.1.0, spring-rabbit
1.1.0.
2. erlang RB15B01

*Problem*

1. When I declared mirrored queues using spring-rabbit API, one of them is
sometimes failed.
2. As a result, the failed queue(s) does not exist.
3. When I rerun my code without any changes, it is sometimes success.
4. Code for declaring the queues is as following.

*<bean id="notificationAddCommentQueue"
class="org.springframework.amqp.core.Queue">*
* <constructor-arg name="name" value="cafe.notification.addComment" />*
* <constructor-arg name="autoDelete" value="false" />*
* <constructor-arg name="exclusive" value="false" />*
* <constructor-arg name="durable" value="true" />*
* <constructor-arg name="arguments">*
* <map>*
* <entry key="x-ha-policy" value="all" />*
* </map>*
* </constructor-arg>*
*</bean>*
*
*
*...*

*for (Queue queue : queues) {*
*  rabbitAdmin.deleteQueue(queue.getName());*
*  rabbitAdmin.declareQueue(queue);*
*}*

5. Error logs on rabbitmq-server is as following.

*=INFO REPORT==== 14-Aug-2012::16:32:05 ===*
*Mirrored-queue (queue 'cafe.ping' in vhost 'cafe'): Promoting slave
<mq1 at NVCAFMQ1501.3.853.2> to master*
*
*
*=ERROR REPORT==== 14-Aug-2012::16:32:06 ===*
*** Generic server <0.854.2> terminating*
*** Last message in was {'$gen_cast',*
*                        {broadcast,*
*                         {delete_and_terminate,*
*                          {{case_clause,{error,not_found}},*
*                           [{rabbit_amqqueue_process,i,2,[]},*
*
{rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,*
*                             []},*
*
{rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,*
*                             []},*
*                            {rabbit_amqqueue_process,infos,2,[]},*
*                            {rabbit_amqqueue_process,emit_stats,2,[]},*
*                            {rabbit_event,if_enabled,3,[]},*
*
{rabbit_amqqueue_process,handle_pre_hibernate,1,*
*                             []},*
*                            {gen_server2,pre_hibernate,1,[]}]}}}}*
*** When Server state == {state,*
*                            {4,<0.854.2>},*
*                            {{4,<0.854.2>},undefined},*
*                            {{4,<0.854.2>},undefined},*
*                            {resource,<<"cafe">>,queue,<<"cafe.ping">>},*
*                            rabbit_mirror_queue_coordinator,*
*                            {9,*
*                             [{{4,<0.854.2>},*
*                               {view_member,*
*                                   {4,<0.854.2>},*
*                                   [],*
*                                   {4,<0.854.2>},*
*                                   {4,<0.854.2>}}}]},*
*                            4,[],*
*                            [<0.855.2>],*
*                            {[],[]},*
*                            [],undefined}*
*** Reason for termination == *
*** {{case_clause,{error,not_found}},*
*    [{rabbit_amqqueue_process,i,2,[]},*
*     {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},*
*     {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},*
*     {rabbit_amqqueue_process,infos,2,[]},*
*     {rabbit_amqqueue_process,emit_stats,2,[]},*
*     {rabbit_event,if_enabled,3,[]},*
*     {rabbit_amqqueue_process,handle_pre_hibernate,1,[]},*
*     {gen_server2,pre_hibernate,1,[]}]}*


                                 [{file,"proc_lib.erl"},{line,227}]}]}}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"cafe">>,queue,<<"cafe.ping">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <0.22597.1>,[],all},
                         none,false,rabbit_mirror_queue_master,
                         {state,<0.22598.1>,<0.22781.1>,
                          rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {1,
                            {[{msg_status,0,

 <<176,245,83,92,212,158,235,71,163,59,227,246,
                                 180,233,129,198>>,
                               {basic_message,

{resource,<<"cafe">>,exchange,<<"cafe.ping">>},
                                [<<"cafe.ping">>],
                                {content,60,
                                 {'P_basic',<<"application/json">>,
                                  <<"UTF-8">>,
                                  [{<<"__TypeId__">>,longstr,
                                    <<"java.lang.String">>}],

2,0,undefined,undefined,undefined,undefined,
                                  undefined,undefined,undefined,undefined,
                                  undefined},

 <<248,0,16,97,112,112,108,105,99,97,116,105,

 111,110,47,106,115,111,110,5,85,84,70,45,56,

 0,0,0,32,10,95,95,84,121,112,101,73,100,95,

 95,83,0,0,0,16,106,97,118,97,46,108,97,110,
                                   103,46,83,116,114,105,110,103,2,0>>,
                                 rabbit_framing_amqp_0_9_1,
                                 [<<"\"NVCAFBE1501.nhnjp.ism
cafe-api-server : Tue Aug 14 16:32:03 JST 2012\"">>]},

<<176,245,83,92,212,158,235,71,163,59,227,246,
                                  180,233,129,198>>,
                                true},
                               true,false,true,true,
                               {message_properties,undefined,false}}],
                             []}},
                           1,
                           {0,nil},
                           undefined,
                           {0,nil},
                           {qistate,

"/home/www/rabbitmq_server-2.8.4/sbin/../var/lib/rabbitmq/mnesia/mq2/queues/9QF3UUJUE12OVYVA26GQJ1FFU",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

...




-- 
Min Cha, Software Developer

Projects involved
- CoRepository : https://github.com/MinCha/corepository
- Good-Samples : http://code.google.com/p/good-samples/

Blog
- (Eng) http://minslovey.blogspot.com
- (Kor) http://minslovey.tistory.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/dc8d9767/attachment.htm>

From adam at petrovic.com.au  Tue Aug 14 08:59:28 2012
From: adam at petrovic.com.au (Adam Petrovic)
Date: Tue, 14 Aug 2012 00:59:28 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Warrens
Message-ID: <c41c2b2d-47d4-4b09-8556-159ad4e93ddf@googlegroups.com>

Hi. I am just reading up about the concept of HAProxy load-balanced warrens 
(active / standby nodes) and I can't quite come up with a solution to a 
bugging question.

I understand that the concept of the load balanced warren is for HAProxy to 
automatically fail over to the standby node, should the active node fail 
and go down. In doing so, any existing messages on the active node would be 
lost until this node is brought back up.

Which brings me to my question, what happens to the pending (still to be 
consumed) messages on the standby node when the active node is brought back 
up. Are they lost, or should the application logic handle this itself? 
Because as far as I know, HAProxy has no way of dealing with this issue.

Regards,

Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/721545c5/attachment.htm>

From vitaly.krugl.numenta at gmail.com  Tue Aug 14 09:07:14 2012
From: vitaly.krugl.numenta at gmail.com (vitaly)
Date: Tue, 14 Aug 2012 01:07:14 -0700 (PDT)
Subject: [rabbitmq-discuss] haigha 0.5.3 crashes when closing channel
Message-ID: <ff6b6a8a-b8a1-49eb-a571-a11181a6c71f@googlegroups.com>

Closing a channel in haigha 0.5.3 (using gevent transport) crashes when 
closing channel.  The traceback looks like this:

Traceback (most recent call last):
  File 
"/Users/vkrug/nta/current/lib/python2.6/site-packages/gevent/greenlet.py", 
line 328, in run
    result = self._run(*self.args, **self.kwargs)
  File "haigha_channel_test.py", line 57, in readFrames
    conn.read_frames()
  File 
"/Users/vkrug/Packages/haigha/haigha-0.5.3/build/lib/haigha/connection.py", 
line 354, in read_frames
    self._transport.process_channels( p_channels )
  File 
"/Users/vkrug/Packages/haigha/haigha-0.5.3/build/lib/haigha/transports/transport.py", 
line 38, in process_channels
    channel.process_frames()
  File 
"/Users/vkrug/Packages/haigha/haigha-0.5.3/build/lib/haigha/channel.py", 
line 208, in process_frames
    self.close( 500, "Failed to dispatch %s"%(str(frame)) )
  File 
"/Users/vkrug/Packages/haigha/haigha-0.5.3/build/lib/haigha/channel.py", 
line 156, in close
    self.channel.close(reply_code, reply_text, class_id, method_id)
AttributeError: 'Channel' object has no attribute 'channel'
<Greenlet at 0x1009d42f8: readFrames(conn=<haigha.connection.Connection 
object at 0x1009de45)> failed with AttributeError

Filed as https://github.com/agoragames/haigha/issues/24
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/cf466201/attachment.htm>

From vitaly.krugl.numenta at gmail.com  Tue Aug 14 09:12:37 2012
From: vitaly.krugl.numenta at gmail.com (vitaly)
Date: Tue, 14 Aug 2012 01:12:37 -0700 (PDT)
Subject: [rabbitmq-discuss] haigha 0.5.1 - 0.5.3 gevent transport is broken
Message-ID: <bcde0fea-0f9c-4e6a-9a61-046d7f252f9c@googlegroups.com>

Ever since haigha 0.5.1, GeventTransport relies on SocketTransport to 
create the socket. Since SocketTransport creates a regular built-in 
socket.socket (not gevent.socket), GeventTransport is no longer 
gevent-compatible/friendly.  The socket calls now block and control doesn't 
switch to other Greenlets.

Filed as https://github.com/agoragames/haigha/issues/22
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/a85dee8b/attachment.htm>

From ernest.staszuk at comarch.pl  Tue Aug 14 10:33:33 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Tue, 14 Aug 2012 11:33:33 +0200
Subject: [rabbitmq-discuss] How to determine originator of a message?
In-Reply-To: <f1758a8f-9f64-40d6-8ccb-eaf4290b091b@googlegroups.com>
References: <f1758a8f-9f64-40d6-8ccb-eaf4290b091b@googlegroups.com>
Message-ID: <502A1B6D.8040006@comarch.pl>

Could you specify what you would like to achieve by knowing publisher?

Regards,
Ernest Staszuk

W dniu 2012-08-13 18:55, PC pisze:
> Hi -
>     When a message is received at a client for a particular topic (or 
> queue), is it possible to determine who was the originator of the message?
> Thanks,
> PC
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/aa36d4ab/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 14 12:20:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Aug 2012 12:20:48 +0100
Subject: [rabbitmq-discuss] When I declared mirrored queues using
 spring-rabbit API, one of them is sometimes failed.
In-Reply-To: <CA+_TFtGzfYZu=WSxs0Sk1XYFPsVXZWVO6uWopEfQjJLYPhqqUw@mail.gmail.com>
References: <CA+_TFtGzfYZu=WSxs0Sk1XYFPsVXZWVO6uWopEfQjJLYPhqqUw@mail.gmail.com>
Message-ID: <502A3490.8070806@rabbitmq.com>

On 14/08/12 08:54, Min Cha wrote:
> *Environment*
>
> 1. rabbit-mq 2.8.4(and java client 2.8.4), spring-amqp 1.1.0,
> spring-rabbit 1.1.0.
> 2. erlang RB15B01
>
> *Problem*
>
> 1. When I declared mirrored queues using spring-rabbit API, one of them
> is sometimes failed.
> 2. As a result, the failed queue(s) does not exist.
> 3. When I rerun my code without any changes, it is sometimes success.
> 4. Code for declaring the queues is as following.


> /for (Queue queue : queues) {/
> /  rabbitAdmin.deleteQueue(queue.getName());/
> /  rabbitAdmin.declareQueue(queue);/
> /}/

 From 
http://lists.rabbitmq.com/pipermail/rabbitmq-announce/attachments/20120802/e4ad3dd3/attachment.txt
<quote>
rapidly declaring and then deleting HA queues no longer crashes the master
</quote>

So please upgrade to 2.8.5.


Regards,

Matthias.

From jon.bergli.heier at zisson.no  Tue Aug 14 13:27:26 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Tue, 14 Aug 2012 12:27:26 +0000
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>

Hello.

I have a cluster consisting of two nodes, and brokers shoveling messages to the cluster using the
shovel plugin. When testing failover with the shovel plugins (by stopping the RabbitMQ nodes) I often
see that when starting a node after stopping it causes the shovel plugin to stop receiving acks for
messages. I have prefetch_count set to 1000 in the shovel config, and I see that "unacked" in the
management interface for the queue rises to 1000 and sits there, with "ready" steadily increasing.
The connection seems to be alive as I can see (via tcpdump) that there are heartbeats being sent.
All RabbitMQ servers are 2.8.5 on Erlang R14A. This only seems to happen with setting ack_mode
set to on_confirm. The queues on the cluster are mirrored using x-ha-policy: all.

Any help or ideas much appreciated.

Jon

From m.luchak at smartasking.com  Tue Aug 14 13:33:05 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Tue, 14 Aug 2012 08:33:05 -0400 (EDT)
Subject: [rabbitmq-discuss]
 =?utf-8?q?How_to_determine_originator_of_a_mes?= =?utf-8?q?sage=3F?=
In-Reply-To: <5029FBDF.2060603@rabbitmq.com>
References: <f1758a8f-9f64-40d6-8ccb-eaf4290b091b@googlegroups.com> 
	<5029FBDF.2060603@rabbitmq.com>
Message-ID: <1344947585.34991727@apps.rackspace.com>


You can use props to tag msgs anyway you like..
 

 AMQP.BasicProperties props = new AMQP.BasicProperties();
 
 BasicProperties.Builder prop = props.builder();
 prop.messageId(msgID);
 prop.deliveryMode(2);
 prop.userId(UserID);
 
 
 
-----Original Message-----
From: "Emile Joubert" <emile at rabbitmq.com>
Sent: Tuesday, August 14, 2012 3:18am
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "PC" <paddy.carman at gmail.com>
Subject: Re: [rabbitmq-discuss] How to determine originator of a message?



Hi,

On 13/08/12 17:55, PC wrote:
>     When a message is received at a client for a particular topic (or
> queue), is it possible to determine who was the originator of the message?

No, not unless the the publisher annotated the message in some way, but
publishers are under no obligation to disclose their identity. The
broker will validate the user-id property in messages, if the publisher
chooses to disclose its identity using that property. See

http://www.rabbitmq.com/validated-user-id.html



-Emile

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/2e37b08f/attachment.htm>

From m.luchak at smartasking.com  Tue Aug 14 13:39:00 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Tue, 14 Aug 2012 08:39:00 -0400 (EDT)
Subject: [rabbitmq-discuss]
 =?utf-8?q?Application_Architecture_Question_?=
 =?utf-8?q?=28topic_routing_+_fanout_broadcasting=29=3F?=
In-Reply-To: <CA+CC+HN_9oL=zV8K0Whe=Y5aP5MBXf4iCKv4E=XQ5PniHwWauQ@mail.gmail.com>
References: <CA+CC+HN_9oL=zV8K0Whe=Y5aP5MBXf4iCKv4E=XQ5PniHwWauQ@mail.gmail.com>
Message-ID: <1344947940.6658540@apps.rackspace.com>


Hi Andy,
 
The exchange to exchange binding is IMHO the way to go.  You can create "user" exchanges bound to the origin exchange(s) with the binding keys that you require and temp Qs that bind to the "user" exchanges...
 
 
-----Original Message-----
From: "Andrew Barringer" <abarringer at gmail.com>
Sent: Tuesday, August 14, 2012 1:16am
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Application Architecture Question (topic routing + fanout broadcasting)?



All,

I'm new to Queuing so please be patient.

I'm trying to build an app to support the following scenario.

We have a database with keys like

state.zipcode.itemtype.details  as new items are entered we want all subscribers to get the data. 

A person can subscribe using wildcards(# or *) in any of the positions. 

For instance given the following data entry keys

ny.12345.vehicles.cars  
ny.12346.boats.jetskies
tn.37775.vehicles.trucks

We want many subscribers to have the ability to create a filters like ny.#.cars to get all cars in NY. Or  they may want to say  #.jetskies or ny.*.boats.# etc etc.. anyways end users need the ability to create complex filters.

The hard part is with a topic exchange/queue only one subscriber is going to get an item when it hits the exchange/queue. I really need a combination of topic + fanout.

Can I create the exchange as a topic and route it to another fanout exchange where the end user is a queue?  Does the ruby amqp gem support exchange to exchange bindings?

Did any of that even make sense?  :D

Any help would be appreciated.

Thanks,
Andy

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/6e8700fc/attachment.htm>

From francesco at rabbitmq.com  Tue Aug 14 13:43:12 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 14 Aug 2012 13:43:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ failover/recovery
In-Reply-To: <1C9888BB42C16344B1C280C07DC8D78D03FA2AAC@INWPIEXC01.SATS.CORP>
References: <1C9888BB42C16344B1C280C07DC8D78D03FA2AAC@INWPIEXC01.SATS.CORP>
Message-ID: <878vdhprtr.wl%francesco@rabbitmq.com>

Hi Edward,

At Fri, 10 Aug 2012 16:30:53 +0000,
Wax, Edward wrote:
> I?m working with a RabbitMQ HA Cluster and have a question regarding
> failover/recovery.
> 
> RabbitMQ in Action has a section on rethinking code layout to accommodate for
> RabbitMQ failures.  It uses a standard consumer/producer model.  Does anybody
> have experience with RabbitMQ failover in an event-driven, asynchronous
> application.

Your question is quite vague.  Could you give more details about the problems
you're encountering?  HA is not that much related to how you send and consume
messages, so I can't see any obvious issues that should arise.  I'll take a look
at the book to check if that makes the issue clearer.

--
Francesco * Often in error, never in doubt

From liuhaobupt at gmail.com  Tue Aug 14 13:42:12 2012
From: liuhaobupt at gmail.com (Liu Hao)
Date: Tue, 14 Aug 2012 20:42:12 +0800
Subject: [rabbitmq-discuss] The RabbitMQ uses very much memory in the
 cluster pattern
In-Reply-To: <502A105A.305@rabbitmq.com>
References: <CAGd7T32_Fz+my6WdAk_SMSNcAD-yQ5gu6yGxxKRo2bU7gOZMvQ@mail.gmail.com>
	<5028AAE0.8030706@rabbitmq.com>
	<CAGd7T32FW24UMU6gZc0_n5-Dy14fOO-RPd3gkr43dAcp=S=q3A@mail.gmail.com>
	<5029D048.5010704@rabbitmq.com>
	<CAGd7T31=zMWuPEpbYcdKtvH3VTqZv3Gq+WhoGa9+9S-H5pDF4w@mail.gmail.com>
	<502A0E96.2000509@rabbitmq.com> <502A105A.305@rabbitmq.com>
Message-ID: <CAGd7T320Hz9caFg+RY6y=as_RrB-YGk9zLkS2FkW28G+pP68BQ@mail.gmail.com>

Thank you very much for your suggestions~

2012/8/14 Matthias Radestock <matthias at rabbitmq.com>

> On 14/08/12 09:38, Matthias Radestock wrote:
>
>> Btw, I suggest you upgrade to the latest rabbit version - the flow
>> control code has changed somewhat and there have been some performance
>> improvements.
>>
>
> You may also want to enable hipe compilation - see
> http://www.rabbitmq.com/**configure.html<http://www.rabbitmq.com/configure.html>
> .
>
> I doubt any of this will make much difference though since the bottleneck
> in your system are the queues, and hipe compilation and most of the
> performance improvements have little impact on queue performance.
>
> Matthias.
>



-- 
-------------------------------------------------------------
??
??????????????
??????
????: liuhaobupt at gmail.com
-------------------------------------------------------------
Liu Hao
State Key Laboratory of Networking & Switching Technology
Beijing University of Posts & Telecommunications
Email&Gtalk: liuhaobupt at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/f828e993/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 14 14:04:12 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Aug 2012 14:04:12 +0100
Subject: [rabbitmq-discuss] Application Architecture Question (topic
 routing + fanout broadcasting)?
In-Reply-To: <1344947940.6658540@apps.rackspace.com>
References: <CA+CC+HN_9oL=zV8K0Whe=Y5aP5MBXf4iCKv4E=XQ5PniHwWauQ@mail.gmail.com>
	<1344947940.6658540@apps.rackspace.com>
Message-ID: <502A4CCC.8040605@rabbitmq.com>

On 14/08/12 13:39, m.luchak at smartasking.com wrote:
> The exchange to exchange binding is IMHO the way to go.  You can create
> "user" exchanges bound to the origin exchange(s) with the binding keys
> that you require and temp Qs that bind to the "user" exchanges...

I don't think e2e is necessary here...

> -----Original Message-----
> From: "Andrew Barringer" <abarringer at gmail.com>
> [...]
> The hard part is with a topic exchange/queue only one subscriber is
> going to get an item when it hits the exchange/queue.

That is incorrect. Exchanges route messages to all queues with bindings 
that match the message. Is that not clear from our documentation, in 
particular the tutorials? The topic routing tutorial 
(http://www.rabbitmq.com/tutorials/tutorial-five-python.html) even has 
an example illustrating the routing of messages to multiple queues.

So simply give each subscriber their own queue and bind it to the 
exchange with the topic patterns describing their interests.

Regards,

Matthias.

From sunnybunny14 at gmail.com  Tue Aug 14 13:13:42 2012
From: sunnybunny14 at gmail.com (bunny)
Date: Tue, 14 Aug 2012 05:13:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Spring AMQP: would like to put message to queue
 and send ACK immediately
Message-ID: <dd6e670b-6539-4694-a5bd-f70ff1fff7b0@googlegroups.com>

 0 down vote favorite<http://stackoverflow.com/questions/11951508/spring-amqp-would-like-to-put-message-to-queue-and-send-ack-immediately#> 
  
I wrote Java application, that sends messages to RabbitMQ. Then Flume picks 
messages up from RabbitMQ queue. I'm interested that nobody pulls messages 
from the queue, except flume.

My application uses Spring AMQP Java plugin.
The problem: 

With the code below, message comes to RabbitMQ queue and stays 
'Unknowledges' for ever. As I understand, RabbitMQ is waiting for ACK from 
MessageListener, but MessageListener will never ACK. Does anybody have idea 
how to fix it?

The code:

public class MyAmqpConfiguration {

    @Autowired
    ConnectionFactory connectionFactory;

    @Bean
    public SimpleMessageListenerContainer messageListenerContainer() {

    SimpleMessageListenerContainer container = new SimpleMessageListenerContainer(connectionFactory);
    container.setQueues(activityLogsQueue());
    container.setMessageListener(MyMessageListener());
            container.setConcurrentConsumers(3);

    return container;
    }

        @Bean(name="myTemplate")
        public RabbitTemplate rabbitTemplate() {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        template.setMessageConverter(MyMessageConverter());
        return template;
        }
}


public class MyMessageListener implements MessageListener {


   public MyMessageListener(MessageConverter converter, MyMessageHandler<MyObject> messageHandler) {
      this.converter = converter;
      this.messageHandler = messageHandler;
    }

   @Override
   public void onMessage(Message message) {
     this.messageHandler.doThings();
   }

}

public class MyMessageHandler  {

     @Autowired
     @Qualifier("myTemplate")
     RabbitTemplate template;

     @Override
     public void handleMessage(MyObject thing) {
         template.convertAndSend(exchange, routingKey, thing);
     }

}


public class MyMessageConverter extends JsonMessageConverter {

    @Override
     protected Message createMessage(Object object, MessageProperties messageProperties) { 
        //do things
     }

     @Override
     public Object fromMessage(Message message) throws MessageConversionException {
         throw new UnsupportedOperationException("fromMessage is not supported in "+this.getClass().getName());
     }


}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/0e03e04c/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 14 14:16:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Aug 2012 14:16:22 +0100
Subject: [rabbitmq-discuss] Spring AMQP: would like to put message to
 queue and send ACK immediately
In-Reply-To: <dd6e670b-6539-4694-a5bd-f70ff1fff7b0@googlegroups.com>
References: <dd6e670b-6539-4694-a5bd-f70ff1fff7b0@googlegroups.com>
Message-ID: <502A4FA6.3020309@rabbitmq.com>

On 14/08/12 13:13, bunny wrote:
> My application uses Spring AMQP Java plugin.
>
>     The problem:
>
> With the code below, message comes to RabbitMQ queue and stays
> 'Unknowledges' for ever. As I understand, RabbitMQ is waiting for ACK
> from MessageListener, but MessageListener will never ACK. Does anybody
> have idea how to fix it?

I see you've already asked the same question on 
http://forum.springsource.org/forumdisplay.php?74-AMQP, which is the 
right place for that.

Regards,

Matthias.

From abarringer at gmail.com  Tue Aug 14 16:02:45 2012
From: abarringer at gmail.com (Andrew Barringer)
Date: Tue, 14 Aug 2012 10:02:45 -0500
Subject: [rabbitmq-discuss] Application Architecture Question (topic
 routing + fanout broadcasting)?
In-Reply-To: <502A4CCC.8040605@rabbitmq.com>
References: <CA+CC+HN_9oL=zV8K0Whe=Y5aP5MBXf4iCKv4E=XQ5PniHwWauQ@mail.gmail.com>
	<1344947940.6658540@apps.rackspace.com>
	<502A4CCC.8040605@rabbitmq.com>
Message-ID: <CA+CC+HMX42st5DJg-5Gt-1k2SHnt77YK49uN1zN==B4D=ab-2g@mail.gmail.com>

Matthias,

Thanks for the reply!

In retrospect tutorial five does seem blindingly obvious for this use case.
Not sure how I missed that.

Thanks,
Andy



On Tue, Aug 14, 2012 at 8:04 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 14/08/12 13:39, m.luchak at smartasking.com wrote:
>
>> The exchange to exchange binding is IMHO the way to go.  You can create
>> "user" exchanges bound to the origin exchange(s) with the binding keys
>> that you require and temp Qs that bind to the "user" exchanges...
>>
>
> I don't think e2e is necessary here...
>
>  -----Original Message-----
>> From: "Andrew Barringer" <abarringer at gmail.com>
>> [...]
>> The hard part is with a topic exchange/queue only one subscriber is
>> going to get an item when it hits the exchange/queue.
>>
>
> That is incorrect. Exchanges route messages to all queues with bindings
> that match the message. Is that not clear from our documentation, in
> particular the tutorials? The topic routing tutorial (
> http://www.rabbitmq.com/**tutorials/tutorial-five-**python.html<http://www.rabbitmq.com/tutorials/tutorial-five-python.html>)
> even has an example illustrating the routing of messages to multiple queues.
>
> So simply give each subscriber their own queue and bind it to the exchange
> with the topic patterns describing their interests.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/f9c4c6e8/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 14 16:59:59 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Aug 2012 16:59:59 +0100
Subject: [rabbitmq-discuss] Queue disappears during high volume
	federation
In-Reply-To: <CACLE7iwUNu37g-7hTL-OY3-L1WK-7zrKnZK0H6XvhJvn1C6ixA@mail.gmail.com>
References: <CACLE7iwUNu37g-7hTL-OY3-L1WK-7zrKnZK0H6XvhJvn1C6ixA@mail.gmail.com>
Message-ID: <502A75FF.4060204@rabbitmq.com>

Matt,

On 14/08/12 01:25, Matt Pietrek wrote:
> I'm hitting an issue where a queue disappears from underneath me in a
> high volume federated scenario.
>
> Background: I'm on RabbitMQ 2.8.5 on top of Ubuntu 10.04.
>
> I have three brokers bi-directionally federated similarly to the "Small
> complete Graph" example in http://www.rabbitmq.com/federation.html. My
> exchange is called "Skytap", and is a topic exchange. One of the routing
> key 'words' directs messages to the appropriate broker.
>
> In my example, I have a single master sending "requests" to two slaves
> which reply back to the master, simulating an RPC scenario. A client app
> on the 'master' broker reads from an exclusive queue called 'master",
> while client apps on the slave brokers read from an exclusive queue
> called "slave'.
>
> In the low volume case, everything works as expected: A steady stream of
> request messages seen on the slaves and a steady stream of reply
> messages seen on the master.
>
> However, if I write "request" messages as fast as possible, in short
> order I see the 'master' queue disappear. (I know this because I have
> mnesia logging turned on.)

Since the 'master' queue is exclusive, and there is nothing unusual in 
the rabbit logs indicating any rabbit-internal problems (you've checked 
the sasl log as well, right?) the only way that queue can vanish is for 
it to be either deleted explicitly by the creating connection or for the 
connection to have been closed.

Can't see how federation would have anything to do with this since it is 
not touching user queues.

Matthias.

From jerryk at rbcon.com  Tue Aug 14 17:02:53 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 14 Aug 2012 09:02:53 -0700
Subject: [rabbitmq-discuss] Disaster Recovery
In-Reply-To: <D805D38E96E2514DA975AE0F5416C8DA036E1D@FIEXMB00.natinc.com>
References: <D805D38E96E2514DA975AE0F5416C8DA036A9A@FIEXMB00.natinc.com>
	<CAE0Sz=wTwEdbwiOOhQzejAoYDGDRcvPdojKGjpEDh-S5mNiz5g@mail.gmail.com>
	<D805D38E96E2514DA975AE0F5416C8DA036E1D@FIEXMB00.natinc.com>
Message-ID: <CAE0Sz=xC=a-oekV-xLy7QfFxWyTt0gNKd=vsRGYKf7OuNq1w3A@mail.gmail.com>

Hi, Ruben...

In terms of acceptable data loss, for our db?s we accept 15 minutes worth
> of data loss, the same level of tolerance would be acceptable for rabbitmq.
>

Can you say more about the structure, both in physical terms and in
application terms, of your scenario?

First, I'm assuming you have RabbitMQ brokers or clusters thereof in two or
more geographically separated environments, along with whatever application
infrastructure is using them (e.g. databases) replicated, in whole or in
part, possibly modulo contents, at both sites?

What sort of work are your consumers doing in response to the messages they
consume?  Does it involve committing things to databases, causing side
effect-ish things to happen in the real world, etc.?

With some of those parameters specified a bit more tightly we can likely
provide guidance.  We've worked with Rabbit users in the past who use
shovel or federation between geographically separated sites to transmit
digests or summaries of started operations or finalized state in one site
to the other site.  Reviewing the properties of shovel and federation and
figuring out what sort of information your case would need to send to the
backup site as part of general operations is a good starting point.

For example, you might consider having the primary send copies of, or new
messages derived from, work requests at the primary site to the secondary
site, where they'll be logged somehow, likely preferably outside of Rabbit,
and left dormant, to be retired when a corresponding "completed" message is
generated at the primary.  Your 15 minute requirement would help you bound
just how much of this you'd need to store, and give you a basis for picking
at the secondary site after suspected or confirmed failure of the
primary...  You'd obviously want to favor a design with idempotency of the
messages so that things received twice don't have additional or different
effects from the thing received once, but this is a good idea even *within*
the sites on either end of your WAN connected systems...

Tell us more and let's digest your use case further... :-)

Best regards,
Jerry


 The assumption is that the failover will not be automatic but that it will
> have to be manually flipped to the DR site and that back ground processes
> would have to be started up manually.
>
> ** **
>
> Thanks,****
>
> Ruben.****
>
> ** **
>
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Jerry Kuch
> *Sent:* Friday, August 03, 2012 1:54 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Disaster Recovery****
>
> ** **
>
> Hi, Ruben:
>
> We have users that make use of Rabbit/AMQP messaging as part of cross-site
> DR scenarios, but one has to be thoughtful about what one is trying to do.
>
> *What* is it that you want replicated between sites for DR?  Presumably
> more than just broker and cluster configs and their metadata since that's
> relatively straightforward...  Usually the question is what data, effects
> and business processes do you want to be able to fail over to a
> geographically separated site, and what sorts of guarantees do you want for
> the failover.  This naturally affects the design of your application and
> its deployment fairly intimately.
>
> If you feel comfortable talking more about what you want from your
> scenario we can probably make some suggestions based on things we've seen
> done...
>
> Best regards,
> Jerry
>
> ****
>
> On Fri, Aug 3, 2012 at 11:29 AM, Ruben Rotteveel <ruben at fiadmin.com>
> wrote:****
>
> Hi All,****
>
>  ****
>
> What is your recommendation for how to  mirror a rabbitmq installation in
> a DR site?****
>
>  ****
>
> Thanks,****
>
> Ruben Rotteveel****
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/0682a9b6/attachment.htm>

From minslovey at gmail.com  Tue Aug 14 17:28:02 2012
From: minslovey at gmail.com (Min Cha)
Date: Wed, 15 Aug 2012 01:28:02 +0900
Subject: [rabbitmq-discuss] When I declared mirrored queues using
 spring-rabbit API, one of them is sometimes failed.
In-Reply-To: <502A3490.8070806@rabbitmq.com>
References: <CA+_TFtGzfYZu=WSxs0Sk1XYFPsVXZWVO6uWopEfQjJLYPhqqUw@mail.gmail.com>
	<502A3490.8070806@rabbitmq.com>
Message-ID: <CA+_TFtH35JZp86-HgVubAtxbmOOGMn58UUNcT9JcAtND928bvg@mail.gmail.com>

The problem has been resolved after upgrading.
Thanks for your fast reply.

On Tue, Aug 14, 2012 at 8:20 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 14/08/12 08:54, Min Cha wrote:
>
>> *Environment*
>>
>> 1. rabbit-mq 2.8.4(and java client 2.8.4), spring-amqp 1.1.0,
>> spring-rabbit 1.1.0.
>> 2. erlang RB15B01
>>
>> *Problem*
>>
>> 1. When I declared mirrored queues using spring-rabbit API, one of them
>> is sometimes failed.
>> 2. As a result, the failed queue(s) does not exist.
>> 3. When I rerun my code without any changes, it is sometimes success.
>> 4. Code for declaring the queues is as following.
>>
>
>
>  /for (Queue queue : queues) {/
>> /  rabbitAdmin.deleteQueue(queue.**getName());/
>> /  rabbitAdmin.declareQueue(**queue);/
>> /}/
>>
>
> From http://lists.rabbitmq.com/**pipermail/rabbitmq-announce/**
> attachments/20120802/e4ad3dd3/**attachment.txt<http://lists.rabbitmq.com/pipermail/rabbitmq-announce/attachments/20120802/e4ad3dd3/attachment.txt>
> <quote>
> rapidly declaring and then deleting HA queues no longer crashes the master
> </quote>
>
> So please upgrade to 2.8.5.
>
>
> Regards,
>
> Matthias.
>



-- 
Min Cha, Software Developer

Projects involved
- CoRepository : https://github.com/MinCha/corepository
- Good-Samples : http://code.google.com/p/good-samples/

Blog
- (Eng) http://minslovey.blogspot.com
- (Kor) http://minslovey.tistory.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/a71f171a/attachment.htm>

From mpietrek at skytap.com  Tue Aug 14 17:29:32 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 14 Aug 2012 09:29:32 -0700
Subject: [rabbitmq-discuss] Queue disappears during high volume
	federation
In-Reply-To: <502A75FF.4060204@rabbitmq.com>
References: <CACLE7iwUNu37g-7hTL-OY3-L1WK-7zrKnZK0H6XvhJvn1C6ixA@mail.gmail.com>
	<502A75FF.4060204@rabbitmq.com>
Message-ID: <CACLE7iwgc3q4PoxkWpHTZ6YBxvxMW306hk3UV57tBaZ2Dd9P0A@mail.gmail.com>

Hmm... I'm using Pika. Perhaps it's feeling overloaded and dropping the
connection. At least I have a new direction to pursue.

Thanks!

On Tue, Aug 14, 2012 at 8:59 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Matt,
>
>
> On 14/08/12 01:25, Matt Pietrek wrote:
>
>> I'm hitting an issue where a queue disappears from underneath me in a
>> high volume federated scenario.
>>
>> Background: I'm on RabbitMQ 2.8.5 on top of Ubuntu 10.04.
>>
>> I have three brokers bi-directionally federated similarly to the "Small
>> complete Graph" example in http://www.rabbitmq.com/**federation.html<http://www.rabbitmq.com/federation.html>.
>> My
>> exchange is called "Skytap", and is a topic exchange. One of the routing
>> key 'words' directs messages to the appropriate broker.
>>
>> In my example, I have a single master sending "requests" to two slaves
>> which reply back to the master, simulating an RPC scenario. A client app
>> on the 'master' broker reads from an exclusive queue called 'master",
>> while client apps on the slave brokers read from an exclusive queue
>> called "slave'.
>>
>> In the low volume case, everything works as expected: A steady stream of
>> request messages seen on the slaves and a steady stream of reply
>> messages seen on the master.
>>
>> However, if I write "request" messages as fast as possible, in short
>> order I see the 'master' queue disappear. (I know this because I have
>> mnesia logging turned on.)
>>
>
> Since the 'master' queue is exclusive, and there is nothing unusual in the
> rabbit logs indicating any rabbit-internal problems (you've checked the
> sasl log as well, right?) the only way that queue can vanish is for it to
> be either deleted explicitly by the creating connection or for the
> connection to have been closed.
>
> Can't see how federation would have anything to do with this since it is
> not touching user queues.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/bee34684/attachment.htm>

From mpietrek at skytap.com  Tue Aug 14 21:22:10 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 14 Aug 2012 13:22:10 -0700
Subject: [rabbitmq-discuss] Queue disappears during high volume
	federation
In-Reply-To: <CACLE7iwgc3q4PoxkWpHTZ6YBxvxMW306hk3UV57tBaZ2Dd9P0A@mail.gmail.com>
References: <CACLE7iwUNu37g-7hTL-OY3-L1WK-7zrKnZK0H6XvhJvn1C6ixA@mail.gmail.com>
	<502A75FF.4060204@rabbitmq.com>
	<CACLE7iwgc3q4PoxkWpHTZ6YBxvxMW306hk3UV57tBaZ2Dd9P0A@mail.gmail.com>
Message-ID: <CACLE7iwnyxGN1s9E6JMVjFJjtb7yoaDz9UfpOJikkGLZoQSDqQ@mail.gmail.com>

False alarm here. I had subtly and inadvertently introduced some threading
with Pika doesn't like too much.

Once those issues are fixed, things seem to work as expected.

Thanks for the quick response Matthias!

On Tue, Aug 14, 2012 at 9:29 AM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Hmm... I'm using Pika. Perhaps it's feeling overloaded and dropping the
> connection. At least I have a new direction to pursue.
>
> Thanks!
>
>
> On Tue, Aug 14, 2012 at 8:59 AM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> Matt,
>>
>>
>> On 14/08/12 01:25, Matt Pietrek wrote:
>>
>>> I'm hitting an issue where a queue disappears from underneath me in a
>>> high volume federated scenario.
>>>
>>> Background: I'm on RabbitMQ 2.8.5 on top of Ubuntu 10.04.
>>>
>>> I have three brokers bi-directionally federated similarly to the "Small
>>> complete Graph" example in http://www.rabbitmq.com/**federation.html<http://www.rabbitmq.com/federation.html>.
>>> My
>>> exchange is called "Skytap", and is a topic exchange. One of the routing
>>> key 'words' directs messages to the appropriate broker.
>>>
>>> In my example, I have a single master sending "requests" to two slaves
>>> which reply back to the master, simulating an RPC scenario. A client app
>>> on the 'master' broker reads from an exclusive queue called 'master",
>>> while client apps on the slave brokers read from an exclusive queue
>>> called "slave'.
>>>
>>> In the low volume case, everything works as expected: A steady stream of
>>> request messages seen on the slaves and a steady stream of reply
>>> messages seen on the master.
>>>
>>> However, if I write "request" messages as fast as possible, in short
>>> order I see the 'master' queue disappear. (I know this because I have
>>> mnesia logging turned on.)
>>>
>>
>> Since the 'master' queue is exclusive, and there is nothing unusual in
>> the rabbit logs indicating any rabbit-internal problems (you've checked the
>> sasl log as well, right?) the only way that queue can vanish is for it to
>> be either deleted explicitly by the creating connection or for the
>> connection to have been closed.
>>
>> Can't see how federation would have anything to do with this since it is
>> not touching user queues.
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/1ee99a56/attachment.htm>

From alex at inferiorhumanorgans.com  Tue Aug 14 21:29:26 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Tue, 14 Aug 2012 13:29:26 -0700
Subject: [rabbitmq-discuss] Shovel stuck?
Message-ID: <20120814202926.GA70993@bloaty>

All,

Currently I've got a bunch of sensors deployed that are posting messages to an
Amazon hosted rabbit instance.  The big catch is that the sensors are connected
via a cellular data network (read: unreliable).  To ensure I'm not dropping any
mesages, I've tried setting shovel up on a few of the sensors.  For the most
part it works well but I've run  into two big problems:

1.) The logging is exceedingly verbose.  I've set
{log_levels, [{connection, none}]}, but shovel still dumps a bunch of info in
the SASL log.  Are there any tunables to turn this down, or would that require
recompiling shovel?

2.) Occasionally the shovel gets wedged.  Initially it was from running into
the free disk space limit, but occasionally I'll run into a situation where
the shovel just terminates for no good reason (stop_app; start_app seems to
resolve the issue).  Here's the error I'm seeing:

<https://gist.github.com/3330388>

Here's my rabbit.config:

<https://gist.github.com/3330468>

Any ideas what this means or how to avoid it?

- alex

From tadw99 at googlemail.com  Tue Aug 14 21:32:41 2012
From: tadw99 at googlemail.com (Tom Wrigg)
Date: Tue, 14 Aug 2012 13:32:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Optimizing RabbitMQ
Message-ID: <71a7ae88-3812-438a-9b27-3be406657dea@googlegroups.com>

Hello.

I'm writing a real-time browser-based game using node.js and AMQP and would 
like to know how to optimise the AMQP server to achieve a high throughput- 
low latency system. I'm using postwait's amqp-node<https://github.com/postwait/node-amqp>client with a RabbitMQ server.

The game logic runs on the server. Every 20ms a world update message is 
sent to the client to render which each has a length of about 4000 bytes:

Game Logic server ---> AMQP topic exchange ---> websockets ---> web-browser.


I've done a quick test to measure the time it takes for the message to be 
published, routed and reach it's destination which came out at 40ms. This 
seems quite slow. 

Why is it taking so long to route a message? I've read of servers doing 
12,000+ messages per second.

Is there a way to turn off acknowledgements? would this make things faster?

Are there any other methods I could use to increase speed/ reduce latency?


Thanks in advance,

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/62b8e384/attachment.htm>

From lostdogs101 at gmail.com  Tue Aug 14 22:54:30 2012
From: lostdogs101 at gmail.com (Alex)
Date: Tue, 14 Aug 2012 14:54:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Having trouble with Web-Stomp
In-Reply-To: <50222508.7030302@rabbitmq.com>
References: <CABjdGM5=m5DKvKN5hky4GwvP=WXUNq_MteVtBXnk7fabNVbfaA@mail.gmail.com>
	<50222508.7030302@rabbitmq.com>
Message-ID: <1344981270353-21400.post@n5.nabble.com>

I didn't write an immediate thank you. This Fixed my issue, thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Having-trouble-with-Web-Stomp-tp21290p21400.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From wchrisjohnson at gmail.com  Wed Aug 15 05:46:44 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Wed, 15 Aug 2012 00:46:44 -0400
Subject: [rabbitmq-discuss] RabbitMQ cluster on a single machine, OSX Lion,
	Homebrew
Message-ID: <CC50A1F4.1F354%wchrisjohnson@gmail.com>

I am attempting to set up a simple, two node cluster on my mac using the
instructions within the clustering guide:

http://www.rabbitmq.com/clustering.html#single-machine

See the transcript below.

I've been trying to get this working for many hours, with no luck.

I'd appreciate it if someone could give me some direction.



?  ~  RABBITMQ_NODE_PORT=5672 RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb
listeners [{mgmt,[{port,55672}]}]" RABBITMQ_NODENAME=rabbit rabbitmq-server
-detached
Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.8.5
* mochiweb-2.3.1-rmq2.8.5-gitd541e9a
* rabbitmq_management-2.8.5
* rabbitmq_management_agent-2.8.5
* rabbitmq_mochiweb-2.8.5
* webmachine-1.9.1-rmq2.8.5-git52e62bc

?  ~  RABBITMQ_NODE_PORT=5673 RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb
listeners [{mgmt,[{port,55673}]}]" RABBITMQ_NODENAME=hare rabbitmq-server
-detached
Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.8.5
* mochiweb-2.3.1-rmq2.8.5-gitd541e9a
* rabbitmq_management-2.8.5
* rabbitmq_management_agent-2.8.5
* rabbitmq_mochiweb-2.8.5
* webmachine-1.9.1-rmq2.8.5-git52e62bc

?  ~  rabbitmqctl -n hare stop_app
Stopping node hare at Wilson ...
...done.
?  ~  rabbitmqctl -n hare reset
Resetting node hare at Wilson ...
...done.
?  ~  rabbitmqctl -n hare cluster rabbit@`hostname -s`
Clustering node hare at Wilson with [rabbit at Wilson] ...
...done.
?  ~  rabbitmqctl -n hare start_app
Starting node hare at Wilson ...
...done.
?  ~  rabbitmqctl cluster_status
Cluster status of node rabbit at localhost ...
Error: unable to connect to node rabbit at localhost: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at localhost]

hosts, their running nodes and ports:
- localhost: [{rabbit,49647},{hare,49652},{rabbitmqctl2623,49672}]

current node details:
- node name: rabbitmqctl2623 at Wilson
- home dir: /Users/wchrisjohnson
- cookie hash: AKiRQ5XKMM9jeUV8oc4l6g==

?  ~  rabbitmqctl status
Status of node rabbit at localhost ...
Error: unable to connect to node rabbit at localhost: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at localhost]

hosts, their running nodes and ports:
- localhost: [{rabbit,49647},{hare,49652},{rabbitmqctl2650,49677}]

current node details:
- node name: rabbitmqctl2650 at Wilson
- home dir: /Users/wchrisjohnson
- cookie hash: AKiRQ5XKMM9jeUV8oc4l6g==





Best Regards,
 
Chris





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/48441b49/attachment.htm>

From ryan at nutcracker.co.za  Wed Aug 15 06:48:11 2012
From: ryan at nutcracker.co.za (Icidis)
Date: Tue, 14 Aug 2012 22:48:11 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ - Service Crash
In-Reply-To: <502A1414.9070306@rabbitmq.com>
References: <A33D44D3C6F1D54AA679F7A3B0995E23237BA566@Nutdc.Nutcracker.local>
	<502A1414.9070306@rabbitmq.com>
Message-ID: <1345009691615-21402.post@n5.nabble.com>


Emile Joubert-2 wrote
> 
> Check the OS eventlog. Is there any reason why the OS might prevent a
> process from creating the file in question? Try creating the same file
> as the same user that the broker runs as and see if you get any errors.
> -Emile
> 

Hi Emile,

I've gone through the OS Security log and found nothing. I checked to see if
the file was created yesterday morning which it was. Strange thing is that
it happened in the middle of the day and when we restarted the ErLang
Service and Rabbit Service everything was running fine again.

Is there maybe an ErLang service log file that I can look at. I haven't had
any problems like this before and we have been using RabbitMQ for over 3
months.

Thank You

Ryan



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Service-Crash-tp21371p21402.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed Aug 15 08:41:02 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Aug 2012 08:41:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ cluster on a single machine,
 OSX Lion, Homebrew
In-Reply-To: <CC50A1F4.1F354%wchrisjohnson@gmail.com>
References: <CC50A1F4.1F354%wchrisjohnson@gmail.com>
Message-ID: <502B528E.4010409@rabbitmq.com>

Chris,

On 15/08/12 05:46, Chris Johnson wrote:
> I am attempting to set up a simple, two node cluster on my mac using the
> instructions within the clustering guide:
>
> http://www.rabbitmq.com/clustering.html#single-machine
>
> See the transcript below.
> I've been trying to get this working for many hours, with no luck.
> I'd appreciate it if someone could give me some direction.
>
> [...]

> ?  ~  rabbitmqctl -n hare start_app
> Starting node hare at Wilson ...
> ...done.
> ?  ~  rabbitmqctl cluster_status
> Cluster status of node rabbit at localhost ...
> Error: unable to connect to node rabbit at localhost: nodedown

Notice the difference in host name in the last two commands - the first 
has 'Wilson', the second 'localhost'.

That is due to the homebrew formula setting the default node name 
explicitly to 'rabbit at localhost':
https://github.com/mxcl/homebrew/blob/master/Library/Formula/rabbitmq.rb#L67. 
I don't know why they are doing that; possibly because MacOS is 
notorious for altering the hostname - you may want to file an issue / 
contact the authors.

Meanwhile, if you always specify the node name explicitly - e.g. add "-n 
rabbit" to the second command above - you should be fine.

Regards,

Matthias.

From emile at rabbitmq.com  Wed Aug 15 11:30:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Aug 2012 11:30:45 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <20120814202926.GA70993@bloaty>
References: <20120814202926.GA70993@bloaty>
Message-ID: <502B7A55.7050409@rabbitmq.com>

Hi,

On 14/08/12 21:29, Alex Zepeda wrote:
> 1.) The logging is exceedingly verbose.  I've set
> {log_levels, [{connection, none}]}, but shovel still dumps a bunch of info in
> the SASL log.  Are there any tunables to turn this down, or would that require
> recompiling shovel?

There are no other tunables, but it should be possible to rotate and
archive old logs regularly. The only other option is to turn logging off
completely in Erlang, something we don't recommend.

> 2.) Occasionally the shovel gets wedged.  Initially it was from running into
> the free disk space limit, but occasionally I'll run into a situation where
> the shovel just terminates for no good reason (stop_app; start_app seems to
> resolve the issue).  Here's the error I'm seeing:

Are there any log entries in the regular or the sasl log that might help
to explain this? How long after starting a shovel does this happen? Can
you reliably reproduce the problem?


-Emile


From emile at rabbitmq.com  Wed Aug 15 12:07:16 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Aug 2012 12:07:16 +0100
Subject: [rabbitmq-discuss] Optimizing RabbitMQ
In-Reply-To: <71a7ae88-3812-438a-9b27-3be406657dea@googlegroups.com>
References: <71a7ae88-3812-438a-9b27-3be406657dea@googlegroups.com>
Message-ID: <502B82E4.8010607@rabbitmq.com>


Hi,

On 14/08/12 21:32, Tom Wrigg wrote:
> Is there a way to turn off acknowledgements? would this make things faster?

Yes, you can consume in auto-ack mode. Or you can impact performance
much less and get the advantages of acknowledgements if you acknowledge
messages in batches.

> Are there any other methods I could use to increase speed/ reduce latency?

Here are some suggestions, which you should benchmark with your own
workload.


Use a larger prefetch count. Small values hurt performance.

A topic exchange is slower than a direct or a fanout exchange.

Make sure queues stay short. Longer queues impose more processing overhead.

If you care about latency and message rates then use smaller messages.
Use an efficient format (e.g. avoid XML) or compress the payload.

Experiment with HiPE, which helps performance.

Avoid transactions and persistence. Also avoid publishing in immediate
or mandatory mode. Avoid HA. Clustering can also impact performance.

You will achieve better throughput on a multi-core system if you have
multiple queues and consumers.

Use at least v2.8.1, which introduces flow control. Make sure the memory
and disk space alarms never trigger.

Virtualisation can impose a small performance penalty.

Tune your OS and network stack. Make sure you provide more than enough
RAM. Provide fast cores and RAM.

---

You may also want to look at the blog entries that pertain to performance:

http://www.rabbitmq.com/blog/tag/performance/




-Emile



From matthias at rabbitmq.com  Wed Aug 15 12:18:32 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Aug 2012 12:18:32 +0100
Subject: [rabbitmq-discuss] Optimizing RabbitMQ
In-Reply-To: <502B82E4.8010607@rabbitmq.com>
References: <71a7ae88-3812-438a-9b27-3be406657dea@googlegroups.com>
	<502B82E4.8010607@rabbitmq.com>
Message-ID: <502B8588.8010300@rabbitmq.com>

To,

On 15/08/12 12:07, Emile Joubert wrote:
> On 14/08/12 21:32, Tom Wrigg wrote:
>> Is there a way to turn off acknowledgements? would this make things faster?
>
> Yes, you can consume in auto-ack mode. Or you can impact performance
> much less and get the advantages of acknowledgements if you acknowledge
> messages in batches.
>
>> Are there any other methods I could use to increase speed/ reduce latency?
>
> Here are some suggestions, which you should benchmark with your own
> workload.
> [snip]

Actually, if you are seeing 40ms latency it is very, very unlikely that 
the RabbitMQ broker is responsible for most of that.

>> Game Logic server ---> AMQP topic exchange ---> websockets ---> web-browser.

So is the 40ms the time it takes for a message to travel from the game 
logic server to the web browser? If so I suggest you measure the latency 
at each step. It could easily be that the bulk of the 40ms is simply 
network latency between your node instance and the web browser, or 
between node and the broker. Or it could be that node/node-amqp are slow.

> Why is it taking so long to route a message? I've read of servers
> doing 12,000+ messages per second.

A lot more than that, actually - see 
http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/. 
However, you are confusing latency with throughput. High throughput is 
still possible in situations when there is high latency, as long as 
synchronous operations are avoided. High prefetch limits or even using 
no-ack are one way to achieve that on the consuming side.

Regards,

Matthias.

From simon at rabbitmq.com  Wed Aug 15 12:21:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Aug 2012 12:21:49 +0100
Subject: [rabbitmq-discuss] Upstream-set of upstream-sets in federation?
In-Reply-To: <CAJreXKDo0Jciv+gN4iwQh4GXpUYxOrCVZgESu-ZWbgMc2EQ3nw@mail.gmail.com>
References: <CAJreXKDo0Jciv+gN4iwQh4GXpUYxOrCVZgESu-ZWbgMc2EQ3nw@mail.gmail.com>
Message-ID: <502B864D.6040909@rabbitmq.com>

On 09/08/12 16:59, James Carr wrote:
> Is it possible to define a set of upstream-sets in federation? For
> example, if I have 3 locations (say TX, VA, CA) and have an
> upstream-set for each individual one is it possible to group those
> sets so that a particular federated exchange can just federate from
> all of them?

Ah, no, at the moment you have exactly two levels to work with, 
connections and upstream-sets. This might be doable though, I'll file a bug.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Aug 15 12:35:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Aug 2012 12:35:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ Monitoring
In-Reply-To: <bw7393ruj13.fsf@mail.cern.ch>
References: <20120813103756.6683.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<CAO70Nwt3JGqCb9Px_a=xLzvM5kK+s8X3rJ2sx8ep3zLtEMc3dA@mail.gmail.com>
	<bw7393ruj13.fsf@mail.cern.ch>
Message-ID: <502B8986.5040800@rabbitmq.com>

On 13/08/12 12:29, Lionel Cons wrote:
> David Gillies<dgillies at brandscreen.com>  writes:
>> I've used this script to monitor the number of messages in a queue in nagios just last week:
>> http://bitkickers.blogspot.com.au/2011/07/checking-rabbitmq-queue-sizeage-with.html
>
> Thanks for the pointer.
>
> The monitoring information being mostly present, the main questions are:
>
> Would it be possible to get an absolute counter rather than a rate and
> let the monitoring application (Nagios, Graphite...) decide on how
> frequently to probe the broker?

You can sort of do this today, the HTTP API returns an absolute count - 
but only for the sum of all channels that are still open. Fixing this is 
a TODO for the next time I look seriously at management stats 
(seriously, mgmt has existed for two years now and we still don't have 
little animated charts?)

It's worth pointing out though that probing the broker is cheap; it 
maintains all these stats in memory anyway.

> Would it be possible to get the number of received/sent messages by the
> broker without enabling fine grain statistics that, according to the
> doc, have a significant performance impact? After all, total numbers per
> broker are not really fine grain ;-)

Well they are, if they are obtained by summing per channel ;-)

Maybe the docs are a bit misleading though, while there is a cost to 
fine grained stats, you'll only see it if you're routing-bound anyway 
(i.e. lots of small transient messages).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Aug 15 14:04:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Aug 2012 14:04:43 +0100
Subject: [rabbitmq-discuss] Irregular service failure
In-Reply-To: <0cbcf212-3a16-4dfb-80b7-322514cfcade@googlegroups.com>
References: <CAFHLqDJSGhpfXf1UwD0PcLh0=7khdcOhFX4seotrku9LkCNFiw@mail.gmail.com>
	<0cbcf212-3a16-4dfb-80b7-322514cfcade@googlegroups.com>
Message-ID: <502B9E6B.3020304@rabbitmq.com>

Hi,

On 08/08/12 10:58, Colin Bull wrote:
> I have exactly the same situation. Although the message volumes are
> slightly less probably 10,000 msg/day.. I am currently running on
> RabbitMQ 2.8.4. I have tried looking in the logs and I cannot see
> anything strange. Any other ideas?

You should take a careful look at all the logfiles. For Windows services
that includes the normal broker log, the sasl log and the console log.
See the rabbitmq-service.bat manpage for more information about
RABBITMQ_CONSOLE_LOG:

http://www.rabbitmq.com/man/rabbitmq-service.man.html

The other possibly useful source of inforamtion is the Erlang crash
dump. If the interpreter crashes unexpectedly then it will produce a
file named erl_crash.dump. The slogan should contain the reason for the
crash.



-Emile



From francesco at rabbitmq.com  Wed Aug 15 14:06:49 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 15 Aug 2012 14:06:49 +0100
Subject: [rabbitmq-discuss] Is there a pika bug with the prefetch?
In-Reply-To: <691d0de4-8e46-49d5-9e71-bce9b01af5a8@googlegroups.com>
References: <691d0de4-8e46-49d5-9e71-bce9b01af5a8@googlegroups.com>
Message-ID: <871uj8pamu.wl%francesco@rabbitmq.com>

At Mon, 13 Aug 2012 22:16:18 -0700 (PDT),
Charles Law wrote:
> When I set prefetch_count to 1, everything works how I expect.  I assumed with
> the default prefetch_count, or even a prefetch count > 1, that the client
> would receive messages, but should hold onto them until the acknowledgement
> for the original message goes out.  Is this correct?

The prefetch_count qos exists precisely for that purpose - to regulate how many
messages will be fetched without receiving ack, see
<http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos>.

So if you want the consumer not to receive messages while it's acking previous
ones, set the prefetch_count to 1.  The tutorials have examples regarding this
as well: <http://www.rabbitmq.com/tutorials/tutorial-two-python.html>.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Wed Aug 15 14:16:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Aug 2012 14:16:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ - Service Crash
In-Reply-To: <1345009691615-21402.post@n5.nabble.com>
References: <A33D44D3C6F1D54AA679F7A3B0995E23237BA566@Nutdc.Nutcracker.local>
	<502A1414.9070306@rabbitmq.com>
	<1345009691615-21402.post@n5.nabble.com>
Message-ID: <502BA112.1020309@rabbitmq.com>

Hi Ryan,

On 15/08/12 06:48, Icidis wrote:
>> Check the OS eventlog. Is there any reason why the OS might prevent a
>> process from creating the file in question? Try creating the same file
>> as the same user that the broker runs as and see if you get any errors.

> I've gone through the OS Security log and found nothing. I checked to see if
> the file was created yesterday morning which it was. Strange thing is that
> it happened in the middle of the day and when we restarted the ErLang
> Service and Rabbit Service everything was running fine again.
> 
> Is there maybe an ErLang service log file that I can look at. I haven't had
> any problems like this before and we have been using RabbitMQ for over 3
> months.

The evidence points to the OS preventing access to the file. This could
even be something like a denial from a malware or virus scanner. There
is nothing more specific in the Erlang report, and the root cause is
unlikely to be RabbitMQ- or Erlang-specific. I suggest you use a process
of elimination to check whether there is any aspect of the environment
that may give rise to the error.


-Emile



From francesco at rabbitmq.com  Wed Aug 15 14:19:41 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 15 Aug 2012 14:19:41 +0100
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
Message-ID: <87zk5wnvgy.wl%francesco@rabbitmq.com>

Hi Jon,

At Tue, 14 Aug 2012 12:27:26 +0000,
Jon Bergli Heier wrote:
> I have a cluster consisting of two nodes, and brokers shoveling messages to
> the cluster using the shovel plugin. When testing failover with the shovel
> plugins (by stopping the RabbitMQ nodes) I often see that when starting a node
> after stopping it causes the shovel plugin to stop receiving acks for
> messages. I have prefetch_count set to 1000 in the shovel config, and I see
> that "unacked" in the management interface for the queue rises to 1000 and
> sits there, with "ready" steadily increasing.  The connection seems to be
> alive as I can see (via tcpdump) that there are heartbeats being sent.  All
> RabbitMQ servers are 2.8.5 on Erlang R14A. This only seems to happen with
> setting ack_mode set to on_confirm. The queues on the cluster are mirrored
> using x-ha-policy: all.

Could you post more details about your shovel config and your HA cluster?  In
particular, how do you handle failover?  Do you have the cluster nodes all as
sources in the shovel config?

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Wed Aug 15 14:32:09 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 15 Aug 2012 14:32:09 +0100
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <87zk5wnvgy.wl%francesco@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>
Message-ID: <87y5lgnuw6.wl%francesco@rabbitmq.com>

At Wed, 15 Aug 2012 14:19:41 +0100,
Francesco Mazzoli wrote:
> At Tue, 14 Aug 2012 12:27:26 +0000,
> Jon Bergli Heier wrote:
> > I have a cluster consisting of two nodes, and brokers shoveling messages to
> > the cluster using the shovel plugin. When testing failover with the shovel
> > plugins (by stopping the RabbitMQ nodes) I often see that when starting a node
> > after stopping it causes the shovel plugin to stop receiving acks for
> > messages. I have prefetch_count set to 1000 in the shovel config, and I see
> > that "unacked" in the management interface for the queue rises to 1000 and
> > sits there, with "ready" steadily increasing.  The connection seems to be
> > alive as I can see (via tcpdump) that there are heartbeats being sent.  All
> > RabbitMQ servers are 2.8.5 on Erlang R14A. This only seems to happen with
> > setting ack_mode set to on_confirm. The queues on the cluster are mirrored
> > using x-ha-policy: all.
> 
> Could you post more details about your shovel config and your HA cluster?  In
> particular, how do you handle failover?  Do you have the cluster nodes all as
> sources in the shovel config?

Also, you might want to check the shovel status,
<http://www.rabbitmq.com/shovel.html#management-status>.

--
Francesco * Often in error, never in doubt

From edward.wax at troppussoftware.com  Wed Aug 15 14:44:52 2012
From: edward.wax at troppussoftware.com (Wax, Edward)
Date: Wed, 15 Aug 2012 13:44:52 +0000
Subject: [rabbitmq-discuss] RabbitMQ application failover/recovery in HA
	cluster
Message-ID: <1C9888BB42C16344B1C280C07DC8D78D03FA64EF@INWPIEXC01.SATS.CORP>

I am implementing a .NET WCF ActiveDuplex service with RabbitMQ under the covers for messaging purposes.   I am using the asynchronous message pattern of publish/subscribe within the ActiveDuplex service, which includes callbacks to the originating client.



There are 2 parts to the equation:  (a) our implementation of the WCF ActiveDuplex interface and (b) the RabbitMQ failover/recovery strategy.  I was hoping you could help with the RabbitMQ part of the equation.



Our previous implementation of RabbitMQ consisted of a Pacemaker active/passive HA cluster with two nodes, and a SAN disk for shared storage. We would connect to the cluster virtual IP for all RabbitMQ transactions, and the HA features of Pacemaker would manage resource failures automatically with the net effect that consumers could complete a RabbitMQ session without interruption.



We recently moved to a RabbitMQ Cluster as recommended in the Clustering Guide at http://www.rabbitmq.com/clustering.html , where multiple RabbitMQ servers are arranged in an Active/Active fashion.  In doing so we gain the benefits of a true HA environment but we have lost the ability to seamlessly recover from RabbitMQ failures, previously provided by the Pacemaker infrastructure (the single virtual IP).   I've reviewed your .NET documentation and see there are references to the various shutdown protocols.  Do you have more specific documentation that would elaborate on these and provide examples on how we can manage our client connections in this HA environment (e.g. if I receive a ModelShutdown event, what steps do I need to go through in order to "transfer" a RabbitMQ session to a new connection).  Or are there other "management" APIs that should be used instead?



I've also been looking the book, RabbitMQ In Action, and a section on application failure and recovery (6.2) sounds almost as simple as wrapping the consumer/producer code in a try/catch block.



Any thoughts would be appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/a7c51e04/attachment.htm>

From tadw99 at googlemail.com  Wed Aug 15 14:59:30 2012
From: tadw99 at googlemail.com (Tom Wrigglesworth)
Date: Wed, 15 Aug 2012 14:59:30 +0100
Subject: [rabbitmq-discuss] Optimizing RabbitMQ
In-Reply-To: <502B8588.8010300@rabbitmq.com>
References: <71a7ae88-3812-438a-9b27-3be406657dea@googlegroups.com>
	<502B82E4.8010607@rabbitmq.com> <502B8588.8010300@rabbitmq.com>
Message-ID: <CAEk0_N7g8Bnrm65PCqPhjLCogc9zyVDvLYgvZwqbeGxSq0+n-Q@mail.gmail.com>

Hi, Thanks for your reply.

So is the 40ms the time it takes for a message to travel from the game
> logic server to the web browser?


It's the time between the message being published and the message being
delivered. I have output from wireshark looking something similar to:

      #     Time          From                   To
 Protocol   Length   Info
...
    155 1.539600    127.0.0.1             127.0.0.1             AMQP
115     Basic.Publish
    157 1.579834    127.0.0.1             127.0.0.1             AMQP
3873   Content-Header Content-Body
    159 1.580942    127.0.0.1             127.0.0.1             AMQP
3963   Basic-Deliver Content-Header Content-Body
    160 1.590769    127.0.0.1             127.0.0.1             AMQP
115     Basic.Publish
    162 1.627732    127.0.0.1             127.0.0.1             AMQP
3873   Content-Header Content-Body
    164 1.628295    127.0.0.1             127.0.0.1             AMQP
3963   Basic-Deliver Content-Header Content-Body
    165 1.638748    127.0.0.1             127.0.0.1             AMQP
115     Basic.Publish
    167 1.675834    127.0.0.1             127.0.0.1             AMQP
3873   Content-Header Content-Body
    169 1.676850    127.0.0.1             127.0.0.1             AMQP
3963   Basic-Deliver Content-Header Content-Body
...

This looks to me like it is AMQP that is taking about 40ms between publish
and deliver. Is this because of certain server settings i'm running,
interference from the node server running at the same time on the same
machine or some other reason?

Thank you for your time.

Tom.

On 15 August 2012 12:18, Matthias Radestock <matthias at rabbitmq.com> wrote:

> To,
>
>
> On 15/08/12 12:07, Emile Joubert wrote:
>
>> On 14/08/12 21:32, Tom Wrigg wrote:
>>
>>> Is there a way to turn off acknowledgements? would this make things
>>> faster?
>>>
>>
>> Yes, you can consume in auto-ack mode. Or you can impact performance
>> much less and get the advantages of acknowledgements if you acknowledge
>> messages in batches.
>>
>>  Are there any other methods I could use to increase speed/ reduce
>>> latency?
>>>
>>
>> Here are some suggestions, which you should benchmark with your own
>> workload.
>> [snip]
>>
>
> Actually, if you are seeing 40ms latency it is very, very unlikely that
> the RabbitMQ broker is responsible for most of that.
>
>  Game Logic server ---> AMQP topic exchange ---> websockets --->
>>> web-browser.
>>>
>>
> So is the 40ms the time it takes for a message to travel from the game
> logic server to the web browser? If so I suggest you measure the latency at
> each step. It could easily be that the bulk of the 40ms is simply network
> latency between your node instance and the web browser, or between node and
> the broker. Or it could be that node/node-amqp are slow.
>
>  Why is it taking so long to route a message? I've read of servers
>> doing 12,000+ messages per second.
>>
>
> A lot more than that, actually - see http://www.rabbitmq.com/blog/**
> 2012/04/25/rabbitmq-**performance-measurements-part-**2/<http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/>.
> However, you are confusing latency with throughput. High throughput is
> still possible in situations when there is high latency, as long as
> synchronous operations are avoided. High prefetch limits or even using
> no-ack are one way to achieve that on the consuming side.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/56d73d7e/attachment.htm>

From jon.bergli.heier at zisson.no  Wed Aug 15 15:00:54 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Wed, 15 Aug 2012 14:00:54 +0000
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <87y5lgnuw6.wl%francesco@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87y5lgnuw6.wl%francesco@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F387@osl02-exc-001>

Hi, thanks for the reply.

This is the shovel config on the broker (with credentials and hostnames replaced).
The broker nodes in destination are the cluster nodes, and source is the local broker
I'm shoveling messages from.

{foo_shovel, [
  {sources, [{broker, "amqp://localhost?heartbeat=5"}]},
  {destinations, [
    {brokers,
      ["amqp://user:pass at rabbit1?heartbeat=5", "amqp://user:pass at rabbit2?heartbeat=5"]
    }
  ]},
  {reconnect_delay, 5},
  {queue, <<"foo">>},
  {prefetch_count, 1000},
  %{ack_mode, on_publish},
  {publish_fields, [
    {exchange, <<"foo">>}
  ]}
]}

The problem appears when I shut down and then start rabbit1 or rabbit2 (using either
the debian init script or rabbitmqctl stop_app). All servers are VMs, and I've also
reproduced this problem by forcing a shutdown of the VM and then booting it up again.

I've checked the shovel status in the management interface and it always shows as
"running" even when the problem appears.

On a related note, when letting the broker sit idle for a while (approx. 24 hours by now)
the shovel seems to disconnect from the destination without reconnecting even with
messages still in the source queue (all of them shows as "ready" with none "unacked").

________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco Mazzoli [francesco at rabbitmq.com]
Sent: Wednesday, August 15, 2012 15:32
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovel stops receiving acks from cluster

At Wed, 15 Aug 2012 14:19:41 +0100,
Francesco Mazzoli wrote:
> At Tue, 14 Aug 2012 12:27:26 +0000,
> Jon Bergli Heier wrote:
> > I have a cluster consisting of two nodes, and brokers shoveling messages to
> > the cluster using the shovel plugin. When testing failover with the shovel
> > plugins (by stopping the RabbitMQ nodes) I often see that when starting a node
> > after stopping it causes the shovel plugin to stop receiving acks for
> > messages. I have prefetch_count set to 1000 in the shovel config, and I see
> > that "unacked" in the management interface for the queue rises to 1000 and
> > sits there, with "ready" steadily increasing.  The connection seems to be
> > alive as I can see (via tcpdump) that there are heartbeats being sent.  All
> > RabbitMQ servers are 2.8.5 on Erlang R14A. This only seems to happen with
> > setting ack_mode set to on_confirm. The queues on the cluster are mirrored
> > using x-ha-policy: all.
>
> Could you post more details about your shovel config and your HA cluster?  In
> particular, how do you handle failover?  Do you have the cluster nodes all as
> sources in the shovel config?

Also, you might want to check the shovel status,
<http://www.rabbitmq.com/shovel.html#management-status>.

--
Francesco * Often in error, never in doubt
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From wchrisjohnson at gmail.com  Wed Aug 15 15:01:56 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Wed, 15 Aug 2012 10:01:56 -0400
Subject: [rabbitmq-discuss] RabbitMQ cluster on a single machine,
 OSX Lion, Homebrew
In-Reply-To: <502B528E.4010409@rabbitmq.com>
Message-ID: <CC512372.1F3C0%wchrisjohnson@gmail.com>

Matthias - thanks for the heads up. I struggled yesterday with the
differences between localhost and Wilson, but could not pin down how/why
the difference was happening. Good catch. I will either file a ticket for
the homebrew change or just submit a pull request and make the change
myself.

For the time being, I just changed the config file to have a default node
name of 'rabbit at Wilson'. Then I wiped the amnesia database folder and the
log folder and rebooted.

The irony of this is that I could have created the cluster yesterday
several times successfully, yet was not able to verify with the
"rabbitmqctl cluster_status" command. Is there any way to make that
command work without having to specify a node?

Chris



On 8/15/12 3:41 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Chris,
>
>On 15/08/12 05:46, Chris Johnson wrote:
>> I am attempting to set up a simple, two node cluster on my mac using the
>> instructions within the clustering guide:
>>
>> http://www.rabbitmq.com/clustering.html#single-machine
>>
>> See the transcript below.
>> I've been trying to get this working for many hours, with no luck.
>> I'd appreciate it if someone could give me some direction.
>>
>> [...]
>
>> ?  ~  rabbitmqctl -n hare start_app
>> Starting node hare at Wilson ...
>> ...done.
>> ?  ~  rabbitmqctl cluster_status
>> Cluster status of node rabbit at localhost ...
>> Error: unable to connect to node rabbit at localhost: nodedown
>
>Notice the difference in host name in the last two commands - the first
>has 'Wilson', the second 'localhost'.
>
>That is due to the homebrew formula setting the default node name
>explicitly to 'rabbit at localhost':
>https://github.com/mxcl/homebrew/blob/master/Library/Formula/rabbitmq.rb#L
>67. 
>I don't know why they are doing that; possibly because MacOS is
>notorious for altering the hostname - you may want to file an issue /
>contact the authors.
>
>Meanwhile, if you always specify the node name explicitly - e.g. add "-n
>rabbit" to the second command above - you should be fine.
>
>Regards,
>
>Matthias.



From gmr at meetme.com  Wed Aug 15 15:05:21 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 15 Aug 2012 10:05:21 -0400
Subject: [rabbitmq-discuss] RabbitMQ cluster on a single machine,
 OSX Lion, Homebrew
In-Reply-To: <502B528E.4010409@rabbitmq.com>
References: <CC50A1F4.1F354%wchrisjohnson@gmail.com>
	<502B528E.4010409@rabbitmq.com>
Message-ID: <CAKwdTWcU9=4-hc3pcL2kQd3T6OZHYvdwgCnXxeTWOGuv6Fm=kQ@mail.gmail.com>

On Wed, Aug 15, 2012 at 3:41 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Chris,
>
>
> On 15/08/12 05:46, Chris Johnson wrote:
>
>> I am attempting to set up a simple, two node cluster on my mac using the
>> instructions within the clustering guide:
>>
>> http://www.rabbitmq.com/**clustering.html#single-machine<http://www.rabbitmq.com/clustering.html#single-machine>
>>
>> See the transcript below.
>> I've been trying to get this working for many hours, with no luck.
>> I'd appreciate it if someone could give me some direction.
>>
>> [...]
>>
>
>  ?  ~  rabbitmqctl -n hare start_app
>> Starting node hare at Wilson ...
>> ...done.
>> ?  ~  rabbitmqctl cluster_status
>> Cluster status of node rabbit at localhost ...
>> Error: unable to connect to node rabbit at localhost: nodedown
>>
>
> Notice the difference in host name in the last two commands - the first
> has 'Wilson', the second 'localhost'.
>
> That is due to the homebrew formula setting the default node name
> explicitly to 'rabbit at localhost':
> https://github.com/mxcl/**homebrew/blob/master/Library/**
> Formula/rabbitmq.rb#L67<https://github.com/mxcl/homebrew/blob/master/Library/Formula/rabbitmq.rb#L67>.
> I don't know why they are doing that; possibly because MacOS is notorious
> for altering the hostname -


That is exactly why. This can be controlled in the rabbitmq-env.conf file
in /usr/local/etc/rabbitmq/:

gmr-mbp:rabbitmq gmr$ cat rabbitmq-env.conf
CONFIG_FILE=/usr/local/etc/rabbitmq/rabbitmq
NODE_IP_ADDRESS=127.0.0.1
NODENAME=rabbit at localhost


> you may want to file an issue / contact the authors.


I ended up with this solution after having people install and not being
able to start it up.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/6423cea0/attachment.htm>

From bballard at seegrid.com  Wed Aug 15 15:06:56 2012
From: bballard at seegrid.com (Benjamin Ballard)
Date: Wed, 15 Aug 2012 14:06:56 +0000
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502B7A55.7050409@rabbitmq.com>
References: <20120814202926.GA70993@bloaty>,<502B7A55.7050409@rabbitmq.com>
Message-ID: <20CB3CC89D650B419E5909B1CAAE57275A250138@vmexchange02.seegrid.local>

Hello,

I have been seeing similar issues to Alex. I also have a non reliable network that is used to shovel data between two rabbit nodes.  I also see my shovels go down in a terminated state and then never come up again.  My config shovel file has declarations in it to create the exchanges on the remote node.  However sometimes I get the error shown by Alex, and sometimes the rabbit shovel terminates when declaring the exchange (even though it was just connected to that exchange and the connection was working).  It also seems to happen much more frequently when the heartbeat time is set smaller, in the environment that the nodes are working in a 1 second heart beat causes a problem in under 30 min, but moving the heart beat to 5 seconds causes the issue to happen about once a day (Probably environment (non reliable network) specific).  Based on this it would seem to me that that there might be network problems during the starting phase of the shovel (after a disconnect due to heart beat), which cause declarations to fail and the shovel to terminate since having a shovel continuously reconnect with a failing declarations would just cause an infinite loop.  The data (config, shovel status and sasl logs) for these is in https://gist.github.com/3360344 . Since i can detect this failure is there anyway to restart the shovel without restarting rabbit?  Or is there a config option that i am missing to have rabbit shovels to attempt to reconnect even if there is a failure during the starting phase of a rabbit shovel. Could i just detect the shovel failure and then create a new shovel when the first crashes out without restarting all of rabbit?

Thank you,

Ben Ballard
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discu 

ss-bounces at lists.rabbitmq.com] on behalf of Emile Joubert [emile at rabbitmq.com]
Sent: Wednesday, August 15, 2012 6:26 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovel stuck?

Hi,

On 14/08/12 21:29, Alex Zepeda wrote:
> 1.) The logging is exceedingly verbose.  I've set
> {log_levels, [{connection, none}]}, but shovel still dumps a bunch of info in
> the SASL log.  Are there any tunables to turn this down, or would that require
> recompiling shovel?

There are no other tunables, but it should be possible to rotate and
archive old logs regularly. The only other option is to turn logging off
completely in Erlang, something we don't recommend.

> 2.) Occasionally the shovel gets wedged.  Initially it was from running into
> the free disk space limit, but occasionally I'll run into a situation where
> the shovel just terminates for no good reason (stop_app; start_app seems to
> resolve the issue).  Here's the error I'm seeing:

Are there any log entries in the regular or the sasl log that might help
to explain this? How long after starting a shovel does this happen? Can
you reliably reproduce the problem?


-Emile

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at meetme.com  Wed Aug 15 15:08:47 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 15 Aug 2012 10:08:47 -0400
Subject: [rabbitmq-discuss] RabbitMQ cluster on a single machine,
 OSX Lion, Homebrew
In-Reply-To: <CC512372.1F3C0%wchrisjohnson@gmail.com>
References: <502B528E.4010409@rabbitmq.com>
	<CC512372.1F3C0%wchrisjohnson@gmail.com>
Message-ID: <CAKwdTWcr1qoygyy0J0247gNOOuLgTuoP=S-ou4R5JVjd_WpR_A@mail.gmail.com>

On Wed, Aug 15, 2012 at 10:01 AM, Chris Johnson <wchrisjohnson at gmail.com>wrote:

>

Good catch. I will either file a ticket for
> the homebrew change or just submit a pull request and make the change
> myself.


Update the rabbitmq-env.conf file with the node info you want to use. The
behavior of setting a default host in brew for RabbitMQ came out of a
compromise with the brew formula maintainers who did not want users to have
to use sudo to install RabbitMQ to insure it could start up. I can dig up
the pull request discussion if people are interested.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/78a0ef3f/attachment.htm>

From wchrisjohnson at gmail.com  Wed Aug 15 15:16:15 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Wed, 15 Aug 2012 10:16:15 -0400
Subject: [rabbitmq-discuss] RabbitMQ cluster on a single machine,
 OSX Lion, Homebrew
In-Reply-To: <CAKwdTWcr1qoygyy0J0247gNOOuLgTuoP=S-ou4R5JVjd_WpR_A@mail.gmail.com>
Message-ID: <CC5126A8.1F3DE%wchrisjohnson@gmail.com>

If that is the case, would it make sense to update the RMQ online docs on
clustering to mention that as a caveat for Homebrew users? I just spent the
better part of a couple of DAYS trying to get this working. I kept thinking
it was user error on my part due to my inexperience with RMQ?

I've updated the config file.

Chris

From:  "Gavin M. Roy" <gmr at meetme.com>
Reply-To:  Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:  Wednesday, August 15, 2012 10:08 AM
To:  Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Subject:  Re: [rabbitmq-discuss] RabbitMQ cluster on a single machine, OSX
Lion, Homebrew



On Wed, Aug 15, 2012 at 10:01 AM, Chris Johnson <wchrisjohnson at gmail.com>
wrote:
>  
>  Good catch. I will either file a ticket for
> the homebrew change or just submit a pull request and make the change
> myself.

Update the rabbitmq-env.conf file with the node info you want to use. The
behavior of setting a default host in brew for RabbitMQ came out of a
compromise with the brew formula maintainers who did not want users to have
to use sudo to install RabbitMQ to insure it could start up. I can dig up
the pull request discussion if people are interested.

Gavin
_______________________________________________ rabbitmq-discuss mailing
list rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/cfd4d811/attachment.htm>

From emile at rabbitmq.com  Wed Aug 15 16:31:58 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Aug 2012 16:31:58 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <20CB3CC89D650B419E5909B1CAAE57275A250138@vmexchange02.seegrid.local>
References: <20120814202926.GA70993@bloaty>, <502B7A55.7050409@rabbitmq.com>
	<20CB3CC89D650B419E5909B1CAAE57275A250138@vmexchange02.seegrid.local>
Message-ID: <502BC0EE.70102@rabbitmq.com>


Hi Benjamin,


Thanks for this information. Would it be possible for you to run some
commands the next time you detect this condition? Your assistance and
the output from this will help alot to track down the problem.

rabbitmqctl eval 'supervisor2:which_children(rabbit_shovel_sup).'

In the output of this command you will see process identifiers formatted
like <x.y.z> where x, y and z are integers. For each process identifier
<x.y.z> can you also run

rabbitmqctl eval 'erlang:process_info(shell_default:pid(x,y,z)).'

Thanks!


On 15/08/12 15:06, Benjamin Ballard wrote:
> missing to have rabbit shovels to attempt to reconnect even if there
> is a failure during the starting phase of a rabbit shovel. Could i
> just detect the shovel failure and then create a new shovel when the
> first crashes out without restarting all of rabbit?

You may be able to restart shovel independently by issuing
rabbitmqctl eval 'application:stop(rabbitmq_shovel).'
rabbitmqctl eval 'application:start(rabbitmq_shovel).'



-Emile



From brendan at soundcloud.com  Wed Aug 15 17:13:01 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 15 Aug 2012 18:13:01 +0200
Subject: [rabbitmq-discuss] RabbitMQ cluster on a single machine,
 OSX Lion, Homebrew
In-Reply-To: <CC5126A8.1F3DE%wchrisjohnson@gmail.com>
References: <CAKwdTWcr1qoygyy0J0247gNOOuLgTuoP=S-ou4R5JVjd_WpR_A@mail.gmail.com>
	<CC5126A8.1F3DE%wchrisjohnson@gmail.com>
Message-ID: <CAHZsVQaYTt0KoNqFyPh0hHs-D3jqg1tvPo0p0w=H3sF2gCU0Ew@mail.gmail.com>

Rather than going through with all the *-env.conf shenanigans for
development, I have a reusable bash mess that sets up N* nodes.
It uses ruby foreman (gem install foreman) so I can enjoy colorfully
interleaved rabbit startup output, and then Ctrl-C/SIGTERM to bring down
the house.

You'll need this entire directory:
https://github.com/brendanhay/vanguard/tree/master/dev
And is runnable via ./dev/run

It looks for *.config files in ./dev, and sets up a node based on the
filename with an incrementing port range and adjusted environment variables
so there should be no clashes.
(So your nodes from the default above, will be rabbit@`hostname` and
chinchilla@`hostname`, add more configs as needed).

If you're testing clustering, you will need to do all the
rabbitmqctl shenanigans yourself.

- Brendan


On Wed, Aug 15, 2012 at 4:16 PM, Chris Johnson <wchrisjohnson at gmail.com>wrote:

> If that is the case, would it make sense to update the RMQ online docs on
> clustering to mention that as a caveat for Homebrew users? I just spent the
> better part of a couple of DAYS trying to get this working. I kept thinking
> it was user error on my part due to my inexperience with RMQ?
>
> I've updated the config file.
>
> Chris
>
> From: "Gavin M. Roy" <gmr at meetme.com>
> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Date: Wednesday, August 15, 2012 10:08 AM
> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] RabbitMQ cluster on a single machine, OSX
> Lion, Homebrew
>
>
>
> On Wed, Aug 15, 2012 at 10:01 AM, Chris Johnson <wchrisjohnson at gmail.com>wrote:
>
>>
>
> Good catch. I will either file a ticket for
>> the homebrew change or just submit a pull request and make the change
>> myself.
>
>
> Update the rabbitmq-env.conf file with the node info you want to use. The
> behavior of setting a default host in brew for RabbitMQ came out of a
> compromise with the brew formula maintainers who did not want users to have
> to use sudo to install RabbitMQ to insure it could start up. I can dig up
> the pull request discussion if people are interested.
>
> Gavin
> _______________________________________________ rabbitmq-discuss mailing
> list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/40a10313/attachment.htm>

From brendan at soundcloud.com  Wed Aug 15 17:17:12 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 15 Aug 2012 18:17:12 +0200
Subject: [rabbitmq-discuss] RabbitMQ cluster on a single machine,
 OSX Lion, Homebrew
In-Reply-To: <CAHZsVQaYTt0KoNqFyPh0hHs-D3jqg1tvPo0p0w=H3sF2gCU0Ew@mail.gmail.com>
References: <CAKwdTWcr1qoygyy0J0247gNOOuLgTuoP=S-ou4R5JVjd_WpR_A@mail.gmail.com>
	<CC5126A8.1F3DE%wchrisjohnson@gmail.com>
	<CAHZsVQaYTt0KoNqFyPh0hHs-D3jqg1tvPo0p0w=H3sF2gCU0Ew@mail.gmail.com>
Message-ID: <CAHZsVQatqfUNynd2j9x854v_WYXjHaY4nhYEMFC56MUUJHM+AA@mail.gmail.com>

Note: The claimed 'no clashes' below, doesn't account for things like the
management plugin port ..

On Wed, Aug 15, 2012 at 6:13 PM, Brendan Hay <brendan at soundcloud.com> wrote:

> Rather than going through with all the *-env.conf shenanigans for
> development, I have a reusable bash mess that sets up N* nodes.
> It uses ruby foreman (gem install foreman) so I can enjoy colorfully
> interleaved rabbit startup output, and then Ctrl-C/SIGTERM to bring down
> the house.
>
> You'll need this entire directory:
> https://github.com/brendanhay/vanguard/tree/master/dev
> And is runnable via ./dev/run
>
> It looks for *.config files in ./dev, and sets up a node based on the
> filename with an incrementing port range and adjusted environment variables
> so there should be no clashes.
> (So your nodes from the default above, will be rabbit@`hostname` and
> chinchilla@`hostname`, add more configs as needed).
>
> If you're testing clustering, you will need to do all the
> rabbitmqctl shenanigans yourself.
>
> - Brendan
>
>
>
> On Wed, Aug 15, 2012 at 4:16 PM, Chris Johnson <wchrisjohnson at gmail.com>wrote:
>
>> If that is the case, would it make sense to update the RMQ online docs on
>> clustering to mention that as a caveat for Homebrew users? I just spent the
>> better part of a couple of DAYS trying to get this working. I kept thinking
>> it was user error on my part due to my inexperience with RMQ?
>>
>> I've updated the config file.
>>
>> Chris
>>
>> From: "Gavin M. Roy" <gmr at meetme.com>
>> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com
>> >
>> Date: Wednesday, August 15, 2012 10:08 AM
>> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Subject: Re: [rabbitmq-discuss] RabbitMQ cluster on a single machine,
>> OSX Lion, Homebrew
>>
>>
>>
>> On Wed, Aug 15, 2012 at 10:01 AM, Chris Johnson <wchrisjohnson at gmail.com>wrote:
>>
>>>
>>
>> Good catch. I will either file a ticket for
>>> the homebrew change or just submit a pull request and make the change
>>> myself.
>>
>>
>> Update the rabbitmq-env.conf file with the node info you want to use. The
>> behavior of setting a default host in brew for RabbitMQ came out of a
>> compromise with the brew formula maintainers who did not want users to have
>> to use sudo to install RabbitMQ to insure it could start up. I can dig up
>> the pull request discussion if people are interested.
>>
>> Gavin
>> _______________________________________________ rabbitmq-discuss mailing
>> list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/61b2c786/attachment.htm>

From alex at inferiorhumanorgans.com  Wed Aug 15 17:29:54 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Wed, 15 Aug 2012 09:29:54 -0700
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502B7A55.7050409@rabbitmq.com>
References: <20120814202926.GA70993@bloaty>
 <502B7A55.7050409@rabbitmq.com>
Message-ID: <20120815162954.GA14902@bloaty>

On Wed, Aug 15, 2012 at 11:30:45AM +0100, Emile Joubert wrote:

> > 2.) Occasionally the shovel gets wedged.  Initially it was from running into
> > the free disk space limit, but occasionally I'll run into a situation where
> > the shovel just terminates for no good reason (stop_app; start_app seems to
> > resolve the issue).  Here's the error I'm seeing:
> 
> Are there any log entries in the regular or the sasl log that might help
> to explain this? How long after starting a shovel does this happen? Can
> you reliably reproduce the problem?

Apologies.  I *suspected* it was initially due to running into the disk limit,
but I'm not 100% sure.  The sensors are set to reboot daily (not my design
choice), so whatever is happening with shovel takes less than 24 hours and
seems to survive a reboot but not a power cycle.

It is definitely repeatable such that I've disabled shovel on the test sensors
that I can get into.  I've got one that's currently stuck and sending non-rabbit
heartbeats that I'd be happy to investigate when I can gain access (unfortunately
I do not have physical access to any of them).

- alex

From alex at inferiorhumanorgans.com  Wed Aug 15 17:42:16 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Wed, 15 Aug 2012 09:42:16 -0700
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502B7A55.7050409@rabbitmq.com>
References: <20120814202926.GA70993@bloaty>
 <502B7A55.7050409@rabbitmq.com>
Message-ID: <20120815164216.GB14902@bloaty>

On Wed, Aug 15, 2012 at 11:30:45AM +0100, Emile Joubert wrote:

> Are there any log entries in the regular or the sasl log that might help
> to explain this? How long after starting a shovel does this happen? Can
> you reliably reproduce the problem?

Ah, I did, however, copy over some of the log files yesterday.

$ grep -h Reason rabbit\@sensor-9ee2-sasl.log.*  | sort | uniq
     Reason:     badarg
     Reason:     heartbeat_timeout
     Reason:     reached_max_restart_intensity
     Reason:     socket_closed_unexpectedly
     Reason:     {badarg,{gen_server,call,[<0.1482.0>,connect,infinity]}}
     Reason:     {badarg,{gen_server,call,[<0.1486.0>,connect,infinity]}}
     Reason:     {infrastructure_died,{writer,send_failed,badarg}}
     Reason:     {socket_error,einval}
     Reason:     {{badmatch,{error,access_refused}},
     Reason:     {{badmatch,{error,enetunreach}},
     Reason:     {{badmatch,{error,handshake_receive_timed_out}},
     Reason:     {{badmatch,{error,unknown_host}},

The sasl logs are full of supervisor and crash reports. I'd be happy to
provide them to you, with the caveat that they're all pretty large.

- alex

From matthias at rabbitmq.com  Wed Aug 15 17:48:42 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Aug 2012 17:48:42 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502BC0EE.70102@rabbitmq.com>
References: <20120814202926.GA70993@bloaty>, <502B7A55.7050409@rabbitmq.com>
	<20CB3CC89D650B419E5909B1CAAE57275A250138@vmexchange02.seegrid.local>
	<502BC0EE.70102@rabbitmq.com>
Message-ID: <502BD2EA.8070004@rabbitmq.com>

On 15/08/12 16:31, Emile Joubert wrote:
> rabbitmqctl eval 'supervisor2:which_children(rabbit_shovel_sup).'

That would indeed be good to have.

> rabbitmqctl eval 'erlang:process_info(shell_default:pid(x,y,z)).'

Actually, the following would probably be more useful to us:

rabbitmqctl eval '[io:format("~p:~n~s~n", [Pid, element(2, 
erlang:process_info(Pid, backtrace))]) || {_, Pid, _, _} <- 
supervisor2:which_children(rabbit_shovel_sup), Pid =/= undefined].'

(all on one line).

Matthias.

From matthias at rabbitmq.com  Wed Aug 15 17:56:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Aug 2012 17:56:22 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <20120815164216.GB14902@bloaty>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty>
Message-ID: <502BD4B6.7010009@rabbitmq.com>

Alex,

On 15/08/12 17:42, Alex Zepeda wrote:
> The sasl logs are full of supervisor and crash reports. I'd be happy to
> provide them to you, with the caveat that they're all pretty large.

All we need is a few minutes of log around the time reported in the
rabbit_shovel_status:status() when the shovels show as 'terminated'.

And, as we suggested to Benjamin in this thread, the output of

rabbitmqctl eval 'supervisor2:which_children(rabbit_shovel_sup).'

and

rabbitmqctl eval '[io:format("~p:~n~s~n", [Pid, element(2, 
erlang:process_info(Pid, backtrace))]) || {_, Pid, _, _} <- 
supervisor2:which_children(rabbit_shovel_sup), Pid =/= undefined].'


would be useful too.


Regards,

Matthias.

From francesco at rabbitmq.com  Wed Aug 15 18:01:45 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 15 Aug 2012 18:01:45 +0100
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F387@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>
Message-ID: <87txw4nl6u.wl%francesco@rabbitmq.com>

Hi Jon,

At Wed, 15 Aug 2012 14:00:54 +0000,
Jon Bergli Heier wrote:
> This is the shovel config on the broker (with credentials and hostnames
> replaced).  The broker nodes in destination are the cluster nodes, and source
> is the local broker I'm shoveling messages from.
> 
> [...]
> 
> The problem appears when I shut down and then start rabbit1 or rabbit2 (using
> either the debian init script or rabbitmqctl stop_app). All servers are VMs,
> and I've also reproduced this problem by forcing a shutdown of the VM and then
> booting it up again.
>
> I've checked the shovel status in the management interface and it always shows
> as "running" even when the problem appears.

OK, so if I understand correctly after you restart rabbit1 or rabbit2 the shovel
plugin stops sending ack after consuming from the source queue, right?

> On a related note, when letting the broker sit idle for a while (approx. 24
> hours by now) the shovel seems to disconnect from the destination without
> reconnecting even with messages still in the source queue (all of them shows
> as "ready" with none "unacked").

Mhm.  Again, what does the shovel status show?  The logs would be useful as
well.

--
Francesco * Often in error, never in doubt

From markiyan.kushnir at gmail.com  Wed Aug 15 18:02:08 2012
From: markiyan.kushnir at gmail.com (Markiyan Kushnir)
Date: Wed, 15 Aug 2012 20:02:08 +0300
Subject: [rabbitmq-discuss] Any message priority support schedule?
Message-ID: <502BD610.1060004@gmail.com>

Hello,

Could anybody please shed light on when message priority support would 
be added to RabbitMQ? I'm aware of workarounds like "priority-dedicated" 
queues or shifting the priority management completely to the application 
side. I'm now considering several approaches, and with the priority 
support in the RabbitMQ my applications and the infrastructure would 
become simpler.

Thanks,
Markiyan.

From alex at inferiorhumanorgans.com  Wed Aug 15 18:07:09 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Wed, 15 Aug 2012 10:07:09 -0700
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502BD4B6.7010009@rabbitmq.com>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
Message-ID: <20120815170709.GC14902@bloaty>

On Wed, Aug 15, 2012 at 05:56:22PM +0100, Matthias Radestock wrote:

> All we need is a few minutes of log around the time reported in the
> rabbit_shovel_status:status() when the shovels show as 'terminated'.
> 
> And, as we suggested to Benjamin in this thread, the output of
> 
> rabbitmqctl eval 'supervisor2:which_children(rabbit_shovel_sup).'
> 
> and
> 
> rabbitmqctl eval '[io:format("~p:~n~s~n", [Pid, element(2, 
> erlang:process_info(Pid, backtrace))]) || {_, Pid, _, _} <- 
> supervisor2:which_children(rabbit_shovel_sup), Pid =/= undefined].'

When I can get back into the sensor I'll see what I can do.

Thanks.

- alex

From francesco at rabbitmq.com  Wed Aug 15 18:09:14 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 15 Aug 2012 18:09:14 +0100
Subject: [rabbitmq-discuss] Any message priority support schedule?
In-Reply-To: <502BD610.1060004@gmail.com>
References: <502BD610.1060004@gmail.com>
Message-ID: <87sjbonkud.wl%francesco@rabbitmq.com>

Hi Markiyan,

At Wed, 15 Aug 2012 20:02:08 +0300,
Markiyan Kushnir wrote:
> Could anybody please shed light on when message priority support would be
> added to RabbitMQ? I'm aware of workarounds like "priority-dedicated" queues
> or shifting the priority management completely to the application side. I'm
> now considering several approaches, and with the priority support in the
> RabbitMQ my applications and the infrastructure would become simpler.

Right now nobody is working on it.  We've had a bug open for a long time and we
plan to implement it at some point, but it's not on our list of things to do
now, so it won't happen soon.

--
Francesco * Often in error, never in doubt

From markiyan.kushnir at gmail.com  Wed Aug 15 18:16:16 2012
From: markiyan.kushnir at gmail.com (Markiyan Kushnir)
Date: Wed, 15 Aug 2012 20:16:16 +0300
Subject: [rabbitmq-discuss] Any message priority support schedule?
In-Reply-To: <87sjbonkud.wl%francesco@rabbitmq.com>
References: <502BD610.1060004@gmail.com> <87sjbonkud.wl%francesco@rabbitmq.com>
Message-ID: <502BD960.2060708@gmail.com>

On 15.08.2012 20:09, Francesco Mazzoli wrote:
> Hi Markiyan,
>
> At Wed, 15 Aug 2012 20:02:08 +0300,
> Markiyan Kushnir wrote:
>> Could anybody please shed light on when message priority support would be
>> added to RabbitMQ? I'm aware of workarounds like "priority-dedicated" queues
>> or shifting the priority management completely to the application side. I'm
>> now considering several approaches, and with the priority support in the
>> RabbitMQ my applications and the infrastructure would become simpler.
>
> Right now nobody is working on it.  We've had a bug open for a long time and we
> plan to implement it at some point, but it's not on our list of things to do
> now, so it won't happen soon.
>

Thanks for the update, it helped me adjust my road map.

--
Markiyan.

> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From bballard at seegrid.com  Wed Aug 15 18:17:37 2012
From: bballard at seegrid.com (Benjamin Ballard)
Date: Wed, 15 Aug 2012 17:17:37 +0000
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <20120815170709.GC14902@bloaty>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty>
	<502BD4B6.7010009@rabbitmq.com>,<20120815170709.GC14902@bloaty>
Message-ID: <20CB3CC89D650B419E5909B1CAAE57275A2512BC@vmexchange02.seegrid.local>

Hello,

The update output of
> rabbitmqctl eval '[io:format("~p:~n~s~n", [Pid, element(2,
> erlang:process_info(Pid, backtrace))]) || {_, Pid, _, _} <-
> supervisor2:which_children(rabbit_shovel_sup), Pid =/= undefined].'  
is at https://gist.github.com/3361703

Ben
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Alex Zepeda [alex at inferiorhumanorgans.com]
Sent: Wednesday, August 15, 2012 1:08 PM
To: Matthias Radestock
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Shovel stuck?

On Wed, Aug 15, 2012 at 05:56:22PM +0100, Matthias Radestock wrote:

> All we need is a few minutes of log around the time reported in the
> rabbit_shovel_status:status() when the shovels show as 'terminated'.
>
> And, as we suggested to Benjamin in this thread, the output of
>
> rabbitmqctl eval 'supervisor2:which_children(rabbit_shovel_sup).'
>
> and
>
> rabbitmqctl eval '[io:format("~p:~n~s~n", [Pid, element(2,
> erlang:process_info(Pid, backtrace))]) || {_, Pid, _, _} <-
> supervisor2:which_children(rabbit_shovel_sup), Pid =/= undefined].'

When I can get back into the sensor I'll see what I can do.

Thanks.

- alex
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Wed Aug 15 18:22:13 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Aug 2012 18:22:13 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <20CB3CC89D650B419E5909B1CAAE57275A2512BC@vmexchange02.seegrid.local>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>,
	<20120815170709.GC14902@bloaty>
	<20CB3CC89D650B419E5909B1CAAE57275A2512BC@vmexchange02.seegrid.local>
Message-ID: <502BDAC5.3040407@rabbitmq.com>

On 15/08/12 18:17, Benjamin Ballard wrote:
> The update output of
>> rabbitmqctl eval '[io:format("~p:~n~s~n", [Pid, element(2,
>> erlang:process_info(Pid, backtrace))]) || {_, Pid, _, _} <-
>> supervisor2:which_children(rabbit_shovel_sup), Pid =/= undefined].'
> is at https://gist.github.com/3361703

Thanks. And the output of the first command, i.e.

rabbitmqctl eval 'supervisor2:which_children(rabbit_shovel_sup).'

?

Matthias.

From alex at inferiorhumanorgans.com  Wed Aug 15 18:30:03 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Wed, 15 Aug 2012 10:30:03 -0700
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502BD4B6.7010009@rabbitmq.com>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
Message-ID: <20120815173003.GD14902@bloaty>

On Wed, Aug 15, 2012 at 05:56:22PM +0100, Matthias Radestock wrote:

> All we need is a few minutes of log around the time reported in the
> rabbit_shovel_status:status() when the shovels show as 'terminated'.

The relevant portions of the logs are now here:

<https://gist.github.com/3361780>
<https://gist.github.com/3361761>

The expected 'channel.open' errors are to be expected (the heartbeat
script needs to be cleaned up), and the rabbit config at the time was
using localhost instead of the internal erlang connection.

- alex

From matthias at rabbitmq.com  Wed Aug 15 18:44:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Aug 2012 18:44:04 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <20120815173003.GD14902@bloaty>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
	<20120815173003.GD14902@bloaty>
Message-ID: <502BDFE4.60705@rabbitmq.com>

Alex,

On 15/08/12 18:30, Alex Zepeda wrote:
> On Wed, Aug 15, 2012 at 05:56:22PM +0100, Matthias Radestock wrote:
>
>> All we need is a few minutes of log around the time reported in the
>> rabbit_shovel_status:status() when the shovels show as 'terminated'.
>
> The relevant portions of the logs are now here:
>
> <https://gist.github.com/3361780>
> <https://gist.github.com/3361761>

The last entry's timestamp coincides with that in the shovel status. Is 
there anything in the latter log *after* that point?

What version of rabbitmq are you running?

Also, please post the output of

rabbitmqctl eval 'supervisor2:which_children(rabbit_shovel_sup).'

and

rabbitmqctl eval '[io:format("~p:~n~s~n", [Pid, element(2, 
erlang:process_info(Pid, backtrace))]) || {_, Pid, _, _} <- 
supervisor2:which_children(rabbit_shovel_sup), Pid =/= undefined].'

(all one line)


Matthias.

From alex at inferiorhumanorgans.com  Wed Aug 15 18:57:47 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Wed, 15 Aug 2012 10:57:47 -0700
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502BDFE4.60705@rabbitmq.com>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
	<20120815173003.GD14902@bloaty> <502BDFE4.60705@rabbitmq.com>
Message-ID: <20120815175747.GE14902@bloaty>

On Wed, Aug 15, 2012 at 06:44:04PM +0100, Matthias Radestock wrote:

> The last entry's timestamp coincides with that in the shovel status. Is 
> there anything in the latter log *after* that point?

Here's the next few minutes of the log files:

<https://gist.github.com/3361930>
<https://gist.github.com/3361963>

It looks like I restarted rabbit around 7:13.  At that point it appeared as
if the shovel had been wedged for about 16 minutes (IIRC there were eight
messages in the 'heartbeat' queue, one is generated roughly every two minutes).

> What version of rabbitmq are you running?

2.8.5 from the debian packages on rabbitmq.com

Erlang should be whatever the latest Ubuntu 11.04 package is.

> Also, please post the output of
> 
> rabbitmqctl eval 'supervisor2:which_children(rabbit_shovel_sup).'
> 
> and
> 
> rabbitmqctl eval '[io:format("~p:~n~s~n", [Pid, element(2, 
> erlang:process_info(Pid, backtrace))]) || {_, Pid, _, _} <- 
> supervisor2:which_children(rabbit_shovel_sup), Pid =/= undefined].'
> 
> (all one line)

When I regain access to the sensor I will try this.  Right now I'm
just going through the log files I copied over the last time I was
able to log in (early yesterday).

- alex

From matthias at rabbitmq.com  Wed Aug 15 19:18:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Aug 2012 19:18:56 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <20120815175747.GE14902@bloaty>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
	<20120815173003.GD14902@bloaty> <502BDFE4.60705@rabbitmq.com>
	<20120815175747.GE14902@bloaty>
Message-ID: <502BE810.9040006@rabbitmq.com>

Alex,

On 15/08/12 18:57, Alex Zepeda wrote:
> Here's the next few minutes of the log files:

Thanks. I think I've found the problem. Unfortunately there's no quick 
fix / workaround, so you are going to have to wait until we release a fix.

Matthias.


From alex at inferiorhumanorgans.com  Wed Aug 15 19:50:16 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Wed, 15 Aug 2012 11:50:16 -0700
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502BE810.9040006@rabbitmq.com>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
	<20120815173003.GD14902@bloaty> <502BDFE4.60705@rabbitmq.com>
	<20120815175747.GE14902@bloaty> <502BE810.9040006@rabbitmq.com>
Message-ID: <20120815185015.GF14902@bloaty>

On Wed, Aug 15, 2012 at 07:18:56PM +0100, Matthias Radestock wrote:

> On 15/08/12 18:57, Alex Zepeda wrote:
> > Here's the next few minutes of the log files:
> 
> Thanks. I think I've found the problem. Unfortunately there's no quick 
> fix / workaround, so you are going to have to wait until we release a fix.

Well, the other thing that stands out is that the shovel seems to remain
wedged across reboots but gets unstuck after a power cycle.  My current
hypothesis is that power cycling leaves the filesystem in an inconsistent
state resulting in the mnesia files getting zapped.

Any idea if there's a good way to unwedge the shovel?

Also, any ETA for a proper fix?

- alex

From torinsandall at gmail.com  Wed Aug 15 20:33:08 2012
From: torinsandall at gmail.com (Torin Sandall)
Date: Wed, 15 Aug 2012 12:33:08 -0700
Subject: [rabbitmq-discuss] rabbitmq cluster manage/ops questions
Message-ID: <CABKNZ0WLxass4E-_TYYGKRi5iWTav_WOEQ=bTqJ4sep9BRzWSg@mail.gmail.com>

Hello,

I'm working on a project involving clustered rabbitmq brokers and I
would like to gain a better understanding of the operational
constraints. I've read the clustering article on the site, but I feel
like I don't have a solid understanding of it yet.

Specific questions:

1) What constraints need to be observed to guarantee the cluster state
remains consistent. I.e., the cluster will not fall into a "split
brain" state.
2) Is there anything invalid or problematic about the tests I describe below?

I've been running tests involving 2-3 clustered brokers. All brokers
are running 2.7.1. The cookies are synched properly.

The cluster can be in one of the following states:

2 disc
2 disc, 1 ram
3 disc

In any of the states, my test can kill one of the brokers (ram or
disc, it doesn't discriminate.) If a broker is killed the next event
the test would execute is either a restart of the dead broker or a
replacement of the dead broker. Replacement is done by deleting the
mnesia database on that node and then service start, stop_app, reset,
force_cluster, start_app.

In the 2 broker-cluster states, the cluster can be grown to size of 3.

In the 3 broker-cluster states, the cluster can be shrunk to size of 2
with a constraint that it won't ever shrink to 1 disc/1 ram.

Growing and shrinking of the cluster is always done by running
rabbitmqctl commands. I.e., there's no cluster configuration in the
rabbitmq.config file. For those who will ask, the commands I'm running
to grow and shrink the cluster are:

1) grow cluster by adding a ram node
rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl cluster <existing-disc-node>
rabbitmqctl start_app

2) grow cluster by adding a disc node
rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl cluster <existing-disc-node> <node-to-be-added>
rabbitmqctl stop_app

3) shrink cluster by removing a node
rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl start_app

I'm not inserting any delays between execution of events (other than
the implicit delay of having to ssh into the server and execute the
command.)

One issue I've encountered so far:

1) rabbit fails to start after shrinking 2 disc/1 ram cluster to 2
disc cluster and then killing a disc node. Here's teh log from the
disc node which fails to start. There's also output from my test
script at the bottom which shows the cluster status:
http://pastebin.com/95McUzkb

-Torin

From bobtkat at gmail.com  Wed Aug 15 16:02:12 2012
From: bobtkat at gmail.com (Bobby Castleberry)
Date: Wed, 15 Aug 2012 08:02:12 -0700 (PDT)
Subject: [rabbitmq-discuss] simple federation question
Message-ID: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>

So I'm attempting a simple federation setup.  I have one server 
distributing an exchange to two end point servers.  Well it seems like it 
should be a simple set up but I must be missing something obvious.  When I 
check the federation status I just see []...done.  I've confirmed that I 
can connect to both of the end points from the distribution server just 
fine on 5672.  There are no errors in the main or startup logs.  If anyone 
can point me in a direction for something to check or a mistake in the 
config I would be greatly appreciative.  

---- start of rabbitmq.config
[{rabbit,
    [{rabbitmq_federation,
        [ { exchanges, [
          { exchange, "graphite" }, 
          { type, "topic" }, 
          { upstream_set, "gdisplay" }, 
          { durable, "true" } 
         ]},
         { upstream_sets, [ 
         {"gdisplay",
           [
           [{ connection, "sansketch8display1" },
             { exchange, "graphite" }] , 
           [{ connection, "sansketch8display2" },
             { exchange, "graphite" }] ] 
         } ]}, 
         { connections, [ 
         {"sansketch8display1",
          [
          { prefetch_count, 1000 }, 
          { ha_policy, "all" }, 
          { expires, 3000 }, 
          { port, 5672 }, 
          { protocol, "amqp" }, 
          { virtual_host, "/" }, 
          { mechanism, default }, 
          { host, "sansketch8display1" }, 
          { reconnect_delay, 5 }, 
          { message_ttl, 10000 }, 
          { heartbeat, 1 }] 
         }, 
         {"sansketch8display2",
          [
          { prefetch_count, 1000 }, 
          { ha_policy, "all" }, 
          { expires, 3000 }, 
          { port, 5672 }, 
          { protocol, "amqp" }, 
          { virtual_host, "/" }, 
          { mechanism, default }, 
          { host, "sansketch8display2" }, 
          { reconnect_delay, 5 }, 
          { message_ttl, 10000 }, 
          { heartbeat, 1 }] 
         }
         ]}
]}]
}
].
-------- End of config


----  Main log output:
=INFO REPORT==== 15-Aug-2012::10:42:10 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
Memory limit set to 803MB of 2009MB total.

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
Disk free limit set to 2009MB

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
Management agent started.

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
Management plugin started. Port: 55672, path: /

=INFO REPORT==== 15-Aug-2012::10:42:10 ===
Statistics database started.

------ End main log

------ Start up log:
Activating RabbitMQ plugins ...
8 plugins activated:
* amqp_client-2.8.2
* mochiweb-1.3-rmq2.8.2-git
* rabbitmq_federation-2.8.2
* rabbitmq_federation_management-2.8.2
* rabbitmq_management-2.8.2
* rabbitmq_management_agent-2.8.2
* rabbitmq_mochiweb-2.8.2
* webmachine-1.7.0-rmq2.8.2-hg

** Found 0 name clashes in code paths 

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.8.2  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at sansketch8polling1
app descriptor : 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
home dir       : /home/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
database dir   : /var/lib/rabbitmq/mnesia/rabbit at sansketch8polling1
erlang version : 5.7.4

-- rabbit boot start
starting file handle cache server                                     
...done
starting worker pool                                                  
...done
starting database                                                     
...done
starting database sync                                                
...done
starting codec correctness check                                      
...done
-- external infrastructure ready
starting statistics event manager                                     
...done
starting logging server                                               
...done
starting plugin registry                                              
...done
starting auth mechanism amqplain                                      
...done
starting auth mechanism cr-demo                                       
...done
starting auth mechanism plain                                         
...done
starting exchange type direct                                         
...done
starting exchange type fanout                                         
...done
starting exchange type headers                                        
...done
starting exchange type topic                                          
...done
-- kernel ready
starting node monitor                                                 
...done
starting cluster delegate                                             
...done
starting guid generator                                               
...done
starting alarm handler                                                
...done
starting memory monitor                                               
...done
-- core initialized
starting federation                                                   
...done
starting federation exchange type                                     
...done
starting federation upstream exchange type                            
...done
starting management agent                                             
...done
starting exchange, queue and binding recovery                         
...done
starting configured definitions                                       
...done
starting empty DB check                                               
...done
starting mirror queue slave sup                                       
...done
starting adding mirrors to queues                                     
...done
-- message delivery logic ready
starting error log relay                                              
...done
starting networking                                                   
...done
starting notify cluster nodes                                         
...done
starting direct client                                                
...done

broker running
--- End main log

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/697a5e84/attachment.htm>

From bobtkat at gmail.com  Thu Aug 16 00:07:05 2012
From: bobtkat at gmail.com (Bobby Castleberry)
Date: Wed, 15 Aug 2012 16:07:05 -0700 (PDT)
Subject: [rabbitmq-discuss] simple federation question
In-Reply-To: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>
References: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>
Message-ID: <718ace7f-3a02-4ffc-89d1-0eee03803fa7@googlegroups.com>


Ok so I figured out that my config was wrong in that it had 
rabbitmq_federation as a subsection of rabbit which unfortunately causes it 
to fail silently.  I have corrected that and a few other things leading to 
a semi-working config of:

[{rabbit,[
    {tcp_listeners, [5672]}
]},
{rabbitmq_federation,
[
        { exchanges,[
                [
                      { exchange, "graphite-uplink" }, 
                      { virtual_host, "/" },
                      { type, "topic" }, 
                      { upstream_set, "gdisplay" }
                ]
        ]},
        { upstream_sets,
            [
                {"gdisplay",
                    [
                       [
                            { connection, "sansketch8display1" },
                            { exchange, "graphite" }
                        ] , 
                       [
                            { connection, "sansketch8display2" },
                            { exchange, "graphite" }
                        ]
                    ] 
                }
            ]
        },
        { connections,
            [ 
                {"sansketch8display1",
                    [
                        { prefetch_count, 1000 }, 
                        { ha_policy, "all" }, 
                        { expires, 3000 }, 
                        { port, 5672 }, 
                        { protocol, "amqp" }, 
                        { virtual_host, "/" }, 
                        { mechanism, default }, 
                        { host, "sansketch8display1" }, 
                        { reconnect_delay, 5 }, 
                        { message_ttl, 10000 }, 
                        { heartbeat, 1 },
                        {max_hops, 2}
                    ] 
                }, 
                {"sansketch8display2",
                    [
                      { prefetch_count, 1000 }, 
                      { ha_policy, "all" }, 
                      { expires, 3000 }, 
                      { port, 5672 }, 
                      { protocol, "amqp" }, 
                      { virtual_host, "/" }, 
                      { mechanism, default }, 
                      { host, "sansketch8display2" }, 
                      { reconnect_delay, 5 }, 
                      { message_ttl, 10000 }, 
                        {username, "guest"},
                        {password, "guest"},
                      { heartbeat, 1 },
                        {prefetch_count, 1000},
                        {max_hops, 2}
                    ] 
                }
            ]
        },
        {local_username, "guest"},
        {local_nodename, "sansketch8polling1"}
    ]
}].
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/993c4ae8/attachment.htm>

From tadw99 at googlemail.com  Thu Aug 16 01:07:20 2012
From: tadw99 at googlemail.com (Tom Wrigg)
Date: Wed, 15 Aug 2012 17:07:20 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Latency
Message-ID: <c22e38fa-9767-40eb-bc22-b558a147f1da@googlegroups.com>

I'm running RabbitMQ with the node.js amqp-node client. I've set up a 
simple publish/consume test in two different ways each produces a different 
latency and I can't work out why. The latency was measured from the time 
the message was sent to the time it was delivered.

The first method uses two separate processes - one for the publishing app - 
one for the consuming app. It produces a latency of about at 4ms. The 
second method uses just one app to produce and consume. This produces a 
latency of about 40ms. Can anyone explain to me why? Thank you for your 
time.

*Method #1 Producer:*

    var amqp = require('amqp'),
> connection = amqp.createConnection({host:'localhost'}),
> testExchange = {};
> connection.on('ready', function(){
> testExchange = connection.exchange('testExchange', {type:'topic', 
> autoDelete:true});
> testMessage();
> });

 

>
> function testMessage(){
> console.log('message sent');
> testExchange.publish('test.message', { msg:'testMessage', time: new 
> Date().getTime() });
> setTimeout(testMessage, 500);
> }

 

>  

> * Method #1 Consumer*
*
*

var amqp = require('amqp'),
> connection = amqp.createConnection({host:'localhost'}),
> connection.on('ready', function(){
> var testExchange = connection.exchange('testExchange', {type:'topic', 
> autoDelete:true});
> var testQ = connection.queue('testQ', function(queue){
> queue.bind('testExchange', 'test.#');
> queue.subscribe( function(message){
> console.log('message received');
> var now = new Date().getTime();
> console.log(now-message.time);
> });
> });
> });


*Method #2 Producer and Consumer *

var amqp = require('amqp'),
> connection = amqp.createConnection({host:'localhost'}),
> testExchange = {};
> connection.on('ready', function(){
> testExchange = connection.exchange('testExchange', {type:'topic', 
> autoDelete:true});
> var testQ = connection.queue('testQ', function(queue){
> queue.bind('testExchange', 'test.#');
> queue.subscribe( function(message){
> console.log('message received');
> var now = new Date().getTime();
> console.log(now-message.time);
> });
> testMessage();
> });
> });
> function testMessage(){
> console.log('message sent');
> testExchange.publish('test.message', { msg:'testMessage', time: new 
> Date().getTime() });
> setTimeout(testMessage, 500);
> }
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/d5736f4c/attachment.htm>

From wchrisjohnson at gmail.com  Thu Aug 16 01:33:50 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Wed, 15 Aug 2012 20:33:50 -0400
Subject: [rabbitmq-discuss] x-message-ttl extension to RabbitMQ
Message-ID: <CC51B82E.1F5A9%wchrisjohnson@gmail.com>

Hi,

I'm building a messaging solution where we'd like messages in several queues
to stick around for several days to a week or more. In the documentation, it
seems to say that this is achievable via the Time-To-Live extension:

http://www.rabbitmq.com/ttl.html#per-queue-message-ttl

I have a queue declared as such:

        @queue ||= client.queue(QUEUE,
                                :durable => true,
                                :autodelete => false,
                                :arguments => {'x-ha-policy' => 'all',
                                               'x-message-ttl' =>
2147483647})

Obviously, I just picked a big number for the TTL?

The messages I'm pushing onto this queue are getting deleted immediately, as
least as far as I can tell within the dashboard UI.

Am I going about this correctly?

Chris


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/b1d6de61/attachment.htm>

From julio at hawaii.edu  Thu Aug 16 02:01:52 2012
From: julio at hawaii.edu (Julio Polo)
Date: Wed, 15 Aug 2012 15:01:52 -1000
Subject: [rabbitmq-discuss] Perl AnyEvent::RabbitMQ,
 "Received data is not body frame" issues
In-Reply-To: <501645CD.9080302@rabbitmq.com>
References: <CAAAKxg+7uv3j_7BiyrOtY1Nx=AYBfgjWYWzxxaW+uoXGv+X8_g@mail.gmail.com>
	<50163AE0.4080100@strategicdata.com.au> <501645CD.9080302@rabbitmq.com>
Message-ID: <CA+0gB9nXm9p=w1sOKuvfYAw+a6UUWxEb2_i1JxnLR4TKWoov=Q@mail.gmail.com>

If you still want to give AnyEvent::RabbitMQ a chance, I recently
posted our RabbitMessaging Perl module at

https://www.hawaii.edu/bwiki/display/UHIAM/Download

It makes using AnyEvent::RabbitMQ easier, but probably at the expense
of AnyEvent functionality.  Be sure to apply the patches documented
there.

Julio Polo
Identity and Access Management
University of Hawaii

On Sun, Jul 29, 2012 at 10:29 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> On 30/07/12 08:42, Toby Corkindale wrote:
>>
>> On 29/07/12 02:35, Frank Mastronardi wrote:
>>>
>>> I am using Perl and there is not much examples w/ just using
>>> AnyEvent::RabbitMQ.
>>
>>
>> The author of that library abandoned it; they haven't responded to bugs
>> or patches for at least a year or more, and I recall that it didn't work
>> well when I tried it even longer ago.
>>
>> I use Net::STOMP::Client. It works well, and the author is active on
>> this list.
>
>
> There is also POE::Component::Client::AMQP -
> http://search.cpan.org/dist/POE-Component-Client-AMQP/ - which is actively
> maintained.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Thu Aug 16 08:39:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Aug 2012 08:39:00 +0100
Subject: [rabbitmq-discuss] x-message-ttl extension to RabbitMQ
In-Reply-To: <CC51B82E.1F5A9%wchrisjohnson@gmail.com>
References: <CC51B82E.1F5A9%wchrisjohnson@gmail.com>
Message-ID: <502CA394.90702@rabbitmq.com>

Hi Chris,

On 16/08/12 01:33, Chris Johnson wrote:
> I'm building a messaging solution where we'd like messages in several
> queues to stick around for several days to a week or more. In the
> documentation, it seems to say that this is achievable via the
> Time-To-Live extension:

If you don't want messages to expire at all then you don't need to
provide any argument. The default is for messages never to expire.

> 'x-message-ttl' => 2147483647})

> The messages I'm pushing onto this queue are getting deleted
> immediately, as least as far as I can tell within the dashboard UI.

Check what value the broker received and make sure the value is what you
expect:

rabbitmqctl list_queues name arguments



-Emile


From jon.bergli.heier at zisson.no  Thu Aug 16 10:13:59 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Thu, 16 Aug 2012 09:13:59 +0000
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <87txw4nl6u.wl%francesco@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87txw4nl6u.wl%francesco@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F437@osl02-exc-001>

> OK, so if I understand correctly after you restart rabbit1 or rabbit2 the shovel
> plugin stops sending ack after consuming from the source queue, right?

Yes, that seems to be the case.

> Mhm.  Again, what does the shovel status show?  The logs would be useful as
> well.

The shovel status still shows as running on this point. I checked the logs and
couldn't find anything (I have no idea exactly when the shovel disconnects).

I have attached the logs in case they might be of help.

________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco Mazzoli [francesco at rabbitmq.com]
Sent: Wednesday, August 15, 2012 19:01
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovel stops receiving acks from cluster

Hi Jon,

At Wed, 15 Aug 2012 14:00:54 +0000,
Jon Bergli Heier wrote:
> This is the shovel config on the broker (with credentials and hostnames
> replaced).  The broker nodes in destination are the cluster nodes, and source
> is the local broker I'm shoveling messages from.
>
> [...]
>
> The problem appears when I shut down and then start rabbit1 or rabbit2 (using
> either the debian init script or rabbitmqctl stop_app). All servers are VMs,
> and I've also reproduced this problem by forcing a shutdown of the VM and then
> booting it up again.
>
> I've checked the shovel status in the management interface and it always shows
> as "running" even when the problem appears.

OK, so if I understand correctly after you restart rabbit1 or rabbit2 the shovel
plugin stops sending ack after consuming from the source queue, right?

> On a related note, when letting the broker sit idle for a while (approx. 24
> hours by now) the shovel seems to disconnect from the destination without
> reconnecting even with messages still in the source queue (all of them shows
> as "ready" with none "unacked").

Mhm.  Again, what does the shovel status show?  The logs would be useful as
well.

--
Francesco * Often in error, never in doubt
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.log.gz
Type: application/x-gzip
Size: 18737 bytes
Desc: rabbit.log.gz
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120816/195f03e3/attachment.bin>

From simon at rabbitmq.com  Thu Aug 16 10:25:30 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 Aug 2012 10:25:30 +0100
Subject: [rabbitmq-discuss] simple federation question
In-Reply-To: <718ace7f-3a02-4ffc-89d1-0eee03803fa7@googlegroups.com>
References: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>
	<718ace7f-3a02-4ffc-89d1-0eee03803fa7@googlegroups.com>
Message-ID: <502CBC8A.5040506@rabbitmq.com>

On 16/08/12 00:07, Bobby Castleberry wrote:
> I have corrected that and a few other things leading to a semi-working
> config  <snip>

How is it semi-working? What is the problem?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From francesco at rabbitmq.com  Thu Aug 16 11:41:48 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 16 Aug 2012 11:41:48 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster manage/ops questions
In-Reply-To: <CABKNZ0WLxass4E-_TYYGKRi5iWTav_WOEQ=bTqJ4sep9BRzWSg@mail.gmail.com>
References: <CABKNZ0WLxass4E-_TYYGKRi5iWTav_WOEQ=bTqJ4sep9BRzWSg@mail.gmail.com>
Message-ID: <87pq6rnmoj.wl%francesco@rabbitmq.com>

Hi Torin,

At Wed, 15 Aug 2012 12:33:08 -0700,
Torin Sandall wrote:
> I'm working on a project involving clustered rabbitmq brokers and I would like
> to gain a better understanding of the operational constraints. I've read the
> clustering article on the site, but I feel like I don't have a solid
> understanding of it yet.
> 
> Specific questions:
> 
> 1) What constraints need to be observed to guarantee the cluster state remains
> consistent. I.e., the cluster will not fall into a "split brain" state.

There are various situations that will mess up clustering.  In general, problems
arise when tables change on some node while other cluster nodes are unaware of
the change.  When something like that happen, mnesia will spit out a "fatal"
error and rabbit will die.

Common scenarios:

  1. A and B are in a cluster.  The connection between A and B is severed, and
     some changes are made to the tables in A or/and B.  When the connection is
     re-established, mnesia will detect that the tables have diverged and die.
  2. A and B are in a cluster.  A is stopped.  B is stopped, reset, and brought
     back online.  A is brought back online, it tries to cluster with B but B's
     schema is now incompatible with A's -> A dies.
  3. A gets clustered to B as a ram node.  C gets clustered to B as a disc
     node. A is stopped.  B is stopped, reset and started again.  A is stopped
     and started again.  A dies because it still thinks that B is in the
     cluster, given that it is a ram node.

We can't do much about 1.

2 and 3 have many variations, and we are working to make the situation much
better - the changes should be available in the next feature release.

> 2) Is there anything invalid or problematic about the tests I describe below?
> 
> I've been running tests involving 2-3 clustered brokers. All brokers are
> running 2.7.1. The cookies are synched properly.

Please upgrade to the last version :).

> The cluster can be in one of the following states:
> 
> 2 disc
> 2 disc, 1 ram
> 3 disc
> 
> In any of the states, my test can kill one of the brokers (ram or disc, it
> doesn't discriminate.) If a broker is killed the next event the test would
> execute is either a restart of the dead broker or a replacement of the dead
> broker. Replacement is done by deleting the mnesia database on that node and
> then service start, stop_app, reset, force_cluster, start_app.

Mhm.  Using `force_cluster' is almost always a bad idea.  However in the current
state of things it is necessary sometimes.  When the mentioned clustering
changes will be released `force_cluster' will be removed, since there will be no
reasonable use cases.

For example your use case is a bad one, since `force_cluster' relies on the node
you're clustering to already have tables matching the other nodes', but that
will not be the case since you have just reset it.

In general make sure that you know what you're doing when you're using it.

> In the 2 broker-cluster states, the cluster can be grown to size of 3.
> 
> In the 3 broker-cluster states, the cluster can be shrunk to size of 2 with a
> constraint that it won't ever shrink to 1 disc/1 ram.
> 
> Growing and shrinking of the cluster is always done by running rabbitmqctl
> commands. I.e., there's no cluster configuration in the rabbitmq.config
> file. For those who will ask, the commands I'm running to grow and shrink the
> cluster are:
> 
> 1) grow cluster by adding a ram node
> rabbitmqctl stop_app
> rabbitmqctl reset
> rabbitmqctl cluster <existing-disc-node>
> rabbitmqctl start_app
> 
> 2) grow cluster by adding a disc node
> rabbitmqctl stop_app
> rabbitmqctl reset
> rabbitmqctl cluster <existing-disc-node> <node-to-be-added>
> rabbitmqctl stop_app
> 
> 3) shrink cluster by removing a node
> rabbitmqctl stop_app
> rabbitmqctl reset
> rabbitmqctl start_app

These all look fine.

> I'm not inserting any delays between execution of events (other than the
> implicit delay of having to ssh into the server and execute the command.)
> 
> One issue I've encountered so far:
> 
> 1) rabbit fails to start after shrinking 2 disc/1 ram cluster to 2 disc
> cluster and then killing a disc node. Here's teh log from the disc node which
> fails to start. There's also output from my test script at the bottom which
> shows the cluster status: http://pastebin.com/95McUzkb

Uhm.  Could you paste the test code or what you're doing in the test in detail?
My suspicion is that you're using `force_reset' as you described above, and thus
the schema tables don't match.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Thu Aug 16 12:05:27 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Aug 2012 12:05:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ application failover/recovery in HA
 cluster
In-Reply-To: <1C9888BB42C16344B1C280C07DC8D78D03FA64EF@INWPIEXC01.SATS.CORP>
References: <1C9888BB42C16344B1C280C07DC8D78D03FA64EF@INWPIEXC01.SATS.CORP>
Message-ID: <502CD3F7.5020008@rabbitmq.com>

Hi Edward,

On 15/08/12 14:44, Wax, Edward wrote:
> our client connections in this HA environment (e.g. if I receive a
> ModelShutdown event, what steps do I need to go through in order to
> "transfer" a RabbitMQ session to a new connection).  Or are there other
> "management" APIs that should be used instead?

A possible reason for receiving a ModelShutdown event is if the broker
raises a channel exception, but this event is also sent if the
channel/Model closes normally. You won't need to re-establish a
channel/Model alone without also needing to re-establish the containing
connection due to a node failure.

The more relevant events in a clustered environment are
IConnection.ConnectionShutdown and IBasicConsumer.HandleBasicCancel.
Upon receipt of the former reconnection to another node in the cluster
could be attempted. If a subscriber of a mirrored queue receives a
cancel notification then it could attempt resubscribing, and it should
be aware that redeliveries are especially likely.

> I?ve also been looking the book, /RabbitMQ In Action/, and a section on
> application failure and recovery (6.2) sounds almost as simple as
> wrapping the consumer/producer code in a try/catch block.

That deals with recovery when connected to a cluster, rather than an HA
cluster with mirrored queues. The assumption there is that queues could
be lost, while in your case mirrored queues will not be lost as long as
any nodes that mirror it remain running.


-Emile





From francesco at rabbitmq.com  Thu Aug 16 15:04:24 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 16 Aug 2012 15:04:24 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster manage/ops questions
In-Reply-To: <87pq6rnmoj.wl%francesco@rabbitmq.com>
References: <CABKNZ0WLxass4E-_TYYGKRi5iWTav_WOEQ=bTqJ4sep9BRzWSg@mail.gmail.com>
	<87pq6rnmoj.wl%francesco@rabbitmq.com>
Message-ID: <87obmbndav.wl%francesco@rabbitmq.com>

At Thu, 16 Aug 2012 11:41:48 +0100,
Francesco Mazzoli wrote:
> For example your use case is a bad one, since `force_cluster' relies on the node
> you're clustering to already have tables matching the other nodes', but that
> will not be the case since you have just reset it.

Actually, this is inaccurate - I got confused with another command.
`force_cluster' "forces" in another way - it'll cluster even if it can't connect
to any nodes.

In any case, you should not need it in this case.

--
Francesco * Often in error, never in doubt

From wchrisjohnson at gmail.com  Thu Aug 16 15:45:18 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Thu, 16 Aug 2012 10:45:18 -0400
Subject: [rabbitmq-discuss] x-message-ttl extension to RabbitMQ
In-Reply-To: <502CA394.90702@rabbitmq.com>
Message-ID: <CC527F50.1F63B%wchrisjohnson@gmail.com>

Hi Emile - 

Sorry - I wasn't clear.

I meant to say that I want messages to stick around even after they are
delivered. I'd like specific queues to hold messages even if they have
been delivered for a specified period of time before deleting them...

Chris


On 8/16/12 3:39 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi Chris,
>
>On 16/08/12 01:33, Chris Johnson wrote:
>> I'm building a messaging solution where we'd like messages in several
>> queues to stick around for several days to a week or more. In the
>> documentation, it seems to say that this is achievable via the
>> Time-To-Live extension:
>
>If you don't want messages to expire at all then you don't need to
>provide any argument. The default is for messages never to expire.
>
>> 'x-message-ttl' => 2147483647})
>
>> The messages I'm pushing onto this queue are getting deleted
>> immediately, as least as far as I can tell within the dashboard UI.
>
>Check what value the broker received and make sure the value is what you
>expect:
>
>rabbitmqctl list_queues name arguments
>
>
>
>-Emile
>



From bobtkat at gmail.com  Thu Aug 16 15:50:38 2012
From: bobtkat at gmail.com (Bobby Castleberry)
Date: Thu, 16 Aug 2012 07:50:38 -0700 (PDT)
Subject: [rabbitmq-discuss] simple federation question
In-Reply-To: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>
References: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>
Message-ID: <5259ea80-4eb7-4f5c-b5c8-7285c5d1c852@googlegroups.com>


I say this is semi-working because while I have all the right log messages 
indicating that the federation exchange connected and the federation 
management plugin is showing the links as being good when I publish a 
message to the federated exchange it goes to a local generated queue but 
never propagates to the to endpoint nodes.  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120816/81f30891/attachment.htm>

From emile at rabbitmq.com  Thu Aug 16 16:03:21 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Aug 2012 16:03:21 +0100
Subject: [rabbitmq-discuss] x-message-ttl extension to RabbitMQ
In-Reply-To: <CC527F50.1F63B%wchrisjohnson@gmail.com>
References: <CC527F50.1F63B%wchrisjohnson@gmail.com>
Message-ID: <502D0BB9.4090200@rabbitmq.com>

Hi,

On 16/08/12 15:45, Chris Johnson wrote:
> I meant to say that I want messages to stick around even after they are
> delivered. I'd like specific queues to hold messages even if they have
> been delivered for a specified period of time before deleting them...

You do not need to use the 'x-message-ttl' parameter for this. If you
simply fail to acknowledge messages, and don't use auto-ack then they
will be retained by the broker as unacknowledged messages. You could
also explicitly nack or reject messages with the requeue flag asserted,
which will return them to the queue and they will be immediately
available to other consumers. Note that the redelivered flag will be set
on the message when retrieved subsequently.



-Emile


From wchrisjohnson at gmail.com  Thu Aug 16 16:14:22 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Thu, 16 Aug 2012 11:14:22 -0400
Subject: [rabbitmq-discuss] x-message-ttl extension to RabbitMQ
In-Reply-To: <502D0BB9.4090200@rabbitmq.com>
Message-ID: <CC528627.1F657%wchrisjohnson@gmail.com>

Wow - I must be (unintentionally) ack-ing the messages.

Thanks for that background - RMQ is so versatile...

Chris


On 8/16/12 11:03 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi,
>
>On 16/08/12 15:45, Chris Johnson wrote:
>> I meant to say that I want messages to stick around even after they are
>> delivered. I'd like specific queues to hold messages even if they have
>> been delivered for a specified period of time before deleting them...
>
>You do not need to use the 'x-message-ttl' parameter for this. If you
>simply fail to acknowledge messages, and don't use auto-ack then they
>will be retained by the broker as unacknowledged messages. You could
>also explicitly nack or reject messages with the requeue flag asserted,
>which will return them to the queue and they will be immediately
>available to other consumers. Note that the redelivered flag will be set
>on the message when retrieved subsequently.
>
>
>
>-Emile
>



From emile at rabbitmq.com  Thu Aug 16 17:12:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Aug 2012 17:12:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ Latency
In-Reply-To: <c22e38fa-9767-40eb-bc22-b558a147f1da@googlegroups.com>
References: <c22e38fa-9767-40eb-bc22-b558a147f1da@googlegroups.com>
Message-ID: <502D1BE7.2060607@rabbitmq.com>

Hi,

On 16/08/12 01:07, Tom Wrigg wrote:
> The first method uses two separate processes - one for the publishing
> app - one for the consuming app. It produces a latency of about at 4ms.
> The second method uses just one app to produce and consume. This
> produces a latency of about 40ms. Can anyone explain to me why? Thank
> you for your time.

In the one the publisher can publish as fast as it likes (within the
limits imposed by internal flow control in the broker) while with the
other publishing and consuming messages happen in lockstep - that's why
it's slower.


-Emile


From francesco at rabbitmq.com  Thu Aug 16 17:47:35 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 16 Aug 2012 17:47:35 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster manage/ops questions
In-Reply-To: <87pq6rnmoj.wl%francesco@rabbitmq.com>
References: <CABKNZ0WLxass4E-_TYYGKRi5iWTav_WOEQ=bTqJ4sep9BRzWSg@mail.gmail.com>
	<87pq6rnmoj.wl%francesco@rabbitmq.com>
Message-ID: <87liheokbc.wl%francesco@rabbitmq.com>

At Thu, 16 Aug 2012 11:41:48 +0100,
Francesco Mazzoli wrote:
> Uhm.  Could you paste the test code or what you're doing in the test in detail?
> My suspicion is that you're using `force_reset' as you described above, and thus
> the schema tables don't match.

And of course I meant `force_cluster', not `force_reset'.

--
Francesco * Often in error, never in doubt

From alex at inferiorhumanorgans.com  Thu Aug 16 19:02:46 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Thu, 16 Aug 2012 11:02:46 -0700
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502BE810.9040006@rabbitmq.com>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
	<20120815173003.GD14902@bloaty> <502BDFE4.60705@rabbitmq.com>
	<20120815175747.GE14902@bloaty> <502BE810.9040006@rabbitmq.com>
Message-ID: <502D35C6.3090605@inferiorhumanorgans.com>

On 8/15/12 11:18 AM, Matthias Radestock wrote:
> Alex,
> 
> On 15/08/12 18:57, Alex Zepeda wrote:
>> Here's the next few minutes of the log files:
> 
> Thanks. I think I've found the problem. Unfortunately there's no quick
> fix / workaround, so you are going to have to wait until we release a fix.

Any chance you could provide some additional insight into the problem?

- alex


From pselibas at gmail.com  Thu Aug 16 10:17:17 2012
From: pselibas at gmail.com (Paul)
Date: Thu, 16 Aug 2012 02:17:17 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Dead Letter Routing
Message-ID: <f17aad39-8e78-4ce2-9409-b599917ba28e@googlegroups.com>



Hello,

I am hoping someone can help me out on this issue.

I have got a typical setup of a async consumer, consuming from a Queue, and 
a async producer (with a reply_to queue set) producing to an exchange.

I am facing the challenge of working with Dead Letter Queues and TTL.

In a nutshell the producer needs a ways to determine if his/her message 
ended up dead (in the event the consumer is too slow or not "alive"). So 
this is what I have come up with but am struggling to implement it (it 
might be impossible).

Producer produces the message (with a reply_to property) -> Rabbit Expires 
the message based on the TTL -> sends the message to a dead letter exchange 
-> the exchange routes the message to the reply_to queue property on that 
message -> the producer now consumers from that queue (the reply_to queue).

Question... "the exchange routes the message to the reply_to queue property 
on that message"... is this possible and how?

Any other suggestions on implementation or design which would meet my 
criteria would be greatly appreciated.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120816/00351c5c/attachment.htm>

From e.tolmachev at gmail.com  Thu Aug 16 14:43:46 2012
From: e.tolmachev at gmail.com (et1975)
Date: Thu, 16 Aug 2012 06:43:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ as a service on Windows - setup
Message-ID: <523e1fbc-fb65-4938-8646-5aab084b62b8@googlegroups.com>

I'm configuring my nodes to work over firewall and I keep changing 
rabbitmq-service.bat to include
-kernel inet_dist_listen_min 4000 ^
-kernel inet_dist_listen_max 4100 ^
into ERLANG_SERVICE_ARGUMENTS

after that I have to reinstall the service, which still doesn't work until 
I start the server interactively, then kill it, then reinstall succeeds in 
configuring the port range.
Is there any way to specify the port range in an environment variable?

Thanks,
E.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120816/55c93bbc/attachment.htm>

From mpietrek at skytap.com  Thu Aug 16 19:31:41 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 16 Aug 2012 11:31:41 -0700
Subject: [rabbitmq-discuss] Problem with Tx.Commit and/or Pika?
Message-ID: <CACLE7ixCWjy+QSF-eD6iMC0ZoyPxHLiYeD6XVg6u1XdwSbZO0g@mail.gmail.com>

I have a simple, single threaded program using Pika's SelectConnection with
RabbitMQ 2.8.5 that simply listens for request messages and replies to them.

This code generally works - It can receive many thousands of messages
before it croaks. When it does croak, it's with the following error:

*CHANNEL_ERROR - unexpected command while processing 'tx.commit'

*The code looks like this:

def handle_delivery(channel, method, header, body):
    print "Received message"

    channel.tx_select()
    channel.basic_publish(exchange="skytap",
        routing_key='foo.bar',
        body='reply',
        mandatory=True,
        properties=BasicProperties(delivery_mode=2))
    channel.tx_commit()

    channel.tx_select()
    channel.basic_ack(delivery_tag=method.delivery_tag)
    channel.tx_commit()


From matthias at rabbitmq.com  Thu Aug 16 19:47:31 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 Aug 2012 19:47:31 +0100
Subject: [rabbitmq-discuss] Problem with Tx.Commit and/or Pika?
In-Reply-To: <CACLE7ixCWjy+QSF-eD6iMC0ZoyPxHLiYeD6XVg6u1XdwSbZO0g@mail.gmail.com>
References: <CACLE7ixCWjy+QSF-eD6iMC0ZoyPxHLiYeD6XVg6u1XdwSbZO0g@mail.gmail.com>
Message-ID: <502D4043.7080403@rabbitmq.com>

Matt,

On 16/08/12 19:31, Matt Pietrek wrote:
> I have a simple, single threaded program using Pika's SelectConnection
> with RabbitMQ 2.8.5 that simply listens for request messages and replies
> to them.
>
> This code generally works - It can receive many thousands of messages
> before it croaks. When it does croak, it's with the following error:
>
> *CHANNEL_ERROR - unexpected command while processing 'tx.commit'
>
> *The code looks like this:
>
> def handle_delivery(channel, method, header, body):
>      print "Received message"
>
>      channel.tx_select()
>      channel.basic_publish(exchange="skytap",
>          routing_key='foo.bar',
>          body='reply',
>          mandatory=True,
>          properties=BasicProperties(delivery_mode=2))
>      channel.tx_commit()
>
>      channel.tx_select()
>      channel.basic_ack(delivery_tag=method.delivery_tag)
>      channel.tx_commit()

btw, you only need to call tx_select *once* - once a channel is in tx 
mode it stays in tx mode and the next transactions starts when the 
previous one is committed or rolled back.

> That is, it looks like a Basic.Deliver and a Basic.Publish are sneaking
> in before the Tx.Commit-Ok comes back.

Nothing wrong with the Basic.Deliver, since that travels from the server 
to client. However, seeing a basic.publish (or indeed anything) going 
from from the client to the server after tx.commit has been issued but 
before tx.commit-ok has been received is definitely bad. AMQP does not 
permit the sending of other commands while a synchronous command is 
outstanding.

> I suspect this is a Pika issue, but my reading of the code doesn't show
> any obvious problems.

I don't know pika, but perhaps it is possible for multiple 
handle_delivery invocations to run concurrently?


Matthias.

From bobtkat at gmail.com  Thu Aug 16 20:49:20 2012
From: bobtkat at gmail.com (Bobby Castleberry)
Date: Thu, 16 Aug 2012 12:49:20 -0700 (PDT)
Subject: [rabbitmq-discuss] simple federation question
In-Reply-To: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>
References: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>
Message-ID: <2319481f-8c9b-4e21-8ca4-fca467d5e41a@googlegroups.com>

It doesn't seem to be forwarding the messages to the end point queues.  I 
subscribe to the federated exchange (graphite-uplink on polling1), publish 
a message and it drops into a locally generated queue but never makes it to 
the end points.  I may be missing something with the routing but as I 
understood it this back end style exchange should handle the routing by 
default.  

root at sansketch8polling1:/var/
log/rabbitmq# rabbitmqctl list_exchanges
Listing exchanges ...
amq.rabbitmq.log        topic
graphite        topic
graphite-uplink x-federation
...done.
root at sansketch8polling1:/var/log/rabbitmq# rabbitmqctl list_queues
Listing queues ...
amq.gen-wEmGzR01E_M30QDAndw8vd  4
SAN     0
...done.

root at sansketch8display1:~# rabbitmqctl list_exchanges
Listing exchanges ...
amq.direct      direct
amq.topic       topic
amq.rabbitmq.trace      topic
federation: graphite -> sansketch8polling1:graphite-uplink A       
x-federation-upstream
amq.rabbitmq.log        topic
amq.fanout      fanout
amq.headers     headers
graphite        topic
        direct
amq.match       headers
...done.
root at sansketch8display1:~# rabbitmqctl list_queues
Listing queues ...
federation: graphite -> sansketch8polling1:graphite-uplink 0
...done.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120816/7edaa12e/attachment.htm>

From meetprashanth437 at gmail.com  Thu Aug 16 21:49:16 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 16 Aug 2012 16:49:16 -0400
Subject: [rabbitmq-discuss]  Per queue message limit
Message-ID: <CAE8G+yTL932jAVUAtyLw5Zbt8Fcts4vvZv3ckZQU6qf3AJv8Yw@mail.gmail.com>

Hi,

Is there a limit on number of messages a queue can hold, and after that
threshold is reached reject the future messages.
I know there is per-queue message TTL and Queue TTL. But this does not
serve my requirements.

And is there a way to tell the producer that queue has reached the
threshold. Produce is transparent to this, but just want to ask the group.

Thanks.

Cheers!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120816/27206f48/attachment.htm>

From emile at rabbitmq.com  Thu Aug 16 23:16:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Aug 2012 23:16:05 +0100
Subject: [rabbitmq-discuss] Per queue message limit
In-Reply-To: <CAE8G+yTL932jAVUAtyLw5Zbt8Fcts4vvZv3ckZQU6qf3AJv8Yw@mail.gmail.com>
References: <CAE8G+yTL932jAVUAtyLw5Zbt8Fcts4vvZv3ckZQU6qf3AJv8Yw@mail.gmail.com>
Message-ID: <502D7125.5020208@rabbitmq.com>

Hi,

On 16/08/12 21:49, Prashanth wrote:
> Is there a limit on number of messages a queue can hold, and after that
> threshold is reached reject the future messages.
> I know there is per-queue message TTL and Queue TTL. But this does not
> serve my requirements.

Other than the TTL options you mention, producers can also choose to
observe the length of a queue and stop when it reaches a limit. There is
no support for this is in the broker beyond reporting the length of the
queue.

> And is there a way to tell the producer that queue has reached the
> threshold. Produce is transparent to this, but just want to ask the group.

It is difficult to communicate this to the publisher, because publishing
is an asynchronous operation.



-Emile


From floccinaucinihilipilification at gmail.com  Fri Aug 17 07:42:04 2012
From: floccinaucinihilipilification at gmail.com (Michael Cohen)
Date: Thu, 16 Aug 2012 23:42:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Computer authentication/authorisation
Message-ID: <efd31973-45c9-410f-ae36-2c9e6c3b8d82@googlegroups.com>

I am planning to use the following plug-ins:

   - rabbitmq_auth_mechanism_ssl
   - rabbitmq_auth_backend_ldap

I would like to authenticate/authorise computers rather than human users. 
I don't want to manually have to add computer "users" in to RabbitMQ. I 
want them looked up from a directory.

Is this possible?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120816/915b99c2/attachment.htm>

From andre at laszlo.nu  Fri Aug 17 08:49:57 2012
From: andre at laszlo.nu (=?ISO-8859-1?Q?Andr=E9_Laszlo?=)
Date: Fri, 17 Aug 2012 09:49:57 +0200
Subject: [rabbitmq-discuss] amqphp "send message failed for channel.close"
 and idle channels stacking up
Message-ID: <CAJvGpYBdwoU1DQPrh4Kp=10uMEgY_jtnJBjkO=L_CT53Nn-gxw@mail.gmail.com>

Does anyone recognize this problem, I was working on it all day
yesterday with no luck:

My setup has been working for six months without any problems, today
amqphp crashed with the message "Send message failed for
channel.close".

I tried restarting, reinstalling, clearing everything I could think of
but the problem remains. I thought I should eliminate as many
variables as possible, so I downloaded the "hello world" scripts,
send.py and receive.py. Receiving works - but only if I send using the
web based management tool. When I send using send.py the messages
seems to get trashed - they never reach receive.py and they don't show
up anywhere in the web interface. What's even more weird is that every
time I run send.py, there's a new channel being added (idle). Right
now I have 20 idling channels. Here's my output from rabbitmqctl
status:

http://pastebin.com/SLhXwcLX

I can't think of any configuration changes or updates that I have made
recently that could be related to these problems, so any help or hint
would be very appreciated!

/Andr? L.

From yuva670 at gmail.com  Fri Aug 17 10:08:31 2012
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Fri, 17 Aug 2012 14:38:31 +0530
Subject: [rabbitmq-discuss] All the consumers shut down
Message-ID: <CAPrynAUKqzjonPsqxtH+qHVzhSyuBbEmAU3S2wB434oxQNW1ZQ@mail.gmail.com>

Hi,

During our testing phase, all out consumers shut down with the
following exception:

<Connection disconnected>
<error>
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
{#method<connection.close>(reply-code=320,
reply-text=CONNECTION_FORCED - bro
ker forced connection closure with reason 'shutdown', class-id=0,
method-id=0), null, ""}
        at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:198)
        at com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:214)
        at watermarkingapp.Main.main(Main.java:60)


Where should I look for the clues?


Thanks in advance,
Mahesh

From emile at rabbitmq.com  Fri Aug 17 13:02:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Aug 2012 13:02:29 +0100
Subject: [rabbitmq-discuss] Computer authentication/authorisation
In-Reply-To: <efd31973-45c9-410f-ae36-2c9e6c3b8d82@googlegroups.com>
References: <efd31973-45c9-410f-ae36-2c9e6c3b8d82@googlegroups.com>
Message-ID: <502E32D5.9000601@rabbitmq.com>

Hi,

On 17/08/12 07:42, Michael Cohen wrote:
> I would like to authenticate/authorise computers rather than human users. 
> I don't want to manually have to add computer "users" in to RabbitMQ. I
> want them looked up from a directory.

This is not possible at the time of writing (v.8.5), but it may well be
possible to write your own plugin that makes use of the information
obtained from the socket. You should look at the implementation of
rabbitmq_auth_mechanism_ssl and the rabbit_auth_mechanism_cr_demo module
in the broker if you want to pursue that avenue.


-Emile


From emile at rabbitmq.com  Fri Aug 17 13:10:46 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Aug 2012 13:10:46 +0100
Subject: [rabbitmq-discuss] amqphp "send message failed for
 channel.close" and idle channels stacking up
In-Reply-To: <CAJvGpYBdwoU1DQPrh4Kp=10uMEgY_jtnJBjkO=L_CT53Nn-gxw@mail.gmail.com>
References: <CAJvGpYBdwoU1DQPrh4Kp=10uMEgY_jtnJBjkO=L_CT53Nn-gxw@mail.gmail.com>
Message-ID: <502E34C6.20303@rabbitmq.com>

Hi,

On 17/08/12 08:49, Andr? Laszlo wrote:
> now I have 20 idling channels. Here's my output from rabbitmqctl
> status:

I notice that disk_free < disk_free_limit. You will probably find broker
logfile entries for the disk free space alarm, which blocks producers.
The solution is to provide more disk space or to lower the limit.


-Emile



From francesco at rabbitmq.com  Fri Aug 17 13:09:31 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 17 Aug 2012 13:09:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ Dead Letter Routing
In-Reply-To: <f17aad39-8e78-4ce2-9409-b599917ba28e@googlegroups.com>
References: <f17aad39-8e78-4ce2-9409-b599917ba28e@googlegroups.com>
Message-ID: <87k3wxoh38.wl%francesco@rabbitmq.com>

Hi Paul,

At Thu, 16 Aug 2012 02:17:17 -0700 (PDT),
Paul wrote:
> Question... "the exchange routes the message to the reply_to queue property on
> that message"... is this possible and how?

Not with the AMQP exchanges types, or the additional exchanges that I've seen.
You can probably easy define your own exchange type and use it as a plugin. For
more information see <http://www.rabbitmq.com/plugin-development.html>.  As an
example of an exchange type packaged as plugin you can check out the consistent
hash exchange: <http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/>.

--
Francesco * Often in error, never in doubt

From meetprashanth437 at gmail.com  Fri Aug 17 14:19:00 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Fri, 17 Aug 2012 09:19:00 -0400
Subject: [rabbitmq-discuss] Per queue message limit
In-Reply-To: <502D7125.5020208@rabbitmq.com>
References: <CAE8G+yTL932jAVUAtyLw5Zbt8Fcts4vvZv3ckZQU6qf3AJv8Yw@mail.gmail.com>
	<502D7125.5020208@rabbitmq.com>
Message-ID: <CAE8G+yQkYzptFH3TYXXSN4WLjCz1eNVJC-HfiductYBX08w4Bw@mail.gmail.com>

Hi Emile,

Thank you for the response, you mean producers can observer the length of
the queue using one of the rabbitmqctl commands. Is there anything other
way too.

Thanks,
Prashanth.

On Thu, Aug 16, 2012 at 6:16 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 16/08/12 21:49, Prashanth wrote:
> > Is there a limit on number of messages a queue can hold, and after that
> > threshold is reached reject the future messages.
> > I know there is per-queue message TTL and Queue TTL. But this does not
> > serve my requirements.
>
> Other than the TTL options you mention, producers can also choose to
> observe the length of a queue and stop when it reaches a limit. There is
> no support for this is in the broker beyond reporting the length of the
> queue.
>
> > And is there a way to tell the producer that queue has reached the
> > threshold. Produce is transparent to this, but just want to ask the
> group.
>
> It is difficult to communicate this to the publisher, because publishing
> is an asynchronous operation.
>
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/4291619a/attachment.htm>

From simon at rabbitmq.com  Fri Aug 17 14:33:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Aug 2012 14:33:36 +0100
Subject: [rabbitmq-discuss] All the consumers shut down
In-Reply-To: <CAPrynAUKqzjonPsqxtH+qHVzhSyuBbEmAU3S2wB434oxQNW1ZQ@mail.gmail.com>
References: <CAPrynAUKqzjonPsqxtH+qHVzhSyuBbEmAU3S2wB434oxQNW1ZQ@mail.gmail.com>
Message-ID: <502E4830.3090601@rabbitmq.com>

On 17/08/12 10:08, Mahesh Viraktamath wrote:
> reply-code=320,
> reply-text=CONNECTION_FORCED - broker forced connection closure with reason 'shutdown',
> class-id=0,
> method-id=0)

Hi Mahesh. That's saying that the broker closed your connection because 
it was shutting down - I assume this was what happened?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Aug 17 14:37:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Aug 2012 14:37:06 +0100
Subject: [rabbitmq-discuss] Computer authentication/authorisation
In-Reply-To: <502E32D5.9000601@rabbitmq.com>
References: <efd31973-45c9-410f-ae36-2c9e6c3b8d82@googlegroups.com>
	<502E32D5.9000601@rabbitmq.com>
Message-ID: <502E4902.3040607@rabbitmq.com>

On 17/08/12 13:02, Emile Joubert wrote:
> On 17/08/12 07:42, Michael Cohen wrote:
>> I would like to authenticate/authorise computers rather than human users.
>> I don't want to manually have to add computer "users" in to RabbitMQ. I
>> want them looked up from a directory.
>
> This is not possible at the time of writing (v.8.5), but it may well be
> possible to write your own plugin that makes use of the information
> obtained from the socket. You should look at the implementation of
> rabbitmq_auth_mechanism_ssl and the rabbit_auth_mechanism_cr_demo module
> in the broker if you want to pursue that avenue.

Well, it depends what the OP meant.

If the idea is that:

* Data about individual computers is managed in a central LDAP repository
* Each computer identifies itself with an SSL certificate

then the two plugins mentioned will do the trick. If not - then what did 
you have in mind (Michael)?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Aug 17 14:44:27 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Aug 2012 14:44:27 +0100
Subject: [rabbitmq-discuss] Per queue message limit
In-Reply-To: <CAE8G+yQkYzptFH3TYXXSN4WLjCz1eNVJC-HfiductYBX08w4Bw@mail.gmail.com>
References: <CAE8G+yTL932jAVUAtyLw5Zbt8Fcts4vvZv3ckZQU6qf3AJv8Yw@mail.gmail.com>
	<502D7125.5020208@rabbitmq.com>
	<CAE8G+yQkYzptFH3TYXXSN4WLjCz1eNVJC-HfiductYBX08w4Bw@mail.gmail.com>
Message-ID: <502E4ABB.8080605@rabbitmq.com>


Hi,

On 17/08/12 14:19, Prashanth wrote:
> Thank you for the response, you mean producers can observer
> the length of the queue using one of the rabbitmqctl commands. Is there
> anything other way too.

That can work, but it is also possible to obtain the queue length using
AMQP, which is probably more convenient for your publishers. Declare the
queue passively and extract the message-count field:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok.message-count

There are other ways of determining the queue length (e.g. using methods
bearing a message-count parameter), but they disturb the queue contents.



-Emile


From alan.antonuk at gmail.com  Fri Aug 17 15:40:21 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 17 Aug 2012 10:40:21 -0400
Subject: [rabbitmq-discuss] C client questions . . .
In-Reply-To: <22BCE56D-B63C-4BDD-A7FF-4D8361DB9FE0@vmware.com>
References: <22BCE56D-B63C-4BDD-A7FF-4D8361DB9FE0@vmware.com>
Message-ID: <CAAt2po+Nr_bY101czq5ZPMZG6dfGKpcNEi+5Rny65CkzO3xJzg@mail.gmail.com>

Jeff;

Handshake timeout? I think that's what happens when the client opens a
socket (using amqp_open_socket) to the broker and doesn't complete the
handshake process (calling amqp_login) in a certain amount of time.  The
timeout is something set on the broker.

I could imagine this sort of thing happening if for whatever reason the
handshake was delayed, or you open a bunch of sockets to the broker without
doing the handshake (calling amqp_login).  Other reasons why this could be
happening:
- The broker is too busy (I/O or CPU) to complete the handshake in enough
time (maybe you have a bunch of clients trying to connect at the same time?)
- There is a serious amount of network traffic preventing your clients from
getting to the broker.
- Something on the client side is really slowing down the handshake process

Going to CC the rabbitmq-discuss list see if they have any ideas.

-Alan

On Fri, Aug 17, 2012 at 12:13 AM, Jeff Markham <jmarkham at vmware.com> wrote:

> Hi Alan,
>
> Was wondering if you might know of any circumstance that might cause the
> the client to peg the broker.  At ~130 client connections, we see
>
> =ERROR REPORT==== 14-Aug-2012::16:04:33 ===
> closing AMQP connection <0.8196.3> (1.1.1.1:63114 -> 2.2.2.2:5671):
> {handshake_timeout,handshake}
>
> in the logs and over and over until it consumes the entire memory of the
> box.  Doesn't happen always but enough that we can't figure out what might
> be causing this.
>
> Thanks for everything.
>
> https://github.com/rabbitmq/rabbitmq-c
>
> Jeff Markham
> Senior Systems Engineer
> vFabric Cloud Application Platform
> VMware
> (949) 385-3806
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/594d49a1/attachment.htm>

From francesco at rabbitmq.com  Fri Aug 17 16:37:07 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 17 Aug 2012 16:37:07 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <502D35C6.3090605@inferiorhumanorgans.com>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
	<20120815173003.GD14902@bloaty> <502BDFE4.60705@rabbitmq.com>
	<20120815175747.GE14902@bloaty> <502BE810.9040006@rabbitmq.com>
	<502D35C6.3090605@inferiorhumanorgans.com>
Message-ID: <87ipcho7h8.wl%francesco@rabbitmq.com>

At Thu, 16 Aug 2012 11:02:46 -0700,
Alex Zepeda wrote:
> Any chance you could provide some additional insight into the problem?

Well, shovel is basically an AMQP client and sometimes things can go wrong -
e.g. network problems.  When things go wrong the erlang client that shovel uses
fails.  It turns out that we are not recovering correctly from these failures,
and shovel does not get restarted as it should.

--
Francesco * Often in error, never in doubt

From tim at rabbitmq.com  Fri Aug 17 16:43:50 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 17 Aug 2012 16:43:50 +0100
Subject: [rabbitmq-discuss] Optimizing RabbitMQ
In-Reply-To: <CAEk0_N7g8Bnrm65PCqPhjLCogc9zyVDvLYgvZwqbeGxSq0+n-Q@mail.gmail.com>
References: <71a7ae88-3812-438a-9b27-3be406657dea@googlegroups.com>
	<502B82E4.8010607@rabbitmq.com> <502B8588.8010300@rabbitmq.com>
	<CAEk0_N7g8Bnrm65PCqPhjLCogc9zyVDvLYgvZwqbeGxSq0+n-Q@mail.gmail.com>
Message-ID: <47E12E61-B7B8-4682-BAE5-D60649FAFD1E@rabbitmq.com>

Hi Tom

On 15 Aug 2012, at 14:59, Tom Wrigglesworth wrote:

> Hi, Thanks for your reply.
> 
> So is the 40ms the time it takes for a message to travel from the game logic server to the web browser? 
> 
> It's the time between the message being published and the message being delivered. I have output from wireshark looking something similar to:
> 
>       #     Time          From                   To                    Protocol   Length   Info
> ...
>     155 1.539600    127.0.0.1             127.0.0.1             AMQP     115     Basic.Publish
>     157 1.579834    127.0.0.1             127.0.0.1             AMQP     3873   Content-Header Content-Body
>     159 1.580942    127.0.0.1             127.0.0.1             AMQP     3963   Basic-Deliver Content-Header Content-Body
>     160 1.590769    127.0.0.1             127.0.0.1             AMQP     115     Basic.Publish
>     162 1.627732    127.0.0.1             127.0.0.1             AMQP     3873   Content-Header Content-Body
>     164 1.628295    127.0.0.1             127.0.0.1             AMQP     3963   Basic-Deliver Content-Header Content-Body
>     165 1.638748    127.0.0.1             127.0.0.1             AMQP     115     Basic.Publish
>     167 1.675834    127.0.0.1             127.0.0.1             AMQP     3873   Content-Header Content-Body
>     169 1.676850    127.0.0.1             127.0.0.1             AMQP     3963   Basic-Deliver Content-Header Content-Body
> ...
> 
> This looks to me like it is AMQP that is taking about 40ms between publish and deliver. Is this because of certain server settings i'm running, interference from the node server running at the same time on the same machine or some other reason?

The only way I can think of to determine that is to remove the other factors. You could try publishing and consuming via the same client instance, with the other servers disabled and see what kind of throughput you get when there's little other potential contention for operating system resources. 

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/888d6288/attachment.htm>

From simon at rabbitmq.com  Fri Aug 17 16:48:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Aug 2012 16:48:40 +0100
Subject: [rabbitmq-discuss] Computer authentication/authorisation
In-Reply-To: <CAH9tybM-XGpPE7Q45rTH-C2pScp_47o4Ot-3hoE7iDAjU6xjHQ@mail.gmail.com>
References: <efd31973-45c9-410f-ae36-2c9e6c3b8d82@googlegroups.com>	<502E32D5.9000601@rabbitmq.com>	<502E4902.3040607@rabbitmq.com>
	<CAH9tybM-XGpPE7Q45rTH-C2pScp_47o4Ot-3hoE7iDAjU6xjHQ@mail.gmail.com>
Message-ID: <502E67D8.3090500@rabbitmq.com>

Hi Michael.

On 17/08/12 15:05, Michael Cohen wrote:
> I was wondering whether if both plugins are used what happens during
> authentication
>
> If I...
> Create certs on the workers with the cert cn = ldap computer object cn
> Set {ssl_cert_login_from, common_name}
> Set {dn_lookup_attribute, "cn"}
> Set {other_bind, {diruser, dirpassword}}
>
> During authentication, will the ldap backend just check common_name
> (from the cert) = cn (from computer object) and ignore the password?

Depends what you mean by "the password". RabbitMQ will use the password 
you configured in {other_bind, {diruser, dirpassword}} to talk to the 
LDAP server. But on the AMQPS connection there won't be a password 
transmitted at all.

You'll also need to tell your client to use the EXTERNAL SASL mechanism 
- e.g. in the Java client you would:

     ConnectionFactory factory = new ConnectionFactory();
     factory.setSaslConfig(DefaultSaslConfig.EXTERNAL);

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From francesco at rabbitmq.com  Fri Aug 17 16:52:23 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 17 Aug 2012 16:52:23 +0100
Subject: [rabbitmq-discuss] Shovel stuck?
In-Reply-To: <20120815185015.GF14902@bloaty>
References: <20120814202926.GA70993@bloaty> <502B7A55.7050409@rabbitmq.com>
	<20120815164216.GB14902@bloaty> <502BD4B6.7010009@rabbitmq.com>
	<20120815173003.GD14902@bloaty> <502BDFE4.60705@rabbitmq.com>
	<20120815175747.GE14902@bloaty> <502BE810.9040006@rabbitmq.com>
	<20120815185015.GF14902@bloaty>
Message-ID: <87has1o6rs.wl%francesco@rabbitmq.com>

At Wed, 15 Aug 2012 11:50:16 -0700,
Alex Zepeda wrote:
> Well, the other thing that stands out is that the shovel seems to remain
> wedged across reboots but gets unstuck after a power cycle.  My current
> hypothesis is that power cycling leaves the filesystem in an inconsistent
> state resulting in the mnesia files getting zapped.

That is very implausible.  Shovel is largely stateless and even an application
restart is enough to "unstuck" it.  The mnesia/msgstore data doesn't have
anything to do with the issue you experienced.

> Any idea if there's a good way to unwedge the shovel?

Restarting the shovel application, as mentioned:

  rabbitmqctl eval 'application:stop(rabbitmq_shovel), application:start(rabbitmq_shovel).'

> Also, any ETA for a proper fix?

If all goes well, a few days.

--
Francesco * Often in error, never in doubt

From mpietrek at skytap.com  Fri Aug 17 20:13:07 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Aug 2012 12:13:07 -0700
Subject: [rabbitmq-discuss] tx_commit() semantics with async connections
	(e.g Pika SelectConnection)
Message-ID: <CACLE7iy=_3LaW2Q6Eoy-c_PSy9kX03Cmidzmc_bK2930L=Xt4Q@mail.gmail.com>

I've been drilling into an issue for a few days where my Pika channel is
abruptly closed. I'm pretty sure I've found either:

   - A large gap in my understanding
   - A misuse of the Rabbit/Pika APIs
   - A serious bug in Pika.

My original understanding about transactions is that calling tx_select() is
a synchronous operation, and that when it returns, whatever actions you've
sent to the broker are committed.

However, in stepping through the Pika tx_commit() code, it seems like it
all it does is add the Tx.Commit message to an outgoing buffer, and that
the tx_commit() call returns without anything actually sent to the broker.
(I've set breakpoints in the debugger at strategic points to verify this.)

In my message handler, I'm writing a reply to the incoming message, using
the same channel. What I'm seeing (verified via WireShark) is that the
Tx.Commit message is followed by some number of Basic.Publish,
Content-Header, and Content-Body records corresponding to my reply message
writes. This violates the AMQP standard, which says that nothing should be
sent to the broker after sending a Tx.Commit and before receiving a
Tx.Commit-Ok reply. (If it helps understanding, my incoming message queue
has a few messages in it already, so I see a series of incoming messages
immediately after starting.)

I see that the tx_commit() method takes a callback method, but if I were to
simply block in my message handler, waiting for the callback to be invoked,
I'd deadlock because Pika's buffer processing code doesn't get a chance to
run.
So given the above, is it me? Is it Pika?

My code looks like this:

def echo_on_connected(connection):
    """Called when we are fully connected to RabbitMQ"""
    # Open a channel
    connection.channel(echo_on_channel_open)

# Step #3
def echo_on_channel_open(channel):
    channel.queue_declare(queue=echo_queue_name, durable=True,
arguments={"x-ha-policy": "all"})
    channel.tx_select()
    channel.basic_consume(echo_handle_delivery, queue=echo_queue_name)

def echo_handle_delivery(channel, method, header, body):
    print "Received message %s" % (body)

    # Write a reply message on the same channel
    channel.basic_publish(exchange='',
        routing_key='reply_queue',
        body="replying to %s" % (body),
        properties=BasicProperties(delivery_mode=2))

    # Ack the incoming message, then force the write to be flushed.
    channel.basic_ack(delivery_tag=method.delivery_tag)
    channel.tx_commit()

def echo_thread():
    connection_parameters = ConnectionParameters(host=broker_host)
    echo_connection = SelectConnection(connection_parameters,
echo_on_connected)
    echo_connection.ioloop.start()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/dc5e34c6/attachment.htm>

From gmr at meetme.com  Fri Aug 17 20:38:50 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 17 Aug 2012 15:38:50 -0400
Subject: [rabbitmq-discuss] tx_commit() semantics with async connections
 (e.g Pika SelectConnection)
In-Reply-To: <CACLE7iy=_3LaW2Q6Eoy-c_PSy9kX03Cmidzmc_bK2930L=Xt4Q@mail.gmail.com>
References: <CACLE7iy=_3LaW2Q6Eoy-c_PSy9kX03Cmidzmc_bK2930L=Xt4Q@mail.gmail.com>
Message-ID: <CAKwdTWdvgiaCDGxAuW4kja6hJgj8oo8VqTL90VdneEzRQwsaqg@mail.gmail.com>

On Fri, Aug 17, 2012 at 3:13 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> I've been drilling into an issue for a few days where my Pika channel is
> abruptly closed. I'm pretty sure I've found either:
>
>    - A large gap in my understanding
>    - A misuse of the Rabbit/Pika APIs
>
> Depending on your perspective, this seems the most likely, in that there
is not any logic in Pika for managing Tx. It lets you send the RPC calls
and leaves it to you to manage state outside of the connection/channel.

>
>    - A serious bug in Pika.
>
> My original understanding about transactions is that calling tx_select()
> is a synchronous operation, and that when it returns, whatever actions
> you've sent to the broker are committed.
>
> However, in stepping through the Pika tx_commit() code, it seems like it
> all it does is add the Tx.Commit message to an outgoing buffer, and that
> the tx_commit() call returns without anything actually sent to the broker.
> (I've set breakpoints in the debugger at strategic points to verify this.)
>
This is correct, because pika is event-loop driven, it is putting the frame
in the output buffer and returning to you. The event loop will write the
data out as the operating system tells it it can You are correct that it is
not blocking on the Tx.Commit until the data is written over the socket.

> In my message handler, I'm writing a reply to the incoming message, using
> the same channel. What I'm seeing (verified via WireShark) is that the
> Tx.Commit message is followed by some number of Basic.Publish,
> Content-Header, and Content-Body records corresponding to my reply message
> writes.
>
Your frames are sent in the order the methods are called.

> This violates the AMQP standard, which says that nothing should be sent to
> the broker after sending a Tx.Commit and before receiving a Tx.Commit-Ok
> reply. (If it helps understanding, my incoming message queue has a few
> messages in it already, so I see a series of incoming messages immediately
> after starting.)
>
You should add a callback for the Tx.Commit-Ok reply and then send your
messages. You are correct that Pika is not enforcing the behavior of
blocking until Tx.Commit-Ok.

You could open a 2nd channel and send your replies over that.

> I see that the tx_commit() method takes a callback method, but if I were
> to simply block in my message handler, waiting for the callback to be
> invoked, I'd deadlock because Pika's buffer processing code doesn't get a
> chance to run.
>
How are you blocking? If you're using any truly blocking method, it will
stop the event loop from running. Since you're on the async loop, I'd use a
timer and a state variable to toggle between the various states you're
trying to achieve.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/49c3681b/attachment.htm>

From fmeshkinpour at fonality.com  Fri Aug 17 20:43:55 2012
From: fmeshkinpour at fonality.com (fm)
Date: Fri, 17 Aug 2012 12:43:55 -0700 (PDT)
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
Message-ID: <1345232635161-21485.post@n5.nabble.com>

Hello,
 
Has there been a progress about implementation of redelivery count or is
there a patch for this issue?

I have the case that my worker tasks are processing msgs from multiple
queues. One of the queues may have msgs that msg  processing constantly
fails the worker task.  I tried to have msg ttl & dead-letter queue, but
noticed that in situation that all worker tasks and failing & restarting on
that one queue, the msgs on other queues that hasn't been processed time-out
& go to dead-letter queue as well.

Any help or suggestions is greatly appreciated.

Thanks,



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/redelivered-count-tp13512p21485.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From wizaerd at gmail.com  Fri Aug 17 20:44:01 2012
From: wizaerd at gmail.com (Wizaerd)
Date: Fri, 17 Aug 2012 12:44:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Different objects being passed thru RabbitMQ
Message-ID: <e4f181d2-b955-4b7c-9fd2-101fb37b05cf@googlegroups.com>

I'm working well with RabbitMQ thus far, however I have a question about 
how to approach something.  Right now I have a series of consumer 
applications that knows exactly what type of serislaized object is coming 
to the queue, as they are specialized for the specific object types to 
process.  However, the architect wants a more generic listener that pull 
messages from the queue, but the messages body would be a different type of 
serialized object.  for example it could be a User object, or a Course 
object, etc...  In my listener, what is the best way to dynamically 
determine the type of object being passed in, thus being able to 
deserialize it and work with it?  I had tried adding a custom header to the 
headers collection with the Type, but RabbitMQ threw an error, and I was 
never able to get the Type to pass thru, plus there was no way to 
dynamically deserialize into the Type of object.  Unfortunately, the Type 
of object is not going to be acceptable.

Anyone have any suggestion I could try and/or research?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/ab1b57a4/attachment.htm>

From alexander.ward at quibids.com  Fri Aug 17 20:51:15 2012
From: alexander.ward at quibids.com (Alexander Ward)
Date: Fri, 17 Aug 2012 14:51:15 -0500
Subject: [rabbitmq-discuss] Different objects being passed thru RabbitMQ
In-Reply-To: <e4f181d2-b955-4b7c-9fd2-101fb37b05cf@googlegroups.com>
References: <e4f181d2-b955-4b7c-9fd2-101fb37b05cf@googlegroups.com>
Message-ID: <CAKeoubUyQ4q_28TLXcK3UiE4AEkTaW5tjUv6nz0ZWo_w8OQG5g@mail.gmail.com>

You could just make a generic object that you are sending to rabbit with 2
properties, one being the type of object you're sending, and the other
being the actual serialized object. You'd have to update your consumers to
be able to handle that though.

It might be better to just send json though, so you'd be working with
something that could have dynamic properties.

-Alex

On Fri, Aug 17, 2012 at 2:44 PM, Wizaerd <wizaerd at gmail.com> wrote:

> I'm working well with RabbitMQ thus far, however I have a question about
> how to approach something.  Right now I have a series of consumer
> applications that knows exactly what type of serislaized object is coming
> to the queue, as they are specialized for the specific object types to
> process.  However, the architect wants a more generic listener that pull
> messages from the queue, but the messages body would be a different type of
> serialized object.  for example it could be a User object, or a Course
> object, etc...  In my listener, what is the best way to dynamically
> determine the type of object being passed in, thus being able to
> deserialize it and work with it?  I had tried adding a custom header to the
> headers collection with the Type, but RabbitMQ threw an error, and I was
> never able to get the Type to pass thru, plus there was no way to
> dynamically deserialize into the Type of object.  Unfortunately, the Type
> of object is not going to be acceptable.
>
> Anyone have any suggestion I could try and/or research?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/fa683841/attachment.htm>

From brett.r.cameron at gmail.com  Fri Aug 17 21:01:00 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sat, 18 Aug 2012 08:01:00 +1200
Subject: [rabbitmq-discuss] C client questions . . .
In-Reply-To: <CAAt2po+Nr_bY101czq5ZPMZG6dfGKpcNEi+5Rny65CkzO3xJzg@mail.gmail.com>
References: <22BCE56D-B63C-4BDD-A7FF-4D8361DB9FE0@vmware.com>
	<CAAt2po+Nr_bY101czq5ZPMZG6dfGKpcNEi+5Rny65CkzO3xJzg@mail.gmail.com>
Message-ID: <CALPqkiqNaQE38V3cBPnYrK==HdArh2+1RVciaGk=FnRQ3QBikA@mail.gmail.com>

Jeff,

I'm sure Simon or Emile will correct me if I'm wrong, but I seem to recall
that the handshake timeout is currently hardwired in the broker to 10s. I
think there's also a SSL timeout of 5s. I've managed to hit one or both of
these limits when using a slow(ish) connection with SSL over the internet,
but have never hit it on the LAN, even with the broker managing many
thousands of simultaneous connections (all created literally one after the
other with no delay). Do you have any more details on your configuration?

Regards,
Brett

On Sat, Aug 18, 2012 at 2:40 AM, Alan Antonuk <alan.antonuk at gmail.com>wrote:

> Jeff;
>
> Handshake timeout? I think that's what happens when the client opens a
> socket (using amqp_open_socket) to the broker and doesn't complete the
> handshake process (calling amqp_login) in a certain amount of time.  The
> timeout is something set on the broker.
>
> I could imagine this sort of thing happening if for whatever reason the
> handshake was delayed, or you open a bunch of sockets to the broker without
> doing the handshake (calling amqp_login).  Other reasons why this could be
> happening:
> - The broker is too busy (I/O or CPU) to complete the handshake in enough
> time (maybe you have a bunch of clients trying to connect at the same time?)
> - There is a serious amount of network traffic preventing your clients
> from getting to the broker.
> - Something on the client side is really slowing down the handshake process
>
> Going to CC the rabbitmq-discuss list see if they have any ideas.
>
> -Alan
>
> On Fri, Aug 17, 2012 at 12:13 AM, Jeff Markham <jmarkham at vmware.com>wrote:
>
>> Hi Alan,
>>
>> Was wondering if you might know of any circumstance that might cause the
>> the client to peg the broker.  At ~130 client connections, we see
>>
>> =ERROR REPORT==== 14-Aug-2012::16:04:33 ===
>> closing AMQP connection <0.8196.3> (1.1.1.1:63114 -> 2.2.2.2:5671):
>> {handshake_timeout,handshake}
>>
>> in the logs and over and over until it consumes the entire memory of the
>> box.  Doesn't happen always but enough that we can't figure out what might
>> be causing this.
>>
>> Thanks for everything.
>>
>> https://github.com/rabbitmq/rabbitmq-c
>>
>> Jeff Markham
>> Senior Systems Engineer
>> vFabric Cloud Application Platform
>> VMware
>> (949) 385-3806
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120818/0b16b054/attachment.htm>

From curylod at asme.org  Fri Aug 17 21:02:49 2012
From: curylod at asme.org (Dave Curylo)
Date: Fri, 17 Aug 2012 16:02:49 -0400
Subject: [rabbitmq-discuss] Different objects being passed thru RabbitMQ
In-Reply-To: <e4f181d2-b955-4b7c-9fd2-101fb37b05cf@googlegroups.com>
References: <e4f181d2-b955-4b7c-9fd2-101fb37b05cf@googlegroups.com>
Message-ID: <CAAqmy6OV+Txpm=fho_f9ETwoaz2Apj_zz5mCtzBknscNFEHLMw@mail.gmail.com>

On Fri, Aug 17, 2012 at 3:44 PM, Wizaerd <wizaerd at gmail.com> wrote:


> I had tried adding a custom header to the headers collection with the
> Type, but RabbitMQ threw an error, and I was never able to get the Type to
> pass thru, plus there was no way to dynamically deserialize into the Type
> of object.  Unfortunately, the Type of object is not going to be acceptable.


You probably can't pass the Type itself into the header, but you should be
able to pass in the fully qualified type name as a string.

var props = model.CreateBasicProperties();
props.Headers["type"] = typof(User).AssemblyQualifiedName;

Then on the other end, you should be able to get out the type name, use
Type.GetType(typeName, true) to load the type, and perform deserialization
as usual.


> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/f28754d2/attachment.htm>

From mpietrek at skytap.com  Fri Aug 17 21:24:25 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Aug 2012 13:24:25 -0700
Subject: [rabbitmq-discuss] Is Pika's add_on_return_callback supposed to be
	single use?
Message-ID: <CACLE7iyNz0HYFnxqso+kWscpxfQi54LVvpjkbQXDR-_yNQLnCw@mail.gmail.com>

(Would publish to a Pika mailing list if there was one, but since there
doesn't seem to be...)

After registering a returned message handler in Pika, I noticed that it
only gets called once. Digging into the code, I see this:

    def add_on_return_callback(self, callback):
        """
        Pass a callback function that will be called when basic_publish as
sent
        a message that has been rejected and returned by the server. The
        callback handler should receive a method, header and body frame. The
        base signature for the callback should be the same as the method
        signature one creates for a basic_consume callback.
        """
       * self.callbacks.add(self.channel_number, '_on_basic_return',
callback)*

The CallbackManager.add() method is defined like this:

    def add(self, prefix, key, callback,* one_shot=True*, only_caller=None):

Since add_on_return_callback doesn't specify a value for the one_shot
keyword arg, it defaults to True, which explains exactly the behavior I'm
seeing.

Is this the correct behavior or an oversight?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/f229f918/attachment.htm>

From brett.r.cameron at gmail.com  Fri Aug 17 21:37:50 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sat, 18 Aug 2012 08:37:50 +1200
Subject: [rabbitmq-discuss] C client questions . . .
In-Reply-To: <CALPqkiqNaQE38V3cBPnYrK==HdArh2+1RVciaGk=FnRQ3QBikA@mail.gmail.com>
References: <22BCE56D-B63C-4BDD-A7FF-4D8361DB9FE0@vmware.com>
	<CAAt2po+Nr_bY101czq5ZPMZG6dfGKpcNEi+5Rny65CkzO3xJzg@mail.gmail.com>
	<CALPqkiqNaQE38V3cBPnYrK==HdArh2+1RVciaGk=FnRQ3QBikA@mail.gmail.com>
Message-ID: <CALPqkip41E3Y84=xsZn6i_+bmjo4ibit5G04bnSVFuU=iuR6kw@mail.gmail.com>

Also, do the failed connections always come from the same address(es)?
Could there be a dodgy piece of network kit somewhere that's causing
intermittent problems?

Brett

On Sat, Aug 18, 2012 at 8:01 AM, Brett Cameron <brett.r.cameron at gmail.com>wrote:

> Jeff,
>
> I'm sure Simon or Emile will correct me if I'm wrong, but I seem to recall
> that the handshake timeout is currently hardwired in the broker to 10s. I
> think there's also a SSL timeout of 5s. I've managed to hit one or both of
> these limits when using a slow(ish) connection with SSL over the internet,
> but have never hit it on the LAN, even with the broker managing many
> thousands of simultaneous connections (all created literally one after the
> other with no delay). Do you have any more details on your configuration?
>
> Regards,
> Brett
>
> On Sat, Aug 18, 2012 at 2:40 AM, Alan Antonuk <alan.antonuk at gmail.com>wrote:
>
>> Jeff;
>>
>> Handshake timeout? I think that's what happens when the client opens a
>> socket (using amqp_open_socket) to the broker and doesn't complete the
>> handshake process (calling amqp_login) in a certain amount of time.  The
>> timeout is something set on the broker.
>>
>> I could imagine this sort of thing happening if for whatever reason the
>> handshake was delayed, or you open a bunch of sockets to the broker without
>> doing the handshake (calling amqp_login).  Other reasons why this could be
>> happening:
>> - The broker is too busy (I/O or CPU) to complete the handshake in enough
>> time (maybe you have a bunch of clients trying to connect at the same time?)
>> - There is a serious amount of network traffic preventing your clients
>> from getting to the broker.
>> - Something on the client side is really slowing down the handshake
>> process
>>
>> Going to CC the rabbitmq-discuss list see if they have any ideas.
>>
>> -Alan
>>
>> On Fri, Aug 17, 2012 at 12:13 AM, Jeff Markham <jmarkham at vmware.com>wrote:
>>
>>> Hi Alan,
>>>
>>> Was wondering if you might know of any circumstance that might cause the
>>> the client to peg the broker.  At ~130 client connections, we see
>>>
>>> =ERROR REPORT==== 14-Aug-2012::16:04:33 ===
>>> closing AMQP connection <0.8196.3> (1.1.1.1:63114 -> 2.2.2.2:5671):
>>> {handshake_timeout,handshake}
>>>
>>> in the logs and over and over until it consumes the entire memory of the
>>> box.  Doesn't happen always but enough that we can't figure out what might
>>> be causing this.
>>>
>>> Thanks for everything.
>>>
>>> https://github.com/rabbitmq/rabbitmq-c
>>>
>>> Jeff Markham
>>> Senior Systems Engineer
>>> vFabric Cloud Application Platform
>>> VMware
>>> (949) 385-3806
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120818/18799a1f/attachment.htm>

From gmr at meetme.com  Fri Aug 17 21:45:12 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 17 Aug 2012 16:45:12 -0400
Subject: [rabbitmq-discuss] Is Pika's add_on_return_callback supposed to
 be single use?
In-Reply-To: <CACLE7iyNz0HYFnxqso+kWscpxfQi54LVvpjkbQXDR-_yNQLnCw@mail.gmail.com>
References: <CACLE7iyNz0HYFnxqso+kWscpxfQi54LVvpjkbQXDR-_yNQLnCw@mail.gmail.com>
Message-ID: <CAKwdTWeva9V_3PXmGJ8m7fOhOw0erujobMXkJKk7eHFKbUmi2g@mail.gmail.com>

On Fri, Aug 17, 2012 at 4:24 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> (Would publish to a Pika mailing list if there was one, but since there
> doesn't seem to be...)
>

There is, but this list is helpful too.

  https://groups.google.com/forum/?fromgroups#!forum/pika-python


> Is this the correct behavior or an oversight?
>

That is an oversight, I've opened a ticket:
https://github.com/pika/pika/issues/164

Thanks,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/2ecb3784/attachment.htm>

From mpietrek at skytap.com  Fri Aug 17 21:53:49 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Aug 2012 13:53:49 -0700
Subject: [rabbitmq-discuss] Is Pika's add_on_return_callback supposed to
 be single use?
In-Reply-To: <CAKwdTWeva9V_3PXmGJ8m7fOhOw0erujobMXkJKk7eHFKbUmi2g@mail.gmail.com>
References: <CACLE7iyNz0HYFnxqso+kWscpxfQi54LVvpjkbQXDR-_yNQLnCw@mail.gmail.com>
	<CAKwdTWeva9V_3PXmGJ8m7fOhOw0erujobMXkJKk7eHFKbUmi2g@mail.gmail.com>
Message-ID: <CACLE7ixvQ=xzSk+3NSnVYP+z1MAvHNC9R_07dN-sTXhRjHe-fg@mail.gmail.com>

Awesomeness. Thanks Gavin!

On Fri, Aug 17, 2012 at 1:45 PM, Gavin M. Roy <gmr at meetme.com> wrote:

>
> On Fri, Aug 17, 2012 at 4:24 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>
>> (Would publish to a Pika mailing list if there was one, but since there
>> doesn't seem to be...)
>>
>
> There is, but this list is helpful too.
>
>   https://groups.google.com/forum/?fromgroups#!forum/pika-python
>
>
>> Is this the correct behavior or an oversight?
>>
>
> That is an oversight, I've opened a ticket:
> https://github.com/pika/pika/issues/164
>
> Thanks,
>
> Gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/b988ce97/attachment.htm>

From mpietrek at skytap.com  Fri Aug 17 22:12:27 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Aug 2012 14:12:27 -0700
Subject: [rabbitmq-discuss] tx_commit() semantics with async connections
 (e.g Pika SelectConnection)
In-Reply-To: <CAKwdTWdvgiaCDGxAuW4kja6hJgj8oo8VqTL90VdneEzRQwsaqg@mail.gmail.com>
References: <CACLE7iy=_3LaW2Q6Eoy-c_PSy9kX03Cmidzmc_bK2930L=Xt4Q@mail.gmail.com>
	<CAKwdTWdvgiaCDGxAuW4kja6hJgj8oo8VqTL90VdneEzRQwsaqg@mail.gmail.com>
Message-ID: <CACLE7ixg7rYWQThq7uPYwxFVZ6Fxcu+6AXtW4mZD9FFHGxsPHA@mail.gmail.com>

Thanks for the background Gavin. It's glad to get confirmation that I was
on the right track with my understanding.

A few thoughts:

It might be worth adding some sort of warning output if there's a
synchronous command in the output buffer and then another "method" (e.g.,
Basic.Publish) get's added.

It would be nice to have some mechanism of saying "Go send whatever output
data you have, right now", then wait for some data to arrive back from the
server. The incoming data wouldn't have to be processed before returning,
but you'd at least know that you could safely send more methods without
breaking AMQP rules.

My thinking is that after calling tx_commit() in my message handler, I
could call this method.

Lastly, it would be really helpful to update the Pika doc to reflect what
you said in your reply. In particular, this except from the
Channel.tx_commit() description appears incorrect, or at least confusing:

*This is a synchronous method that will not allow other commands to be send
to the AMQP broker until it has completed.*

Thanks again,

Matt
On Fri, Aug 17, 2012 at 12:38 PM, Gavin M. Roy <gmr at meetme.com> wrote:

>
>
> On Fri, Aug 17, 2012 at 3:13 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>
>> I've been drilling into an issue for a few days where my Pika channel is
>> abruptly closed. I'm pretty sure I've found either:
>>
>>    - A large gap in my understanding
>>    - A misuse of the Rabbit/Pika APIs
>>
>> Depending on your perspective, this seems the most likely, in that there
> is not any logic in Pika for managing Tx. It lets you send the RPC calls
> and leaves it to you to manage state outside of the connection/channel.
>
>>
>>    - A serious bug in Pika.
>>
>> My original understanding about transactions is that calling tx_select()
>> is a synchronous operation, and that when it returns, whatever actions
>> you've sent to the broker are committed.
>>
>> However, in stepping through the Pika tx_commit() code, it seems like it
>> all it does is add the Tx.Commit message to an outgoing buffer, and that
>> the tx_commit() call returns without anything actually sent to the broker.
>> (I've set breakpoints in the debugger at strategic points to verify this.)
>>
> This is correct, because pika is event-loop driven, it is putting the
> frame in the output buffer and returning to you. The event loop will write
> the data out as the operating system tells it it can You are correct that
> it is not blocking on the Tx.Commit until the data is written over the
> socket.
>
>> In my message handler, I'm writing a reply to the incoming message, using
>> the same channel. What I'm seeing (verified via WireShark) is that the
>> Tx.Commit message is followed by some number of Basic.Publish,
>> Content-Header, and Content-Body records corresponding to my reply message
>> writes.
>>
> Your frames are sent in the order the methods are called.
>
>> This violates the AMQP standard, which says that nothing should be sent
>> to the broker after sending a Tx.Commit and before receiving a Tx.Commit-Ok
>> reply. (If it helps understanding, my incoming message queue has a few
>> messages in it already, so I see a series of incoming messages immediately
>> after starting.)
>>
> You should add a callback for the Tx.Commit-Ok reply and then send your
> messages. You are correct that Pika is not enforcing the behavior of
> blocking until Tx.Commit-Ok.
>
> You could open a 2nd channel and send your replies over that.
>
>> I see that the tx_commit() method takes a callback method, but if I were
>> to simply block in my message handler, waiting for the callback to be
>> invoked, I'd deadlock because Pika's buffer processing code doesn't get a
>> chance to run.
>>
> How are you blocking? If you're using any truly blocking method, it will
> stop the event loop from running. Since you're on the async loop, I'd use a
> timer and a state variable to toggle between the various states you're
> trying to achieve.
>
> Gavin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/a415ade2/attachment.htm>

From mpietrek at skytap.com  Fri Aug 17 23:52:49 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Aug 2012 15:52:49 -0700
Subject: [rabbitmq-discuss] Using Pika's add_on_return_callback with a
	BlockingConnection?
Message-ID: <CACLE7iwSc-NCgfL_kG5H60VAny2yQ9Yu7r0dBNf=DR1RbSxWrg@mail.gmail.com>

I'm got a scenario where I use a dedicated thread to write a series of
messages in a loop. This thread uses BlockingConnection, calls
add_on_return_callback for its channel, and when publishing, uses the
mandatory=True flag.

I want to know when a message is being returned. However, I can't figure
out what to call within my loop to give Pika the opportunity to see the
Basic.Return message and invoke the callback.

I've verified via WireShark that the Basic.Returns are coming back from the
broker. However, I can't figure out what the moral equivalent of calling
ioloop.start() is, so as to give Pika the an opportunity to process the
basic.return messages, but without blocking indefinitely. Just for kicks I
tried calling Channel.basic_get() within the loop, and (as expected), I
didn't get the returned message callbacks.

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/14fe799f/attachment.htm>

From mpietrek at skytap.com  Sat Aug 18 00:11:20 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Aug 2012 16:11:20 -0700
Subject: [rabbitmq-discuss] Using Pika's add_on_return_callback with a
	BlockingConnection?
In-Reply-To: <CACLE7iwSc-NCgfL_kG5H60VAny2yQ9Yu7r0dBNf=DR1RbSxWrg@mail.gmail.com>
References: <CACLE7iwSc-NCgfL_kG5H60VAny2yQ9Yu7r0dBNf=DR1RbSxWrg@mail.gmail.com>
Message-ID: <CACLE7izSyw7B9gEKYGeirUCCkbZ7wuAuwBwEuOdPR8DmbFVxFA@mail.gmail.com>

Update on this: I came across the BlockingConnection.process_data_events()
method, which seems to do the trick if I insert it into my loop.

However, it doesn't look like an "official" API, in that I don't see it
described anywhere, and the only search results I get for it are its
inclusions in various callstacks.

Gavin (or whomever else wants to comment): What are your thoughts on this?

Thanks,

Matt

On Fri, Aug 17, 2012 at 3:52 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> I'm got a scenario where I use a dedicated thread to write a series of
> messages in a loop. This thread uses BlockingConnection, calls
> add_on_return_callback for its channel, and when publishing, uses the
> mandatory=True flag.
>
> I want to know when a message is being returned. However, I can't figure
> out what to call within my loop to give Pika the opportunity to see the
> Basic.Return message and invoke the callback.
>
> I've verified via WireShark that the Basic.Returns are coming back from
> the broker. However, I can't figure out what the moral equivalent of
> calling ioloop.start() is, so as to give Pika the an opportunity to process
> the basic.return messages, but without blocking indefinitely. Just for
> kicks I tried calling Channel.basic_get() within the loop, and (as
> expected), I didn't get the returned message callbacks.
>
> Thanks,
>
> Matt
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/d2a2e00e/attachment.htm>

From vitaly.krugl.numenta at gmail.com  Sat Aug 18 09:40:28 2012
From: vitaly.krugl.numenta at gmail.com (vitaly)
Date: Sat, 18 Aug 2012 01:40:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Unexpected Incoming message timeouts when using
 Haigha/GeventTransport inside uwsgi server
Message-ID: <862b7bbd-e051-4f48-a07d-311e8c2e1f69@googlegroups.com>

I posted the full details on the gevent 
forum: https://groups.google.com/forum/?fromgroups#!topic/gevent/wK7Zrv0wwLs, 
but would like to see if anyone here has run into the problem or has 
recommendations for addressing it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120818/fc59ffef/attachment.htm>

From geegalrawat at gmail.com  Sat Aug 18 16:41:57 2012
From: geegalrawat at gmail.com (Rawat)
Date: Sat, 18 Aug 2012 08:41:57 -0700
Subject: [rabbitmq-discuss] Query on clustering
Message-ID: <CAKm8WCkSXyCZTswuTVoxSnGYF89wKCsjirgZmg92krmYpajb+w@mail.gmail.com>

Hi All,

I am a new user of RabbitMQ and i developed an App using RabbitMQ as a
broker providing asynchronous message communication. However to have high
availability i want to install rabbitMQ as a cluster.


I will have fixed number of publishers pushing data to RabbitMQ Cluster and
fixed number of consumers taking data from RabbitMQ cluster.


From jonathan at yaresse.com  Sun Aug 19 16:27:31 2012
From: jonathan at yaresse.com (Jonathan Camp)
Date: Sun, 19 Aug 2012 08:27:31 -0700 (PDT)
Subject: [rabbitmq-discuss] bulk loading
Message-ID: <73ca94b2-dbb8-4c86-bee5-a486d31f4ad2@13g2000vbf.googlegroups.com>

Is there a method for loading a static set of messages? I have a set
of X million tasks that I need to load into various task queues on a
regular interval (once a week). Rather than publish the same set one
at a time, over and over again, I am hoping there is a way to do a
bulk load.

Thanks! Jonathan

From schaible_adam at yahoo.com  Sun Aug 19 18:18:33 2012
From: schaible_adam at yahoo.com (schaibaa)
Date: Sun, 19 Aug 2012 10:18:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Clusters stop working/passing messages
Message-ID: <d9787920-75cb-45c6-9acc-1e29f357d844@googlegroups.com>

Hi Guys,

I was hoping I might be able to get some help -- I'm running a 3 node 
rabbitmq cluster.  All 3 are currently in Disc mode.

The cluster isn't that busy ... I'm not sure how to obtain throughput 
stats, but my estimate is a few hundred messages per hour.

Anyway, every week or so, we notice an issue in our application, and I'll 
check the dashboard.  One of the nodes will be red and offline.  The 
RabbitMQ service on that machine is still running, but it appears offline 
to the other two nodes.

Restarting the nodes seems to immediately fix the problem... I'm just 
hoping to eliminate this issue.

OS:  Windows server 2008 R2
RabbitMQ Version: 2.8.0

The only thing I see in the logs is below:

=ERROR REPORT==== 19-Aug-2012::12:37:55 ===
Mnesia('rabbit at NODE3'): ** ERROR ** mnesia_event got 
{inconsistent_database, running_partitioned_network, 'rabbit at NODE1'}

=ERROR REPORT==== 19-Aug-2012::12:37:55 ===
Mnesia('rabbit at NODE3'): ** ERROR ** mnesia_event got 
{inconsistent_database, starting_partitioned_network, 'rabbit at NODE2'}

This when I restarted the service on NODE1 ... and a similar log message 
appears on the other nodes.

Any suggestions?  Relatively new to RabbitMQ ...

Thanks :)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120819/8130c984/attachment.htm>

From dharshanr at scalegrid.net  Sun Aug 19 22:31:19 2012
From: dharshanr at scalegrid.net (dharshanr)
Date: Sun, 19 Aug 2012 14:31:19 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ configuration for Scaleout RPC setup
Message-ID: <250d5fdd-df71-49b2-b1d6-ce069457044b@googlegroups.com>

Hi folks,

We are using RabbitMQ to implement a RPC messaging scenario between a 
server and a number of clients. There could potentially be hundreds of 
thousands of clients. Each client also belongs to a different customer - so 
isolation between clients is good.  Here is what I am thinking - would love 
to get the thoughts of RabbitMQ experts

1. A virtual host and user for every client. This way each client connects 
to its virtual host using its own username password. Also if one clients 
username/password gets compromised it wont affect the other clients.
2. One queue per virtual host called the "Client messaging queue". The 
client waits for messages on this queue after connecting to the virtual host
3. When the server wants to message a client it creates an unnamed queue in 
the virtual host of the client (as the reply queue) and then posts messages 
to the "Client messaging queue". The client processes the message and 
replies back on the tagged reply queue.

The clients are forever connected to the RabbitMQ server. I have also set 
RequestHeartBeat since there is a load balancer in the middle.

regards,
Dharshan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120819/e0394dc8/attachment.htm>

From mjeffery at fnb.co.za  Wed Aug 15 14:47:57 2012
From: mjeffery at fnb.co.za (dandare100)
Date: Wed, 15 Aug 2012 06:47:57 -0700 (PDT)
Subject: [rabbitmq-discuss] JSON-RPC: RPC endpoint responds with "not
	found"
In-Reply-To: <4FFC05B6.3050607@rabbitmq.com>
References: <34ca1fe7-68a5-4f01-8f52-9e880ce4f8c9@googlegroups.com>
	<4FFC05B6.3050607@rabbitmq.com>
Message-ID: <1345038477273-21415.post@n5.nabble.com>

Extracting the earlier version plugin and activating it worked for me.

Thanks, this was great help



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/JSON-RPC-RPC-endpoint-responds-with-not-found-tp20670p21415.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jmarkham at vmware.com  Fri Aug 17 19:04:12 2012
From: jmarkham at vmware.com (Jeff Markham)
Date: Fri, 17 Aug 2012 11:04:12 -0700
Subject: [rabbitmq-discuss] C client questions . . .
In-Reply-To: <CAAt2po+Nr_bY101czq5ZPMZG6dfGKpcNEi+5Rny65CkzO3xJzg@mail.gmail.com>
References: <22BCE56D-B63C-4BDD-A7FF-4D8361DB9FE0@vmware.com>
	<CAAt2po+Nr_bY101czq5ZPMZG6dfGKpcNEi+5Rny65CkzO3xJzg@mail.gmail.com>
Message-ID: <7038871F-EDD3-4DC2-B16C-F6B7DAEBC81B@vmware.com>

Thanks much, Alan.  I'll follow up to see if any engineers have any suggestions based on your feedback.

Jeff Markham
Senior Systems Engineer
vFabric Cloud Application Platform
VMware
(949) 385-3806

On Aug 17, 2012, at 7:40 AM, Alan Antonuk wrote:

Jeff;

Handshake timeout? I think that's what happens when the client opens a socket (using amqp_open_socket) to the broker and doesn't complete the handshake process (calling amqp_login) in a certain amount of time.  The timeout is something set on the broker.

I could imagine this sort of thing happening if for whatever reason the handshake was delayed, or you open a bunch of sockets to the broker without doing the handshake (calling amqp_login).  Other reasons why this could be happening:
- The broker is too busy (I/O or CPU) to complete the handshake in enough time (maybe you have a bunch of clients trying to connect at the same time?)
- There is a serious amount of network traffic preventing your clients from getting to the broker.
- Something on the client side is really slowing down the handshake process

Going to CC the rabbitmq-discuss list see if they have any ideas.

-Alan

On Fri, Aug 17, 2012 at 12:13 AM, Jeff Markham <jmarkham at vmware.com<mailto:jmarkham at vmware.com>> wrote:
Hi Alan,

Was wondering if you might know of any circumstance that might cause the the client to peg the broker.  At ~130 client connections, we see

=ERROR REPORT==== 14-Aug-2012::16:04:33 ===
closing AMQP connection <0.8196.3> (1.1.1.1:63114<http://1.1.1.1:63114/> -> 2.2.2.2:5671<http://2.2.2.2:5671/>):
{handshake_timeout,handshake}

in the logs and over and over until it consumes the entire memory of the box.  Doesn't happen always but enough that we can't figure out what might be causing this.

Thanks for everything.

https://github.com/rabbitmq/rabbitmq-c

Jeff Markham
Senior Systems Engineer
vFabric Cloud Application Platform
VMware
(949) 385-3806<tel:%28949%29%20385-3806>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120817/7bceca4e/attachment.htm>

From emile at rabbitmq.com  Mon Aug 20 09:46:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Aug 2012 09:46:30 +0100
Subject: [rabbitmq-discuss] bulk loading
In-Reply-To: <73ca94b2-dbb8-4c86-bee5-a486d31f4ad2@13g2000vbf.googlegroups.com>
References: <73ca94b2-dbb8-4c86-bee5-a486d31f4ad2@13g2000vbf.googlegroups.com>
Message-ID: <5031F966.3030809@rabbitmq.com>

Hi Jonathan,

On 19/08/12 16:27, Jonathan Camp wrote:
> Is there a method for loading a static set of messages? I have a set
> of X million tasks that I need to load into various task queues on a
> regular interval (once a week). Rather than publish the same set one
> at a time, over and over again, I am hoping there is a way to do a
> bulk load.

There's no special bulk loader, but you can write one in term of
basic.publish that loads messages one at a time.

If you want to reset the broker to a previous state then you can restore
a copy of the database directory while the broker is shut down. Only
persistent messages will survive this operation and you will lose any
state that existed on the broker prior to the restore with this method.


-Emile


From emile at rabbitmq.com  Mon Aug 20 09:50:34 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Aug 2012 09:50:34 +0100
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTikbZBQk9R1yvKNDtPK1n9+JqGiHMG3G7AHF-TsV@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>
	<AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>
	<B1E95C0F-54AC-44B4-B695-05BA63934A88@vmware.com>
	<AANLkTi=3OO9=um6odf2RiQY9qexnEp_8iu8ypNinqw2W@mail.gmail.com>
	<F2564C42-56A3-4D57-AADB-7EC773C2A40F@vmware.com>
	<AANLkTikbZBQk9R1yvKNDtPK1n9+JqGiHMG3G7AHF-TsV@mail.gmail.com>
Message-ID: <5031FA5A.5020803@rabbitmq.com>

Hi,

On 09/12/10 01:48, Justin Etheredge wrote:
> Honestly I wasn't under the impression that the message ordering could
> be relied on at all. I mean a basic.reject with a redeliver puts the
> message to the end of the queue, right?

The broker has been improved in the meantime so that ordering is
preserved under those conditions. See

http://www.rabbitmq.com/semantics.html#ordering

-Emile

From emile at rabbitmq.com  Mon Aug 20 09:56:44 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Aug 2012 09:56:44 +0100
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <1345232635161-21485.post@n5.nabble.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<1345232635161-21485.post@n5.nabble.com>
Message-ID: <5031FBCC.8080606@rabbitmq.com>

Hi,

On 17/08/12 20:43, fm wrote:
> Has there been a progress about implementation of redelivery count or is
> there a patch for this issue?

No. The conformance page will be updated if/when this is added:
http://www.rabbitmq.com/specification.html
The release notes will also have information to that affect.

In the meantime you can use the redelivered flag to detect when messages
have been redelivered once and treat that as a hint that it may need
special handling.

-Emile


From matthias at rabbitmq.com  Mon Aug 20 10:00:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 20 Aug 2012 10:00:57 +0100
Subject: [rabbitmq-discuss] bulk loading
In-Reply-To: <73ca94b2-dbb8-4c86-bee5-a486d31f4ad2@13g2000vbf.googlegroups.com>
References: <73ca94b2-dbb8-4c86-bee5-a486d31f4ad2@13g2000vbf.googlegroups.com>
Message-ID: <5031FCC9.2050607@rabbitmq.com>

Jonathan,

On 19/08/12 16:27, Jonathan Camp wrote:
> Is there a method for loading a static set of messages? I have a set
> of X million tasks that I need to load into various task queues on a
> regular interval (once a week). Rather than publish the same set one
> at a time, over and over again, I am hoping there is a way to do a
> bulk load.

What is wrong with "publish the same set one at a time"? It should be 
very little code, and it should be fast.

Anyway, why don't you get rabbit to reload the tasks every week for you?

You could configure the routing s.t. every task that is published ends 
up in two queues - the intended task queue and a (shared) "cron" queue. 
Set up the latter with a per-queue message ttl of one week and a dlx 
pointing to the same exchange the messages were published to initially.

It's possible that rabbit's dlx cycle detection prevents this sort of 
configuration, which would be a shame and s.t. we should change.

Regards,

Matthias.

From emile at rabbitmq.com  Mon Aug 20 10:23:10 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Aug 2012 10:23:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ configuration for Scaleout RPC setup
In-Reply-To: <250d5fdd-df71-49b2-b1d6-ce069457044b@googlegroups.com>
References: <250d5fdd-df71-49b2-b1d6-ce069457044b@googlegroups.com>
Message-ID: <503201FE.7090204@rabbitmq.com>

Hi,

On 19/08/12 22:31, dharshanr wrote:
> 1. A virtual host and user for every client. This way each client
> connects to its virtual host using its own username password. Also if
> one clients username/password gets compromised it wont affect the other
> clients.
> 2. One queue per virtual host called the "Client messaging queue". The
> client waits for messages on this queue after connecting to the virtual host
> 3. When the server wants to message a client it creates an unnamed queue
> in the virtual host of the client (as the reply queue) and then posts
> messages to the "Client messaging queue". The client processes the
> message and replies back on the tagged reply queue.

Your suggested solution will work, but it suffers from the weakness that
the server will need to maintain a separate connection to the broker for
each vhost. Using separate vhost provides good isolation, but you may be
able to get away with less by careful use of access control rules:

www.rabbitmq.com/access-control.html


From emile at rabbitmq.com  Mon Aug 20 10:32:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Aug 2012 10:32:02 +0100
Subject: [rabbitmq-discuss] Clusters stop working/passing messages
In-Reply-To: <d9787920-75cb-45c6-9acc-1e29f357d844@googlegroups.com>
References: <d9787920-75cb-45c6-9acc-1e29f357d844@googlegroups.com>
Message-ID: <50320412.9010702@rabbitmq.com>

Hi,

On 19/08/12 18:18, schaibaa wrote:
> =ERROR REPORT==== 19-Aug-2012::12:37:55 ===
> Mnesia('rabbit at NODE3'): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network, 'rabbit at NODE1'}

This indicates that the node has been disconnected from the cluster.
RabbitMQ clustering demands reliable network connections between all
nodes in the cluster. If your network connections are not reliable then
consider using federation or the shovel instead:

http://www.rabbitmq.com/distributed.html


-Emile


From emile at rabbitmq.com  Mon Aug 20 10:46:04 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Aug 2012 10:46:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ as a service on Windows - setup
In-Reply-To: <523e1fbc-fb65-4938-8646-5aab084b62b8@googlegroups.com>
References: <523e1fbc-fb65-4938-8646-5aab084b62b8@googlegroups.com>
Message-ID: <5032075C.9020000@rabbitmq.com>

Hi,

On 16/08/12 14:43, et1975 wrote:
> I'm configuring my nodes to work over firewall and I keep changing
> rabbitmq-service.bat to include
> -kernel inet_dist_listen_min 4000 ^
> -kernel inet_dist_listen_max 4100 ^
> into ERLANG_SERVICE_ARGUMENTS

You can also add these details to a 'kernel' section in the
rabbitmq.config file:

[{kernel, [{inet_dist_listen_min, 4000},
           {inet_dist_listen_max, 4100}]}].

See http://www.rabbitmq.com/configure.html for details.

> after that I have to reinstall the service, which still doesn't work
> until I start the server interactively, then kill it, then reinstall
> succeeds in configuring the port range.

Modifying the broker configuration requires re-installing and restarting
the service, as shown here:

http://www.rabbitmq.com/plugins.html#windows-restart



-Emile




From francesco at rabbitmq.com  Mon Aug 20 10:54:05 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 20 Aug 2012 10:54:05 +0100
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F437@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>
Message-ID: <87fw7hopmq.wl%francesco@rabbitmq.com>

Hi Jon,

At Thu, 16 Aug 2012 09:13:59 +0000,
Jon Bergli Heier wrote:
> 
> > OK, so if I understand correctly after you restart rabbit1 or rabbit2 the shovel
> > plugin stops sending ack after consuming from the source queue, right?
> 
> Yes, that seems to be the case.
> 
> > Mhm.  Again, what does the shovel status show?  The logs would be useful as
> > well.
> 
> The shovel status still shows as running on this point. I checked the logs and
> couldn't find anything (I have no idea exactly when the shovel disconnects).
> 
> I have attached the logs in case they might be of help.

I took a look at the bug and I can see a lot of network errors - and this
matches the fact that your connection is unreliable.  Could you provide a
timeline of events, so that I can interpret the logs more easily?

Also, just to clarify: those logs are from the single node that acts as a source
for the shovel, and the shovel itself lives on that node, right?

--
Francesco * Often in error, never in doubt

From jon.bergli.heier at zisson.no  Mon Aug 20 11:35:16 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Mon, 20 Aug 2012 10:35:16 +0000
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <87fw7hopmq.wl%francesco@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87fw7hopmq.wl%francesco@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>

> I took a look at the bug and I can see a lot of network errors - and this
> matches the fact that your connection is unreliable.  Could you provide a
> timeline of events, so that I can interpret the logs more easily?

Looking at the end of the log, at approx. 10:51:55 one of the nodes are shut
down, and in the management interface I see that the shovel reconnects to the
other node. About 30 seconds later I start it up again, nothing seems to be
logged at this time. (The last entry in the log is my producer client manually
disconnecting)

> Also, just to clarify: those logs are from the single node that acts as a source
> for the shovel, and the shovel itself lives on that node, right?

Yes, that is correct.

________________________________________
From: Francesco Mazzoli [francesco at rabbitmq.com]
Sent: Monday, August 20, 2012 11:54
To: Discussions about RabbitMQ
Cc: Jon Bergli Heier
Subject: Re: [rabbitmq-discuss] Shovel stops receiving acks from cluster

Hi Jon,

At Thu, 16 Aug 2012 09:13:59 +0000,
Jon Bergli Heier wrote:
>
> > OK, so if I understand correctly after you restart rabbit1 or rabbit2 the shovel
> > plugin stops sending ack after consuming from the source queue, right?
>
> Yes, that seems to be the case.
>
> > Mhm.  Again, what does the shovel status show?  The logs would be useful as
> > well.
>
> The shovel status still shows as running on this point. I checked the logs and
> couldn't find anything (I have no idea exactly when the shovel disconnects).
>
> I have attached the logs in case they might be of help.

I took a look at the bug and I can see a lot of network errors - and this
matches the fact that your connection is unreliable.  Could you provide a
timeline of events, so that I can interpret the logs more easily?

Also, just to clarify: those logs are from the single node that acts as a source
for the shovel, and the shovel itself lives on that node, right?

--
Francesco * Often in error, never in doubt

From Ryan at nutcracker.co.za  Mon Aug 20 14:36:47 2012
From: Ryan at nutcracker.co.za (Ryan Gunn)
Date: Mon, 20 Aug 2012 13:36:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 - Service Crash on Windows 2008 R2
Message-ID: <A33D44D3C6F1D54AA679F7A3B0995E23237BF7AD@Nutdc.Nutcracker.local>

Good Day,

This morning my RabbitMQ service crashed for some reason. I'm still trying to understand these log files and hoping someone can assist. I'm using RabbitMQ 2.8.2, Windows Server 2008 R2 and Erlang R15B. There seemed to be a lot of connections being made to the rabbit service when this crashed happened. I don't know if that would maybe be the cause of the service crash. Please find attached log file for more information. I've also looked through the Windows Event Log and cannot find anything.

Thank You

Ryan Gunn
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Error_Report.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/bbdc75f9/attachment.txt>

From francesco at rabbitmq.com  Mon Aug 20 15:24:03 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 20 Aug 2012 15:24:03 +0100
Subject: [rabbitmq-discuss] simple federation question
In-Reply-To: <2319481f-8c9b-4e21-8ca4-fca467d5e41a@googlegroups.com>
References: <caf04340-116e-4703-8626-3ac34ae24476@googlegroups.com>
	<2319481f-8c9b-4e21-8ca4-fca467d5e41a@googlegroups.com>
Message-ID: <878vd9od4s.wl%francesco@rabbitmq.com>

Hi Bobby,

At Thu, 16 Aug 2012 12:49:20 -0700 (PDT),
Bobby Castleberry wrote:
> It doesn't seem to be forwarding the messages to the end point queues.  I
> subscribe to the federated exchange (graphite-uplink on polling1), publish a
> message and it drops into a locally generated queue but never makes it to the
> end points.  I may be missing something with the routing but as I understood
> it this back end style exchange should handle the routing by default.
> 
> [...]

I'm not sure I understand what you're doing, but two scenarios come to mind
(assuming some binding from `graphite-uplink' to
`amq.gen-wEmGzR01E_M30QDAndw8VD'):

  1. You're publishing your messages to `graphite-uplink' in
     `sansketch8polling1'.  `sansketch8polling1' is the *downstream* exchanges -
     in other words, it receives messages.  So the messages published to
     `graphite-uplink' will just be routed locally to the respective queues.

  2. You're publishing to `graphite' on `sansketch8display1'.  In this case what
     you're seeing is the expected behaviour.  The messages is being passed on
     to `graphite-uplink' on `sansketch8polling1' and they show up in the queue.

Since you're surprised by what you're seeing, my guess is that you're doing
number 1 but you think `graphite-uplink' is the upstream exchange, while it is
the opposite.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Mon Aug 20 15:31:01 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 20 Aug 2012 15:31:01 +0100
Subject: [rabbitmq-discuss] Query on clustering
In-Reply-To: <CAKm8WCkSXyCZTswuTVoxSnGYF89wKCsjirgZmg92krmYpajb+w@mail.gmail.com>
References: <CAKm8WCkSXyCZTswuTVoxSnGYF89wKCsjirgZmg92krmYpajb+w@mail.gmail.com>
Message-ID: <877gstoct6.wl%francesco@rabbitmq.com>

Hi Rawat,

At Sat, 18 Aug 2012 08:41:57 -0700,
Rawat wrote:
> From what i ?understood is that RabbitMQ Cluster is not transparent to
> Publishers and Consumers. e.g publisher has to switch to a different node of
> RabbitMQ Cluster if one node fails. Same way for consumers.

That's correct.

> Is there a way publisher & consumer can just connect with RabbitMQ cluster via
> a single nodename ? Without knowing which cluster node is serving them ?

Are you suggesting some king of "cluster name" that identifies the whole cluster
instead of a single node?  How would that work?

Since you can't rely on any cluster node to always be online, you have to change
if the one you're connected to goes down.

> I want to ?install RabbitMQ cluster in 1x1 configuration ( both RAM nodes
> ).

Having a RAM only cluster is, in most imaginable scenarios, a very bad idea.
The performance improvements are minimum and you risk loss of data.  Why did you
want to do that?

> And my intention is only that if one node fails, then all publishing and
> consuming tranparently gets switched to other cluster node.

I'm afraid that the easiest way will be by catching disconnections and
reconnecting to another cluster node.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Mon Aug 20 15:37:06 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 20 Aug 2012 15:37:06 +0100
Subject: [rabbitmq-discuss] Query on clustering
In-Reply-To: <877gstoct6.wl%francesco@rabbitmq.com>
References: <CAKm8WCkSXyCZTswuTVoxSnGYF89wKCsjirgZmg92krmYpajb+w@mail.gmail.com>
	<877gstoct6.wl%francesco@rabbitmq.com>
Message-ID: <87628docj1.wl%francesco@rabbitmq.com>

At Mon, 20 Aug 2012 15:31:01 +0100,
Francesco Mazzoli wrote:
> I'm afraid that the easiest way will be by catching disconnections and
> reconnecting to another cluster node.

...and a common solution to this problem (outside AMQP) is to put a load
balancer in front of the cluster.

--
Francesco * Often in error, never in doubt

From johnson at edocom.cn  Mon Aug 20 16:51:32 2012
From: johnson at edocom.cn (johnson)
Date: Mon, 20 Aug 2012 23:51:32 +0800
Subject: [rabbitmq-discuss] Is it possible to receive multiple messages then
	return an ACK to Rabbitmq Server?
References: <mailman.1.1344337202.26410.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <201208202351312153998@edocom.cn>

Hi,

I encounter a question and hope anyone can help me.

If I choose the manually Consumer ACK, the consumer needs to return an ACK to Rabbitmq Server once the message arrives. Otherwise the server will not continue to send the message. 

The sender is not under my control. The size of the message is too small. To get enough high efficiency, it is better to merge several messages into 1 bigger message at the consumer side.

Hence, my problem is the following. Is it possible to receive multiple messages then return 1 ACK to Rabbitmq Server? 

Thanks in advance.

Johnson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/0a06db92/attachment.htm>

From ernest.staszuk at comarch.pl  Mon Aug 20 16:58:11 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Mon, 20 Aug 2012 17:58:11 +0200
Subject: [rabbitmq-discuss] Is it possible to receive multiple messages
 then return an ACK to Rabbitmq Server?
In-Reply-To: <201208202351312153998@edocom.cn>
References: <mailman.1.1344337202.26410.rabbitmq-discuss@lists.rabbitmq.com>
	<201208202351312153998@edocom.cn>
Message-ID: <50325E93.5070204@comarch.pl>

Yes, it is.

Firstly, you must set prefetch (channel.basicQos) as big as many 
messages you want to get before ack.
Secondly, you could call channel.basicAck with multiple flag set to true 
(second parameter). That should work.

Regards,
Ernest Staszuk

W dniu 2012-08-20 17:51, johnson pisze:
> Hence, my problem is the following. 
> Is it possible to receive multiple messages then return 1 ACK to Rabbitmq Server? 
>
> Thanks in


From wchrisjohnson at gmail.com  Mon Aug 20 17:10:58 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Mon, 20 Aug 2012 12:10:58 -0400
Subject: [rabbitmq-discuss] Exchange/queue setup question
Message-ID: <CC57D9D2.1F9D1%wchrisjohnson@gmail.com>

I need a second pair of eyes on a small RMQ app I'm working on.
I suspect the issue I'm seeing is related to how I am defining my exchanges
and queues.

If I connect with two clients, I'll see every other message appear on my
client. If I connect with three clients, I see every third message, and so
on. In other words, it appears to 1) be deleting every message that gets
produced on consumption, and 2) round robins which consumer gets each
message.

What I want to see is all clients get the same message each time one is
posted.

Is a topic approach the best approach for this, or is fanout the better way
to handle this?

Here's the specifics of how my producer and consumer is set up:


PRODUCER (client=bunny)
=====================

@topic_exchange ||= client.exchange("internal.platformalert", :type =>
:topic,
                                    :durable => true, :autodelete => false)
@queue ||= client.queue("internal.platformalert.#", :durable => true,
                        :autodelete => false, :arguments => {'x-ha-policy'
=> 'all'})
queue.bind(e, :key => "alert")
exchange.publish(message, :key => "alert", :persistent => true)


CONSUMER (client=ruby-amqp)
=====================

exchange = channel.topic("internal.platformalert", :durable => true,
:autodelete => false)
queue    = channel.queue("internal.platformalert.#", :durable => true,
:autodelete => false,
                       :arguments => {'x-ha-policy' => 'all'})
queue.bind(exchange, :routing_key => "alert")
queue.subscribe(:ack => false) do |header, body|
? do stuff
end


Many thanks!

Chris


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/6b52062a/attachment.htm>

From emile at rabbitmq.com  Mon Aug 20 18:17:59 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Aug 2012 18:17:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 - Service Crash on Windows
 2008 R2
In-Reply-To: <A33D44D3C6F1D54AA679F7A3B0995E23237BF7AD@Nutdc.Nutcracker.local>
References: <A33D44D3C6F1D54AA679F7A3B0995E23237BF7AD@Nutdc.Nutcracker.local>
Message-ID: <50327147.4050609@rabbitmq.com>

Hi Ryan,

On 20/08/12 14:36, Ryan Gunn wrote:
> ** Reason for termination == 
> ** {accept_failed,enfile}

This is a POSIX error code meaning you have run out of file descriptors.
The errors that follow are a consequence of this. You should be able to
raise the limit by setting the ERL_MAX_PORTS variable. Make sure you
really need to open that many connections and that your application is
not leaking connections. I see that connections are accepted at an
alarming rate just before the error.


-Emile



From dharshanr at scalegrid.net  Mon Aug 20 19:08:07 2012
From: dharshanr at scalegrid.net (Dharshan Rangegowda)
Date: Mon, 20 Aug 2012 11:08:07 -0700
Subject: [rabbitmq-discuss] RabbitMQ configuration for Scaleout RPC setup
In-Reply-To: <503201FE.7090204@rabbitmq.com>
References: <250d5fdd-df71-49b2-b1d6-ce069457044b@googlegroups.com>
	<503201FE.7090204@rabbitmq.com>
Message-ID: <CAC3-Q1T+vF+GpB6m76noL+CheDOXLjRWcLOongGJoiEbxyi7Wg@mail.gmail.com>

Thanks Emile. This is great feedback. I will spend some more time on the
Access control rules to determine if they are sufficient for our scenario.

regards,
Dharshan
www.scalegrid.net
(Services for the private cloud)


On Mon, Aug 20, 2012 at 2:23 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 19/08/12 22:31, dharshanr wrote:
> > 1. A virtual host and user for every client. This way each client
> > connects to its virtual host using its own username password. Also if
> > one clients username/password gets compromised it wont affect the other
> > clients.
> > 2. One queue per virtual host called the "Client messaging queue". The
> > client waits for messages on this queue after connecting to the virtual
> host
> > 3. When the server wants to message a client it creates an unnamed queue
> > in the virtual host of the client (as the reply queue) and then posts
> > messages to the "Client messaging queue". The client processes the
> > message and replies back on the tagged reply queue.
>
> Your suggested solution will work, but it suffers from the weakness that
> the server will need to maintain a separate connection to the broker for
> each vhost. Using separate vhost provides good isolation, but you may be
> able to get away with less by careful use of access control rules:
>
> www.rabbitmq.com/access-control.html
>
> From your description clients never need to declare any resources. Being
> able to subscribe to a queue that is named is such a way that it
> contains their client id, and being able to publish to a
> server-generated queue is sufficient. You can set up access control
> rules that allow this.
>
> Bear in mind that clients have no way of learning the names of
> server-generated queues that were generated for other clients, and they
> are named in a cryptographically strong way. Therefore the vhost
> isolation is not strictly required to protect against inadvertent access.
>
>
> -Emile
>
>
>


-- 
regards,
Dharshan.
www.scalegrid.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/329624c1/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 20 19:27:01 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 20 Aug 2012 19:27:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 - Service Crash on Windows
 2008 R2
In-Reply-To: <50327147.4050609@rabbitmq.com>
References: <A33D44D3C6F1D54AA679F7A3B0995E23237BF7AD@Nutdc.Nutcracker.local>
	<50327147.4050609@rabbitmq.com>
Message-ID: <50328175.2000003@rabbitmq.com>

On 20/08/12 18:17, Emile Joubert wrote:
> On 20/08/12 14:36, Ryan Gunn wrote:
>> ** Reason for termination ==
>> ** {accept_failed,enfile}
>
> This is a POSIX error code meaning you have run out of file descriptors.
> The errors that follow are a consequence of this. You should be able to
> raise the limit by setting the ERL_MAX_PORTS variable. Make sure you
> really need to open that many connections and that your application is
> not leaking connections. I see that connections are accepted at an
> alarming rate just before the error.

Alas rabbit generally refuses to accept more connection when file 
descriptors are scarce. I wonder why this isn't happening here.

What limits are reported by 'rabbitmqctl status'?

Matthias.

From dbgreer at gmail.com  Mon Aug 20 19:29:36 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Mon, 20 Aug 2012 11:29:36 -0700 (PDT)
Subject: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
Message-ID: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>

There appears to be a deadlock if you attempt to dispose, close, or abort a 
channel within the context of an IConnection.ConnectionShutdown event. 
 Here's an example client that should demonstrate the issue:

RabbitService.cs (needs to run as admin to shut down the Windows service)
-------------------------
using System;
using System.ServiceProcess;

namespace Consumer
{
public class RabbitService
{
public void Restart()
{
var serviceController = new ServiceController("RabbitMQ", "localhost");
TimeSpan timeout = TimeSpan.FromMilliseconds(20000);
Console.WriteLine("  Stopping RabbitMQ service ...");
serviceController.Stop();
serviceController.WaitForStatus(ServiceControllerStatus.Stopped, timeout);
Console.WriteLine("  RabbitMQ service stopped.");
Console.WriteLine("  Starting RabbitMQ service ...");
serviceController.Start();
serviceController.WaitForStatus(ServiceControllerStatus.Running, timeout);
Console.WriteLine("  RabbitMQ service started.");
}

public void Start()
{
var serviceController = new ServiceController("RabbitMQ", "localhost");
TimeSpan timeout = TimeSpan.FromMilliseconds(20000);
Console.WriteLine("  Starting RabbitMQ service ...");
serviceController.Start();
serviceController.WaitForStatus(ServiceControllerStatus.Running, timeout);
Console.WriteLine("  RabbitMQ service started.");
}

public void Stop()
{
var serviceController = new ServiceController("RabbitMQ", "localhost");
TimeSpan timeout = TimeSpan.FromMilliseconds(20000);
Console.WriteLine("  Stopping RabbitMQ service ...");
serviceController.Stop();
serviceController.WaitForStatus(ServiceControllerStatus.Stopped, timeout);
Console.WriteLine("  RabbitMQ service stopped.");
}
}
}

ConsumerProgram.cs
--------------------------------
using System;
using System.Diagnostics;
using System.IO;
using System.Text;
using System.Threading;
using RabbitMQ.Client;
using RabbitMQ.Client.Events;

namespace Consumer
{
class Program
{
const string Id = "2BD27137-9AE3-4342-B4C3-9DEC20D203DF";
static Thread _thread;
static bool _threadCancelled;

static void Main(string[] args)
{
IConnection connection = new ConnectionFactory().CreateConnection();
connection.ConnectionShutdown += ConnectionShutdown;
SubscribeToQueue(connection);
Console.WriteLine("Press a key to restart the RabbitMQ service ...");
Console.ReadKey();
new RabbitService().Restart();
Console.WriteLine("Press a key to stop subscription ...");
Console.ReadKey();

if (connection.IsOpen)
{
connection.Close();
}
}

static void ConnectionShutdown(IConnection connection, ShutdownEventArgs 
reason)
{
Console.WriteLine("Connection was shut down");
Console.WriteLine("Sending the signal to cancel the thread ...");

// Setting _threadCancelled to true here causes a deadlock.
_threadCancelled = true;
_thread.Join();
}

static void SubscribeToQueue(IConnection connection)
{
_thread = new Thread(() =>
{
IModel channel = connection.CreateModel();

channel.ExchangeDeclare(Id, ExchangeType.Direct, false, true, null);
channel.QueueDeclare(Id, false, false, true, null);
channel.QueueBind(Id, Id, "");

var consumer = new QueueingBasicConsumer(channel);
channel.BasicConsume(Id, true, consumer);

while (true)
{
if (_threadCancelled)
{
Console.WriteLine("Received signal to cancel this thread.");
_threadCancelled = false;
break;
}

BasicDeliverEventArgs eventArgs = null;

try
{
object eArgs = null;
consumer.Queue.Dequeue(10, out eArgs);

if (eArgs != null)
{
eventArgs = (BasicDeliverEventArgs) eArgs;
string message = Encoding.UTF8.GetString(eventArgs.Body);
Console.WriteLine("Message: " + message);
}
}
catch (EndOfStreamException)
{
// Never happens
Console.WriteLine("Caught EndOfStreamException");
channel.Dispose();
channel = null;
break;
}
catch (Exception e)
{
Console.WriteLine("An exception occurred while dequeuing a message: " + 
e.Message, TraceEventType.Error);
}
}
if (channel != null && channel.IsOpen)
{
Console.WriteLine("Closing channel ...");
channel.Close(); // <- Never returns
Console.WriteLine("Channel closed.");
}

Console.WriteLine("End of thread execution.");
});

_thread.Start();
}
}
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/ab0fdca2/attachment.htm>

From dbgreer at gmail.com  Mon Aug 20 19:35:38 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Mon, 20 Aug 2012 11:35:38 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
Message-ID: <c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>

Hey, Micha.  This seems related to the issue I just reported here<https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/5nzeEqI5qxw>. 
 Are you calling dispose within the context of a ConnectionShutdown event 
callback?

On Friday, July 13, 2012 6:20:26 AM UTC-5, Micha wrote:
>
> Hello everybody,
>  
> when hosting the RabbitMQClient in a Winform and call .Dispose() and 
> subscribe to an Exchange my Winform hangs. After checking, I investigated 
> that the a call in ShutdownContinuation.Wait()  caused to hang in 
> BlockingCell.Value -> Monitor.Wait(this); and never returns.
> Can anybody help me to solve my problem. What can be the reason for this.
>  
> Thanks in advance.
>  
> Micha
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/0da52560/attachment.htm>

From tadw99 at googlemail.com  Mon Aug 20 20:59:01 2012
From: tadw99 at googlemail.com (Tom Wrigglesworth)
Date: Mon, 20 Aug 2012 20:59:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ Latency
In-Reply-To: <502D1BE7.2060607@rabbitmq.com>
References: <c22e38fa-9767-40eb-bc22-b558a147f1da@googlegroups.com>
	<502D1BE7.2060607@rabbitmq.com>
Message-ID: <CAEk0_N6NhZOUgW-2w-p76JE=LLiUwoFtYKjmHAp3HKRLj-3Cyw@mail.gmail.com>

Hi,

Thanks for your reply.


In the one the publisher can publish as fast as it likes (within the
> limits imposed by internal flow control in the broker) while with the
> other publishing and consuming messages happen in lockstep - that's why
> it's slower.
>

What do you mean by in lockstep?

On 16 August 2012 17:12, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 16/08/12 01:07, Tom Wrigg wrote:
> > The first method uses two separate processes - one for the publishing
> > app - one for the consuming app. It produces a latency of about at 4ms.
> > The second method uses just one app to produce and consume. This
> > produces a latency of about 40ms. Can anyone explain to me why? Thank
> > you for your time.
>
> In the one the publisher can publish as fast as it likes (within the
> limits imposed by internal flow control in the broker) while with the
> other publishing and consuming messages happen in lockstep - that's why
> it's slower.
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/eecf4094/attachment.htm>

From emile at rabbitmq.com  Mon Aug 20 22:09:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Aug 2012 22:09:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ Latency
In-Reply-To: <CAEk0_N6NhZOUgW-2w-p76JE=LLiUwoFtYKjmHAp3HKRLj-3Cyw@mail.gmail.com>
References: <c22e38fa-9767-40eb-bc22-b558a147f1da@googlegroups.com>
	<502D1BE7.2060607@rabbitmq.com>
	<CAEk0_N6NhZOUgW-2w-p76JE=LLiUwoFtYKjmHAp3HKRLj-3Cyw@mail.gmail.com>
Message-ID: <5032A76D.8040704@rabbitmq.com>

Hi Tom,

On 20/08/12 20:59, Tom Wrigglesworth wrote:
>     In the one the publisher can publish as fast as it likes (within the
>     limits imposed by internal flow control in the broker) while with the
>     other publishing and consuming messages happen in lockstep - that's why
>     it's slower.
> 
> 
> What do you mean by in lockstep?

That the total number of messages sent and received differ by at most 1.


-Emile


From matthias at rabbitmq.com  Mon Aug 20 22:53:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 20 Aug 2012 22:53:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ Latency
In-Reply-To: <5032A76D.8040704@rabbitmq.com>
References: <c22e38fa-9767-40eb-bc22-b558a147f1da@googlegroups.com>
	<502D1BE7.2060607@rabbitmq.com>
	<CAEk0_N6NhZOUgW-2w-p76JE=LLiUwoFtYKjmHAp3HKRLj-3Cyw@mail.gmail.com>
	<5032A76D.8040704@rabbitmq.com>
Message-ID: <5032B1CD.7080901@rabbitmq.com>

On 20/08/12 22:09, Emile Joubert wrote:
> On 20/08/12 20:59, Tom Wrigglesworth wrote:
>>      In the one the publisher can publish as fast as it likes (within the
>>      limits imposed by internal flow control in the broker) while with the
>>      other publishing and consuming messages happen in lockstep - that's why
>>      it's slower.
>>
>> What do you mean by in lockstep?
>
> That the total number of messages sent and received differ by at most 1.

How so? In both examples the producer sends a message every 500ms, 
modulo node.js scheduler delays.

The wireshark trace Tom submitted in another thread clearly shows a 40ms 
delay from the 'publish' going out to the 'deliver' coming back. And 
I've reproduced the same result on my machine.

Looking at the trace in more detail though, I can see that the delay is 
happening solely on the sending side - between the tcp packet containing 
the basic.publish frame and the packet containing the content-header and 
content-body frames.

Running a similar example with our Java client, all three frames 
belonging to a publish get transmitted in a single tcp packet. And the 
basic.deliver comes back 0.3ms later.

The difference could be down to Nagle (the Java client disables it by 
default; no idea what node-amqp does) or buffer flushing (the Java 
client flushes output buffers after complete commands, i.e. at the end 
of the three frames in case of a short basic.publish; no idea what 
node-amqp does), or some node-amqp/node.js weirdness.

Tom, I suggest you contact the node-amqp authors and/or file a bug.

Regards,

Matthias.

From dharshanr at scalegrid.net  Mon Aug 20 23:07:03 2012
From: dharshanr at scalegrid.net (dharshanr)
Date: Mon, 20 Aug 2012 15:07:03 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ management plugin does not display
	message stats
Message-ID: <658e12c1-0885-43f9-9633-cbd134be2ebe@googlegroups.com>

I am using the RabbitMQ management plugin to monitor some stats on the 
server and I noticed that the Messaging stats (Total/Ready/Acknowledged) 
are not being displayed. I can see the other node stats like file 
description/memory usage etc.  Do I need to do some other configuration to 
get this data? I have uploaded a screenshot.

Also is there a way to get this data from rabbitmqctl? This way I don't 
have to use the UI.

regards,
Dharshan
www.scalegrid.net
(Services for the private cloud)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/4606ea1f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq.png
Type: image/png
Size: 16323 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/4606ea1f/attachment.png>

From fredbasset1000 at gmail.com  Tue Aug 21 00:46:46 2012
From: fredbasset1000 at gmail.com (fred basset)
Date: Mon, 20 Aug 2012 16:46:46 -0700
Subject: [rabbitmq-discuss] Problem transferring large message
Message-ID: <CAE-zcqUy84G2_7EANsaTOWjKkKqi1OL4ywMeahJe_ao8YBT45A@mail.gmail.com>

Hi All,

I have a simple producer and consumer based on the hello world
example.  My code works for small messages (sending a 64 byte log
file), but for larger messages (a 53KB log file) the receiver never
seems to get the message.  I am using all the defaults and am on
Ubuntu server using the Pika library.  Any clues as to what could be
wrong?

send.py:
#!/usr/bin/env python
import pika
import json
import sys

filename = sys.argv[1]
logdata = open(filename, 'r').read()

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='66.175.x.x'))
channel = connection.channel()

channel.queue_declare(queue='logupload')
n = filename.rfind('\\')
if n != -1:
    filename = filename[n + 1:]
data = {"filename":filename, "logdata":logdata}

channel.basic_publish(exchange='',
                      routing_key='logupload',
                      body=json.dumps(data))
connection.close()
print "sent %s %d bytes" % (filename, len(logdata))

receive.py:
#!/usr/bin/env python
import pika
import json

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='66.175.x.x))
channel = connection.channel()

channel.queue_declare(queue='logupload')

print ' [*] Waiting for messages. To exit press CTRL+C'

def callback(ch, method, properties, body):
    data = json.loads(body)
    fname = "logs/x14/" + data["filename"]
    logfile = open(fname, "w")
    logfile.write(data["logdata"])
    logfile.close()
    print "Wrote " + fname

channel.basic_consume(callback,
                      queue='logupload',
                      no_ack=True)

channel.start_consuming()

From ryan at nutcracker.co.za  Tue Aug 21 06:26:46 2012
From: ryan at nutcracker.co.za (Icidis)
Date: Mon, 20 Aug 2012 22:26:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 - Service Crash on Windows
	2008 R2
In-Reply-To: <50328175.2000003@rabbitmq.com>
References: <A33D44D3C6F1D54AA679F7A3B0995E23237BF7AD@Nutdc.Nutcracker.local>
	<50327147.4050609@rabbitmq.com> <50328175.2000003@rabbitmq.com>
Message-ID: <1345526806284-21529.post@n5.nabble.com>


Matthias Radestock-3 wrote
> 
> On 20/08/12 18:17, Emile Joubert wrote:
>> On 20/08/12 14:36, Ryan Gunn wrote:
>>> ** Reason for termination ==
>>> ** {accept_failed,enfile}
>>
>> This is a POSIX error code meaning you have run out of file descriptors.
>> The errors that follow are a consequence of this. You should be able to
>> raise the limit by setting the ERL_MAX_PORTS variable. Make sure you
>> really need to open that many connections and that your application is
>> not leaking connections. I see that connections are accepted at an
>> alarming rate just before the error.
> 
> Alas rabbit generally refuses to accept more connection when file 
> descriptors are scarce. I wonder why this isn't happening here.
> 
> What limits are reported by 'rabbitmqctl status'?
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at .rabbitmq
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

Good Day Emile & Matthias,

I've attached the rabbitmqctl status report, I will go through all my
application logs to see if any are leaking connections.

http://rabbitmq.1065348.n5.nabble.com/file/n21529/RabbitMQ_Limits.txt
RabbitMQ_Limits.txt 

Thanks for all your help

Ryan Gunn




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-2-8-2-Service-Crash-on-Windows-2008-R2-tp21512p21529.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From rev.chip at gmail.com  Tue Aug 21 07:12:06 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Mon, 20 Aug 2012 23:12:06 -0700
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Verdict
Message-ID: <CANSL5VFOrb0aepwK+R-BvUz1g1KQvtPW5-jnhXJGKUpUeWqLAw@mail.gmail.com>

In a very large prod environment, we have downgraded to 2.7.1 to
escape the flow control misfeature.  It's just not sane.

We are considering more drastic options going forward.

Please give us a flow control switch to turn off.  We just don't want it.

From simon at rabbitmq.com  Tue Aug 21 10:38:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Aug 2012 10:38:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ management plugin does not display
 message stats
In-Reply-To: <658e12c1-0885-43f9-9633-cbd134be2ebe@googlegroups.com>
References: <658e12c1-0885-43f9-9633-cbd134be2ebe@googlegroups.com>
Message-ID: <50335729.5030408@rabbitmq.com>

On 20/08/12 23:07, dharshanr wrote:
> I am using the RabbitMQ management plugin to monitor some stats on the
> server and I noticed that the Messaging stats (Total/Ready/Acknowledged)
> are not being displayed. I can see the other node stats like file
> description/memory usage etc. Do I need to do some other configuration
> to get this data? I have uploaded a screenshot.

This should be the total number of queued messages on your server - do 
you actually have any queued messages?

> Also is there a way to get this data from rabbitmqctl? This way I don't
> have to use the UI.

You can't get the global total, but you can invoke "rabbitmqctl 
list_queues name messages_ready messages_unacknowledged messages" and 
sum it yourself. Or use the HTTP API.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ernest.staszuk at comarch.pl  Tue Aug 21 10:59:21 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Tue, 21 Aug 2012 11:59:21 +0200
Subject: [rabbitmq-discuss] RabbitMQ Dead Letter Routing
In-Reply-To: <f17aad39-8e78-4ce2-9409-b599917ba28e@googlegroups.com>
References: <f17aad39-8e78-4ce2-9409-b599917ba28e@googlegroups.com>
Message-ID: <50335BF9.5080208@comarch.pl>

You could bind your reply queue to the dead-letter exchange and you should
receive it back. Unfortunately, this approach does not distinguish 
producers
and as consequence of this sends also messages that did not refer only to
particular senders. You could get around this by using parts of routing 
keys
dependent on who sent the message in the first place.

Regards,
Ernest Staszuk

W dniu 2012-08-16 11:17, Paul pisze:
>
> Hello,
>
> I am hoping someone can help me out on this issue.
>
> I have got a typical setup of a async consumer, consuming from a 
> Queue, and a async producer (with a reply_to queue set) producing to 
> an exchange.
>
> I am facing the challenge of working with Dead Letter Queues and TTL.
>
> In a nutshell the producer needs a ways to determine if his/her 
> message ended up dead (in the event the consumer is too slow or not 
> "alive"). So this is what I have come up with but am struggling to 
> implement it (it might be impossible).
>
> Producer produces the message (with a reply_to property) -> Rabbit 
> Expires the message based on the TTL -> sends the message to a dead 
> letter exchange -> the exchange routes the message to the reply_to 
> queue property on that message -> the producer now consumers from that 
> queue (the reply_to queue).
>
> Question... "the exchange routes the message to the reply_to queue 
> property on that message"... is this possible and how?
>
> Any other suggestions on implementation or design which would meet my 
> criteria would be greatly appreciated.
>
> Thanks!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120821/f5bace5c/attachment.htm>

From simon at rabbitmq.com  Tue Aug 21 11:42:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Aug 2012 11:42:46 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Verdict
In-Reply-To: <CANSL5VFOrb0aepwK+R-BvUz1g1KQvtPW5-jnhXJGKUpUeWqLAw@mail.gmail.com>
References: <CANSL5VFOrb0aepwK+R-BvUz1g1KQvtPW5-jnhXJGKUpUeWqLAw@mail.gmail.com>
Message-ID: <50336626.9040808@rabbitmq.com>

On 21/08/12 07:12, Chip Salzenberg wrote:
> In a very large prod environment, we have downgraded to 2.7.1 to
> escape the flow control misfeature.  It's just not sane.
>
> We are considering more drastic options going forward.
>
> Please give us a flow control switch to turn off.  We just don't want it.

Hi Chip. Please don't think us unresponsive to your concerns, but:

When we last spoke about this, there was some unfortunate prioritisation 
going on in the queue process which led to queues staying empty when 
there were large numbers of consumers combined with a low prefetch 
count. This was fixed in 2.8.3. So for your situation:

2.7.1     -> messages queue up in the channel process in the server
2.8.{012} -> producers frequently block
2.8.3+    -> messages queue up in the queue, where they belong

Did you end up trying 2.8.3 or later? If you had problems with flow 
control on 2.8.3 or later then I am very interested in hearing about 
them - flow control should only come on when you are publishing faster 
than RabbitMQ can really accept messages; to turn it off would lead to 
memory use rapidly reaching for the sky in these scenarios.

So I'm reluctant to provide a switch to turn it off since I'm not 
convinced there are situations where this would be useful. I could be 
convinced, of course, but I haven't yet seen a good reason.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Aug 21 11:49:07 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 21 Aug 2012 11:49:07 +0100
Subject: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
Message-ID: <503367A3.5060107@rabbitmq.com>

Hi Derek,

On 20/08/12 19:29, Derek Greer wrote:
> There appears to be a deadlock if you attempt to dispose, close, or
> abort a channel within the context of an IConnection.ConnectionShutdown
> event.

Instead of deadlock I get an IO exception. An attempt to close the
channel requires network access, but it is no longer possible for the
channel to communicate over the network.

System.IO.IOException:
 Unable to write data to the transport connection:
 An existing connection was forcibly closed by the remote host.
System.Net.Sockets.SocketException:
 An existing connection was forcibly closed by the remote host

> if (channel != null && channel.IsOpen)
> {
> Console.WriteLine("Closing channel ...");
> channel.Close(); // <- Never returns
> Console.WriteLine("Channel closed.");
> }

This code is flawed, because the state of the channel could change
between the query and the action. There is no need to explicitly shut
down the channel when the connection shuts down as this will be done by
the library. Parties can register their interest in channel shutdown
using IModel.ModelShutdown.


-Emile


From francesco at rabbitmq.com  Tue Aug 21 12:11:14 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 21 Aug 2012 12:11:14 +0100
Subject: [rabbitmq-discuss] Exchange/queue setup question
In-Reply-To: <CC57D9D2.1F9D1%wchrisjohnson@gmail.com>
References: <CC57D9D2.1F9D1%wchrisjohnson@gmail.com>
Message-ID: <87wr0slctp.wl%francesco@rabbitmq.com>

Hi Chris,

At Mon, 20 Aug 2012 12:10:58 -0400,
Chris Johnson wrote:
> I need a second pair of eyes on a small RMQ app I'm working on.
> I suspect the issue I'm seeing is related to how I am defining my exchanges
> and queues.
> 
> If I connect with two clients, I'll see every other message appear on my
> client. If I connect with three clients, I see every third message, and so on.
> In other words, it appears to 1) be deleting every message that gets produced
> on consumption, and 2) round robins which consumer gets each message.
> 
> What I want to see is all clients get the same message each time one is
> posted.
> 
> Is a topic approach the best approach for this, or is fanout the better way to
> handle this?

Rabbit will deliver each message to one consumer only.  So the solution to this
problem is to use multiple queues, possibly with a fanout exchange.

> Here's the specifics of how my producer and consumer is set up:
> 
> PRODUCER (client=bunny)
> =====================
> 
> @topic_exchange ||= client.exchange("internal.platformalert", :type => :topic,
>                                     :durable => true, :autodelete => false)
> @queue ||= client.queue("internal.platformalert.#", :durable => true,
>                         :autodelete => false, :arguments => {'x-ha-policy' => 'all'})
> queue.bind(e, :key => "alert")
> exchange.publish(message, :key => "alert", :persistent => true)                        

I think you're confused about how exchanges work.  You seem to be using the
queue name to match topics, while that's not how exchanges work (the binding
defines that). See the tutorial:
<http://www.rabbitmq.com/tutorials/tutorial-five-python.html>.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Tue Aug 21 12:27:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 21 Aug 2012 12:27:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ - Service Crash
In-Reply-To: <A33D44D3C6F1D54AA679F7A3B0995E23237BA566@Nutdc.Nutcracker.local>
References: <A33D44D3C6F1D54AA679F7A3B0995E23237BA566@Nutdc.Nutcracker.local>
Message-ID: <503370AF.1070500@rabbitmq.com>

Hi Ryan,

On 14/08/12 06:45, Ryan Gunn wrote:
> =ERROR REPORT==== 13-Aug-2012::12:03:38 ===
> Mnesia(rabbit at SERVER001): ** ERROR ** (could not write core file: system_limit)

Your subsequent report with ENFILE errors has answered this question.
Running out of file descriptors is the most likely root cause of the
system_limit error here too.


-Emile




From dbgreer at gmail.com  Tue Aug 21 15:10:43 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Tue, 21 Aug 2012 09:10:43 -0500
Subject: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <503367A3.5060107@rabbitmq.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
Message-ID: <CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>

My apologizes, I should have included the version number.  I see this
behavior using version 2.8.4 from NuGet.  Perhaps you're testing with a
different version?  The issue appears to be related to the use of the
BlockingCell class used as part of the ShutdownContinuation.

Concerning the example, you're correct that this example poses a race
condition and should be using a try/catch rather than checking for
IsOpen().  That aside, there should never be a case when a client of the
.Net rabbitmq client should be able to call .Close() and cause the API to
block indefinitely.

I appreciate your pointing me to the use of the IModel.ModelShutdown.  I
would have thought that event would be raised any time the model was closed
rather than being raised exclusively due to a connection shutdown.  I'll
use that if I have to, but wouldn't you agree that clients of the API
should be able to subscribe to the IConnection.ConnectionShutdown event to
be alerted to connection shutdowns?

On Tue, Aug 21, 2012 at 5:49 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Derek,
>
> On 20/08/12 19:29, Derek Greer wrote:
> > There appears to be a deadlock if you attempt to dispose, close, or
> > abort a channel within the context of an IConnection.ConnectionShutdown
> > event.
>
> Instead of deadlock I get an IO exception. An attempt to close the
> channel requires network access, but it is no longer possible for the
> channel to communicate over the network.
>
> System.IO.IOException:
>  Unable to write data to the transport connection:
>  An existing connection was forcibly closed by the remote host.
> System.Net.Sockets.SocketException:
>  An existing connection was forcibly closed by the remote host
>
> > if (channel != null && channel.IsOpen)
> > {
> > Console.WriteLine("Closing channel ...");
> > channel.Close(); // <- Never returns
> > Console.WriteLine("Channel closed.");
> > }
>
> This code is flawed, because the state of the channel could change
> between the query and the action. There is no need to explicitly shut
> down the channel when the connection shuts down as this will be done by
> the library. Parties can register their interest in channel shutdown
> using IModel.ModelShutdown.
>
>
> -Emile
>
>


-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120821/8e679c41/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 21 15:15:51 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 21 Aug 2012 15:15:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 - Service Crash on Windows
 2008 R2
In-Reply-To: <1345526806284-21529.post@n5.nabble.com>
References: <A33D44D3C6F1D54AA679F7A3B0995E23237BF7AD@Nutdc.Nutcracker.local>
	<50327147.4050609@rabbitmq.com> <50328175.2000003@rabbitmq.com>
	<1345526806284-21529.post@n5.nabble.com>
Message-ID: <50339817.5050807@rabbitmq.com>

Ryan,

On 21/08/12 06:26, Icidis wrote:
> I've attached the rabbitmqctl status report

Those limits look sane. However, I do notice that you are running an old 
version of Erlang, and in particular a 32-bit version. I suggest you 
upgrade to the 64-bit Windows version of R15B01. Might as well update 
rabbit at the same time.

I doubt the upgrades will fix the problem, but they are worth a try and 
make it easier for us to investigate further.

Also, since you are running the management plug-in, I suggest you keep 
and eye on file descriptor and socket descriptor counts reported there. 
In particular it would be interesting to see whether when the 'used' 
counts get near the limit there is any discrepancy between those counts 
and those reported by 'rabbitmqctl status'.

Regards,

Matthias.

From Sharon.Ben-Asher at AVG.com  Tue Aug 21 15:27:55 2012
From: Sharon.Ben-Asher at AVG.com (sharonbn)
Date: Tue, 21 Aug 2012 07:27:55 -0700 (PDT)
Subject: [rabbitmq-discuss] How many queues can one broker support
Message-ID: <1345559275707-21539.post@n5.nabble.com>

Hello,

I am investigating using RabbitMQ and AMQP to push notifications from our
web app to client apps on Android devices.

In our case, we have few publishers and many consumers (millions, perhaps
~10M), all connected to the broker and ready to consume messages.
every now and then, the publisher needs to send one message to one and only
one consumer.
each consumer will receive few dozens of messages daily. Message
acknowledgements is not mandatory.
btw, the broker (or cluster?) will be hosted on AWS EC2 instances.

I was wondering if there are any limitations on number of connected
consumers and what's the best strategy to implement such a scenario.  From
the documentation, it seems to me there are two ways to do this:

first of all, each client app already reports a unique identifier to the web
app (this is done prior to any message sending).  this unique id, known on
both sides, can be used to ensure routing of the message to the specific
client.

1) The most obvious way is to have one direct-exchange and create an
exclusive queue per consumer with the unique id as the queue name.  this
means there will be millions of queues that are most of the time empty or
nearly empty.

2) Have one topic-exchange with (how many?) queues.  the unique id will be
used as topic name.  Here we have millions of topic names.

which is the best solutions (or perhaps a third option)?  any other
considerations in this use case?  any special configuration/settings? any
help is appreciated :)

thanks,

Sharon.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-many-queues-can-one-broker-support-tp21539.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue Aug 21 15:38:44 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 21 Aug 2012 15:38:44 +0100
Subject: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
Message-ID: <50339D74.9080305@rabbitmq.com>

Hi Derek,

On 21/08/12 15:10, Derek Greer wrote:
> My apologizes, I should have included the version number.  I see this
> behavior using version 2.8.4 from NuGet.  Perhaps you're testing with a
> different version? 

I tested with the latest version, but there have been no changes in that
area since 2.8.4.

> That aside, there should never be a case when a client of the
> .Net rabbitmq client should be able to call .Close() and cause the API
> to block indefinitely.

I'm not able to reproduce the deadlock, as I said, I see an exception
(see attached).

> I appreciate your pointing me to the use of the IModel.ModelShutdown.  I
> would have thought that event would be raised any time the model was
> closed rather than being raised exclusively due to a connection
> shutdown.  I'll use that if I have to, but wouldn't you agree that
> clients of the API should be able to subscribe to the
> IConnection.ConnectionShutdown event to be alerted to connection
> shutdowns?  

Yes, ModelShutdown is raised when the channel shuts down for any reason,
including due to a network interruption. Clients that need notification
of the network connection shutting down should subscribe to
ConnectionShutdown, as your example illustrates. The library also
includes an example (RabbitMQ.Client.Examples.ExceptionTest) that shows
how to go about this.

What is the problem you are trying to solve that the alleged deadlock is
preventing you from solving? If the problem is to ensure that channels
are closed when connections shut down, then you don't need to do that,
since the library already takes care of it.

-Emile

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Exception.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120821/d3b00c76/attachment.txt>

From dbgreer at gmail.com  Tue Aug 21 16:38:36 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Tue, 21 Aug 2012 10:38:36 -0500
Subject: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <50339D74.9080305@rabbitmq.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
	<50339D74.9080305@rabbitmq.com>
Message-ID: <CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>

I'm trying to deal with connection shutdown logic as an atomic operation.
 Here's the scenario I'm trying to implement:

   - An application has 25 subscriptions to different queues on different
   threads
   - The rabbitmq Windows service is restarted
   - The application detects a connection shutdown has occurred and
   performs the following actions:
      - re-establish the connection once available
      - refresh each subscription with the new connection


The problem with using ModelShutdown rather than ConnectionShutdown to
detect connectoin shutdowns (aside from the obvious reason) is that it
doesn't really allow a client to deal with connection shutdown logic
atomically.  Thinking through what I'd need to do to use ModelShutdown for
this scenario seems convoluted at best.  My particular design issues aside,
don't you agree that ConnectionShutdown should be the event you should
subscribe to when you want to know about connection shutdowns?

As far as the blocking, I'm perplexed as to why we wouldn't be seeing the
same results.  Obviously, having someone on your team be able to reproduce
the issue is key to getting it fixed.  To make sure we're actually using
the same bits, I've uploaded the project I'm testing with to
http://aspiringcraftsman.com/downloads/rabbitmq/.  If you wouldn't mind,
please try with this and see if you get the same results.  I'm assuming you
don't have the API installed into your GAC.


Derek

On Tue, Aug 21, 2012 at 9:38 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Derek,
>
> On 21/08/12 15:10, Derek Greer wrote:
> > My apologizes, I should have included the version number.  I see this
> > behavior using version 2.8.4 from NuGet.  Perhaps you're testing with a
> > different version?
>
> I tested with the latest version, but there have been no changes in that
> area since 2.8.4.
>
> > That aside, there should never be a case when a client of the
> > .Net rabbitmq client should be able to call .Close() and cause the API
> > to block indefinitely.
>
> I'm not able to reproduce the deadlock, as I said, I see an exception
> (see attached).
>
> > I appreciate your pointing me to the use of the IModel.ModelShutdown.  I
> > would have thought that event would be raised any time the model was
> > closed rather than being raised exclusively due to a connection
> > shutdown.  I'll use that if I have to, but wouldn't you agree that
> > clients of the API should be able to subscribe to the
> > IConnection.ConnectionShutdown event to be alerted to connection
> > shutdowns?
>
> Yes, ModelShutdown is raised when the channel shuts down for any reason,
> including due to a network interruption. Clients that need notification
> of the network connection shutting down should subscribe to
> ConnectionShutdown, as your example illustrates. The library also
> includes an example (RabbitMQ.Client.Examples.ExceptionTest) that shows
> how to go about this.
>
> What is the problem you are trying to solve that the alleged deadlock is
> preventing you from solving? If the problem is to ensure that channels
> are closed when connections shut down, then you don't need to do that,
> since the library already takes care of it.
>
> -Emile
>
>


-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120821/27c84c75/attachment.htm>

From eliao at seegrid.com  Tue Aug 21 16:45:57 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Tue, 21 Aug 2012 15:45:57 +0000
Subject: [rabbitmq-discuss] Shovel terminated status
Message-ID: <E94F626F5C43D14F8B8479C5EBD790388A7DC549@vmexchange02.seegrid.local>

Hi,

I've been doing some tests with shovel to understand it better and I have a couple questions about the termination state. 

My setup:
I'm using RabbitMQ 2.8.2 with the configuration file at https://gist.github.com/3360344#.  Additionally, I'm forcing shovel into the terminated state by declaring BroadcastExchange as a fanout exchange instead of a topic exchange.  The terminated shovel status (from the last shovel) is as follows:
{shovel3,
     {terminated,
         {{shutdown,
              {server_initiated_close,406,
                  <<"PRECONDITION_FAILED - cannot redeclare exchange 'BroadcastExchange' in vhost '/' with different type, durable, internal or autodelete value">>}},
          {gen_server,call,
              [<4888.2466.1>,
               {call,
                   {'exchange.declare',0,<<"BroadcastExchange">>,
                       <<"topic">>,false,true,false,false,false,[]},
                   none,<4888.2457.1>},
               infinity]}}},
     {{2012,8,21},{11,11,32}}}]


Questions:
In the documentation, it states that the timestamp from  $ rabbitmqctl eval 'rabbit_shovel_status:status().' is the time when shovel entered the state.  I've observed this for the running and starting state but not for the terminated state.  The timestamp for the terminated state appears to be the current time.  Does this have to do with the specific way I'm setting up the termination condition?  Additionally, it seems when a shovel is in the terminated state and periodically trying to reconnect, there are many connections left open with no active channels.  Is this from the shovel connection attempts?  How can I avoid this?

Thanks!

Liz

From emile at rabbitmq.com  Tue Aug 21 17:13:04 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 21 Aug 2012 17:13:04 +0100
Subject: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
	<50339D74.9080305@rabbitmq.com>
	<CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>
Message-ID: <5033B390.3060105@rabbitmq.com>

Hi Derek,

On 21/08/12 16:38, Derek Greer wrote:
> I'm trying to deal with connection shutdown logic as an atomic
> operation.  Here's the scenario I'm trying to implement:

I hesitate to mention it, because this library has been deprecated but
not yet completely removed:
http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/

In it you will find an example of how one might go about reconnecting to
a broker. Be warned that this code will be removed soon and is not
guaranteed to work with recent versions of the broker.

>       o refresh each subscription with the new connection

It is not possible to maintain the previous subscription to the broker
and somehow inject a new channel and/or connection into it. You will
need to re-establish all contained channels and all associated
subscriptions when the connection shuts down.

> aside, don't you agree that ConnectionShutdown should be the event you
> should subscribe to when you want to know about connection shutdowns?

Yes.

> As far as the blocking, I'm perplexed as to why we wouldn't be seeing
> the same results.

When I run your Consumer.exe  standalone I also get the same exception
as before.



-Emile



From simon at rabbitmq.com  Tue Aug 21 17:16:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Aug 2012 17:16:47 +0100
Subject: [rabbitmq-discuss] How many queues can one broker support
In-Reply-To: <1345559275707-21539.post@n5.nabble.com>
References: <1345559275707-21539.post@n5.nabble.com>
Message-ID: <5033B46F.6000004@rabbitmq.com>

Hi Sharon.

There isn't a hard coded limit of course, but ~10M queues sounds 
optimistic, especially if combined with ~10M TCP connections.

I don't think 1) and 2) are all that different. Unless you need the 
wildcard matching of a topic exchange you might as well pick a direct 
exchange.

But in both cases you have millions of connections / consumers / queues. 
That *is* quite a lot to support on one machine. Are all these consumers 
going to connect simultaneously? You may have trouble raising the fd 
limit that high.

Also each connection / consumer / queue will take a few kb of memory 
even when idle - so that could eat up quite a few GB before you do anything.

My gut feeling is that supporting that many simultaneous connections 
will be a problem before the raw number of queues is.

Cheers, Simon

On 21/08/12 15:27, sharonbn wrote:
> Hello,
>
> I am investigating using RabbitMQ and AMQP to push notifications from our
> web app to client apps on Android devices.
>
> In our case, we have few publishers and many consumers (millions, perhaps
> ~10M), all connected to the broker and ready to consume messages.
> every now and then, the publisher needs to send one message to one and only
> one consumer.
> each consumer will receive few dozens of messages daily. Message
> acknowledgements is not mandatory.
> btw, the broker (or cluster?) will be hosted on AWS EC2 instances.
>
> I was wondering if there are any limitations on number of connected
> consumers and what's the best strategy to implement such a scenario.  From
> the documentation, it seems to me there are two ways to do this:
>
> first of all, each client app already reports a unique identifier to the web
> app (this is done prior to any message sending).  this unique id, known on
> both sides, can be used to ensure routing of the message to the specific
> client.
>
> 1) The most obvious way is to have one direct-exchange and create an
> exclusive queue per consumer with the unique id as the queue name.  this
> means there will be millions of queues that are most of the time empty or
> nearly empty.
>
> 2) Have one topic-exchange with (how many?) queues.  the unique id will be
> used as topic name.  Here we have millions of topic names.
>
> which is the best solutions (or perhaps a third option)?  any other
> considerations in this use case?  any special configuration/settings? any
> help is appreciated :)
>
> thanks,
>
> Sharon.
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-many-queues-can-one-broker-support-tp21539.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From alan.antonuk at gmail.com  Tue Aug 21 20:49:56 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 21 Aug 2012 15:49:56 -0400
Subject: [rabbitmq-discuss] AMQP Protocol: Basic.Publish when producer is
	throttled
Message-ID: <CAAt2po+NOPDv3r6QtaH_0-gmNj5KN1QCpGTX276gKKdy8bjU7A@mail.gmail.com>

I have an AMQP Protocol question:

When the broker throttles a client due to a low-disk-space condition on the
broker, what should a client expect when it sends a basic.publish method
and payload?

Restated: what does the client see from a protocol level when the client is
throttled?

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120821/a4235248/attachment.htm>

From brett.r.cameron at gmail.com  Tue Aug 21 23:15:39 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 22 Aug 2012 10:15:39 +1200
Subject: [rabbitmq-discuss] How many queues can one broker support
In-Reply-To: <5033B46F.6000004@rabbitmq.com>
References: <1345559275707-21539.post@n5.nabble.com>
	<5033B46F.6000004@rabbitmq.com>
Message-ID: <CALPqkio7B5s2-0jkXzvRSgCKoH+cfTWEpLane-pCGt98yWYvcg@mail.gmail.com>

Sharon,

Further to Simon's comments, each connection will consume ~66K memory and
each connection also creates 8 Erlang processes (or thereabouts), so you'd
need to factor in this memory usage and ensure that Erlang is able to spin
up the required number of processes. You'd obviously also need to tweak a
few system parameters to allow that many connections/sockets - all quite
doable of course, but I'd concur with Simon that unless you have a pretty
grunty server you could face some challenges. That being said, Erlang (and
by inference RabbitMQ) can certainly handle this sort of thing... you might
like to have a look at http://www.youtube.com/watch?v=wDk6l3tPBuw.

Brett


On Wed, Aug 22, 2012 at 4:16 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Sharon.
>
> There isn't a hard coded limit of course, but ~10M queues sounds
> optimistic, especially if combined with ~10M TCP connections.
>
> I don't think 1) and 2) are all that different. Unless you need the
> wildcard matching of a topic exchange you might as well pick a direct
> exchange.
>
> But in both cases you have millions of connections / consumers / queues.
> That *is* quite a lot to support on one machine. Are all these consumers
> going to connect simultaneously? You may have trouble raising the fd limit
> that high.
>
> Also each connection / consumer / queue will take a few kb of memory even
> when idle - so that could eat up quite a few GB before you do anything.
>
> My gut feeling is that supporting that many simultaneous connections will
> be a problem before the raw number of queues is.
>
> Cheers, Simon
>
>
> On 21/08/12 15:27, sharonbn wrote:
>
>> Hello,
>>
>> I am investigating using RabbitMQ and AMQP to push notifications from our
>> web app to client apps on Android devices.
>>
>> In our case, we have few publishers and many consumers (millions, perhaps
>> ~10M), all connected to the broker and ready to consume messages.
>> every now and then, the publisher needs to send one message to one and
>> only
>> one consumer.
>> each consumer will receive few dozens of messages daily. Message
>> acknowledgements is not mandatory.
>> btw, the broker (or cluster?) will be hosted on AWS EC2 instances.
>>
>> I was wondering if there are any limitations on number of connected
>> consumers and what's the best strategy to implement such a scenario.  From
>> the documentation, it seems to me there are two ways to do this:
>>
>> first of all, each client app already reports a unique identifier to the
>> web
>> app (this is done prior to any message sending).  this unique id, known on
>> both sides, can be used to ensure routing of the message to the specific
>> client.
>>
>> 1) The most obvious way is to have one direct-exchange and create an
>> exclusive queue per consumer with the unique id as the queue name.  this
>> means there will be millions of queues that are most of the time empty or
>> nearly empty.
>>
>> 2) Have one topic-exchange with (how many?) queues.  the unique id will be
>> used as topic name.  Here we have millions of topic names.
>>
>> which is the best solutions (or perhaps a third option)?  any other
>> considerations in this use case?  any special configuration/settings? any
>> help is appreciated :)
>>
>> thanks,
>>
>> Sharon.
>>
>>
>>
>> --
>> View this message in context: http://rabbitmq.1065348.n5.**
>> nabble.com/How-many-queues-**can-one-broker-support-**tp21539.html<http://rabbitmq.1065348.n5.nabble.com/How-many-queues-can-one-broker-support-tp21539.html>
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/cce46501/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 21 23:46:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 21 Aug 2012 23:46:48 +0100
Subject: [rabbitmq-discuss] AMQP Protocol: Basic.Publish when producer
 is throttled
In-Reply-To: <CAAt2po+NOPDv3r6QtaH_0-gmNj5KN1QCpGTX276gKKdy8bjU7A@mail.gmail.com>
References: <CAAt2po+NOPDv3r6QtaH_0-gmNj5KN1QCpGTX276gKKdy8bjU7A@mail.gmail.com>
Message-ID: <50340FD8.2070709@rabbitmq.com>

Alan,

On 21/08/12 20:49, Alan Antonuk wrote:
> I have an AMQP Protocol question:
>
> When the broker throttles a client due to a low-disk-space condition on
> the broker, what should a client expect when it sends a basic.publish
> method and payload?
>
> Restated: what does the client see from a protocol level when the client
> is throttled?

The server throttles connections by stopping to read from the socket. 
The effect is the same as just reading more slowly, or that of a slow / 
disrupted network.

If the condition lasts for a short duration only then there may be no 
observable effects at the client at all since buffering in the network 
stack / network can compensate.

If the condition persists then eventually the buffers fill up. How that 
manifests in the APIs depends on the client. Usually it's just a longer 
(or, in the extreme, indefinite) execution time for basicPublish method. 
Or in some async APIs it would be a delayed notification that the socket 
operation succeeded. Or it may be possible to check how much local 
buffer space there is left.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Aug 22 00:33:36 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 Aug 2012 00:33:36 +0100
Subject: [rabbitmq-discuss] Shovel terminated status
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD790388A7DC549@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DC549@vmexchange02.seegrid.local>
Message-ID: <50341AD0.9050103@rabbitmq.com>

Liz,

On 21/08/12 16:45, Elizabeth Liao wrote:
> Questions: In the documentation, it states that the timestamp from  $
> rabbitmqctl eval 'rabbit_shovel_status:status().' is the time when
> shovel entered the state.  I've observed this for the running and
> starting state but not for the terminated state.  The timestamp for
> the terminated state appears to be the current time.

Your config has a reconnect_delay of 1 (second), so when the shovel 
initialisation fails it will attempt to reconnect after one second, 
which puts the shovel in the 'starting' state, fail and go straight back 
to the 'terminated' state. Then one second later the same happens. And 
so on. Hence the moving timestamp.

> Additionally, it seems when a shovel is in the terminated state and
> periodically trying to reconnect, there are many connections left
> open with no active channels.

What exactly are you observing here? The number of connections returned 
by 'rabbitmqctl list_connections' at the broker the shovel is connecting to?

Btw, it would be good if you conducted your testing with the latest 
RabbitMQ version. Makes it easier for us to investigate any problems.


Regards,

Matthias.

From mpietrek at skytap.com  Wed Aug 22 01:33:56 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 21 Aug 2012 17:33:56 -0700
Subject: [rabbitmq-discuss] Exchange/Federation problems (unknown exchange
 type 'x-federation-upstream') and inability to connect to a broker after
 moving from R13B03 to R15B01
Message-ID: <CACLE7iwVT_eZMOFpC14XY2Di=CzU38Gjt6gUdmBrHGFq7-TjqA@mail.gmail.com>

I've ran into something odd. Previously, using RabbitMQ 2.8.5 and R13B03
(the default Erlang for Ubunto 10.04) I had three brokers (mq1, mq2, mq3)
in a symmetric exchange configuration (e.g, mq1 was the upstream for
mq2/mq3, and vice-versa.)

Everything worked groovy and I could connect to all the brokers, I could
pump messages through my defined  topic exchange ('skytap') between
federated brokers, and so forth.

After upgrading my Erlang version to R15B01, brokers mq2 and mq3 start
fine, work as expected and I see my 'skytap' exchange on them. However, mq1
mostly starts up (I see lots of mnesia spew), but it never accepts
connections, I can't log into the management console. The beam.smp process
is running on mq3, however.

My config file for mq1 looks like this:
[
    {mnesia, [{debug, trace}
             ]
    },
    {rabbitmq_federation,
        [ {exchanges, [[{exchange, "skytap"},
                        {type, "topic"},
                        {upstream_set, "my_upstreams"}]]},

          {upstream_sets, [{"my_upstreams", [[{connection,
"upstream-server-mq2"},
                                              {exchange, "skytap"}],
                                             [{connection,
"upstream-server-mq3"},
                                              {exchange, "skytap"}]
                                       ]}
                     ]},
          {connections, [{"upstream-server-mq2", [{host, "mq2"}
                                                 ]
                         },
                         {"upstream-server-mq3", [{host, "mq3"}]
                         }
                        ]
          }
        ]
    }
].

Whereas for both mq2 and mq3:

[
    {mnesia, [{debug, trace}
             ]
    },
    {rabbitmq_federation,
        [ {exchanges, [[{exchange, "skytap"},
                        {type, "topic"},
                        {upstream_set, "my_upstreams"}]]},

          {upstream_sets, [{"my_upstreams", [[{connection,
"upstream-server"},
                                         {exchange, "skytap"}]
                                       ]}
                     ]},
          {connections, [{"upstream-server", [{host, "mq1"}
                                        ]}
                   ]}
        ]
    }
].

The rabbit at mq1.log file has this:
=INFO REPORT==== 21-Aug-2012::17:09:23 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 21-Aug-2012::17:09:23 ===
Memory limit set to 399MB of 999MB total.

=INFO REPORT==== 21-Aug-2012::17:09:23 ===
Disk free limit set to 953MB

=WARNING REPORT==== 21-Aug-2012::17:09:23 ===
Could not find exchange type x-federation.

=WARNING REPORT==== 21-Aug-2012::17:09:23 ===
Could not find exchange type x-federation.

=INFO REPORT==== 21-Aug-2012::17:09:23 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 21-Aug-2012::17:09:23 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 21-Aug-2012::17:09:23 ===
Could not find exchange type x-federation.

=INFO REPORT==== 21-Aug-2012::17:09:23 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 21-Aug-2012::17:09:24 ===
accepting AMQP connection <0.212.0> (192.168.78.18:55219 ->
192.168.78.16:5672)

=INFO REPORT==== 21-Aug-2012::17:09:24 ===
accepting AMQP connection <0.219.0> (192.168.78.17:58709 ->
192.168.78.16:5672)

=ERROR REPORT==== 21-Aug-2012::17:09:24 ===
connection <0.212.0>, channel 2 - error:
{amqp_error,not_found,
            "no exchange 'federation: skytap ->
rabbit at mq3.mpietrek.internal.illumita.com B' in vhost '/'",
            'exchange.delete'}

=INFO REPORT==== 21-Aug-2012::17:09:24 ===
accepting AMQP connection <0.233.0> (192.168.78.18:50211 ->
192.168.78.16:5672)

=ERROR REPORT==== 21-Aug-2012::17:09:24 ===
connection <0.219.0>, channel 2 - error:
{amqp_error,not_found,
            "no exchange 'federation: skytap ->
rabbit at mq2.mpietrek.internal.illumita.com A' in vhost '/'",
            'exchange.delete'}

=ERROR REPORT==== 21-Aug-2012::17:09:24 ===
connection <0.233.0>, channel 1 - error:
{amqp_error,command_invalid,"unknown exchange type 'x-federation-upstream'",
            'exchange.declare'}

=INFO REPORT==== 21-Aug-2012::17:09:24 ===
accepting AMQP connection <0.245.0> (192.168.78.17:58290 ->
192.168.78.16:5672)

=INFO REPORT==== 21-Aug-2012::17:09:24 ===
closing AMQP connection <0.233.0> (192.168.78.18:50211 -> 192.168.78.16:5672
)

=WARNING REPORT==== 21-Aug-2012::17:09:24 ===
Could not find exchange type x-federation.

=ERROR REPORT==== 21-Aug-2012::17:09:24 ===
connection <0.245.0>, channel 1 - error:
{amqp_error,command_invalid,"unknown exchange type 'x-federation-upstream'",
            'exchange.declare'}

=INFO REPORT==== 21-Aug-2012::17:09:24 ===
closing AMQP connection <0.245.0> (192.168.78.17:58290 -> 192.168.78.16:5672
)

=WARNING REPORT==== 21-Aug-2012::17:09:24 ===
Could not find exchange type x-federation.

=WARNING REPORT==== 21-Aug-2012::17:09:24 ===
Could not find exchange type x-federation.

=WARNING REPORT==== 21-Aug-2012::17:09:24 ===
Could not find exchange type x-federation.

----
And rabbit at mq2.log:

=WARNING REPORT==== 21-Aug-2012::17:09:20 ===
Connection (<0.300.0>) closing: received hard error {'connection.close',320,
                                                     <<"CONNECTION_FORCED -
broker forced connection closure with reason 'shutdown'">>,
                                                     0,0} from server

=INFO REPORT==== 21-Aug-2012::17:09:20 ===
Federation exchange 'skytap' in vhost '/' disconnected from mq1:/:skytap
{upstream_channel_down,
    {connection_closing,
        {server_initiated_close,320,
            <<"CONNECTION_FORCED - broker forced connection closure with
reason 'shutdown'">>}}}

=ERROR REPORT==== 21-Aug-2012::17:09:20 ===
** Generic server <0.300.0> terminating
** Last message in was {channel_exit,3,{writer,send_failed,{error,closed}}}
** When Server state == {state,amqp_network_connection,
                            {state,#Port<0.5842>,0,<0.304.0>,131072,
                                {server_initiated_close,320,
                                    <<"CONNECTION_FORCED - broker forced
connection closure with reason 'shutdown'">>},
                                true},
                            <0.299.0>,<0.302.0>,
                            {amqp_params_network,<<"guest">>,<<"guest">>,
                                <<"/">>,"mq1",5672,0,0,0,infinity,none,
                                [#Fun<amqp_auth_mechanisms.plain.3>,
                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
                                [],[]},
                            0,
                            [{<<"capabilities">>,table,
                              [{<<"publisher_confirms">>,bool,true},
                               {<<"exchange_exchange_bindings">>,bool,true},
                               {<<"basic.nack">>,bool,true},
                               {<<"consumer_cancel_notify">>,bool,true}]},
                             {<<"copyright">>,longstr,
                              <<"Copyright (C) 2007-2012 VMware, Inc.">>},
                             {<<"information">>,longstr,
                              <<"Licensed under the MPL.  See
http://www.rabbitmq.com/">>},
                             {<<"platform">>,longstr,<<"Erlang/OTP">>},
                             {<<"product">>,longstr,<<"RabbitMQ">>},
                             {<<"version">>,longstr,<<"2.8.5">>}],
                            #Fun<amqp_connection_sup.0.39273983>,
                            #Fun<amqp_connection_sup.2.54430129>,
                            {closing,server_initiated_close,
                                {'connection.close',320,
                                    <<"CONNECTION_FORCED - broker forced
connection closure with reason 'shutdown'">>,
                                    0,0},
                                none}}
** Reason for termination ==
** {function_clause,
       [{amqp_network_connection,handle_message,
            [{channel_exit,3,{writer,send_failed,{error,closed}}},
             {state,#Port<0.5842>,0,<0.304.0>,131072,
                 {server_initiated_close,320,
                     <<"CONNECTION_FORCED - broker forced connection
closure with reason 'shutdown'">>},
                 true}],
            []},
        {amqp_gen_connection,callback,3,[]},
        {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,607}]},
        {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 21-Aug-2012::17:09:20 ===
** Generic server <0.305.0> terminating
** Last message in was {inet_async,#Port<0.5842>,404,
                           {ok,<<0,10,0,50,1,64,75,67,79,78,78,69,67,84,73,
                                 79,78,95,70,79,82,67,69,68,32,45,32,98,114,
                                 111,107,101,114,32,102,111,114,99,101,100,

32,99,111,110,110,101,99,116,105,111,110,32,
                                 99,108,111,115,117,114,101,32,119,105,116,

104,32,114,101,97,115,111,110,32,39,115,104,
                                 117,116,100,111,119,110,39,0,0,0,0,206>>}}
** When Server state == {state,#Port<0.5842>,<0.300.0>,<0.302.0>,
                               {method,rabbit_framing_amqp_0_9_1},
                               none}
** Reason for termination ==
** {socket_error,einval}

=WARNING REPORT==== 21-Aug-2012::17:09:20 ===
Federation exchange 'skytap' in vhost '/' did not connect to mq1:/:skytap
{error,econnrefused}

=WARNING REPORT==== 21-Aug-2012::17:09:22 ===
Federation exchange 'skytap' in vhost '/' did not connect to mq1:/:skytap
{error,econnrefused}

=WARNING REPORT==== 21-Aug-2012::17:09:24 ===
Connection (<0.412.0>) closing: received hard error {'connection.close',503,
                                                     <<"COMMAND_INVALID -
unknown exchange type 'x-federation-upstream'">>,
                                                     40,10} from server

=INFO REPORT==== 21-Aug-2012::17:09:24 ===
Federation exchange 'skytap' in vhost '/' connected to mq1:/:skytap

---
The management console for mq2 shows this on the Exchanges tab:
federation: skytap -> rabbit at mq1.mpietrek.internal.illumita.com
A<http://mq2.mpietrek.internal.illumita.com:55672/#/exchanges/%2F/federation%3A%20skytap%20-%3E%20rabbit%40mq1.mpietrek.internal.illumita.com%20A>
x-federation-upstream D AD I Args

And mq3's Exchanges tab shows:
federation: skytap -> rabbit at mq1.mpietrek.internal.illumita.com
B<http://mq3.mpietrek.internal.illumita.com:55672/#/exchanges/%2F/federation%3A%20skytap%20-%3E%20rabbit%40mq1.mpietrek.internal.illumita.com%20B>
x-federation-upstream D AD I Args


Ideas on what I'm doing wrong, or if this is a known issue?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120821/affa88b6/attachment.htm>

From supersonicclay at gmail.com  Tue Aug 21 22:00:07 2012
From: supersonicclay at gmail.com (Clay Anderson)
Date: Tue, 21 Aug 2012 14:00:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Firehose Tracer API?
Message-ID: <c4aab284-9ce2-433e-b56f-05a98c4b6d8e@googlegroups.com>

Is there any way to turn on/off the Firehose Tracer from the API?

I'm basically looking for the equivalent to "rabbitmqctl trace_on" from C#.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120821/c8bffef5/attachment.htm>

From emile at rabbitmq.com  Wed Aug 22 10:13:31 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 22 Aug 2012 10:13:31 +0100
Subject: [rabbitmq-discuss] Firehose Tracer API?
In-Reply-To: <c4aab284-9ce2-433e-b56f-05a98c4b6d8e@googlegroups.com>
References: <c4aab284-9ce2-433e-b56f-05a98c4b6d8e@googlegroups.com>
Message-ID: <5034A2BB.804@rabbitmq.com>

Hi Clay,

On 21/08/12 22:00, Clay Anderson wrote:
> Is there any way to turn on/off the Firehose Tracer from the API?
> 
> I'm basically looking for the equivalent to "rabbitmqctl trace_on" from C#.

AMQP does not let you do this, but you could use a library (e.g.
OTP.NET) that allows you to perform the same actions as rabbitmqctl from
C#. You will need to provide the library access to the erlang cookie for
this to work.


-Emile


From emile at rabbitmq.com  Wed Aug 22 10:36:15 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 22 Aug 2012 10:36:15 +0100
Subject: [rabbitmq-discuss] Problem transferring large message
In-Reply-To: <CAE-zcqUy84G2_7EANsaTOWjKkKqi1OL4ywMeahJe_ao8YBT45A@mail.gmail.com>
References: <CAE-zcqUy84G2_7EANsaTOWjKkKqi1OL4ywMeahJe_ao8YBT45A@mail.gmail.com>
Message-ID: <5034A80F.6020206@rabbitmq.com>

Hi Fred,

On 21/08/12 00:46, fred basset wrote:
> I have a simple producer and consumer based on the hello world
> example.  My code works for small messages (sending a 64 byte log
> file), but for larger messages (a 53KB log file) the receiver never
> seems to get the message.  I am using all the defaults and am on
> Ubuntu server using the Pika library.  Any clues as to what could be
> wrong?

I tried running your example and it worked fine for me with files of
several megabytes, as long as the file contents was UTF8. Does the
broker logfile contain any error messages before or at the time of the
test? Does the message reach the broker? What is the exact size of the
largest file you can upload, is the limit fixed, and does this provide
any clues about where the limit is being imposed?


-Emile



From zabrane3 at gmail.com  Wed Aug 22 10:34:38 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Wed, 22 Aug 2012 11:34:38 +0200
Subject: [rabbitmq-discuss] Problem transferring large message
In-Reply-To: <5034A80F.6020206@rabbitmq.com>
References: <CAE-zcqUy84G2_7EANsaTOWjKkKqi1OL4ywMeahJe_ao8YBT45A@mail.gmail.com>
	<5034A80F.6020206@rabbitmq.com>
Message-ID: <7B5746F9-7CCC-4E4F-8451-40717BB8126F@gmail.com>

Hi guys,

I asked this question long time ago and the idea was to break our big messages (~50Mb)
in smaller ones (100Kb). Everything was fine after that with the default settings !!!

Hope this help.

Regards,
Zabrane


On Aug 22, 2012, at 11:36 AM, Emile Joubert wrote:

> Hi Fred,
> 
> On 21/08/12 00:46, fred basset wrote:
>> I have a simple producer and consumer based on the hello world
>> example.  My code works for small messages (sending a 64 byte log
>> file), but for larger messages (a 53KB log file) the receiver never
>> seems to get the message.  I am using all the defaults and am on
>> Ubuntu server using the Pika library.  Any clues as to what could be
>> wrong?
> 
> I tried running your example and it worked fine for me with files of
> several megabytes, as long as the file contents was UTF8. Does the
> broker logfile contain any error messages before or at the time of the
> test? Does the message reach the broker? What is the exact size of the
> largest file you can upload, is the limit fixed, and does this provide
> any clues about where the limit is being imposed?
> 
> 
> -Emile
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Wed Aug 22 10:55:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 22 Aug 2012 10:55:43 +0100
Subject: [rabbitmq-discuss] Problem transferring large message
In-Reply-To: <7B5746F9-7CCC-4E4F-8451-40717BB8126F@gmail.com>
References: <CAE-zcqUy84G2_7EANsaTOWjKkKqi1OL4ywMeahJe_ao8YBT45A@mail.gmail.com>
	<5034A80F.6020206@rabbitmq.com>
	<7B5746F9-7CCC-4E4F-8451-40717BB8126F@gmail.com>
Message-ID: <5034AC9F.4080503@rabbitmq.com>

Hi,

On 22/08/12 10:34, Zabrane Mickael wrote:
> I asked this question long time ago and the idea was to break our big messages (~50Mb)
> in smaller ones (100Kb). Everything was fine after that with the default settings !!!

Fragmenting the message is fine, but the broker does not force you to do
this. As long as you provide sufficient RAM messages of several hundred
megabytes or larger is possible.


-Emile


From Saravana.Prabhu at emc.com  Wed Aug 22 11:56:23 2012
From: Saravana.Prabhu at emc.com (Prabhu, Saravana)
Date: Wed, 22 Aug 2012 06:56:23 -0400
Subject: [rabbitmq-discuss] RabbitMQ Aliveness Test vs Monitoring
 RabbitMQ Process
References: <978435FA08D0814BAD1CBA3899FE9FB4046B603AED@MX26A.corp.emc.com>
	<50053A58.4020400@rabbitmq.com> 
Message-ID: <978435FA08D0814BAD1CBA3899FE9FB4065C92928D@MX26A.corp.emc.com>

Hi,

I have one follow-up question with respect to verifying the Aliveness test behavior.

Is there a way in which we can simulate the behavior of having the RabbitMQ process (OS PID) up and running without being able to Send/Receive Messages.

Thanks,
Prabhu
-----Original Message-----
From: Prabhu, Saravana 
Sent: Tuesday, July 17, 2012 4:08 PM
To: 'Emile Joubert'; Discussions about RabbitMQ
Subject: RE: [rabbitmq-discuss] RabbitMQ Aliveness Test vs Monitoring RabbitMQ Process

Thanks a ton for the response...

Regards,
Prabhu

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Tuesday, July 17, 2012 3:42 PM
To: Discussions about RabbitMQ
Cc: Prabhu, Saravana
Subject: Re: [rabbitmq-discuss] RabbitMQ Aliveness Test vs Monitoring RabbitMQ Process

Hi,

On 17/07/12 08:21, Saravana.Prabhu at emc.com wrote:
> I would like to know if we can have scenarios where Broker Process will
> be up and running, but it could not be able to publish and receive
> messages due to unknown reasons.

The API documentation has an explanation of what it does:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/priv/www/api/index.html

The aliveness test sends and receives a message. This is a more
meaningful (and more expensive) test than checking an OS PID. It only
makes sense to monitor the OS PID if you expect a crash so dramatic that
the entire Erlang VM crashes. This can happen e.g. in an out-of-memory
scenario, but there are many failure modes that could cause the broker
to stop working while the OS PID of the Erlang VM remains running. So I
suggest using the aliveness test instead.


-Emile



From simon at rabbitmq.com  Wed Aug 22 11:59:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Aug 2012 11:59:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ Aliveness Test vs Monitoring
 RabbitMQ Process
In-Reply-To: <978435FA08D0814BAD1CBA3899FE9FB4065C92928D@MX26A.corp.emc.com>
References: <978435FA08D0814BAD1CBA3899FE9FB4046B603AED@MX26A.corp.emc.com>	<50053A58.4020400@rabbitmq.com>
	<978435FA08D0814BAD1CBA3899FE9FB4065C92928D@MX26A.corp.emc.com>
Message-ID: <5034BB89.3020908@rabbitmq.com>

On 22/08/12 11:56, Prabhu, Saravana wrote:
> Is there a way in which we can simulate the behavior of having the
> RabbitMQ process (OS PID) up and running without being able to
> Send/Receive Messages.

Probably the simplest thing is to use "rabbitmqctl stop_app".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From zabrane3 at gmail.com  Wed Aug 22 12:22:23 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Wed, 22 Aug 2012 13:22:23 +0200
Subject: [rabbitmq-discuss] Problem transferring large message
In-Reply-To: <5034AC9F.4080503@rabbitmq.com>
References: <CAE-zcqUy84G2_7EANsaTOWjKkKqi1OL4ywMeahJe_ao8YBT45A@mail.gmail.com>
	<5034A80F.6020206@rabbitmq.com>
	<7B5746F9-7CCC-4E4F-8451-40717BB8126F@gmail.com>
	<5034AC9F.4080503@rabbitmq.com>
Message-ID: <DA28A83C-490E-4240-B646-D037F33F94C1@gmail.com>

Hi Emile,

> On 22/08/12 10:34, Zabrane Mickael wrote:
>> I asked this question long time ago and the idea was to break our big messages (~50Mb)
>> in smaller ones (100Kb). Everything was fine after that with the default settings !!!
> 
> Fragmenting the message is fine, but the broker does not force you to do this.

You sure about stability?
Sending 50Mb at high rate makes RabbitMQ very unhappy (lot of crashes and messages lost).

One of your guys suggested the idea of splitting the data. And he was right ;-)

> As long as you provide sufficient RAM messages of several hundred megabytes or larger is possible.


That's what we can't afford to have. RAM is limited and we had to deal with millions of very big messages.
Hope this help.

Regards,
Zabrane


From matthias at rabbitmq.com  Wed Aug 22 12:46:30 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 Aug 2012 12:46:30 +0100
Subject: [rabbitmq-discuss] Problem transferring large message
In-Reply-To: <DA28A83C-490E-4240-B646-D037F33F94C1@gmail.com>
References: <CAE-zcqUy84G2_7EANsaTOWjKkKqi1OL4ywMeahJe_ao8YBT45A@mail.gmail.com>
	<5034A80F.6020206@rabbitmq.com>
	<7B5746F9-7CCC-4E4F-8451-40717BB8126F@gmail.com>
	<5034AC9F.4080503@rabbitmq.com>
	<DA28A83C-490E-4240-B646-D037F33F94C1@gmail.com>
Message-ID: <5034C696.3050805@rabbitmq.com>

Zabrane,

On 22/08/12 12:22, Zabrane Mickael wrote:
>> On 22/08/12 10:34, Zabrane Mickael wrote:
>>> I asked this question long time ago and the idea was to break our
>>> big messages (~50Mb) in smaller ones (100Kb). Everything was fine
>>> after that with the default settings !!!
>>
>> Fragmenting the message is fine, but the broker does not force you
>> to do this.
>
> You sure about stability? Sending 50Mb at high rate makes RabbitMQ
> very unhappy (lot of crashes and messages lost).

I have just tested twenty producers sending 50Mb messages to Rabbit as
fast as they can. The combined rate was ~30Hz. And that's on a fairly 
modest machine. There were some long pauses when messages were getting 
paged to disk, and memory peaked at about 80% (so twice the configured 
threshold), but that's expected. No crashes.

With smaller messages the performance profile will be smoother, i.e. the 
pauses will be shorter and memory peaks will be lower. But there are 
downsides to fragmenting messages aside from the extra code involved...

> That's what we can't afford to have. RAM is limited and we had to
> deal with millions of very big messages.

When you say 'deal with millions', what do you mean? That your rabbit 
needs to hold (in its queues) millions of 50Mb messages? If you fragment 
messages at 100k that would translate to 500 million messages. You'd 
need a fair amount of RAM for that since each message has some fixed 
memory footprint (in the small hundreds of bytes, iirc) even when paged 
to disk.

Regards,

Matthias.

From emile at rabbitmq.com  Wed Aug 22 12:53:38 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 22 Aug 2012 12:53:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.6 released
Message-ID: <5034C842.9000407@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 2.8.6.

This is a bugfix release with corrections to the broker, Erlang client,
management plugin as well as the shovel and federation plugins.

See the attached release notes for more details.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                     The RabbitMQ Team
                     (http://www.rabbitmq.com)


-- 
Emile Joubert

RabbitMQ
VMware






-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.8.6.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/2aa70fd2/attachment.txt>

From zabrane3 at gmail.com  Wed Aug 22 12:58:22 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Wed, 22 Aug 2012 13:58:22 +0200
Subject: [rabbitmq-discuss] Problem transferring large message
In-Reply-To: <5034C696.3050805@rabbitmq.com>
References: <CAE-zcqUy84G2_7EANsaTOWjKkKqi1OL4ywMeahJe_ao8YBT45A@mail.gmail.com>
	<5034A80F.6020206@rabbitmq.com>
	<7B5746F9-7CCC-4E4F-8451-40717BB8126F@gmail.com>
	<5034AC9F.4080503@rabbitmq.com>
	<DA28A83C-490E-4240-B646-D037F33F94C1@gmail.com>
	<5034C696.3050805@rabbitmq.com>
Message-ID: <0A2E916B-06B0-42E4-A52A-0346EF300159@gmail.com>

Hi Matthias,

> I have just tested twenty producers sending 50Mb messages to Rabbit as
> fast as they can. The combined rate was ~30Hz. And that's on a fairly modest machine. There were some long pauses when messages were getting paged to disk, and memory peaked at about 80% (so twice the configured threshold), but that's expected. No crashes.
> 
> With smaller messages the performance profile will be smoother, i.e. the pauses will be shorter and memory peaks will be lower. But there are downsides to fragmenting messages aside from the extra code involved...

Interesting.

>> That's what we can't afford to have. RAM is limited and we had to
>> deal with millions of very big messages.
> 
> When you say 'deal with millions', what do you mean? That your rabbit needs to hold (in its queues) millions of 50Mb messages? If you fragment messages at 100k that would translate to 500 million messages. You'd need a fair amount of RAM for that since each message has some fixed memory footprint (in the small hundreds of bytes, iirc) even when paged to disk.


Yep. Our system (large cluster) produce huge amount files on disk (0 to 5 millions per day) and we needed to analyse them at as fast as possible.
These messages stay a very short time on Rabbit queues. Splitting them helped us a lot.

Regards,
Zabrane


From matthias at rabbitmq.com  Wed Aug 22 13:06:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 Aug 2012 13:06:23 +0100
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87fw7hopmq.wl%francesco@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>
Message-ID: <5034CB3F.5040004@rabbitmq.com>

Jon,

On 20/08/12 11:35, Jon Bergli Heier wrote:
> Looking at the end of the log, at approx. 10:51:55 one of the nodes are shut
> down, and in the management interface I see that the shovel reconnects to the
> other node. About 30 seconds later I start it up again, nothing seems to be
> logged at this time. (The last entry in the log is my producer client manually
> disconnecting)

I suggest you give the brand new 2.8.6 release a try.

Also, I notice in your rabbit config you have a uri 
"amqp://localhost?heartbeat=5" - that will establish a network 
connection, whereas a direct connection ("amqp://") would do and be more 
efficient.

If you still see problems, please send us the output of 'rabbitmctl 
report' on both the source and destination brokers, as well as the 
output of "rabbitmqctl eval 'rabbit_shovel_status:status().'" on the 
shoveling node.

Regards,

Matthias.

From nadeem.m.nayeck at gmail.com  Wed Aug 22 13:13:57 2012
From: nadeem.m.nayeck at gmail.com (Nadeem M Nayeck)
Date: Wed, 22 Aug 2012 16:13:57 +0400
Subject: [rabbitmq-discuss] help duplicating a rabbitmq server config
Message-ID: <CACYm6LYdzonDPfHcL_X9Dz8gqAfAb3jecdPtjomZOxj-dQAnRA@mail.gmail.com>

Hi guys,

I need some help duplicating a rabbitmq server config.

I exported all the config using http://IP:55672/api/definitions However, I
did not see the shovel definitions in the resulting JSON. Is it possible to
export the shovels?

regards,
Nadeem
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/e0d666db/attachment.htm>

From francesco at rabbitmq.com  Wed Aug 22 13:28:11 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 22 Aug 2012 13:28:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Warrens
In-Reply-To: <c41c2b2d-47d4-4b09-8556-159ad4e93ddf@googlegroups.com>
References: <c41c2b2d-47d4-4b09-8556-159ad4e93ddf@googlegroups.com>
Message-ID: <87mx1nkt5w.wl%francesco@rabbitmq.com>

Hi Adam,

At Tue, 14 Aug 2012 00:59:28 -0700 (PDT),
Adam Petrovic wrote:
> Hi. I am just reading up about the concept of HAProxy load-balanced warrens
> (active / standby nodes) and I can't quite come up with a solution to a
> bugging question.
> 
> I understand that the concept of the load balanced warren is for HAProxy to
> automatically fail over to the standby node, should the active node fail and
> go down. In doing so, any existing messages on the active node would be lost
> until this node is brought back up.
> 
> Which brings me to my question, what happens to the pending (still to be
> consumed) messages on the standby node when the active node is brought back
> up.  Are they lost, or should the application logic handle this itself?
> Because as far as I know, HAProxy has no way of dealing with this issue.

The first thing you should do is make sure that you need this kind of
active/passive configuration.  If your cluster resides in a local network, you
might want to look at RabbitMQ own clustering, which will let you connect to any
node in the cluster seamlessly, see <http://www.rabbitmq.com/clustering.html>.

Otherwise, I'm don't know much HAProxy, but a good option in this situation
would be to instruct HAProxy to promote the standby node to active node when the
active fails, and make the once-active node a standby node when it comes back
up.  This has the converse problem of what to do with the messages left on the
active node.

If that's not possible, you might want to look for a way to instruct HAProxy to
notify you when the active node comes back up, stop publishing, wait for all the
messages to be consumed on the stanby node, tell HAProxy to restore the active
node, and then start publishing again.  But that's tricky, especially the "wait
for messages to be consumed" part.

--
Francesco * Often in error, never in doubt

From aaron at agoragames.com  Wed Aug 22 13:44:52 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 22 Aug 2012 08:44:52 -0400
Subject: [rabbitmq-discuss] upgrading a cluster
Message-ID: <CALEq_A-p3JWTzgPUe5j2eGZoSCXvoaRHb647Ae91is+kNfO9tg@mail.gmail.com>

To date we've accepted the downtime associated with upgrading our
rabbit cluster as we perform that work infrequently. In evaluating our
planned improvements for the coming year, decreasing downtime is an
important goal.

With that in mind I reviewed the documentation for upgrades and found
that it is still recommended/required that the whole cluster be shut
down for an upgrade. That doesn't fit with our goals, so my questions
are:

* is that recommendation up to date?
* is it a requirement or recommendation?
* is there a configuration that would give us the benefit of
clustering and mirrored queues without this requirement?

Our use of Rabbit is fairly simple. We have a front-end web server to
handle client requests, queue messages to Rabbit, and run a pool of
consumers to handle the requests. We haven't yet evaluated other MQ
options as we've been mostly happy with Rabbit for the past 3 years,
but this required downtime is a sticking point.

-Aaron

From francesco at rabbitmq.com  Wed Aug 22 14:17:52 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 22 Aug 2012 14:17:52 +0100
Subject: [rabbitmq-discuss] upgrading a cluster
In-Reply-To: <CALEq_A-p3JWTzgPUe5j2eGZoSCXvoaRHb647Ae91is+kNfO9tg@mail.gmail.com>
References: <CALEq_A-p3JWTzgPUe5j2eGZoSCXvoaRHb647Ae91is+kNfO9tg@mail.gmail.com>
Message-ID: <87lih7kqv3.wl%francesco@rabbitmq.com>

Hi Aaron,

At Wed, 22 Aug 2012 08:44:52 -0400,
Aaron Westendorf wrote:
> 
> To date we've accepted the downtime associated with upgrading our
> rabbit cluster as we perform that work infrequently. In evaluating our
> planned improvements for the coming year, decreasing downtime is an
> important goal.
> 
> With that in mind I reviewed the documentation for upgrades and found
> that it is still recommended/required that the whole cluster be shut
> down for an upgrade. That doesn't fit with our goals, so my questions
> are:
> 
> * is that recommendation up to date?

Yes.

> * is it a requirement or recommendation?

You can read it as "if you don't follow this, things might go wrong".  And
things will indeed go wrong, especially when upgrading to a feature release.
Doing that when upgrading to a bugfix release is less risky, but still risky.

> * is there a configuration that would give us the benefit of clustering and
>   mirrored queues without this requirement?

You can take a look at federation <http://www.rabbitmq.com/federation.html> and
shovel <http://www.rabbitmq.com/shovel.html>.

> Our use of Rabbit is fairly simple. We have a front-end web server to
> handle client requests, queue messages to Rabbit, and run a pool of
> consumers to handle the requests.

Well this description does not justify your clustering requirements.  If it's
just to achieve high availability, then federation might help you, if you don't
care about having strong guarantees about the published messages.

--
Francesco * Often in error, never in doubt

From jon.bergli.heier at zisson.no  Wed Aug 22 14:17:52 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Wed, 22 Aug 2012 13:17:52 +0000
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <5034CB3F.5040004@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87fw7hopmq.wl%francesco@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>,
	<5034CB3F.5040004@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F7BD@osl02-exc-001>

Hi,

> I suggest you give the brand new 2.8.6 release a try.

I still see this behavior in 2.8.6.

> Also, I notice in your rabbit config you have a uri
> "amqp://localhost?heartbeat=5" - that will establish a network
> connection, whereas a direct connection ("amqp://") would do and be more
> efficient.

I had actually forgotten about that. We have seen the same problem that was
mentioned in another post to the list yesterday, where the shovel would spawn
a new connection each time it tried to reconnect (while stuck in a failed state),
and used this as a workaround. I've tested both with and without a direct
connection now, and I see the problem appear on both configurations.

> If you still see problems, please send us the output of 'rabbitmctl
> report' on both the source and destination brokers, as well as the
> output of "rabbitmqctl eval 'rabbit_shovel_status:status().'" on the
> shoveling node.

Attached these as log files, rabbit1 is the destination and shovel is the source
broker where the shovel lives. The direct connection doesn't seem to show up
from the report command at all, but I can see it in the management interface.


Jon

________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Wednesday, August 22, 2012 14:06
To: Discussions about RabbitMQ
Cc: Jon Bergli Heier
Subject: Re: [rabbitmq-discuss] Shovel stops receiving acks from cluster

Jon,

On 20/08/12 11:35, Jon Bergli Heier wrote:
> Looking at the end of the log, at approx. 10:51:55 one of the nodes are shut
> down, and in the management interface I see that the shovel reconnects to the
> other node. About 30 seconds later I start it up again, nothing seems to be
> logged at this time. (The last entry in the log is my producer client manually
> disconnecting)

I suggest you give the brand new 2.8.6 release a try.

Also, I notice in your rabbit config you have a uri
"amqp://localhost?heartbeat=5" - that will establish a network
connection, whereas a direct connection ("amqp://") would do and be more
efficient.

If you still see problems, please send us the output of 'rabbitmctl
report' on both the source and destination brokers, as well as the
output of "rabbitmqctl eval 'rabbit_shovel_status:status().'" on the
shoveling node.

Regards,

Matthias.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit1-report.log
Type: text/x-log
Size: 39043 bytes
Desc: rabbit1-report.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/f4466d47/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: shovel_report.log
Type: text/x-log
Size: 7733 bytes
Desc: shovel_report.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/f4466d47/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: shovel_status.log
Type: text/x-log
Size: 1777 bytes
Desc: shovel_status.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/f4466d47/attachment-0002.bin>

From simon at rabbitmq.com  Wed Aug 22 14:27:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Aug 2012 14:27:51 +0100
Subject: [rabbitmq-discuss] help duplicating a rabbitmq server config
In-Reply-To: <CACYm6LYdzonDPfHcL_X9Dz8gqAfAb3jecdPtjomZOxj-dQAnRA@mail.gmail.com>
References: <CACYm6LYdzonDPfHcL_X9Dz8gqAfAb3jecdPtjomZOxj-dQAnRA@mail.gmail.com>
Message-ID: <5034DE57.6010509@rabbitmq.com>

On 22/08/12 13:13, Nadeem M Nayeck wrote:
> Hi guys,
>
> I need some help duplicating a rabbitmq server config.
>
> I exported all the config using http://IP:55672/api/definitions However,
> I did not see the shovel definitions in the resulting JSON. Is it
> possible to export the shovels?

Hi Nadeem - the definitions from /api/definitions are intended to 
contain everything that is created at runtime - exchanges, queues, users 
and so on. They do not include anything from the configuration file. The 
way to export shovels is to copy configuration files around :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Wed Aug 22 14:52:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 Aug 2012 14:52:07 +0100
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F7BD@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87fw7hopmq.wl%francesco@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>,
	<5034CB3F.5040004@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F7BD@osl02-exc-001>
Message-ID: <5034E407.6020409@rabbitmq.com>

Jon,

On 22/08/12 14:17, Jon Bergli Heier wrote:
> Attached these as log files, rabbit1 is the destination and shovel is the source
> broker where the shovel lives. The direct connection doesn't seem to show up
> from the report command at all, but I can see it in the management interface.

There are a lot of connections from other rabbits to rabbit1, most of 
them from version 2.8.5, some from 2.8.1. There are a few 2.8.6 
connections. All but two of the connections have a timeout of 10s 
whereas your shovel config indicated that the heartbeat is 5 seconds.

So it looks like there is a lot more going on in your system then you 
have hitherto told us about.

I can see that there is one channel on rabbit1 with 1000 pending 
confirms, which is certainly odd.

Is there any chance you could trim this setup down to the bare 
essentials to help in tracking down the problem?

Also, which node did you bounce - rabbit1 or rabbit2?

Regards,

Matthias.

From simon at rabbitmq.com  Wed Aug 22 14:53:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Aug 2012 14:53:14 +0100
Subject: [rabbitmq-discuss] upgrading a cluster
In-Reply-To: <CALEq_A-p3JWTzgPUe5j2eGZoSCXvoaRHb647Ae91is+kNfO9tg@mail.gmail.com>
References: <CALEq_A-p3JWTzgPUe5j2eGZoSCXvoaRHb647Ae91is+kNfO9tg@mail.gmail.com>
Message-ID: <5034E44A.5060702@rabbitmq.com>

On 22/08/12 13:44, Aaron Westendorf wrote:
> To date we've accepted the downtime associated with upgrading our
> rabbit cluster as we perform that work infrequently. In evaluating our
> planned improvements for the coming year, decreasing downtime is an
> important goal.
>
> With that in mind I reviewed the documentation for upgrades and found
> that it is still recommended/required that the whole cluster be shut
> down for an upgrade. That doesn't fit with our goals, so my questions
> are:
>
> * is that recommendation up to date?

Yes.

> * is it a requirement or recommendation?

Pretty much a requirement I'm afraid. And we're intending to enforce it 
more strictly in future, since we see reports of people running 
mixed-version clusters and getting weird errors.

> * is there a configuration that would give us the benefit of
> clustering and mirrored queues without this requirement?

If you want mirrored queues you need clustering. But you don't need to 
have only *one* cluster.

You could have two separate clusters (they could both run on the same 
set of machines of course) - and either keep them completely separate 
with your clients connecting to both, or have the two clusters connected 
together with the shovel or federation.

You can then take one cluster at a time offline to upgrade it.

> Our use of Rabbit is fairly simple. We have a front-end web server to
> handle client requests, queue messages to Rabbit, and run a pool of
> consumers to handle the requests. We haven't yet evaluated other MQ
> options as we've been mostly happy with Rabbit for the past 3 years,
> but this required downtime is a sticking point.

I hope the above seems like a feasible option.

It's unlikely we'll support mixed-version clusters any time soon - the 
nodes of a cluster are quite tightly integrated, and there are a *lot* 
of points where they interact - the work involved in make sure internal 
messages get correctly translated at each point and in testing the whole 
thing works would be quite alarming (and it would be a cost on every 
future release, not just a one-off).

I hope this helps.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Aug 22 15:08:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Aug 2012 15:08:21 +0100
Subject: [rabbitmq-discuss] Exchange/Federation problems (unknown
 exchange type 'x-federation-upstream') and inability to connect to a broker
 after moving from R13B03 to R15B01
In-Reply-To: <CACLE7iwVT_eZMOFpC14XY2Di=CzU38Gjt6gUdmBrHGFq7-TjqA@mail.gmail.com>
References: <CACLE7iwVT_eZMOFpC14XY2Di=CzU38Gjt6gUdmBrHGFq7-TjqA@mail.gmail.com>
Message-ID: <5034E7D5.4050606@rabbitmq.com>

On 22/08/12 01:33, Matt Pietrek wrote:
> I've ran into something odd. Previously, using RabbitMQ 2.8.5 and R13B03
> (the default Erlang for Ubunto 10.04) I had three brokers (mq1, mq2,
> mq3) in a symmetric exchange configuration (e.g, mq1 was the upstream
> for mq2/mq3, and vice-versa.)

So specifically you have mq2 <---> mq1 <---> mq3; i.e. mq2 and mq3 are 
not connected by federation?

> Everything worked groovy and I could connect to all the brokers, I could
> pump messages through my defined  topic exchange ('skytap') between
> federated brokers, and so forth.
>
> After upgrading my Erlang version to R15B01, brokers mq2 and mq3 start
> fine, work as expected and I see my 'skytap' exchange on them. However,
> mq1 mostly starts up (I see lots of mnesia spew), but it never accepts
> connections, I can't log into the management console. The beam.smp
> process is running on mq3, however.

Do you mean mq1?

> My config file for mq1 looks like this:

<snip>

> The rabbit at mq1.log file has this:

> =WARNING REPORT==== 21-Aug-2012::17:09:23 ===
> Could not find exchange type x-federation.

This is very suspicious - are you absolutely sure the federation plugin 
is enabled?

Actually, you also say you can't log into the management console - have 
you ended up disabling (somehow) all plugins on that broker? The logs 
show no since of management even attempting to start.

(You say "inability to connect to a broker" - I assume you mean to the 
management console since the log shows AMQP connections being accepted.)

What does /var/log/rabbitmq/startup_log show under "Activating RabbitMQ 
plugins"? What does "rabbitmq-plugins list" show?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gmr at meetme.com  Wed Aug 22 15:53:08 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 22 Aug 2012 10:53:08 -0400
Subject: [rabbitmq-discuss] JSONRPC-Channel Plugin and TCP Backpressure
Message-ID: <9C98EE036AF64CA7B4A3DCF2B46AEA40@meetme.com>

Hi all,

I was wondering if the JSONRPC-Channel Plugin will apply or otherwise show constraint in situations where the broker would normally apply TCP Backpressure? I'm seeing a pattern of behavior where a few times a day, clients are unable to connect to established or create new sessions.

Thanks in advance,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/d53c69dc/attachment.htm>

From jon.bergli.heier at zisson.no  Wed Aug 22 17:04:37 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Wed, 22 Aug 2012 16:04:37 +0000
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <5034E407.6020409@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87fw7hopmq.wl%francesco@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>,
	<5034CB3F.5040004@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F7BD@osl02-exc-001>,
	<5034E407.6020409@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F7F4@osl02-exc-001>

Hi,

> So it looks like there is a lot more going on in your system then you
> have hitherto told us about.

Yes, apologies for that.

> Is there any chance you could trim this setup down to the bare
> essentials to help in tracking down the problem?

I just set up two new VMs with RabbitMQ and clustered them. I was still
able to reproduce the problem, but compared to one or two tries it took
me 12 tries (of stopping and starting nodes). I also tried disabling the other
shovels on the shovel node (by commenting them out in the config) and removing
all other queues and exchanges, with that it took 15 tries.

I attached the results of the same commands with the new setup, qa-test1 and
qa-test2 are the new nodes I set up. qa-test1 was the trigger in both cases.

> Also, which node did you bounce - rabbit1 or rabbit2?

rabbit2


Jon
________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Wednesday, August 22, 2012 15:52
To: Jon Bergli Heier
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovel stops receiving acks from cluster

Jon,

On 22/08/12 14:17, Jon Bergli Heier wrote:
> Attached these as log files, rabbit1 is the destination and shovel is the source
> broker where the shovel lives. The direct connection doesn't seem to show up
> from the report command at all, but I can see it in the management interface.

There are a lot of connections from other rabbits to rabbit1, most of
them from version 2.8.5, some from 2.8.1. There are a few 2.8.6
connections. All but two of the connections have a timeout of 10s
whereas your shovel config indicated that the heartbeat is 5 seconds.

So it looks like there is a lot more going on in your system then you
have hitherto told us about.

I can see that there is one channel on rabbit1 with 1000 pending
confirms, which is certainly odd.

Is there any chance you could trim this setup down to the bare
essentials to help in tracking down the problem?

Also, which node did you bounce - rabbit1 or rabbit2?

Regards,

Matthias.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: logs.tar.gz
Type: application/x-gzip
Size: 5273 bytes
Desc: logs.tar.gz
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/9ddf2841/attachment.bin>

From dharshanr at scalegrid.net  Wed Aug 22 19:01:08 2012
From: dharshanr at scalegrid.net (Dharshan Rangegowda)
Date: Wed, 22 Aug 2012 11:01:08 -0700
Subject: [rabbitmq-discuss] RabbitMQ management plugin does not display
 message stats
In-Reply-To: <50335729.5030408@rabbitmq.com>
References: <658e12c1-0885-43f9-9633-cbd134be2ebe@googlegroups.com>
	<50335729.5030408@rabbitmq.com>
Message-ID: <CAC3-Q1Qzvj7oMgougx8AH=O6R-_xxjyq6Eq9s5MMNFyKDYg_OA@mail.gmail.com>

Thanks Simon. The rabbitMQ management plugin seems to struggle under load.
I have a dual core 4GB box with about 8000 connections and a very low
message load. However the Management plugin website struggles with frequent
errors. Is there some documentation on scale out configuration for RabbitMQ
and the plugin?

regards,
Dharshan

On Tue, Aug 21, 2012 at 2:38 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 20/08/12 23:07, dharshanr wrote:
>
>> I am using the RabbitMQ management plugin to monitor some stats on the
>> server and I noticed that the Messaging stats (Total/Ready/Acknowledged)
>> are not being displayed. I can see the other node stats like file
>> description/memory usage etc. Do I need to do some other configuration
>> to get this data? I have uploaded a screenshot.
>>
>
> This should be the total number of queued messages on your server - do you
> actually have any queued messages?
>
>  Also is there a way to get this data from rabbitmqctl? This way I don't
>> have to use the UI.
>>
>
> You can't get the global total, but you can invoke "rabbitmqctl
> list_queues name messages_ready messages_unacknowledged messages" and sum
> it yourself. Or use the HTTP API.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
regards,
Dharshan.
www.scalegrid.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/6088a94c/attachment.htm>

From dharshanr at scalegrid.net  Wed Aug 22 19:36:07 2012
From: dharshanr at scalegrid.net (dharshanr)
Date: Wed, 22 Aug 2012 11:36:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Java client deadlock closing channel/connection
Message-ID: <4c7f92dd-e132-48c6-9674-1dbc90bdec1d@googlegroups.com>

Hi folks,

My java client is hitting a deadlock closing a channel or a connection. I 
have also noticed that it hangs when deleting a queue as well. I have 
noticed this error when the server has a large number of connections. When 
I reboot the error goes away for some time and then appears again. In the 
rabbitmq management webpage I see a memory warning

Memory usage is 2.3GB where the high watermark is 1.5 GB.
"The memory alarm for this node has gone off. It will block incoming 
network traffic until the memory usage drops below the watermark. ". 

Why is the memory usage above the watermark? From what I have read RabbitMQ 
moves the messages to disk and scales that way without using more memory.

regards,
Dharshan
www.scalegrid.net
(Services for the private cloud)


Here is the status of my server

Status of node rabbit at drrabbitmq1 ...
[{pid,1169},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.4"},
      {xmerl,"XML parser","1.2.10"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.4"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.4"},
      {rabbit,"RabbitMQ","2.8.4"},
      {ssl,"Erlang/OTP SSL application","4.1.6"},
      {public_key,"Public key infrastructure","0.13"},
      {crypto,"CRYPTO version 2","2.0.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.4"},
      {webmachine,"webmachine","1.7.0-rmq2.8.4-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.4-git"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,2379504536},
      {processes,1926964632},
      {processes_used,1924985912},
      {system,452539904},
      {atom,1722081},
      {atom_used,1690549},
      {binary,194345200},
      {code,18717132},
      {ets,176530144}]},
 {vm_memory_high_watermark,0.3999999998070925},
 {vm_memory_limit,1658825932},
 {disk_free_limit,1000000000},
 {disk_free,2966052864},
 {file_descriptors,
     [{total_limit,65436},
      {total_used,18006},
      {sockets_limit,58890},
      {sockets_used,8000}]},
 {processes,[{limit,1048576},{used,98174}]},
 {run_queue,0},
 {uptime,61715}]
...done.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/1dcab318/attachment.htm>

From jose.mico at gmail.com  Wed Aug 22 22:35:40 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Wed, 22 Aug 2012 18:35:40 -0300
Subject: [rabbitmq-discuss] RabbitMQ Latency
In-Reply-To: <5032B1CD.7080901@rabbitmq.com>
References: <c22e38fa-9767-40eb-bc22-b558a147f1da@googlegroups.com>
	<502D1BE7.2060607@rabbitmq.com>
	<CAEk0_N6NhZOUgW-2w-p76JE=LLiUwoFtYKjmHAp3HKRLj-3Cyw@mail.gmail.com>
	<5032A76D.8040704@rabbitmq.com> <5032B1CD.7080901@rabbitmq.com>
Message-ID: <503550AC.60305@gmail.com>

On 08/20/2012 06:53 PM, Matthias Radestock wrote:
>
> The wireshark trace Tom submitted in another thread clearly shows a 
> 40ms delay from the 'publish' going out to the 'deliver' coming back. 
> And I've reproduced the same result on my machine.
>
> ...
>
> The difference could be down to Nagle (the Java client disables it by 
> default; no idea what node-amqp does) or buffer flushing (the Java 
> client flushes output buffers after complete commands, i.e. at the end 
> of the three frames in case of a short basic.publish; no idea what 
> node-amqp does), or some node-amqp/node.js weirdness.

On every benchmark that I've done on linux, I found that the Nagle 
algorithm causes a delay of almost exactly 40ms.

Any TCP client which disables the Nagle algorithm will get its latency 
improved at least by 20 times.



From mpietrek at skytap.com  Wed Aug 22 23:06:42 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 22 Aug 2012 15:06:42 -0700
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
Message-ID: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>

I'm experiencing a consistently reproducible scenario where an HA queue
disappears when a node rejoins the cluster. This is using RabbitMQ 2.8.5
and Erlang R15B01.

The brokers here are play, play2 and util. I have a set of queues mirrored
on all the brokers, including a durable queue called 'unit_test'.

Using the management UI, I publish some dummy messages to unit_test and
verify that they show up in the queue, and that the queue is synched on all
nodes.

I then take down the play node and start it back up. Afterwards, I force
everything to be synchronized by doing a management API 'get messages" with
requeue=True. When this completes, everything shows up synched as expected.

I then bring down play2 and start it back up. Immediately after it starts,
the unit_test disappears. Interestingly, none of the other (empty) queues
disappear - Only the unit_test queue.

I have the following from rabbit at play.log file:

=ERROR REPORT==== 22-Aug-2012::14:42:42 ===
** Generic server <0.278.0> terminating
** Last message in was {'$gen_cast',{gm,{length,4}}}
** When Server state == {state,
                         {amqqueue,
                          {resource,<<"/">>,queue,<<"unit_test">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <3299.4430.0>,
                          [<3298.2580.0>],
                          all},
                         <0.280.0>,<3299.4430.0>,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          0,
                          {0,nil},
                          undefined,
                          {0,nil},
                          {qistate,
                           "/home/mpietrek/work/var/lib/rabbit at play
/queues/5CPQWZ6GS6L07B10CDNMTM42C",
                           {{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            []},
                           undefined,0,262144,
                           #Fun<rabbit_variable_queue.2.121033067>,
                           {0,nil}},
                          {{client_msstate,msg_store_persistent,
                            <<3,210,105,14,156,98,212,28,20,242,100,176,253,
                              212,5,205>>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,327753,
                             "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_persistent"},
                            rabbit_msg_store_ets_index,
                            "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_persistent",
                            <0.264.0>,331850,323656,335947,340044},
                           {client_msstate,msg_store_transient,

<<178,59,10,119,58,171,186,219,211,141,219,166,46,
                              89,222,107>>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,307268,
                             "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_transient"},
                            rabbit_msg_store_ets_index,
                            "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_transient",
                            <0.259.0>,311365,303166,315462,319559}},

true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
                          0,infinity,0,0,0,0,0,
                          {rates,
                           {{1345,671562,425012},0},
                           {{1345,671562,425012},0},
                           0.0,0.0,
                           {1345,671606,221014}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          0,0,
                          {rates,
                           {{1345,671562,425012},0},
                           {{1345,671562,425012},0},
                           0.0,0.0,
                           {1345,671606,221014}}},
                         undefined,#Ref<0.0.0.8008>,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         0,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         true}
** Reason for termination ==
** {function_clause,
       [{rabbit_mirror_queue_slave,set_synchronised,
            [false,
             {state,
                 {amqqueue,
                     {resource,<<"/">>,queue,<<"unit_test">>},
                     true,false,none,
                     [{<<"x-ha-policy">>,longstr,<<"all">>}],
                     <3299.4430.0>,
                     [<3298.2580.0>],
                     all},
                 <0.280.0>,<3299.4430.0>,rabbit_variable_queue,
                 {vqstate,
                     {0,{[],[]}},
                     {0,{[],[]}},
                     {delta,undefined,0,undefined},
                     {0,{[],[]}},
                     {0,{[],[]}},
                     0,
                     {0,nil},
                     undefined,
                     {0,nil},
                     {qistate,
                         "/home/mpietrek/work/var/lib/rabbit at play
/queues/5CPQWZ6GS6L07B10CDNMTM42C",
                         {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                          []},
                         undefined,0,262144,
                         #Fun<rabbit_variable_queue.2.121033067>,
                         {0,nil}},
                     {{client_msstate,msg_store_persistent,

<<3,210,105,14,156,98,212,28,20,242,100,176,253,212,
                            5,205>>,
                          {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                          {state,327753,
                              "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_persistent"},
                          rabbit_msg_store_ets_index,
                          "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_persistent",
                          <0.264.0>,331850,323656,335947,340044},
                      {client_msstate,msg_store_transient,

<<178,59,10,119,58,171,186,219,211,141,219,166,46,89,
                            222,107>>,
                          {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                          {state,307268,
                              "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_transient"},
                          rabbit_msg_store_ets_index,
                          "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_transient",
                          <0.259.0>,311365,303166,315462,319559}},
                     true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
                     infinity,0,0,0,0,0,
                     {rates,
                         {{1345,671562,425012},0},
                         {{1345,671562,425012},0},
                         0.0,0.0,
                         {1345,671606,221014}},
                     {0,nil},
                     {0,nil},
                     {0,nil},
                     {0,nil},
                     0,0,
                     {rates,
                         {{1345,671562,425012},0},
                         {{1345,671562,425012},0},
                         0.0,0.0,
                         {1345,671606,221014}}},
                 undefined,#Ref<0.0.0.8008>,
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 0,
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 true}],
            []},
        {rabbit_mirror_queue_slave,process_instruction,2,[]},
        {rabbit_mirror_queue_slave,handle_cast,2,[]},
        {gen_server2,handle_msg,2,[]},
        {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}

=INFO REPORT==== 22-Aug-2012::14:42:42 ===
rabbit on node rabbit at play2 up
--------
On play2, the console spew includes this:

Mnesia(rabbit at play2): write performed by {tid,3817,<3297.298.0>} on record:
        {gm_group,{resource,<<"/">>,queue,<<"system_test">>},
                  83,
                  [{70,<3299.289.0>},{79,<3297.298.0>},{82,<0.295.0>}]}
Mnesia(rabbit at play2): write performed by {tid,3817,<0.277.0>} on record:
        {gm_group,{resource,<<"/">>,queue,<<"unit_test">>},
                  10,
                  [{12,<3299.4432.0>},{7,<0.277.0>}]}
done
-- message delivery logic ready
starting error log relay
...Mnesia(rabbit at play2): Restarting transaction {tid,3818,<0.165.0>}: in
8ms {cyclic,rabbit at play2
,{rabbit_queue,{resource,<<47>>,queue,<<117,110,105,116,95,116,101,115,116>>}},read,read,{tid,3816,<3297.184.0>}}
done
starting networking
...Mnesia(rabbit at play2): delete_object performed by {tid,3816,<3297.184.0>}
on record:
        {rabbit_reverse_route,
            {reverse_binding,
                {resource,<<"/">>,queue,<<"unit_test">>},
                <<"unit_test">>,
                {resource,<<"/">>,exchange,<<>>},
                []},
            const}
Mnesia(rabbit at play2): delete_object performed by {tid,3816,<3297.184.0>} on
record:
        {rabbit_route,{binding,{resource,<<"/">>,exchange,<<>>},
                               <<"unit_test">>,
                               {resource,<<"/">>,queue,<<"unit_test">>},
                               []},
                      const}
Mnesia(rabbit at play2): delete performed by {tid,3816,<3297.184.0>} on record:
        {rabbit_queue,{resource,<<"/">>,queue,<<"unit_test">>}}
Mnesia(rabbit at play2): delete_object performed by {tid,3816,<3297.184.0>} on
record:
        {rabbit_semi_durable_route,
            {binding,
                {resource,<<"/">>,exchange,<<>>},
                <<"unit_test">>,
                {resource,<<"/">>,queue,<<"unit_test">>},
                []},
            const}
Mnesia(rabbit at play2): delete_object performed by {tid,3816,<3297.184.0>} on
record:
        {rabbit_durable_route,
            {binding,
                {resource,<<"/">>,exchange,<<>>},
                <<"unit_test">>,
                {resource,<<"/">>,queue,<<"unit_test">>},
                []},
            const}
Mnesia(rabbit at play2): delete performed by {tid,3816,<3297.184.0>} on record:
        {rabbit_durable_queue,{resource,<<"/">>,queue,<<"unit_test">>}}
Mnesia(rabbit at play2): write performed by {dirty,<0.301.0>} on record:
        {rabbit_listener,rabbit at play2,amqp,
                         "play2.mpietrek.internal.illumita.com",
                         {0,0,0,0},
                         5672}
done
starting direct client
...done
starting notify cluster nodes
...done

broker running
Mnesia(rabbit at play2): write performed by {tid,3820,<3299.4432.0>} on record:
        {gm_group,{resource,<<"/">>,queue,<<"unit_test">>},
                  11,
                  [{12,<3299.4432.0>},{dead,{7,<0.277.0>}}]}
Mnesia(rabbit at play2): write performed by {tid,3821,<3299.4432.0>} on record:
        {gm_group,{resource,<<"/">>,queue,<<"unit_test">>},
                  12,
                  [{12,<3299.4432.0>}]}
Mnesia(rabbit at play2): Transaction log dump initiated by time_threshold:
{needs_dump,47}
Mnesia(rabbit at play2): Transaction log dump initiated by time_threshold:
already_dumped
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/d45a9a9c/attachment.htm>

From dharshanr at scalegrid.net  Wed Aug 22 23:11:38 2012
From: dharshanr at scalegrid.net (Dharshan Rangegowda)
Date: Wed, 22 Aug 2012 15:11:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ management plugin does not display
 message stats
In-Reply-To: <CAC3-Q1Qzvj7oMgougx8AH=O6R-_xxjyq6Eq9s5MMNFyKDYg_OA@mail.gmail.com>
References: <658e12c1-0885-43f9-9633-cbd134be2ebe@googlegroups.com>
	<50335729.5030408@rabbitmq.com>
	<CAC3-Q1Qzvj7oMgougx8AH=O6R-_xxjyq6Eq9s5MMNFyKDYg_OA@mail.gmail.com>
Message-ID: <CAC3-Q1TDCjdSYGHjjyCDw9jWXN3-d+AvqrwJHLeC1Gx6cGShvA@mail.gmail.com>

Another quick observation - I have 8000 virtual hosts and 8000 connections.
Even when I have 0 messages the plugin seems to be very intermittent about
displaying data. I wonder if the plugin does not handle these many virtual
hosts...

On Wed, Aug 22, 2012 at 11:01 AM, Dharshan Rangegowda <
dharshanr at scalegrid.net> wrote:

> Thanks Simon. The rabbitMQ management plugin seems to struggle under load.
> I have a dual core 4GB box with about 8000 connections and a very low
> message load. However the Management plugin website struggles with frequent
> errors. Is there some documentation on scale out configuration for RabbitMQ
> and the plugin?
>
> regards,
> Dharshan
>
>
> On Tue, Aug 21, 2012 at 2:38 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 20/08/12 23:07, dharshanr wrote:
>>
>>> I am using the RabbitMQ management plugin to monitor some stats on the
>>> server and I noticed that the Messaging stats (Total/Ready/Acknowledged)
>>> are not being displayed. I can see the other node stats like file
>>> description/memory usage etc. Do I need to do some other configuration
>>> to get this data? I have uploaded a screenshot.
>>>
>>
>> This should be the total number of queued messages on your server - do
>> you actually have any queued messages?
>>
>>  Also is there a way to get this data from rabbitmqctl? This way I don't
>>> have to use the UI.
>>>
>>
>> You can't get the global total, but you can invoke "rabbitmqctl
>> list_queues name messages_ready messages_unacknowledged messages" and sum
>> it yourself. Or use the HTTP API.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
>
> --
> regards,
> Dharshan.
> www.scalegrid.net
>
>


-- 
regards,
Dharshan.
www.scalegrid.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/f8eb59e4/attachment.htm>

From smason at edgecast.com  Thu Aug 23 02:12:55 2012
From: smason at edgecast.com (Seth Mason)
Date: Wed, 22 Aug 2012 18:12:55 -0700
Subject: [rabbitmq-discuss] Difference betweeen rabbitmqctl and management
	plugin
Message-ID: <CACuA+a29dgOapV8dDcvhECm9f6BJZfenfEepK+tPLmxUoPfLKw@mail.gmail.com>

Hello, I'm getting different results from the management API than I am
from rabbitmqctl when looking at memory.

GET /api/queues/test?columns=name,memory
[
    {
        "memory": 17280,
        "name": "queueone"
    },
    {
        "memory": 7656,
        "name": "queuetwo"
    }
]

> rabbitmqctl list_queues -p test -q name memory
queuetwo	21952
queueone	58560


Is the API returning a different stat than rabbitmqctl or did I miss
some documentation somewhere?

Thanks in advance.

From matthias at rabbitmq.com  Thu Aug 23 04:09:26 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 Aug 2012 04:09:26 +0100
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
 cluster
In-Reply-To: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
Message-ID: <50359EE6.6070000@rabbitmq.com>

Matt,

On 22/08/12 23:06, Matt Pietrek wrote:
> I'm experiencing a consistently reproducible scenario where an HA queue
> disappears when a node rejoins the cluster. This is using RabbitMQ 2.8.5
> and Erlang R15B01.

please try reproducing this with 2.8.6.

Matthias.

From curylod at asme.org  Thu Aug 23 04:24:31 2012
From: curylod at asme.org (Dave Curylo)
Date: Wed, 22 Aug 2012 23:24:31 -0400
Subject: [rabbitmq-discuss] Exchange to exchange bindings in python
	(pika)
In-Reply-To: <D9E68005B2F84C8AA41BB29546F31959@meetme.com>
References: <CAAqmy6M+J6dwUsdCmuXMbPs63k51MDP=k2BfWEVKR=YU5LXFAA@mail.gmail.com>
	<D9E68005B2F84C8AA41BB29546F31959@meetme.com>
Message-ID: <CAAqmy6MiYE13m=ptkgtmvMN3e8ctMmD5ARVNi0X0oQ_3iGBxTw@mail.gmail.com>

Gavin,

I get this error attempting to call channel.exchange_bind:

'BlockingChannel' object has no attribute 'exchange_bind'

This is my source:

import pika
connection =
pika.BlockingConnection(pika.ConnectionParameters(host='10.0.1.100'))
channel = connection.channel()
channel.exchange_bind(source='topicEx', destination='anotherEx',
routing_key='#')

I'm running pika version 0.9.5.
>>> pika.__version__
'0.9.5'

What am I missing that keeps me from being able to do exchange to exchange
bindings?

Thanks,
Dave

On Fri, Aug 10, 2012 at 11:27 AM, Gavin M. Roy wrote:

> Pika 0.9.5 does support this with the Channel.exchange_bind and
> Channel.exchange.unbind commands.
>
> On Friday, August 10, 2012 at 11:19 AM, Dave Curylo wrote:
>
> Has anyone got an example of performing exchange to exchange bindings in
> pika? I'm not sure this extension to AMQP has been implemented. If not,
> does anyone know of a python module that supports this?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/5b3d63f6/attachment.htm>

From matthias at rabbitmq.com  Thu Aug 23 04:31:25 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 Aug 2012 04:31:25 +0100
Subject: [rabbitmq-discuss] Difference betweeen rabbitmqctl and
 management plugin
In-Reply-To: <CACuA+a29dgOapV8dDcvhECm9f6BJZfenfEepK+tPLmxUoPfLKw@mail.gmail.com>
References: <CACuA+a29dgOapV8dDcvhECm9f6BJZfenfEepK+tPLmxUoPfLKw@mail.gmail.com>
Message-ID: <5035A40D.2080502@rabbitmq.com>

Seth,

On 23/08/12 02:12, Seth Mason wrote:
> Hello, I'm getting different results from the management API than I am
> from rabbitmqctl when looking at memory.
>
> GET /api/queues/test?columns=name,memory
> [
>      {
>          "memory": 17280,
>          "name": "queueone"
>      },
>      {
>          "memory": 7656,
>          "name": "queuetwo"
>      }
> ]
>
>> rabbitmqctl list_queues -p test -q name memory
> queuetwo	21952
> queueone	58560
>
>
> Is the API returning a different stat than rabbitmqctl or did I miss
> some documentation somewhere?

The stats for the management API are gathered through passive sampling - 
queues etc send stats to a collector at regular intervals when active 
and the query retrieves the stats from the collector.

The stats for rabbitmqctl are gathered by a direct query of the 
resources involved.

What you are observing above is most likely due to difference in 
hibernation behaviour induced by the different strategies.

Just before a queue goes into hibernation (due to being idle) it 
compacts some of its state, and then sends a final stats report to the 
collector. Those stats will then be returned by the management API for 
the entire duration the queue is hibernating.

By contrast, rabbitmqctl will wake up hibernating queues, which a) is 
expensive and b)  increases their memory footprint (until they hibernate 
again).

Matthias.

From matwey.kornilov at gmail.com  Thu Aug 23 10:18:34 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Thu, 23 Aug 2012 13:18:34 +0400
Subject: [rabbitmq-discuss] RabbitMQ sources release
Message-ID: <k14sha$rt7$2@ger.gmane.org>


Hi,

My question is about source tarballs rabbitmq-server-2.8.6.tar.gz 
distributed by rabbitmq.com. In this tarballs we see carefully prepared 
sources of rabbitmq and plugins.

But umbrella buildsystem requires recheckout of external git/hg repos. dot-
git and dot-hg directories are missed from release and hash.mk can't be 
generated without checkout of existing sources.

Trying to build rpm packages at opensuse build service, I face this problem. 
As for me hash.mk should be keept in rabbitmq-server-?.?.?.tar.gz and this 
would be ok.



From emile at rabbitmq.com  Thu Aug 23 12:00:42 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 23 Aug 2012 12:00:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ sources release
In-Reply-To: <k14sha$rt7$2@ger.gmane.org>
References: <k14sha$rt7$2@ger.gmane.org>
Message-ID: <50360D5A.9050109@rabbitmq.com>

Hi,

On 23/08/12 10:18, Matwey V. Kornilov wrote:
> My question is about source tarballs rabbitmq-server-2.8.6.tar.gz 
> distributed by rabbitmq.com. In this tarballs we see carefully prepared 
> sources of rabbitmq and plugins.
> 
> But umbrella buildsystem requires recheckout of external git/hg repos. dot-
> git and dot-hg directories are missed from release and hash.mk can't be 
> generated without checkout of existing sources.
> 
> Trying to build rpm packages at opensuse build service, I face this problem. 
> As for me hash.mk should be keept in rabbitmq-server-?.?.?.tar.gz and this 
> would be ok.

I can confirm what you are seeing. The first error I see is

  error: Couldn't resolve host 'github.com'

while no error occurs if network access is available:

$ tar xfz rabbitmq-server-2.8.6.tar.gz
$ make -C rabbitmq-server-2.8.6 VERSION=2.8.6
$ find rabbitmq-server-2.8.6 -name hash.mk

rabbitmq-server-2.8.6/plugins-src/erlang-rfc4627-wrapper/build/hash.mk
rabbitmq-server-2.8.6/plugins-src/eldap-wrapper/build/hash.mk
rabbitmq-server-2.8.6/plugins-src/webmachine-wrapper/build/hash.mk
rabbitmq-server-2.8.6/plugins-src/mochiweb-wrapper/build/hash.mk

I will file a bug to solve this. In the meantime you will need network
access to build the sources. (You should consider using the SuSE source
RPM: rabbitmq-server-2.8.6-1.suse.src.rpm)


-Emile


From matthias at rabbitmq.com  Thu Aug 23 12:35:08 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 Aug 2012 12:35:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ management plugin does not display
 message stats
In-Reply-To: <CAC3-Q1TDCjdSYGHjjyCDw9jWXN3-d+AvqrwJHLeC1Gx6cGShvA@mail.gmail.com>
References: <658e12c1-0885-43f9-9633-cbd134be2ebe@googlegroups.com>
	<50335729.5030408@rabbitmq.com>
	<CAC3-Q1Qzvj7oMgougx8AH=O6R-_xxjyq6Eq9s5MMNFyKDYg_OA@mail.gmail.com>
	<CAC3-Q1TDCjdSYGHjjyCDw9jWXN3-d+AvqrwJHLeC1Gx6cGShvA@mail.gmail.com>
Message-ID: <5036156C.1080409@rabbitmq.com>

Dharshan,

On 22/08/12 23:11, Dharshan Rangegowda wrote:
> The rabbitMQ management plugin seems to struggle under load. I have a
> dual core 4GB box with about 8000 connections and a very low message
> load. However the Management plugin website struggles with frequent
> errors.

We have made some improvements to make the management plug-in more 
responsive when the server is under load, particularly when there are 
lots of connections or queues. These will appear in a future release.

> Another quick observation - I have 8000 virtual hosts and 8000
> connections. Even when I have 0 messages the plugin seems to be very
>  intermittent about displaying data. I wonder if the plugin does not
>  handle these many virtual hosts...

As Emile noted in the other thread, you probably only need one virtual host.

Still, the management plug-in should cope with that many vhosts.

When you say that there are "0 messages" do you mean that there are zero 
message in the queues or that there are zero messages flowing in and out 
of the system? It's the latter which generates load.


Matthias.

From matthias at rabbitmq.com  Thu Aug 23 12:54:08 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 Aug 2012 12:54:08 +0100
Subject: [rabbitmq-discuss] Java client deadlock closing
	channel/connection
In-Reply-To: <4c7f92dd-e132-48c6-9674-1dbc90bdec1d@googlegroups.com>
References: <4c7f92dd-e132-48c6-9674-1dbc90bdec1d@googlegroups.com>
Message-ID: <503619E0.6080205@rabbitmq.com>

Dharshan,

On 22/08/12 19:36, dharshanr wrote:
> My java client is hitting a deadlock closing a channel or a connection.
> I have also noticed that it hangs when deleting a queue as well. I have
> noticed this error when the server has a large number of connections.
> [...]
> Memory usage is 2.3GB where the high watermark is 1.5 GB.
> [...]
> Why is the memory usage above the watermark? From what I have read
> RabbitMQ moves the messages to disk and scales that way without using
> more memory.

Connections, channels and queues all take up memory. A single connection 
and channel with heartbeating takes up about 150kb. Idle & empty queues 
take up 10-20k each; 2-3 times that when active.

Furthermore, messages do always have an in-memory footprint of a couple 
hundred bytes even when paged to disk.

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Aug 23 13:03:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 Aug 2012 13:03:37 +0100
Subject: [rabbitmq-discuss] JSONRPC-Channel Plugin and TCP Backpressure
In-Reply-To: <9C98EE036AF64CA7B4A3DCF2B46AEA40@meetme.com>
References: <9C98EE036AF64CA7B4A3DCF2B46AEA40@meetme.com>
Message-ID: <50361C19.5040805@rabbitmq.com>

Gavin,

On 22/08/12 15:53, Gavin M. Roy wrote:
> I was wondering if the JSONRPC-Channel Plugin will apply or otherwise
> show constraint in situations where the broker would normally apply TCP
> Backpressure?

Nope.

Of course you should really be using rabbitmq-web-stomp these days. 
While, afaik, that doesn't exert backpressure either right now, one day 
it might.

Matthias.


From matthias at rabbitmq.com  Thu Aug 23 15:00:36 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 Aug 2012 15:00:36 +0100
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F7F4@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87fw7hopmq.wl%francesco@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>,
	<5034CB3F.5040004@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F7BD@osl02-exc-001>,
	<5034E407.6020409@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F7F4@osl02-exc-001>
Message-ID: <50363784.5040907@rabbitmq.com>

Jon,

On 22/08/12 17:04, Jon Bergli Heier wrote:
> I just set up two new VMs with RabbitMQ and clustered them. I was still
> able to reproduce the problem, but compared to one or two tries it took
> me 12 tries (of stopping and starting nodes). I also tried disabling the other
> shovels on the shovel node (by commenting them out in the config) and removing
> all other queues and exchanges, with that it took 15 tries.
>
> I attached the results of the same commands with the new setup, qa-test1 and
> qa-test2 are the new nodes I set up. qa-test1 was the trigger in both cases.

We are pretty sure this isn't a problem with the shovel but rather some 
edge case in the combination of ha queues and confirms.

Unfortunately we still have not been able to reproduce this :(

So the next best thing we can do is grab some more state from your 
shovel destination cluster...

1) Repeat the above test with the minimal shovel config until the 
"stuck" state is reached.

2) capture both the logs and sasl logs for rabbit1 and rabbit2 - we only 
need to see what happened in this test run, so feel free to discard 
anything before then

3) run 'rabbitmqctl report > report.txt' for rabbit1 (all subsequent 
rabbitmqctl invocations below are for rabbit1 too)

4) Look for the "Channels" section in the result of (3). It should 
contain one channel with a messages_unconfirmed of 1000. Grab the pid of 
that - the first column, something looking like <rabbit1 at i.1.755.0> - 
and feed it into the following:

rabbitmqctl eval 'sys:get_status(rabbit_misc:string_to_pid("ThePid")).' 
 > channel.txt

(replacing ThePid with the pid you obtained, including the <>).

5) Look for the "Queues" section in the result of (3). It should contain 
the shovel's destination queue. Grab the pid of that - the first column 
- and feed it into the same eval as above, capturing the output in queue.txt

6) Same as (6) but this time grab the slave pid from the list of slaves 
in the 7th column and feed the eval output into slave.txt

7) Send us everything captured in the above steps


Note that some of the evals might take a few seconds to complete.


Regards,

Matthias.

From K.Ross at Resilientplc.com  Thu Aug 23 15:45:45 2012
From: K.Ross at Resilientplc.com (Kenneth Ross)
Date: Thu, 23 Aug 2012 14:45:45 +0000
Subject: [rabbitmq-discuss] .Net Client locks trying to create a channel on
	a blocked connection
Message-ID: <D1C94A3B2D4C11419728BBB11348CBEE57E03D59@RNLN-MBX01.teamphone.priv>

I'm using the RabbitMQ .Net client in C# and have noticed that if I try to create a channel (IModel) on a connection that is already established but in a blocking state then the code will just sit and wait.

Here is the C# code, nothing special:

        IModel channel = connection.CreateModel();

I've taken a look at the source of the RabbitMQ .Net Client and have traced it down to this:

Calling CreateModel() does the following:

        public IModel CreateModel()
        {
            ISession session = CreateSession();
            IFullModel model = (IFullModel)Protocol.CreateModel(session);
            model._Private_ChannelOpen("");
            return model;
        }

When model._Private_ChannelOpen(""); is called it ends up in this block of code:

SimpleBlockingRpcContinuation k = new SimpleBlockingRpcContinuation();
TransmitAndEnqueue(new Command(method, header, body), k);
return k.GetReply().Method;

The problem appears to be with the last line, which ends up trying to get the Value of a BlockingCell object, which is basically a while(true) loop like this:

get {
        lock (this) {
        while (!m_valueSet) {
        Monitor.Wait(this);
        }
       	return m_value;
        }
}

And because the m_valueSet is never true this code never returns :-( and the call to CreateModel stays in a blocked condition - presumably until the connection is unblocked.

Does anyone have any advice on how best to handle this situation?

Many thanks!

From K.Ross at Resilientplc.com  Thu Aug 23 15:48:20 2012
From: K.Ross at Resilientplc.com (Kenneth Ross)
Date: Thu, 23 Aug 2012 14:48:20 +0000
Subject: [rabbitmq-discuss] RabbitMQ Shovel config with Alternate-Exchange
Message-ID: <D1C94A3B2D4C11419728BBB11348CBEE57E04D69@RNLN-MBX01.teamphone.priv>

I'm trying to configure the Shovel plugin for RabbitMQ with a list of declarations. I have configured my remote exchange to have an alternate-exchange when I created it.
My problem is that I can't get the config file for shovel to include this argument so RabbitMQ crashes upon startup.
This is what my config looks like:
[
    {mnesia, [{dump_log_write_threshold, 100}]},
    {rabbit, [{vm_memory_high_watermark, 0.4}]},
    {rabbitmq_shovel,
        [{shovels,
            [{call_stats_shovel,
                [{sources, [{broker, "amqp://guest:guest at localhost:5672/test"},
                    {declarations,
                        [{'queue.declare', [{queue, <<"incoming">>}, durable]},
                        {'exchange.declare',[{exchange, <<"my-exchange-topic">>},{type, <<"topic">>},durable]},
                        {'queue.bind',[{exchange, <<"my-exchange-topic">>},{queue, <<"incoming">>}]}
                ]}]},
                {destinations, [{broker, "amqp://guest:guest at 172.16.3.162:5672/blah"},
                    {declarations,
                    [
                        {'queue.declare',[{queue, <<"billing">>},durable]},
                        {'exchange.declare',[{exchange, <<"my-exchange-topic">>},{type, <<"topic">>},{alternate_exchange, <<"alt">>}, durable]},
                        {'queue.bind',[{exchange, <<"my-exchange-topic">>},{queue, <<"billing">>},{routing_key, <<"physical">>}]}
                    ]}
                ]},
                {queue, <<"incoming">>},
                {ack_mode, no_ack},
                {publish_properties, [{delivery_mode, 2}]},
                {reconnect_delay, 5}
                ]}
            ]
        }]
    }
].
The problem is on the destination exchange called my-exchange-topic. If I take out the declarations section then the config file works.
This is the error:
=INFO REPORT==== 31-Jul-2012::12:15:25 === application: rabbitmq_shovel exited: {{invalid_shovel_configuration,call_stats_shovel, {invalid_parameter_value,destinations, {unknown_fields,'exchange.declare', [alternate_exchange]}}}, {rabbit_shovel,start,[normal,[]]}} type: permanent
If I leave the alternate_exchange section out of the declaration I get this error in RabbitMQ web management:
{{shutdown, {server_initiated_close,406, <<"PRECONDITION_FAILED - inequivalent arg 'alternate-exchange'for exchange 'my-exchange-topic' in vhost 'blah': received none but current is the value 'alt' of type 'longstr'">>}}, {gen_server,call, [<0.473.0>, {call, {'exchange.declare',0,<<"my-exchange-topic">>,<<"topic">>,false, true,false,false,false,[]}, none,<0.444.0>}, infinity]}}


From eliao at seegrid.com  Thu Aug 23 15:57:46 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Thu, 23 Aug 2012 14:57:46 +0000
Subject: [rabbitmq-discuss] Shovel terminated status
In-Reply-To: <50341AD0.9050103@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DC549@vmexchange02.seegrid.local>,
	<50341AD0.9050103@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD790388A7DCB43@vmexchange02.seegrid.local>

Ah I had forgotten to test the reconnect_delay parameter.  Thanks!

As for the unclosed connections, I'm looking under the "Connections" tab in the RabbitMQ Management plugin of the broker that is initiating the 3 shovels with another broker. On the broker that is initiating the connections, 'rabbitmqctl list_connections' does not return any connections and 'rabbitmqctl list_channels' returns the channels associated with the 2 running shovels. 'rabbitmqctl reset' clears the list of unclosed connections listed on the management plugin.

Every time the terminated shovel tries to reconnect, there are 6 (2*# of shovels?) more connections listed under the Connections tab.  It seems to happen (so far) only for the termination reason of "cannot redeclare exchange with different type".  I've tried to terminate shovel by deleting an exchange as well.

Also as a note, I'm testing shovel with the version of RabbitMQ that we use currently and unfortunately can't upgrade at the moment.

Thanks

Liz
________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Tuesday, August 21, 2012 7:32 PM
To: Discussions about RabbitMQ
Cc: Elizabeth Liao
Subject: Re: [rabbitmq-discuss] Shovel terminated status

Liz,

On 21/08/12 16:45, Elizabeth Liao wrote:
> Questions: In the documentation, it states that the timestamp from  $
> rabbitmqctl eval 'rabbit_shovel_status:status().' is the time when
> shovel entered the state.  I've observed this for the running and
> starting state but not for the terminated state.  The timestamp for
> the terminated state appears to be the current time.

Your config has a reconnect_delay of 1 (second), so when the shovel
initialisation fails it will attempt to reconnect after one second,
which puts the shovel in the 'starting' state, fail and go straight back
to the 'terminated' state. Then one second later the same happens. And
so on. Hence the moving timestamp.

> Additionally, it seems when a shovel is in the terminated state and
> periodically trying to reconnect, there are many connections left
> open with no active channels.

What exactly are you observing here? The number of connections returned
by 'rabbitmqctl list_connections' at the broker the shovel is connecting to?

Btw, it would be good if you conducted your testing with the latest
RabbitMQ version. Makes it easier for us to investigate any problems.


Regards,

Matthias.

From francesco at rabbitmq.com  Thu Aug 23 16:25:52 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 23 Aug 2012 16:25:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ Shovel config with
	Alternate-Exchange
In-Reply-To: <D1C94A3B2D4C11419728BBB11348CBEE57E04D69@RNLN-MBX01.teamphone.priv>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E04D69@RNLN-MBX01.teamphone.priv>
Message-ID: <87txvtd3zz.wl%francesco@rabbitmq.com>

At Thu, 23 Aug 2012 14:48:20 +0000,
Kenneth Ross wrote:
> I'm trying to configure the Shovel plugin for RabbitMQ with a list of
> declarations. I have configured my remote exchange to have an
> alternate-exchange when I created it.
> My problem is that I can't get the config file for shovel to include this
> argument so RabbitMQ crashes upon startup.
> This is what my config looks like:
> [...]

`alternate-exchange' is not a field in `exchange.declare' (it's a rabbit
extension after all).  Instead, it has to be put in the `arguments':

  {'exchange.declare',[{arguments, [{<<"alternate-exchange">>, longstr, <<"alt">>}]}, ...]}

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Thu Aug 23 16:33:59 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 23 Aug 2012 16:33:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ Shovel config with
	Alternate-Exchange
In-Reply-To: <D1C94A3B2D4C11419728BBB11348CBEE57E04D69@RNLN-MBX01.teamphone.priv>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E04D69@RNLN-MBX01.teamphone.priv>
Message-ID: <87sjbdd3mg.wl%francesco@rabbitmq.com>

One more thing:

At Thu, 23 Aug 2012 14:48:20 +0000,
Kenneth Ross wrote:
>                 [{sources, [{broker, "amqp://guest:guest at localhost:5672/test"}

If it's a local broker, you can just use the AMQP uri <amqp://test>, which will
connect via a direct connection (in other words it will sends erlang messages
directly instead of AMQP frames via TCP).

> {{shutdown, {server_initiated_close,406, <<"PRECONDITION_FAILED - inequivalent arg 'alternate-exchange'for exchange 'my-exchange-topic' in vhost 'blah': received none but current is the value 'alt' of type 'longstr'">>}}, {gen_server,call, [<0.473.0>, {call, {'exchange.declare',0,<<"my-exchange-topic">>,<<"topic">>,false, true,false,false,false,[]}, none,<0.444.0>}, infinity]}}

This error is given by the fact that you're trying to declare
`my-exchange-topic' with the shovel configuration, but the exchange is already
there.

If the resources that you need are already present, you don't need to specify
them in the shovel config.

--
Francesco * Often in error, never in doubt

From jon.bergli.heier at zisson.no  Thu Aug 23 16:37:26 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Thu, 23 Aug 2012 15:37:26 +0000
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <50363784.5040907@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87fw7hopmq.wl%francesco@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>,
	<5034CB3F.5040004@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F7BD@osl02-exc-001>,
	<5034E407.6020409@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F7F4@osl02-exc-001>,
	<50363784.5040907@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F8C2@osl02-exc-001>

Hi, thanks for the reply.

Attached the logs as requested, only 3 attempts this time (exact same setup
as yesterday, restart order was qa-test1, qa-test2, qa-test1).


Jon

________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Thursday, August 23, 2012 16:00
To: Jon Bergli Heier
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovel stops receiving acks from cluster

Jon,

On 22/08/12 17:04, Jon Bergli Heier wrote:
> I just set up two new VMs with RabbitMQ and clustered them. I was still
> able to reproduce the problem, but compared to one or two tries it took
> me 12 tries (of stopping and starting nodes). I also tried disabling the other
> shovels on the shovel node (by commenting them out in the config) and removing
> all other queues and exchanges, with that it took 15 tries.
>
> I attached the results of the same commands with the new setup, qa-test1 and
> qa-test2 are the new nodes I set up. qa-test1 was the trigger in both cases.

We are pretty sure this isn't a problem with the shovel but rather some
edge case in the combination of ha queues and confirms.

Unfortunately we still have not been able to reproduce this :(

So the next best thing we can do is grab some more state from your
shovel destination cluster...

1) Repeat the above test with the minimal shovel config until the
"stuck" state is reached.

2) capture both the logs and sasl logs for rabbit1 and rabbit2 - we only
need to see what happened in this test run, so feel free to discard
anything before then

3) run 'rabbitmqctl report > report.txt' for rabbit1 (all subsequent
rabbitmqctl invocations below are for rabbit1 too)

4) Look for the "Channels" section in the result of (3). It should
contain one channel with a messages_unconfirmed of 1000. Grab the pid of
that - the first column, something looking like <rabbit1 at i.1.755.0> -
and feed it into the following:

rabbitmqctl eval 'sys:get_status(rabbit_misc:string_to_pid("ThePid")).'
 > channel.txt

(replacing ThePid with the pid you obtained, including the <>).

5) Look for the "Queues" section in the result of (3). It should contain
the shovel's destination queue. Grab the pid of that - the first column
- and feed it into the same eval as above, capturing the output in queue.txt

6) Same as (6) but this time grab the slave pid from the list of slaves
in the 7th column and feed the eval output into slave.txt

7) Send us everything captured in the above steps


Note that some of the evals might take a few seconds to complete.


Regards,

Matthias.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: logs2.tar.gz
Type: application/x-gzip
Size: 61691 bytes
Desc: logs2.tar.gz
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120823/e2f7657c/attachment.bin>

From francesco at rabbitmq.com  Thu Aug 23 16:37:47 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 23 Aug 2012 16:37:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ Shovel config
	with	Alternate-Exchange
In-Reply-To: <87sjbdd3mg.wl%francesco@rabbitmq.com>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E04D69@RNLN-MBX01.teamphone.priv>
	<87sjbdd3mg.wl%francesco@rabbitmq.com>
Message-ID: <87r4qxd3g4.wl%francesco@rabbitmq.com>

At Thu, 23 Aug 2012 16:33:59 +0100,
Francesco Mazzoli wrote:
> <amqp://test>

I meant <amqp:///test> (otherwise you're just connecting to the host `test').

--
Francesco * Often in error, never in doubt

From matwey.kornilov at gmail.com  Thu Aug 23 16:39:51 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Thu, 23 Aug 2012 19:39:51 +0400
Subject: [rabbitmq-discuss] RabbitMQ sources release
References: <k14sha$rt7$2@ger.gmane.org> <50360D5A.9050109@rabbitmq.com>
Message-ID: <k15is8$jd5$1@ger.gmane.org>


Thankyou. spec-file doesn't matter in this situation, because you can run 
rpmbuild on your PC with network access. But I am running RPM-building on 
opensuse build service where virtual hosts have no network connections for 
security reasons.


Emile Joubert wrote:

> I will file a bug to solve this. In the meantime you will need network
> access to build the sources. (You should consider using the SuSE source
> RPM: rabbitmq-server-2.8.6-1.suse.src.rpm)



From nadeem.m.nayeck at gmail.com  Thu Aug 23 16:53:53 2012
From: nadeem.m.nayeck at gmail.com (Nadeem M Nayeck)
Date: Thu, 23 Aug 2012 19:53:53 +0400
Subject: [rabbitmq-discuss] help duplicating a rabbitmq server config
In-Reply-To: <5034DE57.6010509@rabbitmq.com>
References: <CACYm6LYdzonDPfHcL_X9Dz8gqAfAb3jecdPtjomZOxj-dQAnRA@mail.gmail.com>
	<5034DE57.6010509@rabbitmq.com>
Message-ID: <009c01cd8147$841ac360$8c504a20$@gmail.com>

Hi,

Thanks for the tip. Makes sense :) I was able to find the shovel configurations in /etc/rabbitmq/rabbitmq.config

Regards,
Nadeem

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 22 August 2012 17:28
To: Discussions about RabbitMQ
Cc: Nadeem M Nayeck
Subject: Re: [rabbitmq-discuss] help duplicating a rabbitmq server config

On 22/08/12 13:13, Nadeem M Nayeck wrote:
> Hi guys,
>
> I need some help duplicating a rabbitmq server config.
>
> I exported all the config using http://IP:55672/api/definitions 
> However, I did not see the shovel definitions in the resulting JSON. 
> Is it possible to export the shovels?

Hi Nadeem - the definitions from /api/definitions are intended to contain everything that is created at runtime - exchanges, queues, users and so on. They do not include anything from the configuration file. The way to export shovels is to copy configuration files around :-)

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


From francesco at rabbitmq.com  Thu Aug 23 16:55:07 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 23 Aug 2012 16:55:07 +0100
Subject: [rabbitmq-discuss] .Net Client locks trying to create a channel
	on	a blocked connection
In-Reply-To: <D1C94A3B2D4C11419728BBB11348CBEE57E03D59@RNLN-MBX01.teamphone.priv>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E03D59@RNLN-MBX01.teamphone.priv>
Message-ID: <87pq6hd2n8.wl%francesco@rabbitmq.com>

Hi Kenneth,

At Thu, 23 Aug 2012 14:45:45 +0000,
Kenneth Ross wrote:
> I'm using the RabbitMQ .Net client in C# and have noticed that if I try to
> create a channel (IModel) on a connection that is already established but in a
> blocking state then the code will just sit and wait.
> 
> [...]
>
> Does anyone have any advice on how best to handle this situation?

The best thing to do is simply to create a new connection when you create a new
channel, since connections from which you're publishing will always be prone to
be blocked.

--
Francesco * Often in error, never in doubt

From k.ross at resilientplc.com  Thu Aug 23 17:03:10 2012
From: k.ross at resilientplc.com (kzhen)
Date: Thu, 23 Aug 2012 09:03:10 -0700 (PDT)
Subject: [rabbitmq-discuss] .Net Client locks trying to create a channel
 on	a blocked connection
In-Reply-To: <87pq6hd2n8.wl%francesco@rabbitmq.com>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E03D59@RNLN-MBX01.teamphone.priv>
	<87pq6hd2n8.wl%francesco@rabbitmq.com>
Message-ID: <1345737789772-21598.post@n5.nabble.com>


Francesco Mazzoli-2 wrote
> 
> The best thing to do is simply to create a new connection when you create
> a new
> channel, since connections from which you're publishing will always be
> prone to
> be blocked.
> 

The guidance of Rabbit is to maintain one connection per application, which
I'm adhering to.

The application will be receiving many many requests per second so this
isn't really feasible. 

I also noticed some interesting behaviour in that I'm able to establish a
connection to a server with a memory alarm which would then result in the
connection being blocked, but the connection is still established...is there
anything I can check on the actual IConnection to see if it is in the
BLOCKED state? I couldn't see anything...



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Net-Client-locks-trying-to-create-a-channel-on-a-blocked-connection-tp21588p21598.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mpietrek at skytap.com  Thu Aug 23 17:04:31 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 23 Aug 2012 09:04:31 -0700
Subject: [rabbitmq-discuss] Using Pika's add_on_return_callback with a
	BlockingConnection?
In-Reply-To: <CACLE7izSyw7B9gEKYGeirUCCkbZ7wuAuwBwEuOdPR8DmbFVxFA@mail.gmail.com>
References: <CACLE7iwSc-NCgfL_kG5H60VAny2yQ9Yu7r0dBNf=DR1RbSxWrg@mail.gmail.com>
	<CACLE7izSyw7B9gEKYGeirUCCkbZ7wuAuwBwEuOdPR8DmbFVxFA@mail.gmail.com>
Message-ID: <CACLE7iwfBGhE8Rq165F5G43YOpwOCZ7kmy=4Xt7ddeLgBxFnDQ@mail.gmail.com>

Pinging again on this thread. Gavin?

Thanks,

Matt

On Fri, Aug 17, 2012 at 4:11 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Update on this: I came across the BlockingConnection.process_data_events()
> method, which seems to do the trick if I insert it into my loop.
>
> However, it doesn't look like an "official" API, in that I don't see it
> described anywhere, and the only search results I get for it are its
> inclusions in various callstacks.
>
> Gavin (or whomever else wants to comment): What are your thoughts on this?
>
> Thanks,
>
> Matt
>
>
> On Fri, Aug 17, 2012 at 3:52 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>
>> I'm got a scenario where I use a dedicated thread to write a series of
>> messages in a loop. This thread uses BlockingConnection, calls
>> add_on_return_callback for its channel, and when publishing, uses the
>> mandatory=True flag.
>>
>> I want to know when a message is being returned. However, I can't figure
>> out what to call within my loop to give Pika the opportunity to see the
>> Basic.Return message and invoke the callback.
>>
>> I've verified via WireShark that the Basic.Returns are coming back from
>> the broker. However, I can't figure out what the moral equivalent of
>> calling ioloop.start() is, so as to give Pika the an opportunity to process
>> the basic.return messages, but without blocking indefinitely. Just for
>> kicks I tried calling Channel.basic_get() within the loop, and (as
>> expected), I didn't get the returned message callbacks.
>>
>> Thanks,
>>
>> Matt
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120823/5b1075c8/attachment.htm>

From k.ross at resilientplc.com  Thu Aug 23 17:05:03 2012
From: k.ross at resilientplc.com (kzhen)
Date: Thu, 23 Aug 2012 09:05:03 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Shovel config
	with	Alternate-Exchange
In-Reply-To: <87r4qxd3g4.wl%francesco@rabbitmq.com>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E04D69@RNLN-MBX01.teamphone.priv>
	<87sjbdd3mg.wl%francesco@rabbitmq.com>
	<87r4qxd3g4.wl%francesco@rabbitmq.com>
Message-ID: <1345737903596-21599.post@n5.nabble.com>

*Many thanks* Francesco, you've solved my problem!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Shovel-config-with-Alternate-Exchange-tp21589p21599.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gmr at meetme.com  Thu Aug 23 17:07:53 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 23 Aug 2012 12:07:53 -0400
Subject: [rabbitmq-discuss] Using Pika's add_on_return_callback with a
 BlockingConnection?
In-Reply-To: <CACLE7iwfBGhE8Rq165F5G43YOpwOCZ7kmy=4Xt7ddeLgBxFnDQ@mail.gmail.com>
References: <CACLE7iwSc-NCgfL_kG5H60VAny2yQ9Yu7r0dBNf=DR1RbSxWrg@mail.gmail.com>
	<CACLE7izSyw7B9gEKYGeirUCCkbZ7wuAuwBwEuOdPR8DmbFVxFA@mail.gmail.com>
	<CACLE7iwfBGhE8Rq165F5G43YOpwOCZ7kmy=4Xt7ddeLgBxFnDQ@mail.gmail.com>
Message-ID: <2D6F0B9CE2EA48838789984421284A08@meetme.com>

It should be fine to invoke this directly. If it were meant to be private it'd be prefixed with an underscore. I'll note that it needs to be added to the docs.

Gavin


On Thursday, August 23, 2012 at 12:04 PM, Matt Pietrek wrote: 
> Pinging again on this thread. Gavin?
> 
> Thanks,
> 
> Matt
> 
> On Fri, Aug 17, 2012 at 4:11 PM, Matt Pietrek <mpietrek at skytap.com (mailto:mpietrek at skytap.com)> wrote:
> > Update on this: I came across the BlockingConnection.process_data_events() method, which seems to do the trick if I insert it into my loop.
> > 
> > However, it doesn't look like an "official" API, in that I don't see it described anywhere, and the only search results I get for it are its inclusions in various callstacks.
> > 
> > Gavin (or whomever else wants to comment): What are your thoughts on this?
> > 
> > Thanks,
> > 
> > Matt
> > 
> > 
> > On Fri, Aug 17, 2012 at 3:52 PM, Matt Pietrek <mpietrek at skytap.com (mailto:mpietrek at skytap.com)> wrote:
> > > I'm got a scenario where I use a dedicated thread to write a series of messages in a loop. This thread uses BlockingConnection, calls add_on_return_callback for its channel, and when publishing, uses the mandatory=True flag.
> > > 
> > > I want to know when a message is being returned. However, I can't figure out what to call within my loop to give Pika the opportunity to see the Basic.Return message and invoke the callback.
> > > 
> > > I've verified via WireShark that the Basic.Returns are coming back from the broker. However, I can't figure out what the moral equivalent of calling ioloop.start() is, so as to give Pika the an opportunity to process the basic.return messages, but without blocking indefinitely. Just for kicks I tried calling Channel.basic_get() within the loop, and (as expected), I didn't get the returned message callbacks.
> > > 
> > > Thanks,
> > > 
> > > Matt
> > > 
> > 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120823/800e02f0/attachment.htm>

From francesco at rabbitmq.com  Thu Aug 23 17:51:40 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 23 Aug 2012 17:51:40 +0100
Subject: [rabbitmq-discuss] .Net Client locks trying to create a channel
	on	a blocked connection
In-Reply-To: <1345737789772-21598.post@n5.nabble.com>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E03D59@RNLN-MBX01.teamphone.priv>
	<87pq6hd2n8.wl%francesco@rabbitmq.com>
	<1345737789772-21598.post@n5.nabble.com>
Message-ID: <87obm1d00z.wl%francesco@rabbitmq.com>

At Thu, 23 Aug 2012 09:03:10 -0700 (PDT),
kzhen wrote:
> The guidance of Rabbit is to maintain one connection per application, which
> I'm adhering to.
> 
> The application will be receiving many many requests per second so this isn't
> really feasible.

What are you trying to accomplish?  If you're creating a new exchange to publish
messages, then the blocking is sensible, since rabbit has blocked the connection
because it can't process you're messages fast enough anyway.

If you want to manage resources, you might want to keep a connection dedicated
to that for situations like that.

> I also noticed some interesting behaviour in that I'm able to establish a
> connection to a server with a memory alarm which would then result in the
> connection being blocked, but the connection is still established...is there
> anything I can check on the actual IConnection to see if it is in the BLOCKED
> state? I couldn't see anything...

No, for the connection to be blocked simply means that rabbit stops reading from
the socket, so there is no easy way to detect that.

--
Francesco * Often in error, never in doubt

From abuckner at homeaway.com  Thu Aug 23 22:12:00 2012
From: abuckner at homeaway.com (Austin Buckner)
Date: Thu, 23 Aug 2012 21:12:00 +0000
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <CC5C048B.275E%abuckner@homeaway.com>
Message-ID: <CC5C0611.2766%abuckner@homeaway.com>

So I don't know exactly what the state of this queue is but its been disconnected from all producers and consumers though still is bound to a topic but remains in the rabbit-admin?
[cid:CE2CA0BD-C504-4D0B-81E5-9718275793F1]

Clicking on that queue reveals?
[cid:2346643D-9F8A-4667-BE44-9558369F61CD]

Digging into the logs reveal?
[cid:DDC7E2F5-F366-4FDF-B7E2-8FBF1F7A24A0]


The queue can't be deleted via the admin plugin and I can't declare anymore queues with that name because its still apparently active.
My only work around at the moment is to restart the disk node which I'd rather not do. Is there a way to restart the management plugin without also restarting the node? Would that even help?
I'm on RabbitMQ 2.8.4 and Erlang R14B04 in a 1 disk node set up. Any ideas?

-Quinn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120823/cb146a1a/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ Management-2-1.png
Type: image/png
Size: 32300 bytes
Desc: RabbitMQ Management-2-1.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120823/cb146a1a/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ Management-4.png
Type: image/png
Size: 132977 bytes
Desc: RabbitMQ Management-4.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120823/cb146a1a/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: root at astapp026__var_log_rabbitmq-1.png
Type: image/png
Size: 309231 bytes
Desc: root at astapp026__var_log_rabbitmq-1.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120823/cb146a1a/attachment-0002.png>

From matthias at rabbitmq.com  Thu Aug 23 22:32:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 Aug 2012 22:32:22 +0100
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <CC5C0611.2766%abuckner@homeaway.com>
References: <CC5C0611.2766%abuckner@homeaway.com>
Message-ID: <5036A166.1060401@rabbitmq.com>

Austin,

On 23/08/12 22:12, Austin Buckner wrote:
> So I don't know exactly what the state of this queue is

Looks like it died somehow, leaving some debris behind. I'd like to know 
how it got into that state.

Please send us the complete log and sasl log starting from the time 
rabbit was last started, as well as the output of 'rabbitmqctl report'.

Regards,

Matthias.

From videlalvaro at gmail.com  Fri Aug 24 09:36:54 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 24 Aug 2012 10:36:54 +0200
Subject: [rabbitmq-discuss] Tutorials in Russian
Message-ID: <F171F58B80964C659A9DEC34D1DE7614@gmail.com>

FYI somebody is taking the time to translate the tutorials into Russian:

http://habrahabr.ru/post/150134/

I think it's time to push a multilingual tutorials site were people can submit their own translations using markdown in github ;)

See for example:

https://github.com/progit/progit

Cheers,

Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/c23178b8/attachment.htm>

From k.ross at resilientplc.com  Fri Aug 24 09:57:20 2012
From: k.ross at resilientplc.com (kzhen)
Date: Fri, 24 Aug 2012 01:57:20 -0700 (PDT)
Subject: [rabbitmq-discuss] .Net Client locks trying to create a channel
 on	a blocked connection
In-Reply-To: <87obm1d00z.wl%francesco@rabbitmq.com>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E03D59@RNLN-MBX01.teamphone.priv>
	<87pq6hd2n8.wl%francesco@rabbitmq.com>
	<1345737789772-21598.post@n5.nabble.com>
	<87obm1d00z.wl%francesco@rabbitmq.com>
Message-ID: <1345798640721-21606.post@n5.nabble.com>


Francesco Mazzoli-2 wrote
> 
> What are you trying to accomplish?  If you're creating a new exchange to
> publish
> messages, then the blocking is sensible, since rabbit has blocked the
> connection
> because it can't process you're messages fast enough anyway.
> 
> If you want to manage resources, you might want to keep a connection
> dedicated
> to that for situations like that.
> 

If the CreateModel timed out instead, or threw an exception if it couldn't
establish a connection that would be the ideal situation. As it is I'm left
with a thread just sitting there blocked, when I try to stop the windows
service that this is running in it will just sit there...for a very long
time because it can't clean this up. The channel would be used to publish
new messages. 

My app is a REST service that is called to enqueue a message, but what is
happening is that the http request will never get a response due to the
channel being blocked...

I would agree blocking makes sense, but having an overload which takes a
timeout parameter would make my life a whole lot easier! 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Net-Client-locks-trying-to-create-a-channel-on-a-blocked-connection-tp21588p21606.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From francesco at rabbitmq.com  Fri Aug 24 12:00:52 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 24 Aug 2012 12:00:52 +0100
Subject: [rabbitmq-discuss] .Net Client locks trying to create a channel
	on	a blocked connection
In-Reply-To: <1345798640721-21606.post@n5.nabble.com>
References: <D1C94A3B2D4C11419728BBB11348CBEE57E03D59@RNLN-MBX01.teamphone.priv>
	<87pq6hd2n8.wl%francesco@rabbitmq.com>
	<1345737789772-21598.post@n5.nabble.com>
	<87obm1d00z.wl%francesco@rabbitmq.com>
	<1345798640721-21606.post@n5.nabble.com>
Message-ID: <871uiw5zbv.wl%francesco@rabbitmq.com>

At Fri, 24 Aug 2012 01:57:20 -0700 (PDT),
kzhen wrote:
> If the CreateModel timed out instead, or threw an exception if it couldn't
> establish a connection that would be the ideal situation. As it is I'm left
> with a thread just sitting there blocked, when I try to stop the windows
> service that this is running in it will just sit there...for a very long time
> because it can't clean this up. The channel would be used to publish new
> messages.
> 
> My app is a REST service that is called to enqueue a message, but what is
> happening is that the http request will never get a response due to the
> channel being blocked...
> 
> I would agree blocking makes sense, but having an overload which takes a
> timeout parameter would make my life a whole lot easier!

You can set up the timeout yourself, for example by spawning a thread that will
try to do some operation and terminating it if it doesn't complete after a
certain amount of time.

I don't maintain the C# client (and I don't know much about C# either) but
introducing support for such a thing in the library would be quite a big change
and I don't it's going to happen.

--
Francesco * Often in error, never in doubt

From stammailbox at gmail.com  Fri Aug 24 12:02:59 2012
From: stammailbox at gmail.com (Mysurf Mail)
Date: Fri, 24 Aug 2012 14:02:59 +0300
Subject: [rabbitmq-discuss] rabbitmq - need assistance in planning correct
	recovery process
Message-ID: <CAJ2-Vrmjb1Qj0vzpAKFVticX_TZrzyU0zdYNP6ONFZgYnO0=pw@mail.gmail.com>

Hi,
In My app I use rabbitmq in several ways.
I want to plan it so that when the rabbitmq restarts all the application
will continue work normally.
Here are my usage of rabbitmq

1. Basic Publish / Basic subscribe
2. Rabbit RPC - cant survive restart
3. Queue delete - I get a tried to use closed channel when trying to delete
a queue

Does anyone have tips regarding how to do it ?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/67899de4/attachment.htm>

From francesco at rabbitmq.com  Fri Aug 24 12:48:20 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 24 Aug 2012 12:48:20 +0100
Subject: [rabbitmq-discuss] Shovel terminated status
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD790388A7DCB43@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DC549@vmexchange02.seegrid.local>
Message-ID: <87zk5k4ikb.wl%francesco@rabbitmq.com>

Hi Elizabeth,

At Thu, 23 Aug 2012 14:57:46 +0000,
Elizabeth Liao wrote:
> 
> As for the unclosed connections, I'm looking under the "Connections" tab in
> the RabbitMQ Management plugin of the broker that is initiating the 3 shovels
> with another broker. On the broker that is initiating the connections,
> 'rabbitmqctl list_connections' does not return any connections and
> 'rabbitmqctl list_channels' returns the channels associated with the 2 running
> shovels. 'rabbitmqctl reset' clears the list of unclosed connections listed on
> the management plugin.
> 
> Every time the terminated shovel tries to reconnect, there are 6 (2*# of
> shovels?) more connections listed under the Connections tab.  It seems to
> happen (so far) only for the termination reason of "cannot redeclare exchange
> with different type".  I've tried to terminate shovel by deleting an exchange
> as well.

I can reproduce this, it's a bug in the management plugin - the connections
*are* being closed, but management still displays them (in other words, nothing
too worrying).

Thanks for the report.

--
Francesco * Often in error, never in doubt

From m.luchak at smartasking.com  Fri Aug 24 14:20:35 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 24 Aug 2012 09:20:35 -0400 (EDT)
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client hangs
	on declare exchange
Message-ID: <1345814435.057821021@apps.rackspace.com>


Hi All,
 
We have a very annoying intermittent bug where our java client hangs when declaring an exchange.  We couldn't find a timeout or wait in the channel class... Is there a way to set/get a session timeout?
 

 - No firewalls or load balancers
 - Very low CPU and memory usage
 

=ERROR REPORT==== 24-Aug-2012::12:40:17 ===
closing AMQP connection <0.22988.7> (XXXXXXXX:28335 -> XXXXXX:5672):
{inet_error,etimedout}
 
 
RabbitMQ Status:
 

[{pid,9764},
{running_applications,
[{rabbitmq_management,"RabbitMQ Management Console","2.8.5"},
{rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.5"},
{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.8.5"},
{rabbit,"RabbitMQ","2.8.5"},
{mnesia,"MNESIA  CXC 138 12","4.4.17"},
{os_mon,"CPO  CXC 138 46","2.2.5"},
{rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.5"},
{webmachine,"webmachine","1.9.1-rmq2.8.5-git52e62bc"},
{mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.5-gitd541e9a"},
{inets,"INETS  CXC 138 49","5.5.2"},
{xmerl,"XML parser","1.2.8"},
{sasl,"SASL  CXC 138 11","2.1.9.3"},
{amqp_client,"RabbitMQ AMQP Client","2.8.5"},
{stdlib,"ERTS  CXC 138 10","1.17.3"},
{kernel,"ERTS  CXC 138 10","2.14.3"}]},
{os,{unix,linux}},
{erlang_version,
"Erlang R14B02 (erts-5.8.3) [source] [64-bit] [rq:1] [async-threads:30] [kernel-poll:true]\n"},
{memory,
[{total,41330968},
{processes,17077520},
{processes_used,16335960},
{system,24253448},
{atom,1537521},
{atom_used,1523741},
{binary,120088},
{code,17080343},
{ets,4172512}]},
{vm_memory_high_watermark,0.39999999935564245},
{vm_memory_limit,248309350},
{disk_free_limit,1000000000},
{disk_free,5325369344},
{file_descriptors,
[{total_limit,924},
{total_used,35},
{sockets_limit,829},
{sockets_used,15}]},
{processes,[{limit,1048576},{used,335}]},
{run_queue,0},
{uptime,1815593}]
 
 
thanks,
 
Matthew
 
 


 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/eeb36688/attachment.htm>

From steve at rabbitmq.com  Fri Aug 24 15:10:48 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 24 Aug 2012 15:10:48 +0100
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
	hangs on declare exchange
In-Reply-To: <1345814435.057821021@apps.rackspace.com>
References: <1345814435.057821021@apps.rackspace.com>
Message-ID: <26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>

Hi Matthew,

It is hard to debug this without some Java information. Can you take a
jstack dump of the JVM BEFORE you kill it and AFTER it hangs? This will
give us some idea of what threads are waiting for what.

It is hard to see how this could happen if the connection has been
closed by the server, though it is not clear if the ERROR REPORT you
give is dated/timed after the Java Client has hung for a bit, or happens
before and CAUSES the hang. Can you determine which from the time of the
log entry?

We will endeavour to help.
All (aka Steve Powell---a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 24 Aug 2012, at 14:20, m.luchak at smartasking.com wrote:

> Hi All,
>  
> We have a very annoying intermittent bug where our java client hangs when declaring an exchange.  We couldn't find a timeout or wait in the channel class... Is there a way to set/get a session timeout?
>  
> - No firewalls or load balancers
> - Very low CPU and memory usage
> 
>  
> =ERROR REPORT==== 24-Aug-2012::12:40:17 ===
> closing AMQP connection <0.22988.7> (XXXXXXXX:28335 -> XXXXXX:5672):
> {inet_error,etimedout}
>  
>  
> RabbitMQ Status:
>  
> [{pid,9764},
> {running_applications,
> [{rabbitmq_management,"RabbitMQ Management Console","2.8.5"},
> {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.5"},
> {rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.8.5"},
> {rabbit,"RabbitMQ","2.8.5"},
> {mnesia,"MNESIA  CXC 138 12","4.4.17"},
> {os_mon,"CPO  CXC 138 46","2.2.5"},
> {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.5"},
> {webmachine,"webmachine","1.9.1-rmq2.8.5-git52e62bc"},
> {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.5-gitd541e9a"},
> {inets,"INETS  CXC 138 49","5.5.2"},
> {xmerl,"XML parser","1.2.8"},
> {sasl,"SASL  CXC 138 11","2.1.9.3"},
> {amqp_client,"RabbitMQ AMQP Client","2.8.5"},
> {stdlib,"ERTS  CXC 138 10","1.17.3"},
> {kernel,"ERTS  CXC 138 10","2.14.3"}]},
> {os,{unix,linux}},
> {erlang_version,
> "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [rq:1] [async-threads:30] [kernel-poll:true]\n"},
> {memory,
> [{total,41330968},
> {processes,17077520},
> {processes_used,16335960},
> {system,24253448},
> {atom,1537521},
> {atom_used,1523741},
> {binary,120088},
> {code,17080343},
> {ets,4172512}]},
> {vm_memory_high_watermark,0.39999999935564245},
> {vm_memory_limit,248309350},
> {disk_free_limit,1000000000},
> {disk_free,5325369344},
> {file_descriptors,
> [{total_limit,924},
> {total_used,35},
> {sockets_limit,829},
> {sockets_used,15}]},
> {processes,[{limit,1048576},{used,335}]},
> {run_queue,0},
> {uptime,1815593}]
> 
>  
> thanks,
>  
> Matthew
>  
>  
> 
>  
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/1b9c1dc9/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 24 15:25:46 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 15:25:46 +0100
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <CC5CF202.27AE%abuckner@homeaway.com>
References: <CC5CF202.27AE%abuckner@homeaway.com>
Message-ID: <50378EEA.8040203@rabbitmq.com>

Austin,

(putting the list back on cc)

On 24/08/12 15:00, Austin Buckner wrote:
> Here you go. Logs are in the dropbox, report in the attachment.

Thanks. So the real error is this one:

{{badmatch,{error,{"/mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/8MI54YI371K8SV2BJU48PDDQ5",
                                        eexist}}},
                      [{rabbit_queue_index,delete_and_terminate,1},
                       {rabbit_variable_queue,delete_and_terminate,2},
                       {rabbit_amqqueue_process,'-terminate/2-fun-2-',4},
                       {rabbit_amqqueue_process,terminate_shutdown,2},
                       {gen_server2,terminate,3},
                       {gen_server2,handle_msg,2},
                       {proc_lib,wake_up,3}]}

For some reason rabbit failed to delete the queue's index directory when 
the queue was deleted. It got an "the file already exists" error which 
is odd and would seem to indicate that the recursive delete somehow 
managed to miss one of the files in the dir.

Could you send me the output of 'ls -ltar' on the directory mentioned above?

Regards,

Matthias.

From matthias at rabbitmq.com  Fri Aug 24 15:29:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 15:29:57 +0100
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <50378EEA.8040203@rabbitmq.com>
References: <CC5CF202.27AE%abuckner@homeaway.com>
	<50378EEA.8040203@rabbitmq.com>
Message-ID: <50378FE5.2050206@rabbitmq.com>

On 24/08/12 15:25, Matthias Radestock wrote:
> Could you send me the output of 'ls -ltar' on the directory mentioned
> above?

Er, I meant "ls -ltaR".

Matthias.

From m.luchak at smartasking.com  Fri Aug 24 15:44:07 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 24 Aug 2012 10:44:07 -0400 (EDT)
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
	hangs on declare exchange
In-Reply-To: <26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>
References: <1345814435.057821021@apps.rackspace.com> 
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>
Message-ID: <1345819447.6797775@apps.rackspace.com>


Thanks Steve,
 
Unfortunately this is an intermittent bug AND it is (we think) occuring only over a 3G connection on Android.  We have ACRA running for logs but the app doesn't crash - just hangs - so ACRA doesn't kick in.
 
We also have a background consumer thread running on the device which  still receives messages when the foreground thread hangs.
 
But, is there really no timeout in the java client that will at least fail rather than hang? There is, I believe, a timeout on the server so... what in theory would happen if the server closed the AMQP connection {inet_error,etimedout} and the client was connecting?  In theory would this cause the client to hang?
 
 
thanks,
Matthew
 
 
 
-----Original Message-----
From: "Steve Powell" <steve at rabbitmq.com>
Sent: Friday, August 24, 2012 10:10am
To: m.luchak at smartasking.com
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client hangs on declare exchange


Hi Matthew,

It is hard to debug this without some Java information. Can you take a
jstack dump of the JVM BEFORE you kill it and AFTER it hangs? This will
give us some idea of what threads are waiting for what.
It is hard to see how this could happen if the connection has been
closed by the server, though it is not clear if the ERROR REPORT you
give is dated/timed after the Java Client has hung for a bit, or happens
before and CAUSES the hang. Can you determine which from the time of the
log entry?
We will endeavour to help.









All (aka Steve Powell---a happy bunny)

----------yet more definitions from the SPD----------corrugate (n.) T.V. soap scandal.
 olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.


On 24 Aug 2012, at 14:20, [mailto:m.luchak at smartasking.com] m.luchak at smartasking.com wrote:

Hi All,
 
We have a very annoying intermittent bug where our java client hangs when declaring an exchange.  We couldn't find a timeout or wait in the channel class... Is there a way to set/get a session timeout?
 
 
 - No firewalls or load balancers
 - Very low CPU and memory usage
 
 
=ERROR REPORT==== 24-Aug-2012::12:40:17 ===
closing AMQP connection <0.22988.7> (XXXXXXXX:28335 -> XXXXXX:5672):
{inet_error,etimedout}
 
 
RabbitMQ Status:
 
 
[{pid,9764},
{running_applications,
[{rabbitmq_management,"RabbitMQ Management Console","2.8.5"},
{rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.5"},
{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.8.5"},
{rabbit,"RabbitMQ","2.8.5"},
{mnesia,"MNESIA  CXC 138 12","4.4.17"},
{os_mon,"CPO  CXC 138 46","2.2.5"},
{rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.5"},
{webmachine,"webmachine","1.9.1-rmq2.8.5-git52e62bc"},
{mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.5-gitd541e9a"},
{inets,"INETS  CXC 138 49","5.5.2"},
{xmerl,"XML parser","1.2.8"},
{sasl,"SASL  CXC 138 11","2.1.9.3"},
{amqp_client,"RabbitMQ AMQP Client","2.8.5"},
{stdlib,"ERTS  CXC 138 10","1.17.3"},
{kernel,"ERTS  CXC 138 10","2.14.3"}]},
{os,{unix,linux}},
{erlang_version,
"Erlang R14B02 (erts-5.8.3) [source] [64-bit] [rq:1] [async-threads:30] [kernel-poll:true]\n"},
{memory,
[{total,41330968},
{processes,17077520},
{processes_used,16335960},
{system,24253448},
{atom,1537521},
{atom_used,1523741},
{binary,120088},
{code,17080343},
{ets,4172512}]},
{vm_memory_high_watermark,0.39999999935564245},
{vm_memory_limit,248309350},
{disk_free_limit,1000000000},
{disk_free,5325369344},
{file_descriptors,
[{total_limit,924},
{total_used,35},
{sockets_limit,829},
{sockets_used,15}]},
{processes,[{limit,1048576},{used,335}]},
{run_queue,0},
{uptime,1815593}]
 
 
thanks,
 
Matthew
 
 


 

_______________________________________________
rabbitmq-discuss mailing list
[mailto:rabbitmq-discuss at lists.rabbitmq.com] rabbitmq-discuss at lists.rabbitmq.com
[https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss] https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/d084856d/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 24 15:55:52 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 15:55:52 +0100
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
 hangs on declare exchange
In-Reply-To: <1345819447.6797775@apps.rackspace.com>
References: <1345814435.057821021@apps.rackspace.com>
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>
	<1345819447.6797775@apps.rackspace.com>
Message-ID: <503795F8.3060503@rabbitmq.com>

Matthew,

On 24/08/12 15:44, m.luchak at smartasking.com wrote:
> what in theory would happen if the server closed the AMQP
> connection {inet_error,etimedout} and the client was connecting?  In
> theory would this cause the client to hang?

It shouldn't, i.e. the client should see the socket close. etimedout is 
the kind of error that is indicative of network problems though, and in 
some cases these can take quite a while to be noticed by the parties. 
Configuring the clients to enable AMQP heartbeats is one way of 
addressing that problem.

Regards,

Matthias.

From abuckner at homeaway.com  Fri Aug 24 16:28:25 2012
From: abuckner at homeaway.com (Austin Buckner)
Date: Fri, 24 Aug 2012 15:28:25 +0000
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <50378FE5.2050206@rabbitmq.com>
Message-ID: <CC5D0792.27C9%abuckner@homeaway.com>

Doesn't look like
/mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/8MI54YI3
71K8SV2BJU48PDDQ5 exists

On 8/24/12 9:29 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 24/08/12 15:25, Matthias Radestock wrote:
>> Could you send me the output of 'ls -ltar' on the directory mentioned
>> above?
>
>Er, I meant "ls -ltaR".
>
>Matthias.
>


From matthias.reik at gmail.com  Fri Aug 24 16:30:44 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Fri, 24 Aug 2012 17:30:44 +0200
Subject: [rabbitmq-discuss] Excessive memory consumption of one server in
	cluster setup
Message-ID: <CAJ1JW0dTk8R68R+xmZ6HOZZN9v9HrvmKEr3TD2igbQgAcVQDbg@mail.gmail.com>

Hi,

2 days ago I have upgraded our RabbitMQ cluster (2 machines running in HA
mode) from 2.8.1 to 2.8.5.
Mainly to get those OOD fixes in, since we experienced those exact issues.

The upgrade went very smooth, but at some point one of the machines
(server2) started to allocate more
and more memory (even though all queues are more or less at 0 with almost
no outstanding acks)

server 1 uses ~200Mb
server 2 (at the point where I took it down) used ~6Gb

I run a rabbitmqctl report... but it didn't give me any insights
I run a rabbitmqctl eval 'erlang:memory().' but that didn't tell me too
much more (but I will attach that at the end)

I found people with similar problems:
http://grokbase.com/t/rabbitmq/rabbitmq-discuss/1223qcx3gg/rabbitmq-memory-usage-in-two-node-cluster
but that's a while back so many things might have changed since then. Also
the memory difference was
rather minimal, whereas here the difference is _very_ significant,
especially since the node with less load
has the increased memory footprint.

I can upgrade to 2.8.6 (unfortunately I upgraded just before it was
released :-(), but I only want to do that if
there is some hope that the problem is solved.
I can bring server2 back online and try to investigate what is consuming
that much memory, but my
RabbitMQ/Erlang knowledge is not good enough, therefore reaching out for
some help.

So any help would be much appreciated.

Thx
Matthias

Our setup is something like the following:
      2 servers exclusively running RabbitMQ on CentOS 5.x (high watermark
~22Gb),
            - both with web-console enabled
            - both defined as disk nodes
            - both running RabbitMQ 2.8.5 on Erlang R15B01 (after the
upgrade, Erlang was already at R15 before)
    10 queues configured with mirroring
      3 queues configured (without mirroring) only on server1 with a TTL
    Most consumers are connecting to server1, server2 only in case of
failover

We get about 1k messages/sec (with peaks much higher than that) into the
system, and each message is
passed through several queues for processing.

-bash-3.2$ sbin/rabbitmqctl eval 'erlang:memory().'
[{total,5445584424},
 {processes,2184155418},
 {processes_used,2184122352},
 {system,3261429006},
 {atom,703377},
 {atom_used,678425},
 {binary,3216386480},
 {code,17978535},
 {ets,4142048}]
...done.

PS: Sorry for the eventual spam (caused by mail-box mix up :-(
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/3e936e1f/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 24 16:32:52 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 16:32:52 +0100
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <CC5D06AC.27C4%abuckner@homeaway.com>
References: <CC5D06AC.27C4%abuckner@homeaway.com>
Message-ID: <50379EA4.1030005@rabbitmq.com>

On 24/08/12 16:25, Austin Buckner wrote:
> Doesn't look like
> /mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/8MI54YI3
> 71K8SV2BJU48PDDQ5 exists

Ah, sorry, that one was from an earlier fault on 14th August. Try
/mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/2PQ758ATP80LLMCCE806NG6JK

Regards,

Matthias.

From matthias.reik at gmail.com  Fri Aug 24 16:34:41 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Fri, 24 Aug 2012 17:34:41 +0200
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
 hangs on declare exchange
In-Reply-To: <503795F8.3060503@rabbitmq.com>
References: <1345814435.057821021@apps.rackspace.com>
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>
	<1345819447.6797775@apps.rackspace.com>
	<503795F8.3060503@rabbitmq.com>
Message-ID: <CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com>

We had a similar issue (I think we where running 2.6.1 or so)... the
exchange/queue declare did eventually happen (after quite a long time).
The same code run just fine on another computer (so we suspected that it
was unrelated to RabbitMQ. After having investigated the issue
for quite a while it turned out to be due to the IPv6 stack timing out (the
routing was set up the wrong way.

Just mentioning it, because it might be a similar issue...

Cheers
Maze

On Fri, Aug 24, 2012 at 4:55 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Matthew,
>
>
> On 24/08/12 15:44, m.luchak at smartasking.com wrote:
>
>> what in theory would happen if the server closed the AMQP
>> connection {inet_error,etimedout} and the client was connecting?  In
>> theory would this cause the client to hang?
>>
>
> It shouldn't, i.e. the client should see the socket close. etimedout is
> the kind of error that is indicative of network problems though, and in
> some cases these can take quite a while to be noticed by the parties.
> Configuring the clients to enable AMQP heartbeats is one way of addressing
> that problem.
>
> Regards,
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/f0c5fbec/attachment.htm>

From francesco at rabbitmq.com  Fri Aug 24 16:43:25 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 24 Aug 2012 16:43:25 +0100
Subject: [rabbitmq-discuss] Excessive memory consumption of one server
	in	cluster setup
In-Reply-To: <CAJ1JW0dTk8R68R+xmZ6HOZZN9v9HrvmKEr3TD2igbQgAcVQDbg@mail.gmail.com>
References: <CAJ1JW0dTk8R68R+xmZ6HOZZN9v9HrvmKEr3TD2igbQgAcVQDbg@mail.gmail.com>
Message-ID: <87wr0o47oi.wl%francesco@rabbitmq.com>

Hi Matthias,

Can you please post the logs and `rabbitmqctl report'?  It's almost impossible
to help you without those.

Could you also try to reproduce the issue with less things going on (e.g. only
one queue) and describe in detail what you're doing to trigger the problem?
Thanks.

At Fri, 24 Aug 2012 17:30:44 +0200,
Matthias Reik wrote:
> I can upgrade to 2.8.6 (unfortunately I upgraded just before it was released
> :-(), but I only want to do that if there is some hope that the problem is
> solved.

There weren't any HA related leaks fixed in 2.8.6, so I don't think upgrading
will fix the problem.  However it would make our work much easier, so please
upgrade if you can.

--
Francesco * Often in error, never in doubt

From abuckner at homeaway.com  Fri Aug 24 16:48:38 2012
From: abuckner at homeaway.com (Austin Buckner)
Date: Fri, 24 Aug 2012 15:48:38 +0000
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <50379EA4.1030005@rabbitmq.com>
Message-ID: <CC5D0C1F.27D2%abuckner@homeaway.com>

# ls -ltaR
/mnt/netapp12/rabbitmq_test/mnesia/rabbit\@diskrabbit01-test/queues/2PQ758A
TP80LLMCCE806NG6JK/
/mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/2PQ758AT
P80LLMCCE806NG6JK/:
total 20
drwxr-xr-x 136 rabbitmq rabbitmq 16384 Aug 24 10:43 ..
drwxr-xr-x   2 rabbitmq rabbitmq  4096 Aug 23 13:14 .


Looks like the only difference between this dir and the rest is that its
missing the journal.jif file
-Quinn


On 8/24/12 10:32 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 24/08/12 16:25, Austin Buckner wrote:
>> Doesn't look like
>>
>>/mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/8MI54Y
>>I3
>> 71K8SV2BJU48PDDQ5 exists
>
>Ah, sorry, that one was from an earlier fault on 14th August. Try
>/mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/2PQ758A
>TP80LLMCCE806NG6JK
>
>Regards,
>
>Matthias.
>


From matthias.reik at gmail.com  Fri Aug 24 16:59:29 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Fri, 24 Aug 2012 17:59:29 +0200
Subject: [rabbitmq-discuss] Excessive memory consumption of one server
 in cluster setup
In-Reply-To: <87wr0o47oi.wl%francesco@rabbitmq.com>
References: <CAJ1JW0dTk8R68R+xmZ6HOZZN9v9HrvmKEr3TD2igbQgAcVQDbg@mail.gmail.com>
	<87wr0o47oi.wl%francesco@rabbitmq.com>
Message-ID: <CAJ1JW0deczsCKmRGtO-YRNP66C1+xvaTgtqoK-PwGCpyX=OQuw@mail.gmail.com>

Thx Francsco,

I send you the files directly (don't want to make them public, even thought
they don't contain
anything super secret.

I hope that's ok

Cheers
Matthias


On Fri, Aug 24, 2012 at 5:43 PM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> Hi Matthias,
>
> Can you please post the logs and `rabbitmqctl report'?  It's almost
> impossible
> to help you without those.
>
> Could you also try to reproduce the issue with less things going on (e.g.
> only
> one queue) and describe in detail what you're doing to trigger the problem?
> Thanks.
>
> At Fri, 24 Aug 2012 17:30:44 +0200,
> Matthias Reik wrote:
> > I can upgrade to 2.8.6 (unfortunately I upgraded just before it was
> released
> > :-(), but I only want to do that if there is some hope that the problem
> is
> > solved.
>
> There weren't any HA related leaks fixed in 2.8.6, so I don't think
> upgrading
> will fix the problem.  However it would make our work much easier, so
> please
> upgrade if you can.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/6b9316f1/attachment.htm>

From francesco at rabbitmq.com  Fri Aug 24 17:10:33 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 24 Aug 2012 17:10:33 +0100
Subject: [rabbitmq-discuss] Excessive memory consumption of one server
	in cluster setup
In-Reply-To: <CAJ1JW0deczsCKmRGtO-YRNP66C1+xvaTgtqoK-PwGCpyX=OQuw@mail.gmail.com>
References: <CAJ1JW0dTk8R68R+xmZ6HOZZN9v9HrvmKEr3TD2igbQgAcVQDbg@mail.gmail.com>
	<87wr0o47oi.wl%francesco@rabbitmq.com>
	<CAJ1JW0deczsCKmRGtO-YRNP66C1+xvaTgtqoK-PwGCpyX=OQuw@mail.gmail.com>
Message-ID: <87vcg846fa.wl%francesco@rabbitmq.com>

Thanks.  I'm going home, and Monday is bank holiday in the UK, so I'll have a
look at this on Tuesday.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Fri Aug 24 17:13:09 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 24 Aug 2012 17:13:09 +0100
Subject: [rabbitmq-discuss] Excessive memory consumption of one
	server	in cluster setup
In-Reply-To: <87vcg846fa.wl%francesco@rabbitmq.com>
References: <CAJ1JW0dTk8R68R+xmZ6HOZZN9v9HrvmKEr3TD2igbQgAcVQDbg@mail.gmail.com>
	<87wr0o47oi.wl%francesco@rabbitmq.com>
	<CAJ1JW0deczsCKmRGtO-YRNP66C1+xvaTgtqoK-PwGCpyX=OQuw@mail.gmail.com>
	<87vcg846fa.wl%francesco@rabbitmq.com>
Message-ID: <87txvs46ay.wl%francesco@rabbitmq.com>

At Fri, 24 Aug 2012 17:10:33 +0100,
Francesco Mazzoli wrote:
> 
> Thanks.  I'm going home, and Monday is bank holiday in the UK, so I'll have a
> look at this on Tuesday.

Oh well, I didn't realise that you posted that message in the mailing list.  As
you say, they shouldn't contain anything secret :).

--
Francesco * Often in error, never in doubt

From johnson at edocom.cn  Fri Aug 24 17:30:01 2012
From: johnson at edocom.cn (johnson)
Date: Sat, 25 Aug 2012 00:30:01 +0800
Subject: [rabbitmq-discuss] How to achieve HA consumers?
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <201208250029598551536@edocom.cn>

Hi,

One problem I encountered is how to achieve HA consumers. My situation is the following.

I installed 1 consumer in a server to consume the messages. But in the production environment, to avoid the unexceptional crash of the consumer, I need to install another consumer in another server. However, because the order of the messages are very important, if two consumers receive the messages simultaneously, the order cannot be reserved.

Maybe the following 2 way can work.
1: At the same time, the server only sends the message to 1 consumer. After that consumer return a ACK, the server send the message to another consumer. This means that although two consumers exist, they receive the messages in turn not concurrently. Once 1 consumer crashes, the remaining consumer can still work.

2: 2 consumers work like master-slave. Only 1 consumer works and the other one doesn't consume any message. Once 1 consumer crashes, the remaining consumer will be activated.

I have searched a lot of RabbitMQ docs and couldn't find useful info. Could anyone can give me some clue? Thanks a lot.




johnson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120825/f05ce57a/attachment.htm>

From maze at reik.se  Fri Aug 24 13:25:42 2012
From: maze at reik.se (Matthias Reik)
Date: Fri, 24 Aug 2012 14:25:42 +0200
Subject: [rabbitmq-discuss] Excessive memory consumption of one server in
	cluster setup
Message-ID: <503772C6.8080700@reik.se>

Hi,

2 days ago I have upgraded our RabbitMQ cluster (2 machines running in 
HA mode) from 2.8.1 to 2.8.5.
Mainly to get those OOD fixes in, since we experienced those exact issues.

The upgrade went very smooth, but at some point one of the machines 
(server2) started to allocate more
and more memory (even though all queues are more or less at 0 with 
almost no outstanding acks)

server 1 uses ~200Mb
server 2 (at the point where I took it down) used ~6Gb

I run a rabbitmqctl report... but it didn't give me any insights
I run a rabbitmqctl eval 'erlang:memory().' but that didn't tell me too 
much more (but I will attach that at the end)

I found people with similar problems:
http://grokbase.com/t/rabbitmq/rabbitmq-discuss/1223qcx3gg/rabbitmq-memory-usage-in-two-node-cluster 

but that's a while back so many things might have changed since then. 
Also the memory difference was
rather minimal, whereas here the difference is _very_ significant, 
especially since the node with less load
has the increased memory footprint.

I can upgrade to 2.8.6 (unfortunately I upgraded just before it was 
released :-(), but I only want to do that if
there is some hope that the problem is solved.
I can bring server2 back online and try to investigate what is consuming 
that much memory, but my
RabbitMQ/Erlang knowledge is not good enough, therefore reaching out for 
some help.

So any help would be much appreciated.

Thx
Matthias

Our setup is something like the following:
       2 servers exclusively running RabbitMQ on CentOS 5.x (high 
watermark ~22Gb),
             - both with web-console enabled
             - both defined as disk nodes
             - both running RabbitMQ 2.8.5 on Erlang R15B01 (after the 
upgrade, Erlang was already at R15 before)
     10 queues configured with mirroring
       3 queues configured (without mirroring) only on server1 with a TTL
     Most consumers are connecting to server1, server2 only in case of 
failover

We get about 1k messages/sec (with peaks much higher than that) into the 
system, and each message is
passed through several queues for processing.

-bash-3.2$ sbin/rabbitmqctl eval 'erlang:memory().'
[{total,5445584424},
  {processes,2184155418},
  {processes_used,2184122352},
  {system,3261429006},
  {atom,703377},
  {atom_used,678425},
  {binary,3216386480},
  {code,17978535},
  {ets,4142048}]
...done.

From matthias at rabbitmq.com  Fri Aug 24 17:55:50 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 17:55:50 +0100
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <CC5D0C1F.27D2%abuckner@homeaway.com>
References: <CC5D0C1F.27D2%abuckner@homeaway.com>
Message-ID: <5037B216.6010807@rabbitmq.com>

Austin,

On 24/08/12 16:48, Austin Buckner wrote:
> # ls -ltaR
> /mnt/netapp12/rabbitmq_test/mnesia/rabbit\@diskrabbit01-test/queues/2PQ758A
> TP80LLMCCE806NG6JK/
> /mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/2PQ758AT
> P80LLMCCE806NG6JK/:
> total 20
> drwxr-xr-x 136 rabbitmq rabbitmq 16384 Aug 24 10:43 ..
> drwxr-xr-x   2 rabbitmq rabbitmq  4096 Aug 23 13:14 .
>
>
> Looks like the only difference between this dir and the rest is that its
> missing the journal.jif file

Curious. So one plausible sequence of events is this:

1. queue gets deleted
2. rabbit attempts a recursive queue deletion by...
2.1 getting the dir listing
2.2 deleting all the files
2.3 deleting the dir - bang! the dir still has files in it
3. some time later the remaining file(s) in the dir vanish

I wonder whether there is some peculiar filesystem issue here. Noting 
the /mnt prefix, are these dirs nfs mounted or on some other sort of 
network storage?


To get you going again, it may be sufficient to delete the dir manually; 
you might then be able to re-declare a queue with the same name.

But given that the fault occurred before, it's likely going to occur again.


Regards,

Matthias.

From mpietrek at skytap.com  Fri Aug 24 18:34:41 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 24 Aug 2012 10:34:41 -0700
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
In-Reply-To: <50359EE6.6070000@rabbitmq.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<50359EE6.6070000@rabbitmq.com>
Message-ID: <CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>

I was able to reproduce this in exactly the same way with 2.8.6 and Erlang
R15B01.

Here's the log from rabbit at play.log. When play2 goes down and comes back
up, the 'unit_test' queue (the only queue with messages) disappears.

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
rabbit on node rabbit at play2 down

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'unit_test' in vhost '/'): Slave <rabbit at play.1.261.0>
saw deaths of mirrors <rabbit at play2.2.2550.0>

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
rabbit on node rabbit at play2 up

=ERROR REPORT==== 24-Aug-2012::10:29:12 ===
** Generic server <0.261.0> terminating
** Last message in was {'$gen_cast',{gm,{length,3}}}
** When Server state == {state,
                         {amqqueue,
                          {resource,<<"/">>,queue,<<"unit_test">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <3299.2457.0>,
                          [<3298.2550.0>],
                          all},
                         <0.262.0>,<3299.2457.0>,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          0,
                          {0,nil},
                          undefined,
                          {0,nil},
                          {qistate,
                           "/home/mpietrek/work/var/lib/rabbit at play
/queues/5CPQWZ6GS6L07B10CDNMTM42C",
                           {{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            []},
                           undefined,0,262144,
                           #Fun<rabbit_variable_queue.2.121033067>,
                           {0,nil}},
                          {{client_msstate,msg_store_persistent,

<<61,29,142,33,178,251,167,19,151,135,213,43,204,
                              197,156,123>>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,327753,
                             "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_persistent"},
                            rabbit_msg_store_ets_index,
                            "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_persistent",
                            <0.255.0>,331850,323656,335947,340044},
                           {client_msstate,msg_store_transient,

<<41,125,255,66,12,1,141,122,87,67,196,42,155,134,
                              88,81>>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,307268,
                             "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_transient"},
                            rabbit_msg_store_ets_index,
                            "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_transient",
                            <0.250.0>,311365,303144,315462,319559}},

true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
                          0,infinity,0,0,0,0,0,
                          {rates,
                           {{1345,829346,423057},0},
                           {{1345,829346,423057},0},
                           0.0,0.0,
                           {1345,829348,736018}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          0,0,
                          {rates,
                           {{1345,829346,423057},0},
                           {{1345,829346,423057},0},
                           0.0,0.0,
                           {1345,829348,736018}}},
                         undefined,undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         0,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         true}
** Reason for termination ==
** {function_clause,
       [{rabbit_mirror_queue_slave,set_synchronised,
            [false,
             {state,
                 {amqqueue,
                     {resource,<<"/">>,queue,<<"unit_test">>},
                     true,false,none,
                     [{<<"x-ha-policy">>,longstr,<<"all">>}],
                     <3299.2457.0>,
                     [<3298.2550.0>],
                     all},
                 <0.262.0>,<3299.2457.0>,rabbit_variable_queue,
                 {vqstate,
                     {0,{[],[]}},
                     {0,{[],[]}},
                     {delta,undefined,0,undefined},
                     {0,{[],[]}},
                     {0,{[],[]}},
                     0,
                     {0,nil},
                     undefined,
                     {0,nil},
                     {qistate,
                         "/home/mpietrek/work/var/lib/rabbit at play
/queues/5CPQWZ6GS6L07B10CDNMTM42C",
                         {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                          []},
                         undefined,0,262144,
                         #Fun<rabbit_variable_queue.2.121033067>,
                         {0,nil}},
                     {{client_msstate,msg_store_persistent,

<<61,29,142,33,178,251,167,19,151,135,213,43,204,197,
                            156,123>>,
                          {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                          {state,327753,
                              "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_persistent"},
                          rabbit_msg_store_ets_index,
                          "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_persistent",
                          <0.255.0>,331850,323656,335947,340044},
                      {client_msstate,msg_store_transient,

<<41,125,255,66,12,1,141,122,87,67,196,42,155,134,88,
                            81>>,
                          {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                          {state,307268,
                              "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_transient"},
                          rabbit_msg_store_ets_index,
                          "/home/mpietrek/work/var/lib/rabbit at play
/msg_store_transient",
                          <0.250.0>,311365,303144,315462,319559}},
                     true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
                     infinity,0,0,0,0,0,
                     {rates,
                         {{1345,829346,423057},0},
                         {{1345,829346,423057},0},
                         0.0,0.0,
                         {1345,829348,736018}},
                     {0,nil},
                     {0,nil},
                     {0,nil},
                     {0,nil},
                     0,0,
                     {rates,
                         {{1345,829346,423057},0},
                         {{1345,829346,423057},0},
                         0.0,0.0,
                         {1345,829348,736018}}},
                 undefined,undefined,
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 0,
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 true}],
            []},
        {rabbit_mirror_queue_slave,process_instruction,2,[]},
        {rabbit_mirror_queue_slave,handle_cast,2,[]},
        {gen_server2,handle_msg,2,[]},
        {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}



On Wed, Aug 22, 2012 at 8:09 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Matt,
>
>
> On 22/08/12 23:06, Matt Pietrek wrote:
>
>> I'm experiencing a consistently reproducible scenario where an HA queue
>> disappears when a node rejoins the cluster. This is using RabbitMQ 2.8.5
>> and Erlang R15B01.
>>
>
> please try reproducing this with 2.8.6.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/682fc7a3/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 24 18:51:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 18:51:57 +0100
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
 cluster
In-Reply-To: <CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<50359EE6.6070000@rabbitmq.com>
	<CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>
Message-ID: <5037BF3D.3050809@rabbitmq.com>

Matt,

On 24/08/12 18:34, Matt Pietrek wrote:
> I was able to reproduce this in exactly the same way with 2.8.6 and
> Erlang R15B01.

Thanks.

> Here's the log from rabbit at play.log. When play2 goes down and comes back
> up, the 'unit_test' queue (the only queue with messages) disappears.

Just to confirm, the queues are mirrored across *three* nodes - play, 
play2 and util, right?

The logs for play and util from around the same time might offer us some 
more clues.

Matthias.

From Michael.Laing at nytimes.com  Fri Aug 24 18:54:15 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 24 Aug 2012 13:54:15 -0400
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <201208250029598551536@edocom.cn>
Message-ID: <CC5D3606.43E0%Michael.Laing@nytimes.com>

I use your option 1: below, which works well.

All critical services drive from HA queues and have at least one worker (consumer) connected to each node in the cluster. RabbitMQ round-robins messages to the workers. If a worker or node fails, its message is routed to another worker.

Michael
From: johnson <johnson at edocom.cn<mailto:johnson at edocom.cn>>
Reply-To: johnson <johnson at edocom.cn<mailto:johnson at edocom.cn>>, rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Fri, 24 Aug 2012 12:30:01 -0400
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] How to achieve HA consumers?

Hi,

One problem I encountered is how to achieve HA consumers. My situation is the following.

I installed 1 consumer in a server to consume the messages. But in the production environment, to avoid the unexceptional crash of the consumer, I need to install another consumer in another server. However, because the order of the messages are very important, if two consumers receive the messages simultaneously, the order cannot be reserved.

Maybe the following 2 way can work.
1: At the same time, the server only sends the message to 1 consumer. After that consumer return a ACK, the server send the message to another consumer. This means that although two consumers exist, they receive the messages in turn not concurrently. Once 1 consumer crashes, the remaining consumer can still work.

2: 2 consumers work like master-slave. Only 1 consumer works and the other one doesn't consume any message. Once 1 consumer crashes, the remaining consumer will be activated.

I have searched a lot of RabbitMQ docs and couldn't find useful info. Could anyone can give me some clue? Thanks a lot.

________________________________
johnson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/a4740f29/attachment.htm>

From mpietrek at skytap.com  Fri Aug 24 19:22:46 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 24 Aug 2012 11:22:46 -0700
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
In-Reply-To: <5037BF3D.3050809@rabbitmq.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<50359EE6.6070000@rabbitmq.com>
	<CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>
	<5037BF3D.3050809@rabbitmq.com>
Message-ID: <CACLE7iwsVvy2k5xJj4hgeBkDx3aoupdohRqOfJpUQcgdR6NjTA@mail.gmail.com>

> The logs for play and util from around the same time might offer us some
more clues.

What I sent was rabbit at play.log.

rabbit at play2.log doesn't look nearly as interesting:

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Memory limit set to 399MB of 999MB total.

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Disk free limit set to 100MB

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 24-Aug-2012::10:29:12 ===
msg_store_persistent: recovery terms differ from present
rebuilding indices from scratch

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Adding mirror of queue 'unit_test' in vhost '/' on node rabbit at play2:
<0.261.0>

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Adding mirror of queue 'test' in vhost '/' on node rabbit at play2: <0.263.0>

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Adding mirror of queue 'XXXX' in vhost '/' on node rabbit at play2: <0.266.0>

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Adding mirror of queue 'XYZZY' in vhost '/' on node rabbit at play2: <0.268.0>

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Adding mirror of queue 'system_test' in vhost '/' on node rabbit at play2:
<0.271.0>

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
rabbit on node rabbit at play up

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
rabbit on node rabbit at util up

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Management agent started.

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Management plugin started. Port: 55672, path: /

And here is rabbit at util.log
=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'charon' in vhost '/'): Slave <rabbit at util.3.262.0>
saw deaths of mirrors <rabbit at play2.2.271.0>

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave
<rabbit at util.3.262.0> to master

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'system_test' in vhost '/'): Slave
<rabbit at util.3.264.0> saw deaths of mirrors <rabbit at play2.2.273.0>

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'system_test' in vhost '/'): Promoting slave
<rabbit at util.3.264.0> to master

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
rabbit on node rabbit at play2 down

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave <rabbit at util.3.258.0>
saw deaths of mirrors <rabbit at play2.2.267.0>

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave
<rabbit at util.3.258.0> to master

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave
<rabbit at util.3.260.0> saw deaths of mirrors <rabbit at play2.2.269.0>

=INFO REPORT==== 24-Aug-2012::10:29:06 ===
Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting slave
<rabbit at util.3.260.0> to master

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
Mirrored-queue (queue 'unit_test' in vhost '/'): Master
<rabbit at util.3.2457.0> saw deaths of mirrors <rabbit at play2.3.261.0>

=INFO REPORT==== 24-Aug-2012::10:29:12 ===
rabbit on node rabbit at play2 up



On Fri, Aug 24, 2012 at 10:51 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Matt,
>
>
> On 24/08/12 18:34, Matt Pietrek wrote:
>
>> I was able to reproduce this in exactly the same way with 2.8.6 and
>> Erlang R15B01.
>>
>
> Thanks.
>
>
>  Here's the log from rabbit at play.log. When play2 goes down and comes back
>> up, the 'unit_test' queue (the only queue with messages) disappears.
>>
>
> Just to confirm, the queues are mirrored across *three* nodes - play,
> play2 and util, right?
>
> The logs for play and util from around the same time might offer us some
> more clues.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/a6238aaa/attachment.htm>

From Michael.Laing at nytimes.com  Fri Aug 24 20:12:02 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 24 Aug 2012 15:12:02 -0400
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <CC5D3606.43E0%Michael.Laing@nytimes.com>
Message-ID: <CC5D4911.440E%Michael.Laing@nytimes.com>

Actually, rereading, perhaps my solution is different from yours?

From: Michael Laing <Michael.Laing at nytimes.com<mailto:Michael.Laing at nytimes.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Fri, 24 Aug 2012 13:54:15 -0400
To: johnson <johnson at edocom.cn<mailto:johnson at edocom.cn>>, rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] How to achieve HA consumers?

I use your option 1: below, which works well.

All critical services drive from HA queues and have at least one worker (consumer) connected to each node in the cluster. RabbitMQ round-robins messages to the workers. If a worker or node fails, its message is routed to another worker.

Michael
From: johnson <johnson at edocom.cn<mailto:johnson at edocom.cn>>
Reply-To: johnson <johnson at edocom.cn<mailto:johnson at edocom.cn>>, rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Fri, 24 Aug 2012 12:30:01 -0400
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] How to achieve HA consumers?

Hi,

One problem I encountered is how to achieve HA consumers. My situation is the following.

I installed 1 consumer in a server to consume the messages. But in the production environment, to avoid the unexceptional crash of the consumer, I need to install another consumer in another server. However, because the order of the messages are very important, if two consumers receive the messages simultaneously, the order cannot be reserved.

Maybe the following 2 way can work.
1: At the same time, the server only sends the message to 1 consumer. After that consumer return a ACK, the server send the message to another consumer. This means that although two consumers exist, they receive the messages in turn not concurrently. Once 1 consumer crashes, the remaining consumer can still work.

2: 2 consumers work like master-slave. Only 1 consumer works and the other one doesn't consume any message. Once 1 consumer crashes, the remaining consumer will be activated.

I have searched a lot of RabbitMQ docs and couldn't find useful info. Could anyone can give me some clue? Thanks a lot.

________________________________
johnson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/b037f329/attachment.htm>

From abuckner at homeaway.com  Fri Aug 24 20:42:37 2012
From: abuckner at homeaway.com (Austin Buckner)
Date: Fri, 24 Aug 2012 19:42:37 +0000
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <5037B216.6010807@rabbitmq.com>
Message-ID: <CC5D42D5.27FE%abuckner@homeaway.com>

Thanks! Deleting that directory cleared up our issue of having to recreate
a queue with the same name.

But I agree this has happened once so it will probably happen again.

The dirs are nfs mounted.

-Quinn

On 8/24/12 11:55 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Austin,
>
>On 24/08/12 16:48, Austin Buckner wrote:
>> # ls -ltaR
>>
>>/mnt/netapp12/rabbitmq_test/mnesia/rabbit\@diskrabbit01-test/queues/2PQ75
>>8A
>> TP80LLMCCE806NG6JK/
>>
>>/mnt/netapp12/rabbitmq_test/mnesia/rabbit at diskrabbit01-test/queues/2PQ758
>>AT
>> P80LLMCCE806NG6JK/:
>> total 20
>> drwxr-xr-x 136 rabbitmq rabbitmq 16384 Aug 24 10:43 ..
>> drwxr-xr-x   2 rabbitmq rabbitmq  4096 Aug 23 13:14 .
>>
>>
>> Looks like the only difference between this dir and the rest is that its
>> missing the journal.jif file
>
>Curious. So one plausible sequence of events is this:
>
>1. queue gets deleted
>2. rabbit attempts a recursive queue deletion by...
>2.1 getting the dir listing
>2.2 deleting all the files
>2.3 deleting the dir - bang! the dir still has files in it
>3. some time later the remaining file(s) in the dir vanish
>
>I wonder whether there is some peculiar filesystem issue here. Noting
>the /mnt prefix, are these dirs nfs mounted or on some other sort of
>network storage?
>
>
>To get you going again, it may be sufficient to delete the dir manually;
>you might then be able to re-declare a queue with the same name.
>
>But given that the fault occurred before, it's likely going to occur
>again.
>
>
>Regards,
>
>Matthias.
>


From m.luchak at smartasking.com  Fri Aug 24 20:54:24 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 24 Aug 2012 15:54:24 -0400 (EDT)
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
	hangs on declare exchange
In-Reply-To: <CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com>
References: <1345814435.057821021@apps.rackspace.com> 
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com> 
	<1345819447.6797775@apps.rackspace.com> <503795F8.3060503@rabbitmq.com>
	<CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com>
Message-ID: <1345838064.01971026@apps.rackspace.com>


Thanks Maze,
 
We have tracked it down to a wait() while declaring an exchange that never completes...
 
com.rabbitmq.client.impl.AMQChannel

private AMQCommand privateRpc(Method m)
 throws IOException, ShutdownSignalException
 {
 SimpleBlockingRpcContinuation k = new SimpleBlockingRpcContinuation();
 rpc(m, k);
 // At this point, the request method has been sent, and we
 // should wait for the reply to arrive.
 //
 // Calling getReply() on the continuation puts us to sleep
 // until the connection's reader-thread throws the reply over
 // the fence.
 return k.getReply();
 }
 
This k.getReply(); jumps through a number of basically empty methods and eventually terminates with another endless wait() that (only on 3G and intermittently) never fulfills. The exchange gets declared but the return is "lost"..
 
We are looking at modifying the client .jar to call a wait with a timeout... I'll keep you updated


 
-----Original Message-----
From: "Matthias Reik" <matthias.reik at gmail.com>
Sent: Friday, August 24, 2012 11:34am
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client hangs on declare exchange



We had a similar issue (I think we where running 2.6.1 or so)... the exchange/queue declare did eventually happen (after quite a long time).
The same code run just fine on another computer (so we suspected that it was unrelated to RabbitMQ. After having investigated the issue
 for quite a while it turned out to be due to the IPv6 stack timing out (the routing was set up the wrong way.

Just mentioning it, because it might be a similar issue...

Cheers
Maze


On Fri, Aug 24, 2012 at 4:55 PM, Matthias Radestock <[mailto:matthias at rabbitmq.com] matthias at rabbitmq.com> wrote:
Matthew,


 On 24/08/12 15:44, [mailto:m.luchak at smartasking.com] m.luchak at smartasking.com wrote:
what in theory would happen if the server closed the AMQP
 connection {inet_error,etimedout} and the client was connecting?  In
 theory would this cause the client to hang?
It shouldn't, i.e. the client should see the socket close. etimedout is the kind of error that is indicative of network problems though, and in some cases these can take quite a while to be noticed by the parties. Configuring the clients to enable AMQP heartbeats is one way of addressing that problem.

 Regards,

 Matthias.


 ______________________________ _________________
 rabbitmq-discuss mailing list
[mailto:rabbitmq-discuss at lists.rabbitmq.com] rabbitmq-discuss at lists. rabbitmq.com
[https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss] https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/be675829/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 24 20:59:02 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 20:59:02 +0100
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
 hangs on declare exchange
In-Reply-To: <1345838064.01971026@apps.rackspace.com>
References: <1345814435.057821021@apps.rackspace.com>
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>
	<1345819447.6797775@apps.rackspace.com>
	<503795F8.3060503@rabbitmq.com>
	<CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com>
	<1345838064.01971026@apps.rackspace.com>
Message-ID: <5037DD06.8010402@rabbitmq.com>

On 24/08/12 20:54, m.luchak at smartasking.com wrote:
> We are looking at modifying the client .jar to call a wait with a
> timeout... I'll keep you updated

Why not try enabling heartbeats, as I suggested?


Matthias.


From m.luchak at smartasking.com  Fri Aug 24 21:11:39 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 24 Aug 2012 16:11:39 -0400 (EDT)
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
	hangs on declare exchange
In-Reply-To: <5037DD06.8010402@rabbitmq.com>
References: <1345814435.057821021@apps.rackspace.com>  
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>  
	<1345819447.6797775@apps.rackspace.com> <503795F8.3060503@rabbitmq.com>
	<CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com> 
	<1345838064.01971026@apps.rackspace.com>
	<5037DD06.8010402@rabbitmq.com>
Message-ID: <1345839099.19474010@apps.rackspace.com>


heartbeats are enabled...
 
-----Original Message-----
From: "Matthias Radestock" <matthias at rabbitmq.com>
Sent: Friday, August 24, 2012 3:59pm
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: m.luchak at smartasking.com
Subject: Re: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client hangs on declare exchange



On 24/08/12 20:54, m.luchak at smartasking.com wrote:
> We are looking at modifying the client .jar to call a wait with a
> timeout... I'll keep you updated

Why not try enabling heartbeats, as I suggested?


Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/e17cd8f0/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 24 21:26:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 21:26:37 +0100
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
 hangs on declare exchange
In-Reply-To: <1345839099.19474010@apps.rackspace.com>
References: <1345814435.057821021@apps.rackspace.com>
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>
	<1345819447.6797775@apps.rackspace.com>
	<503795F8.3060503@rabbitmq.com>
	<CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com>
	<1345838064.01971026@apps.rackspace.com>
	<5037DD06.8010402@rabbitmq.com>
	<1345839099.19474010@apps.rackspace.com>
Message-ID: <5037E37D.8020200@rabbitmq.com>

On 24/08/12 21:11, m.luchak at smartasking.com wrote:
> heartbeats are enabled...

That's very odd then. If the exchange.declare-ok doesn't make it back to 
the client then neither should heartbeats. Missed heartbeats ought to 
result in the client library tearing down everything associated with the 
connection and release any threads waiting for replies.

Matthias.

From m.luchak at smartasking.com  Fri Aug 24 21:49:41 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 24 Aug 2012 16:49:41 -0400 (EDT)
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
	hangs on declare exchange
In-Reply-To: <5037E37D.8020200@rabbitmq.com>
References: <1345814435.057821021@apps.rackspace.com>   
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>   
	<1345819447.6797775@apps.rackspace.com> <503795F8.3060503@rabbitmq.com>
	<CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com> 
	<1345838064.01971026@apps.rackspace.com>
	<5037DD06.8010402@rabbitmq.com> 
	<1345839099.19474010@apps.rackspace.com>
	<5037E37D.8020200@rabbitmq.com>
Message-ID: <1345841381.315321185@apps.rackspace.com>


I couldn't agree more ;)  this is very odd and extremelly annoying ;)
 
While the client wait() is well, waiting, the device receives incoming messages - so there is a connection and the heartbeat is running normally and happily.
 
As this only happens on a slow connection (3G) and intermittently I am working on the assumption that the reply has been sent but has been dropped somewhere... really stretching it there, but I can't seem to find any other explanaition as exchangeDeclare creates new exchanges 100% of the time but only  returns a OK "some of the time".... sigh...
 
BTW, In the Javadocs there is an Exchange.Declare with a nowait boolean :
AMQImpl.Exchange.Declare(int ticket, java.lang.String exchange, java.lang.String  type, boolean passive, boolean durable, boolean autoDelete, boolean internal,  boolean nowait, java.util.Map<java.lang.String,java.lang.Object>  arguments)
 
However, this option is not available in the 2.8.1 or 2.8.6 .jar files or source files... can anyone tell me if this overide is in a  nightly build and/or if it's irrelevant to the task at hand?
 
thanks all,
 
Matthew
 
-----Original Message-----
From: "Matthias Radestock" <matthias at rabbitmq.com>
Sent: Friday, August 24, 2012 4:26pm
To: m.luchak at smartasking.com
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client hangs on declare exchange



On 24/08/12 21:11, m.luchak at smartasking.com wrote:
> heartbeats are enabled...

That's very odd then. If the exchange.declare-ok doesn't make it back to 
the client then neither should heartbeats. Missed heartbeats ought to 
result in the client library tearing down everything associated with the 
connection and release any threads waiting for replies.

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/bf95810f/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 24 22:08:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 22:08:44 +0100
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
 hangs on declare exchange
In-Reply-To: <1345841381.315321185@apps.rackspace.com>
References: <1345814435.057821021@apps.rackspace.com>
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>
	<1345819447.6797775@apps.rackspace.com>
	<503795F8.3060503@rabbitmq.com>
	<CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com>
	<1345838064.01971026@apps.rackspace.com>
	<5037DD06.8010402@rabbitmq.com>
	<1345839099.19474010@apps.rackspace.com>
	<5037E37D.8020200@rabbitmq.com>
	<1345841381.315321185@apps.rackspace.com>
Message-ID: <5037ED5C.1020104@rabbitmq.com>

Matthew,

On 24/08/12 21:49, m.luchak at smartasking.com wrote:
> While the client wait() is well, waiting, the device receives incoming
> messages - so there is a connection and the heartbeat is running
> normally and happily.

The latter is on a different connection though, right? i.e. you are not 
receiving messages on the same connection that has a stuck 
exchange.declare, are you? That would be odder still.

> BTW, In the Javadocs there is an Exchange.Declare with a nowait boolean :
>
> AMQImpl.Exchange.Declare(int ticket, java.lang.String exchange,
> java.lang.String type, boolean passive, boolean durable, boolean
> autoDelete, boolean internal, boolean nowait,
> java.util.Map<java.lang.String,java.lang.Object> arguments)
>
> However, this option is not available in the 2.8.1 or 2.8.6 .jar files
> or source files... can anyone tell me if this overide is in a  nightly
> build and/or if it's irrelevant to the task at hand?

Most synchronous AMQP commands have an async variant, triggered by 
setting the nowait flag. We don't expose convenience methods for that in 
the API but you can use Channel.asyncRpc(Method method) to send commands 
like that, e.g.

import com.rabbitmq.client.impl.AMQImpl.Exchange;

         channel.asyncRpc(new Exchange.Declare.Builder()
                          .exchange("myexchange")
                          .type("direct")
                          .nowait(true)
                          .build());

Matthias.

From m.luchak at smartasking.com  Fri Aug 24 22:28:20 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 24 Aug 2012 17:28:20 -0400 (EDT)
Subject: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client
	hangs on declare exchange
In-Reply-To: <5037ED5C.1020104@rabbitmq.com>
References: <1345814435.057821021@apps.rackspace.com>    
	<26603DCF-23C8-4883-A093-10D6D7CA14EC@rabbitmq.com>    
	<1345819447.6797775@apps.rackspace.com> <503795F8.3060503@rabbitmq.com>
	<CAJ1JW0evsM_w+=VQa4mdAm_-gTJdaFr7v40o6+ixB0+60FjUng@mail.gmail.com> 
	<1345838064.01971026@apps.rackspace.com>
	<5037DD06.8010402@rabbitmq.com> 
	<1345839099.19474010@apps.rackspace.com> 
	<5037E37D.8020200@rabbitmq.com> 
	<1345841381.315321185@apps.rackspace.com>
	<5037ED5C.1020104@rabbitmq.com>
Message-ID: <1345843700.011921319@apps.rackspace.com>


Hi Matthias,
 
I didn't believe it at first either ;) Our java lead got a little pissed as I kept demanding proof that it was the same connection hehe... there are seperate channels on one connection...
 
brilliant - async it is for now... I really need to remove this showstopper and come back to the cause later - crashes aren't good, but, having someone's phone just hang there is a killer!!  As the exchanges are getting created 100% of the time I can live without a reply..
 
thanks for all your help,
Matthew
 
-----Original Message-----
From: "Matthias Radestock" <matthias at rabbitmq.com>
Sent: Friday, August 24, 2012 5:08pm
To: m.luchak at smartasking.com
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Intermittent Problem - 2.8.5 java client hangs on declare exchange



Matthew,

On 24/08/12 21:49, m.luchak at smartasking.com wrote:
> While the client wait() is well, waiting, the device receives incoming
> messages - so there is a connection and the heartbeat is running
> normally and happily.

The latter is on a different connection though, right? i.e. you are not 
receiving messages on the same connection that has a stuck 
exchange.declare, are you? That would be odder still.

> BTW, In the Javadocs there is an Exchange.Declare with a nowait boolean :
>
> AMQImpl.Exchange.Declare(int ticket, java.lang.String exchange,
> java.lang.String type, boolean passive, boolean durable, boolean
> autoDelete, boolean internal, boolean nowait,
> java.util.Map<java.lang.String,java.lang.Object> arguments)
>
> However, this option is not available in the 2.8.1 or 2.8.6 .jar files
> or source files... can anyone tell me if this overide is in a  nightly
> build and/or if it's irrelevant to the task at hand?

Most synchronous AMQP commands have an async variant, triggered by 
setting the nowait flag. We don't expose convenience methods for that in 
the API but you can use Channel.asyncRpc(Method method) to send commands 
like that, e.g.

import com.rabbitmq.client.impl.AMQImpl.Exchange;

 channel.asyncRpc(new Exchange.Declare.Builder()
 .exchange("myexchange")
 .type("direct")
 .nowait(true)
 .build());

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/76d44ad7/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 24 22:48:55 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Aug 2012 22:48:55 +0100
Subject: [rabbitmq-discuss] Possible disconnected queue?
In-Reply-To: <CC5D42D5.27FE%abuckner@homeaway.com>
References: <CC5D42D5.27FE%abuckner@homeaway.com>
Message-ID: <5037F6C7.4000703@rabbitmq.com>

Austin,

On 24/08/12 20:42, Austin Buckner wrote:
> Thanks! Deleting that directory cleared up our issue of having to
> recreate a queue with the same name.

Glad to hear that worked.

> But I agree this has happened once so it will probably happen again.

It's happened more than once - the dir I had mentioned earlier was the
cause of fault on 14th August. So that's at least two faults. I haven't 
checked any older sasl logs, but I wouldn't be surprised to find more 
instances there.

> The dirs are nfs mounted.

That most likely has something to do with the problem. I am not an NFS
expert, but iirc NFS can depart from POSIX behaviour in some
circumstances; no idea whether this scenario is one of them. Could also
be a buggy nfs implementation. Or perhaps some unusual nfs configuration.

Matthias.

From johnson at edocom.cn  Sat Aug 25 02:37:19 2012
From: johnson at edocom.cn (johnson)
Date: Sat, 25 Aug 2012 09:37:19 +0800
Subject: [rabbitmq-discuss] How to achieve HA consumers?
References: <CC5D4911.440E%Michael.Laing@nytimes.com>
Message-ID: <201208250937187791132@edocom.cn>

Thanks, Michael. Actually round-robins dispatching doesn't fit my situation well. If two consumers exist, they will get the message almost in the same time. In this way, the order of the messages cannot be assured. I wonder if there is some way that the server will send the message the second consumer only after it receives the ACK from the first consumer.




johnson

From: Laing, Michael P.
Date: 2012-08-25 03:12
To: rabbitmq; johnson
Subject: Re: [rabbitmq-discuss] How to achieve HA consumers?
Actually, rereading, perhaps my solution is different from yours?


From: Michael Laing <Michael.Laing at nytimes.com>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com>
Date: Fri, 24 Aug 2012 13:54:15 -0400
To: johnson <johnson at edocom.cn>, rabbitmq <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] How to achieve HA consumers?



I use your option 1: below, which works well.


All critical services drive from HA queues and have at least one worker (consumer) connected to each node in the cluster. RabbitMQ round-robins messages to the workers. If a worker or node fails, its message is routed to another worker.


Michael
From: johnson <johnson at edocom.cn>
Reply-To: johnson <johnson at edocom.cn>, rabbitmq <rabbitmq-discuss at lists.rabbitmq.com>
Date: Fri, 24 Aug 2012 12:30:01 -0400
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com>
Subject: [rabbitmq-discuss] How to achieve HA consumers?



Hi,

One problem I encountered is how to achieve HA consumers. My situation is the following.

I installed 1 consumer in a server to consume the messages. But in the production environment, to avoid the unexceptional crash of the consumer, I need to install another consumer in another server. However, because the order of the messages are very important, if two consumers receive the messages simultaneously, the order cannot be reserved.

Maybe the following 2 way can work.
1: At the same time, the server only sends the message to 1 consumer. After that consumer return a ACK, the server send the message to another consumer. This means that although two consumers exist, they receive the messages in turn not concurrently. Once 1 consumer crashes, the remaining consumer can still work.

2: 2 consumers work like master-slave. Only 1 consumer works and the other one doesn't consume any message. Once 1 consumer crashes, the remaining consumer will be activated.

I have searched a lot of RabbitMQ docs and couldn't find useful info. Could anyone can give me some clue? Thanks a lot.




johnson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120825/d8623ea0/attachment.htm>

From yuva670 at gmail.com  Mon Aug 27 08:58:54 2012
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Mon, 27 Aug 2012 13:28:54 +0530
Subject: [rabbitmq-discuss] Non-blocking Consumers approach
Message-ID: <CAPrynAVmxoa5eEtQFfgghCWsAUbQVtjrZAtqtaH9G0W2ESGseg@mail.gmail.com>

Hi,

We used RabbitMQ to implement a simple producer-consumer architecture.
It was fine until very recently, when we encountered the blocking
calls. I ran two nodes in a cluster; in cases where the consumer took
more than the usual time and all subsequent messages kept on waiting.
Then, I came to know that I used QueuingConsumer which is a blocking
architecture, now I know I have to use my own implementation of the
DefaultConsumer. But, I am clueless as to whether I should manage the
threading model or the RabbitMQ itself has any provision on that.
Another thing that is confusing is, whether we run different type of
consumers (with different duties) separately or we maintain a single
main class which will start consumers as the messages come in.



Thanks in advance,
Mahesh

From tim at rabbitmq.com  Mon Aug 27 10:17:08 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 27 Aug 2012 10:17:08 +0100
Subject: [rabbitmq-discuss] Non-blocking Consumers approach
In-Reply-To: <CAPrynAVmxoa5eEtQFfgghCWsAUbQVtjrZAtqtaH9G0W2ESGseg@mail.gmail.com>
References: <CAPrynAVmxoa5eEtQFfgghCWsAUbQVtjrZAtqtaH9G0W2ESGseg@mail.gmail.com>
Message-ID: <080D7020-EEC9-4044-8085-0C4A83591DF0@rabbitmq.com>

Hi Mahesh,

On 27 Aug 2012, at 08:58, Mahesh Viraktamath wrote:

> Hi,
> 
> We used RabbitMQ to implement a simple producer-consumer architecture.
> It was fine until very recently, when we encountered the blocking
> calls. I ran two nodes in a cluster; in cases where the consumer took
> more than the usual time and all subsequent messages kept on waiting.
> Then, I came to know that I used QueuingConsumer which is a blocking
> architecture, now I know I have to use my own implementation of the
> DefaultConsumer. But, I am clueless as to whether I should manage the
> threading model or the RabbitMQ itself has any provision on that.
> Another thing that is confusing is, whether we run different type of
> consumers (with different duties) separately or we maintain a single
> main class which will start consumers as the messages come in.
> 

Have you read the API guide (http://www.rabbitmq.com/api-guide.html) for details about threading and using your own executor service? That's probably a good place to start. The latter question (about choosing how to structure your code) is really something you'll have to decide yourself, based on the responsibilities of each class and whether or not and to what extent separation makes sense in the design.

Cheers,
Tim 

From matthias.reik at gmail.com  Mon Aug 27 10:26:19 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Mon, 27 Aug 2012 11:26:19 +0200
Subject: [rabbitmq-discuss] Excessive memory consumption of one server
 in cluster setup
In-Reply-To: <503772C6.8080700@reik.se>
References: <503772C6.8080700@reik.se>
Message-ID: <CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>

I just upgraded to 2.8.6, and I see the same effect with the latest version
:-(
(not really unexpected, since nothing was fixed in that regard in 2.8.6).

Already after about 10 minutes server2 consumes 200% more memory than
server1,
even though all clients are connected to server1, and there are no queues
with TTL anymore.

(removing the other queues is unfortunately not possible, since it's a
production
server :-(, and I haven't seen this effect on any of our other
(development) servers)

Cheers
Matthias

On Fri, Aug 24, 2012 at 2:25 PM, Matthias Reik <maze at reik.se> wrote:

> Hi,
>
> 2 days ago I have upgraded our RabbitMQ cluster (2 machines running in HA
> mode) from 2.8.1 to 2.8.5.
> Mainly to get those OOD fixes in, since we experienced those exact issues.
>
> The upgrade went very smooth, but at some point one of the machines
> (server2) started to allocate more
> and more memory (even though all queues are more or less at 0 with almost
> no outstanding acks)
>
> server 1 uses ~200Mb
> server 2 (at the point where I took it down) used ~6Gb
>
> I run a rabbitmqctl report... but it didn't give me any insights
> I run a rabbitmqctl eval 'erlang:memory().' but that didn't tell me too
> much more (but I will attach that at the end)
>
> I found people with similar problems:
> http://grokbase.com/t/**rabbitmq/rabbitmq-discuss/**
> 1223qcx3gg/rabbitmq-memory-**usage-in-two-node-cluster<http://grokbase.com/t/rabbitmq/rabbitmq-discuss/1223qcx3gg/rabbitmq-memory-usage-in-two-node-cluster>
> but that's a while back so many things might have changed since then. Also
> the memory difference was
> rather minimal, whereas here the difference is _very_ significant,
> especially since the node with less load
> has the increased memory footprint.
>
> I can upgrade to 2.8.6 (unfortunately I upgraded just before it was
> released :-(), but I only want to do that if
> there is some hope that the problem is solved.
> I can bring server2 back online and try to investigate what is consuming
> that much memory, but my
> RabbitMQ/Erlang knowledge is not good enough, therefore reaching out for
> some help.
>
> So any help would be much appreciated.
>
> Thx
> Matthias
>
> Our setup is something like the following:
>       2 servers exclusively running RabbitMQ on CentOS 5.x (high watermark
> ~22Gb),
>             - both with web-console enabled
>             - both defined as disk nodes
>             - both running RabbitMQ 2.8.5 on Erlang R15B01 (after the
> upgrade, Erlang was already at R15 before)
>     10 queues configured with mirroring
>       3 queues configured (without mirroring) only on server1 with a TTL
>     Most consumers are connecting to server1, server2 only in case of
> failover
>
> We get about 1k messages/sec (with peaks much higher than that) into the
> system, and each message is
> passed through several queues for processing.
>
> -bash-3.2$ sbin/rabbitmqctl eval 'erlang:memory().'
> [{total,5445584424},
>  {processes,2184155418},
>  {processes_used,2184122352},
>  {system,3261429006},
>  {atom,703377},
>  {atom_used,678425},
>  {binary,3216386480},
>  {code,17978535},
>  {ets,4142048}]
> ...done.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120827/2e741165/attachment.htm>

From matthias.reik at gmail.com  Mon Aug 27 10:55:38 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Mon, 27 Aug 2012 11:55:38 +0200
Subject: [rabbitmq-discuss] Excessive memory consumption of one server
 in cluster setup
In-Reply-To: <CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>
References: <503772C6.8080700@reik.se>
	<CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>
Message-ID: <CAJ1JW0e=3fWjRYfDHr9+bodynYn6xg=gOk4sL8_Q-b=e1ki-KQ@mail.gmail.com>

Just to make sure, I stopped the application, reset it, and rejoined the
cluster (on server2).
Thus, any "old" information in mnesia that could have caused that strange
behavior should
be wiped out.

Cheers
Matthias

On Mon, Aug 27, 2012 at 11:26 AM, Matthias Reik <matthias.reik at gmail.com>wrote:

> I just upgraded to 2.8.6, and I see the same effect with the latest
> version :-(
> (not really unexpected, since nothing was fixed in that regard in 2.8.6).
>
> Already after about 10 minutes server2 consumes 200% more memory than
> server1,
> even though all clients are connected to server1, and there are no queues
> with TTL anymore.
>
> (removing the other queues is unfortunately not possible, since it's a
> production
> server :-(, and I haven't seen this effect on any of our other
> (development) servers)
>
> Cheers
> Matthias
>
>
> On Fri, Aug 24, 2012 at 2:25 PM, Matthias Reik <maze at reik.se> wrote:
>
>> Hi,
>>
>> 2 days ago I have upgraded our RabbitMQ cluster (2 machines running in HA
>> mode) from 2.8.1 to 2.8.5.
>> Mainly to get those OOD fixes in, since we experienced those exact issues.
>>
>> The upgrade went very smooth, but at some point one of the machines
>> (server2) started to allocate more
>> and more memory (even though all queues are more or less at 0 with almost
>> no outstanding acks)
>>
>> server 1 uses ~200Mb
>> server 2 (at the point where I took it down) used ~6Gb
>>
>> I run a rabbitmqctl report... but it didn't give me any insights
>> I run a rabbitmqctl eval 'erlang:memory().' but that didn't tell me too
>> much more (but I will attach that at the end)
>>
>> I found people with similar problems:
>> http://grokbase.com/t/**rabbitmq/rabbitmq-discuss/**
>> 1223qcx3gg/rabbitmq-memory-**usage-in-two-node-cluster<http://grokbase.com/t/rabbitmq/rabbitmq-discuss/1223qcx3gg/rabbitmq-memory-usage-in-two-node-cluster>
>> but that's a while back so many things might have changed since then.
>> Also the memory difference was
>> rather minimal, whereas here the difference is _very_ significant,
>> especially since the node with less load
>> has the increased memory footprint.
>>
>> I can upgrade to 2.8.6 (unfortunately I upgraded just before it was
>> released :-(), but I only want to do that if
>> there is some hope that the problem is solved.
>> I can bring server2 back online and try to investigate what is consuming
>> that much memory, but my
>> RabbitMQ/Erlang knowledge is not good enough, therefore reaching out for
>> some help.
>>
>> So any help would be much appreciated.
>>
>> Thx
>> Matthias
>>
>> Our setup is something like the following:
>>       2 servers exclusively running RabbitMQ on CentOS 5.x (high
>> watermark ~22Gb),
>>             - both with web-console enabled
>>             - both defined as disk nodes
>>             - both running RabbitMQ 2.8.5 on Erlang R15B01 (after the
>> upgrade, Erlang was already at R15 before)
>>     10 queues configured with mirroring
>>       3 queues configured (without mirroring) only on server1 with a TTL
>>     Most consumers are connecting to server1, server2 only in case of
>> failover
>>
>> We get about 1k messages/sec (with peaks much higher than that) into the
>> system, and each message is
>> passed through several queues for processing.
>>
>> -bash-3.2$ sbin/rabbitmqctl eval 'erlang:memory().'
>> [{total,5445584424},
>>  {processes,2184155418},
>>  {processes_used,2184122352},
>>  {system,3261429006},
>>  {atom,703377},
>>  {atom_used,678425},
>>  {binary,3216386480},
>>  {code,17978535},
>>  {ets,4142048}]
>> ...done.
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120827/2c9f9315/attachment.htm>

From yuva670 at gmail.com  Mon Aug 27 13:37:19 2012
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Mon, 27 Aug 2012 18:07:19 +0530
Subject: [rabbitmq-discuss] Non-blocking Consumers approach
In-Reply-To: <080D7020-EEC9-4044-8085-0C4A83591DF0@rabbitmq.com>
References: <CAPrynAVmxoa5eEtQFfgghCWsAUbQVtjrZAtqtaH9G0W2ESGseg@mail.gmail.com>
	<080D7020-EEC9-4044-8085-0C4A83591DF0@rabbitmq.com>
Message-ID: <CAPrynAXK5svpkPO5=0qYub6gifzfqFpSPTPkYMdDJT6bZ5rUpQ@mail.gmail.com>

Thanks Tim,

I read the API guide and still stuck to the QueuingConsumer, for each
incoming message I create a new service thread (with common channel,
without that the service won't know which message to acknowledge). But in
the guide, it is mentioned that the channel should be created for each
thread. Now, my question is does this guide assumes that we run different
consumer threads? *I can't understand the concept of different consumer
threads*. I run a single consumer and use basicConsume() to listen to the
messages and each message (nextDelivery()) will give rise to a new service
thread. Again, each message creating a thread is scary !

If it helps, I am running the consumer as a java application and use
basicConsume() and nextDelivery() in a while loop to process the messages.
Our application sends messages to these non-stop. So, I am looking for a
consumer which will not block the incoming messages when it is processing a
large message.



-Mahesh

On Mon, Aug 27, 2012 at 2:47 PM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi Mahesh,
>
> On 27 Aug 2012, at 08:58, Mahesh Viraktamath wrote:
>
>> Hi,
>>
>> We used RabbitMQ to implement a simple producer-consumer architecture.
>> It was fine until very recently, when we encountered the blocking
>> calls. I ran two nodes in a cluster; in cases where the consumer took
>> more than the usual time and all subsequent messages kept on waiting.
>> Then, I came to know that I used QueuingConsumer which is a blocking
>> architecture, now I know I have to use my own implementation of the
>> DefaultConsumer. But, I am clueless as to whether I should manage the
>> threading model or the RabbitMQ itself has any provision on that.
>> Another thing that is confusing is, whether we run different type of
>> consumers (with different duties) separately or we maintain a single
>> main class which will start consumers as the messages come in.
>>
>
> Have you read the API guide (http://www.rabbitmq.com/api-guide.html) for
details about threading and using your own executor service? That's
probably a good place to start. The latter question (about choosing how to
structure your code) is really something you'll have to decide yourself,
based on the responsibilities of each class and whether or not and to what
extent separation makes sense in the design.
>
> Cheers,
> Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120827/74953d1a/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 27 14:24:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Aug 2012 14:24:07 +0100
Subject: [rabbitmq-discuss] Non-blocking Consumers approach
In-Reply-To: <CAPrynAXK5svpkPO5=0qYub6gifzfqFpSPTPkYMdDJT6bZ5rUpQ@mail.gmail.com>
References: <CAPrynAVmxoa5eEtQFfgghCWsAUbQVtjrZAtqtaH9G0W2ESGseg@mail.gmail.com>
	<080D7020-EEC9-4044-8085-0C4A83591DF0@rabbitmq.com>
	<CAPrynAXK5svpkPO5=0qYub6gifzfqFpSPTPkYMdDJT6bZ5rUpQ@mail.gmail.com>
Message-ID: <503B74F7.6040700@rabbitmq.com>

Mahesh,

On 27/08/12 13:37, Mahesh Viraktamath wrote:
> I read the API guide and still stuck to the QueuingConsumer, for each
> incoming message I create a new service thread (with common channel,
> without that the service won't know which message to acknowledge). But
> in the guide, it is mentioned that the channel should be created for
> each thread. Now, my question is does this guide assumes that we run
> different consumer threads? *I can't understand the concept of different
> consumer threads*. I run a single consumer and use basicConsume() to
> listen to the messages and each message (nextDelivery()) will give rise
> to a new service thread. Again, each message creating a thread is scary !
>
> If it helps, I am running the consumer as a java application and use
> basicConsume() and nextDelivery() in a while loop to process the
> messages. Our application sends messages to these non-stop. So, I am
> looking for a consumer which will not block the incoming messages when
> it is processing a large message.

I suggest you create N channels and for each channel:
- set the basic.qos prefetch to 1 or some other low-ish value (for fair 
dispatch)
- create a consumer as shown in 
http://www.rabbitmq.com/api-guide.html#consuming

You write above that you only have one channel because "without that the 
service won't know which message to acknowledge", but the channel is 
accessible via the context (as shown in the example), so there is no 
ambiguity.

Obviously message ordering goes out of the window, but that's the case 
for any scheme where messages are handled by multiple threads.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Aug 27 14:37:15 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Aug 2012 14:37:15 +0100
Subject: [rabbitmq-discuss] Shovel stops receiving acks from cluster
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F8C2@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA2FE5F09E@osl02-exc-001>
	<87zk5wnvgy.wl%francesco@rabbitmq.com>,
	<87fw7hopmq.wl%francesco@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F630@osl02-exc-001>,
	<5034CB3F.5040004@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F7BD@osl02-exc-001>,
	<5034E407.6020409@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F7F4@osl02-exc-001>,
	<50363784.5040907@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA2FE5F8C2@osl02-exc-001>
Message-ID: <503B780B.1020408@rabbitmq.com>

Jon,

On 23/08/12 16:37, Jon Bergli Heier wrote:
> Attached the logs as requested, only 3 attempts this time (exact same setup
> as yesterday, restart order was qa-test1, qa-test2, qa-test1).

Thanks. We have found a race condition that triggers the behaviour you 
are seeing when the RabbitMQ server is processing a publish that gets 
routed to a queue which has a slave (re)starting at the same time.

As well as preventing confirms and tx.commits, the bug also results in 
memory growth in the slaves.

Looks like this bug has been around since 2.8.0, though due to it being 
a race condition it is conceivable that changes in more recent releases 
have increased the probability of it occurring.

We are working on a fix; can't think of a workaround in the meantime, 
unfortunately.

Thanks again for supplying all the debug info; this was instrumental in 
us being able to identify the root cause.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Aug 27 14:40:06 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Aug 2012 14:40:06 +0100
Subject: [rabbitmq-discuss] Excessive memory consumption of one server
 in cluster setup
In-Reply-To: <CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>
References: <503772C6.8080700@reik.se>
	<CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>
Message-ID: <503B78B6.6050301@rabbitmq.com>

Matthias,

On 27/08/12 10:26, Matthias Reik wrote:
> I just upgraded to 2.8.6, and I see the same effect with the latest
> version :-(
> (not really unexpected, since nothing was fixed in that regard in 2.8.6).
>
> Already after about 10 minutes server2 consumes 200% more memory than
> server1,

Thanks for reporting this.

This is almost certainly the same bug as
http://rabbitmq.1065348.n5.nabble.com/Shovel-stops-receiving-acks-from-cluster-tp21384p21649.html

Regards,

Matthias.

From matthias.reik at gmail.com  Mon Aug 27 15:48:45 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Mon, 27 Aug 2012 16:48:45 +0200
Subject: [rabbitmq-discuss] Fwd: Excessive memory consumption of one server
 in cluster setup
In-Reply-To: <CAJ1JW0cZJX8hGYKxsbCPSNqJH3Zpm95YB8RxOa3vpuezKMGEkw@mail.gmail.com>
References: <CAJ1JW0dTk8R68R+xmZ6HOZZN9v9HrvmKEr3TD2igbQgAcVQDbg@mail.gmail.com>
	<87wr0o47oi.wl%francesco@rabbitmq.com>
	<CAJ1JW0cZJX8hGYKxsbCPSNqJH3Zpm95YB8RxOa3vpuezKMGEkw@mail.gmail.com>
Message-ID: <CAJ1JW0f8NuA48sAZgSZNa3zWTnwoak1jzX50r6FMFTrJ_N2KMg@mail.gmail.com>

Now also posting to the list...

Hi Fransesco,

I don't want to publicly publish the rabbitmqctl report... I hope it's ok
that I send it to you directly
Unfortunately the log file is 35Mb big... so I stripped out all the stuff
until the "interesting" part

So far I have never seen this behavior on any of our other RabbitMQ
instances (but that was the
first one we upgraded to 2.8.5)... and that one is a production one... so
running with a smaller
test setup is not really possible :-(

Regarding upgrading:
Currently one of the queues is very full (due to the backlog created by the
slowed down RabbitMQ,
the side effect of the excessive memory consumption) and therefore I don't
want to do the upgrade
right now, but by Monday the queue should be worked down and then I can
upgrade. I can then
also try to have both servers working together again and see whether the
problem exists

Thanks for taking the time to look into this. If there is anything I can
provide you more, then let me
know.

Cheers
Matthias

---------- Forwarded message ----------
From: Francesco Mazzoli <francesco at rabbitmq.com>
Date: Fri, Aug 24, 2012 at 5:43 PM
Subject: Re: [rabbitmq-discuss] Excessive memory consumption of one server
in cluster setup
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>


Hi Matthias,

Can you please post the logs and `rabbitmqctl report'?  It's almost
impossible
to help you without those.

Could you also try to reproduce the issue with less things going on (e.g.
only
one queue) and describe in detail what you're doing to trigger the problem?
Thanks.

At Fri, 24 Aug 2012 17:30:44 +0200,
Matthias Reik wrote:
> I can upgrade to 2.8.6 (unfortunately I upgraded just before it was
released
> :-(), but I only want to do that if there is some hope that the problem is
> solved.

There weren't any HA related leaks fixed in 2.8.6, so I don't think
upgrading
will fix the problem.  However it would make our work much easier, so please
upgrade if you can.

--
Francesco * Often in error, never in doubt
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120827/4a1d51cf/attachment.htm>
-------------- next part --------------
Reporting server status on {{2012,8,23},{13,0,32}}

Status of node 'rabbit at mbuzz-queue-001' ...
[{pid,27644},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.5"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.5"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.5"},
      {rabbit,"RabbitMQ","2.8.5"},
      {os_mon,"CPO  CXC 138 46","2.2.9"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.5"},
      {webmachine,"webmachine","1.9.1-rmq2.8.5-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.5-gitd541e9a"},
      {xmerl,"XML parser","1.3.1"},
      {inets,"INETS  CXC 138 49","5.9"},
      {mnesia,"MNESIA  CXC 138 12","4.7"},
      {stdlib,"ERTS  CXC 138 10","1.18.1"},
      {kernel,"ERTS  CXC 138 10","2.15.1"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:8:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,257417456},
      {processes,145314575},
      {processes_used,145160354},
      {system,112102881},
      {atom,785313},
      {atom_used,774774},
      {binary,60798976},
      {code,17978538},
      {ets,8582984}]},
 {vm_memory_high_watermark,0.6999999999881451},
 {vm_memory_limit,23618924134},
 {disk_free_limit,1000000000},
 {disk_free,959713222656},
 {file_descriptors,
     [{total_limit,32668},
      {total_used,90},
      {sockets_limit,29399},
      {sockets_used,72}]},
 {processes,[{limit,1048576},{used,1625}]},
 {run_queue,0},
 {uptime,91965}]

Cluster status of node 'rabbit at mbuzz-queue-001' ...
[{nodes,[{disc,['rabbit at mbuzz-queue-002','rabbit at mbuzz-queue-001']}]},
 {running_nodes,['rabbit at mbuzz-queue-002','rabbit at mbuzz-queue-001']}]

Application environment of node 'rabbit at mbuzz-queue-001' ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {error_logger,{file,"/data/rabbitmq/log/rabbit at mbuzz-queue-001.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/data/rabbitmq/log/rabbit at mbuzz-queue-001-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.7}]

Status of node 'rabbit at mbuzz-queue-002' ...
[{pid,7425},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.5"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.5"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.5"},
      {rabbit,"RabbitMQ","2.8.5"},
      {os_mon,"CPO  CXC 138 46","2.2.9"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.5"},
      {webmachine,"webmachine","1.9.1-rmq2.8.5-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.5-gitd541e9a"},
      {xmerl,"XML parser","1.3.1"},
      {inets,"INETS  CXC 138 49","5.9"},
      {mnesia,"MNESIA  CXC 138 12","4.7"},
      {stdlib,"ERTS  CXC 138 10","1.18.1"},
      {kernel,"ERTS  CXC 138 10","2.15.1"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:8:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,3859412872},
      {processes,1772686689},
      {processes_used,1772525055},
      {system,2086726183},
      {atom,695185},
      {atom_used,663434},
      {binary,2043223376},
      {code,17978535},
      {ets,2847624}]},
 {vm_memory_high_watermark,0.6999999999881451},
 {vm_memory_limit,23618924134},
 {disk_free_limit,1000000000},
 {disk_free,942826557440},
 {file_descriptors,
     [{total_limit,32668},
      {total_used,21},
      {sockets_limit,29399},
      {sockets_used,9}]},
 {processes,[{limit,1048576},{used,371}]},
 {run_queue,0},
 {uptime,8531}]

Cluster status of node 'rabbit at mbuzz-queue-002' ...
[{nodes,[{disc,['rabbit at mbuzz-queue-002','rabbit at mbuzz-queue-001']}]},
 {running_nodes,['rabbit at mbuzz-queue-001','rabbit at mbuzz-queue-002']}]

Application environment of node 'rabbit at mbuzz-queue-002' ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {error_logger,{file,"/data/rabbitmq/log/rabbit at mbuzz-queue-002.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/data/rabbitmq/log/rabbit at mbuzz-queue-002-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.7}]

Connections:
pid	name	address	port	peer_address	peer_port	ssl	peer_cert_subject	peer_cert_issuer	peer_cert_validity	auth_mechanism	ssl_protocol	ssl_key_exchange	ssl_cipher	ssl_hash	protocol	user	vhost	timeout	frame_max	client_properties	recv_oct	recv_cnt	send_oct	send_cnt	send_pend	state	last_blocked_by	last_blocked_age	channels
<'rabbit at mbuzz-queue-001'.2.7239.4>	10.31.1.114:51003 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.114	51003	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	63411	2332	2452066634	75617	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.6509.4>	10.31.1.121:37444 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	37444	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	145613	4590	997075033	472901	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.2091.0>	10.31.0.58:49208 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.58	49208	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.6.1"}]	937	15	2625451625	17704080	0	running	none	infinity	3
<'rabbit at mbuzz-queue-001'.2.1773.0>	10.31.0.203:44989 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.203	44989	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	2092662042	76425	384	4	0	blocked	flow	9.933393	1
<'rabbit at mbuzz-queue-001'.2.6648.4>	10.31.1.122:57936 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57936	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	143603	4409	614225166	18923	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.6467.4>	10.31.1.121:37443 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	37443	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	144836	4455	994652947	473221	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.3407.0>	10.31.1.121:46690 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	46690	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	315405	13224	3825236792	148723	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.3391.0>	10.31.1.121:46583 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	46583	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	190366	9042	50079263	29391	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.2156.0>	10.31.0.203:45161 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.203	45161	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.6.1"}]	857	15	3869823970	4116246	0	running	none	infinity	3
<'rabbit at mbuzz-queue-001'.2.2140.0>	10.31.0.203:45157 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.203	45157	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.6.1"}]	857	16	3861086301	4116150	0	running	none	infinity	3
<'rabbit at mbuzz-queue-001'.2.1200.0>	10.31.1.115:39775 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39775	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	181599552	42399	2848	311	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.7385.4>	10.31.1.122:57958 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57958	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	406633952	73486	624	33	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.6569.4>	10.31.1.122:57934 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57934	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	143540	4423	615690060	18925	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.428.0>	209.191.189.4:13220 -> 10.31.0.250:5672	10.31.0.250	5672	209.191.189.4	13220	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	179412	11673	327080	7784	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.6669.4>	10.31.1.115:59739 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	59739	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	63579	2321	2461001133	75663	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.6530.4>	10.31.1.122:57932 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57932	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	144269	4321	991265037	472673	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.1385.0>	10.31.1.115:39792 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39792	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	1716620091	317680	2904	314	0	running	none	infinity	6
<'rabbit at mbuzz-queue-001'.2.779.0>	10.31.1.121:40783 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	40783	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	925853	28777	2727776015	101486	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.516.0>	10.31.1.115:39761 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39761	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	880782	25578	4089656973	2174567	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.2095.0>	10.31.0.58:49209 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.58	49209	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.6.1"}]	937	16	2626247364	17708066	0	running	none	infinity	3
<'rabbit at mbuzz-queue-001'.2.510.0>	10.31.1.115:39759 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39759	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	431921	14968	333402930	103972	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.6719.4>	10.31.1.121:37446 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	37446	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	48679	1622	24329696	19815	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.8758.1>	10.31.1.122:35292 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	35292	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	249213	9820	2822162570	95846	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.3395.0>	10.31.1.121:46613 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	46613	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	315321	13015	3848201663	148940	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.1419.0>	10.31.1.115:39795 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39795	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	1714864737	324167	2896	314	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.845.0>	10.31.1.121:40789 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	40789	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	36631389	40963	2880	313	0	running	none	infinity	4
<'rabbit at mbuzz-queue-001'.2.7389.4>	10.31.1.121:37455 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	37455	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	410421263	75967	656	35	0	running	none	infinity	4
<'rabbit at mbuzz-queue-001'.2.7325.4>	10.31.1.121:37448 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	37448	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	408409781	74102	624	33	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.6689.4>	10.31.1.122:57944 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57944	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	40922	1473	29075960	9207	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.4082.0>	10.31.1.115:38086 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	38086	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	311814	12915	3677540500	139825	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.464.0>	10.32.0.5:38292 -> 10.31.0.250:5672	10.31.0.250	5672	10.32.0.5	38292	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	17603967	24712	400	5	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.386.2>	68.233.20.2:35649 -> 10.31.0.250:5672	10.31.0.250	5672	68.233.20.2	35649	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	667	10	2610710933	7698312	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.8777.1>	10.31.1.122:35464 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	35464	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	243144	9940	2816915807	95836	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.370.0>	10.31.1.115:39754 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39754	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	882819	24543	4094138745	2166879	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.6679.4>	10.31.1.122:57942 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57942	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	18178	851	1736330	1452	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.28382.1>	10.31.0.57:51744 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.57	51744	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	429	6	396	5	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.4037.0>	10.31.1.114:39207 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.114	39207	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	314922	12968	3678616166	138514	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.2132.0>	10.31.0.203:45155 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.203	45155	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.6.1"}]	857	16	3875566277	4116044	0	running	none	infinity	3
<'rabbit at mbuzz-queue-001'.2.1558.0>	10.31.1.115:39810 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39810	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	1713720357	312459	2976	319	0	running	none	infinity	10
<'rabbit at mbuzz-queue-001'.2.602.0>	10.31.0.203:44934 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.203	44934	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	527963026	1678491	65536	4655	0	blocked	flow	9.566256	20
<'rabbit at mbuzz-queue-001'.2.586.0>	68.233.20.2:45892 -> 10.31.0.250:5672	10.31.0.250	5672	68.233.20.2	45892	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	712	17	816	12	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.7393.4>	10.31.1.121:37456 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	37456	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	12016183	4514	608	32	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.7329.4>	10.31.1.121:37450 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	37450	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	408805947	73702	624	33	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.2046.0>	10.31.0.57:43695 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.57	43695	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.6.1"}]	857	16	3896584190	4141788	0	running	none	infinity	3
<'rabbit at mbuzz-queue-001'.2.484.0>	10.31.1.115:39757 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39757	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	922346	26289	2725812186	101364	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.6888.4>	10.31.1.122:57946 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57946	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	143582	4425	611121164	18923	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.6662.4>	10.31.1.122:57940 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57940	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	145067	4343	990963236	472919	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.1297.0>	10.31.0.203:44982 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.203	44982	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	158535647	136443	384	4	0	running	flow	241.96315	1
<'rabbit at mbuzz-queue-001'.2.819.0>	10.31.1.121:40787 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	40787	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	185288	8814	27271771	22737	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.684.0>	10.31.1.114:44116 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.114	44116	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	922241	26229	2733711643	101264	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.7363.4>	10.31.1.122:57952 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57952	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	407050121	73333	672	36	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.6656.4>	10.31.1.122:57938 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57938	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	144857	4307	992900413	473154	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.6462.4>	10.31.1.121:37442 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	37442	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	144101	4540	997589782	472857	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.390.2>	68.233.20.2:35648 -> 10.31.0.250:5672	10.31.0.250	5672	68.233.20.2	35648	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	715	10	4145112294	17738089	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.8749.1>	10.31.1.122:35269 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	35269	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	129382	6137	17980025	11366	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.374.0>	10.31.1.115:39755 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.115	39755	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	884142	25480	4093460908	2174251	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.7467.4>	10.32.0.6:38725 -> 10.31.0.250:5672	10.31.0.250	5672	10.32.0.6	38725	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	1108340	1572	624	33	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.7435.4>	10.31.1.122:57963 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57963	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	2329084	2719	624	33	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.32537.2>	10.31.0.58:57277 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.58	57277	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	1492813990	27878	476	10	0	blocked	flow	9.639586	6
<'rabbit at mbuzz-queue-001'.2.28386.1>	10.31.0.57:51745 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.57	51745	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	1342706941	2286601	540	14	0	blocked	flow	9.281692	10
<'rabbit at mbuzz-queue-001'.2.2136.0>	10.31.0.203:45156 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.203	45156	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.6.1"}]	857	15	3862104231	4114451	0	running	none	infinity	3
<'rabbit at mbuzz-queue-001'.2.1841.0>	10.31.0.58:49148 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.58	49148	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	1481194292	795281	496	11	0	running	flow	215.517278	8
<'rabbit at mbuzz-queue-001'.2.1164.0>	10.31.0.203:44970 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.203	44970	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	3734736436	33402910	528	13	0	running	flow	16.345457	10
<'rabbit at mbuzz-queue-001'.2.805.0>	10.31.1.121:40785 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	40785	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	923039	27954	2729411445	101315	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.590.0>	68.233.20.2:45893 -> 10.31.0.250:5672	10.31.0.250	5672	68.233.20.2	45893	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	680	17	784	12	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.7381.4>	10.31.1.122:57955 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57955	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	407175512	71405	656	35	0	running	none	infinity	4
<'rabbit at mbuzz-queue-001'.2.7349.4>	10.31.1.122:57948 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.122	57948	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	15804090	3922	616	32	0	running	none	infinity	2
<'rabbit at mbuzz-queue-001'.2.2050.0>	10.31.0.57:43696 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.57	43696	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.6.1"}]	857	17	3903065289	4138991	0	running	none	infinity	3
<'rabbit at mbuzz-queue-001'.2.456.0>	10.32.0.7:51152 -> 10.31.0.250:5672	10.31.0.250	5672	10.32.0.7	51152	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	17596418	23594	384	4	0	running	none	infinity	1
<'rabbit at mbuzz-queue-001'.2.360.0>	10.31.1.121:40777 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.1.121	40777	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	923963	29347	2734771620	101860	0	running	none	infinity	5
<'rabbit at mbuzz-queue-001'.2.296.0>	10.31.0.58:46530 -> 10.31.0.250:5672	10.31.0.250	5672	10.31.0.58	46530	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	2289787657	479218	400	5	0	blocked	flow	9.794376	2
<'rabbit at mbuzz-queue-002'.1.4804.1>	10.31.1.114:43792 -> 10.31.0.248:5672	10.31.0.248	5672	10.31.1.114	43792	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	43643	1065	231385830	108026	0	running	none	infinity	5
<'rabbit at mbuzz-queue-002'.1.4758.1>	10.31.1.114:43789 -> 10.31.0.248:5672	10.31.0.248	5672	10.31.1.114	43789	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	44084	1031	230947969	108026	0	running	none	infinity	5
<'rabbit at mbuzz-queue-002'.1.4840.1>	10.31.1.114:43794 -> 10.31.0.248:5672	10.31.0.248	5672	10.31.1.114	43794	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	91138905	12650	492	16	0	running	none	infinity	2
<'rabbit at mbuzz-queue-002'.1.4808.1>	10.31.1.114:43793 -> 10.31.0.248:5672	10.31.0.248	5672	10.31.1.114	43793	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	2334285	869	476	15	0	running	none	infinity	1
<'rabbit at mbuzz-queue-002'.1.4728.1>	10.31.1.114:43788 -> 10.31.0.248:5672	10.31.0.248	5672	10.31.1.114	43788	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	90751106	13125	540	19	0	running	none	infinity	5
<'rabbit at mbuzz-queue-002'.1.4794.1>	10.31.1.114:43791 -> 10.31.0.248:5672	10.31.0.248	5672	10.31.1.114	43791	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	16174	431	4296659	3216	0	running	none	infinity	5
<'rabbit at mbuzz-queue-002'.1.4718.1>	10.31.1.114:43787 -> 10.31.0.248:5672	10.31.0.248	5672	10.31.1.114	43787	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	43748	1090	231295212	107973	0	running	none	infinity	5
<'rabbit at mbuzz-queue-002'.1.4768.1>	10.31.1.114:43790 -> 10.31.0.248:5672	10.31.0.248	5672	10.31.1.114	43790	false				PLAIN					{0,9,1}	guest	/	300	131072	[{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.1"}]	91052563	13257	524	18	0	running	none	infinity	4

Channels:
pid	name	connection	number	user	vhost	transactional	confirm	consumer_count	messages_unacknowledged	messages_unconfirmed	messages_uncommitted	acks_uncommitted	prefetch_count	client_flow_blocked
<'rabbit at mbuzz-queue-001'.2.301.0>	10.31.0.58:46530 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.296.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.366.0>	10.31.1.121:40777 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.360.0>	1	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.385.0>	10.31.1.115:39754 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.370.0>	1	guest	/	false	false	1	65	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.386.0>	10.31.1.115:39755 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.374.0>	1	guest	/	false	false	1	72	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.390.0>	10.31.1.115:39754 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.370.0>	2	guest	/	false	false	1	65	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.394.0>	10.31.1.121:40777 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.360.0>	2	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.398.0>	10.31.1.115:39755 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.374.0>	2	guest	/	false	false	1	62	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.432.0>	10.31.1.115:39754 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.370.0>	3	guest	/	false	false	1	75	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.436.0>	10.31.1.115:39755 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.374.0>	3	guest	/	false	false	1	87	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.444.0>	10.31.1.115:39754 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.370.0>	4	guest	/	false	false	1	65	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.460.0>	10.32.0.7:51152 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.456.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.468.0>	10.32.0.5:38292 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.464.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.490.0>	10.31.1.115:39757 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.484.0>	1	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.494.0>	10.31.1.115:39757 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.484.0>	2	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.498.0>	10.31.1.115:39755 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.374.0>	4	guest	/	false	false	1	88	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.502.0>	10.31.1.115:39755 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.374.0>	5	guest	/	false	false	1	89	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.506.0>	10.31.1.115:39754 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.370.0>	5	guest	/	false	false	1	65	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.520.0>	10.31.1.115:39759 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.510.0>	1	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.526.0>	10.31.1.115:39761 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.516.0>	1	guest	/	false	false	1	91	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.530.0>	10.31.1.115:39761 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.516.0>	3	guest	/	false	false	1	64	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.534.0>	10.31.1.115:39761 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.516.0>	2	guest	/	false	false	1	90	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.538.0>	10.31.1.115:39761 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.516.0>	4	guest	/	false	false	1	64	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.570.0>	10.31.1.115:39761 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.516.0>	5	guest	/	false	false	1	74	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.578.0>	10.31.1.115:39759 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.510.0>	2	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.582.0>	10.31.1.115:39759 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.510.0>	3	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.642.0>	10.31.1.115:39759 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.510.0>	4	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.690.0>	10.31.1.114:44116 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.684.0>	1	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.710.0>	10.31.1.115:39757 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.484.0>	3	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.714.0>	10.31.1.115:39757 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.484.0>	4	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.718.0>	10.31.1.115:39757 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.484.0>	5	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.726.0>	10.31.1.114:44116 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.684.0>	2	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.730.0>	10.31.1.114:44116 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.684.0>	3	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.734.0>	10.31.1.114:44116 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.684.0>	4	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.738.0>	10.31.1.114:44116 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.684.0>	5	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.742.0>	10.31.1.115:39759 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.510.0>	5	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.785.0>	10.31.1.121:40783 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.779.0>	1	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.801.0>	10.31.1.121:40777 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.360.0>	3	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.811.0>	10.31.1.121:40785 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.805.0>	1	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.815.0>	10.31.1.121:40777 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.360.0>	4	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.825.0>	10.31.1.121:40787 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.819.0>	1	guest	/	false	false	1	0	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.871.0>	10.31.1.121:40789 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.845.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.875.0>	10.31.1.121:40789 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.845.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.931.0>	10.31.1.121:40777 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.360.0>	5	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.943.0>	10.31.1.121:40785 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.805.0>	2	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.963.0>	10.31.1.121:40785 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.805.0>	3	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.967.0>	10.31.1.121:40785 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.805.0>	4	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.979.0>	10.31.1.121:40783 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.779.0>	2	guest	/	false	false	1	1	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.987.0>	10.31.1.121:40785 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.805.0>	5	guest	/	false	false	1	3	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.1032.0>	10.31.1.121:40783 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.779.0>	3	guest	/	false	false	1	1	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.1036.0>	10.31.1.121:40783 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.779.0>	4	guest	/	false	false	1	1	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.1040.0>	10.31.1.121:40783 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.779.0>	5	guest	/	false	false	1	1	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.1143.0>	209.191.189.4:13220 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.428.0>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1147.0>	68.233.20.2:45893 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.590.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1151.0>	68.233.20.2:45892 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.586.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1168.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.1164.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1172.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.1164.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1176.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.1164.0>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1180.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.1164.0>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1184.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.1164.0>	5	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1188.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (6)	<'rabbit at mbuzz-queue-001'.2.1164.0>	6	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1192.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (7)	<'rabbit at mbuzz-queue-001'.2.1164.0>	7	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1196.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (8)	<'rabbit at mbuzz-queue-001'.2.1164.0>	8	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1206.0>	10.31.1.115:39775 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.1200.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1301.0>	10.31.0.203:44982 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.1297.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1322.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (10)	<'rabbit at mbuzz-queue-001'.2.1164.0>	10	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1326.0>	10.31.0.203:44970 -> 10.31.0.250:5672 (9)	<'rabbit at mbuzz-queue-001'.2.1164.0>	9	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1485.0>	10.31.1.115:39795 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.1419.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1492.0>	10.31.0.58:46530 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.296.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1562.0>	10.31.1.115:39795 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.1419.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1566.0>	10.31.1.115:39795 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.1419.0>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1570.0>	10.31.1.115:39795 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.1419.0>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1586.0>	10.31.1.115:39792 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.1385.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1590.0>	10.31.1.115:39792 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.1385.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1594.0>	10.31.1.115:39792 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.1385.0>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1611.0>	10.31.1.115:39795 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.1419.0>	5	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1627.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.1558.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1640.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.1558.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1644.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.1558.0>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1648.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.1558.0>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1652.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (6)	<'rabbit at mbuzz-queue-001'.2.1558.0>	6	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1656.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (8)	<'rabbit at mbuzz-queue-001'.2.1558.0>	8	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1660.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (9)	<'rabbit at mbuzz-queue-001'.2.1558.0>	9	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1682.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (10)	<'rabbit at mbuzz-queue-001'.2.1558.0>	10	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1722.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.1558.0>	5	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1730.0>	10.31.1.115:39810 -> 10.31.0.250:5672 (7)	<'rabbit at mbuzz-queue-001'.2.1558.0>	7	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1777.0>	10.31.0.203:44989 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.1773.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1845.0>	10.31.0.58:49148 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.1841.0>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1849.0>	10.31.0.58:49148 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.1841.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1853.0>	10.31.0.58:49148 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.1841.0>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1857.0>	10.31.0.58:49148 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.1841.0>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1861.0>	10.31.0.58:49148 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.1841.0>	5	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.1865.0>	10.31.0.58:49148 -> 10.31.0.250:5672 (6)	<'rabbit at mbuzz-queue-001'.2.1841.0>	6	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2054.0>	10.31.0.57:43695 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.2046.0>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2058.0>	10.31.0.57:43696 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.2050.0>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2062.0>	10.31.0.57:43695 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.2046.0>	3	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2066.0>	10.31.0.57:43695 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.2046.0>	2	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2070.0>	10.31.0.57:43696 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.2050.0>	3	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2074.0>	10.31.0.57:43696 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.2050.0>	2	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2099.0>	10.31.0.58:49209 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.2095.0>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2103.0>	10.31.0.58:49208 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.2091.0>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2112.0>	10.31.0.58:49209 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.2095.0>	2	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2116.0>	10.31.0.58:49209 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.2095.0>	3	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2120.0>	10.31.0.58:49208 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.2091.0>	3	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2124.0>	10.31.0.58:49208 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.2091.0>	2	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2144.0>	10.31.0.203:45155 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.2132.0>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2148.0>	10.31.0.203:45156 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.2136.0>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2152.0>	10.31.0.203:45157 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.2140.0>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2160.0>	10.31.0.203:45161 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.2156.0>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2164.0>	10.31.0.203:45156 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.2136.0>	3	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2168.0>	10.31.0.203:45156 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.2136.0>	2	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2172.0>	10.31.0.203:45157 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.2140.0>	2	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2176.0>	10.31.0.203:45157 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.2140.0>	3	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2180.0>	10.31.0.203:45155 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.2132.0>	2	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2184.0>	10.31.0.203:45155 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.2132.0>	3	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2189.0>	10.31.0.203:45161 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.2156.0>	2	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2193.0>	10.31.0.203:45161 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.2156.0>	3	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.2660.0>	10.32.0.5:38292 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.464.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.3399.0>	10.31.1.121:46583 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.3391.0>	1	guest	/	false	false	1	0	0	0	0	20	false
<'rabbit at mbuzz-queue-001'.2.3403.0>	10.31.1.121:46613 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.3395.0>	1	guest	/	false	false	1	19	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.3411.0>	10.31.1.121:46613 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.3395.0>	2	guest	/	false	false	1	19	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.3415.0>	10.31.1.121:46690 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.3407.0>	1	guest	/	false	false	1	20	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.3419.0>	10.31.1.121:46690 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.3407.0>	2	guest	/	false	false	1	19	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.4045.0>	10.31.1.114:39207 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.4037.0>	1	guest	/	false	false	1	19	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.4057.0>	10.31.1.114:39207 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.4037.0>	2	guest	/	false	false	1	20	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.4086.0>	10.31.1.115:38086 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.4082.0>	1	guest	/	false	false	1	19	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.4090.0>	10.31.1.115:38086 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.4082.0>	2	guest	/	false	false	1	19	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.4633.0>	10.31.1.115:39775 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.1200.0>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.5518.0>	10.31.0.58:49148 -> 10.31.0.250:5672 (8)	<'rabbit at mbuzz-queue-001'.2.1841.0>	8	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.5522.0>	10.31.0.58:49148 -> 10.31.0.250:5672 (7)	<'rabbit at mbuzz-queue-001'.2.1841.0>	7	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.6104.0>	10.31.1.121:40789 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.845.0>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.19902.0>	10.31.1.115:39792 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.1385.0>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.19906.0>	10.31.1.115:39792 -> 10.31.0.250:5672 (6)	<'rabbit at mbuzz-queue-001'.2.1385.0>	6	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.19910.0>	10.31.1.115:39792 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.1385.0>	5	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.8753.1>	10.31.1.122:35269 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.8749.1>	1	guest	/	false	false	1	0	0	0	0	20	false
<'rabbit at mbuzz-queue-001'.2.8762.1>	10.31.1.122:35292 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.8758.1>	1	guest	/	false	false	1	20	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.8768.1>	10.31.1.122:35292 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.8758.1>	2	guest	/	false	false	1	20	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.8783.1>	10.31.1.122:35464 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.8777.1>	1	guest	/	false	false	1	19	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.8788.1>	10.31.1.122:35464 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.8777.1>	2	guest	/	false	false	1	19	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.25955.1>	10.31.1.121:40789 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.845.0>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28391.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.28386.1>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28397.1>	10.31.0.57:51744 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.28382.1>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28403.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.28386.1>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28407.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.28386.1>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28411.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (7)	<'rabbit at mbuzz-queue-001'.2.28386.1>	7	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28415.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (6)	<'rabbit at mbuzz-queue-001'.2.28386.1>	6	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28419.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.28386.1>	5	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28423.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.28386.1>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28428.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (9)	<'rabbit at mbuzz-queue-001'.2.28386.1>	9	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28432.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (8)	<'rabbit at mbuzz-queue-001'.2.28386.1>	8	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.28436.1>	10.31.0.57:51745 -> 10.31.0.250:5672 (10)	<'rabbit at mbuzz-queue-001'.2.28386.1>	10	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.394.2>	68.233.20.2:35649 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.386.2>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.398.2>	68.233.20.2:35648 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.390.2>	1	guest	/	false	false	1	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.32541.2>	10.31.0.58:57277 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.32537.2>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.32545.2>	10.31.0.58:57277 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.32537.2>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.32549.2>	10.31.0.58:57277 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.32537.2>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.32553.2>	10.31.0.58:57277 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.32537.2>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.32557.2>	10.31.0.58:57277 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.32537.2>	5	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.32561.2>	10.31.0.58:57277 -> 10.31.0.250:5672 (6)	<'rabbit at mbuzz-queue-001'.2.32537.2>	6	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.6486.4>	10.31.1.121:37442 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6462.4>	1	guest	/	false	false	1	82	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6496.4>	10.31.1.121:37443 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6467.4>	1	guest	/	false	false	1	78	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6505.4>	10.31.1.121:37442 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6462.4>	2	guest	/	false	false	1	82	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6512.4>	10.31.1.121:37443 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6467.4>	2	guest	/	false	false	1	77	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6519.4>	10.31.1.121:37442 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6462.4>	5	guest	/	false	false	1	82	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6533.4>	10.31.1.121:37443 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6467.4>	3	guest	/	false	false	1	77	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6540.4>	10.31.1.121:37442 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6462.4>	4	guest	/	false	false	1	82	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6548.4>	10.31.1.121:37444 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6509.4>	1	guest	/	false	false	1	49	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6560.4>	10.31.1.121:37442 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6462.4>	3	guest	/	false	false	1	82	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6561.4>	10.31.1.121:37443 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6467.4>	4	guest	/	false	false	1	81	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6570.4>	10.31.1.122:57932 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6530.4>	1	guest	/	false	false	1	60	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6574.4>	10.31.1.121:37444 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6509.4>	2	guest	/	false	false	1	59	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6575.4>	10.31.1.121:37443 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6467.4>	5	guest	/	false	false	1	79	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6589.4>	10.31.1.121:37444 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6509.4>	4	guest	/	false	false	1	49	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6593.4>	10.31.1.122:57932 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6530.4>	2	guest	/	false	false	1	60	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6607.4>	10.31.1.122:57934 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6569.4>	1	guest	/	false	false	1	1	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.6609.4>	10.31.1.121:37444 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6509.4>	3	guest	/	false	false	1	81	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6611.4>	10.31.1.122:57932 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6530.4>	3	guest	/	false	false	1	60	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6621.4>	10.31.1.122:57934 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6569.4>	2	guest	/	false	false	1	1	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.6625.4>	10.31.1.121:37444 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6509.4>	5	guest	/	false	false	1	48	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6629.4>	10.31.1.122:57932 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6530.4>	4	guest	/	false	false	1	60	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6638.4>	10.31.1.122:57934 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6569.4>	3	guest	/	false	false	1	1	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.6644.4>	10.31.1.122:57932 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6530.4>	5	guest	/	false	false	1	61	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6688.4>	10.31.1.115:59739 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6669.4>	1	guest	/	false	false	1	26	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6704.4>	10.31.1.115:59739 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6669.4>	2	guest	/	false	false	1	26	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6705.4>	10.31.1.122:57936 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6648.4>	1	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.6720.4>	10.31.1.122:57936 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6648.4>	2	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.6729.4>	10.31.1.122:57940 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6662.4>	1	guest	/	false	false	1	62	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6748.4>	10.31.1.121:37446 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6719.4>	1	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6749.4>	10.31.1.122:57942 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6679.4>	1	guest	/	false	false	1	0	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6754.4>	10.31.1.122:57938 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6656.4>	1	guest	/	false	false	1	71	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6757.4>	10.31.1.122:57940 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6662.4>	2	guest	/	false	false	1	61	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6759.4>	10.31.1.122:57936 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6648.4>	3	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.6766.4>	10.31.1.122:57944 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6689.4>	1	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6777.4>	10.31.1.121:37446 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6719.4>	2	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6780.4>	10.31.1.122:57940 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6662.4>	3	guest	/	false	false	1	73	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6796.4>	10.31.1.122:57940 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6662.4>	4	guest	/	false	false	1	61	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6804.4>	10.31.1.122:57944 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6689.4>	2	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6807.4>	10.31.1.122:57940 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6662.4>	5	guest	/	false	false	1	62	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6808.4>	10.31.1.122:57936 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6648.4>	4	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.6828.4>	10.31.1.122:57938 -> 10.31.0.250:5672 (7)	<'rabbit at mbuzz-queue-001'.2.6656.4>	7	guest	/	false	false	1	71	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6839.4>	10.31.1.122:57938 -> 10.31.0.250:5672 (8)	<'rabbit at mbuzz-queue-001'.2.6656.4>	8	guest	/	false	false	1	71	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6846.4>	10.31.1.122:57938 -> 10.31.0.250:5672 (9)	<'rabbit at mbuzz-queue-001'.2.6656.4>	9	guest	/	false	false	1	74	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6851.4>	10.31.1.122:57938 -> 10.31.0.250:5672 (10)	<'rabbit at mbuzz-queue-001'.2.6656.4>	10	guest	/	false	false	1	71	0	0	0	10000	false
<'rabbit at mbuzz-queue-001'.2.6854.4>	10.31.1.122:57944 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6689.4>	3	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6859.4>	10.31.1.122:57944 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6689.4>	5	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6865.4>	10.31.1.122:57944 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6689.4>	4	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6921.4>	10.31.1.122:57946 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.6888.4>	1	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.6955.4>	10.31.1.121:37446 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6719.4>	3	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.6973.4>	10.31.1.122:57946 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.6888.4>	2	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.7161.4>	10.31.1.122:57946 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.6888.4>	3	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.7173.4>	10.31.1.122:57946 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6888.4>	4	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.7183.4>	10.31.1.122:57946 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6888.4>	5	guest	/	false	false	1	2	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.7223.4>	10.31.1.121:37446 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6719.4>	4	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.7227.4>	10.31.1.121:37446 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6719.4>	5	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.7231.4>	10.31.1.122:57934 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.6569.4>	4	guest	/	false	false	1	0	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.7235.4>	10.31.1.122:57934 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6569.4>	5	guest	/	false	false	1	0	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.7245.4>	10.31.1.114:51003 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7239.4>	1	guest	/	false	false	1	21	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.7249.4>	10.31.1.114:51003 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7239.4>	2	guest	/	false	false	1	22	0	0	0	1000	false
<'rabbit at mbuzz-queue-001'.2.7253.4>	10.31.1.122:57936 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.6648.4>	5	guest	/	false	false	1	1	0	0	0	2000	false
<'rabbit at mbuzz-queue-001'.2.7335.4>	10.31.1.121:37448 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7325.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7341.4>	10.31.1.121:37450 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7329.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7345.4>	10.31.1.121:37448 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7325.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7353.4>	10.31.1.121:37450 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7329.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7359.4>	10.31.1.122:57948 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7349.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7377.4>	10.31.1.122:57952 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7363.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7397.4>	10.31.1.122:57952 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7363.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7403.4>	10.31.1.121:37456 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7393.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7409.4>	10.31.1.122:57955 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7381.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7415.4>	10.31.1.122:57955 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7381.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7419.4>	10.31.1.122:57955 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.7381.4>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7423.4>	10.31.1.122:57955 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.7381.4>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7427.4>	10.31.1.122:57958 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7385.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7431.4>	10.31.1.122:57958 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7385.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7441.4>	10.31.1.122:57963 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7435.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7447.4>	10.31.1.121:37455 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7389.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7451.4>	10.31.1.121:37455 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.7389.4>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7455.4>	10.31.1.121:37455 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7389.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7473.4>	10.32.0.6:38725 -> 10.31.0.250:5672 (1)	<'rabbit at mbuzz-queue-001'.2.7467.4>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7477.4>	10.32.0.6:38725 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7467.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.7511.4>	10.31.1.122:57963 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7435.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.8064.4>	10.31.1.122:57952 -> 10.31.0.250:5672 (3)	<'rabbit at mbuzz-queue-001'.2.7363.4>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.8068.4>	10.31.1.122:57952 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.7363.4>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.8072.4>	10.31.1.122:57952 -> 10.31.0.250:5672 (5)	<'rabbit at mbuzz-queue-001'.2.7363.4>	5	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.8080.4>	10.31.1.121:37455 -> 10.31.0.250:5672 (4)	<'rabbit at mbuzz-queue-001'.2.7389.4>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.13323.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2174)	<'rabbit at mbuzz-queue-001'.2.602.0>	2174	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.13818.4>	10.31.1.122:57948 -> 10.31.0.250:5672 (2)	<'rabbit at mbuzz-queue-001'.2.7349.4>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14274.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2226)	<'rabbit at mbuzz-queue-001'.2.602.0>	2226	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14348.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2241)	<'rabbit at mbuzz-queue-001'.2.602.0>	2241	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14356.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2239)	<'rabbit at mbuzz-queue-001'.2.602.0>	2239	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14360.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2238)	<'rabbit at mbuzz-queue-001'.2.602.0>	2238	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14364.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2237)	<'rabbit at mbuzz-queue-001'.2.602.0>	2237	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14613.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2248)	<'rabbit at mbuzz-queue-001'.2.602.0>	2248	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14621.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2246)	<'rabbit at mbuzz-queue-001'.2.602.0>	2246	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14625.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2245)	<'rabbit at mbuzz-queue-001'.2.602.0>	2245	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14685.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2254)	<'rabbit at mbuzz-queue-001'.2.602.0>	2254	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14835.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2265)	<'rabbit at mbuzz-queue-001'.2.602.0>	2265	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14839.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2264)	<'rabbit at mbuzz-queue-001'.2.602.0>	2264	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14843.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2263)	<'rabbit at mbuzz-queue-001'.2.602.0>	2263	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14847.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2262)	<'rabbit at mbuzz-queue-001'.2.602.0>	2262	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14851.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2261)	<'rabbit at mbuzz-queue-001'.2.602.0>	2261	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14855.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2260)	<'rabbit at mbuzz-queue-001'.2.602.0>	2260	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14859.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2259)	<'rabbit at mbuzz-queue-001'.2.602.0>	2259	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14863.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2258)	<'rabbit at mbuzz-queue-001'.2.602.0>	2258	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14867.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2257)	<'rabbit at mbuzz-queue-001'.2.602.0>	2257	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-001'.2.14871.4>	10.31.0.203:44934 -> 10.31.0.250:5672 (2256)	<'rabbit at mbuzz-queue-001'.2.602.0>	2256	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.4724.1>	10.31.1.114:43787 -> 10.31.0.248:5672 (1)	<'rabbit at mbuzz-queue-002'.1.4718.1>	1	guest	/	false	false	1	62	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4735.1>	10.31.1.114:43788 -> 10.31.0.248:5672 (1)	<'rabbit at mbuzz-queue-002'.1.4728.1>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.4739.1>	10.31.1.114:43787 -> 10.31.0.248:5672 (2)	<'rabbit at mbuzz-queue-002'.1.4718.1>	2	guest	/	false	false	1	59	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4743.1>	10.31.1.114:43787 -> 10.31.0.248:5672 (3)	<'rabbit at mbuzz-queue-002'.1.4718.1>	3	guest	/	false	false	1	59	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4747.1>	10.31.1.114:43787 -> 10.31.0.248:5672 (4)	<'rabbit at mbuzz-queue-002'.1.4718.1>	4	guest	/	false	false	1	59	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4751.1>	10.31.1.114:43787 -> 10.31.0.248:5672 (5)	<'rabbit at mbuzz-queue-002'.1.4718.1>	5	guest	/	false	false	1	59	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4764.1>	10.31.1.114:43789 -> 10.31.0.248:5672 (1)	<'rabbit at mbuzz-queue-002'.1.4758.1>	1	guest	/	false	false	1	56	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4774.1>	10.31.1.114:43790 -> 10.31.0.248:5672 (1)	<'rabbit at mbuzz-queue-002'.1.4768.1>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.4778.1>	10.31.1.114:43789 -> 10.31.0.248:5672 (2)	<'rabbit at mbuzz-queue-002'.1.4758.1>	2	guest	/	false	false	1	56	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4782.1>	10.31.1.114:43789 -> 10.31.0.248:5672 (4)	<'rabbit at mbuzz-queue-002'.1.4758.1>	4	guest	/	false	false	1	57	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4786.1>	10.31.1.114:43789 -> 10.31.0.248:5672 (3)	<'rabbit at mbuzz-queue-002'.1.4758.1>	3	guest	/	false	false	1	57	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4790.1>	10.31.1.114:43789 -> 10.31.0.248:5672 (5)	<'rabbit at mbuzz-queue-002'.1.4758.1>	5	guest	/	false	false	1	56	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4800.1>	10.31.1.114:43791 -> 10.31.0.248:5672 (1)	<'rabbit at mbuzz-queue-002'.1.4794.1>	1	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-002'.1.4814.1>	10.31.1.114:43793 -> 10.31.0.248:5672 (1)	<'rabbit at mbuzz-queue-002'.1.4808.1>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.4820.1>	10.31.1.114:43792 -> 10.31.0.248:5672 (1)	<'rabbit at mbuzz-queue-002'.1.4804.1>	1	guest	/	false	false	1	63	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4824.1>	10.31.1.114:43791 -> 10.31.0.248:5672 (2)	<'rabbit at mbuzz-queue-002'.1.4794.1>	2	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-002'.1.4828.1>	10.31.1.114:43791 -> 10.31.0.248:5672 (5)	<'rabbit at mbuzz-queue-002'.1.4794.1>	5	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-002'.1.4832.1>	10.31.1.114:43791 -> 10.31.0.248:5672 (4)	<'rabbit at mbuzz-queue-002'.1.4794.1>	4	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-002'.1.4836.1>	10.31.1.114:43791 -> 10.31.0.248:5672 (3)	<'rabbit at mbuzz-queue-002'.1.4794.1>	3	guest	/	false	false	1	0	0	0	0	1000	false
<'rabbit at mbuzz-queue-002'.1.4846.1>	10.31.1.114:43794 -> 10.31.0.248:5672 (1)	<'rabbit at mbuzz-queue-002'.1.4840.1>	1	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.4850.1>	10.31.1.114:43792 -> 10.31.0.248:5672 (3)	<'rabbit at mbuzz-queue-002'.1.4804.1>	3	guest	/	false	false	1	60	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4854.1>	10.31.1.114:43792 -> 10.31.0.248:5672 (2)	<'rabbit at mbuzz-queue-002'.1.4804.1>	2	guest	/	false	false	1	60	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4858.1>	10.31.1.114:43792 -> 10.31.0.248:5672 (4)	<'rabbit at mbuzz-queue-002'.1.4804.1>	4	guest	/	false	false	1	60	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4862.1>	10.31.1.114:43792 -> 10.31.0.248:5672 (5)	<'rabbit at mbuzz-queue-002'.1.4804.1>	5	guest	/	false	false	1	60	0	0	0	10000	false
<'rabbit at mbuzz-queue-002'.1.4886.1>	10.31.1.114:43794 -> 10.31.0.248:5672 (2)	<'rabbit at mbuzz-queue-002'.1.4840.1>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.4890.1>	10.31.1.114:43790 -> 10.31.0.248:5672 (2)	<'rabbit at mbuzz-queue-002'.1.4768.1>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.4898.1>	10.31.1.114:43788 -> 10.31.0.248:5672 (2)	<'rabbit at mbuzz-queue-002'.1.4728.1>	2	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.15282.1>	10.31.1.114:43790 -> 10.31.0.248:5672 (3)	<'rabbit at mbuzz-queue-002'.1.4768.1>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.15286.1>	10.31.1.114:43790 -> 10.31.0.248:5672 (4)	<'rabbit at mbuzz-queue-002'.1.4768.1>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.15297.1>	10.31.1.114:43788 -> 10.31.0.248:5672 (3)	<'rabbit at mbuzz-queue-002'.1.4728.1>	3	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.15301.1>	10.31.1.114:43788 -> 10.31.0.248:5672 (4)	<'rabbit at mbuzz-queue-002'.1.4728.1>	4	guest	/	false	false	0	0	0	0	0	0	false
<'rabbit at mbuzz-queue-002'.1.15305.1>	10.31.1.114:43788 -> 10.31.0.248:5672 (5)	<'rabbit at mbuzz-queue-002'.1.4728.1>	5	guest	/	false	false	0	0	0	0	0	0	false

Queues on /:
pid	name	durable	auto_delete	arguments	owner_pid	slave_pids	synchronised_slave_pids	exclusive_consumer_pid	exclusive_consumer_tag	messages_ready	messages_unacknowledged	messages	consumers	memory	backing_queue_status
<'rabbit at mbuzz-queue-001'.2.222.0>	sm.private.raw.cluster-1	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.254.0>]	[<'rabbit at mbuzz-queue-002'.1.254.0>]			0	0	0	2	144416	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,405787}, {persistent_count,0}, {avg_ingress_rate,0.15874708335306648}, {avg_egress_rate,0.15874708335306648}, {avg_ack_ingress_rate,0.15874708335306648}, {avg_ack_egress_rate,0.15874708335306648}, {mirror_seen,0}, {mirror_senders,5}]
<'rabbit at mbuzz-queue-001'.2.223.0>	sm.public.enriched.dre.cluster-1	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.256.0>]	[<'rabbit at mbuzz-queue-002'.1.256.0>]			0	232	232	12	1817096	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,232}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,22941092}, {persistent_count,232}, {avg_ingress_rate,10.675165653452904}, {avg_egress_rate,10.675165653452904}, {avg_ack_ingress_rate,10.675165653452904}, {avg_ack_egress_rate,13.54579843421335}, {mirror_seen,0}, {mirror_senders,57}]
<'rabbit at mbuzz-queue-001'.2.401.2>	clone.to.dev.es.sm.public.raw	false	true	[{"x-message-ttl",5000}]						0	0	0	1	12350336	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,15099628}, {persistent_count,0}, {avg_ingress_rate,488.3488594980552}, {avg_egress_rate,488.3488594980552}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<'rabbit at mbuzz-queue-001'.2.224.0>	sm.public.spinner.raw.hbase	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.258.0>]	[<'rabbit at mbuzz-queue-002'.1.258.0>]			0	0	0	6	4719440	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,21926105}, {persistent_count,0}, {avg_ingress_rate,399.6175556408158}, {avg_egress_rate,399.6175556408158}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, {mirror_senders,10}]
<'rabbit at mbuzz-queue-001'.2.225.0>	sm.public.spinner.raw.cluster-1.sp.md	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.260.0>]	[<'rabbit at mbuzz-queue-002'.1.260.0>]			0	0	0	10	181048	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,206405}, {persistent_count,0}, {avg_ingress_rate,2.5740114080185603}, {avg_egress_rate,2.5740114080185603}, {avg_ack_ingress_rate,2.5740114080185603}, {avg_ack_egress_rate,2.5740114080185603}, {mirror_seen,0}, {mirror_senders,10}]
<'rabbit at mbuzz-queue-001'.2.226.0>	sm.private.enriched.dre.cluster-1	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.262.0>]	[<'rabbit at mbuzz-queue-002'.1.262.0>]			0	0	0	2	286728	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,405799}, {persistent_count,0}, {avg_ingress_rate,0.06725883587734276}, {avg_egress_rate,0.06725883587734276}, {avg_ack_ingress_rate,0.06725883587734276}, {avg_ack_egress_rate,0.1345176717546855}, {mirror_seen,0}, {mirror_senders,6}]
<'rabbit at mbuzz-queue-001'.2.227.0>	sm.public.enriched.dre.index.global.cluster-1	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.264.0>]	[<'rabbit at mbuzz-queue-002'.1.264.0>]			0	99	99	4	16018040	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,99}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,22941096}, {persistent_count,99}, {avg_ingress_rate,9.848376428708267}, {avg_egress_rate,9.848376428708267}, {avg_ack_ingress_rate,9.848376428708267}, {avg_ack_egress_rate,2.5011749660211473}, {mirror_seen,0}, {mirror_senders,57}]
<'rabbit at mbuzz-queue-001'.2.400.2>	clone.to.dev.es.sm.public.spinner.raw	false	true	[{"x-message-ttl",5000}]						0	0	0	1	36336	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,7387811}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<'rabbit at mbuzz-queue-001'.2.228.0>	sm.public.raw.cluster-1	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.266.0>]	[<'rabbit at mbuzz-queue-002'.1.266.0>]			0	9903	9903	60	37011056	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,9903}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,775349866}, {persistent_count,9903}, {avg_ingress_rate,741.2456898548614}, {avg_egress_rate,741.2456898548614}, {avg_ack_ingress_rate,741.2456898548614}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, {mirror_senders,48}]
<'rabbit at mbuzz-queue-001'.2.229.0>	sm.public.spinner.raw.cluster-1.sp.sc	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.268.0>]	[<'rabbit at mbuzz-queue-002'.1.268.0>]			0	0	0	10	269536	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,551783}, {persistent_count,0}, {avg_ingress_rate,2.1608633081088557}, {avg_egress_rate,2.1608633081088557}, {avg_ack_ingress_rate,2.1608633081088557}, {avg_ack_egress_rate,7.022805751353781}, {mirror_seen,0}, {mirror_senders,10}]
<'rabbit at mbuzz-queue-001'.2.230.0>	sm.public.enriched.hbase.cluster-1	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.270.0>]	[<'rabbit at mbuzz-queue-002'.1.270.0>]			0	88	88	40	4738648	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,88}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,22941101}, {persistent_count,88}, {avg_ingress_rate,9.900792499970375}, {avg_egress_rate,9.900792499970375}, {avg_ack_ingress_rate,9.900792499970375}, {avg_ack_egress_rate,4.209785787388979}, {mirror_seen,0}, {mirror_senders,57}]
<'rabbit at mbuzz-queue-001'.2.231.0>	sm.public.raw.hbase	true	false	[{"x-ha-policy","all"}]		[<'rabbit at mbuzz-queue-002'.1.272.0>]	[<'rabbit at mbuzz-queue-002'.1.272.0>]			0	0	0	18	25163864	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,15830483}, {persistent_count,0}, {avg_ingress_rate,513.7003214767358}, {avg_egress_rate,513.7003214767358}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, {mirror_senders,48}]

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.direct	direct	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.rabbitmq.trace	topic	true	false	false	[]
exchange.public.enriched	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
exchange.public.raw	topic	true	false	false	[]
exchange.private.enriched	topic	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
exchange.private.raw	topic	true	false	false	[]
amq.headers	headers	true	false	false	[]
exchange.public.spinner.raw	topic	true	false	false	[]
	direct	true	false	false	[]
amq.match	headers	true	false	false	[]

Bindings on /:
source_name	source_kind	destination_name	destination_kind	routing_key	arguments
	exchange	clone.to.dev.es.sm.public.raw	queue	clone.to.dev.es.sm.public.raw	[]
	exchange	clone.to.dev.es.sm.public.spinner.raw	queue	clone.to.dev.es.sm.public.spinner.raw	[]
	exchange	sm.private.enriched.dre.cluster-1	queue	sm.private.enriched.dre.cluster-1	[]
	exchange	sm.private.raw.cluster-1	queue	sm.private.raw.cluster-1	[]
	exchange	sm.public.enriched.dre.cluster-1	queue	sm.public.enriched.dre.cluster-1	[]
	exchange	sm.public.enriched.dre.index.global.cluster-1	queue	sm.public.enriched.dre.index.global.cluster-1	[]
	exchange	sm.public.enriched.hbase.cluster-1	queue	sm.public.enriched.hbase.cluster-1	[]
	exchange	sm.public.raw.cluster-1	queue	sm.public.raw.cluster-1	[]
	exchange	sm.public.raw.hbase	queue	sm.public.raw.hbase	[]
	exchange	sm.public.spinner.raw.cluster-1.sp.md	queue	sm.public.spinner.raw.cluster-1.sp.md	[]
	exchange	sm.public.spinner.raw.cluster-1.sp.sc	queue	sm.public.spinner.raw.cluster-1.sp.sc	[]
	exchange	sm.public.spinner.raw.hbase	queue	sm.public.spinner.raw.hbase	[]
exchange.private.enriched	exchange	sm.private.enriched.dre.cluster-1	queue	#	[]
exchange.private.raw	exchange	sm.private.raw.cluster-1	queue	#	[]
exchange.public.enriched	exchange	sm.public.enriched.dre.cluster-1	queue	#	[]
exchange.public.enriched	exchange	sm.public.enriched.dre.index.global.cluster-1	queue	#	[]
exchange.public.enriched	exchange	sm.public.enriched.hbase.cluster-1	queue	#	[]
exchange.public.raw	exchange	clone.to.dev.es.sm.public.raw	queue	#	[]
exchange.public.raw	exchange	sm.public.raw.cluster-1	queue	#	[]
exchange.public.raw	exchange	sm.public.raw.hbase	queue	#	[]
exchange.public.spinner.raw	exchange	clone.to.dev.es.sm.public.spinner.raw	queue	#	[]
exchange.public.spinner.raw	exchange	sm.public.spinner.raw.hbase	queue	#	[]
exchange.public.spinner.raw	exchange	sm.public.spinner.raw.cluster-1.sp.md	queue	-n	[]
exchange.public.spinner.raw	exchange	sm.public.spinner.raw.cluster-1.sp.md	queue	sp.md	[]
exchange.public.spinner.raw	exchange	sm.public.spinner.raw.cluster-1.sp.sc	queue	sp.sc	[]

Consumers on /:
queue_name	channel_pid	consumer_tag	ack_required
sm.private.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6749.4>	amq.ctag-QzbZmIEpmwweE0HG60EFZG	true
sm.private.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.825.0>	amq.ctag-ANUbYkm0NrXLFkklUNyP8Y	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.8768.1>	amq.ctag-Q-ENih4ulU2wSBDOCX5aT8	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.8762.1>	amq.ctag-A5bRyPYJVZDCM1cZw7vTWu	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.4057.0>	amq.ctag-w-mThl_8aFtwCGNoNeq5Xl	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.8788.1>	amq.ctag-Ar4_dtUkId3SwQ7nvvZMXe	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.8783.1>	amq.ctag-ARHEmftGFjyVLx3Z5MWFpp	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.3415.0>	amq.ctag-gmZ0_8UiXdPzUFGahxPjAu	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.4086.0>	amq.ctag-AFX7tSgChl1uJ1YZdR_0Yw	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.4090.0>	amq.ctag-gor2iCf-UXXcxD9D7CyuAn	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.3419.0>	amq.ctag-wdkBo9Vbtv1a9TImZSkriy	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.3411.0>	amq.ctag-g2mZ8W5qVKbW71jL-FN-mm	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.4045.0>	amq.ctag-AotaUJKP_OZIydjy5CgApd	true
sm.public.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.3403.0>	amq.ctag-gTuHEyD-5yEqEeQng5aCpv	true
clone.to.dev.es.sm.public.raw	<'rabbit at mbuzz-queue-001'.2.394.2>	amq.ctag-wJr9qUJqMp4Eh60QLzRA_-	false
sm.public.spinner.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2099.0>	amq.ctag-gdkRRWF6Rk4ipklG5txx27	false
sm.public.spinner.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2103.0>	amq.ctag-QFPzMLvPUYVCZUtCJZFs8R	false
sm.public.spinner.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2120.0>	amq.ctag-wQW0lLGzCzBNS4HDRS30_K	false
sm.public.spinner.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2112.0>	amq.ctag-gLPhr_oDDAY70nS8loImoH	false
sm.public.spinner.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2124.0>	amq.ctag-wqkG7zJ2Z2ogKIvaM0bLTe	false
sm.public.spinner.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2116.0>	amq.ctag-Q9e4-cvcSKiXaT7yAiI2C4	false
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.742.0>	amq.ctag-gLJbMUSBJdEffOhtIHFmow	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.6865.4>	amq.ctag-QebwpBesIq9r90FmSQDZGZ	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.6859.4>	amq.ctag-wZ1y5qNdzNCRUY7jiCoRRS	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.6804.4>	amq.ctag-Q8wkRZ-oyklAR6Y7XHdRzc	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.6854.4>	amq.ctag-g-2LCG5QG4H0ZsiahWK1aO	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.6766.4>	amq.ctag-w14oxIL1WmtnpenNELF_KO	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.642.0>	amq.ctag-wCjRIJRzkuxTQn5l-hyil7	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.582.0>	amq.ctag-glMtfiBabu0-CZMTju9VE_	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.578.0>	amq.ctag-AVZrvyCGnUuw4J8g2XoYV9	true
sm.public.spinner.raw.cluster-1.sp.md	<'rabbit at mbuzz-queue-001'.2.520.0>	amq.ctag-Qq0YFrELz_OaiOGj8zADSW	true
sm.private.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.8753.1>	amq.ctag-QvURAxHoyHiJIgSjUWZIv9	true
sm.private.enriched.dre.cluster-1	<'rabbit at mbuzz-queue-001'.2.3399.0>	amq.ctag-Q12_TtD_8hOS_jlg_ENRFA	true
sm.public.enriched.dre.index.global.cluster-1	<'rabbit at mbuzz-queue-001'.2.6704.4>	amq.ctag-AgsdwdpX1jjiPVJtrvi2P_	true
sm.public.enriched.dre.index.global.cluster-1	<'rabbit at mbuzz-queue-001'.2.6688.4>	amq.ctag-wAvXDU5QoIcJ7wHUsNrnvv	true
sm.public.enriched.dre.index.global.cluster-1	<'rabbit at mbuzz-queue-001'.2.7245.4>	amq.ctag-Qx1dnsTxCb43wEkZcbJP2g	true
sm.public.enriched.dre.index.global.cluster-1	<'rabbit at mbuzz-queue-001'.2.7249.4>	amq.ctag-gfA17vdrhV9-3lXxr47vnD	true
clone.to.dev.es.sm.public.spinner.raw	<'rabbit at mbuzz-queue-001'.2.398.2>	amq.ctag-A3OB46iezAaHJc98QzBnCy	false
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.506.0>	amq.ctag-gb_9dMrKyeWDntP508RML6	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6846.4>	amq.ctag-g-Mn0bQOmyXd0g5M9zlxPQ	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6644.4>	amq.ctag-QNx6Fx6E1TJYL_j_Qs7Qe9	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6570.4>	amq.ctag-wqio0OValTyZcQkHo6YIfa	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6851.4>	amq.ctag-wnL4TpS0ydFulcKe3EwF52	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.498.0>	amq.ctag-AdO0xN4QKzLPjWvWqqWvQ3	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6575.4>	amq.ctag-AspvH-P27lANiFVC_PYJjc	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6486.4>	amq.ctag-wKUB66Bgx5a7xDQFMIjLxW	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6757.4>	amq.ctag-Q-KtsxL_oq_notz19S0NQ5	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.538.0>	amq.ctag-wlCxmC907Pjr19CG6g2Ntr	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6807.4>	amq.ctag-g_pto08WXZKZ11deh6xxT9	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.526.0>	amq.ctag-QQrEPWzVvsW7DHmL6-3Jsw	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6512.4>	amq.ctag-gBZspjXZbDzLsSd3SLSUrs	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6796.4>	amq.ctag-AcpByuUhqgL79N9t-thl06	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4858.1>	amq.ctag-ArU0qOYas2Adk1v_q3fAgl	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6548.4>	amq.ctag-gvScNsQUk_RLaW30AGFrwm	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4764.1>	amq.ctag-wdHTENX3RX-5k9CBht30Z3	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6496.4>	amq.ctag-gw4uZbdq9zwK0HX9P94_eF	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6519.4>	amq.ctag-gTrOqKWCXMNBrPthAPNoCx	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4786.1>	amq.ctag-wjZFED_JTWoQb2YtLzUE9H	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.534.0>	amq.ctag-g2LgHU2t5_Lko3gZx5OqQT	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.398.0>	amq.ctag-w8LXfO9oKAv8yb6sCGCIMi	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6593.4>	amq.ctag-gxdCcoqzLLNOuYKWsa3ZdC	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6560.4>	amq.ctag-gX29qxFCM3d0W9lllvxrx2	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4782.1>	amq.ctag-Ap7phJeEbAyazT2bJCSzt2	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4739.1>	amq.ctag-g7IurZBoafwWhnVwpcSKjH	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.502.0>	amq.ctag-ACRbMktHGR2zmg4pjA91sX	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4778.1>	amq.ctag-wc1gp2prMr_EccRcpRMrOB	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6561.4>	amq.ctag-QdYAIJyEqMByLrgJ8HM1on	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6574.4>	amq.ctag-ALzfPiaJ-Z_gEFN2RAKsEu	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4751.1>	amq.ctag-QOPs_rZEvDxmtWzZVaLfxf	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.530.0>	amq.ctag-QW4Jk1HBtHF2EubyET2RsE	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.436.0>	amq.ctag-gpI6WGkGKhgK_60spw4Jbx	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6625.4>	amq.ctag-ArMxNsXjScS2tKdSRYEKk0	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.386.0>	amq.ctag-AQZhOviW3rSwkcXaGkQam6	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4790.1>	amq.ctag-goSZO1f-NM11YpWLrybTze	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6754.4>	amq.ctag-w5rEqNE4z4iI6SjCqD_Ap8	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.432.0>	amq.ctag-AvXbXWxsCRN32O1WJmWjZm	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4820.1>	amq.ctag-gNxnpmJTluMMOdjANaMGRP	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.385.0>	amq.ctag-QWjey3W02q5BcCnYsCR4ur	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6533.4>	amq.ctag-whOU2h_-6pxODN1r81OUF1	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.444.0>	amq.ctag-wO_QSExok3tzdrvL9dN_WR	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6505.4>	amq.ctag-Qq6AmQGRgNjyPIujkjxEBk	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6589.4>	amq.ctag-wHeRFdWh_h2GBpv0EBqNxe	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4743.1>	amq.ctag-gorH8rBSlBRFVAenmMGLNA	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6611.4>	amq.ctag-Ql5B4xV6kMSpmxPwHkUMbt	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4854.1>	amq.ctag-ghyrP-EoEHamlkl5nfxTVR	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.570.0>	amq.ctag-wiKK5k7X0wD9ebssRFRUux	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4724.1>	amq.ctag-wH9mH0-pYXlrf2j2K7BZzj	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6540.4>	amq.ctag-ge4U4payJB9rDzclSPMhkj	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.390.0>	amq.ctag-QjdIaFMw7SeS2KIEzzpEFd	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6729.4>	amq.ctag-AEoR7eq1oFmpA1nr0OxO3O	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4747.1>	amq.ctag-QEhulknY3NFng7oCtUl2Fb	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6780.4>	amq.ctag-AEGeAZqdNFQAMJ5ekhQ2VH	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6839.4>	amq.ctag-gkgJ0B6QSh_lTmWVzlZZRN	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6828.4>	amq.ctag-AeNNbN2hRYlHTWN8WwAVEQ	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6629.4>	amq.ctag-wsNxtBUks6P8WlclH6OH7p	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-001'.2.6609.4>	amq.ctag-gfy_ensc0pcHd8oQvvhMWD	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4862.1>	amq.ctag-QF5_64Vo_SDVwnYVIhB-rY	true
sm.public.raw.cluster-1	<'rabbit at mbuzz-queue-002'.1.4850.1>	amq.ctag-gBt3LrUcAb8Hlo7oEuicGg	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-001'.2.6777.4>	amq.ctag-QdJ2pgGm_g_PLfxudmt6cD	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-002'.1.4832.1>	amq.ctag-gvc5YD76R9M23M0iYmM5ef	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-002'.1.4824.1>	amq.ctag-Q8nFrs9BG7P4YfTrdwICF7	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-002'.1.4836.1>	amq.ctag-A4Qi9dD4A4rJfENGKGsjxZ	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-002'.1.4828.1>	amq.ctag-gKPhuEdAVT0xdbGfif6WAQ	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-002'.1.4800.1>	amq.ctag-AwypvApo6Nj1zQkfRNzDx3	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-001'.2.7227.4>	amq.ctag-w2IICKa-gwcXBnCjaMhSUI	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-001'.2.7223.4>	amq.ctag-gcNqq72z1yFFPtr_oldxwo	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-001'.2.6955.4>	amq.ctag-ATgJ1IEv7aLd9fBGUo1qqT	true
sm.public.spinner.raw.cluster-1.sp.sc	<'rabbit at mbuzz-queue-001'.2.6748.4>	amq.ctag-gDI09Mxz23DVYJoNoQ_X0f	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.7235.4>	amq.ctag-ASVkCa81zJR5pPcLfbauir	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.490.0>	amq.ctag-QeIBUaRljqm8y2JicUsGoA	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.1040.0>	amq.ctag-QgcB9jyBA8PqvhHndJ5uhb	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.967.0>	amq.ctag-QfDt7lNtLp1Kdl8xGavJZw	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.1036.0>	amq.ctag-QrKqVb_Ydl24eVOvQqjqzz	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.801.0>	amq.ctag-wCoVK-iZjrdriwWI2lAD7S	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.394.0>	amq.ctag-A5WiBrkrkDTvfQbF7dSm3P	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.1032.0>	amq.ctag-Qx3gbKYrQN120fLWXo4D6m	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.366.0>	amq.ctag-AEHxMMyyGb03DUJM9A8dFA	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.7183.4>	amq.ctag-QeLFvueezYT8ZqKvKzkH9B	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.7173.4>	amq.ctag-gqPeXct3YtkEA1T12AIy7e	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.7161.4>	amq.ctag-wrJ0aAQfDNAihlaPYHBjOo	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6973.4>	amq.ctag-ABZyMy3xQyQ5FS2V2WT_aP	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6921.4>	amq.ctag-AHt0Qe8J1l1S8o_Av14yF1	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6808.4>	amq.ctag-QG2c1SwAxU5c_2Hf_qOYXK	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6759.4>	amq.ctag-g89029Y-Q_DvzFntufJNRN	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6705.4>	amq.ctag-QNoS3JbINoVV_4O4hBjeMS	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6720.4>	amq.ctag-w6ngMmsOxIjWzKkH1kWlNV	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6621.4>	amq.ctag-gIfIzoRtp0Wr20pymix-GC	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6638.4>	amq.ctag-wckMBJL-tzmbvVSj1iaR95	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.6607.4>	amq.ctag-AfohVLFaIhpPD29ghsnSPi	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.690.0>	amq.ctag-QtibI2Bw4hKB_net5lNWaT	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.785.0>	amq.ctag-ACZVsUaTQpFEmmgS4iybvy	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.718.0>	amq.ctag-gCIvNH_Li61kiqcCvww6o7	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.726.0>	amq.ctag-gVY8hAmIA1XmCH87LAzkpi	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.738.0>	amq.ctag-QiSh7wV8N15PR47YD2A-Wy	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.710.0>	amq.ctag-wOuLAZcD2BdmVtaI77-V-d	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.714.0>	amq.ctag-wHADgUQNWeuTuFrTVwoe1x	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.730.0>	amq.ctag-gx3xs4CQBz6WimCp4yY0Cv	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.987.0>	amq.ctag-AiNQXeUpUKKjgASV4PGo9l	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.963.0>	amq.ctag-wkuTQj-UgpNd1xKapa7a7F	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.734.0>	amq.ctag-QCKo_9H22bc72TEGPOb7SX	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.943.0>	amq.ctag-wNZyqjDlhR7Pr7OVrUBEay	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.494.0>	amq.ctag-AD-ledRMBbtBpmbWNwOsx1	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.811.0>	amq.ctag-AOfuBwjJYUDH_E1BICuIac	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.931.0>	amq.ctag-wnDgwbd3CjAP-PGQOZF5sA	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.815.0>	amq.ctag-wjOvOpFP8YXDv02o_139xp	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.7253.4>	amq.ctag-w5yxn2w4u3xjZbV5ZhMr85	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.979.0>	amq.ctag-wYgqyCB6QZkn_1BO94qgZX	true
sm.public.enriched.hbase.cluster-1	<'rabbit at mbuzz-queue-001'.2.7231.4>	amq.ctag-wzn-RQUNztRf2ASNWhfONw	true
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2164.0>	amq.ctag-QibeviZvg7ftu0HFbNRlw8	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2062.0>	amq.ctag-w2ce_PggIsCIYJSa8ZR8Qg	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2184.0>	amq.ctag-gipfdjoMHqNuHqhRiQQeLX	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2168.0>	amq.ctag-Qx9uQJsLerEZabHPpoci6_	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2160.0>	amq.ctag-gnlN3AiMvA0c2M6QlbfnV5	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2152.0>	amq.ctag-AYWrnytMUeDQaxrU7yCE8p	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2189.0>	amq.ctag-AkZk-5aMFIk_86-AoDgo8o	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2070.0>	amq.ctag-Qqno4x3TB0O-OXEDqzEyvX	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2180.0>	amq.ctag-Aqu5SG7ihc8q3PtEcauDv5	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2193.0>	amq.ctag-A12K94hivr10BQM_mol3xP	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2176.0>	amq.ctag-g_TetDAvTekZfFfm7W8gSs	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2054.0>	amq.ctag-gcgecohfam-7WUreOT_6Vb	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2144.0>	amq.ctag-gPN_b7JngFupAnpcSmB_yi	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2172.0>	amq.ctag-gGE7QITBDKlbpIEGtXTOX8	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2074.0>	amq.ctag-AKN7lsQceYb7S20WcSJiXM	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2148.0>	amq.ctag-gBNhGRH8TGaK1jKmr3CtNt	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2058.0>	amq.ctag-gXW4-GwSXiIezgSrqfYGLh	false
sm.public.raw.hbase	<'rabbit at mbuzz-queue-001'.2.2066.0>	amq.ctag-whDsOzUiTUBETeqXr1n7Rn	false

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at mbuzz-queue-002_shortened.log
Type: application/octet-stream
Size: 38030 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120827/4a1d51cf/attachment.obj>

From matthias.reik at gmail.com  Mon Aug 27 16:02:49 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Mon, 27 Aug 2012 17:02:49 +0200
Subject: [rabbitmq-discuss] Fwd: Excessive memory consumption of one server
 in cluster setup
In-Reply-To: <CAJ1JW0cApHhq18ZKbsyuFQptWEiCBqk4bX1NZQMvK_Da74Lpnw@mail.gmail.com>
References: <503772C6.8080700@reik.se>
	<CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>
	<503B78B6.6050301@rabbitmq.com>
	<CAJ1JW0cApHhq18ZKbsyuFQptWEiCBqk4bX1NZQMvK_Da74Lpnw@mail.gmail.com>
Message-ID: <CAJ1JW0e+6QLY4eNbY8VXoA4Y+6Wpy+C38xA+UdZRHFkhMFTyKw@mail.gmail.com>

Hi Matthias,

even though the setup looks slightly differently (since we are not using
the shovel plugin), the reason
could be the same. We are explicitly ACKing the messages (i.e. no
auto-ack), even though the consumers
are in the same data-centers (so we should have a reliable network), but if
the acks are lost and that
causes memory increase in the server then it could be the same bug.

Is there anything I could do to validate this assumption? I have provided
initial logs to Francesco.

Is there anything I can do in the meantime to get into a state where I have
a working cluster again
(currently I took our second server out from the cluster, but that's of
course a bit of a risky thing to do)

Thx for your help, appreciate a lot.

Cheers
Matthias


On Mon, Aug 27, 2012 at 3:40 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Matthias,
>
>
> On 27/08/12 10:26, Matthias Reik wrote:
>
>> I just upgraded to 2.8.6, and I see the same effect with the latest
>> version :-(
>> (not really unexpected, since nothing was fixed in that regard in 2.8.6).
>>
>> Already after about 10 minutes server2 consumes 200% more memory than
>> server1,
>>
>
> Thanks for reporting this.
>
> This is almost certainly the same bug as
> http://rabbitmq.1065348.n5.**nabble.com/Shovel-stops-**
> receiving-acks-from-cluster-**tp21384p21649.html<http://rabbitmq.1065348.n5.nabble.com/Shovel-stops-receiving-acks-from-cluster-tp21384p21649.html>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120827/79288a4d/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 27 16:22:43 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Aug 2012 16:22:43 +0100
Subject: [rabbitmq-discuss] Fwd: Excessive memory consumption of one
 server in cluster setup
In-Reply-To: <CAJ1JW0e+6QLY4eNbY8VXoA4Y+6Wpy+C38xA+UdZRHFkhMFTyKw@mail.gmail.com>
References: <503772C6.8080700@reik.se>
	<CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>
	<503B78B6.6050301@rabbitmq.com>
	<CAJ1JW0cApHhq18ZKbsyuFQptWEiCBqk4bX1NZQMvK_Da74Lpnw@mail.gmail.com>
	<CAJ1JW0e+6QLY4eNbY8VXoA4Y+6Wpy+C38xA+UdZRHFkhMFTyKw@mail.gmail.com>
Message-ID: <503B90C3.1080900@rabbitmq.com>

Matthias,

On 27/08/12 16:02, Matthias Reik wrote:
> even though the setup looks slightly differently (since we are not
> using the shovel plugin), the reason could be the same. We are
> explicitly ACKing the messages (i.e. no auto-ack), even though the
> consumers are in the same data-centers (so we should have a reliable
> network), but if the acks are lost and that causes memory increase in
> the server then it could be the same bug.

As noted in my analysis, the bug has nothing do with the shovel, or 
consuming/acking - simply publishing to HA queues when (re)starting 
slaves is sufficient to trigger it.

> Is there anything I could do to validate this assumption?

I don't think it's worth the hassle. I am quite certain that you are 
suffering from the same bug.

> Is there anything I can do in the meantime to get into a state where I
> have a working cluster again

Pause all publishing before (re)starting any cluster nodes.

Regards,

Matthias.

From Michael.Laing at nytimes.com  Mon Aug 27 16:53:54 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 27 Aug 2012 11:53:54 -0400
Subject: [rabbitmq-discuss] Fwd: Excessive memory consumption of one
 server in cluster setup
In-Reply-To: <503B90C3.1080900@rabbitmq.com>
Message-ID: <CC610F3E.4470%Michael.Laing@nytimes.com>

I have not yet run into this issue but I have a question:

Would it be appropriate to use 'rabbitmqctl set_vm_memory_high_watermark'
to a low value to temporarily pause publishers, then restart the cluster
nodes, and then reset to the normal value?

Thanks.

Michael

On 8/27/12 11:22 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Matthias,
>
>On 27/08/12 16:02, Matthias Reik wrote:
>> even though the setup looks slightly differently (since we are not
>> using the shovel plugin), the reason could be the same. We are
>> explicitly ACKing the messages (i.e. no auto-ack), even though the
>> consumers are in the same data-centers (so we should have a reliable
>> network), but if the acks are lost and that causes memory increase in
>> the server then it could be the same bug.
>
>As noted in my analysis, the bug has nothing do with the shovel, or
>consuming/acking - simply publishing to HA queues when (re)starting
>slaves is sufficient to trigger it.
>
>> Is there anything I could do to validate this assumption?
>
>I don't think it's worth the hassle. I am quite certain that you are
>suffering from the same bug.
>
>> Is there anything I can do in the meantime to get into a state where I
>> have a working cluster again
>
>Pause all publishing before (re)starting any cluster nodes.
>
>Regards,
>
>Matthias.
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Mon Aug 27 17:21:25 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Aug 2012 17:21:25 +0100
Subject: [rabbitmq-discuss] Fwd: Excessive memory consumption of one
 server in cluster setup
In-Reply-To: <CC610F3E.4470%Michael.Laing@nytimes.com>
References: <CC610F3E.4470%Michael.Laing@nytimes.com>
Message-ID: <503B9E85.3090003@rabbitmq.com>

Michael,

On 27/08/12 16:53, Laing, Michael P. wrote:
> I have not yet run into this issue but I have a question:
>
> Would it be appropriate to use 'rabbitmqctl set_vm_memory_high_watermark'
> to a low value to temporarily pause publishers, then restart the cluster
> nodes, and then reset to the normal value?

Yes, that should work, i.e. you could lower the threshold on all nodes, 
wait for a bit to let the broker work through any backlog, then bounce 
individual nodes.

Note that restarting a node will reset the threshold, but since network 
listeners only get enabled after queue slave initialisation has 
completed that should be fine.

The only time that doesn't work is when you bring down an entire cluster 
and then start it back up. There you'd have to lower the threshold on 
the first node that comes up before starting any subsequent nodes.

Regards,

Matthias.

From yuva670 at gmail.com  Mon Aug 27 19:30:58 2012
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Tue, 28 Aug 2012 00:00:58 +0530
Subject: [rabbitmq-discuss] Non-blocking Consumers approach
In-Reply-To: <503B74F7.6040700@rabbitmq.com>
References: <CAPrynAVmxoa5eEtQFfgghCWsAUbQVtjrZAtqtaH9G0W2ESGseg@mail.gmail.com>
	<080D7020-EEC9-4044-8085-0C4A83591DF0@rabbitmq.com>
	<CAPrynAXK5svpkPO5=0qYub6gifzfqFpSPTPkYMdDJT6bZ5rUpQ@mail.gmail.com>
	<503B74F7.6040700@rabbitmq.com>
Message-ID: <CAPrynAWsS7anCPn+iruGNBPp+umQ93R6FV4SA8jBaFwWv0+8pQ@mail.gmail.com>

Hi,

As per your suggestion, I created 5 channels as follows:

for (int i = 0; i < 5; i++) {
            final Channel channel = connection.createChannel();
            channel.queueDeclare(RPC_QUEUE_NAME, false, false, false, null);
            channel.basicQos(1);

            log.info(" [x] Awaiting RPC requests");

            boolean autoAck = false;
            channel.basicConsume(RPC_QUEUE_NAME, autoAck, "watermark" + i,
                    new DefaultConsumer(channel) {

                        @Override
                        public void handleDelivery(String consumerTag,
                                Envelope envelope,
                                AMQP.BasicProperties properties,
                                byte[] body)
                                throws IOException {
                            String routingKey = envelope.getRoutingKey();
                            String contentType =
properties.getContentType();
                            long deliveryTag = envelope.getDeliveryTag();
                            //process the message here
                            channel.basicPublish("",
properties.getReplyTo(),
                                    new
BasicProperties.Builder().correlationId(properties.getCorrelationId()).build(),
                                    response.getBytes("UTF-8"));
                            channel.basicAck(deliveryTag, false);
                        }
                    });

            }

But, the consumer doesn't seem to listen to the queue, as soon as I run
this application, it exists. Earlier I used the while(true) loop to get the
messages. How do I make sure if the consumer listens to the intended queue
and process messages?


-Mahesh

On Mon, Aug 27, 2012 at 6:54 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Mahesh,
>
>
> On 27/08/12 13:37, Mahesh Viraktamath wrote:
>
>> I read the API guide and still stuck to the QueuingConsumer, for each
>> incoming message I create a new service thread (with common channel,
>> without that the service won't know which message to acknowledge). But
>> in the guide, it is mentioned that the channel should be created for
>> each thread. Now, my question is does this guide assumes that we run
>> different consumer threads? *I can't understand the concept of different
>> consumer threads*. I run a single consumer and use basicConsume() to
>>
>> listen to the messages and each message (nextDelivery()) will give rise
>> to a new service thread. Again, each message creating a thread is scary !
>>
>> If it helps, I am running the consumer as a java application and use
>> basicConsume() and nextDelivery() in a while loop to process the
>> messages. Our application sends messages to these non-stop. So, I am
>> looking for a consumer which will not block the incoming messages when
>> it is processing a large message.
>>
>
> I suggest you create N channels and for each channel:
> - set the basic.qos prefetch to 1 or some other low-ish value (for fair
> dispatch)
> - create a consumer as shown in http://www.rabbitmq.com/api-**
> guide.html#consuming <http://www.rabbitmq.com/api-guide.html#consuming>
>
> You write above that you only have one channel because "without that the
> service won't know which message to acknowledge", but the channel is
> accessible via the context (as shown in the example), so there is no
> ambiguity.
>
> Obviously message ordering goes out of the window, but that's the case for
> any scheme where messages are handled by multiple threads.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/bed9ad9f/attachment.htm>

From michael.kempe at googlemail.com  Mon Aug 27 19:48:10 2012
From: michael.kempe at googlemail.com (Micha)
Date: Mon, 27 Aug 2012 11:48:10 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
	<c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>
Message-ID: <4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>

Hi Derek,

Sorry for late reply. I'm still having problems when disposing the connection. Currently the only workaround for me is to call dispose() with a timeout.

Do you have more info about it?

Cheers,

Micha

From matthias at rabbitmq.com  Mon Aug 27 19:48:51 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Aug 2012 19:48:51 +0100
Subject: [rabbitmq-discuss] Non-blocking Consumers approach
In-Reply-To: <CAPrynAWsS7anCPn+iruGNBPp+umQ93R6FV4SA8jBaFwWv0+8pQ@mail.gmail.com>
References: <CAPrynAVmxoa5eEtQFfgghCWsAUbQVtjrZAtqtaH9G0W2ESGseg@mail.gmail.com>
	<080D7020-EEC9-4044-8085-0C4A83591DF0@rabbitmq.com>
	<CAPrynAXK5svpkPO5=0qYub6gifzfqFpSPTPkYMdDJT6bZ5rUpQ@mail.gmail.com>
	<503B74F7.6040700@rabbitmq.com>
	<CAPrynAWsS7anCPn+iruGNBPp+umQ93R6FV4SA8jBaFwWv0+8pQ@mail.gmail.com>
Message-ID: <503BC113.20607@rabbitmq.com>

Mahesh,

On 27/08/12 19:30, Mahesh Viraktamath wrote:
> as soon as I run this application, it exists

So you want your application to never terminate? Simply stick something
like this at the end:

synchronized(this) { while (true) this.wait(); }

or

while(true) Thread.sleep(Long.MAX_VALUE);

or something similar.

Regards,

Matthias.

From matthias.reik at gmail.com  Mon Aug 27 21:44:36 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Mon, 27 Aug 2012 22:44:36 +0200
Subject: [rabbitmq-discuss] Fwd: Excessive memory consumption of one
 server in cluster setup
In-Reply-To: <503B90C3.1080900@rabbitmq.com>
References: <503772C6.8080700@reik.se>
	<CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>
	<503B78B6.6050301@rabbitmq.com>
	<CAJ1JW0cApHhq18ZKbsyuFQptWEiCBqk4bX1NZQMvK_Da74Lpnw@mail.gmail.com>
	<CAJ1JW0e+6QLY4eNbY8VXoA4Y+6Wpy+C38xA+UdZRHFkhMFTyKw@mail.gmail.com>
	<503B90C3.1080900@rabbitmq.com>
Message-ID: <CAJ1JW0f28DKZqwc6dMaDKowSR_Hy1GG7GVDoP5+dS1qQwDwnJA@mail.gmail.com>

See comments inline

Thanks
Matthias

On Mon, Aug 27, 2012 at 5:22 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Matthias,
>
>
> On 27/08/12 16:02, Matthias Reik wrote:
>
>> even though the setup looks slightly differently (since we are not
>> using the shovel plugin), the reason could be the same. We are
>> explicitly ACKing the messages (i.e. no auto-ack), even though the
>> consumers are in the same data-centers (so we should have a reliable
>> network), but if the acks are lost and that causes memory increase in
>> the server then it could be the same bug.
>>
>
> As noted in my analysis, the bug has nothing do with the shovel, or
> consuming/acking - simply publishing to HA queues when (re)starting slaves
> is sufficient to trigger it.

Wasn't sure I understood it 100% correctly (sorry not too experienced with
RabbitMQ yet). Thx for the confirmation.


>
>
>  Is there anything I could do to validate this assumption?
>>
>
> I don't think it's worth the hassle. I am quite certain that you are
> suffering from the same bug.

 OK, if you expect a fix for the issue to appear soon then I could wait
with with "fixing" the cluster and try out any updated version. If it will
take more time, then I will probably go for your (below) suggested
fix/workaround.


>
>  Is there anything I can do in the meantime to get into a state where I
>> have a working cluster again
>>
>
> Pause all publishing before (re)starting any cluster nodes.
>
Yes, that makes sense.

Thank you for your quick response.

>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120827/a507fafb/attachment.htm>

From eliao at seegrid.com  Mon Aug 27 23:47:37 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Mon, 27 Aug 2012 22:47:37 +0000
Subject: [rabbitmq-discuss] Shovel restart command hanging
Message-ID: <E94F626F5C43D14F8B8479C5EBD790388A7DDA1D@vmexchange02.seegrid.local>

Hi,

Currently we are running Rabbitmq 2.8.2 and are running into some problems with a shovel configuration.  We were running into the shovel wedge issues that was mentioned in another discussion on this mailing list. It appeared to be sometimes resolved by the command: rabbitmqctl eval 'application:stop(rabbitmq_shovel), application:start(rabbitmq_shovel).'  However, other sometimes, executing this command would hang.  

Our other observations were as follows:
  * Executing all rabbit commands were hang (rabbitmqctl status, /etc/init.d/rabbitmq-server status). A control-c breaks out of it
  * Rabbitmq continues to handle all messages  
  * Error messages from logs below
  * I have all all logs and the contents of the MNESIA_BASE directory if needed
 
We noticed that 2.8.6 RabbitMQ contains shovel fixes. Would the new version of RabbitMQ prevent the problems that we're seeing - we know that it will prevent a shovel from getting stuck in the terminated state but is something else also going on?  and if not, what is the recommended fix? 

Thanks!

Liz
---------------
Errors from <nodename>.log:
=ERROR REPORT==== 27-Aug-2012::15:53:17 ===
** Last message in was socket_closed
** When Server state == {state,amqp_network_connection,
                            {state,#Port<0.211307>,5,<0.11430.8>,131072,
                                undefined,false},
                            <0.11417.8>,<0.11420.8>,
                            {amqp_params_network,<<"user1">>,
                                <<"pass1">>,<<"/">>,
                                "host1",5672,0,0,5,infinity,
                                none,
                                [#Fun<amqp_auth_mechanisms.plain.3>,
                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
                                [],[]},
                            0,
                            [{<<"capabilities">>,table,
                              [{<<"publisher_confirms">>,bool,true},
                               {<<"exchange_exchange_bindings">>,bool,true},
                               {<<"basic.nack">>,bool,true},
                               {<<"consumer_cancel_notify">>,bool,true}]},
                             {<<"copyright">>,longstr,
                              <<"Copyright (C) 2007-2012 VMware, Inc.">>},
                             {<<"information">>,longstr,
                              <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>},
                             {<<"platform">>,longstr,<<"Erlang/OTP">>},
                             {<<"product">>,longstr,<<"RabbitMQ">>},
                             {<<"version">>,longstr,<<"2.8.2">>}],
                            #Fun<amqp_connection_sup.0.39273983>,
                            #Fun<amqp_connection_sup.2.54430129>,false}
** Reason for termination == 
** socket_closed_unexpectedly

Output from <nodname>-sasl.log:

=CRASH REPORT==== 27-Aug-2012::15:53:17 ===
  crasher:
    pid: <0.11418.8>
    registered_name: []
    exception exit: socket_closed_unexpectedly
      in function  gen_server:terminate/6
    initial call: amqp_gen_connection:init/1
    ancestors: [<0.11417.8>,amqp_sup,<0.201.0>]
    messages: []
    links: [<0.11416.8>,<0.11417.8>,#Port<0.211307>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 610
    stack_size: 23
    reductions: 782
  neighbours:

=SUPERVISOR REPORT==== 27-Aug-2012::15:53:17 ===
     Supervisor: {<0.11417.8>,amqp_connection_sup}
     Context:    child_terminated
     Reason:     socket_closed_unexpectedly
     Offender:   [{pid,<0.11418.8>},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,<<"user1">>,
                               <<"pass1">>,<<"/">>,
                               "host1",5672,0,0,5,infinity,
                               none,
                               [#Fun<amqp_auth_mechanisms.plain.3>,
                                #Fun<amqp_auth_mechanisms.amqplain.3>],
                               [],[]},
                           #Fun<amqp_connection_sup.0.39273983>,
                           #Fun<amqp_connection_sup.2.54430129>,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 27-Aug-2012::15:53:17 ===
     Supervisor: {<0.11417.8>,amqp_connection_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.11418.8>},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,<<"user1">>,
                               <<"pass1">>,<<"/">>,
                               "host1",5672,0,0,5,infinity,
                               none,
                               [#Fun<amqp_auth_mechanisms.plain.3>,
                                #Fun<amqp_auth_mechanisms.amqplain.3>],
                               [],[]},
                           #Fun<amqp_connection_sup.0.39273983>,
                           #Fun<amqp_connection_sup.2.54430129>,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]

From tim at rabbitmq.com  Tue Aug 28 10:57:26 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 Aug 2012 10:57:26 +0100
Subject: [rabbitmq-discuss] Shovel restart command hanging
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD790388A7DDA1D@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DDA1D@vmexchange02.seegrid.local>
Message-ID: <503C9606.2010801@rabbitmq.com>

On 27/08/2012 23:47, Elizabeth Liao wrote:
> Hi,
>
> Currently we are running Rabbitmq 2.8.2 and are running into some problems with a shovel configuration.  We were running into the shovel wedge issues that was mentioned in another discussion on this mailing list. It appeared to be sometimes resolved by the command: rabbitmqctl eval 'application:stop(rabbitmq_shovel), application:start(rabbitmq_shovel).'  However, other sometimes, executing this command would hang.
>

Are you talking about the issue discussed in 
http://rabbitmq.1065348.n5.nabble.com/Shovel-stops-receiving-acks-from-cluster-td21384.html?

From tim at rabbitmq.com  Tue Aug 28 11:04:24 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 Aug 2012 11:04:24 +0100
Subject: [rabbitmq-discuss] Shovel restart command hanging
In-Reply-To: <503C9606.2010801@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DDA1D@vmexchange02.seegrid.local>
	<503C9606.2010801@rabbitmq.com>
Message-ID: <503C97A8.4030805@rabbitmq.com>

On 28/08/2012 10:57, Tim Watson wrote:
> On 27/08/2012 23:47, Elizabeth Liao wrote:
>> Hi,
>>
>> Currently we are running Rabbitmq 2.8.2 and are running into some
>> problems with a shovel configuration.  We were running into the shovel
>> wedge issues that was mentioned in another discussion on this mailing
>> list. It appeared to be sometimes resolved by the command: rabbitmqctl
>> eval 'application:stop(rabbitmq_shovel),
>> application:start(rabbitmq_shovel).'  However, other sometimes,
>> executing this command would hang.
>>
>
> Are you talking about the issue discussed in
> http://rabbitmq.1065348.n5.nabble.com/Shovel-stops-receiving-acks-from-cluster-td21384.html?
>

Er, I was a bit trigger happy with the send button there. I *meant* to 
say that as per 
http://rabbitmq.1065348.n5.nabble.com/Excessive-memory-consumption-of-one-server-in-cluster-setup-td21617.html, 
that bug appears to have nothing to do with using the shovel plugin.

If this is the issue you're facing, I'm actually working on a fix at the 
moment, and Matthias mentioned in 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-August/022133.html 
that it might be possible to work around this by using `rabbitmqctl 
set_vm_memory_high_watermark` to temporarily disable producers (by 
setting a very low value and make the broker apply back pressure) before 
restarting a node.

From m.luchak at smartasking.com  Tue Aug 28 15:23:28 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Tue, 28 Aug 2012 10:23:28 -0400 (EDT)
Subject: [rabbitmq-discuss] rabbitmq.config location and link
Message-ID: <1346163808.890220678@apps.rackspace.com>


Hi All,
 
I have created a rabbitmq.config file in "\etc\rabbitmq\"  (ubuntu RabbitMQ 2.8.5) but I can't seem to point my instance to pick it up.. I have  configured tcp keepalive true in the .config file but when I restart and run report the configs were not picked up..
 
How can I get Rabbitmq to pick up the .config file?
 
thansk,
Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/31cedcf3/attachment.htm>

From eliao at seegrid.com  Tue Aug 28 16:04:23 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Tue, 28 Aug 2012 15:04:23 +0000
Subject: [rabbitmq-discuss] Shovel restart command hanging
In-Reply-To: <503C97A8.4030805@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DDA1D@vmexchange02.seegrid.local>
	<503C9606.2010801@rabbitmq.com>,<503C97A8.4030805@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD790388A7DDBBA@vmexchange02.seegrid.local>

This is the shovel issue that I was referring to: http://rabbitmq.1065348.n5.nabble.com/Shovel-stuck-tp21398p21482.html. 

> Er, I was a bit trigger happy with the send button there. I *meant* to
> say that as per
> http://rabbitmq.1065348.n5.nabble.com/Excessive-memory-consumption-of-one-server-in-cluster-setup-td21617.html,
> that bug appears to have nothing to do with using the shovel plugin.

Is that specific to clusters? If so, I don't think that's our issue since we don't have a cluster setup.

Liz
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Tim Watson [tim at rabbitmq.com]
Sent: Tuesday, August 28, 2012 6:03 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovel restart command hanging

On 28/08/2012 10:57, Tim Watson wrote:
> On 27/08/2012 23:47, Elizabeth Liao wrote:
>> Hi,
>>
>> Currently we are running Rabbitmq 2.8.2 and are running into some
>> problems with a shovel configuration.  We were running into the shovel
>> wedge issues that was mentioned in another discussion on this mailing
>> list. It appeared to be sometimes resolved by the command: rabbitmqctl
>> eval 'application:stop(rabbitmq_shovel),
>> application:start(rabbitmq_shovel).'  However, other sometimes,
>> executing this command would hang.
>>
>
> Are you talking about the issue discussed in
> http://rabbitmq.1065348.n5.nabble.com/Shovel-stops-receiving-acks-from-cluster-td21384.html?
>

Er, I was a bit trigger happy with the send button there. I *meant* to
say that as per
http://rabbitmq.1065348.n5.nabble.com/Excessive-memory-consumption-of-one-server-in-cluster-setup-td21617.html,
that bug appears to have nothing to do with using the shovel plugin.

If this is the issue you're facing, I'm actually working on a fix at the
moment, and Matthias mentioned in
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-August/022133.html
that it might be possible to work around this by using `rabbitmqctl
set_vm_memory_high_watermark` to temporarily disable producers (by
setting a very low value and make the broker apply back pressure) before
restarting a node.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From m.luchak at smartasking.com  Tue Aug 28 16:28:03 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Tue, 28 Aug 2012 11:28:03 -0400 (EDT)
Subject: [rabbitmq-discuss] rabbitmq.config location and link
In-Reply-To: <1346163808.890220678@apps.rackspace.com>
References: <1346163808.890220678@apps.rackspace.com>
Message-ID: <1346167683.171621106@apps.rackspace.com>


nevermind... got it to load on start... but I have an error in the file
"(error in config file "/etc/rabbitmq/rabbitmq.config" (none): no ending <dot> found)"
 
here's my .config... can someone tell me what I've missed?  A dot at the end ;)?  Do I need a complet .config or is it ok to just define the tcp settings..?
 

[{tcp_listen_options, [binary,
 {packet, raw},
 {reuseaddr, true},
 {backlog, 128},
 {nodelay, true},
 {exit_on_close, false},
 {keepalive, true}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[<<"/">>]},
 {vm_memory_high_watermark,0.4}]
 
-----Original Message-----
From: m.luchak at smartasking.com
Sent: Tuesday, August 28, 2012 10:23am
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Subject: [rabbitmq-discuss] rabbitmq.config location and link



Hi All,
 
I have created a rabbitmq.config file in "\etc\rabbitmq\"  (ubuntu RabbitMQ 2.8.5) but I can't seem to point my instance to pick it up.. I have  configured tcp keepalive true in the .config file but when I restart and run report the configs were not picked up..
 
How can I get Rabbitmq to pick up the .config file?
 
thansk,
Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/4444e444/attachment.htm>

From tim at rabbitmq.com  Tue Aug 28 17:00:03 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 Aug 2012 17:00:03 +0100
Subject: [rabbitmq-discuss] Shovel restart command hanging
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD790388A7DDBBA@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DDA1D@vmexchange02.seegrid.local>
	<503C9606.2010801@rabbitmq.com>, <503C97A8.4030805@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD790388A7DDBBA@vmexchange02.seegrid.local>
Message-ID: <64C720DC-2FEC-4939-9DED-1E52C1E6AD5C@rabbitmq.com>


On 28 Aug 2012, at 16:04, Elizabeth Liao wrote:

> This is the shovel issue that I was referring to: http://rabbitmq.1065348.n5.nabble.com/Shovel-stuck-tp21398p21482.html. 
> 

Ah ok sorry about the misunderstanding. Unfortunately the only workaround for that at the moment is the one Francesco suggests at the end of the thread.

From jaklug at hotmail.com  Tue Aug 28 17:18:04 2012
From: jaklug at hotmail.com (Joe Klug)
Date: Tue, 28 Aug 2012 09:18:04 -0700
Subject: [rabbitmq-discuss] RabbitMQ Fails to start - Erlang machine stopped
	instantly (distribution name conflict?)
Message-ID: <SNT107-DS105C7A5D9E305D92E3A0CFD1A10@phx.gbl>

I had originally installed RabbitMQ 2.8.4 with Erlang Win64 R15B01 on my
Windows 7 laptop.  Everything worked just fine.  I later uninstalled both
RabbitMQ and Erlang, and then installed 2.8.6 with Erlang Win32 R15B01 and
get these 2 errors every time I start the server:

 

Error 1:

RabbitMQ: Erlang machine stopped instantly (distribution name conflict?).
The service is not restarted as OnFail is set to ignore.

 

Error 2:

The RabbitMQ service terminated with the following error: 

The process terminated unexpectedly.

 

I've tried everything I can find on this discussion list and anywhere else
Google can reach.  I've uninstalled, reinstalled, retried the Win64 verions
of Erlang, tried cleaning out the registry, set environment variables, all
to no avail.

 

Any suggestions?

 

Thank you,

 

Joe

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/0d4e1a1e/attachment.htm>

From matthias.reik at gmail.com  Tue Aug 28 17:20:11 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Tue, 28 Aug 2012 18:20:11 +0200
Subject: [rabbitmq-discuss] rabbitmq.config location and link
In-Reply-To: <1346167683.171621106@apps.rackspace.com>
References: <1346163808.890220678@apps.rackspace.com>
	<1346167683.171621106@apps.rackspace.com>
Message-ID: <CAJ1JW0ccJCVwfN6w2w+NUcJ0V8HBpd1SDQkCh+8wGPMV4x0Kkw@mail.gmail.com>

The error message says it all :-)

You should (without looking any further through your config) add a dot at
the end of your config, we have for example something like this:
[ {rabbit, [{vm_memory_high_watermark, 0.5}] } ].

Note the dot at the end. This is a Erlang weirdness (actually end of
instruction, like the ';' in other programming languages)

Hope that helps

Cheers
Matthias



On Tue, Aug 28, 2012 at 5:28 PM, <m.luchak at smartasking.com> wrote:

> nevermind... got it to load on start... but I have an error in the file
>
> "(error in config file "/etc/rabbitmq/rabbitmq.config" (none): no ending
> <dot> found)"
>
>
>
> here's my .config... can someone tell me what I've missed?  A dot at the
> end ;)?  Do I need a complet .config or is it ok to just define the tcp
> settings..?
>
>
>
> [{tcp_listen_options, [binary,
>
> {packet, raw},
>
> {reuseaddr, true},
>
> {backlog, 128},
>
> {nodelay, true},
>
> {exit_on_close, false},
>
> {keepalive, true}]},
>
> {tcp_listeners,[5672]},
>
> {trace_vhosts,[<<"/">>]},
>
> {vm_memory_high_watermark,0.4}]
>
>
>
> -----Original Message-----
> From: m.luchak at smartasking.com
> Sent: Tuesday, August 28, 2012 10:23am
> To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: [rabbitmq-discuss] rabbitmq.config location and link
>
>  Hi All,
>
>
>
> I have created a rabbitmq.config file in "\etc\rabbitmq\"  (ubuntu
> RabbitMQ 2.8.5) but I can't seem to point my instance to pick it up.. I
> have  configured tcp keepalive true in the .config file but when I restart
> and run report the configs were not picked up..
>
>
>
> How can I get Rabbitmq to pick up the .config file?
>
>
>
> thansk,
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/e4dcbb8c/attachment.htm>

From m.luchak at smartasking.com  Tue Aug 28 17:42:15 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Tue, 28 Aug 2012 12:42:15 -0400 (EDT)
Subject: [rabbitmq-discuss] rabbitmq.config location and link
In-Reply-To: <CAJ1JW0ccJCVwfN6w2w+NUcJ0V8HBpd1SDQkCh+8wGPMV4x0Kkw@mail.gmail.com>
References: <1346163808.890220678@apps.rackspace.com> 
	<1346167683.171621106@apps.rackspace.com> 
	<CAJ1JW0ccJCVwfN6w2w+NUcJ0V8HBpd1SDQkCh+8wGPMV4x0Kkw@mail.gmail.com>
Message-ID: <1346172135.135913230@apps.rackspace.com>


eessh... too easy!! hehe...
 
Actually there were a number of errors and the dot was missing because the config was failing before it got to the end...
 
here is my "working copy"... setting "Binary" attribute in TCP was one of the problems..
 

[
 {mnesia, [{dump_log_write_threshold, 1000}]},
 {tcp_listen_options, [{packet, raw},
 {reuseaddr, true},
 {backlog, 128},
 {nodelay, true},
 {exit_on_close, false},
 {keepalive, true}]}
 ].
 


 
-----Original Message-----
From: "Matthias Reik" <matthias.reik at gmail.com>
Sent: Tuesday, August 28, 2012 12:20pm
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] rabbitmq.config location and link



The error message says it all :-)

You should (without looking any further through your config) add a dot at the end of your config, we have for example something like this:
[ {rabbit, [{vm_memory_high_watermark, 0.5}] } ].

Note the dot at the end. This is a Erlang weirdness (actually end of instruction, like the ';' in other programming languages)

Hope that helps

Cheers
Matthias




On Tue, Aug 28, 2012 at 5:28 PM,  <[mailto:m.luchak at smartasking.com] m.luchak at smartasking.com> wrote:

nevermind... got it to load on start... but I have an error in the file
"(error in config file "/etc/rabbitmq/rabbitmq.config" (none): no ending <dot> found)"
 
here's my .config... can someone tell me what I've missed?  A dot at the end ;)?  Do I need a complet .config or is it ok to just define the tcp settings..?
 
 
[{tcp_listen_options, [binary,
 {packet, raw},
 {reuseaddr, true},
 {backlog, 128},
 {nodelay, true},
 {exit_on_close, false},
 {keepalive, true}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[<<"/">>]},
 {vm_memory_high_watermark,0.4}]


 
-----Original Message-----
From: [mailto:m.luchak at smartasking.com] m.luchak at smartasking.com
Sent: Tuesday, August 28, 2012 10:23am
 To: "Discussions about RabbitMQ" <[mailto:rabbitmq-discuss at lists.rabbitmq.com] rabbitmq-discuss at lists.rabbitmq.com>
Subject: [rabbitmq-discuss] rabbitmq.config location and link



Hi All,
 
I have created a rabbitmq.config file in "\etc\rabbitmq\"  (ubuntu RabbitMQ 2.8.5) but I can't seem to point my instance to pick it up.. I have  configured tcp keepalive true in the .config file but when I restart and run report the configs were not picked up..
 
How can I get Rabbitmq to pick up the .config file?
 
thansk,
Matthew
_______________________________________________
 rabbitmq-discuss mailing list
[mailto:rabbitmq-discuss at lists.rabbitmq.com] rabbitmq-discuss at lists.rabbitmq.com
[https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss] https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9fbd2288/attachment.htm>

From tim at rabbitmq.com  Tue Aug 28 17:58:04 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 Aug 2012 17:58:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ Fails to start - Erlang machine
	stopped instantly (distribution name conflict?)
In-Reply-To: <SNT107-DS105C7A5D9E305D92E3A0CFD1A10@phx.gbl>
References: <SNT107-DS105C7A5D9E305D92E3A0CFD1A10@phx.gbl>
Message-ID: <73BA2DB3-834F-4B4F-9E30-51200502A9BD@rabbitmq.com>

Joe,

On 28 Aug 2012, at 17:18, Joe Klug wrote:

> I had originally installed RabbitMQ 2.8.4 with Erlang Win64 R15B01 on my Windows 7 laptop.  Everything worked just fine.  I later uninstalled both RabbitMQ and Erlang, and then installed 2.8.6 with Erlang Win32 R15B01 and get these 2 errors every time I start the server:
>  
> Error 1:
> RabbitMQ: Erlang machine stopped instantly (distribution name conflict?). The service is not restarted as OnFail is set to ignore.
>  
> Error 2:
> The RabbitMQ service terminated with the following error:
> The process terminated unexpectedly.
>  
> I?ve tried everything I can find on this discussion list and anywhere else Google can reach.  I?ve uninstalled, reinstalled, retried the Win64 verions of Erlang, tried cleaning out the registry, set environment variables, all to no avail.
>  
> Any suggestions?

Can you run 'erl -sname rabbit' in the console (cmd) for starters?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/5e563ff9/attachment.htm>

From tim at rabbitmq.com  Tue Aug 28 18:01:51 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 Aug 2012 18:01:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ Fails to start - Erlang machine
	stopped instantly (distribution name conflict?)
In-Reply-To: <73BA2DB3-834F-4B4F-9E30-51200502A9BD@rabbitmq.com>
References: <SNT107-DS105C7A5D9E305D92E3A0CFD1A10@phx.gbl>
	<73BA2DB3-834F-4B4F-9E30-51200502A9BD@rabbitmq.com>
Message-ID: <91FAC084-45B9-4953-93F5-C8E0D2AAE399@rabbitmq.com>


On 28 Aug 2012, at 17:58, Tim Watson wrote:

> Joe,
> 
> On 28 Aug 2012, at 17:18, Joe Klug wrote:
> 
>> I had originally installed RabbitMQ 2.8.4 with Erlang Win64 R15B01 on my Windows 7 laptop.  Everything worked just fine.  I later uninstalled both RabbitMQ and Erlang, and then installed 2.8.6 with Erlang Win32 R15B01 and get these 2 errors every time I start the server:
>>  
>> Error 1:
>> RabbitMQ: Erlang machine stopped instantly (distribution name conflict?). The service is not restarted as OnFail is set to ignore.
>>  
>> Error 2:
>> The RabbitMQ service terminated with the following error:
>> The process terminated unexpectedly.
>>  
>> I?ve tried everything I can find on this discussion list and anywhere else Google can reach.  I?ve uninstalled, reinstalled, retried the Win64 verions of Erlang, tried cleaning out the registry, set environment variables, all to no avail.
>>  
>> Any suggestions?
> 
> Can you run 'erl -sname rabbit' in the console (cmd) for starters?

Obviously you'll need the right (bin) directory on your PATH environment variable for this to work! 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/1c21c6c5/attachment.htm>

From eliao at seegrid.com  Tue Aug 28 18:06:01 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Tue, 28 Aug 2012 17:06:01 +0000
Subject: [rabbitmq-discuss] Shovel restart command hanging
In-Reply-To: <64C720DC-2FEC-4939-9DED-1E52C1E6AD5C@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DDA1D@vmexchange02.seegrid.local>
	<503C9606.2010801@rabbitmq.com>, <503C97A8.4030805@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD790388A7DDBBA@vmexchange02.seegrid.local>,
	<64C720DC-2FEC-4939-9DED-1E52C1E6AD5C@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038912F421C@vmexchange02.seegrid.local>

So is there a way to tell if problem that we're seeing is related to the shovel-remains-in-terminated-state bug (fixed in 2.8.6)?  We can't run rabbitmqctl commands after the problem occurs since all rabbit related commands hang or they're taking a really, really long time (on the order of minutes).  The only information that I have available is from the rabbit logs which were attached to the original email.  Would the fixes in 2.8.6 address the issue?

Thanks a lot!

Liz
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Tim Watson [tim at rabbitmq.com]
Sent: Tuesday, August 28, 2012 11:59 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Shovel restart command hanging

On 28 Aug 2012, at 16:04, Elizabeth Liao wrote:

> This is the shovel issue that I was referring to: http://rabbitmq.1065348.n5.nabble.com/Shovel-stuck-tp21398p21482.html.
>

Ah ok sorry about the misunderstanding. Unfortunately the only workaround for that at the moment is the one Francesco suggests at the end of the thread.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tim at rabbitmq.com  Tue Aug 28 18:50:21 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 Aug 2012 18:50:21 +0100
Subject: [rabbitmq-discuss] Shovel restart command hanging
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038912F421C@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790388A7DDA1D@vmexchange02.seegrid.local>
	<503C9606.2010801@rabbitmq.com>, <503C97A8.4030805@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD790388A7DDBBA@vmexchange02.seegrid.local>,
	<64C720DC-2FEC-4939-9DED-1E52C1E6AD5C@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038912F421C@vmexchange02.seegrid.local>
Message-ID: <73BBB77F-9623-4D87-8D2D-881E76773F24@rabbitmq.com>


On 28 Aug 2012, at 18:06, Elizabeth Liao wrote:

> So is there a way to tell if problem that we're seeing is related to the shovel-remains-in-terminated-state bug (fixed in 2.8.6)?  We can't run rabbitmqctl commands after the problem occurs since all rabbit related commands hang or they're taking a really, really long time (on the order of minutes).  The only information that I have available is from the rabbit logs which were attached to the original email.  Would the fixes in 2.8.6 address the issue?
> 

It does sound like a similar issue, so upgrading might help. Sorry I didn't pick up on that immediately - I was away when 2.8.6 was released and didn't take proper note of the dates.


From mpietrek at skytap.com  Tue Aug 28 19:12:19 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 28 Aug 2012 11:12:19 -0700
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
In-Reply-To: <CACLE7iwsVvy2k5xJj4hgeBkDx3aoupdohRqOfJpUQcgdR6NjTA@mail.gmail.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<50359EE6.6070000@rabbitmq.com>
	<CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>
	<5037BF3D.3050809@rabbitmq.com>
	<CACLE7iwsVvy2k5xJj4hgeBkDx3aoupdohRqOfJpUQcgdR6NjTA@mail.gmail.com>
Message-ID: <CACLE7izix=Py-Fx+5pk4Gxw80XfnPaKTeZ1S36FhKO_KaFtxdg@mail.gmail.com>

Just pinging this thread as it seems to have gone dead, and it feels like a
serious issue with clustering/HA in 2.8.6.

When we last left off, Matthias had asked for the logs for the two other
brokers when the queue disappeared. My last message contained the contents
of those logs.

Thanks,

Matt

On Fri, Aug 24, 2012 at 11:22 AM, Matt Pietrek <mpietrek at skytap.com> wrote:

> > The logs for play and util from around the same time might offer us some
> more clues.
>
>
> What I sent was rabbit at play.log.
>
> rabbit at play2.log doesn't look nearly as interesting:
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Limiting to approx 924 file handles (829 sockets)
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Memory limit set to 399MB of 999MB total.
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Disk free limit set to 100MB
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Management plugin upgraded statistics to fine.
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =WARNING REPORT==== 24-Aug-2012::10:29:12 ===
> msg_store_persistent: recovery terms differ from present
> rebuilding indices from scratch
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'unit_test' in vhost '/' on node rabbit at play2:
> <0.261.0>
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'test' in vhost '/' on node rabbit at play2: <0.263.0>
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'XXXX' in vhost '/' on node rabbit at play2: <0.266.0>
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'XYZZY' in vhost '/' on node rabbit at play2:
> <0.268.0>
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'system_test' in vhost '/' on node rabbit at play2:
> <0.271.0>
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> started TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> rabbit on node rabbit at play up
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> rabbit on node rabbit at util up
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Management agent started.
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Management plugin started. Port: 55672, path: /
>
> And here is rabbit at util.log
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'charon' in vhost '/'): Slave <rabbit at util.3.262.0>
> saw deaths of mirrors <rabbit at play2.2.271.0>
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave
> <rabbit at util.3.262.0> to master
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'system_test' in vhost '/'): Slave
> <rabbit at util.3.264.0> saw deaths of mirrors <rabbit at play2.2.273.0>
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'system_test' in vhost '/'): Promoting slave
> <rabbit at util.3.264.0> to master
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> rabbit on node rabbit at play2 down
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave <rabbit at util.3.258.0>
> saw deaths of mirrors <rabbit at play2.2.267.0>
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave
> <rabbit at util.3.258.0> to master
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave
> <rabbit at util.3.260.0> saw deaths of mirrors <rabbit at play2.2.269.0>
>
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting
> slave <rabbit at util.3.260.0> to master
>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Mirrored-queue (queue 'unit_test' in vhost '/'): Master
> <rabbit at util.3.2457.0> saw deaths of mirrors <rabbit at play2.3.261.0>
>
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> rabbit on node rabbit at play2 up
>
>
>
> On Fri, Aug 24, 2012 at 10:51 AM, Matthias Radestock <
> matthias at rabbitmq.com> wrote:
>
>> Matt,
>>
>>
>> On 24/08/12 18:34, Matt Pietrek wrote:
>>
>>> I was able to reproduce this in exactly the same way with 2.8.6 and
>>> Erlang R15B01.
>>>
>>
>> Thanks.
>>
>>
>>  Here's the log from rabbit at play.log. When play2 goes down and comes back
>>> up, the 'unit_test' queue (the only queue with messages) disappears.
>>>
>>
>> Just to confirm, the queues are mirrored across *three* nodes - play,
>> play2 and util, right?
>>
>> The logs for play and util from around the same time might offer us some
>> more clues.
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9febb102/attachment.htm>

From tim at rabbitmq.com  Tue Aug 28 19:24:23 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 Aug 2012 19:24:23 +0100
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
In-Reply-To: <CACLE7izix=Py-Fx+5pk4Gxw80XfnPaKTeZ1S36FhKO_KaFtxdg@mail.gmail.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<50359EE6.6070000@rabbitmq.com>
	<CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>
	<5037BF3D.3050809@rabbitmq.com>
	<CACLE7iwsVvy2k5xJj4hgeBkDx3aoupdohRqOfJpUQcgdR6NjTA@mail.gmail.com>
	<CACLE7izix=Py-Fx+5pk4Gxw80XfnPaKTeZ1S36FhKO_KaFtxdg@mail.gmail.com>
Message-ID: <C225230A-B642-46A3-89B6-2E7404DF9A30@rabbitmq.com>

Hi Matt,

Matthias has identified the cause of this and a bug has been raised to fix it. I presume this will go into a bugfix release asap, but don't take that as gospel as that decision hasn't been made yet. We certainly haven't forgot about this, that's for sure! :)

Cheers,
Tim

On 28 Aug 2012, at 19:12, Matt Pietrek wrote:

> Just pinging this thread as it seems to have gone dead, and it feels like a serious issue with clustering/HA in 2.8.6.
> 
> When we last left off, Matthias had asked for the logs for the two other brokers when the queue disappeared. My last message contained the contents of those logs.
> 
> Thanks,
> 
> Matt
> 
> On Fri, Aug 24, 2012 at 11:22 AM, Matt Pietrek <mpietrek at skytap.com> wrote:
> > The logs for play and util from around the same time might offer us some more clues.
> 
> 
> What I sent was rabbit at play.log.
> 
> rabbit at play2.log doesn't look nearly as interesting:
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Limiting to approx 924 file handles (829 sockets)
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Memory limit set to 399MB of 999MB total.
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Disk free limit set to 100MB
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Management plugin upgraded statistics to fine.
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
> 
> =WARNING REPORT==== 24-Aug-2012::10:29:12 ===
> msg_store_persistent: recovery terms differ from present
> rebuilding indices from scratch
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'unit_test' in vhost '/' on node rabbit at play2: <0.261.0>
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'test' in vhost '/' on node rabbit at play2: <0.263.0>
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'XXXX' in vhost '/' on node rabbit at play2: <0.266.0>
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'XYZZY' in vhost '/' on node rabbit at play2: <0.268.0>
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Adding mirror of queue 'system_test' in vhost '/' on node rabbit at play2: <0.271.0>
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> started TCP Listener on 0.0.0.0:5672
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> rabbit on node rabbit at play up
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> rabbit on node rabbit at util up
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Management agent started.
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Management plugin started. Port: 55672, path: /
> 
> And here is rabbit at util.log
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'charon' in vhost '/'): Slave <rabbit at util.3.262.0> saw deaths of mirrors <rabbit at play2.2.271.0> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave <rabbit at util.3.262.0> to master
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'system_test' in vhost '/'): Slave <rabbit at util.3.264.0> saw deaths of mirrors <rabbit at play2.2.273.0> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'system_test' in vhost '/'): Promoting slave <rabbit at util.3.264.0> to master
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> rabbit on node rabbit at play2 down
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave <rabbit at util.3.258.0> saw deaths of mirrors <rabbit at play2.2.267.0> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave <rabbit at util.3.258.0> to master
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave <rabbit at util.3.260.0> saw deaths of mirrors <rabbit at play2.2.269.0> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting slave <rabbit at util.3.260.0> to master
> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> Mirrored-queue (queue 'unit_test' in vhost '/'): Master <rabbit at util.3.2457.0> saw deaths of mirrors <rabbit at play2.3.261.0> 
> 
> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
> rabbit on node rabbit at play2 up
> 
> 
> 
> On Fri, Aug 24, 2012 at 10:51 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Matt,
> 
> 
> On 24/08/12 18:34, Matt Pietrek wrote:
> I was able to reproduce this in exactly the same way with 2.8.6 and
> Erlang R15B01.
> 
> Thanks.
> 
> 
> Here's the log from rabbit at play.log. When play2 goes down and comes back
> up, the 'unit_test' queue (the only queue with messages) disappears.
> 
> Just to confirm, the queues are mirrored across *three* nodes - play, play2 and util, right?
> 
> The logs for play and util from around the same time might offer us some more clues.
> 
> Matthias.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9129c3bf/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 28 19:27:28 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Aug 2012 19:27:28 +0100
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
 cluster
In-Reply-To: <C225230A-B642-46A3-89B6-2E7404DF9A30@rabbitmq.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<50359EE6.6070000@rabbitmq.com>
	<CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>
	<5037BF3D.3050809@rabbitmq.com>
	<CACLE7iwsVvy2k5xJj4hgeBkDx3aoupdohRqOfJpUQcgdR6NjTA@mail.gmail.com>
	<CACLE7izix=Py-Fx+5pk4Gxw80XfnPaKTeZ1S36FhKO_KaFtxdg@mail.gmail.com>
	<C225230A-B642-46A3-89B6-2E7404DF9A30@rabbitmq.com>
Message-ID: <503D0D90.7060407@rabbitmq.com>

On 28/08/12 19:24, Tim Watson wrote:
> Matthias has identified the cause of this

No, I haven't. You are thinking of the other HA bug.

> and a bug has been raised to fix it.

That much is true.

Matthias.

From tim at rabbitmq.com  Tue Aug 28 19:38:21 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 28 Aug 2012 19:38:21 +0100
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
In-Reply-To: <503D0D90.7060407@rabbitmq.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<50359EE6.6070000@rabbitmq.com>
	<CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>
	<5037BF3D.3050809@rabbitmq.com>
	<CACLE7iwsVvy2k5xJj4hgeBkDx3aoupdohRqOfJpUQcgdR6NjTA@mail.gmail.com>
	<CACLE7izix=Py-Fx+5pk4Gxw80XfnPaKTeZ1S36FhKO_KaFtxdg@mail.gmail.com>
	<C225230A-B642-46A3-89B6-2E7404DF9A30@rabbitmq.com>
	<503D0D90.7060407@rabbitmq.com>
Message-ID: <FB869E6F-FB10-4897-9786-8C5BF6706192@rabbitmq.com>


On 28 Aug 2012, at 19:27, Matthias Radestock wrote:

> On 28/08/12 19:24, Tim Watson wrote:
>> Matthias has identified the cause of this
> 
> No, I haven't. You are thinking of the other HA bug.
> 

Fair point, although the comments on bugzilla indicate that you've isolated the length mismatch as the crash site, but of course you're right because that's not actually the root cause.

>> and a bug has been raised to fix it.
> 
> That much is true.



From mpietrek at skytap.com  Tue Aug 28 19:59:40 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 28 Aug 2012 11:59:40 -0700
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
In-Reply-To: <C225230A-B642-46A3-89B6-2E7404DF9A30@rabbitmq.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<50359EE6.6070000@rabbitmq.com>
	<CACLE7izAmZJbbjhMk=QKUPvj5XqOtjOOrTk8HzfwFXSSoV5Khw@mail.gmail.com>
	<5037BF3D.3050809@rabbitmq.com>
	<CACLE7iwsVvy2k5xJj4hgeBkDx3aoupdohRqOfJpUQcgdR6NjTA@mail.gmail.com>
	<CACLE7izix=Py-Fx+5pk4Gxw80XfnPaKTeZ1S36FhKO_KaFtxdg@mail.gmail.com>
	<C225230A-B642-46A3-89B6-2E7404DF9A30@rabbitmq.com>
Message-ID: <CACLE7iySwJr_MTrc57xbR_8zEOpLRTx4Z2KGZ0hn_kYXtbbVnQ@mail.gmail.com>

Thanks Tim! I realize that all issues take time to fix, and certainly don't
expect instant turnaround.

In the absence of a reply, I just wanted to make sure the issue was driven
to some sort of resolution ("user error", "bug", "stray photon", etc...).

Matt

On Tue, Aug 28, 2012 at 11:24 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Matt,
>
> Matthias has identified the cause of this and a bug has been raised to fix
> it. I presume this will go into a bugfix release asap, but don't take that
> as gospel as that decision hasn't been made yet. We certainly haven't
> forgot about this, that's for sure! :)
>
> Cheers,
> Tim
>
> On 28 Aug 2012, at 19:12, Matt Pietrek wrote:
>
> Just pinging this thread as it seems to have gone dead, and it feels like
> a serious issue with clustering/HA in 2.8.6.
>
> When we last left off, Matthias had asked for the logs for the two other
> brokers when the queue disappeared. My last message contained the contents
> of those logs.
>
> Thanks,
>
> Matt
>
> On Fri, Aug 24, 2012 at 11:22 AM, Matt Pietrek <mpietrek at skytap.com>wrote:
>
>> > The logs for play and util from around the same time might offer us
>> some more clues.
>>
>>
>> What I sent was rabbit at play.log.
>>
>> rabbit at play2.log doesn't look nearly as interesting:
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Limiting to approx 924 file handles (829 sockets)
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Memory limit set to 399MB of 999MB total.
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Disk free limit set to 100MB
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Management plugin upgraded statistics to fine.
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>>
>> =WARNING REPORT==== 24-Aug-2012::10:29:12 ===
>> msg_store_persistent: recovery terms differ from present
>> rebuilding indices from scratch
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Adding mirror of queue 'unit_test' in vhost '/' on node rabbit at play2:
>> <0.261.0>
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Adding mirror of queue 'test' in vhost '/' on node rabbit at play2:
>> <0.263.0>
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Adding mirror of queue 'XXXX' in vhost '/' on node rabbit at play2:
>> <0.266.0>
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Adding mirror of queue 'XYZZY' in vhost '/' on node rabbit at play2:
>> <0.268.0>
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Adding mirror of queue 'system_test' in vhost '/' on node rabbit at play2:
>> <0.271.0>
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> started TCP Listener on 0.0.0.0:5672
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> rabbit on node rabbit at play up
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> rabbit on node rabbit at util up
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Management agent started.
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> Management plugin started. Port: 55672, path: /
>>
>> And here is rabbit at util.log
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> Mirrored-queue (queue 'charon' in vhost '/'): Slave <rabbit at util.3.262.0>
>> saw deaths of mirrors <rabbit at play2.2.271.0>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave
>> <rabbit at util.3.262.0> to master
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> Mirrored-queue (queue 'system_test' in vhost '/'): Slave
>> <rabbit at util.3.264.0> saw deaths of mirrors <rabbit at play2.2.273.0>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> Mirrored-queue (queue 'system_test' in vhost '/'): Promoting slave
>> <rabbit at util.3.264.0> to master
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> rabbit on node rabbit at play2 down
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave <rabbit at util.3.258.0>
>> saw deaths of mirrors <rabbit at play2.2.267.0>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave
>> <rabbit at util.3.258.0> to master
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave
>> <rabbit at util.3.260.0> saw deaths of mirrors <rabbit at play2.2.269.0>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
>> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting
>> slave <rabbit at util.3.260.0> to master
>>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>>  Mirrored-queue (queue 'unit_test' in vhost '/'): Master
>> <rabbit at util.3.2457.0> saw deaths of mirrors <rabbit at play2.3.261.0>
>>
>> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
>> rabbit on node rabbit at play2 up
>>
>>
>>
>> On Fri, Aug 24, 2012 at 10:51 AM, Matthias Radestock <
>> matthias at rabbitmq.com> wrote:
>>
>>> Matt,
>>>
>>>
>>> On 24/08/12 18:34, Matt Pietrek wrote:
>>>
>>>> I was able to reproduce this in exactly the same way with 2.8.6 and
>>>> Erlang R15B01.
>>>>
>>>
>>> Thanks.
>>>
>>>
>>>  Here's the log from rabbit at play.log. When play2 goes down and comes
>>>> back
>>>> up, the 'unit_test' queue (the only queue with messages) disappears.
>>>>
>>>
>>> Just to confirm, the queues are mirrored across *three* nodes - play,
>>> play2 and util, right?
>>>
>>> The logs for play and util from around the same time might offer us some
>>> more clues.
>>>
>>> Matthias.
>>>
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9354feee/attachment.htm>

From Bin.Chen at kla-tencor.com  Tue Aug 28 21:40:49 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Tue, 28 Aug 2012 13:40:49 -0700
Subject: [rabbitmq-discuss] RabbitMQ crash due to out of memory
Message-ID: <BCC407A444557E41B0D8B0260D68499205566792@CA1EXCLV07.adcorp.kla-tencor.com>

Hello,

 

We recently experienced crashes on 3 RabbitMQ servers.  The  first part
of one dump file is attached.

The Application Error event in Windows event log is also attached.

 

We are using 3 RabbitMQ servers to serve around 240 nodes. Each node has
12 services (clients).

On average, each server serves about 960 clients.

 

The version is RabbitMQ 2.8.4 on Erlang R15B01.

 

We have increased the limit of file descriptors, socket descriptors to
the maximum values.

The high memory watermark was set to 1.6 GB. See the attached picture.

Usually the memory used is just a few hundred MB, saying < 800 MB. We've
never seen it more than 1 GB.

 

Do you have any idea why out of memory happened? Is there any suggestion
to prevent this from happening again.

 

 

We were using version 2.7.1 on Erlang R14B02 before, and we had never
encountered out of memory crash issue.

 

 

Best regards,

--Bin Chen

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9945b059/attachment.htm>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: crash_dump.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9945b059/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: App-error.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9945b059/attachment-0001.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rmq-status.JPG
Type: image/jpeg
Size: 20500 bytes
Desc: rmq-status.JPG
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9945b059/attachment.jpeg>

From matthias at rabbitmq.com  Tue Aug 28 22:00:45 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Aug 2012 22:00:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ crash due to out of memory
In-Reply-To: <BCC407A444557E41B0D8B0260D68499205566792@CA1EXCLV07.adcorp.kla-tencor.com>
References: <BCC407A444557E41B0D8B0260D68499205566792@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <503D317D.7050008@rabbitmq.com>

On 28/08/12 21:40, Chen, Bin wrote:
> The version is RabbitMQ 2.8.4 on Erlang R15B01.

Is that the 32-bit or 64-bit version of Erlang? If the former then 
please switch to the latter.

> The high memory watermark was set to 1.6 GB. See the attached picture.

When you say "set", do you mean you changed it from the default values?

1.6GB at the default threshold of 40% would imply a detected usable 
memory of 4GB, but the crash dump indicates that Erlang failed to 
allocate ~40Mb of memory when it had just 2.6GB already allocated. So either
- the usable system memory was detected incorrectly, or
- the memory HWM was increased from the default, or
- other applications are using the memory, or
- the crash dump significantly underreported the memory usage

Regards,

Matthias.

From matthias.reik at gmail.com  Wed Aug 29 08:28:22 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Wed, 29 Aug 2012 09:28:22 +0200
Subject: [rabbitmq-discuss] Fwd: Excessive memory consumption of one
 server in cluster setup
In-Reply-To: <CAJ1JW0f28DKZqwc6dMaDKowSR_Hy1GG7GVDoP5+dS1qQwDwnJA@mail.gmail.com>
References: <503772C6.8080700@reik.se>
	<CAJ1JW0f0MWwfBaPXKX+srNZ9CSfbxQmvkt78+asN0aV_QdA57g@mail.gmail.com>
	<503B78B6.6050301@rabbitmq.com>
	<CAJ1JW0cApHhq18ZKbsyuFQptWEiCBqk4bX1NZQMvK_Da74Lpnw@mail.gmail.com>
	<CAJ1JW0e+6QLY4eNbY8VXoA4Y+6Wpy+C38xA+UdZRHFkhMFTyKw@mail.gmail.com>
	<503B90C3.1080900@rabbitmq.com>
	<CAJ1JW0f28DKZqwc6dMaDKowSR_Hy1GG7GVDoP5+dS1qQwDwnJA@mail.gmail.com>
Message-ID: <CAJ1JW0d3DKkYjZ8GgxYxjBvCV5WwSUfLeO8mfiQM=CkEjy4EBA@mail.gmail.com>

> Pause all publishing before (re)starting any cluster nodes.
Just want to report back that the "work around" did the trick :-) Of course
the situation is not ideal, but we have a working cluster again

Thx Matthias!

Cheers
Matthias

On Mon, Aug 27, 2012 at 10:44 PM, Matthias Reik <matthias.reik at gmail.com>wrote:

> See comments inline
>
> Thanks
> Matthias
>
> On Mon, Aug 27, 2012 at 5:22 PM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> Matthias,
>>
>>
>> On 27/08/12 16:02, Matthias Reik wrote:
>>
>>> even though the setup looks slightly differently (since we are not
>>> using the shovel plugin), the reason could be the same. We are
>>> explicitly ACKing the messages (i.e. no auto-ack), even though the
>>> consumers are in the same data-centers (so we should have a reliable
>>> network), but if the acks are lost and that causes memory increase in
>>> the server then it could be the same bug.
>>>
>>
>> As noted in my analysis, the bug has nothing do with the shovel, or
>> consuming/acking - simply publishing to HA queues when (re)starting slaves
>> is sufficient to trigger it.
>
> Wasn't sure I understood it 100% correctly (sorry not too experienced with
> RabbitMQ yet). Thx for the confirmation.
>
>
>>
>>
>>  Is there anything I could do to validate this assumption?
>>>
>>
>> I don't think it's worth the hassle. I am quite certain that you are
>> suffering from the same bug.
>
>  OK, if you expect a fix for the issue to appear soon then I could wait
> with with "fixing" the cluster and try out any updated version. If it will
> take more time, then I will probably go for your (below) suggested
> fix/workaround.
>
>
>>
>>  Is there anything I can do in the meantime to get into a state where I
>>> have a working cluster again
>>>
>>
>> Pause all publishing before (re)starting any cluster nodes.
>>
> Yes, that makes sense.
>
> Thank you for your quick response.
>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/80892787/attachment.htm>

From paolocruciani at gmail.com  Wed Aug 29 10:39:06 2012
From: paolocruciani at gmail.com (Paolo)
Date: Wed, 29 Aug 2012 11:39:06 +0200
Subject: [rabbitmq-discuss] AMQP protocol version mismatch
Message-ID: <CAM7srv-VhDFXi=hkWi0KjhBCAshEsFydsw4eHC1FFnKE0s4=jQ@mail.gmail.com>

 I have installed and configured RabbitMQ-server-2.8.6-1 on ubuntu 10.04. My
java web application successfully connects using the library which is
included in RabbitMQ-java-client-bin-2.8.6.
I repeated the same installation and configuration on centos 6.3.
When the java application tries to connect to the server rabbit, takes the
error:
"com.rabbitmq.client.MalformedFrameException: AMQP protocol version mismatch
, we are version 0-9-1, server sent signature 1,1,0,10"

I tried the same configuration  on Ubuntu  and on Centos with RabbitMQ
-server-2.7.1-1 and with the library AMQP-client-2.7.1.jar. The behavior is
the same: it works on ubuntu but I have the same error message on centos

someone can give me some indication about ?
Thank you on advance
best regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/8723755b/attachment.htm>

From david.myllykangas at ericsson.com  Wed Aug 29 10:42:17 2012
From: david.myllykangas at ericsson.com (David Myllykangas)
Date: Wed, 29 Aug 2012 11:42:17 +0200
Subject: [rabbitmq-discuss] Pika 0.9.5 - How to handle Rabbit Stop ?
Message-ID: <9819C11BC6C68B4F820C87D7C7AC7A303C03DD0209@ESESSCMS0365.eemea.ericsson.se>


Hi

We are using Rabbit 2.8.5 and Pika 0.9.5 to process rabbit-queue from python.

If I am doing a 'rabbitctrl stop' to stop Rabbit Server, my python script hangs, and get uninteruptable.

This is the console output I get when I stop the Rabbit Server

Traceback (most recent call last):
  File ".../pycims/queue.py", line 87, in start_consuming
    connection.ioloop.start()
  File ".../pika/adapters/select_connection.py", line 124, in start
    self.poller.start()
  File ".../pika/adapters/select_connection.py", line 374, in start
    self.poll()
  File ".../pika/adapters/select_connection.py", line 388, in poll
    self._handler(events[0][0], events[0][1])
  File ".../pika/adapters/base_connection.py", line 137, in _handle_events
    self._handle_error(error)
  File ".../pika/adapters/base_connection.py", line 106, in _handle_error
    error_code = error[0]  # Python <= 2.5
TypeError: 'NoneType' object is not subscriptable

This is the code; (I am expecting an Exception to be thrown on line 93, so I can handle the situation.) What am I doing wrong?

86        try:
87            connection.ioloop.start()
88        except KeyboardInterrupt:
89            self.stop_consuming()
90            connection.ioloop.stop()
91            connection.close()
92            raise
93        except Exception, e:
94            print 'Exception %s' % str(e)
95            raise

Thanks,
 David

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/ab596231/attachment.htm>

From francesco at rabbitmq.com  Wed Aug 29 11:56:49 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 29 Aug 2012 11:56:49 +0100
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins
	the	cluster
In-Reply-To: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
Message-ID: <871uiqx8y6.wl%francesco@rabbitmq.com>

Hi Matt,

At Wed, 22 Aug 2012 15:06:42 -0700,
Matt Pietrek wrote:
> I then take down the play node and start it back up. Afterwards, I force
> everything to be synchronized by doing a management API 'get messages" with
> requeue=True. When this completes, everything shows up synched as expected.

This should not happen.  Messages are requeued at the original position in the
queue, see <http://www.rabbitmq.com/semantics.html>, and thus that has no effect
to the syncing of slaves.  Republishing would.

I tried to reproduce the problem following exactly what you did, with no
success.  Can you describe, in detail, your setup and the steps you're taking to
reproduce that?  The most convenient thing would be to automate the procedure in
a script.

--
Francesco * Often in error, never in doubt

From gsim at redhat.com  Wed Aug 29 12:36:17 2012
From: gsim at redhat.com (Gordon Sim)
Date: Wed, 29 Aug 2012 12:36:17 +0100
Subject: [rabbitmq-discuss] AMQP protocol version mismatch
In-Reply-To: <CAM7srv-VhDFXi=hkWi0KjhBCAshEsFydsw4eHC1FFnKE0s4=jQ@mail.gmail.com>
References: <CAM7srv-VhDFXi=hkWi0KjhBCAshEsFydsw4eHC1FFnKE0s4=jQ@mail.gmail.com>
Message-ID: <503DFEB1.2070307@redhat.com>

On 08/29/2012 10:39 AM, Paolo wrote:
> I have installed and configured RabbitMQ-server-2.8.6-1 on ubuntu 10.04.
> My java web application successfully connects using the library which is
> included in RabbitMQ-java-client-bin-2.8.6.
> I repeated the same installation and configuration on centos 6.3.
> When the java application tries to connect to the server rabbit, takes
> the error:
> "com.rabbitmq.client.MalformedFrameException: AMQP protocol version
> mismatch, we are version 0-9-1, server sent signature 1,1,0,10"
>
> I tried the same configuration on Ubuntu  and onCentos with
> RabbitMQ-server-2.7.1-1 and with the library AMQP-client-2.7.1.jar. The
> behavior is the same: it works on ubuntu but I have the same error
> message on centos
>
> someone can give me some indication about ?

My guess is that on centos you have a Qpid server running on the 5672 
port, rather than RabbitMQ (they speak different versions of the 
protocol). If you stop the qpidd service and start RabbitMQ you should 
be fine.


From matthias.reik at gmail.com  Wed Aug 29 13:29:31 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Wed, 29 Aug 2012 14:29:31 +0200
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
In-Reply-To: <871uiqx8y6.wl%francesco@rabbitmq.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<871uiqx8y6.wl%francesco@rabbitmq.com>
Message-ID: <CAJ1JW0ffv3GOWZKi90usSHQx+jWW+8MgEq9t9RsmPPaxJmH5gw@mail.gmail.com>

Hi,

I had a potentially related case (sorry didn't read the full thread), so
might be of interest:

I upgraded to a new servers version, and forgot to copy the settings (from
etc/rabbitmq) to
the new version. The result was that even the rabbitmq-env.config was not
found (where we
define a non-standard location for mnesia) and the default location was
selected.

Of course the default location didn't have what we expected to find.
Downgrading solved
that problem (obviously). Therefore we now make sure to copy all files from
rabbitmq_server_abc/etc/rabbitmq to rabbitmq_server_xyz/etc/rabbitmq

Cheers
Matthias


On Wed, Aug 29, 2012 at 12:56 PM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> Hi Matt,
>
> At Wed, 22 Aug 2012 15:06:42 -0700,
> Matt Pietrek wrote:
> > I then take down the play node and start it back up. Afterwards, I force
> > everything to be synchronized by doing a management API 'get messages"
> with
> > requeue=True. When this completes, everything shows up synched as
> expected.
>
> This should not happen.  Messages are requeued at the original position in
> the
> queue, see <http://www.rabbitmq.com/semantics.html>, and thus that has no
> effect
> to the syncing of slaves.  Republishing would.
>
> I tried to reproduce the problem following exactly what you did, with no
> success.  Can you describe, in detail, your setup and the steps you're
> taking to
> reproduce that?  The most convenient thing would be to automate the
> procedure in
> a script.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/ed553e5c/attachment.htm>

From paolocruciani at gmail.com  Wed Aug 29 14:11:37 2012
From: paolocruciani at gmail.com (Paolo)
Date: Wed, 29 Aug 2012 15:11:37 +0200
Subject: [rabbitmq-discuss] AMQP protocol version mismatch
In-Reply-To: <503DFEB1.2070307@redhat.com>
References: <CAM7srv-VhDFXi=hkWi0KjhBCAshEsFydsw4eHC1FFnKE0s4=jQ@mail.gmail.com>
	<503DFEB1.2070307@redhat.com>
Message-ID: <CAM7srv9aaJoiRjupbFa70thEzNLbOf91zyCZkHHKrOmP-Mni7A@mail.gmail.com>

Thanks for your prompt response.
Maybe i explained wrong, the RabbitMQ server works fine: I can also use the
plugin rabbitmq_management and view all active queues.
My problem is different, my application uses a library AMQP-client.jar
to communicate
with the server rabbit (AMQP-client-2.7.1.jar or AMQP-client-2.8.6.jar
depending
on the version of server).
Using this library trying to connect to the server rabbit, i get the error
"*com.rabbitmq.client.MalformedFrameException: AMQP protocol version
mismatch* *, we are version 0-9-1, server sent signature 1,1,0,10**. *"
It seems that the client is incompatible with the server ... which is not
true because they interact properly with Ubuntu
Regards

On Wed, Aug 29, 2012 at 1:36 PM, Gordon Sim <gsim at redhat.com> wrote:

> On 08/29/2012 10:39 AM, Paolo wrote:
>
>> I have installed and configured RabbitMQ-server-2.8.6-1 on ubuntu 10.04.
>> My java web application successfully connects using the library which is
>> included in RabbitMQ-java-client-bin-2.8.**6.
>> I repeated the same installation and configuration on centos 6.3.
>> When the java application tries to connect to the server rabbit, takes
>> the error:
>> "com.rabbitmq.client.**MalformedFrameException: AMQP protocol version
>> mismatch, we are version 0-9-1, server sent signature 1,1,0,10"
>>
>> I tried the same configuration on Ubuntu  and onCentos with
>>
>> RabbitMQ-server-2.7.1-1 and with the library AMQP-client-2.7.1.jar. The
>> behavior is the same: it works on ubuntu but I have the same error
>> message on centos
>>
>> someone can give me some indication about ?
>>
>
> My guess is that on centos you have a Qpid server running on the 5672
> port, rather than RabbitMQ (they speak different versions of the protocol).
> If you stop the qpidd service and start RabbitMQ you should be fine.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/1dedc026/attachment.htm>

From gsim at redhat.com  Wed Aug 29 14:56:25 2012
From: gsim at redhat.com (Gordon Sim)
Date: Wed, 29 Aug 2012 14:56:25 +0100
Subject: [rabbitmq-discuss] AMQP protocol version mismatch
In-Reply-To: <CAM7srv9aaJoiRjupbFa70thEzNLbOf91zyCZkHHKrOmP-Mni7A@mail.gmail.com>
References: <CAM7srv-VhDFXi=hkWi0KjhBCAshEsFydsw4eHC1FFnKE0s4=jQ@mail.gmail.com>
	<503DFEB1.2070307@redhat.com>
	<CAM7srv9aaJoiRjupbFa70thEzNLbOf91zyCZkHHKrOmP-Mni7A@mail.gmail.com>
Message-ID: <503E1F89.7080701@redhat.com>

On 08/29/2012 02:11 PM, Paolo wrote:
> Thanks for your prompt response.
> Maybe i explained wrong,

I suspect it was my answer that was not clear enough...

> the RabbitMQ server works fine: I can also use
> the plugin rabbitmq_management and view all active queues.
> My problem is different, my application uses a library AMQP-client.jar
> to communicate with the server rabbit (AMQP-client-2.7.1.jar or
> AMQP-client-2.8.6.jar depending on the version of server).
> Using this library trying to connect to the serverrabbit, iget the error
> "*com.rabbitmq.client.MalformedFrameException: AMQP protocol version
> mismatch* *, we are version 0-9-1, server sent signature 1,1,0,10**. *"
> It seems that the client is incompatible with the server

Right, and I suspect (I could of course be wrong!) that it is not 
actually RabbitMQ your client is connecting to but a Qpid server (qpidd, 
which supports version 0-10 as identified by the rejected protocol 
header above).

Perhaps RabbitMQ was unable to listen on 5672 because it was already in 
use by Qpid (because the qpidd service is enabled by default on Centos). 
I'm not familiar enough with the management plugin to say for sure, but 
I suspect that is communicating with the RabbitMQ server over HTTP or 
some port other than 5672. You may see some errors in the RabbitMQ logs 
however.

Try running /sbin/service qpidd status, if that shows something running, 
try /sbin/service qpidd stop and then restart RabbitMQ and try your 
client application again.


From paolocruciani at gmail.com  Wed Aug 29 16:21:06 2012
From: paolocruciani at gmail.com (Paolo)
Date: Wed, 29 Aug 2012 17:21:06 +0200
Subject: [rabbitmq-discuss] AMQP protocol version mismatch
In-Reply-To: <503E1F89.7080701@redhat.com>
References: <CAM7srv-VhDFXi=hkWi0KjhBCAshEsFydsw4eHC1FFnKE0s4=jQ@mail.gmail.com>
	<503DFEB1.2070307@redhat.com>
	<CAM7srv9aaJoiRjupbFa70thEzNLbOf91zyCZkHHKrOmP-Mni7A@mail.gmail.com>
	<503E1F89.7080701@redhat.com>
Message-ID: <CAM7srv862RbwGNw-RjCZZp2MYjVxadEYvFog0VJ3NW9hX2KeXQ@mail.gmail.com>

I tried to do what suggested.
Stopping the service
"/sbin/service qpidd stop"
and restarting RabbitMQ my application gets the error "Connection refused"
as shown in the attached file  "TomcatErrorLogWithQpiddOFF.txt"
The server not working as shown in the image file "Server DOWN.jpg"

but starting the service qpidd
"/sbin/service qpidd start"
the error returned is the one shown in the attached file
"TomcatErrorLogWithQpiddON.txt"
The server is working properly and it is listening on port 5672  as shown in
the attached file "Server UP.jpg"

I thought that the problem could be related to the version of the
client and the
server, but is in contradiction with the behavior on ubuntu where it seems
to work properly
Thanks in advanced


On Wed, Aug 29, 2012 at 3:56 PM, Gordon Sim <gsim at redhat.com> wrote:

> On 08/29/2012 02:11 PM, Paolo wrote:
>
>> Thanks for your prompt response.
>> Maybe i explained wrong,
>>
>
> I suspect it was my answer that was not clear enough...
>
>  the RabbitMQ server works fine: I can also use
>> the plugin rabbitmq_management and view all active queues.
>> My problem is different, my application uses a library AMQP-client.jar
>> to communicate with the server rabbit (AMQP-client-2.7.1.jar or
>> AMQP-client-2.8.6.jar depending on the version of server).
>> Using this library trying to connect to the serverrabbit, iget the error
>> "*com.rabbitmq.client.**MalformedFrameException: AMQP protocol version
>> mismatch* *, we are version 0-9-1, server sent signature 1,1,0,10**. *"
>>
>> It seems that the client is incompatible with the server
>>
>
> Right, and I suspect (I could of course be wrong!) that it is not actually
> RabbitMQ your client is connecting to but a Qpid server (qpidd, which
> supports version 0-10 as identified by the rejected protocol header above).
>
> Perhaps RabbitMQ was unable to listen on 5672 because it was already in
> use by Qpid (because the qpidd service is enabled by default on Centos).
> I'm not familiar enough with the management plugin to say for sure, but I
> suspect that is communicating with the RabbitMQ server over HTTP or some
> port other than 5672. You may see some errors in the RabbitMQ logs however.
>
> Try running /sbin/service qpidd status, if that shows something running,
> try /sbin/service qpidd stop and then restart RabbitMQ and try your client
> application again.
>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/1db89908/attachment.htm>
-------------- next part --------------
org.springframework.amqp.AmqpConnectException: java.net.ConnectException: Connection refused
	at org.springframework.amqp.rabbit.connection.RabbitUtils.convertRabbitAccessException(RabbitUtils.java:106)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:118)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:179)
	at it.mcr.watt.service.message.AMQPManager.createQueue(AMQPManager.java:17)
	at it.mcr.watt.entity.administration.User_Entity_Methods.ajc$interMethod$it_mcr_watt_entity_administration_User_Entity_Methods$it_mcr_watt_entity_administration_User$insert(User_Entity_Methods.aj:47)
	at it.mcr.watt.entity.administration.User.insert(User.java:1)
	at it.mcr.watt.entity.administration.User_Entity_Methods.ajc$interMethodDispatch1$it_mcr_watt_entity_administration_User_Entity_Methods$it_mcr_watt_entity_administration_User$insert(User_Entity_Methods.aj)
	at it.mcr.watt.controller.administration.UserController_Controller.ajc$interMethod$it_mcr_watt_controller_administration_UserController_Controller$it_mcr_watt_controller_administration_UserController$create(UserController_Controller.aj:46)
	at it.mcr.watt.controller.administration.UserController.create(UserController.java:1)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:426)
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:414)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:790)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:719)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:644)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:560)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:641)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.springframework.orm.jpa.support.OpenEntityManagerInViewFilter.doFilterInternal(OpenEntityManagerInViewFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:368)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:109)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:83)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:97)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:78)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:54)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:35)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:187)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:105)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:79)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.session.ConcurrentSessionFilter.doFilter(ConcurrentSessionFilter.java:109)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:169)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:237)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:167)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:77)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:225)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)
	at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:927)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)
	at com.springsource.insight.collection.tcserver.request.HttpRequestOperationCollectionValve.traceNextValve(HttpRequestOperationCollectionValve.java:116)
	at com.springsource.insight.collection.tcserver.request.HttpRequestOperationCollectionValve.invoke(HttpRequestOperationCollectionValve.java:98)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)
	at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:999)
	at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:565)
	at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:309)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
	at java.lang.Thread.run(Thread.java:722)
Caused by: java.net.ConnectException: Connection refused
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:391)
	at java.net.Socket.connect(Socket.java:579)
	at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:445)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:504)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:116)
	... 77 more
-------------- next part --------------
org.springframework.amqp.AmqpIOException: java.io.IOException
	at org.springframework.amqp.rabbit.connection.RabbitUtils.convertRabbitAccessException(RabbitUtils.java:109)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:118)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:179)
	at it.mcr.watt.service.message.AMQPManager.createQueue(AMQPManager.java:17)
	at it.mcr.watt.entity.administration.User_Entity_Methods.ajc$interMethod$it_mcr_watt_entity_administration_User_Entity_Methods$it_mcr_watt_entity_administration_User$insert(User_Entity_Methods.aj:47)
	at it.mcr.watt.entity.administration.User.insert(User.java:1)
	at it.mcr.watt.entity.administration.User_Entity_Methods.ajc$interMethodDispatch1$it_mcr_watt_entity_administration_User_Entity_Methods$it_mcr_watt_entity_administration_User$insert(User_Entity_Methods.aj)
	at it.mcr.watt.controller.administration.UserController_Controller.ajc$interMethod$it_mcr_watt_controller_administration_UserController_Controller$it_mcr_watt_controller_administration_UserController$create(UserController_Controller.aj:46)
	at it.mcr.watt.controller.administration.UserController.create(UserController.java:1)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:426)
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:414)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:790)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:719)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:644)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:560)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:641)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.springframework.orm.jpa.support.OpenEntityManagerInViewFilter.doFilterInternal(OpenEntityManagerInViewFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:368)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:109)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:83)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:97)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:78)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:54)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:35)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:187)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:105)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:79)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.session.ConcurrentSessionFilter.doFilter(ConcurrentSessionFilter.java:109)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:380)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:169)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:237)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:167)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:77)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:225)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)
	at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:927)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)
	at com.springsource.insight.collection.tcserver.request.HttpRequestOperationCollectionValve.traceNextValve(HttpRequestOperationCollectionValve.java:116)
	at com.springsource.insight.collection.tcserver.request.HttpRequestOperationCollectionValve.invoke(HttpRequestOperationCollectionValve.java:98)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)
	at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:999)
	at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:565)
	at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:309)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
	at java.lang.Thread.run(Thread.java:722)
Caused by: java.io.IOException
	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:353)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:116)
	... 77 more
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; reason: com.rabbitmq.client.MalformedFrameException: AMQP protocol version mismatch; we are version 0-9-1, server sent signature 1,1,0,10
	at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:306)
	... 80 more
Caused by: com.rabbitmq.client.MalformedFrameException: AMQP protocol version mismatch; we are version 0-9-1, server sent signature 1,1,0,10
	at com.rabbitmq.client.impl.Frame.protocolVersionMismatch(Frame.java:174)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:111)
	at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:131)
	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:508)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Server DOWN.jpg
Type: image/jpeg
Size: 102325 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/1db89908/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Server UP.jpg
Type: image/jpeg
Size: 75751 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/1db89908/attachment-0001.jpg>

From jaklug at hotmail.com  Wed Aug 29 16:51:13 2012
From: jaklug at hotmail.com (Joe Klug)
Date: Wed, 29 Aug 2012 08:51:13 -0700
Subject: [rabbitmq-discuss] RabbitMQ Fails to start - Erlang
	machine	stopped instantly (distribution name conflict?)
In-Reply-To: <91FAC084-45B9-4953-93F5-C8E0D2AAE399@rabbitmq.com>
References: <SNT107-DS105C7A5D9E305D92E3A0CFD1A10@phx.gbl>	<73BA2DB3-834F-4B4F-9E30-51200502A9BD@rabbitmq.com>
	<91FAC084-45B9-4953-93F5-C8E0D2AAE399@rabbitmq.com>
Message-ID: <SNT107-DS22B37439C32DA6AF620A3DD1A00@phx.gbl>

Yes, but then what?

 

From: Tim Watson [mailto:tim at rabbitmq.com] 
Sent: Tuesday, August 28, 2012 10:02 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ Fails to start - Erlang machine
stopped instantly (distribution name conflict?)

 

 

On 28 Aug 2012, at 17:58, Tim Watson wrote:





Joe,

 

On 28 Aug 2012, at 17:18, Joe Klug wrote:





I had originally installed RabbitMQ 2.8.4 with Erlang Win64 R15B01 on my
Windows 7 laptop.  Everything worked just fine.  I later uninstalled both
RabbitMQ and Erlang, and then installed 2.8.6 with Erlang Win32 R15B01 and
get these 2 errors every time I start the server:

 

Error 1:

RabbitMQ: Erlang machine stopped instantly (distribution name conflict?).
The service is not restarted as OnFail is set to ignore.

 

Error 2:

The RabbitMQ service terminated with the following error:

The process terminated unexpectedly.

 

I've tried everything I can find on this discussion list and anywhere else
Google can reach.  I've uninstalled, reinstalled, retried the Win64 verions
of Erlang, tried cleaning out the registry, set environment variables, all
to no avail.

 

Any suggestions?

 

Can you run 'erl -sname rabbit' in the console (cmd) for starters?

 

Obviously you'll need the right (bin) directory on your PATH environment
variable for this to work! 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/2211b33d/attachment.htm>

From mpietrek at skytap.com  Wed Aug 29 18:08:04 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 29 Aug 2012 10:08:04 -0700
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins the
	cluster
In-Reply-To: <871uiqx8y6.wl%francesco@rabbitmq.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<871uiqx8y6.wl%francesco@rabbitmq.com>
Message-ID: <CACLE7izRCjP+Lcch6o7vwa78mrMvDr+dRqb-c8jiM4X0UWMAVQ@mail.gmail.com>

Hi Francesco,

Argh... I was so happy that this bug appeared to have been reproduced.

I would happily give you a script to repro, except that the logic is
intertwined with our own infrastructure. So instead, here's a brain dump of
everything I can fathom would be relevant.

Each node (rabbit at play, rabbit at play2, rabbit at util) is run on it's own
separate Ubuntu 10.04 64-bit VM. The management and tracing plugin are
enabled on all nodes. All nodes are disc nodes.

Clustering is performed by a config file that's the same on all nodes:

----
[
    {rabbit, [{cluster_nodes, [rabbit at play,rabbit at play2,rabbit at util] },
              {disk_free_limit, 104857600}
             ]
    },
    {mnesia, [{debug, trace}
             ]
    }
].
----

All queues are created as HA and durable.

Starting from a fully operational cluster with all nodes running and a set
of ~6 empty queues.

   - Pick a queue to work with (say, "foo")
   - Using the management UI, select the queue tab and publish 4 messages
   to "foo", delivery-mode = persistent, but  message content doesn't matter.
   I use "abc" for the content.
   - Using rabbitmqctl, bring the first node (play) down. In the management
   UI, note that the queues are now backed by only two nodes (play2, util)
   - Using rabbitmqctl, bring the first node (play) back up. In the
   management UI, note that the "foo" queue is synched on (play2, util), but
   not on play. (UI shows "+1 +1")
   - Using the management UI, retrieve all the messages from the queue in
   question, but with the requeue flag enabled. After this, the queue appears
   synced on all nodes ("+2).
   - Using rabbitmqctl, bring down the 2nd node (play2). If you wait long
   enough, you should see that the "foo" queue has vanished. However, all
   other queues remain. You should also have logs similar to what I included
   previously.
   - On the off chance that "foo" doesn't disappear within 10-15 seconds,
   use rabbitmqctl to start the second node up again. See if "foo" has
   vanished.


Regarding the resync logic I have (HTTP api to retrieve all messages, with
requeue), I'm not wedded to that. I'm just looking for some way to quickly
resynch all contents, preferably without myself reading and re-publishing
all messages. If there's some way to let the broker do most (all?) of the
work, I'm all ears. My observation was that the "retrieve with requeue"
seemed to work as intended, but you're obviously the expert on this, so I'm
all ears.


On Wed, Aug 29, 2012 at 3:56 AM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> Hi Matt,
>
> At Wed, 22 Aug 2012 15:06:42 -0700,
> Matt Pietrek wrote:
> > I then take down the play node and start it back up. Afterwards, I force
> > everything to be synchronized by doing a management API 'get messages"
> with
> > requeue=True. When this completes, everything shows up synched as
> expected.
>
> This should not happen.  Messages are requeued at the original position in
> the
> queue, see <http://www.rabbitmq.com/semantics.html>, and thus that has no
> effect
> to the syncing of slaves.  Republishing would.
>
> I tried to reproduce the problem following exactly what you did, with no
> success.  Can you describe, in detail, your setup and the steps you're
> taking to
> reproduce that?  The most convenient thing would be to automate the
> procedure in
> a script.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/bd5df0f8/attachment.htm>

From Bin.Chen at kla-tencor.com  Wed Aug 29 18:24:32 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Wed, 29 Aug 2012 10:24:32 -0700
Subject: [rabbitmq-discuss] RabbitMQ crash due to out of memory
In-Reply-To: <503D317D.7050008@rabbitmq.com>
References: <BCC407A444557E41B0D8B0260D68499205566792@CA1EXCLV07.adcorp.kla-tencor.com>
	<503D317D.7050008@rabbitmq.com>
Message-ID: <BCC407A444557E41B0D8B0260D68499205566958@CA1EXCLV07.adcorp.kla-tencor.com>

Hi Matthias,

My system is Windows 2008 Server 64-bit which has 24 GB RAM installed.
Erlang is a 32-bit version.

We had out-of-memory crash before with default HWM (40% - 800 MB).

Since Erlang VM has /LARGEADDRESSAWARE flag set, which implies it can
use up to 4 GB on a 64-bit Windows, we increased HWM to 1.6 GB.
As I pointed out in my previous email, RMQ detects 2GB as the maximum
usable memory in my case, we have to use 80% to set HWM to 1.6 GB.

The memory usage in crash dump may not be trustable. 
I had seen an out-of-memory crash dump before, indicating that Erlang
failed to allocate 1.4 GB of memory.


Best regards,
--Bin Chen


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Tuesday, August 28, 2012 2:01 PM
To: Discussions about RabbitMQ
Cc: Chen, Bin
Subject: Re: [rabbitmq-discuss] RabbitMQ crash due to out of memory

On 28/08/12 21:40, Chen, Bin wrote:
> The version is RabbitMQ 2.8.4 on Erlang R15B01.

Is that the 32-bit or 64-bit version of Erlang? If the former then
please switch to the latter.

> The high memory watermark was set to 1.6 GB. See the attached picture.

When you say "set", do you mean you changed it from the default values?

1.6GB at the default threshold of 40% would imply a detected usable
memory of 4GB, but the crash dump indicates that Erlang failed to
allocate ~40Mb of memory when it had just 2.6GB already allocated. So
either
- the usable system memory was detected incorrectly, or
- the memory HWM was increased from the default, or
- other applications are using the memory, or
- the crash dump significantly underreported the memory usage

Regards,

Matthias.

From francesco at rabbitmq.com  Wed Aug 29 18:27:26 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 29 Aug 2012 18:27:26 +0100
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins
	the	cluster
In-Reply-To: <CACLE7izRCjP+Lcch6o7vwa78mrMvDr+dRqb-c8jiM4X0UWMAVQ@mail.gmail.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<871uiqx8y6.wl%francesco@rabbitmq.com>
	<CACLE7izRCjP+Lcch6o7vwa78mrMvDr+dRqb-c8jiM4X0UWMAVQ@mail.gmail.com>
Message-ID: <87wr0hwqv5.wl%francesco@rabbitmq.com>

Hi Matt,

It turns out that I was testing it wrong - I can reproduce the problem, and we
tracked down the cause. Thanks a lot for reporting this, even if fixing it
won't be fun...

> Regarding the resync logic I have (HTTP api to retrieve all messages, with
> requeue), I'm not wedded to that. I'm just looking for some way to quickly
> resynch all contents, preferably without myself reading and re-publishing all
> messages. If there's some way to let the broker do most (all?) of the work,
> I'm all ears. My observation was that the "retrieve with requeue" seemed to
> work as intended, but you're obviously the expert on this, so I'm all ears.

The one and only way to resync an HA queues is by republishing.  Rabbit queues
are non-browsable, and for this reason the only way to insert messages is at the
back - so requeuing won't work, since requeue messages are left were they are.

--
Francesco * Often in error, never in doubt

From gsim at redhat.com  Wed Aug 29 18:35:05 2012
From: gsim at redhat.com (Gordon Sim)
Date: Wed, 29 Aug 2012 18:35:05 +0100
Subject: [rabbitmq-discuss] AMQP protocol version mismatch
In-Reply-To: <CAM7srv862RbwGNw-RjCZZp2MYjVxadEYvFog0VJ3NW9hX2KeXQ@mail.gmail.com>
References: <CAM7srv-VhDFXi=hkWi0KjhBCAshEsFydsw4eHC1FFnKE0s4=jQ@mail.gmail.com>
	<503DFEB1.2070307@redhat.com>
	<CAM7srv9aaJoiRjupbFa70thEzNLbOf91zyCZkHHKrOmP-Mni7A@mail.gmail.com>
	<503E1F89.7080701@redhat.com>
	<CAM7srv862RbwGNw-RjCZZp2MYjVxadEYvFog0VJ3NW9hX2KeXQ@mail.gmail.com>
Message-ID: <503E52C9.5060402@redhat.com>

On 08/29/2012 04:21 PM, Paolo wrote:
> I tried to do what suggested.
> Stopping the service
> "/sbin/service qpidd stop"
> and restarting RabbitMQ my application gets the error "Connection
> refused" as shown in the attached file "TomcatErrorLogWithQpiddOFF.txt"
> The server notworking as shown in the image file "Server DOWN.jpg"
>
> but starting the service qpidd
> "/sbin/service qpidd start"
> the error returned is the one shown in the attached file
> "TomcatErrorLogWithQpiddON.txt"
> The server is working properly and it is listening on port 5672as shown
> in the attached file "Server UP.jpg"
>
> I thought that the problem could be related to the version of the client
> and the server, but is in contradiction with the behavior on ubuntu
> where it seems to work properly

I think this confirms that it is qpidd running on 5672. When started you 
get a protocol version error; when stopped there is nothing listening.

While qpidd is listening on 5672, RabbitMQ will be unable to do so. 
However when you stop qpidd and restart RabbitMQ, it *should* then start 
listening. If it dod not do so, as you indicate above, there may be some 
other configuration error. What do the logs say for RabbitMQ after the 
restart? Any errors or warnings?

From watson.timothy at gmail.com  Wed Aug 29 18:33:13 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 29 Aug 2012 18:33:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ Fails to start - Erlang
	machine	stopped instantly (distribution name conflict?)
In-Reply-To: <SNT107-DS22B37439C32DA6AF620A3DD1A00@phx.gbl>
References: <SNT107-DS105C7A5D9E305D92E3A0CFD1A10@phx.gbl>
	<73BA2DB3-834F-4B4F-9E30-51200502A9BD@rabbitmq.com>
	<91FAC084-45B9-4953-93F5-C8E0D2AAE399@rabbitmq.com>
	<SNT107-DS22B37439C32DA6AF620A3DD1A00@phx.gbl>
Message-ID: <EFBFDEA1-DE02-4E7D-BCF7-9ABA706FD099@rabbitmq.com>

Now run 'epmd -names' - if there is some node in there then that'll be the issue.

On 29 Aug 2012, at 16:51, Joe Klug <jaklug at hotmail.com> wrote:

> Yes, but then what?
>  
> From: Tim Watson [mailto:tim at rabbitmq.com] 
> Sent: Tuesday, August 28, 2012 10:02 AM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] RabbitMQ Fails to start - Erlang machine stopped instantly (distribution name conflict?)
>  
>  
> On 28 Aug 2012, at 17:58, Tim Watson wrote:
> 
> 
> Joe,
>  
> On 28 Aug 2012, at 17:18, Joe Klug wrote:
> 
> 
> I had originally installed RabbitMQ 2.8.4 with Erlang Win64 R15B01 on my Windows 7 laptop.  Everything worked just fine.  I later uninstalled both RabbitMQ and Erlang, and then installed 2.8.6 with Erlang Win32 R15B01 and get these 2 errors every time I start the server:
>  
> Error 1:
> RabbitMQ: Erlang machine stopped instantly (distribution name conflict?). The service is not restarted as OnFail is set to ignore.
>  
> Error 2:
> The RabbitMQ service terminated with the following error:
> The process terminated unexpectedly.
>  
> I?ve tried everything I can find on this discussion list and anywhere else Google can reach.  I?ve uninstalled, reinstalled, retried the Win64 verions of Erlang, tried cleaning out the registry, set environment variables, all to no avail.
>  
> Any suggestions?
>  
> Can you run 'erl -sname rabbit' in the console (cmd) for starters?
>  
> Obviously you'll need the right (bin) directory on your PATH environment variable for this to work! 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/a1d430dc/attachment.htm>

From matthias at rabbitmq.com  Wed Aug 29 18:50:31 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 Aug 2012 18:50:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ crash due to out of memory
In-Reply-To: <BCC407A444557E41B0D8B0260D68499205566958@CA1EXCLV07.adcorp.kla-tencor.com>
References: <BCC407A444557E41B0D8B0260D68499205566792@CA1EXCLV07.adcorp.kla-tencor.com>
	<503D317D.7050008@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205566958@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <503E5667.5010700@rabbitmq.com>

On 29/08/12 18:24, Chen, Bin wrote:
> My system is Windows 2008 Server 64-bit which has 24 GB RAM installed.
> Erlang is a 32-bit version.

Please switch to the 64-bit version.

> Since Erlang VM has /LARGEADDRESSAWARE flag set, which implies it can
> use up to 4 GB on a 64-bit Windows, we increased HWM to 1.6 GB.

I am not convinced that is true. Please try the following:

- in a command shell run 'erl.exe'
- at the prompt, enter
      binary:copy(<<0>>, 1024*1024*1024*3).
   (including the final '.') and hit return.

That should churn away for a few seconds and eventually print

<<0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,...>>

If it dies instead then Erlang cannot use 4GB.


Regards,

Matthias.

From cameron.davison at gmail.com  Wed Aug 29 22:07:10 2012
From: cameron.davison at gmail.com (Cameron Davison)
Date: Wed, 29 Aug 2012 16:07:10 -0500
Subject: [rabbitmq-discuss] Publisher Confirms stop occurring when
 Consumer is present and queue is large
In-Reply-To: <6a0411f9-e56f-450a-a9e8-3f35a86f7839@StrongMad.local>
References: <20111104153821.GA31860@wellquite.org>
	<6a0411f9-e56f-450a-a9e8-3f35a86f7839@StrongMad.local>
Message-ID: <CAGWz9vXSUTLAZnhgkuWCY3vKPMTg5QpTatrbiKszQYuVw3O-Yw@mail.gmail.com>

It has been a while since I wrote to the group. I was wondering if
this bug ever was fixed in a more recent release?

Thanks,
Cameron

On Fri, Nov 4, 2011 at 12:32 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> Do watch for our upcoming "Cursing and Screaming as a Service" (CaSaaS)
> offering! :-)
>
> Jerry
>
> ----- Original Message -----
> From: "Matthew Sackman" <matthew at rabbitmq.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, November 4, 2011 8:38:22 AM
> Subject: Re: [rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
>
> Hi Cameron,
>
> On Wed, Nov 02, 2011 at 12:10:21AM -0500, Cameron Davison wrote:
>> Thank you for the reply. Do y'all have a bug tracker that I would be
>> able to watch so that I can know when y'all address this issue?
>
> We do have a bug tracker but alas it's not public because we all like to
> curse and scream at each other and generally feel that making it public
> would preclude us from doing that, which would be bad for morale.
>
>> Do you
>> know if this same thing would be even worse for a mirrored queue
>> rabbit mq cluster?
>
> I don't think this bug will affect mirrored queues in a worse way than
> non-mirrored queues...
>
>> I am seeing a lot of degradation in write
>> throughput while reading when doing mirrored queue cluster. All I
>> really want is high availability such that if one server crashed the
>> slave in the cluster will become the master and allow for continued
>> throughput. Is this the correct way to that?
>
> Yes - you are doing things the right way. Mirrored queues are much
> slower than non-mirrored queues due to the additional work that has to
> be done. You should probably expect to see about a ten-fold decrease in
> performance.
>
> http://old.nabble.com/Mirror-queues-and-poor-write-performance-td32727693.html
> reports that I can get a little over 2kHz on a single mirrored queue
> with one consumer keeping the queue empty.
>
> But the bug that you've identified will certainly affect mirrored queues
> as well as non-mirrored queues.
>
> One thing you could try is on the consumer:
> 1. Try a fairly healthy qos prefetch size N (eg N=100)
> 2. Only ack every N/2 (eg 50) msgs but turn on the "multiple" flag in
> the ack.
>
> The effect of these changes will be to reduce the consumer-related
> messages that the queue has to deal with, and so will hopefully allow
> the queue to process the publishes faster (and issue the confirms).
>
> If you're able to try these changes, I'd be interested in what
> improvements (if any) they achieve for you.
>
> Best wishes,
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Wed Aug 29 22:48:52 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 Aug 2012 22:48:52 +0100
Subject: [rabbitmq-discuss] Publisher Confirms stop occurring when
 Consumer is present and queue is large
In-Reply-To: <CAGWz9vXSUTLAZnhgkuWCY3vKPMTg5QpTatrbiKszQYuVw3O-Yw@mail.gmail.com>
References: <20111104153821.GA31860@wellquite.org>
	<6a0411f9-e56f-450a-a9e8-3f35a86f7839@StrongMad.local>
	<CAGWz9vXSUTLAZnhgkuWCY3vKPMTg5QpTatrbiKszQYuVw3O-Yw@mail.gmail.com>
Message-ID: <503E8E44.2060600@rabbitmq.com>

On 29/08/12 22:07, Cameron Davison wrote:
> I was wondering if this bug ever was fixed in a more recent release?

Yes.

Matthias.

From vitaly.krugl.numenta at gmail.com  Wed Aug 29 22:51:54 2012
From: vitaly.krugl.numenta at gmail.com (vitaly)
Date: Wed, 29 Aug 2012 14:51:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Unexpected Incoming message timeouts when
 using Haigha/GeventTransport inside uwsgi server
In-Reply-To: <862b7bbd-e051-4f48-a07d-311e8c2e1f69@googlegroups.com>
References: <862b7bbd-e051-4f48-a07d-311e8c2e1f69@googlegroups.com>
Message-ID: <fd489448-e406-4e41-a1ef-ea10ab76f394@googlegroups.com>

On Saturday, August 18, 2012 1:40:28 AM UTC-7, vitaly wrote:
>
> I posted the full details on the gevent forum: 
> https://groups.google.com/forum/?fromgroups#!topic/gevent/wK7Zrv0wwLs, 
> but would like to see if anyone here has run into the problem or has 
> recommendations for addressing it.

 
I did more debugging yesterday and finally nailed it down -- it had nothing 
to do with uWSGI; it was an internal error.  Sorry for the trouble and 
thank you for all the help. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/5ad68815/attachment.htm>

From citi007 at 126.com  Thu Aug 30 10:24:37 2012
From: citi007 at 126.com (Allchin)
Date: Thu, 30 Aug 2012 17:24:37 +0800 (CST)
Subject: [rabbitmq-discuss] auto configration cluster fail ...
Message-ID: <16b1a316.fe2c.13976d8b604.Coremail.citi007@126.com>

hi ,
I am  running 1 virtual machines with 1 rabbitMQ server on each.
And follow the auto configration cluster guide ,I found my cluster doesn't work without any error .


----------------------------
here is the clear-up script.
rabbitMQ-cluster-reset.bat
----------------------------
 
cd %rabbit_bin_home%   
call rabbitmqctl cluster_status
call rabbitmqctl stop_app
call rabbitmqctl force_reset
call rabbitmqctl stop


-------------------------------
here is my running script :
rabbitMQ-cluster-start.bat
-------------------------------
echo off
set RABBITMQ_NODENAME=rabbit
set RABBITMQ_CLUSTER_CONFIG_FILE=E:\servers\rabbitMQ\rabbitmq
set RABBITMQ_CONFIG_FILE=%RABBITMQ_CLUSTER_CONFIG_FILE%
set RABBITMQ_CONSOLE_LOG=new
rabbitmq-server -detached
pause


-------------------
the rabbitmq.config file 
-------------------
[{rabbit,[{cluster_nodes,['rabbit at rabbit2','rabbit at rabbit3']}]}].
----------------------------------------------------------------------------
run 
rabbitMQ-cluster-reset.bat
and 
rabbitMQ-cluster-start.bat
on each node.
the result :


rabbt3>C:\Program Files\RabbitMQ Server\rabbitmq_server-2.8.5\sbin>rabbitmqctl cluster_
status
Cluster status of node rabbit at rabbit3 ...
[{nodes,[{disc,[rabbit at rabbit3]}]},{running_nodes,[rabbit at rabbit3]}]
...done.


rabbit2>C:\Program Files\RabbitMQ Server\rabbitmq_server-2.8.5\sbin>rabbitmqctl cluster_
status
Cluster status of node rabbit at rabbit2 ...
[{nodes,[{disc,[rabbit at rabbit2]}]},{running_nodes,[rabbit at rabbit2]}]
...done.


this is not the correct cluster  msg .
then i try to modify  script likes
---
set RABBITMQ_CLUSTER_CONFIG_FILE=E:\servers\rabbitMQ\rabbitmq
<-->
set RABBITMQ_CLUSTER_CONFIG_FILE=E:\servers\rabbitMQ\rabbitmq.config
---
[{rabbit,[{cluster_nodes,['rabbit at rabbit2','rabbit at rabbit3',rabbit at RABBIT2','rabbit at RABBIT3']}]}].
<-->
[{rabbit,[{cluster_nodes,['rabbit at rabbit2','rabbit at rabbit3'']}]}].
---
but it still doesn't work.


i am sure these nodes can ping each other successfully...


what wrong with the cluster configration ? 
please help me and thanks.


allchin.


 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120830/956a633c/attachment.htm>

From paolo.cruciani at gruppomcr.com  Thu Aug 30 11:41:56 2012
From: paolo.cruciani at gruppomcr.com (Paolo MCR)
Date: Thu, 30 Aug 2012 12:41:56 +0200
Subject: [rabbitmq-discuss] AMQP protocol version mismatch
In-Reply-To: <503E52C9.5060402@redhat.com>
References: <CAM7srv-VhDFXi=hkWi0KjhBCAshEsFydsw4eHC1FFnKE0s4=jQ@mail.gmail.com>
	<503DFEB1.2070307@redhat.com>
	<CAM7srv9aaJoiRjupbFa70thEzNLbOf91zyCZkHHKrOmP-Mni7A@mail.gmail.com>
	<503E1F89.7080701@redhat.com>
	<CAM7srv862RbwGNw-RjCZZp2MYjVxadEYvFog0VJ3NW9hX2KeXQ@mail.gmail.com>
	<503E52C9.5060402@redhat.com>
Message-ID: <CAM7srv_iBC=tjZhui5p_6st29R4Ttx-ed-Yo6qQEwAzKqeGSgA@mail.gmail.com>

Dear Gordon
I thank you very much for your help.
I verified that the port 5672 is actually used by the process qpidd.
I changed the listening port of the RabbitMQ server and the application worked
properly.
Thanks again

On Wed, Aug 29, 2012 at 7:35 PM, Gordon Sim <gsim at redhat.com> wrote:

> On 08/29/2012 04:21 PM, Paolo wrote:
>
>> I tried to do what suggested.
>> Stopping the service
>> "/sbin/service qpidd stop"
>> and restarting RabbitMQ my application gets the error "Connection
>> refused" as shown in the attached file "TomcatErrorLogWithQpiddOFF.**txt"
>> The server notworking as shown in the image file "Server DOWN.jpg"
>>
>>
>> but starting the service qpidd
>> "/sbin/service qpidd start"
>> the error returned is the one shown in the attached file
>> "TomcatErrorLogWithQpiddON.**txt"
>> The server is working properly and it is listening on port 5672as shown
>>
>> in the attached file "Server UP.jpg"
>>
>> I thought that the problem could be related to the version of the client
>> and the server, but is in contradiction with the behavior on ubuntu
>> where it seems to work properly
>>
>
> I think this confirms that it is qpidd running on 5672. When started you
> get a protocol version error; when stopped there is nothing listening.
>
> While qpidd is listening on 5672, RabbitMQ will be unable to do so.
> However when you stop qpidd and restart RabbitMQ, it *should* then start
> listening. If it dod not do so, as you indicate above, there may be some
> other configuration error. What do the logs say for RabbitMQ after the
> restart? Any errors or warnings?
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
 ------------------------------
 *Gruppo M**C**R S.r.l.*

*Paolo CRUCIANI***
* *
*Sede Legale: Via Menotti Garibaldi, 15 - 00049 - Velletri - RM*
*Sede Operativa: Via Tuscolana, 990 - 00174 - Roma - RM*
 *Sede Operativa: Via Valla, 16 - 20141 - Milano - MI*
**
****
***Tel.: +39.06.64730509***
*Fax: +39.06.64730730***
*Cell.: +39.349.8182271*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120830/8dc79965/attachment.htm>

From john at merrells.com  Sat Aug 25 00:39:41 2012
From: john at merrells.com (John Merrells)
Date: Fri, 24 Aug 2012 16:39:41 -0700
Subject: [rabbitmq-discuss] channel 1 badfun
Message-ID: <CBF8856C-7C53-4DC3-B0D7-71CBEA6716EC@merrells.com>


We have a two node cluster of RabbitMQ 2.8.6 on Erlang 5.8.5.

Sometimes one of the servers will peg the cpu and messages will
stop passing through the system. We don't have a reliable way of
reproducing this...

But, we do have some curious error reports in the logs. I've read
through rabbit_amqqueue.erl and delegate.erl and I think that
one server is telling the other to execute some function in 
rabbit_amqqueue... but I don't see why that function would be 
'bad'.

Anyone any thoughts on the cpu issue, or this error report?

John 


=ERROR REPORT==== 24-Aug-2012::05:03:41 ===
AMQP connection <0.9427.665>, channel 1 - error:
{{badfun,#Fun<rabbit_amqqueue.28.6260804>},
 [{delegate,safe_invoke,2},
  {delegate,'-safe_invoke/2-lc$^0/1-0-',2},
  {delegate,handle_call,3},
  {gen_server2,handle_msg,2},
  {proc_lib,wake_up,3}]}

=WARNING REPORT==== 24-Aug-2012::05:03:41 ===
Non-AMQP exit reason '{{badfun,#Fun<rabbit_amqqueue.28.6260804>},
                       [{delegate,safe_invoke,2},
                        {delegate,'-safe_invoke/2-lc$^0/1-0-',2},
                        {delegate,handle_call,3},
                        {gen_server2,handle_msg,2},
                        {proc_lib,wake_up,3}]}'


-- 
John Merrells
http://johnmerrells.com
+1.415.244.5808






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120824/b9cbd2bf/attachment.htm>

From kolchanov at gmail.com  Tue Aug 28 11:57:40 2012
From: kolchanov at gmail.com (Andrey Kolchanov)
Date: Tue, 28 Aug 2012 03:57:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Topic exchange erlang client
Message-ID: <d1f077ec-e9cd-48c1-9e75-4c63e26e6bec@googlegroups.com>

Hello,
I have a topic exchange in my test environment.
I've add some binding to this exchange in web management console.When I 
publish a test message with proper routing key via web management console 
this message successfully delivered to desired queue.
I'm trying to publish message through erlang client, but message is not 
delivering to queue. 
What is wrong with my code:

ExchangeName = <<"custom.topic">>,   
ExchangeType = <<"topic">>,  
Key = <<"K">>,
Msg = <<"123">>,
{ok, Connection} = amqp_connection:start
    (#amqp_params_network{username = <<"guest">>, password = <<"guest">>, host = "192.168.1.1"}),
{ok, Channel} = amqp_connection:open_channel(Connection),
#'exchange.declare_ok'{} = 
    amqp_channel:call(Channel, #'exchange.declare'{exchange=ExchangeName, durable=true, type = ExchangeType}), 

ok = amqp_channel:call(Channel, #'basic.publish'{routing_key = Key}, 
#amqp_msg{props = #'P_basic'{delivery_mode=2}, payload = Msg}) .
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/b9a74e5e/attachment.htm>

From kolchanov at gmail.com  Tue Aug 28 12:55:07 2012
From: kolchanov at gmail.com (Andrey Kolchanov)
Date: Tue, 28 Aug 2012 04:55:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Topic exchange erlang client
In-Reply-To: <d1f077ec-e9cd-48c1-9e75-4c63e26e6bec@googlegroups.com>
References: <d1f077ec-e9cd-48c1-9e75-4c63e26e6bec@googlegroups.com>
Message-ID: <53cf9ac2-7774-4b37-aa99-2c5d8449b9f1@googlegroups.com>



I found error myself.

amqp_channel:call(Channel, #'basic.publish'{*exchange= ExchangeName*,routing_key 
= Key}, #amqp_msg{props = #'P_basic'{delivery_mode=2}, payload = Msg})

Thanks,
On Tuesday, August 28, 2012 2:57:40 PM UTC+4, Andrey Kolchanov wrote:
>
> Hello,
> I have a topic exchange in my test environment.
> I've add some binding to this exchange in web management console.When I 
> publish a test message with proper routing key via web management console 
> this message successfully delivered to desired queue.
> I'm trying to publish message through erlang client, but message is not 
> delivering to queue. 
> What is wrong with my code:
>
> ExchangeName = <<"custom.topic">>,   
> ExchangeType = <<"topic">>,  
> Key = <<"K">>,
> Msg = <<"123">>,
> {ok, Connection} = amqp_connection:start
>     (#amqp_params_network{username = <<"guest">>, password = <<"guest">>, host = "192.168.1.1"}),
> {ok, Channel} = amqp_connection:open_channel(Connection),
> #'exchange.declare_ok'{} = 
>     amqp_channel:call(Channel, #'exchange.declare'{exchange=ExchangeName, durable=true, type = ExchangeType}), 
>
> ok = amqp_channel:call(Channel, #'basic.publish'{routing_key = Key}, 
> #amqp_msg{props = #'P_basic'{delivery_mode=2}, payload = Msg}) .
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/54f8ef28/attachment.htm>

From kashifshaikh2.0 at gmail.com  Tue Aug 28 18:03:58 2012
From: kashifshaikh2.0 at gmail.com (Kashif Shaikh)
Date: Tue, 28 Aug 2012 10:03:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Java client threading design
Message-ID: <073480a1-f4f6-4099-aed8-ab93dd71bc17@googlegroups.com>

I'm just trying to understand the threading design:

- When a consumer is started for any queue on a particular channel, a 
thread is selected from the default executor service?
- Does a channel create a thread for itself?

- I have a threadpool for my application that processes requests and does 
consumes (amongst other tasks) - I don't want my threadpool servicing the 
consume callbacks.  So can I keep a single global channel, and just call 
basicConsume and register callbacks that will be executed on the default 
executor? Or should I create a channel for each thread in my threadpool, 
and then use channel.basicConsume()? 

- what happens if connection breaks - do I have to re-consume again?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/8c729567/attachment.htm>

From mark at control-alt-del.org  Tue Aug 28 20:46:54 2012
From: mark at control-alt-del.org (Mark Steele)
Date: Tue, 28 Aug 2012 15:46:54 -0400
Subject: [rabbitmq-discuss] RabbitMQ collectd monitoring plugin
Message-ID: <CAB5=j_rZY=SeHNJsNeGZ8VWbyuCxwqX6UMD2j3F949iKZOZbaQ@mail.gmail.com>

In case anyone's interested...

https://github.com/marksteele/collectd-plugins
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/d2acca1a/attachment.htm>

From charsyam at gmail.com  Wed Aug 29 12:42:29 2012
From: charsyam at gmail.com (CharSyam)
Date: Wed, 29 Aug 2012 04:42:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Failover in Clustering mode
Message-ID: <bc4121ed-eafd-4f57-947f-8e72bc566da8@googlegroups.com>

Hi. guys. I have a question of RabbitMQ Clustering mode. and I use Pika 
library.

I made a Rabbitmq cluster with 3 nodes.

Originally, there are 1 disk node and 2 ram nodes.

It worked well.

but when I kill the process of node1.

the queue_declare command failed( queue name is "task_queue" )

and I couldn't make it again unless I recovred it.

but when i changed the queue name. It works well again.

Please, Tell me the mechanism of RabbitMQ Cluster Mode when some nodes fail.

It is hart for me to understand the source code, due to writing in Erlang.

Thank you.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/d23dda58/attachment.htm>

From kilian.devouassoux at gmail.com  Thu Aug 30 09:57:21 2012
From: kilian.devouassoux at gmail.com (misterdev)
Date: Thu, 30 Aug 2012 01:57:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq v2.8.6 installation - Command make
	hangs forever
Message-ID: <48bfdcbd-707c-490c-aea9-83e4f8f840da@googlegroups.com>

Hello all
I have a problem when I want to install RAbbitMQ v2.8.5 and v2.8.6
1 - the command *make* give me errors : 

> git: Command not found 
>
--> It'snormal because git is not installed on my server. Is that a problem 
for the installation ? 

2 - a few seconds after giving me the git errors, *make *hangs after these 
lines : 

> rm -rf eldap-wrapper/build/dep-ezs
> mkdir -p eldap-wrapper/build/dep-ezs
> [elided] copy dependent ezs
> touch eldap-wrapper/build/dep-ezs/.done
>
 
And it hangs here forever...
I have had absolutely no problem installing and running v2.8.4, but I can't 
compile the new version. 
Has there been some changes that could explain that ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120830/f9df4b56/attachment.htm>

From tlempart at gmail.com  Thu Aug 30 14:53:07 2012
From: tlempart at gmail.com (tlempart)
Date: Thu, 30 Aug 2012 06:53:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchange and queue naming conventions
In-Reply-To: <AANLkTimBXprF+Q=VtAd=W+-V1LaYwW-gmW3S8htPk7j4@mail.gmail.com>
References: <AANLkTikB3T8BPUDkrvRPd7OwrOQVX8fLrK0LAn-Ab3xZ@mail.gmail.com>
	<yrv4cbp36np8l.fsf@dwragg.eng.vmware.com>
	<AANLkTikOj3sbPq5_dwjD7B2TCgaW6=m0OHrgihg-bnV1@mail.gmail.com>
	<AANLkTimBXprF+Q=VtAd=W+-V1LaYwW-gmW3S8htPk7j4@mail.gmail.com>
Message-ID: <1346334787471-21702.post@n5.nabble.com>

Hi,

Your discussion was very helpful for me. In particular, information about
who is responsible for creating what. However, I see one problem in case of
two independent applications, where the first one constains producer (PA)
and the second one contains consumer (CA). At the beginning there are no
exchanges/queues/bindings on the rabbitmq, so if the PA starts first, than
the producer creates exchange and starts sending messages. Because consumer
is not ready (CA has not yet started), than the queue and binding is not
created and the messages are lost. Is there any simple way/pattern to solve
such case, I mean to suspend sending messages by producer, until the
consumer creates own infrastructure (queue and binding)?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Exchange-and-queue-naming-conventions-tp7254p21702.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gerhard at lazu.co.uk  Thu Aug 30 15:08:43 2012
From: gerhard at lazu.co.uk (gerhard)
Date: Thu, 30 Aug 2012 07:08:43 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering woes
Message-ID: <be064ad6-604c-4037-9666-b6fbdde5a85e@googlegroups.com>

Running a rabbitmq cluster makes rabbitmq extremely unstable. I have a very 
simple, 2 nodes setup (both disc) for HA purposes. The most important 
queues have the HA flag ensuring they get replicated on both nodes so that 
if one goes down, the clients can reconnect to the other one and continue 
consuming messages as if nothing happened. In theory, it sounds perfect, 
but in practice it's such a pain!

If one node goes down, the performance of the remaining node gets seriously 
affected. Everything slows down, on occasions the broker just crashes. Any 
rabbitmqctl commands on the remaing node take 30seconds+ if the node is 
relatively quiet. Resetting the cluster doesn't work without a force_reset, 
I keep getting the *no_running_cluster_nodes* error.

Is anyone else having the same issues with RabbitMQ clustering? As it 
stands, it's pretty unusable. I'm running RabbitMQ *2.8.6* on Erlang *R13B03 
under Ubuntu 10.04.03 64bit, installed via the official *
http://www.rabbitmq.com/debian/dists/testing/* packages.*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120830/725a73de/attachment.htm>

From Pankaj.Mishra at indiatimes.co.in  Wed Aug 29 13:12:13 2012
From: Pankaj.Mishra at indiatimes.co.in (Pankaj Mishra)
Date: Wed, 29 Aug 2012 17:42:13 +0530
Subject: [rabbitmq-discuss] Rabbitmq server crash.
Message-ID: <D12F6E1231346F43981ED423F3F82AEA041FB18779@MUM01EVS02.INDIATIMES.CO.IN>

Hi,

We experienced a strange problem with rabbitmq server running in cluster. Actually according to
Log file the master of the server crashed. Post that all my publishers continue to send message without
Throwing any exception but all those messages were dropped silently by rabbitmq server. Consumer were not able
To get any of those messages until we restarted the rabbitmq server again.

I have attached with this mail the server crash log for master as well as for slave.

We have following setup for servers.
There are two servers. Both are in cluster in which one has data in disc and other has in RAM.

We have two queues both are durable and our message are also persistent.

Version of server that we are using 2.8.4
Erlang version ( Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8] [async-threads:0] [hipe] [kernel-poll:false]   )

We are using mirrored queue to avoid emergency failure of one server.  I am providing below the Code of our rabbit mq client.

We will be highly grateful for the explanation of aforesaid server behaviour.

PS: This happens once in a month.

Thanks,
Pankaj


Our consumer code

package com.times.mytimes.rabbitclient;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.rabbitmq.client.AMQP;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Consumer;
import com.rabbitmq.client.DefaultConsumer;
import com.rabbitmq.client.Envelope;
import com.rabbitmq.client.ShutdownListener;
import com.rabbitmq.client.ShutdownSignalException;

public abstract class BaseConsumer {
            final static Logger logger = LoggerFactory.getLogger(BaseConsumer.class);

            RabbitMqConnectionFactory rabbitMqConnectionFactory;

            private boolean shutdownFired = false;

            private BaseMessageHandler messageHandler;

            private ExecutorService threadExecutor;

            private int numberOFThreads;

            private ConsumerThread  consumerThread;

            private ConnectionShutDownListener connectionShutDownListener;

            private Thread th;

            public BaseConsumer(int numberOfConsumer, RabbitMqConnectionFactory rabbitMqConnectionFactory,
                                    BaseMessageHandler mytimesMessageHandler,int numberOFThreads) throws IOException {
                        this.messageHandler = mytimesMessageHandler;
                        this.rabbitMqConnectionFactory = rabbitMqConnectionFactory;
                        consumerThread= new ConsumerThread(numberOfConsumer, this.rabbitMqConnectionFactory.getConnection());
                        th= new Thread(consumerThread);
                        th.start();
                        threadExecutor = Executors.newFixedThreadPool(numberOFThreads);
                        this.numberOFThreads = numberOFThreads;
            }


    public abstract String getQueueName();

    public abstract String getRoutingKey();

    public abstract String getExchangeName();




            public void createConsumers(final int numberOfConsumer, final Connection connection ) throws IOException {
                        connectionShutDownListener = new ConnectionShutDownListener(numberOfConsumer);
                        connection.addShutdownListener(connectionShutDownListener);
                        for (int i = 0; i < numberOfConsumer; ++i) {
                                    Channel channel = connection.createChannel();
                                    getQueue(channel);
                                    channel.basicQos(this.numberOFThreads);
                                    binQueuedWithExchange(channel);
                                    createConsumer(channel, i + "th mt consumer");
                        }
            }

            public Connection getConnection()  {
                        try{
                                    return this.rabbitMqConnectionFactory.getConnection();
                        }catch (Exception e) {

                        }
                        return null;
            }

            public void getQueue(Channel channel) throws IOException {
                        Map<String, Object> args = new HashMap<String, Object>();
                        args.put("x-ha-policy", "all");
                        channel.queueDeclare(getQueueName(), true, false, false, args);
            }

            public void binQueuedWithExchange(Channel channel) throws IOException {
                        channel.queueBind(getQueueName(), getExchangeName(), getRoutingKey());
            }

            public void createConsumer(final Channel channel, String consumerTag) throws IOException {
                        channel.basicConsume(getQueueName(), false, consumerTag, new DefaultConsumer(channel) {

                                    @Override
                                    public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body)
                                    throws IOException
                                    {
                                                long deliveryTag = envelope.getDeliveryTag();
                                                            logger.error("handling message=="+new String(body));
                                                            Task task= new Task(new String(body), channel, deliveryTag);
                                                            threadExecutor.execute(task);
                                    }

                                    /**
                                     * No-op implementation of {@link Consumer#handleCancelOk}.
                                     *
                                     * @param consumerTag
                                     *            the defined consumer tag (client- or server-generated)
                                     */
                                    public void handleCancelOk(String consumerTag) {
                                                logger.error("This consumer cancelled ok ---"+consumerTag);
                                    }

                                    /**
                                     * No-op implementation of {@link Consumer#handleCancel(String)}
                                     *
                                     * @param consumerTag
                                     *            the defined consumer tag (client- or server-generated)
                                     */
                                    public void handleCancel(String consumerTag) throws IOException {
                                                logger.error("This consumer cancelled ---"+consumerTag);
                                    }

                                    /**
                                     * No-op implementation of {@link Consumer#handleShutdownSignal}.
                                     */
                                    public void handleShutdownSignal(String consumerTag, ShutdownSignalException sig) {
                                                logger.error("This consumer shutdown ---"+consumerTag , sig);
                                    }

                                    /**
                                     * No-op implementation of {@link Consumer#handleRecoverOk}.
                                     */
                                    public void handleRecoverOk() {
                                                logger.error("This consumer recoved ok ---");
                                    }
                        });
            }


            public void closeConnection() throws IOException{
                        shutdownFired = true;
                        threadExecutor.shutdown();
                        consumerThread.getConnection().removeShutdownListener(connectionShutDownListener);
                        consumerThread.getConnection().close();
                        th.interrupt();

            }
            private class ConsumerThread implements Runnable {

                        private int numberOfConsumer;

                        private Connection connection;


                        public ConsumerThread(int numberOfConsumer, Connection connection) {
                                    this.numberOfConsumer = numberOfConsumer;
                                    this.connection = connection;
                        }

                        @Override
                        public void run() {
                                    try {
                                                createConsumers(numberOfConsumer, this.connection);
                                    } catch (IOException e) {
                                                System.out.println("This thread is being killed.....");
                                    }
                        }

                        public Connection getConnection() {
                                    return connection;
                        }



            }

            private class ConnectionShutDownListener  implements ShutdownListener {

                        private int numberOfConsumer;
                        public ConnectionShutDownListener(int numberOfConsumer){
                                    this.numberOfConsumer = numberOfConsumer;
                        }
                        @Override
                        public void shutdownCompleted(ShutdownSignalException cause) {
                                    if(!shutdownFired){
                                                logger.error("new thread is being started.....for starting new connection.. connection fluctuates...");
                                                Connection connection = getConnection() ;
                                                while(connection == null ){
                                                            logger.error("got failed connection.....retrying...");
                                                            try {
                                                                        Thread.sleep(100);
                                                            } catch (InterruptedException e) {

                                                            }
                                                            connection = getConnection() ;
                                                }
                                        logger.error("connection successfully gained");
                                        consumerThread= new ConsumerThread(numberOfConsumer, connection);
                                                th= new Thread(consumerThread);
                                                th.start();
                                    }
                        }

            }


            private class Task implements Runnable{

                        String message;

                        Channel channel;

                        long deliveryTag;

                        public Task(String message, Channel channel, long deliveryTag) {
                                    this.message = message;
                                    this.channel = channel;
                                    this.deliveryTag = deliveryTag;
                        }
                        @Override
                        public void run() {
                                    try{
                                                messageHandler.handleMessage(message);
                                    }finally{
                                                try {
                                                            channel.basicAck(deliveryTag, false);
                                                } catch (IOException e) {
                                                            logger.error("Error in sending acknowledge");
                                                }
                                    }
                        }
            }
}





Below is the log for server crash ()



Run farther, run faster, run pain-free. Calling all marathon enthusiasts for a sports evaluation and runners' program at  VARD.N. Write in today to vardan at timesgroup.com or click here to register and we'll schedule an appointment for you.



DISCLAIMER AND PRIVILEGE NOTICE: This e-mail message contains confidential, copyright, proprietary and legally privileged information. It should not be used by anyone who is not the original intended recipient. If you have erroneously received this message, please delete it immediately and notify the sender. The recipient must note and understand that any views expressed in this message are those of the individual sender and no binding nature of the message shall be implied or assumed unless the sender does so expressly with due authority of BCCL subsidiaries and associated companies, Collectively Times Group.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/8f1ddbda/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: master-sasl.log
Type: application/octet-stream
Size: 30196 bytes
Desc: master-sasl.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/8f1ddbda/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: master.log
Type: application/octet-stream
Size: 7284 bytes
Desc: master.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/8f1ddbda/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: slave.log
Type: application/octet-stream
Size: 1698 bytes
Desc: slave.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120829/8f1ddbda/attachment-0002.obj>

From tim at rabbitmq.com  Thu Aug 30 22:43:50 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 30 Aug 2012 22:43:50 +0100
Subject: [rabbitmq-discuss] Rabbitmq v2.8.6 installation - Command make
	hangs forever
In-Reply-To: <48bfdcbd-707c-490c-aea9-83e4f8f840da@googlegroups.com>
References: <48bfdcbd-707c-490c-aea9-83e4f8f840da@googlegroups.com>
Message-ID: <5E2E377E-245E-4BB4-A375-7E1930B94320@rabbitmq.com>


On 30 Aug 2012, at 09:57, misterdev wrote:

> Hello all
> I have a problem when I want to install RAbbitMQ v2.8.5 and v2.8.6

*How* are you trying to install rabbit? Are you using a package manager, or compiling from source (I assume this one) or some other way?

> 1 - the command make give me errors : 
> git: Command not found 
> --> It'snormal because git is not installed on my server. Is that a problem for the installation ? 
> 

Yes, the installation requires git.

> 2 - a few seconds after giving me the git errors, make hangs after these lines :
> rm -rf eldap-wrapper/build/dep-ezs
> mkdir -p eldap-wrapper/build/dep-ezs
> [elided] copy dependent ezs
> touch eldap-wrapper/build/dep-ezs/.done
>  

That's quite odd, but nonetheless you won't be able to build using make without having git installed.

> And it hangs here forever...
> I have had absolutely no problem installing and running v2.8.4, but I can't compile the new version.
> Has there been some changes that could explain that ?

There have been changes to the build system, but the requirement to use git when compiling from source is not new.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120830/7288b150/attachment.htm>

From mpietrek at skytap.com  Thu Aug 30 22:47:45 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 30 Aug 2012 14:47:45 -0700
Subject: [rabbitmq-discuss] RabbitMQ clustering woes
In-Reply-To: <be064ad6-604c-4037-9666-b6fbdde5a85e@googlegroups.com>
References: <be064ad6-604c-4037-9666-b6fbdde5a85e@googlegroups.com>
Message-ID: <CACLE7iysLw5RVF-2amuZMS55aXEcErrKV-UtwahL7ZjFoFRJ0g@mail.gmail.com>

FWIW, I run a pretty similar situation (2.8.6 on Ubuntu 10.04), with HA
queues on 3 or 4 node clusters.

I habitually (many, many times / day) take nodes out of the cluster and
have never seen the particular issue you're seeing, i.e slowness when
communicating with the remaining node.

I have other issues with clustering, just not the slowness and crashes. I'm
wondering if you have some sort of weird networking state when this
happens. Just a guess though.


On Thu, Aug 30, 2012 at 7:08 AM, gerhard <gerhard at lazu.co.uk> wrote:

> Running a rabbitmq cluster makes rabbitmq extremely unstable. I have a
> very simple, 2 nodes setup (both disc) for HA purposes. The most important
> queues have the HA flag ensuring they get replicated on both nodes so that
> if one goes down, the clients can reconnect to the other one and continue
> consuming messages as if nothing happened. In theory, it sounds perfect,
> but in practice it's such a pain!
>
> If one node goes down, the performance of the remaining node gets
> seriously affected. Everything slows down, on occasions the broker just
> crashes. Any rabbitmqctl commands on the remaing node take 30seconds+ if
> the node is relatively quiet. Resetting the cluster doesn't work without a
> force_reset, I keep getting the *no_running_cluster_nodes* error.
>
> Is anyone else having the same issues with RabbitMQ clustering? As it
> stands, it's pretty unusable. I'm running RabbitMQ *2.8.6* on Erlang *R13B03
> under Ubuntu 10.04.03 64bit, installed via the official *
> http://www.rabbitmq.com/debian/dists/testing/* packages.*
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120830/50cda336/attachment.htm>

From matthias at rabbitmq.com  Thu Aug 30 22:53:26 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 Aug 2012 22:53:26 +0100
Subject: [rabbitmq-discuss] Rabbitmq v2.8.6 installation - Command make
 hangs forever
In-Reply-To: <5E2E377E-245E-4BB4-A375-7E1930B94320@rabbitmq.com>
References: <48bfdcbd-707c-490c-aea9-83e4f8f840da@googlegroups.com>
	<5E2E377E-245E-4BB4-A375-7E1930B94320@rabbitmq.com>
Message-ID: <503FE0D6.8050609@rabbitmq.com>

On 30/08/12 22:43, Tim Watson wrote:
> There have been changes to the build system, but the requirement to use
> git when compiling from source is not new.

I am assuming the OP is attempting to build from the source packages 
rather than hg. The git requirement for that was in fact only introduced 
in 2.8.5. And we are hoping to eliminate that again.

This has come up before. See 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-August/022060.html

Matthias.

From tim at rabbitmq.com  Thu Aug 30 23:04:36 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 30 Aug 2012 23:04:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering woes
In-Reply-To: <be064ad6-604c-4037-9666-b6fbdde5a85e@googlegroups.com>
References: <be064ad6-604c-4037-9666-b6fbdde5a85e@googlegroups.com>
Message-ID: <D3D4D116-A288-40C2-8D3D-7F2700A27AB0@rabbitmq.com>


On 30 Aug 2012, at 15:08, gerhard wrote:

> Running a rabbitmq cluster makes rabbitmq extremely unstable. I have a very simple, 2 nodes setup (both disc) for HA purposes. The most important queues have the HA flag ensuring they get replicated on both nodes so that if one goes down, the clients can reconnect to the other one and continue consuming messages as if nothing happened. In theory, it sounds perfect, but in practice it's such a pain!
> 

That shouldn't be the case, obviously. From the sounds of things, the issues you're experiencing are to do with HA, rather than clustering, which in and of itself is not just an HA feature. 

> If one node goes down, the performance of the remaining node gets seriously affected. Everything slows down, on occasions the broker just crashes. Any rabbitmqctl commands on the remaing node take 30seconds+ if the node is relatively quiet. Resetting the cluster doesn't work without a force_reset, I keep getting the no_running_cluster_nodes error.
> 

This is not normal behaviour. In a two node cluster with HA enabled, there will be *some* performance degradation during failover, as the remaining node has a lot of work to do, but this 'slow down' should not last for too long, the broker should not crash and rabbitmqctl should not keep taking 30+ seconds to complete commands once things have evened out a bit.

It *sounds* to me like your problems are worth investigating, but we'll need some more information to go on. 

- How often is one of the nodes failing? This (obviously) shouldn't happen very often. 
- What is causing one of the nodes to fail? Is it a rabbit crash, or something else (external to the broker)?
- What kind of load is the system (i.e., the broker) under whilst failover takes place?
- How many HA queues do you have and how many exchanges + bindings around these?
- Are the machines on the same LAN, Subnet, etc. Any specific network kit in between them?

If you can post the logs (and sasl logs) from both brokers and `rabbitmqctl report` output, that would also be very helpful. If you're able to provide a minimal example (written, scripted or whatever) then that would also enable us to diagnose and fix any problems more rapidly. Any other diagnostic information would also be useful (info on CPU, memory, network and disk usage on the given nodes for example).

> Is anyone else having the same issues with RabbitMQ clustering? As it stands, it's pretty unusable. I'm running RabbitMQ 2.8.6 on Erlang R13B03 under Ubuntu 10.04.03 64bit, installed via the official http://www.rabbitmq.com/debian/dists/testing/ packages.

We've seen a few bugs in the HA code which can crop up under very specific circumstances and we've fixed most of them, released many of the fixes and are trying to get the remaining fixes completed and released asap.

Please also note that we *highly* recommend upgrading to the latest Erlang/OTP release if possible (R15B01 at this time), as R13 is quite old and a lot of fixes and performance improvements have gone into the VM since then.

Thanks,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120830/7ae89ecf/attachment.htm>

From tim at rabbitmq.com  Thu Aug 30 23:17:04 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 30 Aug 2012 23:17:04 +0100
Subject: [rabbitmq-discuss] channel 1 badfun
In-Reply-To: <CBF8856C-7C53-4DC3-B0D7-71CBEA6716EC@merrells.com>
References: <CBF8856C-7C53-4DC3-B0D7-71CBEA6716EC@merrells.com>
Message-ID: <E78BB53C-99EE-478E-B369-1C830E147B3A@rabbitmq.com>

Hi John

On 25 Aug 2012, at 00:39, John Merrells wrote:

> 
> We have a two node cluster of RabbitMQ 2.8.6 on Erlang 5.8.5.
> 
> Sometimes one of the servers will peg the cpu and messages will
> stop passing through the system. We don't have a reliable way of
> reproducing this...
> 

There are a few conditions that can cause this to happen. What other symptoms happen when this occurs? Does memory usage go up as well? Does the CPU usage come down eventually, or get stuck?

> But, we do have some curious error reports in the logs. I've read
> through rabbit_amqqueue.erl and delegate.erl and I think that
> one server is telling the other to execute some function in 
> rabbit_amqqueue... but I don't see why that function would be 
> 'bad'.
> 
> Anyone any thoughts on the cpu issue, or this error report?
> 

Well we'd certainly like to get to the bottom of it asap. Can you please tell us a bit more about your setup please:

   a. cluster setup (i.e., disk vs ram nodes)
   b. how many queues, are there any HA queues?
   c. how you're interacting with the broker/cluster (publishers, consumers, exchanges and bindings and so on)

Also if there's any more of the logs (and sasl logs) for both nodes you're able to share, that would also help. If this occurs again and you're able to run `rabbitmqctl report` on the affected node, that would be great.

Cheers,
Tim

From jerryk at rbcon.com  Thu Aug 30 23:43:49 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 30 Aug 2012 15:43:49 -0700
Subject: [rabbitmq-discuss] Exchange and queue naming conventions
In-Reply-To: <1346334787471-21702.post@n5.nabble.com>
References: <AANLkTikB3T8BPUDkrvRPd7OwrOQVX8fLrK0LAn-Ab3xZ@mail.gmail.com>
	<yrv4cbp36np8l.fsf@dwragg.eng.vmware.com>
	<AANLkTikOj3sbPq5_dwjD7B2TCgaW6=m0OHrgihg-bnV1@mail.gmail.com>
	<AANLkTimBXprF+Q=VtAd=W+-V1LaYwW-gmW3S8htPk7j4@mail.gmail.com>
	<1346334787471-21702.post@n5.nabble.com>
Message-ID: <CAE0Sz=xH9QKh+F8yCcB-DC1jOKi-tb0Nucw_zazLMMNXiSWPkg@mail.gmail.com>

You might consider having producers use the mandatory flag.  That way if
it's not possible for Rabbit to put the message into at least one queue,
you'll get it sent back to you via a basic.return and the producer can
rethink its life choices accordingly.

Best regards,
Jerry

On Thu, Aug 30, 2012 at 6:53 AM, tlempart <tlempart at gmail.com> wrote:

> Hi,
>
> Your discussion was very helpful for me. In particular, information about
> who is responsible for creating what. However, I see one problem in case of
> two independent applications, where the first one constains producer (PA)
> and the second one contains consumer (CA). At the beginning there are no
> exchanges/queues/bindings on the rabbitmq, so if the PA starts first, than
> the producer creates exchange and starts sending messages. Because consumer
> is not ready (CA has not yet started), than the queue and binding is not
> created and the messages are lost. Is there any simple way/pattern to solve
> such case, I mean to suspend sending messages by producer, until the
> consumer creates own infrastructure (queue and binding)?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Exchange-and-queue-naming-conventions-tp7254p21702.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120830/04b8fae6/attachment.htm>

From alexis at rabbitmq.com  Fri Aug 31 07:29:34 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 31 Aug 2012 07:29:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ collectd monitoring plugin
In-Reply-To: <CAB5=j_rZY=SeHNJsNeGZ8VWbyuCxwqX6UMD2j3F949iKZOZbaQ@mail.gmail.com>
References: <CAB5=j_rZY=SeHNJsNeGZ8VWbyuCxwqX6UMD2j3F949iKZOZbaQ@mail.gmail.com>
Message-ID: <CACOPnvc8g6iO9eo5iigcWyFJ6O1EJvLdM-Tpeo++z2SbcG79OQ@mail.gmail.com>

cool!

On Tue, Aug 28, 2012 at 8:46 PM, Mark Steele <mark at control-alt-del.org> wrote:
> In case anyone's interested...
>
> https://github.com/marksteele/collectd-plugins
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Fri Aug 31 07:46:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 Aug 2012 07:46:21 +0100
Subject: [rabbitmq-discuss] Exchange and queue naming conventions
In-Reply-To: <CAE0Sz=xH9QKh+F8yCcB-DC1jOKi-tb0Nucw_zazLMMNXiSWPkg@mail.gmail.com>
References: <AANLkTikB3T8BPUDkrvRPd7OwrOQVX8fLrK0LAn-Ab3xZ@mail.gmail.com>
	<yrv4cbp36np8l.fsf@dwragg.eng.vmware.com>
	<AANLkTikOj3sbPq5_dwjD7B2TCgaW6=m0OHrgihg-bnV1@mail.gmail.com>
	<AANLkTimBXprF+Q=VtAd=W+-V1LaYwW-gmW3S8htPk7j4@mail.gmail.com>
	<1346334787471-21702.post@n5.nabble.com>
	<CAE0Sz=xH9QKh+F8yCcB-DC1jOKi-tb0Nucw_zazLMMNXiSWPkg@mail.gmail.com>
Message-ID: <50405DBD.2080205@rabbitmq.com>

On 30/08/12 23:43, Jerry Kuch wrote:
> You might consider having producers use the mandatory flag.  That way if
> it's not possible for Rabbit to put the message into at least one queue,
> you'll get it sent back to you via a basic.return and the producer can
> rethink its life choices accordingly.

Or *both* producer and consumer could declare the required exchanges, 
queues and bindings.

Obviously that only works if they both a) have the required knowledge, 
and b) are sufficiently trusted.

Matthias.

From jherazo at beverlydata.com  Fri Aug 31 10:35:12 2012
From: jherazo at beverlydata.com (Jaime Herazo B.)
Date: Fri, 31 Aug 2012 11:35:12 +0200
Subject: [rabbitmq-discuss] Help pinpointing an error
Message-ID: <50408550.8070801@beverlydata.com>

Hi.

I'm new to RabbitMQ and the whole messaging platforms world in general.
I'm working with this Rabbit setup already in place as part of my
sysadmin duties. There's other people who are the ones that really know
about it, but in general i have to take care of the servers.

Today a rabbit instance went down. I restarted the service only to be
greeted by screams as apparently many messages were lost in the process
(as far as i understood, once queues were marked as "Durable" this
couldn't happen, but it happened).

The "Reason for termination" was:

{{badmatch,[{file_summary,2064936,4810835,2064935,2064937,16780759,true,1}]},                                                                                                             
 [
  {rabbit_msg_store,combine_files,3},
  {rabbit_msg_store_gc,attempt_action,3},
  {rabbit_msg_store_gc,handle_cast,2},
  {gen_server2,handle_msg,2},
  {proc_lib,wake_up,3}
 ]
}

I'm having trouble even identifying what does this mean, let alone
preventing it from happening again. It started just fine, so it was
probably a transient error, but the fact that it took with it all the
messages in the queue is troubling.

Can you please point me towards more resources to handle these kinds of
problems in the future that don't involve loss of data? What did i do
wrong?

Also, do you see a hint of what went wrong there, or do i need to give
more info for this?

Thanks for any help or hints.


From tim at rabbitmq.com  Fri Aug 31 10:46:16 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 Aug 2012 10:46:16 +0100
Subject: [rabbitmq-discuss] Rabbitmq server crash.
In-Reply-To: <D12F6E1231346F43981ED423F3F82AEA041FB18779@MUM01EVS02.INDIATIMES.CO.IN>
References: <D12F6E1231346F43981ED423F3F82AEA041FB18779@MUM01EVS02.INDIATIMES.CO.IN>
Message-ID: <C1CC286E-316B-405E-952B-09B18A095A20@rabbitmq.com>

Hi

On 29 Aug 2012, at 13:12, Pankaj Mishra wrote:

> Hi,
>  
> We experienced a strange problem with rabbitmq server running in cluster. Actually according to
> Log file the master of the server crashed. Post that all my publishers continue to send message without
> Throwing any exception but all those messages were dropped silently by rabbitmq server. Consumer were not able
> To get any of those messages until we restarted the rabbitmq server again.
>  
> I have attached with this mail the server crash log for master as well as for slave.

According to the master log, the mnesia database has become inconsistent, which is not a good sign. It looks very much like a network partition has occurred here:

%% from master.log

=INFO REPORT==== 7-Aug-2012::18:42:24 ===
rabbit on node rabbit at MyTimes160 down

%% from slave.log

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
rabbit on node rabbit at MyTimes159 down

According to the logs, both the master and the slave observed the other node disappear, which seems consistent with the network partition theory.

%% from master.log

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
Mirrored-queue (queue 'cms' in vhost '/'): Master <rabbit at MyTimes159.3.444.0> saw deaths of mirrors <rabbit at MyTimes160.2.595.0> 

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
Mirrored-queue (queue 'mytimes' in vhost '/'): Master <rabbit at MyTimes159.3.437.0> saw deaths of mirrors <rabbit at MyTimes160.2.591.0> 

%% from slave.log

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
Mirrored-queue (queue 'mytimes' in vhost '/'): Slave <rabbit at MyTimes160.2.591.0> saw deaths of mirrors <rabbit at MyTimes159.3.437.0> 

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
Mirrored-queue (queue 'cms' in vhost '/'): Slave <rabbit at MyTimes160.2.595.0> saw deaths of mirrors <rabbit at MyTimes159.3.444.0> 


Rabbit is not partition tolerant, so I would expect things might go wrong under such circumstances, but I would not expect messages to be silently dropped. My reading of the logs so far is that when the partitioned database state is reached, a message is sent to the gm ring on the 'master' node (the {mnesia_locker,rabbit at MyTimes160,granted} message) which isn't handled, thereby crashing the gm handling process. Once that is down, other things start to go wrong. The parent supervisor will have restarted the failed process to get things back into a consistent state, but it looks as though because mnesia has its knickers in a twist about the partitioned database, that the recovery can't take place properly.

We will look into this asap, but can you confirm that a net split did in fact take place around the time this problem started appearing?
 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/eacaf45b/attachment.htm>

From tim at rabbitmq.com  Fri Aug 31 10:56:00 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 Aug 2012 10:56:00 +0100
Subject: [rabbitmq-discuss] Help pinpointing an error
In-Reply-To: <50408550.8070801@beverlydata.com>
References: <50408550.8070801@beverlydata.com>
Message-ID: <E7A072CA-7E70-4BCF-86C3-88366D9C268D@rabbitmq.com>

Hi

On 31 Aug 2012, at 10:35, Jaime Herazo B. wrote:

> Hi.
> 
> Today a rabbit instance went down. I restarted the service only to be
> greeted by screams as apparently many messages were lost in the process
> (as far as i understood, once queues were marked as "Durable" this
> couldn't happen, but it happened).
> 

This shouldn't happen, so let's try and figure out what went wrong.


> The "Reason for termination" was:
> 
> {{badmatch,[{file_summary,2064936,4810835,2064935,2064937,16780759,true,1}]},                                                                                                             
> [
>  {rabbit_msg_store,combine_files,3},
>  {rabbit_msg_store_gc,attempt_action,3},
>  {rabbit_msg_store_gc,handle_cast,2},
>  {gen_server2,handle_msg,2},
>  {proc_lib,wake_up,3}
> ]
> }
> 

The rabbit_msg_store module handles persisting the contents (i.e., data) for durable queues on disk. The badmatch (which means we didn't see the data we expected to see when assigning something) occurs because the 'readers' field for the file_summary is expected to be 0, not 1. This routine is called when compacting the data (e.g., during a garbage collection-esque process) and is called when the message store is initialising, so my reading thus far is that we've somehow ended up with a process trying to read from the message store before it's properly initialised.

> I'm having trouble even identifying what does this mean, let alone
> preventing it from happening again. It started just fine, so it was
> probably a transient error, but the fact that it took with it all the
> messages in the queue is troubling.
> 

Indeed. We must stop this from happening.

> Can you please point me towards more resources to handle these kinds of
> problems in the future that don't involve loss of data? What did i do
> wrong?
> 
> Also, do you see a hint of what went wrong there, or do i need to give
> more info for this?
> 

Someone better versed in the mechanics of the message store may chime in with a good explanation, but for my part I'd like to understand a few more things:

1. how did your rabbit go down (crashed, accidentally restarted, etc)?
2. exactly what steps did you take to restart it
3. what kind of configuration do you have (is it clustered, any HA queues, etc)

And if you could please send over the logs and sasl-logs (stripped of any private data if needs be) that would be very helpful indeed.



From matthias at rabbitmq.com  Fri Aug 31 11:13:54 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 Aug 2012 11:13:54 +0100
Subject: [rabbitmq-discuss] Help pinpointing an error
In-Reply-To: <E7A072CA-7E70-4BCF-86C3-88366D9C268D@rabbitmq.com>
References: <50408550.8070801@beverlydata.com>
	<E7A072CA-7E70-4BCF-86C3-88366D9C268D@rabbitmq.com>
Message-ID: <50408E62.7040602@rabbitmq.com>

On 31/08/12 10:56, Tim Watson wrote:
> 1. how did your rabbit go down (crashed, accidentally restarted, etc)?
> 2. exactly what steps did you take to restart it
> 3. what kind of configuration do you have (is it clustered, any HA queues, etc)

The most important question of all is "What version of rabbit are you 
running?"

We fixed numerous bugs in the persister, but that was a long time ago 
and we have not seen any problem reports since.


Matthias.

From francesco at rabbitmq.com  Fri Aug 31 11:56:05 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 31 Aug 2012 11:56:05 +0100
Subject: [rabbitmq-discuss] auto configration cluster fail ...
In-Reply-To: <16b1a316.fe2c.13976d8b604.Coremail.citi007@126.com>
References: <16b1a316.fe2c.13976d8b604.Coremail.citi007@126.com>
Message-ID: <87txvjgwje.wl%francesco@rabbitmq.com>

Hi,

Are you sure that rabbit is picking up your config file?  You can check by
inspecting the output when starting the broker it will show, among other things,

  config file(s) : (none)

Make sure that in your case you don't get `(none)' but a path to your config
file.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Fri Aug 31 11:58:34 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 31 Aug 2012 11:58:34 +0100
Subject: [rabbitmq-discuss] Failover in Clustering mode
In-Reply-To: <bc4121ed-eafd-4f57-947f-8e72bc566da8@googlegroups.com>
References: <bc4121ed-eafd-4f57-947f-8e72bc566da8@googlegroups.com>
Message-ID: <87sjb3gwf9.wl%francesco@rabbitmq.com>

Hi,

Your messages is very unclear in what's going on.  What's `node1'?  Is it the
disc node, or one of the ram nodes?  What error do you get when trying to
declare the queue?  Are you sure there isn't another queue with the same name?

Please send more details.

--
Francesco * Often in error, never in doubt

From rajni at arosys.com  Fri Aug 31 12:16:13 2012
From: rajni at arosys.com (Rajni)
Date: Fri, 31 Aug 2012 16:46:13 +0530
Subject: [rabbitmq-discuss] No Exchange Found In V Host Issue
Message-ID: <00c901cd876a$0b4bc2d0$21e34870$@com>

Hi,

 

I'm a newbie to rabbitmq publish/consume concept , I would request for
positive reply from anyone.

 

I'm trying to publish a message using the code below:

 

String exchangeName = "directPublishMessageToIndexServiceExchangeName";

String routeKey = "directPublishMessageToIndexServiceRoutekeyName";

 

channel = connection.createChannel();

channel.basicPublish(exchangeName,routeKey, properties,messageBody);

channel.close();

 

 

and when I try to run the code it's giving an error like below :

 

ERROR - Exception in closing Channel :
com.rabbitmq.client.ShutdownSignalException: channel error; reason:
{#method<channel.close>(reply-code=404,reply-text=NOT_FOUND - no exchange
'directPublishMessageToIndexServiceExchangeName' in vhost
'/',class-id=60,method-id=40),null,""}

com.rabbitmq.client.ShutdownSignalException: channel error; reason:
{#method<channel.close>(reply-code=404,reply-text=NOT_FOUND - no exchange
'directPublishMessageToIndexServiceExchangeName' in vhost
'/',class-id=60,method-id=40),null,""}

ERROR - com.rabbitmq.client.ShutdownSignalException: connection error;
reason: com.rabbitmq.client.impl.UnknownChannelException: Unknown channel
number 5

 

Please Help..!

 

Thanks,

Rajni

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/ed8a79a4/attachment.htm>

From francesco at rabbitmq.com  Fri Aug 31 12:27:34 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 31 Aug 2012 12:27:34 +0100
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <201208250029598551536@edocom.cn>
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
Message-ID: <87pq67gv2x.wl%francesco@rabbitmq.com>

Hi,

This is done easily by having acks enabled.  When the first consumer dies, the
unacked messages will be requeued, and the second consumer can start consuming.

Now, the only issues is for the second consumer to find out when to start
consuming.  This can be done in a multitude of ways, but we'll propose two:

  * The second consumer polls the first in some way and starts consuming when it
    realises the first consumer is dead.  This is simple and should serve you
    right, but it's not that nice performance wise.

  * You create a second queue that we'll call "token queue", and you publish one
    dummy message in it, with acks enabled.  Then, a consumer wishing to consume
    from your queue, will:

      - Consume from the token queue
      - Start consuming from the actual queue
      - When shutting down, publish a dummy message to the token queue

    In this way your token queue will act a semaphore that will guarantee
    exclusive access to the queue.  When a consumer die, the message in the
    token queue will be requeued, and the next consumer will be able to consume
    it and then start consuming from the other queue.

    This method scales to an arbitrary number of consumers.

I hope this suggestions help.

--
Francesco * Often in error, never in doubt

From jherazo at beverlydata.com  Fri Aug 31 12:32:46 2012
From: jherazo at beverlydata.com (Jaime Herazo B.)
Date: Fri, 31 Aug 2012 13:32:46 +0200
Subject: [rabbitmq-discuss] Help pinpointing an error
In-Reply-To: <50408E62.7040602@rabbitmq.com>
References: <50408550.8070801@beverlydata.com>
	<E7A072CA-7E70-4BCF-86C3-88366D9C268D@rabbitmq.com>
	<50408E62.7040602@rabbitmq.com>
Message-ID: <5040A0DE.4020303@beverlydata.com>

I just checked on the machine with "rabbitmqctl list_queues name
durable", and all show "false". Seems like someone here made a mistake
and forgot to make the queues durable, which was something we all had
assumed. Sorry for the alarm.

Is it possible to change the parameters of the queues and make them
durable without having to make a new one with a different name as
suggested in the Python tutorial?

Also the broker still crashed, so i'm posting the info asked anyway:

* rabbitmq-server 2.8.4-1 on Debian Stable (6.0.3)
* The service crashed, so i did a "service rabbitmq-server restart".
Naturally, since now we know that the queues are not durable as we
expected, all was lost.
* No HA, no clustering, 2 machines sending information to each other,
and a couple dozen clients consuming the messages put on the queues by
the one that crashed.

And for the logs, here's the pastebin:
http://pastebin.com/FTHGQVPQ
The sasl log has far more information, but it was almost 1Mb of
information on that crash alone, so initially i'm just pasting this and
if needed i'll just add the other one.

On 31/08/12 12:13, Matthias Radestock wrote:
> On 31/08/12 10:56, Tim Watson wrote:
>> 1. how did your rabbit go down (crashed, accidentally restarted, etc)?
>> 2. exactly what steps did you take to restart it
>> 3. what kind of configuration do you have (is it clustered, any HA
>> queues, etc)
>
> The most important question of all is "What version of rabbit are you
> running?"
>
> We fixed numerous bugs in the persister, but that was a long time ago
> and we have not seen any problem reports since.
>
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From matthias at rabbitmq.com  Fri Aug 31 12:39:47 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 Aug 2012 12:39:47 +0100
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <87pq67gv2x.wl%francesco@rabbitmq.com>
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>
Message-ID: <5040A283.9010901@rabbitmq.com>

On 31/08/12 12:27, Francesco Mazzoli wrote:
>    * The second consumer polls the first in some way and starts consuming when it
>      realises the first consumer is dead.  This is simple and should serve you
>      right, but it's not that nice performance wise.

A passive queue.declare, which returns the consumer_count could 
accomplish this. You'd need to be mindful of races when consumers start up.

>    * You create a second queue that we'll call "token queue", and you publish one
>      dummy message in it, with acks enabled.  Then, a consumer wishing to consume
>      from your queue, will:
>
>        - Consume from the token queue

More specifically, start consuming and wait for the token message to 
arrive. And then...

>        - Start consuming from the actual queue
>        - When shutting down, publish a dummy message to the token queue

No need for the last step (and in fact it will lead to token 
duplication). Simply leave the message unack'ed and let the automatic 
requeue on connection closure/failure take care of the rest.

Matthias.

From matthias at rabbitmq.com  Fri Aug 31 12:50:30 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 Aug 2012 12:50:30 +0100
Subject: [rabbitmq-discuss] Failover in Clustering mode
In-Reply-To: <bc4121ed-eafd-4f57-947f-8e72bc566da8@googlegroups.com>
References: <bc4121ed-eafd-4f57-947f-8e72bc566da8@googlegroups.com>
Message-ID: <5040A506.1020105@rabbitmq.com>

On 29/08/12 12:42, CharSyam wrote:
> I made a Rabbitmq cluster with 3 nodes.
>
> Originally, there are 1 disk node and 2 ram nodes.
>
> It worked well.
>
> but when I kill the process of node1.
>
> the queue_declare command failed( queue name is "task_queue" )
>
> and I couldn't make it again unless I recovred it.

That is the expected behaviour when the queue is declared as 'durable'.

While a queue's "home" node is down, clients connected to other nodes 
and attempting to re-declare the queue will get a 404-NOT_FOUND.

If other nodes were able to re-declare such queues they would then 
conflict with the original queue when that gets recovered.

Matthias.

From matthias at rabbitmq.com  Fri Aug 31 13:02:39 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 Aug 2012 13:02:39 +0100
Subject: [rabbitmq-discuss] No Exchange Found In V Host Issue
In-Reply-To: <00c901cd876a$0b4bc2d0$21e34870$@com>
References: <00c901cd876a$0b4bc2d0$21e34870$@com>
Message-ID: <5040A7DF.9050508@rabbitmq.com>

Rajni,

On 31/08/12 12:16, Rajni wrote:
> I?m trying to publish a message using the code below:
>
> *String exchangeName = ?directPublishMessageToIndexServiceExchangeName?;*
> *String routeKey = ?directPublishMessageToIndexServiceRoutekeyName?;*
> **
> *channel = connection.createChannel();*
> *channel.basicPublish(exchangeName,routeKey, properties,messageBody);*
> *channel.close();*
>
> and when I try to run the code it?s giving an error like below :
>
> *ERROR - Exception in closing Channel :
> com.rabbitmq.client.ShutdownSignalException: channel error; reason:
> {#method<channel.close>(reply-code=404,reply-text=NOT_FOUND - no
> exchange 'directPublishMessageToIndexServiceExchangeName' in vhost
> '/',class-id=60,method-id=40),null,""}*

You are missing an exchangeDeclare.

Have you read the rabbit tutorials 
(http://www.rabbitmq.com/getstarted.html)? Exchange declaration is 
covered in tutorial 3.

Regards,

Matthias.

From tim at rabbitmq.com  Fri Aug 31 13:18:17 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 Aug 2012 13:18:17 +0100
Subject: [rabbitmq-discuss] Help pinpointing an error
In-Reply-To: <5040A0DE.4020303@beverlydata.com>
References: <50408550.8070801@beverlydata.com>
	<E7A072CA-7E70-4BCF-86C3-88366D9C268D@rabbitmq.com>
	<50408E62.7040602@rabbitmq.com> <5040A0DE.4020303@beverlydata.com>
Message-ID: <4DFE1868-EFA4-4439-AE5B-00AF1FFED624@rabbitmq.com>


On 31 Aug 2012, at 12:32, Jaime Herazo B. wrote:

> I just checked on the machine with "rabbitmqctl list_queues name
> durable", and all show "false". Seems like someone here made a mistake
> and forgot to make the queues durable, which was something we all had
> assumed. Sorry for the alarm.
> 

Well at least the message loss is not unexpected then

> Is it possible to change the parameters of the queues and make them
> durable without having to make a new one with a different name as
> suggested in the Python tutorial?

Not that I'm aware of.

> 
> Also the broker still crashed, so i'm posting the info asked anyway:
> 
> * rabbitmq-server 2.8.4-1 on Debian Stable (6.0.3)

That sounds new enough to me - Matthias?

> * The service crashed, so i did a "service rabbitmq-server restart".
> Naturally, since now we know that the queues are not durable as we
> expected, all was lost.
> * No HA, no clustering, 2 machines sending information to each other,
> and a couple dozen clients consuming the messages put on the queues by
> the one that crashed.
> 
> And for the logs, here's the pastebin:
> http://pastebin.com/FTHGQVPQ
> The sasl log has far more information, but it was almost 1Mb of
> information on that crash alone, so initially i'm just pasting this and
> if needed i'll just add the other one.
> 

Is that it? It seems like you've pasted only a subset of the log file, and I'd like to know a bit more about what was happening on both nodes when this occurs. Can we see the sasl logs for both nodes too please, and the output of `rabbitmqctl report` for both nodes?

From tim at rabbitmq.com  Fri Aug 31 13:26:57 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 Aug 2012 13:26:57 +0100
Subject: [rabbitmq-discuss] Help pinpointing an error
In-Reply-To: <4DFE1868-EFA4-4439-AE5B-00AF1FFED624@rabbitmq.com>
References: <50408550.8070801@beverlydata.com>
	<E7A072CA-7E70-4BCF-86C3-88366D9C268D@rabbitmq.com>
	<50408E62.7040602@rabbitmq.com> <5040A0DE.4020303@beverlydata.com>
	<4DFE1868-EFA4-4439-AE5B-00AF1FFED624@rabbitmq.com>
Message-ID: <3984CA9F-36F5-4137-9307-213020BBA7DA@rabbitmq.com>


On 31 Aug 2012, at 13:18, Tim Watson wrote:
>> 
> 
> Is that it? It seems like you've pasted only a subset of the log file, and I'd like to know a bit more about what was happening on both nodes when this occurs. Can we see the sasl logs for both nodes too please, and the output of `rabbitmqctl report` for both nodes?
> _

I mean for 'the node' not 'both nodes'. Also, what Erlang version are you using (what do you see when running `erl`) ?

> ______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/6c8d0967/attachment.htm>

From tim at rabbitmq.com  Fri Aug 31 13:40:41 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 Aug 2012 13:40:41 +0100
Subject: [rabbitmq-discuss] Help pinpointing an error
In-Reply-To: <3984CA9F-36F5-4137-9307-213020BBA7DA@rabbitmq.com>
References: <50408550.8070801@beverlydata.com>
	<E7A072CA-7E70-4BCF-86C3-88366D9C268D@rabbitmq.com>
	<50408E62.7040602@rabbitmq.com> <5040A0DE.4020303@beverlydata.com>
	<4DFE1868-EFA4-4439-AE5B-00AF1FFED624@rabbitmq.com>
	<3984CA9F-36F5-4137-9307-213020BBA7DA@rabbitmq.com>
Message-ID: <75E36AF0-8C51-466D-9EBD-800021DD24DB@rabbitmq.com>

Jaime,

I note that the Erlang release for Debian Stable is quite old (R14A) and that a couple of important bug fixes were made in ets since then:

- OTP-9181  ETS table type ordered_set could order large integer keys                wrongly on pure 64bit platforms. This is now corrected.  
- OTP-9281  ETS tables using the ordered_set option could potentially get           into an internally inconsistent state.

So I would strongly suggest upgrading to the latest Erlang (R15). The squeeze-backports repo has an 15B version, which should do nicely to remove this from the line up of potential causes.

Cheers,
Tim

On 31 Aug 2012, at 13:26, Tim Watson wrote:

> 
> On 31 Aug 2012, at 13:18, Tim Watson wrote:
>>> 
>> 
>> Is that it? It seems like you've pasted only a subset of the log file, and I'd like to know a bit more about what was happening on both nodes when this occurs. Can we see the sasl logs for both nodes too please, and the output of `rabbitmqctl report` for both nodes?
>> _
> 
> I mean for 'the node' not 'both nodes'. Also, what Erlang version are you using (what do you see when running `erl`) ?
> 
>> ______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/e9485418/attachment.htm>

From tim at rabbitmq.com  Fri Aug 31 15:50:30 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 Aug 2012 15:50:30 +0100
Subject: [rabbitmq-discuss] Rabbitmq server crash.
In-Reply-To: <C1CC286E-316B-405E-952B-09B18A095A20@rabbitmq.com>
References: <D12F6E1231346F43981ED423F3F82AEA041FB18779@MUM01EVS02.INDIATIMES.CO.IN>
	<C1CC286E-316B-405E-952B-09B18A095A20@rabbitmq.com>
Message-ID: <DD6D95D3-B7C2-4B17-8288-D311A7AC786B@rabbitmq.com>

Hi

On further investigation, this error condition (verified by the presence of '{mnesia_locker,rabbit at MyTimes160,granted}' in the gm process mailbox) is indeed the result of a netsplit. In RabbitMQ, clustering (and by association, HA/mirror queues) are not partition tolerant, and therefore netsplits *will* cause errors like this to occur. If you cannot rely on the network links between your clustered nodes then you should consider another approach to distribution, such as federation.

For more details about this, see the distribution guide (http://www.rabbitmq.com/distributed.html) and in particular note these comments from the 'Summary' section:

Federation / Shovel	Clustering

Chooses Availability and Partition Tolerance from the CAP theorem.         	 Chooses Consistency and Availability from the CAP theorem.         

So if you want Consistency (guarantees) and Availability, you should go with clustering and HA, but if you want Availability *and* Partition tolerance, then Clustering/HA is not the right setup for you. Also if this is happening once a month, then I'd suggest looking at what the network admin team is doing around that time, to see if some kit (or software) is being changed, reconfigured and/or taken offline for maintenance during this time period.

Cheers,
Tim 

On 31 Aug 2012, at 10:46, Tim Watson wrote:

> Hi
> 
> On 29 Aug 2012, at 13:12, Pankaj Mishra wrote:
> 
>> Hi,
>>  
>> We experienced a strange problem with rabbitmq server running in cluster. Actually according to
>> Log file the master of the server crashed. Post that all my publishers continue to send message without
>> Throwing any exception but all those messages were dropped silently by rabbitmq server. Consumer were not able
>> To get any of those messages until we restarted the rabbitmq server again.
>>  
>> I have attached with this mail the server crash log for master as well as for slave.
> 
> According to the master log, the mnesia database has become inconsistent, which is not a good sign. It looks very much like a network partition has occurred here:
> 
> %% from master.log
> 
> =INFO REPORT==== 7-Aug-2012::18:42:24 ===
> rabbit on node rabbit at MyTimes160 down
> 
> %% from slave.log
> 
> =INFO REPORT==== 7-Aug-2012::18:42:25 ===
> rabbit on node rabbit at MyTimes159 down
> 
> According to the logs, both the master and the slave observed the other node disappear, which seems consistent with the network partition theory.
> 
> %% from master.log
> 
> =INFO REPORT==== 7-Aug-2012::18:42:25 ===
> Mirrored-queue (queue 'cms' in vhost '/'): Master <rabbit at MyTimes159.3.444.0> saw deaths of mirrors <rabbit at MyTimes160.2.595.0> 
> 
> =INFO REPORT==== 7-Aug-2012::18:42:25 ===
> Mirrored-queue (queue 'mytimes' in vhost '/'): Master <rabbit at MyTimes159.3.437.0> saw deaths of mirrors <rabbit at MyTimes160.2.591.0> 
> 
> %% from slave.log
> 
> =INFO REPORT==== 7-Aug-2012::18:42:25 ===
> Mirrored-queue (queue 'mytimes' in vhost '/'): Slave <rabbit at MyTimes160.2.591.0> saw deaths of mirrors <rabbit at MyTimes159.3.437.0> 
> 
> =INFO REPORT==== 7-Aug-2012::18:42:25 ===
> Mirrored-queue (queue 'cms' in vhost '/'): Slave <rabbit at MyTimes160.2.595.0> saw deaths of mirrors <rabbit at MyTimes159.3.444.0> 
> 
> 
> Rabbit is not partition tolerant, so I would expect things might go wrong under such circumstances, but I would not expect messages to be silently dropped. My reading of the logs so far is that when the partitioned database state is reached, a message is sent to the gm ring on the 'master' node (the {mnesia_locker,rabbit at MyTimes160,granted} message) which isn't handled, thereby crashing the gm handling process. Once that is down, other things start to go wrong. The parent supervisor will have restarted the failed process to get things back into a consistent state, but it looks as though because mnesia has its knickers in a twist about the partitioned database, that the recovery can't take place properly.
> 
> We will look into this asap, but can you confirm that a net split did in fact take place around the time this problem started appearing?
>  
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/6ee2a9a2/attachment.htm>

From tim at rabbitmq.com  Fri Aug 31 17:15:56 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 Aug 2012 17:15:56 +0100
Subject: [rabbitmq-discuss] Pika 0.9.5 - How to handle Rabbit Stop ?
In-Reply-To: <9819C11BC6C68B4F820C87D7C7AC7A303C03DD0209@ESESSCMS0365.eemea.ericsson.se>
References: <9819C11BC6C68B4F820C87D7C7AC7A303C03DD0209@ESESSCMS0365.eemea.ericsson.se>
Message-ID: <B7119CF6-BEC0-4801-AA98-A5CAFC304F9B@rabbitmq.com>

Hi David,

What *kind* of adapter is this connection please? I know very little about Pika, but I can attempt to figure out what you *should* be doing to get the behaviour you want. But there's a big difference between the behaviours of say, the blocking versus the polling/select based adapters.

Cheers,
Tim 


On 29 Aug 2012, at 10:42, David Myllykangas wrote:

>  
> Hi
>  
> We are using Rabbit 2.8.5 and Pika 0.9.5 to process rabbit-queue from python.
>  
> If I am doing a 'rabbitctrl stop' to stop Rabbit Server, my python script hangs, and get uninteruptable.
>  
> This is the console output I get when I stop the Rabbit Server
>  
> Traceback (most recent call last):
>   File ".../pycims/queue.py", line 87, in start_consuming
>     connection.ioloop.start()
>   File ".../pika/adapters/select_connection.py", line 124, in start
>     self.poller.start()
>   File ".../pika/adapters/select_connection.py", line 374, in start
>     self.poll()
>   File ".../pika/adapters/select_connection.py", line 388, in poll
>     self._handler(events[0][0], events[0][1])
>   File ".../pika/adapters/base_connection.py", line 137, in _handle_events
>     self._handle_error(error)
>   File ".../pika/adapters/base_connection.py", line 106, in _handle_error
>     error_code = error[0]  # Python <= 2.5
> TypeError: 'NoneType' object is not subscriptable
>  
> This is the code; (I am expecting an Exception to be thrown on line 93, so I can handle the situation.) What am I doing wrong?
>  
> 86        try:
> 87            connection.ioloop.start()
> 88        except KeyboardInterrupt:
> 89            self.stop_consuming()
> 90            connection.ioloop.stop()
> 91            connection.close()
> 92            raise
> 93        except Exception, e:
> 94            print 'Exception %s' % str(e)
> 95            raise
>  
> Thanks,
> David
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/0ab34914/attachment.htm>

From tim at rabbitmq.com  Fri Aug 31 17:32:41 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 31 Aug 2012 17:32:41 +0100
Subject: [rabbitmq-discuss] rabbitmq - need assistance in planning
	correct recovery process
In-Reply-To: <CAJ2-Vrmjb1Qj0vzpAKFVticX_TZrzyU0zdYNP6ONFZgYnO0=pw@mail.gmail.com>
References: <CAJ2-Vrmjb1Qj0vzpAKFVticX_TZrzyU0zdYNP6ONFZgYnO0=pw@mail.gmail.com>
Message-ID: <621D05A5-6852-4A8D-B933-C85F03D5F29C@rabbitmq.com>

Hi

On 24 Aug 2012, at 12:02, Mysurf Mail wrote:

> Hi, 
> In My app I use rabbitmq in several ways. 
> I want to plan it so that when the rabbitmq restarts all the application will continue work normally.
> Here are my usage of rabbitmq
> 
> 1. Basic Publish / Basic subscribe
> 2. Rabbit RPC - cant survive restart
> 3. Queue delete - I get a tried to use closed channel when trying to delete a queue 
> 
> Does anyone have tips regarding how to do it ? 

Can you try and narrow this question down a bit. What exactly are you trying to do that is proving hard to implement? Is it the queue deletion that is causing a problem? What does your RabbitMQ setup look like and so on?


From nadeem.m.nayeck at gmail.com  Fri Aug 31 17:57:51 2012
From: nadeem.m.nayeck at gmail.com (Nadeem M Nayeck)
Date: Fri, 31 Aug 2012 20:57:51 +0400
Subject: [rabbitmq-discuss]  rabbitmq - simple message sending error
Message-ID: <CACYm6LZnE59FjkmrhnoAi1PY9ULcFaBw34ioB2zX74xFriM20g@mail.gmail.com>

hi guys
I wrote a simple java client  sending a message to a queue on Rabbit
I get this:


org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:331)
    at $Proxy9.queueDeclare(Unknown Source)
    at
org.springframework.amqp.rabbit.core.RabbitAdmin.declareQueues(RabbitAdmin.java:342)
    at
org.springframework.amqp.rabbit.core.RabbitAdmin.access$200(RabbitAdmin.java:46)
    at
org.springframework.amqp.rabbit.core.RabbitAdmin$11.doInRabbit(RabbitAdmin.java:312)
    at
org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:600)
    ... 41 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason: {#method<channel.close>(reply-code=406,
reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue
'ml2gos_events' in vhost 'OPLCPMED00': received none but current is the
value '86400000' of type 'long', class-id=50, method-id=10), null, ""}
    at
com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
    at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
    at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
    at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216)
    at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
    ... 53 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason: {#method<channel.close>(reply-code=406,
reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue
'ml2gos_events' in vhost 'OPLCPMED00': received none but current is the
value '86400000' of type 'long', class-id=50, method-id=10), null, ""}
    at com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:454)
    at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:294)
    at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144)
    at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:91)
    at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:519)



Any pointers?

regards,
Nadeem
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/0901c6e7/attachment.htm>

From markfisher at vmware.com  Fri Aug 31 18:15:00 2012
From: markfisher at vmware.com (Mark Fisher)
Date: Fri, 31 Aug 2012 10:15:00 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq - simple message sending error
In-Reply-To: <CACYm6LZnE59FjkmrhnoAi1PY9ULcFaBw34ioB2zX74xFriM20g@mail.gmail.com>
Message-ID: <1186315546.30048480.1346433300429.JavaMail.root@vmware.com>

The error message is showing that you are trying to declare a Queue where the value for 'x-message-ttl' does not match that of an existing Queue with the same name (' ml2gos_events') . 

----- Original Message -----

| From: "Nadeem M Nayeck" <nadeem.m.nayeck at gmail.com>
| To: "Discussions about RabbitMQ"
| <rabbitmq-discuss at lists.rabbitmq.com>
| Sent: Friday, August 31, 2012 12:57:51 PM
| Subject: [rabbitmq-discuss] rabbitmq - simple message sending error

| hi guys
| I wrote a simple java client sending a message to a queue on Rabbit
| I get this:

| org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:331)
| at $Proxy9.queueDeclare(Unknown Source)
| at
| org.springframework.amqp.rabbit.core.RabbitAdmin.declareQueues(RabbitAdmin.java:342)
| at
| org.springframework.amqp.rabbit.core.RabbitAdmin.access$200(RabbitAdmin.java:46)
| at
| org.springframework.amqp.rabbit.core.RabbitAdmin$11.doInRabbit(RabbitAdmin.java:312)
| at
| org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:600)
| ... 41 more
| Caused by: com.rabbitmq.client.ShutdownSignalException: channel
| error; reason: {#method<channel.close>(reply-code=406,
| reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for
| queue 'ml2gos_events' in vhost 'OPLCPMED00': received none but
| current is the value '86400000' of type 'long', class-id=50,
| method-id=10), null, ""}
| at
| com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
| at
| com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
| at
| com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
| at
| com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216)
| at
| com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
| ... 53 more
| Caused by: com.rabbitmq.client.ShutdownSignalException: channel
| error; reason: {#method<channel.close>(reply-code=406,
| reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for
| queue 'ml2gos_events' in vhost 'OPLCPMED00': received none but
| current is the value '86400000' of type 'long', class-id=50,
| method-id=10), null, ""}
| at com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:454)
| at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:294)
| at
| com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144)
| at
| com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:91)
| at
| com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:519)

| Any pointers?

| regards,
| Nadeem

| _______________________________________________
| rabbitmq-discuss mailing list
| rabbitmq-discuss at lists.rabbitmq.com
| https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/a6877cc8/attachment.htm>

From matthias.reik at gmail.com  Fri Aug 31 20:03:08 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Fri, 31 Aug 2012 21:03:08 +0200
Subject: [rabbitmq-discuss] rabbitmq - simple message sending error
In-Reply-To: <1186315546.30048480.1346433300429.JavaMail.root@vmware.com>
References: <CACYm6LZnE59FjkmrhnoAi1PY9ULcFaBw34ioB2zX74xFriM20g@mail.gmail.com>
	<1186315546.30048480.1346433300429.JavaMail.root@vmware.com>
Message-ID: <CAJ1JW0eAKUeq5NnfSMLchip-4=Mm6wETgKdMUybPt=gRR82hjw@mail.gmail.com>

Or to put it more simple:
If you already have a queue, and you try to declare it again (which is ok),
you will have to make sure that you declare it with the same parameters. As
your stack trace shows, and as Mark mentions, in your case the
x-message-ttl is the parameter that differs.

I want to take to use the occasion to ask a question in this context:
For most of the parameters this is a good approach, but for some parameters
this can be a bit annoying, especially for the HA feature, where you
specify over which servers a queue is distributed. For the TTL it's a bit
similar
At least I feel sometimes that it would be good if the queue parameters
could be adjusted at runtime, that the mirroring could be changed at
runtime, without clients requiring an update.
The current approach we have taken is that clients don't define the queues
anymore, but they are managed externally. Which is not ideal either :-( If
anyone has a good recommendation, ideas, ... I would be interested to hear
them

Cheers
Maze


On Fri, Aug 31, 2012 at 7:15 PM, Mark Fisher <markfisher at vmware.com> wrote:

> The error message is showing that you are trying to declare a Queue where
> the value for 'x-message-ttl' does not match that of an existing Queue with
> the same name ('ml2gos_events').
>
> ------------------------------
>
> *From: *"Nadeem M Nayeck" <nadeem.m.nayeck at gmail.com>
> *To: *"Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
> *Sent: *Friday, August 31, 2012 12:57:51 PM
> *Subject: *[rabbitmq-discuss]  rabbitmq - simple message sending error
>
>
> hi guys
> I wrote a simple java client  sending a message to a queue on Rabbit
> I get this:
>
>
>
> org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:331)
>     at $Proxy9.queueDeclare(Unknown Source)
>     at
> org.springframework.amqp.rabbit.core.RabbitAdmin.declareQueues(RabbitAdmin.java:342)
>     at
> org.springframework.amqp.rabbit.core.RabbitAdmin.access$200(RabbitAdmin.java:46)
>     at
> org.springframework.amqp.rabbit.core.RabbitAdmin$11.doInRabbit(RabbitAdmin.java:312)
>     at
> org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:600)
>     ... 41 more
> Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
> reason: {#method<channel.close>(reply-code=406,
> reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue
> 'ml2gos_events' in vhost 'OPLCPMED00': received none but current is the
> value '86400000' of type 'long', class-id=50, method-id=10), null, ""}
>     at
> com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
>     at
> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
>     at
> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
>     at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216)
>     at
> com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
>     ... 53 more
> Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
> reason: {#method<channel.close>(reply-code=406,
> reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue
> 'ml2gos_events' in vhost 'OPLCPMED00': received none but current is the
> value '86400000' of type 'long', class-id=50, method-id=10), null, ""}
>     at com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:454)
>     at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:294)
>     at
> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144)
>     at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:91)
>     at
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:519)
>
>
>
> Any pointers?
>
> regards,
> Nadeem
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/61303db3/attachment.htm>

From matthias at rabbitmq.com  Fri Aug 31 20:51:40 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 Aug 2012 20:51:40 +0100
Subject: [rabbitmq-discuss] rabbitmq - simple message sending error
In-Reply-To: <CAJ1JW0eAKUeq5NnfSMLchip-4=Mm6wETgKdMUybPt=gRR82hjw@mail.gmail.com>
References: <CACYm6LZnE59FjkmrhnoAi1PY9ULcFaBw34ioB2zX74xFriM20g@mail.gmail.com>
	<1186315546.30048480.1346433300429.JavaMail.root@vmware.com>
	<CAJ1JW0eAKUeq5NnfSMLchip-4=Mm6wETgKdMUybPt=gRR82hjw@mail.gmail.com>
Message-ID: <504115CC.9070701@rabbitmq.com>

Matthias,

On 31/08/12 20:03, Matthias Reik wrote:
> I want to take to use the occasion to ask a question in this context:
> For most of the parameters this is a good approach, but for some
> parameters this can be a bit annoying, especially for the HA feature,
> where you specify over which servers a queue is distributed.

We are planning to make HA configurable, and dynamically changeable, via 
server policies in a release in the not too distant future.

> For the TTL it's a bit similar

TTL would be hard to change dynamically, since that might result in 
messages at the tail of the queue expiring before messages at the head, 
which our queue logic does not permit.

Regards,

Matthias.

From matthias at rabbitmq.com  Fri Aug 31 21:00:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 31 Aug 2012 21:00:44 +0100
Subject: [rabbitmq-discuss] Startup error
In-Reply-To: <CAHFJS_Ufrrc4oU+qO_dWYo6J3zRUE7mz0krQbk42vy2hLAZU2Q@mail.gmail.com>
References: <CAHFJS_V69x7WmnE_XzFR+nPzfFXJdZhR02jpYAwT7vz1QokNoA@mail.gmail.com>
	<4FFAACB4.1070303@rabbitmq.com>
	<CAHFJS_Ufrrc4oU+qO_dWYo6J3zRUE7mz0krQbk42vy2hLAZU2Q@mail.gmail.com>
Message-ID: <504117EC.5090203@rabbitmq.com>

Micha?,

On 10/07/12 12:59, Micha? Ki?dy? wrote:
> 2012/7/9 Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>
>     On 09/07/12 08:54, Micha? Ki?dy? wrote:
>
>         What happened? IHMO It looks like management plugin problem.
>
>
>     Hi. Thanks for the bug report, I'll look into it. Does this happen
>     consistently? Is this in a cluster?
>
> Yes - this is part of a two-node server cluster.
> Does not start only when the rabbitmq_management plugin is enabled.

Did you manage to resolve this problem in the end?

Regards,

Matthias.

From Bin.Chen at kla-tencor.com  Fri Aug 31 22:57:27 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Fri, 31 Aug 2012 14:57:27 -0700
Subject: [rabbitmq-discuss] RabbitMQ crash due to out of memory
In-Reply-To: <503E5667.5010700@rabbitmq.com>
References: <BCC407A444557E41B0D8B0260D68499205566792@CA1EXCLV07.adcorp.kla-tencor.com>
	<503D317D.7050008@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205566958@CA1EXCLV07.adcorp.kla-tencor.com>
	<503E5667.5010700@rabbitmq.com>
Message-ID: <BCC407A444557E41B0D8B0260D68499205566EB9@CA1EXCLV07.adcorp.kla-tencor.com>

Hi Matthias,

I tried your code. Erl.exe crashed.
My other tests showed that the crash happened when size was more than
2040*1024*1024, a little bit smaller than 2GB.

There was result display error when size was more than 512 MB.

When size is smaller than 512 MB, the result was displayed as 
<<0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,...>>

We will switch to 64-bit later.

Thanks,
--Bin


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Wednesday, August 29, 2012 10:51 AM
To: Chen, Bin
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ crash due to out of memory

On 29/08/12 18:24, Chen, Bin wrote:
> My system is Windows 2008 Server 64-bit which has 24 GB RAM installed.
> Erlang is a 32-bit version.

Please switch to the 64-bit version.

> Since Erlang VM has /LARGEADDRESSAWARE flag set, which implies it can 
> use up to 4 GB on a 64-bit Windows, we increased HWM to 1.6 GB.

I am not convinced that is true. Please try the following:

- in a command shell run 'erl.exe'
- at the prompt, enter
      binary:copy(<<0>>, 1024*1024*1024*3).
   (including the final '.') and hit return.

That should churn away for a few seconds and eventually print

<<0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,...>>

If it dies instead then Erlang cannot use 4GB.


Regards,

Matthias.

From vaclav.matouch at gmail.com  Fri Aug 31 21:43:18 2012
From: vaclav.matouch at gmail.com (=?UTF-8?Q?V=C3=A1clav_Matouch?=)
Date: Fri, 31 Aug 2012 13:43:18 -0700 (PDT)
Subject: [rabbitmq-discuss] object not found in RabbitMQ admin panel
In-Reply-To: <4EB125F1.8070401@rabbitmq.com>
References: <15862270.2641.1320190071390.JavaMail.geo-discussion-forums@yqnv12>
	<4EB112F4.7080403@rabbitmq.com> <4EB125F1.8070401@rabbitmq.com>
Message-ID: <7df75fda-2977-4a72-9823-b6248a90bb0f@googlegroups.com>

The problem was the trailing slash. This worked for me:

    location /rabbit/ {
        proxy_pass              http://localhost:55672;
        proxy_set_header        Host $http_host;
        rewrite                 ^/rabbit/(.*)$ /$1 break;
    }

    location /rabbit {
        rewrite                 ^(.*)$ /rabbit/ permanent;
    }

Dne st?eda, 2. listopadu 2011 12:13:53 UTC+1 Simon MacMullen napsal(a):
>
> On 02/11/11 09:52, Emile Joubert wrote:
> > We don't have an equivalent nginx config, so it would be very useful if
> > you could confirm how to do that. Proxies must not canonicalise or
> > modify URLs.
>
> To be more specific, it's very common in the mgmt plugin to have URL 
> paths that look like
>
> /api/queues/%2f/myqueue
>
> We've seen Apache rewrite this as:
>
> /api/queues///myqueue
>
> which then doesn't work. To the best of my reading ability this violates 
> RFC 3986. Apache needs to be told "nocanon" in order not to do that - 
> nginx may also be similarly confused.
>
> If you turn on HTTP request logging (see 
> http://www.rabbitmq.com/management.html) you can see if nginx is doing 
> such rewriting.
>
> If you do get a working nginx config, please let us know and I'll add it 
> to the website.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/d093bb77/attachment.htm>

