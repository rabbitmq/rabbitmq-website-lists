<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Federation chokes on load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20chokes%20on%20load&In-Reply-To=%3CCAP0RBZUmGLeB_jAgn%3Dc_72%2B4HU6WioaBA8QfiOkpVrD%3DYvSsnw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034304.html">
   <LINK REL="Next"  HREF="034319.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Federation chokes on load</H1>
    <B>Patrik Ring</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20chokes%20on%20load&In-Reply-To=%3CCAP0RBZUmGLeB_jAgn%3Dc_72%2B4HU6WioaBA8QfiOkpVrD%3DYvSsnw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Federation chokes on load">patrik.ring at bloglovin.com
       </A><BR>
    <I>Tue Mar  4 22:06:35 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034304.html">[rabbitmq-discuss] Federation chokes on load
</A></li>
        <LI>Next message: <A HREF="034319.html">[rabbitmq-discuss] Federation chokes on load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34312">[ date ]</a>
              <a href="thread.html#34312">[ thread ]</a>
              <a href="subject.html#34312">[ subject ]</a>
              <a href="author.html#34312">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rabbit version in use is: RabbitMQ 3.2.1, Erlang R14B04

rabbitmqctl report on
upstream: <A HREF="http://pastebin.com/PNqTziGk">http://pastebin.com/PNqTziGk</A>
&quot;slave&quot; server: <A HREF="http://pastebin.com/4L6JFsiW">http://pastebin.com/4L6JFsiW</A>

*I have this in the exchanges list on the upstream:*

 federation: users -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3.c.rabbit-magic.internal</A>
B&lt;<A HREF="http://rabbit1:15672/#/exchanges/%2F/federation%3A%20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal%20B">http://rabbit1:15672/#/exchanges/%2F/federation%3A%20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal%20B</A>&gt;
x-federation-upstream ha-all D AD I Args


And this i the queues list:

 federation: users -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3.c.rabbit-magic.internal</A>&lt;<A HREF="http://rabbit1:15672/#/queues/%2F/federation%3A%20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal">http://rabbit1:15672/#/queues/%2F/federation%3A%20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal</A>&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util1</A> +1  Exp D Args
*For the slave:*

*Nothing.* Except on channels, where I find this:

 &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3.3.237.0</A>&gt;
(1)&lt;<A HREF="http://162.222.179.163:15672/#/channels/%3Crabbit%40rabbit3.3.237.0%3E%20(1">http://162.222.179.163:15672/#/channels/%3Crabbit%40rabbit3.3.237.0%3E%20(1</A>)&gt;federation


Feel like we might be on to something?

How do I set this up?



As a side note: The queues and exchanges on the upstream might still be
there since when we tried making it run both ways, not sure about this. We
do however have the federation status on the SLAVE, and according to that
it's up and running.


Best regards
Patrik Ring

Co-founder and CTO of Bloglovin.com
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">patrik.ring at bloglovin.com</A>
+46 730 59 78 14
+1 347 859 7999


On Tue, Mar 4, 2014 at 12:56 PM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hi Patrik.
</I>&gt;<i>
</I>&gt;<i> On 03/03/14 21:41, Patrik Ring wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Some messages come through (but are heavily delayed, as in hours) but
</I>&gt;&gt;<i> they seem completely random.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That's definitely not right!
</I>&gt;<i>
</I>&gt;<i> First of all, could you send the output of &quot;rabbitmqctl report&quot; for each
</I>&gt;<i> broker?
</I>&gt;<i>
</I>&gt;<i> Also, which version of RabbitMQ are you using?
</I>&gt;<i>
</I>&gt;<i> Secondly, you might want to investigate whether the underlying
</I>&gt;<i> infrastructure used by federation is wired up correctly. There should be a
</I>&gt;<i> queue for each (exchange, downstream) pairing declared in the upstream
</I>&gt;<i> broker (called &quot;federation: [exchange] -&gt; [node]&quot;). It should be bound
</I>&gt;<i> (once) to an internal exchange with a similar name. That internal exchange
</I>&gt;<i> should be bound to the upstream exchange with all the bindings that are in
</I>&gt;<i> use downstream.
</I>&gt;<i>
</I>&gt;<i> Does it look like that is happening? Is the infrastructure queue seeing
</I>&gt;<i> the message rates you would expect?
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/53213e5a/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/53213e5a/attachment.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034304.html">[rabbitmq-discuss] Federation chokes on load
</A></li>
	<LI>Next message: <A HREF="034319.html">[rabbitmq-discuss] Federation chokes on load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34312">[ date ]</a>
              <a href="thread.html#34312">[ thread ]</a>
              <a href="subject.html#34312">[ subject ]</a>
              <a href="author.html#34312">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
