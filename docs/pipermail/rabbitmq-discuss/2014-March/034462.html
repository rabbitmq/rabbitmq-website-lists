<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] OOM kill
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20OOM%20kill&In-Reply-To=%3C531D9B64.3020308%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034392.html">
   <LINK REL="Next"  HREF="034465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] OOM kill</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20OOM%20kill&In-Reply-To=%3C531D9B64.3020308%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] OOM kill">simon at rabbitmq.com
       </A><BR>
    <I>Mon Mar 10 11:00:52 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034392.html">[rabbitmq-discuss] OOM kill
</A></li>
        <LI>Next message: <A HREF="034465.html">[rabbitmq-discuss] OOM kill
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34462">[ date ]</a>
              <a href="thread.html#34462">[ thread ]</a>
              <a href="subject.html#34462">[ subject ]</a>
              <a href="author.html#34462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/03/2014 11:17AM, Dmitry Andrianov wrote:
&gt;<i> When you say Rabbit will gracefully stop accepting connections when
</I>&gt;<i> ulimit is reached, are you talking about some action explicitly done
</I>&gt;<i> by Rabbit itself when it sees limit approaching or is everything done
</I>&gt;<i> by the OS?
</I>
It's dome by RabbitMQ explicitly - since FDs are shared across sockets 
and files we don't want to hit the OS FD limit in the middle of a file 
operation, so we stop accepting new connections before that happens.

&gt;<i> If Rabbit does something - doesn't it make sense to do the same when
</I>&gt;<i> memory is running low?
</I>
Again, as mentioned, if we did that and memory had filled up with 
messages we might hit a situation where progress is impossible - the 
broker is full of messages but clients can't connect to consume them.

&gt;<i> i will of course follow your advice and play with ulimit but it does
</I>&gt;<i> not feel very reliable - even if I find ulimit value which works in
</I>&gt;<i> that specific test case, it may stop working when message size
</I>&gt;<i> changes.
</I>
Well, the memory alarm system is agnostic to how many messages are in 
the broker and what proportion of available memory they use. You just 
need to set your ulimit low enough that you can't cause the memory limit 
to be breached purely with connections.

&gt;<i> Regarding plugin memory - it worth mentioning that we have couple of
</I>&gt;<i> custom plugins including a custom authentication backend. Can these
</I>&gt;<i> be the root cause? Is there anything that needs to be explicitly done
</I>&gt;<i> by the plugin developer to make sure the memory is accounted
</I>&gt;<i> correctly?
</I>
There shouldn't be, no. But thanks for that information; I will be 
investigating this today and it might prove useful.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034392.html">[rabbitmq-discuss] OOM kill
</A></li>
	<LI>Next message: <A HREF="034465.html">[rabbitmq-discuss] OOM kill
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34462">[ date ]</a>
              <a href="thread.html#34462">[ thread ]</a>
              <a href="subject.html#34462">[ subject ]</a>
              <a href="author.html#34462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
