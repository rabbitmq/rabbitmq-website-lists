<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Broken 3 node cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Broken%203%20node%20cluster&In-Reply-To=%3CCAFtA53xDY04i4NwprFZztNJb4bWVKrYnMrF_Jm4RNnRxVVUwhA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034620.html">
   <LINK REL="Next"  HREF="034626.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Broken 3 node cluster</H1>
    <B>Ron Cordell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Broken%203%20node%20cluster&In-Reply-To=%3CCAFtA53xDY04i4NwprFZztNJb4bWVKrYnMrF_Jm4RNnRxVVUwhA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Broken 3 node cluster">ron.cordell at gmail.com
       </A><BR>
    <I>Mon Mar 17 16:58:17 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034620.html">[rabbitmq-discuss] Broken 3 node cluster
</A></li>
        <LI>Next message: <A HREF="034626.html">[rabbitmq-discuss] Bugs in RabbitMQ WCF Library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34625">[ date ]</a>
              <a href="thread.html#34625">[ thread ]</a>
              <a href="subject.html#34625">[ subject ]</a>
              <a href="author.html#34625">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We experienced almost exactly similar symptoms when we first started
working with RabbitMQ clusters. We checked everything - network, switches,
load balancer, application code. The cluster was always unstable in the way
that you describe. We brought Pivotal Labs in to do some deep dives to see
if they could help - from what they told us we weren't doing anything
incorrectly. We tried various combinations of RabbitMQ releases and Erlang
releases as well.

We put together a Linux-based cluster and never had a problem with it.
Solid as a rock and significantly more throughput. We put our Windows
cluster in a non-load balanced, two node active/passive type of
configuration. Most of our queues are mirrored/highly available and there
are a couple hundred of them. We need to be assured that we wouldn't lose
messages, so we came up with this &quot;limp mode&quot; to get us into production at
low message volumes until we could solidify our ops teams around Linux. We
are now replacing the Windows &quot;clusters&quot; with real 3-node, load balanced
Linux clusters. All of our performance testing has shown them to be
completely solid. No weird cluster node states or anything like that.

This is not a &quot;Linux us better than Windows&quot; diatribe. We have been a
completely Windows shop until now and we decided to incur the cost of
operationalizing Linux in our infrastructure because RabbitMQ is a key
component. Our measurements and observations told us that if we want to run
a high throughput, stable, Rabbit cluster with mostly mirrored queues it
would have to be on Linux.

-Ron


On Mon, Mar 17, 2014 at 4:50 AM, Patrick Long &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pat at munkiisoft.com</A>&gt; wrote:

&gt;<i> RABBITMQ 3.2.1 on Windows Server 2003
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Came into work this morning to find a suspected Network partition on a 3
</I>&gt;<i> node cluster
</I>&gt;<i>
</I>&gt;<i> Node 3 and Node 2 said Node 1 was down
</I>&gt;<i>
</I>&gt;<i> Node 1 said 2 and 3 were down
</I>&gt;<i>
</I>&gt;<i> Tried stop_app on Node 1 but it hung stop_app on Nodes 2 and 3 were fine.
</I>&gt;<i>
</I>&gt;<i> All 3 nodes hang on start_app
</I>&gt;<i>
</I>&gt;<i> Tried restarting Windows service. Nodes 2 and 3 come back and are clustered
</I>&gt;<i>
</I>&gt;<i> Node 1 will not start. In the end I removed all contents of the db
</I>&gt;<i> directory. Not it starts up.
</I>&gt;<i>
</I>&gt;<i> I want to rejoin the cluster but it says it is already a member although
</I>&gt;<i> cluster_status says otherwise.
</I>&gt;<i>
</I>&gt;<i> I have tried forget_cluster_node from one of the running nodes but that
</I>&gt;<i> hangs
</I>&gt;<i>
</I>&gt;<i> Anyone any ideas?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Patrick Long - Munkiisoft Ltd
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/a78a3b8b/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/a78a3b8b/attachment.html</A>&gt;
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034620.html">[rabbitmq-discuss] Broken 3 node cluster
</A></li>
	<LI>Next message: <A HREF="034626.html">[rabbitmq-discuss] Bugs in RabbitMQ WCF Library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34625">[ date ]</a>
              <a href="thread.html#34625">[ thread ]</a>
              <a href="subject.html#34625">[ subject ]</a>
              <a href="author.html#34625">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
