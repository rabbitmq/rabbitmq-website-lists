<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] System.OutOfMemoryException
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20System.OutOfMemoryException&In-Reply-To=%3C5321E924.90908%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034564.html">
   <LINK REL="Next"  HREF="034566.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] System.OutOfMemoryException</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20System.OutOfMemoryException&In-Reply-To=%3C5321E924.90908%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] System.OutOfMemoryException">simon at rabbitmq.com
       </A><BR>
    <I>Thu Mar 13 17:21:40 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034564.html">[rabbitmq-discuss] System.OutOfMemoryException
</A></li>
        <LI>Next message: <A HREF="034566.html">[rabbitmq-discuss] System.OutOfMemoryException
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34565">[ date ]</a>
              <a href="thread.html#34565">[ thread ]</a>
              <a href="subject.html#34565">[ subject ]</a>
              <a href="author.html#34565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am no .net expert but my guess might be that you have too many threads 
(i.e. possibly too many connections).

Each thread needs to reserve a certain amount of memory in the process 
address space; too many threads (especially on a 32 bit process) can 
exhaust the address space before you come anywhere near running out of 
actual committed memory.

Cheers, Simon

On 13/03/14 17:07, Phil Marino wrote:
&gt;<i> Hi - we're running RabbitMQ 3.1.3 on Windows Server 2008 R2, using the
</I>&gt;<i> .Net Rabbit client library.
</I>&gt;<i> We're troubleshooting a distributed transaction problem involving
</I>&gt;<i> Oracle.  But when this problem happens, we also see thes from Rabbit:
</I>&gt;<i> 2014-03-13 12:27:12,706 [1237] ERROR Services.Messaging.MessageService
</I>&gt;<i> :: (null) &gt; MessageTransaction.Prepared Failed: None of the specified
</I>&gt;<i> endpoints were reachable
</I>&gt;<i> Endpoints attempted:
</I>&gt;<i> ------------------------------------------------
</I>&gt;<i> endpoint=amqp-0-9://localhost:5672, attempts=1
</I>&gt;<i> System.OutOfMemoryException: Exception of type
</I>&gt;<i> 'System.OutOfMemoryException' was thrown.
</I>&gt;<i>     at System.Threading.Thread.StartInternal(IPrincipal principal,
</I>&gt;<i> StackCrawlMark&amp; stackMark)
</I>&gt;<i>     at System.Threading.Thread.Start(StackCrawlMark&amp; stackMark)
</I>&gt;<i>     at System.Threading.Thread.Start()
</I>&gt;<i>     at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
</I>&gt;<i>     at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory
</I>&gt;<i> factory, Boolean insist, IFrameHandler frameHandler)
</I>&gt;<i>     at
</I>&gt;<i> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory
</I>&gt;<i> factory, Boolean insist, IFrameHandler frameHandler)
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
</I>&gt;<i> maxRedirects, IDictionary connectionAttempts, IDictionary
</I>&gt;<i> connectionErrors, AmqpTcpEndpoint[]&amp; mostRecentKnownHosts,
</I>&gt;<i> AmqpTcpEndpoint endpoint)
</I>&gt;<i> ================================================
</I>&gt;<i> Stack trace:
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
</I>&gt;<i> maxRedirects)
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
</I>&gt;<i>     at
</I>&gt;<i> Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment
</I>&gt;<i> preparingEnlistment) in
</I>&gt;<i> h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line
</I>&gt;<i> 208
</I>&gt;<i> and
</I>&gt;<i> 2014-03-13 12:27:12,722 [1237] ERROR
</I>&gt;<i> System.ServiceModel.Diagnostics.DiagnosticTrace :: TraceEvent &gt;
</I>&gt;<i> &lt;TraceRecord
</I>&gt;<i> xmlns=&quot;<A HREF="http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord">http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord</A>&quot;
</I>&gt;<i> Severity=&quot;Error&quot;&gt;&lt;TraceIdentifier&gt;<A HREF="http://msdn.microsoft.com/en-US/library/System.ServiceModel.Diagnostics.TraceHandledException.aspx&lt;/TraceIdentifier">http://msdn.microsoft.com/en-US/library/System.ServiceModel.Diagnostics.TraceHandledException.aspx&lt;/TraceIdentifier</A>&gt;&lt;Description&gt;Handling
</I>&gt;<i> an
</I>&gt;<i> exception.&lt;/Description&gt;&lt;AppDomain&gt;/LM/W3SVC/3/ROOT/services.messaging1.0-1-130391077949327736&lt;/AppDomain&gt;&lt;Exception&gt;&lt;ExceptionType&gt;System.Transactions.TransactionAbortedException,
</I>&gt;<i> System.Transactions, Version=4.0.0.0, Culture=neutral,
</I>&gt;<i> PublicKeyToken=b77a5c561934e089&lt;/ExceptionType&gt;&lt;Message&gt;The transaction
</I>&gt;<i> has aborted.&lt;/Message&gt;&lt;StackTrace&gt;   at
</I>&gt;<i> System.Transactions.TransactionStateAborted.EndCommit(InternalTransaction tx)
</I>&gt;<i>     at System.Transactions.CommittableTransaction.Commit()
</I>&gt;<i>     at
</I>&gt;<i> System.ServiceModel.Dispatcher.TransactionInstanceContextFacet.Complete(Transaction
</I>&gt;<i> transaction, Exception
</I>&gt;<i> error)&lt;/StackTrace&gt;&lt;ExceptionString&gt;System.Transactions.TransactionAbortedException:
</I>&gt;<i> The transaction has aborted. ---&amp;gt;
</I>&gt;<i> RabbitMQ.Client.Exceptions.BrokerUnreachableException: None of the
</I>&gt;<i> specified endpoints were reachable
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
</I>&gt;<i> maxRedirects)
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
</I>&gt;<i>     at
</I>&gt;<i> Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment
</I>&gt;<i> preparingEnlistment) in
</I>&gt;<i> h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line
</I>&gt;<i> 208
</I>&gt;<i>     --- End of inner exception stack trace ---
</I>&gt;<i>     at
</I>&gt;<i> System.Transactions.TransactionStateAborted.EndCommit(InternalTransaction tx)
</I>&gt;<i>     at System.Transactions.CommittableTransaction.Commit()
</I>&gt;<i>     at
</I>&gt;<i> System.ServiceModel.Dispatcher.TransactionInstanceContextFacet.Complete(Transaction
</I>&gt;<i> transaction, Exception
</I>&gt;<i> error)&lt;/ExceptionString&gt;&lt;InnerException&gt;&lt;ExceptionType&gt;RabbitMQ.Client.Exceptions.BrokerUnreachableException,
</I>&gt;<i> RabbitMQ.Client, Version=2.8.7.0, Culture=neutral,
</I>&gt;<i> PublicKeyToken=89e7d7c5feba84ce&lt;/ExceptionType&gt;&lt;Message&gt;None of the
</I>&gt;<i> specified endpoints were reachable&lt;/Message&gt;&lt;StackTrace&gt;   at
</I>&gt;<i> RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
</I>&gt;<i>     at
</I>&gt;<i> Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment
</I>&gt;<i> preparingEnlistment) in
</I>&gt;<i> h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line
</I>&gt;<i> 208&lt;/StackTrace&gt;&lt;ExceptionString&gt;None of the specified endpoints were
</I>&gt;<i> reachable
</I>&gt;<i> Endpoints attempted:
</I>&gt;<i> ------------------------------------------------
</I>&gt;<i> endpoint=amqp-0-9://localhost:5672, attempts=1
</I>&gt;<i> System.OutOfMemoryException: Exception of type
</I>&gt;<i> 'System.OutOfMemoryException' was thrown.
</I>&gt;<i>     at System.Threading.Thread.StartInternal(IPrincipal principal,
</I>&gt;<i> StackCrawlMark&amp;amp; stackMark)
</I>&gt;<i>     at System.Threading.Thread.Start(StackCrawlMark&amp;amp; stackMark)
</I>&gt;<i>     at System.Threading.Thread.Start()
</I>&gt;<i>     at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
</I>&gt;<i>     at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory
</I>&gt;<i> factory, Boolean insist, IFrameHandler frameHandler)
</I>&gt;<i>     at
</I>&gt;<i> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory
</I>&gt;<i> factory, Boolean insist, IFrameHandler frameHandler)
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
</I>&gt;<i> maxRedirects, IDictionary connectionAttempts, IDictionary
</I>&gt;<i> connectionErrors, AmqpTcpEndpoint[]&amp;amp; mostRecentKnownHosts,
</I>&gt;<i> AmqpTcpEndpoint endpoint)
</I>&gt;<i> ================================================
</I>&gt;<i> Stack trace:
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
</I>&gt;<i> maxRedirects)
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
</I>&gt;<i>     at
</I>&gt;<i> Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment
</I>&gt;<i> preparingEnlistment) in
</I>&gt;<i> h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line
</I>&gt;<i> 208&lt;/ExceptionString&gt;&lt;DataItems&gt;&lt;Data&gt;&lt;Key&gt;amqp-0-9://localhost:5672&lt;/Key&gt;&lt;Value&gt;System.OutOfMemoryException:
</I>&gt;<i> Exception of type 'System.OutOfMemoryException' was thrown.
</I>&gt;<i>     at System.Threading.Thread.StartInternal(IPrincipal principal,
</I>&gt;<i> StackCrawlMark&amp;amp; stackMark)
</I>&gt;<i>     at System.Threading.Thread.Start(StackCrawlMark&amp;amp; stackMark)
</I>&gt;<i>     at System.Threading.Thread.Start()
</I>&gt;<i>     at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
</I>&gt;<i>     at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory
</I>&gt;<i> factory, Boolean insist, IFrameHandler frameHandler)
</I>&gt;<i>     at
</I>&gt;<i> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory
</I>&gt;<i> factory, Boolean insist, IFrameHandler frameHandler)
</I>&gt;<i>     at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
</I>&gt;<i> maxRedirects, IDictionary connectionAttempts, IDictionary
</I>&gt;<i> connectionErrors, AmqpTcpEndpoint[]&amp;amp; mostRecentKnownHosts,
</I>&gt;<i> AmqpTcpEndpoint
</I>&gt;<i> endpoint)&lt;/Value&gt;&lt;/Data&gt;&lt;/DataItems&gt;&lt;/InnerException&gt;&lt;/Exception&gt;&lt;/TraceRecord&gt;
</I>&gt;<i> I will say that the server appears to have plenty of RAM available.
</I>&gt;<i> I'm sure that I don't have enough information to identify what's
</I>&gt;<i> happening, so one question I have is: what else do I need?
</I>&gt;<i> It looks like we're trying to enlist in an aborted transaction, but I'm
</I>&gt;<i> not sure why the Out Of Memory exception is thrown.  Any suggestions?
</I>&gt;<i> Thanks,
</I>&gt;<i> Phil
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034564.html">[rabbitmq-discuss] System.OutOfMemoryException
</A></li>
	<LI>Next message: <A HREF="034566.html">[rabbitmq-discuss] System.OutOfMemoryException
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34565">[ date ]</a>
              <a href="thread.html#34565">[ thread ]</a>
              <a href="subject.html#34565">[ subject ]</a>
              <a href="author.html#34565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
