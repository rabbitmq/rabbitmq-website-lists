<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Writing custom exchange type plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Writing%20custom%20exchange%20type%20plugin&In-Reply-To=%3CCAKgmDnGwT6evwWbokWLbQ_CYTKdBj_6pmmtN7ewnW64iUhPV-w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034739.html">
   <LINK REL="Next"  HREF="034728.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Writing custom exchange type plugin</H1>
    <B>Laing, Michael</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Writing%20custom%20exchange%20type%20plugin&In-Reply-To=%3CCAKgmDnGwT6evwWbokWLbQ_CYTKdBj_6pmmtN7ewnW64iUhPV-w%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Writing custom exchange type plugin">michael.laing at nytimes.com
       </A><BR>
    <I>Tue Mar 25 10:12:16 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034739.html">[rabbitmq-discuss] Writing custom exchange type plugin
</A></li>
        <LI>Next message: <A HREF="034728.html">[rabbitmq-discuss] rabbitmq crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34770">[ date ]</a>
              <a href="thread.html#34770">[ thread ]</a>
              <a href="subject.html#34770">[ subject ]</a>
              <a href="author.html#34770">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We implement our nyt&#10765;a&#1073;rik system as a collection of vhost nodes. The
vhosts are named according to a set of rules: role, region, product,
organization, environment (dev, stage, production), etc.

The vhosts are multiply connected via shovels and federation.

The mapping of vhosts to hosts varies. For example, in production we
usually run 1 vhost per host spread across many regions/zones in the cloud.
For dev, I can run the exact same configuration on my mac using a single
cluster with vhosts representing all the roles, regions, etc.

The point with regard to the OP is that you can architect using multiple
vhosts, and there can be benefits, as we realize. But you should consider
the separation Simon referred to as a virtue, using it to maintain a
flexible and reliable arrangement of loosely coupled strong components.

Best regards,

Michael


On Mon, Mar 24, 2014 at 6:53 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 22/03/2014 11:33PM, Adam Smith wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>    I want to write a custom exchange type plugin to accomplish the
</I>&gt;&gt;<i> following:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. My application publishes messages to a custom exchange CUST in vhost
</I>&gt;&gt;<i> MYAPP
</I>&gt;&gt;<i> 2. The custom exchange plugin in turn publishes the same message to
</I>&gt;&gt;<i>          a. exchange X in vhost CL1
</I>&gt;&gt;<i>          b. exchange X in vhost CL2
</I>&gt;&gt;<i>          .....
</I>&gt;&gt;<i> The number of CLx vhosts can vary at different points in the
</I>&gt;&gt;<i> application's lifetime. Any pointers on how/whether it can done would be
</I>&gt;&gt;<i> greatly appreciated.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It can be done, since rabbit_exchange_type:route/2 returns a list of
</I>&gt;<i> #resource{}s for the queue names to route to - and each #resource{}
</I>&gt;<i> contains a virtual host. So you could mess with virtual hosts according to
</I>&gt;<i> whatever logic you want in that function.
</I>&gt;<i>
</I>&gt;<i> However (and it's quite a big however), RabbitMQ (and AMQP) are definitely
</I>&gt;<i> not designed to work like that. Each virtual host is supposed to be a
</I>&gt;<i> self-contained universe, so by routing across virtual hosts you are
</I>&gt;<i> breaking the rules.
</I>&gt;<i>
</I>&gt;<i> Some issues you will experience (I won't guarantee that this is a complete
</I>&gt;<i> list):
</I>&gt;<i>
</I>&gt;<i> 1) You won't be allowed to establish a cross-vhost binding, so you'll have
</I>&gt;<i> to determine how cross-vhost routing works in practice without reference to
</I>&gt;<i> bindings.
</I>&gt;<i>
</I>&gt;<i> 2) The permissions system won't take any account of any cross-vhost
</I>&gt;<i> routing you do.
</I>&gt;<i>
</I>&gt;<i> 3) Message rates in the management plugin might be garbled.
</I>&gt;<i>
</I>&gt;<i> 4) Future changes to the broker might break this completely (for example,
</I>&gt;<i> if we ever move to per-vhost message stores). No such changes are currently
</I>&gt;<i> on our radar though.
</I>&gt;<i>
</I>&gt;<i> So this is very much &quot;at your own risk&quot;. Virtual hosts are *designed* to
</I>&gt;<i> keep things completely separate, so if you want to route messages between
</I>&gt;<i> them then maybe your design should be rethought.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/82c230d3/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/82c230d3/attachment.html</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034739.html">[rabbitmq-discuss] Writing custom exchange type plugin
</A></li>
	<LI>Next message: <A HREF="034728.html">[rabbitmq-discuss] rabbitmq crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34770">[ date ]</a>
              <a href="thread.html#34770">[ thread ]</a>
              <a href="subject.html#34770">[ subject ]</a>
              <a href="author.html#34770">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
