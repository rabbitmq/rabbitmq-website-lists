<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] : Delayed processing of data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%3A%20Delayed%20processing%20of%20data&In-Reply-To=%3CCAKgmDnHYH%2B2Yi%3DrotT1qFmt_SboLhTOKTVC9iL50sE9UjoKSDQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034703.html">
   <LINK REL="Next"  HREF="034620.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] : Delayed processing of data</H1>
    <B>Laing, Michael</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%3A%20Delayed%20processing%20of%20data&In-Reply-To=%3CCAKgmDnHYH%2B2Yi%3DrotT1qFmt_SboLhTOKTVC9iL50sE9UjoKSDQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] : Delayed processing of data">michael.laing at nytimes.com
       </A><BR>
    <I>Sun Mar 23 00:48:43 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034703.html">[rabbitmq-discuss] : Delayed processing of data
</A></li>
        <LI>Next message: <A HREF="034620.html">[rabbitmq-discuss] Broken 3 node cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34726">[ date ]</a>
              <a href="thread.html#34726">[ thread ]</a>
              <a href="subject.html#34726">[ subject ]</a>
              <a href="author.html#34726">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You can try this:

Lets say you can work on 1 minute boundaries - that's what we do.

When you have a message you want to delay to exchange E, calculate: 1) the
datetime DT to the minute at which you want it released; 2) the
corresponding number of milliseconds MS from now.

Declare a queue QDT with a name incorporating DT and a dead letter exchange
of E. If there is already a queue with that name and exact parameters it's
OK - queue declarations are idempotent so you will neither get a redundant
queue nor will you get an error if it already exists.

Publish your message to queue QDT with an expiry of MS.

At DT (or close enough) the message expirations will take effect and the
messages will be released in queued order to exchange E.

You can use a policy to delete queue QDT.

Hope that helps!

ml


On Fri, Mar 21, 2014 at 6:57 AM, Daniel McGreal &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">daniel at redbite.com</A>&gt; wrote:

&gt;<i> Ah, I see the problem in the Caveats&lt;<A HREF="http://www.rabbitmq.com/ttl.html#per-message-ttl-caveats">http://www.rabbitmq.com/ttl.html#per-message-ttl-caveats</A>&gt;
</I>&gt;<i> .
</I>&gt;<i>
</I>&gt;<i> On 21 Mar 2014, at 10:49, Daniel McGreal wrote:
</I>&gt;<i>
</I>&gt;<i> I'm not familiar with all aspect of the process, but couldn't you set a
</I>&gt;<i> TTL on the message, not the queue?
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/ttl.html#per-message-ttl">http://www.rabbitmq.com/ttl.html#per-message-ttl</A>
</I>&gt;<i> With no consumers on this queue it ends up in ultimately it will be dead
</I>&gt;<i> lettered to an exchange/queue/consumer setup where your actual processing
</I>&gt;<i> happens, i.e. there was at least the specified delay in processing
</I>&gt;<i> customisable per message?
</I>&gt;<i>
</I>&gt;<i> On 21 Mar 2014, at 10:22, Ajinkya Apte wrote:
</I>&gt;<i>
</I>&gt;<i>  Thanks for the reply.  So the only problem I see with what I want to do
</I>&gt;<i> and with whats available in RabbitMQ is I will have to time slice and
</I>&gt;<i> create multiple queues.
</I>&gt;<i> For example:
</I>&gt;<i> One queue with a timeout of 5 min, the other 10 min. Then according to the
</I>&gt;<i> delay time just put incoming data into the proper queue.
</I>&gt;<i> The down side I can see is that new data that will be thrown in a queue
</I>&gt;<i> with say a 10 min timeout, will be theoretically processed anywhere between
</I>&gt;<i> 1-10 mins. I cannot kinda guarantee that the data will be handled only
</I>&gt;<i> after 10 mins.
</I>&gt;<i>
</I>&gt;<i>  Does this make sense to you?
</I>&gt;<i>
</I>&gt;<i>  Do you create a new queue per request coming in, depending on a the
</I>&gt;<i> delay?
</I>&gt;<i>
</I>&gt;<i>  AJ
</I>&gt;<i>
</I>&gt;<i>   From: &lt;Laing&gt;, Michael &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.laing at nytimes.com</A>&gt;
</I>&gt;<i> Reply-To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> Date: Thursday, March 20, 2014 6:36 PM
</I>&gt;<i> To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] : Delayed processing of data
</I>&gt;<i>
</I>&gt;<i>   We currently use TTLs and Dead Letter Exchanges to accomplish this.
</I>&gt;<i>
</I>&gt;<i>  An app we call Route looks at messages and either:
</I>&gt;<i>
</I>&gt;<i>    1. sends them to an exchange called Distribute, or
</I>&gt;<i>    2. declares a queue with a name reflecting the embargo datetime and a
</I>&gt;<i>    DLX of Distribute and sends the message to it with a TTL calculated to
</I>&gt;<i>    release at that datetime.
</I>&gt;<i>
</I>&gt;<i> This works fine. You can dynamically set a policy to delete the queue.
</I>&gt;<i>
</I>&gt;<i>  Probably we will move away from this in the next few months simply
</I>&gt;<i> because we wish to persist as little as possible in rabbitmq. But it is
</I>&gt;<i> quite simple and functional.
</I>&gt;<i>
</I>&gt;<i>  ml
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Mar 20, 2014 at 2:11 PM, Ajinkya Apte &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aapte at zynga.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>  Hey guys,
</I>&gt;&gt;<i> I want to delay the processing of some data coming into a queue. The data
</I>&gt;&gt;<i> has delayTime associated with it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  What I want to do?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    1. Data is coming in with a delayTime associated with it.
</I>&gt;&gt;<i>    2. Some data can come with the delayTime=5 mintes from now, some data
</I>&gt;&gt;<i>    with delayTime=10 and so on. This delayTime can be anything.
</I>&gt;&gt;<i>    3. I want to delay the processing of this data.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Questions?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    1. From the documentation seems like using message TTL won't be the
</I>&gt;&gt;<i>    way to go, right?
</I>&gt;&gt;<i>    2. Will I have to use the 'Dead Letter Exchanges' concept along with
</I>&gt;&gt;<i>    multiple retry queues having different timeouts?
</I>&gt;&gt;<i>    3. Any other suggestions?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Please let me know.
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  AJ
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>    _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140322/dedf69ed/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140322/dedf69ed/attachment.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034703.html">[rabbitmq-discuss] : Delayed processing of data
</A></li>
	<LI>Next message: <A HREF="034620.html">[rabbitmq-discuss] Broken 3 node cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34726">[ date ]</a>
              <a href="thread.html#34726">[ thread ]</a>
              <a href="subject.html#34726">[ subject ]</a>
              <a href="author.html#34726">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
