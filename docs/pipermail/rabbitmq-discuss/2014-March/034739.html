<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Writing custom exchange type plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Writing%20custom%20exchange%20type%20plugin&In-Reply-To=%3C53300EA9.8040509%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034725.html">
   <LINK REL="Next"  HREF="034770.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Writing custom exchange type plugin</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Writing%20custom%20exchange%20type%20plugin&In-Reply-To=%3C53300EA9.8040509%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Writing custom exchange type plugin">simon at rabbitmq.com
       </A><BR>
    <I>Mon Mar 24 10:53:29 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034725.html">[rabbitmq-discuss] Writing custom exchange type plugin
</A></li>
        <LI>Next message: <A HREF="034770.html">[rabbitmq-discuss] Writing custom exchange type plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34739">[ date ]</a>
              <a href="thread.html#34739">[ thread ]</a>
              <a href="subject.html#34739">[ subject ]</a>
              <a href="author.html#34739">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/03/2014 11:33PM, Adam Smith wrote:
&gt;<i> Hi,
</I>&gt;<i>    I want to write a custom exchange type plugin to accomplish the
</I>&gt;<i> following:
</I>&gt;<i>
</I>&gt;<i> 1. My application publishes messages to a custom exchange CUST in vhost
</I>&gt;<i> MYAPP
</I>&gt;<i> 2. The custom exchange plugin in turn publishes the same message to
</I>&gt;<i>          a. exchange X in vhost CL1
</I>&gt;<i>          b. exchange X in vhost CL2
</I>&gt;<i>          .....
</I>&gt;<i> The number of CLx vhosts can vary at different points in the
</I>&gt;<i> application's lifetime. Any pointers on how/whether it can done would be
</I>&gt;<i> greatly appreciated.
</I>
It can be done, since rabbit_exchange_type:route/2 returns a list of 
#resource{}s for the queue names to route to - and each #resource{} 
contains a virtual host. So you could mess with virtual hosts according 
to whatever logic you want in that function.

However (and it's quite a big however), RabbitMQ (and AMQP) are 
definitely not designed to work like that. Each virtual host is supposed 
to be a self-contained universe, so by routing across virtual hosts you 
are breaking the rules.

Some issues you will experience (I won't guarantee that this is a 
complete list):

1) You won't be allowed to establish a cross-vhost binding, so you'll 
have to determine how cross-vhost routing works in practice without 
reference to bindings.

2) The permissions system won't take any account of any cross-vhost 
routing you do.

3) Message rates in the management plugin might be garbled.

4) Future changes to the broker might break this completely (for 
example, if we ever move to per-vhost message stores). No such changes 
are currently on our radar though.

So this is very much &quot;at your own risk&quot;. Virtual hosts are *designed* to 
keep things completely separate, so if you want to route messages 
between them then maybe your design should be rethought.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034725.html">[rabbitmq-discuss] Writing custom exchange type plugin
</A></li>
	<LI>Next message: <A HREF="034770.html">[rabbitmq-discuss] Writing custom exchange type plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34739">[ date ]</a>
              <a href="thread.html#34739">[ thread ]</a>
              <a href="subject.html#34739">[ subject ]</a>
              <a href="author.html#34739">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
