<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Client certificate based authentication over	SSL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Client%20certificate%20based%20authentication%20over%0A%09SSL&In-Reply-To=%3C499D01F7-44F7-45EC-998A-23FFB7AC0773%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034826.html">
   <LINK REL="Next"  HREF="034843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Client certificate based authentication over	SSL</H1>
    <B>Primary</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Client%20certificate%20based%20authentication%20over%0A%09SSL&In-Reply-To=%3C499D01F7-44F7-45EC-998A-23FFB7AC0773%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Client certificate based authentication over	SSL">virus.vinay at gmail.com
       </A><BR>
    <I>Fri Mar 28 11:46:42 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034826.html">[rabbitmq-discuss] Client certificate based authentication over SSL
</A></li>
        <LI>Next message: <A HREF="034843.html">[rabbitmq-discuss] Client certificate based authentication over SSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34871">[ date ]</a>
              <a href="thread.html#34871">[ thread ]</a>
              <a href="subject.html#34871">[ subject ]</a>
              <a href="author.html#34871">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon,
 
Thank you for your response.
We have made a bit of a progress but are still struggling with a few things. Can you please give us some pointers:
1) We tried using {other_bind, anon} but that still failed even though our AD allows anonymous access. Following is an extract of the log:
{handandshake_error,starting,0,
    {exit,
        {error,operationsError},
        'connection.start_ok',
2) We used a {username, password} tuple to bind to the AD. Though this is not an ideal approach, we were able to bind to AD and authorise our certificate user. Isn't there a way to use the certificate itself to bind to AD rather giving a username, password in clear text?
3) Once this was done we had to then &quot;create the certificate user with no password&quot; in RabbitMQ admin and grant access to the virtual host via the admin. We want to get away with this i.e. having to maintain users outside the AD. Is there no way we can achieve this without having to create a user in RabbitMQ admin?
4) This last bit is related to authorising access to the user. We are able to write, read and create queues if our resource access query is {constant, true}. To grant access based on AD groups we changed the query to
{permission, write,
                                                {for, [{resource, queue, {constant, true}},                                                           {resource, exchange, {in_group, &quot;cn=&lt;Group Name&gt;,ou=XXX,ou=Exchange,ou=Distribution Lists,dc=domain,dc=com&quot;}}]}}
 
However this does not work. The group does exist and the certificate user is a member of that group. We even tried giving a full group path without any success.
 
Following is an extract from our log:
 
LDAP network traffic: search reply = {ok,
                                     {'LDAPMessage',2,
                                                     {searchResDone,           {'LDAPResult',noSuchObject,&quot;DC=domain,DC=com&quot;,
[48,48,48,48,50,48,56,68,58,32,                                                  78,97,109,101,69,114,114,58,32,68,83,73,68,45,48,51,49,48,48,                                                    50,48,65,44,32,112,114,111,98,108,101,109,32,50,48,48,49,32,                                                     40,78,79,95,79,66,74,69,67,84,41,44,32,100,97,116,97,32,48,44,                                                   32,98,101,115,116,32,109,97,116,
99,104,32,111,102,58,10,9,39,68,                                                            67,61,101,100,102,116,114,97,100,105,110,103,44,68,67,61,99,111,109,39,10,0],
asn1_NOVALUE}}, asn1_NOVALUE}}
=INFO REPORT==== 28-Mar-2014::11:29:43 ===
LDAP evaluated in_group for &quot;cn=Group,ou=XXX,ou=Exchange,ou=Distribution Lists,dc=domain,dc=com&quot;: {error,
noSuchObject}
 
Regards,
Vinay

&gt;<i> On 27 Mar 2014, at 21:09, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On 27/03/2014 14:56, Vinay Nayak wrote:
</I>&gt;&gt;<i>     {exit,as_user_no_password,'connection.start_ok',
</I>&gt;<i> 
</I>&gt;<i> So I think this (&quot;as_user_no_password&quot;) is the least clear error message I have ever perpetrated. It's getting made clearer in the next release.
</I>&gt;<i> 
</I>&gt;<i> What it's trying to say is:
</I>&gt;<i> 
</I>&gt;<i> &quot;You have (successfully) authenticated a user without giving a password (using client certs instead). However, the 'other_bind' configuration item is set to 'as_user' which means that when I want to go to the LDAP server for authorisation queries, I should bind to it with the user's credentials. But I only know how to do that with the user's password. Which I don't have.&quot;
</I>&gt;<i> 
</I>&gt;<i> It's not made any clearer by the fact that 'as_user' is the default value for 'other_bind'.
</I>&gt;<i> 
</I>&gt;<i> So you must set 'other_bind' to 'anon' (bind anonymously for authZ queries), or {&quot;someuser&quot;, &quot;somepassword&quot;} (bind with those creds for authZ).
</I>&gt;<i> 
</I>&gt;<i> Cheers, Simon
</I>&gt;<i> 
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034826.html">[rabbitmq-discuss] Client certificate based authentication over SSL
</A></li>
	<LI>Next message: <A HREF="034843.html">[rabbitmq-discuss] Client certificate based authentication over SSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34871">[ date ]</a>
              <a href="thread.html#34871">[ thread ]</a>
              <a href="subject.html#34871">[ subject ]</a>
              <a href="author.html#34871">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
