<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ cluster and connection management
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20cluster%20and%20connection%20management&In-Reply-To=%3CCAD6m6fGQ1ipXEZOhEuKmE0gq0z-6u-v_Zdj31RuZ75f6zy7x4g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034506.html">
   <LINK REL="Next"  HREF="034720.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ cluster and connection management</H1>
    <B>Jason McIntosh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20cluster%20and%20connection%20management&In-Reply-To=%3CCAD6m6fGQ1ipXEZOhEuKmE0gq0z-6u-v_Zdj31RuZ75f6zy7x4g%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ cluster and connection management">mcintoshj at gmail.com
       </A><BR>
    <I>Wed Mar 12 16:09:46 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034506.html">[rabbitmq-discuss] RabbitMQ cluster and connection management
</A></li>
        <LI>Next message: <A HREF="034720.html">[rabbitmq-discuss] RabbitMQ cluster and connection management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34528">[ date ]</a>
              <a href="thread.html#34528">[ thread ]</a>
              <a href="subject.html#34528">[ subject ]</a>
              <a href="author.html#34528">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>haproxy is a common method that you can play with via software, F5 load
balancers for hardware, pretty much any standard balancer will work.  Heck
I'd imagine you could almost use apache httpd and proxy support to do this.
 They just have to be configured correctly and then choose your load
balancing mechanism appropriately, and support a lower level tcp/ip
connection since the AMQP protocol is NOT http (we hit this initially until
networking realized that these aren't short lived simple http connections).
 Though beware, if you use a feature most load balancers have of monitoring
the back end through tcp/ip connects to the port (5672), you'll have a LOT
of messages in your log files where you'll see what are essentially half
opened connections to Rabbit.  This is pretty normal though as the load
balancers aren't trying to really connect, just verify that the port is
still open before rerouting traffic to a different node.

A lot of these kinds of decisions tend to be organization specific.  Does
your organization use physical load balancers everywhere and have good
policies in place to use them, or do most people have software load
balancers, cloud load balancers, etc.

We use F5 LTM's ourselves, with a least open connections algorithm I
believe (might be a round robin though - I don't recall immediately).  It's
worked pretty reliably, once we set the load balancer to not reap
connections until 615 seconds have passed (default heartbeat in rabbit was
600 seconds as I recall).

Jason


On Wed, Mar 12, 2014 at 1:28 AM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;wrote:

&gt;<i>
</I>&gt;<i> On 12 Mar 2014, at 08:41, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lcassa8 at gmail.com</A> wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I created 3 server cluster of RabbitMQ. As per documentation, RabbitMQ
</I>&gt;<i> client code does not support connection management to the cluster. It only
</I>&gt;<i> connects to one broker at a time. I wanted to find out that in order to
</I>&gt;<i> distribute load what usualy people do for RabbitMQ.
</I>&gt;<i>
</I>&gt;<i> Any strategy that achieves a reasonably even distribution. Picking a
</I>&gt;<i> random node will
</I>&gt;<i> likely be good enough for many environments.
</I>&gt;<i>
</I>&gt;<i> &gt; Do you use simple Load Balacer or write your own code to manage
</I>&gt;<i> connections, connection pooling etc?
</I>&gt;<i>
</I>&gt;<i> It's a common strategy to use a load balancer in front of a cluster and
</I>&gt;<i> make clients connect to it. Note that
</I>&gt;<i> you may need more than one load balancer and clients need to be able to
</I>&gt;<i> connect to the first reachable one.
</I>&gt;<i>
</I>&gt;<i> If you use RabbitMQ Java client, it can connect to the first reachable
</I>&gt;<i> node from a list.
</I>&gt;<i>
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> Software Engineer, Pivotal/RabbitMQ
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>


-- 
Jason McIntosh
<A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/101119eb/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/101119eb/attachment.html</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034506.html">[rabbitmq-discuss] RabbitMQ cluster and connection management
</A></li>
	<LI>Next message: <A HREF="034720.html">[rabbitmq-discuss] RabbitMQ cluster and connection management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34528">[ date ]</a>
              <a href="thread.html#34528">[ thread ]</a>
              <a href="subject.html#34528">[ subject ]</a>
              <a href="author.html#34528">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
