<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] OOM kill
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20OOM%20kill&In-Reply-To=%3CCAD6m6fET%2BkP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy%2BmdrVQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034378.html">
   <LINK REL="Next"  HREF="034382.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] OOM kill</H1>
    <B>Jason McIntosh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20OOM%20kill&In-Reply-To=%3CCAD6m6fET%2BkP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy%2BmdrVQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] OOM kill">mcintoshj at gmail.com
       </A><BR>
    <I>Fri Mar  7 17:43:47 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034378.html">[rabbitmq-discuss] OOM kill
</A></li>
        <LI>Next message: <A HREF="034382.html">[rabbitmq-discuss] OOM kill
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34379">[ date ]</a>
              <a href="thread.html#34379">[ thread ]</a>
              <a href="subject.html#34379">[ subject ]</a>
              <a href="author.html#34379">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As I recall, the memory limit doesn't prevent rabbit from using more
memory, it's the point at which it stops accepting new connections.  It
would still allow existing connections to flood the system:
Memory-Based Flow Control

The RabbitMQ server detects the total amount of RAM installed in the
computer on startup and when rabbitmqctl set_vm_memory_high_watermark
*fraction* is executed. By default, when the RabbitMQ server uses above 40%
of the installed RAM, it raises a memory alarm and *blocks all connections.
*Once the memory alarm has cleared (e.g. due to the server paging messages
to disk or delivering them to clients) normal service resumes.


No clue about the plugins memory.
Jason


On Fri, Mar 7, 2014 at 11:16 AM, Dmitry Andrianov &lt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dmitry.andrianov at alertme.com</A>&gt; wrote:

&gt;<i> Hello.
</I>&gt;<i> We are trying to load-test RabbitMQ server in different configurations on
</I>&gt;<i> Amazon EC2 node.
</I>&gt;<i> Most of our tests end with Linux OOM killer intervening and killing Rabbit.
</I>&gt;<i> That is something I cannot really understand especially given that it is
</I>&gt;<i> reproducible even with vm_memory_high_watermark set to 0.2 and no other
</I>&gt;<i> processes running on that box.
</I>&gt;<i> So if someone could shed some light onto that issue it would help a lot.
</I>&gt;<i>
</I>&gt;<i> Below the status response not long before the process was killed:
</I>&gt;<i>
</I>&gt;<i>  {os,{unix,linux}},
</I>&gt;<i>  {erlang_version,
</I>&gt;<i>      &quot;Erlang R15B01 (erts-5.9.1) [source] [64-bit] [async-threads:30]
</I>&gt;<i> [kernel-poll:true]\n&quot;},
</I>&gt;<i>  {memory,
</I>&gt;<i>      [{total,1984625336},
</I>&gt;<i>       {connection_procs,1235761240},
</I>&gt;<i>       {queue_procs,142935728},
</I>&gt;<i>       {plugins,-44730984},
</I>&gt;<i>       {other_proc,34065132},
</I>&gt;<i>       {mnesia,32001976},
</I>&gt;<i>       {mgmt_db,233149752},
</I>&gt;<i>       {msg_index,13545296},
</I>&gt;<i>       {other_ets,49861192},
</I>&gt;<i>       {binary,148478688},
</I>&gt;<i>       {code,20404184},
</I>&gt;<i>       {atom,793505},
</I>&gt;<i>       {other_system,118359627}]},
</I>&gt;<i>  {vm_memory_high_watermark,0.2},
</I>&gt;<i>  {vm_memory_limit,804643635},
</I>&gt;<i>  {disk_free_limit,50000000},
</I>&gt;<i>  {disk_free,1843380224},
</I>&gt;<i>  {file_descriptors,
</I>&gt;<i>      [{total_limit,64900},
</I>&gt;<i>       {total_used,11681},
</I>&gt;<i>       {sockets_limit,58408},
</I>&gt;<i>       {sockets_used,11677}]},
</I>&gt;<i>  {processes,[{limit,1048576},{used,198557}]},
</I>&gt;<i>  {run_queue,6},
</I>&gt;<i>  {uptime,575}]
</I>&gt;<i>
</I>&gt;<i> Couple of strange things there are:
</I>&gt;<i>
</I>&gt;<i> 1. {vm_memory_limit,804643635} but still memory {total,1984625336}. How is
</I>&gt;<i> that possible? <A HREF="https://www.rabbitmq.com/memory.html">https://www.rabbitmq.com/memory.html</A> says that erlang
</I>&gt;<i> process can take twice the configured size so I expected that but it is
</I>&gt;<i> definitely more than twice.
</I>&gt;<i>
</I>&gt;<i> 2. {plugins,-44730984} - how this one is possible?
</I>&gt;<i>
</I>&gt;<i> And just in cast it is needed, below is /proc/X/status
</I>&gt;<i>
</I>&gt;<i> VmPeak:     2267580 kB
</I>&gt;<i> VmSize:     2110952 kB
</I>&gt;<i> VmLck:           0 kB
</I>&gt;<i> VmHWM:     2096276 kB
</I>&gt;<i> VmRSS:     2020848 kB
</I>&gt;<i> VmData:     2075168 kB
</I>&gt;<i> VmStk:          88 kB
</I>&gt;<i> VmExe:        1604 kB
</I>&gt;<i> VmLib:        4848 kB
</I>&gt;<i> VmPTE:        4304 kB
</I>&gt;<i> Threads:    31
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks in advance!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This email is for the use of the intended recipient(s) only.
</I>&gt;<i> If you have received this email in error, please notify the sender
</I>&gt;<i> immediately and then delete it.
</I>&gt;<i> If you are not the intended recipient, you must not use, disclose or
</I>&gt;<i> distribute this email without the
</I>&gt;<i> author's prior permission. AlertMe.com Ltd. is not responsible for any
</I>&gt;<i> personal views expressed
</I>&gt;<i> in this message or any attachments that are those of the individual sender.
</I>&gt;<i>
</I>&gt;<i> AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
</I>&gt;<i> Registered in England, Company number 578 2908, VAT registration number GB
</I>&gt;<i> 895 9914 42.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>


-- 
Jason McIntosh
<A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/6a06d623/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/6a06d623/attachment.html</A>&gt;
</PRE>










































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034378.html">[rabbitmq-discuss] OOM kill
</A></li>
	<LI>Next message: <A HREF="034382.html">[rabbitmq-discuss] OOM kill
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34379">[ date ]</a>
              <a href="thread.html#34379">[ thread ]</a>
              <a href="subject.html#34379">[ subject ]</a>
              <a href="author.html#34379">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
