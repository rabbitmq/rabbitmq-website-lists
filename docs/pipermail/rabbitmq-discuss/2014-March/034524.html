<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Odd behavior where server stops responding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Odd%20behavior%20where%20server%20stops%20responding&In-Reply-To=%3CCAD6m6fFrizO5c2WAyxqn07ujYfrKHzcRhkBWiL0M%3D0%3D--LbHqA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034518.html">
   <LINK REL="Next"  HREF="034529.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Odd behavior where server stops responding</H1>
    <B>Jason McIntosh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Odd%20behavior%20where%20server%20stops%20responding&In-Reply-To=%3CCAD6m6fFrizO5c2WAyxqn07ujYfrKHzcRhkBWiL0M%3D0%3D--LbHqA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Odd behavior where server stops responding">mcintoshj at gmail.com
       </A><BR>
    <I>Wed Mar 12 14:32:42 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034518.html">[rabbitmq-discuss] Odd behavior where server stops responding
</A></li>
        <LI>Next message: <A HREF="034529.html">[rabbitmq-discuss] Odd behavior where server stops responding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34524">[ date ]</a>
              <a href="thread.html#34524">[ thread ]</a>
              <a href="subject.html#34524">[ subject ]</a>
              <a href="author.html#34524">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I never could get any node up - nothing showed up in the logs for startup,
shutdown, regular and sasl logs.  One interesting thing is on the startup
after killing all the processes (including epmd) it appears to have started
multiple beams instead of the typical one.

By non-responsive, rabbitmqctl shows the node as being down, but I could
telnet to both the management port and the rabbitmq port (which I'm
guessing is the epmd process), but nothing shows in the log files for
rabbit itself, nothing in the sasl logs, no content from the management
port, etc.  The OS was completely responsive - I could get to the shell, do
most commands, though lsof (I think I mentioned this) wouldn't respond in
any timely manner while rabbit server was running.  All the ways I know of
to talk to rabbit and all the os things i know to do were failing and all
the things I know to try and restart it (killing the processes, waiting for
network connections in TIM_WAIT to drain, killing EPMD as well) all failed.

At that point, I recycled each of the servers and they're back to a running
state.  I don't know that I have a box handy but I'll see what I can do to
replicate this.  For some reason I think I've seen this before and it's
something with the OEL 6.2 kernel that Oracle put together, dealing with
disk io flush on a journaled file system.  I'm pretty sure I've seen the
same thing about 6 months ago or so on a completely different set of
servers.

Jason




On Wed, Mar 12, 2014 at 4:39 AM, Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On 11 Mar 2014, at 16:41, Jason McIntosh wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; This may be a 3.0.4-1 issue (or erlang esl-erlang-R15B03-2.x86_64) and I
</I>&gt;<i> just may need to upgrade rabbit but I thought I'd see if anyone had seen
</I>&gt;<i> this before.  This is on oracle enterprise linux 6.2.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; A few days after a software raid filesystem check (may or not be
</I>&gt;<i> related, only thing I can see that's common), on three separate servers,
</I>&gt;<i> rabbit just completely hung.  I couldn't even do an LSOF on any file system.
</I>&gt;<i>
</I>&gt;<i> That sounds like the OS hung not rabbit?
</I>&gt;<i>
</I>&gt;<i> &gt; The port was still responsive, but the rabbit process itself was
</I>&gt;<i> completely hung.  CPU use jumped up to 25% on the beam process and just
</I>&gt;<i> stayed there...
</I>&gt;<i>
</I>&gt;<i> 25% isn't exactly massive, though if the spike in CPU wasn't associated
</I>&gt;<i> with an increase in messaging traffic then something could be wrong.
</I>&gt;<i>
</I>&gt;<i> &gt;  I killed all the rabbit processes and tried to restart them.  There was
</I>&gt;<i> nothing in the logs and the startup failed
</I>&gt;<i>
</I>&gt;<i> How did it fail? Non-zero return code(s) or more?
</I>&gt;<i>
</I>&gt;<i> &gt; I killed everything again, including the EPMD process and then rabbit
</I>&gt;<i> was finally able to start.  With-in a few moments though the beam hung
</I>&gt;<i> again - I see a few connections show in the logs and then the process is
</I>&gt;<i> non-responsive.
</I>&gt;<i>
</I>&gt;<i> How did the beam process hang and in what way did the broker become
</I>&gt;<i> unresponsive? How are you trying to interact with the broker? Are we
</I>&gt;<i> talking about rabbitmqctl commands not responding, or something else?
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm GUESSING this is an OS level issue, and I'd swear I've seen this
</I>&gt;<i> before.
</I>&gt;<i>
</I>&gt;<i> I've not heard of this before either. If you can get a rabbit node up and
</I>&gt;<i> running then we may be able to run some diagnostic commands, depending on
</I>&gt;<i> whether or not rabbitmqctl commands are working (or not). There are other
</I>&gt;<i> ways to access a console on a running node too, though they're a bit more
</I>&gt;<i> involved.
</I>&gt;<i>
</I>&gt;<i> &gt;  I've had to do a full restart of the server to get things back to a
</I>&gt;<i> decent state.  Anyone have any advice/ideas?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Please clarify what we mean by hung and non-responsive. Also, do you now
</I>&gt;<i> have the broker running without any of these issues? Can you fire up a
</I>&gt;<i> standalone (test) node in a VM or some such, run the broker (successfully)
</I>&gt;<i> on it and re-run the raid check to see if it causes the same problem?
</I>&gt;<i>
</I>&gt;<i> It would be good to get to the bottom of this, though clearly without any
</I>&gt;<i> logs it's going to be tricky.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Tim
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>


-- 
Jason McIntosh
<A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/e9de56f1/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/e9de56f1/attachment.html</A>&gt;
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034518.html">[rabbitmq-discuss] Odd behavior where server stops responding
</A></li>
	<LI>Next message: <A HREF="034529.html">[rabbitmq-discuss] Odd behavior where server stops responding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34524">[ date ]</a>
              <a href="thread.html#34524">[ thread ]</a>
              <a href="subject.html#34524">[ subject ]</a>
              <a href="author.html#34524">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
