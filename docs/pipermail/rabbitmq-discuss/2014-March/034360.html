<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%203.2.2%20cluster%20shutting%20down&In-Reply-To=%3CCAKRHTke3kCzOJ_jGFAbSomT%3DhK7wtAPv6svKTSebp6eiPN3zGA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034359.html">
   <LINK REL="Next"  HREF="034415.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down</H1>
    <B>Andy Martin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%203.2.2%20cluster%20shutting%20down&In-Reply-To=%3CCAKRHTke3kCzOJ_jGFAbSomT%3DhK7wtAPv6svKTSebp6eiPN3zGA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down">akmartin at gmail.com
       </A><BR>
    <I>Thu Mar  6 15:47:12 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034359.html">[rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down
</A></li>
        <LI>Next message: <A HREF="034415.html">[rabbitmq-discuss] Number of messages in a queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34360">[ date ]</a>
              <a href="thread.html#34360">[ thread ]</a>
              <a href="subject.html#34360">[ subject ]</a>
              <a href="author.html#34360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your quick response.

&quot;Down&quot; as in the Erlang VM had exited, or &quot;down&quot; as in the Erlang VM was
&gt;<i> still running but the RabbitMQ application had stopped?
</I>

That's a good question. I didn't even check. I only looked at it from
Windows services and restarted from there.  But both nodes are definitely
running 3.2.2.

I don't see anything about autoheal in the logs. The first log I sent was
from the node that went down, right at the time I lost connection to that
node. This is from the other node in the cluster. So a partition definitely
occurred, but there's nothing about autohealing. Maybe I should upgrade to
3.2.4 and see if it happens again?


=ERROR REPORT==== 6-Mar-2014::09:49:24 ===
AMQP connection &lt;0.63.92&gt; (running), channel 0 - error:
{amqp_error,connection_forced,
            &quot;broker forced connection closure with reason 'shutdown'&quot;,none}

=INFO REPORT==== 6-Mar-2014::09:49:24 ===
Halting Erlang VM

=ERROR REPORT==== 6-Mar-2014::09:49:30 ===
Mnesia(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at BOSRISDEVFAB201</A>): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MARRISDEVFAB201</A>
}


Thanks,
Andy


On Thu, Mar 6, 2014 at 10:19 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 06/03/14 15:04, Andy Martin wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> ** {{badmatch,{error,not_found}},
</I>&gt;&gt;<i>      [{rabbit_amqqueue_process,i,2,[]},
</I>&gt;&gt;<i>       {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
</I>&gt;&gt;<i>       {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
</I>&gt;&gt;<i>       {rabbit_amqqueue_process,emit_stats,2,[]},
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That's the exact stack trace of a bug we fixed in 3.2.1. Are you
</I>&gt;<i> completely sure that both nodes are running 3.2.2?
</I>&gt;<i>
</I>&gt;<i>  I have a two-node autoheal cluster. Yesterday I came in to find out
</I>&gt;&gt;<i> that neither server in the cluster was seeing the other, but there
</I>&gt;&gt;<i> was no message about a partition having occurred.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You will only be notified about the partition once the servers can see
</I>&gt;<i> each other again - until that happens, A thinks B is down, and B thinks A
</I>&gt;<i> is down; they have no way to know it's a partition.
</I>&gt;<i>
</I>&gt;<i>  Today I came in to
</I>&gt;&gt;<i> find one of the servers down. I can't find anything in the logs that
</I>&gt;&gt;<i> would indicate why this is happening. What should I be looking for in
</I>&gt;&gt;<i> the logs?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &quot;Down&quot; as in the Erlang VM had exited, or &quot;down&quot; as in the Erlang VM was
</I>&gt;<i> still running but the RabbitMQ application had stopped?
</I>&gt;<i>
</I>&gt;<i> If the former, then it can't be anything to do with autoheal since that
</I>&gt;<i> doesn't attempt to stop the node completely. You might want to look for
</I>&gt;<i> &quot;Halting Erlang VM&quot; in the logs; that would imply the broker was shut down
</I>&gt;<i> deliberately. If that's not there then please post the logs somewhere with
</I>&gt;<i> an indication of when you became aware the server was down.
</I>&gt;<i>
</I>&gt;<i> If the latter, it's possible that you ran into one of the bugs we fixed in
</I>&gt;<i> 3.2.4, where an attempt at autoheal can get stuck. There should still be
</I>&gt;<i> messages about autoheal in the logs in that case though.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/35687f35/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/35687f35/attachment.html</A>&gt;
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034359.html">[rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down
</A></li>
	<LI>Next message: <A HREF="034415.html">[rabbitmq-discuss] Number of messages in a queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34360">[ date ]</a>
              <a href="thread.html#34360">[ thread ]</a>
              <a href="subject.html#34360">[ subject ]</a>
              <a href="author.html#34360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
