<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] ulimit and cgroup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ulimit%20and%20cgroup&In-Reply-To=%3CF964A398-3D7F-40A4-AFDC-64812FB452B9%40gopivotal.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034544.html">
   <LINK REL="Next"  HREF="034546.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] ulimit and cgroup</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ulimit%20and%20cgroup&In-Reply-To=%3CF964A398-3D7F-40A4-AFDC-64812FB452B9%40gopivotal.com%3E"
       TITLE="[rabbitmq-discuss] ulimit and cgroup">mklishin at gopivotal.com
       </A><BR>
    <I>Thu Mar 13 09:18:23 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034544.html">[rabbitmq-discuss] ulimit and cgroup
</A></li>
        <LI>Next message: <A HREF="034546.html">[rabbitmq-discuss] ulimit and cgroup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34545">[ date ]</a>
              <a href="thread.html#34545">[ thread ]</a>
              <a href="subject.html#34545">[ subject ]</a>
              <a href="author.html#34545">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13 Mar 2014, at 12:47, ratheesh kannoth &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ratheesh.ksz at gmail.com</A>&gt; wrote:

&gt;<i> This is the case even if  we don't use durable queues...right ?
</I>
This is true for non-persistent messages, too.

&gt;<i> 
</I>&gt;&gt;<i> There should be no giant files, though, on disk
</I>&gt;&gt;<i> message store will split them into multiple smaller files (16 MB by default, AFAIR).
</I>&gt;<i> 
</I>&gt;<i> All these files would be opened and kept. Or will be opened on demand.
</I>&gt;<i> Because linux ulimit can set limit on
</I>&gt;<i> no of opened files.
</I>
They are created as needed. However, during compaction (garbage collection
of messages on disk), the number of files may temporarily become up to 2 times greater
than usual.

It is rarely a good idea to set a limit on how many files RabbitMQ (or any other infrastructure service, e.g. PostgreSQL or Cassandra)
can open. Best case scenario it will stop accepting new connections (there will be messages
in the log about this).

In general RabbitMQ tries to reduce the number of file descriptors it uses.

&gt;<i> 
</I>&gt;&gt;<i> There is a fixed (a few dozens of bytes) RAM cost per message until you use a
</I>&gt;&gt;<i> custom queue index plugin, such as rabbitmq-toke [1].
</I>&gt;<i> 
</I>&gt;<i> Can you list out other plugins ( and tuning parameters ) through which
</I>&gt;<i> i can tune Broker's system resource usage ?
</I>
<A HREF="http://www.rabbitmq.com/configure.html#configuration-file">http://www.rabbitmq.com/configure.html#configuration-file</A>

&gt;<i> 
</I>&gt;&gt;<i> If RabbitMQ cannot allocate memory or write to a file, of course, there is little it can do, so be
</I>&gt;&gt;<i> careful about setting RSS and file size limit.
</I>&gt;<i> Will it gracefully shutdown ?  Can you predict the behavior ? it just crash ?
</I>
If it fails to write to a file, the OS process won&#8217;t crash. If VM fails to allocate memory,
it will exit and RabbitMQ will have no chance to shut down.

Graceful shutdown involves disk I/O, too.
--
MK

Software Engineer, Pivotal/RabbitMQ

</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034544.html">[rabbitmq-discuss] ulimit and cgroup
</A></li>
	<LI>Next message: <A HREF="034546.html">[rabbitmq-discuss] ulimit and cgroup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34545">[ date ]</a>
              <a href="thread.html#34545">[ thread ]</a>
              <a href="subject.html#34545">[ subject ]</a>
              <a href="author.html#34545">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
