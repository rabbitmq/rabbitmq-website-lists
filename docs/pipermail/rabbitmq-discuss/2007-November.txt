From 0x6e6562 at gmail.com  Thu Nov  1 07:12:54 2007
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 1 Nov 2007 07:12:54 +0000
Subject: [rabbitmq-discuss] Windows Install of RabbitMQ and Erlang in
	non C drive
In-Reply-To: <50ec7a2e0710311508y3fc86b2aj52ad48e7b2020cc9@mail.gmail.com>
References: <50ec7a2e0710311508y3fc86b2aj52ad48e7b2020cc9@mail.gmail.com>
Message-ID: <269388e30711010012x359540fes27e940cfd50c4bab@mail.gmail.com>

Joe,

Why don't you open up a shell and type the command at the prompt so
that you can capture the output?

Ben

On 10/31/07, joe lee <codewalkerjoe at gmail.com> wrote:
> I have installed my erlang in I:\Program Files\erl5.5.5 and placed
> rabbitmq-1.2.0 into I:\Program Files\erl5.5.5\lib.  I have them installed on
> Windows XP.
>
> I have set the ERLANG_HOME as windows environment variable:
> ERLANG_HOME = I:\Program Files\erl5.5.5\bin
>
> and set RABBITMQ_BASE in rabbitmq-server.bat as:
> set RABBITMQ_BASE=G:\dev\erlang_apps\rabbitmq
>
> When I click on:
> I:\Program
> Files\erl5.5.5\lib\rabbitmq-1.2.0\erlang\rabbit\scripts\rabbitmq-server.bat
> , I get ms-dos prompt which opens and closes right away.  I can't seem to
> get the rabbitmq server running.   Erlang  shell is working fine.
>
> Any help appreciated.
>
> Thanks,
> Joe
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From 0x6e6562 at gmail.com  Thu Nov  1 07:22:08 2007
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 1 Nov 2007 07:22:08 +0000
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <4728CD44.4050506@cohesiveft.com>
References: <4728CD44.4050506@cohesiveft.com>
Message-ID: <269388e30711010022s42e42ed6u55fc59df9d8e8e9f@mail.gmail.com>

Dmitriy,

> I set up a cluster of 2 nodes - rabbit at node1 and rabbit at node2. Several producers will
> connect to either node and send a series of messages with topic hierarchy as routing key
> (for example, "a.b.c.d.e.f"). Consumers will also connect to either node and will register
> to receive some subset of what is being sent - in other words, for example, some of them
> will request "a.#" while others might want to get only "#.e.f". My goal is to make it
> happen if at least one of the nodes in the cluster is up and running. Both producers and
> consumers will know about existence of both cluster nodes, but they need to be able to
> randomly connect to either.

As far as I know, message queues are not yet fully clustered in
rabbitmq, meaning that you cannot yet transparently failover or
migrate a queue to a different node in the cluster. These queues are
visible from any node in the cluster however.

HTH,

Ben



From ellisonbg.net at gmail.com  Fri Nov  2 22:18:28 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Fri, 2 Nov 2007 16:18:28 -0600
Subject: [rabbitmq-discuss] Using rabbitmq with cean erlang
Message-ID: <6ce0ac130711021518i3e1bdec8j7c49eeb54c395dfd@mail.gmail.com>

Hi,

I have installed the cean erlang package and rabbitmq from source.  I
can start a broker with rabbitmq-server, but when I do rabbitmqctl
status, I get an error.  Here is what I see:

Invalid command ["status","-s","cean","version"]
Usage: rabbitmqctl [-n <node>] <command> [<arg> ...]

I traced this down to the actuall erl bash script that invokes erl in
the cean distribution.  The last line if this script has:

#$BINDIR/$cmd ${1+"$@"} -s cean version

So, you see that it is passing -s cean version to erlang as plain
arguments, which causes the pattern matching of the action function to
fail.  Simply commenting out these extra arguments makes it work fine,
but this seems like a bug either in cean or rabbitmq.

I am new to erlang so it is not clear why -s cean version is being
passed to erlang.  Should I keep using the cean dist or should I
switch to something else?  Is there a better work around for this
issue?

Thanks!

Brian



From ellisonbg.net at gmail.com  Sat Nov  3 05:16:16 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Fri, 2 Nov 2007 23:16:16 -0600
Subject: [rabbitmq-discuss] rabbitmq-multi
Message-ID: <6ce0ac130711022216j65710f71y7251f83d97967bf2@mail.gmail.com>

Hi,

After getting single node rabbit server working fine (with the qpid
python client) I am trying to use rabbitmq-multi to get multiple nodes
going.  I am on OS X and I get the following:

$ rabbitmq-multi start_all 2
Starting all nodes...
Starting node 0....................
rabbit_multi action start_all failed:
timeout_waiting_for_node_to_come_up

I have put lots of debugging statement in and have played around with
different cluster config files, but I can't get this to work.  Is
there something trivial that I am not doing or is there  a bug?

Thanks

Brian



From matthias at lshift.net  Sat Nov  3 10:33:13 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 03 Nov 2007 10:33:13 +0000
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <269388e30711010022s42e42ed6u55fc59df9d8e8e9f@mail.gmail.com>
References: <4728CD44.4050506@cohesiveft.com>
	<269388e30711010022s42e42ed6u55fc59df9d8e8e9f@mail.gmail.com>
Message-ID: <472C4E69.1040409@lshift.net>

Dmitriy,

Ben Hood wrote:
> Dmitriy,
> 
>> I set up a cluster of 2 nodes - rabbit at node1 and rabbit at node2.
>> Several producers will connect to either node and send a series of
>> messages with topic hierarchy as routing key (for example,
>> "a.b.c.d.e.f"). Consumers will also connect to either node and will
>> register to receive some subset of what is being sent - in other
>> words, for example, some of them will request "a.#" while others
>> might want to get only "#.e.f". My goal is to make it happen if at
>> least one of the nodes in the cluster is up and running. Both
>> producers and consumers will know about existence of both cluster
>> nodes, but they need to be able to randomly connect to either.

> As far as I know, message queues are not yet fully clustered in
> rabbitmq, meaning that you cannot yet transparently failover or
> migrate a queue to a different node in the cluster. These queues are
> visible from any node in the cluster however.

Ben is right about the (lack of) queue clustering. Whether or not that 
matters depends on what guarantees you expect on message delivery: Can 
you afford to lose messages? Is it ok for a message to be delivered to a 
consumer more than once?

You can guarantee exactly-once delivery if you use transactions, durable 
queues and exchanges, and persistent messages, but only as long as any 
failing node eventually recovers.

If you can afford to lose the odd message then the simplest setup is to 
just have consumers detect when connections goes down, connect to the 
other node and recreate their queues. Similarly, producers just 
re-connect to the second node on failure of the first node, and start 
sending messages to the same exchange as before.

If message loss is bad but duplication is ok then you can could set up 
two parallel routing topologies with producers sending messages to both 
nodes and each consumer consuming from two queues - one on each node.

There are various other options; which one is best really depends on the 
specific requirements of your application.


All this is going to improve significantly in AMQP 0-10, where there is 
a notion of a "session" whose lifecycle is independent from that of the 
transport connection. Sessions can transparently reconnect to other 
nodes and have built-in support for exactly-once delivery. We'd still 
need to add queue clustering to RabbitMQ, but that's on our roadmap 
already anyway.


Regards,

Matthias.



From matthias at lshift.net  Sat Nov  3 10:41:02 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 03 Nov 2007 10:41:02 +0000
Subject: [rabbitmq-discuss] Using rabbitmq with cean erlang
In-Reply-To: <6ce0ac130711021518i3e1bdec8j7c49eeb54c395dfd@mail.gmail.com>
References: <6ce0ac130711021518i3e1bdec8j7c49eeb54c395dfd@mail.gmail.com>
Message-ID: <472C503E.40308@lshift.net>

Brian,

Brian Granger wrote:
> Hi,
> 
> I have installed the cean erlang package and rabbitmq from source.  I
> can start a broker with rabbitmq-server, but when I do rabbitmqctl
> status, I get an error.  Here is what I see:
> 
> Invalid command ["status","-s","cean","version"]
> Usage: rabbitmqctl [-n <node>] <command> [<arg> ...]
> 
> I traced this down to the actuall erl bash script that invokes erl in
> the cean distribution.  The last line if this script has:
> 
> #$BINDIR/$cmd ${1+"$@"} -s cean version
> 
> So, you see that it is passing -s cean version to erlang as plain
> arguments, which causes the pattern matching of the action function to
> fail.  Simply commenting out these extra arguments makes it work fine,
> but this seems like a bug either in cean or rabbitmq.
> 
> I am new to erlang so it is not clear why -s cean version is being
> passed to erlang.  Should I keep using the cean dist or should I
> switch to something else?  Is there a better work around for this
> issue?

That cean command line looks strange.

If it's not too much trouble for you I'd recommend using the stock 
Erlang distribution.

Meanwhile, if anybody on the list has experience with cean I'd 
appreciate their insight on why this error might be happening (and, 
indeed, why it doesn't happen for rabbitmq-server).


Matthias.



From matthias at lshift.net  Sat Nov  3 10:50:16 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 03 Nov 2007 10:50:16 +0000
Subject: [rabbitmq-discuss] rabbitmq-multi
In-Reply-To: <6ce0ac130711022216j65710f71y7251f83d97967bf2@mail.gmail.com>
References: <6ce0ac130711022216j65710f71y7251f83d97967bf2@mail.gmail.com>
Message-ID: <472C5268.6050608@lshift.net>

Brian,

Brian Granger wrote:
> I am on OS X and I get the following:
> 
> $ rabbitmq-multi start_all 2
> Starting all nodes...
> Starting node 0....................
> rabbit_multi action start_all failed:
> timeout_waiting_for_node_to_come_up

Are there any errors being reported in the log files (under 
/var/log/rabbitmq by default)?


Matthias.



From alexis.richardson at cohesiveft.com  Sat Nov  3 11:21:14 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 3 Nov 2007 11:21:14 +0000
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <472C4E69.1040409@lshift.net>
References: <4728CD44.4050506@cohesiveft.com>
	<269388e30711010022s42e42ed6u55fc59df9d8e8e9f@mail.gmail.com>
	<472C4E69.1040409@lshift.net>
Message-ID: <167204d20711030421p7a843d45u4c0bfd5f8a20fe3@mail.gmail.com>

On 11/3/07, Matthias Radestock <matthias at lshift.net> wrote:
>
> You can guarantee exactly-once delivery if you use transactions, durable
> queues and exchanges, and persistent messages, but only as long as any
> failing node eventually recovers.
>
> If you can afford to lose the odd message then the simplest setup is to
> just have consumers detect when connections goes down, connect to the
> other node and recreate their queues. Similarly, producers just
> re-connect to the second node on failure of the first node, and start
> sending messages to the same exchange as before.
>
> If message loss is bad but duplication is ok then you can could set up
> two parallel routing topologies with producers sending messages to both
> nodes and each consumer consuming from two queues - one on each node.
>
> There are various other options; which one is best really depends on the
> specific requirements of your application.

All true.

Another MQ-like pattern that works for 0-8/0-9, for some cases, is
applicable when message loss is bad, and 'eventual delivery' is
desired. If you have a local disk, then run a second broker on the
client machine, in persistent mode.  Then, write a consumer which
copies messages from the local broker on the client, to the broker on
the server.  This may feel clunky but it lets the client application
'hand off' delivery to the local queue reliably, provided that the
local disk can be trusted.  Then delivery to the server and hence to
the ultimate message recipient will eventually occur assuming there is
a network.

As Matthias pointed out these patterns for reliability, though
possible today, will be supported better in 0-10.

alexis



From ellisonbg.net at gmail.com  Sun Nov  4 01:55:42 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Sat, 3 Nov 2007 19:55:42 -0600
Subject: [rabbitmq-discuss] rabbitmq-multi
In-Reply-To: <472C5268.6050608@lshift.net>
References: <6ce0ac130711022216j65710f71y7251f83d97967bf2@mail.gmail.com>
	<472C5268.6050608@lshift.net>
Message-ID: <6ce0ac130711031855h4f050f91w392391abed06e1b7@mail.gmail.com>

The logs are empty after the failure, so there isn't really anything to look at.

Hmm.  I am willing to poke around the code, but being new to erlang
and rabbitmq, it is tough to figure out where to start looking.  Any
ideas?

Brian

On 11/3/07, Matthias Radestock <matthias at lshift.net> wrote:
> Brian,
>
> Brian Granger wrote:
> > I am on OS X and I get the following:
> >
> > $ rabbitmq-multi start_all 2
> > Starting all nodes...
> > Starting node 0....................
> > rabbit_multi action start_all failed:
> > timeout_waiting_for_node_to_come_up
>
> Are there any errors being reported in the log files (under
> /var/log/rabbitmq by default)?
>
>
> Matthias.
>



From matthias at lshift.net  Sun Nov  4 10:39:32 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 04 Nov 2007 10:39:32 +0000
Subject: [rabbitmq-discuss] rabbitmq-multi
In-Reply-To: <6ce0ac130711031855h4f050f91w392391abed06e1b7@mail.gmail.com>
References: <6ce0ac130711022216j65710f71y7251f83d97967bf2@mail.gmail.com>	<472C5268.6050608@lshift.net>
	<6ce0ac130711031855h4f050f91w392391abed06e1b7@mail.gmail.com>
Message-ID: <472DA164.2020808@lshift.net>

Brian,

Brian Granger wrote:
> The logs are empty after the failure, so there isn't really anything to look at.
> 
> Hmm.  I am willing to poke around the code, but being new to erlang
> and rabbitmq, it is tough to figure out where to start looking.  Any
> ideas?

rabbitmq-multi is a shell script that calls the rabbit_multi erlang 
module. So those two are the place to start looking / debugging.

The program expects to find the rabbitmq-server script in the same 
directory as the rabbitmq-multi script and uses that to launch the 
individual nodes. So one possible failure is that the rabbitmq-server 
script cannot be found or invoking it produces an error.


Matthias.



From codewalkerjoe at gmail.com  Mon Nov  5 02:48:19 2007
From: codewalkerjoe at gmail.com (joe lee)
Date: Sun, 4 Nov 2007 21:48:19 -0500
Subject: [rabbitmq-discuss] rabbitmq Internal rollback
Message-ID: <50ec7a2e0711041848m575161a1w73ac677ca43067f9@mail.gmail.com>

I am getting internal rollback on dos prompt where rabbitmq was started.
What is this mean?
I am using amqp0-8.xml.

Here is my python code for just placing stuff in the queue:

                client = Client(RABBITMQ_SERVER,RABBITMQ_PORT, spec=
qpid.spec.load(RABBITMQ_SPECXML))
                client.start({ 'LOGIN':'guest', 'PASSWORD':'guest' })
                ch = client.channel(1)
                ch.channel_open()

                rkey = "testqueue." + socket.gethostname().split('.')[0]
                producer_queue = ch.queue_declare()
                ch.queue_bind(queue=producer_queue.queue, exchange="
amq.topic",
                              routing_key=rkey)
                line = "items:%s, user:%s" % (items, None)
                c = Content(line)
                c['headers'] = { 'sent':int(time.time())}
                ch.basic_publish(routing_key=rkey, content=c, exchange='
amq.topic')

Rabbitmq:

broker running
debug:: Internal rollback <0.155.0>
  - 0 acks uncommitted, 0 messages unacked, 0 publishes uncommitted
debug:: Internal rollback <0.174.0>
  - 0 acks uncommitted, 0 messages unacked, 0 publishes uncommitted


rabbit.log:

=INFO REPORT==== 4-Nov-2007::20:42:16 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1644

=WARNING REPORT==== 4-Nov-2007::20:42:16 ===
Attempt by client to use invalid ticket 0

=WARNING REPORT==== 4-Nov-2007::20:42:16 ===
Lax ticket check mode: fabricating full ticket number 0

=INFO REPORT==== 4-Nov-2007::20:43:50 ===
Connection closed abruptly.

=INFO REPORT==== 4-Nov-2007::20:43:50 ===
closing TCP connection from 127.0.0.1:1644

thanks,
joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071104/57aa54c7/attachment.htm 

From matthias at lshift.net  Mon Nov  5 09:08:05 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 05 Nov 2007 09:08:05 +0000
Subject: [rabbitmq-discuss] rabbitmq Internal rollback
In-Reply-To: <50ec7a2e0711041848m575161a1w73ac677ca43067f9@mail.gmail.com>
References: <50ec7a2e0711041848m575161a1w73ac677ca43067f9@mail.gmail.com>
Message-ID: <472EDD75.4050204@lshift.net>

Joe,

joe lee wrote:
> I am getting internal rollback on dos prompt where rabbitmq was 
> started.  What is this mean?

That's just some debug output. Nothing to worry about. It will be gone 
in the next release.


Matthias



From matt at meez.com  Mon Nov  5 17:59:44 2007
From: matt at meez.com (matt)
Date: Mon, 5 Nov 2007 09:59:44 -0800
Subject: [rabbitmq-discuss] Queue inspector.
Message-ID: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>

First off, I want to say how much we love amqp and rabbitMQ!  We've
( meez.com) been using it in our production environment (when it was
alpha) for about 6 months now I think.

In brief, we use rabbitMQ as a way of communicating with our rendering
cluster.  We have user facing tomcat servers that provide a way of
giving the user options to create an avatar.  Upon save, we send
export requests via rabbitMQ and they're picked up by nodes in the
export cloud.  Upon success of the rendered images, a notification is
sent back and the user is notified that the exports were successful.

We've been refactoring to provide optimum scalability, and one way of
doing that is by using EC2 for some of our export nodes.  We're doing
this over an ssh tunnel and things work pretty well.  However, the big
immediate need we're looking for is a way to see how much is being
queued up on the rabbitMQ cluster.  That way, we can programatically
bring EC2 nodes up or take then down based on need.

I know that this is in the pipeline - but is there *any* way of doing
this now and/or is there something that could be easily added to
support this?

-matt

--
Matt Darling
Director, Server Engineering
Meez
182 2nd Street, 5th Floor
San Francisco, CA 94105
(m) 415.505.4623
matt at corp.meez.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071105/513871a6/attachment.htm 

From matthias at lshift.net  Mon Nov  5 18:20:14 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 05 Nov 2007 18:20:14 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
Message-ID: <472F5EDE.6070805@lshift.net>

Matt,

matt wrote:
> First off, I want to say how much we love amqp and rabbitMQ!

Thank you. It is always nice to hear from real users.

> We've ( meez.com) been using it in our production environment (when
> it was alpha) for about 6 months now I think.
> 
> In brief, we use rabbitMQ as a way of communicating with our
> rendering cluster.  We have user facing tomcat servers that provide a
> way of giving the user options to create an avatar.  Upon save, we
> send export requests via rabbitMQ and they're picked up by nodes in
> the export cloud.  Upon success of the rendered images, a
> notification is sent back and the user is notified that the exports
> were successful.

That is a pretty neat use case, and it is good to hear that RabbitMQ
worked out well for you.

> the big immediate need we're looking for is a way to see how much is
> being queued up on the rabbitMQ cluster.  That way, we can
> programatically bring EC2 nodes up or take then down based on need.
> 
> I know that this is in the pipeline - but is there *any* way of doing
>  this now and/or is there something that could be easily added to 
> support this?

queue.declare-ok, the result of a queue.declare operation, in one of its 
fields contains the number of messages in the queue. This is part of the 
amqp 0-8 spec and implemented by RabbitMQ. In combination with 
queue.declare's passive flag it allows you to determine the length of 
existing queues.

If you are using the RabbitMQ Java client, check out
http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/ChannelN.html#queueDeclare(int,%20java.lang.String,%20boolean,%20boolean,%20boolean,%20boolean,%20java.util.Map),
  and
http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/AMQImpl.Queue.DeclareOk.html#getMessageCount()

This is only a very limited interface - you need to know the names of 
queues and you only get a report on the number of messages, not their 
storage size etc - but perhaps that is sufficient for your needs?


Hope this helps, and thank you for using RabbitMQ,


Matthias.



From matt at meez.com  Mon Nov  5 19:26:45 2007
From: matt at meez.com (matt)
Date: Mon, 5 Nov 2007 11:26:45 -0800
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <472F5EDE.6070805@lshift.net>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
Message-ID: <AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>

Getting the message count only appears to get updated when you declare  
the queue.  What if you wanted to poll the queue and see how many  
messages were on it every 15 seconds or so?  Creating a new binding to  
the queue just to get the message count seems a bit expensive.

The main reason for wanting the message count is so that we can  
determine if we need to bring more consumer instances online when  
we're getting hammered (EC2 instances currently).

thx,
-matt

On Nov 5, 2007, at 10:20 AM, Matthias Radestock wrote:

> Matt,
>
> matt wrote:
>> First off, I want to say how much we love amqp and rabbitMQ!
>
> Thank you. It is always nice to hear from real users.
>
>> We've ( meez.com) been using it in our production environment (when
>> it was alpha) for about 6 months now I think.
>> In brief, we use rabbitMQ as a way of communicating with our
>> rendering cluster.  We have user facing tomcat servers that provide a
>> way of giving the user options to create an avatar.  Upon save, we
>> send export requests via rabbitMQ and they're picked up by nodes in
>> the export cloud.  Upon success of the rendered images, a
>> notification is sent back and the user is notified that the exports
>> were successful.
>
> That is a pretty neat use case, and it is good to hear that RabbitMQ
> worked out well for you.
>
>> the big immediate need we're looking for is a way to see how much is
>> being queued up on the rabbitMQ cluster.  That way, we can
>> programatically bring EC2 nodes up or take then down based on need.
>> I know that this is in the pipeline - but is there *any* way of doing
>> this now and/or is there something that could be easily added to  
>> support this?
>
> queue.declare-ok, the result of a queue.declare operation, in one of  
> its fields contains the number of messages in the queue. This is  
> part of the amqp 0-8 spec and implemented by RabbitMQ. In  
> combination with queue.declare's passive flag it allows you to  
> determine the length of existing queues.
>
> If you are using the RabbitMQ Java client, check out
> http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/ChannelN.html#queueDeclare(int,%20java.lang.String,%20boolean,%20boolean,%20boolean,%20boolean,%20java.util.Map) 
> ,
> and
> http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/AMQImpl.Queue.DeclareOk.html#getMessageCount()
>
> This is only a very limited interface - you need to know the names  
> of queues and you only get a report on the number of messages, not  
> their storage size etc - but perhaps that is sufficient for your  
> needs?
>
>
> Hope this helps, and thank you for using RabbitMQ,
>
>
> Matthias.


--
Matt Darling
Director, Server Engineering
Meez
182 2nd Street, 5th Floor
San Francisco, CA 94105
(m) 415.505.4623
matt at corp.meez.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071105/2f6aa72a/attachment.htm 

From matthias at lshift.net  Mon Nov  5 23:22:22 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 05 Nov 2007 23:22:22 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
Message-ID: <472FA5AE.8000004@lshift.net>

Matt,


matt wrote:
> Getting the message count only appears to get updated when you declare 
> the queue.  What if you wanted to poll the queue and see how many 
> messages were on it every 15 seconds or so?

queue.declare has a passive mode of operation where it doesn't actually 
create a new queue. That's what I was referring to when I wrote that "in 
combination with queue.declare's passive flag it allows you to determine 
the length of existing queues".


Matthias.



From ellisonbg.net at gmail.com  Mon Nov  5 23:24:48 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Mon, 5 Nov 2007 16:24:48 -0700
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <472FA5AE.8000004@lshift.net>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
Message-ID: <6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>

On a related note, is there a way of querying the server to get the
names of all the queues?

Thanks

Brian

On 11/5/07, Matthias Radestock <matthias at lshift.net> wrote:
> Matt,
>
>
> matt wrote:
> > Getting the message count only appears to get updated when you declare
> > the queue.  What if you wanted to poll the queue and see how many
> > messages were on it every 15 seconds or so?
>
> queue.declare has a passive mode of operation where it doesn't actually
> create a new queue. That's what I was referring to when I wrote that "in
> combination with queue.declare's passive flag it allows you to determine
> the length of existing queues".
>
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matt at corp.meez.com  Tue Nov  6 00:10:17 2007
From: matt at corp.meez.com (matt)
Date: Mon, 5 Nov 2007 16:10:17 -0800
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <472FA5AE.8000004@lshift.net>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
Message-ID: <3805BEEE-9ADF-469D-A0C1-7B4BB9730CFC@corp.meez.com>

Sorry, I missed that important piece. :)  Works great!

Thx

-matt

On Nov 5, 2007, at 3:22 PM, Matthias Radestock wrote:

> Matt,
>
>
> matt wrote:
>> Getting the message count only appears to get updated when you  
>> declare the queue.  What if you wanted to poll the queue and see  
>> how many messages were on it every 15 seconds or so?
>
> queue.declare has a passive mode of operation where it doesn't  
> actually create a new queue. That's what I was referring to when I  
> wrote that "in combination with queue.declare's passive flag it  
> allows you to determine the length of existing queues".
>
>
> Matthias.


--
Matt Darling
Director, Server Engineering
Meez
182 2nd Street, 5th Floor
San Francisco, CA 94105
(m) 415.505.4623
matt at corp.meez.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071105/92cd732d/attachment.htm 

From alexis.richardson at cohesiveft.com  Tue Nov  6 15:17:15 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 6 Nov 2007 15:17:15 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
Message-ID: <167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>

Brian

Not yet, I'm afraid :-(

Management features are due in a future version of AMQP.  How
important is this for you today?

alexis


On 11/5/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> On a related note, is there a way of querying the server to get the
> names of all the queues?
>
> Thanks
>
> Brian
>
> On 11/5/07, Matthias Radestock <matthias at lshift.net> wrote:
> > Matt,
> >
> >
> > matt wrote:
> > > Getting the message count only appears to get updated when you declare
> > > the queue.  What if you wanted to poll the queue and see how many
> > > messages were on it every 15 seconds or so?
> >
> > queue.declare has a passive mode of operation where it doesn't actually
> > create a new queue. That's what I was referring to when I wrote that "in
> > combination with queue.declare's passive flag it allows you to determine
> > the length of existing queues".
> >
> >
> > Matthias.
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From simon at lshift.net  Tue Nov  6 17:43:11 2007
From: simon at lshift.net (Simon MacMullen)
Date: Tue, 06 Nov 2007 17:43:11 +0000
Subject: [rabbitmq-discuss] HTTP client release
Message-ID: <4730A7AF.1070709@lshift.net>

I've just made another snapshot release of the HTTP client. This 
consists of an AMQP-over-HTTP protocol binding for RabbitMQ and some 
Javascript libraries for interacting with RabbitMQ over HTTP.

This is still experimental code.

The client can be downloaded from:

http://www.rabbitmq.com/download.html#rabbitmq-http

It currently depends on the broker from CVS HEAD. A suitable snapshot is 
available at:

http://dev.rabbitmq.com/snapshots/rabbitmq/rabbitmq-200710291145.tar.gz

Please note that the client has moved from darcs to monotone for version 
control.

Cheers, Simon

-- 
   [][][] Simon MacMullen
     [][] LShift Ltd
   []  [] www.lshift.net



From ellisonbg.net at gmail.com  Tue Nov  6 18:01:46 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Tue, 6 Nov 2007 11:01:46 -0700
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
Message-ID: <6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>

I am evaluating rabbitmq/amqp to see if it would do what we need it
to.  Our system has a worker/master architecture and we would like to
use rabbitmq for the master<-> worker messaging.  There are a few
constraints in our system though:

- workers come and go at any time.
- each worker needs a private queue - the master process needs to be
able to see which workers are currently connected.  My initial thought
is that this could be accomplished by the master getting a list of
queues.

My current thought is to have a separate queue that workers use to
register/unregister themselves.  They could put the name of their
private queue on this registration queue.

But, it would be nice to have more introspection capabilities.

Thanks

Brian

On 11/6/07, Alexis Richardson <alexis.richardson at cohesiveft.com> wrote:
> Brian
>
> Not yet, I'm afraid :-(
>
> Management features are due in a future version of AMQP.  How
> important is this for you today?
>
> alexis
>
>
> On 11/5/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> > On a related note, is there a way of querying the server to get the
> > names of all the queues?
> >
> > Thanks
> >
> > Brian
> >
> > On 11/5/07, Matthias Radestock <matthias at lshift.net> wrote:
> > > Matt,
> > >
> > >
> > > matt wrote:
> > > > Getting the message count only appears to get updated when you declare
> > > > the queue.  What if you wanted to poll the queue and see how many
> > > > messages were on it every 15 seconds or so?
> > >
> > > queue.declare has a passive mode of operation where it doesn't actually
> > > create a new queue. That's what I was referring to when I wrote that "in
> > > combination with queue.declare's passive flag it allows you to determine
> > > the length of existing queues".
> > >
> > >
> > > Matthias.
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
>
> --
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>



From alexis.richardson at cohesiveft.com  Tue Nov  6 18:13:17 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 6 Nov 2007 18:13:17 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
	<6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
Message-ID: <167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>

Brian

Thanks for your note - that helps.

On 11/6/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> I am evaluating rabbitmq/amqp to see if it would do what we need it
> to.  Our system has a worker/master architecture and we would like to
> use rabbitmq for the master<-> worker messaging.

Great :-)

Work queues are a common pattern and we would love to hear how you get on.



> There are a few
> constraints in our system though:
>
> - workers come and go at any time.

Indeed this is also a common situation when you want your system to be
robust - as I assume you do.  Some of this will be supported more
'inherently' in future versions of AMQP, eg for federations of
brokers.  But I think there is enough in RabbitMQ as it is today, and
as it currently clusters, to get you going.


> - each worker needs a private queue

Is that strictly needed for your use case?

You could have workers in groups, sharing a queue on a round robin
basis.  Then they can 'pull' work and no registry is needed.


> - the master process needs to be
> able to see which workers are currently connected.

Yes - if you want to 'push' work and each worker must have a private queue.


> My initial thought
> is that this could be accomplished by the master getting a list of
> queues.

Got it.


> My current thought is to have a separate queue that workers use to
> register/unregister themselves.  They could put the name of their
> private queue on this registration queue.

I would certainly do this if you want to 'push' work.  In effect you
are making the registry explicit and this would be very useful for
other implementation patterns, eg shared services 'fed' by queues (a
bit like an 'ESB').


> But, it would be nice to have more introspection capabilities.

I wholly agree!

alexis





>
> Thanks
>
> Brian
>
> On 11/6/07, Alexis Richardson <alexis.richardson at cohesiveft.com> wrote:
> > Brian
> >
> > Not yet, I'm afraid :-(
> >
> > Management features are due in a future version of AMQP.  How
> > important is this for you today?
> >
> > alexis
> >
> >
> > On 11/5/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> > > On a related note, is there a way of querying the server to get the
> > > names of all the queues?
> > >
> > > Thanks
> > >
> > > Brian
> > >
> > > On 11/5/07, Matthias Radestock <matthias at lshift.net> wrote:
> > > > Matt,
> > > >
> > > >
> > > > matt wrote:
> > > > > Getting the message count only appears to get updated when you declare
> > > > > the queue.  What if you wanted to poll the queue and see how many
> > > > > messages were on it every 15 seconds or so?
> > > >
> > > > queue.declare has a passive mode of operation where it doesn't actually
> > > > create a new queue. That's what I was referring to when I wrote that "in
> > > > combination with queue.declare's passive flag it allows you to determine
> > > > the length of existing queues".
> > > >
> > > >
> > > > Matthias.
> > > >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> >
> >
> > --
> > Alexis Richardson
> > +44 20 7617 7339 (UK)
> > +44 77 9865 2911 (cell)
> > +1 650 206 2517 (US)
> >
>


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From ellisonbg.net at gmail.com  Tue Nov  6 20:02:47 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Tue, 6 Nov 2007 13:02:47 -0700
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
	<6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
Message-ID: <6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>

> Brian
>
> Thanks for your note - that helps.

No problem.

> On 11/6/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> > I am evaluating rabbitmq/amqp to see if it would do what we need it
> > to.  Our system has a worker/master architecture and we would like to
> > use rabbitmq for the master<-> worker messaging.
>
> Great :-)
>
> Work queues are a common pattern and we would love to hear how you get on.

As I move forward I will let you know how it goes.

>
>
> > There are a few
> > constraints in our system though:
> >
> > - workers come and go at any time.
>
> Indeed this is also a common situation when you want your system to be
> robust - as I assume you do.  Some of this will be supported more
> 'inherently' in future versions of AMQP, eg for federations of
> brokers.  But I think there is enough in RabbitMQ as it is today, and
> as it currently clusters, to get you going.

This is definitely a very common pattern - although our system has a
few unusual properties (more on that below)

>
> > - each worker needs a private queue
>
> Is that strictly needed for your use case?

Yes, each worker does need a private queue so workers can directly
send messages to a given worker.  But, it gets more complicated than
that in a number of ways:

- The master needs to be able to push messages to arbitrary sets of
workers.  Our general syntax (our master in written in python) looks
like this:

push(list_of_workers, msg)

So you see things like this:

push(getIDs(), msg)  that does a broadcast or:

push(range(10), msg) that pushes to workers 0,1,...10

- Obviously, when pushing messages to specific workers, you can't do
dynamic load balancing.  To support dynamic load balancing we have
another single shared FIFO queue that sits on top of the private
worker queues.  We have a scheduler that pulls things off the shared
queue and puts them on the private queues, based on how many messages
there are in the private queues at any given moment.  I am not sure if
rabbitmq/amqp will be able to handle this more complex queue logic as
it would require logic *in* the rabbitmq server......

So, the next question is ..... how easy it is to build custom rabbitmq
servers that have custom queue logic.  Basically, I need queues to be
able to act as clients to other queues.

Currently we have implemented this system using twisted (an
asynchronous networking framework in python).  It works extremely
well....but it doesn't scale to  a large number of workers, which is
why we are looking at erlang/amqp.  It might be the case that we need
to implement our server at a lower level in erlang, but I really like
rabbitmq/amqp.

Any ideas you have about how to approach this would be greatly appreciated.

> You could have workers in groups, sharing a queue on a round robin
> basis.  Then they can 'pull' work and no registry is needed.

We have thought about things like this, but we would still need to
have the push mode as well.

>
> > - the master process needs to be
> > able to see which workers are currently connected.
>
> Yes - if you want to 'push' work and each worker must have a private queue.
>
>
> > My initial thought
> > is that this could be accomplished by the master getting a list of
> > queues.
>
> Got it.
>
>
> > My current thought is to have a separate queue that workers use to
> > register/unregister themselves.  They could put the name of their
> > private queue on this registration queue.
>
> I would certainly do this if you want to 'push' work.  In effect you
> are making the registry explicit and this would be very useful for
> other implementation patterns, eg shared services 'fed' by queues (a
> bit like an 'ESB').

OK, it is good to know that I am on the right track.

Thanks

Brian

>
> > But, it would be nice to have more introspection capabilities.
>
> I wholly agree!
>
> alexis
>
>
>
>
>
> >
> > Thanks
> >
> > Brian
> >
> > On 11/6/07, Alexis Richardson <alexis.richardson at cohesiveft.com> wrote:
> > > Brian
> > >
> > > Not yet, I'm afraid :-(
> > >
> > > Management features are due in a future version of AMQP.  How
> > > important is this for you today?
> > >
> > > alexis
> > >
> > >
> > > On 11/5/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> > > > On a related note, is there a way of querying the server to get the
> > > > names of all the queues?
> > > >
> > > > Thanks
> > > >
> > > > Brian
> > > >
> > > > On 11/5/07, Matthias Radestock <matthias at lshift.net> wrote:
> > > > > Matt,
> > > > >
> > > > >
> > > > > matt wrote:
> > > > > > Getting the message count only appears to get updated when you declare
> > > > > > the queue.  What if you wanted to poll the queue and see how many
> > > > > > messages were on it every 15 seconds or so?
> > > > >
> > > > > queue.declare has a passive mode of operation where it doesn't actually
> > > > > create a new queue. That's what I was referring to when I wrote that "in
> > > > > combination with queue.declare's passive flag it allows you to determine
> > > > > the length of existing queues".
> > > > >
> > > > >
> > > > > Matthias.
> > > > >
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > >
> > > >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >
> > >
> > >
> > > --
> > > Alexis Richardson
> > > +44 20 7617 7339 (UK)
> > > +44 77 9865 2911 (cell)
> > > +1 650 206 2517 (US)
> > >
> >
>
>
> --
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>



From codewalkerjoe at gmail.com  Tue Nov  6 21:51:00 2007
From: codewalkerjoe at gmail.com (joe lee)
Date: Tue, 6 Nov 2007 16:51:00 -0500
Subject: [rabbitmq-discuss] Starting RabbitMQ-Server and message storage
Message-ID: <50ec7a2e0711061351y4850a057v98be5423625475ff@mail.gmail.com>

When I start the server on the command line with "rabbitmq-server",
will the messages be kept in memory or disk?  Is there a way to
specify type of message storage at the command line?

On the dos prompt, if I do ctrl+c, does it mean all the messages will
be lost when the server restarted at some point?

Thanks,
joe



From tonyg at lshift.net  Wed Nov  7 12:58:13 2007
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 07 Nov 2007 12:58:13 +0000
Subject: [rabbitmq-discuss] Starting RabbitMQ-Server and message storage
In-Reply-To: <50ec7a2e0711061351y4850a057v98be5423625475ff@mail.gmail.com>
References: <50ec7a2e0711061351y4850a057v98be5423625475ff@mail.gmail.com>
Message-ID: <4731B665.1020707@lshift.net>

Hi Joe,

joe lee wrote:
> When I start the server on the command line with "rabbitmq-server",
> will the messages be kept in memory or disk?  Is there a way to
> specify type of message storage at the command line?

The server makes available both in-memory and on-disk storage to
clients. Which is used depends on both (a) the "durability" setting of
the queue concerned, and (b) the "delivery mode" property of Basic messages.

Messages will be stored in memory if EITHER the queue is declared with
"durable" set false OR the message is published with "delivery mode"
missing or set to non-persistent (= 1).

Messages will be stored on disk if BOTH the queue is declared with
"durable" set true AND the message is published with "delivery mode"
present and set to persistent (= 2).

Here's an example of publishing a persistent message to a durable queue,
using RabbitMQ's Java API:

  // The "true" below makes the queue durable.

  myChannel.queueDeclare(ticket, "queuename", true);

  // The MessageProperties.PERSISTENT_TEXT_PLAIN is a useful
  // preallocated BasicProperties instance that has a text/plain
  // content-type and a delivery mode of 2 (== persistent).

  myChannel.basicPublish(ticket, "", "queuename",
                         MessageProperties.PERSISTENT_TEXT_PLAIN,
                         "hello, world".getBytes("UTF-8"));


> On the dos prompt, if I do ctrl+c, does it mean all the messages will
> be lost when the server restarted at some point?

Only those in memory. Also, all non-durable queues will be lost. Durable
queues, however, should survive server restarts, as should persistent
messages held by durable queues.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From alexis.richardson at cohesiveft.com  Wed Nov  7 17:58:18 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 7 Nov 2007 17:58:18 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
	<6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
	<6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
Message-ID: <167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>

Brian


On 11/6/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
>
> our system has a
> few unusual properties (more on that below)
>
> > > - each worker needs a private queue
> >
> > Is that strictly needed for your use case?
>
> Yes, each worker does need a private queue so workers can directly
> send messages to a given worker.  But, it gets more complicated than
> that in a number of ways:
>
> - The master needs to be able to push messages to arbitrary sets of
> workers.  Our general syntax (our master in written in python) looks
> like this:
>
> push(list_of_workers, msg)
>
> So you see things like this:
>
> push(getIDs(), msg)  that does a broadcast or:
>
> push(range(10), msg) that pushes to workers 0,1,...10

OK, this is good.  I assume you also have queues for work done
(results) and work in progress (lease-based?).


> - Obviously, when pushing messages to specific workers, you can't do
> dynamic load balancing.  To support dynamic load balancing we have
> another single shared FIFO queue that sits on top of the private
> worker queues.  We have a scheduler that pulls things off the shared
> queue and puts them on the private queues, based on how many messages
> there are in the private queues at any given moment.

Got it.


> I am not sure if
> rabbitmq/amqp will be able to handle this more complex queue logic as
> it would require logic *in* the rabbitmq server......
>
> So, the next question is ..... how easy it is to build custom rabbitmq
> servers that have custom queue logic.  Basically, I need queues to be
> able to act as clients to other queues.

OK, there are at least three answers to this question :-)

1. You can do this today by running a scheduler that is a regular
client and acts both as a producer and a consumer.  You may have
latency concerns if your units of work are fine grained (say <10ms
total work time per task).  If you do not, then I would recommend
looking at this as a solution.  If you do have latency concerns then I
would still start here as a prototype since you will be able to verify
that it scales.   By the way, you can also improve latency by
colocating processes (or using a single process - see 3 below).

2. Future versions of AMQP will support 'chaining' of brokers and
federation better.  Solutions of type 1 will, most likely, be able to
gracefully adopt the likely new features at low cost.

3. You can mod the broker by running 'in broker consumers' and 'in
broker producers'.  This is a very interesting area for future work
but it would require a knowledge of Erlang.  We would be happy to help
on list.  However if this is your goal then I would still start at 1
(which also lets you try out multiple brokers and remain
interoperability-compliant).



> Currently we have implemented this system using twisted (an
> asynchronous networking framework in python).  It works extremely
> well....but it doesn't scale to  a large number of workers, which is
> why we are looking at erlang/amqp.

Interesting stuff - how many workers?  (If that's not an impertinent
question ..)


>  It might be the case that we need
> to implement our server at a lower level in erlang, but I really like
> rabbitmq/amqp.

Thank-you very much.  I hope we can help you avoid having to care
about the lower levels.


> > I would certainly do this if you want to 'push' work.  In effect you
> > are making the registry explicit and this would be very useful for
> > other implementation patterns, eg shared services 'fed' by queues (a
> > bit like an 'ESB').
>
> OK, it is good to know that I am on the right track.

Cool.  Please let us know if you need help, eg with the deregistration methods.

alexis














>
> Thanks
>
> Brian
>
> >
> > > But, it would be nice to have more introspection capabilities.
> >
> > I wholly agree!
> >
> > alexis
> >
> >
> >
> >
> >
> > >
> > > Thanks
> > >
> > > Brian
> > >
> > > On 11/6/07, Alexis Richardson <alexis.richardson at cohesiveft.com> wrote:
> > > > Brian
> > > >
> > > > Not yet, I'm afraid :-(
> > > >
> > > > Management features are due in a future version of AMQP.  How
> > > > important is this for you today?
> > > >
> > > > alexis
> > > >
> > > >
> > > > On 11/5/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> > > > > On a related note, is there a way of querying the server to get the
> > > > > names of all the queues?
> > > > >
> > > > > Thanks
> > > > >
> > > > > Brian
> > > > >
> > > > > On 11/5/07, Matthias Radestock <matthias at lshift.net> wrote:
> > > > > > Matt,
> > > > > >
> > > > > >
> > > > > > matt wrote:
> > > > > > > Getting the message count only appears to get updated when you declare
> > > > > > > the queue.  What if you wanted to poll the queue and see how many
> > > > > > > messages were on it every 15 seconds or so?
> > > > > >
> > > > > > queue.declare has a passive mode of operation where it doesn't actually
> > > > > > create a new queue. That's what I was referring to when I wrote that "in
> > > > > > combination with queue.declare's passive flag it allows you to determine
> > > > > > the length of existing queues".
> > > > > >
> > > > > >
> > > > > > Matthias.
> > > > > >
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > >
> > > > >
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > >
> > > >
> > > >
> > > > --
> > > > Alexis Richardson
> > > > +44 20 7617 7339 (UK)
> > > > +44 77 9865 2911 (cell)
> > > > +1 650 206 2517 (US)
> > > >
> > >
> >
> >
> > --
> > Alexis Richardson
> > +44 20 7617 7339 (UK)
> > +44 77 9865 2911 (cell)
> > +1 650 206 2517 (US)
> >
>


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From ellisonbg.net at gmail.com  Wed Nov  7 20:42:03 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Wed, 7 Nov 2007 13:42:03 -0700
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
	<6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
	<6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
	<167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>
Message-ID: <6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>

Alexis,

On 11/7/07, Alexis Richardson <alexis.richardson at cohesiveft.com> wrote:
> Brian
>
>
> On 11/6/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> >
> > our system has a
> > few unusual properties (more on that below)
> >
> > > > - each worker needs a private queue
> > >
> > > Is that strictly needed for your use case?
> >
> > Yes, each worker does need a private queue so workers can directly
> > send messages to a given worker.  But, it gets more complicated than
> > that in a number of ways:
> >
> > - The master needs to be able to push messages to arbitrary sets of
> > workers.  Our general syntax (our master in written in python) looks
> > like this:
> >
> > push(list_of_workers, msg)
> >
> > So you see things like this:
> >
> > push(getIDs(), msg)  that does a broadcast or:
> >
> > push(range(10), msg) that pushes to workers 0,1,...10
>
> OK, this is good.  I assume you also have queues for work done
> (results) and work in progress (lease-based?).

Yep, these queues would also have to be there.


> > So, the next question is ..... how easy it is to build custom rabbitmq
> > servers that have custom queue logic.  Basically, I need queues to be
> > able to act as clients to other queues.
>
> OK, there are at least three answers to this question :-)
>
> 1. You can do this today by running a scheduler that is a regular
> client and acts both as a producer and a consumer.  You may have
> latency concerns if your units of work are fine grained (say <10ms
> total work time per task).  If you do not, then I would recommend
> looking at this as a solution.  If you do have latency concerns then I
> would still start here as a prototype since you will be able to verify
> that it scales.   By the way, you can also improve latency by
> colocating processes (or using a single process - see 3 below).

The other option that is related to this one would be to have each
worker pull from both its private queue and the shared one.  I would
just need to make some decisions about which has priority in given
situations.  Unfortunately, latency is a big issue for us - the lower
the better.

> 2. Future versions of AMQP will support 'chaining' of brokers and
> federation better.  Solutions of type 1 will, most likely, be able to
> gracefully adopt the likely new features at low cost.

I see.  That would be fantastic, as long as the chaining was
relatively flexible.

> 3. You can mod the broker by running 'in broker consumers' and 'in
> broker producers'.  This is a very interesting area for future work
> but it would require a knowledge of Erlang.  We would be happy to help
> on list.  However if this is your goal then I would still start at 1
> (which also lets you try out multiple brokers and remain
> interoperability-compliant).

I don't mind learning Erlang if it is needed.  My other option is to
just write a custom solution from scratch in Erlang.  But rabbitmq
seems to have many of the pieces already, so I would really like to
use it if possible.  Thanks for the offer of help - I will keep you
posted.

> > Currently we have implemented this system using twisted (an
> > asynchronous networking framework in python).  It works extremely
> > well....but it doesn't scale to  a large number of workers, which is
> > why we are looking at erlang/amqp.
>
> Interesting stuff - how many workers?  (If that's not an impertinent
> question ..)

We are using this architecture for parallel computing in Python.  Our
workers are basically Python interpreters exposed to the network.  Our
"clients" are also python scripts that submit python code/objects to
the workers to be performed.  As you can imagine I am looking at the
qpid python amqp client.  We have run already with up to 256 workers
and we already see scaling problems.  Our stuff works just fine on
supercomputers, so we would like to scale up to.....2**10, 2**11,
2**12, etc.  We hit scaling problems in a number of ways:

1) # of file descriptors per process.
2) broadcasting/multicasting to all (or large subsets) of workers.
3) Latency - the latency determines the grain size of work, which we
would like to be as small as possible.
4) Large messages.  In some cases, the messages can be very large
(files or large data sets).  It is not uncommon for people to want to
distribute 100 MB messages to subsets of workers.  Our current
solution generates a short lived temporary copy of the large objects
for each worker they are sent to.  This means if we have 128 workers,
we use 128*msg_size memory for a short period of time.  We know how to
fix this in Python, but it still doesn't solve the other scalability
problems.  All that to say, any solution that we come up with must
also be able to handle large messages well.  Does rabbitmq have any
streaming support?

>
> >  It might be the case that we need
> > to implement our server at a lower level in erlang, but I really like
> > rabbitmq/amqp.
>
> Thank-you very much.  I hope we can help you avoid having to care
> about the lower levels.

I would love to avoid the lower level stuff, but I also realize we
have a somewhat unusual set of design requirements (scalability,
low-latency && ability to handle large messages).  In various
prototypes we even implemented custom protocols on top of TCP.  Once
you start doing that Erlang becomes a "high-level" solution :)

>
> > > I would certainly do this if you want to 'push' work.  In effect you
> > > are making the registry explicit and this would be very useful for
> > > other implementation patterns, eg shared services 'fed' by queues (a
> > > bit like an 'ESB').
> >
> > OK, it is good to know that I am on the right track.
>
> Cool.  Please let us know if you need help, eg with the deregistration methods.

Ahh yes, the deregistration methods could be subtle.  The main concern
there is if a worker dies without notifying the server that they are
going to die.  What facilities does rabbitmq/amqp have to handle this
type of stuff?

Thanks much for your help!

Brian


> alexis
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> >
> > Thanks
> >
> > Brian
> >
> > >
> > > > But, it would be nice to have more introspection capabilities.
> > >
> > > I wholly agree!
> > >
> > > alexis
> > >
> > >
> > >
> > >
> > >
> > > >
> > > > Thanks
> > > >
> > > > Brian
> > > >
> > > > On 11/6/07, Alexis Richardson <alexis.richardson at cohesiveft.com> wrote:
> > > > > Brian
> > > > >
> > > > > Not yet, I'm afraid :-(
> > > > >
> > > > > Management features are due in a future version of AMQP.  How
> > > > > important is this for you today?
> > > > >
> > > > > alexis
> > > > >
> > > > >
> > > > > On 11/5/07, Brian Granger <ellisonbg.net at gmail.com> wrote:
> > > > > > On a related note, is there a way of querying the server to get the
> > > > > > names of all the queues?
> > > > > >
> > > > > > Thanks
> > > > > >
> > > > > > Brian
> > > > > >
> > > > > > On 11/5/07, Matthias Radestock <matthias at lshift.net> wrote:
> > > > > > > Matt,
> > > > > > >
> > > > > > >
> > > > > > > matt wrote:
> > > > > > > > Getting the message count only appears to get updated when you declare
> > > > > > > > the queue.  What if you wanted to poll the queue and see how many
> > > > > > > > messages were on it every 15 seconds or so?
> > > > > > >
> > > > > > > queue.declare has a passive mode of operation where it doesn't actually
> > > > > > > create a new queue. That's what I was referring to when I wrote that "in
> > > > > > > combination with queue.declare's passive flag it allows you to determine
> > > > > > > the length of existing queues".
> > > > > > >
> > > > > > >
> > > > > > > Matthias.
> > > > > > >
> > > > > > > _______________________________________________
> > > > > > > rabbitmq-discuss mailing list
> > > > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > > >
> > > > > >
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > >
> > > > >
> > > > >
> > > > > --
> > > > > Alexis Richardson
> > > > > +44 20 7617 7339 (UK)
> > > > > +44 77 9865 2911 (cell)
> > > > > +1 650 206 2517 (US)
> > > > >
> > > >
> > >
> > >
> > > --
> > > Alexis Richardson
> > > +44 20 7617 7339 (UK)
> > > +44 77 9865 2911 (cell)
> > > +1 650 206 2517 (US)
> > >
> >
>
>
> --
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>



From 0x6e6562 at gmail.com  Wed Nov  7 23:21:05 2007
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 7 Nov 2007 23:21:05 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472F5EDE.6070805@lshift.net>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
	<6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
	<6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
	<167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>
	<6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>
Message-ID: <6293B9A7-B08B-4BE4-A1B3-2215AB887D3D@gmail.com>

Brian,

On 7 Nov 2007, at 20:42, Brian Granger wrote:
>>>
>>> Yes, each worker does need a private queue so workers can directly
>>> send messages to a given worker.  But, it gets more complicated than
>>> that in a number of ways:
>>>
>>> - The master needs to be able to push messages to arbitrary sets of
>>> workers.  Our general syntax (our master in written in python) looks
>>> like this:
>>>
>>> push(list_of_workers, msg)
>>>
>>> So you see things like this:
>>>
>>> push(getIDs(), msg)  that does a broadcast or:
>>>
>>> push(range(10), msg) that pushes to workers 0,1,...10

I've been following this thread but I don't think I've understood  
everything completely.

Can you clarify what it is about your system that requires the  
workflow to be producer driven and consumer driven? Are the  
interactions stateful in any way? Or am I missing the point?

Ben



From ellisonbg.net at gmail.com  Wed Nov  7 23:58:57 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Wed, 7 Nov 2007 16:58:57 -0700
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <6293B9A7-B08B-4BE4-A1B3-2215AB887D3D@gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
	<6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
	<6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
	<167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>
	<6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>
	<6293B9A7-B08B-4BE4-A1B3-2215AB887D3D@gmail.com>
Message-ID: <6ce0ac130711071558m1f41a068u4d54861354c12f7@mail.gmail.com>

> Can you clarify what it is about your system that requires the
> workflow to be producer driven and consumer driven? Are the
> interactions stateful in any way? Or am I missing the point?

We have different types of queues and there needs to be somewhat
complex logic that moves (consumes) messages from certain shared
queues into (publish) other private ones.  In pseudo code it looks
something like:

if private_queue = move_message():
    msg = shared_queue.consume()
    private_queue.publish(msg)

The important point is that the result of move_message() is very
dynamic.  That is, it depends on things like 1) the number of private
queues 2) the number of messages in those queues currently 3) the
particular resources and characteristics of the consumers of the
private queues (how much RAM they have, available libraries, etc.)

Now you may wonder why we would want this.  We have two types of
messages: 1) messages that need to be sent to a particular client and
2) messages that can be sent to any one client.  In this second case,
we typically want to send the message to the least loaded client.  Our
messages are packets of work that the clients (they are workers)
perform.  We use the shared queue to perform dynamical load balancing
for work that can be performed by any qualified worker.  But that work
still has to go through the private queues to preserve ordering.

Does this make a bit more sense?

Thanks

Brian

> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From 0x6e6562 at gmail.com  Thu Nov  8 00:08:55 2007
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 8 Nov 2007 00:08:55 +0000
Subject: [rabbitmq-discuss]  Queue inspector.
References: <55936279-4366-418F-A7F9-5E85B112CABB@gmail.com>
Message-ID: <27292330-DC99-43AB-ACD3-057E45E63C6D@gmail.com>


>
>> Now you may wonder why we would want this.  We have two types of
>> messages: 1) messages that need to be sent to a particular client and
>> 2) messages that can be sent to any one client.  In this second case,
>> we typically want to send the message to the least loaded client.   
>> Our
>> messages are packets of work that the clients (they are workers)
>> perform.  We use the shared queue to perform dynamical load balancing
>> for work that can be performed by any qualified worker.  But that  
>> work
>> still has to go through the private queues to preserve ordering.
>>
>> Does this make a bit more sense?
>
> Do your clients do anything contextually specific to the producer or  
> is it just that the work needs to get load balanced dynamically  
> according to the resources available to any given consumer?
>
> Ben




From 0x6e6562 at gmail.com  Thu Nov  8 06:58:57 2007
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 8 Nov 2007 06:58:57 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <6ce0ac130711071936y7b146514nf04d4846067d8742@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
	<6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
	<6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
	<167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>
	<6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>
	<6293B9A7-B08B-4BE4-A1B3-2215AB887D3D@gmail.com>
	<6ce0ac130711071558m1f41a068u4d54861354c12f7@mail.gmail.com>
	<55936279-4366-418F-A7F9-5E85B112CABB@gmail.com>
	<6ce0ac130711071936y7b146514nf04d4846067d8742@mail.gmail.com>
Message-ID: <B8546ED5-03DA-471A-9E92-FDEF17B9A575@gmail.com>


On 8 Nov 2007, at 03:36, Brian Granger wrote:

> On Nov 7, 2007 5:08 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>>> Now you may wonder why we would want this.  We have two types of
>>> messages: 1) messages that need to be sent to a particular client  
>>> and
>>> 2) messages that can be sent to any one client.  In this second  
>>> case,
>>> we typically want to send the message to the least loaded client.   
>>> Our
>>> messages are packets of work that the clients (they are workers)
>>> perform.  We use the shared queue to perform dynamical load  
>>> balancing
>>> for work that can be performed by any qualified worker.  But that  
>>> work
>>> still has to go through the private queues to preserve ordering.
>>>
>>> Does this make a bit more sense?
>>
>> Do your clients do anything contextually specific to the producer or
>> is it just that the work needs to get load balanced dynamically
>> according to the resources available to any given consumer?
>
> I am not quite sure what you mean here.  But when clients submit work
> to the shared queue, it really is just for load balancing purposes.
> Can you give me an example of what "contextually specific" would mean
> in this case?

What I am trying to get at is find out whether the load balancing  
could just be a concern of the queue infrastructure rather than  
implementing it on the application layer. I am unsure why your  
producers *need* to know about the existence of any consumers to  
achieve your business requirements. Hence I was asking whether it had  
to be producer driven rather than consumer driven. The reason that I  
was imagining why you might want to make it producer driven is if  
there was some kind of conversational state between a producer and a  
consumer. Do you have different message types that can only be  
consumed by certain consumers?

Ben 



From ellisonbg.net at gmail.com  Thu Nov  8 07:30:14 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Thu, 8 Nov 2007 00:30:14 -0700
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <B8546ED5-03DA-471A-9E92-FDEF17B9A575@gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
	<6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
	<167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>
	<6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>
	<6293B9A7-B08B-4BE4-A1B3-2215AB887D3D@gmail.com>
	<6ce0ac130711071558m1f41a068u4d54861354c12f7@mail.gmail.com>
	<55936279-4366-418F-A7F9-5E85B112CABB@gmail.com>
	<6ce0ac130711071936y7b146514nf04d4846067d8742@mail.gmail.com>
	<B8546ED5-03DA-471A-9E92-FDEF17B9A575@gmail.com>
Message-ID: <6ce0ac130711072330x29f948a7u1e82667455706a5e@mail.gmail.com>

> What I am trying to get at is find out whether the load balancing
> could just be a concern of the queue infrastructure rather than
> implementing it on the application layer.

At some level, I would like the load balancing to be handled in the
queue infrastructure, but I am not sure this is possible given our
other requirements....keep reading...

> I am unsure why your
> producers *need* to know about the existence of any consumers to
> achieve your business requirements.

This question definitely makes sense.  In our system some types of
messages can only be consumed by particular workers.  These message
bypass any load balancing.  For these types of messages the producers
do need to be able to do things like 1) discover which consumers are
currently available 2) send messages to specific consumers and 3) get
back results from those consumers.

> Hence I was asking whether it had
> to be producer driven rather than consumer driven.

It is definitely producer driven in the sense the the producer is the
one making decisions about where to send what types of messages.

> The reason that I
> was imagining why you might want to make it producer driven is if
> there was some kind of conversational state between a producer and a
> consumer.

There is definitely conversational state between producers and
particular consumers.  The consumer's also maintain a lot of internal
state.  You could even look at our consumers as state machines that
change state in response to the messages.

> Do you have different message types that can only be
> consumed by certain consumers?

Yep.

Brian

>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From 0x6e6562 at gmail.com  Thu Nov  8 08:42:28 2007
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 8 Nov 2007 08:42:28 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <6ce0ac130711072330x29f948a7u1e82667455706a5e@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
	<6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
	<167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>
	<6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>
	<6293B9A7-B08B-4BE4-A1B3-2215AB887D3D@gmail.com>
	<6ce0ac130711071558m1f41a068u4d54861354c12f7@mail.gmail.com>
	<55936279-4366-418F-A7F9-5E85B112CABB@gmail.com>
	<6ce0ac130711071936y7b146514nf04d4846067d8742@mail.gmail.com>
	<B8546ED5-03DA-471A-9E92-FDEF17B9A575@gmail.com>
	<6ce0ac130711072330x29f948a7u1e82667455706a5e@mail.gmail.com>
Message-ID: <BC176502-A493-44F1-A274-795D7192EA8E@gmail.com>


On 8 Nov 2007, at 07:30, Brian Granger wrote:
> This question definitely makes sense.  In our system some types of
> messages can only be consumed by particular workers.  These message
> bypass any load balancing.  For these types of messages the producers
> do need to be able to do things like 1) discover which consumers are
> currently available 2) send messages to specific consumers and 3) get
> back results from those consumers.

If certain types of messages have to be processed by particular  
consumers, this could be achieved by having consumers bind to  
different queues, I think. It also sounds like a use case for using  
predicates in header based routing, which unfortunately is not  
currently implemented in rabbit.

Point 3 sounds like asynchronous RPC, for which there is already a  
pattern.

Points 1 and 2 sound like they are required to support point 3, but  
I'm still failing to see the concrete business requirement for that,  
but having said that, I don't understand your domain.

>> Hence I was asking whether it had
>> to be producer driven rather than consumer driven.
>
> It is definitely producer driven in the sense the the producer is the
> one making decisions about where to send what types of messages.

Thats why I was asking whether you can turn the decision on it's head  
by just having the producers fire and forget and letting the consumers  
dequeue messages based on some predicate.

>
> There is definitely conversational state between producers and
> particular consumers.  The consumer's also maintain a lot of internal
> state.  You could even look at our consumers as state machines that
> change state in response to the messages.

Fair enough. If you do need to maintain a conversation between a  
producer and consumer over multiple message exchanges then I can see  
why things might have to be determined by the producer.

Ben 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071108/4241865d/attachment.htm 

From matt at meez.com  Thu Nov  8 17:22:11 2007
From: matt at meez.com (matt)
Date: Thu, 8 Nov 2007 09:22:11 -0800
Subject: [rabbitmq-discuss] publish mandatory/immediate flags
Message-ID: <CC6F2F15-D69E-4539-8804-27917E12BBA6@corp.meez.com>

We launched w/ a big partner yesterday (AOL) and we're getting hit  
pretty hard with requests and such and it appears that some requests  
never get made to our export nodes and the responses don't always make  
it back from them at times too.  Seeing that we use rabbitMQ for the  
transport of messages, I have a question regarding the mandatory and  
immediate flags.  One of the basic publish options is as follows:

session.getChannel().basicPublish(session.getTicket(),  
session.getExchange(), key, basicProps, data);

This has mandatory/immediate set to false.  Could it be that the new  
server load is causing requests to get dropped at times?  What are the  
drawbacks to changing those values to true by using the other call?

Thx!

--
Matt Darling
Director, Server Engineering
Meez
182 2nd Street, 5th Floor
San Francisco, CA 94105
(m) 415.505.4623
matt at corp.meez.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071108/2f3736b3/attachment.htm 

From matt at corp.meez.com  Fri Nov  9 04:48:05 2007
From: matt at corp.meez.com (matt)
Date: Thu, 8 Nov 2007 20:48:05 -0800
Subject: [rabbitmq-discuss] Meez status.
Message-ID: <4A46C022-CA6D-4C51-87ED-80D45C9AAEC5@corp.meez.com>

Ok, I think we *might* be out of the woods.  Earlier in the day Alexis  
& Co. told us that publishing on the channel might not be thread safe  
in our application.  We made a change earlier in the day, but it looks  
like it never really made it to production.  Verified this evening  
about an hour ago and now things are running better w/ the sync block  
around on the publish calls.  We think that the frames were getting  
clobbered and as a result killing the connection and giving us socket  
closed exceptions.  We saw this at one point while running the trace:

  Exception in thread "Thread-4"  
com.rabbitmq.client.UnexpectedFrameError
  at com.rabbitmq.client.impl.AMQCommand 
$Assembler.handleFrame(AMQCommand.java:291)
  at com.rabbitmq.tools.Tracer$DirectionHandler.doFrame(Tracer.java:158)
  at com.rabbitmq.tools.Tracer$DirectionHandler.run(Tracer.java:170)
  at java.lang.Thread.run(Thread.java:595)

This was our biggest traffic day in history - a ton of which is coming  
from AOL.  In the last hour or so we've pushed about 48k requests  
through a single broker and the payload is about 5k each.

That said, things are looking better.  Now we have sluggish publish  
times because everyone's blocked on the publish.  However, I think we  
can just create more channels and spread the load that way.  We also  
have a subset of export requests that should get processed first  
before others, so we'll be leveraging the priority level in the  
protocol.  Real excited about that.

Many thanks to the rabbitMQ team.  You guys have a responsiveness  
that's unheard of!

-matt

--
Matt Darling
Director, Server Engineering
Meez
182 2nd Street, 5th Floor
San Francisco, CA 94105
(m) 415.505.4623
matt at corp.meez.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071108/4041391b/attachment.htm 

From matthias at lshift.net  Fri Nov  9 09:17:21 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 09 Nov 2007 09:17:21 +0000
Subject: [rabbitmq-discuss] Meez status.
In-Reply-To: <4A46C022-CA6D-4C51-87ED-80D45C9AAEC5@corp.meez.com>
References: <4A46C022-CA6D-4C51-87ED-80D45C9AAEC5@corp.meez.com>
Message-ID: <473425A1.5080507@lshift.net>

Matt,

matt wrote:
> Ok, I think we *might* be out of the woods.

Excellent. Keep us posted.

> We think that the frames were getting clobbered and 
> as a result killing the connection and giving us socket closed 
> exceptions.

It's not actually the frames themselves that are getting clobbered - 
their assembly and transmission is atomic - but the sequencing of them. 
Some commands, notably basic.publish, span multiple frames. These must 
all be sent back-to-back on the channel, though they can be interleaved 
with frames from other channels on the connection.

When you have multiple threads issuing commands on a channel, and some 
of these commands are multi-frame commands you can get interleaving on 
the channel itself, which results in the UnexpectedFrameError you have seen.

> This was our biggest traffic day in history - a ton of which is coming 
> from AOL.  In the last hour or so we've pushed about 48k requests 
> through a single broker and the payload is about 5k each.
> 
> That said, things are looking better.  Now we have sluggish publish 
> times because everyone's blocked on the publish.

The traffic levels you are reporting - averaging 13.3 msgs/s - are 
nowhere near the capacity of the broker. You should be able to publish 
thousands of messages per second on a single channel. So, with your 
current load, the chances of two publishes contending for the lock 
should actually be quite small.

Perhaps tasks other than the raw basicPublish call, such as preparation 
of the message, are consuming a lot of time?

> We also have a subset of export requests that should get processed
> first before others, so we'll be leveraging the priority level in the
> protocol.

Unfortunately RabbitMQ does not yet support message priorities. It's 
listed as a planned feature at 
http://www.rabbitmq.com/compatibility.html. Let us know if you really 
need it and we will try to add this feature in the next release.

> Many thanks to the rabbitMQ team.  You guys have a responsiveness that's 
> unheard of!  

Glad to have been of assistance.


Regards,

Matthias.



From matthias at lshift.net  Fri Nov  9 11:09:19 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 09 Nov 2007 11:09:19 +0000
Subject: [rabbitmq-discuss] publish mandatory/immediate flags
In-Reply-To: <CC6F2F15-D69E-4539-8804-27917E12BBA6@corp.meez.com>
References: <CC6F2F15-D69E-4539-8804-27917E12BBA6@corp.meez.com>
Message-ID: <47343FDF.5080401@lshift.net>

Matt,

matt wrote:

> I have a question regarding the mandatory and 
> immediate flags.  One of the basic publish options is as follows:
> 
> session.getChannel().basicPublish(session.getTicket(), 
> session.getExchange(), key, basicProps, data);
> 
> This has mandatory/immediate set to false.  Could it be that the new 
> server load is causing requests to get dropped at times?  What are the 
> drawbacks to changing those values to true by using the other call?

With 'mandatory' set to true you will get an asynchronous notification 
when a message cannot be routed to any queue, e.g. because there are no 
queues bound to the exchange, or the routing key matching fails to 
produce a result.

With 'immediate' set to true you will get an asynchronous notification 
when a message cannot be sent to a consumer straight away, i.e. if it 
would be queued. This can happen there are no consumers registered on a 
queue or they are all overloaded.

In the Java client, the notifications are received by the ReturnListener 
set with channel.setReturnListener(listener).

The drawback of setting these flags is an increase in latency and drop 
in throughput, though not by all that much.


Matthias.



From alexis.richardson at cohesiveft.com  Fri Nov  9 11:46:39 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 9 Nov 2007 11:46:39 +0000
Subject: [rabbitmq-discuss] Queue inspector.
In-Reply-To: <6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>
References: <774027CA-57D9-4343-94D2-5129B9C10DA2@corp.meez.com>
	<AD0414EA-3A1A-465D-A5D3-91E91A037AB8@corp.meez.com>
	<472FA5AE.8000004@lshift.net>
	<6ce0ac130711051524s42c92cfy53c41d6aeea9a920@mail.gmail.com>
	<167204d20711060717y8a18786yf8cb867522647341@mail.gmail.com>
	<6ce0ac130711061001i514b18c2qe21c70195dbc3090@mail.gmail.com>
	<167204d20711061013i546692f9h382c6a2b2fb38ca0@mail.gmail.com>
	<6ce0ac130711061202k362ee228kc18329eaf630c455@mail.gmail.com>
	<167204d20711070958x11a2bc6agf3e653e27e839ace@mail.gmail.com>
	<6ce0ac130711071242y60e9ba9ewaab6f77c638cdf5e@mail.gmail.com>
Message-ID: <167204d20711090346k2e4162b0r2ac2a0544c44e03e@mail.gmail.com>

Brian

Very interesting stuff :-)

I'm addressing a subset of your questions since Ben has sensibly
forked off the conversation about conversational messaging.


On Nov 7, 2007 8:42 PM, Brian Granger <ellisonbg.net at gmail.com> wrote:
>
> We are using this architecture for parallel computing in Python.  Our
> workers are basically Python interpreters exposed to the network.  Our
> "clients" are also python scripts that submit python code/objects to
> the workers to be performed.  As you can imagine I am looking at the
> qpid python amqp client.  We have run already with up to 256 workers
> and we already see scaling problems.

Is this with RabbitMQ as is?  Can you shed a little more light on this please.



> Our stuff works just fine on
> supercomputers, so we would like to scale up to.....2**10, 2**11,
> 2**12, etc.  We hit scaling problems in a number of ways:
>
> 1) # of file descriptors per process.
> 2) broadcasting/multicasting to all (or large subsets) of workers.
> 3) Latency - the latency determines the grain size of work, which we
> would like to be as small as possible.

If you could share some of the numbers with the list, that would be
very interesting.


> 4) Large messages.  In some cases, the messages can be very large
> (files or large data sets).  It is not uncommon for people to want to
> distribute 100 MB messages to subsets of workers.  Our current
> solution generates a short lived temporary copy of the large objects
> for each worker they are sent to.  This means if we have 128 workers,
> we use 128*msg_size memory for a short period of time.

Eek.  And does each worker need to have a local copy of the whole
message, every time, to work from?

(As an aside one fun idea we have looked at is bittorrent style
sharing of data between broker peers, essentially implementing a DHT).


> We know how to
> fix this in Python, but it still doesn't solve the other scalability
> problems.  All that to say, any solution that we come up with must
> also be able to handle large messages well.  Does rabbitmq have any
> streaming support?

I shall leave this one for Tony.


> I would love to avoid the lower level stuff, but I also realize we
> have a somewhat unusual set of design requirements (scalability,
> low-latency && ability to handle large messages).  In various
> prototypes we even implemented custom protocols on top of TCP.  Once
> you start doing that Erlang becomes a "high-level" solution :)

Indeed :-)

I still think you should be ok staying above the waterline and coding
to RabbitMQ, at least for now.


> > Cool.  Please let us know if you need help, eg with the deregistration methods.
>
> Ahh yes, the deregistration methods could be subtle.  The main concern
> there is if a worker dies without notifying the server that they are
> going to die.  What facilities does rabbitmq/amqp have to handle this
> type of stuff?

Do you mean in the sense of leasing?  I'll see what we can say about that.

One point to note in passing is that Erlang/OTP provides the notion of
a 'supervisor', see eg here:
http://www.computer.org/portal/site/dsonline/menuitem.9ed3d9924aeb0dcd82ccc6716bbe36ec/index.jsp?&pName=dso_level1&path=dsonline/2007/12&file=w6tow.xml&xsl=article.xsl&;jsessionid=Hp7BjTtbB6JYdhP2H6p6v61x4GFCfp0CF6lXF59Y7dTvjCdGFLPG!1017941068

alexis




-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From 0x6e6562 at gmail.com  Wed Nov 14 07:53:49 2007
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 14 Nov 2007 07:53:49 +0000
Subject: [rabbitmq-discuss] Queue clustering
Message-ID: <277D1A62-DD6D-4EFA-9FD4-00EB527A54A8@gmail.com>

Dear list,

This is probably a stupid question, but why is mnesia not suitable for  
backing queues?

Given that rabbit already uses mnesia to replicate exchange state, and  
that you get a reference to the first and last items of a sorted  
table, is there some obvious problem with using mnesia that I can't see?

Ben



From alexis.richardson at cohesiveft.com  Wed Nov 14 13:14:58 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 14 Nov 2007 13:14:58 +0000
Subject: [rabbitmq-discuss] Queue clustering
In-Reply-To: <277D1A62-DD6D-4EFA-9FD4-00EB527A54A8@gmail.com>
References: <277D1A62-DD6D-4EFA-9FD4-00EB527A54A8@gmail.com>
Message-ID: <167204d20711140514l214a18encbe5a85c7c773e20@mail.gmail.com>

Ben

We used logfiles to persist queues for speed and as a known best practice.

Using mnesia for persisting queues is a good idea for several reasons,
not least the manageability and quality of mnesia, but of course also
to provide several queue failover patterns 'out of the box'.  Other
persistence models may also be attractive.

We'd planned to look at this in more detail after AMQP 0-10 is out
because that will define some of the failover and HA behaviours for
AMQP.  Given that 0-10 is on its way soon, we've begun to look at this
informally, and would be delighted to move that discussion 'on list'.
What ideas would you recommend pursuing first?  Our back-of-envelope
idea was, very simply, to see how a broker would perform with mnesia
instead of the current logger, using a bit of custom coding.  This
might suggest good ways to go forward more systematically, and indeed
if this was even a good idea to pursue.

Thoughts?

alexis







On Nov 14, 2007 7:53 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Dear list,
>
> This is probably a stupid question, but why is mnesia not suitable for
> backing queues?
>
> Given that rabbit already uses mnesia to replicate exchange state, and
> that you get a reference to the first and last items of a sorted
> table, is there some obvious problem with using mnesia that I can't see?
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From alexis.richardson at cohesiveft.com  Wed Nov 14 15:22:56 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 14 Nov 2007 15:22:56 +0000
Subject: [rabbitmq-discuss] Queue clustering
In-Reply-To: <167204d20711140514l214a18encbe5a85c7c773e20@mail.gmail.com>
References: <277D1A62-DD6D-4EFA-9FD4-00EB527A54A8@gmail.com>
	<167204d20711140514l214a18encbe5a85c7c773e20@mail.gmail.com>
Message-ID: <167204d20711140722r13ae096cpfdb330548888017@mail.gmail.com>

Ben

I've just been ticked off for my lack of clarity by a colleague :-)

To be clear - my remarks were intended to apply to both uses of Mnesia, i.e.

- for clustering queues as well as exchanges, in the transient case,
without necessarily committing to committing to disk
- for persistence in its several forms

alexis


On Nov 14, 2007 1:14 PM, Alexis Richardson
<alexis.richardson at cohesiveft.com> wrote:
> Ben
>
> We used logfiles to persist queues for speed and as a known best practice.
>
> Using mnesia for persisting queues is a good idea for several reasons,
> not least the manageability and quality of mnesia, but of course also
> to provide several queue failover patterns 'out of the box'.  Other
> persistence models may also be attractive.
>
> We'd planned to look at this in more detail after AMQP 0-10 is out
> because that will define some of the failover and HA behaviours for
> AMQP.  Given that 0-10 is on its way soon, we've begun to look at this
> informally, and would be delighted to move that discussion 'on list'.
> What ideas would you recommend pursuing first?  Our back-of-envelope
> idea was, very simply, to see how a broker would perform with mnesia
> instead of the current logger, using a bit of custom coding.  This
> might suggest good ways to go forward more systematically, and indeed
> if this was even a good idea to pursue.
>
> Thoughts?
>
> alexis
>
>
>
>
>
>
>
>
> On Nov 14, 2007 7:53 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> > Dear list,
> >
> > This is probably a stupid question, but why is mnesia not suitable for
> > backing queues?
> >
> > Given that rabbit already uses mnesia to replicate exchange state, and
> > that you get a reference to the first and last items of a sorted
> > table, is there some obvious problem with using mnesia that I can't see?
> >
> > Ben
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
>
>
> --
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From ellisonbg.net at gmail.com  Fri Nov 16 02:35:37 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Thu, 15 Nov 2007 19:35:37 -0700
Subject: [rabbitmq-discuss] Exchange-queue binding ?
Message-ID: <6ce0ac130711151835g792226b1j306eb7e5f91e7a0a@mail.gmail.com>

Hi,

I am trying to figure out how to bind a set of queues to an exchange
to get specific type of routing and I can't seem to figure out exactly
how to set things up.

Here is the needed routing pattern:

I have 1 publisher and N consumers.  Each consumer has a private queue
and only they consume from.

The publisher needs to be able to send messages to arbirary subsets of
the priviate queues.

So if there are private queues:

pq1, pq2, pq3, pq4, etc.

Publisher needs to be able to send messages to combinations like:

msg -> pq1 + pq2
msg -> pq1 + pq3 + pq4
msg -> pq1+pq2+pq3+pq4

Arbitrary subsets are allowed.

The simple way of doing this is to convert each publish to multiple
publishes to each desired queue:

Thus msg -> pq1 + pq2 becomes:

msg->pq1
msg->pq2

The problem with this is that the publisher sends the message to the
exchange twice (or N times to send to N private queues). I need a way
of publishing to an exchange only one time per message and then have
the exchange route the message to the appropriate subset of private
queues.  I should also mention that the subsets are very dynamic and
completely determined by the publisher.

It seem like I should be able to use a topic exchange, but the amqp
spec is a little vague on exactly how things are matched.

Can I do the following?

pq1: Pattern = #.pq1.#
pq2: Pattern = #.pq2.#
pq1: Pattern = #.pq3.#

And then send messages with routing keys like:

pq1.pq2  (route to pq1 and pq2)
pq1.pq2.pq3 (route to pq1 & pq2 & pq3)
and so on

I suppose this also might be possible with header exchange types, but
it is not obvious how to do that.

Any ideas?

Thanks

Brian



From 0x6e6562 at gmail.com  Fri Nov 16 08:03:43 2007
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 16 Nov 2007 08:03:43 +0000
Subject: [rabbitmq-discuss] Exchange-queue binding ?
In-Reply-To: <6ce0ac130711151835g792226b1j306eb7e5f91e7a0a@mail.gmail.com>
References: <6ce0ac130711151835g792226b1j306eb7e5f91e7a0a@mail.gmail.com>
Message-ID: <86C3B2E4-BE29-420B-97F1-9269D05165DA@gmail.com>

Brian,

On 16 Nov 2007, at 02:35, Brian Granger wrote:
> The publisher needs to be able to send messages to arbirary subsets of
> the priviate queues.
--snip--
>
> The problem with this is that the publisher sends the message to the
> exchange twice (or N times to send to N private queues). I need a way
> of publishing to an exchange only one time per message and then have
> the exchange route the message to the appropriate subset of private
> queues.  I should also mention that the subsets are very dynamic and
> completely determined by the publisher.
>

This seems very producer driven. Can I ask why the producer needs to  
know about subsets of consumers - are context specific packets of work  
being divided up and farmed out to known consumers who maintain state  
across the consumption of different messages?

>
> I suppose this also might be possible with header exchange types, but
> it is not obvious how to do that.

It does sound like you're trying to achieve predicate based routing  
which would be suited to the header exchange type.  Unfortunately  the  
header exchange is not yet implemented in rabbit.

Ben



From ellisonbg.net at gmail.com  Fri Nov 16 17:33:05 2007
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Fri, 16 Nov 2007 10:33:05 -0700
Subject: [rabbitmq-discuss] Exchange-queue binding ?
In-Reply-To: <86C3B2E4-BE29-420B-97F1-9269D05165DA@gmail.com>
References: <6ce0ac130711151835g792226b1j306eb7e5f91e7a0a@mail.gmail.com>
	<86C3B2E4-BE29-420B-97F1-9269D05165DA@gmail.com>
Message-ID: <6ce0ac130711160933l6cd33633uaa5bbd92f51dc76b@mail.gmail.com>

> On 16 Nov 2007, at 02:35, Brian Granger wrote:
> > The publisher needs to be able to send messages to arbirary subsets of
> > the priviate queues.
> --snip--
> >
> > The problem with this is that the publisher sends the message to the
> > exchange twice (or N times to send to N private queues). I need a way
> > of publishing to an exchange only one time per message and then have
> > the exchange route the message to the appropriate subset of private
> > queues.  I should also mention that the subsets are very dynamic and
> > completely determined by the publisher.
> >
>
> This seems very producer driven. Can I ask why the producer needs to
> know about subsets of consumers - are context specific packets of work
> being divided up and farmed out to known consumers who maintain state
> across the consumption of different messages?

Yes, this is exactly the case.  The consumers maintain a large amount
of state, and particular message are sent to particular consumers to
change that state.

> >
> > I suppose this also might be possible with header exchange types, but
> > it is not obvious how to do that.
>
> It does sound like you're trying to achieve predicate based routing
> which would be suited to the header exchange type.  Unfortunately  the
> header exchange is not yet implemented in rabbit.

Ahh, I didn't know that the header exchange wasn't implemented yet.
What about doing this using a topic exchange?

Thanks

Brian

> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matt at corp.meez.com  Sat Nov 17 02:14:01 2007
From: matt at corp.meez.com (matt)
Date: Fri, 16 Nov 2007 18:14:01 -0800
Subject: [rabbitmq-discuss] beam instances and growing memory usage
Message-ID: <F24DBA33-46BC-443C-9014-465C2EDA4B50@corp.meez.com>

Hey gang,

When we did a complete site restart on Tuesday night, Wednesday worked  
flawlessly.  We rebuilt the cluster (disk based nodes) and created a  
total of 7 brokers on the box.  When I was watching the instances on  
Wednesday, each instance was taking up about 0.1% of the server ram,  
according to top.

I checked yesterday (Thursday) and each instance was taking 2.0% :

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
11093 root      16   0  341m 323m 1772 S   33  2.0 132:21.11 beam
11038 root      16   0  341m 322m 1772 R   26  2.0 129:54.36 beam
11142 root      16   0  340m 323m 1776 S   23  2.0 132:18.13 beam
11230 root      16   0  340m 321m 1772 S   18  2.0 126:56.12 beam
11186 root      16   0  340m 322m 1776 S    8  2.0 131:59.12 beam
10683 root      16   0  335m 318m 1772 S    2  2.0 128:45.69 beam
10729 root      16   0  341m 322m 1772 S    1  2.0 129:16.77 beam

I just looked now (Friday) and it's taking 2.9%:

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
10729 root      16   0  483m 462m 1792 S   48  2.9 183:10.47 beam
11230 root      17   0  487m 468m 1792 R   36  2.9 312:12.13 beam
11038 root      16   0  490m 471m 1792 S   17  2.9 321:37.75 beam
11093 root      16   0  491m 472m 1792 S    2  2.9 332:11.46 beam
10683 root      16   0  487m 466m 1792 S    1  2.9 311:57.63 beam
11142 root      16   0  492m 472m 1792 S    1  2.9 348:10.30 beam
11186 root      16   0  485m 466m 1792 S    1  2.9 249:32.93 beam

Durable is set to false - so it doesn't appear that things should be  
persisting anywhere.

Any ideas why it'd be growing over time?

--
Matt Darling
Director, Server Engineering
Meez
182 2nd Street, 5th Floor
San Francisco, CA 94105
(m) 415.505.4623
matt at corp.meez.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071116/7fdc2b74/attachment.htm 

From matthias at lshift.net  Sat Nov 17 08:03:33 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 17 Nov 2007 08:03:33 +0000
Subject: [rabbitmq-discuss] Exchange-queue binding ?
In-Reply-To: <6ce0ac130711160933l6cd33633uaa5bbd92f51dc76b@mail.gmail.com>
References: <6ce0ac130711151835g792226b1j306eb7e5f91e7a0a@mail.gmail.com>	<86C3B2E4-BE29-420B-97F1-9269D05165DA@gmail.com>
	<6ce0ac130711160933l6cd33633uaa5bbd92f51dc76b@mail.gmail.com>
Message-ID: <473EA055.4030003@lshift.net>

Brian,

Brian Granger wrote:

> Ahh, I didn't know that the header exchange wasn't implemented yet.

The reason they aren't implemented is that they are not part of the AMQP 
0-8 spec, which is what RabbitMQ conforms to. They were introduced in 
AMQP 0-9.

> What about doing this using a topic exchange?

Yep. That should work.

 > rabbit_exchange:topic_matches(<<"#.foo.#">>, <<"foo.bar.baz.boo">>).
true
 > rabbit_exchange:topic_matches(<<"#.bar.#">>, <<"foo.bar.baz.boo">>).
true
 > rabbit_exchange:topic_matches(<<"#.baz.#">>, <<"foo.bar.baz.boo">>).
true
 > rabbit_exchange:topic_matches(<<"#.boo.#">>, <<"foo.bar.baz.boo">>).
true
 > rabbit_exchange:topic_matches(<<"#.moo.#">>, <<"foo.bar.baz.boo">>).
false


Matthias.



From matthias at lshift.net  Sat Nov 17 08:46:15 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 17 Nov 2007 08:46:15 +0000
Subject: [rabbitmq-discuss] beam instances and growing memory usage
In-Reply-To: <F24DBA33-46BC-443C-9014-465C2EDA4B50@corp.meez.com>
References: <F24DBA33-46BC-443C-9014-465C2EDA4B50@corp.meez.com>
Message-ID: <473EAA57.4020801@lshift.net>

Matt,

matt wrote:
> When we did a complete site restart on Tuesday night, Wednesday worked 
> flawlessly.  We rebuilt the cluster (disk based nodes) and created a 
> total of 7 brokers on the box.

When you are saying "disk based nodes", do you mean that all broker 
nodes are configured as disk nodes? That is not good for performance. If 
you have all nodes on a single machine and they all write to the same 
disk then there is no point having more than one disk node.

> When I was watching the instances on Wednesday, each instance was 
> taking up about 0.1% of the server ram, according to top. I checked
> yesterday (Thursday) and each instance was taking 2.0%. I just looked
> now (Friday) and it's taking 2.9%. Durable is set to false - so it
> doesn't appear that things should be persisting anywhere. Any ideas
> why it'd be growing over time?

The growth is not necessarily anything to worry about. You still have 
plenty of memory left and the growth might stop after a while. Keep an 
eye on it.

It is worth checking the queue sizes. Connect to one of the nodes in 
your cluster - any node will do - and run rabbit_amqqueue:stat_all(), e.g.

$ erl -sname debug -hidden -remsh rabbit at tanto
Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0] [hipe] 
[kernel-poll:false]
Eshell V5.5.5  (abort with ^G)
(rabbit at tanto)1> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,<<"test queue">>},0,0}]
(rabbit at tanto)2> CTRL-c CTRL-c

That will list all the queues in the system, their message queue length 
and their number of consumers.


On another topic, from your 'top' reports I notice that although the CPU 
load is unevenly distributed over the nodes, the distribution changes 
over time and the cumulative CPU times are much more even. So it looks 
like your load-balancing logic is working fine over the long run. 
Curiously though there are two nodes in your latter report which have 
accumulated much less CPU time.


Matthias.



From feeder.of.the.bears at gmail.com  Mon Nov 19 19:48:52 2007
From: feeder.of.the.bears at gmail.com (David Pollak)
Date: Mon, 19 Nov 2007 11:48:52 -0800
Subject: [rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,
	delayed stock prices)?
Message-ID: <cdbebedf0711191148y4330ddf9q1721b92c7acc8759@mail.gmail.com>

Howdy,

Over in lift-land (http://liftweb.net) we're noodling adding RabbitMQ
support into lift.  It'd be wicked cool if we could have a RabbitMQ demo
complete with a public RabbitMQ feed.  Are there any known public RabbitMQ
feeds out there?

If not, I can probably set one up if someone could supply the feed data.

Please let me know.

Thanks,

David

-- 
lift, the secure, simple, powerful web framework http://liftweb.net
Collaborative Task Management http://much4.us
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071119/5b4334ae/attachment.htm 

From tonyg at lshift.net  Tue Nov 20 12:51:06 2007
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 20 Nov 2007 12:51:06 +0000
Subject: [rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,
 delayed stock prices)?
In-Reply-To: <cdbebedf0711191148y4330ddf9q1721b92c7acc8759@mail.gmail.com>
References: <cdbebedf0711191148y4330ddf9q1721b92c7acc8759@mail.gmail.com>
Message-ID: <4742D83A.2080506@lshift.net>

Hi David,

What kinds of feeds do you have in mind?

There is a publicly-available RabbitMQ server at dev.rabbitmq.com:5672 -
and there are occasionally (!) one or more instances of the camstream
capture program pushing video frames through some exchanges on that
server... is that the kind of thing you're looking for?

If so, see:

http://www.rabbitmq.com/camstream.html#live
http://www.rabbitmq.com/examples/camstream/0.22/camstream-source-0.22.zip

Regards,
  Tony


David Pollak wrote:
> Howdy,
> 
> Over in lift-land (http://liftweb.net) we're noodling adding RabbitMQ
> support into lift.  It'd be wicked cool if we could have a RabbitMQ demo
> complete with a public RabbitMQ feed.  Are there any known public
> RabbitMQ feeds out there?
> 
> If not, I can probably set one up if someone could supply the feed data.
> 
> Please let me know.
> 
> Thanks,
> 
> David
> 
> -- 
> lift, the secure, simple, powerful web framework http://liftweb.net
> Collaborative Task Management http://much4.us
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From feeder.of.the.bears at gmail.com  Tue Nov 20 14:12:16 2007
From: feeder.of.the.bears at gmail.com (David Pollak)
Date: Tue, 20 Nov 2007 06:12:16 -0800
Subject: [rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,
	delayed stock prices)?
In-Reply-To: <4742D83A.2080506@lshift.net>
References: <cdbebedf0711191148y4330ddf9q1721b92c7acc8759@mail.gmail.com>
	<4742D83A.2080506@lshift.net>
Message-ID: <cdbebedf0711200612v334893aaqa0b110795aaa0ecd@mail.gmail.com>

On Nov 20, 2007 4:51 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:

> Hi David,
>
> What kinds of feeds do you have in mind?


Ideally, some delayed financial feeds.  The demo we're currently noodling is
a stock portfolio tool that updates in real time.


>
> There is a publicly-available RabbitMQ server at dev.rabbitmq.com:5672 -
> and there are occasionally (!) one or more instances of the camstream
> capture program pushing video frames through some exchanges on that
> server... is that the kind of thing you're looking for?


Not really.  Those demos are definitely sexy.  But, we're looking for
something more text-based suitable for pushing to the client browser with
Comet (one of lift's strengths.)

Thanks,

David



>
>
> If so, see:
>
> http://www.rabbitmq.com/camstream.html#live
> http://www.rabbitmq.com/examples/camstream/0.22/camstream-source-0.22.zip
>
> Regards,
>  Tony
>
>
> David Pollak wrote:
> > Howdy,
> >
> > Over in lift-land (http://liftweb.net) we're noodling adding RabbitMQ
> > support into lift.  It'd be wicked cool if we could have a RabbitMQ demo
> > complete with a public RabbitMQ feed.  Are there any known public
> > RabbitMQ feeds out there?
> >
> > If not, I can probably set one up if someone could supply the feed data.
> >
> > Please let me know.
> >
> > Thanks,
> >
> > David
> >
> > --
> > lift, the secure, simple, powerful web framework http://liftweb.net
> > Collaborative Task Management http://much4.us
> >
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>



-- 
lift, the secure, simple, powerful web framework
http://liftweb.net
Collaborative Task Management http://much4.us
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071120/cbad238c/attachment.htm 

From alexis.richardson at cohesiveft.com  Tue Nov 20 20:14:48 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 20 Nov 2007 20:14:48 +0000
Subject: [rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,
	delayed stock prices)?
In-Reply-To: <cdbebedf0711200612v334893aaqa0b110795aaa0ecd@mail.gmail.com>
References: <cdbebedf0711191148y4330ddf9q1721b92c7acc8759@mail.gmail.com>
	<4742D83A.2080506@lshift.net>
	<cdbebedf0711200612v334893aaqa0b110795aaa0ecd@mail.gmail.com>
Message-ID: <167204d20711201214n5e815b0eqfeae82094444abc6@mail.gmail.com>

David

I think this is a great idea if we can find a suitable price feed
provider.  I am happy to help you find one.  That said, did you have
anyone in mind?

All - suggestions from the list are of course most welcome :-)

alexis


On Nov 20, 2007 2:12 PM, David Pollak <feeder.of.the.bears at gmail.com> wrote:
>
>
>
> On Nov 20, 2007 4:51 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> > Hi David,
> >
> > What kinds of feeds do you have in mind?
>
> Ideally, some delayed financial feeds.  The demo we're currently noodling is
> a stock portfolio tool that updates in real time.
>
>
> >
> >
> > There is a publicly-available RabbitMQ server at dev.rabbitmq.com:5672 -
> > and there are occasionally (!) one or more instances of the camstream
> > capture program pushing video frames through some exchanges on that
> > server... is that the kind of thing you're looking for?
>
> Not really.  Those demos are definitely sexy.  But, we're looking for
> something more text-based suitable for pushing to the client browser with
> Comet (one of lift's strengths.)
>
> Thanks,
>
> David
>
>
>
> >
> >
> > If so, see:
> >
> > http://www.rabbitmq.com/camstream.html#live
> > http://www.rabbitmq.com/examples/camstream/0.22/camstream-source-0.22.zip
> >
> > Regards,
> >  Tony
> >
> >
> >
> >
> >
> > David Pollak wrote:
> > > Howdy,
> > >
> > > Over in lift-land (http://liftweb.net) we're noodling adding RabbitMQ
> > > support into lift.  It'd be wicked cool if we could have a RabbitMQ demo
> > > complete with a public RabbitMQ feed.  Are there any known public
> > > RabbitMQ feeds out there?
> > >
> > > If not, I can probably set one up if someone could supply the feed data.
> > >
> > > Please let me know.
> > >
> > > Thanks,
> > >
> > > David
> > >
> > > --
> > > lift, the secure, simple, powerful web framework http://liftweb.net
> > > Collaborative Task Management http://much4.us
> > >
> > >
> > > ------------------------------------------------------------------------
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> > --
> >  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
> >   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
> >  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
> >
>
>
>
>
> --
> lift, the secure, simple, powerful web framework
> http://liftweb.net
> Collaborative Task Management http://much4.us
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From JWatson at sis.tv  Fri Nov 23 10:27:17 2007
From: JWatson at sis.tv (John Watson)
Date: Fri, 23 Nov 2007 10:27:17 -0000
Subject: [rabbitmq-discuss] Newbie question
Message-ID: <85FA03E6BB6F0340B5A117013571A9B70FDD20@exchange3.ad.sis.tv>

It was very interesting to see you, Tony and Alexis, earlier on in the
week - very many thanks for making the time.
 
I'm having my first look at the java interface to rabbitMQ. I've
installed rabbitMQ on my machine, set up a user (john) and a virtualhost
(sportsdata).  I've both granted myself access and set myself
permissions (not sure if I need to do this if I am the owner) but anyway
I get:
 
Listing permissions for user "john" in vhost "sportsdata" ...
/data: [passive,active,write,read]
done.
 
I'm following the instructions in the core java API guide, trying to
attach to this virtual host with this user on the host (which I've named
'localhost' - hope this works).  When I attempt channel.accessRequest()
to the /data realm, I get the error:
 
     [java] Caused by: com.rabbitmq.client.ShutdownSignalException
(channel error; reason: {#method<channel.close>(reply code=403, reply
text=ACCESS_REFUSED, class id=30, method id=10),null,""})
 
I'm obviously missing something, but I can't see what.  
 
Cheers
 
John
 

*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071123/835c416b/attachment.htm 

From JWatson at sis.tv  Fri Nov 23 11:01:40 2007
From: JWatson at sis.tv (John Watson)
Date: Fri, 23 Nov 2007 11:01:40 -0000
Subject: [rabbitmq-discuss] Newbie question
References: <85FA03E6BB6F0340B5A117013571A9B70FDD20@exchange3.ad.sis.tv>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B70FDD29@exchange3.ad.sis.tv>

Ah - found my problem - I need to use /data rather than data as the name
of the realm.

________________________________

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of John
Watson
Sent: 23 November 2007 10:27
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Newbie question


It was very interesting to see you, Tony and Alexis, earlier on in the
week - very many thanks for making the time.
 
I'm having my first look at the java interface to rabbitMQ. I've
installed rabbitMQ on my machine, set up a user (john) and a virtualhost
(sportsdata).  I've both granted myself access and set myself
permissions (not sure if I need to do this if I am the owner) but anyway
I get:
 
Listing permissions for user "john" in vhost "sportsdata" ...
/data: [passive,active,write,read]
done.
 
I'm following the instructions in the core java API guide, trying to
attach to this virtual host with this user on the host (which I've named
'localhost' - hope this works).  When I attempt channel.accessRequest()
to the /data realm, I get the error:
 
     [java] Caused by: com.rabbitmq.client.ShutdownSignalException
(channel error; reason: {#method<channel.close>(reply code=403, reply
text=ACCESS_REFUSED, class id=30, method id=10),null,""})
 
I'm obviously missing something, but I can't see what.  
 
Cheers
 
John
 

*************************************************************

Satellite Information Services Limited Registered Office: 

17 Corsham Street London N1 6DR, Company No. 4243307

 

The information in this e-mail (which includes any files

transmitted with it) is confidential and is intended for the

addressee only. Unauthorised recipients are required to

maintain confidentiality. If you have received this e-mail

in error please notify the sender immediately, destroy any

copies and delete it from your computer system. 

*************************************************************

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071123/26acd654/attachment.htm 

From JWatson at sis.tv  Fri Nov 23 14:07:03 2007
From: JWatson at sis.tv (John Watson)
Date: Fri, 23 Nov 2007 14:07:03 -0000
Subject: [rabbitmq-discuss] Message routing
Message-ID: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv>

OK - I've successfully got simple enqueue and dequeue working against a
single queue.  Next question, can you point me at some documentation
that explains how message routing works (or if not yet implemented,
where it lives in the roadmap, and how it's maybe expected to work)?
Ideally I'd like to be able to do content-based-routing based (say) on
XPath expressions into XML content.
 
Cheers
 
John

*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071123/b06dab1a/attachment.htm 

From tonyg at lshift.net  Mon Nov 26 16:42:46 2007
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 26 Nov 2007 16:42:46 +0000
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv>
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv>
Message-ID: <474AF786.70207@lshift.net>

Hi John,

John Watson wrote:
> OK - I've successfully got simple enqueue and dequeue working against a
> single queue.

Cool.

> Next question, can you point me at some documentation
> that explains how message routing works (or if not yet implemented,
> where it lives in the roadmap, and how it's maybe expected to work)?

Routing is implemented for

 - fanout
 - direct
 - topic

exchanges, all of which are documented in the AMQP 0-8 specification.
See
https://jira.amqp.org/confluence/download/attachments/720900/amqp0-8.pdf?version=1,
sections 2.1.3 and 3.1.3.

The API for all this is largely in the interaction of exchangeDeclare(),
queueBind(), and basicPublish().

> Ideally I'd like to be able to do content-based-routing based (say) on
> XPath expressions into XML content.

There is no XPath exchange defined by AMQP 0-8. If you can shoehorn your
routing into routing-keys, then maybe direct or topic exchanges will
server your purpose; otherwise, I'm afraid you're stuck with simulating
a router at an application level:

      exchange ---> app-level router's queue
                               |
                               V
                        Java application doing
                           xpath-based routing
                              /|\
                             / | \
                            V  V  V
                      exchanges, queues that are
                      actual targets

So messages enter the broker, leave the broker, are routed, and are
delivered again.

The xpath-router can be implemented in Java or Erlang. If it's
implemented in Erlang, it can be colocated on the broker's node.

If it's implemented in erlang, we can go even further, and make it an
experimental exchange type: we could get some experience with xpath
exchanges, which could then subsequently be proposed for standardisation...

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From JWatson at sis.tv  Tue Nov 27 09:13:35 2007
From: JWatson at sis.tv (John Watson)
Date: Tue, 27 Nov 2007 09:13:35 -0000
Subject: [rabbitmq-discuss] Message routing
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv> 
	<474AF786.70207@lshift.net>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B70FDD44@exchange3.ad.sis.tv>

 
Thanks very much, Tony.

A lot to digest here - I'll respond again, I hope, when I've done a bit
more reading. In principle, I wouldn't be averse to having a crack at an
erlang XPath routing engine - however I need to learn the language
properly first, and this is still a spare-time project at the moment!

John

*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************




From JWatson at sis.tv  Wed Nov 28 11:01:29 2007
From: JWatson at sis.tv (John Watson)
Date: Wed, 28 Nov 2007 11:01:29 -0000
Subject: [rabbitmq-discuss] Message routing
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv> 
	<474AF786.70207@lshift.net>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>

Hi Tony, 

You say:
> The API for all this is largely in the interaction of
exchangeDeclare(), queueBind(), and 
> basicPublish().

I've had another look at the AMQP spec and the API javadoc.  What I find
strange is that exchanges and queues are set up and administered only
via the API.  I would have expected this to be done via the admin tool.
It seems to me that these objects will tend to be shared between
different application programs which have different concerns, and in
most cases will be long lived, and the API gives me more of an
impression of transience.

Or am I missing something more fundamental about the philosophy of AMQP?

cheers

John


*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************




From sustrik at imatix.com  Wed Nov 28 11:07:02 2007
From: sustrik at imatix.com (Martin Sustrik)
Date: Wed, 28 Nov 2007 12:07:02 +0100
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv>
	<474AF786.70207@lshift.net>
	<85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>
Message-ID: <474D4BD6.3060108@imatix.com>


> Or am I missing something more fundamental about the philosophy of AMQP?

This is the case because of the zero-config feature of AMQP. I.e. 
install and run the software on 1000 boxes of your server farm without 
any extra work.

Applications themselves are then responsible for creating the 'wiring'.

Martin



From JWatson at sis.tv  Wed Nov 28 11:39:18 2007
From: JWatson at sis.tv (John Watson)
Date: Wed, 28 Nov 2007 11:39:18 -0000
Subject: [rabbitmq-discuss] Message routing
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv><474AF786.70207@lshift.net><85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>
	<474D4BD6.3060108@imatix.com>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B70FDD70@exchange3.ad.sis.tv>

Martin wrote
> This is the case because of the zero-config feature of AMQP. I.e. 
> install and run the software on 1000 boxes of your server farm without
any extra work.

Well, to me, this seems to be deferring the administration to some other
kind of process. Suppose that you wish to publish messages to 1000
different customers, each with their own box.  Let's say each customer
has his own routing rules, and that these rules are quite complex, and
change from time to time as and when business requirements change and
cause different subsets of the available messages to be received. 

Suppose also that you want to control the message routing yourself (in
response, say to a customer buying a new service from you), and you want
absolute control over the security of your own box.  What must you do?

John

*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************




From sustrik at imatix.com  Wed Nov 28 11:50:26 2007
From: sustrik at imatix.com (Martin Sustrik)
Date: Wed, 28 Nov 2007 12:50:26 +0100
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B70FDD70@exchange3.ad.sis.tv>
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv><474AF786.70207@lshift.net><85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>
	<474D4BD6.3060108@imatix.com>
	<85FA03E6BB6F0340B5A117013571A9B70FDD70@exchange3.ad.sis.tv>
Message-ID: <474D5602.70100@imatix.com>

I would probably implement this in a following way:

1. I would separate messages into different exchanges. Each exchange 
would correspond to a service customer can buy. The producer application 
creates the exchanges on the startup. When client buys a service, he 
gets access to the corresponding exchange.

2. Client application creates its own queue and binds to desired 
exchange (of course only if the service was bought already, otherwise it 
should get access error) with any routing criteria. These criteria can 
be changed afterwards using Queue.Bind and Queue.Unbind commands.

Martin

John Watson wrote:
> Martin wrote
>> This is the case because of the zero-config feature of AMQP. I.e. 
>> install and run the software on 1000 boxes of your server farm without
> any extra work.
> 
> Well, to me, this seems to be deferring the administration to some other
> kind of process. Suppose that you wish to publish messages to 1000
> different customers, each with their own box.  Let's say each customer
> has his own routing rules, and that these rules are quite complex, and
> change from time to time as and when business requirements change and
> cause different subsets of the available messages to be received. 
> 
> Suppose also that you want to control the message routing yourself (in
> response, say to a customer buying a new service from you), and you want
> absolute control over the security of your own box.  What must you do?
> 
> John
> 
> *************************************************************
> Satellite Information Services Limited Registered Office: 
> 17 Corsham Street London N1 6DR, Company No. 4243307
> 
> The information in this e-mail (which includes any files
> transmitted with it) is confidential and is intended for the
> addressee only. Unauthorised recipients are required to
> maintain confidentiality.  If you have received this e-mail
> in error please notify the sender immediately, destroy any
> copies and delete it from your computer system. 
> *************************************************************
> 




From JWatson at sis.tv  Wed Nov 28 16:07:56 2007
From: JWatson at sis.tv (John Watson)
Date: Wed, 28 Nov 2007 16:07:56 -0000
Subject: [rabbitmq-discuss] Message routing
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv><474AF786.70207@lshift.net><85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>
	<474D4BD6.3060108@imatix.com> 
	<85FA03E6BB6F0340B5A117013571A9B70FDD70@exchange3.ad.sis.tv> 
	<474D5602.70100@imatix.com>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B70FDD7B@exchange3.ad.sis.tv>

 
Martin wrote:
> I would probably implement this in a following way:
>
> 1. I would separate messages into different exchanges. Each exchange
would correspond to  > a service customer can buy. The producer
application creates the exchanges on the 
> startup. When client buys a service, he gets access to the
corresponding exchange.
>
> 2. Client application creates its own queue and binds to desired
exchange (of course only 
> if the service was bought already, otherwise it should get access
error) with any routing 
> criteria. These criteria can be changed afterwards using Queue.Bind
and Queue.Unbind 
> commands.

Interesting.....  I think I'm beginning to get the picture, but I'm
still not completely happy.  Suppose you have 500 different exchanges
necessary to manage this. Your producer application does (what I'd call
the administration job) of creating the exchanges and is now busy
routing messages to all the different exchanges.  A customer contacts us
and says he wants to get message type 'D' in addition to messages 'A',
'B' and 'C' that he had before.  Maybe there's already an exchange with
this profile, maybe not.

The 'admin' task now is firstly (maybe) to create the new exchange and
secondly to reconfigure the customer appl to point to a new exchange.
The first task requires the producer program to be stopped,
reconfigured, and restarted.  The second requires us to contact the
customer.

(At the moment we manage this sort of thing with our IBM Websphere MQ
network simply by reconfiguring the 'broking' rules - the customer stays
attached to the same queue and does not need to be contacted, and we
don't need necessarily to bounce the broker.)

Cheers

John

*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************




From sustrik at imatix.com  Wed Nov 28 17:48:04 2007
From: sustrik at imatix.com (Martin Sustrik)
Date: Wed, 28 Nov 2007 18:48:04 +0100
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B70FDD7B@exchange3.ad.sis.tv>
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv><474AF786.70207@lshift.net><85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>
	<474D4BD6.3060108@imatix.com>
	<85FA03E6BB6F0340B5A117013571A9B70FDD70@exchange3.ad.sis.tv>
	<474D5602.70100@imatix.com>
	<85FA03E6BB6F0340B5A117013571A9B70FDD7B@exchange3.ad.sis.tv>
Message-ID: <474DA9D4.7020300@imatix.com>


> Interesting.....  I think I'm beginning to get the picture, but I'm
> still not completely happy.  Suppose you have 500 different exchanges
> necessary to manage this. Your producer application does (what I'd call
> the administration job) of creating the exchanges and is now busy
> routing messages to all the different exchanges.  A customer contacts us
> and says he wants to get message type 'D' in addition to messages 'A',
> 'B' and 'C' that he had before.  Maybe there's already an exchange with
> this profile, maybe not.

I suppose you know what services you are offering in advance. So the 
producer application can create all of them as it starts.

When client calls and requests access to some service the only thing you 
have to do is to grant him necessary privileges to bind to the specific 
exchange. I don't know how this can be done using RabbitMQ. *Question 
for RabbitMQ team!*


> The 'admin' task now is firstly (maybe) to create the new exchange and
> secondly to reconfigure the customer appl to point to a new exchange.
> The first task requires the producer program to be stopped,
> reconfigured, and restarted. 

Not true. Take into account that exchanges can be created dynamically in 
the runtime. So if you want to add services without restarting the 
broker, either publiching application or a separate admin application 
can take care of that.

Note: The AMQP protocol is specifically designed to allow this kind of 
interaction. The default semantics for commands like Exchange.Declare is 
'create the exchange if it does not already exist' meaning that you can 
safely 'declare' the exchange even from multiple applications.


> The second requires us to contact the
> customer.

You can choose to create bindings to consumer's queue from producer 
side, which is kind of uncommon, but well doable in run-time though.

Martin



From matthias at lshift.net  Thu Nov 29 07:40:19 2007
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 29 Nov 2007 07:40:19 +0000
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <474DA9D4.7020300@imatix.com>
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv><474AF786.70207@lshift.net><85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>	<474D4BD6.3060108@imatix.com>	<85FA03E6BB6F0340B5A117013571A9B70FDD70@exchange3.ad.sis.tv>	<474D5602.70100@imatix.com>	<85FA03E6BB6F0340B5A117013571A9B70FDD7B@exchange3.ad.sis.tv>
	<474DA9D4.7020300@imatix.com>
Message-ID: <474E6CE3.8080805@lshift.net>

Martin Sustrik wrote:
> When client calls and requests access to some service the only thing you 
> have to do is to grant him necessary privileges to bind to the specific 
> exchange. I don't know how this can be done using RabbitMQ. *Question 
> for RabbitMQ team!*

Exchanges and queues belong to realms. Realms can be created using the 
rabbitmqctl admin tool - see 
http://www.rabbitmq.com/admin-guide.html#add_realm. The realm of an 
exchange/queue is determined at the time of their creation.

Publishing to an exchange requires the user to have 'write' access to 
the exchange's realm. This can be granted with the rabbitmqctl admin 
tool - see http://www.rabbitmq.com/admin-guide.html#set_permissions.

So far so good.

However, binding a queue to an exchange requires the user to have 
'active' access to the *queue*'s realm. The AMQP 0-8 spec says nothing 
about the exchange's realm in this context.

So there doesn't appear to be a way to restrict queue-exchange bindings.

Also, the concept of realms is being revamped/removed(?) in AMQP 0-10.


Matthias.



From JWatson at sis.tv  Thu Nov 29 09:48:15 2007
From: JWatson at sis.tv (John Watson)
Date: Thu, 29 Nov 2007 09:48:15 -0000
Subject: [rabbitmq-discuss] Message routing
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv><474AF786.70207@lshift.net><85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>
	<474D4BD6.3060108@imatix.com>     
	<85FA03E6BB6F0340B5A117013571A9B70FDD70@exchange3.ad.sis.tv>     
	<474D5602.70100@imatix.com> 
	<85FA03E6BB6F0340B5A117013571A9B70FDD7B@exchange3.ad.sis.tv> 
	<474DA9D4.7020300@imatix.com>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B768464E@exchange3.ad.sis.tv>

Thanks very much for your answers, Martin.  It's becoming clearer.

You say:
> So if you want to add services without restarting the 
> broker, either publiching application or a separate admin application 
> can take care of that.

I would choose a separate admin application to add services.  Which
brings me to my original point - wouldn't it be more convenient to add
this functionality to the admin tool itself?

John

-----Original Message-----
From: Martin Sustrik [mailto:sustrik at imatix.com] 
Sent: 28 November 2007 17:48
To: John Watson
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Message routing


> Interesting.....  I think I'm beginning to get the picture, but I'm
> still not completely happy.  Suppose you have 500 different exchanges
> necessary to manage this. Your producer application does (what I'd
call
> the administration job) of creating the exchanges and is now busy
> routing messages to all the different exchanges.  A customer contacts
us
> and says he wants to get message type 'D' in addition to messages 'A',
> 'B' and 'C' that he had before.  Maybe there's already an exchange
with
> this profile, maybe not.

I suppose you know what services you are offering in advance. So the 
producer application can create all of them as it starts.

When client calls and requests access to some service the only thing you

have to do is to grant him necessary privileges to bind to the specific 
exchange. I don't know how this can be done using RabbitMQ. *Question 
for RabbitMQ team!*


> The 'admin' task now is firstly (maybe) to create the new exchange and
> secondly to reconfigure the customer appl to point to a new exchange.
> The first task requires the producer program to be stopped,
> reconfigured, and restarted. 

Not true. Take into account that exchanges can be created dynamically in

the runtime. So if you want to add services without restarting the 
broker, either publiching application or a separate admin application 
can take care of that.

Note: The AMQP protocol is specifically designed to allow this kind of 
interaction. The default semantics for commands like Exchange.Declare is

'create the exchange if it does not already exist' meaning that you can 
safely 'declare' the exchange even from multiple applications.


> The second requires us to contact the
> customer.

You can choose to create bindings to consumer's queue from producer 
side, which is kind of uncommon, but well doable in run-time though.

Martin

*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************




From sustrik at imatix.com  Thu Nov 29 09:52:06 2007
From: sustrik at imatix.com (Martin Sustrik)
Date: Thu, 29 Nov 2007 10:52:06 +0100
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B768464E@exchange3.ad.sis.tv>
References: <85FA03E6BB6F0340B5A117013571A9B70FDD2E@exchange3.ad.sis.tv><474AF786.70207@lshift.net><85FA03E6BB6F0340B5A117013571A9B70FDD6C@exchange3.ad.sis.tv>
	<474D4BD6.3060108@imatix.com>
	<85FA03E6BB6F0340B5A117013571A9B70FDD70@exchange3.ad.sis.tv>
	<474D5602.70100@imatix.com>
	<85FA03E6BB6F0340B5A117013571A9B70FDD7B@exchange3.ad.sis.tv>
	<474DA9D4.7020300@imatix.com>
	<85FA03E6BB6F0340B5A117013571A9B768464E@exchange3.ad.sis.tv>
Message-ID: <474E8BC6.2090901@imatix.com>


> You say:
>> So if you want to add services without restarting the 
>> broker, either publiching application or a separate admin application 
>> can take care of that.
> 
> I would choose a separate admin application to add services.  Which
> brings me to my original point - wouldn't it be more convenient to add
> this functionality to the admin tool itself?

Yup. The point is that AMQP knows nothing about administration - it's a 
simple client/server wire-level protocol. However, the commands it 
provides allows you to implement the admin tool in any way you want. The 
admin tool from AMQP's point of view will be just another client 
applcation. I suppose RabbitMQ already has some kind of admin tool 
available.

Martin



From alexis.richardson at cohesiveft.com  Thu Nov 29 14:22:56 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 29 Nov 2007 14:22:56 +0000
Subject: [rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,
	delayed stock prices)?
In-Reply-To: <167204d20711201214n5e815b0eqfeae82094444abc6@mail.gmail.com>
References: <cdbebedf0711191148y4330ddf9q1721b92c7acc8759@mail.gmail.com>
	<4742D83A.2080506@lshift.net>
	<cdbebedf0711200612v334893aaqa0b110795aaa0ecd@mail.gmail.com>
	<167204d20711201214n5e815b0eqfeae82094444abc6@mail.gmail.com>
Message-ID: <167204d20711290622o161cd9fdpfc0290670c38c067@mail.gmail.com>

Hi

OK, I have found someone who may be able to give us access to some
data.  But, it won't happen for at least a few weeks.  If anyone is
interested in helping code up a demo, please let me know.

alexis

On Nov 20, 2007 8:14 PM, Alexis Richardson
<alexis.richardson at cohesiveft.com> wrote:
> David
>
> I think this is a great idea if we can find a suitable price feed
> provider.  I am happy to help you find one.  That said, did you have
> anyone in mind?
>
> All - suggestions from the list are of course most welcome :-)
>
> alexis
>
>
>
> On Nov 20, 2007 2:12 PM, David Pollak <feeder.of.the.bears at gmail.com> wrote:
> >
> >
> >
> > On Nov 20, 2007 4:51 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> > > Hi David,
> > >
> > > What kinds of feeds do you have in mind?
> >
> > Ideally, some delayed financial feeds.  The demo we're currently noodling is
> > a stock portfolio tool that updates in real time.
> >
> >
> > >
> > >
> > > There is a publicly-available RabbitMQ server at dev.rabbitmq.com:5672 -
> > > and there are occasionally (!) one or more instances of the camstream
> > > capture program pushing video frames through some exchanges on that
> > > server... is that the kind of thing you're looking for?
> >
> > Not really.  Those demos are definitely sexy.  But, we're looking for
> > something more text-based suitable for pushing to the client browser with
> > Comet (one of lift's strengths.)
> >
> > Thanks,
> >
> > David
> >
> >
> >
> > >
> > >
> > > If so, see:
> > >
> > > http://www.rabbitmq.com/camstream.html#live
> > > http://www.rabbitmq.com/examples/camstream/0.22/camstream-source-0.22.zip
> > >
> > > Regards,
> > >  Tony
> > >
> > >
> > >
> > >
> > >
> > > David Pollak wrote:
> > > > Howdy,
> > > >
> > > > Over in lift-land (http://liftweb.net) we're noodling adding RabbitMQ
> > > > support into lift.  It'd be wicked cool if we could have a RabbitMQ demo
> > > > complete with a public RabbitMQ feed.  Are there any known public
> > > > RabbitMQ feeds out there?
> > > >
> > > > If not, I can probably set one up if someone could supply the feed data.
> > > >
> > > > Please let me know.
> > > >
> > > > Thanks,
> > > >
> > > > David
> > > >
> > > > --
> > > > lift, the secure, simple, powerful web framework http://liftweb.net
> > > > Collaborative Task Management http://much4.us
> > > >
> > > >
> > > > ------------------------------------------------------------------------
> > > >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > >
> > > --
> > >  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
> > >   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
> > >  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
> > >
> >
> >
> >
> >
> > --
> > lift, the secure, simple, powerful web framework
> > http://liftweb.net
> > Collaborative Task Management http://much4.us
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
>
>
> --
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From feeder.of.the.bears at gmail.com  Thu Nov 29 14:27:24 2007
From: feeder.of.the.bears at gmail.com (David Pollak)
Date: Thu, 29 Nov 2007 06:27:24 -0800
Subject: [rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,
	delayed stock prices)?
In-Reply-To: <167204d20711290622o161cd9fdpfc0290670c38c067@mail.gmail.com>
References: <cdbebedf0711191148y4330ddf9q1721b92c7acc8759@mail.gmail.com>
	<4742D83A.2080506@lshift.net>
	<cdbebedf0711200612v334893aaqa0b110795aaa0ecd@mail.gmail.com>
	<167204d20711201214n5e815b0eqfeae82094444abc6@mail.gmail.com>
	<167204d20711290622o161cd9fdpfc0290670c38c067@mail.gmail.com>
Message-ID: <cdbebedf0711290627i11fda279s337ab162a7220fe0@mail.gmail.com>

We're integrating RabbitMQ functionality into lift this week.  I'll take a
crack at doing a demo once you get your feed running.  There's be another
demo (tailing a log off one of our servers) that'll ship with lift.

On Nov 29, 2007 6:22 AM, Alexis Richardson <alexis.richardson at cohesiveft.com>
wrote:

> Hi
>
> OK, I have found someone who may be able to give us access to some
> data.  But, it won't happen for at least a few weeks.  If anyone is
> interested in helping code up a demo, please let me know.
>
> alexis
>
> On Nov 20, 2007 8:14 PM, Alexis Richardson
> <alexis.richardson at cohesiveft.com> wrote:
> > David
> >
> > I think this is a great idea if we can find a suitable price feed
> > provider.  I am happy to help you find one.  That said, did you have
> > anyone in mind?
> >
> > All - suggestions from the list are of course most welcome :-)
> >
> > alexis
> >
> >
> >
> > On Nov 20, 2007 2:12 PM, David Pollak <feeder.of.the.bears at gmail.com>
> wrote:
> > >
> > >
> > >
> > > On Nov 20, 2007 4:51 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> > > > Hi David,
> > > >
> > > > What kinds of feeds do you have in mind?
> > >
> > > Ideally, some delayed financial feeds.  The demo we're currently
> noodling is
> > > a stock portfolio tool that updates in real time.
> > >
> > >
> > > >
> > > >
> > > > There is a publicly-available RabbitMQ server at
> dev.rabbitmq.com:5672 -
> > > > and there are occasionally (!) one or more instances of the
> camstream
> > > > capture program pushing video frames through some exchanges on that
> > > > server... is that the kind of thing you're looking for?
> > >
> > > Not really.  Those demos are definitely sexy.  But, we're looking for
> > > something more text-based suitable for pushing to the client browser
> with
> > > Comet (one of lift's strengths.)
> > >
> > > Thanks,
> > >
> > > David
> > >
> > >
> > >
> > > >
> > > >
> > > > If so, see:
> > > >
> > > > http://www.rabbitmq.com/camstream.html#live
> > > >
> http://www.rabbitmq.com/examples/camstream/0.22/camstream-source-0.22.zip
> > > >
> > > > Regards,
> > > >  Tony
> > > >
> > > >
> > > >
> > > >
> > > >
> > > > David Pollak wrote:
> > > > > Howdy,
> > > > >
> > > > > Over in lift-land (http://liftweb.net) we're noodling adding
> RabbitMQ
> > > > > support into lift.  It'd be wicked cool if we could have a
> RabbitMQ demo
> > > > > complete with a public RabbitMQ feed.  Are there any known public
> > > > > RabbitMQ feeds out there?
> > > > >
> > > > > If not, I can probably set one up if someone could supply the feed
> data.
> > > > >
> > > > > Please let me know.
> > > > >
> > > > > Thanks,
> > > > >
> > > > > David
> > > > >
> > > > > --
> > > > > lift, the secure, simple, powerful web framework
> http://liftweb.net
> > > > > Collaborative Task Management http://much4.us
> > > > >
> > > > >
> > > > >
> ------------------------------------------------------------------------
> > > > >
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >
> > > >
> > > > --
> > > >  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
> > > >   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
> > > >  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
> > > >
> > >
> > >
> > >
> > >
> > > --
> > > lift, the secure, simple, powerful web framework
> > > http://liftweb.net
> > > Collaborative Task Management http://much4.us
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > >
> >
> >
> >
> > --
> > Alexis Richardson
> > +44 20 7617 7339 (UK)
> > +44 77 9865 2911 (cell)
> > +1 650 206 2517 (US)
> >
>
>
>
> --
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>



-- 
lift, the secure, simple, powerful web framework http://liftweb.net
Collaborative Task Management http://much4.us
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071129/e805ab9c/attachment.htm 

From alexis.richardson at cohesiveft.com  Thu Nov 29 14:28:24 2007
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 29 Nov 2007 14:28:24 +0000
Subject: [rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,
	delayed stock prices)?
In-Reply-To: <cdbebedf0711290627i11fda279s337ab162a7220fe0@mail.gmail.com>
References: <cdbebedf0711191148y4330ddf9q1721b92c7acc8759@mail.gmail.com>
	<4742D83A.2080506@lshift.net>
	<cdbebedf0711200612v334893aaqa0b110795aaa0ecd@mail.gmail.com>
	<167204d20711201214n5e815b0eqfeae82094444abc6@mail.gmail.com>
	<167204d20711290622o161cd9fdpfc0290670c38c067@mail.gmail.com>
	<cdbebedf0711290627i11fda279s337ab162a7220fe0@mail.gmail.com>
Message-ID: <167204d20711290628r44f7efcatf68d898916e5c3f@mail.gmail.com>

Thanks David, that is highly cool of you.


On Nov 29, 2007 2:27 PM, David Pollak <feeder.of.the.bears at gmail.com> wrote:
> We're integrating RabbitMQ functionality into lift this week.  I'll take a
> crack at doing a demo once you get your feed running.  There's be another
> demo (tailing a log off one of our servers) that'll ship with lift.
>
>
>
> On Nov 29, 2007 6:22 AM, Alexis Richardson
> <alexis.richardson at cohesiveft.com> wrote:
> > Hi
> >
> > OK, I have found someone who may be able to give us access to some
> > data.  But, it won't happen for at least a few weeks.  If anyone is
> > interested in helping code up a demo, please let me know.
> >
> > alexis
> >
> > On Nov 20, 2007 8:14 PM, Alexis Richardson
> >
> >
> >
> > <alexis.richardson at cohesiveft.com> wrote:
> > > David
> > >
> > > I think this is a great idea if we can find a suitable price feed
> > > provider.  I am happy to help you find one.  That said, did you have
> > > anyone in mind?
> > >
> > > All - suggestions from the list are of course most welcome :-)
> > >
> > > alexis
> > >
> > >
> > >
> > > On Nov 20, 2007 2:12 PM, David Pollak <feeder.of.the.bears at gmail.com>
> wrote:
> > > >
> > > >
> > > >
> > > > On Nov 20, 2007 4:51 AM, Tony Garnock-Jones < tonyg at lshift.net> wrote:
> > > > > Hi David,
> > > > >
> > > > > What kinds of feeds do you have in mind?
> > > >
> > > > Ideally, some delayed financial feeds.  The demo we're currently
> noodling is
> > > > a stock portfolio tool that updates in real time.
> > > >
> > > >
> > > > >
> > > > >
> > > > > There is a publicly-available RabbitMQ server at
> dev.rabbitmq.com:5672 -
> > > > > and there are occasionally (!) one or more instances of the
> camstream
> > > > > capture program pushing video frames through some exchanges on that
> > > > > server... is that the kind of thing you're looking for?
> > > >
> > > > Not really.  Those demos are definitely sexy.  But, we're looking for
> > > > something more text-based suitable for pushing to the client browser
> with
> > > > Comet (one of lift's strengths.)
> > > >
> > > > Thanks,
> > > >
> > > > David
> > > >
> > > >
> > > >
> > > > >
> > > > >
> > > > > If so, see:
> > > > >
> > > > > http://www.rabbitmq.com/camstream.html#live
> > > > >
> http://www.rabbitmq.com/examples/camstream/0.22/camstream-source-0.22.zip
> > > > >
> > > > > Regards,
> > > > >  Tony
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > David Pollak wrote:
> > > > > > Howdy,
> > > > > >
> > > > > > Over in lift-land (http://liftweb.net) we're noodling adding
> RabbitMQ
> > > > > > support into lift.  It'd be wicked cool if we could have a
> RabbitMQ demo
> > > > > > complete with a public RabbitMQ feed.  Are there any known public
> > > > > > RabbitMQ feeds out there?
> > > > > >
> > > > > > If not, I can probably set one up if someone could supply the feed
> data.
> > > > > >
> > > > > > Please let me know.
> > > > > >
> > > > > > Thanks,
> > > > > >
> > > > > > David
> > > > > >
> > > > > > --
> > > > > > lift, the secure, simple, powerful web framework
> http://liftweb.net
> > > > > > Collaborative Task Management http://much4.us
> > > > > >
> > > > > >
> > > > > >
> ------------------------------------------------------------------------
> > > > > >
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > >
> > > > >
> > > > > --
> > > > >  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
> > > > >   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
> > > > >  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
> > > > >
> > > >
> > > >
> > > >
> > > >
> > > > --
> > > > lift, the secure, simple, powerful web framework
> > > > http://liftweb.net
> > > > Collaborative Task Management http://much4.us
> > > >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >
> > > >
> > >
> > >
> > >
> > > --
> > > Alexis Richardson
> > > +44 20 7617 7339 (UK)
> > > +44 77 9865 2911 (cell)
> > > +1 650 206 2517 (US)
> > >
> >
> >
> >
> > --
> > Alexis Richardson
> > +44 20 7617 7339 (UK)
> > +44 77 9865 2911 (cell)
> > +1 650 206 2517 (US)
> >
>
>
>
> --
>
>
> lift, the secure, simple, powerful web framework http://liftweb.net
> Collaborative Task Management http://much4.us



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



