From gtcampbell at gmail.com  Sun Aug  1 01:20:01 2010
From: gtcampbell at gmail.com (Greg Campbell)
Date: Sat, 31 Jul 2010 17:20:01 -0700
Subject: [rabbitmq-discuss] Potential channel.flow_ok bug in either .NET
	client, server, or my 	code
Message-ID: <AANLkTimokS7cB6jOunGM9cnCxGJ-L67AVBPUjqq-6LOc@mail.gmail.com>

Has anyone seen this error before?  .NET client 1.8.1, rabbitmq-server
1.8.1:

connection <0.244.0> (running), channel 1 - error:
{amqp_error,command_invalid,
            "received channel.flow_ok{active=false} has incorrect polarity",
            'channel.flow_ok'}

This causes the channel to be closed.  About 1 minute previous, there was a
vm_memory_high_watermark set followed within 4 seconds by a
vm_memory_high_watermark clear.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100731/893968d4/attachment.htm>

From abhishek.kona at gmail.com  Sun Aug  1 04:37:45 2010
From: abhishek.kona at gmail.com (Abhishek K)
Date: Sun, 1 Aug 2010 09:07:45 +0530
Subject: [rabbitmq-discuss] Non Acknowledged Messages
Message-ID: <AANLkTimA4M5niy7fcH11RYkMU+-eY2++f2ceVtAROakH@mail.gmail.com>

Please correct me if I am wrong.

   - Messages are kept in the Queue if they are not acknowledged.
   - If Client A has not got acknowledgement for a message another Consumer
   can read the message.
   - I need to implement a method in which a message when sent to a consumer
   and awaits ACK, it should not be sent to another consumer. Only after a
   certain time out , can the message be resent to any other consumer. Any
   Ideas?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100801/2267156e/attachment.htm>

From matthias at rabbitmq.com  Sun Aug  1 08:07:52 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 01 Aug 2010 08:07:52 +0100
Subject: [rabbitmq-discuss] Non Acknowledged Messages
In-Reply-To: <AANLkTimA4M5niy7fcH11RYkMU+-eY2++f2ceVtAROakH@mail.gmail.com>
References: <AANLkTimA4M5niy7fcH11RYkMU+-eY2++f2ceVtAROakH@mail.gmail.com>
Message-ID: <4C551D48.6010906@rabbitmq.com>

Abhishek K wrote:
> Please correct me if I am wrong.
> 
>     * Messages are kept in the Queue if they are not acknowledged.

yes, assuming the noAck flag of basic.consume/get wasn't set.

>     * If Client A has not got acknowledgement for a message another
>       Consumer can read the message.

Unacked messages are requeued when the consuming client's channel or 
connection closes, at which point they become available to other consumers.

>     * I need to implement a method in which a message when sent to a
>       consumer and awaits ACK, it should not be sent to another
>       consumer.

That's the behaviour AMQP specifies and RabbitMQ implements.

> Only after a certain time out , can the message be
>       resent to any other consumer. Any Ideas?

This question came up before. See, e.g. 
http://old.nabble.com/adjusting-timeout-for-non-acked-messages-to-be-requeued-td26951114.html#a26951114


Regards,

Matthias

From matthias at rabbitmq.com  Sun Aug  1 08:13:32 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 01 Aug 2010 08:13:32 +0100
Subject: [rabbitmq-discuss] Potential channel.flow_ok bug in either .NET
 client, server, or my 	code
In-Reply-To: <AANLkTimokS7cB6jOunGM9cnCxGJ-L67AVBPUjqq-6LOc@mail.gmail.com>
References: <AANLkTimokS7cB6jOunGM9cnCxGJ-L67AVBPUjqq-6LOc@mail.gmail.com>
Message-ID: <4C551E9C.1020503@rabbitmq.com>

Greg,

Greg Campbell wrote:
> Has anyone seen this error before?  .NET client 1.8.1, rabbitmq-server 
> 1.8.1:
> 
> connection <0.244.0> (running), channel 1 - error:
> {amqp_error,command_invalid,
>             "received channel.flow_ok{active=false} has incorrect polarity",
>             'channel.flow_ok'}

That is a known bug in the .net client. The fix is in mercurial (see 
http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/bee357184618 for the 
change) and will be in the next release.


Regards,

Matthias.

From rgrey at openinit.com  Mon Aug  2 04:08:21 2010
From: rgrey at openinit.com (Robert Grey)
Date: Sun, 1 Aug 2010 23:08:21 -0400
Subject: [rabbitmq-discuss] adding consumers to existing queue
Message-ID: <64196121-29F4-4A0B-B25A-D247DC97AB20@openinit.com>

I apologize if this question has been answered, I've searched the mailing lists and google for a couple of days.

I'm using Python and py-amqplib to connect to a durable, non-auto-delete queue. The consuming clients take a while to process message (~ 2 or 3 minutes) and I would like to increase and decrease clients dynamically to respond to load. Unfortunately, it appears a currently connected client blocks or holds all the messages that were added before new clients connect. Is this correct behavior? Or is there some kind of setting I am missing?

Thanks for any suggestions.

-Robert Grey

From lists at zopyx.com  Mon Aug  2 05:09:23 2010
From: lists at zopyx.com (Andreas Jung)
Date: Mon, 02 Aug 2010 06:09:23 +0200
Subject: [rabbitmq-discuss] adding consumers to existing queue
In-Reply-To: <64196121-29F4-4A0B-B25A-D247DC97AB20@openinit.com>
References: <64196121-29F4-4A0B-B25A-D247DC97AB20@openinit.com>
Message-ID: <4C5644F3.5060500@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I think this is the same issues as asked some weeks ago on the list
(check the archive)...also related to Python. I think I answered that it
is related to the parameters passed to the qos() method. I can not
recall the details...please look in the archive (and check for my answer).

- -aj

Robert Grey wrote:
> I apologize if this question has been answered, I've searched the mailing lists and google for a couple of days.
> 
> I'm using Python and py-amqplib to connect to a durable, non-auto-delete queue. The consuming clients take a while to process message (~ 2 or 3 minutes) and I would like to increase and decrease clients dynamically to respond to load. Unfortunately, it appears a currently connected client blocks or holds all the messages that were added before new clients connect. Is this correct behavior? Or is there some kind of setting I am missing?
> 
> Thanks for any suggestions.
> 
> -Robert Grey
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


- -- 
ZOPYX Limited           | zopyx group
Charlottenstr. 37/1     | The full-service network for Zope & Plone
D-72070 T?bingen        | Produce & Publish
www.zopyx.com           | www.produce-and-publish.com
- ------------------------------------------------------------------------
E-Publishing, Python, Zope & Plone development, Consulting


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkxWRPMACgkQCJIWIbr9KYx2YgCeLSoo/e+ZbMhCiQd9wXGXGMQ9
GXYAoKf+0Bj12HuaMrtQubMlxxqqcZEW
=MNWw
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100802/7209110f/attachment.vcf>

From lists at zopyx.com  Mon Aug  2 05:10:04 2010
From: lists at zopyx.com (Andreas Jung)
Date: Mon, 02 Aug 2010 06:10:04 +0200
Subject: [rabbitmq-discuss] adding consumers to existing queue
In-Reply-To: <64196121-29F4-4A0B-B25A-D247DC97AB20@openinit.com>
References: <64196121-29F4-4A0B-B25A-D247DC97AB20@openinit.com>
Message-ID: <4C56451C.7010300@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Robert Grey wrote:
> I apologize if this question has been answered, I've searched the mailing lists and google for a couple of days.
> 
> I'm using Python and py-amqplib to connect to a durable, non-auto-delete queue. The consuming clients take a while to process message (~ 2 or 3 minutes) and I would like to increase and decrease clients dynamically to respond to load. Unfortunately, it appears a currently connected client blocks or holds all the messages that were added before new clients connect. Is this correct behavior? Or is there some kind of setting I am missing?
> 
> Thanks for any suggestions.
> 

Oh, it's here:

http://answerpot.com/showthread.php?438212-Controlling+rate+of+callbacks

- -aj
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkxWRRwACgkQCJIWIbr9KYx08QCdG0MfhiSHegFbxn6twTUdPt/o
pjkAn3O4kZ4CP2zm5BolRgJM565WCSn0
=h+E3
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100802/b36bf1f9/attachment.vcf>

From simon at rabbitmq.com  Mon Aug  2 12:21:04 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Aug 2010 12:21:04 +0100
Subject: [rabbitmq-discuss] py-amqplib and rabbit default
In-Reply-To: <4C54294F.4020109@rabbitmq.com>
References: <AANLkTim+4VR3bgwaiyAdyNn6sBSiZFXenyNhV1Nqxi7G@mail.gmail.com>	<20100731102828.GA20755@wellquite.org>
	<4C54294F.4020109@rabbitmq.com>
Message-ID: <4C56AA20.6090206@rabbitmq.com>

On 31/07/10 14:46, Simon MacMullen wrote:
> However, we weren't aware that there were clients out there in the wild
> sending even odder handshakes.

Update: Actually the official spec downloadable from amqp.org specifies 
AMQP1191 for AMQP 0-8. I can only assume this is a typo. However most 
clients send AMQP1180. I apologise for impugning the good name of 
py-amqplib :)

Anyway, we've added this case to the protocol negotiation in the server. 
py-amqplib should work again.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthias at rabbitmq.com  Mon Aug  2 12:29:42 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 02 Aug 2010 12:29:42 +0100
Subject: [rabbitmq-discuss] py-amqplib and rabbit default
In-Reply-To: <4C56AA20.6090206@rabbitmq.com>
References: <AANLkTim+4VR3bgwaiyAdyNn6sBSiZFXenyNhV1Nqxi7G@mail.gmail.com>	<20100731102828.GA20755@wellquite.org>	<4C54294F.4020109@rabbitmq.com>
	<4C56AA20.6090206@rabbitmq.com>
Message-ID: <4C56AC26.2080003@rabbitmq.com>

On 02/08/10 12:21, Simon MacMullen wrote:
> On 31/07/10 14:46, Simon MacMullen wrote:
>> However, we weren't aware that there were clients out there in the wild
>> sending even odder handshakes.
>
> Update: Actually the official spec downloadable from amqp.org specifies
> AMQP1191 for AMQP 0-8.

More precisely, the main spec pdf document in in section 4.2.1 says 
that. This error was introduced when the AMQP web site got updated for 
0-9-1.

The 0-8 xml docs have the correct version details, i.e. major=8, minor=0.


Regards,

Matthias.

From kapouer at melix.org  Mon Aug  2 13:44:44 2010
From: kapouer at melix.org (=?UTF-8?B?SsOpcsOpbXkgTGFs?=)
Date: Mon, 02 Aug 2010 14:44:44 +0200
Subject: [rabbitmq-discuss] rabbitmq-stomp badmatch with 1.8.1
Message-ID: <4C56BDBC.7070604@melix.org>

Hi,
i just updated to rabbitmq 1.8.1 with latest stomp plugin (hg #16b4a346f1dd),
and it seems i can't connect to the stomp listener using guest/guest login,
while it worked without any problem with 1.8.0 and corresponding stomp version.


=INFO REPORT==== 2-Aug-2010::14:34:14 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 2-Aug-2010::14:34:14 ===
started STOMP Listener on 127.0.0.1:61613

=INFO REPORT==== 2-Aug-2010::14:34:20 ===
accepted TCP connection on 127.0.0.1:61613 from 127.0.0.1:54894

=INFO REPORT==== 2-Aug-2010::14:34:20 ===
starting STOMP connection <0.195.0> from 127.0.0.1:54894

=ERROR REPORT==== 2-Aug-2010::14:34:20 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {{badmatch,<0.197.0>},
                        [{rabbit_stomp_server,do_login,4},
                         {rabbit_stomp_server,process_frame,3},
                         {rabbit_stomp_server,process_received_bytes,2},
                         {rabbit_stomp_server,init,1},
                         {proc_lib,init_p_do_apply,3}]}

=INFO REPORT==== 2-Aug-2010::14:34:20 ===
ending STOMP connection <0.195.0> from 127.0.0.1:54894


Would someone have any idea why it says so ?

Regards,
J?r?my.


From simon at rabbitmq.com  Mon Aug  2 13:48:59 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Aug 2010 13:48:59 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp badmatch with 1.8.1
In-Reply-To: <4C56BDBC.7070604@melix.org>
References: <4C56BDBC.7070604@melix.org>
Message-ID: <4C56BEBB.2020307@rabbitmq.com>

On 02/08/10 13:44, J?r?my Lal wrote:
> Hi,
> i just updated to rabbitmq 1.8.1 with latest stomp plugin (hg #16b4a346f1dd),
> and it seems i can't connect to the stomp listener using guest/guest login,
> while it worked without any problem with 1.8.0 and corresponding stomp version.

Hi J?r?my. I'm pretty sure that's a too-new version of the STOMP plugin 
for 1.8.1; there have definitely been API changes since 1.8.1. I haven't 
tried it, but I think 619d7826cc21 might work better - if not, try 
around there.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From kapouer at melix.org  Mon Aug  2 13:59:22 2010
From: kapouer at melix.org (=?UTF-8?B?SsOpcsOpbXkgTGFs?=)
Date: Mon, 02 Aug 2010 14:59:22 +0200
Subject: [rabbitmq-discuss] rabbitmq-stomp badmatch with 1.8.1
In-Reply-To: <4C56BEBB.2020307@rabbitmq.com>
References: <4C56BDBC.7070604@melix.org> <4C56BEBB.2020307@rabbitmq.com>
Message-ID: <4C56C12A.90704@melix.org>

On 02/08/2010 14:48, Simon MacMullen wrote:
> On 02/08/10 13:44, J?r?my Lal wrote:
>> Hi,
>> i just updated to rabbitmq 1.8.1 with latest stomp plugin (hg #16b4a346f1dd),
>> and it seems i can't connect to the stomp listener using guest/guest login,
>> while it worked without any problem with 1.8.0 and corresponding stomp version.
> 
> Hi J?r?my. I'm pretty sure that's a too-new version of the STOMP plugin for 1.8.1; there have definitely been API changes since 1.8.1. I haven't tried it, but I think 619d7826cc21 might work better - if not, try around there.
> 
> Cheers, Simon
> 

That's much better using
0428e1a2a2ab

Thank you !

J?r?my.


From rgrey at openinit.com  Mon Aug  2 14:27:59 2010
From: rgrey at openinit.com (Robert Grey)
Date: Mon, 2 Aug 2010 08:27:59 -0500 (CDT)
Subject: [rabbitmq-discuss] adding consumers to existing queue
In-Reply-To: <4C56451C.7010300@zopyx.com>
References: <64196121-29F4-4A0B-B25A-D247DC97AB20@openinit.com>
	<4C56451C.7010300@zopyx.com>
Message-ID: <13FC4202389340DDA2A7696854CBDD91@dev64xp>

Setting the prefetch_count solved the issue. I swear I had tried that
before, maybe just in the wrong location. Thanks for your help Andreas,
you reduced a lot of stress.

-----Original Message-----
From: Andreas Jung [mailto:lists at zopyx.com] 
Sent: Monday, August 02, 2010 12:10 AM
To: Robert Grey
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] adding consumers to existing queue

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Robert Grey wrote:
> I apologize if this question has been answered, I've searched the
mailing lists and google for a couple of days.
> 
> I'm using Python and py-amqplib to connect to a durable, non-auto-delete
queue. The consuming clients take a while to process message (~ 2 or 3
minutes) and I would like to increase and decrease clients dynamically to
respond to load. Unfortunately, it appears a currently connected client
blocks or holds all the messages that were added before new clients
connect. Is this correct behavior? Or is there some kind of setting I am
missing?
> 
> Thanks for any suggestions.
> 

Oh, it's here:

http://answerpot.com/showthread.php?438212-Controlling+rate+of+callbacks

- -aj
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkxWRRwACgkQCJIWIbr9KYx08QCdG0MfhiSHegFbxn6twTUdPt/o
pjkAn3O4kZ4CP2zm5BolRgJM565WCSn0
=h+E3
-----END PGP SIGNATURE-----

From aaron at agoragames.com  Mon Aug  2 15:14:09 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 2 Aug 2010 10:14:09 -0400
Subject: [rabbitmq-discuss] Cluster recovery due to network outages
Message-ID: <AANLkTi=2hL6VRKgv5fxOVD1gGPaYywTyckd4mvrjepEq@mail.gmail.com>

We had an outage in the internal network at our datacenter this
weekend and our rabbit cluster did not fully recover.

We have 4 hosts, all running 1.7.2.  When failures started, we saw
messages like the following (which we've seen before):


=ERROR REPORT==== 1-Aug-2010::06:13:24 ===
** Node rabbit at caerbannog not responding **
** Removing (timedout) connection **

=INFO REPORT==== 1-Aug-2010::06:13:24 ===
node rabbit at caerbannog down


A short time later the hosts recovered, also as we've seen before:

=INFO REPORT==== 1-Aug-2010::06:26:48 ===
node rabbit at caerbannog up
=ERROR REPORT==== 1-Aug-2010::06:26:48 ===
Mnesia(rabbit at bigwig): ** ERROR ** mnesia_event got
{inconsistent_database, running_partitioned_network,
 rabbit at caerbannog}

=ERROR REPORT==== 1-Aug-2010::06:26:48 ===
Mnesia(rabbit at bigwig): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network
, rabbit at caerbannog}


Another 15 minutes later and the timedout errors were logged and that
was the end of the cluster; I think two of the nodes figured out how
to connect back to each other, but two others remained on their own.
The hosts and nodes themselves never shutdown, and when I restarted
just one of the nodes later in the day, the whole cluster rediscovered
itself and all appeared to be well (`rabbitmqctl status` was
consistent with expectations).

So our first problem is that the nodes did not re-cluster after the
second outage.  Once we corrected the cluster though, our applications
still did not respond and we had to restart all of our clients.

Our clients all have a lot of handling for connection drops and
channel closures, but most of them did not see any TCP disconnects to
their respective nodes.  When the cluster was fixed, we found a lot of
our queues missing (they weren't durable), and so we had to restart
all of the apps to redeclare the queues.  This still didn't fix our
installation though, as our apps were receiving and processing data,
but responses were not being sent back out of our HTTP translators.

We have a single exchange, "response" that any application expecting a
response can bind to.  Our HTTP translators handle traffic from our
public endpoints, publish to various exchanges for the services we
offer, and those services in turn write back to the response exchange.
 We have a monitoring tool that confirmed that these translators could
write a response to its own Rabbit host and immediately receive it (a
ping, more or less).  However, none of the responses from services
which were connected to other Rabbit nodes were received by the
translators.

In short, it appeared that even though the cluster was healed and all
our services had re-declared their queues, the bindings between the
response exchange and the queues which our translators use did not
appear to propagate to the rest of the nodes in the cluster.

So in summary,

* Rabbit didn't re-connect to the other nodes after the second TCP disconnect
* After fixing the cluster (manually or automatically), Rabbit appears
to have lost its non-durable queues even though the nodes never
stopped
* Although we had every indication that exchanges and queues were
still alive and functional, bindings appear to have been lost between
Rabbit nodes

What we'd like to know is,

* Does any of this make sense and can we add more detail to help fix any bugs?
* Have there been fixes for these issues since 1.7.2 that we should deploy?
* Is there anything we should add/change about our applications to
deal with these types of situations?


Thanks in advance for any help.
-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From jaredtsmith at gmail.com  Mon Aug  2 17:19:14 2010
From: jaredtsmith at gmail.com (Jared Smith)
Date: Mon, 2 Aug 2010 11:19:14 -0500
Subject: [rabbitmq-discuss] RabbitMQ + amqplib (python)
Message-ID: <AANLkTikPqF5KRM5V2zCMizbG3W7P9KghosYAM9OgNqN3@mail.gmail.com>

I wrote some test code to understand how amqplib and RabbitMQ work together
and I ran into an issue I'm trying to figure out if this is a bug or user
error on my part.

Scenario is that I wanted to simulate an RPC client/Server the client sends
a message to the server and the server will bounce back an answer in the
reply to address.

To simulate the RPC I created a queue client side that I cache for all of my
requests as I found making a new queue for each call makes things much
slower.

Everything works good for the first pass where I send 100k request/response
pairs and I'm getting on the order of 4-5k rpc calls per second.  To make
amqplib have blocking semantics I registered a callback with basic_consume
and have that deposit messages that are read into a blocking queue which the
client thread reads from this; it seems to work ok as far as I can tell.

Problem I'm seeing is that on the second run of the program I get the
following errors:

==============client error=================
Traceback (most recent call last):
  File "amqp_auth_client.py", line 58, in <module>
    client.close()
  File "/andorian2/xsa/mgmt-plane/xsa/mgmt/configd/base_amqp_client.py",
line 171, in close
    self.chan.basic_cancel(queue_name)
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", line
1704, in basic_cancel
  File
"build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py", line
105, in wait
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", line
273, in _close
amqplib.client_0_8.exceptions.AMQPChannelException: (406,
u'PRECONDITION_FAILED - timeout waiting for channel.flow_ok{active=false}',
(0, 0), '')
=======================================

============== matching server error ================
Traceback (most recent call last):
  File "amqp_auth_server.py", line 28, in <module>
    client.waitOnCallback()
  File "/andorian2/xsa/mgmt-plane/xsa/mgmt/configd/base_amqp_client.py",
line 144, in waitOnCallback
    self.chan.wait()
  File
"build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py", line
89, in wait
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py", line
218, in _wait_method
  File
"build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py", line
105, in wait
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py", line
367, in _close
amqplib.client_0_8.exceptions.AMQPConnectionException: (503,
u'COMMAND_INVALID - basic.publish received after
channel.flow_ok{active=false}', (60, 40), 'Channel.basic_publish')
==============================================


When this is run I start RabbitMQ, start my server process and then I start
the client process.  The server stays running for both passes of the test
and the client runs and then exits and then I run it a second time and it
gets the above errors.

Hoping someone can point me to the probable cause here.  Here are some
details on the code that is run:

The queue to receive the response is declared as:
========CLIENT QUEUE FOR RPC RESPONSE=============
retval = self.chan.queue_declare(durable=False,
                                             exclusive=True,
                                             auto_delete=True)
queue_name = retval[0]
self.chan.queue_bind(queue=queue_name,
                                 exchange=BaseMessageClient.exchange_name,
                                 routing_key=queue_name)
=====================

The queue on the server side is declared as follows:

==================SERVER QUEUE ======================
retval = self.chan.queue_declare(
                durable=True,
                exclusive=False,
                auto_delete=False
            )
queue_name = retval[0]
self.subjectToQueue[subject] = queue_name
self.chan.queue_bind(queue=self.subjectToQueue[subject],
                                 exchange=BaseMessageClient.exchange_name,
                                 routing_key=subject)
=====================================================


Server method in the stack is pretty simple just doing this:

    def waitOnCallback(self):
        # Waits on whatever callbacks are registered for this client
        # allowed_methods=[callback]
        while True:
            self.chan.wait()


Client method is doing this:
    def close(self):
        with self._responseQueueLock:
            while not self._responseQueueCache.empty():
                (message_queue,
                 queue_name) = self._responseQueueCache.get(True)
                #self.chan.queue_delete(queue=queue_name)
                self.chan.basic_cancel(queue_name)
        self.chan.close()
        self.conn.close()

Where _responseQueueCache is just a structure that holds the response queues
so they can be re-used.  In normal condition there is just one of these used
as I use a single thread to do the processing on the client.   Since this
works on the first pass not sure if I need to do additional clean up or if
something is wrong in the close method?  I did notice that it does seem to
hang for what seems like a long time when it is shutting down maybe 3-4
seconds at the end of the first pass.


Thank you any advice is appreciated,

Jared
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100802/dd50b0ba/attachment-0001.htm>

From david at rabbitmq.com  Mon Aug  2 17:36:42 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 02 Aug 2010 17:36:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ + amqplib (python)
In-Reply-To: <AANLkTikPqF5KRM5V2zCMizbG3W7P9KghosYAM9OgNqN3@mail.gmail.com>
	(Jared Smith's message of "Mon, 2 Aug 2010 11:19:14 -0500")
References: <AANLkTikPqF5KRM5V2zCMizbG3W7P9KghosYAM9OgNqN3@mail.gmail.com>
Message-ID: <yrv4ck4o9j7j9.fsf@dwragg.eng.vmware.com>

Hi Jared,

Jared Smith <jaredtsmith at gmail.com> writes:
> Everything works good for the first pass where I send 100k
> request/response pairs and I'm getting on the order of 4-5k rpc calls
> per second.  To make amqplib have blocking semantics I registered a
> callback with basic_consume and have that deposit messages that are
> read into a blocking queue which the client thread reads from this; it
> seems to work ok as far as I can tell.
>
> Problem I'm seeing is that on the second run of the program I get the
> following errors:
>
> ==============client error=================
[...]
> u'PRECONDITION_FAILED - timeout waiting for channel.flow_ok{active=false}',
> (0, 0), '')
> =======================================
>
> ============== matching server error ================
[...]
> amqplib.client_0_8.exceptions.AMQPConnectionException: (503,
> u'COMMAND_INVALID - basic.publish received after
> channel.flow_ok{active=false}', (60, 40), 'Channel.basic_publish')
> ==============================================

It's hard to be sure from the fragments of code you posted, but I wonder
if the issue is that you aren't acknowledging the messages?  To do this,
you either need to call basic_consume with no_ack=True (to tell rabbit
not to expect acknowledgements), or call basic_ack in your consuming
code to explicitly ack the messages.

If you don't acknowledge the messages, then they will stay in the queue,
and take up memory, eventually resulting in the channel.flow methods
indicated above.

You could confirm that this is the issue by doing a

    $ sudo rabbitmqctl list_queues

This will list the queues, along with the count of messages in each
queue.  If you do this after your first run, and see that a lot of
messages are still present, then it is very likely to be the lack of
acks causing the problem.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From gturnquist at vmware.com  Mon Aug  2 19:32:40 2010
From: gturnquist at vmware.com (Greg Turnquist)
Date: Mon, 2 Aug 2010 11:32:40 -0700
Subject: [rabbitmq-discuss] rabbitmqctl not reporting anything
Message-ID: <B4D0A127-246A-44E1-B3EB-ABFBD722B5CA@vmware.com>

I started up the server as follows:
$ sudo rabbitmq-server

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.0  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at gturnquist-mbp
app descriptor: /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
home dir      : /opt/local/var/lib/rabbitmq
cookie hash   : LzeGh+Mq7zIqA+aKqg5vxw==
log           : /opt/local/var/log/rabbitmq/rabbit.log
sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running


Trying to ping for some status, it appears the node is unreachable (all on the same machine).

$ sudo rabbitmqctl list_users
Listing users ...
Error: unable to connect to node 'rabbit at gturnquist-mbp': nodedown
diagnostics:
- unable to connect to epmd on gturnquist-mbp: address
- current node: 'rabbitmqctl89889 at gturnquist-mbp'
- current node home dir: /opt/local/var/lib/rabbitmq
- current node cookie hash: LzeGh+Mq7zIqA+aKqg5vxw==

Since I'm trying to ping the server for exchanges, queues, and all that good stuff, this tool isn't working very well. Any clues?
--
Greg Turnquist (greg.turnquist at springsource.com)
Senior Software Engineer
SpringSource, A division of VMware
http://springsource.com


From david at rabbitmq.com  Mon Aug  2 19:52:48 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 02 Aug 2010 19:52:48 +0100
Subject: [rabbitmq-discuss] rabbitmqctl not reporting anything
In-Reply-To: <B4D0A127-246A-44E1-B3EB-ABFBD722B5CA@vmware.com> (Greg
	Turnquist's message of "Mon, 2 Aug 2010 11:32:40 -0700")
References: <B4D0A127-246A-44E1-B3EB-ABFBD722B5CA@vmware.com>
Message-ID: <yrv4cvd7s979b.fsf@dwragg.eng.vmware.com>

Hi Greg,

Greg Turnquist <gturnquist at vmware.com> writes:
> I started up the server as follows:
> $ sudo rabbitmq-server
> [...]
> |   v1.7.0  +---+   |
> [...]
> $ sudo rabbitmqctl list_users
> Listing users ...
> Error: unable to connect to node 'rabbit at gturnquist-mbp': nodedown
> diagnostics:
> - unable to connect to epmd on gturnquist-mbp: address
> - current node: 'rabbitmqctl89889 at gturnquist-mbp'
> - current node home dir: /opt/local/var/lib/rabbitmq
> - current node cookie hash: LzeGh+Mq7zIqA+aKqg5vxw==

I don't recall seeing this issue reported before.  But 1.7.0 is fairly
old, and we've done quite a bit of work on the macports packaging since
then.  Our macports-packaged 1.8.1 in particular seems to work well,
judging from the lack of reported issues.  Could you try upgrading by
following the instructions at <http://www.rabbitmq.com/macports.html>?
I'm not sure whether doing that will fix your problem, but if it
doesn't, it will much easier for us to find the cause.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From matthias at rabbitmq.com  Mon Aug  2 19:55:33 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 02 Aug 2010 19:55:33 +0100
Subject: [rabbitmq-discuss] rabbitmqctl not reporting anything
In-Reply-To: <B4D0A127-246A-44E1-B3EB-ABFBD722B5CA@vmware.com>
References: <B4D0A127-246A-44E1-B3EB-ABFBD722B5CA@vmware.com>
Message-ID: <4C5714A5.60205@rabbitmq.com>

Greg,

Greg Turnquist wrote:
> - unable to connect to epmd on gturnquist-mbp: address

Looks like gturnquist-mbp is not resolvable.


Matthias.

From tsuraan at gmail.com  Mon Aug  2 20:08:27 2010
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 2 Aug 2010 14:08:27 -0500
Subject: [rabbitmq-discuss] py-amqplib and rabbit default
In-Reply-To: <4C56AA20.6090206@rabbitmq.com>
References: <AANLkTim+4VR3bgwaiyAdyNn6sBSiZFXenyNhV1Nqxi7G@mail.gmail.com>
	<20100731102828.GA20755@wellquite.org>
	<4C54294F.4020109@rabbitmq.com> <4C56AA20.6090206@rabbitmq.com>
Message-ID: <AANLkTi=Zxe14g4i2Ya5Bx2fAGbBpjEXtt2UxR8gNg0jH@mail.gmail.com>

> Anyway, we've added this case to the protocol negotiation in the server.
> py-amqplib should work again.

Awesome, thanks!

From mike.petrusis at ericsson.com  Tue Aug  3 09:43:56 2010
From: mike.petrusis at ericsson.com (Mike Petrusis)
Date: Tue, 3 Aug 2010 04:43:56 -0400
Subject: [rabbitmq-discuss] Exactly Once Delivery
Message-ID: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>

Greetings,

In reviewing the mailing list archives, I see various threads which state that ensuring "exactly once" delivery requires deduplication by the consumer.  For example the following:

"Exactly-once requires coordination between consumers, or idempotency,
even when there is just a single queue. The consumer, broker or network
may die during the transmission of the ack for a message, thus causing
retransmission of the message (which the consumer has already seen and
processed) at a later point."  http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-July/004237.html

In the case of competing consumers which pull messages from the same queue, this will require some sort of shared state between consumers to de-duplicate messages (assuming the consumers are not idempotent).   

Our application is using RabbitMQ to distribute tasks across multiple workers residing on different servers, this adds to the cost of sharing state between the workers. 

Another message in the email archive mentions that "You can guarantee exactly-once delivery if you use transactions, durable queues and exchanges, and persistent messages, but only as long as any failing node eventually recovers."

>From the way I understand it, the transaction only affects the publishing of the message into RabbitMQ and prevents the message from being queued until the transaction is committed.  If this is correct, I don't understand how the transaction will prevent a duplicate message in the previously mentioned scenarios that will cause a retransmission.  Can anybody clarify?  

On a more practical level:

What's the recommended way to deal with the potential of duplicate messages?  
What do people generally do? 
Is this a rare enough edge case that most people just ignore it?


Thanks,

Mike

From Sunghyun at altispartners.com  Tue Aug  3 17:22:34 2010
From: Sunghyun at altispartners.com (Sunghyun Lee)
Date: Tue, 3 Aug 2010 17:22:34 +0100
Subject: [rabbitmq-discuss] Http support on windows
Message-ID: <341ABE7319A5F14296A322844570DDF70588BCC216@JYEXC1.ALTISPARTNERS.local>

Hello,

Is it possible to deliver messages to web applications hosted on IIS from the Rabbit broker running on windows? I have had a quick look at the rabbitmq-jsonrpc-channel however being on windows we can't really get this to build.

Is there anything else that might work with windows that I can look at?

Thanks!

Sunghyun Lee | Senior Analyst Programmer
Altis Partners (Jersey)
2 Hill Street | St. Helier | Jersey, JE2 4UA 
t. +44 (0)1534 787 742 | f. +44 (0)870 460 1980 | w. www.altispartners.com

Altis Partners Jersey Limited - registered with the Jersey Financial Services Commission for the conduct of investment business

This email and its contents is issued by Altis Partners Jersey Limited ('APJL') and is for private circulation only.  APJL is registered with the Jersey Financial Services Commission for the conduct of investment business.  The information contained in this email is strictly confidential.  The information and opinions contained in this email are for background purposes only, and do not purport to be full or complete.  Nor does this email constitute investment advice.  APJL is not hereby arranging or agreeing to arrange any transaction in any investment or other undertaking requiring regulatory authorisation. This email does not constitute or form part of any offer to issue or sell, or any solicitation of an offer to subscribe or purchase, any investment nor shall it or the fact of its distribution form the basis of, or be relied on in connection with, any contract therefore.  No representation, warranty, or undertaking, express or limited, is given as to the accuracy or completeness of the information or opinions contained  in this email by any of APJL, its partners or employees and no liability is accepted by such persons for the accuracy or completeness of such information or opinions.  As such, no reliance may be placed on the information and opinions in this email.

This email may contain confidential and/or privileged information.  If you are not the intended recipient or have received this email in error please notify the sender immediately and delete immediately.  Any unauthorised copying, disclosure or distribution of this email is strictly forbidden.
ALTIS-JFSC-NFA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100803/e0a255cc/attachment.htm>

From simon at rabbitmq.com  Tue Aug  3 17:34:43 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Aug 2010 17:34:43 +0100
Subject: [rabbitmq-discuss] Http support on windows
In-Reply-To: <341ABE7319A5F14296A322844570DDF70588BCC216@JYEXC1.ALTISPARTNERS.local>
References: <341ABE7319A5F14296A322844570DDF70588BCC216@JYEXC1.ALTISPARTNERS.local>
Message-ID: <4C584523.6030301@rabbitmq.com>

On 03/08/10 17:22, Sunghyun Lee wrote:
> Is it possible to deliver messages to web applications hosted on IIS
> from the Rabbit broker running on windows? I have had a quick look at
> the rabbitmq-jsonrpc-channel however being on windows we can?t really
> get this to build.

Hi Sunghyun.

If the only problem you have is building it then 
rabbitmq-jsonrpc-channel should still be your best bet. The .ez files 
are cross platform so if you can build it on a Linux VM you can deploy 
to Windows. I think you should be able to build the plugins using Cygwin 
as well.

We're also looking at how we can make plugin installation easier; I'm 
not allowed to make predictions of release dates or anything but I 
intend to get us into a state where we can make binary plugin releases 
at some point.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From johndapps at gmail.com  Tue Aug  3 18:59:02 2010
From: johndapps at gmail.com (John Apps)
Date: Tue, 3 Aug 2010 19:59:02 +0200
Subject: [rabbitmq-discuss] Http support on windows
In-Reply-To: <4C584523.6030301@rabbitmq.com>
References: <341ABE7319A5F14296A322844570DDF70588BCC216@JYEXC1.ALTISPARTNERS.local>
	<4C584523.6030301@rabbitmq.com>
Message-ID: <AANLkTik3SPgCtA299mG9SDD=f_HUxWCnapue+L2xtjFX@mail.gmail.com>

Depending on how the Web applications are written that are running under
IIS, I am wondering whether the .NET client would not be appropriate? Or
perhaps I missed something here?

On Tue, Aug 3, 2010 at 18:34, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 03/08/10 17:22, Sunghyun Lee wrote:
>
>> Is it possible to deliver messages to web applications hosted on IIS
>> from the Rabbit broker running on windows? I have had a quick look at
>> the rabbitmq-jsonrpc-channel however being on windows we can?t really
>> get this to build.
>>
>
> Hi Sunghyun.
>
> If the only problem you have is building it then rabbitmq-jsonrpc-channel
> should still be your best bet. The .ez files are cross platform so if you
> can build it on a Linux VM you can deploy to Windows. I think you should be
> able to build the plugins using Cygwin as well.
>
> We're also looking at how we can make plugin installation easier; I'm not
> allowed to make predictions of release dates or anything but I intend to get
> us into a state where we can make binary plugin releases at some point.
>
> Cheers, Simon
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100803/5a610b42/attachment.htm>

From gturnquist at vmware.com  Tue Aug  3 20:29:02 2010
From: gturnquist at vmware.com (Greg Turnquist)
Date: Tue, 3 Aug 2010 12:29:02 -0700
Subject: [rabbitmq-discuss] rabbitmqctl not reporting anything
In-Reply-To: <4C5714A5.60205@rabbitmq.com>
References: <B4D0A127-246A-44E1-B3EB-ABFBD722B5CA@vmware.com>
	<4C5714A5.60205@rabbitmq.com>
Message-ID: <46DF62FA-9B66-4900-8FC3-F9CD6C304358@vmware.com>

I loaded rabbitmq 1.8.0. When I fire up rabbitmq-server, I see the following:
+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.8.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at gturnquist-mbp
app descriptor : /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.8.1/sbin/../ebin/rabbit.app
home dir       : /opt/local/var/lib/rabbitmq
cookie hash    : WsSCWeum/oLXE3iNW2zauw==
log            : /opt/local/var/log/rabbitmq/rabbit at gturnquist-mbp.log
sasl log       : /opt/local/var/log/rabbitmq/rabbit at gturnquist-mbp-sasl.log
database dir   : /opt/local/var/lib/rabbitmq/mnesia/rabbit at gturnquist-mbp
erlang version : 5.8

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting exchange type registry                                       ...done
starting exchange type topic                                          ...done
starting exchange type headers                                        ...done
starting exchange type fanout                                         ...done
starting exchange type direct                                         ...done
starting internal event notification system                           ...done
starting logging server                                               ...done
-- kernel ready
starting alarm handler                                                ...done
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
-- network listeners available

broker running

rabbitmqctl tries to access the same node name:

gturnquist-mbp:~ gturnquist$ sudo rabbitmqctl list_exchanges
Listing exchanges ...
Error: unable to connect to node 'rabbit at gturnquist-mbp': nodedown
diagnostics:
- unable to connect to epmd on gturnquist-mbp: address
- current node: 'rabbitmqctl50582 at gturnquist-mbp'
- current node home dir: /opt/local/var/lib/rabbitmq
- current node cookie hash: WsSCWeum/oLXE3iNW2zauw==


I don't know where it decided to call the node rabbit at gturnquist-mbp. It is the local hostname, but I usually use gturnquist-mbp.local to reference my local LAN IP address. I don't see how to override this setting from either the server or the ctl script. It seems like an issue, because I thought doing all this on the same node would be out-of-the-box functionality.

On Aug 2, 2010, at 1:55 PM, Matthias Radestock wrote:

> Greg,
> 
> Greg Turnquist wrote:
>> - unable to connect to epmd on gturnquist-mbp: address
> 
> Looks like gturnquist-mbp is not resolvable.
> 
> 
> Matthias.

--
Greg Turnquist (greg.turnquist at springsource.com)
Senior Software Engineer
SpringSource, A division of VMware
http://springsource.com


From aaron at agoragames.com  Tue Aug  3 20:40:29 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 3 Aug 2010 15:40:29 -0400
Subject: [rabbitmq-discuss] rabbitmqctl not reporting anything
In-Reply-To: <46DF62FA-9B66-4900-8FC3-F9CD6C304358@vmware.com>
References: <B4D0A127-246A-44E1-B3EB-ABFBD722B5CA@vmware.com>
	<4C5714A5.60205@rabbitmq.com>
	<46DF62FA-9B66-4900-8FC3-F9CD6C304358@vmware.com>
Message-ID: <AANLkTimZLxq2Zh0kDv6xtc7rskETuAG3Y9DtfNUEnYM4@mail.gmail.com>

Greg,

Check your /etc/hosts file, I know we've had similar problems when
this was misconfigured.  I forget exactly what an incorrect setup
looks like, but here's how ours look now:

bofh at warren:~$ cat /etc/hosts
127.0.0.1      localhost.localdomain localhost
X.X.X.X          warren.cloud warren
bofh at warren:~$ cat /etc/resolv.conf
search cloud
nameserver X.X.X.X
bofh at warren:~$ cat /etc/hostname
warren
bofh at warren:~$

-Aaron


On Tue, Aug 3, 2010 at 3:29 PM, Greg Turnquist <gturnquist at vmware.com> wrote:
> I don't know where it decided to call the node rabbit at gturnquist-mbp. It is the local hostname, but I usually use gturnquist-mbp.local to reference my local LAN IP address. I don't see how to override this setting from either the server or the ctl script. It seems like an issue, because I thought doing all this on the same node would be out-of-the-box functionality.


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From jamesgeary at CrispThinking.com  Tue Aug  3 23:17:19 2010
From: jamesgeary at CrispThinking.com (James Geary)
Date: Tue, 3 Aug 2010 23:17:19 +0100
Subject: [rabbitmq-discuss] persist to disk feature
Message-ID: <555BCB283BEB174F9BF8A0A73C880BB2030D814874@exchange02.crispthinking.local>

Hi.

I am having trouble finding out any information on the persist-to-disk feature. Has this been released, or is it on it's way? I can find a number of threads going back to last year, but nothing saying that it had been released, or how to configure it. We love the performance of rabbitmq, but to make it really work for our business, we need to be able to queue millions of messages, without risk of the server running out of memory, and crashing.

Thanks,

James

From Sunghyun at altispartners.com  Wed Aug  4 11:33:44 2010
From: Sunghyun at altispartners.com (Sunghyun Lee)
Date: Wed, 4 Aug 2010 11:33:44 +0100
Subject: [rabbitmq-discuss] Http support on windows
In-Reply-To: <AANLkTik3SPgCtA299mG9SDD=f_HUxWCnapue+L2xtjFX@mail.gmail.com>
References: <341ABE7319A5F14296A322844570DDF70588BCC216@JYEXC1.ALTISPARTNERS.local>
	<4C584523.6030301@rabbitmq.com>
	<AANLkTik3SPgCtA299mG9SDD=f_HUxWCnapue+L2xtjFX@mail.gmail.com>
Message-ID: <341ABE7319A5F14296A322844570DDF70588BCC217@JYEXC1.ALTISPARTNERS.local>

Thanks for the response,

The problem with IIS is that the worker process will recycle resulting in the consumer being killed.  Rather than look at resolving this behaviour in IIS we want to deliver messages by POSTing messages via HTTP to our web applications.  If a message is received by an application that IIS is not currently running then IIS will start that application and allow that message to be processed.

We think the rabbitmq-jsonrpc-channel will provide this functionality however we are not sure.  We have also considered creating a windows service to act as a channel adaptor taking in rabbitmq messages and converting them to http calls.

Are we heading in the right direction or missing something?



From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of John Apps
Sent: 03 August 2010 18:59
To: Simon MacMullen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Http support on windows

Depending on how the Web applications are written that are running under IIS, I am wondering whether the .NET client would not be appropriate? Or perhaps I missed something here?
On Tue, Aug 3, 2010 at 18:34, Simon MacMullen <simon at rabbitmq.com><mailto:simon at rabbitmq.com>> wrote:
On 03/08/10 17:22, Sunghyun Lee wrote:
Is it possible to deliver messages to web applications hosted on IIS
from the Rabbit broker running on windows? I have had a quick look at
the rabbitmq-jsonrpc-channel however being on windows we can't really
get this to build.

Hi Sunghyun.

If the only problem you have is building it then rabbitmq-jsonrpc-channel should still be your best bet. The .ez files are cross platform so if you can build it on a Linux VM you can deploy to Windows. I think you should be able to build the plugins using Cygwin as well.

We're also looking at how we can make plugin installation easier; I'm not allowed to make predictions of release dates or anything but I intend to get us into a state where we can make binary plugin releases at some point.

Cheers, Simon
--
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



--
---
John Apps
(49) 171 869 1813

Sunghyun Lee | Senior Analyst Programmer
Altis Partners (Jersey)
2 Hill Street | St. Helier | Jersey, JE2 4UA 
t. +44 (0)1534 787 742 | f. +44 (0)870 460 1980 | w. www.altispartners.com

Altis Partners Jersey Limited - registered with the Jersey Financial Services Commission for the conduct of investment business

This email and its contents is issued by Altis Partners Jersey Limited ('APJL') and is for private circulation only.  APJL is registered with the Jersey Financial Services Commission for the conduct of investment business.  The information contained in this email is strictly confidential.  The information and opinions contained in this email are for background purposes only, and do not purport to be full or complete.  Nor does this email constitute investment advice.  APJL is not hereby arranging or agreeing to arrange any transaction in any investment or other undertaking requiring regulatory authorisation. This email does not constitute or form part of any offer to issue or sell, or any solicitation of an offer to subscribe or purchase, any investment nor shall it or the fact of its distribution form the basis of, or be relied on in connection with, any contract therefore.  No representation, warranty, or undertaking, express or limited, is given as to the accuracy or completeness of the information or opinions contained  in this email by any of APJL, its partners or employees and no liability is accepted by such persons for the accuracy or completeness of such information or opinions.  As such, no reliance may be placed on the information and opinions in this email.

This email may contain confidential and/or privileged information.  If you are not the intended recipient or have received this email in error please notify the sender immediately and delete immediately.  Any unauthorised copying, disclosure or distribution of this email is strictly forbidden.
ALTIS-JFSC-NFA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100804/4ba797b9/attachment.htm>

From simon at rabbitmq.com  Wed Aug  4 13:45:07 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Aug 2010 13:45:07 +0100
Subject: [rabbitmq-discuss] persist to disk feature
In-Reply-To: <555BCB283BEB174F9BF8A0A73C880BB2030D814874@exchange02.crispthinking.local>
References: <555BCB283BEB174F9BF8A0A73C880BB2030D814874@exchange02.crispthinking.local>
Message-ID: <4C5960D3.2060407@rabbitmq.com>

On 03/08/10 23:17, James Geary wrote:
> I am having trouble finding out any information on the
> persist-to-disk feature. Has this been released, or is it on it's
> way? I can find a number of threads going back to last year, but
> nothing saying that it had been released, or how to configure it. We
> love the performance of rabbitmq, but to make it really work for our
> business, we need to be able to queue millions of messages, without
> risk of the server running out of memory, and crashing.

Hi James.

The new persister was in QA for a long time, and therefore had to be 
built from a branch in Mercurial. As of a week or so ago, it's been 
merged into default; you still have to build from Mercurial but from the 
default branch.

This also means it will be in the next release, so if you can wait 
that's certainly the easiest way to get it.

Assuming you're using a build with it in at all, there's no 
configuration to do: it just works.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From johndapps at gmail.com  Wed Aug  4 14:14:29 2010
From: johndapps at gmail.com (John Apps)
Date: Wed, 4 Aug 2010 15:14:29 +0200
Subject: [rabbitmq-discuss] rabbitmq-c or librabbitmq (it seems to have 2
	names)
Message-ID: <AANLkTi=d+MWis9o08Q6qN5GdBvkX_uey34YuuwGB+Lr2@mail.gmail.com>

(I fear some of the following has already been asked or noted, so please
bear with me if it has!)

   - rabbitmq-c or librabbitmq is termed experimental, which begs this
   obvious question: what does this mean?
   - Does the library support all the 0.9.1 requirements?
   - Does it support all RabbitMQ 1.8.1 functionality, e.g., flow control?
   - Another way of putting it might be: is it as function-rich as the .NET
   or Java libraries?
   - Is it, or will it be, supported?

The reason for asking is that we have a number of prospective clients who
would benefit from using AMQP in general and RabbitMQ in particular.
However, none of them have Erlang, none of them use Java or .NET, but all of
them have C/C++ or other high-level language code such as COBOL. If we are
to work with these clients we will need something a bit more reassuring than
'experimental'...

Cheers, John
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100804/4b47859f/attachment.htm>

From jaredtsmith at gmail.com  Wed Aug  4 14:31:09 2010
From: jaredtsmith at gmail.com (Jared Smith)
Date: Wed, 4 Aug 2010 08:31:09 -0500
Subject: [rabbitmq-discuss] RabbitMQ + amqplib (python)
In-Reply-To: <yrv4ck4o9j7j9.fsf@dwragg.eng.vmware.com>
References: <AANLkTikPqF5KRM5V2zCMizbG3W7P9KghosYAM9OgNqN3@mail.gmail.com>
	<yrv4ck4o9j7j9.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=0F+66uu88ZaF__PtSosaXM16FVbVheb1e5wMx@mail.gmail.com>

Thanks for the pointer looking at the queues was very helpful figured out I
was never cleaning out the server queues and I kept re-creating a new one
each time it was restarted and they were all bound to the same topic.  So
the sending of 100k messages from the client resulted in coping those 100k
messages into tens of queues making millions of copies of messages.

I changed the server queue to be non-durable and it looked like I can do
many passes with no crash now.

Thanks!

Jared

On Mon, Aug 2, 2010 at 11:36 AM, David Wragg <david at rabbitmq.com> wrote:

> Hi Jared,
>
> Jared Smith <jaredtsmith at gmail.com> writes:
> > Everything works good for the first pass where I send 100k
> > request/response pairs and I'm getting on the order of 4-5k rpc calls
> > per second.  To make amqplib have blocking semantics I registered a
> > callback with basic_consume and have that deposit messages that are
> > read into a blocking queue which the client thread reads from this; it
> > seems to work ok as far as I can tell.
> >
> > Problem I'm seeing is that on the second run of the program I get the
> > following errors:
> >
> > ==============client error=================
> [...]
> > u'PRECONDITION_FAILED - timeout waiting for
> channel.flow_ok{active=false}',
> > (0, 0), '')
> > =======================================
> >
> > ============== matching server error ================
> [...]
> > amqplib.client_0_8.exceptions.AMQPConnectionException: (503,
> > u'COMMAND_INVALID - basic.publish received after
> > channel.flow_ok{active=false}', (60, 40), 'Channel.basic_publish')
> > ==============================================
>
> It's hard to be sure from the fragments of code you posted, but I wonder
> if the issue is that you aren't acknowledging the messages?  To do this,
> you either need to call basic_consume with no_ack=True (to tell rabbit
> not to expect acknowledgements), or call basic_ack in your consuming
> code to explicitly ack the messages.
>
> If you don't acknowledge the messages, then they will stay in the queue,
> and take up memory, eventually resulting in the channel.flow methods
> indicated above.
>
> You could confirm that this is the issue by doing a
>
>    $ sudo rabbitmqctl list_queues
>
> This will list the queues, along with the count of messages in each
> queue.  If you do this after your first run, and see that a lot of
> messages are still present, then it is very likely to be the lack of
> acks causing the problem.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100804/824dec6f/attachment.htm>

From alexandru at rabbitmq.com  Wed Aug  4 14:45:40 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Wed, 4 Aug 2010 14:45:40 +0100
Subject: [rabbitmq-discuss] Cluster recovery due to network outages
In-Reply-To: <AANLkTi=2hL6VRKgv5fxOVD1gGPaYywTyckd4mvrjepEq@mail.gmail.com>
References: <AANLkTi=2hL6VRKgv5fxOVD1gGPaYywTyckd4mvrjepEq@mail.gmail.com>
Message-ID: <20100804134540.GA19625@dakota.eng.vmware.com>

Hi Aaron,

> =ERROR REPORT==== 1-Aug-2010::06:13:24 ===
> ** Node rabbit at caerbannog not responding **
> ** Removing (timedout) connection **
> 
> =INFO REPORT==== 1-Aug-2010::06:13:24 ===
> node rabbit at caerbannog down

As the error message suggests, it means mnesia timed out a connection to
another node.
 
There was a discussion about this a while ago
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-March/006508.html

If you're expecting frequent short outages, you might consider
tweaking the timeout parameters as described above.

> A short time later the hosts recovered, also as we've seen before:
> 
> =INFO REPORT==== 1-Aug-2010::06:26:48 ===
> node rabbit at caerbannog up
> =ERROR REPORT==== 1-Aug-2010::06:26:48 ===
> Mnesia(rabbit at bigwig): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network,
>  rabbit at caerbannog}
> 
> =ERROR REPORT==== 1-Aug-2010::06:26:48 ===
> Mnesia(rabbit at bigwig): ** ERROR ** mnesia_event got
> {inconsistent_database, starting_partitioned_network
> , rabbit at caerbannog}
> 

During the outage, the nodes were out of contact with each other for
so long that mnesia is worried about possible inconsistencies.

The simplest solution would be to take down 3 of the nodes and
restart them.  This should allow them to sync with the fourth.

There's a longer explanation available here.

http://www.erlang.org/doc/apps/mnesia/Mnesia_chap7.html#id2277661

> Another 15 minutes later and the timedout errors were logged and that
> was the end of the cluster; I think two of the nodes figured out how
> to connect back to each other, but two others remained on their own.
> The hosts and nodes themselves never shutdown, and when I restarted
> just one of the nodes later in the day, the whole cluster rediscovered
> itself and all appeared to be well (`rabbitmqctl status` was
> consistent with expectations).
> 
> So our first problem is that the nodes did not re-cluster after the
> second outage.

If this was caused by the inconsistent_database errors, there's not
much you can do apart from a restart of some of the nodes.

> Once we corrected the cluster though, our applications
> still did not respond and we had to restart all of our clients.
> 
> Our clients all have a lot of handling for connection drops and
> channel closures, but most of them did not see any TCP disconnects to
> their respective nodes.  When the cluster was fixed, we found a lot of
> our queues missing (they weren't durable), and so we had to restart
> all of the apps to redeclare the queues.  This still didn't fix our
> installation though, as our apps were receiving and processing data,
> but responses were not being sent back out of our HTTP translators.
> 
> We have a single exchange, "response" that any application expecting a
> response can bind to.  Our HTTP translators handle traffic from our
> public endpoints, publish to various exchanges for the services we
> offer, and those services in turn write back to the response exchange.
>  We have a monitoring tool that confirmed that these translators could
> write a response to its own Rabbit host and immediately receive it (a
> ping, more or less).  However, none of the responses from services
> which were connected to other Rabbit nodes were received by the
> translators.
> 
> In short, it appeared that even though the cluster was healed and all
> our services had re-declared their queues, the bindings between the
> response exchange and the queues which our translators use did not
> appear to propagate to the rest of the nodes in the cluster.

That doesn't sound right.  As you say, if the cluster was indeed
running, the queues/exhanges/bindings should have appeared on all of the
nodes.

It's possible that the rabbit nodes reconnected succesfully, but the
mnesia ones didn't.  When a rabbitmq node detects another has gone
down, it automatically removes the queues declared on it from the
cluster.  If the rabbit nodes think everything is fine, this removal
wouldn't happen.  As a result, rabbitmqctl might report
queues/exchanges/bindings that are actually unusable.

> So in summary,
> 
> * Rabbit didn't re-connect to the other nodes after the second TCP disconnect

We don't have any logic in the broker to recover from
inconsistent_database errors.  Your best bet is probably to restart
all but one of the nodes.

> * After fixing the cluster (manually or automatically), Rabbit appears
> to have lost its non-durable queues even though the nodes never
> stopped
> * Although we had every indication that exchanges and queues were
> still alive and functional, bindings appear to have been lost between
> Rabbit nodes

See above.  The cluster may not have been completely repaired.  Try
restarting.

> What we'd like to know is,
> 
> * Does any of this make sense and can we add more detail to help fix any bugs?

It makes some sense.  Thanks for pointing this problem out.

> * Have there been fixes for these issues since 1.7.2 that we should deploy?

Not to this, sorry.

> * Is there anything we should add/change about our applications to
> deal with these types of situations?

I'm not sure what you could do to prevent this.  This is more of a
mnesia problem.

Cheers,
Alex

From aaron at agoragames.com  Wed Aug  4 14:52:13 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 4 Aug 2010 09:52:13 -0400
Subject: [rabbitmq-discuss] Cluster recovery due to network outages
In-Reply-To: <20100804134540.GA19625@dakota.eng.vmware.com>
References: <AANLkTi=2hL6VRKgv5fxOVD1gGPaYywTyckd4mvrjepEq@mail.gmail.com>
	<20100804134540.GA19625@dakota.eng.vmware.com>
Message-ID: <AANLkTin6b7C98BP6MoUM4w0_vghBAitzYV1kaHpOVMmZ@mail.gmail.com>

Alex,

Thank you for your reply.  We're building up our Erlang, Rabbit and
Mnesia knowledge and I'll pass along your reply to the rest of the
team.

cheers,
Aaron

On Wed, Aug 4, 2010 at 9:45 AM, Alexandru Scvortov
<alexandru at rabbitmq.com> wrote:
> Hi Aaron,
>
>> =ERROR REPORT==== 1-Aug-2010::06:13:24 ===
>> ** Node rabbit at caerbannog not responding **
>> ** Removing (timedout) connection **
>>
>> =INFO REPORT==== 1-Aug-2010::06:13:24 ===
>> node rabbit at caerbannog down
>
> As the error message suggests, it means mnesia timed out a connection to
> another node.
>
> There was a discussion about this a while ago
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-March/006508.html
>
> If you're expecting frequent short outages, you might consider
> tweaking the timeout parameters as described above.
>
>> A short time later the hosts recovered, also as we've seen before:
>>
>> =INFO REPORT==== 1-Aug-2010::06:26:48 ===
>> node rabbit at caerbannog up
>> =ERROR REPORT==== 1-Aug-2010::06:26:48 ===
>> Mnesia(rabbit at bigwig): ** ERROR ** mnesia_event got
>> {inconsistent_database, running_partitioned_network,
>> ?rabbit at caerbannog}
>>
>> =ERROR REPORT==== 1-Aug-2010::06:26:48 ===
>> Mnesia(rabbit at bigwig): ** ERROR ** mnesia_event got
>> {inconsistent_database, starting_partitioned_network
>> , rabbit at caerbannog}
>>
>
> During the outage, the nodes were out of contact with each other for
> so long that mnesia is worried about possible inconsistencies.
>
> The simplest solution would be to take down 3 of the nodes and
> restart them. ?This should allow them to sync with the fourth.
>
> There's a longer explanation available here.
>
> http://www.erlang.org/doc/apps/mnesia/Mnesia_chap7.html#id2277661
>
>> Another 15 minutes later and the timedout errors were logged and that
>> was the end of the cluster; I think two of the nodes figured out how
>> to connect back to each other, but two others remained on their own.
>> The hosts and nodes themselves never shutdown, and when I restarted
>> just one of the nodes later in the day, the whole cluster rediscovered
>> itself and all appeared to be well (`rabbitmqctl status` was
>> consistent with expectations).
>>
>> So our first problem is that the nodes did not re-cluster after the
>> second outage.
>
> If this was caused by the inconsistent_database errors, there's not
> much you can do apart from a restart of some of the nodes.
>
>> Once we corrected the cluster though, our applications
>> still did not respond and we had to restart all of our clients.
>>
>> Our clients all have a lot of handling for connection drops and
>> channel closures, but most of them did not see any TCP disconnects to
>> their respective nodes. ?When the cluster was fixed, we found a lot of
>> our queues missing (they weren't durable), and so we had to restart
>> all of the apps to redeclare the queues. ?This still didn't fix our
>> installation though, as our apps were receiving and processing data,
>> but responses were not being sent back out of our HTTP translators.
>>
>> We have a single exchange, "response" that any application expecting a
>> response can bind to. ?Our HTTP translators handle traffic from our
>> public endpoints, publish to various exchanges for the services we
>> offer, and those services in turn write back to the response exchange.
>> ?We have a monitoring tool that confirmed that these translators could
>> write a response to its own Rabbit host and immediately receive it (a
>> ping, more or less). ?However, none of the responses from services
>> which were connected to other Rabbit nodes were received by the
>> translators.
>>
>> In short, it appeared that even though the cluster was healed and all
>> our services had re-declared their queues, the bindings between the
>> response exchange and the queues which our translators use did not
>> appear to propagate to the rest of the nodes in the cluster.
>
> That doesn't sound right. ?As you say, if the cluster was indeed
> running, the queues/exhanges/bindings should have appeared on all of the
> nodes.
>
> It's possible that the rabbit nodes reconnected succesfully, but the
> mnesia ones didn't. ?When a rabbitmq node detects another has gone
> down, it automatically removes the queues declared on it from the
> cluster. ?If the rabbit nodes think everything is fine, this removal
> wouldn't happen. ?As a result, rabbitmqctl might report
> queues/exchanges/bindings that are actually unusable.
>
>> So in summary,
>>
>> * Rabbit didn't re-connect to the other nodes after the second TCP disconnect
>
> We don't have any logic in the broker to recover from
> inconsistent_database errors. ?Your best bet is probably to restart
> all but one of the nodes.
>
>> * After fixing the cluster (manually or automatically), Rabbit appears
>> to have lost its non-durable queues even though the nodes never
>> stopped
>> * Although we had every indication that exchanges and queues were
>> still alive and functional, bindings appear to have been lost between
>> Rabbit nodes
>
> See above. ?The cluster may not have been completely repaired. ?Try
> restarting.
>
>> What we'd like to know is,
>>
>> * Does any of this make sense and can we add more detail to help fix any bugs?
>
> It makes some sense. ?Thanks for pointing this problem out.
>
>> * Have there been fixes for these issues since 1.7.2 that we should deploy?
>
> Not to this, sorry.
>
>> * Is there anything we should add/change about our applications to
>> deal with these types of situations?
>
> I'm not sure what you could do to prevent this. ?This is more of a
> mnesia problem.
>
> Cheers,
> Alex
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From david at rabbitmq.com  Wed Aug  4 15:11:55 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 04 Aug 2010 15:11:55 +0100
Subject: [rabbitmq-discuss] rabbitmq-c or librabbitmq (it seems to have
	2 names)
In-Reply-To: <AANLkTi=d+MWis9o08Q6qN5GdBvkX_uey34YuuwGB+Lr2@mail.gmail.com>
	(John Apps's message of "Wed, 4 Aug 2010 15:14:29 +0200")
References: <AANLkTi=d+MWis9o08Q6qN5GdBvkX_uey34YuuwGB+Lr2@mail.gmail.com>
Message-ID: <yrv4ceieeii1g.fsf@dwragg.eng.vmware.com>

John Apps <johndapps at gmail.com> writes:
> (I fear some of the following has already been asked or noted, so please
> bear with me if it has!)

Responding to the "rabbitmq-c or librabbitmq" question: rabbitmq-c is
the name of its source code repository, following our convention for
other components of the RabbitMQ suite.  librabbitmq is the resulting
library you can build from that source code, following the Unix
convention for library names.  As well as the library, rabbitmq-c
includes some example code and command-line tools based on librabbitmq.

>    - rabbitmq-c or librabbitmq is termed experimental, which begs this
>    obvious question: what does this mean?

It means that, although we are developing and maintaining it, it has not
yet received the degree of review that our officially supported client
libraries have (the Java and .NET ones).  So for instance, in the
process of such a review we might decide that significant changes are
required to the API exposed by the library.  We'd also like to see full
Windows support, so that it can be used on the same platforms as the
broker.

The "experimental" label is not a comment on its quality.  It is robust,
and many people are already using it.  Judged by the general standard of
AMQP client libraries out there, for all languages, it's in good shape.

>    - Does the library support all the 0.9.1 requirements?

There is a 0-9-1 branch, that seems in good shape to be merged soon.  We
haven't done a careful conformance-checking pass against the spec, but
it seems unlikely that there are major areas of non-conformance.

>    - Does it support all RabbitMQ 1.8.1 functionality, e.g., flow
>    control?

It doesn't yet support flow control.

>    - Another way of putting it might be: is it as function-rich as the .NET
>    or Java libraries?

Not quite.  As noted, flow control is missing.  It's also missing a few
less commonly used AMQP operations in its API (e.g. basic_reject,
basic_recover), though adding these would be trivial.

>    - Is it, or will it be, supported?
>
> The reason for asking is that we have a number of prospective clients who
> would benefit from using AMQP in general and RabbitMQ in particular.
> However, none of them have Erlang, none of them use Java or .NET, but all of
> them have C/C++ or other high-level language code such as COBOL. If we are
> to work with these clients we will need something a bit more reassuring than
> 'experimental'...

We have also heard quite a bit of interest in librabbitmq from the kinds
of users who would appreciate the reassurance that declaring it
"officially supported" would bring.  So it is very likely that it will
become supported.  But we cannot yet commit to a time scale for when
that will happen.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From cameron at cameronharris.org  Wed Aug  4 16:06:05 2010
From: cameron at cameronharris.org (Cameron Harris)
Date: Wed, 4 Aug 2010 16:06:05 +0100
Subject: [rabbitmq-discuss] JSONRPCError - Internal error: badmatch
Message-ID: <AANLkTik+dSh0JKZJzWRVSF1e_PzQeXRYB0g+s48Ww=yH@mail.gmail.com>

Hi all,

I've installed rabbitmq on OS X 10.6 via MacPorts, and built and
installed the rabbitmq-jsonrpc, rabbitmq-jsonrpc-channel, mochiweb,
rabbitmq-mochiweb, rfc4627_jsonrpc plugins.

After installing, I went to the example page on localhost:55672, and
clicked the Simple JSONRPC test. I get the following output:

test_main
{"installGenericProxy":{"name":"open","idempotent":false,"params":
[{"name":"username","type":"str"},{"name":"password","type":"str"},
{"name":"sessionTimeout","type":"num"},
{"name":"virtualHost","type":"str"}]}}
open
JsonRPC error:
Service: "/rpc/rabbitmq"
Method: "open"
Params: ["guest","guest",5,null]
Response: {"version":"1.1","id":2,"error":
{"name":"JSONRPCError","code":500,"message":"Internal
error","error":"{{{badmatch,{error,{{badmatch,<0.13932.0>},
                   [{rabbit_jsonrpc_channel,init,1},
                    {gen_server,init_it,6},
                    {proc_lib,init_p_do_apply,3}]}}},
 [{rabbit_jsonrpc_channel,open,1},
  {rabbit_jsonrpc_channel_factory,handle_call,3},
  {gen_server,handle_msg,5},
  {proc_lib,init_p_do_apply,3}]},
 {gen_server,call,
            [<0.8986.0>,
             {jsonrpc,<<\"open\">>,
                      {obj,[{\"http_method\",<<\"POST\">>},
                            {\"http_query_parameters\",{obj,[]}},
                            {\"http_headers\",
                             {obj,[{\"accept\",<<\"*/*\">>},

{\"accept-charset\",<<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},

{\"accept-encoding\",<<\"gzip,deflate\">>},

{\"accept-language\",<<\"en-us,en;q=0.5\">>},
                                   {\"cache-control\",<<\"no-cache\">>},
                                   {\"connection\",<<\"keep-alive\">>},
                                   {\"content-length\",<<\"74\">>},

{\"content-type\",<<\"application/json;charset=UTF-8\">>},
                                   {\"host\",<<\"localhost:55672\">>},
                                   {\"keep-alive\",<<\"115\">>},
                                   {\"pragma\",<<\"no-cache\">>},
                                   {\"referer\",<<\"
http://localhost:55672/rabbitmq_lib/www-examples/test/index.html\">>},
                                   {\"user-agent\",<<\"Mozilla/5.0
(Macintosh; IntelMac OS X 10.6; rv:2.0b3pre) Gecko/20100729
Minefield/4.0b3pre\">>},
                                   {\"x-json-rpc-timeout\",<<\"30000\">>},

{\"x-requested-with\",<<\"XMLHttpRequest\">>}]}},
                            {\"remote_peername\",<<\"127.0.0.1\">>},
                            {\"scheme\",<<\"http\">>}]},
                      [<<\"guest\">>,<<\"guest\">>,5,null]},
             30000]}}"}}
-------

The broker has started without any errors and appears to be
functioning, and when I tried the rabbitmq-status plugin, that worked
fine.

My rabbitmqctl status is:
Status of node rabbit at Bilbo ...
[{running_applications,
    [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
     {rabbit,"RabbitMQ","1.8.1"},
     {os_mon,"CPO  CXC 138 46","2.2.5"},
     {sasl,"SASL  CXC 138 11","2.1.9.2"},
     {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
     {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
     {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
     {mochiweb,"MochiMedia Web Server","1.3"},
     {crypto,"CRYPTO version 2","2.0"},
     {inets,"INETS  CXC 138 49","5.4"},
     {mnesia,"MNESIA  CXC 138 12","4.4.14"},
     {stdlib,"ERTS  CXC 138 10","1.17"},
     {kernel,"ERTS  CXC 138 10","2.14"}]},
 {nodes,[{disc,[rabbit at Bilbo]}]},
 {running_nodes,[rabbit at Bilbo]}]
...done.

Thanks,
Cameron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100804/4269a2df/attachment.htm>

From pdezwart at rubiconproject.com  Wed Aug  4 18:45:13 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 04 Aug 2010 10:45:13 -0700
Subject: [rabbitmq-discuss] rabbitmq-c or librabbitmq (it seems to have2
 names)
In-Reply-To: <yrv4ceieeii1g.fsf@dwragg.eng.vmware.com>
Message-ID: <C87EF539.D59A%pdezwart@rubiconproject.com>

Ive said this before, but I will say it again:

+1 for official C library support. I would love to see this get done, and
obviously the sooner the better because I keep on having to tweak the PHP
extension all the time, and its getting old.
I mean, seriously, what do we pay you all this good money fo--

Oh. =)

Pieter


On 8/4/10 7:11 AM, "David Wragg" <david at rabbitmq.com> wrote:

> John Apps <johndapps at gmail.com> writes:
>> > (I fear some of the following has already been asked or noted, so please
>> > bear with me if it has!)
> 
> Responding to the "rabbitmq-c or librabbitmq" question: rabbitmq-c is
> the name of its source code repository, following our convention for
> other components of the RabbitMQ suite.  librabbitmq is the resulting
> library you can build from that source code, following the Unix
> convention for library names.  As well as the library, rabbitmq-c
> includes some example code and command-line tools based on librabbitmq.
> 
>> >    - rabbitmq-c or librabbitmq is termed experimental, which begs this
>> >    obvious question: what does this mean?
> 
> It means that, although we are developing and maintaining it, it has not
> yet received the degree of review that our officially supported client
> libraries have (the Java and .NET ones).  So for instance, in the
> process of such a review we might decide that significant changes are
> required to the API exposed by the library.  We'd also like to see full
> Windows support, so that it can be used on the same platforms as the
> broker.
> 
> The "experimental" label is not a comment on its quality.  It is robust,
> and many people are already using it.  Judged by the general standard of
> AMQP client libraries out there, for all languages, it's in good shape.
> 
>> >    - Does the library support all the 0.9.1 requirements?
> 
> There is a 0-9-1 branch, that seems in good shape to be merged soon.  We
> haven't done a careful conformance-checking pass against the spec, but
> it seems unlikely that there are major areas of non-conformance.
> 
>> >    - Does it support all RabbitMQ 1.8.1 functionality, e.g., flow
>> >    control?
> 
> It doesn't yet support flow control.
> 
>> >    - Another way of putting it might be: is it as function-rich as the .NET
>> >    or Java libraries?
> 
> Not quite.  As noted, flow control is missing.  It's also missing a few
> less commonly used AMQP operations in its API (e.g. basic_reject,
> basic_recover), though adding these would be trivial.
> 
>> >    - Is it, or will it be, supported?
>> >
>> > The reason for asking is that we have a number of prospective clients who
>> > would benefit from using AMQP in general and RabbitMQ in particular.
>> > However, none of them have Erlang, none of them use Java or .NET, but all
>> of
>> > them have C/C++ or other high-level language code such as COBOL. If we are
>> > to work with these clients we will need something a bit more reassuring
>> than
>> > 'experimental'...
> 
> We have also heard quite a bit of interest in librabbitmq from the kinds
> of users who would appreciate the reassurance that declaring it
> "officially supported" would bring.  So it is very likely that it will
> become supported.  But we cannot yet commit to a time scale for when
> that will happen.
> 
> David
> 
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-- 
the rubicon project

PIETER DE ZWART | INTERFACES TEAM, LEAD ENGINEER
??? P 310 207 0272 | x224
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100804/6db54cc1/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100804/6db54cc1/attachment-0001.png>

From arun.suresh at gmail.com  Thu Aug  5 06:51:50 2010
From: arun.suresh at gmail.com (Arun Suresh)
Date: Wed, 4 Aug 2010 22:51:50 -0700
Subject: [rabbitmq-discuss]  messages getting stuck in queue
Message-ID: <AANLkTinKFoPjcKvGfWG9xe-nNxfnsKgWXpe9yOk2+YRu@mail.gmail.com>

Hi

Im currently using rabbitmq-1.7.2. Ive noticed that many a times... messages
remain stuck in the queue and there is no way for me to extract them.. I
tries running the list_queues command... and I see that the queues does have
consumers waiting for messages.. but the message is never sent... I event
tried restarting the rabbitmq instance and having consumers reconnect to
it.. but of no avail..

Was wondering if anybody else has faced this issue.. and if so, what could
be the cause ?

Thanks in advance
-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100804/a6503b8a/attachment.htm>

From alexandru at rabbitmq.com  Thu Aug  5 07:37:49 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Thu, 5 Aug 2010 07:37:49 +0100
Subject: [rabbitmq-discuss] messages getting stuck in queue
In-Reply-To: <AANLkTinKFoPjcKvGfWG9xe-nNxfnsKgWXpe9yOk2+YRu@mail.gmail.com>
References: <AANLkTinKFoPjcKvGfWG9xe-nNxfnsKgWXpe9yOk2+YRu@mail.gmail.com>
Message-ID: <20100805063748.GB9478@dakota>

Hi Arun,

> Im currently using rabbitmq-1.7.2. Ive noticed that many a times... messages
> remain stuck in the queue and there is no way for me to extract them.. I
> tries running the list_queues command... and I see that the queues does have
> consumers waiting for messages.. but the message is never sent... I event
> tried restarting the rabbitmq instance and having consumers reconnect to
> it.. but of no avail..

It isn't really possible for messages to get ``stuck'' in a queue.

If there are consumers on the queue, then the messages should get
delivered to them.

A few questions:
  * Are you sure the consumers are written correctly and that they're
    getting messages off the queue?
  * Are you in no-ack mode or are you explicitly acking the messages?
    Otherwise, the messages will get deliverd but will not get taken off
    the queue.

Hope this helps.

Cheers,
Alex


From jiri at krutil.com  Thu Aug  5 09:21:35 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Thu, 05 Aug 2010 10:21:35 +0200
Subject: [rabbitmq-discuss] Broker accepts self-signed client certificate in
	verify_peer mode
Message-ID: <20100805102135.19094860wnfezm2o@webmail.active24.cz>

When experimenting with SSL connections to RabbitMQ, I came across a  
very strange thing.

The RabbitMQ server is configured to require a client certificate and  
verify the chain of trust (see rabbitmq.config below). I'm using my  
own CA that has a self-signed certificate. This is the only trusted  
root CA certificate I'm using.

RabbitMQ correctly accepts client certificates signed by my CA. But it  
also accepts self-signed client certificates, which I think is  
incorrect. I believe a self-signed client certificate should be  
rejected because there is no chain of trust to the root CA certificate.

I did not find anything helpful in the RabbitMQ logs. Am I doing  
something wrong?

I'm using RabbitMQ server 1.8.1, Erlang R13B03 and new_ssl 3.10.7.

Contents of rabbitmq.config:
[
     {rabbit, [
         {ssl_listeners, [{"0.0.0.0",5671}]},
         {ssl_options, [
             {cacertfile,"~/ssl/ca/cacert.pem"},
             {certfile,"~/ssl/server/servercert.pem"},
             {keyfile,"~/ssl/server/serverkey.pem"},
             {verify,verify_peer},
             {fail_if_no_peer_cert,true},
             {ssl_imp,new}
         ]}
     ]}
].

Self-signed CA certificate (cacert.pem):
-----BEGIN CERTIFICATE-----
MIICyjCCAbKgAwIBAgIJANP7tyB3tORuMA0GCSqGSIb3DQEBBQUAMBUxEzARBgNV
BAMTCkNhcGFjaXR5Q0EwHhcNMTAwNzI5MTUxMzEzWhcNMTEwNzI5MTUxMzEzWjAV
MRMwEQYDVQQDEwpDYXBhY2l0eUNBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB
CgKCAQEAqpg4Zo25u/OK+8dwBaMLoZVZevi/DLnCvLPZ4g88DItIC8L4mLxCo2Mj
z3WHMo703PFNkGOnvqDkfmvVdsKC/TtGb4zQWQ84dseuORUyYUS4uqKVyaQr8ZYO
G67E8NbRgLnO+hJc4jJBR2ooF5IjSUMdfUBJ2GFDFgeE4DyYY0Qk/0jGW030ZbUI
1qTR0ng14boWo6tBULDOGsozRnh6K5oV2A6rxEKMSfHPdsH4cUYUZc94ftiMvABM
e0NMVuiXKUB1uXN9SZXVM9ve0ohQ+g81XAASTxylT11vCq52SqCCMg0uVNO9hFFW
fVMsCgfBkcn7kL/1hrwrZi9jJQ4pCQIDAQABox0wGzAMBgNVHRMEBTADAQH/MAsG
A1UdDwQEAwIBBjANBgkqhkiG9w0BAQUFAAOCAQEAMdZ4L1kOQpkDwcGkGhfPnEsC
C96NnhFR6DjZ2MAjK+5vSfmbqxFTxwHpbYbYasJ8HoRHU8GfcjAexjQOAyFbKkEM
DtKlYiBN2DOlMkpK4YSuRcERonsA9DfVxS/y+6Z1uzXy+Gmmaa4AB+K8UtFng/s+
zQZ1ISc0CTtzRVDp7hUBfdl6vW7fVSVoUF6L92eZxMJah4SvU1MZxoW2GeGfw3ZM
t0CU4PPciGBDT4iCrF/JVblNP2VcPvDnYR37l3WC7tUftmAH6ysuV+b0Xm7FmWGH
wO+h5/taFGSgwj+sZTSrFctRWjX0+Nc3YjuvQJo+0QhM0l/psguVnOErN0Z2lQ==
-----END CERTIFICATE-----

Self-signed client certificate:
-----BEGIN CERTIFICATE-----
MIIDzTCCArWgAwIBAgIJAKYbO0v1Ug8AMA0GCSqGSIb3DQEBBQUAME0xCzAJBgNV
BAYTAkRFMQowCAYDVQQIEwEgMQowCAYDVQQHEwEgMQowCAYDVQQKEwEgMQowCAYD
VQQLEwEgMQ4wDAYDVQQDEwVVc2VyMTAeFw0xMDA4MDQxMjU5NTBaFw0xMTA4MDQx
MjU5NTBaME0xCzAJBgNVBAYTAkRFMQowCAYDVQQIEwEgMQowCAYDVQQHEwEgMQow
CAYDVQQKEwEgMQowCAYDVQQLEwEgMQ4wDAYDVQQDEwVVc2VyMTCCASIwDQYJKoZI
hvcNAQEBBQADggEPADCCAQoCggEBALHxPfWg+M8qSyps48YOpj58iI6NAxXrssDR
xi2oSIn+4mM8SpEMX0LIG8v/N8Xrc61XrK1LvLkyWUrpK1KoTxswcgBaomAzRu6i
RPpEZQ6vSYwS4zPWYr6MaAJpErV/+IuabaPnVGPk5uPk8G6N3AuzjFlD3DmAyzXx
FFCf/cyCfjnAfU77RSrl1/ldXYTiZvgRAqvRRr4sFYwA2jH2Nrb676V3IsNvwT4h
5/6Gy469MF0cTIxd8gvoT0IdbkdgWX3H9DQ7jAGk2UA0+ThI/Gj/OJ04mXjnNQp7
5N6lRQE6cn/cZCCnT24eYD+0FdqBY45sdNRs77iKulDEfJA7pz0CAwEAAaOBrzCB
rDAdBgNVHQ4EFgQUBTMBjdui9J2zb4Ksb3f283IybSYwfQYDVR0jBHYwdIAUBTMB
jdui9J2zb4Ksb3f283IybSahUaRPME0xCzAJBgNVBAYTAkRFMQowCAYDVQQIEwEg
MQowCAYDVQQHEwEgMQowCAYDVQQKEwEgMQowCAYDVQQLEwEgMQ4wDAYDVQQDEwVV
c2VyMYIJAKYbO0v1Ug8AMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEB
AC5tYG0Uzb2ktbir++HM28SjPPORjmuLHE/6nCxzPagbQdrB2auAx4wz9kAass/3
CBqqx42tKtAMmQ2h9BjqBIvOePGuYFGJE5ClXsRKqbCedImXQWha32UAaaFxUzcN
ZkSYVU14+3ex2ud+RtNyIrUEgEmkvZSbZgLPHnBng8hxwA6wB9hjfphlcqvSNhot
Jnx98yBT8ETA3p+heiu2mIUzqSeNCpx7F5rPbBST0n8cFCDOKAoybGUekH6A2Ntk
uTgk3HILrJDWEp9gT53eUQaVnEbFQ5YOyEElfIej0PWwhGPzjLRB32MWQuXDuef5
WXmX4YvXnVSRZmfh4AXRZbo=
-----END CERTIFICATE-----


From matthew at rabbitmq.com  Thu Aug  5 12:22:52 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 5 Aug 2010 12:22:52 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
Message-ID: <20100805112252.GH17061@rabbitmq.com>

Hi Mike,

On Tue, Aug 03, 2010 at 04:43:56AM -0400, Mike Petrusis wrote:
> In reviewing the mailing list archives, I see various threads which state that ensuring "exactly once" delivery requires deduplication by the consumer.  For example the following:
> 
> "Exactly-once requires coordination between consumers, or idempotency,
> even when there is just a single queue. The consumer, broker or network
> may die during the transmission of the ack for a message, thus causing
> retransmission of the message (which the consumer has already seen and
> processed) at a later point."  http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-July/004237.html
> 
> In the case of competing consumers which pull messages from the same queue, this will require some sort of shared state between consumers to de-duplicate messages (assuming the consumers are not idempotent).   
> 
> Our application is using RabbitMQ to distribute tasks across multiple workers residing on different servers, this adds to the cost of sharing state between the workers. 
> 
> Another message in the email archive mentions that "You can guarantee exactly-once delivery if you use transactions, durable queues and exchanges, and persistent messages, but only as long as any failing node eventually recovers."

All the above is sort of wrong. You can never *guarantee* exactly once
(there's always some argument about whether receiving message duplicates
but relying on idempotency is achieving exactly once. I don't feel it
does, and this should become clearer as to why further on...)

The problem is publishers. If the server on which RabbitMQ is running
crashes, after commiting a transaction containing publishes, it's
possible the commit-ok message may get lost. Thus the publishers still
think they need to republish, so wait until the broker comes back up and
then republishes. This can happen an infinite number of times: the
publishers connect, start a transaction, publish messages, commit the
transaction and then the commit-ok gets lost and so the publishers
repeat the process.

As a result, on the clients, you need to detect duplicates. Now this is
really a barrier to making all operations idempotent. The problem is
that you never know how many copies of a message there will be. Thus you
never know when it's safe to remove messages from your dedup cache. Now
things like redis apparently have the means to delete entries after an
amount of time, which would at least allow you to avoid the database
eating up all the RAM in the universe, but there's still the possibility
that after the entry's been deleted, another duplicate will come along
which you now won't detect as a duplicate.

This isn't just a problem with RabbitMQ - in any messaging system, if
any message can be lost, you can not achieve exactly once semantics. The
best you can hope for is a probability of a large number of 9s that you
will be able to detect all the duplicates. But that's the best you can
achieve.

Scaling horizontally is thus more tricky because, as you say, you may
now have multiple consumers which each receive one copy of a message.
Thus the dedup database would have to be distributed. With high message
rates, this might well become prohibitive because of the amount of
network traffic due to transactions between the consumers.

> What's the recommended way to deal with the potential of duplicate messages?  

Currently, there is no "recommended" way. If you have a single consumer,
it's quite easy - something like tokyocabinet should be more than
sufficiently performant. For multiple consumers, you're currently going
to have to look at some sort of distributed database.

> Is this a rare enough edge case that most people just ignore it?

No idea. But one way of making your life easier is for the producer to
send slightly different messages on every republish (they would still
obviously need to have the same msg id). That way, if you detect a msg
with "republish count" == 0, then you know it's the first copy, so you
can insert async into your shared database and then act on the message.
You only need to do a query on the database whenever you receive a msg
with "republish count" > 0 - thus you can tune your database for
inserts and hopefully save some work - the common case will then be the
first case, and lookups will be exceedingly rare.

The question then is: if you've received a msg, republish count > 0 but
there are no entries in the database, what do you do? It shouldn't have
overtaken the first publish (though if consumers disconnected without
acking, or requeued messages, it could have), but you need to cause some
sort of synchronise operation between all the consumers to ensure none
are in the process of adding to the database - it all gets a bit hairy
at this point.

Thus if your message rate is low, you're much safer doing the insert and
select on every message. If that's too expensive, you're going to have
to think very hard indeed about how to avoid races between different
consumers thinking they're both/all responsible for acting on the same
message.

This stuff isn't easy.

Matthew

From johndapps at gmail.com  Thu Aug  5 14:00:11 2010
From: johndapps at gmail.com (John Apps)
Date: Thu, 5 Aug 2010 15:00:11 +0200
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <20100805112252.GH17061@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
Message-ID: <AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>

Matthew,
  an excellent response and thank you for it! Yes, difficult it is!

It raises a somewhat philosophical discussion around where the onus is
placed in terms of guaranteeing such things as 'guaranteed once', i.e., on
the client side or on the server side? The JMS standard offers guaranteed
once, whereby the onus is on the server (JMS implementation) and not on the
client.

What I am trying to say is that, in my opinion, client programs should be as
'simple' as possible with the servers doing all the hard work. This is what
the JMS standard forces on implementors and, perhaps to a lesser extent
today, do does AMQP.

Note: the word 'server' is horribly overloaded these days. It is used here
to indicate the software with which clients, producers and consumers,
communicate.

Oh well, off to librabbitMQ and some example programs written in COBOL...

Cheers, John
On Thu, Aug 5, 2010 at 13:22, Matthew Sackman <matthew at rabbitmq.com> wrote:

> Hi Mike,
>
> On Tue, Aug 03, 2010 at 04:43:56AM -0400, Mike Petrusis wrote:
> > In reviewing the mailing list archives, I see various threads which state
> that ensuring "exactly once" delivery requires deduplication by the
> consumer.  For example the following:
> >
> > "Exactly-once requires coordination between consumers, or idempotency,
> > even when there is just a single queue. The consumer, broker or network
> > may die during the transmission of the ack for a message, thus causing
> > retransmission of the message (which the consumer has already seen and
> > processed) at a later point."
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-July/004237.html
> >
> > In the case of competing consumers which pull messages from the same
> queue, this will require some sort of shared state between consumers to
> de-duplicate messages (assuming the consumers are not idempotent).
> >
> > Our application is using RabbitMQ to distribute tasks across multiple
> workers residing on different servers, this adds to the cost of sharing
> state between the workers.
> >
> > Another message in the email archive mentions that "You can guarantee
> exactly-once delivery if you use transactions, durable queues and exchanges,
> and persistent messages, but only as long as any failing node eventually
> recovers."
>
> All the above is sort of wrong. You can never *guarantee* exactly once
> (there's always some argument about whether receiving message duplicates
> but relying on idempotency is achieving exactly once. I don't feel it
> does, and this should become clearer as to why further on...)
>
> The problem is publishers. If the server on which RabbitMQ is running
> crashes, after commiting a transaction containing publishes, it's
> possible the commit-ok message may get lost. Thus the publishers still
> think they need to republish, so wait until the broker comes back up and
> then republishes. This can happen an infinite number of times: the
> publishers connect, start a transaction, publish messages, commit the
> transaction and then the commit-ok gets lost and so the publishers
> repeat the process.
>
> As a result, on the clients, you need to detect duplicates. Now this is
> really a barrier to making all operations idempotent. The problem is
> that you never know how many copies of a message there will be. Thus you
> never know when it's safe to remove messages from your dedup cache. Now
> things like redis apparently have the means to delete entries after an
> amount of time, which would at least allow you to avoid the database
> eating up all the RAM in the universe, but there's still the possibility
> that after the entry's been deleted, another duplicate will come along
> which you now won't detect as a duplicate.
>
> This isn't just a problem with RabbitMQ - in any messaging system, if
> any message can be lost, you can not achieve exactly once semantics. The
> best you can hope for is a probability of a large number of 9s that you
> will be able to detect all the duplicates. But that's the best you can
> achieve.
>
> Scaling horizontally is thus more tricky because, as you say, you may
> now have multiple consumers which each receive one copy of a message.
> Thus the dedup database would have to be distributed. With high message
> rates, this might well become prohibitive because of the amount of
> network traffic due to transactions between the consumers.
>
> > What's the recommended way to deal with the potential of duplicate
> messages?
>
> Currently, there is no "recommended" way. If you have a single consumer,
> it's quite easy - something like tokyocabinet should be more than
> sufficiently performant. For multiple consumers, you're currently going
> to have to look at some sort of distributed database.
>
> > Is this a rare enough edge case that most people just ignore it?
>
> No idea. But one way of making your life easier is for the producer to
> send slightly different messages on every republish (they would still
> obviously need to have the same msg id). That way, if you detect a msg
> with "republish count" == 0, then you know it's the first copy, so you
> can insert async into your shared database and then act on the message.
> You only need to do a query on the database whenever you receive a msg
> with "republish count" > 0 - thus you can tune your database for
> inserts and hopefully save some work - the common case will then be the
> first case, and lookups will be exceedingly rare.
>
> The question then is: if you've received a msg, republish count > 0 but
> there are no entries in the database, what do you do? It shouldn't have
> overtaken the first publish (though if consumers disconnected without
> acking, or requeued messages, it could have), but you need to cause some
> sort of synchronise operation between all the consumers to ensure none
> are in the process of adding to the database - it all gets a bit hairy
> at this point.
>
> Thus if your message rate is low, you're much safer doing the insert and
> select on every message. If that's too expensive, you're going to have
> to think very hard indeed about how to avoid races between different
> consumers thinking they're both/all responsible for acting on the same
> message.
>
> This stuff isn't easy.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100805/7eca06e8/attachment.htm>

From tonyg at rabbitmq.com  Thu Aug  5 14:48:40 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Thu, 05 Aug 2010 09:48:40 -0400
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
Message-ID: <4C5AC138.1010706@rabbitmq.com>

John Apps wrote:
> The JMS standard offers guaranteed once

What exactly do they mean by that? In particular, how do they deal with
duplicates? Do they report failure, or silently let a dup through in certain
situations? If you could point me to the part of the spec that sets out the JMS
resolution of these issues, that's be really useful.

Tony


From tonyg at rabbitmq.com  Thu Aug  5 14:50:46 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Thu, 05 Aug 2010 09:50:46 -0400
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <20100805112252.GH17061@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
Message-ID: <4C5AC1B6.5080707@rabbitmq.com>

Matthew Sackman wrote:
> As a result, on the clients, you need to detect duplicates. Now this is
> really a barrier to making all operations idempotent. The problem is
> that you never know how many copies of a message there will be. Thus you
> never know when it's safe to remove messages from your dedup cache.

The other piece of this is time-to-live (TTL). Given a finite-length dedup
cache and message TTL, you can detect and report failure. (And if the ack
travels upstream to the publisher, you can report failures at the send end,
too.) Without the TTL, you have silent dups on rare occasions.

Tony


From david at rabbitmq.com  Thu Aug  5 15:16:50 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 05 Aug 2010 15:16:50 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5AC138.1010706@rabbitmq.com> (Tony Garnock-Jones's message of
	"Thu, 05 Aug 2010 09:48:40 -0400")
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
Message-ID: <yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>

Tony Garnock-Jones <tonyg at rabbitmq.com> writes:
> John Apps wrote:
>> The JMS standard offers guaranteed once
>
> What exactly do they mean by that? In particular, how do they deal
> with duplicates? Do they report failure, or silently let a dup through
> in certain situations? If you could point me to the part of the spec
> that sets out the JMS resolution of these issues, that's be really
> useful.

As an API spec, it's quite easy for JMS to mandate something apparently
impossible, without hinting at how it might actually be implemented.

Most of the spec says that the PERSISTENT delivery mode gives
"once-and-only-once" delivery.  But section 4.4.13 (of JMS 1.1) admits
that there are a number of caveats to this.  So it's really
"once-and-only-once-except-in-some-corner-cases".

I think the wrinkle that might prevent us saying that RabbitMQ gives the
same guarantees is on the publishing side.  The caveats in JMS all seems
to apply only to the consuming side.  But what happens with an AMQP
producer if the connection gets dropped before a tx.commit-ok gets back
to the client?  In that case the client has to re-publish, leading to a
potential dup.  This can be avoided by a de-dup filter on published
messages in the broker.  I don't know if JMS brokers really go to such
lengths.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From mikeb at rabbitmq.com  Thu Aug  5 15:17:28 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 05 Aug 2010 15:17:28 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5AC138.1010706@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
Message-ID: <4C5AC7F8.5010101@rabbitmq.com>

> John Apps wrote:
>> The JMS standard offers guaranteed once
> 
> What exactly do they mean by that? In particular, how do they deal with
> duplicates? Do they report failure, or silently let a dup through in certain
> situations? If you could point me to the part of the spec that sets out the JMS
> resolution of these issues, that's be really useful.

For consumers, JMS has client ack mode; the application acknowledges 
messages, and the server must not resend a message that has been 
acknowledged.

A failure in the connection may result in the server resending a message 
which the application thinks it has acknowledged.  The spec suggests 
"Since such clients cannot know for certain if a particular message has 
been acknowledged, they must be prepared for redelivery of the last 
consumed message.".  I.e., the client application has to have an 
idempotency barrier.

For producers, duplicate publishing is simply prohibited.  As for 
failure modes -- "A message that is redelivered due to session recovery 
is not considered a duplicate message."

So JMS cannot magically do "exactly once" any more than anything else.


--Michael

From matthew at rabbitmq.com  Thu Aug  5 15:25:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 5 Aug 2010 15:25:18 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5AC7F8.5010101@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com> <4C5AC7F8.5010101@rabbitmq.com>
Message-ID: <20100805142518.GN17061@rabbitmq.com>

On Thu, Aug 05, 2010 at 03:17:28PM +0100, Michael Bridgen wrote:
> For producers, duplicate publishing is simply prohibited.

So that seems to suggest that every messages is universally unique?

If this is correct, who's responsibility is it to add GUIDs (or some
such) to every message? Does the client library do that automatically?

Matthew

From srijanani.s at gmail.com  Thu Aug  5 16:57:16 2010
From: srijanani.s at gmail.com (Srijanani Srinivasan)
Date: Thu, 5 Aug 2010 10:57:16 -0500
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100728124626.GH554@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
	<20100726151140.GC6839@rabbitmq.com>
	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
	<20100728124626.GH554@rabbitmq.com>
Message-ID: <AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>

Can you guys tell me more about the new persister that is going to be
released? We are currently using RabbitMQ in our applications and using all
persistent messages.  But we have noticed that when we have like say
millions of messages in the queue, the server goes down which is not
desired. Does the new persister target these issues? It will be helpful for
me to know.

Thanks!
Jan

On Wed, Jul 28, 2010 at 7:46 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Wed, Jul 28, 2010 at 03:22:58PM +0300, Ovidiu Deac wrote:
> > Any idea about when to expect the next official version of rabbitmq?
>
> I can't give out any official date but in the "next few weeks".
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100805/992d3795/attachment.htm>

From amenges at vmware.com  Thu Aug  5 17:16:14 2010
From: amenges at vmware.com (Tony Menges)
Date: Thu, 5 Aug 2010 09:16:14 -0700
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <20100805142518.GN17061@rabbitmq.com>
Message-ID: <C88031DE.809B%amenges@vmware.com>


The JMS provider sets the message id. It is supposed to be unique enough to be used for a "historical repository" but the scope of uniqueness is left to the provider. It is recommended that it should be at least unique for a given "installation". I don't think this helps on the publisher side since as you pointed out the notification of the completion of the publish might not make it back to the producer.

JMS requires the provider to set the redelivered flag (and optionally the delivery count) field if it thinks the message has been given to the application before. The application may or may not have seen it but this flag can be used to trigger the check for a duplicate by the application. The use of unique message ids helps on this end.

Tony Menges
VMware, Inc.


On 8/5/10 7:25 AM, "Matthew Sackman" <matthew at rabbitmq.com> wrote:

On Thu, Aug 05, 2010 at 03:17:28PM +0100, Michael Bridgen wrote:
> For producers, duplicate publishing is simply prohibited.

So that seems to suggest that every messages is universally unique?

If this is correct, who's responsibility is it to add GUIDs (or some
such) to every message? Does the client library do that automatically?

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From johndapps at gmail.com  Thu Aug  5 17:20:32 2010
From: johndapps at gmail.com (John Apps)
Date: Thu, 5 Aug 2010 18:20:32 +0200
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5AC138.1010706@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
Message-ID: <AANLkTimKPKfi=H0ErSuhtrxSA4ZtXzgvVG48A3UBWDRw@mail.gmail.com>

>From my possibly naive understanding of the spec, it means quite simply that
a message will be delivered guaranteed once and only once; but I somehow do
not think that that is quite what you were asking?

The nice part about JMS is that it is only an API spec and says nothing
about implementation.
I would have to look into the spec to see what the answer is to the
question: "...how do they deal with duplicates..." etc. If I find the time,
I shall be happy to look at the odd JMS implementation and see what the
various vendors do in cases such as that in question.
What I do know is that one can specify notification for when a message with
"guaranteed delivery" simply cannot be delivered, for whatever reason. This
can be to the client or, more likely, as a message from the 'server' to
those that want to know.

A relatively unknown product called Reliable Transaction Router (RTR),
architected and developed long ago by DEC and still maintained and developed
by HP, warns, when it considers that a message *may* be a duplicate, i.e.,
has possibly been delivered previously, of the fact. This is also the case
when messages are being 'replayed' after a server has been brought down and
is now receiving messages which flowed through the network whilst it was
down.

There is much discussion around the word "guaranteed", the objection being
that nothing can be "guaranteed". Of course it cannot, but if we take things
to that extent, we may as well give up right away!

On Thu, Aug 5, 2010 at 15:48, Tony Garnock-Jones <tonyg at rabbitmq.com> wrote:

> John Apps wrote:
> > The JMS standard offers guaranteed once
>
> What exactly do they mean by that? In particular, how do they deal with
> duplicates? Do they report failure, or silently let a dup through in
> certain
> situations? If you could point me to the part of the spec that sets out the
> JMS
> resolution of these issues, that's be really useful.
>
> Tony
>
>


-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100805/96d3f1b7/attachment.htm>

From matthew at rabbitmq.com  Thu Aug  5 17:25:36 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 5 Aug 2010 17:25:36 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <C88031DE.809B%amenges@vmware.com>
References: <20100805142518.GN17061@rabbitmq.com>
	<C88031DE.809B%amenges@vmware.com>
Message-ID: <20100805162535.GS17061@rabbitmq.com>

On Thu, Aug 05, 2010 at 09:16:14AM -0700, Tony Menges wrote:
> The JMS provider sets the message id. It is supposed to be unique enough to be used for a "historical repository" but the scope of uniqueness is left to the provider. It is recommended that it should be at least unique for a given "installation". I don't think this helps on the publisher side since as you pointed out the notification of the completion of the publish might not make it back to the producer.
> 
> JMS requires the provider to set the redelivered flag (and optionally the delivery count) field if it thinks the message has been given to the application before. The application may or may not have seen it but this flag can be used to trigger the check for a duplicate by the application. The use of unique message ids helps on this end.

Ahh interesting. It would thus seem that JMS requires slightly more of
the producer when publishing messages (more logic is required in the
client library there) and AMQP possibly requires more at the consumer
side.

Matthew

From jon.brisbin at npcinternational.com  Thu Aug  5 17:30:08 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 5 Aug 2010 11:30:08 -0500
Subject: [rabbitmq-discuss] BQL with 1.8.1
Message-ID: <E465122C-2465-4BB9-B615-E8F0AACB6932@npcinternational.com>

Trying to follow the directions on installing the BQL plugin into my freshly-updated 1.8.1 broker and I get various errors like the below.

Will this work with 1.8.1?

Jon Brisbin
Portal Webmaster
NPC International, Inc.


=INFO REPORT==== 5-Aug-2010::11:25:11 ===
Limiting to approx 924 file handles

=INFO REPORT==== 5-Aug-2010::11:25:11 ===
Memory limit set to 25318MB.

=INFO REPORT==== 5-Aug-2010::11:25:11 ===
Rolling persister log to "/var/lib/rabbitmq/mnesia/rabbit at warehouse1/rabbit_persister.LOG.previous"

=INFO REPORT==== 5-Aug-2010::11:25:11 ===
started TCP Listener on 0.0.0.0:5672

=ERROR REPORT==== 5-Aug-2010::11:25:11 ===
** Generic server <0.218.0> terminating 
** Last message in was {command,{open_channel,none}}
** When Server state == {dc_state,
                            {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
                                "localhost",5672,0,0,0,none,[]},
                            false,
                            [{<<"product">>,longstr,<<"RabbitMQ">>},
                             {<<"version">>,longstr,<<"1.8.1">>},
                             {<<"platform">>,longstr,<<"Erlang/OTP">>},
                             {<<"copyright">>,longstr,
                              <<"Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.">>},
                             {<<"information">>,longstr,
                              <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>}],
                            {{0,nil},
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}}},
                            <0.219.0>}
** Reason for termination == 
** {{badmatch,{error,{{badmatch,<0.221.0>},
                      [{amqp_channel_util,start_channel_infrastructure,3},
                       {amqp_channel,init,1},
                       {gen_server,init_it,6},
                       {proc_lib,init_p_do_apply,3}]}}},
    [{amqp_channel_util,open_channel,5},
     {amqp_direct_connection,handle_command,3},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 5-Aug-2010::11:25:11 ===
** Generic server <0.221.0> terminating 
** Last message in was {'EXIT',<0.220.0>,
                           {{badmatch,<0.221.0>},
                            [{amqp_channel_util,start_channel_infrastructure,
                                 3},
                             {amqp_channel,init,1},
                             {gen_server,init_it,6},
                             {proc_lib,init_p_do_apply,3}]}}
** When Server state == {ch,starting,1,<0.220.0>,<0.220.0>,undefined,none,
                            {set,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                            1,
                            {[],[]},
                            {[],[]},
                            <<"guest">>,<<"/">>,<<>>,
                            {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                            {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                            <0.219.0>,
                            {flow,true,true,none}}
** Reason for termination == 
** {{badmatch,<0.221.0>},
    [{amqp_channel_util,start_channel_infrastructure,3},
     {amqp_channel,init,1},
     {gen_server,init_it,6},
     {proc_lib,init_p_do_apply,3}]}

=INFO REPORT==== 5-Aug-2010::11:25:11 ===
    application: rabbitmq_bql
    exited: {shutdown,{rabbitmq_bql,start,[normal,[]]}}
    type: permanent

=INFO REPORT==== 5-Aug-2010::11:25:11 ===
stopped TCP Listener on 0.0.0.0:5672

=ERROR REPORT==== 5-Aug-2010::11:25:11 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,<0.213.0>,
                       {<0.221.0>,
                        "** Generic server ~p terminating \n** Last message in was ~p~n** When Server state == ~p~n** Reason for termination == ~n** ~p~n",
                        [<0.221.0>,
                         {'EXIT',<0.220.0>,
                             {{badmatch,<0.221.0>},
                              [{amqp_channel_util,
                                   start_channel_infrastructure,3},
                               {amqp_channel,init,1},
                               {gen_server,init_it,6},
                               {proc_lib,init_p_do_apply,3}]}},
                         {ch,starting,1,<0.220.0>,<0.220.0>,undefined,none,
                             {set,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             1,
                             {[],[]},
                             {[],[]},
                             <<"guest">>,<<"/">>,<<>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             <0.219.0>,
                             {flow,true,true,none}},
                         {{badmatch,<0.221.0>},
                          [{amqp_channel_util,start_channel_infrastructure,3},
                           {amqp_channel,init,1},
                           {gen_server,init_it,6},
                           {proc_lib,init_p_do_apply,3}]}]}}
** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
** Reason == {badarg,[{ets,lookup,[rabbit_exchange_type_registry,topic]},
                      {rabbit_exchange_type_registry,lookup_module,1},
                      {rabbit_exchange,type_to_module,1},
                      {rabbit_exchange,publish,3},
                      {rabbit_basic,publish,1},
                      {rabbit_error_logger,publish1,4},
                      {rabbit_error_logger,handle_event,2},
                      {gen_event,server_update,4}]}


From jamesgeary at CrispThinking.com  Thu Aug  5 17:39:48 2010
From: jamesgeary at CrispThinking.com (James Geary)
Date: Thu, 5 Aug 2010 17:39:48 +0100
Subject: [rabbitmq-discuss] persist to disk feature
In-Reply-To: <4C5960D3.2060407@rabbitmq.com>
References: <555BCB283BEB174F9BF8A0A73C880BB2030D814874@exchange02.crispthinking.local>
	<4C5960D3.2060407@rabbitmq.com>
Message-ID: <555BCB283BEB174F9BF8A0A73C880BB2030D80B580@exchange02.crispthinking.local>

Awesome. Thanks for the response Simon, this feature is going to make a monumental difference to our use of rabbit. I think we can wait for the next release.... when will that be?

 :-)

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: 04 August 2010 13:45
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] persist to disk feature

On 03/08/10 23:17, James Geary wrote:
> I am having trouble finding out any information on the persist-to-disk 
> feature. Has this been released, or is it on it's way? I can find a 
> number of threads going back to last year, but nothing saying that it 
> had been released, or how to configure it. We love the performance of 
> rabbitmq, but to make it really work for our business, we need to be 
> able to queue millions of messages, without risk of the server running 
> out of memory, and crashing.

Hi James.

The new persister was in QA for a long time, and therefore had to be built from a branch in Mercurial. As of a week or so ago, it's been merged into default; you still have to build from Mercurial but from the default branch.

This also means it will be in the next release, so if you can wait that's certainly the easiest way to get it.

Assuming you're using a build with it in at all, there's no configuration to do: it just works.

Cheers, Simon
--
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Aug  5 17:41:27 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 5 Aug 2010 17:41:27 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
	<20100726151140.GC6839@rabbitmq.com>
	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
	<20100728124626.GH554@rabbitmq.com>
	<AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>
Message-ID: <20100805164127.GT17061@rabbitmq.com>

On Thu, Aug 05, 2010 at 10:57:16AM -0500, Srijanani Srinivasan wrote:
> Can you guys tell me more about the new persister that is going to be
> released? We are currently using RabbitMQ in our applications and using all
> persistent messages.  But we have noticed that when we have like say
> millions of messages in the queue, the server goes down which is not
> desired. Does the new persister target these issues? 

In a word: yes.

The new persister is explicitly designed to target these kinds of
scalability issues: ensuring that Rabbit can easily and happily store
more messages than RAM permits and in some cases getting very close to
zero RAM cost per message.

Matthew

From vchang at ign.com  Thu Aug  5 19:08:47 2010
From: vchang at ign.com (vinse)
Date: Thu, 5 Aug 2010 11:08:47 -0700 (PDT)
Subject: [rabbitmq-discuss]  Disk node vs ram node
Message-ID: <29356379.post@talk.nabble.com>


So I know from an instructions point of view how to set up a clustered
environment with disk nodes and ram nodes, but from the documentation/man
pages I am still unclear of a couple of things.
1.  Assuming I have 3 nodes, node A, B, and C. Does node A become a disk
node by default when I set up the vhosts/users/permissions?

2. With the same node arrangement listed above.... I set up A(created vhost,
users, set permissions etc) and then clustered B against A,B (rabbitmqctl
cluster nodeA nodeB). I took down A and my messages did not persist even
though B should be a disk node. Is there something wrong with my steps?

3. What is the conventional/non-conventional way to determine whether or not
individual nodes in a cluster are a disk or ram nodes?

Thanks.

-- 
View this message in context: http://old.nabble.com/Disk-node-vs-ram-node-tp29356379p29356379.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexandru at rabbitmq.com  Thu Aug  5 20:43:09 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Thu, 5 Aug 2010 20:43:09 +0100
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <29356379.post@talk.nabble.com>
References: <29356379.post@talk.nabble.com>
Message-ID: <20100805194309.GA3413@dakota>

> 1.  Assuming I have 3 nodes, node A, B, and C. Does node A become a disk
> node by default when I set up the vhosts/users/permissions?

The disk nodes are the ones explicitly listed in the "rabbitmqctl
cluster" command.

So,
% rabbitmqctl cluster rabbit at A rabbit at B
results in a cluster where A and B are disk nodes.  If that command is
run on either A or B,  the cluster has just the two nodes.
If, on the other hand, that command is run on C, you get a cluster with
A and B disc nodes (same as above) and C as a ram node.

> 2. With the same node arrangement listed above.... I set up A(created vhost,
> users, set permissions etc) and then clustered B against A,B (rabbitmqctl
> cluster nodeA nodeB). I took down A and my messages did not persist even
> though B should be a disk node. Is there something wrong with my steps?

Queues exist physically only on the node on which they were declared.
Clustering just makes them (and exchanges) accesible transparently on
all of the nodes.

Thus, if the queue was declared on A, and A was taken down, the messages
stored on the queue would become inaccesible.

If you want to never lose messages, have a look at our high-availability
clustering guide in the documentation section of the website.

> 3. What is the conventional/non-conventional way to determine whether or not
> individual nodes in a cluster are a disk or ram nodes?

To find out whether nodes are disc or ram, run
% rabbitmqctl status
on any node in the cluster.

Unfortunately, due to a bug, that command will not report the correct
node type, so it's not of much help to you now.  This problem has been
fixed in our default branch and will be in the release.

Cheers,
Alex

From vchang at ign.com  Thu Aug  5 21:49:51 2010
From: vchang at ign.com (Vince Chang)
Date: Thu, 5 Aug 2010 13:49:51 -0700
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <20100805194309.GA3413@dakota>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
Message-ID: <AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>

Thanks for your response Alex, 

1. So if I start node A by itself, and then cluster B against A, then A becomes a disk node because I specified A in the rabbitmqctl command? Here are the steps

Node1: 
start_app
add_vhost host1
add_user user pass

Node2:
stop_app
reset
cluster node1 <--- (is this the step that makes node A a disk node?)
start_app

Node3:
stop_app
reset
cluster node1 
start_app

2. To be clear, if I send a message that creates the queue Q1 in node A in a cluster with node A, node B, and node C and node A goes down, then I will lose those messages on node A. Node A is down, but B and C should still be alive. If I send the same message to be queued on Q1, will Q1 be created on node B and node C? For me so far, that is not the case. When I send a message to be queued on Q1 (where the messages on Q1 on node A are now lost because node A is down) I do not see the queue getting created on either node B or node C. Is there something wrong with my steps?

3. I am using RabbitMQ 1.7.2. Just to be clear there is _no way_ on 1.7.2 to determine whether or not a node is a disk node or ram node? 

-----Original Message-----
From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru Scvortov
Sent: Thursday, August 05, 2010 12:43 PM
To: Vince Chang
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Disk node vs ram node

> 1.  Assuming I have 3 nodes, node A, B, and C. Does node A become a disk
> node by default when I set up the vhosts/users/permissions?

The disk nodes are the ones explicitly listed in the "rabbitmqctl
cluster" command.

So,
% rabbitmqctl cluster rabbit at A rabbit at B
results in a cluster where A and B are disk nodes.  If that command is
run on either A or B,  the cluster has just the two nodes.
If, on the other hand, that command is run on C, you get a cluster with
A and B disc nodes (same as above) and C as a ram node.

> 2. With the same node arrangement listed above.... I set up A(created vhost,
> users, set permissions etc) and then clustered B against A,B (rabbitmqctl
> cluster nodeA nodeB). I took down A and my messages did not persist even
> though B should be a disk node. Is there something wrong with my steps?

Queues exist physically only on the node on which they were declared.
Clustering just makes them (and exchanges) accesible transparently on
all of the nodes.

Thus, if the queue was declared on A, and A was taken down, the messages
stored on the queue would become inaccesible.

If you want to never lose messages, have a look at our high-availability
clustering guide in the documentation section of the website.

> 3. What is the conventional/non-conventional way to determine whether or not
> individual nodes in a cluster are a disk or ram nodes?

To find out whether nodes are disc or ram, run
% rabbitmqctl status
on any node in the cluster.

Unfortunately, due to a bug, that command will not report the correct
node type, so it's not of much help to you now.  This problem has been
fixed in our default branch and will be in the release.

Cheers,
Alex


From srijanani.s at gmail.com  Thu Aug  5 21:58:46 2010
From: srijanani.s at gmail.com (Srijanani Srinivasan)
Date: Thu, 5 Aug 2010 15:58:46 -0500
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100805164127.GT17061@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
	<20100726151140.GC6839@rabbitmq.com>
	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
	<20100728124626.GH554@rabbitmq.com>
	<AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>
	<20100805164127.GT17061@rabbitmq.com>
Message-ID: <AANLkTin_9ZA-DMacYj26Gn9haob08aXNY1NdAb0QaawJ@mail.gmail.com>

Thanks for your response Matthew. I want to understand a bit more about
how the new persister is going to be different from the current one? Please
correct me if i am wrong, i believe that currently the messages are in the
queue are loaded in the memory, and if they are marked persistent, any
time the consumer stops consuming messages or other scenarios the messages
are written to the disk and retrieved later when needed.

The problem comes up when the message queue grows too large it occupies a
lot of memory and the server is not able to handle it.

You mentioned the Rabbit queue can store more messages than the RAM permits,
can I know how it is being done?

Thanks again!

On Thu, Aug 5, 2010 at 11:41 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Aug 05, 2010 at 10:57:16AM -0500, Srijanani Srinivasan wrote:
> > Can you guys tell me more about the new persister that is going to be
> > released? We are currently using RabbitMQ in our applications and using
> all
> > persistent messages.  But we have noticed that when we have like say
> > millions of messages in the queue, the server goes down which is not
> > desired. Does the new persister target these issues?
>
> In a word: yes.
>
> The new persister is explicitly designed to target these kinds of
> scalability issues: ensuring that Rabbit can easily and happily store
> more messages than RAM permits and in some cases getting very close to
> zero RAM cost per message.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100805/e6078441/attachment.htm>

From alexandru at rabbitmq.com  Thu Aug  5 22:38:00 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Thu, 5 Aug 2010 22:38:00 +0100
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
	<AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
Message-ID: <20100805213800.GB3413@dakota>

On Thu, Aug 05, 2010 at 01:49:51PM -0700, Vince Chang wrote:
> 1. So if I start node A by itself, and then cluster B against A, then A becomes a disk node because I specified A in the rabbitmqctl command? Here are the steps
> 
> Node1: 
> start_app
> add_vhost host1
> add_user user pass
> 
> Node2:
> stop_app
> reset
> cluster node1 <--- (is this the step that makes node A a disk node?)
> start_app
> 
> Node3:
> stop_app
> reset
> cluster node1 
> start_app

I've just tried that on default.

All the nodes start up as disc nodes.  At that point, you turn *Node2*
into a ram node.  In the third group of commands, you also turn *Node3*
into a ram node.

So, the sequence is:
1. Start Node1 as a disc node
2. Cluster Node2 with Node1; Node2 becomes a ram node
3. Cluster Node3 with Node1; Node3 becomes a ram node
At the end, Node1 is disc; Node2 and Node3 are ram

> 2. To be clear, if I send a message that creates the queue Q1 in node A in a cluster with node A, node B, and node C and node A goes down, then I will lose those messages on node A. Node A is down, but B and C should still be alive. If I send the same message to be queued on Q1, will Q1 be created on node B and node C? For me so far, that is not the case. When I send a message to be queued on Q1 (where the messages on Q1 on node A are now lost because node A is down) I do not see the queue getting created on either node B or node C. Is there something wrong with my steps?

I'm not quite sure what you mean by ``message that creates the queue''.

If you declare a queue Q1 on node A with queue.declare, then Q1 will
reside on node A.  If node A goes down, all the messages on its queues
(including Q1) will become inaccessible.  If Q1 was declared as durable,
then the messages published as persistent on it will become available
when node A comes back online.

In a cluster, when a node goes down, its queues become inaccesbile.
They are *not* automatically created on other nodes.

Incidentally, which client are you using?

> 3. I am using RabbitMQ 1.7.2. Just to be clear there is _no way_ on 1.7.2 to determine whether or not a node is a disk node or ram node? 

There's no way to do it with the provided tools.

If you're not squeamish about running a bit of Erlang, you could do
this:

% erl -sname mgmtsh -remsh rabbit at localhost

This gives you a remote Erlang shell named mgmtsh, connected to
rabbit at localhost

Then, running this should give you the disc nodes:
(rabbit at localhost)1> mnesia:table_info(rabbit_durable_exchange, disc_copies).

And running this should give you the ram nodes:
(rabbit at localhost)2> mnesia:table_info(rabbit_durable_exchange, ram_copies).


Cheers,
Alex




From vchang at ign.com  Thu Aug  5 22:56:55 2010
From: vchang at ign.com (Vince Chang)
Date: Thu, 5 Aug 2010 14:56:55 -0700
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <20100805213800.GB3413@dakota>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
	<AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
	<20100805213800.GB3413@dakota>
Message-ID: <AEC6A2084B89EA49B99F71108C2E53EB846A2D@ign-msg-06.hq.ign.com>

Thanks for your answers!

#2. I mean that if I send a message that is meant for Q1, where Q1 was originally on node A but now is down because node A is down, will the queue be created on the other nodes B,C? It looks like your answer is no, just to confirm? I am using the 1.7.2 Java client. Is there a way to set up the cluster such that a queue (like Q1 in our case) will be created(automatically) on other nodes (such as node B and node C) if node A goes down? What happens when I make either (node B or node C) or both (node B and node C) disk nodes? 

#3. Not sure if I should do anything before hand, but I ran the command you provided and got this output:
$ erl -sname mgmtsh -remsh rabbit at localhost
Erlang R13B03 (erts-5.7.4) [source] [smp:4:4] [rq:4] [async-threads:0] [hipe] [kernel-poll:false]

*** ERROR: Shell process terminated! (^G to start new job) ***
{error_logger,{{2010,8,5},{14,52,59}},"~s~n",["Error in process <0.33.0> on node 'mgmtsh at ebony' with exit value: {badarg,[{erlang,list_to_existing_atom,[\"rabbit at ubuntu\"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}\n"]}

=ERROR REPORT==== 5-Aug-2010::14:52:59 ===
Error in process <0.33.0> on node 'mgmtsh at ebony' with exit value: {badarg,[{erlang,list_to_existing_atom,["rabbit at ubuntu"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}

FYI: I'm running Ubuntu and installed rabbitMQ 1.7.2 with sudo apt-get install rabbitmq-server. 

-----Original Message-----
From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru Scvortov
Sent: Thursday, August 05, 2010 2:38 PM
To: Vince Chang
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Disk node vs ram node

On Thu, Aug 05, 2010 at 01:49:51PM -0700, Vince Chang wrote:
> 1. So if I start node A by itself, and then cluster B against A, then A becomes a disk node because I specified A in the rabbitmqctl command? Here are the steps
> 
> Node1: 
> start_app
> add_vhost host1
> add_user user pass
> 
> Node2:
> stop_app
> reset
> cluster node1 <--- (is this the step that makes node A a disk node?)
> start_app
> 
> Node3:
> stop_app
> reset
> cluster node1 
> start_app

I've just tried that on default.

All the nodes start up as disc nodes.  At that point, you turn *Node2*
into a ram node.  In the third group of commands, you also turn *Node3*
into a ram node.

So, the sequence is:
1. Start Node1 as a disc node
2. Cluster Node2 with Node1; Node2 becomes a ram node
3. Cluster Node3 with Node1; Node3 becomes a ram node
At the end, Node1 is disc; Node2 and Node3 are ram

> 2. To be clear, if I send a message that creates the queue Q1 in node A in a cluster with node A, node B, and node C and node A goes down, then I will lose those messages on node A. Node A is down, but B and C should still be alive. If I send the same message to be queued on Q1, will Q1 be created on node B and node C? For me so far, that is not the case. When I send a message to be queued on Q1 (where the messages on Q1 on node A are now lost because node A is down) I do not see the queue getting created on either node B or node C. Is there something wrong with my steps?

I'm not quite sure what you mean by ``message that creates the queue''.

If you declare a queue Q1 on node A with queue.declare, then Q1 will
reside on node A.  If node A goes down, all the messages on its queues
(including Q1) will become inaccessible.  If Q1 was declared as durable,
then the messages published as persistent on it will become available
when node A comes back online.

In a cluster, when a node goes down, its queues become inaccesbile.
They are *not* automatically created on other nodes.

Incidentally, which client are you using?

> 3. I am using RabbitMQ 1.7.2. Just to be clear there is _no way_ on 1.7.2 to determine whether or not a node is a disk node or ram node? 

There's no way to do it with the provided tools.

If you're not squeamish about running a bit of Erlang, you could do
this:

% erl -sname mgmtsh -remsh rabbit at localhost

This gives you a remote Erlang shell named mgmtsh, connected to
rabbit at localhost

Then, running this should give you the disc nodes:
(rabbit at localhost)1> mnesia:table_info(rabbit_durable_exchange, disc_copies).

And running this should give you the ram nodes:
(rabbit at localhost)2> mnesia:table_info(rabbit_durable_exchange, ram_copies).


Cheers,
Alex





From david at rabbitmq.com  Thu Aug  5 22:57:00 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 05 Aug 2010 22:57:00 +0100
Subject: [rabbitmq-discuss] rabbitmqctl not reporting anything
In-Reply-To: <46DF62FA-9B66-4900-8FC3-F9CD6C304358@vmware.com> (Greg
	Turnquist's message of "Tue, 3 Aug 2010 12:29:02 -0700")
References: <B4D0A127-246A-44E1-B3EB-ABFBD722B5CA@vmware.com>
	<4C5714A5.60205@rabbitmq.com>
	<46DF62FA-9B66-4900-8FC3-F9CD6C304358@vmware.com>
Message-ID: <yrv4ck4o4radv.fsf@dwragg.eng.vmware.com>

Hi Greg,

Greg Turnquist <gturnquist at vmware.com> writes:
> rabbitmqctl tries to access the same node name:
>
> gturnquist-mbp:~ gturnquist$ sudo rabbitmqctl list_exchanges
> Listing exchanges ...
> Error: unable to connect to node 'rabbit at gturnquist-mbp': nodedown
> diagnostics:
> - unable to connect to epmd on gturnquist-mbp: address
> - current node: 'rabbitmqctl50582 at gturnquist-mbp'
> - current node home dir: /opt/local/var/lib/rabbitmq
> - current node cookie hash: WsSCWeum/oLXE3iNW2zauw==
>
> I don't know where it decided to call the node
> rabbit at gturnquist-mbp. It is the local hostname, but I usually use
> gturnquist-mbp.local to reference my local LAN IP address. I don't see
> how to override this setting from either the server or the ctl
> script. It seems like an issue, because I thought doing all this on
> the same node would be out-of-the-box functionality.

RabbitMQ requires that the host (or hosts) running rabbitmq-server can
be named by a short hostname (i.e. without any dots).

So when constructing the default value of RABBITMQ_NODENAME, the
rabbitmq scripts will assume that the hostname given by `hostname -s` is
a valid name for the machine.  This is usually a reasonable assumption,
but it sounds like it doesn't apply on your machine.

You can override it by setting RABBITMQ_NODENAME in the environment, as
documented in the rabbitmq-server man page.  This also applies to
rabbitmqctl.  The RABBITMQ_NODENAME value should be of the form
"name at host".  If your machine doesn't have a simple hostname, then you
can simply use "rabbit at localhost", though of course this
constrains you to run rabbitmqctl on the same machine as the server.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From simon at rabbitmq.com  Thu Aug  5 23:35:14 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Aug 2010 23:35:14 +0100
Subject: [rabbitmq-discuss] JSONRPCError - Internal error: badmatch
In-Reply-To: <AANLkTik+dSh0JKZJzWRVSF1e_PzQeXRYB0g+s48Ww=yH@mail.gmail.com>
References: <AANLkTik+dSh0JKZJzWRVSF1e_PzQeXRYB0g+s48Ww=yH@mail.gmail.com>
Message-ID: <4C5B3CA2.3040200@rabbitmq.com>

Hi Cameron.

I think you're trying to use a too-new version of 
rabbitmq-jsonrpc-channel. I haven't tested, but I think revision 
0a920cb5180b is more likely to work with RabbitMQ 1.8.1. Or you could 
build the server from default as well as the plugins.

Cheers, Simon

On 04/08/10 16:06, Cameron Harris wrote:
> Hi all,
>
> I've installed rabbitmq on OS X 10.6 via MacPorts, and built and
> installed the rabbitmq-jsonrpc, rabbitmq-jsonrpc-channel, mochiweb,
> rabbitmq-mochiweb, rfc4627_jsonrpc plugins.
>
> After installing, I went to the example page on localhost:55672, and
> clicked the Simple JSONRPC test. I get the following output:
>
> test_main
> {"installGenericProxy":{"name":"open","idempotent":false,"params":
> [{"name":"username","type":"str"},{"name":"password","type":"str"},
> {"name":"sessionTimeout","type":"num"},
> {"name":"virtualHost","type":"str"}]}}
> open
> JsonRPC error:
> Service: "/rpc/rabbitmq"
> Method: "open"
> Params: ["guest","guest",5,null]
> Response: {"version":"1.1","id":2,"error":
> {"name":"JSONRPCError","code":500,"message":"Internal
> error","error":"{{{badmatch,{error,{{badmatch,<0.13932.0>},
>                     [{rabbit_jsonrpc_channel,init,1},
>                      {gen_server,init_it,6},
>                      {proc_lib,init_p_do_apply,3}]}}},
>   [{rabbit_jsonrpc_channel,open,1},
>    {rabbit_jsonrpc_channel_factory,handle_call,3},
>    {gen_server,handle_msg,5},
>    {proc_lib,init_p_do_apply,3}]},
>   {gen_server,call,
>              [<0.8986.0>,
>               {jsonrpc,<<\"open\">>,
>                        {obj,[{\"http_method\",<<\"POST\">>},
>                              {\"http_query_parameters\",{obj,[]}},
>                              {\"http_headers\",
>                               {obj,[{\"accept\",<<\"*/*\">>},
>
> {\"accept-charset\",<<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
>
> {\"accept-encoding\",<<\"gzip,deflate\">>},
>
> {\"accept-language\",<<\"en-us,en;q=0.5\">>},
>                                     {\"cache-control\",<<\"no-cache\">>},
>                                     {\"connection\",<<\"keep-alive\">>},
>                                     {\"content-length\",<<\"74\">>},
>
> {\"content-type\",<<\"application/json;charset=UTF-8\">>},
>                                     {\"host\",<<\"localhost:55672\">>},
>                                     {\"keep-alive\",<<\"115\">>},
>                                     {\"pragma\",<<\"no-cache\">>},
>
> {\"referer\",<<\"http://localhost:55672/rabbitmq_lib/www-examples/test/index.html\">>},
>                                     {\"user-agent\",<<\"Mozilla/5.0
> (Macintosh; IntelMac OS X 10.6; rv:2.0b3pre) Gecko/20100729
> Minefield/4.0b3pre\">>},
>                                     {\"x-json-rpc-timeout\",<<\"30000\">>},
>
> {\"x-requested-with\",<<\"XMLHttpRequest\">>}]}},
>                              {\"remote_peername\",<<\"127.0.0.1\">>},
>                              {\"scheme\",<<\"http\">>}]},
>                        [<<\"guest\">>,<<\"guest\">>,5,null]},
>               30000]}}"}}
> -------
>
> The broker has started without any errors and appears to be
> functioning, and when I tried the rabbitmq-status plugin, that worked
> fine.
>
> My rabbitmqctl status is:
> Status of node rabbit at Bilbo ...
> [{running_applications,
>      [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
>       {rabbit,"RabbitMQ","1.8.1"},
>       {os_mon,"CPO  CXC 138 46","2.2.5"},
>       {sasl,"SASL  CXC 138 11","2.1.9.2"},
>       {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>       {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>       {mochiweb,"MochiMedia Web Server","1.3"},
>       {crypto,"CRYPTO version 2","2.0"},
>       {inets,"INETS  CXC 138 49","5.4"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.14"},
>       {stdlib,"ERTS  CXC 138 10","1.17"},
>       {kernel,"ERTS  CXC 138 10","2.14"}]},
>   {nodes,[{disc,[rabbit at Bilbo]}]},
>   {running_nodes,[rabbit at Bilbo]}]
> ...done.
>
> Thanks,
> Cameron
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Aug  5 23:39:48 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Aug 2010 23:39:48 +0100
Subject: [rabbitmq-discuss] BQL with 1.8.1
In-Reply-To: <E465122C-2465-4BB9-B615-E8F0AACB6932@npcinternational.com>
References: <E465122C-2465-4BB9-B615-E8F0AACB6932@npcinternational.com>
Message-ID: <4C5B3DB4.5070502@rabbitmq.com>

Hi Jon. I think you have a too-new version of rabbitmq-erlang-client to 
work with rabbitmq-server 1.8.1. I haven't tested, but try revision 
b0425d0ade4d. Or build the server from default too.

(For those playing along at home, yes, I have been posting a few similar 
replies lately. And yes, we're hoping to make using plugins less of an 
ordeal soon.)

Cheers, Simon

On 05/08/10 17:30, Jon Brisbin wrote:
> Trying to follow the directions on installing the BQL plugin into my freshly-updated 1.8.1 broker and I get various errors like the below.
>
> Will this work with 1.8.1?
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
> =INFO REPORT==== 5-Aug-2010::11:25:11 ===
> Limiting to approx 924 file handles
>
> =INFO REPORT==== 5-Aug-2010::11:25:11 ===
> Memory limit set to 25318MB.
>
> =INFO REPORT==== 5-Aug-2010::11:25:11 ===
> Rolling persister log to "/var/lib/rabbitmq/mnesia/rabbit at warehouse1/rabbit_persister.LOG.previous"
>
> =INFO REPORT==== 5-Aug-2010::11:25:11 ===
> started TCP Listener on 0.0.0.0:5672
>
> =ERROR REPORT==== 5-Aug-2010::11:25:11 ===
> ** Generic server<0.218.0>  terminating
> ** Last message in was {command,{open_channel,none}}
> ** When Server state == {dc_state,
>                              {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
>                                  "localhost",5672,0,0,0,none,[]},
>                              false,
>                              [{<<"product">>,longstr,<<"RabbitMQ">>},
>                               {<<"version">>,longstr,<<"1.8.1">>},
>                               {<<"platform">>,longstr,<<"Erlang/OTP">>},
>                               {<<"copyright">>,longstr,
>                                <<"Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.">>},
>                               {<<"information">>,longstr,
>                                <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>}],
>                              {{0,nil},
>                               {dict,0,16,16,8,80,48,
>                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}}},
>                              <0.219.0>}
> ** Reason for termination ==
> ** {{badmatch,{error,{{badmatch,<0.221.0>},
>                        [{amqp_channel_util,start_channel_infrastructure,3},
>                         {amqp_channel,init,1},
>                         {gen_server,init_it,6},
>                         {proc_lib,init_p_do_apply,3}]}}},
>      [{amqp_channel_util,open_channel,5},
>       {amqp_direct_connection,handle_command,3},
>       {gen_server,handle_msg,5},
>       {proc_lib,init_p_do_apply,3}]}
>
> =ERROR REPORT==== 5-Aug-2010::11:25:11 ===
> ** Generic server<0.221.0>  terminating
> ** Last message in was {'EXIT',<0.220.0>,
>                             {{badmatch,<0.221.0>},
>                              [{amqp_channel_util,start_channel_infrastructure,
>                                   3},
>                               {amqp_channel,init,1},
>                               {gen_server,init_it,6},
>                               {proc_lib,init_p_do_apply,3}]}}
> ** When Server state == {ch,starting,1,<0.220.0>,<0.220.0>,undefined,none,
>                              {set,0,16,16,8,80,48,
>                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                              1,
>                              {[],[]},
>                              {[],[]},
>                              <<"guest">>,<<"/">>,<<>>,
>                              {dict,0,16,16,8,80,48,
>                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]},
>                                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]}}},
>                              {dict,0,16,16,8,80,48,
>                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]},
>                                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]}}},
>                              <0.219.0>,
>                              {flow,true,true,none}}
> ** Reason for termination ==
> ** {{badmatch,<0.221.0>},
>      [{amqp_channel_util,start_channel_infrastructure,3},
>       {amqp_channel,init,1},
>       {gen_server,init_it,6},
>       {proc_lib,init_p_do_apply,3}]}
>
> =INFO REPORT==== 5-Aug-2010::11:25:11 ===
>      application: rabbitmq_bql
>      exited: {shutdown,{rabbitmq_bql,start,[normal,[]]}}
>      type: permanent
>
> =INFO REPORT==== 5-Aug-2010::11:25:11 ===
> stopped TCP Listener on 0.0.0.0:5672
>
> =ERROR REPORT==== 5-Aug-2010::11:25:11 ===
> ** gen_event handler rabbit_error_logger crashed.
> ** Was installed in error_logger
> ** Last event was: {error,<0.213.0>,
>                         {<0.221.0>,
>                          "** Generic server ~p terminating \n** Last message in was ~p~n** When Server state == ~p~n** Reason for termination == ~n** ~p~n",
>                          [<0.221.0>,
>                           {'EXIT',<0.220.0>,
>                               {{badmatch,<0.221.0>},
>                                [{amqp_channel_util,
>                                     start_channel_infrastructure,3},
>                                 {amqp_channel,init,1},
>                                 {gen_server,init_it,6},
>                                 {proc_lib,init_p_do_apply,3}]}},
>                           {ch,starting,1,<0.220.0>,<0.220.0>,undefined,none,
>                               {set,0,16,16,8,80,48,
>                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               1,
>                               {[],[]},
>                               {[],[]},
>                               <<"guest">>,<<"/">>,<<>>,
>                               {dict,0,16,16,8,80,48,
>                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {dict,0,16,16,8,80,48,
>                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               <0.219.0>,
>                               {flow,true,true,none}},
>                           {{badmatch,<0.221.0>},
>                            [{amqp_channel_util,start_channel_infrastructure,3},
>                             {amqp_channel,init,1},
>                             {gen_server,init_it,6},
>                             {proc_lib,init_p_do_apply,3}]}]}}
> ** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
> ** Reason == {badarg,[{ets,lookup,[rabbit_exchange_type_registry,topic]},
>                        {rabbit_exchange_type_registry,lookup_module,1},
>                        {rabbit_exchange,type_to_module,1},
>                        {rabbit_exchange,publish,3},
>                        {rabbit_basic,publish,1},
>                        {rabbit_error_logger,publish1,4},
>                        {rabbit_error_logger,handle_event,2},
>                        {gen_event,server_update,4}]}
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Fri Aug  6 00:07:03 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Fri, 6 Aug 2010 00:07:03 +0100
Subject: [rabbitmq-discuss] Disk node vs ram node
Message-ID: <20100805230703.GB31359@dakota>

> #2. I mean that if I send a message that is meant for Q1, where Q1 was originally on node A but now is down because node A is down, will the queue be created on the other nodes B,C? It looks like your answer is no, just to confirm? I am using the 1.7.2 Java client. Is there a way to set up the cluster such that a queue (like Q1 in our case) will be created(automatically) on other nodes (such as node B and node C) if node A goes down? What happens when I make either (node B or node C) or both (node B and node C) disk nodes? 

There's no automatic way to create missing queues inside a cluster in
RabbitMQ, as far as I know.

Whether a node is disc or ram refers to where the broker metadata
(queues, exchanges, bindings) is kept.  Persistent messages are always
stored on disk.  When a ram node goes down, it looses all its metadata.
If it's in a cluster, it will just connect to some other node and
recover the information.  If the entire cluster goes down (say, power
outage), the metadata can only be recovered if at least one node was
disc.  In general, there's not much sense in having a lot of disc nodes.
One or two should be enough.  Ram nodes are faster.

> #3. Not sure if I should do anything before hand, but I ran the command you provided and got this output:
> $ erl -sname mgmtsh -remsh rabbit at localhost
> Erlang R13B03 (erts-5.7.4) [source] [smp:4:4] [rq:4] [async-threads:0] [hipe] [kernel-poll:false]
> 
> *** ERROR: Shell process terminated! (^G to start new job) ***
> {error_logger,{{2010,8,5},{14,52,59}},"~s~n",["Error in process <0.33.0> on node 'mgmtsh at ebony' with exit value: {badarg,[{erlang,list_to_existing_atom,[\"rabbit at ubuntu\"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}\n"]}
> 
> =ERROR REPORT==== 5-Aug-2010::14:52:59 ===
> Error in process <0.33.0> on node 'mgmtsh at ebony' with exit value: {badarg,[{erlang,list_to_existing_atom,["rabbit at ubuntu"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}
> 
> FYI: I'm running Ubuntu and installed rabbitMQ 1.7.2 with sudo apt-get install rabbitmq-server. 

I assumed the rabbit at localhost was your node.  Try rabbit at ebony. 
 

From vchang at ign.com  Fri Aug  6 00:42:04 2010
From: vchang at ign.com (Vince Chang)
Date: Thu, 5 Aug 2010 16:42:04 -0700
Subject: [rabbitmq-discuss] Single point of failure in a clustered
	environment with a durable exchange and durable queues
Message-ID: <AEC6A2084B89EA49B99F71108C2E53EB846A47@ign-msg-06.hq.ign.com>

Hello,

 

I have an clustered environment with 3 nodes having the following set
up:

 

Exchange name:  TestExchange (1 durable exchange)

Queues: Q1, Q2, Q3 (3 durable queues)

Nodes: N1, N2, N3

Cluster: N2 and N3 are clustered against N1.   

Message delivery mode: 2.  

 

The problem that I have is that N1 is a single point of failure.  When I
stop RabbitMQ service on N1, all the queues stop working.  Publishers
can no longer connect to any queues and messages cannot be enqueued.  

 

Can anyone tell me what I'm doing wrong?  Is it because I have a single
exchange?

 

Thanks!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100805/12e6603e/attachment.htm>

From mike.petrusis at ericsson.com  Fri Aug  6 03:28:17 2010
From: mike.petrusis at ericsson.com (Mike Petrusis)
Date: Thu, 5 Aug 2010 22:28:17 -0400
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <20100805162535.GS17061@rabbitmq.com>
References: <20100805142518.GN17061@rabbitmq.com>
	<C88031DE.809B%amenges@vmware.com>
	<20100805162535.GS17061@rabbitmq.com>
Message-ID: <B268CF12349471459840DDE70D308B9DB0E9ED6764@EUSAACMS0702.eamcs.ericsson.se>

Thanks all for the input. I've got a better understanding of the issues now and it sounds like the issue is the same regardless of the use of transactions.  

Matthew's idea of having producers add a "republish count" to the messages is good suggestion to optimize the de-duplication of messages, but this only helps for messages resent by a producer. 

Can messages get duplicated while they are propagating in the broker?  If duplicates are produced in the broker they will have the same "republish count" and this method won't work.  


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: Thursday, August 05, 2010 9:26 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Exactly Once Delivery

On Thu, Aug 05, 2010 at 09:16:14AM -0700, Tony Menges wrote:
> The JMS provider sets the message id. It is supposed to be unique enough to be used for a "historical repository" but the scope of uniqueness is left to the provider. It is recommended that it should be at least unique for a given "installation". I don't think this helps on the publisher side since as you pointed out the notification of the completion of the publish might not make it back to the producer.
> 
> JMS requires the provider to set the redelivered flag (and optionally the delivery count) field if it thinks the message has been given to the application before. The application may or may not have seen it but this flag can be used to trigger the check for a duplicate by the application. The use of unique message ids helps on this end.

Ahh interesting. It would thus seem that JMS requires slightly more of
the producer when publishing messages (more logic is required in the
client library there) and AMQP possibly requires more at the consumer
side.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Fri Aug  6 10:40:11 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 6 Aug 2010 10:40:11 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <B268CF12349471459840DDE70D308B9DB0E9ED6764@EUSAACMS0702.eamcs.ericsson.se>
References: <20100805142518.GN17061@rabbitmq.com>
	<C88031DE.809B%amenges@vmware.com>
	<20100805162535.GS17061@rabbitmq.com>
	<B268CF12349471459840DDE70D308B9DB0E9ED6764@EUSAACMS0702.eamcs.ericsson.se>
Message-ID: <20100806094011.GB16235@rabbitmq.com>

On Thu, Aug 05, 2010 at 10:28:17PM -0400, Mike Petrusis wrote:
> Can messages get duplicated while they are propagating in the broker?  If duplicates are produced in the broker they will have the same "republish count" and this method won't work.  

Well, a message that is sent to an exchange which then results in the
message going to several queues will obviously be duplicated. But
presumably in that case, your consumers consuming from the different
queues would be doing different tasks with the messages, hence the need
for the different queues in the first place.

That aside, no, within a queue, Rabbit does not arbitrarily duplicate
messages.

Matthew

From cameron at cameronharris.org  Fri Aug  6 17:05:19 2010
From: cameron at cameronharris.org (Cameron Harris)
Date: Fri, 6 Aug 2010 09:05:19 -0700 (PDT)
Subject: [rabbitmq-discuss] JSONRPCError - Internal error: badmatch
In-Reply-To: <4C5B3CA2.3040200@rabbitmq.com>
References: <AANLkTik+dSh0JKZJzWRVSF1e_PzQeXRYB0g+s48Ww=yH@mail.gmail.com> 
	<4C5B3CA2.3040200@rabbitmq.com>
Message-ID: <ae4193ec-03e9-483e-bc9b-11a972308313@v15g2000yqe.googlegroups.com>

I was running 1.8.1...

Anyway, I've reinstalled now, on Ubuntu Linux 10.04 this time. I built
everything from the umbrella.

Now I'm getting a different problem on the examples:

test_main
{"installGenericProxy":{"name":"open","idempotent":false,"params":
[{"name":"username","type":"str"},{"name":"password","type":"str"},
{"name":"sessionTimeout","type":"num"},
{"name":"virtualHost","type":"str"}]}}
open
{"installGenericProxy":{"name":"poll","idempotent":false,"params":[]}}
{"installGenericProxy":{"name":"close","idempotent":false,"params":
[]}}
{"installGenericProxy":{"name":"call","idempotent":false,"params":
[{"name":"method","type":"str"},{"name":"args","type":"arr"}]}}
{"installGenericProxy":{"name":"cast","idempotent":false,"params":
[{"name":"method","type":"str"},{"name":"args","type":"arr"},
{"name":"content","type":"str"},{"name":"props","type":"arr"}]}}
handle_channel_ready
{"q2":"test-queue-1b"}
{"q1":"test-queue-1a"}
JsonRPC error:
Service: "/rpc/8DCB5AAAE542E25A84F64EE11A1398E1"
Method: "call"
Params: ["basic.consume",[0,"test-queue-1a","aa-cons-
tag1",false,false,false,false]]
Response: {"version":"1.1","id":8,"error":
{"name":"JSONRPCError","code":500,"message":"Internal
error","error":"{noproc,
    {gen_server,call,
        [<0.875.0>,
         {jsonrpc,<<\"call\">>,
             {obj,
                 [{\"http_method\",<<\"POST\">>},
                  {\"http_query_parameters\",{obj,[]}},
                  {\"http_headers\",
                   {obj,
                       [{\"accept\",<<\"*/*\">>},
                        {\"accept-charset\",
                         <<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
                        {\"accept-encoding\",<<\"gzip, deflate\">>},
                        {\"accept-language\",<<\"en-us,en;q=0.5\">>},
                        {\"cache-control\",<<\"no-cache\">>},
                        {\"connection\",<<\"keep-alive\">>},
                        {\"content-length\",<<\"126\">>},
                        {\"content-type\",<<\"application/json;
charset=UTF-8\">>},
                        {\"host\",<<\"vmrab1:55672\">>},
                        {\"keep-alive\",<<\"115\">>},
                        {\"pragma\",<<\"no-cache\">>},
                        {\"referer\",
                         <<\"http://vmrab1:55672/rabbitmq_lib/www-
examples/test/index.html\">>},
                        {\"user-agent\",
                         <<\"Mozilla/5.0 (Windows; Windows NT 6.1;
WOW64; rv:2.0b3pre) Gecko/20100801 Minefield/4.0b3pre ( .NET CLR
3.5.30729; .NET4.0E)\">>},
                        {\"x-json-rpc-timeout\",<<\"5000\">>},
                        {\"x-requested-with\",<<\"XMLHttpRequest
\">>}]}},
                  {\"remote_peername\",<<\"172.20.5.26\">>},
                  {\"scheme\",<<\"http\">>}]},
             [<<\"basic.consume\">>,
              [0,<<\"test-queue-1a\">>,<<\"aa-cons-
tag1\">>,false,false,false,
               false]]},
         5000]}}"}}
JsonRPC error:
Service: "/rpc/8DCB5AAAE542E25A84F64EE11A1398E1"
Method: "call"
Params: ["basic.consume",[0,"test-
queue-1b","",false,false,false,false]]
Response: {"version":"1.1","id":7,"error":
{"name":"JSONRPCError","code":500,"message":"AMQP error","error":
{"code":"command_invalid","text":"unimplemented
method","method":"basic.consume"}}}



"unimplemented method"?
My rabbitmqctl status is:
Status of node rabbit at vmrab1 ...
[{running_applications,
     [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
      {rabbit,"RabbitMQ","%%VSN%%"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {crypto,"CRYPTO version 1","1.6.3"},
      {inets,"INETS  CXC 138 49","5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,[{disc,[rabbit at vmrab1]}]},
 {running_nodes,[rabbit at vmrab1]}]
...done.


The queues are being created, however:

$ scripts/rabbitmqctl list_queues
Listing queues ...
test-queue-1b   0
amq.gen-CDzvGz+lPWtoz5uOQz1wMA==        0
test-queue-1a   0
amq.gen-VKcoc8C1V6yxQ2f2Nj/sEg==        0
...done.


Also, not sure if I'm doing something wrong, but to get to the example
pages, I have to copy them from priv/www-examples to priv/www then
access them using the URL /rabbitmq_lib/www-examples. This happened on
both Ubuntu and OS X. The paths in the README just return 404 Not
Found.

Thanks,
Cameron

On Aug 5, 11:35?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> Hi Cameron.
>
> I think you're trying to use a too-new version of
> rabbitmq-jsonrpc-channel. I haven't tested, but I think revision
> 0a920cb5180b is more likely to work with RabbitMQ 1.8.1. Or you could
> build the server from default as well as the plugins.
>
> Cheers, Simon
>
> On 04/08/10 16:06, Cameron Harris wrote:
>
>
>
>
>
> > Hi all,
>
> > I've installed rabbitmq on OS X 10.6 via MacPorts, and built and
> > installed the rabbitmq-jsonrpc, rabbitmq-jsonrpc-channel, mochiweb,
> > rabbitmq-mochiweb, rfc4627_jsonrpc plugins.
>
> > After installing, I went to the example page on localhost:55672, and
> > clicked the Simple JSONRPC test. I get the following output:
>
> > test_main
> > {"installGenericProxy":{"name":"open","idempotent":false,"params":
> > [{"name":"username","type":"str"},{"name":"password","type":"str"},
> > {"name":"sessionTimeout","type":"num"},
> > {"name":"virtualHost","type":"str"}]}}
> > open
> > JsonRPC error:
> > Service: "/rpc/rabbitmq"
> > Method: "open"
> > Params: ["guest","guest",5,null]
> > Response: {"version":"1.1","id":2,"error":
> > {"name":"JSONRPCError","code":500,"message":"Internal
> > error","error":"{{{badmatch,{error,{{badmatch,<0.13932.0>},
> > ? ? ? ? ? ? ? ? ? ? [{rabbit_jsonrpc_channel,init,1},
> > ? ? ? ? ? ? ? ? ? ? ?{gen_server,init_it,6},
> > ? ? ? ? ? ? ? ? ? ? ?{proc_lib,init_p_do_apply,3}]}}},
> > ? [{rabbit_jsonrpc_channel,open,1},
> > ? ?{rabbit_jsonrpc_channel_factory,handle_call,3},
> > ? ?{gen_server,handle_msg,5},
> > ? ?{proc_lib,init_p_do_apply,3}]},
> > ? {gen_server,call,
> > ? ? ? ? ? ? ?[<0.8986.0>,
> > ? ? ? ? ? ? ? {jsonrpc,<<\"open\">>,
> > ? ? ? ? ? ? ? ? ? ? ? ?{obj,[{\"http_method\",<<\"POST\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{\"http_query_parameters\",{obj,[]}},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{\"http_headers\",
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {obj,[{\"accept\",<<\"*/*\">>},
>
> > {\"accept-charset\",<<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
>
> > {\"accept-encoding\",<<\"gzip,deflate\">>},
>
> > {\"accept-language\",<<\"en-us,en;q=0.5\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"cache-control\",<<\"no-cache\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"connection\",<<\"keep-alive\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"content-length\",<<\"74\">>},
>
> > {\"content-type\",<<\"application/json;charset=UTF-8\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"host\",<<\"localhost:55672\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"keep-alive\",<<\"115\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"pragma\",<<\"no-cache\">>},
>
> > {\"referer\",<<\"http://localhost:55672/rabbitmq_lib/www-examples/test/index.html\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"user-agent\",<<\"Mozilla/5.0
> > (Macintosh; IntelMac OS X 10.6; rv:2.0b3pre) Gecko/20100729
> > Minefield/4.0b3pre\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"x-json-rpc-timeout\",<<\"30000\">>},
>
> > {\"x-requested-with\",<<\"XMLHttpRequest\">>}]}},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{\"remote_peername\",<<\"127.0.0.1\">>},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{\"scheme\",<<\"http\">>}]},
> > ? ? ? ? ? ? ? ? ? ? ? ?[<<\"guest\">>,<<\"guest\">>,5,null]},
> > ? ? ? ? ? ? ? 30000]}}"}}
> > -------
>
> > The broker has started without any errors and appears to be
> > functioning, and when I tried the rabbitmq-status plugin, that worked
> > fine.
>
> > My rabbitmqctl status is:
> > Status of node rabbit at Bilbo ...
> > [{running_applications,
> > ? ? ?[{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
> > ? ? ? {rabbit,"RabbitMQ","1.8.1"},
> > ? ? ? {os_mon,"CPO ?CXC 138 46","2.2.5"},
> > ? ? ? {sasl,"SASL ?CXC 138 11","2.1.9.2"},
> > ? ? ? {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
> > ? ? ? {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
> > ? ? ? {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
> > ? ? ? {mochiweb,"MochiMedia Web Server","1.3"},
> > ? ? ? {crypto,"CRYPTO version 2","2.0"},
> > ? ? ? {inets,"INETS ?CXC 138 49","5.4"},
> > ? ? ? {mnesia,"MNESIA ?CXC 138 12","4.4.14"},
> > ? ? ? {stdlib,"ERTS ?CXC 138 10","1.17"},
> > ? ? ? {kernel,"ERTS ?CXC 138 10","2.14"}]},
> > ? {nodes,[{disc,[rabbit at Bilbo]}]},
> > ? {running_nodes,[rabbit at Bilbo]}]
> > ...done.
>
> > Thanks,
> > Cameron
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From floydophone at gmail.com  Fri Aug  6 18:50:19 2010
From: floydophone at gmail.com (Pete Hunt)
Date: Fri, 6 Aug 2010 13:50:19 -0400
Subject: [rabbitmq-discuss] Node scheduling with RabbitMQ
Message-ID: <AANLkTimtWEm0oN=iqyK23KQ2jFWredu22TtrEdk6iU3_@mail.gmail.com>

Hi -

I am currently evaluating RabbitMQ for a master/worker work queue
environment (like a lot of people do!).

The first catch with our system is that nodes may fail at any time;
pretty standard.
The second catch with our system is that we want the scheduler to be
cache-aware, that is, since we know what data the task will use ahead
of time, schedule the task on a node which will result in the least
cache misses. We already have a system and algorithms in place to
determine this, however, they need to be integrated with RabbitMQ.
Would the proper course of action be implementing a custom exchange?
Or is this outside the scope of RabbitMQ? Please advise; thanks!

Pete

From tim.fox at jboss.com  Fri Aug  6 22:43:56 2010
From: tim.fox at jboss.com (Tim Fox)
Date: Fri, 06 Aug 2010 22:43:56 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>
	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
Message-ID: <4C5C821C.6010308@jboss.com>

On 05/08/10 15:16, David Wragg wrote:
> Tony Garnock-Jones<tonyg at rabbitmq.com>  writes:
>    
>> John Apps wrote:
>>      
>>> The JMS standard offers guaranteed once
>>>        
>> What exactly do they mean by that? In particular, how do they deal
>> with duplicates? Do they report failure, or silently let a dup through
>> in certain situations? If you could point me to the part of the spec
>> that sets out the JMS resolution of these issues, that's be really
>> useful.
>>      
> As an API spec, it's quite easy for JMS to mandate something apparently
> impossible, without hinting at how it might actually be implemented.
>
> Most of the spec says that the PERSISTENT delivery mode gives
> "once-and-only-once" delivery.  But section 4.4.13 (of JMS 1.1) admits
> that there are a number of caveats to this.  So it's really
> "once-and-only-once-except-in-some-corner-cases".
>
> I think the wrinkle that might prevent us saying that RabbitMQ gives the
> same guarantees is on the publishing side.  The caveats in JMS all seems
> to apply only to the consuming side.  But what happens with an AMQP
> producer if the connection gets dropped before a tx.commit-ok gets back
> to the client?  In that case the client has to re-publish, leading to a
> potential dup.  This can be avoided by a de-dup filter on published
> messages in the broker.  I don't know if JMS brokers really go to such
> lengths.
>    
Some do. It's fairly common for JMS brokers to implement duplicate 
detection on the server side, to get around the "lost commit-ok problem" 
and give us near as possible once and only once, from the publisher to 
the server at least.

The way we do it in HornetQ is we have a well defined header key 
"_HQ_DUP_ID". The client can set this with some unique value of it's 
choice before sending (e.g. a GUID). When the server receives the 
message if the _HQ_DUP_ID header is set, it looks up the value in it's 
cache, and if it's seen it before it ignores it. The cache can 
optionally be persisted.

On the client side, the producer can resend the message/transaction if 
it does not receive a confirmation-ok, so it effectively makes 
sends/commits idempotent.
David
>    


-- 
Sent from my BBC Micro Model B

Tim Fox
JBoss

HornetQ - putting the buzz in messaging http://hornetq.org
http://hornetq.blogspot.com/
http://twitter.com/hornetq
irc://irc.freenode.net:6667#hornetq	
fox at redhat.com


From askh at opera.com  Sat Aug  7 09:43:56 2010
From: askh at opera.com (Ask Solem)
Date: Sat, 7 Aug 2010 10:43:56 +0200
Subject: [rabbitmq-discuss] Node scheduling with RabbitMQ
In-Reply-To: <AANLkTimtWEm0oN=iqyK23KQ2jFWredu22TtrEdk6iU3_@mail.gmail.com>
References: <AANLkTimtWEm0oN=iqyK23KQ2jFWredu22TtrEdk6iU3_@mail.gmail.com>
Message-ID: <9BC6CEAE-37E5-4BE1-A20B-9136A10539BE@opera.com>


On Aug 6, 2010, at 7:50 PM, Pete Hunt wrote:

> Hi -
> 
> I am currently evaluating RabbitMQ for a master/worker work queue
> environment (like a lot of people do!).
> 
> The first catch with our system is that nodes may fail at any time;
> pretty standard.
> The second catch with our system is that we want the scheduler to be
> cache-aware, that is, since we know what data the task will use ahead
> of time, schedule the task on a node which will result in the least
> cache misses. We already have a system and algorithms in place to
> determine this, however, they need to be integrated with RabbitMQ.
> Would the proper course of action be implementing a custom exchange?
> Or is this outside the scope of RabbitMQ? Please advise; thanks!

cache-aware? You mean data locality?

I've been contemplating this as well.
I think this could be solved by having a proxy in front of RabbitMQ, that routes
the messages to the correct hosts (using routing keys).

E.g. if each worker is also consuming from a private queue, this proxy could
just reroute the message so the task is received by a single worker.

-- 
{Ask Solem,
 Developer ~ Webteam,
 Opera Software,
 +47 98435213 | twitter.com/asksol }.


From askh at opera.com  Sat Aug  7 10:04:35 2010
From: askh at opera.com (Ask Solem)
Date: Sat, 7 Aug 2010 11:04:35 +0200
Subject: [rabbitmq-discuss] Node scheduling with RabbitMQ
In-Reply-To: <9BC6CEAE-37E5-4BE1-A20B-9136A10539BE@opera.com>
References: <AANLkTimtWEm0oN=iqyK23KQ2jFWredu22TtrEdk6iU3_@mail.gmail.com>
	<9BC6CEAE-37E5-4BE1-A20B-9136A10539BE@opera.com>
Message-ID: <3A98A0E9-B7FD-434A-BC06-8BDC0E37A9AE@opera.com>


On Aug 7, 2010, at 10:43 AM, Ask Solem wrote:
>> 
> 
> cache-aware? You mean data locality?
> 
> I've been contemplating this as well.
> I think this could be solved by having a proxy in front of RabbitMQ, that routes
> the messages to the correct hosts (using routing keys).
> 
> E.g. if each worker is also consuming from a private queue, this proxy could
> just reroute the message so the task is received by a single worker.


On second thought it doesn't need to be a proxy at all,
just some service knowing what worker(s) is near the data.

node1.example.com consumes from
    queue: tasks exchange: tasks type: direct
    queue: node1.example.com exchange: directly_to type: direct

node2.example.com consumes from
    queue: tasks exchange: tasks rkey=tasks
    queue: node2.example.com exchange: directly_to rkey=node2.example.com

Then these workers will receive tasks from the "tasks" queue in round robin style,
and it's also possible to send tasks directly to one or more workers. 

When you publish a task that could benefit from optimal data locality, you consult
the central authority to know what nodes is closest to the file(s):

routing_key = node_close_to(file)
basic_publish(message, exchange="directly_to", routing_key=routing_key) 

This doesn't take into account failing nodes, but maybe you could use
the immediate flag for this.

As the maintainer of Celery (http://celeryproject.org), I'm very interested
in what you end up with here.



-- 
{Ask Solem,
 +47 98435213 | twitter.com/asksol }.


From matthew at rabbitmq.com  Sat Aug  7 12:50:17 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 7 Aug 2010 12:50:17 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5C821C.6010308@jboss.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
	<4C5C821C.6010308@jboss.com>
Message-ID: <20100807115017.GA1469@wellquite.org>

On Fri, Aug 06, 2010 at 10:43:56PM +0100, Tim Fox wrote:
> The way we do it in HornetQ is we have a well defined header key
> "_HQ_DUP_ID". The client can set this with some unique value of it's
> choice before sending (e.g. a GUID). When the server receives the
> message if the _HQ_DUP_ID header is set, it looks up the value in
> it's cache, and if it's seen it before it ignores it. The cache can
> optionally be persisted.

How do you prevent the cache from growing without bound?

Matthew

From tonyg at rabbitmq.com  Sat Aug  7 14:52:57 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sat, 07 Aug 2010 09:52:57 -0400
Subject: [rabbitmq-discuss] rabbit_binary_parser:ensure_content_decoded/2 -
 why /2 rather than /1?
Message-ID: <4C5D6539.8050202@rabbitmq.com>

In rabbit_binary_parser.erl, what used to be ensure_content_decoded/1 is now
endure_content_decoded/2, presumably for multi-protocol support. However, it is
always called with a hard-coded protocol parameter of rabbit_framing_amqp_0_9_1.

Shouldn't it be /1 as before, and decide which protocol to use based on
Content#content.protocol?

Tony

From johndapps at gmail.com  Sat Aug  7 16:09:45 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 7 Aug 2010 17:09:45 +0200
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <20100807115017.GA1469@wellquite.org>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
	<4C5C821C.6010308@jboss.com> <20100807115017.GA1469@wellquite.org>
Message-ID: <AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>

On Sat, Aug 7, 2010 at 13:50, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Fri, Aug 06, 2010 at 10:43:56PM +0100, Tim Fox wrote:
> > The way we do it in HornetQ is we have a well defined header key
> > "_HQ_DUP_ID". The client can set this with some unique value of it's
> > choice before sending (e.g. a GUID). When the server receives the
> > message if the _HQ_DUP_ID header is set, it looks up the value in
> > it's cache, and if it's seen it before it ignores it. The cache can
> > optionally be persisted.
>
> How do you prevent the cache from growing without bound?
>
> Matthew
>
> That's really like the piece of string question, no? Of course it can fill
up, as can the DB where things are persisted for those cases where messages
cannot be delivered.
Having an unique ID in every message is not something new and not restricted
to messaging, of course. It is simply a very good idea!
TCP/IP claims to be a 'reliable' transport...The problem with that is that
packets get 'lost' or 'dropped' or simply die of 'old age'. Similar, but
more complex, problems exist with queuing.
What has not been touched on in this little discussion so far is the
question of transactions, and I do not mean those in the 0.9.1 spec, but
those described in the 1.0 spec. Here again, JMS is leading the way with
something which in my mind is as necessary as guaranteed once (or at least
once). Updating DBs from queues and posting the results of those updates to
queues should be atomic; and if I want my debit/credit to happen once rather
than many times or not at all, then a combination of transactions and
guaranteed delivery becomes very attractive both to the designer and the
developers. Yes, ACID comes to mind here...and it is indeed what I am
referring to.

It is great to participate in conversations of this nature - thank you for
putting up with my sometimes oblique ramblings:-)

---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100807/82c2cefc/attachment.htm>

From matthias at rabbitmq.com  Sat Aug  7 20:01:38 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 07 Aug 2010 20:01:38 +0100
Subject: [rabbitmq-discuss]
 rabbit_binary_parser:ensure_content_decoded/2 - why /2 rather than /1?
In-Reply-To: <4C5D6539.8050202@rabbitmq.com>
References: <4C5D6539.8050202@rabbitmq.com>
Message-ID: <4C5DAD92.2050104@rabbitmq.com>

Tony,

Tony Garnock-Jones wrote:
> In rabbit_binary_parser.erl, what used to be ensure_content_decoded/1 is now
> endure_content_decoded/2 [...]
> 
> Shouldn't it be /1 as before, and decide which protocol to use based on
> Content#content.protocol?

Probably. The /2 was introduced before #content.protocol existed and 
iirc we kept it for symmetry w ensure_content_encoded/2. I have filed a 
bug to look into this.


Regards,

Matthias.

From matthias at rabbitmq.com  Sat Aug  7 20:46:50 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 07 Aug 2010 20:46:50 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>
	<20100807115017.GA1469@wellquite.org>
	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
Message-ID: <4C5DB82A.5080006@rabbitmq.com>

John,

John Apps wrote:
> That's really like the piece of string question, no? Of course it can 
> fill up, as can the DB where things are persisted for those cases where 
> messages cannot be delivered.
> Having an unique ID in every message is not something new and not 
> restricted to messaging, of course. It is simply a very good idea!

I believe Matthew was simply trying to point out that many of the 
supposed guarantees of messaging systems are a lot softer than most 
people think. In reality a "guarantee" is little more than an increase 
in the probability that the right thing will happen. Coming clean about 
that is going to be important for cloud computing to succeed - improving 
the probabilities does come at a price, and for systems at massive 
scales the cost/benefit calculations look quite different.

So, for example, using publisher-supplied message ids for de-duping 
simply does not scale. Think what a genuine cloud messaging system would 
have to do to handle the case where a producer injects the same message 
first in a node in Australia and then in New York.

> What has not been touched on in this little discussion so far is the 
> question of transactions

Similar considerations apply here. XA in the cloud? Hmmm.


Regards,

Matthias.

From tonyg at rabbitmq.com  Sat Aug  7 21:13:07 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sat, 07 Aug 2010 16:13:07 -0400
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5DB82A.5080006@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>	<20100807115017.GA1469@wellquite.org>	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com>
Message-ID: <4C5DBE53.7020107@rabbitmq.com>

Matthias Radestock wrote:
> So, for example, using publisher-supplied message ids for de-duping
> simply does not scale. Think what a genuine cloud messaging system would
> have to do to handle the case where a producer injects the same message
> first in a node in Australia and then in New York.

What is the problem you're thinking of? Would a setup like the following cope?

 - publishers choose a message ID
 - publishers choose a TTL
 - receivers dedup based on message ID
 - receiver's dedup buffer is expired by (some factor of) TTL
 - each delivery contains an address to which the ACK should be routed

Tony


From matthias at rabbitmq.com  Sat Aug  7 21:17:51 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 07 Aug 2010 21:17:51 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5DBE53.7020107@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>	<20100807115017.GA1469@wellquite.org>	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com> <4C5DBE53.7020107@rabbitmq.com>
Message-ID: <4C5DBF6F.3000500@rabbitmq.com>

Tony,

Tony Garnock-Jones wrote:
> Would a setup like the following cope?
> 
>  - publishers choose a message ID
>  - publishers choose a TTL
>  - receivers dedup based on message ID
>  - receiver's dedup buffer is expired by (some factor of) TTL
>  - each delivery contains an address to which the ACK should be routed

That's end-to-end dedup you are thinking of. Nothing wrong with that, 
and it doesn't require the broker to do/know anything. The context of 
the discussion here was a "broker dedups publishes" feature.

Matthias.

From tonyg at rabbitmq.com  Sat Aug  7 21:19:19 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sat, 07 Aug 2010 16:19:19 -0400
Subject: [rabbitmq-discuss]
 rabbit_binary_parser:ensure_content_decoded/2 - why /2 rather than /1?
In-Reply-To: <4C5DAD92.2050104@rabbitmq.com>
References: <4C5D6539.8050202@rabbitmq.com> <4C5DAD92.2050104@rabbitmq.com>
Message-ID: <4C5DBFC7.7040103@rabbitmq.com>

Matthias Radestock wrote:
> Probably. The /2 was introduced before #content.protocol existed and
> iirc we kept it for symmetry w ensure_content_encoded/2. I have filed a
> bug to look into this.

Hmm. Looks like ensure_content_encoded could also be /1 along similar lines.
Also it doesn't seem to be called anywhere! (And also it's a bit weird. The
pattern-matching in the heads doesn't look exhaustive.)

Tony

From alexis at rabbitmq.com  Sat Aug  7 21:22:04 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 7 Aug 2010 21:22:04 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <20100807115017.GA1469@wellquite.org>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
	<4C5C821C.6010308@jboss.com> <20100807115017.GA1469@wellquite.org>
Message-ID: <AANLkTi=3y0kmkrSKPNJ_ws8BRS6B_b_4Ai_Wdz9XnXZr@mail.gmail.com>

On Sat, Aug 7, 2010 at 12:50 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Fri, Aug 06, 2010 at 10:43:56PM +0100, Tim Fox wrote:
>> The way we do it in HornetQ is we have a well defined header key
>> "_HQ_DUP_ID". The client can set this with some unique value of it's
>> choice before sending (e.g. a GUID). When the server receives the
>> message if the _HQ_DUP_ID header is set, it looks up the value in
>> it's cache, and if it's seen it before it ignores it. The cache can
>> optionally be persisted.
>
> How do you prevent the cache from growing without bound?

AFAIK the normal approach with this system is to bound it arbitrarily.



> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From tonyg at rabbitmq.com  Sat Aug  7 21:26:11 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sat, 07 Aug 2010 16:26:11 -0400
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5DBF6F.3000500@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>	<20100807115017.GA1469@wellquite.org>	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com> <4C5DBE53.7020107@rabbitmq.com>
	<4C5DBF6F.3000500@rabbitmq.com>
Message-ID: <4C5DC163.80801@rabbitmq.com>

Matthias Radestock wrote:
> That's end-to-end dedup you are thinking of. Nothing wrong with that,
> and it doesn't require the broker to do/know anything. The context of
> the discussion here was a "broker dedups publishes" feature.

Well couldn't the broker take responsibility for the delivery itself by acking?
And use the same protocol (including perhaps a fresh message ID) to relay a
message out to a receiver on the outbound leg?

Perhaps it's a distraction: I guess I was really wondering what the New York vs
Australia part had to do with it.

Tony

From matthias at rabbitmq.com  Sat Aug  7 21:26:28 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 07 Aug 2010 21:26:28 +0100
Subject: [rabbitmq-discuss]
 rabbit_binary_parser:ensure_content_decoded/2 - why /2 rather than /1?
In-Reply-To: <4C5DBFC7.7040103@rabbitmq.com>
References: <4C5D6539.8050202@rabbitmq.com> <4C5DAD92.2050104@rabbitmq.com>
	<4C5DBFC7.7040103@rabbitmq.com>
Message-ID: <4C5DC174.2010303@rabbitmq.com>

Tony,

Tony Garnock-Jones wrote:
> Looks like ensure_content_encoded could also be /1

No! That would prevent any transcoding between different protocol 
versions. While the higher-level APIs currently do not support that 
(since it is not needed), the lower ones certainly do.

> Also it doesn't seem to be called anywhere!

It is there for symmetry.

> (And also it's a bit weird. The pattern-matching in the heads doesn't
> look exhaustive.)

It *is* exhaustive.


Matthias.

From tonyg at rabbitmq.com  Sat Aug  7 21:29:13 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sat, 07 Aug 2010 16:29:13 -0400
Subject: [rabbitmq-discuss]
 rabbit_binary_parser:ensure_content_decoded/2 - why /2 rather than /1?
In-Reply-To: <4C5DC174.2010303@rabbitmq.com>
References: <4C5D6539.8050202@rabbitmq.com> <4C5DAD92.2050104@rabbitmq.com>
	<4C5DBFC7.7040103@rabbitmq.com> <4C5DC174.2010303@rabbitmq.com>
Message-ID: <4C5DC219.8050906@rabbitmq.com>

Matthias Radestock wrote:
> No! That would prevent any transcoding between different protocol
> versions. While the higher-level APIs currently do not support that
> (since it is not needed), the lower ones certainly do.

Fair enough.

> It *is* exhaustive.

It looks like it doesn't handle the case where you have only a binary encoded
form of the headers (properties = none), in a protocol different from the one
you want.

Tony


From matthias at rabbitmq.com  Sat Aug  7 21:33:06 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 07 Aug 2010 21:33:06 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5DC163.80801@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>	<20100807115017.GA1469@wellquite.org>	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com> <4C5DBE53.7020107@rabbitmq.com>
	<4C5DBF6F.3000500@rabbitmq.com> <4C5DC163.80801@rabbitmq.com>
Message-ID: <4C5DC302.9070506@rabbitmq.com>

Tony,

Tony Garnock-Jones wrote:
> Matthias Radestock wrote:
>> That's end-to-end dedup you are thinking of. Nothing wrong with that,
>> and it doesn't require the broker to do/know anything. The context of
>> the discussion here was a "broker dedups publishes" feature.
> 
> Well couldn't the broker take responsibility for the delivery itself by acking?
> And use the same protocol (including perhaps a fresh message ID) to relay a
> message out to a receiver on the outbound leg?
> 
> Perhaps it's a distraction: I guess I was really wondering what the New York vs
> Australia part had to do with it.

1) publisher connects to cloud; ends up connecting to Australia node
2) publisher sends message
3) connection drops, publisher didn't get ack so must resend ...
4) publisher connects to cloud; ends up connecting to NY node
5) publisher re-sends message

At that point the cloud messaging service has two copies of the same 
message in different locations. For the duplication to be detected, some 
information needs to flow between the two locations. Which is expensive.


Regards,

Matthias.

From matthias at rabbitmq.com  Sat Aug  7 21:36:17 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 07 Aug 2010 21:36:17 +0100
Subject: [rabbitmq-discuss]
 rabbit_binary_parser:ensure_content_decoded/2 - why /2 rather than /1?
In-Reply-To: <4C5DC219.8050906@rabbitmq.com>
References: <4C5D6539.8050202@rabbitmq.com> <4C5DAD92.2050104@rabbitmq.com>
	<4C5DBFC7.7040103@rabbitmq.com> <4C5DC174.2010303@rabbitmq.com>
	<4C5DC219.8050906@rabbitmq.com>
Message-ID: <4C5DC3C1.8060709@rabbitmq.com>

Tony,

Tony Garnock-Jones wrote:
> It looks like it doesn't handle the case where you have only a binary encoded
> form of the headers (properties = none), in a protocol different from the one
> you want.

True. That's what one gets when writing code that doesn't actually get 
used ;) Will fix.


Matthias.

From tonyg at rabbitmq.com  Sat Aug  7 21:47:00 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sat, 07 Aug 2010 16:47:00 -0400
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5DC302.9070506@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>	<20100807115017.GA1469@wellquite.org>	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com> <4C5DBE53.7020107@rabbitmq.com>
	<4C5DBF6F.3000500@rabbitmq.com> <4C5DC163.80801@rabbitmq.com>
	<4C5DC302.9070506@rabbitmq.com>
Message-ID: <4C5DC644.7080603@rabbitmq.com>

Matthias Radestock wrote:
> At that point the cloud messaging service has two copies of the same
> message in different locations. For the duplication to be detected, some
> information needs to flow between the two locations. Which is expensive.

Aha! I see. Thank you. I had the *publishers* being in different locations in
my mind. Which is of course a different problem.

In the context in which you originally posted the example ("using
publisher-supplied message ids for de-duping simply does not scale") I suspect
that the mention of publisher-supplied message IDs is not relevant: it's the
maintainance of any kind of dedup buffer at all in more than one place at the
same time that's not scalable.

Isn't the fundamental state-synchronisation-between-server-nodes problem
independent of the choice of message ID?

Tony


From matthew at rabbitmq.com  Sat Aug  7 22:25:27 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 7 Aug 2010 22:25:27 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5DB82A.5080006@rabbitmq.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
	<4C5C821C.6010308@jboss.com> <20100807115017.GA1469@wellquite.org>
	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com>
Message-ID: <20100807212527.GF1469@wellquite.org>

On Sat, Aug 07, 2010 at 08:46:50PM +0100, Matthias Radestock wrote:
> I believe Matthew was simply trying to point out that many of the
> supposed guarantees of messaging systems are a lot softer than most
> people think.

Well, in my mind, if you "guarantee" something, then you can offer a
proof in some branch of maths that the property you are guaranteeing can
never be violated except in the circumstances you qualify the statement
with.

That is why, as far as I'm concerned, no messaging system, regardless of
whether it's implemented in a computer or not, can ever guarantee
exactly once semantics: I can prove (or rather, other people have
proven) that provided any individual message can be lost, you can either
achieve "at least once" semantics or "at most once" semantics.

Quantum mechanics may offer a way to avoid messages ever being lost, but
I suspect that's probably not going to be sorted out in time for
RabbitMQ 3.0.

> In reality a "guarantee" is little more than an
> increase in the probability that the right thing will happen.

Indeed. And importantly, under different circumstances, that probability
can vary wildly. Once you start combining different systems, and the
error rates compound, the probability that the whole thing works end to
end can end up looking very shaky. I suspect the insurance industry will
do well here.

> > What has not been touched on in this little discussion so far is
> > the question of transactions. .. Updating DBs from queues and
> > posting the results of those updates to queues should be atomic; and
> > if I want my debit/credit to happen once rather than many times or
> > not at all, then a combination of transactions and guaranteed
> > delivery becomes very attractive both to the designer and the
> > developers. Yes, ACID comes to mind here...and it is indeed what I
> > am referring to.

Distributed transactions rely on 2-phase or 3-phase commit or some
variant thereof (eg there's an improved 3-phase build on paxos). Whilst
the protocols themselves are sound, my understanding is (and please
correct me if I'm wrong) that they all rely on, once everyone's agreed
there is no problem committing the transaction, no participant will
renege on that promise. But of course, no participant can actually
guarantee that. Thus distributed transactions can never guarantee ACID.

All you can get is increasing probability that the outcome will be
atomic, consistent and isolated. But you can never guarantee it.

Matthew

From alexis at rabbitmq.com  Sat Aug  7 22:32:49 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 7 Aug 2010 22:32:49 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <20100807212527.GF1469@wellquite.org>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
	<4C5C821C.6010308@jboss.com> <20100807115017.GA1469@wellquite.org>
	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com>
	<20100807212527.GF1469@wellquite.org>
Message-ID: <AANLkTinU=3zhjeb8kBO6h0iohC_Sb7_1hkvUw9JXRCzp@mail.gmail.com>

On Sat, Aug 7, 2010 at 10:25 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Sat, Aug 07, 2010 at 08:46:50PM +0100, Matthias Radestock wrote:
>> I believe Matthew was simply trying to point out that many of the
>> supposed guarantees of messaging systems are a lot softer than most
>> people think.
>
> Well, in my mind, if you "guarantee" something, then you can offer a
> proof in some branch of maths that the property you are guaranteeing can
> never be violated except in the circumstances you qualify the statement
> with.
>
> That is why, as far as I'm concerned, no messaging system, regardless of
> whether it's implemented in a computer or not, can ever guarantee
> exactly once semantics: I can prove (or rather, other people have
> proven) that provided any individual message can be lost, you can either
> achieve "at least once" semantics or "at most once" semantics.

AFAICT, the normal way this plays out is that people seek to provide
>=1 semantics for publisher-broker, and <=1 semantics for
broker-consumer.  Which for most people is 'good enough'.




> Quantum mechanics may offer a way to avoid messages ever being lost, but
> I suspect that's probably not going to be sorted out in time for
> RabbitMQ 3.0.

This would be renamed QbitMQ.  Delivery would be determined by opening
a box.  No bunnies would be harmed in this experiment.





>> In reality a "guarantee" is little more than an
>> increase in the probability that the right thing will happen.
>
> Indeed. And importantly, under different circumstances, that probability
> can vary wildly. Once you start combining different systems, and the
> error rates compound, the probability that the whole thing works end to
> end can end up looking very shaky. I suspect the insurance industry will
> do well here.
>
>> > What has not been touched on in this little discussion so far is
>> > the question of transactions. .. Updating DBs from queues and
>> > posting the results of those updates to queues should be atomic; and
>> > if I want my debit/credit to happen once rather than many times or
>> > not at all, then a combination of transactions and guaranteed
>> > delivery becomes very attractive both to the designer and the
>> > developers. Yes, ACID comes to mind here...and it is indeed what I
>> > am referring to.
>
> Distributed transactions rely on 2-phase or 3-phase commit or some
> variant thereof (eg there's an improved 3-phase build on paxos). Whilst
> the protocols themselves are sound, my understanding is (and please
> correct me if I'm wrong) that they all rely on, once everyone's agreed
> there is no problem committing the transaction, no participant will
> renege on that promise. But of course, no participant can actually
> guarantee that. Thus distributed transactions can never guarantee ACID.
>
> All you can get is increasing probability that the outcome will be
> atomic, consistent and isolated. But you can never guarantee it.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From sustrik at 250bpm.com  Sun Aug  8 11:30:04 2010
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Sun, 08 Aug 2010 12:30:04 +0200
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <AANLkTinU=3zhjeb8kBO6h0iohC_Sb7_1hkvUw9JXRCzp@mail.gmail.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>
	<20100807115017.GA1469@wellquite.org>	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>	<4C5DB82A.5080006@rabbitmq.com>	<20100807212527.GF1469@wellquite.org>
	<AANLkTinU=3zhjeb8kBO6h0iohC_Sb7_1hkvUw9JXRCzp@mail.gmail.com>
Message-ID: <4C5E872C.4030403@250bpm.com>

Alexis Richardson wrote:

>> Quantum mechanics may offer a way to avoid messages ever being lost, but
>> I suspect that's probably not going to be sorted out in time for
>> RabbitMQ 3.0.
> 
> This would be renamed QbitMQ.  Delivery would be determined by opening
> a box.  No bunnies would be harmed in this experiment.

Even better:

If message is missing, try to guess what was that the sender intended to 
send. Deliver it to the receiver. If it turns out later on that the 
guess was incorrect, cancel the transaction. Additional advantage is 
that you can get negative latencies this way.

Martin

From floydophone at gmail.com  Mon Aug  9 03:55:22 2010
From: floydophone at gmail.com (Pete Hunt)
Date: Sun, 8 Aug 2010 22:55:22 -0400
Subject: [rabbitmq-discuss] Node scheduling with RabbitMQ
In-Reply-To: <3A98A0E9-B7FD-434A-BC06-8BDC0E37A9AE@opera.com>
References: <AANLkTimtWEm0oN=iqyK23KQ2jFWredu22TtrEdk6iU3_@mail.gmail.com>
	<9BC6CEAE-37E5-4BE1-A20B-9136A10539BE@opera.com>
	<3A98A0E9-B7FD-434A-BC06-8BDC0E37A9AE@opera.com>
Message-ID: <AANLkTi=QYUWuwV1pZy+8HEuJN=RB3j1Pqe=V5zrL7twk@mail.gmail.com>

Hi Ask -

I am a Pythonista and I have been looking into Celery, so this is very
cool that you have responded!

I was considering writing an x-script exchange for RabbitMQ and
creating one queue per worker to dump messages in; this is a feasible
way to go, right? The exchange could probably handle data locality,
however, what happens when a worker dies with messages sitting on the
queue?

I also am relatively new to the non-Amazon SQS message queuing world,
so I guess that this becomes less a question of how to do proper data
locality and more about how to do reliability with RabbitMQ. On SQS,
due to the visibility timeout semantics I am assured that if I design
idempotent tasks they will eventually occur even if there is a node
failure.

Right now, the solution that makes the most sense to me is to have a
single consumer that farms the tasks out to the worker nodes, however,
this means that I need to build reliability capabilities like
visibility timeouts into the consumer rather than relying on a battle
tested piece of software like RabbitMQ. Is there some sort of
functionality in RabbitMQ that accounts for this? Am I missing an
important piece of documentation somewhere?

Thanks,

Pete

On Sat, Aug 7, 2010 at 5:04 AM, Ask Solem <askh at opera.com> wrote:
>
> On Aug 7, 2010, at 10:43 AM, Ask Solem wrote:
>>>
>>
>> cache-aware? You mean data locality?
>>
>> I've been contemplating this as well.
>> I think this could be solved by having a proxy in front of RabbitMQ, that routes
>> the messages to the correct hosts (using routing keys).
>>
>> E.g. if each worker is also consuming from a private queue, this proxy could
>> just reroute the message so the task is received by a single worker.
>
>
> On second thought it doesn't need to be a proxy at all,
> just some service knowing what worker(s) is near the data.
>
> node1.example.com consumes from
> ? ?queue: tasks exchange: tasks type: direct
> ? ?queue: node1.example.com exchange: directly_to type: direct
>
> node2.example.com consumes from
> ? ?queue: tasks exchange: tasks rkey=tasks
> ? ?queue: node2.example.com exchange: directly_to rkey=node2.example.com
>
> Then these workers will receive tasks from the "tasks" queue in round robin style,
> and it's also possible to send tasks directly to one or more workers.
>
> When you publish a task that could benefit from optimal data locality, you consult
> the central authority to know what nodes is closest to the file(s):
>
> routing_key = node_close_to(file)
> basic_publish(message, exchange="directly_to", routing_key=routing_key)
>
> This doesn't take into account failing nodes, but maybe you could use
> the immediate flag for this.
>
> As the maintainer of Celery (http://celeryproject.org), I'm very interested
> in what you end up with here.
>
>
>
> --
> {Ask Solem,
> ?+47 98435213 | twitter.com/asksol }.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From johndapps at gmail.com  Mon Aug  9 09:41:24 2010
From: johndapps at gmail.com (John Apps)
Date: Mon, 9 Aug 2010 10:41:24 +0200
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5E872C.4030403@250bpm.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
	<4C5C821C.6010308@jboss.com> <20100807115017.GA1469@wellquite.org>
	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com>
	<20100807212527.GF1469@wellquite.org>
	<AANLkTinU=3zhjeb8kBO6h0iohC_Sb7_1hkvUw9JXRCzp@mail.gmail.com>
	<4C5E872C.4030403@250bpm.com>
Message-ID: <AANLkTikVx8M1Z=B8hMqgBeD5A1jU0EJCHES_S9YnMUn2@mail.gmail.com>

On Sun, Aug 8, 2010 at 12:30, Martin Sustrik <sustrik at 250bpm.com> wrote:

> Alexis Richardson wrote:
>
>  Quantum mechanics may offer a way to avoid messages ever being lost, but
>>> I suspect that's probably not going to be sorted out in time for
>>> RabbitMQ 3.0.
>>>
>>
>> This would be renamed QbitMQ.  Delivery would be determined by opening
>> a box.  No bunnies would be harmed in this experiment.
>>
>
Thus spoke the CEO - end of discussion!


>
> Even better:
>
> If message is missing, try to guess what was that the sender intended to
> send. Deliver it to the receiver. If it turns out later on that the guess
> was incorrect, cancel the transaction. Additional advantage is that you can
> get negative latencies this way.
>
> Martin
>

It is good to see humour in discussions of this nature; it would be even
better if those implementing the applications were to share the same humour!
I suspect the world of open source is at times a different one to that which
I seem to work in. Oh well, back to the drawing board.

---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100809/4364c2eb/attachment.htm>

From alexis at rabbitmq.com  Mon Aug  9 09:46:38 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 9 Aug 2010 09:46:38 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <AANLkTikVx8M1Z=B8hMqgBeD5A1jU0EJCHES_S9YnMUn2@mail.gmail.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>
	<20100805112252.GH17061@rabbitmq.com>
	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>
	<4C5AC138.1010706@rabbitmq.com>
	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>
	<4C5C821C.6010308@jboss.com> <20100807115017.GA1469@wellquite.org>
	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>
	<4C5DB82A.5080006@rabbitmq.com>
	<20100807212527.GF1469@wellquite.org>
	<AANLkTinU=3zhjeb8kBO6h0iohC_Sb7_1hkvUw9JXRCzp@mail.gmail.com>
	<4C5E872C.4030403@250bpm.com>
	<AANLkTikVx8M1Z=B8hMqgBeD5A1jU0EJCHES_S9YnMUn2@mail.gmail.com>
Message-ID: <AANLkTim8=zMynkXJu6z_fnrL-bJDEgWbCOrsT24Y2r5A@mail.gmail.com>

John

On Mon, Aug 9, 2010 at 9:41 AM, John Apps <johndapps at gmail.com> wrote:
>
> It is good to see humour in discussions of this nature; it would be even
> better if those implementing the applications were to share the same humour!
> I suspect the world of open source is at times a different one to that which
> I seem to work in. Oh well, back to the drawing board.

John we take this stuff as seriously as anyone.  That's why we do it
professionally.

We've often found customers whose requirements include "please break
the laws of physics, and cure cancer".  I'm sure you know what I mean.
 If you could advise us on how to best help in such cases, we're all
ears.

In the meantime we are stuck in world where "guaranteed" has no fixed
connotation.

alexis

From tim.fox at jboss.com  Mon Aug  9 11:49:42 2010
From: tim.fox at jboss.com (Tim Fox)
Date: Mon, 09 Aug 2010 11:49:42 +0100
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <20100807115017.GA1469@wellquite.org>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>
	<20100807115017.GA1469@wellquite.org>
Message-ID: <4C5FDD46.7070609@jboss.com>

On 07/08/10 12:50, Matthew Sackman wrote:
> On Fri, Aug 06, 2010 at 10:43:56PM +0100, Tim Fox wrote:
>    
>> The way we do it in HornetQ is we have a well defined header key
>> "_HQ_DUP_ID". The client can set this with some unique value of it's
>> choice before sending (e.g. a GUID). When the server receives the
>> message if the _HQ_DUP_ID header is set, it looks up the value in
>> it's cache, and if it's seen it before it ignores it. The cache can
>> optionally be persisted.
>>      
> How do you prevent the cache from growing without bound?
>    
Currently we use a circular buffer. It's up to the user to make it big 
enough for their use case. For JMS, where persistent sends/ tx commit 
must be synchronous, the buffer size would need to be somewhat larger 
than the max number of producers, since there's never more than one 
"inflight" message at any time per producer. But there's certainly an 
element of guesswork here.

In HornetQ we also provide an interface above and beyond JMS, which 
allows the user to receive an *asynchronous* ack that the message they 
sent (or tx commit) has been received ok on the server so they can clear 
it from their local resend cache. Since this is async it's not limited 
by network latency as in the blocking JMS case. The downside is many 
messages can be in-flight at any time per producer so the caches need to 
be larger.

To do all of this without being limited by arbitrary cache size, would 
need some kind of "ack of ack" (we don't implement this yet)- i.e. 1) 
the client sends message to server, 2) server sends ack back to to 
client to say "received-ok" 3) client sends further ack from client to 
server saying received-received-ok-ok. At point 2) the client can clear 
their resend cache. At point 3) the server can clear it's cache. I 
believe AMQP 1.0 specifies something similar to this too (?)

So.. this could scale. You'd have a further buffer per producer on the 
server side. If you're using TCP on the server, then every connection 
will have it's own buffer anyway. The extra buffer per producer should 
be of the same order of size as the TCP buffer, since it's effectively 
defined by a window, kind of similar to the TCP window size.

Like others have said, 100% once and only once delivery doesn't happen. 
To get very near at 100% you can implement stuff like the above, and 
also make sure your storage is highly redundant, also mirrored in 
geographically distributed sites in case the building blows up. Then 
you've got bugs in your own app, device drivers or the operating system 
that screw your once and only once (for example last week I hit a bug in 
the Linux kernel TCP impl which can cause packets to be lost at high 
load) that you might hit well before having to take quantum effects into 
account :)
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    


-- 
Sent from my BBC Micro Model B

Tim Fox
JBoss

HornetQ - putting the buzz in messaging http://hornetq.org
http://hornetq.blogspot.com/
http://twitter.com/hornetq
irc://irc.freenode.net:6667#hornetq	
fox at redhat.com


From tonyg at rabbitmq.com  Mon Aug  9 16:35:59 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Mon, 09 Aug 2010 11:35:59 -0400
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <4C5FDD46.7070609@jboss.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>	<20100807115017.GA1469@wellquite.org>
	<4C5FDD46.7070609@jboss.com>
Message-ID: <4C60205F.7030800@rabbitmq.com>

Tim Fox wrote:
> To do all of this without being limited by arbitrary cache size, would
> need some kind of "ack of ack"

That's an occasionally-useful optimization, but it really only works well with
message UUIDs (i.e. never repeating a message ID). Even then, in the general
case you're likely to want to bound the time you wait for the message
transmission to complete anyway (consider what happens when an ack or ack-ack
goes missing), it seems simpler (not to mention much less chatty) to me to
avoid ack-acks and go with a Delta-T style timeout-bounded buffer. At that
point you're free to choose any kind of message ID space, including
compressible fixed-length reusable spaces like those in TCP/SCTP etc.

> Like others have said, 100% once and only once delivery doesn't happen.
> To get very near at 100% you can implement stuff like the above, and
> also make sure your storage is highly redundant, also mirrored in
> geographically distributed sites in case the building blows up. Then
> you've got bugs in your own app, device drivers or the operating system
> that screw your once and only once (for example last week I hit a bug in
> the Linux kernel TCP impl which can cause packets to be lost at high
> load) that you might hit well before having to take quantum effects into
> account :)

Amen :-)

Tony


From archanasayshi at gmail.com  Mon Aug  9 17:33:47 2010
From: archanasayshi at gmail.com (archana v)
Date: Mon, 9 Aug 2010 12:33:47 -0400
Subject: [rabbitmq-discuss] To declare a MQ listener at java application
	startup
Message-ID: <AANLkTi=OYNTManT0D4DcUTb+Wj3Um5=5xHymbvikZvp6@mail.gmail.com>

Hi All,

I am new to rabbit-mq. I would like to know  how to start a MQ listner(Java
Client) to listen to a queue at the application start up.  I am deploying my
application in tomcat server.
Thanks in advance for your help.


Thanks and Regards,
Archana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100809/5d20b0b5/attachment.htm>

From jeff at gamesys.co.uk  Mon Aug  9 18:11:21 2010
From: jeff at gamesys.co.uk (Jeff Bannister)
Date: Mon, 9 Aug 2010 18:11:21 +0100
Subject: [rabbitmq-discuss] Broker to Broker communication...
Message-ID: <CCFB1811-13BF-4D0F-BF46-4EFBED5C20BC@gamesys.co.uk>

Hi,

I am a newbie to AMQP, and have spent the last couple of days reading through the 0.8 spec, as well as various articles on the Internet, and I am still not clear on what RabbitMQ/AMQP parts I would need for my purposes.

I would like to use RabbitMQ for communication between two Java applications, that are geographically separate, and separated by a global transit link with approx. 150ms latency. One application will produce messages anywhere upto 200 msgs/sec. This messages are very small and I need guaranteed delivery to the other application. Latency is not a big issue here, as its ok if the messages are not delivery to the consuming application for several seconds. Although the faster the delivery the better. I'm just indicating their is a broad degree of latency tolerance. Looking through the docs so far I believe I need to have two brokers one on each side of the WAN link. However I am not clear exactly what the topology would look like.

Would it look like this?

e.g. App B--->Exchange A-->Queue-->Exchange B-->Queue-->App A

or would I just configure a RabbitMQ Cluster where the nodes can be geographically separate as its using the OTP platform?

Any advice would be much appreciated. Ideally some example deployment topologies would be great as well.

Jeff Bannister
Gamesys Ltd
Chief Application Architect
e: jeff at gamesys.co.uk<mailto:jeff at gamesys.co.uk>
t: 07876 231869


This email (including any attachments) is confidential, protected by copyright and may be privileged. It is for the exclusive use of the intended recipient(s). If you have received it in error, please notify the sender immediately by emailing a response before deleting the email completely from your computer, and note that any storage, copying or dissemination is prohibited.

Where the content of this email is personal or otherwise unconnected with business of the Group?s Companies, we accept no responsibility or liability for such content.

We accept no responsibility for viruses that we may have unintentionally transmitted to you within this email and you should check for viruses before opening any attachment. Those communicating with us by email will be deemed to have consented to us intercepting and monitoring those communications.

Gamesys Ltd is registered in England & Wales, company registration number 04042931.  10 Piccadilly, London, W1J 0DD.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100809/bf9d26ac/attachment.htm>

From david at brightscope.com  Mon Aug  9 18:30:59 2010
From: david at brightscope.com (David Allison)
Date: Mon, 9 Aug 2010 10:30:59 -0700
Subject: [rabbitmq-discuss] Using Clustering with Amazon EC2
Message-ID: <9EA0415A-427F-4D55-AC67-509182C928DD@brightscope.com>

Hi All,

I was hoping someone could discuss experiences they've had with using RabbitMQ clustering (as described in http://www.rabbitmq.com/clustering.html ) on Amazon EC2.  We currently only run one queue broker, and were considering using clustering to increase reliability and availability of the queues. 

Also, because the queues are currently not replicated, if a node goes down that contains a queue, is that queue immediately inaccessible, or are its contents (messages)  just lost, but clients could potentially still write to the same queue name on another broker in the cluster?

Best,
David Allison
Head of Engineering & Development
BrightScope, Inc.
david at brightscope.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100809/bc8c6dbc/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: logo5.png
Type: image/png
Size: 11824 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100809/bc8c6dbc/attachment-0001.png>

From jon.brisbin at npcinternational.com  Mon Aug  9 18:43:42 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 9 Aug 2010 12:43:42 -0500
Subject: [rabbitmq-discuss] To declare a MQ listener at java application
	startup
In-Reply-To: <AANLkTi=OYNTManT0D4DcUTb+Wj3Um5=5xHymbvikZvp6@mail.gmail.com>
References: <AANLkTi=OYNTManT0D4DcUTb+Wj3Um5=5xHymbvikZvp6@mail.gmail.com>
Message-ID: <14F9D31B-439C-4523-8349-339E65C85A7B@npcinternational.com>

There's actually a lot of ways to go about this:

1) If you're using Spring, then just configure a bean in your app-context.xml. 

2) You could use the new spring-amqp classes: http://www.springsource.org/spring-amqp

3) You could manually configure them from the servlet init method.

I also run listeners that integrate with the Tomcat server. You can configure them in different ways depending on the context. You could set up a global naming resource, or you could scope it to your web application by putting it in META-INF/context.xml: http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Aug 9, 2010, at 11:33 AM, archana v wrote:

> Hi All,
> 
> I am new to rabbit-mq. I would like to know  how to start a MQ listner(Java Client) to listen to a queue at the application start up.  I am deploying my application in tomcat server.
> Thanks in advance for your help.
> 
> 
> Thanks and Regards,
> Archana 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100809/f32a0f6e/attachment.htm>

From jon.brisbin at npcinternational.com  Mon Aug  9 18:52:13 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 9 Aug 2010 12:52:13 -0500
Subject: [rabbitmq-discuss] To declare a MQ listener at java application
	startup
In-Reply-To: <AANLkTi=3ODwo1DNj22zRi2Wxq6CdJG64RdyNYUS=o4Ts@mail.gmail.com>
References: <AANLkTi=OYNTManT0D4DcUTb+Wj3Um5=5xHymbvikZvp6@mail.gmail.com>
	<14F9D31B-439C-4523-8349-339E65C85A7B@npcinternational.com>
	<AANLkTi=3ODwo1DNj22zRi2Wxq6CdJG64RdyNYUS=o4Ts@mail.gmail.com>
Message-ID: <1DDDC4E7-4220-4F40-9013-FB87B143CB99@npcinternational.com>

On Aug 9, 2010, at 12:47 PM, archana v wrote:

> Thanks for your reply.I  am not using spring.. I am trying to configure it at servlet init. But it doesn seem to work. I dont know if my method of declaring the listener is right. It would be helpful if you could send me some samples.

Sorry, I don't have any example of using servlet init because I use Spring.

Maybe you could show a little of what you're trying to do?

Are you including <load-on-startup>1</load-on-startup> in your servlet init?

jb


> 
> 
> Thanks and Regards,
> Archana 
> 
> On Mon, Aug 9, 2010 at 1:43 PM, Jon Brisbin <jon.brisbin at npcinternational.com> wrote:
> There's actually a lot of ways to go about this:
> 
> 1) If you're using Spring, then just configure a bean in your app-context.xml. 
> 
> 2) You could use the new spring-amqp classes: http://www.springsource.org/spring-amqp
> 
> 3) You could manually configure them from the servlet init method.
> 
> I also run listeners that integrate with the Tomcat server. You can configure them in different ways depending on the context. You could set up a global naming resource, or you could scope it to your web application by putting it in META-INF/context.xml: http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html
> 
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
> 
> 
> 
> On Aug 9, 2010, at 11:33 AM, archana v wrote:
> 
>> Hi All,
>> 
>> I am new to rabbit-mq. I would like to know  how to start a MQ listner(Java Client) to listen to a queue at the application start up.  I am deploying my application in tomcat server.
>> Thanks in advance for your help.
>> 
>> 
>> Thanks and Regards,
>> Archana 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100809/f6a15de2/attachment.htm>

From chrisch at ecollege.com  Mon Aug  9 18:56:23 2010
From: chrisch at ecollege.com (Chris Chew)
Date: Mon, 9 Aug 2010 11:56:23 -0600
Subject: [rabbitmq-discuss] Broker to Broker communication...
In-Reply-To: <CCFB1811-13BF-4D0F-BF46-4EFBED5C20BC@gamesys.co.uk>
Message-ID: <74D4EDFED2256749A5BF5B59267E085303918550@EXMBCL01CORP.eclg.org>

> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jeff Bannister
> Sent: Monday, August 09, 2010 11:11 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Broker to Broker communication...
>
> ...
> 
> Would it look like this??
>
> App B--->Exchange A-->Queue-->Exchange B-->Queue-->App A

Hi Jeff.

The part you are missing is the piece that "connects" the queue on Exchange A to Exchange B.  Prior to the upcoming 1.0 spec, AMQP does not define anything special for broker-to-broker mechanics.

You might consider the rabbitmq-shovel plugin to "shovel" the messages from one broker/exchange to another.  In your case, it would be from a broker in geographic location A to an analogous broker in geographic location B.

With shovel, the flow would look more like this:

          [ ......... Broker A .......... ]          [ ..... Broker B ..... ]
App B --> Exchange A --> Queue A --> Shovel -+WAN+-> Exchange B --> Queue --> App B

See:

http://www.lshift.net/blog/2010/02/01/rabbitmq-shovel-message-relocation-equipment
http://hg.rabbitmq.com/rabbitmq-shovel/

I hope this helps!

Chris

From matthias at rabbitmq.com  Mon Aug  9 19:04:20 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 09 Aug 2010 19:04:20 +0100
Subject: [rabbitmq-discuss] Broker to Broker communication...
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303918550@EXMBCL01CORP.eclg.org>
References: <74D4EDFED2256749A5BF5B59267E085303918550@EXMBCL01CORP.eclg.org>
Message-ID: <4C604324.20600@rabbitmq.com>

Jeff,

Chris Chew wrote:
>Jeff Bannister wrote:
>> App B--->Exchange A-->Queue-->Exchange B-->Queue-->App A
> [...]
> With shovel, the flow would look more like this:
> 
>           [ ......... Broker A .......... ]          [ ..... Broker B ..... ]
> App B --> Exchange A --> Queue A --> Shovel -+WAN+-> Exchange B --> Queue --> App B

rabbitmq-shovel is certainly one option. But do you actually need two 
brokers in the first place? Why not co-locate the broker with either the 
sending or the receiving side?


Regards,

Matthias.

From jeff at gamesys.co.uk  Mon Aug  9 20:54:47 2010
From: jeff at gamesys.co.uk (Jeff Bannister)
Date: Mon, 9 Aug 2010 12:54:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Broker to Broker communication...
In-Reply-To: <4C604324.20600@rabbitmq.com>
References: <CCFB1811-13BF-4D0F-BF46-4EFBED5C20BC@gamesys.co.uk>
	<74D4EDFED2256749A5BF5B59267E085303918550@EXMBCL01CORP.eclg.org>
	<4C604324.20600@rabbitmq.com>
Message-ID: <29391546.post@talk.nabble.com>



Matthias Radestock-3 wrote:
> 
> 
> rabbitmq-shovel is certainly one option. But do you actually need two 
> brokers in the first place? Why not co-locate the broker with either the 
> sending or the receiving side?
> 
> 

I have no preference or reason for having a broker each side. This is the
conclusion I came to after reading through some docs. I may well lack some
fundamental understanding of AMQP/RabbitMQ. With the approach you suggest I
am not sure how this would work. 

The application that produces the messages would send them asynchronously to
a local broker i.e. an Exchange. It is my understanding that an Exchange
will not store any messages, therefore I am guessing I need a Q on the
sending side to buffer these messages. This would give me an Exchange and a
Q on the sending side. How would the messages get sent to the destination
without something like shovel? i.e. Who would read the Q, the consumer on
the other side of the WAN?

So I would end up have something like...

App A-->Exchange-->Q-->+WAN+>Consumer-->AppB

I am keen to have the simplest solution I can. Therefore if 'shovel' is an
unnecessary part then I would be happy to loose it.



-- 
View this message in context: http://old.nabble.com/Broker-to-Broker-communication...-tp29390117p29391546.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Mon Aug  9 22:34:22 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 09 Aug 2010 22:34:22 +0100
Subject: [rabbitmq-discuss] Broker to Broker communication...
In-Reply-To: <29391546.post@talk.nabble.com>
References: <CCFB1811-13BF-4D0F-BF46-4EFBED5C20BC@gamesys.co.uk>	<74D4EDFED2256749A5BF5B59267E085303918550@EXMBCL01CORP.eclg.org>	<4C604324.20600@rabbitmq.com>
	<29391546.post@talk.nabble.com>
Message-ID: <4C60745E.7090204@rabbitmq.com>

Jeff,

Jeff Bannister wrote:
> The application that produces the messages would send them asynchronously to
> a local broker i.e. an Exchange. It is my understanding that an Exchange
> will not store any messages, therefore I am guessing I need a Q on the
> sending side to buffer these messages.

Correct. In fact the only way to get messages out of an AMQP broker is 
via a queue; clients cannot consume from exchanges directly.

> Who would read the Q, the consumer on the other side of the WAN?

Yep.

> So I would end up have something like...
> 
> App A-->Exchange-->Q-->+WAN+>Consumer-->AppB

Correct.


Regards,

Matthias.

From jon.brisbin at npcinternational.com  Mon Aug  9 22:56:47 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 9 Aug 2010 16:56:47 -0500
Subject: [rabbitmq-discuss] To declare a MQ listener at java application
	startup
In-Reply-To: <AANLkTin4ZNA7g6aUnL45MKRmNZTPmMpH+pecMkqnmZMt@mail.gmail.com>
References: <AANLkTi=OYNTManT0D4DcUTb+Wj3Um5=5xHymbvikZvp6@mail.gmail.com>
	<14F9D31B-439C-4523-8349-339E65C85A7B@npcinternational.com>
	<AANLkTi=3ODwo1DNj22zRi2Wxq6CdJG64RdyNYUS=o4Ts@mail.gmail.com>
	<1DDDC4E7-4220-4F40-9013-FB87B143CB99@npcinternational.com>
	<AANLkTin4ZNA7g6aUnL45MKRmNZTPmMpH+pecMkqnmZMt@mail.gmail.com>
Message-ID: <123044DE-98A7-4173-8AF2-A256F99096E2@npcinternational.com>

Have you looked at "basicConsume" on the Channel object?

http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.8.0/rabbitmq-java-client-javadoc-1.8.0/com/rabbitmq/client/Channel.html

Or do you mean: "more specifically, how do you manage multi-threading issues when managing consumers"?

The latter is a black hole of a topic. :)

The API guide, though Spartan, is a good starting point:
http://www.rabbitmq.com/api-guide.html#consuming

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Aug 9, 2010, at 1:15 PM, archana v wrote:

> i declare something like this
> 
> 	 <servlet>
> 	<servlet-name>MQListenerServlet</servlet-name>
> 	<display-name>MQListenerServlet</display-name>
> 	<servlet-class>com.ssmi.admin.MQ.MQListenerTest</servlet-class>
> 	
> 	<load-on-startup>6</load-on-startup>
> 	</servlet>
> 
> 
> but in my class file i am not sure as to how to declare the listner. Should i use the java Thread or is there a default method like addlistener or somethin in rabbit MQ.
> 
> On Mon, Aug 9, 2010 at 1:52 PM, Jon Brisbin <jon.brisbin at npcinternational.com> wrote:
> On Aug 9, 2010, at 12:47 PM, archana v wrote:
> 
>> Thanks for your reply.I  am not using spring.. I am trying to configure it at servlet init. But it doesn seem to work. I dont know if my method of declaring the listener is right. It would be helpful if you could send me some samples.
> 
> Sorry, I don't have any example of using servlet init because I use Spring.
> 
> Maybe you could show a little of what you're trying to do?
> 
> Are you including <load-on-startup>1</load-on-startup> in your servlet init?
> 
> jb
> 
> 
>> 
>> 
>> Thanks and Regards,
>> Archana 
>> 
>> On Mon, Aug 9, 2010 at 1:43 PM, Jon Brisbin <jon.brisbin at npcinternational.com> wrote:
>> There's actually a lot of ways to go about this:
>> 
>> 1) If you're using Spring, then just configure a bean in your app-context.xml. 
>> 
>> 2) You could use the new spring-amqp classes: http://www.springsource.org/spring-amqp
>> 
>> 3) You could manually configure them from the servlet init method.
>> 
>> I also run listeners that integrate with the Tomcat server. You can configure them in different ways depending on the context. You could set up a global naming resource, or you could scope it to your web application by putting it in META-INF/context.xml: http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> 
>> 
>> On Aug 9, 2010, at 11:33 AM, archana v wrote:
>> 
>>> Hi All,
>>> 
>>> I am new to rabbit-mq. I would like to know  how to start a MQ listner(Java Client) to listen to a queue at the application start up.  I am deploying my application in tomcat server.
>>> Thanks in advance for your help.
>>> 
>>> 
>>> Thanks and Regards,
>>> Archana 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100809/26e9ea30/attachment-0001.htm>

From avanti at yahoo-inc.com  Tue Aug 10 00:59:15 2010
From: avanti at yahoo-inc.com (Avanti Nadgir)
Date: Mon, 9 Aug 2010 16:59:15 -0700 (PDT)
Subject: [rabbitmq-discuss] New user : Help needed in understanding memory
	usage
In-Reply-To: <5980445.141281398145069.JavaMail.avanti@angrystood-lm>
Message-ID: <5384000.161281398354503.JavaMail.avanti@angrystood-lm>

I am experimenting with RabbitMQ on a rhel vm (ver 1.8.1)
Have started the broker and am able to publish and consume events till the resident memory usage of the broker peaks at about 400M (it keeps growing with the number of messages published even though the consumer is consuming events) After this the broker needs to be restarted to bring back the memory usage to 0 before more messages can be sent.

Attached is the code snippet of the publisher and consumer.  
=================================================================
Publisher :
                factory.setHost("localhost");
                factory.setPort(5672);
                Connection conn = factory.newConnection();

                Channel channel = conn.createChannel();

                System.out.println("done creating conn");
                String exchangeName = "testExchange";
                String queueName = "testQueueNew";
                String routingKey = "";
                channel.exchangeDeclare(exchangeName, "direct", true);
                channel.queueDeclare(queueName, true, false, true, null);
                channel.queueBind(queueName, exchangeName, routingKey);

                byte[] messageBodyBytes = new byte[2000];
                for(int j = 0;j<2000;j++) {
                        messageBodyBytes[j] = 'A';
                }
                for(int i = 0; i < numMessages; i++) {
                        channel.basicPublish(exchangeName, routingKey, null, messageBodyBytes);
                        if(sleepInterval != 0) {
                                if (i % sleepInterval == 0) {
                                        Thread.sleep(timeToSleep);
                                        System.out.println("Published Message " + i);
                                }
                        }
                }

                channel.close();
                conn.close();
==================================================================
Consumer :
                ConnectionFactory factory = new ConnectionFactory();
                factory.setHost("localhost");
                factory.setPort(5672);
                Connection conn = factory.newConnection();
                Channel channel = conn.createChannel();

                String exchangeName = "testExchange";
                String routingKey = "";
                String queueName = "testQueue";
                channel.exchangeDeclare(exchangeName, "direct", true);
                channel.queueBind(queueName, exchangeName, routingKey);

                boolean noAck = false;
                QueueingConsumer consumer = new QueueingConsumer(channel);
                channel.basicConsume(queueName, noAck, consumer);
                int count = 0;
                while (count < numMessages) {
                    count++;
                    QueueingConsumer.Delivery delivery;
                    try {
                        delivery = consumer.nextDelivery();
                    } catch (InterruptedException ie) {
                        continue;
                    }
                    // (process the message components ...)

                        byte[] body = delivery.getBody();
                        String resp = new String(body);
                        channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                }

                channel.close();
                conn.close();

===================================================================================
Any help is appreciated.

Thanks,
Avanti

From sustrik at 250bpm.com  Tue Aug 10 08:52:08 2010
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Tue, 10 Aug 2010 09:52:08 +0200
Subject: [rabbitmq-discuss] Exactly Once Delivery
In-Reply-To: <AANLkTim8=zMynkXJu6z_fnrL-bJDEgWbCOrsT24Y2r5A@mail.gmail.com>
References: <B268CF12349471459840DDE70D308B9DB0E9E63A33@EUSAACMS0702.eamcs.ericsson.se>	<20100805112252.GH17061@rabbitmq.com>	<AANLkTi=OzrRYT1Jf9AM37KNKf0WWDTWDdm5Aew0oJhjf@mail.gmail.com>	<4C5AC138.1010706@rabbitmq.com>	<yrv4cwrs5gn59.fsf@dwragg.eng.vmware.com>	<4C5C821C.6010308@jboss.com>	<20100807115017.GA1469@wellquite.org>	<AANLkTimvv7wQv=qqnKtL1-kfw9Ne35MfniDco8xR_UFU@mail.gmail.com>	<4C5DB82A.5080006@rabbitmq.com>	<20100807212527.GF1469@wellquite.org>	<AANLkTinU=3zhjeb8kBO6h0iohC_Sb7_1hkvUw9JXRCzp@mail.gmail.com>	<4C5E872C.4030403@250bpm.com>	<AANLkTikVx8M1Z=B8hMqgBeD5A1jU0EJCHES_S9YnMUn2@mail.gmail.com>
	<AANLkTim8=zMynkXJu6z_fnrL-bJDEgWbCOrsT24Y2r5A@mail.gmail.com>
Message-ID: <4C610528.5060404@250bpm.com>

Alexis Richardson wrote:

> We've often found customers whose requirements include "please break
> the laws of physics, and cure cancer".  I'm sure you know what I mean.
>  If you could advise us on how to best help in such cases, we're all
> ears.
> 
> In the meantime we are stuck in world where "guaranteed" has no fixed
> connotation.

Yes. People tend to have unrealistic expectations.

It kind of reminds me of requirements for "security". Yes, application 
can be made more resistant to attacks, however, "security" is not a 
purely technical issue. It's a technical and _operational_ issue. To 
achieve "security" you have to use good software _and_ introduce a sane 
security policy in your organisation.

Same with guaranteed delivery. While applications can do all kinds of 
tricks to improve reliability at some point you'll have to load the data 
to USB key and ride across the country to deliver it.

So the goal of designing "guaranteed delivery" is twofold IMO. First, 
it's doing all the tweaking of the software necessary to get as much 
nines of reliability as possible. Second, its promoting sane 
organisational patterns (patterns that would prevent message lost or 
duplication).

Let me give a simple example:

1. Messages are confirmed by simple ack. There's no replay 
functionality. This guarantees no duplicates.
2. Sender has a timeout for getting an ack. When the ack does not 
arrive, the message is moved to dead letter queue. (Note that messages 
in the DLQ are "dubious", i.e. they may have been delivered or not, we 
don't know).
3. There's a person in the organisation responsible for the dead letter 
queue. He goes through the queue once a day and tries to find out what's 
the actual state of the dubious messages is (using personal 
conversation, phone, checking the production system etc.) Delivered 
messages can be simply deleted from the DLQ. Lost messages can be 
resubmitted in different ways (doing a new transaction, reading the 
details of the transaction over the phone etc.)

My 2c.
Martin


From alexandru at rabbitmq.com  Tue Aug 10 10:31:42 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 10 Aug 2010 10:31:42 +0100
Subject: [rabbitmq-discuss] New user : Help needed in understanding
 memory usage
In-Reply-To: <5384000.161281398354503.JavaMail.avanti@angrystood-lm>
References: <5980445.141281398145069.JavaMail.avanti@angrystood-lm>
	<5384000.161281398354503.JavaMail.avanti@angrystood-lm>
Message-ID: <20100810092951.GB6255@dakota.vmair.com>

Hi Avanti,

If the memory usage is steadily increasing, you're probably not ack'ing
the messages.

Try running,
% rabbitmqctl list_queues name messages

That should list your queues and tell you how many ready and
unacknowledged there are.  If this number of messages is
steadily increasing, you're not ack'ing properly.

If that's the case, you can either set noAck to true (i.e. messages
don't need to be acknowledged), or explicitly ack them (like you're
doing now); just make sure that that code is being run with the right
arguments.

Cheers,
Alex

On Mon, Aug 09, 2010 at 04:59:15PM -0700, Avanti Nadgir wrote:
> I am experimenting with RabbitMQ on a rhel vm (ver 1.8.1)
> Have started the broker and am able to publish and consume events till the resident memory usage of the broker peaks at about 400M (it keeps growing with the number of messages published even though the consumer is consuming events) After this the broker needs to be restarted to bring back the memory usage to 0 before more messages can be sent.
> 
> Attached is the code snippet of the publisher and consumer.  
> =================================================================
> Publisher :
>                 factory.setHost("localhost");
>                 factory.setPort(5672);
>                 Connection conn = factory.newConnection();
> 
>                 Channel channel = conn.createChannel();
> 
>                 System.out.println("done creating conn");
>                 String exchangeName = "testExchange";
>                 String queueName = "testQueueNew";
>                 String routingKey = "";
>                 channel.exchangeDeclare(exchangeName, "direct", true);
>                 channel.queueDeclare(queueName, true, false, true, null);
>                 channel.queueBind(queueName, exchangeName, routingKey);
> 
>                 byte[] messageBodyBytes = new byte[2000];
>                 for(int j = 0;j<2000;j++) {
>                         messageBodyBytes[j] = 'A';
>                 }
>                 for(int i = 0; i < numMessages; i++) {
>                         channel.basicPublish(exchangeName, routingKey, null, messageBodyBytes);
>                         if(sleepInterval != 0) {
>                                 if (i % sleepInterval == 0) {
>                                         Thread.sleep(timeToSleep);
>                                         System.out.println("Published Message " + i);
>                                 }
>                         }
>                 }
> 
>                 channel.close();
>                 conn.close();
> ==================================================================
> Consumer :
>                 ConnectionFactory factory = new ConnectionFactory();
>                 factory.setHost("localhost");
>                 factory.setPort(5672);
>                 Connection conn = factory.newConnection();
>                 Channel channel = conn.createChannel();
> 
>                 String exchangeName = "testExchange";
>                 String routingKey = "";
>                 String queueName = "testQueue";
>                 channel.exchangeDeclare(exchangeName, "direct", true);
>                 channel.queueBind(queueName, exchangeName, routingKey);
> 
>                 boolean noAck = false;
>                 QueueingConsumer consumer = new QueueingConsumer(channel);
>                 channel.basicConsume(queueName, noAck, consumer);
>                 int count = 0;
>                 while (count < numMessages) {
>                     count++;
>                     QueueingConsumer.Delivery delivery;
>                     try {
>                         delivery = consumer.nextDelivery();
>                     } catch (InterruptedException ie) {
>                         continue;
>                     }
>                     // (process the message components ...)
> 
>                         byte[] body = delivery.getBody();
>                         String resp = new String(body);
>                         channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
>                 }
> 
>                 channel.close();
>                 conn.close();
> 
> ===================================================================================
> Any help is appreciated.
> 
> Thanks,
> Avanti
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ejarendt at gmail.com  Wed Aug 11 00:24:55 2010
From: ejarendt at gmail.com (eric.arendt)
Date: Tue, 10 Aug 2010 16:24:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Strange behavior when accessing properties of a
 delivered message (in Java)
Message-ID: <29403410.post@talk.nabble.com>


Hi,

I'm running RabbitMQ 1.8.1 with the 1.8.1 Java API, and I'm getting some
very strange behavior when I receive messages.  Suppose I do the following:

// This is fine
QueueingConsumer.Delivery delivery = consumer.nextDelivery();
AMQP.BasicProperties properties = delivery.getProperties();

// But when I do this...
properties.getDeliveryMode();

I don't get a null pointer, I don't get any kind of exception.  Rather, the
thread of execution either hangs, or in the case of a threaded application,
restarts (as if this was a "GOTO" statement or something).

My conclusion is that getting the delivery mode of a delivered message in
this manner is not an appropriate thing to do, but I just spent three hours
trying to figure out why doing this caused execution to hang or reset.  It's
the strangest thing.  I fixed the problem by not touching the properties of
a delivered message.

Any ideas?
-- 
View this message in context: http://old.nabble.com/Strange-behavior-when-accessing-properties-of-a-delivered-message-%28in-Java%29-tp29403410p29403410.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From avanti at yahoo-inc.com  Wed Aug 11 00:35:49 2010
From: avanti at yahoo-inc.com (Avanti Nadgir)
Date: Tue, 10 Aug 2010 16:35:49 -0700 (PDT)
Subject: [rabbitmq-discuss] New user : Help needed in understanding
 memory usage
In-Reply-To: <16011579.421281479275929.JavaMail.avanti@angrystood-lm>
Message-ID: <3109874.441281483346382.JavaMail.avanti@angrystood-lm>

Alexandru, 

That was the issue. The ack was not sent after consuming the message to the queues (since i had multiple queues registered against the same routing key). 
Thank you very much for the pointers.

Avanti
----- Original Message -----
From: "Alexandru Scvor?ov" <alexandru at rabbitmq.com>
To: "Avanti Nadgir" <avanti at yahoo-inc.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, August 10, 2010 2:31:42 AM GMT -08:00 US/Canada Pacific
Subject: Re: [rabbitmq-discuss] New user : Help needed in understanding memory usage

Hi Avanti,

If the memory usage is steadily increasing, you're probably not ack'ing
the messages.

Try running,
% rabbitmqctl list_queues name messages

That should list your queues and tell you how many ready and
unacknowledged there are.  If this number of messages is
steadily increasing, you're not ack'ing properly.

If that's the case, you can either set noAck to true (i.e. messages
don't need to be acknowledged), or explicitly ack them (like you're
doing now); just make sure that that code is being run with the right
arguments.

Cheers,
Alex

On Mon, Aug 09, 2010 at 04:59:15PM -0700, Avanti Nadgir wrote:
> I am experimenting with RabbitMQ on a rhel vm (ver 1.8.1)
> Have started the broker and am able to publish and consume events till the resident memory usage of the broker peaks at about 400M (it keeps growing with the number of messages published even though the consumer is consuming events) After this the broker needs to be restarted to bring back the memory usage to 0 before more messages can be sent.
> 
> Attached is the code snippet of the publisher and consumer.  
> =================================================================
> Publisher :
>                 factory.setHost("localhost");
>                 factory.setPort(5672);
>                 Connection conn = factory.newConnection();
> 
>                 Channel channel = conn.createChannel();
> 
>                 System.out.println("done creating conn");
>                 String exchangeName = "testExchange";
>                 String queueName = "testQueueNew";
>                 String routingKey = "";
>                 channel.exchangeDeclare(exchangeName, "direct", true);
>                 channel.queueDeclare(queueName, true, false, true, null);
>                 channel.queueBind(queueName, exchangeName, routingKey);
> 
>                 byte[] messageBodyBytes = new byte[2000];
>                 for(int j = 0;j<2000;j++) {
>                         messageBodyBytes[j] = 'A';
>                 }
>                 for(int i = 0; i < numMessages; i++) {
>                         channel.basicPublish(exchangeName, routingKey, null, messageBodyBytes);
>                         if(sleepInterval != 0) {
>                                 if (i % sleepInterval == 0) {
>                                         Thread.sleep(timeToSleep);
>                                         System.out.println("Published Message " + i);
>                                 }
>                         }
>                 }
> 
>                 channel.close();
>                 conn.close();
> ==================================================================
> Consumer :
>                 ConnectionFactory factory = new ConnectionFactory();
>                 factory.setHost("localhost");
>                 factory.setPort(5672);
>                 Connection conn = factory.newConnection();
>                 Channel channel = conn.createChannel();
> 
>                 String exchangeName = "testExchange";
>                 String routingKey = "";
>                 String queueName = "testQueue";
>                 channel.exchangeDeclare(exchangeName, "direct", true);
>                 channel.queueBind(queueName, exchangeName, routingKey);
> 
>                 boolean noAck = false;
>                 QueueingConsumer consumer = new QueueingConsumer(channel);
>                 channel.basicConsume(queueName, noAck, consumer);
>                 int count = 0;
>                 while (count < numMessages) {
>                     count++;
>                     QueueingConsumer.Delivery delivery;
>                     try {
>                         delivery = consumer.nextDelivery();
>                     } catch (InterruptedException ie) {
>                         continue;
>                     }
>                     // (process the message components ...)
> 
>                         byte[] body = delivery.getBody();
>                         String resp = new String(body);
>                         channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
>                 }
> 
>                 channel.close();
>                 conn.close();
> 
> ===================================================================================
> Any help is appreciated.
> 
> Thanks,
> Avanti
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Wed Aug 11 06:59:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 11 Aug 2010 06:59:07 +0100
Subject: [rabbitmq-discuss] Strange behavior when accessing properties
 of a delivered message (in Java)
In-Reply-To: <29403410.post@talk.nabble.com>
References: <29403410.post@talk.nabble.com>
Message-ID: <4C623C2B.5050708@rabbitmq.com>

Eric,

eric.arendt wrote:
> properties.getDeliveryMode();
> 
> I don't get a null pointer, I don't get any kind of exception.  Rather, the
> thread of execution either hangs, or in the case of a threaded application,
> restarts (as if this was a "GOTO" statement or something).

The underlying implementation looks like this:

         public java.lang.Integer getDeliveryMode() { return deliveryMode; }

So there is nothing peculiar going on there. Unless perhaps the delivery 
mode isn't set at all, in which case the above will return 'null', which 
if you tried to assign to an int would cause things to break.


Regards,

Matthias.

From abhishek.kona at gmail.com  Wed Aug 11 07:14:20 2010
From: abhishek.kona at gmail.com (Abhishek K)
Date: Wed, 11 Aug 2010 11:44:20 +0530
Subject: [rabbitmq-discuss] RabbitMQ not accepting messages after a limit
Message-ID: <AANLkTi=QLrV2nThAaOOEMroRVcZoOf+cU=WK+3t_hNSp@mail.gmail.com>

I am running a RabbitMQ instance and when I push data in the terms of around
3.7 lakh messages the Rabbit stops accepting data and stalls. All queues are
durable and messages are persistant . I am on a 2GB machine.

Rabbit MQ Status
[{running_applications,[{rabbit,"RabbitMQ","1.8.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.14"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.2"},
                        {stdlib,"ERTS  CXC 138 10","1.17"},
                        {kernel,"ERTS  CXC 138 10","2.14"}]},
 {nodes,[{disc,[rabbit at abhishek]}]},
 {running_nodes,[rabbit at abhishek]}]

Listing queues ...
bulk_test       379264
...done.

Is it the default behavior?

Abhishek Kona
Department of Computer Engineering
National Institute of Technology
Karnataka, India
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/e390a31c/attachment.htm>

From matthias at rabbitmq.com  Wed Aug 11 07:18:49 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 11 Aug 2010 07:18:49 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTin_9ZA-DMacYj26Gn9haob08aXNY1NdAb0QaawJ@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>	<20100726151140.GC6839@rabbitmq.com>	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>	<20100728124626.GH554@rabbitmq.com>	<AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>	<20100805164127.GT17061@rabbitmq.com>
	<AANLkTin_9ZA-DMacYj26Gn9haob08aXNY1NdAb0QaawJ@mail.gmail.com>
Message-ID: <4C6240C9.5020702@rabbitmq.com>

Srijanani Srinivasan wrote:
> Please correct me if i am wrong, i believe that currently the messages 
> are in the queue are loaded in the memory, and if they are marked 
> persistent, any time the consumer stops consuming messages or 
> other scenarios the messages are written to the disk and retrieved later 
> when needed.

Not quite. In the old/current persister, messages marked as persistent 
that are sent to durable queues are written to disk straight away 
(except for various buffering stages). They are *also* kept in memory, 
like all messages. Hence with the old persister rabbit requires enough 
memory to hold all messages, persistent or not. By contrast, the new 
persister can page messages to/from disk in response to changing memory 
conditions. This happens regardless of whether the messages are marked 
persistent. So the "new persister" is not just about message 
persistence, but message storage in general. Memory becomes an optional 
extra, though it's quite handy to have some :)

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Aug 11 07:34:14 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 11 Aug 2010 07:34:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ not accepting messages after a limit
In-Reply-To: <AANLkTi=QLrV2nThAaOOEMroRVcZoOf+cU=WK+3t_hNSp@mail.gmail.com>
References: <AANLkTi=QLrV2nThAaOOEMroRVcZoOf+cU=WK+3t_hNSp@mail.gmail.com>
Message-ID: <4C624466.4010004@rabbitmq.com>

Abhishek,

Abhishek K wrote:
> I am running a RabbitMQ instance and when I push data in the terms of 
> around 3.7 lakh messages the Rabbit stops accepting data and stalls. All 
> queues are durable and messages are persistant . I am on a 2GB machine.
> 
> Is it the default behavior?

Yes. All rabbit releases up to the current one require that all messages 
fit into RAM. When memory gets tight, rabbit throttles producers.

The much talked about "new persister", which is scheduled to appear in 
the next rabbit release, removes the memory constraint, allowing rabbit 
to hold as much message data as there is disk space.


Regards,

Matthias.

From jiri at krutil.com  Wed Aug 11 07:41:06 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Wed, 11 Aug 2010 08:41:06 +0200
Subject: [rabbitmq-discuss] Broker accepts self-signed client
 certificate in verify_peer mode
In-Reply-To: <20100805102135.19094860wnfezm2o@webmail.active24.cz>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz>
Message-ID: <20100811084106.55876jocvl9p1mo0@webmail.active24.cz>

Hi

Could anyone help with this issue please?

Any tips or experince would be greatly appreciated.

Many thanks
Jiri


> When experimenting with SSL connections to RabbitMQ, I came across a  
> very strange thing.
>
> The RabbitMQ server is configured to require a client certificate  
> and verify the chain of trust (see rabbitmq.config below). I'm using  
> my own CA that has a self-signed certificate. This is the only  
> trusted root CA certificate I'm using.
>
> RabbitMQ correctly accepts client certificates signed by my CA. But  
> it also accepts self-signed client certificates, which I think is  
> incorrect. I believe a self-signed client certificate should be  
> rejected because there is no chain of trust to the root CA  
> certificate.
>
> I did not find anything helpful in the RabbitMQ logs. Am I doing  
> something wrong?
>
> I'm using RabbitMQ server 1.8.1, Erlang R13B03 and new_ssl 3.10.7.


From abhishek.kona at gmail.com  Wed Aug 11 08:24:37 2010
From: abhishek.kona at gmail.com (Abhishek K)
Date: Wed, 11 Aug 2010 12:54:37 +0530
Subject: [rabbitmq-discuss] Best Way to achieve redundancy
Message-ID: <AANLkTim8BmxtF9a4d2p31PwS=_2LJphMvKheE46yvS8r@mail.gmail.com>

I need to maintain a clone of the RabbitMQ server. If one system goes down
the other system should be containing the data (queues and messages).
Clustering does not seem to solve my problem. What is the best way to do it.


Abhishek Kona
India
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/756bf47c/attachment.htm>

From alexis at rabbitmq.com  Wed Aug 11 08:52:25 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 11 Aug 2010 08:52:25 +0100
Subject: [rabbitmq-discuss] Best Way to achieve redundancy
In-Reply-To: <AANLkTim8BmxtF9a4d2p31PwS=_2LJphMvKheE46yvS8r@mail.gmail.com>
References: <AANLkTim8BmxtF9a4d2p31PwS=_2LJphMvKheE46yvS8r@mail.gmail.com>
Message-ID: <AANLkTi=_zfq_fABJZU2MyXgG=RPYtHK=7pXtCVJQKB+q@mail.gmail.com>

Abhishek,

Have you seen the active/passive HA model described here:
http://www.rabbitmq.com/pacemaker.html

alexis


On Wed, Aug 11, 2010 at 8:24 AM, Abhishek K <abhishek.kona at gmail.com> wrote:
> I need to maintain a clone of the RabbitMQ server. If one system goes down
> the other system should be containing the data (queues and messages).
> Clustering does not seem to solve my problem. What is the best way to do it.
>
>
> Abhishek Kona
> India
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alexandru at rabbitmq.com  Wed Aug 11 09:38:58 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 11 Aug 2010 09:38:58 +0100
Subject: [rabbitmq-discuss] Single point of failure in a clustered
 environment with a durable exchange and durable queues
In-Reply-To: <AEC6A2084B89EA49B99F71108C2E53EB846A47@ign-msg-06.hq.ign.com>
References: <AEC6A2084B89EA49B99F71108C2E53EB846A47@ign-msg-06.hq.ign.com>
Message-ID: <20100811083858.GA3573@dakota.eng.vmware.com>

Hello Vince,

Sorry for the late reply.

> I have an clustered environment with 3 nodes having the following set
> up:
> 
>  
> 
> Exchange name:  TestExchange (1 durable exchange)
> 
> Queues: Q1, Q2, Q3 (3 durable queues)
> 
> Nodes: N1, N2, N3
> 
> Cluster: N2 and N3 are clustered against N1.   
> 

Clustering isn't doing quite what you're expecting it to do.

Because the 3 nodes are clustered, they can see each other's queues,
exchanges and binding.  Moreover, connecting to any one of them gives
you access to all of the queues, exchanges, etc.

> The problem that I have is that N1 is a single point of failure.  When I
> stop RabbitMQ service on N1, all the queues stop working.  Publishers
> can no longer connect to any queues and messages cannot be enqueued.  

But, even when clustered, the queues reside only on the node they were
declared on.  In your case, I'm guessing you connect to node N1 and
declare the 3 queues on it.  Unfortunately, this means that if N1 goes
down, its queues become unusable and the messages on them are
temporarily unavailable (persistent ones are anyway, transient ones are
lost).

Put another way, clustering only makes the nodes' resources logically
available to each other.  It doesn't actually replicate queues across
the cluster.

If you really need to always have access to the messages, you could
try following our HA with Rabbit guide (it's in the documentation
section of the website); this explains how to set up a active/passive
rabbit system.

Hope this helps.

Cheers,
Alex


From abhishek.kona at gmail.com  Wed Aug 11 10:01:40 2010
From: abhishek.kona at gmail.com (Abhishek K)
Date: Wed, 11 Aug 2010 14:31:40 +0530
Subject: [rabbitmq-discuss] Publish and ACK in different channels
Message-ID: <AANLkTininggvcvjdVEk8z=skYKfbf9mgdxrdEeh_J6Yw@mail.gmail.com>

I am using the RabbitMQ Java API.

Channel A does a basicGet, gets message M channel A is closed. AutoAck is
set to false.
Now I need to Ack message M using some other channel (channel B), and do not
want message M to be delivered to some other consumer in the meanwhile. What
can be the best approach to achieve this?

Abhishek Kona
Department of Computer Engineering
National Institute of Technology
Karnataka, India
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/663de9d2/attachment.htm>

From alexandru at rabbitmq.com  Wed Aug 11 10:32:39 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 11 Aug 2010 10:32:39 +0100
Subject: [rabbitmq-discuss] Publish and ACK in different channels
In-Reply-To: <AANLkTininggvcvjdVEk8z=skYKfbf9mgdxrdEeh_J6Yw@mail.gmail.com>
References: <AANLkTininggvcvjdVEk8z=skYKfbf9mgdxrdEeh_J6Yw@mail.gmail.com>
Message-ID: <20100811093239.GB3573@dakota.eng.vmware.com>

If you get a message and close the channel without ack'ing it, the
message will get reinserted into the queue.

If you don't want the message to be reinserted, either you acknowledge
it explicitly, or you get with noAck set to true.

Cheers,
Alex

On Wed, Aug 11, 2010 at 02:31:40PM +0530, Abhishek K wrote:
> I am using the RabbitMQ Java API.
> 
> Channel A does a basicGet, gets message M channel A is closed. AutoAck is
> set to false.
> Now I need to Ack message M using some other channel (channel B), and do not
> want message M to be delivered to some other consumer in the meanwhile. What
> can be the best approach to achieve this?
> 
> Abhishek Kona
> Department of Computer Engineering
> National Institute of Technology
> Karnataka, India

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Wed Aug 11 10:38:22 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Aug 2010 10:38:22 +0100
Subject: [rabbitmq-discuss] Broker accepts self-signed client
 certificate in verify_peer mode
In-Reply-To: <20100811084106.55876jocvl9p1mo0@webmail.active24.cz>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz>
	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>
Message-ID: <4C626F8E.3000007@rabbitmq.com>


Hi Jiri,

On 11/08/10 07:41, jiri at krutil.com wrote:

[...]

>> The RabbitMQ server is configured to require a client certificate and
>> verify the chain of trust (see rabbitmq.config below). I'm using my
>> own CA that has a self-signed certificate. This is the only trusted
>> root CA certificate I'm using.
>>
>> RabbitMQ correctly accepts client certificates signed by my CA. But it
>> also accepts self-signed client certificates, which I think is
>> incorrect. I believe a self-signed client certificate should be
>> rejected because there is no chain of trust to the root CA certificate.

By default an unknown CA will not cause the connection to fail. The
default verify_fun ignores {bad_cert, unknown_ca} errors. You should
provide your own verify_fun that does not ignore {bad_cert, unknown_ca}.

Regards

Emile

From abhishek.kona at gmail.com  Wed Aug 11 10:41:14 2010
From: abhishek.kona at gmail.com (Abhishek K)
Date: Wed, 11 Aug 2010 15:11:14 +0530
Subject: [rabbitmq-discuss] Publish and ACK in different channels
In-Reply-To: <20100811093239.GB3573@dakota.eng.vmware.com>
References: <AANLkTininggvcvjdVEk8z=skYKfbf9mgdxrdEeh_J6Yw@mail.gmail.com> 
	<20100811093239.GB3573@dakota.eng.vmware.com>
Message-ID: <AANLkTikUedypWuYD7zysEuNCib0DREkM0i4v9k1yhy5P@mail.gmail.com>

In my situation
I am using a thrift layer in the middle.
RabbitMQ runs on Machine A, Thrift on Machine B and Client on Machine C.
Thrift is the middle layer, which relays the message to the client.

Now if I have to acknowledge the message I have to keep the channel object
open at the Thrift layer, till the user acknowledges the message.
What can be the best way to do this.

Thanks
Abhishek Kona


On Wed, Aug 11, 2010 at 3:02 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> If you get a message and close the channel without ack'ing it, the
> message will get reinserted into the queue.
>
> If you don't want the message to be reinserted, either you acknowledge
> it explicitly, or you get with noAck set to true.
>
> Cheers,
> Alex
>
> On Wed, Aug 11, 2010 at 02:31:40PM +0530, Abhishek K wrote:
> > I am using the RabbitMQ Java API.
> >
> > Channel A does a basicGet, gets message M channel A is closed. AutoAck is
> > set to false.
> > Now I need to Ack message M using some other channel (channel B), and do
> not
> > want message M to be delivered to some other consumer in the meanwhile.
> What
> > can be the best approach to achieve this?
> >
> > Abhishek Kona
> > Department of Computer Engineering
> > National Institute of Technology
> > Karnataka, India
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/cc21f598/attachment-0001.htm>

From jigar87 at gmail.com  Wed Aug 11 11:04:42 2010
From: jigar87 at gmail.com (jigar sheth)
Date: Wed, 11 Aug 2010 15:34:42 +0530
Subject: [rabbitmq-discuss] Queue Exists or Not
Message-ID: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>

How Can i check whether a particular Queue Exists or not  in C# Api ??
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/5e53433e/attachment.htm>

From alexandru at rabbitmq.com  Wed Aug 11 11:30:28 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 11 Aug 2010 11:30:28 +0100
Subject: [rabbitmq-discuss] Publish and ACK in different channels
In-Reply-To: <AANLkTikUedypWuYD7zysEuNCib0DREkM0i4v9k1yhy5P@mail.gmail.com>
References: <AANLkTininggvcvjdVEk8z=skYKfbf9mgdxrdEeh_J6Yw@mail.gmail.com>
	<20100811093239.GB3573@dakota.eng.vmware.com>
	<AANLkTikUedypWuYD7zysEuNCib0DREkM0i4v9k1yhy5P@mail.gmail.com>
Message-ID: <20100811103028.GC3573@dakota.eng.vmware.com>

I'm not familiar with Thrift, so I cannot really answer.

A simple solution would be to basic.get with noAck set to true.  That
way, messages will be not need to be acknowledged (so they won't get
redelivered).

If you really need the client to be the one ack'ing the message (perhaps
because you sometimes do want the message to be redelivered), I think
you'll have to short-circuit Thrift.

Cheers,
Alex

On Wed, Aug 11, 2010 at 03:11:14PM +0530, Abhishek K wrote:
> In my situation
> I am using a thrift layer in the middle.
> RabbitMQ runs on Machine A, Thrift on Machine B and Client on Machine C.
> Thrift is the middle layer, which relays the message to the client.
> 
> Now if I have to acknowledge the message I have to keep the channel object
> open at the Thrift layer, till the user acknowledges the message.
> What can be the best way to do this.
> 
> Thanks
> Abhishek Kona
> 
> 
> On Wed, Aug 11, 2010 at 3:02 PM, Alexandru Scvor?ov
> <alexandru at rabbitmq.com>wrote:
> 
> > If you get a message and close the channel without ack'ing it, the
> > message will get reinserted into the queue.
> >
> > If you don't want the message to be reinserted, either you acknowledge
> > it explicitly, or you get with noAck set to true.
> >
> > Cheers,
> > Alex
> >
> > On Wed, Aug 11, 2010 at 02:31:40PM +0530, Abhishek K wrote:
> > > I am using the RabbitMQ Java API.
> > >
> > > Channel A does a basicGet, gets message M channel A is closed. AutoAck is
> > > set to false.
> > > Now I need to Ack message M using some other channel (channel B), and do
> > not
> > > want message M to be delivered to some other consumer in the meanwhile.
> > What
> > > can be the best approach to achieve this?
> > >
> > > Abhishek Kona
> > > Department of Computer Engineering
> > > National Institute of Technology
> > > Karnataka, India
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >

From orhan at tart.com.tr  Wed Aug 11 11:39:16 2010
From: orhan at tart.com.tr (Orhan Kavrakoglu)
Date: Wed, 11 Aug 2010 13:39:16 +0300
Subject: [rabbitmq-discuss] Subscribing to a queue regardless of its
 parameters (auto-delete, ack, etc.)
In-Reply-To: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>
References: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>
Message-ID: <4C627DD4.30006@tart.com.tr>

Hi,

I have a client-side library (modified PHP Zend_Queue classes over the 
STOMP adapter) which I use to subscribe to some queues. However, the 
interface provided by the STOMP adapter seems to want the exact 
parameters a queue was created with in order to subscribe to it. (That 
is, if a queue was created with the non-default "auto-delete: false" 
parameter, you have to specify "auto-delete: false" when subscribing to 
it.) This complicates the client code, especially given that the queue 
was created in a Java program somewhere else. Is there a way to work 
around this?

Either a "subscribe regardless of parameters" command or some way to get 
a queue's parameters would work. I haven't checked if libamqp has 
either, because I couldn't find a PHP implementation that works on 
Windows (which half our developers are using).

-- 
Orhan Kavrako?lu
orhan at tart.com.tr

Tart New Media
w : http://www.tart.com.tr
t : +90 212 265 0 666 / ext: 142
f : +90 212 263 93 93
a : Abd?lhak Molla Sok. No:42 Arnavutk?y / ?STANBUL


From alexandru at rabbitmq.com  Wed Aug 11 11:57:45 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 11 Aug 2010 11:57:45 +0100
Subject: [rabbitmq-discuss] Queue Exists or Not
In-Reply-To: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>
References: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>
Message-ID: <20100811105745.GD3573@dakota.eng.vmware.com>

Answered on StackOverflow, ;)
http://stackoverflow.com/questions/3457305/rabbitmq-message-queue-exists-or-not


From alexandru at rabbitmq.com  Wed Aug 11 12:12:21 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 11 Aug 2010 12:12:21 +0100
Subject: [rabbitmq-discuss] Publish and ACK in different channels
In-Reply-To: <AANLkTikcaoOrp7U5uqiSDu_wO-wnQQhN62_byORcVqgC@mail.gmail.com>
References: <AANLkTininggvcvjdVEk8z=skYKfbf9mgdxrdEeh_J6Yw@mail.gmail.com>
	<20100811093239.GB3573@dakota.eng.vmware.com>
	<AANLkTikUedypWuYD7zysEuNCib0DREkM0i4v9k1yhy5P@mail.gmail.com>
	<20100811103028.GC3573@dakota.eng.vmware.com>
	<AANLkTikcaoOrp7U5uqiSDu_wO-wnQQhN62_byORcVqgC@mail.gmail.com>
Message-ID: <20100811111221.GE3573@dakota.eng.vmware.com>

Hi Vivek,

> So, I have my RabbitMQ running on machine A, and I give a API to Consumers
> who are operating on machine C. So, the user just calls a get method without
> knowing the details of RabbitMQ. My API, which apparently runs on Machine B,
> does all the back side job of opening a channel and getting the message.
> 
> Is there a way I can implement acknowledgment?
> 
> It appears to me that if I retrieved a message M through channel C, I have
> to acknowledge message M through Channel C only. So does my API needs to
> keep the channel open till the user gives back an acknowledgment? Or is
> there a better ( and cleaner ? ) way out?

The way AMQP works is that it re-enqueues unack'd messages on channel
close.  If you close the channel, there's no point in ack'ing the
messages; they're already on some queue waiting to be delivered to some
consumer (possibly, the same one).

What you could do, is auto-ack the messages when the middle layer gets
them.  Then, if a client says it doesn't want the message (the
equivalent of not sending an ack), the middle layer republishes the
message.  This may not be possible in your setup and will cause all
sorts of other problems.

Cheers,
Alex

From aaron at agoragames.com  Wed Aug 11 12:23:42 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 11 Aug 2010 07:23:42 -0400
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <4C6240C9.5020702@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
	<20100726151140.GC6839@rabbitmq.com>
	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
	<20100728124626.GH554@rabbitmq.com>
	<AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>
	<20100805164127.GT17061@rabbitmq.com>
	<AANLkTin_9ZA-DMacYj26Gn9haob08aXNY1NdAb0QaawJ@mail.gmail.com>
	<4C6240C9.5020702@rabbitmq.com>
Message-ID: <AANLkTimVew+nWWAOwEQNgxkJOTGVL2LfgzzBbtZbJ707@mail.gmail.com>

Matthias,

I can't begin tell you how fantastic it is to hear that.  Is Rabbit
using mmap for those files to take advantage of kernel caching and
paging?

-Aaron


On Wed, Aug 11, 2010 at 2:18 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
>
> Not quite. In the old/current persister, messages marked as persistent that
> are sent to durable queues are written to disk straight away (except for
> various buffering stages). They are *also* kept in memory, like all
> messages. Hence with the old persister rabbit requires enough memory to hold
> all messages, persistent or not. By contrast, the new persister can page
> messages to/from disk in response to changing memory conditions. This
> happens regardless of whether the messages are marked persistent. So the
> "new persister" is not just about message persistence, but message storage
> in general. Memory becomes an optional extra, though it's quite handy to
> have some :)
>
> Regards,
>
> Matthias.


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From nishtiak at mail.ua  Wed Aug 11 12:57:27 2010
From: nishtiak at mail.ua (Alexandr F. Boyko)
Date: Wed, 11 Aug 2010 14:57:27 +0300
Subject: [rabbitmq-discuss] Error: invalid command
Message-ID: <201008111457.28155.nishtiak@mail.ua>

Hello!


I succesfully installed rabbitmq 1.8.0 from ports on  FreeBSD 8.0. But when I 
tried to configure it I got such errors:

[rabbitmq at static /usr/home/alex]$ rabbitmqctl add_user celery celery
Error: invalid command 'add_user celery celery'

[rabbitmq at static /usr/home/alex]$ rabbitmqctl add_vhost abnew
Error: invalid command 'add_vhost abnew'

But "readonly" commands are working:
[rabbitmq at static /usr/home/alex]$ rabbitmqctl status
Status of node rabbit at static ...
[{running_applications,[{rabbit,"RabbitMQ","1.8.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.13"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9"},
                        {stdlib,"ERTS  CXC 138 10","1.16.5"},
                        {kernel,"ERTS  CXC 138 10","2.13.5"}]},
 {nodes,[rabbit at static]},
 {running_nodes,[rabbit at static]}]
...done.

[rabbitmq at static /usr/home/alex]$ rabbitmqctl list_users
Listing users ...
guest
...done.

[rabbitmq at static /usr/home/alex]$ rabbitmqctl list_vhosts
Listing vhosts ...
/
...done.


What is wrong? I'm totally confused. Help me, please.

From nishtiak at mail.ua  Wed Aug 11 13:12:54 2010
From: nishtiak at mail.ua (=?UTF-8?B?0JDQu9C10LrRgdCw0L3QtNGAINCR0L7QudC60L4=?=)
Date: Wed, 11 Aug 2010 15:12:54 +0300
Subject: [rabbitmq-discuss] =?utf-8?q?Error=3A_invalid_command?=
Message-ID: <1281528774.8fd015.19237@mail.ua>

Hello!


I succesfully installed rabbitmq 1.8.0 from ports on  FreeBSD 8.0. But when I 
tried to configure it I got such errors:

[rabbitmq at static /usr/home/alex]$ rabbitmqctl add_user celery celery
Error: invalid command 'add_user celery celery'

[rabbitmq at static /usr/home/alex]$ rabbitmqctl add_vhost abnew
Error: invalid command 'add_vhost abnew'

But "readonly" commands are working:
[rabbitmq at static /usr/home/alex]$ rabbitmqctl status
Status of node rabbit at static ...
[{running_applications,[{rabbit,"RabbitMQ","1.8.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.13"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9"},
                        {stdlib,"ERTS  CXC 138 10","1.16.5"},
                        {kernel,"ERTS  CXC 138 10","2.13.5"}]},
 {nodes,[rabbit at static]},
 {running_nodes,[rabbit at static]}]
...done.

[rabbitmq at static /usr/home/alex]$ rabbitmqctl list_users
Listing users ...
guest
...done.

[rabbitmq at static /usr/home/alex]$ rabbitmqctl list_vhosts
Listing vhosts ...
/
...done.


What is wrong? I'm totally confused. Help me, please.

From iver at mupublishing.com  Wed Aug 11 13:10:07 2010
From: iver at mupublishing.com (Iver Odin Kvello)
Date: Wed, 11 Aug 2010 12:10:07 +0000 (UTC)
Subject: [rabbitmq-discuss] No period allowed in queue name in rabbit
	1.8.0?
References: <AANLkTikASR9cBzSXvrG7KaLuij4Xzrc6oAdoCs2mr9We@mail.gmail.com>
Message-ID: <loom.20100811T140403-948@post.gmane.org>

Nicol?s C?sar <nico at ...> writes:

> ??? (class_id, method_id))amqplib.client_0_8.exceptions.AMQPChannelException:
(404, u"NOT_FOUND - no queue 'st.test-o.com_q' in vhost '/'", (50, 10),
'Channel.queue_declare')----------------------I've changed st.test-o.com_q? to?
st_test-o_com_q and had no problem... periods are not allowed in queue names
now? Nico C?sarhttp://blog.nicocesar.com
> 

We just had the same problem, which apparently was due to having some residues
of the old (durable) queues from the previous install present; in particular,
when using

   rabbitmqctl list_bindings

the old queues were visible, whereas 

   rabbitmqctl list_queues

showed no queues present. It was then possible to declare new queues, but not
queues with the same name as the ones that existed before.

The problem was fixable by 
   rabbitmqctl stop_app
   rabbitmqctl reset
   rabbitmqctl start_app

after which the old bindings were gone and the queueus could be declared again.

Regards,
Iver Odin Kvello
 




From matthew at rabbitmq.com  Wed Aug 11 13:17:06 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 11 Aug 2010 13:17:06 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTimVew+nWWAOwEQNgxkJOTGVL2LfgzzBbtZbJ707@mail.gmail.com>
References: <AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
	<20100726151140.GC6839@rabbitmq.com>
	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
	<20100728124626.GH554@rabbitmq.com>
	<AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>
	<20100805164127.GT17061@rabbitmq.com>
	<AANLkTin_9ZA-DMacYj26Gn9haob08aXNY1NdAb0QaawJ@mail.gmail.com>
	<4C6240C9.5020702@rabbitmq.com>
	<AANLkTimVew+nWWAOwEQNgxkJOTGVL2LfgzzBbtZbJ707@mail.gmail.com>
Message-ID: <20100811121706.GT29106@rabbitmq.com>

Hi Aoron,

On Wed, Aug 11, 2010 at 07:23:42AM -0400, Aaron Westendorf wrote:
> I can't begin tell you how fantastic it is to hear that.  Is Rabbit
> using mmap for those files to take advantage of kernel caching and
> paging?

Sadly, no: Erlang does not expose an mmap interface, though actually
there has been a recent thread on erlang-questions about how to
implement this. However, we do do very aggressive caching and work hard
to make as much use of kernel disk buffers as possible: we try to play
nice with the kernel. With a little tuning, we can easily saturate disk
write bandwidth, so it seems we're doing something right ;)

Matthew

From davegreggory at yahoo.com  Wed Aug 11 14:17:40 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 11 Aug 2010 09:17:40 -0400
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <20100805213800.GB3413@dakota>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
	<AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
	<20100805213800.GB3413@dakota>
Message-ID: <59CCC341-3A68-4C0D-8C7C-686FE1E0AAD6@yahoo.com>

I'm a little concerned regarding what happens when a node that contains a certain queue in a cluster goes down. 

On Aug 5, 2010, at 5:38 PM, Alexandru Scvortov <alexandru at rabbitmq.com> wrote:

> If you declare a queue Q1 on node A with queue.declare, then Q1 will
> reside on node A.  If node A goes down, all the messages on its queues
> (including Q1) will become inaccessible.  If Q1 was declared as durable,
> then the messages published as persistent on it will become available
> when node A comes back online.
> 
> In a cluster, when a node goes down, its queues become inaccesbile.
> They are *not* automatically created on other nodes.

I'm using the java client (1.8.1) and I automatically reconnect my producers/consumers to another node when a node goes down. I do this by    setting up a shutdown listener hook on the connection.

When a node with a queue goes down, can I write something using the java client that re-declares all known queues on the other node. May be have all the queue names(and params) registered somewhere in the app and upon reconnect, passively re-declare them. If passive declaration throws an exception, catch that and do an actual declaration. Would that work?

If that works, then what happens if we bring up the node that went down that had the queue originally? Would it play nice?

I'd like to find a solution without resorting to using the pacemaker approach.

This is important not just for node failures but for other things as upgrading or reconfiguring rabbit without affecting any clients. (our rabbits sit behind a round-robin load balancer). 

From emile at rabbitmq.com  Wed Aug 11 14:47:45 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Aug 2010 14:47:45 +0100
Subject: [rabbitmq-discuss] Error: invalid command
In-Reply-To: <1281528774.8fd015.19237@mail.ua>
References: <1281528774.8fd015.19237@mail.ua>
Message-ID: <4C62AA01.2030702@rabbitmq.com>


Hi ?????????,

On 11/08/10 13:12, ????????? ????? wrote:
> Hello!
> 
> 
> I succesfully installed rabbitmq 1.8.0 from ports on  FreeBSD 8.0. But when I 
> tried to configure it I got such errors:
> 
> [rabbitmq at static /usr/home/alex]$ rabbitmqctl add_user celery celery
> Error: invalid command 'add_user celery celery'

Which shell are you using? The reason why read-only commands appear to
work is because they have no additional parameters. I've seen something
similar while using tcsh. The problem is that the parameters are not
being split correctly. Do you get the same error when using bash?


Regards

Emile

From msteele at beringmedia.com  Wed Aug 11 14:59:07 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Wed, 11 Aug 2010 09:59:07 -0400
Subject: [rabbitmq-discuss] Broker accepts self-signed client
	certificate in verify_peer mode
In-Reply-To: <4C626F8E.3000007@rabbitmq.com>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz> 
	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>
	<4C626F8E.3000007@rabbitmq.com>
Message-ID: <AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com>

Care to expand how how one would do this? I've encountered similar issues.

Basically, what I'm looking for is that if the client cert isn't signed by a
CA in the CA file that I'm pointing rabbit to, it should fail (which is what
the default behavior should be). This was also kind of implied in the rabbit
doc, even though it doesn't seem to work as advertised.

See the "Trust the Client's Root CA" section of the Rabbit SSL howto
documentation.

Also, if you do know how to do this, explain it as if you were dealing with
an Erlang novice :)

Cheers,

Mark Steele
Director of development
Bering Media Inc.



On Wed, Aug 11, 2010 at 5:38 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Jiri,
>
> On 11/08/10 07:41, jiri at krutil.com wrote:
>
> [...]
>
> >> The RabbitMQ server is configured to require a client certificate and
> >> verify the chain of trust (see rabbitmq.config below). I'm using my
> >> own CA that has a self-signed certificate. This is the only trusted
> >> root CA certificate I'm using.
> >>
> >> RabbitMQ correctly accepts client certificates signed by my CA. But it
> >> also accepts self-signed client certificates, which I think is
> >> incorrect. I believe a self-signed client certificate should be
> >> rejected because there is no chain of trust to the root CA certificate.
>
> By default an unknown CA will not cause the connection to fail. The
> default verify_fun ignores {bad_cert, unknown_ca} errors. You should
> provide your own verify_fun that does not ignore {bad_cert, unknown_ca}.
>
> Regards
>
> Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/bbbd6654/attachment.htm>

From davegreggory at yahoo.com  Wed Aug 11 15:01:20 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 11 Aug 2010 10:01:20 -0400
Subject: [rabbitmq-discuss] RabbitMQ - live upgrade
Message-ID: <B6FF1263-7C50-4058-94E6-44DF70723E6F@yahoo.com>

I'm curious as to how we can perform a live upgrade of clustered rabbitmq setup, like when you release the new persister :-) 

Our rabbit nodes sit behind a load balancer and client will connect through this load balancer to another node if the connection is lost. 

We have two nodes in the cluster and they can talk to each other directly (obviously). They're both 1.8.1 and say we want to upgrade them one at a time to 1.new version without affecting clients. If we take down 1 node out of the load balancer then clients will connect to the other node when they detect the connection loss. Now we can shutdown this first node and upgrade it.

Will we lose any of the persisted messages in the downed node due to the new persister and/or mnesia differences?

when we bring up the newly upgraded node, it will attempt to cluster itself with the still up second node with old version? Can only very bad things happen in this situation?

Other than being very quick on the trigger finger and downing the second node as we're bringing up the first node, are there any other solutions?

Or will the new version just not work without having to upgrade client API (java) and restsrting clients?

From matthew at rabbitmq.com  Wed Aug 11 15:11:13 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 11 Aug 2010 15:11:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ - live upgrade
In-Reply-To: <B6FF1263-7C50-4058-94E6-44DF70723E6F@yahoo.com>
References: <B6FF1263-7C50-4058-94E6-44DF70723E6F@yahoo.com>
Message-ID: <20100811141112.GU29106@rabbitmq.com>

Hi Dave,

On Wed, Aug 11, 2010 at 10:01:20AM -0400, Dave Greggory wrote:
> We have two nodes in the cluster and they can talk to each other
> directly (obviously). They're both 1.8.1 and say we want to upgrade
> them one at a time to 1.new version without affecting clients. If we
> take down 1 node out of the load balancer then clients will connect to
> the other node when they detect the connection loss. Now we can
> shutdown this first node and upgrade it.

That would work, but obviously any queues that are declared on the node
that is now down will be unavailable.

> Will we lose any of the persisted messages in the downed node due to
> the new persister and/or mnesia differences?

Yes. You will lose all persisted messages. And all declared queues,
exchanges, bindings, vhosts and users.

> when we bring up the newly upgraded node, it will attempt to cluster
> itself with the still up second node with old version? Can only very
> bad things happen in this situation?

Hmmm, I'm not sure if it will try to recluster. If it does, it'll
certainly fail. You can not cluster between rabbit with different
versions of rabbit (well, actually, you probably can sometimes, but the
outcome is undefined at best). Don't do this.

> Other than being very quick on the trigger finger and downing the
> second node as we're bringing up the first node, are there any other
> solutions?

Yes, build a new cluster, then switch your producers over to the new
cluster (where they must create new queues, exchanges etc etc). Have
your consumers continue to drain the old cluster, and then when the old
cluster is empty, switch the consumers to the new cluster.

> Or will the new version just not work without having to upgrade client
> API (java) and restsrting clients?

There is no requirement to touch your clients. The on-the-wire AMQP
protocol has not changed. There have been changes and likely
improvements to the clients but I don't believe there should be any
problems with 1.8.1 clients connecting to the next released version of
the RabbitMQ broker.

Matthew

From nishtiak at mail.ua  Wed Aug 11 15:46:08 2010
From: nishtiak at mail.ua (=?UTF-8?B?0J7Qu9C10LrRgdCw0L3QtNGAINCR0L7QudC60L4=?=)
Date: Wed, 11 Aug 2010 17:46:08 +0300
Subject: [rabbitmq-discuss] =?utf-8?q?Error=3A_invalid_command?=
In-Reply-To: <4C62AA01.2030702.rabbitmq.com>
References: <4C62AA01.2030702.rabbitmq.com>
Message-ID: <1281537968.feDCF5317.13533@mail.ua>


>  Which shell are you using? The reason why read-only
>  commands appear to
>  work is because they have no additional parameters. I've
>  seen something
>  similar while using tcsh. The problem is that the
>  parameters are not
>  being split correctly. Do you get the same error when
>  using bash?
>
>Regards

>Emile

Thank you.

I use bash. I already tried do same with /bin/sh and /bin/tcsh with same result.

From emile at rabbitmq.com  Wed Aug 11 16:15:10 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Aug 2010 16:15:10 +0100
Subject: [rabbitmq-discuss] Broker accepts self-signed client
 certificate in verify_peer mode
In-Reply-To: <AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz>
	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>
	<4C626F8E.3000007@rabbitmq.com>
	<AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com>
Message-ID: <4C62BE7E.6030306@rabbitmq.com>

On 11/08/10 14:59, Mark Steele wrote:
> Care to expand how how one would do this? I've encountered similar issues.
> 
> Basically, what I'm looking for is that if the client cert isn't signed
> by a CA in the CA file that I'm pointing rabbit to, it should fail
> (which is what the default behavior should be). This was also kind of
> implied in the rabbit doc, even though it doesn't seem to work as
> advertised.

Hi Mark,

I don't see any way of doing this using configuration options alone.
Unless I'm overlooking a more obvious route, you will need to recompile
the Erlang ssl module or the Rabbit networking module. I would suggest
the latter.

Adding the following tuple to SslOpts in rabbit_networking:boot_ssl/0
works for me using erlang R13B03 and R14A:
{verify_fun, fun(ErrorList) -> length(ErrorList) == 0 end}
With this in place the server will reject a client presenting a
certificate not signed by a recognised CA.

I agree that this should be easier. Please let me know if you have
suggestions.


Regards

Emile

From ejarendt at gmail.com  Wed Aug 11 16:16:43 2010
From: ejarendt at gmail.com (eric.arendt)
Date: Wed, 11 Aug 2010 08:16:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Strange behavior when accessing properties
 of a delivered message (in Java)
In-Reply-To: <4C623C2B.5050708@rabbitmq.com>
References: <29403410.post@talk.nabble.com> <4C623C2B.5050708@rabbitmq.com>
Message-ID: <29409405.post@talk.nabble.com>


Thanks for the quick reply!  Turns out someone wrote the equivalent of this
in a class I was using:

while (true) {
  try {
    // get next delivery
    // process next delivery
  } catch (Exception e) {
    continue;
  }
}

:thinking:

Thanks for your help!

 - Eric


Matthias Radestock-3 wrote:
> 
> Eric,
> 
> eric.arendt wrote:
>> properties.getDeliveryMode();
>> 
>> I don't get a null pointer, I don't get any kind of exception.  Rather,
>> the
>> thread of execution either hangs, or in the case of a threaded
>> application,
>> restarts (as if this was a "GOTO" statement or something).
> 
> The underlying implementation looks like this:
> 
>          public java.lang.Integer getDeliveryMode() { return deliveryMode;
> }
> 
> So there is nothing peculiar going on there. Unless perhaps the delivery 
> mode isn't set at all, in which case the above will return 'null', which 
> if you tried to assign to an int would cause things to break.
> 
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Strange-behavior-when-accessing-properties-of-a-delivered-message-%28in-Java%29-tp29403410p29409405.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Wed Aug 11 16:26:02 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 11 Aug 2010 16:26:02 +0100
Subject: [rabbitmq-discuss] Using Clustering with Amazon EC2
In-Reply-To: <9EA0415A-427F-4D55-AC67-509182C928DD@brightscope.com>
References: <9EA0415A-427F-4D55-AC67-509182C928DD@brightscope.com>
Message-ID: <AANLkTik0E3oAFgkOfKY0CXvOgpGswPa9y6Fxi_e-MVkY@mail.gmail.com>

David,

On Mon, Aug 9, 2010 at 18:30, David Allison <david at brightscope.com> wrote:
> I was hoping someone could discuss experiences they've had with using RabbitMQ clustering (as described in?http://www.rabbitmq.com/clustering.html ) on Amazon EC2. ?We currently only run one queue broker, and were considering using clustering to increase reliability and availability of the queues.

Clustering is not a reliability/availability mechanism. Sorry.
It should be only used to achieve a greater scalability, and can bring
benefit only for some group of use cases.

If you want availability, please consult our Pacemaker guide:
http://www.rabbitmq.com/pacemaker.html

Leaving that aside, did you have any particular issues with clustering on EC2?
Have you configured the firewall between hosts properly?

> Also, because the queues are currently not replicated, if a node goes down that contains a queue, is that queue immediately inaccessible, or are its contents (messages) ?just lost, but clients could potentially still write to the same queue name on another broker in the cluster?

No. If a node that holds a queue goes down bad things will happen.

Marek

From msteele at beringmedia.com  Wed Aug 11 16:59:00 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Wed, 11 Aug 2010 11:59:00 -0400
Subject: [rabbitmq-discuss] Broker accepts self-signed client
	certificate in verify_peer mode
In-Reply-To: <4C62BE7E.6030306@rabbitmq.com>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz> 
	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>
	<4C626F8E.3000007@rabbitmq.com> 
	<AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com> 
	<4C62BE7E.6030306@rabbitmq.com>
Message-ID: <AANLkTikNF+UvE=1vK2qZigmyfoq9zrFWjuetF50ssNUm@mail.gmail.com>

It's great that you've sent a solution, but it's not very pretty. As it is,
I would consider SSL functionality broken and would put a big warning on the
SSL howto page.

I'll probably make a custom ebuild for gentoo with a patch, however most
folks are using binary packages and will probably have issue with this
solution.

Care to post a unified diff?

Thanks,

Mark Steele
Director of development
Bering Media Inc.



On Wed, Aug 11, 2010 at 11:15 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 11/08/10 14:59, Mark Steele wrote:
> > Care to expand how how one would do this? I've encountered similar
> issues.
> >
> > Basically, what I'm looking for is that if the client cert isn't signed
> > by a CA in the CA file that I'm pointing rabbit to, it should fail
> > (which is what the default behavior should be). This was also kind of
> > implied in the rabbit doc, even though it doesn't seem to work as
> > advertised.
>
> Hi Mark,
>
> I don't see any way of doing this using configuration options alone.
> Unless I'm overlooking a more obvious route, you will need to recompile
> the Erlang ssl module or the Rabbit networking module. I would suggest
> the latter.
>
> Adding the following tuple to SslOpts in rabbit_networking:boot_ssl/0
> works for me using erlang R13B03 and R14A:
> {verify_fun, fun(ErrorList) -> length(ErrorList) == 0 end}
> With this in place the server will reject a client presenting a
> certificate not signed by a recognised CA.
>
> I agree that this should be easier. Please let me know if you have
> suggestions.
>
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/fc3daba6/attachment.htm>

From majek04 at gmail.com  Wed Aug 11 17:11:29 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 11 Aug 2010 17:11:29 +0100
Subject: [rabbitmq-discuss] Node scheduling with RabbitMQ
In-Reply-To: <AANLkTi=QYUWuwV1pZy+8HEuJN=RB3j1Pqe=V5zrL7twk@mail.gmail.com>
References: <AANLkTimtWEm0oN=iqyK23KQ2jFWredu22TtrEdk6iU3_@mail.gmail.com>
	<9BC6CEAE-37E5-4BE1-A20B-9136A10539BE@opera.com>
	<3A98A0E9-B7FD-434A-BC06-8BDC0E37A9AE@opera.com>
	<AANLkTi=QYUWuwV1pZy+8HEuJN=RB3j1Pqe=V5zrL7twk@mail.gmail.com>
Message-ID: <AANLkTimw62J8_CoDdA0pwWAp-Sw-AwMQq-N8z_M7OUF0@mail.gmail.com>

Hi Pete,

On Mon, Aug 9, 2010 at 03:55, Pete Hunt <floydophone at gmail.com> wrote:
> I was considering writing an x-script exchange for RabbitMQ and
> creating one queue per worker to dump messages in; this is a feasible
> way to go, right?

Well, the question about data locality is pretty tricky to answer.
First. If you have fixed number of workers, than you can just create
two queues for every worker. One queue with requests for 'data to be
prefetched',
another one with real task requests.

But it's more common that you don't know in advance how many workers
will be needed. In such case, I'm sorry, but if doing a task requires
downloading data, than well, it requires downloading data.
If a task is two-stage, and I'm afraid you can't do much
about it. Maybe running more than one worker on a single host, to make
sure that CPU is always saturated, even if another task is busy with
downloading?

> The exchange could probably handle data locality,
> however, what happens when a worker dies with messages sitting on the
> queue?

In AMQP every message needs to be acknowledged before it's removed from
the server. If your worker received a message, and died without acking it,
the message will simply be redelivered to another worker.

> I also am relatively new to the non-Amazon SQS message queuing world,
> so I guess that this becomes less a question of how to do proper data
> locality and more about how to do reliability with RabbitMQ. On SQS,
> due to the visibility timeout semantics I am assured that if I design
> idempotent tasks they will eventually occur even if there is a node
> failure.

Yes, instead of timeouts AMQP/RabbitMQ uses explicit acknowledgments.

> Right now, the solution that makes the most sense to me is to have a
> single consumer that farms the tasks out to the worker nodes, however,
> this means that I need to build reliability capabilities like
> visibility timeouts into the consumer rather than relying on a battle
> tested piece of software like RabbitMQ. Is there some sort of
> functionality in RabbitMQ that accounts for this? Am I missing an
> important piece of documentation somewhere?

Look at the basic.consume examples, see how the acknowledgments are done.
For example:
http://github.com/tonyg/pika/blob/master/examples/demo_receive.py#L74

You also will be interested in the 'qos' command. For example
http://github.com/majek/pika/blob/master/examples/demo_channel_flow_asyncore.py#L55

Cheers,
   Marek

From majek04 at gmail.com  Wed Aug 11 17:41:25 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 11 Aug 2010 17:41:25 +0100
Subject: [rabbitmq-discuss] JSONRPCError - Internal error: badmatch
In-Reply-To: <ae4193ec-03e9-483e-bc9b-11a972308313@v15g2000yqe.googlegroups.com>
References: <AANLkTik+dSh0JKZJzWRVSF1e_PzQeXRYB0g+s48Ww=yH@mail.gmail.com>
	<4C5B3CA2.3040200@rabbitmq.com>
	<ae4193ec-03e9-483e-bc9b-11a972308313@v15g2000yqe.googlegroups.com>
Message-ID: <AANLkTi=bRxcYEOemY+oyW2JxSJWBZJm97+Ji5Wzao95S@mail.gmail.com>

Cameron,

It appears that rabbitmq-jsonrpc-channel had outdated signature for
basic.consume. We've fixed that in the default branch.

Could you try again, and let us know if the new code works better?

Cheers,
  Marek


On Fri, Aug 6, 2010 at 17:05, Cameron Harris <cameron at cameronharris.org> wrote:
> I was running 1.8.1...
>
> Anyway, I've reinstalled now, on Ubuntu Linux 10.04 this time. I built
> everything from the umbrella.
>
> Now I'm getting a different problem on the examples:
>
> test_main
> {"installGenericProxy":{"name":"open","idempotent":false,"params":
> [{"name":"username","type":"str"},{"name":"password","type":"str"},
> {"name":"sessionTimeout","type":"num"},
> {"name":"virtualHost","type":"str"}]}}
> open
> {"installGenericProxy":{"name":"poll","idempotent":false,"params":[]}}
> {"installGenericProxy":{"name":"close","idempotent":false,"params":
> []}}
> {"installGenericProxy":{"name":"call","idempotent":false,"params":
> [{"name":"method","type":"str"},{"name":"args","type":"arr"}]}}
> {"installGenericProxy":{"name":"cast","idempotent":false,"params":
> [{"name":"method","type":"str"},{"name":"args","type":"arr"},
> {"name":"content","type":"str"},{"name":"props","type":"arr"}]}}
> handle_channel_ready
> {"q2":"test-queue-1b"}
> {"q1":"test-queue-1a"}
> JsonRPC error:
> Service: "/rpc/8DCB5AAAE542E25A84F64EE11A1398E1"
> Method: "call"
> Params: ["basic.consume",[0,"test-queue-1a","aa-cons-
> tag1",false,false,false,false]]
> Response: {"version":"1.1","id":8,"error":
> {"name":"JSONRPCError","code":500,"message":"Internal
> error","error":"{noproc,
> ? ?{gen_server,call,
> ? ? ? ?[<0.875.0>,
> ? ? ? ? {jsonrpc,<<\"call\">>,
> ? ? ? ? ? ? {obj,
> ? ? ? ? ? ? ? ? [{\"http_method\",<<\"POST\">>},
> ? ? ? ? ? ? ? ? ?{\"http_query_parameters\",{obj,[]}},
> ? ? ? ? ? ? ? ? ?{\"http_headers\",
> ? ? ? ? ? ? ? ? ? {obj,
> ? ? ? ? ? ? ? ? ? ? ? [{\"accept\",<<\"*/*\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"accept-charset\",
> ? ? ? ? ? ? ? ? ? ? ? ? <<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"accept-encoding\",<<\"gzip, deflate\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"accept-language\",<<\"en-us,en;q=0.5\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"cache-control\",<<\"no-cache\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"connection\",<<\"keep-alive\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"content-length\",<<\"126\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"content-type\",<<\"application/json;
> charset=UTF-8\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"host\",<<\"vmrab1:55672\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"keep-alive\",<<\"115\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"pragma\",<<\"no-cache\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"referer\",
> ? ? ? ? ? ? ? ? ? ? ? ? <<\"http://vmrab1:55672/rabbitmq_lib/www-
> examples/test/index.html\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"user-agent\",
> ? ? ? ? ? ? ? ? ? ? ? ? <<\"Mozilla/5.0 (Windows; Windows NT 6.1;
> WOW64; rv:2.0b3pre) Gecko/20100801 Minefield/4.0b3pre ( .NET CLR
> 3.5.30729; .NET4.0E)\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"x-json-rpc-timeout\",<<\"5000\">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{\"x-requested-with\",<<\"XMLHttpRequest
> \">>}]}},
> ? ? ? ? ? ? ? ? ?{\"remote_peername\",<<\"172.20.5.26\">>},
> ? ? ? ? ? ? ? ? ?{\"scheme\",<<\"http\">>}]},
> ? ? ? ? ? ? [<<\"basic.consume\">>,
> ? ? ? ? ? ? ?[0,<<\"test-queue-1a\">>,<<\"aa-cons-
> tag1\">>,false,false,false,
> ? ? ? ? ? ? ? false]]},
> ? ? ? ? 5000]}}"}}
> JsonRPC error:
> Service: "/rpc/8DCB5AAAE542E25A84F64EE11A1398E1"
> Method: "call"
> Params: ["basic.consume",[0,"test-
> queue-1b","",false,false,false,false]]
> Response: {"version":"1.1","id":7,"error":
> {"name":"JSONRPCError","code":500,"message":"AMQP error","error":
> {"code":"command_invalid","text":"unimplemented
> method","method":"basic.consume"}}}
>
>
>
> "unimplemented method"?
> My rabbitmqctl status is:
> Status of node rabbit at vmrab1 ...
> [{running_applications,
> ? ? [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
> ? ? ?{rabbit,"RabbitMQ","%%VSN%%"},
> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.4"},
> ? ? ?{sasl,"SASL ?CXC 138 11","2.1.8"},
> ? ? ?{rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
> ? ? ?{rfc4627_jsonrpc,"JSON RPC Service","0.01"},
> ? ? ?{rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
> ? ? ?{mochiweb,"MochiMedia Web Server","1.3"},
> ? ? ?{crypto,"CRYPTO version 1","1.6.3"},
> ? ? ?{inets,"INETS ?CXC 138 49","5.2"},
> ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.4.12"},
> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.16.4"},
> ? ? ?{kernel,"ERTS ?CXC 138 10","2.13.4"}]},
> ?{nodes,[{disc,[rabbit at vmrab1]}]},
> ?{running_nodes,[rabbit at vmrab1]}]
> ...done.
>
>
> The queues are being created, however:
>
> $ scripts/rabbitmqctl list_queues
> Listing queues ...
> test-queue-1b ? 0
> amq.gen-CDzvGz+lPWtoz5uOQz1wMA== ? ? ? ?0
> test-queue-1a ? 0
> amq.gen-VKcoc8C1V6yxQ2f2Nj/sEg== ? ? ? ?0
> ...done.
>
>
> Also, not sure if I'm doing something wrong, but to get to the example
> pages, I have to copy them from priv/www-examples to priv/www then
> access them using the URL /rabbitmq_lib/www-examples. This happened on
> both Ubuntu and OS X. The paths in the README just return 404 Not
> Found.
>
> Thanks,
> Cameron
>
> On Aug 5, 11:35?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
>> Hi Cameron.
>>
>> I think you're trying to use a too-new version of
>> rabbitmq-jsonrpc-channel. I haven't tested, but I think revision
>> 0a920cb5180b is more likely to work with RabbitMQ 1.8.1. Or you could
>> build the server from default as well as the plugins.
>>
>> Cheers, Simon
>>
>> On 04/08/10 16:06, Cameron Harris wrote:
>>
>>
>>
>>
>>
>> > Hi all,
>>
>> > I've installed rabbitmq on OS X 10.6 via MacPorts, and built and
>> > installed the rabbitmq-jsonrpc, rabbitmq-jsonrpc-channel, mochiweb,
>> > rabbitmq-mochiweb, rfc4627_jsonrpc plugins.
>>
>> > After installing, I went to the example page on localhost:55672, and
>> > clicked the Simple JSONRPC test. I get the following output:
>>
>> > test_main
>> > {"installGenericProxy":{"name":"open","idempotent":false,"params":
>> > [{"name":"username","type":"str"},{"name":"password","type":"str"},
>> > {"name":"sessionTimeout","type":"num"},
>> > {"name":"virtualHost","type":"str"}]}}
>> > open
>> > JsonRPC error:
>> > Service: "/rpc/rabbitmq"
>> > Method: "open"
>> > Params: ["guest","guest",5,null]
>> > Response: {"version":"1.1","id":2,"error":
>> > {"name":"JSONRPCError","code":500,"message":"Internal
>> > error","error":"{{{badmatch,{error,{{badmatch,<0.13932.0>},
>> > ? ? ? ? ? ? ? ? ? ? [{rabbit_jsonrpc_channel,init,1},
>> > ? ? ? ? ? ? ? ? ? ? ?{gen_server,init_it,6},
>> > ? ? ? ? ? ? ? ? ? ? ?{proc_lib,init_p_do_apply,3}]}}},
>> > ? [{rabbit_jsonrpc_channel,open,1},
>> > ? ?{rabbit_jsonrpc_channel_factory,handle_call,3},
>> > ? ?{gen_server,handle_msg,5},
>> > ? ?{proc_lib,init_p_do_apply,3}]},
>> > ? {gen_server,call,
>> > ? ? ? ? ? ? ?[<0.8986.0>,
>> > ? ? ? ? ? ? ? {jsonrpc,<<\"open\">>,
>> > ? ? ? ? ? ? ? ? ? ? ? ?{obj,[{\"http_method\",<<\"POST\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{\"http_query_parameters\",{obj,[]}},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{\"http_headers\",
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {obj,[{\"accept\",<<\"*/*\">>},
>>
>> > {\"accept-charset\",<<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
>>
>> > {\"accept-encoding\",<<\"gzip,deflate\">>},
>>
>> > {\"accept-language\",<<\"en-us,en;q=0.5\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"cache-control\",<<\"no-cache\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"connection\",<<\"keep-alive\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"content-length\",<<\"74\">>},
>>
>> > {\"content-type\",<<\"application/json;charset=UTF-8\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"host\",<<\"localhost:55672\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"keep-alive\",<<\"115\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"pragma\",<<\"no-cache\">>},
>>
>> > {\"referer\",<<\"http://localhost:55672/rabbitmq_lib/www-examples/test/index.html\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"user-agent\",<<\"Mozilla/5.0
>> > (Macintosh; IntelMac OS X 10.6; rv:2.0b3pre) Gecko/20100729
>> > Minefield/4.0b3pre\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {\"x-json-rpc-timeout\",<<\"30000\">>},
>>
>> > {\"x-requested-with\",<<\"XMLHttpRequest\">>}]}},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{\"remote_peername\",<<\"127.0.0.1\">>},
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{\"scheme\",<<\"http\">>}]},
>> > ? ? ? ? ? ? ? ? ? ? ? ?[<<\"guest\">>,<<\"guest\">>,5,null]},
>> > ? ? ? ? ? ? ? 30000]}}"}}
>> > -------
>>
>> > The broker has started without any errors and appears to be
>> > functioning, and when I tried the rabbitmq-status plugin, that worked
>> > fine.
>>
>> > My rabbitmqctl status is:
>> > Status of node rabbit at Bilbo ...
>> > [{running_applications,
>> > ? ? ?[{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
>> > ? ? ? {rabbit,"RabbitMQ","1.8.1"},
>> > ? ? ? {os_mon,"CPO ?CXC 138 46","2.2.5"},
>> > ? ? ? {sasl,"SASL ?CXC 138 11","2.1.9.2"},
>> > ? ? ? {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>> > ? ? ? {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
>> > ? ? ? {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>> > ? ? ? {mochiweb,"MochiMedia Web Server","1.3"},
>> > ? ? ? {crypto,"CRYPTO version 2","2.0"},
>> > ? ? ? {inets,"INETS ?CXC 138 49","5.4"},
>> > ? ? ? {mnesia,"MNESIA ?CXC 138 12","4.4.14"},
>> > ? ? ? {stdlib,"ERTS ?CXC 138 10","1.17"},
>> > ? ? ? {kernel,"ERTS ?CXC 138 10","2.14"}]},
>> > ? {nodes,[{disc,[rabbit at Bilbo]}]},
>> > ? {running_nodes,[rabbit at Bilbo]}]
>> > ...done.
>>
>> > Thanks,
>> > Cameron
>>
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-disc... at lists.rabbitmq.com
>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jiri at krutil.com  Wed Aug 11 18:04:31 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Wed, 11 Aug 2010 19:04:31 +0200
Subject: [rabbitmq-discuss] Broker accepts self-signed client
 certificate in verify_peer mode
In-Reply-To: <AANLkTikNF+UvE=1vK2qZigmyfoq9zrFWjuetF50ssNUm@mail.gmail.com>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz>
	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>
	<4C626F8E.3000007@rabbitmq.com>
	<AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com>
	<4C62BE7E.6030306@rabbitmq.com>
	<AANLkTikNF+UvE=1vK2qZigmyfoq9zrFWjuetF50ssNUm@mail.gmail.com>
Message-ID: <20100811190431.89194ae463fxnri8@webmail.active24.cz>

I also believe that the default behaviour should be to reject client  
certs signed by an untrusted CA. I found the current functionality  
quite surprising and potentially dangerous.

Any chance of changing this in the "official" distribution of RabbitMQ?

Cheers
Jiri

> It's great that you've sent a solution, but it's not very pretty. As it is,
> I would consider SSL functionality broken and would put a big warning on the
> SSL howto page.


From matthew at rabbitmq.com  Wed Aug 11 18:07:38 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 11 Aug 2010 18:07:38 +0100
Subject: [rabbitmq-discuss] Broker accepts self-signed client
 certificate in verify_peer mode
In-Reply-To: <20100811190431.89194ae463fxnri8@webmail.active24.cz>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz>
	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>
	<4C626F8E.3000007@rabbitmq.com>
	<AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com>
	<4C62BE7E.6030306@rabbitmq.com>
	<AANLkTikNF+UvE=1vK2qZigmyfoq9zrFWjuetF50ssNUm@mail.gmail.com>
	<20100811190431.89194ae463fxnri8@webmail.active24.cz>
Message-ID: <20100811170738.GV29106@rabbitmq.com>

On Wed, Aug 11, 2010 at 07:04:31PM +0200, jiri at krutil.com wrote:
> I also believe that the default behaviour should be to reject client
> certs signed by an untrusted CA. I found the current functionality
> quite surprising and potentially dangerous.

Yes. I assure you this was not the behaviour of Erlang when I wrote the
SSL guide. Unfortunately, a fix is not going to happen in time for the
next release, but we're going to chase the Erlang SSL module authors to
see if there's any reason for this behaviour, and I hope will change it
either in their code or ours. I agree with you that with verify_peer on,
the broker *must not* blindly trust *any* certs without being able to
establish a chain of trust to the presented cert.

Matthew

From archanasayshi at gmail.com  Wed Aug 11 19:13:47 2010
From: archanasayshi at gmail.com (archana v)
Date: Wed, 11 Aug 2010 14:13:47 -0400
Subject: [rabbitmq-discuss] Modifying a message in the queue
Message-ID: <AANLkTin3dd1e+9aK+C_VaJ4XXYAkvmKX3g+sY4wu4k90@mail.gmail.com>

Hi All,

I am a newbie to rabbitMQ. Is it possible to modify a message in the queue
with a java client.if yes,please let me know how.
Thanks in advance.


Thanks and Regards,
Archana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/7fcc354b/attachment.htm>

From lists at zopyx.com  Wed Aug 11 19:36:29 2010
From: lists at zopyx.com (Andreas Jung)
Date: Wed, 11 Aug 2010 20:36:29 +0200
Subject: [rabbitmq-discuss] Modifying a message in the queue
In-Reply-To: <AANLkTin3dd1e+9aK+C_VaJ4XXYAkvmKX3g+sY4wu4k90@mail.gmail.com>
References: <AANLkTin3dd1e+9aK+C_VaJ4XXYAkvmKX3g+sY4wu4k90@mail.gmail.com>
Message-ID: <4C62EDAD.1050205@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

archana v wrote:
> Hi All,
> 
> I am a newbie to rabbitMQ. Is it possible to modify a message in the
> queue with a java client.if yes,please let me know how.
> Thanks in advance.
> 

A queue is not a database.
What do you want to modify and why? Usecase?

- -aj
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkxi7a0ACgkQCJIWIbr9KYxL1QCgl53v0F/DH4bAybq3+tdoHhf0
z50AnA71Qfqd8i1lqncFdv7M/AsRHWHq
=nUM0
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100811/7f901a26/attachment.vcf>

From alexis at rabbitmq.com  Wed Aug 11 20:38:04 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 11 Aug 2010 20:38:04 +0100
Subject: [rabbitmq-discuss] Modifying a message in the queue
In-Reply-To: <4C62EDAD.1050205@zopyx.com>
References: <AANLkTin3dd1e+9aK+C_VaJ4XXYAkvmKX3g+sY4wu4k90@mail.gmail.com>
	<4C62EDAD.1050205@zopyx.com>
Message-ID: <AANLkTinexCqwH0xEPqR-8b-BxKTiGP7kAw8dpb3hjfgt@mail.gmail.com>

Archana

Unfortunately it is not possible to do that without removing a message
from the queue, and then republishing it.

The reason for this, as Andreas hints, is that 'update in place' is a
database type operation.  It's tempting to think of messaging as being
about the manipulation of resources using, among other things,
idempotent operations on data that has a persistent identity (eg
primary key).  But, we think messaging is much more about managing
'streams' or if you prefer, 'flows' of data, where managing timelike
behaviour is an implicit concern.

Attempts have been made to reconcile these views but it's *hard* to do
so in a way that preserves decent performance and scalability.  In
some ways the new breed of 'nosql' stores are attempts to do so, by
imposing less structure on stored data so that it can be viewed in a
'streamlike' or at least 'spacelike' way.  See Redis queues for
example.

As Andreas suggests, spelling out your use case would help members of
the list to suggest a way forward for you.

I hope this helps.

alexis



On Wed, Aug 11, 2010 at 7:36 PM, Andreas Jung <lists at zopyx.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> archana v wrote:
>> Hi All,
>>
>> I am a newbie to rabbitMQ. Is it possible to modify a message in the
>> queue with a java client.if yes,please let me know how.
>> Thanks in advance.
>>
>
> A queue is not a database.
> What do you want to modify and why? Usecase?
>
> - -aj
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (Darwin)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
> iEYEARECAAYFAkxi7a0ACgkQCJIWIbr9KYxL1QCgl53v0F/DH4bAybq3+tdoHhf0
> z50AnA71Qfqd8i1lqncFdv7M/AsRHWHq
> =nUM0
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From list.rabbit at calidris.co.uk  Wed Aug 11 21:28:37 2010
From: list.rabbit at calidris.co.uk (Tim Sawyer)
Date: Wed, 11 Aug 2010 21:28:37 +0100
Subject: [rabbitmq-discuss] Can't connect on Windows
Message-ID: <4C6307F5.1050507@calidris.co.uk>

I have a Flex application with a Java backend.  The Java backend is 
putting messages onto a RabbitMQ exchange and the Flex client is picking 
them up using http://github.com/0x6e6562/as3-amqp.  This works as 
expected when the RabbitMQ server is running on Fedora.  When I run up 
RabbitMQ 1.7.2 locally on windows and try and run the entire application 
stack on windows, (AMQP Server = localhost) the app tells me it can?t 
connect.

I?m running 
http://github.com/dansimpson/amqp-js/tree/master/policy-server/ on both 
the fedora box and the windows box, and I can see they are both being 
queried at the correct time for the crossdomain file.  The cross domain 
file is the default from that repository, I haven?t changed it.

However, the error I?m getting is:

Error #2044: Unhandled connectionError:. text=Connection failed
                 at org.amqp::Connection()
                 at Dashboard/setupAmqpConnection()
                 at flash.events::EventDispatcher/dispatchEventFunction()
                 at flash.events::EventDispatcher/dispatchEvent()
                 at 
mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::dispatchRpcEvent()
                 at 
mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::resultHandler()
                 at mx.rpc::Responder/result()
                 at mx.rpc::AsyncRequest/acknowledge()
                 at DirectHTTPMessageResponder/completeHandler()
                 at flash.events::EventDispatcher/dispatchEventFunction()
                 at flash.events::EventDispatcher/dispatchEvent()
                 at flash.net::URLLoader/onComplete()

followed by

Error #2044: Unhandled securityError:. text=Error #2048: Security 
sandbox violation: http://localhost:8224/Dashboard/Dashboard.swf cannot 
load data from auk:5672.
                 at org.amqp::Connection()
                 at Dashboard/setupAmqpConnection()
                 at flash.events::EventDispatcher/dispatchEventFunction()
                 at flash.events::EventDispatcher/dispatchEvent()
                 at 
mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::dispatchRpcEvent()
                 at 
mx.rpc::AbstractInvoker/http://www.adobe.com/2006/flex/mx/internal::resultHandler()
                 at mx.rpc::Responder/result()
                 at mx.rpc::AsyncRequest/acknowledge()
                 at DirectHTTPMessageResponder/completeHandler()
                 at flash.events::EventDispatcher/dispatchEventFunction()
                 at flash.events::EventDispatcher/dispatchEvent()
                 at flash.net::URLLoader/onComplete()

rabbitmqctl status on Fedora gives:

Status of node rabbit at nightjar ...
[{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
                         {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                         {os_mon,"CPO  CXC 138 46","2.1.8"},
                         {sasl,"SASL  CXC 138 11","2.1.5.4"},
                         {stdlib,"ERTS  CXC 138 10","1.15.5"},
                         {kernel,"ERTS  CXC 138 10","2.12.5"}]},
  {nodes,[rabbit at nightjar]},
  {running_nodes,[rabbit at nightjar]}]
...done.

The same on windows gives:

Status of node rabbit at auk ...
[{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
                         {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                         {os_mon,"CPO  CXC 138 46","2.2.4"},
                         {sasl,"SASL  CXC 138 11","2.1.8"},
                         {stdlib,"ERTS  CXC 138 10","1.16.4"},
                         {kernel,"ERTS  CXC 138 10","2.13.4"}]},
  {nodes,[rabbit at auk]},
  {running_nodes,[rabbit at auk]}]

Rabbit.log contains

=INFO REPORT==== 11-Aug-2010::15:55:13 ===
accepted TCP connection on 0.0.0.0:5672 from 192.168.128.144:52353

=INFO REPORT==== 11-Aug-2010::15:55:13 ===
starting TCP connection <0.19740.0> from 192.168.128.144:52353

=WARNING REPORT==== 11-Aug-2010::15:55:46 ===
exception on TCP connection <0.19740.0> from 192.168.128.144:52353
connection_closed_abruptly

=INFO REPORT==== 11-Aug-2010::15:55:46 ===
closing TCP connection <0.19740.0> from 192.168.128.144:52353

where that is my local ip address

Can someone give me an inkling of where to start looking for a solution?

Cheers,

Tim.



From tonyg at rabbitmq.com  Wed Aug 11 21:47:12 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Wed, 11 Aug 2010 16:47:12 -0400
Subject: [rabbitmq-discuss] Can't connect on Windows
In-Reply-To: <4C6307F5.1050507@calidris.co.uk>
References: <4C6307F5.1050507@calidris.co.uk>
Message-ID: <4C630C50.5090401@rabbitmq.com>

Tim Sawyer wrote:
> Can someone give me an inkling of where to start looking for a solution?

Looks like a Flash cross-domain policy problem to my inexpert eye. Are you
connecting to "localhost" or "auk"? Flash is picky about where it lets you open
sockets to, IIRC. I'm absolutely no expert in any of this :-) but you might
find some guidance in http://kb2.adobe.com/cps/142/tn_14213.html.

Regards,
  Tony



From desrie.qi at wealthcraft.com  Thu Aug 12 03:06:20 2010
From: desrie.qi at wealthcraft.com (Desrie Qi)
Date: Thu, 12 Aug 2010 10:06:20 +0800
Subject: [rabbitmq-discuss] RabbitMQ Clustering in Windows Server
In-Reply-To: <201008111457.28155.nishtiak@mail.ua>
References: <201008111457.28155.nishtiak@mail.ua>
Message-ID: <8F16BDCC98E64841857E711110AF5EDD01630FE62075@EXMBX01.wealthcraft.local>

Hello,

We run RabbitMQ as windows service. Does anyone cluster RabbitMQ service in Windows server? 

Should we cluster two RabbitMQ nodes following two steps bellow or either one is OK?

Step 1) Join two nodes in a cluster by RabbitMQ command: rabbitmqctl
	.....
	.....
	@rabbit2\\C:\RabbitMQ_server-1.8.1\sbin> rabbitmqctl cluster rabbit at rabbit1
	Clustering node rabbit at rabbit2 with [rabbit at rabbit1] ...done.
	......
	......

Step 2) cluster two RabbitMQ service using Windows clustering manager.

Thanks
Desrie

From david at rabbitmq.com  Thu Aug 12 05:43:00 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 12 Aug 2010 05:43:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ Clustering in Windows Server
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDD01630FE62075@EXMBX01.wealthcraft.local>
	(Desrie Qi's message of "Thu, 12 Aug 2010 10:06:20 +0800")
References: <201008111457.28155.nishtiak@mail.ua>
	<8F16BDCC98E64841857E711110AF5EDD01630FE62075@EXMBX01.wealthcraft.local>
Message-ID: <yrv4cfwykqw4r.fsf@dwragg.eng.vmware.com>

Hi Desrie,

Desrie Qi <desrie.qi at wealthcraft.com> writes:
> We run RabbitMQ as windows service. Does anyone cluster RabbitMQ service in Windows server? 
>
> Should we cluster two RabbitMQ nodes following two steps bellow or either one is OK?
>
> Step 1) Join two nodes in a cluster by RabbitMQ command: rabbitmqctl
> 	.....
> 	.....
> 	@rabbit2\\C:\RabbitMQ_server-1.8.1\sbin> rabbitmqctl cluster rabbit at rabbit1
> 	Clustering node rabbit at rabbit2 with [rabbit at rabbit1] ...done.
> 	......
> 	......
>
> Step 2) cluster two RabbitMQ service using Windows clustering manager.

I'm not sure what the "Windows clustering manager" you refer to is.  But
the instructions for clustering at
<http://www.rabbitmq.com/clustering.html> should apply on Windows,
including in the case where you run the nodes as Windows services.  Is
there a specific problem you are having when trying to get this working?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jiri at krutil.com  Thu Aug 12 07:31:52 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Thu, 12 Aug 2010 08:31:52 +0200
Subject: [rabbitmq-discuss] Broker accepts self-signed client
 certificate in verify_peer mode
In-Reply-To: <20100811170738.GV29106@rabbitmq.com>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz>
	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>
	<4C626F8E.3000007@rabbitmq.com>
	<AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com>
	<4C62BE7E.6030306@rabbitmq.com>
	<AANLkTikNF+UvE=1vK2qZigmyfoq9zrFWjuetF50ssNUm@mail.gmail.com>
	<20100811190431.89194ae463fxnri8@webmail.active24.cz>
	<20100811170738.GV29106@rabbitmq.com>
Message-ID: <20100812083152.11144cemudqf0vac@webmail.active24.cz>

> Yes. I assure you this was not the behaviour of Erlang when I wrote the
> SSL guide. Unfortunately, a fix is not going to happen in time for the
> next release, but we're going to chase the Erlang SSL module authors to
> see if there's any reason for this behaviour, and I hope will change it
> either in their code or ours. I agree with you that with verify_peer on,
> the broker *must not* blindly trust *any* certs without being able to
> establish a chain of trust to the presented cert.

Hi Matthew,

thanks for clarifying this.

Do you have a publicly accessible bug tracking system where we could  
follow this issue and see when is it resolved?

Cheers
Jiri


From emile at rabbitmq.com  Thu Aug 12 10:02:08 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 12 Aug 2010 10:02:08 +0100
Subject: [rabbitmq-discuss] Broker accepts self-signed client
 certificate in verify_peer mode
In-Reply-To: <20100812083152.11144cemudqf0vac@webmail.active24.cz>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz>	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>	<4C626F8E.3000007@rabbitmq.com>	<AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com>	<4C62BE7E.6030306@rabbitmq.com>	<AANLkTikNF+UvE=1vK2qZigmyfoq9zrFWjuetF50ssNUm@mail.gmail.com>	<20100811190431.89194ae463fxnri8@webmail.active24.cz>	<20100811170738.GV29106@rabbitmq.com>
	<20100812083152.11144cemudqf0vac@webmail.active24.cz>
Message-ID: <4C63B890.2090208@rabbitmq.com>


Hi Jiri,

On 12/08/10 07:31, jiri at krutil.com wrote:
>> Yes. I assure you this was not the behaviour of Erlang when I wrote the
>> SSL guide. Unfortunately, a fix is not going to happen in time for the
>> next release, but we're going to chase the Erlang SSL module authors to
>> see if there's any reason for this behaviour, and I hope will change it
>> either in their code or ours. I agree with you that with verify_peer on,
>> the broker *must not* blindly trust *any* certs without being able to
>> establish a chain of trust to the presented cert.
> 
> Hi Matthew,
> 
> thanks for clarifying this.
> 
> Do you have a publicly accessible bug tracking system where we could
> follow this issue and see when is it resolved?

We don't have a public bug tracker, but I have started a conversation on
the erlang-questions mailing list which you can follow. Development
effort that follows from that (if any) will take place on a branch of
the rabbitmq-server mercurial repository named 'bug23017'.

Regards

Emile

From cameron at cameronharris.org  Thu Aug 12 11:27:24 2010
From: cameron at cameronharris.org (Cameron Harris)
Date: Thu, 12 Aug 2010 11:27:24 +0100
Subject: [rabbitmq-discuss] JSONRPCError - Internal error: badmatch
In-Reply-To: <AANLkTi=bRxcYEOemY+oyW2JxSJWBZJm97+Ji5Wzao95S@mail.gmail.com>
References: <AANLkTik+dSh0JKZJzWRVSF1e_PzQeXRYB0g+s48Ww=yH@mail.gmail.com>
	<4C5B3CA2.3040200@rabbitmq.com>
	<ae4193ec-03e9-483e-bc9b-11a972308313@v15g2000yqe.googlegroups.com>
	<AANLkTi=bRxcYEOemY+oyW2JxSJWBZJm97+Ji5Wzao95S@mail.gmail.com>
Message-ID: <AANLkTinQ1j-Ce9bxT8f+gi-ACKuyi2=DzcyXL8uyshSk@mail.gmail.com>

Hi Marek,

That has fixed the issue when building from scratch, thanks.

However, we would like to get it working in 1.8.1 if possible. I've tried
checking out the revision of rabbitmq-jsonrpc-channel that Simon suggested
most likely to work with 1.8.1 (0a920cb5180b) and loaded it into the 1.8.1
release version of rabbitmq, along with the head versions of
rfc4627_jsonrpc, rabbit_jsonrpc, rabbit_mochiweb, mochiweb. Unfortunately
this gives me the error I reported in my first post.

I tried building rabbitmq-server tag 1.8.1, but I got errors relating to
what files were available in rabbit-codegen, and rabbit-codegen only has a
1.8.0 tag. Many of the other plugins aren't tagged for 1.8.1, so is using
the head version of those likely to cause a problem? Most of the comments on
the commits also reference bug numbers.. is there a public bug tracker
anywhere so that I can work out what the commits are for?


On a more interesting, related note: is there any way of writing javascript
that runs on a seperate webserver that connects to the rabbitmq-server's
json-rpc? I'm guessing either you could use JSONP, or in standards compliant
browsers, you'd need to use CORS/XHR2, and IE would need to use
XDomainRequest (which needs support in the javascript lib doesn't it?). Has
this issue been considered yet? To do CORS and JSONP would both require
support in the web server, wouldn't they?

Thanks,
Cameron Harris


On 11 August 2010 17:41, Marek Majkowski <majek04 at gmail.com> wrote:

> Cameron,
>
> It appears that rabbitmq-jsonrpc-channel had outdated signature for
> basic.consume. We've fixed that in the default branch.
>
> Could you try again, and let us know if the new code works better?
>
> Cheers,
>  Marek
>
>
> On Fri, Aug 6, 2010 at 17:05, Cameron Harris <cameron at cameronharris.org>
> wrote:
> > I was running 1.8.1...
> >
> > Anyway, I've reinstalled now, on Ubuntu Linux 10.04 this time. I built
> > everything from the umbrella.
> >
> > Now I'm getting a different problem on the examples:
> >
> > test_main
> > {"installGenericProxy":{"name":"open","idempotent":false,"params":
> > [{"name":"username","type":"str"},{"name":"password","type":"str"},
> > {"name":"sessionTimeout","type":"num"},
> > {"name":"virtualHost","type":"str"}]}}
> > open
> > {"installGenericProxy":{"name":"poll","idempotent":false,"params":[]}}
> > {"installGenericProxy":{"name":"close","idempotent":false,"params":
> > []}}
> > {"installGenericProxy":{"name":"call","idempotent":false,"params":
> > [{"name":"method","type":"str"},{"name":"args","type":"arr"}]}}
> > {"installGenericProxy":{"name":"cast","idempotent":false,"params":
> > [{"name":"method","type":"str"},{"name":"args","type":"arr"},
> > {"name":"content","type":"str"},{"name":"props","type":"arr"}]}}
> > handle_channel_ready
> > {"q2":"test-queue-1b"}
> > {"q1":"test-queue-1a"}
> > JsonRPC error:
> > Service: "/rpc/8DCB5AAAE542E25A84F64EE11A1398E1"
> > Method: "call"
> > Params: ["basic.consume",[0,"test-queue-1a","aa-cons-
> > tag1",false,false,false,false]]
> > Response: {"version":"1.1","id":8,"error":
> > {"name":"JSONRPCError","code":500,"message":"Internal
> > error","error":"{noproc,
> >    {gen_server,call,
> >        [<0.875.0>,
> >         {jsonrpc,<<\"call\">>,
> >             {obj,
> >                 [{\"http_method\",<<\"POST\">>},
> >                  {\"http_query_parameters\",{obj,[]}},
> >                  {\"http_headers\",
> >                   {obj,
> >                       [{\"accept\",<<\"*/*\">>},
> >                        {\"accept-charset\",
> >                         <<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
> >                        {\"accept-encoding\",<<\"gzip, deflate\">>},
> >                        {\"accept-language\",<<\"en-us,en;q=0.5\">>},
> >                        {\"cache-control\",<<\"no-cache\">>},
> >                        {\"connection\",<<\"keep-alive\">>},
> >                        {\"content-length\",<<\"126\">>},
> >                        {\"content-type\",<<\"application/json;
> > charset=UTF-8\">>},
> >                        {\"host\",<<\"vmrab1:55672\">>},
> >                        {\"keep-alive\",<<\"115\">>},
> >                        {\"pragma\",<<\"no-cache\">>},
> >                        {\"referer\",
> >                         <<\"http://vmrab1:55672/rabbitmq_lib/www-
> > examples/test/index.html\">>},
> >                        {\"user-agent\",
> >                         <<\"Mozilla/5.0 (Windows; Windows NT 6.1;
> > WOW64; rv:2.0b3pre) Gecko/20100801 Minefield/4.0b3pre ( .NET CLR
> > 3.5.30729; .NET4.0E)\">>},
> >                        {\"x-json-rpc-timeout\",<<\"5000\">>},
> >                        {\"x-requested-with\",<<\"XMLHttpRequest
> > \">>}]}},
> >                  {\"remote_peername\",<<\"172.20.5.26\">>},
> >                  {\"scheme\",<<\"http\">>}]},
> >             [<<\"basic.consume\">>,
> >              [0,<<\"test-queue-1a\">>,<<\"aa-cons-
> > tag1\">>,false,false,false,
> >               false]]},
> >         5000]}}"}}
> > JsonRPC error:
> > Service: "/rpc/8DCB5AAAE542E25A84F64EE11A1398E1"
> > Method: "call"
> > Params: ["basic.consume",[0,"test-
> > queue-1b","",false,false,false,false]]
> > Response: {"version":"1.1","id":7,"error":
> > {"name":"JSONRPCError","code":500,"message":"AMQP error","error":
> > {"code":"command_invalid","text":"unimplemented
> > method","method":"basic.consume"}}}
> >
> >
> >
> > "unimplemented method"?
> > My rabbitmqctl status is:
> > Status of node rabbit at vmrab1 ...
> > [{running_applications,
> >     [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
> >      {rabbit,"RabbitMQ","%%VSN%%"},
> >      {os_mon,"CPO  CXC 138 46","2.2.4"},
> >      {sasl,"SASL  CXC 138 11","2.1.8"},
> >      {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
> >      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
> >      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
> >      {mochiweb,"MochiMedia Web Server","1.3"},
> >      {crypto,"CRYPTO version 1","1.6.3"},
> >      {inets,"INETS  CXC 138 49","5.2"},
> >      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
> >      {stdlib,"ERTS  CXC 138 10","1.16.4"},
> >      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
> >  {nodes,[{disc,[rabbit at vmrab1]}]},
> >  {running_nodes,[rabbit at vmrab1]}]
> > ...done.
> >
> >
> > The queues are being created, however:
> >
> > $ scripts/rabbitmqctl list_queues
> > Listing queues ...
> > test-queue-1b   0
> > amq.gen-CDzvGz+lPWtoz5uOQz1wMA==        0
> > test-queue-1a   0
> > amq.gen-VKcoc8C1V6yxQ2f2Nj/sEg==        0
> > ...done.
> >
> >
> > Also, not sure if I'm doing something wrong, but to get to the example
> > pages, I have to copy them from priv/www-examples to priv/www then
> > access them using the URL /rabbitmq_lib/www-examples. This happened on
> > both Ubuntu and OS X. The paths in the README just return 404 Not
> > Found.
> >
> > Thanks,
> > Cameron
> >
> > On Aug 5, 11:35 pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> >> Hi Cameron.
> >>
> >> I think you're trying to use a too-new version of
> >> rabbitmq-jsonrpc-channel. I haven't tested, but I think revision
> >> 0a920cb5180b is more likely to work with RabbitMQ 1.8.1. Or you could
> >> build the server from default as well as the plugins.
> >>
> >> Cheers, Simon
> >>
> >> On 04/08/10 16:06, Cameron Harris wrote:
> >>
> >>
> >>
> >>
> >>
> >> > Hi all,
> >>
> >> > I've installed rabbitmq on OS X 10.6 via MacPorts, and built and
> >> > installed the rabbitmq-jsonrpc, rabbitmq-jsonrpc-channel, mochiweb,
> >> > rabbitmq-mochiweb, rfc4627_jsonrpc plugins.
> >>
> >> > After installing, I went to the example page on localhost:55672, and
> >> > clicked the Simple JSONRPC test. I get the following output:
> >>
> >> > test_main
> >> > {"installGenericProxy":{"name":"open","idempotent":false,"params":
> >> > [{"name":"username","type":"str"},{"name":"password","type":"str"},
> >> > {"name":"sessionTimeout","type":"num"},
> >> > {"name":"virtualHost","type":"str"}]}}
> >> > open
> >> > JsonRPC error:
> >> > Service: "/rpc/rabbitmq"
> >> > Method: "open"
> >> > Params: ["guest","guest",5,null]
> >> > Response: {"version":"1.1","id":2,"error":
> >> > {"name":"JSONRPCError","code":500,"message":"Internal
> >> > error","error":"{{{badmatch,{error,{{badmatch,<0.13932.0>},
> >> >                     [{rabbit_jsonrpc_channel,init,1},
> >> >                      {gen_server,init_it,6},
> >> >                      {proc_lib,init_p_do_apply,3}]}}},
> >> >   [{rabbit_jsonrpc_channel,open,1},
> >> >    {rabbit_jsonrpc_channel_factory,handle_call,3},
> >> >    {gen_server,handle_msg,5},
> >> >    {proc_lib,init_p_do_apply,3}]},
> >> >   {gen_server,call,
> >> >              [<0.8986.0>,
> >> >               {jsonrpc,<<\"open\">>,
> >> >                        {obj,[{\"http_method\",<<\"POST\">>},
> >> >                              {\"http_query_parameters\",{obj,[]}},
> >> >                              {\"http_headers\",
> >> >                               {obj,[{\"accept\",<<\"*/*\">>},
> >>
> >> > {\"accept-charset\",<<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
> >>
> >> > {\"accept-encoding\",<<\"gzip,deflate\">>},
> >>
> >> > {\"accept-language\",<<\"en-us,en;q=0.5\">>},
> >> >
> {\"cache-control\",<<\"no-cache\">>},
> >> >
> {\"connection\",<<\"keep-alive\">>},
> >> >                                     {\"content-length\",<<\"74\">>},
> >>
> >> > {\"content-type\",<<\"application/json;charset=UTF-8\">>},
> >> >
> {\"host\",<<\"localhost:55672\">>},
> >> >                                     {\"keep-alive\",<<\"115\">>},
> >> >                                     {\"pragma\",<<\"no-cache\">>},
> >>
> >> > {\"referer\",<<\"
> http://localhost:55672/rabbitmq_lib/www-examples/test/index.html\<http://localhost:55672/rabbitmq_lib/www-examples/test/index.html%5C>
> ">>},
> >> >                                     {\"user-agent\",<<\"Mozilla/5.0
> >> > (Macintosh; IntelMac OS X 10.6; rv:2.0b3pre) Gecko/20100729
> >> > Minefield/4.0b3pre\">>},
> >> >
> {\"x-json-rpc-timeout\",<<\"30000\">>},
> >>
> >> > {\"x-requested-with\",<<\"XMLHttpRequest\">>}]}},
> >> >                              {\"remote_peername\",<<\"127.0.0.1\">>},
> >> >                              {\"scheme\",<<\"http\">>}]},
> >> >                        [<<\"guest\">>,<<\"guest\">>,5,null]},
> >> >               30000]}}"}}
> >> > -------
> >>
> >> > The broker has started without any errors and appears to be
> >> > functioning, and when I tried the rabbitmq-status plugin, that worked
> >> > fine.
> >>
> >> > My rabbitmqctl status is:
> >> > Status of node rabbit at Bilbo ...
> >> > [{running_applications,
> >> >      [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
> >> >       {rabbit,"RabbitMQ","1.8.1"},
> >> >       {os_mon,"CPO  CXC 138 46","2.2.5"},
> >> >       {sasl,"SASL  CXC 138 11","2.1.9.2"},
> >> >       {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
> >> >       {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
> >> >       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
> >> >       {mochiweb,"MochiMedia Web Server","1.3"},
> >> >       {crypto,"CRYPTO version 2","2.0"},
> >> >       {inets,"INETS  CXC 138 49","5.4"},
> >> >       {mnesia,"MNESIA  CXC 138 12","4.4.14"},
> >> >       {stdlib,"ERTS  CXC 138 10","1.17"},
> >> >       {kernel,"ERTS  CXC 138 10","2.14"}]},
> >> >   {nodes,[{disc,[rabbit at Bilbo]}]},
> >> >   {running_nodes,[rabbit at Bilbo]}]
> >> > ...done.
> >>
> >> > Thanks,
> >> > Cameron
> >>
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-disc... at lists.rabbitmq.com
> >> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100812/07a3f9dd/attachment-0001.htm>

From aaron at agoragames.com  Thu Aug 12 13:31:20 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 12 Aug 2010 08:31:20 -0400
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100811121706.GT29106@rabbitmq.com>
References: <AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
	<20100726151140.GC6839@rabbitmq.com>
	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
	<20100728124626.GH554@rabbitmq.com>
	<AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>
	<20100805164127.GT17061@rabbitmq.com>
	<AANLkTin_9ZA-DMacYj26Gn9haob08aXNY1NdAb0QaawJ@mail.gmail.com>
	<4C6240C9.5020702@rabbitmq.com>
	<AANLkTimVew+nWWAOwEQNgxkJOTGVL2LfgzzBbtZbJ707@mail.gmail.com>
	<20100811121706.GT29106@rabbitmq.com>
Message-ID: <AANLkTinAXp-BqsjHR3VC16mAed=p6VnadyhunLFaPdTf@mail.gmail.com>

Bummer, that's a big surprise.  I'd be curious to see a comparison
with a persister backed by a storage engine that does use mmap, like
Tokyo Cabinet.  Not that I doubt the team's abilities, we just have
had fantastic results with applications such as Varnish, TC and Mongo
which all make extensive use of mmap and let the kernel do all the
heavy lifting.  Maybe with the abstraction layer in place, we'll take
that on the next time we have a hack-a-thon day.  I'd also be curious
to try an extension of the persistent messaging, so that after X
seconds it can be thrown out.

We've decided to hold off upgrading our cluster until the next release
of Rabbit which includes this persister, we're looking forward to it.
Well done!

cheers,
Aaron

On Wed, Aug 11, 2010 at 8:17 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
>
> Sadly, no: Erlang does not expose an mmap interface, though actually
> there has been a recent thread on erlang-questions about how to
> implement this. However, we do do very aggressive caching and work hard
> to make as much use of kernel disk buffers as possible: we try to play
> nice with the kernel. With a little tuning, we can easily saturate disk
> write bandwidth, so it seems we're doing something right ;)
>
> Matthew
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From davegreggory at yahoo.com  Thu Aug 12 13:49:31 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Thu, 12 Aug 2010 08:49:31 -0400
Subject: [rabbitmq-discuss] RabbitMQ - live upgrade
In-Reply-To: <20100811141112.GU29106@rabbitmq.com>
References: <B6FF1263-7C50-4058-94E6-44DF70723E6F@yahoo.com>
	<20100811141112.GU29106@rabbitmq.com>
Message-ID: <AA575846-FED6-4E35-BF32-4398D19BF11C@yahoo.com>

Thanks, Matthew. 

It's good to hear that we won't need to upgrade the clients to the new client API. 

The reason I said it will try to re-cluster is because we use the cluster config file to automatically cluster when nodes start up fresh. 

I figured as much for the nodes themselves. 

On Aug 11, 2010, at 10:11 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:

> Hi Dave,
> 
> On Wed, Aug 11, 2010 at 10:01:20AM -0400, Dave Greggory wrote:
>> We have two nodes in the cluster and they can talk to each other
>> directly (obviously). They're both 1.8.1 and say we want to upgrade
>> them one at a time to 1.new version without affecting clients. If we
>> take down 1 node out of the load balancer then clients will connect to
>> the other node when they detect the connection loss. Now we can
>> shutdown this first node and upgrade it.
> 
> That would work, but obviously any queues that are declared on the node
> that is now down will be unavailable.
> 
>> Will we lose any of the persisted messages in the downed node due to
>> the new persister and/or mnesia differences?
> 
> Yes. You will lose all persisted messages. And all declared queues,
> exchanges, bindings, vhosts and users.
> 
>> when we bring up the newly upgraded node, it will attempt to cluster
>> itself with the still up second node with old version? Can only very
>> bad things happen in this situation?
> 
> Hmmm, I'm not sure if it will try to recluster. If it does, it'll
> certainly fail. You can not cluster between rabbit with different
> versions of rabbit (well, actually, you probably can sometimes, but the
> outcome is undefined at best). Don't do this.
> 
>> Other than being very quick on the trigger finger and downing the
>> second node as we're bringing up the first node, are there any other
>> solutions?
> 
> Yes, build a new cluster, then switch your producers over to the new
> cluster (where they must create new queues, exchanges etc etc). Have
> your consumers continue to drain the old cluster, and then when the old
> cluster is empty, switch the consumers to the new cluster.
> 
>> Or will the new version just not work without having to upgrade client
>> API (java) and restsrting clients?
> 
> There is no requirement to touch your clients. The on-the-wire AMQP
> protocol has not changed. There have been changes and likely
> improvements to the clients but I don't believe there should be any
> problems with 1.8.1 clients connecting to the next released version of
> the RabbitMQ broker.
> 
> Matthew

From davegreggory at yahoo.com  Thu Aug 12 13:55:50 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Thu, 12 Aug 2010 08:55:50 -0400
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <59CCC341-3A68-4C0D-8C7C-686FE1E0AAD6@yahoo.com>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
	<AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
	<20100805213800.GB3413@dakota>
	<59CCC341-3A68-4C0D-8C7C-686FE1E0AAD6@yahoo.com>
Message-ID: <67501E52-FE7A-4B11-B37E-3567B67B4ACA@yahoo.com>

Maybe no one saw my questions below due to their placement in the original email. Anybody? 

> When a node with a queue goes down, can I write something using the java client that re-declares all known queues on the other node. May be have all the queue names(and params) registered somewhere in the app and upon reconnect, passively re-declare them. If passive declaration throws an exception, catch that and do an actual declaration. Would that work?
> 
> If that works, then what happens if we bring up the node that went down that had the queue originally? Would it play nice?

From alexandru at rabbitmq.com  Thu Aug 12 14:24:49 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 12 Aug 2010 14:24:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ - live upgrade
In-Reply-To: <AA575846-FED6-4E35-BF32-4398D19BF11C@yahoo.com>
References: <B6FF1263-7C50-4058-94E6-44DF70723E6F@yahoo.com>
	<20100811141112.GU29106@rabbitmq.com>
	<AA575846-FED6-4E35-BF32-4398D19BF11C@yahoo.com>
Message-ID: <20100812132449.GA2747@dakota.eng.vmware.com>

> The reason I said it will try to re-cluster is because we use the cluster config file to automatically cluster when nodes start up fresh. 

We moved the cluster configuration from that file to rabbitmq.config.

To set up the cluster automatically, set cluster_nodes in
rabbitmq.config.

Cheers,
Alex

From alexandru at rabbitmq.com  Thu Aug 12 14:33:54 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 12 Aug 2010 14:33:54 +0100
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <59CCC341-3A68-4C0D-8C7C-686FE1E0AAD6@yahoo.com>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
	<AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
	<20100805213800.GB3413@dakota>
	<59CCC341-3A68-4C0D-8C7C-686FE1E0AAD6@yahoo.com>
Message-ID: <20100812133354.GB2747@dakota.eng.vmware.com>

Hi Dave,

> When a node with a queue goes down, can I write something using the java client that re-declares all known queues on the other node. May be have all the queue names(and params) registered somewhere in the app and upon reconnect, passively re-declare them. If passive declaration throws an exception, catch that and do an actual declaration. Would that work?

If you:
  1) declare a durable queue on one of the clustered nodes,
  2) take down that node,
  3) declare the same queue on another node
you get a "404: Not Found".

If it's not durable, sure.

As an aside, if you passive declare something, then immediately declare
it, the first step is redundant.  There's no problem with declaring
the same thing repeatedly. (assuming it's declared in exactly the
same way and it's not unreachable)

Cheers,
Alex

From alexis at rabbitmq.com  Thu Aug 12 14:51:27 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 12 Aug 2010 14:51:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ experiences on VMs
Message-ID: <AANLkTini1JZaw1YGZHtFeLj0UOntvhqX3ks7-1-H-oO7@mail.gmail.com>

Aaron,

You mentioned that you'd been running RabbitMQ on a VM.  Could you
please tell us how that has been going and if there is anything we
could do to make it better?

Cheers

alexis

From matthew at rabbitmq.com  Thu Aug 12 15:28:40 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 12 Aug 2010 15:28:40 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTinAXp-BqsjHR3VC16mAed=p6VnadyhunLFaPdTf@mail.gmail.com>
References: <AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
	<20100728124626.GH554@rabbitmq.com>
	<AANLkTinsUhv0wMRJX4k3N5CrDCYEoVyUBoH5Ma9opcEr@mail.gmail.com>
	<20100805164127.GT17061@rabbitmq.com>
	<AANLkTin_9ZA-DMacYj26Gn9haob08aXNY1NdAb0QaawJ@mail.gmail.com>
	<4C6240C9.5020702@rabbitmq.com>
	<AANLkTimVew+nWWAOwEQNgxkJOTGVL2LfgzzBbtZbJ707@mail.gmail.com>
	<20100811121706.GT29106@rabbitmq.com>
	<AANLkTinAXp-BqsjHR3VC16mAed=p6VnadyhunLFaPdTf@mail.gmail.com>
Message-ID: <20100812142839.GA4164@rabbitmq.com>

On Thu, Aug 12, 2010 at 08:31:20AM -0400, Aaron Westendorf wrote:
> Bummer, that's a big surprise.  I'd be curious to see a comparison
> with a persister backed by a storage engine that does use mmap, like
> Tokyo Cabinet.  Not that I doubt the team's abilities, we just have
> had fantastic results with applications such as Varnish, TC and Mongo
> which all make extensive use of mmap and let the kernel do all the
> heavy lifting.

Bear in mind that we don't have many random seeks. All our writes are
append only, and queues only have one read head. This doesn't make life
easy, but it does mean that predicting where the next read is going to
be is rather easy. Plus obviously using block reads etc etc... Given the
way queues are accessed, I'm not convinced you'd see enormous speedups
using mmap. Oh and also, you tend to have many writes for a message, and
0 or 1 reads for a message. So all those stores that are optimised for
heavy read loads - well, needless to say they don't tend to maintain
their performance when presented with a high write-to-read ratio.

> Maybe with the abstraction layer in place, we'll take
> that on the next time we have a hack-a-thon day.

Please do - the Toke Erlang driver for Tokyo Cabinet that I wrote should
serve you well there.

> I'd also be curious
> to try an extension of the persistent messaging, so that after X
> seconds it can be thrown out.

If you get anywhere with that, please let us know! We have plans to do a
per-queue TTL (no message in the queue can have been in the queue for
more than N seconds), but general per message TTL is very very much
harder, which is why we've not done it.

Matthew

From aaron at agoragames.com  Thu Aug 12 16:34:52 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 12 Aug 2010 11:34:52 -0400
Subject: [rabbitmq-discuss] RabbitMQ experiences on VMs
In-Reply-To: <AANLkTini1JZaw1YGZHtFeLj0UOntvhqX3ks7-1-H-oO7@mail.gmail.com>
References: <AANLkTini1JZaw1YGZHtFeLj0UOntvhqX3ks7-1-H-oO7@mail.gmail.com>
Message-ID: <AANLkTikEovUOBHQfw0+qZyBW5bjRL60ACDz08AjsGFdx@mail.gmail.com>

Our experience has been excellent, with no notable problems.  I should
note that we're not using persistent messages, and in our experience,
all VM IO has a huge hit on performance.  This is due to the drivers,
which place all of the workload on the kernel and CPU, whereas on
hardware a large portion of the work is offloaded to disk and network
controllers.  I think this situation has improved, though disk IO is
still our greatest bottleneck, and we don't see that on our cluster
because all our messages are non-persistent.  We may see a different
pattern with the new persister; we'll keep our eyes on the hosts.

In the past, the memory management between Linux and the balloon
driver was problematic, but Ubuntu 9.04 and later VMWare releases have
fixed that problem.  There may still be edge cases we have not
encountered, as we use monit to keep a close eye on memory usage and
take quick action if our queues have caused Rabbit to consume too much
memory.  That only happens when our consumers have broken, and that's
a rare occurrence.

I should also note that some of our expected high-throughput projects
have been delayed or yielded less traffic than expected.  In hindsight
this has been a boon because we've been able to refine our application
stack and tool set, but by next spring, we and our rabbits will be
fully loaded and we'll have better data from which to draw
conclusions.

cheers,
Aaron

On Thu, Aug 12, 2010 at 9:51 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Aaron,
>
> You mentioned that you'd been running RabbitMQ on a VM. ?Could you
> please tell us how that has been going and if there is anything we
> could do to make it better?
>
> Cheers
>
> alexis
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From alexis at rabbitmq.com  Thu Aug 12 17:12:17 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 12 Aug 2010 17:12:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ experiences on VMs
In-Reply-To: <AANLkTikEovUOBHQfw0+qZyBW5bjRL60ACDz08AjsGFdx@mail.gmail.com>
References: <AANLkTini1JZaw1YGZHtFeLj0UOntvhqX3ks7-1-H-oO7@mail.gmail.com>
	<AANLkTikEovUOBHQfw0+qZyBW5bjRL60ACDz08AjsGFdx@mail.gmail.com>
Message-ID: <AANLkTikKe-P_ppjoxFOMAPSxrwu_JRKvu7jthqeoCx0N@mail.gmail.com>

Aaron,

Thank-you very much.  Do please let us know how you find the new
persister when run from inside a VM.  We do have the ability to feed
back this info to VMware folks who are hungry for specific use cases
involving potential performance improvements.

alexis


On Thu, Aug 12, 2010 at 4:34 PM, Aaron Westendorf <aaron at agoragames.com> wrote:
> Our experience has been excellent, with no notable problems. ?I should
> note that we're not using persistent messages, and in our experience,
> all VM IO has a huge hit on performance. ?This is due to the drivers,
> which place all of the workload on the kernel and CPU, whereas on
> hardware a large portion of the work is offloaded to disk and network
> controllers. ?I think this situation has improved, though disk IO is
> still our greatest bottleneck, and we don't see that on our cluster
> because all our messages are non-persistent. ?We may see a different
> pattern with the new persister; we'll keep our eyes on the hosts.
>
> In the past, the memory management between Linux and the balloon
> driver was problematic, but Ubuntu 9.04 and later VMWare releases have
> fixed that problem. ?There may still be edge cases we have not
> encountered, as we use monit to keep a close eye on memory usage and
> take quick action if our queues have caused Rabbit to consume too much
> memory. ?That only happens when our consumers have broken, and that's
> a rare occurrence.
>
> I should also note that some of our expected high-throughput projects
> have been delayed or yielded less traffic than expected. ?In hindsight
> this has been a boon because we've been able to refine our application
> stack and tool set, but by next spring, we and our rabbits will be
> fully loaded and we'll have better data from which to draw
> conclusions.
>
> cheers,
> Aaron
>
> On Thu, Aug 12, 2010 at 9:51 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Aaron,
>>
>> You mentioned that you'd been running RabbitMQ on a VM. ?Could you
>> please tell us how that has been going and if there is anything we
>> could do to make it better?
>>
>> Cheers
>>
>> alexis
>>
>
>
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com
>

From mail at sebastian-latza.de  Thu Aug 12 18:24:30 2010
From: mail at sebastian-latza.de (Sebastian Latza)
Date: Thu, 12 Aug 2010 19:24:30 +0200
Subject: [rabbitmq-discuss] Upgrade issues - 541 - bad_return_value -
	amqqueue
Message-ID: <AANLkTikdBk+N9_OnNh7oDyvJeenmGv_-6M=oaX3JtZbG@mail.gmail.com>

Hi everybody,

after upgrading from 1.7.0 to 1.8.1 im getting 541 Internal Errors on
my Java client using the 1.8.1 java lib. While on my 1.8.0 test system
everything works fine, the 1.8.1 on a different machine gives me this
error output:

http://gist.github.com/521308

This both happens with newly created vhosts, as with pre-existing ones
(before the upgrade). Any hints what might be going wrong here?

Regards
Sebastian

From matthias at rabbitmq.com  Thu Aug 12 19:17:41 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Aug 2010 19:17:41 +0100
Subject: [rabbitmq-discuss] Upgrade issues - 541 - bad_return_value -
 amqqueue
In-Reply-To: <AANLkTikdBk+N9_OnNh7oDyvJeenmGv_-6M=oaX3JtZbG@mail.gmail.com>
References: <AANLkTikdBk+N9_OnNh7oDyvJeenmGv_-6M=oaX3JtZbG@mail.gmail.com>
Message-ID: <4C643AC5.6070008@rabbitmq.com>

Sebastian,

On 12/08/10 18:24, Sebastian Latza wrote:
> after upgrading from 1.7.0 to 1.8.1 im getting 541 Internal Errors on
> my Java client using the 1.8.1 java lib. While on my 1.8.0 test system
> everything works fine, the 1.8.1 on a different machine gives me this
> error output:
>
> http://gist.github.com/521308
>
> This both happens with newly created vhosts, as with pre-existing ones
> (before the upgrade). Any hints what might be going wrong here?

The error is symptomatic of a schema mismatch.

An upgrade of the server from 1.7.0 to 1.8.x should automatically move 
Rabbit's database to a backup location and start with a fresh one, since 
the schema changed between these versions. So I do not understand how 
any vhosts (or other data) can have survived the upgrade.

Does 'rabbitmqctl list_queues' show any queues? Ditto for exchanges, 
bindings and vhosts.

You may want to try resetting the db with
   rabbitmqctl stop_app
   rabbitmqctl reset
   rabbitmqctl start_app


Regards,

Matthias.

From list.rabbit at calidris.co.uk  Thu Aug 12 22:12:16 2010
From: list.rabbit at calidris.co.uk (Tim Sawyer)
Date: Thu, 12 Aug 2010 22:12:16 +0100
Subject: [rabbitmq-discuss] Can't connect on Windows
Message-ID: <4C6463B0.9090109@calidris.co.uk>

On 11/08/10 21:46, Tony Garnock-Jones wrote:
> Tim Sawyer wrote:
>> Can someone give me an inkling of where to start looking for a solution?
>
> Looks like a Flash cross-domain policy problem to my inexpert eye. Are you
> connecting to "localhost" or "auk"? Flash is picky about where it lets you open
> sockets to, IIRC. I'm absolutely no expert in any of this :-) but you might
> find some guidance in http://kb2.adobe.com/cps/142/tn_14213.html.

I've tried auk, auk.domain.com and localhost, with no joy.

Unfortunately I think you're right that it's a cross domain problem.
RabbitMQ itself works fine on that machine, on anything but a Flex client.

Running the same version on an XP box (instead of windows 7) and then
connecting to it remotely seems to work fine, so maybe it's something to
do with the security in Windows 7.

Thanks,

Tim.

From clegnitto at mozilla.com  Thu Aug 12 22:17:35 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Thu, 12 Aug 2010 14:17:35 -0700
Subject: [rabbitmq-discuss] rabbitmq-public-umbrella fails to build due to
	bql plugin, patch attached
Message-ID: <E741D477-FB3D-4D7E-844E-3DE2DEA833EA@mozilla.com>

All:

I updated my rabbitmq-public-umbrella and tried to build everything. It failed due to the bql plugin not finding deps. This is the (trivial) patch I applied to bql locally (RHEL 5.5) to get it all to build:

diff -r 565833936dc4 Makefile
--- a/Makefile  Mon Jun 28 09:55:38 2010 +0100
+++ b/Makefile  Wed Aug 11 05:13:49 2010 -0700
@@ -26,7 +26,7 @@
    rm -rf $(CLIENT_PACKAGE_DIR)
    mkdir -p $(DIST_DIR)
    mkdir -p $(CLIENT_PACKAGE_DIR)/ebin
-   cp $(EBIN_DIR)/* $(foreach DEP_NAME, $(CLIENT_DEPS), $(PRIV_DEPS_DIR)/$(DEP_NAME)/ebin/*) $(CLIENT_PACKAGE_DIR)/ebin
+   cp $(EBIN_DIR)/* $(foreach DEP_NAME, $(CLIENT_DEPS), $(PRIV_DEPS_DIR)/$(DEP_NAME)*/ebin/*) $(CLIENT_PACKAGE_DIR)/ebin
    cp $(SCRIPTS_DIR)/* $(CLIENT_PACKAGE_DIR)
    
    (cd $(CLIENT_PACKAGE_DIR); zip -r ../../$@ *)


Thanks,
Christian

From koolvivek2006 at gmail.com  Fri Aug 13 08:18:44 2010
From: koolvivek2006 at gmail.com (vivek agarwal)
Date: Fri, 13 Aug 2010 12:48:44 +0530
Subject: [rabbitmq-discuss] Performance Issues on Rabbit MQ ,
	stops responding
Message-ID: <AANLkTimHOQsCvF9=YX6uWOBdH-WxYcvGofh5V8whKD2d@mail.gmail.com>

Hi,
I am running RabbitMQ Perf tests on my system, and I find that after pushing
in 1,50,000 messages of 1KB each, the rabbit mq stops responding to more
enqueues.
What is more surprising is that, I cannot even dequeue the messages. Thus,
its as good as saying that rabbit mq broker has stopped responding, although
the client still allows me to query with list_queues and list_exchanges.

I am using 2GB Ram.

I think we really need a disk flow persister, or can someone suggest any
other way to evade this problem?

Thanks,
Vivek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100813/aa083f1c/attachment.htm>

From jigar87 at gmail.com  Fri Aug 13 08:29:24 2010
From: jigar87 at gmail.com (jigar sheth)
Date: Fri, 13 Aug 2010 12:59:24 +0530
Subject: [rabbitmq-discuss] RabbitMQ Message Consumption ID based (c# API)
Message-ID: <AANLkTikEgTGBEgKYTB9OmTgM5ocH1+7AVgDGC+1CO_eW@mail.gmail.com>

i would like to publish/produce a message with some message id, like each
message has a particular id..

i just need to findout how to publish a message in a queue with a ID
(message ID or any such ID that identifies the message) and to Consume the
Message based on ID I really dont think Database is the Correct
Approach.since the messages are already in the queue we just need a way to
assign ID and read them by those ID. I am sure it is possible in rabbitMQ c#
api but i dont know how.

regarding publishing message i have figured it out till some extent ,what i
did is created object for  IBasicProperties
(IBasicProperties object = new BasicProperties();) and than assigned
messageid to the object and passed that object inside BasicPublish method. I
am not sure whether this is the correct way to do, but i am still not able
to understand how to consume message based on ID passed in this
BasicPublish.


Regards,
Jigar Sheth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100813/8b8fcd7d/attachment-0001.htm>

From emile at rabbitmq.com  Fri Aug 13 09:05:44 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Aug 2010 09:05:44 +0100
Subject: [rabbitmq-discuss] rabbitmq-public-umbrella fails to build due
 to	bql plugin, patch attached
In-Reply-To: <E741D477-FB3D-4D7E-844E-3DE2DEA833EA@mozilla.com>
References: <E741D477-FB3D-4D7E-844E-3DE2DEA833EA@mozilla.com>
Message-ID: <4C64FCD8.3070003@rabbitmq.com>


Hi Christian,

On 12/08/10 22:17, Christian Legnitto wrote:
> All:
> 
> I updated my rabbitmq-public-umbrella and tried to build everything. It failed due to the bql plugin not finding deps. This is the (trivial) patch I applied to bql locally (RHEL 5.5) to get it all to build:
> 
> diff -r 565833936dc4 Makefile
> --- a/Makefile  Mon Jun 28 09:55:38 2010 +0100
> +++ b/Makefile  Wed Aug 11 05:13:49 2010 -0700
> @@ -26,7 +26,7 @@
>     rm -rf $(CLIENT_PACKAGE_DIR)
>     mkdir -p $(DIST_DIR)
>     mkdir -p $(CLIENT_PACKAGE_DIR)/ebin
> -   cp $(EBIN_DIR)/* $(foreach DEP_NAME, $(CLIENT_DEPS), $(PRIV_DEPS_DIR)/$(DEP_NAME)/ebin/*) $(CLIENT_PACKAGE_DIR)/ebin
> +   cp $(EBIN_DIR)/* $(foreach DEP_NAME, $(CLIENT_DEPS), $(PRIV_DEPS_DIR)/$(DEP_NAME)*/ebin/*) $(CLIENT_PACKAGE_DIR)/ebin
>     cp $(SCRIPTS_DIR)/* $(CLIENT_PACKAGE_DIR)
>     
>     (cd $(CLIENT_PACKAGE_DIR); zip -r ../../$@ *)

Thanks for the patch - we've opened a bug for this problem.



-Emile

From mail at sebastian-latza.de  Fri Aug 13 10:12:08 2010
From: mail at sebastian-latza.de (Sebastian Latza)
Date: Fri, 13 Aug 2010 11:12:08 +0200
Subject: [rabbitmq-discuss] Upgrade issues - 541 - bad_return_value -
	amqqueue
In-Reply-To: <4C643AC5.6070008@rabbitmq.com>
References: <AANLkTikdBk+N9_OnNh7oDyvJeenmGv_-6M=oaX3JtZbG@mail.gmail.com>
	<4C643AC5.6070008@rabbitmq.com>
Message-ID: <AANLkTi=viXAUrd-QAw4355Npt2hjyBxGX=3mjSeqNuaz@mail.gmail.com>

Matthias,
> The error is symptomatic of a schema mismatch.
>
> An upgrade of the server from 1.7.0 to 1.8.x should automatically move
> Rabbit's database to a backup location and start with a fresh one, since the
> schema changed between these versions. So I do not understand how any vhosts
> (or other data) can have survived the upgrade.
>

I think that happened because we changed the default directory for the
persister log and mnesia and somehow ended up using the old files.


> You may want to try resetting the db with
> ?rabbitmqctl stop_app
> ?rabbitmqctl reset
> ?rabbitmqctl start_app
>

That helped :) Thanks for the clarification, when I encountered the
error I was suspecting something like a version mismatch in terms of
the used library, but this makes sense.

Regards,
Sebastian

From matthew at rabbitmq.com  Fri Aug 13 10:38:15 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Aug 2010 10:38:15 +0100
Subject: [rabbitmq-discuss] Performance Issues on Rabbit MQ ,
 stops responding
In-Reply-To: <AANLkTimHOQsCvF9=YX6uWOBdH-WxYcvGofh5V8whKD2d@mail.gmail.com>
References: <AANLkTimHOQsCvF9=YX6uWOBdH-WxYcvGofh5V8whKD2d@mail.gmail.com>
Message-ID: <20100813093815.GD10945@rabbitmq.com>

Hi,

On Fri, Aug 13, 2010 at 12:48:44PM +0530, vivek agarwal wrote:
> I am running RabbitMQ Perf tests on my system, and I find that after pushing
> in 1,50,000 messages of 1KB each, the rabbit mq stops responding to more
> enqueues.
> What is more surprising is that, I cannot even dequeue the messages. Thus,
> its as good as saying that rabbit mq broker has stopped responding, although
> the client still allows me to query with list_queues and list_exchanges.

You're using the default branch aren't you? We've changed from using the
AMQP channel.flow for flow control to using simple TCP backpressure. The
advantage is that it works with all clients and avoids very nasty
buffering issues which hit a lot of people in the 1.8.1 release. The
downside is that when activated, it'll block the entire connection to
the client - not just individual channels.

We do try and be nice here - if a connection is not being used for
publishes at all then we don't block it.

> I am using 2GB Ram.

That may not be enough for those tests. Check the rabbit logs and see if
it's complaining about hitting the memory high watermark.

> I think we really need a disk flow persister, or can someone suggest any
> other way to evade this problem?

Err, if you're running from default then you will be using the new
persister. You should find that it'll be pushing messages rapidly to
disk and should eventually recover.

Matthew

From matthew at rabbitmq.com  Fri Aug 13 10:40:21 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Aug 2010 10:40:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ Message Consumption ID based (c#
 API)
In-Reply-To: <AANLkTikEgTGBEgKYTB9OmTgM5ocH1+7AVgDGC+1CO_eW@mail.gmail.com>
References: <AANLkTikEgTGBEgKYTB9OmTgM5ocH1+7AVgDGC+1CO_eW@mail.gmail.com>
Message-ID: <20100813094021.GE10945@rabbitmq.com>

On Fri, Aug 13, 2010 at 12:59:24PM +0530, jigar sheth wrote:
> i just need to findout how to publish a message in a queue with a ID
> (message ID or any such ID that identifies the message) and to Consume the
> Message based on ID I really dont think Database is the Correct
> Approach.since the messages are already in the queue we just need a way to
> assign ID and read them by those ID. I am sure it is possible in rabbitMQ c#
> api but i dont know how.

What you're asking for is a database. AMQP queues are FIFO structures.
There's no arbitrary random access to them. You can enqueue and dequeue
and that is all.

Matthew

From jigar87 at gmail.com  Fri Aug 13 12:00:03 2010
From: jigar87 at gmail.com (jigar sheth)
Date: Fri, 13 Aug 2010 16:30:03 +0530
Subject: [rabbitmq-discuss] RabbitMQ Message Publishing and Consuming with
	Database Operations
Message-ID: <AANLkTikajUY+JBXAJtQ3aPoq4nLcZfa6BXLUGENXKrGV@mail.gmail.com>

In my Previous question i received a response from which i understood i will
have to involve some sort of database operation.
at the bottom of this mail is my previously asked question.

So on that basis to achieve the requirement which i have mentioned below
what kind of database operation will i require to perform. please tell me
how can i achieve this task. since i am a beginner little explanation or
some links from where i can understand things woulod be appreciated

Thanks & Regards,
Jigar Sheth





*Previously Asked Question*
 just need to findout how to publish a message in a queue with a ID
> (message ID or any such ID that identifies the message) and to Consume the
> Message based on ID I really dont think Database is the Correct
> Approach.since the messages are already in the queue we just need a way to
> assign ID and read them by those ID. I am sure it is possible in rabbitMQ
c#
> api but i dont know how.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100813/e5f40426/attachment.htm>

From alexis at rabbitmq.com  Fri Aug 13 13:02:13 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 13 Aug 2010 13:02:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ Message Publishing and Consuming
 with Database Operations
In-Reply-To: <AANLkTikajUY+JBXAJtQ3aPoq4nLcZfa6BXLUGENXKrGV@mail.gmail.com>
References: <AANLkTikajUY+JBXAJtQ3aPoq4nLcZfa6BXLUGENXKrGV@mail.gmail.com>
Message-ID: <AANLkTikNEJko2Ectnvb7DdY+42RCY9fVqE3pzOCyG8_M@mail.gmail.com>

Jigar

I think it depends which database you are using.  If you want to use
C# then I assume you will also be using MS SQL or possibly Access.  In
which case I recommend MSDN as a starting point, perhaps using ADO.NET
or whatever the current data abstraction in .NET is.

alexis




On Fri, Aug 13, 2010 at 12:00 PM, jigar sheth <jigar87 at gmail.com> wrote:
> In my Previous question i received a response from which i understood i will
> have to involve some sort of database operation.
> at the bottom of this mail is my previously asked question.
> So on that basis to achieve the requirement which i have mentioned below
> what kind of database operation will i require to perform. please tell me
> how can i achieve this task. since i am a beginner little explanation or
> some links from where i can understand things woulod be appreciated
> Thanks & Regards,
> Jigar Sheth
>
>
>
>
> Previously Asked Question
> ?just need to findout how to publish a message in a queue with a ID
>> (message ID or any such ID that identifies the message) and to Consume the
>> Message based on ID I really dont think Database is the Correct
>> Approach.since the messages are already in the queue we just need a way to
>> assign ID and read them by those ID. I am sure it is possible in rabbitMQ
>> c#
>> api but i dont know how.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From majek04 at gmail.com  Fri Aug 13 13:16:09 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 13 Aug 2010 13:16:09 +0100
Subject: [rabbitmq-discuss] JSONRPCError - Internal error: badmatch
In-Reply-To: <AANLkTinQ1j-Ce9bxT8f+gi-ACKuyi2=DzcyXL8uyshSk@mail.gmail.com>
References: <AANLkTik+dSh0JKZJzWRVSF1e_PzQeXRYB0g+s48Ww=yH@mail.gmail.com>
	<4C5B3CA2.3040200@rabbitmq.com>
	<ae4193ec-03e9-483e-bc9b-11a972308313@v15g2000yqe.googlegroups.com>
	<AANLkTi=bRxcYEOemY+oyW2JxSJWBZJm97+Ji5Wzao95S@mail.gmail.com>
	<AANLkTinQ1j-Ce9bxT8f+gi-ACKuyi2=DzcyXL8uyshSk@mail.gmail.com>
Message-ID: <AANLkTikN9g=tojzkg=VhO9XUN2aeF9mw6jnx+fgKi1t0@mail.gmail.com>

On Thu, Aug 12, 2010 at 11:27, Cameron Harris <cameron at cameronharris.org> wrote:
> That has fixed the issue when building from scratch, thanks.
>
> However, we would like to get it working in 1.8.1 if possible. I've tried
> checking out the revision of rabbitmq-jsonrpc-channel that Simon suggested
> most likely to work with 1.8.1 (0a920cb5180b) and loaded it into the 1.8.1
> release version of rabbitmq, along with the head versions of
> rfc4627_jsonrpc, rabbit_jsonrpc, rabbit_mochiweb, mochiweb. Unfortunately
> this gives me the error I reported in my first post.
>
> I tried building rabbitmq-server tag 1.8.1, but I got errors relating to
> what files were available in rabbit-codegen, and rabbit-codegen only has a
> 1.8.0 tag. Many of the other plugins aren't tagged for 1.8.1, so is using
> the head version of those likely to cause a problem? Most of the comments on
> the commits also reference bug numbers.. is there a public bug tracker
> anywhere so that I can work out what the commits are for?

The bug tracker is not public at the moment.
I'm afraid I'm not able to assist you with building the plugins for 1.8.1.
Instead, I'd ask you to give us some time. On the next release
(which should happen pretty soon) all the plugins will be correctly
tagged and hopefully working.


> On a more interesting, related note: is there any way of writing javascript
> that runs on a seperate webserver that connects to the rabbitmq-server's
> json-rpc?

That is a very valid question. From my knowledge no one has ever tried
to use these plugins in production.

If anyone has - please shout now!


> I'm guessing either you could use JSONP, or in standards compliant
> browsers, you'd need to use CORS/XHR2, and IE would need to use
> XDomainRequest (which needs support in the javascript lib doesn't it?). Has
> this issue been considered yet? To do CORS and JSONP would both require
> support in the web server, wouldn't they?

I did heard of the solution to this problem via iframe hack, but it's all messy.

On the other hand there seem to be few projects that try to do  'comet'
things via a hosted service. For example http://pusherapp.com/.

What problem are you actually trying to solve via rabbitmq-jsonrpc-channel?

Cheers,
  Marek

From emile at rabbitmq.com  Fri Aug 13 14:24:38 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Aug 2010 14:24:38 +0100
Subject: [rabbitmq-discuss] JSONRPCError - Internal error: badmatch
In-Reply-To: <AANLkTinQ1j-Ce9bxT8f+gi-ACKuyi2=DzcyXL8uyshSk@mail.gmail.com>
References: <AANLkTik+dSh0JKZJzWRVSF1e_PzQeXRYB0g+s48Ww=yH@mail.gmail.com>	<4C5B3CA2.3040200@rabbitmq.com>	<ae4193ec-03e9-483e-bc9b-11a972308313@v15g2000yqe.googlegroups.com>	<AANLkTi=bRxcYEOemY+oyW2JxSJWBZJm97+Ji5Wzao95S@mail.gmail.com>
	<AANLkTinQ1j-Ce9bxT8f+gi-ACKuyi2=DzcyXL8uyshSk@mail.gmail.com>
Message-ID: <4C654796.10206@rabbitmq.com>


Hi Cameron,

On 12/08/10 11:27, Cameron Harris wrote:
> Hi Marek,
> 

> I tried building rabbitmq-server tag 1.8.1, but I got errors relating to
> what files were available in rabbit-codegen, and rabbit-codegen only has
> a 1.8.0 tag.

Thanks for pointing that out - a 1.8.1 tag has been added to the
rabbitmq-codegen repository, which will show as soon as you perform a
refresh.


Emile


From holger.hoffstaette at googlemail.com  Fri Aug 13 14:35:19 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Fri, 13 Aug 2010 15:35:19 +0200
Subject: [rabbitmq-discuss] RabbitMQ Message Publishing and Consuming
	with Database Operations
References: <AANLkTikajUY+JBXAJtQ3aPoq4nLcZfa6BXLUGENXKrGV@mail.gmail.com>
	<AANLkTikNEJko2Ectnvb7DdY+42RCY9fVqE3pzOCyG8_M@mail.gmail.com>
Message-ID: <pan.2010.08.13.13.35.19.193375@googlemail.com>

On Fri, 13 Aug 2010 13:02:13 +0100, Alexis Richardson wrote:

> I think it depends which database you are using.  If you want to use C#

He doesn't want a database, he's asking how to add a custom "ID" (sequence
number?) header and then do a "selective receive" aka get/consume matching
that ID.

..at least that's how I parsed this. :/

-h



From matthew at rabbitmq.com  Fri Aug 13 14:39:20 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Aug 2010 14:39:20 +0100
Subject: [rabbitmq-discuss] RabbitMQ Message Publishing and Consuming
 with Database Operations
In-Reply-To: <pan.2010.08.13.13.35.19.193375@googlemail.com>
References: <AANLkTikajUY+JBXAJtQ3aPoq4nLcZfa6BXLUGENXKrGV@mail.gmail.com>
	<AANLkTikNEJko2Ectnvb7DdY+42RCY9fVqE3pzOCyG8_M@mail.gmail.com>
	<pan.2010.08.13.13.35.19.193375@googlemail.com>
Message-ID: <20100813133920.GG10945@rabbitmq.com>

On Fri, Aug 13, 2010 at 03:35:19PM +0200, Holger Hoffstaette wrote:
> > I think it depends which database you are using.  If you want to use C#
> 
> He doesn't want a database, he's asking how to add a custom "ID" (sequence
> number?) header and then do a "selective receive" aka get/consume matching
> that ID.

Right, and I've explained that a queue is a FIFO structure and you can't
do a selective receive or any such query operations.

Matthew

From alexis at rabbitmq.com  Fri Aug 13 14:50:35 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 13 Aug 2010 14:50:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ Message Publishing and Consuming
 with Database Operations
In-Reply-To: <20100813133920.GG10945@rabbitmq.com>
References: <AANLkTikajUY+JBXAJtQ3aPoq4nLcZfa6BXLUGENXKrGV@mail.gmail.com>
	<AANLkTikNEJko2Ectnvb7DdY+42RCY9fVqE3pzOCyG8_M@mail.gmail.com>
	<pan.2010.08.13.13.35.19.193375@googlemail.com>
	<20100813133920.GG10945@rabbitmq.com>
Message-ID: <AANLkTi=qE81u+SGQ_XY3jMGD87YE=qVdPL-SvRoByOkF@mail.gmail.com>

Holger

Jigar's question is fine.

Key to it though is this phrase "since the messages are already in the
queue".  So, the question is about performing a select operation an
existing queue, seeing it as a store of messages.  That's a database
operation.  As Matthew points out, this is further complicated by our
queues being FIFO.  But it would also be true for other ordered
structures: the select is asking for an out of order retrieval based
on message content (ie. not based on routing metadata).

In instead the question where about to set up a content based
subscription, then the answer would be to create a content based
routing exchange.  But I don't think that's what Jigar meant.

In general, this area is worth further exploration, but we don't have
something OOTB for it.  For a quick solution, a database would
suffice.  Unless I missed something...

alexis






On Fri, Aug 13, 2010 at 2:39 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Fri, Aug 13, 2010 at 03:35:19PM +0200, Holger Hoffstaette wrote:
>> > I think it depends which database you are using. ?If you want to use C#
>>
>> He doesn't want a database, he's asking how to add a custom "ID" (sequence
>> number?) header and then do a "selective receive" aka get/consume matching
>> that ID.
>
> Right, and I've explained that a queue is a FIFO structure and you can't
> do a selective receive or any such query operations.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From davegreggory at yahoo.com  Fri Aug 13 15:36:48 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Fri, 13 Aug 2010 07:36:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <20100812133354.GB2747@dakota.eng.vmware.com>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
	<AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
	<20100805213800.GB3413@dakota>
	<59CCC341-3A68-4C0D-8C7C-686FE1E0AAD6@yahoo.com>
	<20100812133354.GB2747@dakota.eng.vmware.com>
Message-ID: <187129.31562.qm@web111001.mail.gq1.yahoo.com>



Ouch... so no way to ensure that there's something to catch messages when the 
node with the original durable queue goes down?

There are several mentions throughout the site about out-of-the-box live 
failover in future release, how far out is that? 6 months? 1 year?

Not a big fan of the pacemaker approach due to the number of moving parts and 
different packages (pacemaker/corosync/heartbeat/erbd) to maintain and manage. 
And also haven't seen any indication of people actually using that setup in a 
complex VM environment in production.




----- Original Message ----
From: Alexandru Scvor?ov <alexandru at rabbitmq.com>
To: Dave Greggory <davegreggory at yahoo.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Thu, August 12, 2010 9:33:54 AM
Subject: Re: [rabbitmq-discuss] Disk node vs ram node

Hi Dave,

> When a node with a queue goes down, can I write something using the java client 
>
>that re-declares all known queues on the other node. May be have all the queue 
>names(and params) registered somewhere in the app and upon reconnect, passively 

>re-declare them. If passive declaration throws an exception, catch that and do 
>an actual declaration. Would that work?

If you:
  1) declare a durable queue on one of the clustered nodes,
  2) take down that node,
  3) declare the same queue on another node
you get a "404: Not Found".

If it's not durable, sure.

As an aside, if you passive declare something, then immediately declare
it, the first step is redundant.  There's no problem with declaring
the same thing repeatedly. (assuming it's declared in exactly the
same way and it's not unreachable)

Cheers,
Alex


      

From alexis at rabbitmq.com  Fri Aug 13 15:40:14 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 13 Aug 2010 15:40:14 +0100
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <187129.31562.qm@web111001.mail.gq1.yahoo.com>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
	<AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
	<20100805213800.GB3413@dakota>
	<59CCC341-3A68-4C0D-8C7C-686FE1E0AAD6@yahoo.com>
	<20100812133354.GB2747@dakota.eng.vmware.com>
	<187129.31562.qm@web111001.mail.gq1.yahoo.com>
Message-ID: <AANLkTim_3xcFvYfDc4BPxQz=BoA6__a9CSy1r-W6spPK@mail.gmail.com>

Dave

One of the things on our todo list, as you can imagine, is to
understand how to best provide HA in a VM based setting.  Some VM
technologies provide useful failover / snapshot capability...

alexis

On Fri, Aug 13, 2010 at 3:36 PM, Dave Greggory <davegreggory at yahoo.com> wrote:
>
>
> Ouch... so no way to ensure that there's something to catch messages when the
> node with the original durable queue goes down?
>
> There are several mentions throughout the site about out-of-the-box live
> failover in future release, how far out is that? 6 months? 1 year?
>
> Not a big fan of the pacemaker approach due to the number of moving parts and
> different packages (pacemaker/corosync/heartbeat/erbd) to maintain and manage.
> And also haven't seen any indication of people actually using that setup in a
> complex VM environment in production.
>
>
>
>
> ----- Original Message ----
> From: Alexandru Scvor?ov <alexandru at rabbitmq.com>
> To: Dave Greggory <davegreggory at yahoo.com>
> Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Thu, August 12, 2010 9:33:54 AM
> Subject: Re: [rabbitmq-discuss] Disk node vs ram node
>
> Hi Dave,
>
>> When a node with a queue goes down, can I write something using the java client
>>
>>that re-declares all known queues on the other node. May be have all the queue
>>names(and params) registered somewhere in the app and upon reconnect, passively
>
>>re-declare them. If passive declaration throws an exception, catch that and do
>>an actual declaration. Would that work?
>
> If you:
> ?1) declare a durable queue on one of the clustered nodes,
> ?2) take down that node,
> ?3) declare the same queue on another node
> you get a "404: Not Found".
>
> If it's not durable, sure.
>
> As an aside, if you passive declare something, then immediately declare
> it, the first step is redundant. ?There's no problem with declaring
> the same thing repeatedly. (assuming it's declared in exactly the
> same way and it's not unreachable)
>
> Cheers,
> Alex
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Fri Aug 13 16:04:06 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 13 Aug 2010 16:04:06 +0100
Subject: [rabbitmq-discuss] Subscribing to a queue regardless of its
 parameters (auto-delete, ack, etc.)
In-Reply-To: <4C627DD4.30006@tart.com.tr>
References: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>
	<4C627DD4.30006@tart.com.tr>
Message-ID: <4C655EE6.1000207@rabbitmq.com>

Orhan,

On 11/08/10 11:39, Orhan Kavrakoglu wrote:
> I have a client-side library (modified PHP Zend_Queue classes over the
> STOMP adapter) which I use to subscribe to some queues. However, the
> interface provided by the STOMP adapter seems to want the exact
> parameters a queue was created with in order to subscribe to it. (That
> is, if a queue was created with the non-default "auto-delete: false"
> parameter, you have to specify "auto-delete: false" when subscribing to
> it.) This complicates the client code, especially given that the queue
> was created in a Java program somewhere else. Is there a way to work
> around this?

By setting "passive=true" in the header you should be able to make the 
queue declaration passive, which means that all that matters is whether 
the queue exists.


Regards,

Matthias.

From davegreggory at yahoo.com  Fri Aug 13 17:45:39 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Fri, 13 Aug 2010 12:45:39 -0400
Subject: [rabbitmq-discuss] Disk node vs ram node
In-Reply-To: <AANLkTim_3xcFvYfDc4BPxQz=BoA6__a9CSy1r-W6spPK@mail.gmail.com>
References: <29356379.post@talk.nabble.com> <20100805194309.GA3413@dakota>
	<AEC6A2084B89EA49B99F71108C2E53EB846A25@ign-msg-06.hq.ign.com>
	<20100805213800.GB3413@dakota>
	<59CCC341-3A68-4C0D-8C7C-686FE1E0AAD6@yahoo.com>
	<20100812133354.GB2747@dakota.eng.vmware.com>
	<187129.31562.qm@web111001.mail.gq1.yahoo.com>
	<AANLkTim_3xcFvYfDc4BPxQz=BoA6__a9CSy1r-W6spPK@mail.gmail.com>
Message-ID: <F0D53DB7-D872-402A-90AF-59DCAA9411AE@yahoo.com>

I understand, look forward to hearing about your plans for HA. 

On Aug 13, 2010, at 10:40 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:

> Dave
> 
> One of the things on our todo list, as you can imagine, is to
> understand how to best provide HA in a VM based setting.  Some VM
> technologies provide useful failover / snapshot capability...
> 
> alexis
> 
> On Fri, Aug 13, 2010 at 3:36 PM, Dave Greggory <davegreggory at yahoo.com> wrote:
>> 
>> 
>> Ouch... so no way to ensure that there's something to catch messages when the
>> node with the original durable queue goes down?
>> 
>> There are several mentions throughout the site about out-of-the-box live
>> failover in future release, how far out is that? 6 months? 1 year?
>> 
>> Not a big fan of the pacemaker approach due to the number of moving parts and
>> different packages (pacemaker/corosync/heartbeat/erbd) to maintain and manage.
>> And also haven't seen any indication of people actually using that setup in a
>> complex VM environment in production.
>> 
>> 
>> 
>> 
>> ----- Original Message ----
>> From: Alexandru Scvor?ov <alexandru at rabbitmq.com>
>> To: Dave Greggory <davegreggory at yahoo.com>
>> Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Thu, August 12, 2010 9:33:54 AM
>> Subject: Re: [rabbitmq-discuss] Disk node vs ram node
>> 
>> Hi Dave,
>> 
>>> When a node with a queue goes down, can I write something using the java client
>>> 
>>> that re-declares all known queues on the other node. May be have all the queue
>>> names(and params) registered somewhere in the app and upon reconnect, passively
>> 
>>> re-declare them. If passive declaration throws an exception, catch that and do
>>> an actual declaration. Would that work?
>> 
>> If you:
>>  1) declare a durable queue on one of the clustered nodes,
>>  2) take down that node,
>>  3) declare the same queue on another node
>> you get a "404: Not Found".
>> 
>> If it's not durable, sure.
>> 
>> As an aside, if you passive declare something, then immediately declare
>> it, the first step is redundant.  There's no problem with declaring
>> the same thing repeatedly. (assuming it's declared in exactly the
>> same way and it's not unreachable)
>> 
>> Cheers,
>> Alex
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 

From davegreggory at yahoo.com  Fri Aug 13 18:04:33 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Fri, 13 Aug 2010 13:04:33 -0400
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
	watermark on 1.8.1
Message-ID: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>

In one of our load tests, we found that RabbitMQ causes producers to hang when it reaches the high memory watermark. We expected RabbitMQ to hang and but not the producers. How can we work around it?

Is there a way to configure RabbitMQ to close the connection or throw an exception from the client API when that happens so the producers can respond. Or maybe there's a timeout I can specify for sends? If there's no timeout can that thread be interrupted when it hangs?

It's imperative that our client apps remain unaffected if RabbitMQ blows up in any way. 

We're connecting to RabbitMQ 1.8.1 nodes using 1.8.1 java client running under Spring-AMQP 1.0M1. 

From aaron at agoragames.com  Fri Aug 13 20:16:45 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Fri, 13 Aug 2010 15:16:45 -0400
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
Message-ID: <AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>

Dave,

It's likely that flow control kicked in.  I don't know how that's
implemented in Spring, as each client is welcome to implement it as
they see fit.  You can turn it off at the broker thusly:

bofh at host:~$ cat /etc/rabbitmq/rabbitmq.config
[{rabbit, [{vm_memory_high_watermark, 0}]}].

If you have enough monitoring tools in place to keep tabs on Rabbit
and deal with your infrastructure / apps in advance of catastrophe, I
don't personally see a need for flow control.

cheers,
Aaron

On Fri, Aug 13, 2010 at 1:04 PM, Dave Greggory <davegreggory at yahoo.com> wrote:
> In one of our load tests, we found that RabbitMQ causes producers to hang when it reaches the high memory watermark. We expected RabbitMQ to hang and but not the producers. How can we work around it?
>
> Is there a way to configure RabbitMQ to close the connection or throw an exception from the client API when that happens so the producers can respond. Or maybe there's a timeout I can specify for sends? If there's no timeout can that thread be interrupted when it hangs?
>
> It's imperative that our client apps remain unaffected if RabbitMQ blows up in any way.
>
> We're connecting to RabbitMQ 1.8.1 nodes using 1.8.1 java client running under Spring-AMQP 1.0M1.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From davegreggory at yahoo.com  Sat Aug 14 00:02:43 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Fri, 13 Aug 2010 16:02:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
	watermark on 1.8.1
In-Reply-To: <AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
Message-ID: <847342.16579.qm@web111005.mail.gq1.yahoo.com>

Hi Aaron,

Thanks for the tip, but does this merely turn off flow control? How  would 
RabbitMQ try to allocate memory for itself when its configured  this way?

Thanks,
Dave


----- Original Message ----
From: Aaron Westendorf <aaron at agoragames.com>
To: Dave Greggory <davegreggory at yahoo.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Fri, August 13, 2010 3:16:45 PM
Subject: Re: [rabbitmq-discuss] Producers hanging when reaching high memory 
watermark on 1.8.1

Dave,

It's likely that flow control kicked in.  I don't know how that's
implemented in Spring, as each client is welcome to implement it as
they see fit.  You can turn it off at the broker thusly:

bofh at host:~$ cat /etc/rabbitmq/rabbitmq.config
[{rabbit, [{vm_memory_high_watermark, 0}]}].

If you have enough monitoring tools in place to keep tabs on Rabbit
and deal with your infrastructure / apps in advance of catastrophe, I
don't personally see a need for flow control.

cheers,
Aaron


      

From chen650 at yahoo.com  Sat Aug 14 03:00:21 2010
From: chen650 at yahoo.com (alex chen)
Date: Fri, 13 Aug 2010 19:00:21 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000 topics/queues
Message-ID: <95833.58711.qm@web31801.mail.mud.yahoo.com>

Hi,

we are testing the new persiter (built from last week's default branch). when 
there are 1000 queues with backed up messages, starting the consumers would 
cause some queues to disappear.  here are the steps to reproduce the problem:

1) create 1000 queues for 1000 topics.
2) publish messages to these topics.  each message size is 20 KB.
3) when total number of queued messages bytes reaches 10GB, start 1000 consumers 
with 1000 processes.

The broker would start having problem when several consumers start consuming 
messages very fast, which causes other consumers error in login or 
basic_consume.  then some queues would disappear and the publishers would get 
no_route errors.

there was no problem if the num of topics/queues is less than 100. our machine 
has 8GB mem and 4 disks RAID.  we could get around 50MB/sec publish rate and 30 
MB/sec consume rate.
 
Could someone help to look into this problem? 
thanks.

-alex



      

From matthias at rabbitmq.com  Sat Aug 14 03:15:42 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 14 Aug 2010 03:15:42 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <95833.58711.qm@web31801.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
Message-ID: <4C65FC4E.8070804@rabbitmq.com>

Alex,

thanks for your problem report ...

alex chen wrote:
> we are testing the new persister (built from last week's default branch).

What's the hg revision id?

And what O/S and version of Erlang are you running this on?

> when there are 1000 queues with backed up messages, starting the
> consumers would cause some queues to disappear.  here are the steps
> to reproduce the problem: [...]

Can you post the code for this test?

> 1) create 1000 queues for 1000 topics.
> 2) publish messages to these topics.  each message size is 20 KB.
> 3) when total number of queued messages bytes reaches 10GB, start 1000 consumers 
> with 1000 processes.

Does that mean you have 1000+ connections?

What is the file descriptor limit for the user account running the 
rabbit server?

> The broker would start having problem when several consumers start consuming 
> messages very fast, which causes other consumers error in login or 
> basic_consume.  then some queues would disappear and the publishers would get 
> no_route errors.

Are there any interesting messages in the rabbit@<node>.log or 
rabbit@<node>-sasl.log? Can you post the contents of these log files? 
(If they are large, please upload them somewhere we can see them.)

Also, please post the output of
   rabbitmqctl list_connections
   rabbitmqctl list_channels
   rabbitmqctl list_exchanges
   rabbitmqctl list_bindings
   rabbitmqctl list_queues

(again, if the output is large please upload it somewhere).


Regards,

Matthias.

From matthias at rabbitmq.com  Sat Aug 14 15:39:27 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 14 Aug 2010 15:39:27 +0100
Subject: [rabbitmq-discuss] problem with new persiter with
	1000	topics/queues
In-Reply-To: <4C65FC4E.8070804@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com>
Message-ID: <4C66AA9F.1000006@rabbitmq.com>

Alex,

Matthias Radestock wrote:
> thanks for your problem report ...

We have since managed to reproduce this, so there is no need to send 
further info.

Your report has been incredibly valuable since it has allowed us to 
reliably reproduce a problem that hitherto we have only seen a handful 
of times in months of testing. So thank you!


Regards,

Matthias.

From pdezwart at rubiconproject.com  Sun Aug 15 07:42:40 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Sat, 14 Aug 2010 23:42:40 -0700
Subject: [rabbitmq-discuss] Compiling rabbitmq-c
Message-ID: <C88CDA70.E16F%pdezwart@rubiconproject.com>

Hey guys,

I freely admit that I am an idiot, but I could use some help. I am trying to
get some combination of rabbitmq-c and codegen to compile on my box (FC8 ?
old, I know,) and it wont behave. I am using
http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94 (amqp_0_8 tag) and
http://hg.rabbitmq.com/rabbitmq-codegen/rev/d1b197ff0c5d (rabbitmq_v_1_8_0)
and I keep on getting:

utility:~/workspace/rabbit/rabbitmq-c-0.8$ make
make  all-recursive
make[1]: Entering directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
Making all in librabbitmq
make[2]: Entering directory
`/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen python
./codegen.py header
/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp-rabbitmq-0.8.jso
n amqp_framing.h
Traceback (most recent call last):
  File "./codegen.py", line 490, in <module>
    do_main(generateHrl, generateErl)
  File 
"/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
line 263, in do_main
    do_main_dict({"header": header_fn, "body": body_fn})
  File 
"/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
line 298, in do_main_dict
    execute(funcDict[function], sources, dest)
  File 
"/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
line 277, in execute
    fn(amqp_specs)
  File "./codegen.py", line 487, in generateHrl
    genHrl(AmqpSpec(specPath))
  File 
"/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
line 155, in __init__
    self.major = self.spec['major-version']
KeyError: 'major-version'
make[2]: *** [amqp_framing.h] Error 1
make[2]: Leaving directory
`/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
make: *** [all] Error 2

What am I doing wrong?! What is the current secret magic incantation?

Thanks,
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100814/2c93a655/attachment.htm>

From scott at beamdog.com  Sun Aug 15 09:52:40 2010
From: scott at beamdog.com (Scott Brooks)
Date: Sun, 15 Aug 2010 02:52:40 -0600
Subject: [rabbitmq-discuss] Compiling rabbitmq-c
In-Reply-To: <C88CDA70.E16F%pdezwart@rubiconproject.com>
References: <Acs8RQ5ESWAF1dTGPkaFWNdemcwjBw==>
	<C88CDA70.E16F%pdezwart@rubiconproject.com>
Message-ID: <AANLkTimLOcB4GPgMaBobb2e79zHEqvTJMePuXi21xD=2@mail.gmail.com>

Maybe check your python version on something that old?  That step is
running a python script to generate some code, and if you've got an
old python it may not work properly.

Scott

On Sun, Aug 15, 2010 at 12:42 AM, Pieter de Zwart
<pdezwart at rubiconproject.com> wrote:
> Hey guys,
>
> I freely admit that I am an idiot, but I could use some help. I am trying to
> get some combination of rabbitmq-c and codegen to compile on my box (FC8 ?
> old, I know,) and it wont behave. I am using
> http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94 (amqp_0_8 tag) and
> http://hg.rabbitmq.com/rabbitmq-codegen/rev/d1b197ff0c5d (rabbitmq_v_1_8_0)
> and I keep on getting:
>
> utility:~/workspace/rabbit/rabbitmq-c-0.8$ make
> make ?all-recursive
> make[1]: Entering directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
> Making all in librabbitmq
> make[2]: Entering directory
> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
> PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen python
> ./codegen.py header
> /home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp-rabbitmq-0.8.json
> amqp_framing.h
> Traceback (most recent call last):
> ??File "./codegen.py", line 490, in <module>
> ????do_main(generateHrl, generateErl)
> ??File
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> line 263, in do_main
> ????do_main_dict({"header": header_fn, "body": body_fn})
> ??File
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> line 298, in do_main_dict
> ????execute(funcDict[function], sources, dest)
> ??File
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> line 277, in execute
> ????fn(amqp_specs)
> ??File "./codegen.py", line 487, in generateHrl
> ????genHrl(AmqpSpec(specPath))
> ??File
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> line 155, in __init__
> ????self.major = self.spec['major-version']
> KeyError: 'major-version'
> make[2]: *** [amqp_framing.h] Error 1
> make[2]: Leaving directory
> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
> make[1]: *** [all-recursive] Error 1
> make[1]: Leaving directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
> make: *** [all] Error 2
>
> What am I doing wrong?! What is the current secret magic incantation?
>
> Thanks,
> Pieter
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alexandru at rabbitmq.com  Sun Aug 15 10:08:26 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Sun, 15 Aug 2010 10:08:26 +0100
Subject: [rabbitmq-discuss] Compiling rabbitmq-c
In-Reply-To: <C88CDA70.E16F%pdezwart@rubiconproject.com>
References: <C88CDA70.E16F%pdezwart@rubiconproject.com>
Message-ID: <20100815090826.GA23736@dakota>

Hi,

Could you please try again with:
  * rabbitmq-codegen default, and
  * rabbimtq-c default.

This should work and you give you a 0-8 client.

Cheers,
Alex

On Sat, Aug 14, 2010 at 11:42:40PM -0700, Pieter de Zwart wrote:
> Hey guys,
> 
> I freely admit that I am an idiot, but I could use some help. I am trying to
> get some combination of rabbitmq-c and codegen to compile on my box (FC8 ?
> old, I know,) and it wont behave. I am using
> http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94 (amqp_0_8 tag) and
> http://hg.rabbitmq.com/rabbitmq-codegen/rev/d1b197ff0c5d (rabbitmq_v_1_8_0)
> and I keep on getting:
> 
> utility:~/workspace/rabbit/rabbitmq-c-0.8$ make
> make  all-recursive
> make[1]: Entering directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
> Making all in librabbitmq
> make[2]: Entering directory
> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
> PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen python
> ./codegen.py header
> /home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp-rabbitmq-0.8.jso
> n amqp_framing.h
> Traceback (most recent call last):
>   File "./codegen.py", line 490, in <module>
>     do_main(generateHrl, generateErl)
>   File 
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> line 263, in do_main
>     do_main_dict({"header": header_fn, "body": body_fn})
>   File 
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> line 298, in do_main_dict
>     execute(funcDict[function], sources, dest)
>   File 
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> line 277, in execute
>     fn(amqp_specs)
>   File "./codegen.py", line 487, in generateHrl
>     genHrl(AmqpSpec(specPath))
>   File 
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> line 155, in __init__
>     self.major = self.spec['major-version']
> KeyError: 'major-version'
> make[2]: *** [amqp_framing.h] Error 1
> make[2]: Leaving directory
> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
> make[1]: *** [all-recursive] Error 1
> make[1]: Leaving directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
> make: *** [all] Error 2
> 
> What am I doing wrong?! What is the current secret magic incantation?
> 
> Thanks,
> Pieter

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Sun Aug 15 11:12:58 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 15 Aug 2010 11:12:58 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
 topics/queues
In-Reply-To: <4C66AA9F.1000006@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
Message-ID: <20100815101257.GA4835@wellquite.org>

Alex,

On Sat, Aug 14, 2010 at 03:39:27PM +0100, Matthias Radestock wrote:
> Your report has been incredibly valuable since it has allowed us to
> reliably reproduce a problem that hitherto we have only seen a
> handful of times in months of testing. So thank you!

And after about a dozen hours combined of debugging and head scratching,
we've found what the problem was, and fixed it. The fix is yet to go
through QA, so please compile from the server branch "bug23129" to test.

Matthew

From davegreggory at yahoo.com  Sun Aug 15 15:41:39 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Sun, 15 Aug 2010 10:41:39 -0400
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
	watermark on 1.8.1
In-Reply-To: <AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
Message-ID: <947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>

Spring-AMQP doesn't seem to abide by flow control messages when sending. What's the standard pattern for doing so when using basic publish?

Is there plans to add that to Spring-AMQP? And is there a near-term fix we can use till you do?

And how does setting the high memory watermark to 0 affect how RabbitMQ allocates memory for itself? Does it still limit itself to 40% or use up all that's there? Is that advisable?


From mpollack at vmware.com  Sun Aug 15 16:07:47 2010
From: mpollack at vmware.com (Mark Pollack)
Date: Sun, 15 Aug 2010 08:07:47 -0700
Subject: [rabbitmq-discuss] Producers hanging when reaching high
	memory	watermark on 1.8.1
In-Reply-To: <947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
Message-ID: <806F700D7E08E9408413160B05EB66672A481A4B8F@EXCH-MBX-1.vmware.com>

Hi,

If this is a matter of calling the 'flow' method on the channel, then the short term fix is to create a subclass of either SingleConnectionFactory or CachingConnectionFactory and override the 

protected Channel getChannel(Connection connection)

In the case of subclassing SingleConnectionFactory this would be

	protected Channel getChannel(Connection connection) throws Exception {
		Channel channel = connection.createChannel();
		channel.flow(true);
		return channel;
	}

I've created the issue https://jira.springsource.org/browse/AMQP-56 to track this

Mark


> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Dave Greggory
> Sent: Sunday, August 15, 2010 10:42 AM
> To: Aaron Westendorf
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Producers hanging when reaching high
> memory watermark on 1.8.1
> 
> Spring-AMQP doesn't seem to abide by flow control messages when
> sending. What's the standard pattern for doing so when using basic
> publish?
> 
> Is there plans to add that to Spring-AMQP? And is there a near-term fix
> we can use till you do?
> 
> And how does setting the high memory watermark to 0 affect how RabbitMQ
> allocates memory for itself? Does it still limit itself to 40% or use
> up all that's there? Is that advisable?
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Mon Aug 16 04:05:41 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Aug 2010 04:05:41 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
Message-ID: <4C68AB05.8040003@rabbitmq.com>

Dave,

Dave Greggory wrote:
> Spring-AMQP doesn't seem to abide by flow control messages when
> sending.

That would surprise me. It's calling into RabbitMQ's Java client APIs, 
which take care of flow control automatically.

What evidence are you seeing that flow control isn't working?

> What's the standard pattern for doing so when using basic publish?

You shouldn't have to do anything; basic.publish should automatically 
block when the server has told the client to stop sending messages.

> And how does setting the high memory watermark to 0 affect how
> RabbitMQ allocates memory for itself? Does it still limit itself to
> 40% or use up all that's there? Is that advisable?

The default threshold is 40% instead of 100% since we need a safety 
margin. See http://www.rabbitmq.com/extensions.html#memsup for details 
of how the whole flow control mechanism operates.

In some setups a higher threshold may be safe, but disabling flow 
control altogether is not advisable.

Mark Pollack wrote:
 > If this is a matter of calling the 'flow' method on the channel,

That's for flow control in the other direction, i.e. the client telling 
the server that it should stop sending messages.


Regards,

Matthias.

From davegreggory at yahoo.com  Mon Aug 16 04:40:37 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Sun, 15 Aug 2010 23:40:37 -0400
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
	watermark on 1.8.1
In-Reply-To: <4C68AB05.8040003@rabbitmq.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
	<4C68AB05.8040003@rabbitmq.com>
Message-ID: <3F4B38CF-80CB-4621-9108-A328F2365D52@yahoo.com>

Hi Matthias,

What I'm trying to achieve is to get my client apps to be unaffected if RabbitMQ goes down. In this case, from hitting high memory watermark. Right now, when Rabbit hits that watermark, the clients hang or slow down to a crawl. Maybe that is caused by the threads being blocked by flow control, there by making it appear to be hung. 

 I don't want that. I want sends to throw an exception or some other event I can respond to so that the client apps don't break down or suffer a performance hit just because they lose messaging functionality. How do I do that?

Thanks, 
Dave


On Aug 15, 2010, at 11:05 PM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Dave,
> 
> Dave Greggory wrote:
>> Spring-AMQP doesn't seem to abide by flow control messages when
>> sending.
> 
> That would surprise me. It's calling into RabbitMQ's Java client APIs, which take care of flow control automatically.
> 
> What evidence are you seeing that flow control isn't working?
> 
>> What's the standard pattern for doing so when using basic publish?
> 
> You shouldn't have to do anything; basic.publish should automatically block when the server has told the client to stop sending messages.
> 
>> And how does setting the high memory watermark to 0 affect how
>> RabbitMQ allocates memory for itself? Does it still limit itself to
>> 40% or use up all that's there? Is that advisable?
> 
> The default threshold is 40% instead of 100% since we need a safety margin. See http://www.rabbitmq.com/extensions.html#memsup for details of how the whole flow control mechanism operates.
> 
> In some setups a higher threshold may be safe, but disabling flow control altogether is not advisable.
> 
> Mark Pollack wrote:
> > If this is a matter of calling the 'flow' method on the channel,
> 
> That's for flow control in the other direction, i.e. the client telling the server that it should stop sending messages.
> 
> 
> Regards,
> 
> Matthias.

From matthias at rabbitmq.com  Mon Aug 16 04:58:57 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Aug 2010 04:58:57 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <3F4B38CF-80CB-4621-9108-A328F2365D52@yahoo.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
	<4C68AB05.8040003@rabbitmq.com>
	<3F4B38CF-80CB-4621-9108-A328F2365D52@yahoo.com>
Message-ID: <4C68B781.3090707@rabbitmq.com>

Dave,

Dave Greggory wrote:
> What I'm trying to achieve is to get my client apps to be unaffected
> if RabbitMQ goes down. In this case, from hitting high memory
> watermark. Right now, when Rabbit hits that watermark, the clients
> hang or slow down to a crawl. Maybe that is caused by the threads
> being blocked by flow control, there by making it appear to be hung.
> 
> I don't want that. I want sends to throw an exception or some other
> event I can respond to so that the client apps don't break down or
> suffer a performance hit just because they lose messaging
> functionality. How do I do that?

There can be many conditions that cause a service to slow down - network 
congestion and outages, load on the server machine, etc. 
Server-initiated flow control is just one of them, i.e. to a client 
application it will simply appear as (sometimes very) slow service.

So this then becomes a question of deciding when publishing is "too 
slow", and being able to continue (w/o publishing) when it is.

One way to do that would be to have a single publishing thread that is 
fed publishes via a thread-safe queue from other threads. The app 
threads can then decide whether to enqueue another publish based on the 
queue's length. Or the publishing thread could record the time the 
currently underway publish (if there is one) was started and app threads 
would use that information to make the publish/not-publish decision 
instead. Or you could come up with yet more elaborate schemes.

Regards,

Matthias.

From pdezwart at rubiconproject.com  Mon Aug 16 07:58:04 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Sun, 15 Aug 2010 23:58:04 -0700
Subject: [rabbitmq-discuss] |Spam| Re:  Compiling rabbitmq-c
In-Reply-To: <20100815090826.GA23736@dakota>
Message-ID: <C88E2F8C.E18D%pdezwart@rubiconproject.com>

utility:~/workspace/rabbit$ hg clone http://hg.rabbitmq.com/rabbitmq-codegen
codegen-default
requesting all changes
adding changesets
adding manifests
adding file changes
added 144 changesets with 127 changes to 20 files (+3 heads)
updating working directory
10 files updated, 0 files merged, 0 files removed, 0 files unresolved
utility:~/workspace/rabbit$ hg clone http://hg.rabbitmq.com/rabbitmq-c
rabbitmq-c-default
requesting all changes
adding changesets
adding manifests
adding file changes
added 176 changesets with 517 changes to 79 files (+2 heads)
updating working directory
76 files updated, 0 files merged, 0 files removed, 0 files unresolved
utility:~/workspace/rabbit$ cd rabbitmq-c-default/
utility:~/workspace/rabbit/rabbitmq-c-default$ ln -s ../codegen-default
codegen
utility:~/workspace/rabbit/rabbitmq-c-default$ autoreconf -i
configure.ac:3: installing `./missing'
configure.ac:3: installing `./install-sh'
examples/Makefile.am: installing `./depcomp'
utility:~/workspace/rabbit/rabbitmq-c-default$ ./configure
[configure succeeds]
utility:~/workspace/rabbit/rabbitmq-c-default$ make
make  all-recursive
make[1]: Entering directory
`/home/pdezwart/workspace/rabbit/rabbitmq-c-default'
Making all in librabbitmq
make[2]: Entering directory
`/home/pdezwart/workspace/rabbit/rabbitmq-c-default/librabbitmq'
PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen python
./codegen.py header
/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp-rabbitmq-0.8
.json amqp_framing.h
Traceback (most recent call last):
  File "./codegen.py", line 490, in <module>
    do_main(generateHrl, generateErl)
  File 
"/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
, line 263, in do_main
    do_main_dict({"header": header_fn, "body": body_fn})
  File 
"/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
, line 298, in do_main_dict
    execute(funcDict[function], sources, dest)
  File 
"/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
, line 277, in execute
    fn(amqp_specs)
  File "./codegen.py", line 487, in generateHrl
    genHrl(AmqpSpec(specPath))
  File 
"/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
, line 155, in __init__
    self.major = self.spec['major-version']
KeyError: 'major-version'
make[2]: *** [amqp_framing.h] Error 1
make[2]: Leaving directory
`/home/pdezwart/workspace/rabbit/rabbitmq-c-default/librabbitmq'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory
`/home/pdezwart/workspace/rabbit/rabbitmq-c-default'
make: *** [all] Error 2


And:
utility:~/workspace/rabbit/rabbitmq-c-default$ python --version
Python 2.5.2

Where is my screwup? =(

Thanks,
Pieter


On 8/15/10 2:08 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:

> Hi,
> 
> Could you please try again with:
>   * rabbitmq-codegen default, and
>   * rabbimtq-c default.
> 
> This should work and you give you a 0-8 client.
> 
> Cheers,
> Alex
> 
> On Sat, Aug 14, 2010 at 11:42:40PM -0700, Pieter de Zwart wrote:
>> Hey guys,
>> 
>> I freely admit that I am an idiot, but I could use some help. I am trying to
>> get some combination of rabbitmq-c and codegen to compile on my box (FC8 ?
>> old, I know,) and it wont behave. I am using
>> http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94 (amqp_0_8 tag) and
>> http://hg.rabbitmq.com/rabbitmq-codegen/rev/d1b197ff0c5d (rabbitmq_v_1_8_0)
>> and I keep on getting:
>> 
>> utility:~/workspace/rabbit/rabbitmq-c-0.8$ make
>> make  all-recursive
>> make[1]: Entering directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
>> Making all in librabbitmq
>> make[2]: Entering directory
>> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
>> PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen python
>> ./codegen.py header
>> /home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp-rabbitmq-0.8.jso
>> n amqp_framing.h
>> Traceback (most recent call last):
>>   File "./codegen.py", line 490, in <module>
>>     do_main(generateHrl, generateErl)
>>   File
>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>> line 263, in do_main
>>     do_main_dict({"header": header_fn, "body": body_fn})
>>   File
>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>> line 298, in do_main_dict
>>     execute(funcDict[function], sources, dest)
>>   File
>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>> line 277, in execute
>>     fn(amqp_specs)
>>   File "./codegen.py", line 487, in generateHrl
>>     genHrl(AmqpSpec(specPath))
>>   File
>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>> line 155, in __init__
>>     self.major = self.spec['major-version']
>> KeyError: 'major-version'
>> make[2]: *** [amqp_framing.h] Error 1
>> make[2]: Leaving directory
>> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
>> make[1]: *** [all-recursive] Error 1
>> make[1]: Leaving directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
>> make: *** [all] Error 2
>> 
>> What am I doing wrong?! What is the current secret magic incantation?
>> 
>> Thanks,
>> Pieter
> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


From pdezwart at rubiconproject.com  Mon Aug 16 08:04:09 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 16 Aug 2010 00:04:09 -0700
Subject: [rabbitmq-discuss] Compiling rabbitmq-c
In-Reply-To: <20100815090826.GA23736@dakota>
Message-ID: <C88E30FA.E190%pdezwart@rubiconproject.com>

Response may have been flagged as spam, so sending shell dump as attachment.

Thanks in advance for your help,
Pieter


On 8/15/10 2:08 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:

> Hi,
> 
> Could you please try again with:
>   * rabbitmq-codegen default, and
>   * rabbimtq-c default.
> 
> This should work and you give you a 0-8 client.
> 
> Cheers,
> Alex
> 
> On Sat, Aug 14, 2010 at 11:42:40PM -0700, Pieter de Zwart wrote:
>> > Hey guys,
>> >
>> > I freely admit that I am an idiot, but I could use some help. I am trying
>> to
>> > get some combination of rabbitmq-c and codegen to compile on my box (FC8 ?
>> > old, I know,) and it wont behave. I am using
>> > http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94 (amqp_0_8 tag) and
>> > http://hg.rabbitmq.com/rabbitmq-codegen/rev/d1b197ff0c5d (rabbitmq_v_1_8_0)
>> > and I keep on getting:
>> >
>> > utility:~/workspace/rabbit/rabbitmq-c-0.8$ make
>> > make  all-recursive
>> > make[1]: Entering directory
>> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
>> > Making all in librabbitmq
>> > make[2]: Entering directory
>> > `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
>> > PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen python
>> > ./codegen.py header
>> > 
>> /home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp-rabbitmq-0.8.jso
>> > n amqp_framing.h
>> > Traceback (most recent call last):
>> >   File "./codegen.py", line 490, in <module>
>> >     do_main(generateHrl, generateErl)
>> >   File
>> > "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>> > line 263, in do_main
>> >     do_main_dict({"header": header_fn, "body": body_fn})
>> >   File
>> > "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>> > line 298, in do_main_dict
>> >     execute(funcDict[function], sources, dest)
>> >   File
>> > "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>> > line 277, in execute
>> >     fn(amqp_specs)
>> >   File "./codegen.py", line 487, in generateHrl
>> >     genHrl(AmqpSpec(specPath))
>> >   File
>> > "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>> > line 155, in __init__
>> >     self.major = self.spec['major-version']
>> > KeyError: 'major-version'
>> > make[2]: *** [amqp_framing.h] Error 1
>> > make[2]: Leaving directory
>> > `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
>> > make[1]: *** [all-recursive] Error 1
>> > make[1]: Leaving directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
>> > make: *** [all] Error 2
>> >
>> > What am I doing wrong?! What is the current secret magic incantation?
>> >
>> > Thanks,
>> > Pieter
> 
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
the rubicon project

PIETER DE ZWART | INTERFACES TEAM, LEAD ENGINEER
??? P 310 207 0272 | x224
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100816/1b5ed9c8/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100816/1b5ed9c8/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq.txt
Type: application/octet-stream
Size: 2698 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100816/1b5ed9c8/attachment-0001.obj>

From Alister.Morton at tradition.com  Mon Aug 16 10:10:37 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 16 Aug 2010 10:10:37 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <4C68B781.3090707@rabbitmq.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
	<4C68AB05.8040003@rabbitmq.com>
	<3F4B38CF-80CB-4621-9108-A328F2365D52@yahoo.com>
	<4C68B781.3090707@rabbitmq.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891068355325792@SVR-2K3-BH-EMC.tradition.int>

> So this then becomes a question of deciding when publishing is "too slow", and being able to continue

I think conceptually it's different - it's a matter of is the broker running "normally" albeit really slowly (that's ok, we'll live with it) or has the broker said "Enough!" and sent a flow control message. That ought to be a detectable condition, and is fundamentally different to a broker simply crawling to a halt.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From alexandru at rabbitmq.com  Mon Aug 16 10:27:39 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 16 Aug 2010 10:27:39 +0100
Subject: [rabbitmq-discuss] Compiling rabbitmq-c
In-Reply-To: <C88E2F8C.E18D%pdezwart@rubiconproject.com>
References: <20100815090826.GA23736@dakota>
	<C88E2F8C.E18D%pdezwart@rubiconproject.com>
Message-ID: <20100816092739.GA2958@dakota.eng.vmware.com>

Sorry, but I can't reproduce your problem.

Running that exact sequence of commands works fine for me with both
python-2.5.4 and python-2.6.5.

What distribution are you using and could you try upgrading to a more
recent version of Python?


Alex

On Sun, Aug 15, 2010 at 11:58:04PM -0700, Pieter de Zwart wrote:
> utility:~/workspace/rabbit$ hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> codegen-default
> requesting all changes
> adding changesets
> adding manifests
> adding file changes
> added 144 changesets with 127 changes to 20 files (+3 heads)
> updating working directory
> 10 files updated, 0 files merged, 0 files removed, 0 files unresolved
> utility:~/workspace/rabbit$ hg clone http://hg.rabbitmq.com/rabbitmq-c
> rabbitmq-c-default
> requesting all changes
> adding changesets
> adding manifests
> adding file changes
> added 176 changesets with 517 changes to 79 files (+2 heads)
> updating working directory
> 76 files updated, 0 files merged, 0 files removed, 0 files unresolved
> utility:~/workspace/rabbit$ cd rabbitmq-c-default/
> utility:~/workspace/rabbit/rabbitmq-c-default$ ln -s ../codegen-default
> codegen
> utility:~/workspace/rabbit/rabbitmq-c-default$ autoreconf -i
> configure.ac:3: installing `./missing'
> configure.ac:3: installing `./install-sh'
> examples/Makefile.am: installing `./depcomp'
> utility:~/workspace/rabbit/rabbitmq-c-default$ ./configure
> [configure succeeds]
> utility:~/workspace/rabbit/rabbitmq-c-default$ make
> make  all-recursive
> make[1]: Entering directory
> `/home/pdezwart/workspace/rabbit/rabbitmq-c-default'
> Making all in librabbitmq
> make[2]: Entering directory
> `/home/pdezwart/workspace/rabbit/rabbitmq-c-default/librabbitmq'
> PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen python
> ./codegen.py header
> /home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp-rabbitmq-0.8
> .json amqp_framing.h
> Traceback (most recent call last):
>   File "./codegen.py", line 490, in <module>
>     do_main(generateHrl, generateErl)
>   File 
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
> , line 263, in do_main
>     do_main_dict({"header": header_fn, "body": body_fn})
>   File 
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
> , line 298, in do_main_dict
>     execute(funcDict[function], sources, dest)
>   File 
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
> , line 277, in execute
>     fn(amqp_specs)
>   File "./codegen.py", line 487, in generateHrl
>     genHrl(AmqpSpec(specPath))
>   File 
> "/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
> , line 155, in __init__
>     self.major = self.spec['major-version']
> KeyError: 'major-version'
> make[2]: *** [amqp_framing.h] Error 1
> make[2]: Leaving directory
> `/home/pdezwart/workspace/rabbit/rabbitmq-c-default/librabbitmq'
> make[1]: *** [all-recursive] Error 1
> make[1]: Leaving directory
> `/home/pdezwart/workspace/rabbit/rabbitmq-c-default'
> make: *** [all] Error 2
> 
> 
> And:
> utility:~/workspace/rabbit/rabbitmq-c-default$ python --version
> Python 2.5.2
> 
> Where is my screwup? =(
> 
> Thanks,
> Pieter
> 
> 
> On 8/15/10 2:08 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:
> 
> > Hi,
> > 
> > Could you please try again with:
> >   * rabbitmq-codegen default, and
> >   * rabbimtq-c default.
> > 
> > This should work and you give you a 0-8 client.
> > 
> > Cheers,
> > Alex
> > 
> > On Sat, Aug 14, 2010 at 11:42:40PM -0700, Pieter de Zwart wrote:
> >> Hey guys,
> >> 
> >> I freely admit that I am an idiot, but I could use some help. I am trying to
> >> get some combination of rabbitmq-c and codegen to compile on my box (FC8 ?
> >> old, I know,) and it wont behave. I am using
> >> http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94 (amqp_0_8 tag) and
> >> http://hg.rabbitmq.com/rabbitmq-codegen/rev/d1b197ff0c5d (rabbitmq_v_1_8_0)
> >> and I keep on getting:
> >> 
> >> utility:~/workspace/rabbit/rabbitmq-c-0.8$ make
> >> make  all-recursive
> >> make[1]: Entering directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
> >> Making all in librabbitmq
> >> make[2]: Entering directory
> >> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
> >> PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen python
> >> ./codegen.py header
> >> /home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp-rabbitmq-0.8.jso
> >> n amqp_framing.h
> >> Traceback (most recent call last):
> >>   File "./codegen.py", line 490, in <module>
> >>     do_main(generateHrl, generateErl)
> >>   File
> >> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> >> line 263, in do_main
> >>     do_main_dict({"header": header_fn, "body": body_fn})
> >>   File
> >> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> >> line 298, in do_main_dict
> >>     execute(funcDict[function], sources, dest)
> >>   File
> >> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> >> line 277, in execute
> >>     fn(amqp_specs)
> >>   File "./codegen.py", line 487, in generateHrl
> >>     genHrl(AmqpSpec(specPath))
> >>   File
> >> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
> >> line 155, in __init__
> >>     self.major = self.spec['major-version']
> >> KeyError: 'major-version'
> >> make[2]: *** [amqp_framing.h] Error 1
> >> make[2]: Leaving directory
> >> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
> >> make[1]: *** [all-recursive] Error 1
> >> make[1]: Leaving directory `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
> >> make: *** [all] Error 2
> >> 
> >> What am I doing wrong?! What is the current secret magic incantation?
> >> 
> >> Thanks,
> >> Pieter
> > 
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> 

From matthias at rabbitmq.com  Mon Aug 16 10:28:29 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Aug 2010 10:28:29 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891068355325792@SVR-2K3-BH-EMC.tradition.int>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>	<4C68AB05.8040003@rabbitmq.com>	<3F4B38CF-80CB-4621-9108-A328F2365D52@yahoo.com>
	<4C68B781.3090707@rabbitmq.com>
	<5A46D132C446C04B9EFE8AD14E7891068355325792@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <4C6904BD.4020100@rabbitmq.com>

Alister,

On 16/08/10 10:10, Alister Morton wrote:
>> So this then becomes a question of deciding when publishing is "too
>> slow", and being able to continue
>
> I think conceptually it's different - it's a matter of is the broker
> running "normally" albeit really slowly (that's ok, we'll live with
> it) or has the broker said "Enough!" and sent a flow control message.
> That ought to be a detectable condition, and is fundamentally
> different to a broker simply crawling to a halt.

RabbitMQ could gradually decrease its message acceptance rate as memory 
gets tighter. To the point when just before it reaches the memory 
threshold it, say, is only accepting messages at a rate of 0.01Hz. And 
then, finally, it stops accepting messages altogether. Is that last, 
minuscule change fundamentally different? I don't think so.

Also, from an application's point of view, what would an app do 
differently in response to the broker (or network) running, really, 
really, slowly vs not accepting messages at all? In both cases it is 
left holding the baby, er, message, i.e. it cannot get rid of it by 
placing it on the network stack.


Regards,

Matthias.

From matthew at rabbitmq.com  Mon Aug 16 11:30:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 16 Aug 2010 11:30:18 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
 topics/queues
In-Reply-To: <20100815101257.GA4835@wellquite.org>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
Message-ID: <20100816103018.GA16525@rabbitmq.com>

On Sun, Aug 15, 2010 at 11:12:58AM +0100, Matthew Sackman wrote:
> And after about a dozen hours combined of debugging and head scratching,
> we've found what the problem was, and fixed it. The fix is yet to go
> through QA, so please compile from the server branch "bug23129" to test.

It's now on default. Please pull, recompile the default branch and test
at your leisure!

Matthew

From orhan at tart.com.tr  Mon Aug 16 13:45:51 2010
From: orhan at tart.com.tr (Orhan Kavrakoglu)
Date: Mon, 16 Aug 2010 15:45:51 +0300
Subject: [rabbitmq-discuss] Subscribing to a queue regardless of its
 parameters (auto-delete, ack, etc.)
In-Reply-To: <4C627DD4.30006@tart.com.tr>
References: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>
	<4C627DD4.30006@tart.com.tr>
Message-ID: <4C6932FF.4000109@tart.com.tr>

I didn't seem to get a response to the following question. Did I do 
something wrong? (Or am I just too impatient?)

On 2010-08-11 13:39, Orhan Kavrakoglu wrote:
> I have a client-side library (modified PHP Zend_Queue classes over the 
> STOMP adapter) which I use to subscribe to some queues. However, the 
> interface provided by the STOMP adapter seems to want the exact 
> parameters a queue was created with in order to subscribe to it. (That 
> is, if a queue was created with the non-default "auto-delete: false" 
> parameter, you have to specify "auto-delete: false" when subscribing 
> to it.) This complicates the client code, especially given that the 
> queue was created in a Java program somewhere else. Is there a way to 
> work around this?
>
> Either a "subscribe regardless of parameters" command or some way to 
> get a queue's parameters would work. I haven't checked if libamqp has 
> either, because I couldn't find a PHP implementation that works on 
> Windows (which half our developers are using).
>


From matthias at rabbitmq.com  Mon Aug 16 13:54:51 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Aug 2010 13:54:51 +0100
Subject: [rabbitmq-discuss] Subscribing to a queue regardless of its
 parameters (auto-delete, ack, etc.)
In-Reply-To: <4C6932FF.4000109@tart.com.tr>
References: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>	<4C627DD4.30006@tart.com.tr>
	<4C6932FF.4000109@tart.com.tr>
Message-ID: <4C69351B.5060705@rabbitmq.com>

Orhan,

On 16/08/10 13:45, Orhan Kavrakoglu wrote:
> I didn't seem to get a response to the following question. Did I do
> something wrong? (Or am I just too impatient?)

I replied a few days ago:

http://old.nabble.com/Re%3A-Subscribing-to-a-queue-regardless-of-its-parameters-%28auto-delete%2C-ack%2C-etc.%29-p29429640.html


Regards,

Matthias.

From koolvivek2006 at gmail.com  Mon Aug 16 13:57:33 2010
From: koolvivek2006 at gmail.com (vivek agarwal)
Date: Mon, 16 Aug 2010 18:27:33 +0530
Subject: [rabbitmq-discuss] Query for asynchronous acknowledgment
Message-ID: <AANLkTinrmJfsNatV9FVHZSMzT=H=1V+xnzxp=X7ZJeF=@mail.gmail.com>

Hi,

As I find through my experiments on RabbitMQ, while consuming a message and
acknowledging the same, I have to do them through the same channel objects.

So, the thing is, I cannot transfer a message to different machine to
process it,  before I acknowledge.

Am I correct on this? If so, is there any way or future plan to acknowledge
a message, by just the delivery tag, or some other tag, which does not needs
to know of which channel it was received from?

Thanks,
Vivek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100816/175516d5/attachment.htm>

From matthew at rabbitmq.com  Mon Aug 16 13:59:39 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 16 Aug 2010 13:59:39 +0100
Subject: [rabbitmq-discuss] Query for asynchronous acknowledgment
In-Reply-To: <AANLkTinrmJfsNatV9FVHZSMzT=H=1V+xnzxp=X7ZJeF=@mail.gmail.com>
References: <AANLkTinrmJfsNatV9FVHZSMzT=H=1V+xnzxp=X7ZJeF=@mail.gmail.com>
Message-ID: <20100816125939.GC16525@rabbitmq.com>

On Mon, Aug 16, 2010 at 06:27:33PM +0530, vivek agarwal wrote:
> Am I correct on this?

You are.

> If so, is there any way or future plan to acknowledge
> a message, by just the delivery tag, or some other tag, which does not needs
> to know of which channel it was received from?

Nope. Delivery tags are scoped within channels. This is as defined by
the AMQP spec.

Matthew

From Alister.Morton at tradition.com  Mon Aug 16 14:08:25 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 16 Aug 2010 14:08:25 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <4C6904BD.4020100@rabbitmq.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
	<4C68AB05.8040003@rabbitmq.com>
	<3F4B38CF-80CB-4621-9108-A328F2365D52@yahoo.com>
	<4C68B781.3090707@rabbitmq.com>
	<5A46D132C446C04B9EFE8AD14E7891068355325792@SVR-2K3-BH-EMC.tradition.int>
	<4C6904BD.4020100@rabbitmq.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E789106835DAA4AEC@SVR-2K3-BH-EMC.tradition.int>

>>>
threshold it, say, is only accepting messages at a rate of 0.01Hz. And
then, finally, it stops accepting messages altogether. Is that last,
minuscule change fundamentally different? I don't think so.
<<<

Yes, absolutely, it is a different state. It may appear to the client as indistinguishable but it is, nonetheless, a distinct and identifiably different state. If a broker was down to accepting single message per minute, is that a problem if the client only contributes one message per week? Whereas if the broker has signalled "I absolutely cannot accept any messages at all" then this is an identifiably different situation and may require handling in a different way.

You may decide that so long as the broker is accepting messages at all, however slowly, that you will live with it. That's a decision for the client logic. Equally, you may decide that if and only if a broker has stopped messages completely via flow control then you want to send them elsewhere.

If a system is slowed to a crawl you can't know that it suddenly isn't going to clear. If a system has issued a stop, you know for certain that until told otherwise, nothing is moving. Fundamentally different situations.

I remember being told years ago, never confuse an observed effect (i.e. the system /appears/ to have stopped) with what is defined to be the case (i.e. we have been told to stop sending).

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From koolvivek2006 at gmail.com  Mon Aug 16 14:10:31 2010
From: koolvivek2006 at gmail.com (vivek agarwal)
Date: Mon, 16 Aug 2010 18:40:31 +0530
Subject: [rabbitmq-discuss] Query for asynchronous acknowledgment
In-Reply-To: <20100816125939.GC16525@rabbitmq.com>
References: <AANLkTinrmJfsNatV9FVHZSMzT=H=1V+xnzxp=X7ZJeF=@mail.gmail.com>
	<20100816125939.GC16525@rabbitmq.com>
Message-ID: <AANLkTikb5VJNG=5B3tmHc3UapiZqHdnP4BQG_6StjSe9@mail.gmail.com>

Thanks for the quick reply.

So, is there anyways to achieve asynchronous acknowledgment of data?
Again, I also wanted to know if there is a way to replicate data, to
increase the system's availability.

So that, if a node1 running RabbitMQ goes down, a slave comes up and works
like a master, so that all the queues and data on node1, are still
accessible?

Thanks,
Vivek



On Mon, Aug 16, 2010 at 6:29 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Mon, Aug 16, 2010 at 06:27:33PM +0530, vivek agarwal wrote:
> > Am I correct on this?
>
> You are.
>
> > If so, is there any way or future plan to acknowledge
> > a message, by just the delivery tag, or some other tag, which does not
> needs
> > to know of which channel it was received from?
>
> Nope. Delivery tags are scoped within channels. This is as defined by
> the AMQP spec.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100816/4fdb0dcf/attachment.htm>

From orhan at tart.com.tr  Mon Aug 16 14:25:55 2010
From: orhan at tart.com.tr (Orhan Kavrakoglu)
Date: Mon, 16 Aug 2010 16:25:55 +0300
Subject: [rabbitmq-discuss] Subscribing to a queue regardless of its
 parameters (auto-delete, ack, etc.)
In-Reply-To: <4C655EE6.1000207@rabbitmq.com>
References: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>	<4C627DD4.30006@tart.com.tr>
	<4C655EE6.1000207@rabbitmq.com>
Message-ID: <4C693C63.5040403@tart.com.tr>

On 2010-08-13 18:04, Matthias Radestock wrote:
> By setting "passive=true" in the header you should be able to make the 
> queue declaration passive, which means that all that matters is 
> whether the queue exists.
>
Ah, excellent. Thanks.

-- 
Orhan Kavrako?lu
orhan at tart.com.tr

Tart New Media
w : http://www.tart.com.tr
t : +90 212 265 0 666 / ext: 142
f : +90 212 263 93 93
a : Abd?lhak Molla Sok. No:42 Arnavutk?y / ?STANBUL


From orhan at tart.com.tr  Mon Aug 16 14:28:31 2010
From: orhan at tart.com.tr (Orhan Kavrakoglu)
Date: Mon, 16 Aug 2010 16:28:31 +0300
Subject: [rabbitmq-discuss] Subscribing to a queue regardless of its
 parameters (auto-delete, ack, etc.)
In-Reply-To: <4C69351B.5060705@rabbitmq.com>
References: <AANLkTin_AD68V=iGK3C5iiizFqERL0i2G=VDZqebUH+f@mail.gmail.com>	<4C627DD4.30006@tart.com.tr>	<4C6932FF.4000109@tart.com.tr>
	<4C69351B.5060705@rabbitmq.com>
Message-ID: <4C693CFF.7020804@tart.com.tr>

On 2010-08-16 15:54, Matthias Radestock wrote:
> On 16/08/10 13:45, Orhan Kavrakoglu wrote:
>> I didn't seem to get a response to the following question. Did I do
>> something wrong? (Or am I just too impatient?)
>
> I replied a few days ago: 

And now I see the problem. My question showed up as a reply in an 
unrelated thread because I'm an idiot.

-- 
Orhan Kavrako?lu
orhan at tart.com.tr

Tart New Media
w : http://www.tart.com.tr
t : +90 212 265 0 666 / ext: 142
f : +90 212 263 93 93
a : Abd?lhak Molla Sok. No:42 Arnavutk?y / ?STANBUL


From matthias at rabbitmq.com  Mon Aug 16 14:44:36 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Aug 2010 14:44:36 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <5A46D132C446C04B9EFE8AD14E789106835DAA4AEC@SVR-2K3-BH-EMC.tradition.int>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>	<4C68AB05.8040003@rabbitmq.com>	<3F4B38CF-80CB-4621-9108-A328F2365D52@yahoo.com>	<4C68B781.3090707@rabbitmq.com>	<5A46D132C446C04B9EFE8AD14E7891068355325792@SVR-2K3-BH-EMC.tradition.int>	<4C6904BD.4020100@rabbitmq.com>
	<5A46D132C446C04B9EFE8AD14E789106835DAA4AEC@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <4C6940C4.8060704@rabbitmq.com>

Alister,

On 16/08/10 14:08, Alister Morton wrote:
> If a system is slowed to a crawl you can't know that it suddenly
> isn't
going to clear. If a system has issued a stop, you know for certain that
until told otherwise, nothing is moving. Fundamentally different situations.

The memory condition that triggered channel.flow can clear just as 
quickly as any condition that caused a slow down.

> I remember being told years ago, never confuse an observed effect
(i.e. the system /appears/ to have stopped) with what is defined to be
the case (i.e. we have been told to stop sending).

The "appears to have stopped" which is observable as a slow-down in TCP 
operations is actually a manifestation of a "please stop sending" signal 
from the TCP layer, or rather a "I can't send any more because I've 
already sent as much as the other side can handle" signal. [I am 
simplifying and paraphrasing here]. The network stack doesn't magically 
stop sending data / block callers; some event/condition has to trigger that.

The OP wanted to prevent their publishing threads from stalling. The 
techniques I suggested to the OP in my original reply deal with *all* 
conditions that can cause that to happen.


Regards,

Matthias.

From Alister.Morton at tradition.com  Mon Aug 16 15:01:34 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 16 Aug 2010 15:01:34 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <4C6940C4.8060704@rabbitmq.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
	<4C68AB05.8040003@rabbitmq.com>
	<3F4B38CF-80CB-4621-9108-A328F2365D52@yahoo.com>
	<4C68B781.3090707@rabbitmq.com>
	<5A46D132C446C04B9EFE8AD14E7891068355325792@SVR-2K3-BH-EMC.tradition.int>
	<4C6904BD.4020100@rabbitmq.com>
	<5A46D132C446C04B9EFE8AD14E789106835DAA4AEC@SVR-2K3-BH-EMC.tradition.int>
	<4C6940C4.8060704@rabbitmq.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E789106835DAA4B21@SVR-2K3-BH-EMC.tradition.int>

> The memory condition that triggered channel.flow can clear just as
> quickly as any condition that caused a slow down.
Indeed so. In which case the stop would be removed.

I haven't looked closely at flow control; I'm possibly somewhat naively assuming that the broker sends distinct "xon/xoff" type messages to the client, rather than passively implementing flow control by simply not dequeueing data.

In the case of xon/xoff style flow control, then "stopped" is a distinct finite state and is precisely detectable (and I think it should be. If the spec doesn't allow for this then I'd say it's an omission but c'est la vie). In the case of passive flow control it's not really deterministic and you have to implement some sort of empirical "Well it /looks/ like it's stopped but who knows" fuzzy logic.

A bit like a turnpike that is clogged but moving very slowly - all you know it appears to be open so you have to make a value judgement on whether it's likely, on balance, to be worth it to join the slow traffic or to give up and find an alternative route. OTOH, if the road is closed, you KNOW with certainty that you have to look elsewhere.

One is a fuzzy best guess based on observations and inference, one is a state based decision.

Al

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From aaron at agoragames.com  Mon Aug 16 15:29:57 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 16 Aug 2010 10:29:57 -0400
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <4C68AB05.8040003@rabbitmq.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
	<4C68AB05.8040003@rabbitmq.com>
Message-ID: <AANLkTi=L_OD7gj4PeWS1wFaxzMx61MaRnb1LJF0+KcH1@mail.gmail.com>

On Sun, Aug 15, 2010 at 11:05 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> In some setups a higher threshold may be safe, but disabling flow control
> altogether is not advisable.

Could you elaborate on this a little more?  With enough disk and the
latest kernels, it seems that Linux will page Erlang correctly even if
its memory usage nears the quantity of RAM.  We're using monit on all
our hosts, so we'd know in advance of run-away memory usage, and can
take corrective action without flow control kicking in across our
entire infrastructure.  Things will be slow for sure, but in a shared
environment, we'd rather address the few mis-behaving clients than
shift the burden of memory management to all of our clients, which is
effectively what pausing client publishing is doing.

I could be mis-reading your recommendation though and the implications
of disabling flow control.

cheers,
Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthias at rabbitmq.com  Mon Aug 16 15:44:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Aug 2010 15:44:07 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <AANLkTi=L_OD7gj4PeWS1wFaxzMx61MaRnb1LJF0+KcH1@mail.gmail.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>	<4C68AB05.8040003@rabbitmq.com>
	<AANLkTi=L_OD7gj4PeWS1wFaxzMx61MaRnb1LJF0+KcH1@mail.gmail.com>
Message-ID: <4C694EB7.9010404@rabbitmq.com>

Aaron,

On 16/08/10 15:29, Aaron Westendorf wrote:
> On Sun, Aug 15, 2010 at 11:05 PM, Matthias Radestock
> <matthias at rabbitmq.com>  wrote:
>> In some setups a higher threshold may be safe, but disabling flow control
>> altogether is not advisable.
>
> Could you elaborate on this a little more?  With enough disk and the
> latest kernels, it seems that Linux will page Erlang correctly even if
> its memory usage nears the quantity of RAM.

If you can live with the massive performance degradation that swapping 
entails, and have plenty of swap configured, then disabling rabbit's 
memory monitoring is a viable alternative.

Though once the new persister is released, I don't see what you'd be 
gaining with that. The new persister provides a much more sophisticated 
and performant swapping mechanism than the kernel can provide.

> Things will be slow for sure, but in a shared
> environment, we'd rather address the few mis-behaving clients than
> shift the burden of memory management to all of our clients, which is
> effectively what pausing client publishing is doing.

Once rabbit starts swapping, clients will experience pauses in 
publishing anyway, through TCP backpressure.

By "shifting the burden of memory management" do you mean "having to 
deal with the channel.flow message"? The AMQP client library should take 
care of that.


Regards,

Matthias.

From aaron at agoragames.com  Mon Aug 16 16:04:23 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 16 Aug 2010 11:04:23 -0400
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <4C694EB7.9010404@rabbitmq.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
	<4C68AB05.8040003@rabbitmq.com>
	<AANLkTi=L_OD7gj4PeWS1wFaxzMx61MaRnb1LJF0+KcH1@mail.gmail.com>
	<4C694EB7.9010404@rabbitmq.com>
Message-ID: <AANLkTinPhR8iR-9OJ9hK8ceoYhnM+Eq=1P0Fxftd9GAa@mail.gmail.com>

On Mon, Aug 16, 2010 at 10:44 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> If you can live with the massive performance degradation that swapping
> entails, and have plenty of swap configured, then disabling rabbit's memory
> monitoring is a viable alternative.

We can, and we'd take corrective action once we saw that condition arise.

> Though once the new persister is released, I don't see what you'd be gaining
> with that. The new persister provides a much more sophisticated and
> performant swapping mechanism than the kernel can provide.

Really looking forward to this.  We've held off on deploying 1.8.x
because of the flow control changes, but plan to roll out because of
the new persister.  Will the persister only write to disk based on
vm_memory_high_watermark, or is there another control?

> Once rabbit starts swapping, clients will experience pauses in publishing
> anyway, through TCP backpressure.
>
> By "shifting the burden of memory management" do you mean "having to deal
> with the channel.flow message"? The AMQP client library should take care of
> that.

When I modded py-amqplib to support libevent, I didn't implement flow
control.  I see its value, but for our usage, implementing it would
only shift the backlog that's consuming memory from the Rabbit hosts
to the client hosts.  I do plan to add it back when I refactor our
work for publication, though we're still not likely use it.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthias at rabbitmq.com  Mon Aug 16 16:04:53 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Aug 2010 16:04:53 +0100
Subject: [rabbitmq-discuss] rabbitmq-public-umbrella fails to build due
 to	bql plugin, patch attached
In-Reply-To: <4C64FCD8.3070003@rabbitmq.com>
References: <E741D477-FB3D-4D7E-844E-3DE2DEA833EA@mozilla.com>
	<4C64FCD8.3070003@rabbitmq.com>
Message-ID: <4C695395.3090408@rabbitmq.com>

On 13/08/10 09:05, Emile Joubert wrote:
> we've opened a bug for this problem.

Fixed. A build of BQL from the latest 'default' branches of the hg repos 
should now work again.

Matthias.

From matthew at rabbitmq.com  Mon Aug 16 16:09:32 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 16 Aug 2010 16:09:32 +0100
Subject: [rabbitmq-discuss] Producers hanging when reaching high memory
 watermark on 1.8.1
In-Reply-To: <AANLkTinPhR8iR-9OJ9hK8ceoYhnM+Eq=1P0Fxftd9GAa@mail.gmail.com>
References: <D109E6B3-AA95-4919-BF44-22ACD0FB50D4@yahoo.com>
	<AANLkTin11YuNS-44xEQu4PboSMs7wF9ijivsxg=_eqtN@mail.gmail.com>
	<947FBBD1-E93F-453F-A6AD-3BE49EEE8852@yahoo.com>
	<4C68AB05.8040003@rabbitmq.com>
	<AANLkTi=L_OD7gj4PeWS1wFaxzMx61MaRnb1LJF0+KcH1@mail.gmail.com>
	<4C694EB7.9010404@rabbitmq.com>
	<AANLkTinPhR8iR-9OJ9hK8ceoYhnM+Eq=1P0Fxftd9GAa@mail.gmail.com>
Message-ID: <20100816150932.GD16525@rabbitmq.com>

On Mon, Aug 16, 2010 at 11:04:23AM -0400, Aaron Westendorf wrote:
> Really looking forward to this.  We've held off on deploying 1.8.x
> because of the flow control changes, but plan to roll out because of
> the new persister.  Will the persister only write to disk based on
> vm_memory_high_watermark, or is there another control?

It's vm_memory_high_watermark. There's no new control.

Matthew

From chen650 at yahoo.com  Mon Aug 16 18:42:21 2010
From: chen650 at yahoo.com (alex chen)
Date: Mon, 16 Aug 2010 10:42:21 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <20100816103018.GA16525@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
Message-ID: <766990.31259.qm@web31804.mail.mud.yahoo.com>

Matthew and Matthias,

Thanks a lot for fixing it so quickly!   It is greatly appreciated!
I will run some tests today using the default branch.  will let you know the 
results asap.

-alex




----- Original Message ----
> From: Matthew Sackman <matthew at rabbitmq.com>
> To: alex chen <chen650 at yahoo.com>; rabbitmq-discuss at lists.rabbitmq.com
> Sent: Mon, August 16, 2010 3:30:18 AM
> Subject: Re: [rabbitmq-discuss] problem with new persiter with 1000 
>topics/queues
> 
> On Sun, Aug 15, 2010 at 11:12:58AM +0100, Matthew Sackman wrote:
> > And  after about a dozen hours combined of debugging and head scratching,
> >  we've found what the problem was, and fixed it. The fix is yet to go
> >  through QA, so please compile from the server branch "bug23129" to  test.
> 
> It's now on default. Please pull, recompile the default branch and  test
> at your leisure!
> 
> Matthew
> 


      

From pdezwart at rubiconproject.com  Mon Aug 16 18:44:45 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 16 Aug 2010 10:44:45 -0700
Subject: [rabbitmq-discuss] |Spam| Re:  Compiling rabbitmq-c
In-Reply-To: <20100816092739.GA2958@dakota.eng.vmware.com>
Message-ID: <C88EC71D.E1D1%pdezwart@rubiconproject.com>

Yup, python was the problem. Something between 2.5.2 and 2.5.4 was important
=)

Thanks guys,
Pieter


On 8/16/10 2:27 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:

> Sorry, but I can't reproduce your problem.
> 
> Running that exact sequence of commands works fine for me with both
> python-2.5.4 and python-2.6.5.
> 
> What distribution are you using and could you try upgrading to a more
> recent version of Python?
> 
> 
> Alex
> 
> On Sun, Aug 15, 2010 at 11:58:04PM -0700, Pieter de Zwart wrote:
>> > utility:~/workspace/rabbit$ hg clone
>> http://hg.rabbitmq.com/rabbitmq-codegen
>> > codegen-default
>> > requesting all changes
>> > adding changesets
>> > adding manifests
>> > adding file changes
>> > added 144 changesets with 127 changes to 20 files (+3 heads)
>> > updating working directory
>> > 10 files updated, 0 files merged, 0 files removed, 0 files unresolved
>> > utility:~/workspace/rabbit$ hg clone http://hg.rabbitmq.com/rabbitmq-c
>> > rabbitmq-c-default
>> > requesting all changes
>> > adding changesets
>> > adding manifests
>> > adding file changes
>> > added 176 changesets with 517 changes to 79 files (+2 heads)
>> > updating working directory
>> > 76 files updated, 0 files merged, 0 files removed, 0 files unresolved
>> > utility:~/workspace/rabbit$ cd rabbitmq-c-default/
>> > utility:~/workspace/rabbit/rabbitmq-c-default$ ln -s ../codegen-default
>> > codegen
>> > utility:~/workspace/rabbit/rabbitmq-c-default$ autoreconf -i
>> > configure.ac:3: installing `./missing'
>> > configure.ac:3: installing `./install-sh'
>> > examples/Makefile.am: installing `./depcomp'
>> > utility:~/workspace/rabbit/rabbitmq-c-default$ ./configure
>> > [configure succeeds]
>> > utility:~/workspace/rabbit/rabbitmq-c-default$ make
>> > make  all-recursive
>> > make[1]: Entering directory
>> > `/home/pdezwart/workspace/rabbit/rabbitmq-c-default'
>> > Making all in librabbitmq
>> > make[2]: Entering directory
>> > `/home/pdezwart/workspace/rabbit/rabbitmq-c-default/librabbitmq'
>> > PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen
>> python
>> > ./codegen.py header
>> > 
>> /home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp-rabbitmq-0.8
>> > .json amqp_framing.h
>> > Traceback (most recent call last):
>> >   File "./codegen.py", line 490, in <module>
>> >     do_main(generateHrl, generateErl)
>> >   File
>> > 
>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
>> > , line 263, in do_main
>> >     do_main_dict({"header": header_fn, "body": body_fn})
>> >   File
>> > 
>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
>> > , line 298, in do_main_dict
>> >     execute(funcDict[function], sources, dest)
>> >   File
>> > 
>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
>> > , line 277, in execute
>> >     fn(amqp_specs)
>> >   File "./codegen.py", line 487, in generateHrl
>> >     genHrl(AmqpSpec(specPath))
>> >   File
>> > 
>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-default/codegen/amqp_codegen.py"
>> > , line 155, in __init__
>> >     self.major = self.spec['major-version']
>> > KeyError: 'major-version'
>> > make[2]: *** [amqp_framing.h] Error 1
>> > make[2]: Leaving directory
>> > `/home/pdezwart/workspace/rabbit/rabbitmq-c-default/librabbitmq'
>> > make[1]: *** [all-recursive] Error 1
>> > make[1]: Leaving directory
>> > `/home/pdezwart/workspace/rabbit/rabbitmq-c-default'
>> > make: *** [all] Error 2
>> >
>> >
>> > And:
>> > utility:~/workspace/rabbit/rabbitmq-c-default$ python --version
>> > Python 2.5.2
>> >
>> > Where is my screwup? =(
>> >
>> > Thanks,
>> > Pieter
>> >
>> >
>> > On 8/15/10 2:08 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:
>> >
>>> > > Hi,
>>> > >
>>> > > Could you please try again with:
>>> > >   * rabbitmq-codegen default, and
>>> > >   * rabbimtq-c default.
>>> > >
>>> > > This should work and you give you a 0-8 client.
>>> > >
>>> > > Cheers,
>>> > > Alex
>>> > >
>>> > > On Sat, Aug 14, 2010 at 11:42:40PM -0700, Pieter de Zwart wrote:
>>>> > >> Hey guys,
>>>> > >>
>>>> > >> I freely admit that I am an idiot, but I could use some help. I am
>>>> trying to
>>>> > >> get some combination of rabbitmq-c and codegen to compile on my box
>>>> (FC8 ?
>>>> > >> old, I know,) and it wont behave. I am using
>>>> > >> http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94 (amqp_0_8 tag) and
>>>> > >> http://hg.rabbitmq.com/rabbitmq-codegen/rev/d1b197ff0c5d
>>>> (rabbitmq_v_1_8_0)
>>>> > >> and I keep on getting:
>>>> > >>
>>>> > >> utility:~/workspace/rabbit/rabbitmq-c-0.8$ make
>>>> > >> make  all-recursive
>>>> > >> make[1]: Entering directory
>>>> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
>>>> > >> Making all in librabbitmq
>>>> > >> make[2]: Entering directory
>>>> > >> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
>>>> > >> PYTHONPATH=/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen >>>>
python
>>>> > >> ./codegen.py header
>>>> > >> 
>>>> 
/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp-rabbitmq-0.8.jso
>>>> > >> n amqp_framing.h
>>>> > >> Traceback (most recent call last):
>>>> > >>   File "./codegen.py", line 490, in <module>
>>>> > >>     do_main(generateHrl, generateErl)
>>>> > >>   File
>>>> > >> 
>>>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>>>> > >> line 263, in do_main
>>>> > >>     do_main_dict({"header": header_fn, "body": body_fn})
>>>> > >>   File
>>>> > >> 
>>>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>>>> > >> line 298, in do_main_dict
>>>> > >>     execute(funcDict[function], sources, dest)
>>>> > >>   File
>>>> > >> 
>>>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>>>> > >> line 277, in execute
>>>> > >>     fn(amqp_specs)
>>>> > >>   File "./codegen.py", line 487, in generateHrl
>>>> > >>     genHrl(AmqpSpec(specPath))
>>>> > >>   File
>>>> > >> 
>>>> "/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/codegen/amqp_codegen.py",
>>>> > >> line 155, in __init__
>>>> > >>     self.major = self.spec['major-version']
>>>> > >> KeyError: 'major-version'
>>>> > >> make[2]: *** [amqp_framing.h] Error 1
>>>> > >> make[2]: Leaving directory
>>>> > >> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8/librabbitmq'
>>>> > >> make[1]: *** [all-recursive] Error 1
>>>> > >> make[1]: Leaving directory
>>>> `/home/pdezwart/workspace/rabbit/rabbitmq-c-0.8'
>>>> > >> make: *** [all] Error 2
>>>> > >>
>>>> > >> What am I doing wrong?! What is the current secret magic incantation?
>>>> > >>
>>>> > >> Thanks,
>>>> > >> Pieter
>>> > >
>>>> > >> _______________________________________________
>>>> > >> rabbitmq-discuss mailing list
>>>> > >> rabbitmq-discuss at lists.rabbitmq.com
>>>> > >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> > >
>>> > >
>> >
> 




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100816/fd18f0ec/attachment.htm>

From david at rabbitmq.com  Mon Aug 16 18:50:30 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 16 Aug 2010 18:50:30 +0100
Subject: [rabbitmq-discuss] Compiling rabbitmq-c
In-Reply-To: <C88E30FA.E190%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Mon, 16 Aug 2010 00:04:09 -0700")
References: <C88E30FA.E190%pdezwart@rubiconproject.com>
Message-ID: <yrv4cy6c6bg61.fsf@dwragg.eng.vmware.com>

Hi Peter,

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> Response may have been flagged as spam, so sending shell dump as
> attachment.

I just followed your shell commands exactly on a fresh F8 install, and
rabbitmq-c built fine, so I think the explanation for your issue lies outside
of rabbitmq-c.

(I'll hoped to test today against a fully updated F8, but "yum update"
it taking several hours.)

It's very hard to suggest what the cause might be.  The error indicates
that the "major-version" field is missing from the dictionary resulting
from parsing amqp-rabbitmq-0.8.json.  Yet it is plainly present in the
file.  This suggests that something is very odd about your python, or
python-simplejson module.  Do you have any other F8 machines on which
you are able to reproduce this?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From pdezwart at rubiconproject.com  Mon Aug 16 18:58:08 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 16 Aug 2010 10:58:08 -0700
Subject: [rabbitmq-discuss] Compiling rabbitmq-c
In-Reply-To: <yrv4cy6c6bg61.fsf@dwragg.eng.vmware.com>
Message-ID: <C88ECA40.E1DD%pdezwart@rubiconproject.com>

Hey David,

Thanks for working so hard on this. It turns out that Python was the
culprit. The compilation process requires something greater than 2.5.2. I
don?t know what version that is, but 2.7 worked nicely for me in the end.

Thanks for all of your help! Now back to fixing the PHP client =)
Pieter


On 8/16/10 10:50 AM, "David Wragg" <david at rabbitmq.com> wrote:

> Hi Peter,
> 
> Pieter de Zwart <pdezwart at rubiconproject.com> writes:
>> > Response may have been flagged as spam, so sending shell dump as
>> > attachment.
> 
> I just followed your shell commands exactly on a fresh F8 install, and
> rabbitmq-c built fine, so I think the explanation for your issue lies outside
> of rabbitmq-c.
> 
> (I'll hoped to test today against a fully updated F8, but "yum update"
> it taking several hours.)
> 
> It's very hard to suggest what the cause might be.  The error indicates
> that the "major-version" field is missing from the dictionary resulting
> from parsing amqp-rabbitmq-0.8.json.  Yet it is plainly present in the
> file.  This suggests that something is very odd about your python, or
> python-simplejson module.  Do you have any other F8 machines on which
> you are able to reproduce this?
> 
> David
> 
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100816/f0383366/attachment.htm>

From clegnitto at mozilla.com  Mon Aug 16 23:18:57 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 16 Aug 2010 15:18:57 -0700
Subject: [rabbitmq-discuss] RabbitMQ hanging on "starting queue supervisor
	and queue recovery" after system went down (using new persister)
Message-ID: <C597EA24-79DE-4767-9F0B-BB7410237A56@mozilla.com>

All:

I've been running default with the new persister. I went away for the weekend and saw that my RabbitMQ instance died (not sure what happened, doesn't look to be in logs). In any case, I went to restart the server and it was hanging at "starting queue supervisor and queue recovery". The VM this on isn't speedy but I let it go for ~30 mins. I moved the mnesia db out of the way, tried again,  and it started instantly.

I can send the mnesia db, but it is very large. I didn't have many queues (3?) but each probably had thousands (or even 100k+ messages) queued up.

Thanks,
Christian

From chen650 at yahoo.com  Tue Aug 17 08:21:41 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 17 Aug 2010 00:21:41 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <766990.31259.qm@web31804.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
Message-ID: <597082.60604.qm@web31809.mail.mud.yahoo.com>

Matthew,

Thanks to the fix you put in to the default branch, our test showed that it was 
able  to consume 10 GB of messages without any errors.

however, there is unexpected memory usage when consuming from 200 GB of backed 
up data.
first, when i tried to publish to 1000 topics/queues, when the queue size 
reached 100 GB, the memory usage would grow to 4GB.  our system has 8 GB of 
RAM.  with the default high watermark of 0.4, the broker started to throttle the 
publisher.  the publish rate would drop from 80 MB/sec to 10 MB/sec.  when queue 
size reached 200 GB, i started the consumer,  then the memory usage would grow 
to 10 GB.  the system started swapping and the consume rate dropped from 30 
MB/sec to < 10 MB/sec.

later i tried to increase the high watermark to 0.7.  the max mem usage for 
broker reached around 6.6 GB while publishing to 200 GB.  for some reason the 
throttling did not occur, so the publish rate maintained at 80 MB/sec.  however, 
when starting to consume the messages from 200 GB, the mem usage would still 
reach 10 GB.  the system started swapping, the consume rate dropped from 30 
MB/sec to 20 MB/sec.  it is better than the 0.4 watermark case.

these tests were run with 1000 topics/queues.  if i decrease the topics to 100,. 
the broker's mem usage would remain below 3GB, even when the data size reached 
200 GB.

any idea on how to decrease the usage of broker for the 1000 topics case?  i am 
not sure if it is caused by a bug, or it is something that cannot be avoided.
thanks.

-alex




----- Original Message ----
> From: alex chen <chen650 at yahoo.com>
> To: Matthew Sackman <matthew at rabbitmq.com>; 
rabbitmq-discuss at lists.rabbitmq.com
> Sent: Mon, August 16, 2010 10:42:21 AM
> Subject: Re: [rabbitmq-discuss] problem with new persiter with 1000 
>topics/queues
> 
> Matthew and Matthias,
> 
> Thanks a lot for fixing it so quickly!   It is  greatly appreciated!
> I will run some tests today using the default  branch.  will let you know the 
> results  asap.
> 
> -alex


      

From jiri at krutil.com  Tue Aug 17 08:36:32 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Tue, 17 Aug 2010 09:36:32 +0200
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <597082.60604.qm@web31809.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
Message-ID: <20100817093632.61664pueomxsmw4k@webmail.active24.cz>

Hi all

I was wondering if it is possible to configure the broker in a way  
that it will authenticate clients connecting over SSL using the client  
certificate only, without username and password?

Let's say the client connects over SSL and presents a signed  
certificate containing the client user name in the certificate  
subject's Common Name. If the broker can establish a chain of trust to  
a configured root CA cert, the client identity is verified, which in  
my opinion completes the authentication. It then does not really make  
sense to require a username and a password.

Imagine a client connects using a trusted certificate for client A,  
but then provides a valid username/password combination for client B.  
Which client is it then?

As far as I know, Apache Qpid supports such certificate-based authentication.

Cheers
Jiri


From matthias at rabbitmq.com  Tue Aug 17 10:35:31 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 17 Aug 2010 10:35:31 +0100
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <20100817093632.61664pueomxsmw4k@webmail.active24.cz>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>	<4C65FC4E.8070804@rabbitmq.com>
	<4C66AA9F.1000006@rabbitmq.com>	<20100815101257.GA4835@wellquite.org>	<20100816103018.GA16525@rabbitmq.com>	<766990.31259.qm@web31804.mail.mud.yahoo.com>	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817093632.61664pueomxsmw4k@webmail.active24.cz>
Message-ID: <4C6A57E3.6070402@rabbitmq.com>

Jiri,

On 17/08/10 08:36, jiri at krutil.com wrote:
> I was wondering if it is possible to configure the broker in a way that
> it will authenticate clients connecting over SSL using the client
> certificate only, without username and password?

This has been considered, but there are no concrete implementation plans 
for such a feature.

> Let's say the client connects over SSL and presents a signed certificate
> containing the client user name in the certificate subject's Common
> Name. If the broker can establish a chain of trust to a configured root
> CA cert, the client identity is verified, which in my opinion completes
> the authentication. It then does not really make sense to require a
> username and a password.

In some specific use cases you might indeed want to associate AMQP user 
identifies with a certificate's CN. In the general case though you'd 
probably want to allow for a many-to-many mapping.

> Imagine a client connects using a trusted certificate for client A, but
> then provides a valid username/password combination for client B. Which
> client is it then?

Neither the certificate not the username/password carry intrinsically 
identify a client. That identification is only the result of a specific 
interpretation of the data. The way one chooses to interpret the 
information determines whether particular combinations make sense or 
not. So, for example, a CN might identify an organisation and the 
username/password a particular application or individual within that 
organisation. Many other interpretations are possible.


Regards,

Matthias.

From jiri at krutil.com  Tue Aug 17 10:46:08 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Tue, 17 Aug 2010 11:46:08 +0200
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <4C6A57E3.6070402@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817093632.61664pueomxsmw4k@webmail.active24.cz>
	<4C6A57E3.6070402@rabbitmq.com>
Message-ID: <20100817114608.585123v33s43xnxc@webmail.active24.cz>

Matthias,

> In some specific use cases you might indeed want to associate AMQP  
> user identifies with a certificate's CN. In the general case though  
> you'd probably want to allow for a many-to-many mapping.

I understand that certificate-based authentication cannot be used by  
default. It could however be supported as an alternative to  
username/password authentication.

I can imagine that extracting the username from the certificate  
subject could also be made configurable, for example using a custom  
function that takes the subject data and returns the username.

> This has been considered, but there are no concrete implementation  
> plans for such a feature.

Any chance this will be implemented? I believe this feature would  
increase the level of security required by some enterprise applications.

Cheers,
Jiri


From michaelburns1 at gmail.com  Tue Aug 17 11:05:56 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Tue, 17 Aug 2010 11:05:56 +0100
Subject: [rabbitmq-discuss] connecting after exchange restart
Message-ID: <AANLkTin+jyd9S8mgmWgV_E5WKszvKzUTB3h=jrzBBbR=@mail.gmail.com>

Hi,
We have a problem whereby if the exchange is restarted then
QueueingConsumer.nextDelivery() always  throws  ShutDownSignalException:

com.rabbitmq.client.ShutdownSignalException: clean channel shutdown; reason:
#method<channel.close>(reply-code=200,reply-text=OK,class-id=0,method-id=0)


Is there any way we can reconnect automatically our does the reconnect logic
need to be handled in our application?

Many Thanks
Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100817/29f3a673/attachment-0001.htm>

From matthias at rabbitmq.com  Tue Aug 17 11:56:46 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 17 Aug 2010 11:56:46 +0100
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <20100817114608.585123v33s43xnxc@webmail.active24.cz>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>	<4C65FC4E.8070804@rabbitmq.com>
	<4C66AA9F.1000006@rabbitmq.com>	<20100815101257.GA4835@wellquite.org>	<20100816103018.GA16525@rabbitmq.com>	<766990.31259.qm@web31804.mail.mud.yahoo.com>	<597082.60604.qm@web31809.mail.mud.yahoo.com>	<20100817093632.61664pueomxsmw4k@webmail.active24.cz>	<4C6A57E3.6070402@rabbitmq.com>
	<20100817114608.585123v33s43xnxc@webmail.active24.cz>
Message-ID: <4C6A6AEE.8070601@rabbitmq.com>

Jiri,

On 17/08/10 10:46, jiri at krutil.com wrote:
> Any chance this will be implemented?

I've filed a bug for it. But I don't expect we'll work on this any time 
soon. Perhaps you could try coming up with a patch?


Matthias.

From alexandru at rabbitmq.com  Tue Aug 17 12:45:12 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 17 Aug 2010 12:45:12 +0100
Subject: [rabbitmq-discuss] connecting after exchange restart
In-Reply-To: <AANLkTin+jyd9S8mgmWgV_E5WKszvKzUTB3h=jrzBBbR=@mail.gmail.com>
References: <AANLkTin+jyd9S8mgmWgV_E5WKszvKzUTB3h=jrzBBbR=@mail.gmail.com>
Message-ID: <20100817114512.GA2733@dakota.eng.vmware.com>

Hi Michael,

> We have a problem whereby if the exchange is restarted then
> QueueingConsumer.nextDelivery() always  throws  ShutDownSignalException:
> 
> com.rabbitmq.client.ShutdownSignalException: clean channel shutdown; reason:
> #method<channel.close>(reply-code=200,reply-text=OK,class-id=0,method-id=0)
> 
> Is there any way we can reconnect automatically our does the reconnect logic
> need to be handled in our application?

Reconnect logic needs to be handled by the application.  If the
connection dies you have to redo everything up-to and including
declaring the QueueingConsumer.

Cheers,
Alex


From newsjimi at gmail.com  Tue Aug 17 16:08:05 2010
From: newsjimi at gmail.com (Jimi riblei)
Date: Tue, 17 Aug 2010 17:08:05 +0200
Subject: [rabbitmq-discuss] rabbitmq-jsonrpc
Message-ID: <AANLkTimNyaa4fSEznSGS9_4RrNv9U96ytunu7=Qf7to_@mail.gmail.com>

Hello All,
I would like try?rabbitmq-jsonrpc , but when I going to
hg.opensource.lshift.net/erlang-rfc462

I've the follow error:

 hg clone http://hg.opensource.lshift.net/erlang-rfc4627/
destination directory: erlang-rfc4627
abort: HTTP Error 404: Not Found

Do You have changed source repository?

Tnks
J.

From matthew at rabbitmq.com  Tue Aug 17 18:17:21 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 17 Aug 2010 18:17:21 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
 topics/queues
In-Reply-To: <597082.60604.qm@web31809.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
Message-ID: <20100817171720.GL16525@rabbitmq.com>

Hi Alex,

On Tue, Aug 17, 2010 at 12:21:41AM -0700, alex chen wrote:
> however, there is unexpected memory usage when consuming from 200 GB of backed 
> up data.
> first, when i tried to publish to 1000 topics/queues, when the queue size 
> reached 100 GB, the memory usage would grow to 4GB.  our system has 8 GB of 
> RAM.  with the default high watermark of 0.4, the broker started to throttle the 
> publisher.  the publish rate would drop from 80 MB/sec to 10 MB/sec.

Hmm, that's unfortunate. Really, you should only be bound by disk write
speed at that point, and I'm sure your disks can do more than 10MB/sec.
You might try tuning the msg_store_file_size_limit setting: the default
is 16777216 (i.e. 16MB), but try pushing that up to 67108864 (i.e. 64MB)
and you might find Rabbit can drive the disks harder. You'll need to do
that in rabbitmq.config with something like:

[{rabbit, [{msg_store_file_size_limit, 67108864}]}].

> when queue 
> size reached 200 GB, i started the consumer,  then the memory usage would grow 
> to 10 GB.  the system started swapping and the consume rate dropped from 30 
> MB/sec to < 10 MB/sec.

We can reproduce that here. I have a few theories about this, but it's
really pending more testing and debugging. Is there any chance you could
send us your test code - it'd be good to see exactly what you're doing?

> later i tried to increase the high watermark to 0.7.  the max mem usage for 
> broker reached around 6.6 GB while publishing to 200 GB.  for some reason the 
> throttling did not occur, so the publish rate maintained at 80 MB/sec.  however, 
> when starting to consume the messages from 200 GB, the mem usage would still 
> reach 10 GB.  the system started swapping, the consume rate dropped from 30 
> MB/sec to 20 MB/sec.  it is better than the 0.4 watermark case.

Mmm. Try seeing what happens if you reduce the high watermark to 0.2 or
lower - yes, publishing will be slower, but it might help with the
memory usage on consuming.

> any idea on how to decrease the usage of broker for the 1000 topics case?  i am 
> not sure if it is caused by a bug, or it is something that cannot be avoided.
> thanks.

We're not quite sure yet either I'm afraid. As I say, I have a few
theories I want to test out but it could be an issue with the Erlang
garbage collector. Also, what version of Erlang are you using?

Best wishes,

Matthew

From chen650 at yahoo.com  Tue Aug 17 18:59:33 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 17 Aug 2010 10:59:33 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <20100817171720.GL16525@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
Message-ID: <529232.46115.qm@web31809.mail.mud.yahoo.com>



> Hmm, that's unfortunate. Really, you should only be bound by disk  write

> speed at that point, and I'm sure your disks can do more than  10MB/sec.
> You might try tuning the msg_store_file_size_limit setting: the  default
> is 16777216 (i.e. 16MB), but try pushing that up to 67108864 (i.e.  64MB)
> and you might find Rabbit can drive the disks harder. You'll need to  do
> that in rabbitmq.config with something like:
> 
> [{rabbit,  [{msg_store_file_size_limit, 67108864}]}].

The 10MB/sec was due to the broker memory passed 0.4 mem watermark and started 
putting throttling the producer.
The problem is after the producer slowed down, the broker still could not 
recover from the high memory usage.
After i increased the watermark to 0.7, the publish rate could reach 80 MB/sec.  


> We can reproduce that  here. I have a few theories about this, but it's
> really pending more testing  and debugging. Is there any chance you could
> send us your test code - it'd be  good to see exactly what you're doing?

our code is based on the amqp_consumer.c from the rabbitmq-c/examples, with some 
modifications for durable exchange/queues.
however, it is mixed with lots of our internal functions.  i will try to make 
minimum modification to amqp_consumer.c to reproduce our test case, and send you 
that sample code.

> Mmm. Try seeing what happens if you reduce  the high watermark to 0.2 or
> lower - yes, publishing will be slower, but it  might help with the
> memory usage on consuming.

i will try that.

> We're not quite sure yet either I'm afraid. As I  say, I have a few
> theories I want to test out but it could be an issue with  the Erlang
> garbage collector. Also, what version of Erlang are you  using?

good point!  i forgot to mention that i tried both erlang 13B and 14A.
with 13B, the broker would use very high cpu (>700% on our 8 core machine) while 
consuming 200 GB (even for 100 clusters), and the consuming rate would decline 
steadily during the test.
with 14A, the cpu stayed cool (about 200%) during both the 100 and 1000 clusters 
test.  the only problem is the mem usage.

thanks for looking into this!  

-alex



      

From aaron at agoragames.com  Tue Aug 17 19:24:22 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 17 Aug 2010 14:24:22 -0400
Subject: [rabbitmq-discuss] Concerning cluster failure scenario
Message-ID: <AANLkTimD8T1fVgjf5ZAyXPVVeALhJRJB=b58jz7yvSgw@mail.gmail.com>

We experienced a very odd and disturbing outage yesterday.  I'll do my
best to explain and can fill in any missing details as needed.

We have a 4 host/node cluster of 1.7.2 rabbits.  One node serves our
translators that bridge synchronous HTTP traffic to our backend
services.  Two other nodes handle our services and one is a spare.
The translators have queues named "$host.$pid" and which are bound to
the "response" exchange using routing keys of the same name.

One of the application nodes went down, apparently due to an outright
crash.  Monit caught that rabbit wasn't running and restarted it.  All
the rabbit hosts and our services saw this as a socket disconnect
without any closure method.  The only immediate fallout from this was
a mis-handling in our application stack for socket drops.  Combing
through the logs yielded nothing; it appears Erlang crashed hard.

The really strange behavior happened at the node which serves our
translators.  Running `rabbitmqctl list_queues` it was clear that most
of the queues that should exist did not, including the ones which our
translators need.  The logs when the other node went down have many
entries similar to the following:

=ERROR REPORT==== 16-Aug-2010::18:06:54 ===
connection <0.20615.10> (running), channel 2 - error:
{amqp_error,internal_error,
            "commit failed:
[{exit,{{nodedown,rabbit at jackalope},{gen_server2,call,[<7282.218.0>,{commit,{{11,<0.20706.10>},98789}},infinity]}}}]",
            'tx.commit'}


Those errors propagated up our application stack where our translators
re-connected to the broker (fresh socket).  That lead to this error
which is very common:

=ERROR REPORT==== 16-Aug-2010::18:06:56 ===
connection <0.22741.65> (running), channel 1 - error:
{amqp_error,not_found,"no queue 'ogre.28645' in vhost '/hydra'",'queue.bind'}

We have added a delay to some of our applications so that reconnection
happens after a second or two to avoid this race condition, and will
make that change here too.  So both logs and rabbitmqctl were in
agreement that the queues which should have existed for our
translators did not exist.  I didn't see any errors about the
queue.basic_consume calls though.

Our translators have some test endpoints, and one of those is a ping
which writes directly to the response exchange to effectively test
that the translator and Rabbit are working together.  The response
exchange is living on the same node which the translator is connected
to and consuming from.

When we called this test endpoint, it succeeded!  Though rabbit did
not report a queue or binding, every single on of our translators was
receiving responses though they never should have.  When one of our
services wrote back to the response exchange on other node in the
cluster, the message was dropped as we would expect.

-Aaron

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From josh at gebaschtel.ch  Wed Aug 18 05:04:24 2010
From: josh at gebaschtel.ch (Josh Geisser)
Date: Wed, 18 Aug 2010 06:04:24 +0200
Subject: [rabbitmq-discuss] Cluster behavior with distributing messages
 internally over Wide area networks
Message-ID: <9C37154E143FE14CBA656B2D2232745F060899DE40A2@popeye.gebaschtel.bnet>


Hi all

I was wondering whether a Node is aware of what to and what not to deliver to a cluster peer. 

Eg.
   
Producer
   \/
[Node 1] ===> consumer1 (queue1)
   |
   | WAN 
   |
[Node 2] ===> consumer2 (queue2)

Here all messages to will traverse the WAN connection b/c they are delivered to Queue2.

If Node 2 would not have a consumer2, would Node 1 send all it's messages, or will it filter messages only to match a queue in Node2?

I guess my question is rather related to where a queue is held in memory and how it's accessed, but our concern is what inter-cluster-traffic we have to expect. Since it's a low bandwith/high latency connection we're not sure whether Clustering or Shovel is more adequate?

Cheers
Josh


From alexandru at rabbitmq.com  Wed Aug 18 11:32:44 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 18 Aug 2010 11:32:44 +0100
Subject: [rabbitmq-discuss] Cluster behavior with distributing messages
 internally over Wide area networks
In-Reply-To: <9C37154E143FE14CBA656B2D2232745F060899DE40A2@popeye.gebaschtel.bnet>
References: <9C37154E143FE14CBA656B2D2232745F060899DE40A2@popeye.gebaschtel.bnet>
Message-ID: <20100818103244.GC2810@dakota.eng.vmware.com>

Hi Josh,

> I was wondering whether a Node is aware of what to and what not to deliver to a cluster peer. 
> 
> Eg.
>    
> Producer
>    \/
> [Node 1] ===> consumer1 (queue1)
>    |
>    | WAN 
>    |
> [Node 2] ===> consumer2 (queue2)
> 
> Here all messages to will traverse the WAN connection b/c they are delivered to Queue2.
> 
> If Node 2 would not have a consumer2, would Node 1 send all it's messages, or will it filter messages only to match a queue in Node2?

Messages are only sent across the network when they're requested.  So,
unless something on Node 2 tries to consume messages from queue1, those
messages will not be sent over the network.

> I guess my question is rather related to where a queue is held in memory and how it's accessed, 

A queue is only stored on the node it was declared on.  Within the cluster,
all nodes can access all queues, but messages are only routed to other
nodes on-demand.

> but our concern is what inter-cluster-traffic we have to expect. Since it's a low bandwith/high latency connection we're not sure whether Clustering or Shovel is more adequate?

It depends on what you're trying to achieve.  Clustering creates a
logical broker made out of several smaller ones.  The shovel keeps the
brokers separate.

If you want to connect to any of the nodes and be able to consume from
any queue, create new bindings, and so on, use clustering.

If you just want to move messages around in a predefined way, use
shovel.

Cheers,
Alex


From majek04 at gmail.com  Wed Aug 18 11:42:27 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 18 Aug 2010 11:42:27 +0100
Subject: [rabbitmq-discuss] rabbitmq-jsonrpc
In-Reply-To: <AANLkTimNyaa4fSEznSGS9_4RrNv9U96ytunu7=Qf7to_@mail.gmail.com>
References: <AANLkTimNyaa4fSEznSGS9_4RrNv9U96ytunu7=Qf7to_@mail.gmail.com>
Message-ID: <AANLkTik9Z63KkCBk4rQJa=5jDVTNNC3by-Gfm=4yM48Y@mail.gmail.com>

Jimi,

We've moved the erlang-rfc4627 to github.
If you want to play with rabbitmq-jsonrpc-channel, I'd suggest:
hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
cd rabbitmq-public-umbrella/
make co
make
cd rabbitmq-jsonrpc-channel
make run

On Tue, Aug 17, 2010 at 16:08, Jimi riblei <newsjimi at gmail.com> wrote:
> Hello All,
> I would like try?rabbitmq-jsonrpc , but when I going to
> hg.opensource.lshift.net/erlang-rfc462
>
> I've the follow error:
>
> ?hg clone http://hg.opensource.lshift.net/erlang-rfc4627/
> destination directory: erlang-rfc4627
> abort: HTTP Error 404: Not Found
>
> Do You have changed source repository?
>
> Tnks
> J.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Wed Aug 18 11:50:33 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 18 Aug 2010 11:50:33 +0100
Subject: [rabbitmq-discuss] rabbitmq-jsonrpc
In-Reply-To: <AANLkTik9Z63KkCBk4rQJa=5jDVTNNC3by-Gfm=4yM48Y@mail.gmail.com>
References: <AANLkTimNyaa4fSEznSGS9_4RrNv9U96ytunu7=Qf7to_@mail.gmail.com>
	<AANLkTik9Z63KkCBk4rQJa=5jDVTNNC3by-Gfm=4yM48Y@mail.gmail.com>
Message-ID: <4C6BBAF9.8040207@rabbitmq.com>

On 18/08/10 11:42, Marek Majkowski wrote:
> We've moved the erlang-rfc4627 to github.
> If you want to play with rabbitmq-jsonrpc-channel, I'd suggest:
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
> cd rabbitmq-public-umbrella/
> make co
> make
> cd rabbitmq-jsonrpc-channel
> make run

or simply follow the instructions in the README :)

http://hg.rabbitmq.com/rabbitmq-jsonrpc-channel/file/default/README


Matthias.

From alexandru at rabbitmq.com  Wed Aug 18 11:53:22 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 18 Aug 2010 11:53:22 +0100
Subject: [rabbitmq-discuss] Cluster behavior with distributing messages
 internally over Wide area networks
In-Reply-To: <20100818103244.GC2810@dakota.eng.vmware.com>
References: <9C37154E143FE14CBA656B2D2232745F060899DE40A2@popeye.gebaschtel.bnet>
	<20100818103244.GC2810@dakota.eng.vmware.com>
Message-ID: <20100818105322.GD2810@dakota.eng.vmware.com>

> > I was wondering whether a Node is aware of what to and what not to deliver to a cluster peer. 
> > 
> > Eg.
> >    
> > Producer
> >    \/
> > [Node 1] ===> consumer1 (queue1)
> >    |
> >    | WAN 
> >    |
> > [Node 2] ===> consumer2 (queue2)
> > 
> > Here all messages to will traverse the WAN connection b/c they are delivered to Queue2.
> > 
> > If Node 2 would not have a consumer2, would Node 1 send all it's messages, or will it filter messages only to match a queue in Node2?
> 
> Messages are only sent across the network when they're requested.  So,
> unless something on Node 2 tries to consume messages from queue1, those
> messages will not be sent over the network.
> 
> > I guess my question is rather related to where a queue is held in memory and how it's accessed, 
> 
> A queue is only stored on the node it was declared on.  Within the cluster,
> all nodes can access all queues, but messages are only routed to other
> nodes on-demand.

That's how consuming works.

In a cluster, publishing goes something like this:

>       Producer
>          \/
>        Node 1
>      (exchange)
>         /|\
>        / | \
>       /  |  \
>      /   |   \
> Node 2 Node 3  Node 4
>   Q1    Q2      Q3
>                 Q4

If your producer is publishes a message to an exchange on Node 1 and
there are queues bound to that exchange on nodes 2, 3, and 4, the
message is sent from Node 1 to the other Nodes only if the queue
bindings match (it doesn't broadcast them).  If there are multiple
matching queues on a node (e.g. Node 4 has Q3 and Q4), the message
is only sent once from Node 1 to Node 4.

Alex

From matthew at rabbitmq.com  Wed Aug 18 12:10:38 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 18 Aug 2010 12:10:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ hanging on "starting queue
 supervisor and queue recovery" after system went down (using new persister)
In-Reply-To: <C597EA24-79DE-4767-9F0B-BB7410237A56@mozilla.com>
References: <C597EA24-79DE-4767-9F0B-BB7410237A56@mozilla.com>
Message-ID: <20100818111038.GB26111@rabbitmq.com>

Hi Christian,

On Mon, Aug 16, 2010 at 03:18:57PM -0700, Christian Legnitto wrote:
> I've been running default with the new persister. I went away for the weekend and saw that my RabbitMQ instance died (not sure what happened, doesn't look to be in logs). In any case, I went to restart the server and it was hanging at "starting queue supervisor and queue recovery". The VM this on isn't speedy but I let it go for ~30 mins. I moved the mnesia db out of the way, tried again,  and it started instantly.

Hmm. Any idea what it was doing - was the disk thrashing or CPU very
busy? In the event of a crash, rabbit has to do various checks on start
up, which can be time consuming, in order to validate the state of the
messages in the queues. However, I think last time I benchmarked this,
it was of the order of 100s of thousands per second. Otoh, that's on an
8-core machine with oodles of RAM and decent hard drives.

I'd be curious as to what it was doing.

> I can send the mnesia db, but it is very large. I didn't have many queues (3?) but each probably had thousands (or even 100k+ messages) queued up.

That might be useful though the startup/recovery process is at various
points pruning, so the data you have may very well now be different to
the data that was there when you restarted Rabbit. You didn't happen to
take a backup *before* restarting Rabbit did you?

Matthew

From rharrop at vmware.com  Wed Aug 18 14:03:32 2010
From: rharrop at vmware.com (Rob Harrop)
Date: Wed, 18 Aug 2010 06:03:32 -0700
Subject: [rabbitmq-discuss] Java Client Threading Patches
Message-ID: <D6FB4343-409F-4412-8FA7-4361DBD47B79@vmware.com>

All,

I've been tweaking the threading of the Java Client a little bit in some patches.

The main change of interest is that dispatching to consumers no longer happens on the connection thread. This means that a given Consumer cannot hold up Consumers on other Channels.

I'm interested to hear feedback from anyone who is using the Java Client in anger. This change should help you to use Consumer directly, without having to set up your own threads and use QueuingConsumer.

You can grab my patches from: http://bitbucket.org/robharrop/rabbitmq-java-client

The branch of interest is bug18384.

Regards,

Rob

VMware

From jon.brisbin at npcinternational.com  Wed Aug 18 14:16:14 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 18 Aug 2010 08:16:14 -0500
Subject: [rabbitmq-discuss] Java Client Threading Patches
In-Reply-To: <D6FB4343-409F-4412-8FA7-4361DBD47B79@vmware.com>
References: <D6FB4343-409F-4412-8FA7-4361DBD47B79@vmware.com>
Message-ID: <6878300D-4F08-45B2-A816-490F369CB31B@npcinternational.com>

This is good news! I'd like to check this out...assuming there is some kind of documentation on what I'd need to do differently than today to make use of this. :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Aug 18, 2010, at 8:03 AM, Rob Harrop wrote:

> All,
> 
> I've been tweaking the threading of the Java Client a little bit in some patches.
> 
> The main change of interest is that dispatching to consumers no longer happens on the connection thread. This means that a given Consumer cannot hold up Consumers on other Channels.
> 
> I'm interested to hear feedback from anyone who is using the Java Client in anger. This change should help you to use Consumer directly, without having to set up your own threads and use QueuingConsumer.
> 
> You can grab my patches from: http://bitbucket.org/robharrop/rabbitmq-java-client
> 
> The branch of interest is bug18384.
> 
> Regards,
> 
> Rob
> 
> VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From cal.leeming at simplicitymedialtd.co.uk  Wed Aug 18 14:48:16 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Wed, 18 Aug 2010 14:48:16 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on channel
	request
Message-ID: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>

Hi guys,

I seem to have a problem where RabbitMQ will stop accepting channel requests
after either a certain amount of messages are in the queue, or once I have
sent 200-300 connection requests.

I have done this using the Tracer and without the Tracer, and experience the
exact same problem each time. I'm also not using any custom rabbitmq config.

At first I thought it was a memory problem, but if I restart RabbitMQ,
sometimes it will start accepting connections again and allow me to put more
items on the queue, but then other times it won't.

Whenever I delete the mnesia folder, it will start working again, but then
after a few thousands messages (20k+) it will randomly stop again.

Currently, I am at 324k messages in the queue.

Does anyone have any ideas what could be causing this?

Cheers

Cal



System info
-----------------
 root at mail01.dmemedialtd.com [/var/log/rabbitmq] > uname -a
Linux mail01.dmemedialtd.com 2.6.26-2-amd64 #1 SMP Sun Jun 20 20:16:30 UTC
2010 x86_64 GNU/Linux

 root at mail01.dmemedialtd.com [/var/log/rabbitmq] > cat /etc/issue
Debian GNU/Linux 5.0 \n \l

top - 14:42:53 up 49 days, 15:35,  2 users,  load average: 0.00, 0.00, 0.00
Tasks:  60 total,   1 running,  59 sleeping,   0 stopped,   0 zombie
Cpu0  :  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu1  :  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Mem:   1027932k total,   766764k used,   261168k free,    25584k buffers
Swap:   971892k total,   212020k used,   759872k free,   288416k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 4682 rabbitmq  20   0  610m 349m 2020 S    0 34.8   0:28.47 beam.smp
 4735 rabbitmq  20   0  3772  372  368 S    0  0.0   0:00.00 cpu_sup
 4764 rabbitmq  20   0 10492  392  388 S    0  0.0   0:00.00 inet_gethost
 4766 rabbitmq  20   0 16784  560  556 S    0  0.1   0:00.00 inet_gethost
14382 rabbitmq  20   0 11004  940  332 S    0  0.1   0:01.50 epmd

rabbitmq 14382  0.0  0.0  11004   940 ?        S    Aug12   0:01
/usr/lib/erlang/erts-5.6.3/bin/epmd -daemon
rabbitmq  4682  0.9 34.7 624684 357480 ?       Ssl  13:54   0:28
/usr/lib/erlang/erts-5.6.3/bin/beam.smp -W w -K true -A30 -P 1048576 --
-root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/../ebin -noshell -noinput
-s rabbit -sname rabbit at mail01 -boot start_sasl -kernel
inet_default_listen_options [{nodelay,true}] -kernel
inet_default_connect_options [{nodelay,true}] -sasl errlog_type error
-kernel error_logger {file,"/var/log/rabbitmq/rabbit at mail01.log"} -sasl
sasl_error_logger {file,"/var/log/rabbitmq/rabbit at mail01-sasl.log"} -os_mon
start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup false
-mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at mail01" -noshell -noinput
rabbitmq  4735  0.0  0.0   3772   372 ?        Ss   13:54   0:00  \_
/usr/lib/erlang/lib/os_mon-2.1.6/priv/bin/cpu_sup
rabbitmq  4764  0.0  0.0  10492   392 ?        Ss   13:54   0:00  \_
inet_gethost 4
rabbitmq  4766  0.0  0.0  16784   560 ?        S    13:54   0:00      \_
inet_gethost 4


 root at mail01.dmemedialtd.com [~/rabbitmq-java-client-1.4.0/build/dist] >
rabbitmqctl list_queues
Listing queues ...
po_box 324722
...done.


 root at mail01.dmemedialtd.com [/var/lib/rabbitmq/mnesia/rabbit at mail01] > ls
-la
total 162608
drwxr-xr-x 2 rabbitmq rabbitmq     4096 2010-08-18 14:00 .
drwxr-xr-x 3 rabbitmq rabbitmq     4096 2010-08-12 21:54 ..
-rw-r--r-- 1 rabbitmq rabbitmq      155 2010-08-18 14:00 DECISION_TAB.LOG
-rw-r--r-- 1 rabbitmq rabbitmq       91 2010-08-18 14:00 LATEST.LOG
-rw-r--r-- 1 rabbitmq rabbitmq        8 2010-08-12 21:54 rabbit_config.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      822 2010-08-18 13:31
rabbit_durable_exchange.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      198 2010-08-18 13:54
rabbit_durable_queue.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      271 2010-08-18 13:57
rabbit_durable_queue.DCL
-rw-r--r-- 1 rabbitmq rabbitmq      348 2010-08-18 13:31
rabbit_durable_route.DCD
-rw-r--r-- 1 rabbitmq rabbitmq 83128355 2010-08-18 13:55
rabbit_persister.LOG
-rw-r--r-- 1 rabbitmq rabbitmq 83128355 2010-08-18 13:55
rabbit_persister.LOG.previous
-rw-r--r-- 1 rabbitmq rabbitmq        3 2010-08-18 13:54 rabbit_serial
-rw-r--r-- 1 rabbitmq rabbitmq      127 2010-08-18 13:31 rabbit_user.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      185 2010-08-18 13:31
rabbit_user_permission.DCD
-rw-r--r-- 1 rabbitmq rabbitmq      581 2010-08-18 14:00
rabbit_user_permission.DCL
-rw-r--r-- 1 rabbitmq rabbitmq      126 2010-08-18 13:31 rabbit_vhost.DCD
-rw-r--r-- 1 rabbitmq rabbitmq    12389 2010-08-12 21:54 schema.DAT



Client Side:
-------------------
>>> conn = amqp.Connection(host="10.1.3.2:5673", userid="guest",
password="guest", virtual_host="/", insist=True)
>>> chan = conn.channel()
 ---- Blocks forever and a day ----
 ---- Press CTRL + C ----
^CTraceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py", line
230, in channel
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", line
82, in __init__
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", line
471, in _x_open
  File
"build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py", line
89, in wait
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py", line
198, in _wait_method
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/method_framing.py",
line 212, in read_method
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/method_framing.py",
line 127, in _next_method
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/transport.py", line
109, in read_frame
  File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/transport.py", line
200, in _read
KeyboardInterrupt

Tracer proxy result:
-------------------
 root at mail01.dmemedialtd.com [~/rabbitmq-java-client-1.4.0/build/dist] >
./runjava.sh com.rabbitmq.tools.Tracer
Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
Invoked as: Tracer 5673 localhost 5672
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false

---- this is where the connection is started ----
1282138358084: conn#0 ch#0 <-
{#method<connection.start>(version-major=8,version-minor=0,server
properties={platform=Erlang/OTP, product=RabbitMQ, version=1.8.1,
copyright=Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial
Technologies LLC., and Rabbit Technologies Ltd., information=Licensed under
the MPL.  See http://www.rabbitmq.com/},mechanisms=PLAIN
AMQPLAIN,locales=en_US),null,""}
1282138358084: conn#0 ch#0 <-
{#method<connection.tune>(channel-max=0,frame-max=131072,heartbeat=0),null,""}
1282138358086: conn#0 ch#0 ->
{#method<connection.start-ok>(client-properties={library=Python amqplib,
library_version=0.6.1},mechanism=AMQPLAIN,response=LOGINSguesPASSWORDSguest,locale=en_US),null,""}
1282138358124: conn#0 ch#0 ->
{#method<connection.tune-ok>(channel-max=65535,frame-max=131072,heartbeat=0),null,""}
1282138358125: conn#0 ch#0 ->
{#method<connection.open>(virtual-host=/,capabilities=,insist=true),null,""}
1282138358164: conn#0 ch#0 <-
{#method<connection.open-ok>(known-hosts=mail01:5672),null,""}

---- this is where the channel is opened ----
1282138359932: conn#0 ch#1 -> {#method<channel.open>(out-of-band=),null,""}
---- nothing comes back afterwards ----


 root at mail01.dmemedialtd.com [~] > rabbitmqctl list_connections
Listing connections ...
guest   127.0.0.1       43467   running
...done.

 root at mail01.dmemedialtd.com [~] > rabbitmqctl list_channels
Listing channels ...
<rabbit at mail01.3566.0>  guest   false   0       0
...done.

Logs
----------------
 root at mail01.dmemedialtd.com [/var/log/rabbitmq] > tail -n 20
rabbit at mail01.log

=WARNING REPORT==== 18-Aug-2010::14:28:49 ===
exception on TCP connection <0.873.0> from 10.1.3.1:36844
connection_closed_abruptly

=INFO REPORT==== 18-Aug-2010::14:28:49 ===
closing TCP connection <0.873.0> from 10.1.3.1:36844

=WARNING REPORT==== 18-Aug-2010::14:31:54 ===
exception on TCP connection <0.3212.0> from 127.0.0.1:57206
connection_closed_abruptly

=INFO REPORT==== 18-Aug-2010::14:31:54 ===
closing TCP connection <0.3212.0> from 127.0.0.1:57206

=INFO REPORT==== 18-Aug-2010::14:32:37 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:43467

=INFO REPORT==== 18-Aug-2010::14:32:37 ===
starting TCP connection <0.3559.0> from 127.0.0.1:43467




-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/d0b0f406/attachment-0001.htm>

From jiri at krutil.com  Wed Aug 18 15:43:47 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Wed, 18 Aug 2010 16:43:47 +0200
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <4C6A6AEE.8070601@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817093632.61664pueomxsmw4k@webmail.active24.cz>
	<4C6A57E3.6070402@rabbitmq.com>
	<20100817114608.585123v33s43xnxc@webmail.active24.cz>
	<4C6A6AEE.8070601@rabbitmq.com>
Message-ID: <20100818164347.527066lkl0ashzgo@webmail.active24.cz>

Matthias,

> I've filed a bug for it. But I don't expect we'll work on this any  
> time soon. Perhaps you could try coming up with a patch?

I have implemented cert-based authentication for SSL connections as a  
configurable alternative to user/password authentication. If enabled,  
the client cert subject's Common Name is used as user name (no  
password is verified).

How do I turn this into a patch you could review and maybe include in  
one of the future releases?

Cheers
Jiri


From cal.leeming at simplicitymedialtd.co.uk  Wed Aug 18 17:01:01 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Wed, 18 Aug 2010 17:01:01 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
	channel request
In-Reply-To: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
Message-ID: <AANLkTi=wRbN1MOEwNLO1c0VgKfCwUCjdGhSvLDzNk1QB@mail.gmail.com>

Also,

I have uploaded the tcpdump pcap of the connection.

http://www.wikifortio.com/540101/trace.pcap

In this pcap, I had attempted to connect several times, and then CTRL + C
the python app after a few seconds.

Cheers

Cal

On Wed, Aug 18, 2010 at 2:48 PM, Cal Leeming [Simplicity Media Ltd] <
cal.leeming at simplicitymedialtd.co.uk> wrote:

> Hi guys,
>
> I seem to have a problem where RabbitMQ will stop accepting channel
> requests after either a certain amount of messages are in the queue, or once
> I have sent 200-300 connection requests.
>
> I have done this using the Tracer and without the Tracer, and experience
> the exact same problem each time. I'm also not using any custom rabbitmq
> config.
>
> At first I thought it was a memory problem, but if I restart RabbitMQ,
> sometimes it will start accepting connections again and allow me to put more
> items on the queue, but then other times it won't.
>
> Whenever I delete the mnesia folder, it will start working again, but then
> after a few thousands messages (20k+) it will randomly stop again.
>
> Currently, I am at 324k messages in the queue.
>
> Does anyone have any ideas what could be causing this?
>
> Cheers
>
> Cal
>
>
>
> System info
> -----------------
>  root at mail01.dmemedialtd.com [/var/log/rabbitmq] > uname -a
> Linux mail01.dmemedialtd.com 2.6.26-2-amd64 #1 SMP Sun Jun 20 20:16:30 UTC
> 2010 x86_64 GNU/Linux
>
>  root at mail01.dmemedialtd.com [/var/log/rabbitmq] > cat /etc/issue
> Debian GNU/Linux 5.0 \n \l
>
> top - 14:42:53 up 49 days, 15:35,  2 users,  load average: 0.00, 0.00, 0.00
> Tasks:  60 total,   1 running,  59 sleeping,   0 stopped,   0 zombie
> Cpu0  :  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,
>  0.0%st
> Cpu1  :  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,
>  0.0%st
> Mem:   1027932k total,   766764k used,   261168k free,    25584k buffers
> Swap:   971892k total,   212020k used,   759872k free,   288416k cached
>
>   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
>  4682 rabbitmq  20   0  610m 349m 2020 S    0 34.8   0:28.47 beam.smp
>  4735 rabbitmq  20   0  3772  372  368 S    0  0.0   0:00.00 cpu_sup
>  4764 rabbitmq  20   0 10492  392  388 S    0  0.0   0:00.00 inet_gethost
>  4766 rabbitmq  20   0 16784  560  556 S    0  0.1   0:00.00 inet_gethost
> 14382 rabbitmq  20   0 11004  940  332 S    0  0.1   0:01.50 epmd
>
> rabbitmq 14382  0.0  0.0  11004   940 ?        S    Aug12   0:01
> /usr/lib/erlang/erts-5.6.3/bin/epmd -daemon
> rabbitmq  4682  0.9 34.7 624684 357480 ?       Ssl  13:54   0:28
> /usr/lib/erlang/erts-5.6.3/bin/beam.smp -W w -K true -A30 -P 1048576 --
> -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -pa
> /usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/../ebin -noshell -noinput
> -s rabbit -sname rabbit at mail01 -boot start_sasl -kernel
> inet_default_listen_options [{nodelay,true}] -kernel
> inet_default_connect_options [{nodelay,true}] -sasl errlog_type error
> -kernel error_logger {file,"/var/log/rabbitmq/rabbit at mail01.log"} -sasl
> sasl_error_logger {file,"/var/log/rabbitmq/rabbit at mail01-sasl.log"}
> -os_mon start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup
> false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at mail01" -noshell
> -noinput
> rabbitmq  4735  0.0  0.0   3772   372 ?        Ss   13:54   0:00  \_
> /usr/lib/erlang/lib/os_mon-2.1.6/priv/bin/cpu_sup
> rabbitmq  4764  0.0  0.0  10492   392 ?        Ss   13:54   0:00  \_
> inet_gethost 4
> rabbitmq  4766  0.0  0.0  16784   560 ?        S    13:54   0:00      \_
> inet_gethost 4
>
>
>  root at mail01.dmemedialtd.com [~/rabbitmq-java-client-1.4.0/build/dist] >
> rabbitmqctl list_queues
> Listing queues ...
> po_box 324722
> ...done.
>
>
>  root at mail01.dmemedialtd.com [/var/lib/rabbitmq/mnesia/rabbit at mail01] > ls
> -la
> total 162608
> drwxr-xr-x 2 rabbitmq rabbitmq     4096 2010-08-18 14:00 .
> drwxr-xr-x 3 rabbitmq rabbitmq     4096 2010-08-12 21:54 ..
> -rw-r--r-- 1 rabbitmq rabbitmq      155 2010-08-18 14:00 DECISION_TAB.LOG
> -rw-r--r-- 1 rabbitmq rabbitmq       91 2010-08-18 14:00 LATEST.LOG
> -rw-r--r-- 1 rabbitmq rabbitmq        8 2010-08-12 21:54 rabbit_config.DCD
> -rw-r--r-- 1 rabbitmq rabbitmq      822 2010-08-18 13:31
> rabbit_durable_exchange.DCD
> -rw-r--r-- 1 rabbitmq rabbitmq      198 2010-08-18 13:54
> rabbit_durable_queue.DCD
> -rw-r--r-- 1 rabbitmq rabbitmq      271 2010-08-18 13:57
> rabbit_durable_queue.DCL
> -rw-r--r-- 1 rabbitmq rabbitmq      348 2010-08-18 13:31
> rabbit_durable_route.DCD
> -rw-r--r-- 1 rabbitmq rabbitmq 83128355 2010-08-18 13:55
> rabbit_persister.LOG
> -rw-r--r-- 1 rabbitmq rabbitmq 83128355 2010-08-18 13:55
> rabbit_persister.LOG.previous
> -rw-r--r-- 1 rabbitmq rabbitmq        3 2010-08-18 13:54 rabbit_serial
> -rw-r--r-- 1 rabbitmq rabbitmq      127 2010-08-18 13:31 rabbit_user.DCD
> -rw-r--r-- 1 rabbitmq rabbitmq      185 2010-08-18 13:31
> rabbit_user_permission.DCD
> -rw-r--r-- 1 rabbitmq rabbitmq      581 2010-08-18 14:00
> rabbit_user_permission.DCL
> -rw-r--r-- 1 rabbitmq rabbitmq      126 2010-08-18 13:31 rabbit_vhost.DCD
> -rw-r--r-- 1 rabbitmq rabbitmq    12389 2010-08-12 21:54 schema.DAT
>
>
>
> Client Side:
> -------------------
> >>> conn = amqp.Connection(host="10.1.3.2:5673", userid="guest",
> password="guest", virtual_host="/", insist=True)
> >>> chan = conn.channel()
>  ---- Blocks forever and a day ----
>  ---- Press CTRL + C ----
> ^CTraceback (most recent call last):
>   File "<stdin>", line 1, in <module>
>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py",
> line 230, in channel
>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", line
> 82, in __init__
>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", line
> 471, in _x_open
>   File
> "build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py", line
> 89, in wait
>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py",
> line 198, in _wait_method
>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/method_framing.py",
> line 212, in read_method
>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/method_framing.py",
> line 127, in _next_method
>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/transport.py", line
> 109, in read_frame
>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/transport.py", line
> 200, in _read
> KeyboardInterrupt
>
> Tracer proxy result:
> -------------------
>  root at mail01.dmemedialtd.com [~/rabbitmq-java-client-1.4.0/build/dist] >
> ./runjava.sh com.rabbitmq.tools.Tracer
> Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
> Invoked as: Tracer 5673 localhost 5672
> com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
> com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
> com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
> com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
>
> ---- this is where the connection is started ----
> 1282138358084: conn#0 ch#0 <-
> {#method<connection.start>(version-major=8,version-minor=0,server
> properties={platform=Erlang/OTP, product=RabbitMQ, version=1.8.1,
> copyright=Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial
> Technologies LLC., and Rabbit Technologies Ltd., information=Licensed under
> the MPL.  See http://www.rabbitmq.com/},mechanisms=PLAIN
> AMQPLAIN,locales=en_US),null,""}
> 1282138358084: conn#0 ch#0 <-
> {#method<connection.tune>(channel-max=0,frame-max=131072,heartbeat=0),null,""}
> 1282138358086: conn#0 ch#0 ->
> {#method<connection.start-ok>(client-properties={library=Python amqplib,
> library_version=0.6.1},mechanism=AMQPLAIN,response=LOGINSguesPASSWORDSguest,locale=en_US),null,""}
> 1282138358124: conn#0 ch#0 ->
> {#method<connection.tune-ok>(channel-max=65535,frame-max=131072,heartbeat=0),null,""}
> 1282138358125: conn#0 ch#0 ->
> {#method<connection.open>(virtual-host=/,capabilities=,insist=true),null,""}
> 1282138358164: conn#0 ch#0 <-
> {#method<connection.open-ok>(known-hosts=mail01:5672),null,""}
>
> ---- this is where the channel is opened ----
> 1282138359932: conn#0 ch#1 -> {#method<channel.open>(out-of-band=),null,""}
> ---- nothing comes back afterwards ----
>
>
>  root at mail01.dmemedialtd.com [~] > rabbitmqctl list_connections
> Listing connections ...
> guest   127.0.0.1       43467   running
> ...done.
>
>  root at mail01.dmemedialtd.com [~] > rabbitmqctl list_channels
> Listing channels ...
> <rabbit at mail01.3566.0>  guest   false   0       0
> ...done.
>
> Logs
> ----------------
>  root at mail01.dmemedialtd.com [/var/log/rabbitmq] > tail -n 20
> rabbit at mail01.log
>
> =WARNING REPORT==== 18-Aug-2010::14:28:49 ===
> exception on TCP connection <0.873.0> from 10.1.3.1:36844
> connection_closed_abruptly
>
> =INFO REPORT==== 18-Aug-2010::14:28:49 ===
> closing TCP connection <0.873.0> from 10.1.3.1:36844
>
> =WARNING REPORT==== 18-Aug-2010::14:31:54 ===
> exception on TCP connection <0.3212.0> from 127.0.0.1:57206
> connection_closed_abruptly
>
> =INFO REPORT==== 18-Aug-2010::14:31:54 ===
> closing TCP connection <0.3212.0> from 127.0.0.1:57206
>
> =INFO REPORT==== 18-Aug-2010::14:32:37 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:43467
>
> =INFO REPORT==== 18-Aug-2010::14:32:37 ===
> starting TCP connection <0.3559.0> from 127.0.0.1:43467
>
>
>
>
> --
>
> Cal Leeming
>
> Operational Security & Support Team
>
> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
> support at simplicitymedialtd.co.uk
> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
> Simplicity Media Ltd. All rights reserved.
> Registered company number 7143564
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/24db1069/attachment-0001.htm>

From cal.leeming at simplicitymedialtd.co.uk  Wed Aug 18 17:17:24 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Wed, 18 Aug 2010 17:17:24 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
	channel request
In-Reply-To: <AANLkTi=wRbN1MOEwNLO1c0VgKfCwUCjdGhSvLDzNk1QB@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<AANLkTi=wRbN1MOEwNLO1c0VgKfCwUCjdGhSvLDzNk1QB@mail.gmail.com>
Message-ID: <AANLkTimsDg9ypsNuCDQKirFQQ9UhkGSvv2kiqZhkJaqz@mail.gmail.com>

Sorry guys, previous pcap only contained client data.

Here is another one with the server responses too!

http://www.wikifortio.com/822943/trace%20(1).pcap

Cal

On Wed, Aug 18, 2010 at 5:01 PM, Cal Leeming [Simplicity Media Ltd] <
cal.leeming at simplicitymedialtd.co.uk> wrote:

> Also,
>
> I have uploaded the tcpdump pcap of the connection.
>
> http://www.wikifortio.com/540101/trace.pcap
>
> In this pcap, I had attempted to connect several times, and then CTRL + C
> the python app after a few seconds.
>
> Cheers
>
> Cal
>
> On Wed, Aug 18, 2010 at 2:48 PM, Cal Leeming [Simplicity Media Ltd] <
> cal.leeming at simplicitymedialtd.co.uk> wrote:
>
>> Hi guys,
>>
>> I seem to have a problem where RabbitMQ will stop accepting channel
>> requests after either a certain amount of messages are in the queue, or once
>> I have sent 200-300 connection requests.
>>
>> I have done this using the Tracer and without the Tracer, and experience
>> the exact same problem each time. I'm also not using any custom rabbitmq
>> config.
>>
>> At first I thought it was a memory problem, but if I restart RabbitMQ,
>> sometimes it will start accepting connections again and allow me to put more
>> items on the queue, but then other times it won't.
>>
>> Whenever I delete the mnesia folder, it will start working again, but then
>> after a few thousands messages (20k+) it will randomly stop again.
>>
>> Currently, I am at 324k messages in the queue.
>>
>> Does anyone have any ideas what could be causing this?
>>
>> Cheers
>>
>> Cal
>>
>>
>>
>> System info
>> -----------------
>>  root at mail01.dmemedialtd.com [/var/log/rabbitmq] > uname -a
>> Linux mail01.dmemedialtd.com 2.6.26-2-amd64 #1 SMP Sun Jun 20 20:16:30
>> UTC 2010 x86_64 GNU/Linux
>>
>>  root at mail01.dmemedialtd.com [/var/log/rabbitmq] > cat /etc/issue
>> Debian GNU/Linux 5.0 \n \l
>>
>>  top - 14:42:53 up 49 days, 15:35,  2 users,  load average: 0.00, 0.00,
>> 0.00
>> Tasks:  60 total,   1 running,  59 sleeping,   0 stopped,   0 zombie
>> Cpu0  :  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,
>>  0.0%st
>> Cpu1  :  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,
>>  0.0%st
>> Mem:   1027932k total,   766764k used,   261168k free,    25584k buffers
>> Swap:   971892k total,   212020k used,   759872k free,   288416k cached
>>
>>   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
>>  4682 rabbitmq  20   0  610m 349m 2020 S    0 34.8   0:28.47 beam.smp
>>  4735 rabbitmq  20   0  3772  372  368 S    0  0.0   0:00.00 cpu_sup
>>  4764 rabbitmq  20   0 10492  392  388 S    0  0.0   0:00.00 inet_gethost
>>  4766 rabbitmq  20   0 16784  560  556 S    0  0.1   0:00.00 inet_gethost
>> 14382 rabbitmq  20   0 11004  940  332 S    0  0.1   0:01.50 epmd
>>
>> rabbitmq 14382  0.0  0.0  11004   940 ?        S    Aug12   0:01
>> /usr/lib/erlang/erts-5.6.3/bin/epmd -daemon
>> rabbitmq  4682  0.9 34.7 624684 357480 ?       Ssl  13:54   0:28
>> /usr/lib/erlang/erts-5.6.3/bin/beam.smp -W w -K true -A30 -P 1048576 --
>> -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -pa
>> /usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/../ebin -noshell -noinput
>> -s rabbit -sname rabbit at mail01 -boot start_sasl -kernel
>> inet_default_listen_options [{nodelay,true}] -kernel
>> inet_default_connect_options [{nodelay,true}] -sasl errlog_type error
>> -kernel error_logger {file,"/var/log/rabbitmq/rabbit at mail01.log"} -sasl
>> sasl_error_logger {file,"/var/log/rabbitmq/rabbit at mail01-sasl.log"}
>> -os_mon start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup
>> false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at mail01" -noshell
>> -noinput
>> rabbitmq  4735  0.0  0.0   3772   372 ?        Ss   13:54   0:00  \_
>> /usr/lib/erlang/lib/os_mon-2.1.6/priv/bin/cpu_sup
>> rabbitmq  4764  0.0  0.0  10492   392 ?        Ss   13:54   0:00  \_
>> inet_gethost 4
>> rabbitmq  4766  0.0  0.0  16784   560 ?        S    13:54   0:00      \_
>> inet_gethost 4
>>
>>
>>  root at mail01.dmemedialtd.com [~/rabbitmq-java-client-1.4.0/build/dist] >
>> rabbitmqctl list_queues
>> Listing queues ...
>> po_box 324722
>> ...done.
>>
>>
>>  root at mail01.dmemedialtd.com [/var/lib/rabbitmq/mnesia/rabbit at mail01] >
>> ls -la
>> total 162608
>> drwxr-xr-x 2 rabbitmq rabbitmq     4096 2010-08-18 14:00 .
>> drwxr-xr-x 3 rabbitmq rabbitmq     4096 2010-08-12 21:54 ..
>> -rw-r--r-- 1 rabbitmq rabbitmq      155 2010-08-18 14:00 DECISION_TAB.LOG
>> -rw-r--r-- 1 rabbitmq rabbitmq       91 2010-08-18 14:00 LATEST.LOG
>> -rw-r--r-- 1 rabbitmq rabbitmq        8 2010-08-12 21:54 rabbit_config.DCD
>> -rw-r--r-- 1 rabbitmq rabbitmq      822 2010-08-18 13:31
>> rabbit_durable_exchange.DCD
>> -rw-r--r-- 1 rabbitmq rabbitmq      198 2010-08-18 13:54
>> rabbit_durable_queue.DCD
>> -rw-r--r-- 1 rabbitmq rabbitmq      271 2010-08-18 13:57
>> rabbit_durable_queue.DCL
>> -rw-r--r-- 1 rabbitmq rabbitmq      348 2010-08-18 13:31
>> rabbit_durable_route.DCD
>> -rw-r--r-- 1 rabbitmq rabbitmq 83128355 2010-08-18 13:55
>> rabbit_persister.LOG
>> -rw-r--r-- 1 rabbitmq rabbitmq 83128355 2010-08-18 13:55
>> rabbit_persister.LOG.previous
>> -rw-r--r-- 1 rabbitmq rabbitmq        3 2010-08-18 13:54 rabbit_serial
>> -rw-r--r-- 1 rabbitmq rabbitmq      127 2010-08-18 13:31 rabbit_user.DCD
>> -rw-r--r-- 1 rabbitmq rabbitmq      185 2010-08-18 13:31
>> rabbit_user_permission.DCD
>> -rw-r--r-- 1 rabbitmq rabbitmq      581 2010-08-18 14:00
>> rabbit_user_permission.DCL
>> -rw-r--r-- 1 rabbitmq rabbitmq      126 2010-08-18 13:31 rabbit_vhost.DCD
>> -rw-r--r-- 1 rabbitmq rabbitmq    12389 2010-08-12 21:54 schema.DAT
>>
>>
>>
>> Client Side:
>> -------------------
>> >>> conn = amqp.Connection(host="10.1.3.2:5673", userid="guest",
>> password="guest", virtual_host="/", insist=True)
>> >>> chan = conn.channel()
>>  ---- Blocks forever and a day ----
>>  ---- Press CTRL + C ----
>> ^CTraceback (most recent call last):
>>   File "<stdin>", line 1, in <module>
>>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py",
>> line 230, in channel
>>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", line
>> 82, in __init__
>>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/channel.py", line
>> 471, in _x_open
>>   File
>> "build/bdist.linux-x86_64/egg/amqplib/client_0_8/abstract_channel.py", line
>> 89, in wait
>>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/connection.py",
>> line 198, in _wait_method
>>   File
>> "build/bdist.linux-x86_64/egg/amqplib/client_0_8/method_framing.py", line
>> 212, in read_method
>>   File
>> "build/bdist.linux-x86_64/egg/amqplib/client_0_8/method_framing.py", line
>> 127, in _next_method
>>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/transport.py",
>> line 109, in read_frame
>>   File "build/bdist.linux-x86_64/egg/amqplib/client_0_8/transport.py",
>> line 200, in _read
>> KeyboardInterrupt
>>
>> Tracer proxy result:
>> -------------------
>>   root at mail01.dmemedialtd.com [~/rabbitmq-java-client-1.4.0/build/dist] >
>> ./runjava.sh com.rabbitmq.tools.Tracer
>> Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
>> Invoked as: Tracer 5673 localhost 5672
>> com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
>> com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
>> com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
>> com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
>>
>> ---- this is where the connection is started ----
>> 1282138358084: conn#0 ch#0 <-
>> {#method<connection.start>(version-major=8,version-minor=0,server
>> properties={platform=Erlang/OTP, product=RabbitMQ, version=1.8.1,
>> copyright=Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial
>> Technologies LLC., and Rabbit Technologies Ltd., information=Licensed under
>> the MPL.  See http://www.rabbitmq.com/},mechanisms=PLAIN
>> AMQPLAIN,locales=en_US),null,""}
>> 1282138358084: conn#0 ch#0 <-
>> {#method<connection.tune>(channel-max=0,frame-max=131072,heartbeat=0),null,""}
>> 1282138358086: conn#0 ch#0 ->
>> {#method<connection.start-ok>(client-properties={library=Python amqplib,
>> library_version=0.6.1},mechanism=AMQPLAIN,response=LOGINSguesPASSWORDSguest,locale=en_US),null,""}
>> 1282138358124: conn#0 ch#0 ->
>> {#method<connection.tune-ok>(channel-max=65535,frame-max=131072,heartbeat=0),null,""}
>> 1282138358125: conn#0 ch#0 ->
>> {#method<connection.open>(virtual-host=/,capabilities=,insist=true),null,""}
>> 1282138358164: conn#0 ch#0 <-
>> {#method<connection.open-ok>(known-hosts=mail01:5672),null,""}
>>
>> ---- this is where the channel is opened ----
>> 1282138359932: conn#0 ch#1 ->
>> {#method<channel.open>(out-of-band=),null,""}
>> ---- nothing comes back afterwards ----
>>
>>
>>  root at mail01.dmemedialtd.com [~] > rabbitmqctl list_connections
>>  Listing connections ...
>> guest   127.0.0.1       43467   running
>> ...done.
>>
>>  root at mail01.dmemedialtd.com [~] > rabbitmqctl list_channels
>> Listing channels ...
>> <rabbit at mail01.3566.0>  guest   false   0       0
>> ...done.
>>
>> Logs
>> ----------------
>>  root at mail01.dmemedialtd.com [/var/log/rabbitmq] > tail -n 20
>> rabbit at mail01.log
>>
>> =WARNING REPORT==== 18-Aug-2010::14:28:49 ===
>> exception on TCP connection <0.873.0> from 10.1.3.1:36844
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 18-Aug-2010::14:28:49 ===
>> closing TCP connection <0.873.0> from 10.1.3.1:36844
>>
>> =WARNING REPORT==== 18-Aug-2010::14:31:54 ===
>> exception on TCP connection <0.3212.0> from 127.0.0.1:57206
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 18-Aug-2010::14:31:54 ===
>>  closing TCP connection <0.3212.0> from 127.0.0.1:57206
>>
>> =INFO REPORT==== 18-Aug-2010::14:32:37 ===
>> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:43467
>>
>> =INFO REPORT==== 18-Aug-2010::14:32:37 ===
>> starting TCP connection <0.3559.0> from 127.0.0.1:43467
>>
>>
>>
>>
>> --
>>
>> Cal Leeming
>>
>> Operational Security & Support Team
>>
>> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
>> support at simplicitymedialtd.co.uk
>> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
>>
>> Simplicity Media Ltd. All rights reserved.
>> Registered company number 7143564
>>
>>
>
>
> --
>
> Cal Leeming
>
> Operational Security & Support Team
>
> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
> support at simplicitymedialtd.co.uk
> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
> Simplicity Media Ltd. All rights reserved.
> Registered company number 7143564
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/e251cab9/attachment-0001.htm>

From matthias at rabbitmq.com  Wed Aug 18 17:18:25 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 18 Aug 2010 17:18:25 +0100
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <20100818164347.527066lkl0ashzgo@webmail.active24.cz>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>	<4C65FC4E.8070804@rabbitmq.com>
	<4C66AA9F.1000006@rabbitmq.com>	<20100815101257.GA4835@wellquite.org>	<20100816103018.GA16525@rabbitmq.com>	<766990.31259.qm@web31804.mail.mud.yahoo.com>	<597082.60604.qm@web31809.mail.mud.yahoo.com>	<20100817093632.61664pueomxsmw4k@webmail.active24.cz>	<4C6A57E3.6070402@rabbitmq.com>	<20100817114608.585123v33s43xnxc@webmail.active24.cz>	<4C6A6AEE.8070601@rabbitmq.com>
	<20100818164347.527066lkl0ashzgo@webmail.active24.cz>
Message-ID: <4C6C07D1.509@rabbitmq.com>

Jiri,

On 18/08/10 15:43, jiri at krutil.com wrote:
> I have implemented cert-based authentication for SSL connections as a
> configurable alternative to user/password authentication. If enabled,
> the client cert subject's Common Name is used as user name (no password
> is verified).

Wow, that was quick!

> How do I turn this into a patch you could review and maybe include in
> one of the future releases?

Just take the output of 'hg diff' and post it here or somewhere else we 
can see. Thanks.


Regards,

Matthias.

From alexandru at rabbitmq.com  Wed Aug 18 17:44:12 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 18 Aug 2010 17:44:12 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
Message-ID: <20100818164412.GF2810@dakota.eng.vmware.com>

Hi Cal,

> I seem to have a problem where RabbitMQ will stop accepting channel requests
> after either a certain amount of messages are in the queue, or once I have
> sent 200-300 connection requests.

What you describe is usually caused by rabbit running out memory.

When rabbit runs out of memory it stops accepting new connections.
Check the logs for for warnings about the hitting the high memory
watermark to see if this is indeed the case.

> At first I thought it was a memory problem, but if I restart RabbitMQ,
> sometimes it will start accepting connections again and allow me to put more
> items on the queue, but then other times it won't.

Sounds like you're squeezing in a few more messages before hitting the memory
watermark again.

> Currently, I am at 324k messages in the queue.
> Does anyone have any ideas what could be causing this?

That's sounds like an awful lot of messages.  Do you actually need all
of them on the queue?  Are you consuming them? (if so, are you also
ack'ing them?)

The problem you're facing is that the released versions of rabbit hold
all of the messages in memory.  As a direct consequence, how many
messages you can hold in the broker is upper-bounded by the amount of
RAM you have (the default is 0.4 of the available RAM, if I remember
correctly).  This has been fixed on the default branch (i.e. the amount
of messages is upper-bounded by disk-space) and will be in the next
release.

Hope this helps.

Cheers,
Alex

From chen650 at yahoo.com  Wed Aug 18 22:06:25 2010
From: chen650 at yahoo.com (alex chen)
Date: Wed, 18 Aug 2010 14:06:25 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <20100817171720.GL16525@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
Message-ID: <140810.79403.qm@web31813.mail.mud.yahoo.com>



> [{rabbit,  [{msg_store_file_size_limit, 67108864}]}].

this increases the write throughput, but the memory usage is still high.

> We can reproduce that here. I have a few theories about this, but it's
> really pending more testing and debugging. Is there any chance you could
> send us your test code - it'd be good to see exactly what you're doing?

attached please find amqp_consumer.c that i modified to show our use case. the 
main params are:
  amqp_boolean_t durable =1;
  amqp_boolean_t auto_delete =0;
  amqp_boolean_t no_ack =1;
  int prefetch_count = 50;

> Mmm. Try seeing what happens if you reduce  the high watermark to 0.2 or
> lower - yes, publishing will be slower, but it  might help with the
> memory usage on consuming.

the memory usage on consuming becomes lower, but the throughput also goes down.
so far the highest throughput we get is by setting mem high watermark to 0.6 
(20-30 MB/sec consume rate).
the only problem is the mem would go to 10 GB.  decreasing the watermark would 
lower the mem usage, but in the same time the throughput would decrease.

i think the big puzzle is:  for both 100 topics and 1000 topics, when there are 
total number of 200 GB messages queued, the number of messages is the same (10M 
for 20 KB message size).  why the 1000 topics case uses much more memory than 
the 100 topic case?

thanks.
-alex



      
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp_consumer.c
Type: text/x-csrc
Size: 6929 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/72cea609/attachment.c>

From clegnitto at mozilla.com  Wed Aug 18 22:36:59 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Wed, 18 Aug 2010 14:36:59 -0700
Subject: [rabbitmq-discuss] RabbitMQ hanging on "starting queue
	supervisor and queue recovery" after system went down (using
	new persister)
In-Reply-To: <20100818111038.GB26111@rabbitmq.com>
References: <C597EA24-79DE-4767-9F0B-BB7410237A56@mozilla.com>
	<20100818111038.GB26111@rabbitmq.com>
Message-ID: <1F909390-438F-4580-A6BD-DAF2FE3DFA41@mozilla.com>

This ended up being my problem, the machine ran out of disk space.

Thanks,
Christian

On Aug 18, 2010, at 4:10 AM, Matthew Sackman wrote:

> Hi Christian,
> 
> On Mon, Aug 16, 2010 at 03:18:57PM -0700, Christian Legnitto wrote:
>> I've been running default with the new persister. I went away for the weekend and saw that my RabbitMQ instance died (not sure what happened, doesn't look to be in logs). In any case, I went to restart the server and it was hanging at "starting queue supervisor and queue recovery". The VM this on isn't speedy but I let it go for ~30 mins. I moved the mnesia db out of the way, tried again,  and it started instantly.
> 
> Hmm. Any idea what it was doing - was the disk thrashing or CPU very
> busy? In the event of a crash, rabbit has to do various checks on start
> up, which can be time consuming, in order to validate the state of the
> messages in the queues. However, I think last time I benchmarked this,
> it was of the order of 100s of thousands per second. Otoh, that's on an
> 8-core machine with oodles of RAM and decent hard drives.
> 
> I'd be curious as to what it was doing.
> 
>> I can send the mnesia db, but it is very large. I didn't have many queues (3?) but each probably had thousands (or even 100k+ messages) queued up.
> 
> That might be useful though the startup/recovery process is at various
> points pruning, so the data you have may very well now be different to
> the data that was there when you restarted Rabbit. You didn't happen to
> take a backup *before* restarting Rabbit did you?
> 
> Matthew


From cal.leeming at simplicitymedialtd.co.uk  Wed Aug 18 22:44:35 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Wed, 18 Aug 2010 22:44:35 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <20100818164412.GF2810@dakota.eng.vmware.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
Message-ID: <AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>

Thank you for your reply!

This might be a little question but, if RabbitMQ runs out of memory, and I
am unable to open a new channel, how would one then consume off the queue,
if one isn't able to open a channel to do so? Or is this something which has
been solved with the new persister?

Cheers

Cal

On Wed, Aug 18, 2010 at 5:44 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> Hi Cal,
>
> > I seem to have a problem where RabbitMQ will stop accepting channel
> requests
> > after either a certain amount of messages are in the queue, or once I
> have
> > sent 200-300 connection requests.
>
> What you describe is usually caused by rabbit running out memory.
>
> When rabbit runs out of memory it stops accepting new connections.
> Check the logs for for warnings about the hitting the high memory
> watermark to see if this is indeed the case.
>
> > At first I thought it was a memory problem, but if I restart RabbitMQ,
> > sometimes it will start accepting connections again and allow me to put
> more
> > items on the queue, but then other times it won't.
>
> Sounds like you're squeezing in a few more messages before hitting the
> memory
> watermark again.
>
> > Currently, I am at 324k messages in the queue.
> > Does anyone have any ideas what could be causing this?
>
> That's sounds like an awful lot of messages.  Do you actually need all
> of them on the queue?  Are you consuming them? (if so, are you also
> ack'ing them?)
>
> The problem you're facing is that the released versions of rabbit hold
> all of the messages in memory.  As a direct consequence, how many
> messages you can hold in the broker is upper-bounded by the amount of
> RAM you have (the default is 0.4 of the available RAM, if I remember
> correctly).  This has been fixed on the default branch (i.e. the amount
> of messages is upper-bounded by disk-space) and will be in the next
> release.
>
> Hope this helps.
>
> Cheers,
> Alex
>



-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/0c769dd1/attachment-0001.htm>

From cal.leeming at simplicitymedialtd.co.uk  Wed Aug 18 23:23:25 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Wed, 18 Aug 2010 23:23:25 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
Message-ID: <AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>

Just thought you all might like to know.. I'm now using the latest version
of RabbitMQ, and it seems to work fine :)

On Wed, Aug 18, 2010 at 10:44 PM, Cal Leeming [Simplicity Media Ltd] <
cal.leeming at simplicitymedialtd.co.uk> wrote:

> Thank you for your reply!
>
> This might be a little question but, if RabbitMQ runs out of memory, and I
> am unable to open a new channel, how would one then consume off the queue,
> if one isn't able to open a channel to do so? Or is this something which has
> been solved with the new persister?
>
> Cheers
>
> Cal
>
> On Wed, Aug 18, 2010 at 5:44 PM, Alexandru Scvor?ov <
> alexandru at rabbitmq.com> wrote:
>
>> Hi Cal,
>>
>> > I seem to have a problem where RabbitMQ will stop accepting channel
>> requests
>> > after either a certain amount of messages are in the queue, or once I
>> have
>> > sent 200-300 connection requests.
>>
>> What you describe is usually caused by rabbit running out memory.
>>
>> When rabbit runs out of memory it stops accepting new connections.
>> Check the logs for for warnings about the hitting the high memory
>> watermark to see if this is indeed the case.
>>
>> > At first I thought it was a memory problem, but if I restart RabbitMQ,
>> > sometimes it will start accepting connections again and allow me to put
>> more
>> > items on the queue, but then other times it won't.
>>
>> Sounds like you're squeezing in a few more messages before hitting the
>> memory
>> watermark again.
>>
>> > Currently, I am at 324k messages in the queue.
>> > Does anyone have any ideas what could be causing this?
>>
>> That's sounds like an awful lot of messages.  Do you actually need all
>> of them on the queue?  Are you consuming them? (if so, are you also
>> ack'ing them?)
>>
>> The problem you're facing is that the released versions of rabbit hold
>> all of the messages in memory.  As a direct consequence, how many
>> messages you can hold in the broker is upper-bounded by the amount of
>> RAM you have (the default is 0.4 of the available RAM, if I remember
>> correctly).  This has been fixed on the default branch (i.e. the amount
>> of messages is upper-bounded by disk-space) and will be in the next
>> release.
>>
>> Hope this helps.
>>
>> Cheers,
>> Alex
>>
>
>
>
> --
>
> Cal Leeming
>
> Operational Security & Support Team
>
> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
> support at simplicitymedialtd.co.uk
> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
> Simplicity Media Ltd. All rights reserved.
> Registered company number 7143564
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/65a8d56f/attachment.htm>

From matthew at rabbitmq.com  Wed Aug 18 23:39:35 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 18 Aug 2010 23:39:35 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
Message-ID: <20100818223934.GA17230@wellquite.org>

Hi Cal,

> On Wed, Aug 18, 2010 at 10:44 PM, Cal Leeming [Simplicity Media Ltd] <
> cal.leeming at simplicitymedialtd.co.uk> wrote:
> > This might be a little question but, if RabbitMQ runs out of memory, and I
> > am unable to open a new channel, how would one then consume off the queue,
> > if one isn't able to open a channel to do so? Or is this something which has
> > been solved with the new persister?

The "new persister" is the solution to this problem and has recently
been merged into the default branch (a couple of weeks ago) which is why
you're now seeing that this isn't so much of a problem.

Basically, the "new persister" allows paging of messages so Rabbit
should never run out of memory for very long - it should always (well,
nearly always) be able to free up some memory by writing messages out to
disk.

Glad it's now working for you.

Matthew

From cal.leeming at simplicitymedialtd.co.uk  Thu Aug 19 01:16:17 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 19 Aug 2010 01:16:17 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <20100818223934.GA17230@wellquite.org>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
Message-ID: <AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>

Hi all,

I am now getting the following errors when using RabbitMQ with Python Celery
and Django Celery..

The below error messages doesn't mean much to be sadly.. Could anyone shed
some light on what the below actually means??

Cheers

Cal

==> /var/log/rabbitmq/rabbit at mail01.log <==

=WARNING REPORT==== 19-Aug-2010::01:13:31 ===
exception on TCP connection <0.2829.0> from 10.1.3.1:54996
connection_closed_abruptly

=INFO REPORT==== 19-Aug-2010::01:13:31 ===
closing TCP connection <0.2829.0> from 10.1.3.1:54996

=INFO REPORT==== 19-Aug-2010::01:13:32 ===
accepted TCP connection on 0.0.0.0:5672 from 10.1.3.1:44483

=INFO REPORT==== 19-Aug-2010::01:13:32 ===
starting TCP connection <0.2923.0> from 10.1.3.1:44483

=INFO REPORT==== 19-Aug-2010::01:13:32 ===
accepted TCP connection on 0.0.0.0:5672 from 10.1.3.1:44484

=INFO REPORT==== 19-Aug-2010::01:13:32 ===
starting TCP connection <0.2925.0> from 10.1.3.1:44484

=ERROR REPORT==== 19-Aug-2010::01:13:32 ===
** Generic server <0.2936.0> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'basic.publish',0,<<"tasks">>,

<<"bluemail.cache.updatecampaignstatus">>,
                                   false,false},
                               {content,60,none,

<<208,0,30,97,112,112,108,105,99,97,116,105,

111,110,47,120,45,112,121,116,104,111,110,

45,115,101,114,105,97,108,105,122,101,6,
                                     98,105,110,97,114,121,2>>,
                                   rabbit_framing_amqp_0_8,

[<<"(dp1\nS'retries'\np2\nI0\nsS'task'\np3\nS'webapp.bluemail.tasks.UpdateCampaignStatus'\np4\nsS'args'\np5\n(lp6\nsS'eta'\np7\nNsS'kwargs'\np8\n(dp9\nsS'id'\np10\nS'c49f1e35-a042-43ba-9316-3e99e27a6bf7'\np11\ns.">>]}}}
** When Server state == {ch,running,1,<0.2925.0>,<0.2934.0>,undefined,none,
                            {sets,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                            1,
                            {[],[]},
                            {[],[]},

 <<"simplicitymedialtd">>,<<"bluemail_dev">>,<<>>,
                            {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                            {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                            <0.2926.0>,
                            {state,none,undefined}}
** Reason for termination ==
** {{undef,[{re,split,
                [<<"bluemail.cache.#">>,"\\.",[{return,list}]]},
            {rabbit_exchange_type_topic,topic_matches,2},
            {rabbit_router,'-match_bindings/2-fun-1-',10},
            {qlc,collect,1},
            {qlc,eval,2},
            {mnesia_tm,non_transaction,5},
            {rabbit_router,match_bindings,2},
            {rabbit_exchange_type_topic,publish,2}]},
    [{mnesia_tm,non_transaction,5},
     {rabbit_router,match_bindings,2},
     {rabbit_exchange_type_topic,publish,2},
     {rabbit_exchange,publish,3},
     {rabbit_channel,handle_method,3},
     {rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,7},
     {proc_lib,init_p,5}]}

=ERROR REPORT==== 19-Aug-2010::01:13:32 ===
connection <0.2925.0> (running), channel 1 - error:
{{undef,[{re,split,
             [<<"bluemail.cache.#">>,"\\.",[{return,list}]]},
         {rabbit_exchange_type_topic,topic_matches,2},
         {rabbit_router,'-match_bindings/2-fun-1-',10},
         {qlc,collect,1},
         {qlc,eval,2},
         {mnesia_tm,non_transaction,5},
         {rabbit_router,match_bindings,2},
         {rabbit_exchange_type_topic,publish,2}]},
 [{mnesia_tm,non_transaction,5},
  {rabbit_router,match_bindings,2},
  {rabbit_exchange_type_topic,publish,2},
  {rabbit_exchange,publish,3},
  {rabbit_channel,handle_method,3},
  {rabbit_channel,handle_cast,2},
  {gen_server2,handle_msg,7},
  {proc_lib,init_p,5}]}

=WARNING REPORT==== 19-Aug-2010::01:13:32 ===
Non-AMQP exit reason '{{undef,[{re,split,
                                   [<<"bluemail.cache.#">>,"\\.",
                                    [{return,list}]]},
                               {rabbit_exchange_type_topic,topic_matches,2},

{rabbit_router,'-match_bindings/2-fun-1-',10},
                               {qlc,collect,1},
                               {qlc,eval,2},
                               {mnesia_tm,non_transaction,5},
                               {rabbit_router,match_bindings,2},
                               {rabbit_exchange_type_topic,publish,2}]},
                       [{mnesia_tm,non_transaction,5},
                        {rabbit_router,match_bindings,2},
                        {rabbit_exchange_type_topic,publish,2},
                        {rabbit_exchange,publish,3},
                        {rabbit_channel,handle_method,3},
                        {rabbit_channel,handle_cast,2},
                        {gen_server2,handle_msg,7},
                        {proc_lib,init_p,5}]}'

=INFO REPORT==== 19-Aug-2010::01:13:32 ===
closing TCP connection <0.2925.0> from 10.1.3.1:44484

==> /var/log/rabbitmq/rabbit at mail01-sasl.log <==

=CRASH REPORT==== 19-Aug-2010::01:13:32 ===
  crasher:
    pid: <0.2936.0>
    registered_name: []
    exception exit: {{undef,[{re,split,
                                 [<<"bluemail.cache.#">>,"\\.",
                                  [{return,list}]]},
                             {rabbit_exchange_type_topic,topic_matches,2},
                             {rabbit_router,'-match_bindings/2-fun-1-',10},
                             {qlc,collect,1},
                             {qlc,eval,2},
                             {mnesia_tm,non_transaction,5},
                             {rabbit_router,match_bindings,2},
                             {rabbit_exchange_type_topic,publish,2}]},
                     [{mnesia_tm,non_transaction,5},
                      {rabbit_router,match_bindings,2},
                      {rabbit_exchange_type_topic,publish,2},
                      {rabbit_exchange,publish,3},
                      {rabbit_channel,handle_method,3},
                      {rabbit_channel,handle_cast,2},
                      {gen_server2,handle_msg,7},
                      {proc_lib,init_p,5}]}
      in function  gen_server2:terminate/6
    initial call: gen:init_it(gen_server2,<0.2935.0>,<0.2935.0>,
                              rabbit_channel,
                              [1,<0.2925.0>,<0.2934.0>,
                               <<"simplicitymedialtd">>,<<"bluemail_dev">>,
                               <0.2926.0>],
                              [])
    ancestors: [<0.2935.0>]
    messages: []
    links: [<0.2935.0>]
    dictionary: [{permission_cache,
                      [{{resource,<<"bluemail_dev">>,exchange,<<"tasks">>},
                        write},
                       {{resource,<<"bluemail_dev">>,exchange,<<"tasks">>},
                        configure}]},
                  {guid,{{0,<0.2936.0>},0}}]
    trap_exit: true
    status: running
    heap_size: 610
    stack_size: 23
    reductions: 2649
  neighbours:

==> /var/log/rabbitmq/rabbit at mail01.log <==

=INFO REPORT==== 19-Aug-2010::01:13:38 ===
closing TCP connection <0.2923.0> from 10.1.3.1:44483
^C

 root at mail01.dmemedialtd.com [~/rabbitmq-server/scripts] >


On Wed, Aug 18, 2010 at 11:39 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Cal,
>
> > On Wed, Aug 18, 2010 at 10:44 PM, Cal Leeming [Simplicity Media Ltd] <
> > cal.leeming at simplicitymedialtd.co.uk> wrote:
> > > This might be a little question but, if RabbitMQ runs out of memory,
> and I
> > > am unable to open a new channel, how would one then consume off the
> queue,
> > > if one isn't able to open a channel to do so? Or is this something
> which has
> > > been solved with the new persister?
>
> The "new persister" is the solution to this problem and has recently
> been merged into the default branch (a couple of weeks ago) which is why
> you're now seeing that this isn't so much of a problem.
>
> Basically, the "new persister" allows paging of messages so Rabbit
> should never run out of memory for very long - it should always (well,
> nearly always) be able to free up some memory by writing messages out to
> disk.
>
> Glad it's now working for you.
>
> Matthew
>



-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100819/de6ac73a/attachment-0001.htm>

From matthew at rabbitmq.com  Thu Aug 19 01:19:28 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 19 Aug 2010 01:19:28 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
Message-ID: <20100819001927.GB17230@wellquite.org>

On Thu, Aug 19, 2010 at 01:16:17AM +0100, Cal Leeming [Simplicity Media Ltd] wrote:
> ** {{undef,[{re,split,
>                 [<<"bluemail.cache.#">>,"\\.",[{return,list}]]},

That suggests it can't find the re:split function, which in turn
suggests your erlang is too old. Rabbit requires at least R12B3 which
should include the 're' module.

Matthew

From cal.leeming at simplicitymedialtd.co.uk  Thu Aug 19 01:21:52 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 19 Aug 2010 01:21:52 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <20100819001927.GB17230@wellquite.org>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
	<20100819001927.GB17230@wellquite.org>
Message-ID: <AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>

It would appear that I have a good version of Erlang:

 root at mail01.dmemedialtd.com [~/rabbitmq-server/scripts] > erl -v
Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:2]
[async-threads:0] [kernel-poll:false]

Any thoughts?

On Thu, Aug 19, 2010 at 1:19 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Aug 19, 2010 at 01:16:17AM +0100, Cal Leeming [Simplicity Media
> Ltd] wrote:
> > ** {{undef,[{re,split,
> >                 [<<"bluemail.cache.#">>,"\\.",[{return,list}]]},
>
> That suggests it can't find the re:split function, which in turn
> suggests your erlang is too old. Rabbit requires at least R12B3 which
> should include the 're' module.
>
> Matthew
>



-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100819/2340576c/attachment.htm>

From cal.leeming at simplicitymedialtd.co.uk  Thu Aug 19 01:32:14 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 19 Aug 2010 01:32:14 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
	<20100819001927.GB17230@wellquite.org>
	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
Message-ID: <AANLkTimEcJYMweCA9L-p0sJNcVUqLqVVg1pKWE0eOVu_@mail.gmail.com>

Btw, this was using the latest development branch.. I reverted back to
stable, and it works again, albeit, I now can't use the new persister :(

On Thu, Aug 19, 2010 at 1:21 AM, Cal Leeming [Simplicity Media Ltd] <
cal.leeming at simplicitymedialtd.co.uk> wrote:

> It would appear that I have a good version of Erlang:
>
>  root at mail01.dmemedialtd.com [~/rabbitmq-server/scripts] > erl -v
> Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:2]
> [async-threads:0] [kernel-poll:false]
>
> Any thoughts?
>
> On Thu, Aug 19, 2010 at 1:19 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>
>> On Thu, Aug 19, 2010 at 01:16:17AM +0100, Cal Leeming [Simplicity Media
>> Ltd] wrote:
>> > ** {{undef,[{re,split,
>> >                 [<<"bluemail.cache.#">>,"\\.",[{return,list}]]},
>>
>> That suggests it can't find the re:split function, which in turn
>> suggests your erlang is too old. Rabbit requires at least R12B3 which
>> should include the 're' module.
>>
>> Matthew
>>
>
>
>
> --
>
> Cal Leeming
>
> Operational Security & Support Team
>
> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
> support at simplicitymedialtd.co.uk
> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
> Simplicity Media Ltd. All rights reserved.
> Registered company number 7143564
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100819/47c15a81/attachment.htm>

From matthew at rabbitmq.com  Thu Aug 19 01:33:49 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 19 Aug 2010 01:33:49 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
	<20100819001927.GB17230@wellquite.org>
	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
Message-ID: <20100819003348.GC17230@wellquite.org>

On Thu, Aug 19, 2010 at 01:21:52AM +0100, Cal Leeming [Simplicity Media Ltd] wrote:
> It would appear that I have a good version of Erlang:
> 
>  root at mail01.dmemedialtd.com [~/rabbitmq-server/scripts] > erl -v
> Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:2]
> [async-threads:0] [kernel-poll:false]

Hmm. Try firing up erlang and testing to see if it can find the module:

> erl
Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.7.5  (abort with ^G)
1> re:split(<<"bluemail.cache.#">>,"\\.",[{return,list}]).
["bluemail","cache","#"]

(i.e. type/copy+paste the line from the "re:" onwards).

If you get another undef then that suggests you don't have the re
module. In R12B3, the re module was experimental. I wonder whether that
meant some distributions didn't include it. Did you compile from source
or is your erlang installation from some package? And if so, which
package?

Matthew

From cal.leeming at simplicitymedialtd.co.uk  Thu Aug 19 01:36:33 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 19 Aug 2010 01:36:33 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <20100819003348.GC17230@wellquite.org>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
	<20100819001927.GB17230@wellquite.org>
	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
	<20100819003348.GC17230@wellquite.org>
Message-ID: <AANLkTi=ABQ9PwvKzBau7t8mDLoFZmFQ5QG6kgiOzk8F2@mail.gmail.com>

Hope this helps!

Also, now that I reverted back to the original RabbitMQ (1.8.1-1), the re
bug disappears...

:S

 root at mail01.dmemedialtd.com [~] > erl
Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:2]
[async-threads:0] [kernel-poll:false]

Eshell V5.6.3  (abort with ^G)
1> re:split(<<"bluemail.cache.#">>,"\\.",[{return,list}]).
** exception error: undefined function re:split/3
2>

 root at mail01.dmemedialtd.com [~] > apt-cache showpkg erlang
Package: erlang
Versions:
1:12.b.3-dfsg-4
(/var/lib/apt/lists/mirror.sov.uk.goscomb.net_debian_dists_lenny_main_binary-amd64_Packages)
 Description Language:
                 File:
/var/lib/apt/lists/mirror.sov.uk.goscomb.net_debian_dists_lenny_main_binary-amd64_Packages
                  MD5: 8cd64139254e500ad7dfc44b7460178f


Reverse Depends:
  erlang-x11,erlang 1:12.b.3-dfsg-4
  erlang-x11,erlang
  erlang-src,erlang 1:12.b.3-dfsg-4
  erlang-src,erlang
  erlang-nox,erlang 1:12.b.3-dfsg-4
  erlang-nox,erlang
  erlang-mode,erlang
  erlang-examples,erlang 1:12.b.3-dfsg-4
  erlang-examples,erlang
  erlang-dev,erlang 1:12.b.3-dfsg-4
  erlang-dev,erlang
  erlang-base,erlang 1:12.b.3-dfsg-4
  erlang-base,erlang 1:12.b.3-dfsg-4
  erlang-base,erlang
  erlang-base-hipe,erlang 1:12.b.3-dfsg-4
  erlang-base-hipe,erlang 1:12.b.3-dfsg-4
  erlang-base-hipe,erlang
  erlang-manpages,erlang
  erlang-doc-html,erlang
Dependencies:
1:12.b.3-dfsg-4 - erlang-base (16 (null)) erlang-base-hipe (0 (null))
erlang-nox (0 (null)) erlang-x11 (0 (null)) erlang-dev (0 (null))
erlang-manpages (0 (null)) erlang-doc-html (0 (null)) erlang-mode (0 (null))
erlang-src (0 (null)) erlang-examples (0 (null))
Provides:
1:12.b.3-dfsg-4 -
Reverse Provides:



 root at mail01.dmemedialtd.com [~] > apt-cache showpkg rabbitmq-server
Package: rabbitmq-server
Versions:
1.8.1-1 (/var/lib/dpkg/status)
 Description Language:
                 File: /var/lib/dpkg/status
                  MD5: 84b4ba9b1e860e3e631ab2c47dc87650


Reverse Depends:
Dependencies:
1.8.1-1 - erlang-base (18 1:12.b.3) erlang-base-hipe (2 1:12.b.3) erlang-ssl
(16 (null)) erlang-nox (3 1:13.b-dfsg1-1) erlang-os-mon (16 (null))
erlang-nox (3 1:13.b-dfsg1-1) erlang-mnesia (16 (null)) erlang-nox (3
1:13.b-dfsg1-1) adduser (0 (null)) logrotate (0 (null))
Provides:
1.8.1-1 -
Reverse Provides:


On Thu, Aug 19, 2010 at 1:33 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Aug 19, 2010 at 01:21:52AM +0100, Cal Leeming [Simplicity Media
> Ltd] wrote:
> > It would appear that I have a good version of Erlang:
> >
> >  root at mail01.dmemedialtd.com [~/rabbitmq-server/scripts] > erl -v
> > Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:2]
> > [async-threads:0] [kernel-poll:false]
>
> Hmm. Try firing up erlang and testing to see if it can find the module:
>
> > erl
> Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:4:4] [rq:4]
> [async-threads:0] [hipe] [kernel-poll:false]
>
> Eshell V5.7.5  (abort with ^G)
> 1> re:split(<<"bluemail.cache.#">>,"\\.",[{return,list}]).
> ["bluemail","cache","#"]
>
> (i.e. type/copy+paste the line from the "re:" onwards).
>
> If you get another undef then that suggests you don't have the re
> module. In R12B3, the re module was experimental. I wonder whether that
> meant some distributions didn't include it. Did you compile from source
> or is your erlang installation from some package? And if so, which
> package?
>
> Matthew
>



-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100819/6d53d047/attachment-0001.htm>

From matthew at rabbitmq.com  Thu Aug 19 01:42:25 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 19 Aug 2010 01:42:25 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTi=ABQ9PwvKzBau7t8mDLoFZmFQ5QG6kgiOzk8F2@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
	<20100819001927.GB17230@wellquite.org>
	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
	<20100819003348.GC17230@wellquite.org>
	<AANLkTi=ABQ9PwvKzBau7t8mDLoFZmFQ5QG6kgiOzk8F2@mail.gmail.com>
Message-ID: <20100819004224.GD17230@wellquite.org>

On Thu, Aug 19, 2010 at 01:36:33AM +0100, Cal Leeming [Simplicity Media Ltd] wrote:
> Also, now that I reverted back to the original RabbitMQ (1.8.1-1), the re
> bug disappears...

That's very odd - as far as I'm aware, there are no changes between
1.8.1 and default regarding the use of regexp versus the re module (the
re module is the replacement for the new deprecated regexp module). I
wonder if this points more to different multiple versions of erlang
installed on your system - thus when you run and compile rabbit from
source it picks up something different to if you use the binary. Any
chance of that happening?

I would have thought a ps ax | grep rabbit for each case should be
enough to see what's different.

Matthew

From cal.leeming at simplicitymedialtd.co.uk  Thu Aug 19 01:56:22 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 19 Aug 2010 01:56:22 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <20100819004224.GD17230@wellquite.org>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
	<20100819001927.GB17230@wellquite.org>
	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
	<20100819003348.GC17230@wellquite.org>
	<AANLkTi=ABQ9PwvKzBau7t8mDLoFZmFQ5QG6kgiOzk8F2@mail.gmail.com>
	<20100819004224.GD17230@wellquite.org>
Message-ID: <AANLkTi=A1mGmsBwNO=+sFM4KH_cNRekAn_VUBPN1+tdv@mail.gmail.com>

Hey Matthew,

As far as I know, there is only a single instance of Erlang installed on the
server.

However, I think it's safe to assume that I am probably doing something
wrong when compiling the RabbitMQ from scratch, so I'm going to have another
play around and see if I can figure out what is happening.

Thank you for all your help :)

Cal

On Thu, Aug 19, 2010 at 1:42 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Aug 19, 2010 at 01:36:33AM +0100, Cal Leeming [Simplicity Media
> Ltd] wrote:
> > Also, now that I reverted back to the original RabbitMQ (1.8.1-1), the re
> > bug disappears...
>
> That's very odd - as far as I'm aware, there are no changes between
> 1.8.1 and default regarding the use of regexp versus the re module (the
> re module is the replacement for the new deprecated regexp module). I
> wonder if this points more to different multiple versions of erlang
> installed on your system - thus when you run and compile rabbit from
> source it picks up something different to if you use the binary. Any
> chance of that happening?
>
> I would have thought a ps ax | grep rabbit for each case should be
> enough to see what's different.
>
> Matthew
>



-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100819/e71e1eb7/attachment.htm>

From derek.p.moore at gmail.com  Thu Aug 19 04:46:07 2010
From: derek.p.moore at gmail.com (Derek Moore)
Date: Wed, 18 Aug 2010 22:46:07 -0500
Subject: [rabbitmq-discuss] rabbitutil.js - rabbitmqctl sibling in
 JavaScript w/ RabbitMQ Java & Mozilla Rhino
Message-ID: <AANLkTikVw9Zu6xLv-1=to7+wTPDgkJ_Rr9+w0aY8caHc@mail.gmail.com>

I wrote this today at work.  Others may find it useful also.

I wanted what rabbitmqctl seemed to lack, so I wrote this up quick & dirty.
 It is very simple, no validation, but functional.  I also needed something
to inject messages for testing purposes.

I run the JavaScript from a shell script called "rabbitutil":
--
#!/bin/bash
java -cp js.jar:commons-io-1.2.jar:rabbitmq-client.jar \
org.mozilla.javascript.tools.shell.Main rabbitutil.js $@
--
and/or jrunscript (which I haven't really tested):
jrunscript -cp commons-io-1.2.jar:rabbitmq-client.jar rabbitutil.js

Source attached as "rabbitutil.txt", since .js is commonly filtered.

Cheers,

Derek P. Moore
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100818/53e616b5/attachment.htm>
-------------- next part --------------
var port = 5671;
var user = 'guest';
var pass = 'guest';

switch (arguments[0]) {

case 'create_exchange':
	if (arguments.length < 4) {
		print('create_exchange arguments: server, exchange, type, optional vhost.');
		quit();
	}
	server = arguments[1];
	exchange = arguments[2];
	type = arguments[3];
	vhost = (arguments.length > 4) ? arguments[4] : '/';
	connect(); create_ex(); close();
	break;

case 'delete_exchange':
	if (arguments.length < 3) {
		print('delete_exchange arguments: server, exchange, optional vhost.');
		quit();
	}
	server = arguments[1];
	exchange = arguments[2];
	vhost = (arguments.length > 3) ? arguments[3] : '/';
	connect(); delete_ex(); close();
	break;

case 'create_queue':
	if (arguments.length < 4) {
		print('create_queue arguments: server, exchange, queue, optional routing_key, optional vhost.');
		quit();
	}
	server = arguments[1];
	exchange = arguments[2];
	queue = arguments[3];
	key = (arguments.length > 4) ? arguments[4] : null;
	vhost = (arguments.length > 5) ? arguments[5] : '/';
	connect(); create_q(); close();
	break;

case 'delete_queue':
	if (arguments.length < 3) {
		print('delete_queue arguments: server, queue, optional vhost.');
		quit();
	}
	server = arguments[1];
	queue = arguments[2];
	vhost = (arguments.length > 3) ? arguments[3] : '/';
	connect(); delete_q(); close();
	break;

case 'delete_queues':
	if (arguments.length < 2) {
		print('delete_queues arguments: server, optional vhost.');
		print('delete_queues takes lines of queue names as standard input.');
		quit();
	}
	server = arguments[1];
	vhost = (arguments.length > 2) ? arguments[2] : '/';
	connect(); delete_qs(); close();
	break;

case 'create_bind':
	if (arguments.length < 5) {
		print('create_bind arguments: server, exchange, queue, routing_key, optional vhost.');
		quit();
	}
	server = arguments[1];
	exchange = arguments[2];
	queue = arguments[3];
	key = arguments[4];
	vhost = (arguments.length > 5) ? arguments[5] : '/';
	connect(); create_q(); close();
	break;

case 'delete_bind':
	if (arguments.length < 5) {
		print('delete_bind arguments: server, exchange, queue, routing_key, optional vhost.');
		quit();
	}
	server = arguments[1];
	exchange = arguments[2];
	queue = arguments[3];
	key = arguments[4];
	vhost = (arguments.length > 5) ? arguments[5] : '/';
	connect(); create_q(); close();
	break;

case 'inject_msg':
	if (arguments.length < 5) {
		print('inject_event arguments: server, exchange, msg_key, msg_data, optional vhost.');
		quit();
	}
	server = arguments[1];
	exchange = arguments[2];
	msg_key = arguments[3];
	msg_data = arguments[4];
	vhost = (arguments.length > 5) ? arguments[5] : '/';
	connect(); inject_ev(); close();
	break;

case 'inject_msgs':
	if (arguments.length < 4) {
		print('inject_events arguments: server, exchange, msg_key, optional vhost.');
		print('inject_events takes lines of message data as standard input.');
		quit();
	}
	server = arguments[1];
	exchange = arguments[2];
	msg_key = arguments[3];
	vhost = (arguments.length > 4) ? arguments[4] : '/';
	connect(); inject_evs(); close();
	break;

case 'remove_msg':
	if (arguments.length < 3) {
		print('inject_events arguments: server, queue, optional vhost.');
		quit();
	}
	server = arguments[1];
	queue = arguments[2];
	vhost = (arguments.length > 3) ? arguments[3] : '/';
	connect(); remove_ev(); close();
	break;

default:
	print('Commands: create_exchange, delete_exchange,');
	print('          create_queue, delete_queue, delete_queues,');
	print('          create_bind, delete_bind,');
	print('          inject_msg, inject_msgs,');
	print('          remove_msg.');
	quit();
}

function connect() {
	var f = new com.rabbitmq.client.ConnectionFactory();
	f.setHost(server);
	f.setPort(port);
	f.setUsername(user);
	f.setPassword(pass);
	f.setVirtualHost(vhost);

	conn = f.newConnection();
	chan = conn.createChannel();
}

function create_ex() {
	chan.exchangeDeclare(exchange, type, true);
}

function delete_ex() {
	chan.exchangeDelete(exchange);
}

function create_q() {
	chan.queueDeclare(queue, true, false, false, null);
	if (key) chan.queueBind(queue, exchange, key);
}

function delete_q() {
	chan.queueDelete(queue);
}

function delete_qs() {
	var input = new java.io.BufferedReader(new java.io.InputStreamReader(
	                                           java.lang.System['in']));
	while ((str = input.readLine()) != null) chan.queueDelete(str);
}

function create_bind() {
	chan.queueBind(queue, exchange, key);
}

function delete_bind() {
	chan.queueUnbind(queue, exchange, key);
}

function inject_msg() {
	chan.basicPublish(exchange, msg_key, null,
	                  (new java.lang.String(msg_data)).getBytes());
}

function inject_msgs() {
	var input = new java.io.BufferedReader(new java.io.InputStreamReader(
	                                           java.lang.System['in']));
	while ((msg_data = input.readLine()) != null)
		chan.basicPublish(exchange, msg_key, null,
		                  (new java.lang.String(msg_data)).getBytes());
}

function remove_msg() {
	res = chan.basicGet(queue, true);
	print(java.lang.String(res.getBody()));
}

function close() {
	chan.close();
	conn.close();
}

From jiri at krutil.com  Thu Aug 19 09:51:08 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Thu, 19 Aug 2010 10:51:08 +0200
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <4C6C07D1.509@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817093632.61664pueomxsmw4k@webmail.active24.cz>
	<4C6A57E3.6070402@rabbitmq.com>
	<20100817114608.585123v33s43xnxc@webmail.active24.cz>
	<4C6A6AEE.8070601@rabbitmq.com>
	<20100818164347.527066lkl0ashzgo@webmail.active24.cz>
	<4C6C07D1.509@rabbitmq.com>
Message-ID: <20100819105108.159445k87zfxqpic@webmail.active24.cz>

> Just take the output of 'hg diff' and post it here or somewhere else  
> we can see. Thanks.

Attached is a patch against the default branch. I'm new to Erlang so  
please forgive my coding style and feel free to change the code as you  
see fit.

Please let me know if this could become official.

Cheers
Jiri
-------------- next part --------------
diff -r a11bf1f62fbb include/rabbit.hrl
--- a/include/rabbit.hrl	Wed Aug 18 17:40:19 2010 +0100
+++ b/include/rabbit.hrl	Thu Aug 19 09:49:35 2010 +0100
@@ -68,7 +68,7 @@
 -record(basic_message, {exchange_name, routing_key, content, guid,
                         is_persistent}).
 
--record(ssl_socket, {tcp, ssl}).
+-record(ssl_socket, {tcp, ssl, cn}).
 -record(delivery, {mandatory, immediate, txn, sender, message}).
 -record(amqp_error, {name, explanation, method = none}).
 
diff -r a11bf1f62fbb src/rabbit_access_control.erl
--- a/src/rabbit_access_control.erl	Wed Aug 18 17:40:19 2010 +0100
+++ b/src/rabbit_access_control.erl	Thu Aug 19 09:49:35 2010 +0100
@@ -33,7 +33,7 @@
 -include_lib("stdlib/include/qlc.hrl").
 -include("rabbit.hrl").
 
--export([check_login/2, user_pass_login/2,
+-export([check_login/3, user_pass_login/2,
          check_vhost_access/2, check_resource_access/3]).
 -export([add_user/2, delete_user/1, change_password/2, list_users/0,
          lookup_user/1]).
@@ -52,10 +52,11 @@
 -type(password() :: binary()).
 -type(regexp() :: binary()).
 -type(scope() :: binary()).
+-type(socket() :: rabbit_networking:ip_port() | rabbit_types:ssl_socket()).
 
--spec(check_login/2 ::
-        (binary(), binary()) -> rabbit_types:user() |
-                                rabbit_types:channel_exit()).
+-spec(check_login/3 ::
+        (binary(), binary(), socket()) -> rabbit_types:user() |
+                                          rabbit_types:channel_exit()).
 -spec(user_pass_login/2 ::
         (username(), password())
         -> rabbit_types:user() | rabbit_types:channel_exit()).
@@ -95,33 +96,54 @@
 
 %% SASL PLAIN, as used by the Qpid Java client and our clients. Also,
 %% apparently, by OpenAMQ.
-check_login(<<"PLAIN">>, Response) ->
-    [User, Pass] = [list_to_binary(T) ||
-                       T <- string:tokens(binary_to_list(Response), [0])],
-    user_pass_login(User, Pass);
+check_login(<<"PLAIN">>, Response, Sock) ->
+    case is_record(Sock, ssl_socket) andalso Sock#ssl_socket.cn /= none of
+        true ->
+            certificate_login(Sock);
+        false ->
+            [User, Pass] = [list_to_binary(T) ||
+                               T <- string:tokens(binary_to_list(Response), [0])],
+            user_pass_login(User, Pass)
+    end;
 %% AMQPLAIN, as used by Qpid Python test suite. The 0-8 spec actually
 %% defines this as PLAIN, but in 0-9 that definition is gone, instead
 %% referring generically to "SASL security mechanism", i.e. the above.
-check_login(<<"AMQPLAIN">>, Response) ->
-    LoginTable = rabbit_binary_parser:parse_table(Response),
-    case {lists:keysearch(<<"LOGIN">>, 1, LoginTable),
-          lists:keysearch(<<"PASSWORD">>, 1, LoginTable)} of
-        {{value, {_, longstr, User}},
-         {value, {_, longstr, Pass}}} ->
-            user_pass_login(User, Pass);
-        _ ->
-            %% Is this an information leak?
-            rabbit_misc:protocol_error(
-              access_refused,
-              "AMQPPLAIN auth info ~w is missing LOGIN or PASSWORD field",
-              [LoginTable])
+check_login(<<"AMQPLAIN">>, Response, Sock) ->
+    case is_record(Sock, ssl_socket) andalso Sock#ssl_socket.cn /= none of
+        true ->
+            certificate_login(Sock);
+        false ->
+            LoginTable = rabbit_binary_parser:parse_table(Response),
+            case {lists:keysearch(<<"LOGIN">>, 1, LoginTable),
+                  lists:keysearch(<<"PASSWORD">>, 1, LoginTable)} of
+                {{value, {_, longstr, User}},
+                 {value, {_, longstr, Pass}}} ->
+                    user_pass_login(User, Pass);
+                _ ->
+                    %% Is this an information leak?
+                    rabbit_misc:protocol_error(
+                      access_refused,
+                      "AMQPPLAIN auth info ~w is missing LOGIN or PASSWORD field",
+                      [LoginTable])
+            end
     end;
 
-check_login(Mechanism, _Response) ->
+check_login(Mechanism, _Response, _Sock) ->
     rabbit_misc:protocol_error(
       access_refused, "unsupported authentication mechanism '~s'",
       [Mechanism]).
 
+certificate_login(Sock) ->
+    CN = list_to_binary(Sock#ssl_socket.cn),
+    ?LOGDEBUG("Login with cert (CN=~s)~n", [CN]),
+    case lookup_user(CN) of
+        {ok, U} ->
+            U;
+        {error, not_found} ->
+            rabbit_misc:protocol_error(
+              access_refused, "certificate login refused for Common Name '~s'", [CN])
+    end.
+
 user_pass_login(User, Pass) ->
     ?LOGDEBUG("Login with user ~p pass ~p~n", [User, Pass]),
     case lookup_user(User) of
diff -r a11bf1f62fbb src/rabbit_networking.erl
--- a/src/rabbit_networking.erl	Wed Aug 18 17:40:19 2010 +0100
+++ b/src/rabbit_networking.erl	Thu Aug 19 09:49:35 2010 +0100
@@ -45,6 +45,7 @@
          start_client/1, start_ssl_client/2]).
 
 -include("rabbit.hrl").
+-include_lib("public_key/include/OTP-PUB-KEY.hrl").
 -include_lib("kernel/include/inet.hrl").
 
 -define(RABBIT_TCP_OPTS, [
@@ -216,19 +217,65 @@
     start_client(
       Sock,
       fun (Sock1) ->
-              case catch ssl:ssl_accept(Sock1, SslOpts, ?SSL_TIMEOUT * 1000) of
-                  {ok, SslSock} ->
-                      rabbit_log:info("upgraded TCP connection ~p to SSL~n",
-                                      [self()]),
-                      {ok, #ssl_socket{tcp = Sock1, ssl = SslSock}};
-                  {error, Reason} ->
-                      {error, {ssl_upgrade_error, Reason}};
-                  {'EXIT', Reason} ->
-                      {error, {ssl_upgrade_failure, Reason}}
+         case catch ssl:ssl_accept(Sock1, SslOpts, ?SSL_TIMEOUT * 1000) of
+             {ok, SslSock} ->
+                 % authenticate with certificate or password?
+                 case proplists:get_value(authentication, SslOpts, password) of
+                     cert ->
+                         % retrieve client certificate and extract subject Common Name
+                         case ssl:peercert(SslSock, [ssl]) of
+                             {ok, Cert} ->
+                                 case extract_common_name(Cert) of
+                                     error ->
+                                         {error, {ssl_upgrade_error,
+                                             "Could not extract CommonName from client cert"}};
+                                     CommonName ->
+                                         rabbit_log:info(
+                                             "upgraded TCP connection ~p to SSL (CN=~p)~n",
+                                             [self(), CommonName]),
+                                         {ok, #ssl_socket{
+                                             tcp = Sock1, ssl = SslSock, cn = CommonName}}
+                                 end;
+                             {error, Reason} ->
+                                 {error, {ssl_upgrade_error, Reason}}
+                         end;
+                     _ ->
+                         rabbit_log:info("upgraded TCP connection ~p to SSL~n",
+                                         [self()]),
+                         {ok, #ssl_socket{tcp = Sock1, ssl = SslSock, cn = none}}
+                 end;
+             {error, Reason} ->
+                 {error, {ssl_upgrade_error, Reason}};
+             {'EXIT', Reason} ->
+                 {error, {ssl_upgrade_failure, Reason}}
 
-              end
+         end
       end).
 
+extract_common_name(Cert) ->
+    case is_record(Cert, 'OTPCertificate') of
+        true ->
+            TbsCert = Cert#'OTPCertificate'.tbsCertificate,
+            case is_record(TbsCert, 'OTPTBSCertificate') of
+                true ->
+                    Subject = TbsCert#'OTPTBSCertificate'.subject,
+                    case Subject of
+                        {rdnSequence, Attributes} ->
+                            find_attribute(Attributes, ?'id-at-commonName');
+                        _ -> error
+                    end;
+                false -> error
+            end;
+        false -> error
+    end.
+
+find_attribute([], _) -> error;
+find_attribute([Attr | Tail], Key) ->
+    case Attr of
+        [{'AttributeTypeAndValue', Key, {printableString, Value}}] -> Value;
+        _ -> find_attribute(Tail, Key)
+    end.
+
 connections() ->
     [Pid || {_, Pid, _, _} <- supervisor:which_children(
                                 rabbit_tcp_client_sup)].
diff -r a11bf1f62fbb src/rabbit_reader.erl
--- a/src/rabbit_reader.erl	Wed Aug 18 17:40:19 2010 +0100
+++ b/src/rabbit_reader.erl	Thu Aug 19 09:49:35 2010 +0100
@@ -719,7 +719,7 @@
                            connection = Connection =
                                #connection{protocol = Protocol},
                            sock = Sock}) ->
-    User = rabbit_access_control:check_login(Mechanism, Response),
+    User = rabbit_access_control:check_login(Mechanism, Response, Sock),
     Tune = #'connection.tune'{channel_max = 0,
                               frame_max = ?FRAME_MAX,
                               heartbeat = 0},

From matthias at rabbitmq.com  Thu Aug 19 10:34:04 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Aug 2010 10:34:04 +0100
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <20100819105108.159445k87zfxqpic@webmail.active24.cz>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>	<4C65FC4E.8070804@rabbitmq.com>
	<4C66AA9F.1000006@rabbitmq.com>	<20100815101257.GA4835@wellquite.org>	<20100816103018.GA16525@rabbitmq.com>	<766990.31259.qm@web31804.mail.mud.yahoo.com>	<597082.60604.qm@web31809.mail.mud.yahoo.com>	<20100817093632.61664pueomxsmw4k@webmail.active24.cz>	<4C6A57E3.6070402@rabbitmq.com>	<20100817114608.585123v33s43xnxc@webmail.active24.cz>	<4C6A6AEE.8070601@rabbitmq.com>	<20100818164347.527066lkl0ashzgo@webmail.active24.cz>	<4C6C07D1.509@rabbitmq.com>
	<20100819105108.159445k87zfxqpic@webmail.active24.cz>
Message-ID: <4C6CFA8C.70801@rabbitmq.com>

Jiri,

On 19/08/10 09:51, jiri at krutil.com wrote:
> Attached is a patch against the default branch. I'm new to Erlang so
> please forgive my coding style and feel free to change the code as you
> see fit.

This looks quite reasonable. It will require some work to generalise it 
and clean up the APIs. I have attached the patch to the bug, so we can 
look at it when we find the time. Realistically this is unlikely to 
happen any time soon. So meanwhile, if you need this feature, I suggest 
you run rabbit with that patch applied.


Regards,

Matthias.

From gsim at redhat.com  Thu Aug 19 10:47:00 2010
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 19 Aug 2010 10:47:00 +0100
Subject: [rabbitmq-discuss] Authenticate client using certificate only
In-Reply-To: <20100819105108.159445k87zfxqpic@webmail.active24.cz>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>	<4C65FC4E.8070804@rabbitmq.com>
	<4C66AA9F.1000006@rabbitmq.com>	<20100815101257.GA4835@wellquite.org>	<20100816103018.GA16525@rabbitmq.com>	<766990.31259.qm@web31804.mail.mud.yahoo.com>	<597082.60604.qm@web31809.mail.mud.yahoo.com>	<20100817093632.61664pueomxsmw4k@webmail.active24.cz>	<4C6A57E3.6070402@rabbitmq.com>	<20100817114608.585123v33s43xnxc@webmail.active24.cz>	<4C6A6AEE.8070601@rabbitmq.com>	<20100818164347.527066lkl0ashzgo@webmail.active24.cz>	<4C6C07D1.509@rabbitmq.com>
	<20100819105108.159445k87zfxqpic@webmail.active24.cz>
Message-ID: <4C6CFD94.7060301@redhat.com>

On 08/19/2010 09:51 AM, jiri at krutil.com wrote:
>   %% AMQPLAIN, as used by Qpid Python test suite. The 0-8 spec actually
>   %% defines this as PLAIN, but in 0-9 that definition is gone, instead
>   %% referring generically to "SASL security mechanism", i.e. the above.
> -check_login(<<"AMQPLAIN">>, Response) ->
> -    LoginTable = rabbit_binary_parser:parse_table(Response),
> -    case {lists:keysearch(<<"LOGIN">>, 1, LoginTable),
> -          lists:keysearch(<<"PASSWORD">>, 1, LoginTable)} of
> -        {{value, {_, longstr, User}},
> -         {value, {_, longstr, Pass}}} ->
> -            user_pass_login(User, Pass);
> -        _ ->
> -            %% Is this an information leak?
> -            rabbit_misc:protocol_error(
> -              access_refused,
> -              "AMQPPLAIN auth info ~w is missing LOGIN or PASSWORD field",
> -              [LoginTable])
> +check_login(<<"AMQPLAIN">>, Response, Sock) ->
> +    case is_record(Sock, ssl_socket) andalso Sock#ssl_socket.cn /= none of
> +        true ->
> +            certificate_login(Sock);
> +        false ->
> +            LoginTable = rabbit_binary_parser:parse_table(Response),
> +            case {lists:keysearch(<<"LOGIN">>, 1, LoginTable),
> +                  lists:keysearch(<<"PASSWORD">>, 1, LoginTable)} of
> +                {{value, {_, longstr, User}},
> +                 {value, {_, longstr, Pass}}} ->
> +                    user_pass_login(User, Pass);
> +                _ ->
> +                    %% Is this an information leak?
> +                    rabbit_misc:protocol_error(
> +                      access_refused,
> +                      "AMQPPLAIN auth info ~w is missing LOGIN or PASSWORD field",
> +                      [LoginTable])
> +            end
>       end;

The SASL EXTERNAL mechanism is intended for just such use cases (i.e. 
where the underlying transport authenticates itself and no further 
exchange is required). So a nice way (though perhaps a slightly more 
involved patch) might be to offer that mechanism on SSL connections. 
Just a suggestion however.

From cal.leeming at simplicitymedialtd.co.uk  Thu Aug 19 12:51:44 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 19 Aug 2010 12:51:44 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTin5cxyW1zFn8T1dZcSZ_Y9zAgGbwdu9LPrQFQYD@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
	<20100819001927.GB17230@wellquite.org>
	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
	<20100819003348.GC17230@wellquite.org>
	<AANLkTi=ABQ9PwvKzBau7t8mDLoFZmFQ5QG6kgiOzk8F2@mail.gmail.com>
	<20100819004224.GD17230@wellquite.org>
	<AANLkTi=A1mGmsBwNO=+sFM4KH_cNRekAn_VUBPN1+tdv@mail.gmail.com>
	<AANLkTin5cxyW1zFn8T1dZcSZ_Y9zAgGbwdu9LPrQFQYD@mail.gmail.com>
Message-ID: <AANLkTimESCWc3EcvdgH6LW--iEauS4DYPDsHHY4zaMws@mail.gmail.com>

Hey guys,

Looks like I found the offending change.. I'm attempting to compile a newer
version of Erlang now to see if this resolves the problem.

src/rabbit_exchange_type_topic.erl
branchbug23138changeset 45136c99455ffbc1
<http://hg.rabbitmq.com/rabbitmq-server/rev/6c99455ffbc1>parent
3982ce8aaaaaa101
<http://hg.rabbitmq.com/rabbitmq-server/diff/ce8aaaaaa101/src/rabbit_exchange_type_topic.erl>

       1 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l1>
--- a/src/rabbit_exchange_type_topic.erl	Fri Jul 09 12:59:30 2010
+0100       2 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l2>
+++ b/src/rabbit_exchange_type_topic.erl	Thu Aug 19 12:28:48 2010
+0100       3 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l3>
@@ -67,8 +67,7 @@       4
<http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l4>
                           Delivery).       5
<http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l5>
        6 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l6>
 split_topic_key(Key) ->       7
<http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l7>
-    KeySplit = re:split(Key, "\\.", [{return, list}]),       8
<http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l8>
-    KeySplit.       9
<http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l9>
+    re:split(Key, "\\.", [{return, list}]).      10
<http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l10>
       11 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l11>
 topic_matches(PatternKey, RoutingKey) ->      12
<http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l12>
     P = split_topic_key(PatternKey),


On Thu, Aug 19, 2010 at 1:56 AM, Cal Leeming [Simplicity Media Ltd] <
cal.leeming at simplicitymedialtd.co.uk> wrote:

>
>
> ---------- Forwarded message ----------
> From: Cal Leeming [Simplicity Media Ltd] <
> cal.leeming at simplicitymedialtd.co.uk>
> Date: Thu, Aug 19, 2010 at 1:56 AM
> Subject: Re: [rabbitmq-discuss] Problems with RabbitMQ not responding on
> channel request
> To: "Cal Leeming [Simplicity Media Ltd]" <
> cal.leeming at simplicitymedialtd.co.uk>, rabbitmq-discuss at lists.rabbitmq.com
>
>
> Hey Matthew,
>
> As far as I know, there is only a single instance of Erlang installed on
> the server.
>
> However, I think it's safe to assume that I am probably doing something
> wrong when compiling the RabbitMQ from scratch, so I'm going to have another
> play around and see if I can figure out what is happening.
>
> Thank you for all your help :)
>
> Cal
>
> On Thu, Aug 19, 2010 at 1:42 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>
>> On Thu, Aug 19, 2010 at 01:36:33AM +0100, Cal Leeming [Simplicity Media
>> Ltd] wrote:
>> > Also, now that I reverted back to the original RabbitMQ (1.8.1-1), the
>> re
>> > bug disappears...
>>
>> That's very odd - as far as I'm aware, there are no changes between
>> 1.8.1 and default regarding the use of regexp versus the re module (the
>> re module is the replacement for the new deprecated regexp module). I
>> wonder if this points more to different multiple versions of erlang
>> installed on your system - thus when you run and compile rabbit from
>> source it picks up something different to if you use the binary. Any
>> chance of that happening?
>>
>> I would have thought a ps ax | grep rabbit for each case should be
>> enough to see what's different.
>>
>> Matthew
>>
>
>
>
> --
>
> Cal Leeming
>
> Operational Security & Support Team
>
> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
> support at simplicitymedialtd.co.uk
> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
> Simplicity Media Ltd. All rights reserved.
> Registered company number 7143564
>
>
>
>
> --
>
> Cal Leeming
>
> Operational Security & Support Team
>
> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
> support at simplicitymedialtd.co.uk
> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
> Simplicity Media Ltd. All rights reserved.
> Registered company number 7143564
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100819/c638094e/attachment.htm>

From cal.leeming at simplicitymedialtd.co.uk  Thu Aug 19 12:53:48 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 19 Aug 2010 12:53:48 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTimESCWc3EcvdgH6LW--iEauS4DYPDsHHY4zaMws@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>
	<20100818164412.GF2810@dakota.eng.vmware.com>
	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>
	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>
	<20100818223934.GA17230@wellquite.org>
	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>
	<20100819001927.GB17230@wellquite.org>
	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>
	<20100819003348.GC17230@wellquite.org>
	<AANLkTi=ABQ9PwvKzBau7t8mDLoFZmFQ5QG6kgiOzk8F2@mail.gmail.com>
	<20100819004224.GD17230@wellquite.org>
	<AANLkTi=A1mGmsBwNO=+sFM4KH_cNRekAn_VUBPN1+tdv@mail.gmail.com>
	<AANLkTin5cxyW1zFn8T1dZcSZ_Y9zAgGbwdu9LPrQFQYD@mail.gmail.com>
	<AANLkTimESCWc3EcvdgH6LW--iEauS4DYPDsHHY4zaMws@mail.gmail.com>
Message-ID: <AANLkTikaZ6sMDUHre50zMi9P99edAEbu93ak_GqccKbD@mail.gmail.com>

Hi again,

Looks like you were right Matthew. It would seem V5.6.3 is no
longer adequate for RabbitMQ to function properly. For anyone else who runs
into this problem with Celery/Django Celery along side RabbitMQ, you have to
make sure you are running a newer version of Erlang (I'm now using 5.8)
along with the latest export of RabbitMQ.

I'll let you know if this resolves all the bugs..

Cheers

Cal

 root at mail01.dmemedialtd.com [~] > erl
Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:2]
[async-threads:0] [kernel-poll:false]

Eshell V5.6.3  (abort with ^G)
1> re:split("Erlang","[ln]",[{return,list}]).
** exception error: undefined function re:split/3

 root at mail01.dmemedialtd.com [~/otp_src_R14A] > ./bin/erl
Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0]
[hipe] [kernel-poll:false]

Eshell V5.8  (abort with ^G)
1> re:split("Erlang","[ln]",[{return,list}]).
["Er","a","g"]
2>



On Thu, Aug 19, 2010 at 12:51 PM, Cal Leeming [Simplicity Media Ltd] <
cal.leeming at simplicitymedialtd.co.uk> wrote:

> Hey guys,
>
> Looks like I found the offending change.. I'm attempting to compile a newer
> version of Erlang now to see if this resolves the problem.
>
>
> src/rabbit_exchange_type_topic.erl
>
> branchbug23138
> changeset 45136c99455ffbc1 <http://hg.rabbitmq.com/rabbitmq-server/rev/6c99455ffbc1>parent 3982ce8aaaaaa101 <http://hg.rabbitmq.com/rabbitmq-server/diff/ce8aaaaaa101/src/rabbit_exchange_type_topic.erl>
>
>        1 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l1> --- a/src/rabbit_exchange_type_topic.erl	Fri Jul 09 12:59:30 2010 +0100       2 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l2> +++ b/src/rabbit_exchange_type_topic.erl	Thu Aug 19 12:28:48 2010 +0100       3 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l3> @@ -67,8 +67,7 @@       4 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l4>                            Delivery).       5 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l5>         6 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l6>  split_topic_key(Key) ->       7 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l7> -    KeySplit = re:split(Key, "\\.", [{return, list}]),       8 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l8> -    KeySplit.       9 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l9> +    re:split(Key, "\\.", [{return, list}]).      10 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l10>        11 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l11>  topic_matches(PatternKey, RoutingKey) ->      12 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l12>      P = split_topic_key(PatternKey),
>
>
> On Thu, Aug 19, 2010 at 1:56 AM, Cal Leeming [Simplicity Media Ltd] <
> cal.leeming at simplicitymedialtd.co.uk> wrote:
>
>>
>>
>> ---------- Forwarded message ----------
>> From: Cal Leeming [Simplicity Media Ltd] <
>> cal.leeming at simplicitymedialtd.co.uk>
>> Date: Thu, Aug 19, 2010 at 1:56 AM
>> Subject: Re: [rabbitmq-discuss] Problems with RabbitMQ not responding on
>> channel request
>> To: "Cal Leeming [Simplicity Media Ltd]" <
>> cal.leeming at simplicitymedialtd.co.uk>,
>> rabbitmq-discuss at lists.rabbitmq.com
>>
>>
>> Hey Matthew,
>>
>> As far as I know, there is only a single instance of Erlang installed on
>> the server.
>>
>> However, I think it's safe to assume that I am probably doing something
>> wrong when compiling the RabbitMQ from scratch, so I'm going to have another
>> play around and see if I can figure out what is happening.
>>
>> Thank you for all your help :)
>>
>> Cal
>>
>> On Thu, Aug 19, 2010 at 1:42 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>>
>>> On Thu, Aug 19, 2010 at 01:36:33AM +0100, Cal Leeming [Simplicity Media
>>> Ltd] wrote:
>>> > Also, now that I reverted back to the original RabbitMQ (1.8.1-1), the
>>> re
>>> > bug disappears...
>>>
>>> That's very odd - as far as I'm aware, there are no changes between
>>> 1.8.1 and default regarding the use of regexp versus the re module (the
>>> re module is the replacement for the new deprecated regexp module). I
>>> wonder if this points more to different multiple versions of erlang
>>> installed on your system - thus when you run and compile rabbit from
>>> source it picks up something different to if you use the binary. Any
>>> chance of that happening?
>>>
>>> I would have thought a ps ax | grep rabbit for each case should be
>>> enough to see what's different.
>>>
>>> Matthew
>>>
>>
>>
>>
>> --
>>
>> Cal Leeming
>>
>> Operational Security & Support Team
>>
>> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
>> support at simplicitymedialtd.co.uk
>> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
>>
>> Simplicity Media Ltd. All rights reserved.
>> Registered company number 7143564
>>
>>
>>
>>
>> --
>>
>> Cal Leeming
>>
>> Operational Security & Support Team
>>
>> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
>> support at simplicitymedialtd.co.uk
>> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
>>
>> Simplicity Media Ltd. All rights reserved.
>> Registered company number 7143564
>>
>>
>
>
> --
>
> Cal Leeming
>
> Operational Security & Support Team
>
> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
> support at simplicitymedialtd.co.uk
> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
> Simplicity Media Ltd. All rights reserved.
> Registered company number 7143564
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100819/69097c51/attachment-0001.htm>

From cal.leeming at simplicitymedialtd.co.uk  Thu Aug 19 13:07:50 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 19 Aug 2010 13:07:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ,
 Celery and Django Celery not playing well together.. solution found!
Message-ID: <AANLkTik_tvUhSagUo8WcxR29enfugYbUdjZ0Wdq9ApqP@mail.gmail.com>

Hey again,

Great news! It's all now working :) This is the combination of items I had
to use in the end:

*Erlang: *Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2]
[async-threads:0] [hipe] [kernel-poll:false]
*Python Celery: *celery-2.0.2-py2.6
*Python Django Celery: *django_celery-2.0.2-py2.6
*Python Django: *Django-1.2.1-py2.6
*RabbitMQ:* Latest as of 18th August 2010 (AMQP 0-9-1 / 0-9 / 0-8)

Also, this next bit is slightly off topic but, to make the latest version of
RabbitMQ work nicely with Celery, the set_permissions method stated in the
documentation of Celery is wrong..

*Correct:* ./rabbitmqctl set_permissions -p vhost username ".*" ".*" ".*"
*Wrong:* ./rabbitmqctl set_permissions -p vhost username "" ".*" ".*"

I really hope this helps someone, as it's taken me 2-3 days to figure this
out.

Thanks again to Matthew for pointing out the re:split problem!

Cheers

Cal

On Thu, Aug 19, 2010 at 12:53 PM, Cal Leeming [Simplicity Media Ltd] <
cal.leeming at simplicitymedialtd.co.uk> wrote:

> Hi again,
>
> Looks like you were right Matthew. It would seem V5.6.3 is no
> longer adequate for RabbitMQ to function properly. For anyone else who runs
> into this problem with Celery/Django Celery along side RabbitMQ, you have to
> make sure you are running a newer version of Erlang (I'm now using 5.8)
> along with the latest export of RabbitMQ.
>
> I'll let you know if this resolves all the bugs..
>
> Cheers
>
> Cal
>
>  root at mail01.dmemedialtd.com [~] > erl
> Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:2]
> [async-threads:0] [kernel-poll:false]
>
> Eshell V5.6.3  (abort with ^G)
> 1> re:split("Erlang","[ln]",[{return,list}]).
> ** exception error: undefined function re:split/3
>
>  root at mail01.dmemedialtd.com [~/otp_src_R14A] > ./bin/erl
> Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0]
> [hipe] [kernel-poll:false]
>
> Eshell V5.8  (abort with ^G)
> 1> re:split("Erlang","[ln]",[{return,list}]).
> ["Er","a","g"]
> 2>
>
>
>
> On Thu, Aug 19, 2010 at 12:51 PM, Cal Leeming [Simplicity Media Ltd] <
> cal.leeming at simplicitymedialtd.co.uk> wrote:
>
>> Hey guys,
>>
>> Looks like I found the offending change.. I'm attempting to compile a
>> newer version of Erlang now to see if this resolves the problem.
>>
>>
>>
>> src/rabbit_exchange_type_topic.erl
>>
>>
>> branchbug23138
>>
>> changeset 45136c99455ffbc1 <http://hg.rabbitmq.com/rabbitmq-server/rev/6c99455ffbc1>
>> parent 3982
>> ce8aaaaaa101 <http://hg.rabbitmq.com/rabbitmq-server/diff/ce8aaaaaa101/src/rabbit_exchange_type_topic.erl>
>>
>>        1 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l1> --- a/src/rabbit_exchange_type_topic.erl	Fri Jul 09 12:59:30 2010 +0100       2 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l2> +++ b/src/rabbit_exchange_type_topic.erl	Thu Aug 19 12:28:48 2010 +0100       3 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l3> @@ -67,8 +67,7 @@       4 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l4>                            Delivery).       5 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l5>         6 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l6>  split_topic_key(Key) ->       7 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l7> -    KeySplit = re:split(Key, "\\.", [{return, list}]),       8 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l8> -    KeySplit.       9 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l9> +    re:split(Key, "\\.", [{return, list}]).      10 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l10>        11 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l11>  topic_matches(PatternKey, RoutingKey) ->      12 <http://hg.rabbitmq.com/rabbitmq-server/diff/6c99455ffbc1/src/rabbit_exchange_type_topic.erl#l12>      P = split_topic_key(PatternKey),
>>
>>
>> On Thu, Aug 19, 2010 at 1:56 AM, Cal Leeming [Simplicity Media Ltd] <
>> cal.leeming at simplicitymedialtd.co.uk> wrote:
>>
>>>
>>>
>>> ---------- Forwarded message ----------
>>> From: Cal Leeming [Simplicity Media Ltd] <
>>> cal.leeming at simplicitymedialtd.co.uk>
>>> Date: Thu, Aug 19, 2010 at 1:56 AM
>>> Subject: Re: [rabbitmq-discuss] Problems with RabbitMQ not responding on
>>> channel request
>>> To: "Cal Leeming [Simplicity Media Ltd]" <
>>> cal.leeming at simplicitymedialtd.co.uk>,
>>> rabbitmq-discuss at lists.rabbitmq.com
>>>
>>>
>>> Hey Matthew,
>>>
>>> As far as I know, there is only a single instance of Erlang installed on
>>> the server.
>>>
>>> However, I think it's safe to assume that I am probably doing something
>>> wrong when compiling the RabbitMQ from scratch, so I'm going to have another
>>> play around and see if I can figure out what is happening.
>>>
>>> Thank you for all your help :)
>>>
>>> Cal
>>>
>>> On Thu, Aug 19, 2010 at 1:42 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>>>
>>>> On Thu, Aug 19, 2010 at 01:36:33AM +0100, Cal Leeming [Simplicity Media
>>>> Ltd] wrote:
>>>> > Also, now that I reverted back to the original RabbitMQ (1.8.1-1), the
>>>> re
>>>> > bug disappears...
>>>>
>>>> That's very odd - as far as I'm aware, there are no changes between
>>>> 1.8.1 and default regarding the use of regexp versus the re module (the
>>>> re module is the replacement for the new deprecated regexp module). I
>>>> wonder if this points more to different multiple versions of erlang
>>>> installed on your system - thus when you run and compile rabbit from
>>>> source it picks up something different to if you use the binary. Any
>>>> chance of that happening?
>>>>
>>>> I would have thought a ps ax | grep rabbit for each case should be
>>>> enough to see what's different.
>>>>
>>>> Matthew
>>>>
>>>
>>>
>>>
>>> --
>>>
>>> Cal Leeming
>>>
>>> Operational Security & Support Team
>>>
>>> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
>>> support at simplicitymedialtd.co.uk
>>> *Fax: *+44 (02476) 578987 | *Email: *
>>> cal.leeming at simplicitymedialtd.co.uk
>>> Simplicity Media Ltd. All rights reserved.
>>> Registered company number 7143564
>>>
>>>
>>>
>>>
>>> --
>>>
>>> Cal Leeming
>>>
>>> Operational Security & Support Team
>>>
>>> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
>>> support at simplicitymedialtd.co.uk
>>> *Fax: *+44 (02476) 578987 | *Email: *
>>> cal.leeming at simplicitymedialtd.co.uk
>>> Simplicity Media Ltd. All rights reserved.
>>> Registered company number 7143564
>>>
>>>
>>
>>
>> --
>>
>> Cal Leeming
>>
>> Operational Security & Support Team
>>
>> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
>> support at simplicitymedialtd.co.uk
>> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
>>
>> Simplicity Media Ltd. All rights reserved.
>> Registered company number 7143564
>>
>>
>
>
> --
>
> Cal Leeming
>
> Operational Security & Support Team
>
> *Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
> support at simplicitymedialtd.co.uk
> *Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
> Simplicity Media Ltd. All rights reserved.
> Registered company number 7143564
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100819/de23ed44/attachment.htm>

From matthias at rabbitmq.com  Thu Aug 19 13:11:17 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Aug 2010 13:11:17 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <AANLkTikaZ6sMDUHre50zMi9P99edAEbu93ak_GqccKbD@mail.gmail.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>	<20100818164412.GF2810@dakota.eng.vmware.com>	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>	<20100818223934.GA17230@wellquite.org>	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>	<20100819001927.GB17230@wellquite.org>	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>	<20100819003348.GC17230@wellquite.org>	<AANLkTi=ABQ9PwvKzBau7t8mDLoFZmFQ5QG6kgiOzk8F2@mail.gmail.com>	<20100819004224.GD17230@wellquite.org>	<AANLkTi=A1mGmsBwNO=+sFM4KH_cNRekAn_VUBPN1+tdv@mail.gmail.com>	<AANLkTin5cxyW1zFn8T1dZcSZ_Y9zAgGbwdu9LPrQFQYD@mail.gmail.com>	<AANLkTimESCWc3EcvdgH6LW--iEauS4DYPDsHHY4zaMws@mail.gmail.com>
	<AANLkTikaZ6sMDUHre50zMi9P99edAEbu93ak_GqccKbD@mail.gmail.com>
Message-ID: <4C6D1F65.7020004@rabbitmq.com>

Cal,

On 19/08/10 12:53, Cal Leeming [Simplicity Media Ltd] wrote:
> Looks like you were right Matthew. It would seem V5.6.3 is no
> longer adequate for RabbitMQ to function properly.

It turns out re:split was only introduced in Erlang/OTP R12B-5, so 
rabbit on 'default' currently only works with that version or later. We 
will fix that before the release so rabbit works again with R12B-3 or 
later, as advertised.

Thanks for reporting this.

Regards,

Matthias.

From goran at krampe.se  Thu Aug 19 14:47:40 2010
From: goran at krampe.se (=?ISO-8859-1?Q?G=F6ran_Krampe?=)
Date: Thu, 19 Aug 2010 15:47:40 +0200
Subject: [rabbitmq-discuss] STOMP and transactions
Message-ID: <4C6D35FC.8090001@krampe.se>

Hi all!

I am implementing a STOMP lib in Squeak:

http://www.squeaksource.com/StompProtocol.html

...and most of it now works (ACKs and RECEIPT etc) but I need more
info on how transactions are meant to work. Can someone give me a
pointer? I am aware that Rabbit has lots of different terms here, but
what is the "out of the box" meaning of BEGIN/COMMIT using the stomp
adapter?

I thought it meant that *nothing* is *delivered* until on COMMIT, but 
that seems a misunderstanding. Is it about making sure hitting disk?

regards, G?ran

From matthias at rabbitmq.com  Fri Aug 20 04:23:54 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Aug 2010 04:23:54 +0100
Subject: [rabbitmq-discuss] Error: invalid command
In-Reply-To: <1281537968.feDCF5317.13533@mail.ua>
References: <4C62AA01.2030702.rabbitmq.com>
	<1281537968.feDCF5317.13533@mail.ua>
Message-ID: <4C6DF54A.4090600@rabbitmq.com>

?????????,

????????? ????? wrote:
> Emile Joubert wrote:
>> Which shell are you using? The reason why read-only commands appear
>> to work is because they have no additional parameters. I've seen 
>> something similar while using tcsh. The problem is that the 
>> parameters are not being split correctly. Do you get the same error
>> when using bash?
> 
> I use bash. I already tried do same with /bin/sh and /bin/tcsh with
> same result.

Did you manage to resolve this?


Regards,

Matthias.

From matthias at rabbitmq.com  Fri Aug 20 05:36:11 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Aug 2010 05:36:11 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ not responding on
 channel request
In-Reply-To: <4C6D1F65.7020004@rabbitmq.com>
References: <AANLkTinLFONtpKROb0T0R8AG=ONo4NAV813Bu8OgckKg@mail.gmail.com>	<20100818164412.GF2810@dakota.eng.vmware.com>	<AANLkTinQ3kuu97pO7EjR6x_fRa3xA4i19NBXiUqLvW9r@mail.gmail.com>	<AANLkTind-ykq3E-rKCE++SuZ6rxoV+CSC2NUQ7OkLMwQ@mail.gmail.com>	<20100818223934.GA17230@wellquite.org>	<AANLkTi=Pua_YKz+kbAgAi_YEy7_HQzxRnytgpNAf=pfX@mail.gmail.com>	<20100819001927.GB17230@wellquite.org>	<AANLkTimSEHrUdUcs1coT8+x2vPA3rRbmfH8A=_K=twF+@mail.gmail.com>	<20100819003348.GC17230@wellquite.org>	<AANLkTi=ABQ9PwvKzBau7t8mDLoFZmFQ5QG6kgiOzk8F2@mail.gmail.com>	<20100819004224.GD17230@wellquite.org>	<AANLkTi=A1mGmsBwNO=+sFM4KH_cNRekAn_VUBPN1+tdv@mail.gmail.com>	<AANLkTin5cxyW1zFn8T1dZcSZ_Y9zAgGbwdu9LPrQFQYD@mail.gmail.com>	<AANLkTimESCWc3EcvdgH6LW--iEauS4DYPDsHHY4zaMws@mail.gmail.com>
	<AANLkTikaZ6sMDUHre50zMi9P99edAEbu93ak_GqccKbD@mail.gmail.com>
	<4C6D1F65.7020004@rabbitmq.com>
Message-ID: <4C6E063B.10006@rabbitmq.com>

Matthias Radestock wrote:
> On 19/08/10 12:53, Cal Leeming [Simplicity Media Ltd] wrote:
>> Looks like you were right Matthew. It would seem V5.6.3 is no
>> longer adequate for RabbitMQ to function properly.
> 
> It turns out re:split was only introduced in Erlang/OTP R12B-5, so 
> rabbit on 'default' currently only works with that version or later. We 
> will fix that before the release so rabbit works again with R12B-3 or 
> later, as advertised.

The fix for this landed on 'default' yesterday afternoon.

http://hg.rabbitmq.com/rabbitmq-server/rev/0c17cedcf9e7


Matthias.

From riteshrathi at gmail.com  Fri Aug 20 11:38:58 2010
From: riteshrathi at gmail.com (rathi)
Date: Fri, 20 Aug 2010 16:08:58 +0530
Subject: [rabbitmq-discuss] Getting an error while starting the consumer
Message-ID: <AANLkTin3qfE83rhC8X3Xb1Yqhon0W7tSjTauVd=or-xp@mail.gmail.com>

I am getting the below error when I try to start the consumer. I have
attached the code which I am using. I am using rabbitmq_server-1.5.0
version.

Exception in thread "main" java.io.IOException
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
        at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:703)
        at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:661)
        at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:647)
        at RabbitMQConsumer.main(RabbitMQConsumer.java:28)
Caused by: com.rabbitmq.client.ShutdownSignalException (connection error;
reason:
{#method<connection.close>(reply-code=541,reply-text=INTERNAL_ERROR,class-id=0,method-id=0),null,""})
        at
com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:606)
        at
com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection.java:561)
        at
com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection.java:541)
        at
com.rabbitmq.client.impl.AMQConnection$1.processAsync(AMQConnection.java:84)
        at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:159)
        at
com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
        at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:446)


In rabbitmq log we get the following message.


=ERROR REPORT==== 20-Aug-2010::15:33:01 ===
connection <0.193.0> (running), channel 1 - error:
{undef,[{ssl_base64,encode,

[<<132,105,185,189,207,122,93,248,157,124,89,168,150,171,
                       226,86>>]},
        {rabbit_misc,string_guid,1},
        {rabbit_misc,binstring_guid,1},
        {rabbit_channel,handle_method,3},
        {rabbit_channel,handle_message,2},
        {buffering_proxy,'-mainloop/4-fun-0-',3},
        {lists,foldl,3},
        {buffering_proxy,mainloop,4}]}

=WARNING REPORT==== 20-Aug-2010::15:33:01 ===
Non-AMQP exit reason '{undef,
                          [{ssl_base64,encode,
                               [<<132,105,185,189,207,122,93,248,157,124,89,
                                  168,150,171,226,86>>]},
                           {rabbit_misc,string_guid,1},
                           {rabbit_misc,binstring_guid,1},
                           {rabbit_channel,handle_method,3},
                           {rabbit_channel,handle_message,2},
                           {buffering_proxy,'-mainloop/4-fun-0-',3},
                           {lists,foldl,3},
                           {buffering_proxy,mainloop,4}]}'


Can someone identify the reason for this. Thanks in advance.

regards,
ritesh rathi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100820/a934b86b/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQConsumer.java
Type: text/x-java
Size: 1578 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100820/a934b86b/attachment.java>

From matthew at rabbitmq.com  Fri Aug 20 11:53:51 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 20 Aug 2010 11:53:51 +0100
Subject: [rabbitmq-discuss] Getting an error while starting the consumer
In-Reply-To: <AANLkTin3qfE83rhC8X3Xb1Yqhon0W7tSjTauVd=or-xp@mail.gmail.com>
References: <AANLkTin3qfE83rhC8X3Xb1Yqhon0W7tSjTauVd=or-xp@mail.gmail.com>
Message-ID: <20100820105351.GG25770@rabbitmq.com>

Hi Ritesh,

On Fri, Aug 20, 2010 at 04:08:58PM +0530, rathi wrote:
> I am getting the below error when I try to start the consumer. I have
> attached the code which I am using. I am using rabbitmq_server-1.5.0
> version.

1.5.0 is positively ancient and we would strongly recommend you upgrade
to the latest 1.8.1.

The ssl_base64 issue may be a bug back in 1.5.0, or it may be related to
the version of Erlang you're running (or both). What version of Erlang
are you running?

Matthew

From riteshrathi at gmail.com  Fri Aug 20 12:03:32 2010
From: riteshrathi at gmail.com (rathi)
Date: Fri, 20 Aug 2010 16:33:32 +0530
Subject: [rabbitmq-discuss] Getting an error while starting the consumer
In-Reply-To: <20100820105351.GG25770@rabbitmq.com>
References: <AANLkTin3qfE83rhC8X3Xb1Yqhon0W7tSjTauVd=or-xp@mail.gmail.com>
	<20100820105351.GG25770@rabbitmq.com>
Message-ID: <AANLkTimrRrPqPdGka4LMSOmU5RX5PTidOginV2qq6_HW@mail.gmail.com>

I will migrate to the latest and then check. Do we need to do anything
specific for ssl while compiling Erlang.

thanks,
ritesh


On Fri, Aug 20, 2010 at 4:23 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Ritesh,
>
> On Fri, Aug 20, 2010 at 04:08:58PM +0530, rathi wrote:
> > I am getting the below error when I try to start the consumer. I have
> > attached the code which I am using. I am using rabbitmq_server-1.5.0
> > version.
>
> 1.5.0 is positively ancient and we would strongly recommend you upgrade
> to the latest 1.8.1.
>
> The ssl_base64 issue may be a bug back in 1.5.0, or it may be related to
> the version of Erlang you're running (or both). What version of Erlang
> are you running?
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100820/2b3c440b/attachment.htm>

From matthew at rabbitmq.com  Fri Aug 20 12:08:56 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 20 Aug 2010 12:08:56 +0100
Subject: [rabbitmq-discuss] Getting an error while starting the consumer
In-Reply-To: <AANLkTimrRrPqPdGka4LMSOmU5RX5PTidOginV2qq6_HW@mail.gmail.com>
References: <AANLkTin3qfE83rhC8X3Xb1Yqhon0W7tSjTauVd=or-xp@mail.gmail.com>
	<20100820105351.GG25770@rabbitmq.com>
	<AANLkTimrRrPqPdGka4LMSOmU5RX5PTidOginV2qq6_HW@mail.gmail.com>
Message-ID: <20100820110856.GI25770@rabbitmq.com>

On Fri, Aug 20, 2010 at 04:33:32PM +0530, rathi wrote:
> I will migrate to the latest and then check. Do we need to do anything
> specific for ssl while compiling Erlang.

Are you meaning just to ensure that the ssl issue that caused the crash
you saw is gone (in which case I think you just need to ensure you have
the openssl dev libraries installed); or do you mean so that you can do
SSL AMQP connections to RabbitMQ? If the latter, be aware that Erlang's
support for SSL is sadly very flakey, and in our experience the best
version of Erlang to use for SSL connections is R13B03.

Matthew

From riteshrathi at gmail.com  Fri Aug 20 12:25:24 2010
From: riteshrathi at gmail.com (rathi)
Date: Fri, 20 Aug 2010 16:55:24 +0530
Subject: [rabbitmq-discuss] Getting an error while starting the consumer
In-Reply-To: <20100820110856.GI25770@rabbitmq.com>
References: <AANLkTin3qfE83rhC8X3Xb1Yqhon0W7tSjTauVd=or-xp@mail.gmail.com>
	<20100820105351.GG25770@rabbitmq.com>
	<AANLkTimrRrPqPdGka4LMSOmU5RX5PTidOginV2qq6_HW@mail.gmail.com>
	<20100820110856.GI25770@rabbitmq.com>
Message-ID: <AANLkTinFjzqxhqT=xGKiM-TRryTYDE-3VMpprw0Cu+-M@mail.gmail.com>

I just wanted to ensure the ssl issue which caused the crash is gone.
Thanks for your support.

regards,
ritesh

On Fri, Aug 20, 2010 at 4:38 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Fri, Aug 20, 2010 at 04:33:32PM +0530, rathi wrote:
> > I will migrate to the latest and then check. Do we need to do anything
> > specific for ssl while compiling Erlang.
>
> Are you meaning just to ensure that the ssl issue that caused the crash
> you saw is gone (in which case I think you just need to ensure you have
> the openssl dev libraries installed); or do you mean so that you can do
> SSL AMQP connections to RabbitMQ? If the latter, be aware that Erlang's
> support for SSL is sadly very flakey, and in our experience the best
> version of Erlang to use for SSL connections is R13B03.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100820/dc883fdd/attachment.htm>

From tonyg at rabbitmq.com  Fri Aug 20 17:55:22 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Fri, 20 Aug 2010 12:55:22 -0400
Subject: [rabbitmq-discuss] STOMP and transactions
In-Reply-To: <4C6D35FC.8090001@krampe.se>
References: <4C6D35FC.8090001@krampe.se>
Message-ID: <4C6EB37A.50108@rabbitmq.com>

Hej G?ran,

I spotted your library over on squeak-dev - very cool. I'm pleased you're
trying it out against RabbitMQ.

Transactions in AMQP (and STOMP, though STOMP's semantics are pretty loose) are
not quite what you'd expect given what they mean in the DB world. They are used
to *group* sets of messages ("SEND"s) together (atomically, more or less) so
that either all or none are published. An additional wrinkle is the treatment
of acknowledgements ("ACK"s) of messages delivered to the transacting client
from the server: acknowledgements can be included in a transaction along with
new publications.

This lets e.g. an RPC server receive a request, process it, and then
transactionally both acknowledge the request and send the reply message. If the
transaction commits, the request is deleted from the server's queue, and the
reply is enqueued for the RPC client; if the transaction aborts, the request
remains enqueued waiting for another (or perhaps the same) RPC server instance
to pick it up and work on it, and the reply message is not sent.

With regard to hitting disk: persistence of messages is orthogonal to their
transactionality in messaging systems like AMQP and STOMP.

I hope this helps. I read squeak-dev, too, so feel free to get in touch in
either place if you have further questions.

Regards,
  Tony


G?ran Krampe wrote:
> Hi all!
> 
> I am implementing a STOMP lib in Squeak:
> 
> http://www.squeaksource.com/StompProtocol.html
> 
> ...and most of it now works (ACKs and RECEIPT etc) but I need more
> info on how transactions are meant to work. Can someone give me a
> pointer? I am aware that Rabbit has lots of different terms here, but
> what is the "out of the box" meaning of BEGIN/COMMIT using the stomp
> adapter?
> 
> I thought it meant that *nothing* is *delivered* until on COMMIT, but
> that seems a misunderstanding. Is it about making sure hitting disk?
> 
> regards, G?ran
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

From gturnquist at vmware.com  Fri Aug 20 18:49:49 2010
From: gturnquist at vmware.com (Greg Turnquist)
Date: Fri, 20 Aug 2010 10:49:49 -0700
Subject: [rabbitmq-discuss] Read blog entry about building RabbitMQ apps in
	Python
Message-ID: <709EC5A9-5EFF-4A37-A068-6773D2DD8052@vmware.com>

Read it and vote it up! http://www.dzone.com/links/building_rabbitmq_apps_using_python.html
--
Greg Turnquist (greg.turnquist at springsource.com)
Senior Software Engineer
SpringSource, A division of VMware
http://springsource.com


From goran at krampe.se  Fri Aug 20 18:56:35 2010
From: goran at krampe.se (=?ISO-8859-1?Q?G=F6ran_Krampe?=)
Date: Fri, 20 Aug 2010 19:56:35 +0200
Subject: [rabbitmq-discuss] STOMP and transactions
In-Reply-To: <4C6EB37A.50108@rabbitmq.com>
References: <4C6D35FC.8090001@krampe.se> <4C6EB37A.50108@rabbitmq.com>
Message-ID: <4C6EC1D3.1080107@krampe.se>

Hej!

On 08/20/2010 06:55 PM, Tony Garnock-Jones wrote:
> Hej G?ran,

Swedish! :)

> I spotted your library over on squeak-dev - very cool. I'm pleased you're
> trying it out against RabbitMQ.

Hehe, yeah, I started with CoilMQ but I realized it doesn't even do 
receipts. I must say that getting Rabbit up and running was NOT trivial. 
You guys need to put out a Howto for that.

But disregarding that, Rabbit seems nice. And yeah, I noticed your AMQP 
lib on SS, and funny enough searching for "STOMP" gives a hit on your 
private repo I think ;)

> Transactions in AMQP (and STOMP, though STOMP's semantics are pretty loose) are
> not quite what you'd expect given what they mean in the DB world. They are used
> to *group* sets of messages ("SEND"s) together (atomically, more or less) so
> that either all or none are published. An additional wrinkle is the treatment
> of acknowledgements ("ACK"s) of messages delivered to the transacting client
> from the server: acknowledgements can be included in a transaction along with
> new publications.
>
> This lets e.g. an RPC server receive a request, process it, and then
> transactionally both acknowledge the request and send the reply message. If the
> transaction commits, the request is deleted from the server's queue, and the
> reply is enqueued for the RPC client; if the transaction aborts, the request
> remains enqueued waiting for another (or perhaps the same) RPC server instance
> to pick it up and work on it, and the reply message is not sent.

Right, this was my guess. But then I tried making a sunit test and... 
well, I start two sessions, let the first set up a subscription to 
'wonderland', then let the second session do BEGIN and send two messages 
to 'wonderland', now, my naive understanding was that session one should 
not receive any message until session2 does COMMIT.

But perhaps what is happening is that the messages are not *removed* 
from the queue until COMMIT? Hmmm. Ok. <scratching head> wonder how to 
rig a unit test for that.

> With regard to hitting disk: persistence of messages is orthogonal to their
> transactionality in messaging systems like AMQP and STOMP.

Right, kinda guessed.

> I hope this helps. I read squeak-dev, too, so feel free to get in touch in
> either place if you have further questions.

Sure!

> Regards,
>    Tony

regards, G?ran

From alexis at rabbitmq.com  Fri Aug 20 18:59:02 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 20 Aug 2010 18:59:02 +0100
Subject: [rabbitmq-discuss] STOMP and transactions
In-Reply-To: <4C6EC1D3.1080107@krampe.se>
References: <4C6D35FC.8090001@krampe.se> <4C6EB37A.50108@rabbitmq.com>
	<4C6EC1D3.1080107@krampe.se>
Message-ID: <AANLkTi=UwVDcScmLt=Qm1UBXzDLqZPMD-=BW9KDr5OC6@mail.gmail.com>

G?ran,

What sorts of problems did you have getting RabbitMQ up and running,
that we could address?

alexis


2010/8/20 G?ran Krampe <goran at krampe.se>:
> Hej!
>
> On 08/20/2010 06:55 PM, Tony Garnock-Jones wrote:
>>
>> Hej G?ran,
>
> Swedish! :)
>
>> I spotted your library over on squeak-dev - very cool. I'm pleased you're
>> trying it out against RabbitMQ.
>
> Hehe, yeah, I started with CoilMQ but I realized it doesn't even do
> receipts. I must say that getting Rabbit up and running was NOT trivial. You
> guys need to put out a Howto for that.
>
> But disregarding that, Rabbit seems nice. And yeah, I noticed your AMQP lib
> on SS, and funny enough searching for "STOMP" gives a hit on your private
> repo I think ;)
>
>> Transactions in AMQP (and STOMP, though STOMP's semantics are pretty
>> loose) are
>> not quite what you'd expect given what they mean in the DB world. They are
>> used
>> to *group* sets of messages ("SEND"s) together (atomically, more or less)
>> so
>> that either all or none are published. An additional wrinkle is the
>> treatment
>> of acknowledgements ("ACK"s) of messages delivered to the transacting
>> client
>> from the server: acknowledgements can be included in a transaction along
>> with
>> new publications.
>>
>> This lets e.g. an RPC server receive a request, process it, and then
>> transactionally both acknowledge the request and send the reply message.
>> If the
>> transaction commits, the request is deleted from the server's queue, and
>> the
>> reply is enqueued for the RPC client; if the transaction aborts, the
>> request
>> remains enqueued waiting for another (or perhaps the same) RPC server
>> instance
>> to pick it up and work on it, and the reply message is not sent.
>
> Right, this was my guess. But then I tried making a sunit test and... well,
> I start two sessions, let the first set up a subscription to 'wonderland',
> then let the second session do BEGIN and send two messages to 'wonderland',
> now, my naive understanding was that session one should not receive any
> message until session2 does COMMIT.
>
> But perhaps what is happening is that the messages are not *removed* from
> the queue until COMMIT? Hmmm. Ok. <scratching head> wonder how to rig a unit
> test for that.
>
>> With regard to hitting disk: persistence of messages is orthogonal to
>> their
>> transactionality in messaging systems like AMQP and STOMP.
>
> Right, kinda guessed.
>
>> I hope this helps. I read squeak-dev, too, so feel free to get in touch in
>> either place if you have further questions.
>
> Sure!
>
>> Regards,
>> ? Tony
>
> regards, G?ran
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From tonyg at rabbitmq.com  Fri Aug 20 19:32:41 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Fri, 20 Aug 2010 14:32:41 -0400
Subject: [rabbitmq-discuss] STOMP and transactions
In-Reply-To: <4C6EC1D3.1080107@krampe.se>
References: <4C6D35FC.8090001@krampe.se> <4C6EB37A.50108@rabbitmq.com>
	<4C6EC1D3.1080107@krampe.se>
Message-ID: <4C6ECA49.2040401@rabbitmq.com>

G?ran Krampe wrote:
> Swedish! :)

visst :) fast det har varit flera ?r sen jag brukade spr?ket p? allvar.

> Hehe, yeah, I started with CoilMQ but I realized it doesn't even do
> receipts. I must say that getting Rabbit up and running was NOT trivial.
> You guys need to put out a Howto for that.

Apologies. I'm guessing that it was rabbitmq-stomp in particular that was
tricky, rather than the core AMQP server? The guys are planning to release
binary (.ez) plugins for STOMP etc with the next release, I think, so that
should ease the pain significantly.

> Right, this was my guess. But then I tried making a sunit test and...
> well, I start two sessions, let the first set up a subscription to
> 'wonderland', then let the second session do BEGIN and send two messages
> to 'wonderland', now, my naive understanding was that session one should
> not receive any message until session2 does COMMIT.

Did you include the "transaction" header on the SEND? You have to tell the
server *which* transaction you want the SEND (or the ACK) to be included within.

Regards,
  Tony

From robert.nicholson at gmail.com  Sat Aug 21 04:30:47 2010
From: robert.nicholson at gmail.com (Robert Nicholson)
Date: Fri, 20 Aug 2010 22:30:47 -0500
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
Message-ID: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>

Seem to be hung up building xmlto which requires get opt that supports long options. The get opt suggested has compile errors in snow leopard.

Sent from my iPad

From david at rabbitmq.com  Sat Aug 21 12:22:21 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 21 Aug 2010 12:22:21 +0100
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com> (Robert
	Nicholson's message of "Fri, 20 Aug 2010 22:30:47 -0500")
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
Message-ID: <yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>

Hi Robert,

Robert Nicholson <robert.nicholson at gmail.com> writes:
> Seem to be hung up building xmlto which requires get opt that supports
> long options. The get opt suggested has compile errors in snow
> leopard.

How are you compiling xmlto?

On OS X, we normally build rabbitmq under macports, which seems to take
care of this.  Perhaps it builds xmlto against an alternative getopt
implementation.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Sat Aug 21 14:54:18 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 21 Aug 2010 14:54:18 +0100
Subject: [rabbitmq-discuss] Concerning cluster failure scenario
In-Reply-To: <AANLkTimD8T1fVgjf5ZAyXPVVeALhJRJB=b58jz7yvSgw@mail.gmail.com>
	(Aaron Westendorf's message of "Tue, 17 Aug 2010 14:24:22 -0400")
References: <AANLkTimD8T1fVgjf5ZAyXPVVeALhJRJB=b58jz7yvSgw@mail.gmail.com>
Message-ID: <yrv4clj803wc5.fsf@dwragg.eng.vmware.com>

Hi Aaron,

Some questions below.

Aaron Westendorf <aaron at agoragames.com> writes:
> We experienced a very odd and disturbing outage yesterday.  I'll do my
> best to explain and can fill in any missing details as needed.
>
> We have a 4 host/node cluster of 1.7.2 rabbits.  One node serves our
> translators that bridge synchronous HTTP traffic to our backend
> services.  Two other nodes handle our services and one is a spare.
> The translators have queues named "$host.$pid" and which are bound to
> the "response" exchange using routing keys of the same name.
>
> One of the application nodes went down, apparently due to an outright
> crash.  Monit caught that rabbit wasn't running and restarted it.  All
> the rabbit hosts and our services saw this as a socket disconnect
> without any closure method.  The only immediate fallout from this was
> a mis-handling in our application stack for socket drops.  Combing
> through the logs yielded nothing; it appears Erlang crashed hard.
>
> The really strange behavior happened at the node which serves our
> translators.  Running `rabbitmqctl list_queues` it was clear that most
> of the queues that should exist did not, including the ones which our
> translators need.

You say that an application node went down, and queues disappeared.  Is
it possible that those queues has been declared on that node?  As out
clustering guide at <http://www.rabbitmq.com/clustering.html> mentions,
queues reside on a single node - the one where they were declared.  So how
did your translator queues get declared?  Is it possible that they were
declared on the node that crashed?  Were the queues declared as durable?

> The logs when the other node went down have many entries similar to
> the following:
>
> =ERROR REPORT==== 16-Aug-2010::18:06:54 ===
> connection <0.20615.10> (running), channel 2 - error:
> {amqp_error,internal_error,
>             "commit failed:
> [{exit,{{nodedown,rabbit at jackalope},{gen_server2,call,[<7282.218.0>,{commit,{{11,<0.20706.10>},98789}},infinity]}}}]",
>             'tx.commit'}

My guess is that these are due to the crash itself.

> Those errors propagated up our application stack where our translators
> re-connected to the broker (fresh socket).  That lead to this error
> which is very common:
>
> =ERROR REPORT==== 16-Aug-2010::18:06:56 ===
> connection <0.22741.65> (running), channel 1 - error:
> {amqp_error,not_found,"no queue 'ogre.28645' in vhost
> '/hydra'",'queue.bind'}

This is what I would expect if the queues in question resided on the
crashed node.

AMQP applications often bind queues immediately after declaring them.
But from your description of this error, it sounds like the binding
happens quite separately from the declaration.  Is that right?

> We have added a delay to some of our applications so that reconnection
> happens after a second or two to avoid this race condition, and will
> make that change here too.  So both logs and rabbitmqctl were in
> agreement that the queues which should have existed for our
> translators did not exist.  I didn't see any errors about the
> queue.basic_consume calls though.

That is indeed surprising.  Do you have the output of 'rabbitmqctl
list_bindings' from this point?

> Our translators have some test endpoints, and one of those is a ping
> which writes directly to the response exchange to effectively test
> that the translator and Rabbit are working together.  The response
> exchange is living on the same node which the translator is connected
> to and consuming from.

Note that exchanges do not live on a particular node, unlike queues.

> When we called this test endpoint, it succeeded!  Though rabbit did
> not report a queue or binding, every single on of our translators was
> receiving responses though they never should have.  When one of our
> services wrote back to the response exchange on other node in the
> cluster, the message was dropped as we would expect.

Again, the output of 'rabbitmqctl list_bindings' would be useful, if you
have it.

One more general question: This is a fairly elaborate clustering set-up.
While we intended that clustering works properly, and I hope we can get
to the bottom of your problem, the non-uniform nature of the current
RabbitMQ clustering can make it quite complicated to administer.  So I
wonder what requirements led you to this design?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From robert.nicholson at gmail.com  Sat Aug 21 15:41:25 2010
From: robert.nicholson at gmail.com (Robert Nicholson)
Date: Sat, 21 Aug 2010 09:41:25 -0500
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
Message-ID: <12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>

What is the preferred way to build/run rabbitmq server? Since I have VM Ware Fusion that's always an option if there's an appliance.

When I try MacPorts all I end up with is what looks like an endless loop of it trying to figure out what the dependencies are.

I will include information for you here now ...

audrey:Downloads robert$ cd xmlto-0.0.23
audrey:xmlto-0.0.23 robert$ ls
AUTHORS		NEWS		configure	xmlif
COPYING		README		configure.in	xmlto.in
ChangeLog	THANKS		depcomp		xmlto.mak
FAQ		aclocal.m4	doc		xmlto.spec
INSTALL		compile		format		xmlto.spec.in
Makefile.am	config.h.in	install-sh	ylwrap
Makefile.in	config.log	missing
audrey:xmlto-0.0.23 robert$ ./configure
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... ./install-sh -c -d
checking for gawk... no
checking for mawk... no
checking for nawk... no
checking for awk... awk
checking whether make sets $(MAKE)... yes
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables... 
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking for style of include used by make... GNU
checking dependency style of gcc... gcc3
checking whether gcc and cc understand -c and -o together... yes
checking for flex... flex
checking lex output file root... lex.yy
checking lex library... -lfl
checking whether yytext is a pointer... yes
checking for mktemp... mktemp
checking for find... find 
checking for bash... /bin/sh
checking for getopt... getopt
checking for long options support in getopt... no
configure: error:
You need getopt from <http://huizen.dds.nl/~frodol/getopt.html>, or
else some other implementation that supports --longoptions.

audrey:xmlto-0.0.23 robert$ 

When building that getopt I see

audrey:getopt-1.1.4 robert$ make
gcc -c -DLIBCGETOPT=0 -DWITH_GETTEXT= -DLOCALEDIR=\"/usr/local/share/locale\" -DNOT_UTIL_LINUX -I./gnu  -Wall -W -Wshadow -Wpointer-arith -Wbad-function-cast -Wcast-qual -Wcast-align -Wmissing-declarations -Wwrite-strings -Wstrict-prototypes -Wmissing-prototypes -Wnested-externs -Winline -O3 -fno-strength-reduce getopt.c -o getopt.o
In file included from getopt.c:51:
./gnu/getopt.h:106: warning: function declaration isn?t a prototype
In file included from getopt.c:54:
nls.h:35:21: error: libintl.h: No such file or directory
getopt.c: In function ?our_malloc?:
getopt.c:91: warning: implicit declaration of function ?gettext?
getopt.c:91: warning: incompatible implicit declaration of built-in function ?gettext?
getopt.c: In function ?our_realloc?:
getopt.c:101: warning: incompatible implicit declaration of built-in function ?gettext?
getopt.c: In function ?parse_error?:
getopt.c:235: warning: incompatible implicit declaration of built-in function ?gettext?
getopt.c: In function ?add_long_options?:
getopt.c:301: warning: incompatible implicit declaration of built-in function ?gettext?
getopt.c: In function ?set_shell?:
getopt.c:321: warning: incompatible implicit declaration of built-in function ?gettext?
getopt.c: In function ?print_help?:
getopt.c:326: warning: incompatible implicit declaration of built-in function ?gettext?
getopt.c: In function ?main?:
getopt.c:378: warning: implicit declaration of function ?setlocale?
getopt.c:378: warning: nested extern declaration of ?setlocale?
getopt.c:378: error: ?LC_ALL? undeclared (first use in this function)
getopt.c:378: error: (Each undeclared identifier is reported only once
getopt.c:378: error: for each function it appears in.)
getopt.c:379: warning: implicit declaration of function ?bindtextdomain?
getopt.c:379: warning: nested extern declaration of ?bindtextdomain?
getopt.c:380: warning: implicit declaration of function ?textdomain?
getopt.c:380: warning: nested extern declaration of ?textdomain?
getopt.c:397: warning: incompatible implicit declaration of built-in function ?gettext?
getopt.c:446: warning: incompatible implicit declaration of built-in function ?gettext?
getopt.c:458: warning: incompatible implicit declaration of built-in function ?gettext?
make: *** [getopt.o] Error 1
audrey:getopt-1.1.4 robert$ 

When I tried MacPorts

I see

DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: freetype
DEBUG: Didn't find receipt, going to depspec regex for: freetype
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: autoconf
DEBUG: Didn't find receipt, going to depspec regex for: autoconf
DEBUG: Searching for dependency: automake
DEBUG: Didn't find receipt, going to depspec regex for: automake
DEBUG: Searching for dependency: libtool
DEBUG: Didn't find receipt, going to depspec regex for: libtool
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: libpng
DEBUG: Didn't find receipt, going to depspec regex for: libpng
DEBUG: Searching for dependency: jpeg
DEBUG: Didn't find receipt, going to depspec regex for: jpeg


over and over and over


On Aug 21, 2010, at 6:22 AM, David Wragg wrote:

> Hi Robert,
> 
> Robert Nicholson <robert.nicholson at gmail.com> writes:
>> Seem to be hung up building xmlto which requires get opt that supports
>> long options. The get opt suggested has compile errors in snow
>> leopard.
> 
> How are you compiling xmlto?
> 
> On OS X, we normally build rabbitmq under macports, which seems to take
> care of this.  Perhaps it builds xmlto against an alternative getopt
> implementation.
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware


From david at rabbitmq.com  Sat Aug 21 17:13:47 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 21 Aug 2010 17:13:47 +0100
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com> (Robert
	Nicholson's message of "Sat, 21 Aug 2010 09:41:25 -0500")
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
Message-ID: <yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>

Hi Robert,

Robert Nicholson <robert.nicholson at gmail.com> writes:
> What is the preferred way to build/run rabbitmq server?

On OS X, installation via macports is what we support and test.  I can't
claim that the macports approach is always as robust as we would like,
but it does seem to work for a lot of people.

Others have reported success installing the generic unix package on OS X
(see <http://www.rabbitmq.com/install.html#generic-unix>).  But to run
that, you need to install erlang, and one way to do that is through
macports (though you could use homebrew, or build it - and all its
dependencies - by hand).  So the macports approach seems the most
straightforward to me.

> Since I have VM Ware Fusion that's always an option if there's an
> appliance.

That's an interesting idea, but we don't currently release such a thing.
But if you happen to have a Linux VM around (debian, ubuntu, or fedora),
installing rabbitmq-server there is really easy due to the package
management systems.

> When I try MacPorts all I end up with is what looks like an endless
> loop of it trying to figure out what the dependencies are.

See below.

> I will include information for you here now ...
> [...]

I've checked the xmlto macports portfile (at
<http://trac.macports.org/browser/trunk/dports/textproc/xmlto/Portfile>),
and I see that it does list getopt as a dependency, as well as 11 other
dependencies.  So installing it by hand could be quite a tiresome
exercise.

> When I tried MacPorts
>
> I see
>
> DEBUG: Didn't find receipt, going to depspec regex for: libiconv
> DEBUG: Searching for dependency: expat
> [...]

This seems like a macports issue unconnected with the rabbitmq-server
port.  I see that it was reported to macports at
<https://trac.macports.org/ticket/25923>, and the underlying cuase is
described in <https://trac.macports.org/ticket/25912>.  But apparently
it was fixed 3 weeks ago.  So try the following three commands to bring
everything up to date:

  $ sudo port selfupdate
  $ sudo port sync
  $ sudo port upgrade outdated

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From robert.nicholson at gmail.com  Sat Aug 21 18:33:51 2010
From: robert.nicholson at gmail.com (Robert Nicholson)
Date: Sat, 21 Aug 2010 12:33:51 -0500
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
	<yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
Message-ID: <15C0CD30-DBBE-454A-A118-7E69854FB3AF@gmail.com>

After doing what you suggested I still see there is an infinite loop when doing the dependencies.

On Aug 21, 2010, at 11:13 AM, David Wragg wrote:

> 
>> When I tried MacPorts
>> 
>> I see
>> 
>> DEBUG: Didn't find receipt, going to depspec regex for: libiconv
>> DEBUG: Searching for dependency: expat
>> [...]
> 
> This seems like a macports issue unconnected with the rabbitmq-server
> port.  I see that it was reported to macports at
> <https://trac.macports.org/ticket/25923>, and the underlying cuase is
> described in <https://trac.macports.org/ticket/25912>.  But apparently
> it was fixed 3 weeks ago.  So try the following three commands to bring
> everything up to date:
> 
>  $ sudo port selfupdate
>  $ sudo port sync
>  $ sudo port upgrade outdated
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware


From david at rabbitmq.com  Sat Aug 21 18:54:22 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 21 Aug 2010 18:54:22 +0100
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <15C0CD30-DBBE-454A-A118-7E69854FB3AF@gmail.com> (Robert
	Nicholson's message of "Sat, 21 Aug 2010 12:33:51 -0500")
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
	<yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
	<15C0CD30-DBBE-454A-A118-7E69854FB3AF@gmail.com>
Message-ID: <yrv4caaof4zsh.fsf@dwragg.eng.vmware.com>

Robert Nicholson <robert.nicholson at gmail.com> writes:
> After doing what you suggested I still see there is an infinite loop
> when doing the dependencies.

Sorry to hear that.

Could you post the following:

- The output of doing

    port info xorg-libXi

- The whole dependencies DEBUG output (you might want to upload it
  somewhere, e.g. <htp://gist.github.com/>, and send a link).

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From dilip1984me at gmail.com  Sat Aug 21 20:20:56 2010
From: dilip1984me at gmail.com (dilip raghavan)
Date: Sat, 21 Aug 2010 15:20:56 -0400
Subject: [rabbitmq-discuss] erl_crash_dump Help !!!
Message-ID: <AANLkTin6KnVerTFJ9orPahqods0YyCrUaQzg-_Wr0zAT@mail.gmail.com>

Dear Sir/Madam,
             I am new to rabbitmq and I tried downloading and installing it.
During installation of rabbitmq-server.bat it crashed. I am attaching the
file along with this mail. Please help me. Thanks in advance.

Regards
Dilip
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100821/bed1106c/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 253565 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100821/bed1106c/attachment-0001.obj>

From matthias at rabbitmq.com  Sun Aug 22 00:20:15 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 22 Aug 2010 00:20:15 +0100
Subject: [rabbitmq-discuss] erl_crash_dump Help !!!
In-Reply-To: <AANLkTin6KnVerTFJ9orPahqods0YyCrUaQzg-_Wr0zAT@mail.gmail.com>
References: <AANLkTin6KnVerTFJ9orPahqods0YyCrUaQzg-_Wr0zAT@mail.gmail.com>
Message-ID: <4C705F2F.3070407@rabbitmq.com>

Dilip,

dilip raghavan wrote:
>              I am new to rabbitmq and I tried downloading and installing 
> it. During installation of rabbitmq-server.bat it crashed.

When you run rabbitmq-server.bat from the prompt in a command window, do 
you get any output?


Regards,

Matthias

From tonyg at rabbitmq.com  Sun Aug 22 01:19:20 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sat, 21 Aug 2010 20:19:20 -0400
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
	<yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
Message-ID: <4C706D08.9080607@rabbitmq.com>

David Wragg wrote:
> I've checked the xmlto macports portfile (at
> <http://trac.macports.org/browser/trunk/dports/textproc/xmlto/Portfile>),
> and I see that it does list getopt as a dependency, as well as 11 other
> dependencies.  So installing it by hand could be quite a tiresome
> exercise.

It really is. I have not yet managed to get a working OS X xmlto, and so have
been unable to build the documentation on OS X for some months now. (My
workaround is to have an ubuntu VM handy ;-) )

Tony


From robert.nicholson at gmail.com  Sun Aug 22 01:32:18 2010
From: robert.nicholson at gmail.com (Robert Nicholson)
Date: Sat, 21 Aug 2010 19:32:18 -0500
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <yrv4caaof4zsh.fsf@dwragg.eng.vmware.com>
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
	<yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
	<15C0CD30-DBBE-454A-A118-7E69854FB3AF@gmail.com>
	<yrv4caaof4zsh.fsf@dwragg.eng.vmware.com>
Message-ID: <714E16A4-3CC3-4578-BFDC-A52DA07C6191@gmail.com>

I'm guessing you were looking for more than this?

audrey:~ robert$ sudo port -d info xorg-libXi
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXi
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
xorg-libXi @1.3.2 (x11, devel)
Variants:             universal

Description:          X11 Input Extension
Homepage:             http://www.x.org

Build Dependencies:   port:pkgconfig
Library Dependencies: port:xorg-libXext, port:xorg-inputproto
Platforms:            darwin, macosx
License:              unknown
Maintainers:          jeremyhu at macports.org, openmaintainer at macports.org
audrey:~ robert$ 


On Aug 21, 2010, at 12:54 PM, David Wragg wrote:

> Robert Nicholson <robert.nicholson at gmail.com> writes:
>> After doing what you suggested I still see there is an infinite loop
>> when doing the dependencies.
> 
> Sorry to hear that.
> 
> Could you post the following:
> 
> - The output of doing
> 
>    port info xorg-libXi
> 
> - The whole dependencies DEBUG output (you might want to upload it
>  somewhere, e.g. <htp://gist.github.com/>, and send a link).
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware


From david at rabbitmq.com  Sun Aug 22 08:41:13 2010
From: david at rabbitmq.com (David Wragg)
Date: Sun, 22 Aug 2010 08:41:13 +0100
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <714E16A4-3CC3-4578-BFDC-A52DA07C6191@gmail.com> (Robert
	Nicholson's message of "Sat, 21 Aug 2010 19:32:18 -0500")
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
	<yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
	<15C0CD30-DBBE-454A-A118-7E69854FB3AF@gmail.com>
	<yrv4caaof4zsh.fsf@dwragg.eng.vmware.com>
	<714E16A4-3CC3-4578-BFDC-A52DA07C6191@gmail.com>
Message-ID: <yrv4csk27ccx2.fsf@dwragg.eng.vmware.com>

Robert Nicholson <robert.nicholson at gmail.com> writes:
> I'm guessing you were looking for more than this?
>
> audrey:~ robert$ sudo port -d info xorg-libXi

Oops, I meant the debug output from doing the "port install
rabbitmq-server".  Sorry.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Sun Aug 22 08:46:15 2010
From: david at rabbitmq.com (David Wragg)
Date: Sun, 22 Aug 2010 08:46:15 +0100
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <4C706D08.9080607@rabbitmq.com> (Tony Garnock-Jones's message of
	"Sat, 21 Aug 2010 20:19:20 -0400")
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
	<yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
	<4C706D08.9080607@rabbitmq.com>
Message-ID: <yrv4coccvccoo.fsf@dwragg.eng.vmware.com>

Tony Garnock-Jones <tonyg at rabbitmq.com> writes:
> David Wragg wrote:
>> I've checked the xmlto macports portfile (at
>> <http://trac.macports.org/browser/trunk/dports/textproc/xmlto/Portfile>),
>> and I see that it does list getopt as a dependency, as well as 11 other
>> dependencies.  So installing it by hand could be quite a tiresome
>> exercise.
>
> It really is. I have not yet managed to get a working OS X xmlto, and so have
> been unable to build the documentation on OS X for some months now. (My
> workaround is to have an ubuntu VM handy ;-) )

My point was that its better to rely on macports.  And xmlto is in
homebrew if you don't like macports.  So what's the problem?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From robert.nicholson at gmail.com  Sun Aug 22 19:09:27 2010
From: robert.nicholson at gmail.com (Robert Nicholson)
Date: Sun, 22 Aug 2010 13:09:27 -0500
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <yrv4csk27ccx2.fsf@dwragg.eng.vmware.com>
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
	<yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
	<15C0CD30-DBBE-454A-A118-7E69854FB3AF@gmail.com>
	<yrv4caaof4zsh.fsf@dwragg.eng.vmware.com>
	<714E16A4-3CC3-4578-BFDC-A52DA07C6191@gmail.com>
	<yrv4csk27ccx2.fsf@dwragg.eng.vmware.com>
Message-ID: <BA7499FC-4785-4267-B1FF-AC2D5EE64F1E@gmail.com>

As you might guess that is never ending but here's a quick look

Last login: Sun Aug 22 11:22:16 on ttys001
audrey:~ robert$ sudo port -d install rabbitmq-server
Password:
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/net/rabbitmq-server
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Starting logging for rabbitmq-server
--->  Computing dependencies for rabbitmq-server
DEBUG: Searching for dependency: xmlto
DEBUG: Didn't find receipt, going to depspec regex for: xmlto
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/xmlto
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: libxslt
DEBUG: Didn't find receipt, going to depspec regex for: libxslt
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libxslt
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: erlang
DEBUG: Didn't find receipt, going to depspec regex for: erlang
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/lang/erlang
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Searching for dependency: coreutils
DEBUG: Didn't find receipt, going to depspec regex for: coreutils
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/sysutils/coreutils
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: findutils
DEBUG: Didn't find receipt, going to depspec regex for: findutils
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/sysutils/findutils
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: getopt
DEBUG: Didn't find receipt, going to depspec regex for: getopt
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/sysutils/getopt
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: libpaper
DEBUG: Didn't find receipt, going to depspec regex for: libpaper
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/print/libpaper
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: texlive
DEBUG: Didn't find receipt, going to depspec regex for: texlive
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant medium provides medium
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-htmlxml
DEBUG: Didn't find receipt, going to depspec regex for: texlive-htmlxml
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-htmlxml
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: libxml2
DEBUG: Didn't find receipt, going to depspec regex for: libxml2
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libxml2
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: libxslt
DEBUG: Didn't find receipt, going to depspec regex for: libxslt
DEBUG: Searching for dependency: docbook-xml
DEBUG: Didn't find receipt, going to depspec regex for: docbook-xml
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/docbook-xml
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Searching for dependency: docbook-xsl
DEBUG: Didn't find receipt, going to depspec regex for: docbook-xsl
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/docbook-xsl
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Searching for dependency: fop
DEBUG: Didn't find receipt, going to depspec regex for: fop
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/fop
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Searching for dependency: dblatex
DEBUG: Didn't find receipt, going to depspec regex for: dblatex
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/dblatex
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/python26-1.0.tcl
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/gettext
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: gmp
DEBUG: Didn't find receipt, going to depspec regex for: gmp
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/gmp
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libiconv
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/ncurses
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/expat
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/gperf
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/ncursesw
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: texlive-basic
DEBUG: Didn't find receipt, going to depspec regex for: texlive-basic
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-basic
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-bin-extra
DEBUG: Didn't find receipt, going to depspec regex for: texlive-bin-extra
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-bin-extra
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-context
DEBUG: Didn't find receipt, going to depspec regex for: texlive-context
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-context
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-documentation-english
DEBUG: Didn't find receipt, going to depspec regex for: texlive-documentation-english
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-documentation-english
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-fontutils
DEBUG: Didn't find receipt, going to depspec regex for: texlive-fontutils
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-fontutils
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-fonts-recommended
DEBUG: Didn't find receipt, going to depspec regex for: texlive-fonts-recommended
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-fonts-recommended
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-czechslovak
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-czechslovak
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-czechslovak
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-dutch
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-dutch
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-dutch
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-french
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-french
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-french
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-german
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-german
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-german
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-italian
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-italian
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-italian
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-polish
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-polish
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-polish
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-portuguese
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-portuguese
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-portuguese
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-spanish
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-spanish
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-spanish
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-lang-ukenglish
DEBUG: Didn't find receipt, going to depspec regex for: texlive-lang-ukenglish
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-lang-ukenglish
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-latex
DEBUG: Didn't find receipt, going to depspec regex for: texlive-latex
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-latex
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-latex-recommended
DEBUG: Didn't find receipt, going to depspec regex for: texlive-latex-recommended
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-latex-recommended
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-math-extra
DEBUG: Didn't find receipt, going to depspec regex for: texlive-math-extra
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-math-extra
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-metapost
DEBUG: Didn't find receipt, going to depspec regex for: texlive-metapost
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-metapost
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-xetex
DEBUG: Didn't find receipt, going to depspec regex for: texlive-xetex
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-xetex
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-luatex
DEBUG: Didn't find receipt, going to depspec regex for: texlive-luatex
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-luatex
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-generic-recommended
DEBUG: Didn't find receipt, going to depspec regex for: texlive-generic-recommended
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-generic-recommended
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-documentation-base
DEBUG: Didn't find receipt, going to depspec regex for: texlive-documentation-base
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-documentation-base
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant doc provides doc
DEBUG: Searching for dependency: texlive-common
DEBUG: Didn't find receipt, going to depspec regex for: texlive-common
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-common
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Searching for dependency: texlive-bin
DEBUG: Didn't find receipt, going to depspec regex for: texlive-bin
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/tex/texlive-bin
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/texlive-1.0.tcl
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Executing variant motif provides motif
DEBUG: Searching for dependency: texlive-common
DEBUG: Didn't find receipt, going to depspec regex for: texlive-common
DEBUG: Searching for dependency: texlive-bin
DEBUG: Didn't find receipt, going to depspec regex for: texlive-bin
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/lang/perl5
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/pkgconfig
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: fontconfig
DEBUG: Didn't find receipt, going to depspec regex for: fontconfig
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/fontconfig
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: freetype
DEBUG: Didn't find receipt, going to depspec regex for: freetype
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/print/freetype
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: gd2
DEBUG: Didn't find receipt, going to depspec regex for: gd2
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/gd2
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: libpng
DEBUG: Didn't find receipt, going to depspec regex for: libpng
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/libpng
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/archivers/zlib
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/xcodeversion-1.0.tcl
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: t1lib
DEBUG: Didn't find receipt, going to depspec regex for: t1lib
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/t1lib
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: poppler
DEBUG: Didn't find receipt, going to depspec regex for: poppler
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/poppler
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: xorg-libXp
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXp
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXp
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: texlive-common
DEBUG: Didn't find receipt, going to depspec regex for: texlive-common
DEBUG: Searching for dependency: openmotif
DEBUG: Didn't find receipt, going to depspec regex for: openmotif
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/openmotif
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: ghostscript
DEBUG: Didn't find receipt, going to depspec regex for: ghostscript
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/print/ghostscript
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/lang/perl5.8
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: freetype
DEBUG: Didn't find receipt, going to depspec regex for: freetype
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: autoconf
DEBUG: Didn't find receipt, going to depspec regex for: autoconf
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/autoconf
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: automake
DEBUG: Didn't find receipt, going to depspec regex for: automake
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/automake
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: libtool
DEBUG: Didn't find receipt, going to depspec regex for: libtool
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/libtool
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: libpng
DEBUG: Didn't find receipt, going to depspec regex for: libpng
DEBUG: Searching for dependency: jpeg
DEBUG: Didn't find receipt, going to depspec regex for: jpeg
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/jpeg
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: freetype
DEBUG: Didn't find receipt, going to depspec regex for: freetype
DEBUG: Searching for dependency: fontconfig
DEBUG: Didn't find receipt, going to depspec regex for: fontconfig
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: xpm
DEBUG: Didn't find receipt, going to depspec regex for: xpm
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xpm
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: m4
DEBUG: Didn't find receipt, going to depspec regex for: m4
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/m4
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: help2man
DEBUG: Didn't find receipt, going to depspec regex for: help2man
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/help2man
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: p5-locale-gettext
DEBUG: Didn't find receipt, going to depspec regex for: p5-locale-gettext
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/perl/p5-locale-gettext
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/perl5-1.0.tcl
DEBUG: Re-registering default for configure.universal_args
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: autoconf
DEBUG: Didn't find receipt, going to depspec regex for: autoconf
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: m4
DEBUG: Didn't find receipt, going to depspec regex for: m4
DEBUG: Searching for dependency: help2man
DEBUG: Didn't find receipt, going to depspec regex for: help2man
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: p5-locale-gettext
DEBUG: Didn't find receipt, going to depspec regex for: p5-locale-gettext
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: automake
DEBUG: Didn't find receipt, going to depspec regex for: automake
DEBUG: Searching for dependency: autoconf
DEBUG: Didn't find receipt, going to depspec regex for: autoconf
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: m4
DEBUG: Didn't find receipt, going to depspec regex for: m4
DEBUG: Searching for dependency: help2man
DEBUG: Didn't find receipt, going to depspec regex for: help2man
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: p5-locale-gettext
DEBUG: Didn't find receipt, going to depspec regex for: p5-locale-gettext
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: freetype
DEBUG: Didn't find receipt, going to depspec regex for: freetype
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-xproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xproto
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-xproto
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: xorg-libXt
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXt
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXt
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libXext
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXext
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXext
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-util-macros
DEBUG: Didn't find receipt, going to depspec regex for: xorg-util-macros
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-util-macros
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: xorg-libsm
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libsm
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libsm
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libX11
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libX11
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libX11
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-xtrans
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xtrans
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-xtrans
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: xorg-libice
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libice
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libice
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-xtrans
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xtrans
DEBUG: Searching for dependency: xorg-xproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xproto
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-util-macros
DEBUG: Didn't find receipt, going to depspec regex for: xorg-util-macros
DEBUG: Searching for dependency: xorg-xtrans
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xtrans
DEBUG: Searching for dependency: xorg-bigreqsproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-bigreqsproto
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-bigreqsproto
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: xorg-xcmiscproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xcmiscproto
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-xcmiscproto
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: xorg-xextproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xextproto
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-xextproto
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: xorg-xf86bigfontproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xf86bigfontproto
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-xf86bigfontproto
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: xorg-inputproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-inputproto
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-inputproto
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: xorg-libXdmcp
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXdmcp
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXdmcp
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libXau
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXau
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXau
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-xproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xproto
DEBUG: Searching for dependency: xorg-kbproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-kbproto
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-kbproto
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-xproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xproto
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-xproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xproto
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-libX11
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libX11
DEBUG: Searching for dependency: xorg-xextproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xextproto
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-util-macros
DEBUG: Didn't find receipt, going to depspec regex for: xorg-util-macros
DEBUG: Searching for dependency: xorg-xtrans
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xtrans
DEBUG: Searching for dependency: xorg-bigreqsproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-bigreqsproto
DEBUG: Searching for dependency: xorg-xcmiscproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xcmiscproto
DEBUG: Searching for dependency: xorg-xextproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xextproto
DEBUG: Searching for dependency: xorg-xf86bigfontproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xf86bigfontproto
DEBUG: Searching for dependency: xorg-inputproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-inputproto
DEBUG: Searching for dependency: xorg-libXdmcp
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXdmcp
DEBUG: Searching for dependency: xorg-libXau
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXau
DEBUG: Searching for dependency: xorg-xproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xproto
DEBUG: Searching for dependency: xorg-kbproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-kbproto
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-xproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xproto
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: xorg-xproto
DEBUG: Didn't find receipt, going to depspec regex for: xorg-xproto
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: libtool
DEBUG: Didn't find receipt, going to depspec regex for: libtool
DEBUG: Searching for dependency: automake
DEBUG: Didn't find receipt, going to depspec regex for: automake
DEBUG: Searching for dependency: autoconf
DEBUG: Didn't find receipt, going to depspec regex for: autoconf
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: m4
DEBUG: Didn't find receipt, going to depspec regex for: m4
DEBUG: Searching for dependency: help2man
DEBUG: Didn't find receipt, going to depspec regex for: help2man
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: p5-locale-gettext
DEBUG: Didn't find receipt, going to depspec regex for: p5-locale-gettext
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: curl
DEBUG: Didn't find receipt, going to depspec regex for: curl
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/net/curl
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Executing variant ssl provides ssl
DEBUG: Searching for dependency: gtk2
DEBUG: Didn't find receipt, going to depspec regex for: gtk2
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/gtk2
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/xcodeversion-1.0.tcl
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Executing variant x11 provides x11
DEBUG: Searching for dependency: lcms
DEBUG: Didn't find receipt, going to depspec regex for: lcms
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/lcms
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: openjpeg
DEBUG: Didn't find receipt, going to depspec regex for: openjpeg
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/openjpeg
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: poppler-data
DEBUG: Didn't find receipt, going to depspec regex for: poppler-data
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/poppler-data
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: libidn
DEBUG: Didn't find receipt, going to depspec regex for: libidn
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/mail/libidn
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: openssl
DEBUG: Didn't find receipt, going to depspec regex for: openssl
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/openssl
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: curl-ca-bundle
DEBUG: Didn't find receipt, going to depspec regex for: curl-ca-bundle
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/net/curl-ca-bundle
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: universal_variant is false, so not adding the default universal variant
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: tiff
DEBUG: Didn't find receipt, going to depspec regex for: tiff
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/tiff
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/xcodeversion-1.0.tcl
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: jasper
DEBUG: Didn't find receipt, going to depspec regex for: jasper
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics/jasper
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: atk
DEBUG: Didn't find receipt, going to depspec regex for: atk
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/atk
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: pango
DEBUG: Didn't find receipt, going to depspec regex for: pango
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/pango
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: xorg-libXi
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXi
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXi
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libXrandr
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXrandr
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXrandr
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libXcursor
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXcursor
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXcursor
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libXinerama
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXinerama
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXinerama
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libXdamage
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXdamage
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXdamage
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libXcomposite
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXcomposite
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXcomposite
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: xorg-libXfixes
DEBUG: Didn't find receipt, going to depspec regex for: xorg-libXfixes
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/xorg-libXfixes
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: shared-mime-info
DEBUG: Didn't find receipt, going to depspec regex for: shared-mime-info
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/shared-mime-info
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: jpeg
DEBUG: Didn't find receipt, going to depspec regex for: jpeg
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: unzip
DEBUG: Didn't find receipt, going to depspec regex for: unzip
DEBUG: Found Dependency: path: /usr/bin filename: unzip regex: ^unzip$
DEBUG: Found Dependency: path: /usr/bin filename: unzip regex: ^unzip$
DEBUG: Searching for dependency: jpeg
DEBUG: Didn't find receipt, going to depspec regex for: jpeg
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: gtk-doc
DEBUG: Didn't find receipt, going to depspec regex for: gtk-doc
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/gnome/gtk-doc
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: glib2
DEBUG: Didn't find receipt, going to depspec regex for: glib2
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/glib2
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: gnome-doc-utils
DEBUG: Didn't find receipt, going to depspec regex for: gnome-doc-utils
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/gnome/gnome-doc-utils
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: docbook-xml
DEBUG: Didn't find receipt, going to depspec regex for: docbook-xml
DEBUG: Searching for dependency: docbook-xsl
DEBUG: Didn't find receipt, going to depspec regex for: docbook-xsl
DEBUG: Searching for dependency: rarian
DEBUG: Didn't find receipt, going to depspec regex for: rarian
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/rarian
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: libxml2
DEBUG: Didn't find receipt, going to depspec regex for: libxml2
DEBUG: Searching for dependency: glib2
DEBUG: Didn't find receipt, going to depspec regex for: glib2
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: intltool
DEBUG: Didn't find receipt, going to depspec regex for: intltool
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/intltool
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: p5-xml-parser
DEBUG: Didn't find receipt, going to depspec regex for: p5-xml-parser
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/perl/p5-xml-parser
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/perl5-1.0.tcl
DEBUG: Re-registering default for configure.universal_args
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: libxslt
DEBUG: Didn't find receipt, going to depspec regex for: libxslt
DEBUG: Searching for dependency: python26
DEBUG: Didn't find receipt, going to depspec regex for: python26
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/lang/python26
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/select-1.0.tcl
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Searching for dependency: docbook-xml
DEBUG: Didn't find receipt, going to depspec regex for: docbook-xml
DEBUG: Searching for dependency: docbook-xsl
DEBUG: Didn't find receipt, going to depspec regex for: docbook-xsl
DEBUG: Searching for dependency: rarian
DEBUG: Didn't find receipt, going to depspec regex for: rarian
DEBUG: Searching for dependency: iso-codes
DEBUG: Didn't find receipt, going to depspec regex for: iso-codes
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/iso-codes
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: py26-libxml2
DEBUG: Didn't find receipt, going to depspec regex for: py26-libxml2
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/python/py26-libxml2
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/python26-1.0.tcl
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: gnome-common
DEBUG: Didn't find receipt, going to depspec regex for: gnome-common
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/gnome/gnome-common
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: p5-xml-parser
DEBUG: Didn't find receipt, going to depspec regex for: p5-xml-parser
DEBUG: Searching for dependency: p5-getopt-long
DEBUG: Didn't find receipt, going to depspec regex for: p5-getopt-long
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/perl/p5-getopt-long
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/perl5-1.0.tcl
DEBUG: Re-registering default for configure.universal_args
DEBUG: only one arch supported, so not adding the default universal variant
DEBUG: Searching for dependency: p5-pathtools
DEBUG: Didn't find receipt, going to depspec regex for: p5-pathtools
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/perl/p5-pathtools
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/perl5-1.0.tcl
DEBUG: Re-registering default for configure.universal_args
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: p5-scalar-list-utils
DEBUG: Didn't find receipt, going to depspec regex for: p5-scalar-list-utils
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/perl/p5-scalar-list-utils
DEBUG: OS darwin/10.4.0 (Mac OS X 10.6) arch i386
DEBUG: org.macports.load registered provides 'load', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a pre-existing procedure. Target override will not be provided
DEBUG: Using group file /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/perl5-1.0.tcl
DEBUG: Re-registering default for configure.universal_args
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from /opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Searching for dependency: pkgconfig
DEBUG: Didn't find receipt, going to depspec regex for: pkgconfig
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: perl5
DEBUG: Didn't find receipt, going to depspec regex for: perl5
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: perl5.8
DEBUG: Didn't find receipt, going to depspec regex for: perl5.8
DEBUG: Checking for conflicts against perl5.8
DEBUG: Searching for dependency: perl5.10
DEBUG: Didn't find receipt, going to depspec regex for: perl5.10
DEBUG: Searching for dependency: perl5.12
DEBUG: Didn't find receipt, going to depspec regex for: perl5.12
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: ncurses
DEBUG: Didn't find receipt, going to depspec regex for: ncurses
DEBUG: Searching for dependency: expat
DEBUG: Didn't find receipt, going to depspec regex for: expat
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: ncursesw
DEBUG: Didn't find receipt, going to depspec regex for: ncursesw
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: libxml2
DEBUG: Didn't find receipt, going to depspec regex for: libxml2
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: libiconv
DEBUG: Didn't find receipt, going to depspec regex for: libiconv
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: gperf
DEBUG: Didn't find receipt, going to depspec regex for: gperf
DEBUG: Searching for dependency: gettext
DEBUG: Didn't find receipt, going to depspec regex for: gettext
DEBUG: Searching for dependency: zlib
DEBUG: Didn't find receipt, going to depspec regex for: zlib
DEBUG: Searching for dependency: openssl
DEBUG: Didn't find receipt, going to depspec regex for: openssl
DEBUG: Searching for dependency: tk
DEBUG: Didn't find receipt, going to depspec regex for: tk
DEBUG: Changing to port directory: /opt/local/var/macports/sources/rsync.macports.org/release/ports/x11/tk
^C
audrey:~ robert$ 


On Aug 22, 2010, at 2:41 AM, David Wragg wrote:

> Robert Nicholson <robert.nicholson at gmail.com> writes:
>> I'm guessing you were looking for more than this?
>> 
>> audrey:~ robert$ sudo port -d info xorg-libXi
> 
> Oops, I meant the debug output from doing the "port install
> rabbitmq-server".  Sorry.
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware


From david at rabbitmq.com  Sun Aug 22 19:48:05 2010
From: david at rabbitmq.com (David Wragg)
Date: Sun, 22 Aug 2010 19:48:05 +0100
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <BA7499FC-4785-4267-B1FF-AC2D5EE64F1E@gmail.com> (Robert
	Nicholson's message of "Sun, 22 Aug 2010 13:09:27 -0500")
References: <CB1B0722-BBF6-4ABD-B629-E8161B0FB2D1@gmail.com>
	<yrv4cpqxc43de.fsf@dwragg.eng.vmware.com>
	<12C74344-08D3-4CA9-B77F-FDEF9C808289@gmail.com>
	<yrv4chbio3pvo.fsf@dwragg.eng.vmware.com>
	<15C0CD30-DBBE-454A-A118-7E69854FB3AF@gmail.com>
	<yrv4caaof4zsh.fsf@dwragg.eng.vmware.com>
	<714E16A4-3CC3-4578-BFDC-A52DA07C6191@gmail.com>
	<yrv4csk27ccx2.fsf@dwragg.eng.vmware.com>
	<BA7499FC-4785-4267-B1FF-AC2D5EE64F1E@gmail.com>
Message-ID: <yrv4csk26cwm2.fsf@dwragg.eng.vmware.com>

Robert Nicholson <robert.nicholson at gmail.com> writes:
> As you might guess that is never ending but here's a quick look

Thanks.

How long did all that take, and what happens if you just leave it?

This is a fresh macports install, right?  It's a couple of months since
I've done a fresh install, but I think it's normal that macports takes a
while to figure out all the things it has to build.  And building them
all takes several hours on a fairly recent mac mini.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From tonyg at rabbitmq.com  Sun Aug 22 22:13:41 2010
From: tonyg at rabbitmq.com (=?utf-8?B?VG9ueSBHYXJub2NrLUpvbmVz?=)
Date: Sun, 22 Aug 2010 22:13:41 +0100 (BST)
Subject: [rabbitmq-discuss]
	=?utf-8?q?Building_rabbitmq_on_snow_leopard=3F?=
Message-ID: <20100822211341.8AAD6151635@smtp.rabbitmq.com>

At the time, xmlto wouldn't build from homebrew. I spent a few hours messing with it before giving up; perhaps it's time for another go.

Sent from my HTC

----- Reply message -----
From: "David Wragg" <david at rabbitmq.com>
Date: Sun, Aug 22, 2010 03:46
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
To: "Tony Garnock-Jones" <tonyg at rabbitmq.com>
Cc: "rabbitmq-discuss\@lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>


Tony Garnock-Jones <tonyg at rabbitmq.com> writes:
> David Wragg wrote:
>> I've checked the xmlto macports portfile (at
>> <http://trac.macports.org/browser/trunk/dports/textproc/xmlto/Portfile>),
>> and I see that it does list getopt as a dependency, as well as 11 other
>> dependencies.  So installing it by hand could be quite a tiresome
>> exercise.
>
> It really is. I have not yet managed to get a working OS X xmlto, and so have
> been unable to build the documentation on OS X for some months now. (My
> workaround is to have an ubuntu VM handy ;-) )

My point was that its better to rely on macports.  And xmlto is in
homebrew if you don't like macports.  So what's the problem?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100822/aaa7ffbb/attachment.htm>

From tonyg at rabbitmq.com  Sun Aug 22 22:18:47 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sun, 22 Aug 2010 17:18:47 -0400
Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
In-Reply-To: <20100822211341.8AAD6151635@smtp.rabbitmq.com>
References: <20100822211341.8AAD6151635@smtp.rabbitmq.com>
Message-ID: <4C719437.9090508@rabbitmq.com>

Yay! Thanks for the impetus to try again, David; I've just `brew install
xmlto`ed, and it built cleanly and installed OK. And now rabbitmq-server's
`make docs_all` works perfectly.

Regards,
  Tony

Tony Garnock-Jones wrote:
> At the time, xmlto wouldn't build from homebrew. I spent a few hours
> messing with it before giving up; perhaps it's time for another go.
> 
> Sent from my HTC
> 
> ----- Reply message -----
> From: "David Wragg" <david at rabbitmq.com>
> Date: Sun, Aug 22, 2010 03:46
> Subject: [rabbitmq-discuss] Building rabbitmq on snow leopard?
> To: "Tony Garnock-Jones" <tonyg at rabbitmq.com>
> Cc: "rabbitmq-discuss\@lists.rabbitmq.com"
> <rabbitmq-discuss at lists.rabbitmq.com>
> 
> 
> Tony Garnock-Jones <tonyg at rabbitmq.com> writes:
>> David Wragg wrote:
>>> I've checked the xmlto macports portfile (at
>>> <http://trac.macports.org/browser/trunk/dports/textproc/xmlto/Portfile>),
>>> and I see that it does list getopt as a dependency, as well as 11 other
>>> dependencies. So installing it by hand could be quite a tiresome
>>> exercise.
>>
>> It really is. I have not yet managed to get a working OS X xmlto, and
> so have
>> been unable to build the documentation on OS X for some months now. (My
>> workaround is to have an ubuntu VM handy ;-) )
> 
> My point was that its better to rely on macports. And xmlto is in
> homebrew if you don't like macports. So what's the problem?
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From aaron at agoragames.com  Mon Aug 23 14:10:48 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 23 Aug 2010 09:10:48 -0400
Subject: [rabbitmq-discuss] Concerning cluster failure scenario
In-Reply-To: <yrv4clj803wc5.fsf@dwragg.eng.vmware.com>
References: <AANLkTimD8T1fVgjf5ZAyXPVVeALhJRJB=b58jz7yvSgw@mail.gmail.com>
	<yrv4clj803wc5.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=LWYiLe7dvGS0e5SvP3xviOH+miTpwg5vN-p6+@mail.gmail.com>

On Sat, Aug 21, 2010 at 9:54 AM, David Wragg <david at rabbitmq.com> wrote:

> You say that an application node went down, and queues disappeared. ?Is
> it possible that those queues has been declared on that node?

The queues that disappeared were on other nodes and were not durable.
It is possible that our application stack is responsible for the
queues disappearing.  We have numerous instances of probably 100
different applications running on our cluster, and when something
dies, forensic gathering clashes with urgent repairs.

Interim work and a camping trip clouds some of the details.

>> The logs when the other node went down have many entries similar to
>> the following:
>>
>> =ERROR REPORT==== 16-Aug-2010::18:06:54 ===
>> connection <0.20615.10> (running), channel 2 - error:
>> {amqp_error,internal_error,
>>             "commit failed:
>
> My guess is that these are due to the crash itself.

Yeah, I expect so.  We see that anytime there's a disconnect within the cluster.

>> =ERROR REPORT==== 16-Aug-2010::18:06:56 ===
>> connection <0.22741.65> (running), channel 1 - error:
>> {amqp_error,not_found,"no queue 'ogre.28645' in vhost
>> '/hydra'",'queue.bind'}
>
> This is what I would expect if the queues in question resided on the
> crashed node.

It's a race condition that is very common for us.  The destination
queue was on the crashed node, so a commit failed.  The publisher
disconnects and then tries to reconnect, setting up queues and
bindings.

> AMQP applications often bind queues immediately after declaring them.
> But from your description of this error, it sounds like the binding
> happens quite separately from the declaration. ?Is that right?

No they're in rapid succession.  I know that our libevent integration
with py-amqplib isn't perfect with respect to synchronous vs.
asynchronous transactions, but binding errors only occur when we
quickly disconnect the one consumer of a non-durable queue, then
reconnect and redeclare the queue and the bindings.

Looking at our default behavior, I think the problem is that
nowait=False, when it should be true.

>> So both logs and rabbitmqctl were in
>> agreement that the queues which should have existed for our
>> translators did not exist. ?I didn't see any errors about the
>> queue.basic_consume calls though.
>
> That is indeed surprising. ?Do you have the output of 'rabbitmqctl
> list_bindings' from this point?

I don't, but it was consistent with other rabbitmqctl output.

>> Our translators have some test endpoints, and one of those is a ping
>> which writes directly to the response exchange to effectively test
>> that the translator and Rabbit are working together. ?The response
>> exchange is living on the same node which the translator is connected
>> to and consuming from.
>
> Note that exchanges do not live on a particular node, unlike queues.

I know, but in this case, there was a distinct branch of behavior
depending on which node was being published to.  It was almost as if
all rabbitmqctl output, and the configurations of other nodes, was
driven entirely from mnesia, but that internally there was still a
reference to the queue, the binding and the consumer.

>> When we called this test endpoint, it succeeded! ?Though rabbit did
>> not report a queue or binding, every single on of our translators was
>> receiving responses though they never should have. ?When one of our
>> services wrote back to the response exchange on other node in the
>> cluster, the message was dropped as we would expect.
>
> Again, the output of 'rabbitmqctl list_bindings' would be useful, if you
> have it.
>
> One more general question: This is a fairly elaborate clustering set-up.
> While we intended that clustering works properly, and I hope we can get
> to the bottom of your problem, the non-uniform nature of the current
> RabbitMQ clustering can make it quite complicated to administer. ?So I
> wonder what requirements led you to this design?

How do you mean non-uniform?

We think we've modeled our environment on best practices.  This report
is complicated because it covers our HTTP interfaces, but otherwise we
have asynchronous applications connected to one of several nodes.  We
use clustering to share our workload and give us fallback hosts.  If
one suite of apps fails to process data fast enough, the worst they'll
do is back up one of the cluster nodes and not take down our entire
infrastructure.  We can divide the workflow evenly and monitor the
hosts to ensure that cpu, ram and disk are within bounds.  We're
over-allocated on capacity at the moment, but expect an order of
magnitude growth over the next 6-9 months.

Thanks for your time!

cheers,
Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From tim at cantemo.com  Mon Aug 23 14:31:11 2010
From: tim at cantemo.com (Tim Child)
Date: Mon, 23 Aug 2010 15:31:11 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.8.1 Stomp adaptor badmatch
Message-ID: <E3C2751E-3476-435D-BEBA-C26011BD236C@cantemo.com>

This is what I got in my log file:

=INFO REPORT==== 23-Aug-2010::14:38:19 ===
starting STOMP connection <0.451.0> from 10.0.1.100:63404

=ERROR REPORT==== 23-Aug-2010::14:38:19 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {{badmatch,
                        {ok,
                         {'channel.open_ok'},

{state,#Port<0.2016>,undefined,<0.453.0>,<0.452.0>,
                          {headers,
                           {hstate,command,[],undefined,undefined,
[]}}}}},
                       [{rabbit_stomp_server,do_login,4},
                        {rabbit_stomp_server,process_frame,3},
                        {rabbit_stomp_server,process_received_bytes,
2},
                        {rabbit_stomp_server,init,1},
                        {proc_lib,init_p_do_apply,3}]}

=INFO REPORT==== 23-Aug-2010::14:38:19 ===
ending STOMP connection <0.451.0> from 10.0.1.100:63404


----

What I did was checkout the rabbitmq-public-umbrella package, then I
reverted rabbitmq-stomp to version 149
cd rabbitmq-stomp
hg update -C -r 149
make package
Then I copied rabbitmq-stomp/dist/rabbit_stomp.ez and rabbitmq-stomp/
dist/amqp_client.ez to my plugins directory, and then copied the
rabbitmq-stomp/ebin files to my rabbitmq_server-1.8.1/ebin/ directory.

After that I activated, restarted, and then tried to connect using
stomp.py

From simon at rabbitmq.com  Mon Aug 23 15:20:51 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Aug 2010 15:20:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.8.1 Stomp adaptor badmatch
In-Reply-To: <E3C2751E-3476-435D-BEBA-C26011BD236C@cantemo.com>
References: <E3C2751E-3476-435D-BEBA-C26011BD236C@cantemo.com>
Message-ID: <4C7283C3.2010902@rabbitmq.com>

On 23/08/10 14:31, Tim Child wrote:
> This is what I got in my log file:
>
> =INFO REPORT==== 23-Aug-2010::14:38:19 ===
> starting STOMP connection<0.451.0>  from 10.0.1.100:63404
>
> =ERROR REPORT==== 23-Aug-2010::14:38:19 ===
> STOMP error frame sent:
> Message: "Processing error"
> Detail: "Processing error\n"
> Server private detail: {{badmatch,
>                          {ok,
>                           {'channel.open_ok'},
>
> {state,#Port<0.2016>,undefined,<0.453.0>,<0.452.0>,
>                            {headers,
>                             {hstate,command,[],undefined,undefined,
> []}}}}},
>                         [{rabbit_stomp_server,do_login,4},
>                          {rabbit_stomp_server,process_frame,3},
>                          {rabbit_stomp_server,process_received_bytes,
> 2},
>                          {rabbit_stomp_server,init,1},
>                          {proc_lib,init_p_do_apply,3}]}
>
> =INFO REPORT==== 23-Aug-2010::14:38:19 ===
> ending STOMP connection<0.451.0>  from 10.0.1.100:63404

This looks like you are running the wrong version. However...

> What I did was checkout the rabbitmq-public-umbrella package, then I
> reverted rabbitmq-stomp to version 149

In Mercurial, the short version integers like 149 are only meanigful 
locally - my 149 is not yours, unfortunately. J?r?my Lal suggests that 
0428e1a2a2ab should work - you should be able to see this with "hg id".

> cd rabbitmq-stomp
> hg update -C -r 149
> make package
> Then I copied rabbitmq-stomp/dist/rabbit_stomp.ez and rabbitmq-stomp/
> dist/amqp_client.ez to my plugins directory

Sounds OK.

> and then copied the
> rabbitmq-stomp/ebin files to my rabbitmq_server-1.8.1/ebin/ directory.

You should not need to copy these - they're embedded in the .ez file.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From tim at cantemo.com  Mon Aug 23 16:30:19 2010
From: tim at cantemo.com (Tim Child)
Date: Mon, 23 Aug 2010 17:30:19 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.8.1 Stomp adaptor badmatch
In-Reply-To: <4C7283C3.2010902@rabbitmq.com>
References: <E3C2751E-3476-435D-BEBA-C26011BD236C@cantemo.com>
	<4C7283C3.2010902@rabbitmq.com>
Message-ID: <3AC5CEF9-11C0-4569-98ED-A5F8ABF77369@cantemo.com>

I managed with the help of the IRC channel to checkout the complete rabbitmq-public-umbrella and compile.

So now was is left to do is to install in a meaningful way on my Ubuntu 10.04 LTS server, by that I mean, have a proper daemon running, with the binaries on the path and have the STOMP server installed. I presume there is something in rabbitmq-server/packaging I could use?

I can't find any instructions on how to do this however.

Tim.


On 23 Aug 2010, at 16:20, Simon MacMullen wrote:

> On 23/08/10 14:31, Tim Child wrote:
>> This is what I got in my log file:
>> 
>> =INFO REPORT==== 23-Aug-2010::14:38:19 ===
>> starting STOMP connection<0.451.0>  from 10.0.1.100:63404
>> 
>> =ERROR REPORT==== 23-Aug-2010::14:38:19 ===
>> STOMP error frame sent:
>> Message: "Processing error"
>> Detail: "Processing error\n"
>> Server private detail: {{badmatch,
>>                         {ok,
>>                          {'channel.open_ok'},
>> 
>> {state,#Port<0.2016>,undefined,<0.453.0>,<0.452.0>,
>>                           {headers,
>>                            {hstate,command,[],undefined,undefined,
>> []}}}}},
>>                        [{rabbit_stomp_server,do_login,4},
>>                         {rabbit_stomp_server,process_frame,3},
>>                         {rabbit_stomp_server,process_received_bytes,
>> 2},
>>                         {rabbit_stomp_server,init,1},
>>                         {proc_lib,init_p_do_apply,3}]}
>> 
>> =INFO REPORT==== 23-Aug-2010::14:38:19 ===
>> ending STOMP connection<0.451.0>  from 10.0.1.100:63404
> 
> This looks like you are running the wrong version. However...
> 
>> What I did was checkout the rabbitmq-public-umbrella package, then I
>> reverted rabbitmq-stomp to version 149
> 
> In Mercurial, the short version integers like 149 are only meanigful locally - my 149 is not yours, unfortunately. J?r?my Lal suggests that 0428e1a2a2ab should work - you should be able to see this with "hg id".
> 
>> cd rabbitmq-stomp
>> hg update -C -r 149
>> make package
>> Then I copied rabbitmq-stomp/dist/rabbit_stomp.ez and rabbitmq-stomp/
>> dist/amqp_client.ez to my plugins directory
> 
> Sounds OK.
> 
>> and then copied the
>> rabbitmq-stomp/ebin files to my rabbitmq_server-1.8.1/ebin/ directory.
> 
> You should not need to copy these - they're embedded in the .ez file.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com


From simon at rabbitmq.com  Mon Aug 23 16:49:02 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Aug 2010 16:49:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.8.1 Stomp adaptor badmatch
In-Reply-To: <3AC5CEF9-11C0-4569-98ED-A5F8ABF77369@cantemo.com>
References: <E3C2751E-3476-435D-BEBA-C26011BD236C@cantemo.com>	<4C7283C3.2010902@rabbitmq.com>
	<3AC5CEF9-11C0-4569-98ED-A5F8ABF77369@cantemo.com>
Message-ID: <4C72986E.7010900@rabbitmq.com>

On 23/08/10 16:30, Tim Child wrote:
> I managed with the help of the IRC channel to checkout the complete
> rabbitmq-public-umbrella and compile.

I'll assume you're running from default now.

> So now was is left to do is to install in a meaningful way on my
> Ubuntu 10.04 LTS server, by that I mean, have a proper daemon
> running, with the binaries on the path and have the STOMP server
> installed. I presume there is something in rabbitmq-server/packaging
> I could use?

Yes, but as noted it's undocumented; building Debian packages from 
Mercurial is a fairly rare case. Try something like:

$ cd rabbitmq-server
$ make VERSION=1.8.99 srcdist
$ make -C packaging/debs/Debian UNOFFICIAL_RELEASE=true package
$ sudo dpkg -i packaging/debs/Debian/rabbitmq-server_1.8.99-1_all.deb

This will build and install a Debian package for the server *without* 
plugins.

You should then copy the .ez. files for the plugins you need to:

/usr/lib/rabbitmq/lib/rabbitmq_server-1.8.99/plugins/

and restart rabbitmq-server for the changes to take effect (there's no 
rabbitmq-activate-plugins in default, it's automatic).

Of course, the 1.8.99 version above is something I made up, you could 
use something else.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Mon Aug 23 17:45:32 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 Aug 2010 17:45:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.8.1 Stomp adaptor badmatch
In-Reply-To: <914172FC-B72E-4C79-95CE-073B5BDCDCBB@cantemo.com>
References: <E3C2751E-3476-435D-BEBA-C26011BD236C@cantemo.com>	<4C7283C3.2010902@rabbitmq.com>
	<3AC5CEF9-11C0-4569-98ED-A5F8ABF77369@cantemo.com>
	<4C72986E.7010900@rabbitmq.com>
	<914172FC-B72E-4C79-95CE-073B5BDCDCBB@cantemo.com>
Message-ID: <4C72A5AC.4000805@rabbitmq.com>

On 23/08/10 17:35, Tim Child wrote:
> Awesome just what I wanted. For future reference, I needed the
> packages - cdbs debhelper xmlto.

Ah, should have mentioned that...

> Only thing I have noticed is that I don't have the commands
> "rabbitmq-activate-plugins   rabbitmq-deactivate-plugins"

In the upcoming version of rabbitmq-server, those commands don't exist 
any more. Restarting the server will automatically activate plugins. 
Remove the plugins from the plugins directory and restart to deactivate 
them. A list of activated plugins is written into 
/var/log/rabbitmq/startup_log.

Cheers, Simon

> Perhaps I am missing something from doing my compile steps: ---
>
> apt-get install erlang-crypto erlang-snmp erlang-syntax-tools
> libsctp1 lksctp-tools erlang-runtime-tools erlang-mnesia
> erlang-public-key erlang-os-mon erlang-ssl erlang-base
> erlang-parsetools mercurial git-core build-essential erlang-dev zip
> erlang-tools erlang-src python-simplejson  erlang-edoc cd ~ hg clone
> http://hg.rabbitmq.com/rabbitmq-public-umbrella cd
> rabbitmq-public-umbrella make co make
>
> ---
>
> Thanks though..
>
> Tim.
>
> On 23 Aug 2010, at 17:49, Simon MacMullen wrote:
>
>> On 23/08/10 16:30, Tim Child wrote:
>>> I managed with the help of the IRC channel to checkout the
>>> complete rabbitmq-public-umbrella and compile.
>>
>> I'll assume you're running from default now.
>>
>>> So now was is left to do is to install in a meaningful way on my
>>> Ubuntu 10.04 LTS server, by that I mean, have a proper daemon
>>> running, with the binaries on the path and have the STOMP server
>>> installed. I presume there is something in
>>> rabbitmq-server/packaging I could use?
>>
>> Yes, but as noted it's undocumented; building Debian packages from
>> Mercurial is a fairly rare case. Try something like:
>>
>> $ cd rabbitmq-server $ make VERSION=1.8.99 srcdist $ make -C
>> packaging/debs/Debian UNOFFICIAL_RELEASE=true package $ sudo dpkg
>> -i packaging/debs/Debian/rabbitmq-server_1.8.99-1_all.deb
>>
>> This will build and install a Debian package for the server
>> *without* plugins.
>>
>> You should then copy the .ez. files for the plugins you need to:
>>
>> /usr/lib/rabbitmq/lib/rabbitmq_server-1.8.99/plugins/
>>
>> and restart rabbitmq-server for the changes to take effect (there's
>> no rabbitmq-activate-plugins in default, it's automatic).
>>
>> Of course, the 1.8.99 version above is something I made up, you
>> could use something else.
>>
>> Cheers, Simon -- Simon MacMullen Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>>
>> _______________________________________________ rabbitmq-discuss
>> mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>>
> Tim Child +46 (0) 7602 17785 Skype: timchild http://www.cantemo.com
>


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jay at custin.com  Mon Aug 23 18:26:01 2010
From: jay at custin.com (Jay Custin)
Date: Mon, 23 Aug 2010 13:26:01 -0400
Subject: [rabbitmq-discuss] Inconsistency in the Windows instructions/kit
Message-ID: <001601cb42e8$42ee9910$c8cbcb30$@com>

Using the kit (v1.8.1) I downloaded this morning and the instructions found
at http://www.rabbitmq.com/install.html I see the following
inconsistency(ies):

 

Within the sbin directory is a file rabbitmq-server.bat which may need
customisation for your installation, especially if you use a different
version of Erlang.

 

But from the kit I find: 

 

C:\Program Files\RabbitMQ\rabbitmq-server-1.8.1>dir/w *.

 Volume in drive C has no label.

 Volume Serial Number is 7C90-4B19

 

 Directory of C:\Program Files\RabbitMQ\rabbitmq-server-1.8.1

 

[.]                    [..]                   calculate-relative

[codegen]              [docs]                 [ebin]

generate_app           generate_deps          [include]

INSTALL                LICENSE                LICENSE-MPL-RabbitMQ

Makefile               README                 [scripts]

[src]

               8 File(s)         68,499 bytes

               8 Dir(s)  58,384,355,328 bytes free

 

And sure enough the file rabbitmq-server.bat occurs in the "scripts"
directory.

 

Jay

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100823/00e31745/attachment.htm>

From tonyg at rabbitmq.com  Mon Aug 23 19:59:56 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Mon, 23 Aug 2010 14:59:56 -0400
Subject: [rabbitmq-discuss] My very unofficial bleeding-edge binary
 rabbitmq-universe repository (was Re: RabbitMQ 1.8.1 Stomp adaptor
 badmatch)
In-Reply-To: <3AC5CEF9-11C0-4569-98ED-A5F8ABF77369@cantemo.com>
References: <E3C2751E-3476-435D-BEBA-C26011BD236C@cantemo.com>	<4C7283C3.2010902@rabbitmq.com>
	<3AC5CEF9-11C0-4569-98ED-A5F8ABF77369@cantemo.com>
Message-ID: <4C72C52C.3000504@rabbitmq.com>

Tim Child wrote:
> So now was is left to do is to install in a meaningful way on my Ubuntu
> 10.04 LTS server, by that I mean, have a proper daemon running, with the binaries
> on the path and have the STOMP server installed. I presume there is something in
> rabbitmq-server/packaging I could use?

If you don't mind using the extremely unofficial packages I've built for my own
personal use (on and for a rackspace-cloud ubuntu machine), you could try adding

  deb http://vapour.eighty-twenty.org/rabbitmq/repo/debian/ kitten main

to your sources.list and running

  apt-get install rabbitmq-server rabbitmq-plugin-rabbit-stomp

The packages in the repo are built from the latest mercurial/git revisions of
the various rabbitmq projects by http://github.com/tonyg/rabbitmq-universe
every time I get around to making it check for updates. Which is every few
days. I suppose I should cron it or something.

The version numbers will look odd at first glance. I've tried to explain here:
http://github.com/tonyg/rabbitmq-universe#readme

Cheers,
  Tony



From gordon.robinson at gmail.com  Mon Aug 23 22:07:22 2010
From: gordon.robinson at gmail.com (Gordon Robinson)
Date: Mon, 23 Aug 2010 22:07:22 +0100
Subject: [rabbitmq-discuss] Problems with SSL support
Message-ID: <AANLkTikipmGDeV5D_k=yRR+T2r89V5HHCPuOd_C+ovg8@mail.gmail.com>

I?ve recently upgraded my version of RabbitMQ and ubuntu and am now having
problems trying to get it to work using the SSL support.  I?ve using Ubuntu
10.4 and RabbitMQ 1.8.1.  Erlang is at version 5.7.4 (R13B03).  erlang_ssl
is version 3.10.7.



Whenever I try and connect to the server from my .Net client using the 1.8.1
library I get the following in my log file:



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

Limiting to approx 924 file handles



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

Memory limit set to 198MB.



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

Rolling persister log to "/var/lib/rabbitmq/mnesia/rabbit at ubuntu
/rabbit_persister.LOG.previous"



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

started TCP Listener on 0.0.0.0:5672



=INFO REPORT==== 23-Aug-2010::15:12:30 ===

started SSL Listener on 0.0.0.0:5671



=INFO REPORT==== 23-Aug-2010::15:14:02 ===

accepted TCP connection on 0.0.0.0:5671 from 192.168.152.1:49757



=INFO REPORT==== 23-Aug-2010::15:14:02 ===

starting TCP connection <0.309.0> from 192.168.152.1:49757



=ERROR REPORT==== 23-Aug-2010::15:14:02 ===

** State machine <0.310.0> terminating

** Last message in was {tcp,#Port<0.1886>,<<65,77,81,80,1,1,8,0>>}

** When State == hello

**      Data  == {state,server,

                     {#Ref<0.0.0.489>,<0.309.0>},

                     gen_tcp,tcp,tcp_closed,"localhost",5671,#Port<0.1886>,

                     {ssl_options,[],verify_peer,#Fun<ssl.2.46498989>,false,

                         false,1,"/opt/memex/server/cert.pem",

                         "/opt/memex/server/key.pem",undefined,undefined,

                         "/opt/memex/testca/cacert.pem",

                         [<<0,10>>,<<0,47>>,<<0,5>>,<<0,4>>,<<0,9>>],

                         #Fun<ssl.0.78632910>,true,[]},

                     {socket_options,binary,0,0,0,false},

                     {connection_states,

                         {connection_state,

                             {security_parameters,undefined,0,0,0,undefined,


undefined,undefined,undefined,0,undefined,0,

                                 undefined,undefined,undefined,undefined},

                             undefined,undefined,undefined,0},

                         {connection_state,

                             {security_parameters,undefined,0,undefined,

                                 undefined,undefined,undefined,undefined,

                                 undefined,undefined,undefined,undefined,

                                 undefined,undefined,


<<76,114,200,122,113,163,4,87,181,206,33,228,


217,189,66,80,91,54,17,1,216,163,45,205,102,

                                   27,203,158,65,229,96,147>>,

                                 undefined},

                             undefined,undefined,undefined,undefined},

                         {connection_state,

                             {security_parameters,undefined,0,0,0,undefined,


undefined,undefined,undefined,0,undefined,0,

                                 undefined,undefined,undefined,undefined},

                             undefined,undefined,undefined,0},

                         {connection_state,

                             {security_parameters,undefined,0,undefined,

                                 undefined,undefined,undefined,undefined,

                                 undefined,undefined,undefined,undefined,

                                 undefined,undefined,


<<76,114,200,122,113,163,4,87,181,206,33,228,


217,189,66,80,91,54,17,1,216,163,45,205,102,

                                   27,203,158,65,229,96,147>>,

                                 undefined},

                             undefined,undefined,undefined,undefined}},

                     <<>>,<<>>,


{{<<1,35,69,103,137,171,205,239,254,220,186,152,118,84,50,

                         16,0,0,0,0,0,0,0,0,97,98,98,105,116,109,113,95,115,


101,114,118,101,114,45,49,46,56,46,49,47,115,98,105,


110,47,46,46,47,101,98,105,110,47,115,115,108,95,104,


97,110,100,115,104,97,107,101,46,98,101,97,109,0,0,0,

                         0,0,0,0,0,49,0,0,0,0,0,0,0>>,

                       <<1,35,69,103,137,171,205,239,254,220,186,152,118,84,

                         50,16,240,225,210,195,0,0,0,0,0,0,0,0,48,46,55,47,


101,98,105,110,47,115,115,108,95,104,97,110,100,115,


104,97,107,101,46,98,101,97,109,97,107,101,46,98,153,


0,0,0,3,0,0,0,156,104,56,183,0,0,0,0,0,0,0,0,0,0,0,0,

                         0,0,0,0,0,0,0,0,0,0,0,0>>},


{<<1,35,69,103,137,171,205,239,254,220,186,152,118,84,50,

                         16,0,0,0,0,0,0,0,0,97,98,98,105,116,109,113,95,115,


101,114,118,101,114,45,49,46,56,46,49,47,115,98,105,


110,47,46,46,47,101,98,105,110,47,115,115,108,95,104,


97,110,100,115,104,97,107,101,46,98,101,97,109,0,0,0,

                         0,0,0,0,0,49,0,0,0,0,0,0,0>>,

                       <<1,35,69,103,137,171,205,239,254,220,186,152,118,84,

                         50,16,240,225,210,195,0,0,0,0,0,0,0,0,48,46,55,47,


101,98,105,110,47,115,115,108,95,104,97,110,100,115,

                         104,97,107,101,46,98,101,97,109,97,107,101,46,98,

                         153,0,0,0,3,0,0,0,156,104,56,183,0,0,0,0,0,0,0,0,0,

                         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0>>}},

                     [],


<<48,130,2,209,48,130,1,185,160,3,2,1,2,2,1,1,48,13,6,9,


42,134,72,134,247,13,1,1,5,5,0,48,22,49,20,48,18,6,3,85,


4,3,19,11,80,97,116,114,105,97,114,99,104,77,81,48,30,


23,13,49,48,48,56,50,51,49,55,53,50,50,56,90,23,13,49,


49,48,56,50,51,49,55,53,50,50,56,90,48,17,49,15,48,13,6,


3,85,4,3,19,6,117,98,117,110,116,117,48,130,1,34,48,13,


6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,


1,10,2,130,1,1,0,240,206,61,195,81,249,30,191,37,80,210,


97,45,52,21,235,156,125,76,104,74,32,39,190,81,131,140,


53,54,175,97,1,9,128,56,190,218,230,249,207,159,18,133,


83,145,66,0,97,124,232,160,11,249,209,23,61,8,95,8,33,


245,156,86,182,210,188,192,27,80,117,210,22,173,120,9,


106,96,0,6,206,76,151,170,59,241,226,148,132,207,167,95,


188,147,93,16,97,25,47,234,156,253,53,10,200,210,242,66,


239,60,34,255,187,237,10,68,27,113,6,193,167,59,32,213,


22,145,143,242,26,123,21,71,166,234,19,91,46,225,221,54,


233,199,14,174,245,55,173,48,218,79,52,38,73,42,93,70,


139,30,245,74,0,241,194,124,240,242,126,48,158,154,219,


135,44,39,254,90,42,38,179,250,11,104,51,110,30,35,14,


236,2,44,22,235,210,74,32,101,251,124,163,238,174,119,

                       125,145,184,92,191,171,76,165,32,30,22,213,97,11,134,


244,58,126,132,189,95,73,139,61,109,181,221,249,234,232,


220,14,118,14,199,17,156,136,161,28,5,150,96,16,83,11,


17,99,249,10,82,59,6,144,29,2,3,1,0,1,163,47,48,45,48,9,


6,3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,


48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,


13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,0,94,58,

                       169,57,227,155,93,3,38,59,200,79,56,104,214,5,211,33,


161,223,25,140,196,71,236,28,94,33,28,61,253,101,30,240,


161,177,217,18,52,196,217,247,167,230,122,90,77,184,58,


54,73,75,138,171,196,150,159,13,10,244,126,101,157,99,


30,161,56,69,0,159,214,217,6,60,217,186,253,189,37,107,


157,120,14,120,142,211,92,236,66,62,222,175,139,183,175,


183,244,95,24,46,191,235,134,208,179,138,67,1,117,238,


118,184,157,122,3,109,121,91,145,188,249,22,153,207,187,


51,185,228,131,18,121,185,232,40,51,46,47,240,113,223,


132,65,166,251,161,183,49,197,229,8,161,210,162,56,70,


177,2,55,137,68,156,246,194,13,37,102,190,212,91,64,245,


224,245,193,211,33,114,58,249,216,224,248,177,59,52,171,


234,94,235,145,154,189,220,221,216,114,110,59,62,7,113,

                       86,51,82,92,23,14,188,23,220,170,203,179,222,249,172,


172,53,80,33,113,48,110,17,231,18,107,40,134,80,59,227,


220,51,19,160,10,17,223,243,252,177,50,111,36,85,31,216,

                       239,69,57,41,248,16,155,230>>,

                     {session,undefined,undefined,undefined,undefined,

                         undefined,false,undefined},

                     143416,ssl_session_cache,undefined,undefined,false,

                     undefined,undefined,

                     {'RSAPrivateKey','two-prime',


30398894548410421145429503863141262794424948956980331525482246936698923945493304052034839119789003402128662978724398013149831739744571701598176856460306520767824104259514408250283911043782279373063969484605834921709214208612587276909566299321046864779542406219279789218623508096670096828074380473629160218113186622787723537092279159445817379513076561854396992128528895918242061646866646429621915320993554813978211567538416829402129313385939899845838282300263008183018421675819186452009553790489791666498892895752488841223943132536960611059968546332387113905936758131542047418381322919547853895110090268178995216814109,

                         65537,


20210577738732912250311340804809361162071560735974289412519835566563094345988285154268001436248935047950777473930443417137868205199360333583102094842432148601486669679655184037740063963862878631050296449078313612290978859234747590361225304698363580758567247871987716493490142893146000869628712116773269588531860908341493168497266906442321885515898434445130197299948246674007686696230057104952905643853071699676628178237289258631271288302406865959096315047458066090622897857576117174910893747661810297852718394850805367999588003104017411898288838853890622731631964394697537884326611820388152917699596495600193889685169,


179054234250895360208868484599140198401723455804053707464741994806412431405409304622807329906865989982021588267147308910141470689516351409253917903626138921640273527757280681594860864376999930099824366432907523084840885643395443547539152884598628614516227853353088712805742623001192712249408671311086599141447,


169774787374280770779066149172673101156163602152615726519303049607462237337000172660482791848674503292362270716756848525641876904749106722609903750688570413926737680514719703855084839715287341595671727627273611295510055591169382981580324505177869713458443375239988258382126728365756524656365624864100967156347,


52145034330417761645276163038576526644419089636024979182325491140503649324864458062329687025686929288750843548938363639760137168013627157132921511643933769602304965908959199977409928094044900832892074061041442018970553174387680784111757815515654145546130045761891010766596025185784581320356651977408163803861,


54219544680771114521657300489556250777400616339689750157148066409572983619381625856903807519306000486887442606492833661011100349671159859380583265970547610715879879353236849439048563334314418719157258636172493162870217793356045986305082501386587928997134745926315733828797662765999115935391191668914250615413,


149383369136315075137099878868863322421183694610764911283368726453550984587106254460395177686264404117511654210035460973354287280862647798049584797321416944299546978437856430847674270084226772637166060174983178495596302686112381529307249392410214651869398395853785925605752575147149686720932768370380284639697,

                         asn1_NOVALUE},

                     undefined,undefined,#Ref<0.0.0.492>,

                     {<0.309.0>,#Ref<0.0.0.498>},

                     0,<<>>,true}

** Reason for termination =

** {function_clause,[{ssl_record,mac_hash,

                                 [undefined,0,undefined,0,21,2,<<2,22>>]},

                     {ssl_record,hash_and_bump_seqno,5},

                     {ssl_record,cipher,4},

                     {ssl_record,encode_plain_text,4},

                     {ssl_connection,handle_own_alert,4},

                     {ssl_connection,handle_info,3},

                     {gen_fsm,handle_msg,7},

                     {proc_lib,init_p_do_apply,3}]}



=ERROR REPORT==== 23-Aug-2010::15:14:02 ===

error on TCP connection <0.309.0>:{ssl_upgrade_failure,

                                   {{function_clause,

                                     [{ssl_record,mac_hash,

                                       [undefined,0,undefined,0,21,2,

                                        <<2,22>>]},

                                      {ssl_record,hash_and_bump_seqno,5},

                                      {ssl_record,cipher,4},

                                      {ssl_record,encode_plain_text,4},

                                      {ssl_connection,handle_own_alert,4},

                                      {ssl_connection,handle_info,3},

                                      {gen_fsm,handle_msg,7},

                                      {proc_lib,init_p_do_apply,3}]},

                                    {gen_fsm,sync_send_all_state_event,

                                     [<0.310.0>,started,5000]}}}



=INFO REPORT==== 23-Aug-2010::15:14:02 ===

closing TCP connection <0.309.0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100823/57887162/attachment-0001.htm>

From alexandru at rabbitmq.com  Mon Aug 23 23:38:05 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 23 Aug 2010 23:38:05 +0100
Subject: [rabbitmq-discuss] Problems with SSL support
In-Reply-To: <AANLkTikipmGDeV5D_k=yRR+T2r89V5HHCPuOd_C+ovg8@mail.gmail.com>
References: <AANLkTikipmGDeV5D_k=yRR+T2r89V5HHCPuOd_C+ovg8@mail.gmail.com>
Message-ID: <20100823223805.GA2327@dakota>

There's a bug in that version of the .NET client that breaks SSL.

It's been fixed in the default branch and will make it into the next
release.

In the meantime, either compile from source (it's fairly straightforward
and we've got some very easy to follow instructions: [1]), or use a
version of the .NET client prior to 1.8.0 (not recommended).

Your best bet is probably to wait for the next release.

Cheers,
Alex

[1]  http://www.rabbitmq.com/build-dotnet-client.html

On Mon, Aug 23, 2010 at 10:07:22PM +0100, Gordon Robinson wrote:
> I?ve recently upgraded my version of RabbitMQ and ubuntu and am now having
> problems trying to get it to work using the SSL support.  I?ve using Ubuntu
> 10.4 and RabbitMQ 1.8.1.  Erlang is at version 5.7.4 (R13B03).  erlang_ssl
> is version 3.10.7.
> 
> 
> 
> Whenever I try and connect to the server from my .Net client using the 1.8.1
> library I get the following in my log file:
> 
> 
> 
> =INFO REPORT==== 23-Aug-2010::15:12:30 ===
> 
> Limiting to approx 924 file handles
> 
... 
> 
> =ERROR REPORT==== 23-Aug-2010::15:14:02 ===
> 
> error on TCP connection <0.309.0>:{ssl_upgrade_failure,
> 
>                                    {{function_clause,
> 
>                                      [{ssl_record,mac_hash,
> 
>                                        [undefined,0,undefined,0,21,2,
> 
>                                         <<2,22>>]},
> 
>                                       {ssl_record,hash_and_bump_seqno,5},
> 
>                                       {ssl_record,cipher,4},
> 
>                                       {ssl_record,encode_plain_text,4},
> 
>                                       {ssl_connection,handle_own_alert,4},
> 
>                                       {ssl_connection,handle_info,3},
> 
>                                       {gen_fsm,handle_msg,7},
> 
>                                       {proc_lib,init_p_do_apply,3}]},
> 
>                                     {gen_fsm,sync_send_all_state_event,
> 
>                                      [<0.310.0>,started,5000]}}}
> 
> 
> 
> =INFO REPORT==== 23-Aug-2010::15:14:02 ===
> 
> closing TCP connection <0.309.0>

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at cantemo.com  Tue Aug 24 08:36:42 2010
From: tim at cantemo.com (Tim Child)
Date: Tue, 24 Aug 2010 09:36:42 +0200
Subject: [rabbitmq-discuss] My very unofficial bleeding-edge binary
	rabbitmq-universe repository (was Re: RabbitMQ 1.8.1 Stomp
	adaptor badmatch)
In-Reply-To: <4C72C52C.3000504@rabbitmq.com>
References: <E3C2751E-3476-435D-BEBA-C26011BD236C@cantemo.com>	<4C7283C3.2010902@rabbitmq.com>
	<3AC5CEF9-11C0-4569-98ED-A5F8ABF77369@cantemo.com>
	<4C72C52C.3000504@rabbitmq.com>
Message-ID: <C5811019-D4F3-477D-B80E-1BA5B0EA54AC@cantemo.com>

Yes, I saw that you had scripts for building different packages. Might give that a go in the future.

Thanks,

Tim.

On 23 Aug 2010, at 20:59, Tony Garnock-Jones wrote:

> Tim Child wrote:
>> So now was is left to do is to install in a meaningful way on my Ubuntu
>> 10.04 LTS server, by that I mean, have a proper daemon running, with the binaries
>> on the path and have the STOMP server installed. I presume there is something in
>> rabbitmq-server/packaging I could use?
> 
> If you don't mind using the extremely unofficial packages I've built for my own
> personal use (on and for a rackspace-cloud ubuntu machine), you could try adding
> 
>  deb http://vapour.eighty-twenty.org/rabbitmq/repo/debian/ kitten main
> 
> to your sources.list and running
> 
>  apt-get install rabbitmq-server rabbitmq-plugin-rabbit-stomp
> 
> The packages in the repo are built from the latest mercurial/git revisions of
> the various rabbitmq projects by http://github.com/tonyg/rabbitmq-universe
> every time I get around to making it check for updates. Which is every few
> days. I suppose I should cron it or something.
> 
> The version numbers will look odd at first glance. I've tried to explain here:
> http://github.com/tonyg/rabbitmq-universe#readme
> 
> Cheers,
>  Tony
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com


From goran at krampe.se  Tue Aug 24 09:15:42 2010
From: goran at krampe.se (=?ISO-8859-1?Q?G=F6ran_Krampe?=)
Date: Tue, 24 Aug 2010 10:15:42 +0200
Subject: [rabbitmq-discuss] STOMP and transactions
In-Reply-To: <4C6ECA49.2040401@rabbitmq.com>
References: <4C6D35FC.8090001@krampe.se> <4C6EB37A.50108@rabbitmq.com>
	<4C6EC1D3.1080107@krampe.se> <4C6ECA49.2040401@rabbitmq.com>
Message-ID: <4C737FAE.8000706@krampe.se>

Hi all!

On 08/20/2010 08:32 PM, Tony Garnock-Jones wrote:
> G?ran Krampe wrote:
>> Swedish! :)
>
> visst :) fast det har varit flera ?r sen jag brukade spr?ket p? allvar.

:)

[SNIP]
>> Right, this was my guess. But then I tried making a sunit test and...
>> well, I start two sessions, let the first set up a subscription to
>> 'wonderland', then let the second session do BEGIN and send two messages
>> to 'wonderland', now, my naive understanding was that session one should
>> not receive any message until session2 does COMMIT.
>
> Did you include the "transaction" header on the SEND? You have to tell the
> server *which* transaction you want the SEND (or the ACK) to be included within.

Ehrmph, <cough cough>, I *thought* i did, but alas, I didn't. Thanks for 
the pointer - now the first txn test is green! Disregarding the fact 
that I need more tests, then the implementation *should* be complete.

FYI:

Class StompProtocol is a stateless encoding of the actual wire protocol. 
Then the other high level objects use that, and StompSession should be 
thread safe using a mutex so that multiple Squeak Processes can share 
it. The reading is done by a background process in the session, so that 
receiving frames is asynchronously performed.

All in all I think it is a fairly nice looking implementation. Will try 
to blog about it in a day or so.

regards, G?ran

From alexandru at rabbitmq.com  Tue Aug 24 09:46:47 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Tue, 24 Aug 2010 09:46:47 +0100
Subject: [rabbitmq-discuss] Problems with SSL support
In-Reply-To: <20100823223805.GA2327@dakota>
References: <AANLkTikipmGDeV5D_k=yRR+T2r89V5HHCPuOd_C+ovg8@mail.gmail.com>
	<20100823223805.GA2327@dakota>
Message-ID: <20100824084647.GB2768@dakota.eng.vmware.com>

> It's been fixed in the default branch and will make it into the next
> release.

For clarification, we got SSL running completely in the .NET client on
Mono.  On Windows, the certificate validation still fails, so your only
chance is to set {verify, verify_none} in the server config (which would
give you an unauthenticated, encrypted connection).  There's an open bug
for this and we're working on it.

On Mon, Aug 23, 2010 at 11:38:05PM +0100, Alexandru Scvor?ov wrote:
> There's a bug in that version of the .NET client that breaks SSL.
> 
> It's been fixed in the default branch and will make it into the next
> release.
> 
> In the meantime, either compile from source (it's fairly straightforward
> and we've got some very easy to follow instructions: [1]), or use a
> version of the .NET client prior to 1.8.0 (not recommended).
> 
> Your best bet is probably to wait for the next release.
> 
> Cheers,
> Alex
> 
> [1]  http://www.rabbitmq.com/build-dotnet-client.html
> 
> On Mon, Aug 23, 2010 at 10:07:22PM +0100, Gordon Robinson wrote:
> > I?ve recently upgraded my version of RabbitMQ and ubuntu and am now having
> > problems trying to get it to work using the SSL support.  I?ve using Ubuntu
> > 10.4 and RabbitMQ 1.8.1.  Erlang is at version 5.7.4 (R13B03).  erlang_ssl
> > is version 3.10.7.
> > 
> > 
> > 
> > Whenever I try and connect to the server from my .Net client using the 1.8.1
> > library I get the following in my log file:
> > 
> > 
> > 
> > =INFO REPORT==== 23-Aug-2010::15:12:30 ===
> > 
> > Limiting to approx 924 file handles
> > 
> ... 
> > 
> > =ERROR REPORT==== 23-Aug-2010::15:14:02 ===
> > 
> > error on TCP connection <0.309.0>:{ssl_upgrade_failure,
> > 
> >                                    {{function_clause,
> > 
> >                                      [{ssl_record,mac_hash,
> > 
> >                                        [undefined,0,undefined,0,21,2,
> > 
> >                                         <<2,22>>]},
> > 
> >                                       {ssl_record,hash_and_bump_seqno,5},
> > 
> >                                       {ssl_record,cipher,4},
> > 
> >                                       {ssl_record,encode_plain_text,4},
> > 
> >                                       {ssl_connection,handle_own_alert,4},
> > 
> >                                       {ssl_connection,handle_info,3},
> > 
> >                                       {gen_fsm,handle_msg,7},
> > 
> >                                       {proc_lib,init_p_do_apply,3}]},
> > 
> >                                     {gen_fsm,sync_send_all_state_event,
> > 
> >                                      [<0.310.0>,started,5000]}}}
> > 
> > 
> > 
> > =INFO REPORT==== 23-Aug-2010::15:14:02 ===
> > 
> > closing TCP connection <0.309.0>
> 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Tue Aug 24 10:34:22 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 24 Aug 2010 10:34:22 +0100
Subject: [rabbitmq-discuss] Inconsistency in the Windows instructions/kit
In-Reply-To: <001601cb42e8$42ee9910$c8cbcb30$@com> (Jay Custin's message of
	"Mon, 23 Aug 2010 13:26:01 -0400")
References: <001601cb42e8$42ee9910$c8cbcb30$@com>
Message-ID: <yrv4cbp8s73s1.fsf@dwragg.eng.vmware.com>

Hi Jay,

"Jay Custin" <jay at custin.com> writes:
> Using the kit (v1.8.1) I downloaded this morning and the instructions found
> at http://www.rabbitmq.com/install.html I see the following
> inconsistency(ies):
>
> Within the sbin directory is a file rabbitmq-server.bat which may need
> customisation for your installation, especially if you use a different
> version of Erlang.
>
> But from the kit I find: 
>
> C:\Program Files\RabbitMQ\rabbitmq-server-1.8.1>dir/w *.
> [...]

It looks like you clicked on the "Source code and tools" download on the
download page.  The Windows installation instructions apply to the
"Packaged for Windows systems" download.  You should find that the
instructions accurately describe the contents of the latter.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From gordon.robinson at gmail.com  Tue Aug 24 11:15:22 2010
From: gordon.robinson at gmail.com (gordon.robinson at gmail.com)
Date: Tue, 24 Aug 2010 10:15:22 +0000
Subject: [rabbitmq-discuss] Problems with SSL support
In-Reply-To: <20100824084647.GB2768@dakota.eng.vmware.com>
Message-ID: <0015174be6a8f823ec048e8f0ae0@google.com>

Thanks.

I reverted the .Net client to 1.7.2 and changed the verify setting to  
verify_none and it works now although as you say unauthenticated.

On , Alexandru Scvortov <alexandru at rabbitmq.com> wrote:
> > It's been fixed in the default branch and will make it into the next

> > release.



> For clarification, we got SSL running completely in the .NET client on

> Mono. On Windows, the certificate validation still fails, so your only

> chance is to set {verify, verify_none} in the server config (which would

> give you an unauthenticated, encrypted connection). There's an open bug

> for this and we're working on it.



> On Mon, Aug 23, 2010 at 11:38:05PM +0100, Alexandru Scvor?ov wrote:

> > There's a bug in that version of the .NET client that breaks SSL.

> >

> > It's been fixed in the default branch and will make it into the next

> > release.

> >

> > In the meantime, either compile from source (it's fairly straightforward

> > and we've got some very easy to follow instructions: [1]), or use a

> > version of the .NET client prior to 1.8.0 (not recommended).

> >

> > Your best bet is probably to wait for the next release.

> >

> > Cheers,

> > Alex

> >

> > [1] http://www.rabbitmq.com/build-dotnet-client.html

> >

> > On Mon, Aug 23, 2010 at 10:07:22PM +0100, Gordon Robinson wrote:

> > > I've recently upgraded my version of RabbitMQ and ubuntu and am now  
> having

> > > problems trying to get it to work using the SSL support. I've using  
> Ubuntu

> > > 10.4 and RabbitMQ 1.8.1. Erlang is at version 5.7.4 (R13B03).  
> erlang_ssl

> > > is version 3.10.7.

> > >

> > >

> > >

> > > Whenever I try and connect to the server from my .Net client using  
> the 1.8.1

> > > library I get the following in my log file:

> > >

> > >

> > >

> > > =INFO REPORT==== 23-Aug-2010::15:12:30 ===

> > >

> > > Limiting to approx 924 file handles

> > >

> > ...

> > >

> > > =ERROR REPORT==== 23-Aug-2010::15:14:02 ===

> > >

> > > error on TCP connection :{ssl_upgrade_failure,

> > >

> > > {{function_clause,

> > >

> > > [{ssl_record,mac_hash,

> > >

> > > [undefined,0,undefined,0,21,2,

> > >

> > > >]},

> > >

> > > {ssl_record,hash_and_bump_seqno,5},

> > >

> > > {ssl_record,cipher,4},

> > >

> > > {ssl_record,encode_plain_text,4},

> > >

> > > {ssl_connection,handle_own_alert,4},

> > >

> > > {ssl_connection,handle_info,3},

> > >

> > > {gen_fsm,handle_msg,7},

> > >

> > > {proc_lib,init_p_do_apply,3}]},

> > >

> > > {gen_fsm,sync_send_all_state_event,

> > >

> > > [,started,5000]}}}

> > >

> > >

> > >

> > > =INFO REPORT==== 23-Aug-2010::15:14:02 ===

> > >

> > > closing TCP connection

> >

> > > _______________________________________________

> > > rabbitmq-discuss mailing list

> > > rabbitmq-discuss at lists.rabbitmq.com

> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

> >

> > _______________________________________________

> > rabbitmq-discuss mailing list

> > rabbitmq-discuss at lists.rabbitmq.com

> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100824/7487fd6a/attachment-0001.htm>

From alexandru at rabbitmq.com  Tue Aug 24 11:34:58 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 24 Aug 2010 11:34:58 +0100
Subject: [rabbitmq-discuss] Problems with SSL support
In-Reply-To: <0015174be6a8f823ec048e8f0ae0@google.com>
References: <20100824084647.GB2768@dakota.eng.vmware.com>
	<0015174be6a8f823ec048e8f0ae0@google.com>
Message-ID: <20100824103458.GE2768@dakota.eng.vmware.com>

I cannot say for sure, but with .NET client 1.7.2 and Erlang R13B03,
certificates should work.  So, {verify, verify_peer} should work.

On Tue, Aug 24, 2010 at 10:15:22AM +0000, gordon.robinson at gmail.com wrote:
> Thanks.
> 
> I reverted the .Net client to 1.7.2 and changed the verify setting to  
> verify_none and it works now although as you say unauthenticated.
> 
> On , Alexandru Scvortov <alexandru at rabbitmq.com> wrote:
> > > It's been fixed in the default branch and will make it into the next
> 
> > > release.
> 
> 
> 
> > For clarification, we got SSL running completely in the .NET client on
> 
> > Mono. On Windows, the certificate validation still fails, so your only
> 
> > chance is to set {verify, verify_none} in the server config (which would
> 
> > give you an unauthenticated, encrypted connection). There's an open bug
> 
> > for this and we're working on it.
> 
> 
> 
> > On Mon, Aug 23, 2010 at 11:38:05PM +0100, Alexandru Scvor?ov wrote:
> 
> > > There's a bug in that version of the .NET client that breaks SSL.
> 
> > >
> 
> > > It's been fixed in the default branch and will make it into the next
> 
> > > release.
> 
> > >
> 
> > > In the meantime, either compile from source (it's fairly straightforward
> 
> > > and we've got some very easy to follow instructions: [1]), or use a
> 
> > > version of the .NET client prior to 1.8.0 (not recommended).
> 
> > >
> 
> > > Your best bet is probably to wait for the next release.
> 
> > >
> 
> > > Cheers,
> 
> > > Alex
> 
> > >
> 
> > > [1] http://www.rabbitmq.com/build-dotnet-client.html
> 
> > >
> 
> > > On Mon, Aug 23, 2010 at 10:07:22PM +0100, Gordon Robinson wrote:
> 
> > > > I've recently upgraded my version of RabbitMQ and ubuntu and am now  
> > having
> 
> > > > problems trying to get it to work using the SSL support. I've using  
> > Ubuntu
> 
> > > > 10.4 and RabbitMQ 1.8.1. Erlang is at version 5.7.4 (R13B03).  
> > erlang_ssl
> 
> > > > is version 3.10.7.
> 
> > > >
> 
> > > >
> 
> > > >
> 
> > > > Whenever I try and connect to the server from my .Net client using  
> > the 1.8.1
> 
> > > > library I get the following in my log file:
> 
> > > >
> 
> > > >
> 
> > > >
> 
> > > > =INFO REPORT==== 23-Aug-2010::15:12:30 ===
> 
> > > >
> 
> > > > Limiting to approx 924 file handles
> 
> > > >
> 
> > > ...
> 
> > > >
> 
> > > > =ERROR REPORT==== 23-Aug-2010::15:14:02 ===
> 
> > > >
> 
> > > > error on TCP connection :{ssl_upgrade_failure,
> 
> > > >
> 
> > > > {{function_clause,
> 
> > > >
> 
> > > > [{ssl_record,mac_hash,
> 
> > > >
> 
> > > > [undefined,0,undefined,0,21,2,
> 
> > > >
> 
> > > > >]},
> 
> > > >
> 
> > > > {ssl_record,hash_and_bump_seqno,5},
> 
> > > >
> 
> > > > {ssl_record,cipher,4},
> 
> > > >
> 
> > > > {ssl_record,encode_plain_text,4},
> 
> > > >
> 
> > > > {ssl_connection,handle_own_alert,4},
> 
> > > >
> 
> > > > {ssl_connection,handle_info,3},
> 
> > > >
> 
> > > > {gen_fsm,handle_msg,7},
> 
> > > >
> 
> > > > {proc_lib,init_p_do_apply,3}]},
> 
> > > >
> 
> > > > {gen_fsm,sync_send_all_state_event,
> 
> > > >
> 
> > > > [,started,5000]}}}
> 
> > > >
> 
> > > >
> 
> > > >
> 
> > > > =INFO REPORT==== 23-Aug-2010::15:14:02 ===
> 
> > > >
> 
> > > > closing TCP connection
> 
> > >
> 
> > > > _______________________________________________
> 
> > > > rabbitmq-discuss mailing list
> 
> > > > rabbitmq-discuss at lists.rabbitmq.com
> 
> > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> > >
> 
> > > _______________________________________________
> 
> > > rabbitmq-discuss mailing list
> 
> > > rabbitmq-discuss at lists.rabbitmq.com
> 
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

From david at rabbitmq.com  Tue Aug 24 11:38:21 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 24 Aug 2010 11:38:21 +0100
Subject: [rabbitmq-discuss] Inconsistency in the Windows instructions/kit
In-Reply-To: <yrv4cbp8s73s1.fsf@dwragg.eng.vmware.com> (David Wragg's message
	of "Tue, 24 Aug 2010 10:34:22 +0100")
References: <001601cb42e8$42ee9910$c8cbcb30$@com>
	<yrv4cbp8s73s1.fsf@dwragg.eng.vmware.com>
Message-ID: <yrv4c1v9o70te.fsf@dwragg.eng.vmware.com>

David Wragg <david at rabbitmq.com> writes:
> It looks like you clicked on the "Source code and tools" download on the
> download page.  The Windows installation instructions apply to the
> "Packaged for Windows systems" download.  You should find that the
> instructions accurately describe the contents of the latter.

Ah, I see that the Windows installation instructions actually suggest
the the wrong download.  OK, we'll get this fixed.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From tim at cantemo.com  Tue Aug 24 14:15:11 2010
From: tim at cantemo.com (Tim Child)
Date: Tue, 24 Aug 2010 15:15:11 +0200
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
Message-ID: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>

I have been reading through the past messages on the mailing list to try and provide some answers.

One part of my application is to provide realtime feedback on jobs going on in the system, there will be a job overview page, which will list the status of x number of jobs (probably about 40), and a job 'detail' page which will have more in-depth information on that job. I have been working with Orbited and Morbidq, and basically it works today by creating STOMP channels for each job, and on going to the detail page of a particular job my Javascript subscribes to the job channel /jobs/jobID  using STOMP. I have a publisher that when there are any updates to the jobs publishes to the channel, and if any consumers are listening on that particular channel the page is updated with the new details.

Now moving over to using RabbitMQ, and the stomp plugin, I understand that my setup will change slightly.

I currently have a VHOST / , and I publish to an exchange, my understanding is that I have to send to a particular exchange "amq.topic" to be able to broadcast to more than one consumer that may or may not be listening. I don't care if my message doesn't ever get received as someone will not always be on the system.

And then my STOMP consumer will listen to VHOST / and amq.topic ? But if I want to replicate my jobs channels, should I create a routing key, binding and different queues for each job? Records of jobs can stay on my system forever, but the period that they get updated is sporadic - much in the first minutes of their life, hardly ever after they have been finished.

It seemed easier to get my publisher to talk AMQP, so my example is more like:

	import stomp
	from amqplib import client_0_8 as amqp
	conn = amqp.Connection(host="myhostname:5672", userid="myusername", password="mypassword", virtual_host="/", insist=False)
        msg = amqp.Message('This is a test message')
        chan = conn.channel()
        chan.basic_publish(msg, 'amq.topic', 'x.#')

My consumer will be javascript, proxied through Orbited using STOMP.

Thanks,

Tim.



From jon at jbrisbin.com  Tue Aug 24 15:40:20 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 24 Aug 2010 09:40:20 -0500
Subject: [rabbitmq-discuss] Writing a new plugin
Message-ID: <AF78AC3F-1056-4CD6-A814-783DE4D37C75@jbrisbin.com>

I originally debated on whether to write a standalone app or a plugin for the functionality I'd like to add to a couple applications I'm writing but I think I've decided it would work better as a plugin. It will need the exact same lifecycle as the broker, etc... so I'm trying to figure out what I need to set up to start developing a plugin. I've read the website info on getting started and I'm looking at the other plugins to see what the best practices are.

I'm trying to add "webhook" functionality to several applications I'm writing (basically my own version of PayPal notifications, Google Checkout callbacks, or GAE tasks), so I thought I'd create a plugin ("rabbitmq-webhook"?) that consumes messages on an exchange and uses the lhttpc module to send them to a configurable REST URL. 

For the first iteration, I'm going to keep it simple and have the webhook plugin manage its own queues, which means I'll have to address the problem of message delivery to the plugin as well as to AMQP consumers. I'm putting that off for the first draft.

The REST API to call, what method to use, what headers to send, etc... will all be configurable, but I'm going to respect message headers so that any of those parameters are overridable on a per-message basis.

Anyone written RabbitMQ plugins using erlide? I've been using TextMate, which I love, but I thought I'd at least see if there was a more productive way to write plugins than by using a text editor. :)

Alos, is there a "hello world" skeleton project that one can clone to get a jump start on writing a new plugin?

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100824/90119aec/attachment.htm>

From tonyg at rabbitmq.com  Tue Aug 24 16:04:13 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Tue, 24 Aug 2010 11:04:13 -0400
Subject: [rabbitmq-discuss] Writing a new plugin
In-Reply-To: <AF78AC3F-1056-4CD6-A814-783DE4D37C75@jbrisbin.com>
References: <AF78AC3F-1056-4CD6-A814-783DE4D37C75@jbrisbin.com>
Message-ID: <4C73DF6D.6020207@rabbitmq.com>

Jon Brisbin wrote:
> I'm trying to add "webhook" functionality to several applications I'm
> writing (basically my own version of PayPal notifications, Google
> Checkout callbacks, or GAE tasks), so I thought I'd create a plugin
> ("rabbitmq-webhook"?) that consumes messages on an exchange and uses the
> lhttpc module to send them to a configurable REST URL. 

Sorry if this has already been mentioned, but have you tried RabbitHub? It
implements PSHB, backed by RabbitMQ, and will both receive messages via HTTP
POST which it then distributes through Rabbit's exchanges and queues, and
deliver messages via HTTP POST when the PSHB subscription protocol is used
(over HTTP) to point RabbitHub at some HTTP server endpoint somewhere else on
the network.

http://github.com/tonyg/rabbithub#readme

Regards,
  Tony


From jon at jbrisbin.com  Tue Aug 24 16:11:45 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 24 Aug 2010 10:11:45 -0500
Subject: [rabbitmq-discuss] Writing a new plugin
In-Reply-To: <4C73DF56.2010309@ccs.neu.edu>
References: <AF78AC3F-1056-4CD6-A814-783DE4D37C75@jbrisbin.com>
	<4C73DF56.2010309@ccs.neu.edu>
Message-ID: <20F49BE7-2ECE-4B08-8B09-CD20715D549B@jbrisbin.com>


On Aug 24, 2010, at 10:03 AM, Tony Garnock-Jones wrote:

> Jon Brisbin wrote:
>> I'm trying to add "webhook" functionality to several applications I'm
>> writing (basically my own version of PayPal notifications, Google
>> Checkout callbacks, or GAE tasks), so I thought I'd create a plugin
>> ("rabbitmq-webhook"?) that consumes messages on an exchange and uses the
>> lhttpc module to send them to a configurable REST URL. 
> 
> Sorry if this has already been mentioned, but have you tried RabbitHub? It
> implements PSHB, backed by RabbitMQ, and will both receive messages via HTTP
> POST which it then distributes through Rabbit's exchanges and queues, and
> deliver messages via HTTP POST when the PSHB subscription protocol is used
> (over HTTP) to point RabbitHub at some HTTP server endpoint somewhere else on
> the network.
> 
> http://github.com/tonyg/rabbithub#readme
> 
> Regards,
>  Tony

Alexis pointed this out to me as I wasn't aware of it. I checked it out of Git and have gotten some pretty good ideas from it as what I'm wanting to do is fairly similar. :)

But I'm wanting more configurability, per-message overrides, and less emphasis on the PSHB model (I really need full REST support, particularly if the webhooks are a CouchDB database or similar).

I'm thinking I'll likely use a REST API on the front end at some point, but I'm more interested in the resulting webhook functionality at the moment.

I'm actually working on a blog post that discusses my two current use cases and explains why I haven't found anything that fits what I'm looking for yet.

I'm *really* digging Erlang, BTW! :) I think it's my new favorite language. Python and Ruby who? ;)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100824/8977fc03/attachment.htm>

From alexis at rabbitmq.com  Tue Aug 24 17:08:16 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 24 Aug 2010 17:08:16 +0100
Subject: [rabbitmq-discuss] Writing a new plugin
In-Reply-To: <20F49BE7-2ECE-4B08-8B09-CD20715D549B@jbrisbin.com>
References: <AF78AC3F-1056-4CD6-A814-783DE4D37C75@jbrisbin.com>
	<4C73DF56.2010309@ccs.neu.edu>
	<20F49BE7-2ECE-4B08-8B09-CD20715D549B@jbrisbin.com>
Message-ID: <AANLkTimxWaB7Nb28ncfRQvF3zfS9iN18J-0mvPFWQ0BF@mail.gmail.com>

Jon

I have also bcc'd a person who may be interested in this discussion.

alexis


On Tue, Aug 24, 2010 at 4:11 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
>
> On Aug 24, 2010, at 10:03 AM, Tony Garnock-Jones wrote:
>
> Jon Brisbin wrote:
>
> I'm trying to add "webhook" functionality to several applications I'm
>
> writing (basically my own version of PayPal notifications, Google
>
> Checkout callbacks, or GAE tasks), so I thought I'd create a plugin
>
> ("rabbitmq-webhook"?) that consumes messages on an exchange and uses the
>
> lhttpc module to send them to a configurable REST URL.
>
> Sorry if this has already been mentioned, but have you tried RabbitHub? It
> implements PSHB, backed by RabbitMQ, and will both receive messages via HTTP
> POST which it then distributes through Rabbit's exchanges and queues, and
> deliver messages via HTTP POST when the PSHB subscription protocol is used
> (over HTTP) to point RabbitHub at some HTTP server endpoint somewhere else
> on
> the network.
>
> http://github.com/tonyg/rabbithub#readme
>
> Regards,
> ?Tony
>
> Alexis pointed this out to me as I wasn't aware of it. I checked it out of
> Git and have gotten some pretty good ideas from it as what I'm wanting to do
> is fairly similar. :)
> But I'm wanting more configurability, per-message overrides, and less
> emphasis on the PSHB model (I really need full REST support, particularly if
> the webhooks are a CouchDB database or similar).
> I'm thinking I'll likely use a REST API on the front end at some point, but
> I'm more interested in the resulting webhook functionality at the moment.
> I'm actually working on a blog post that discusses my two current use cases
> and explains why I haven't found anything that fits what I'm looking for
> yet.
> I'm *really* digging Erlang, BTW! :) I think it's my new favorite language.
> Python and Ruby who? ;)
> Thanks!
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jon at jbrisbin.com  Tue Aug 24 17:11:16 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 24 Aug 2010 11:11:16 -0500
Subject: [rabbitmq-discuss] clarifying plugin supervision, configuration
Message-ID: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>

I'm looking at some of the existing plugins and I just want to make sure I understand how the plugins are supervised in the broker.

It looks like it starts the application defined in the plugin's .app file, whose start() function should call my plugin's supervisor's start_link() function, correct?

Looking at rabbit_shovel, the plugin loads the configuration in the start_link() function, which I assume is coming from the main rabbit.config file? I don't have to have a separate config file for my plugin, correct?

I'll need to listen on multiple exchanges, so I'm assuming I'll need a gen_server, which starts separate consumers, for each configuration element (akin to what rabbit_shovel is doing by creating a child configuration in the supervisor for each element in the configuration file). How far can I go before I need to worry about resource usage of the "process per consumer" approach? Or should I have a consumer that listens to multiple exchanges (since it'll be doing almost the same thing for every message that comes through)?

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100824/b9ff84f6/attachment.htm>

From matthias at rabbitmq.com  Tue Aug 24 17:18:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 24 Aug 2010 17:18:07 +0100
Subject: [rabbitmq-discuss] problem with new persiter with
	1000	topics/queues
In-Reply-To: <140810.79403.qm@web31813.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>	<4C65FC4E.8070804@rabbitmq.com>
	<4C66AA9F.1000006@rabbitmq.com>	<20100815101257.GA4835@wellquite.org>	<20100816103018.GA16525@rabbitmq.com>	<766990.31259.qm@web31804.mail.mud.yahoo.com>	<597082.60604.qm@web31809.mail.mud.yahoo.com>	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
Message-ID: <4C73F0BF.30605@rabbitmq.com>

Alex,

On 18/08/10 22:06, alex chen wrote:
> i think the big puzzle is:  for both 100 topics and 1000 topics, when there are
> total number of 200 GB messages queued, the number of messages is the same (10M
> for 20 KB message size).  why the 1000 topics case uses much more memory than
> the 100 topic case?

Based on your previous comments I am assuming you have 100/1000 
*queues*, right?

With 1000 queues the memory is more fragmented than with 100 queues and 
a lot more things are going on in parallel. That makes it harder for the 
persister to keep memory usage in check. Particularly if your file 
descriptor limit is also low.

> [with a watermark of 0.2] the memory usage on consuming becomes
> lower, but the throughput also goes down. so far the highest
> throughput we get is by setting mem high watermark to 0.6 (20-30
> MB/sec consume rate). the only problem is the mem would go to 10 GB.
> decreasing the watermark would lower the mem usage, but in the same
> time the throughput would decrease.

Decreasing the watermark will inevitably affect the throughput since 
more frequent and fine-grained paging to/from disk will occur.


Regards,

Matthias.

From jon at jbrisbin.com  Tue Aug 24 20:01:04 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 24 Aug 2010 14:01:04 -0500
Subject: [rabbitmq-discuss] Emacs setup
Message-ID: <5454F173-2B50-4100-8777-A26110C1B992@jbrisbin.com>

Just trying out Emacs for plugin development and wondering how I need to set it up to find the RabbitMQ include directory? I have the erlang mode stuff installed and it's telling me it can't find the "rabbit_common/include/rabbit.hrl" include, which is located here: /Users/jbrisbin/src/rabbitmq-public-umbrella/rabbitmq-server/include

I can't figure out how to set arbitrary compiler options in erlang mode...

I've now tried erlide and Emacs for erlang development and haven't found much better than TextMate with the erlang bundle for syntax highlighting and an open terminal for command-line compilation.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100824/a5492383/attachment.htm>

From Steve.Follett at troppussoftware.com  Tue Aug 24 20:45:15 2010
From: Steve.Follett at troppussoftware.com (Steve Follett)
Date: Tue, 24 Aug 2010 13:45:15 -0600
Subject: [rabbitmq-discuss] RabbitMQ Clustering in Windows Server
Message-ID: <5A3DFF3A6A500040A0862EC7FCF753E317DAB96829@TROPPUSDC.troppus.local>

David,  the question Desrie poses is mine as well.  Those of us that have done Microsoft clustering for some time understand there are a few simple things needed to allow an application to be configured on MS cluster, and most seem to be readily available in RabbitMQ windows version.  We are also looking into the Linux Pacemaker configuration as well but thought we could hit two paths for completeness.



For Microsoft clustering an application it needs to be able to run as a service.

It needs to be able to listen on a unique configured IP address rather than the local host, which seems to be able to be configured in RabbitMQ.

It needs to be able to configure all relevant log files onto the shared storage location, which seems to be able to be configured in RabbitMQ.



With these as a basis do you know of anyone who has tried this kind of configuration rather than the Windows version posted on your site?



Steve



Hi Desrie,



Desrie Qi <desrie.qi at wealthcraft.com<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>> writes:

> We run RabbitMQ as windows service. Does anyone cluster RabbitMQ service in Windows server?

>

> Should we cluster two RabbitMQ nodes following two steps bellow or either one is OK?

>

> Step 1) Join two nodes in a cluster by RabbitMQ command: rabbitmqctl

>       .....

>       .....

>       @rabbit2\\C:\RabbitMQ_server-1.8.1\sbin> rabbitmqctl cluster rabbit at rabbit1<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>

>       Clustering node rabbit at rabbit2<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss> with [rabbit at rabbit1<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>] ...done.

>       ......

>       ......

>

> Step 2) cluster two RabbitMQ service using Windows clustering manager.



I'm not sure what the "Windows clustering manager" you refer to is.  But

the instructions for clustering at

<http://www.rabbitmq.com/clustering.html> should apply on Windows,

including in the case where you run the nodes as Windows services.  Is

there a specific problem you are having when trying to get this working?



David



--

David Wragg

Staff Engineer, RabbitMQ

SpringSource, a division of VMware



Steve Follett
Director Technical Operations | www.Troppussoftware.com<http://www.troppussoftware.com/>
Mobile: (303)803-7812 | steve.follett at troppussoftware.com<mailto:stevefollett at peak8solutions.com>

[cid:image002.jpg at 01CB4392.953C14E0]
________________________________
This email may contain confidential privileged material for the sole use of the intended recipient. Any review or distribution by others is strictly prohibited. If you are not the intended recipient please contact the sender and delete all copies. Your compliance is appreciated.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100824/c576fa28/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 4103 bytes
Desc: image002.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100824/c576fa28/attachment-0001.jpg>

From chen650 at yahoo.com  Tue Aug 24 21:09:49 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 24 Aug 2010 13:09:49 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <4C73F0BF.30605@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
Message-ID: <400676.56539.qm@web31808.mail.mud.yahoo.com>

> Based on your previous  comments I am assuming you have 100/1000 *queues*, 
>right?


right.  we map bind one topic to one queue.
 
> With 1000  queues the memory is more fragmented than with 100 queues and a lot 
>more things  are going on in parallel. That makes it harder for the persister to 
>keep memory  usage in check. Particularly if your file descriptor limit is also  
>low.

So is there a plan to improve the memory usage in the new persister?  if not, we 
have to order new machines with 16 GB RAM instead of the current 8 GB.  If we 
increase the file descriptor limit, would it reduce to memory usage?
i saw the following line in rabbit.log:
"Limiting to approx 16284 file handles (14654 sockets)"
is this too low?

thanks a lot for all the inputs you provide on this problem.  that would help us 
to figure out the system bottleneck and do the hardware planning accordingly.

-alex


      

From matthias at rabbitmq.com  Tue Aug 24 21:32:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 24 Aug 2010 21:32:07 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <400676.56539.qm@web31808.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
	<400676.56539.qm@web31808.mail.mud.yahoo.com>
Message-ID: <4C742C47.6080306@rabbitmq.com>

Alex,

alex chen wrote:
> So is there a plan to improve the memory usage in the new persister?

Over time the new persister will be improved in many ways. And memory 
use is definitely an area we will continue to look at. Quite when that 
will happen is impossible to predict.

> if not, we have to order new machines with 16 GB RAM instead of the
> current 8 GB.

Unless the costs are crippling I'd recommend that anyway.

> If we increase the file descriptor limit, would it reduce to memory usage?

yes, indirectly, by allowing rabbit to work more efficiently.

> i saw the following line in rabbit.log:
> "Limiting to approx 16284 file handles (14654 sockets)"
> is this too low?

That should be plenty.

> thanks a lot for all the inputs you provide on this problem.  that would help us 
> to figure out the system bottleneck and do the hardware planning accordingly.

Your problem reports have helped us iron out some bugs and sub-optimal 
behaviour in the new persister code. Thanks for testing the code in its 
pre-release form.

One thing that would help us identify potential bottlenecks in the 
broker is packaged test cases that demonstrate problematic behaviour. By 
"packaged" I mean test code that has been condensed (i.e. contains no 
extraneous code not related to the problem) and includes precise 
instructions on how to build and run it to reproduce the problematic 
behaviour and a clear description of what that behaviour is.

As you have seen yourself, altering just one little aspect of the test 
setup can produce radically different results. So for us to reproduce a 
problem we must ensure that we are running exactly the same code and 
follow exactly the same steps.

Would it be possible for you to package your tests in that way?


Regards,

Matthias.

From jon at jbrisbin.com  Tue Aug 24 22:47:19 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 24 Aug 2010 16:47:19 -0500
Subject: [rabbitmq-discuss] erlide
Message-ID: <ABDE4ED4-7977-4D80-9F00-EB07272041E5@jbrisbin.com>

Anyone using erlide for rabbitmq development or is Emacs still king? ;)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100824/0d53d513/attachment.htm>

From james.r.carr at gmail.com  Tue Aug 24 22:57:46 2010
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 24 Aug 2010 16:57:46 -0500
Subject: [rabbitmq-discuss] Websocket Support?
Message-ID: <AANLkTinGAgK_MjrUUrdhOEewiRsFAOUiv60CE6Axg3W3@mail.gmail.com>

Hi All,

Is there any plans to support STOMP over websockets?

Thanks,
James

From alexis at rabbitmq.com  Tue Aug 24 23:02:43 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 24 Aug 2010 23:02:43 +0100
Subject: [rabbitmq-discuss] Websocket Support?
In-Reply-To: <AANLkTinGAgK_MjrUUrdhOEewiRsFAOUiv60CE6Axg3W3@mail.gmail.com>
References: <AANLkTinGAgK_MjrUUrdhOEewiRsFAOUiv60CE6Axg3W3@mail.gmail.com>
Message-ID: <AANLkTimP7+UGykAjXC-Jsgq+xdk3ph0_r-8DQLCqkJHs@mail.gmail.com>

James

We support STOMP; can you elaborate on what doing so over websockets
would look like?

alexis


On Tue, Aug 24, 2010 at 10:57 PM, James Carr <james.r.carr at gmail.com> wrote:
> Hi All,
>
> Is there any plans to support STOMP over websockets?
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.r.carr at gmail.com  Tue Aug 24 23:21:33 2010
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 24 Aug 2010 17:21:33 -0500
Subject: [rabbitmq-discuss] Websocket Support?
In-Reply-To: <AANLkTimP7+UGykAjXC-Jsgq+xdk3ph0_r-8DQLCqkJHs@mail.gmail.com>
References: <AANLkTinGAgK_MjrUUrdhOEewiRsFAOUiv60CE6Axg3W3@mail.gmail.com>
	<AANLkTimP7+UGykAjXC-Jsgq+xdk3ph0_r-8DQLCqkJHs@mail.gmail.com>
Message-ID: <AANLkTimqRjA88DmFPc50++CO315-mSwXyNT-C927HmQf@mail.gmail.com>

Basically just using a STOMP client over something like
ws://localhost:61614/stomp

Thanks,
James


On Tue, Aug 24, 2010 at 5:02 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> James
>
> We support STOMP; can you elaborate on what doing so over websockets
> would look like?
>
> alexis
>
>
> On Tue, Aug 24, 2010 at 10:57 PM, James Carr <james.r.carr at gmail.com> wrote:
>> Hi All,
>>
>> Is there any plans to support STOMP over websockets?
>>
>> Thanks,
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From matthew at rabbitmq.com  Tue Aug 24 23:29:34 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 24 Aug 2010 23:29:34 +0100
Subject: [rabbitmq-discuss] erlide
In-Reply-To: <ABDE4ED4-7977-4D80-9F00-EB07272041E5@jbrisbin.com>
References: <ABDE4ED4-7977-4D80-9F00-EB07272041E5@jbrisbin.com>
Message-ID: <20100824222933.GC21667@wellquite.org>

Hi Jon,

On Tue, Aug 24, 2010 at 04:47:19PM -0500, Jon Brisbin wrote:
> Anyone using erlide for rabbitmq development or is Emacs still king? ;)

I'm afraid none of us at Rabbit use erlide. We mainly all use emacs, but
we don't use its in-built compilation features. The makefile is pretty
impressive and given the code generation and dynamic dependency analysis
that goes on, I wouldn't waste your time trying to get emacs to do all
that - I'd just call make from Emacs.

Matthew

From james.r.carr at gmail.com  Tue Aug 24 23:54:23 2010
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 24 Aug 2010 17:54:23 -0500
Subject: [rabbitmq-discuss] Websocket Support?
In-Reply-To: <AANLkTimqRjA88DmFPc50++CO315-mSwXyNT-C927HmQf@mail.gmail.com>
References: <AANLkTinGAgK_MjrUUrdhOEewiRsFAOUiv60CE6Axg3W3@mail.gmail.com>
	<AANLkTimP7+UGykAjXC-Jsgq+xdk3ph0_r-8DQLCqkJHs@mail.gmail.com>
	<AANLkTimqRjA88DmFPc50++CO315-mSwXyNT-C927HmQf@mail.gmail.com>
Message-ID: <AANLkTi=4ZmjcnvThiqAJP8dDdPaC-cTrNrrvTCzfGY4Q@mail.gmail.com>

Just a follow up, the only reason I ask was that I've been using
websockets for a web application lately and was surprised when I saw
this example [1] of using STOMP over websockets. Since RabbitMQ is the
messaging solution I use I'm just wondering if it'll be possible.

Thanks,
James

1. http://jmesnil.net/stomp-websocket/doc/

On Tue, Aug 24, 2010 at 5:21 PM, James Carr <james.r.carr at gmail.com> wrote:
> Basically just using a STOMP client over something like
> ws://localhost:61614/stomp
>
> Thanks,
> James
>
>
> On Tue, Aug 24, 2010 at 5:02 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> James
>>
>> We support STOMP; can you elaborate on what doing so over websockets
>> would look like?
>>
>> alexis
>>
>>
>> On Tue, Aug 24, 2010 at 10:57 PM, James Carr <james.r.carr at gmail.com> wrote:
>>> Hi All,
>>>
>>> Is there any plans to support STOMP over websockets?
>>>
>>> Thanks,
>>> James
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>

From chen650 at yahoo.com  Wed Aug 25 04:30:15 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 24 Aug 2010 20:30:15 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <4C742C47.6080306@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
	<400676.56539.qm@web31808.mail.mud.yahoo.com>
	<4C742C47.6080306@rabbitmq.com>
Message-ID: <685259.73254.qm@web31807.mail.mud.yahoo.com>

 > Would it be possible for you to package  your tests in that way?


yes.  our current test is simply a shell script that starts 1000 amqp_consumers 
from the rabbitmq-c examples.
it seems to me rabbitma-java-client has some packaged tests.  i will try using 
java client to write one.

-alex


      

From matthias at rabbitmq.com  Wed Aug 25 04:35:26 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 Aug 2010 04:35:26 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <685259.73254.qm@web31807.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
	<400676.56539.qm@web31808.mail.mud.yahoo.com>
	<4C742C47.6080306@rabbitmq.com>
	<685259.73254.qm@web31807.mail.mud.yahoo.com>
Message-ID: <4C748F7E.7020805@rabbitmq.com>

Alex,

alex chen wrote:
>  > Would it be possible for you to package  your tests in that way?
> 
> yes.  our current test is simply a shell script that starts 1000 amqp_consumers 
> from the rabbitmq-c examples.
> it seems to me rabbitma-java-client has some packaged tests.  i will try using 
> java client to write one.

Using the C client is fine. What's missing from what you sent us so far is:
- the producer code
- how exactly you are invoking the producer and consumer ("1000 
amqp_consumers" - but with what args?, etc)
- what exactly it is you are looking at / measuring - e.g. you mentioned 
something about 200GB of message data, how is that figure calculated?

Regards,

Matthias.

From chen650 at yahoo.com  Wed Aug 25 05:37:06 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 24 Aug 2010 21:37:06 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <4C748F7E.7020805@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
	<400676.56539.qm@web31808.mail.mud.yahoo.com>
	<4C742C47.6080306@rabbitmq.com>
	<685259.73254.qm@web31807.mail.mud.yahoo.com>
	<4C748F7E.7020805@rabbitmq.com>
Message-ID: <111467.41327.qm@web31811.mail.mud.yahoo.com>

> Using  the C client is fine. What's missing from what you sent us so far is:

> - the  producer code

this could be the amqp_producer.c in rabbitmq-c/examples.  simply modify the 
code to accept the topic name and message size from command line.

> - how exactly you are invoking the producer and consumer ("1000  
>amqp_consumers" - but with what args?, etc)

i use 3 bash shell scripts (bind.sh, producer.sh, consumer.sh):

# bind.sh
for i in {1..1000}
do
   topic=t.$i
   queue=$topic_q
   amqp_bind $topic $queue  &
done

# producer.sh
for i in {1..1000}
do
   topic=t.$i
   let message_size=20*1024   # 20KB 
   amqp_producer $topic $message_size  &
done

# consumer.sh, bind 1000 topics to 1000 queues
for i in {1..1000}
do
   topic=t.$i
   queue=$topic_q
   amqp_consumer $topic $queue  &
done

the test steps are:
1) run bind.sh
2) run producer.sh
3) run the following command the monitor the total size of messages stored:
$ watch --interval 5 "du -hs $rabbitmq_server_dir/rabbit/$message_store_dir"

4) after the output from 3) reaches 200 GB, stop the producers by running:
$ pkill amqp_producer

5) run consumer.sh

after step 5), running "top" command will show the beam process would use about 
10 GB of memory.

> - what exactly it is you are  looking at / measuring - e.g. you mentioned 
>something about 200GB of message  data, how is that figure calculated?

see the step 3) above.  another way is using "rabbitmqctl list_queues" to get 
the total message counts.  however, i found rabbitmqctl always return errors 
when the broker is busy (e.g. during step 5), so using "du -hs" is a good 
alternative.

our recent test shows that if you run producer.sh and consumer.sh at the same 
time (without 200 GB messages backed up), the broker process would also use 
large amount of mem (around 6 GB).  this way you can reproduce the high mem 
usage problem without waiting long time for the 200 GB messages backed up.

please feel free to let me know if you need further info.
thanks.

-alex



      

From matthias at rabbitmq.com  Wed Aug 25 06:05:04 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 Aug 2010 06:05:04 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <111467.41327.qm@web31811.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
	<400676.56539.qm@web31808.mail.mud.yahoo.com>
	<4C742C47.6080306@rabbitmq.com>
	<685259.73254.qm@web31807.mail.mud.yahoo.com>
	<4C748F7E.7020805@rabbitmq.com>
	<111467.41327.qm@web31811.mail.mud.yahoo.com>
Message-ID: <4C74A480.3080600@rabbitmq.com>

Alex,

alex chen wrote:
> this could be the amqp_producer.c in rabbitmq-c/examples.  simply modify the 
> code to accept the topic name and message size from command line.

Please send us the modified code.

>> - how exactly you are invoking the producer and consumer ("1000  
>> amqp_consumers" - but with what args?, etc)
> 
> i use 3 bash shell scripts (bind.sh, producer.sh, consumer.sh):
> [...]

Thanks.

> the test steps are:
> 1) run bind.sh
> 2) run producer.sh

There must be a step 0) missing here. amqp_bind does not create any 
queues and will fail if the referenced queues do not exist. So how are 
the queues created? Please send us the code/scripts for that.

Also, are all the above running on the same machine as the broker?

> our recent test shows that if you run producer.sh and consumer.sh at the same 
> time (without 200 GB messages backed up), the broker process would also use 
> large amount of mem (around 6 GB).  this way you can reproduce the high mem 
> usage problem without waiting long time for the 200 GB messages backed up.

ok. That's useful to know.

Btw, what revision of the server are you running? 'hg id' will tell you.


Regards,

Matthias.

From emile at rabbitmq.com  Wed Aug 25 10:01:14 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Aug 2010 10:01:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ Clustering in Windows Server
In-Reply-To: <5A3DFF3A6A500040A0862EC7FCF753E317DAB96829@TROPPUSDC.troppus.local>
References: <5A3DFF3A6A500040A0862EC7FCF753E317DAB96829@TROPPUSDC.troppus.local>
Message-ID: <4C74DBDA.8030300@rabbitmq.com>


Hi Steve,

There may have been some confusion between rabbit clustering and
Microsoft Cluster Service - they are completely different. Rabbit
clustering is based on the Erlang distributed database and is fully
supported and widely used on Windows.

MSCS can be used to set up high availability services, while rabbit
clustering is used to achieve scalability. It should be possible to set
up MSCS in single quorum mode using shared storage to get HA in the same
way as Pacemaker, but I'm not aware of anyone trying this. We would be
interested to hear about your experience if you try this or succeed.

Regards

Emile




On 24/08/10 20:45, Steve Follett wrote:
> David,  the question Desrie poses is mine as well.  Those of us that have done Microsoft clustering for some time understand there are a few simple things needed to allow an application to be configured on MS cluster, and most seem to be readily available in RabbitMQ windows version.  We are also looking into the Linux Pacemaker configuration as well but thought we could hit two paths for completeness.
>
>
> For Microsoft clustering an application it needs to be able to run as a service.
> It needs to be able to listen on a unique configured IP address rather than the local host, which seems to be able to be configured in RabbitMQ.
> It needs to be able to configure all relevant log files onto the shared storage location, which seems to be able to be configured in RabbitMQ.
>
> With these as a basis do you know of anyone who has tried this kind of configuration rather than the Windows version posted on your site?
>
>
> Steve
>
> Hi Desrie,
>
>
> Desrie Qi <desrie.qi at wealthcraft.com<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>> writes:
>
>   
>> We run RabbitMQ as windows service. Does anyone cluster RabbitMQ service in Windows server?
>>     
>> Should we cluster two RabbitMQ nodes following two steps bellow or either one is OK?
>>     
>> Step 1) Join two nodes in a cluster by RabbitMQ command: rabbitmqctl
>>     
>>       @rabbit2\\C:\RabbitMQ_server-1.8.1\sbin> rabbitmqctl cluster rabbit at rabbit1<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>     
>>       Clustering node rabbit at rabbit2<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss> with [rabbit at rabbit1<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>] ...done.
>> Step 2) cluster two RabbitMQ service using Windows clustering manager.
>>     
> I'm not sure what the "Windows clustering manager" you refer to is.  But
> the instructions for clustering at
> <http://www.rabbitmq.com/clustering.html> should apply on Windows,
> including in the case where you run the nodes as Windows services.  Is
> there a specific problem you are having when trying to get this working?
>
>
> David
>
>
> --
>
> David Wragg
>
> Staff Engineer, RabbitMQ
>
> SpringSource, a division of VMware
>
>
>
> Steve Follett
> Director Technical Operations | www.Troppussoftware.com<http://www.troppussoftware.com/>
> Mobile: (303)803-7812 | steve.follett at troppussoftware.com<mailto:stevefollett at peak8solutions.com>


From vlad at rabbitmq.com  Wed Aug 25 10:13:58 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 25 Aug 2010 10:13:58 +0100
Subject: [rabbitmq-discuss] erlide
In-Reply-To: <ABDE4ED4-7977-4D80-9F00-EB07272041E5@jbrisbin.com>
References: <ABDE4ED4-7977-4D80-9F00-EB07272041E5@jbrisbin.com>
Message-ID: <4C74DED6.4080303@rabbitmq.com>


FWIW, Erlide is broken with the latest version of Eclipse. The developer 
promised to fix that soon, but it's been more than a month since then.

I've found Netbeans's Erlybird to do a reasonable job (just as an 
editor). But the latest version of the plugin doesn't work with the 
latest version of Netbeans. I think I'm using version 0.17.0.

I'm the only one in the office not using Emacs :) .

Vlad.



On 08/24/2010 10:47 PM, Jon Brisbin wrote:
> Anyone using erlide for rabbitmq development or is Emacs still king? ;)
>
> Thanks!
>
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/11a077fe/attachment-0001.htm>

From david at rabbitmq.com  Wed Aug 25 10:58:56 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 25 Aug 2010 10:58:56 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <4C74A480.3080600@rabbitmq.com> (Matthias Radestock's message of
	"Wed, 25 Aug 2010 06:05:04 +0100")
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
	<400676.56539.qm@web31808.mail.mud.yahoo.com>
	<4C742C47.6080306@rabbitmq.com>
	<685259.73254.qm@web31807.mail.mud.yahoo.com>
	<4C748F7E.7020805@rabbitmq.com>
	<111467.41327.qm@web31811.mail.mud.yahoo.com>
	<4C74A480.3080600@rabbitmq.com>
Message-ID: <yrv4cd3t757z3.fsf@dwragg.eng.vmware.com>

Matthias Radestock <matthias at rabbitmq.com> writes:
> alex chen wrote:
>> this could be the amqp_producer.c in rabbitmq-c/examples.  simply
>> modify the code to accept the topic name and message size from
>> command line.
>
> Please send us the modified code.

Alex: The amqp-publish program in the tools directory should be able to
accomplish the same thing without code changes.

Do something like:

dd if=/dev/zero of=/tmp/test-data count=1 bs=LENGTH
ampq-publish -e EXCHANGE -r TOPIC </tmp/test-data

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From mikeb at rabbitmq.com  Wed Aug 25 11:01:49 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 25 Aug 2010 11:01:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.0.0 release
Message-ID: <4C74EA0D.8000608@rabbitmq.com>

We the RabbitMQ team are delighted to announce the release of RabbitMQ
2.0.0.

This release includes a rewritten message store that pages messages to
disk to relieve memory pressure, and support for AMQP 0-9-1.  There are
many other more modest additions, such as an implementation of
basic.reject, and queue leases.  For details see the attached release notes.

Binary and source distributions of the new release can be found in the
usual place at http://www.rabbitmq.com/download.html

This now includes binary packages of plugins, at
http://www.rabbitmq.com/plugins.html.  Please note the caveats there.

Due to an issue we're currently seeing with the nexus/sonatype
maven repository, the 2.0.0 release is not yet available in maven. We
will rectify this as soon as we can.

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.


Regards,

The RabbitMQ Team


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.0.0.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/a4ed718d/attachment.txt>

From jon at jbrisbin.com  Wed Aug 25 13:12:28 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 25 Aug 2010 07:12:28 -0500
Subject: [rabbitmq-discuss] erlide
In-Reply-To: <4C74DED6.4080303@rabbitmq.com>
References: <ABDE4ED4-7977-4D80-9F00-EB07272041E5@jbrisbin.com>
	<4C74DED6.4080303@rabbitmq.com>
Message-ID: <9B57CA43-201B-4FC8-B91E-A7F12CEB6EC8@jbrisbin.com>

I looked at ErlyBird, but the latest NetBeans it supports is 6.7 and the last download was updated last year. erlide has a few nice features but doesn't really work for a real project, so I gave that up. I always have the latest Aquamacs Emacs on my machine for nostalgia, if for no other reason (it was my first programming environment :), so I used the erlang mode. I don't like the way it does formatting and speedbar is less than impressive as a project browser, so I feel the most at home in TextMate with a checkout of the Erlang.tmbundle from the textmate svn repo, which has a few template helpers in it and other niceties.

I liked the continuous building of code with erlide and netbeans. It's actually quite helpful. But there's just too many other environmental things they seem to ignore that make building an actual project (a nitrogen-based webapp or a rabbit plugin, for example...I prefer not to have -include_lib's showing red all the time) difficult or impossible.

Realistically, having to build from the command line after changes doesn't really slow you down all that much. I guess the flexibility compensates for that.

jb

On Aug 25, 2010, at 4:13 AM, Vlad Alexandru Ionescu wrote:

> 
> FWIW, Erlide is broken with the latest version of Eclipse. The developer promised to fix that soon, but it's been more than a month since then.
> 
> I've found Netbeans's Erlybird to do a reasonable job (just as an editor). But the latest version of the plugin doesn't work with the latest version of Netbeans. I think I'm using version 0.17.0.
> 
> I'm the only one in the office not using Emacs :) .
> 
> Vlad.
> 
> 
> 
> On 08/24/2010 10:47 PM, Jon Brisbin wrote:
>> 
>> Anyone using erlide for rabbitmq development or is Emacs still king? ;)
>> 
>> Thanks!
>> 
>> J. Brisbin
>> http://jbrisbin.com/
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>   


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/ce1005fc/attachment.htm>

From jon at jbrisbin.com  Wed Aug 25 13:27:08 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 25 Aug 2010 07:27:08 -0500
Subject: [rabbitmq-discuss] pluggable message transformers
Message-ID: <C09D9B3F-F320-4A83-B387-3B8C3D0EBA17@jbrisbin.com>

Hopefully I'll be getting back into my webhooks plugin today. One of the things I'll probably need to implement inside the plugin is a transformer of some sort that could turn an AMQP message into an HTTP request body. It will need to be pluggable, so I can add other kinds later, but for sure I'll want to be able to turn a binary message into a www-form-urlencoded. The JSON data I think I can handle with content-types, etc...

Does anyone have an existing message transformer in Erlang I can look at? I guess I'm needing examples of ways to go about piping messages from one place to another and applying encoding or encrypting or somesuch...

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/73e1bac5/attachment.htm>

From rgh at topikality.com  Wed Aug 25 13:38:12 2010
From: rgh at topikality.com (Richard Heycock)
Date: Wed, 25 Aug 2010 22:38:12 +1000
Subject: [rabbitmq-discuss] RabbitMQ 2.0.0 release
In-Reply-To: <4C74EA0D.8000608@rabbitmq.com>
References: <4C74EA0D.8000608@rabbitmq.com>
Message-ID: <1282739852-sup-4738@roughage.com.au>

Excerpts from Michael Bridgen's message of 2010-08-25 20:01:49 +1000:
> We the RabbitMQ team are delighted to announce the release of RabbitMQ
> 2.0.0.
> 
> This release includes a rewritten message store that pages messages to
> disk to relieve memory pressure, and support for AMQP 0-9-1.  There are
> many other more modest additions, such as an implementation of
> basic.reject, and queue leases.  For details see the attached release notes.
> 
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
> 
> This now includes binary packages of plugins, at
> http://www.rabbitmq.com/plugins.html.  Please note the caveats there.
> 
> Due to an issue we're currently seeing with the nexus/sonatype
> maven repository, the 2.0.0 release is not yet available in maven. We
> will rectify this as soon as we can.
> 
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
> 
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.

This is so cool guys. A massive thank you for all your hard work.

rgh

> Regards,
> 
> The RabbitMQ Team
> Release: RabbitMQ 2.0.0
> 
> Release Highlights
> ==================
> 
> server
> ------
> bug fixes
> - correct file descriptor limits on Windows, preventing crashes due to
>   exceeding the limit
> - fix bug that resulted in 'rabbitmqctl status' reporting disk nodes
>   as ram nodes
> - tx.commit no longer fails when participating queues are deleted
>   during the lifetime of the transaction
> - more robust logic to detect changes in the data layout between
>   rabbit versions and thus guard against upgrade failures
> 
> enhancements
> - new persister
>   - the volume of messages rabbit can hold on to is bounded by disk
>     space (in previous versions it was bounded by memory)
>   - rabbit optimises memory usage by paging messages out to / in from
>     disk as needed
>   - consistently high performance regardless of retained message
>     volume (previous versions would slow down considerably as the
>     persisted message volume grew)
>   - consistently fast startup regardless of volume of persisted data
>     (previous versions would require time proportional to the amount
>     of data)
>   - better performance for concurrent transactions (in previous
>     version the rate at which queues could handle transactions
>     involving persistent messages was fixed)
> - implement AMQP 0-9-1, in addition to 0-8 - see
>   http://www.rabbitmq.com/specification.html
> - instrumentation for asynchronous statistics events, emitting more
>   stats than currently available and laying the foundation for
>   monitoring a busy broker without crippling performance -
>   see http://www.rabbitmq.com/blog/2010/08/06/management-monitoring-and-statistics/
> - more effective flow control mechanism that does not require
>   cooperation from clients and reacts quickly to prevent the broker
>   from exhausing memory - see http://www.rabbitmq.com/extensions.html#memsup
> - implement basic.reject - see
> http://www.rabbitmq.com/blog/2010/08/03/well-ill-let-you-go-basicreject-in-rabbitmq/
> - simplify plugin activation by moving it into the server startup
> - permit upgrades of Erlang w/o breaking rabbit servers with activated
>   plugins
> - introduce support for queue leases - see http://www.rabbitmq.com/extensions.html#queue-leases
> - improve the setting of permissions, making it easer to use and
>   introducing a way to grant no permissions at all - see http://www.rabbitmq.com/admin-guide.html#management
> - delete exclusive queues synchronously on server-initiated connection
>   close (rather than just client-initiated)
> 
> java client
> -----------
> bug fixes
> - prevent spurious timeout exceptions that theoretically could have
>   arisen due to spurios thread wake-ups
> 
> enhancements
> - switch to AMQP 0-9-1 - see
>   http://www.rabbitmq.com/specification.html
> 
> .net client
> -----------
> bug fixes
> - fix bug that caused incorrect responses to server-issued
>   channel.flow commands, which in turn resulted in connections getting
>   closed with an error.
> - make SSL connections work in Mono
> 
> enhancements
> - implement AMQP 0-9-1, in addition to 0-8 and 0-9 - see
>   http://www.rabbitmq.com/specification.html
> - simplify the Subscription class and make it more versatile
> - improve documentation
> 
> building & packaging
> --------------------
> bug fixes
> - correct location of rabbitmq.config file under macports - it now
>   lives in /opt/local/etc/rabbitmq/
> - "make docs_all" now works on more platforms
> 
> enhancements
> - portable, binary plugin releases to simplify plugin installation -
>   see http://www.rabbitmq.com/plugins.html
> - automatically create plugin directory, to streamline plugin
>   installation
> 
> Upgrading
> =========
> The database schema and the format in which persistent messages are
> stored have both changed since the last release (1.8.1). When
> starting, the RabbitMQ server will detect the existence of an old
> database and will move it to a backup location, before creating a
> fresh, empty database, and will log a warning. If your RabbitMQ
> installation contains important data then we recommend you contact
> support at rabbitmq.com for assistance with the upgrade.
-- 
Richard Heycock

http://topikality.com

+61 (0) 410 646 369
[e]:  rgh at topikality.com
[im]: rgh at topikality.com

From cal.leeming at simplicitymedialtd.co.uk  Wed Aug 25 13:42:55 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Wed, 25 Aug 2010 13:42:55 +0100
Subject: [rabbitmq-discuss] Fwd:  RabbitMQ 2.0.0 release
In-Reply-To: <AANLkTi=QUe6i_jv+h392HR4mt=FUWaPUw6NydCon1bJT@mail.gmail.com>
References: <4C74EA0D.8000608@rabbitmq.com>
	<AANLkTi=QUe6i_jv+h392HR4mt=FUWaPUw6NydCon1bJT@mail.gmail.com>
Message-ID: <AANLkTikS0KGLAT=5zFGR72HqSFB+sufQCZRTjkUChrGV@mail.gmail.com>

Great work guys! I'll look forward to trying out the latest version :)

Cal

On Wed, Aug 25, 2010 at 11:01 AM, Michael Bridgen <mikeb at rabbitmq.com>wrote:

> We the RabbitMQ team are delighted to announce the release of RabbitMQ
> 2.0.0.
>
> This release includes a rewritten message store that pages messages to
> disk to relieve memory pressure, and support for AMQP 0-9-1.  There are
> many other more modest additions, such as an implementation of
> basic.reject, and queue leases.  For details see the attached release
> notes.
>
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
>
> This now includes binary packages of plugins, at
> http://www.rabbitmq.com/plugins.html.  Please note the caveats there.
>
> Due to an issue we're currently seeing with the nexus/sonatype
> maven repository, the 2.0.0 release is not yet available in maven. We
> will rectify this as soon as we can.
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
>
>
> Regards,
>
> The RabbitMQ Team
>
>
>
> Release: RabbitMQ 2.0.0
>
> Release Highlights
> ==================
>
> server
> ------
> bug fixes
> - correct file descriptor limits on Windows, preventing crashes due to
>  exceeding the limit
> - fix bug that resulted in 'rabbitmqctl status' reporting disk nodes
>  as ram nodes
> - tx.commit no longer fails when participating queues are deleted
>  during the lifetime of the transaction
> - more robust logic to detect changes in the data layout between
>  rabbit versions and thus guard against upgrade failures
>
> enhancements
> - new persister
>  - the volume of messages rabbit can hold on to is bounded by disk
>    space (in previous versions it was bounded by memory)
>  - rabbit optimises memory usage by paging messages out to / in from
>    disk as needed
>  - consistently high performance regardless of retained message
>    volume (previous versions would slow down considerably as the
>    persisted message volume grew)
>  - consistently fast startup regardless of volume of persisted data
>    (previous versions would require time proportional to the amount
>    of data)
>  - better performance for concurrent transactions (in previous
>    version the rate at which queues could handle transactions
>    involving persistent messages was fixed)
> - implement AMQP 0-9-1, in addition to 0-8 - see
>  http://www.rabbitmq.com/specification.html
> - instrumentation for asynchronous statistics events, emitting more
>  stats than currently available and laying the foundation for
>  monitoring a busy broker without crippling performance -
>  see
> http://www.rabbitmq.com/blog/2010/08/06/management-monitoring-and-statistics/
> - more effective flow control mechanism that does not require
>  cooperation from clients and reacts quickly to prevent the broker
>  from exhausing memory - see
> http://www.rabbitmq.com/extensions.html#memsup
> - implement basic.reject - see
>
> http://www.rabbitmq.com/blog/2010/08/03/well-ill-let-you-go-basicreject-in-rabbitmq/
> - simplify plugin activation by moving it into the server startup
> - permit upgrades of Erlang w/o breaking rabbit servers with activated
>  plugins
> - introduce support for queue leases - see
> http://www.rabbitmq.com/extensions.html#queue-leases
> - improve the setting of permissions, making it easer to use and
>  introducing a way to grant no permissions at all - see
> http://www.rabbitmq.com/admin-guide.html#management
> - delete exclusive queues synchronously on server-initiated connection
>  close (rather than just client-initiated)
>
> java client
> -----------
> bug fixes
> - prevent spurious timeout exceptions that theoretically could have
>  arisen due to spurios thread wake-ups
>
> enhancements
> - switch to AMQP 0-9-1 - see
>  http://www.rabbitmq.com/specification.html
>
> .net client
> -----------
> bug fixes
> - fix bug that caused incorrect responses to server-issued
>  channel.flow commands, which in turn resulted in connections getting
>  closed with an error.
> - make SSL connections work in Mono
>
> enhancements
> - implement AMQP 0-9-1, in addition to 0-8 and 0-9 - see
>  http://www.rabbitmq.com/specification.html
> - simplify the Subscription class and make it more versatile
> - improve documentation
>
> building & packaging
> --------------------
> bug fixes
> - correct location of rabbitmq.config file under macports - it now
>  lives in /opt/local/etc/rabbitmq/
> - "make docs_all" now works on more platforms
>
> enhancements
> - portable, binary plugin releases to simplify plugin installation -
>  see http://www.rabbitmq.com/plugins.html
> - automatically create plugin directory, to streamline plugin
>  installation
>
> Upgrading
> =========
> The database schema and the format in which persistent messages are
> stored have both changed since the last release (1.8.1). When
> starting, the RabbitMQ server will detect the existence of an old
> database and will move it to a backup location, before creating a
> fresh, empty database, and will log a warning. If your RabbitMQ
> installation contains important data then we recommend you contact
> support at rabbitmq.com for assistance with the upgrade.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564




-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/dca7c990/attachment-0001.htm>

From davegreggory at yahoo.com  Wed Aug 25 13:44:56 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 25 Aug 2010 08:44:56 -0400
Subject: [rabbitmq-discuss] RabbitMQ 2.0.0 release
In-Reply-To: <4C74EA0D.8000608@rabbitmq.com>
References: <4C74EA0D.8000608@rabbitmq.com>
Message-ID: <515F3393-27AB-4358-A65A-5D6BBBF1B4D3@yahoo.com>

Congrats, all. I look forward to testing this out. 

On Aug 25, 2010, at 6:01 AM, Michael Bridgen <mikeb at rabbitmq.com> wrote:

> We the RabbitMQ team are delighted to announce the release of RabbitMQ
> 2.0.0.
> 
> This release includes a rewritten message store that pages messages to
> disk to relieve memory pressure, and support for AMQP 0-9-1.  There are
> many other more modest additions, such as an implementation of
> basic.reject, and queue leases.  For details see the attached release notes.
> 
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
> 
> This now includes binary packages of plugins, at
> http://www.rabbitmq.com/plugins.html. Please note the caveats there.
> 
> Due to an issue we're currently seeing with the nexus/sonatype
> maven repository, the 2.0.0 release is not yet available in maven. We
> will rectify this as soon as we can.
> 
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
> 
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
> 
> 
> Regards,
> 
> The RabbitMQ Team
> 
> 
> Release: RabbitMQ 2.0.0
> 
> Release Highlights
> ==================
> 
> server
> ------
> bug fixes
> - correct file descriptor limits on Windows, preventing crashes due to
>  exceeding the limit
> - fix bug that resulted in 'rabbitmqctl status' reporting disk nodes
>  as ram nodes
> - tx.commit no longer fails when participating queues are deleted
>  during the lifetime of the transaction
> - more robust logic to detect changes in the data layout between
>  rabbit versions and thus guard against upgrade failures
> 
> enhancements
> - new persister
>  - the volume of messages rabbit can hold on to is bounded by disk
>    space (in previous versions it was bounded by memory)
>  - rabbit optimises memory usage by paging messages out to / in from
>    disk as needed
>  - consistently high performance regardless of retained message
>    volume (previous versions would slow down considerably as the
>    persisted message volume grew)
>  - consistently fast startup regardless of volume of persisted data
>    (previous versions would require time proportional to the amount
>    of data)
>  - better performance for concurrent transactions (in previous
>    version the rate at which queues could handle transactions
>    involving persistent messages was fixed)
> - implement AMQP 0-9-1, in addition to 0-8 - see
>  http://www.rabbitmq.com/specification.html
> - instrumentation for asynchronous statistics events, emitting more
>  stats than currently available and laying the foundation for
>  monitoring a busy broker without crippling performance -
>  see http://www.rabbitmq.com/blog/2010/08/06/management-monitoring-and-statistics/
> - more effective flow control mechanism that does not require
>  cooperation from clients and reacts quickly to prevent the broker
>  from exhausing memory - see http://www.rabbitmq.com/extensions.html#memsup
> - implement basic.reject - see
> http://www.rabbitmq.com/blog/2010/08/03/well-ill-let-you-go-basicreject-in-rabbitmq/
> - simplify plugin activation by moving it into the server startup
> - permit upgrades of Erlang w/o breaking rabbit servers with activated
>  plugins
> - introduce support for queue leases - see http://www.rabbitmq.com/extensions.html#queue-leases
> - improve the setting of permissions, making it easer to use and
>  introducing a way to grant no permissions at all - see http://www.rabbitmq.com/admin-guide.html#management
> - delete exclusive queues synchronously on server-initiated connection
>  close (rather than just client-initiated)
> 
> java client
> -----------
> bug fixes
> - prevent spurious timeout exceptions that theoretically could have
>  arisen due to spurios thread wake-ups
> 
> enhancements
> - switch to AMQP 0-9-1 - see
>  http://www.rabbitmq.com/specification.html
> 
> .net client
> -----------
> bug fixes
> - fix bug that caused incorrect responses to server-issued
>  channel.flow commands, which in turn resulted in connections getting
>  closed with an error.
> - make SSL connections work in Mono
> 
> enhancements
> - implement AMQP 0-9-1, in addition to 0-8 and 0-9 - see
>  http://www.rabbitmq.com/specification.html
> - simplify the Subscription class and make it more versatile
> - improve documentation
> 
> building & packaging
> --------------------
> bug fixes
> - correct location of rabbitmq.config file under macports - it now
>  lives in /opt/local/etc/rabbitmq/
> - "make docs_all" now works on more platforms
> 
> enhancements
> - portable, binary plugin releases to simplify plugin installation -
>  see http://www.rabbitmq.com/plugins.html
> - automatically create plugin directory, to streamline plugin
>  installation
> 
> Upgrading
> =========
> The database schema and the format in which persistent messages are
> stored have both changed since the last release (1.8.1). When
> starting, the RabbitMQ server will detect the existence of an old
> database and will move it to a backup location, before creating a
> fresh, empty database, and will log a warning. If your RabbitMQ
> installation contains important data then we recommend you contact
> support at rabbitmq.com for assistance with the upgrade.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Wed Aug 25 15:49:41 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 25 Aug 2010 15:49:41 +0100
Subject: [rabbitmq-discuss] Query for asynchronous acknowledgment
In-Reply-To: <AANLkTikb5VJNG=5B3tmHc3UapiZqHdnP4BQG_6StjSe9@mail.gmail.com>
References: <AANLkTinrmJfsNatV9FVHZSMzT=H=1V+xnzxp=X7ZJeF=@mail.gmail.com>
	<20100816125939.GC16525@rabbitmq.com>
	<AANLkTikb5VJNG=5B3tmHc3UapiZqHdnP4BQG_6StjSe9@mail.gmail.com>
Message-ID: <20100825144940.GE12799@rabbitmq.com>

On Mon, Aug 16, 2010 at 06:40:31PM +0530, vivek agarwal wrote:
> So, is there anyways to achieve asynchronous acknowledgment of data?

Well, acknowledgements are by their definition async - they are sent by
the client when the client feels like it and do not evoke any response
by the broker.

Why could you not have the machine which is actually processing the
message and doing the work also be responsible for consuming and
acknowleding the work? You can have many consumers off the same queue.
Would this work for you?

> Again, I also wanted to know if there is a way to replicate data, to
> increase the system's availability.

Purely in terms of messages, no there is no way currently in Rabbit to
achieve this automatically. You could publish the messages to several
different Rabbits and then handle deduplification on the client side,
but that is significantly more work.

You could also publish messages in "persistent" mode (delivery_mode = 2)
so that they get written to disk and then use some sort of distributed
storage system (eg DRBD, ENBD etc, or some sort of NAS/SAN) to achieve
redundancy.

> So that, if a node1 running RabbitMQ goes down, a slave comes up and works
> like a master, so that all the queues and data on node1, are still
> accessible?

What you're describing there is what we call active/passive HA, which is
well documented and explained at http://www.rabbitmq.com/pacemaker.html

Matthew

From elij.mx at gmail.com  Wed Aug 25 19:55:44 2010
From: elij.mx at gmail.com (elij)
Date: Wed, 25 Aug 2010 11:55:44 -0700
Subject: [rabbitmq-discuss] sasl_error_logger tty problem on 2.0.0?
Message-ID: <AANLkTikuV8A_WsOMHUCh4cPR8V=FPsu2kqZG6oJyyxGO@mail.gmail.com>

I am testing out rabbitmq-2.0.0, and ran into an odd issue.
We use rabbitmq and pipe our logs to syslog (with daemontools and a
logger) from stdout.
Because of this, we edit the rabbitmq-server script, and remove the
"-sasl sasl_error_logger" line, which should then default to tty (it
does on rabbitmq-1.8.x).

However, I am getting this error:

#######
Activating RabbitMQ plugins ...
0 plugins activated:

{"init terminating in
do_boot",{{nocatch,{error,{cannot_log_to_tty,sasl_report_tty_h,not_installed}}},[{rabbit,ensure_working_log_handler,5},{rabbit,ensure_working_log_handlers,0},{rabbit,prepare,0},{init,eval_script,8},{init,do_boot,3}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

#######


If I instead specify "-sasl sasl_error_logger false", and thus disable
sasl logging, it starts up and runs fine.
I tried '-sasl sasl_error_logger tty', and experience the identical
crash as above.

Is there a way to get tty output again for sasl error logging?

Thanks.

From matthew at rabbitmq.com  Wed Aug 25 20:12:13 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 25 Aug 2010 20:12:13 +0100
Subject: [rabbitmq-discuss] sasl_error_logger tty problem on 2.0.0?
In-Reply-To: <AANLkTikuV8A_WsOMHUCh4cPR8V=FPsu2kqZG6oJyyxGO@mail.gmail.com>
References: <AANLkTikuV8A_WsOMHUCh4cPR8V=FPsu2kqZG6oJyyxGO@mail.gmail.com>
Message-ID: <20100825191212.GD8173@wellquite.org>

On Wed, Aug 25, 2010 at 11:55:44AM -0700, elij wrote:
> I tried '-sasl sasl_error_logger tty', and experience the identical
> crash as above.

Confirmed. I get exactly the same. Well, we made it almost 8 hours
before a bug was found. Awesome.

> Is there a way to get tty output again for sasl error logging?

I believe that you can change the logging dynamically after sasl has
started. However, I can't for the life of me remember how to do it
though I think I've seen Vlad in the office doing this.

Matthew

From alexis at rabbitmq.com  Wed Aug 25 21:06:40 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 25 Aug 2010 21:06:40 +0100
Subject: [rabbitmq-discuss] pluggable message transformers
In-Reply-To: <C09D9B3F-F320-4A83-B387-3B8C3D0EBA17@jbrisbin.com>
References: <C09D9B3F-F320-4A83-B387-3B8C3D0EBA17@jbrisbin.com>
Message-ID: <AANLkTiki1W9sQBpg2fmze5H+SXHBYCoNwuGtzBjWOUNo@mail.gmail.com>

Jon

Did you see Tony's presentation at the Erlang Factory in March 2010?

alexis


On Wed, Aug 25, 2010 at 1:27 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
> Hopefully I'll be getting back into my webhooks plugin today. One of the
> things I'll probably need to implement inside the plugin is a transformer of
> some sort that could turn an AMQP message into an HTTP request body. It will
> need to be pluggable, so I can add other kinds later, but for sure I'll want
> to be able to turn a binary message into a www-form-urlencoded. The JSON
> data I think I can handle with content-types, etc...
> Does anyone have an existing message transformer in Erlang I can look at? I
> guess I'm needing examples of ways to go about piping messages from one
> place to another and applying encoding or encrypting or somesuch...
>
> Thanks!
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From chen650 at yahoo.com  Wed Aug 25 21:08:43 2010
From: chen650 at yahoo.com (alex chen)
Date: Wed, 25 Aug 2010 13:08:43 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <4C74A480.3080600@rabbitmq.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
	<400676.56539.qm@web31808.mail.mud.yahoo.com>
	<4C742C47.6080306@rabbitmq.com>
	<685259.73254.qm@web31807.mail.mud.yahoo.com>
	<4C748F7E.7020805@rabbitmq.com>
	<111467.41327.qm@web31811.mail.mud.yahoo.com>
	<4C74A480.3080600@rabbitmq.com>
Message-ID: <152675.81635.qm@web31808.mail.mud.yahoo.com>

Matthias,


> > this could be the amqp_producer.c in  rabbitmq-c/examples.  simply modify the 
>code to accept the topic name and  message size from command line.
> 
> Please send us the modified  code.

David mentioned that tools/amqp-publish does the same thing.

> There must be a step 0) missing here.  amqp_bind does not create any queues and 
>will fail if the referenced queues do  not exist. So how are the queues created? 
>Please send us the code/scripts for  that.

i modified rabbitmq-c/examples/amqp_consumer.c to create the queue without 
consuming the messages.
# to bind and declare the queue then exit.  use this in bind.sh
amqp_consumer -r routingkey -q queue -n 0
# to consume the queue, use this in consume.sh
amqp_consumer -r routingkey -q queue 

attached please find the modified amqp_consumer.c.  

> Also, are all the above running on the same machine as the  broker?

yes.  i also tested running publisher from different host.  the throughput is 
the same if the publisher host and borker host are in the same data center, 
because the bottleneck is disk and memory.
 
-alex



      
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp_consumer.c
Type: text/x-csrc
Size: 8163 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/eee4fc27/attachment-0001.c>

From jon.brisbin at npcinternational.com  Wed Aug 25 21:12:05 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 25 Aug 2010 15:12:05 -0500
Subject: [rabbitmq-discuss] macports for 2.0?
Message-ID: <58299CD9-54C1-4E59-8B82-0482BEF561C4@npcinternational.com>

I've been using MacPorts to keep my RabbitMQ install updated for local development (though I'm using a checkout for my plugin development). Just wondering if  MacPorts will be updated for 2.0 so I can start seeing what I'll need to change for existing code?

Jon Brisbin
Portal Webmaster
NPC International, Inc.




From jon at jbrisbin.com  Wed Aug 25 21:45:34 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 25 Aug 2010 15:45:34 -0500
Subject: [rabbitmq-discuss] pluggable message transformers
In-Reply-To: <AANLkTimzWR3Eti66s8LKghq05PUVu0rrVrbV6g7=M_Rj@mail.gmail.com>
References: <C09D9B3F-F320-4A83-B387-3B8C3D0EBA17@jbrisbin.com>
	<AANLkTiki1W9sQBpg2fmze5H+SXHBYCoNwuGtzBjWOUNo@mail.gmail.com>
	<E582AA2D-98E5-4A9B-B033-4556B4B18F74@jbrisbin.com>
	<AANLkTimzWR3Eti66s8LKghq05PUVu0rrVrbV6g7=M_Rj@mail.gmail.com>
Message-ID: <854FD831-1A52-4445-BA35-B955882406C3@jbrisbin.com>

	
On Aug 25, 2010, at 3:12 PM, Alexis Richardson wrote:

> yes - http://www.erlang-factory.com/upload/presentations/229/ErlangFactorySFBay2010-TonyGarnock-Jones.pdf

This is very interesting...

I like the idea of the "x-script" transformer. It would be consistent with CouchDB that way...

I'll check out the code.

Maybe one of these days I'll actually feel like I'm not in a game of perpetual catch-up with you guys! ;)

jb


> 
> On Wed, Aug 25, 2010 at 9:10 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
>> 
>> On Aug 25, 2010, at 3:06 PM, Alexis Richardson wrote:
>> 
>> Jon
>> 
>> Did you see Tony's presentation at the Erlang Factory in March 2010?
>> 
>> I didn't. Is it archived on the website?
>> jb
>> 
>> alexis
>> 
>> 
>> On Wed, Aug 25, 2010 at 1:27 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
>> 
>> Hopefully I'll be getting back into my webhooks plugin today. One of the
>> 
>> things I'll probably need to implement inside the plugin is a transformer of
>> 
>> some sort that could turn an AMQP message into an HTTP request body. It will
>> 
>> need to be pluggable, so I can add other kinds later, but for sure I'll want
>> 
>> to be able to turn a binary message into a www-form-urlencoded. The JSON
>> 
>> data I think I can handle with content-types, etc...
>> 
>> Does anyone have an existing message transformer in Erlang I can look at? I
>> 
>> guess I'm needing examples of ways to go about piping messages from one
>> 
>> place to another and applying encoding or encrypting or somesuch...
>> 
>> Thanks!
>> 
>> J. Brisbin
>> 
>> http://jbrisbin.com/
>> 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> 
>> rabbitmq-discuss mailing list
>> 
>> rabbitmq-discuss at lists.rabbitmq.com
>> 
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> 
>> Thanks!
>> J. Brisbin
>> http://jbrisbin.com/
>> 
>> 
>> 
>> 
>> 
>> 


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/a177a755/attachment.htm>

From jon at jbrisbin.com  Wed Aug 25 22:00:32 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 25 Aug 2010 16:00:32 -0500
Subject: [rabbitmq-discuss] webhooks plugin
Message-ID: <81F6BAAC-044D-4409-B65E-9A14E99A6EBF@jbrisbin.com>

The day's not over, but I've made some pretty good progress on the webhooks plugin today. Got the plugin starting inside the broker and listening to external messages, etc...

Now I just need to plug lhttpc into the gen_server I'm using for handling messages and I'll be done with the first alpha!

I'm wondering now how the best way to handle payload data is in the erlang client? I seem to be crashing the broker when trying to do anything with it. It looks like this in the console:

<<"{ \"my\": \"test\" }">>

I don't know what it doesn't like about that. Looks like valid JSON data to me. I'm sending this message from my Groovy DSL.

How do I need to define my handle_call() function to get access to the payload without causing the broker to barf? I'm using:

handle_call({Info, Msg}, State) 

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/c46605ca/attachment.htm>

From jon.brisbin at npcinternational.com  Wed Aug 25 22:28:33 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 25 Aug 2010 16:28:33 -0500
Subject: [rabbitmq-discuss] webhooks plugin
In-Reply-To: <81F6BAAC-044D-4409-B65E-9A14E99A6EBF@jbrisbin.com>
References: <81F6BAAC-044D-4409-B65E-9A14E99A6EBF@jbrisbin.com>
Message-ID: <6738FAA0-397F-422F-9861-C35DA21ED673@npcinternational.com>


On Aug 25, 2010, at 4:00 PM, Jon Brisbin wrote:

> The day's not over, but I've made some pretty good progress on the webhooks plugin today. Got the plugin starting inside the broker and listening to external messages, etc...
> 
> Now I just need to plug lhttpc into the gen_server I'm using for handling messages and I'll be done with the first alpha!
> 
> I'm wondering now how the best way to handle payload data is in the erlang client? I seem to be crashing the broker when trying to do anything with it. It looks like this in the console:
> 
> <<"{ \"my\": \"test\" }">>
> 
> I don't know what it doesn't like about that. Looks like valid JSON data to me. I'm sending this message from my Groovy DSL.
> 
> How do I need to define my handle_call() function to get access to the payload without causing the broker to barf? I'm using:
> 
> handle_call({Info, Msg}, State) 


I meant handle_info() here, not handle_call()...

I'm trying to filter out basic.consume_ok and other stuff. Pattern matching these isn't being nice to me. :/

jb


> 
> Thanks!
> 
> J. Brisbin
> http://jbrisbin.com/
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100825/cba1edb6/attachment-0001.htm>

From jon.brisbin at npcinternational.com  Wed Aug 25 22:47:59 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 25 Aug 2010 16:47:59 -0500
Subject: [rabbitmq-discuss] webhooks plugin
In-Reply-To: <6738FAA0-397F-422F-9861-C35DA21ED673@npcinternational.com>
References: <81F6BAAC-044D-4409-B65E-9A14E99A6EBF@jbrisbin.com>
	<6738FAA0-397F-422F-9861-C35DA21ED673@npcinternational.com>
Message-ID: <C72AB078-F9CA-4E7A-9646-51662717BE55@npcinternational.com>

On Aug 25, 2010, at 4:28 PM, Jon Brisbin wrote:

> 
> On Aug 25, 2010, at 4:00 PM, Jon Brisbin wrote:
> 
>> The day's not over, but I've made some pretty good progress on the webhooks plugin today. Got the plugin starting inside the broker and listening to external messages, etc...
>> 
>> Now I just need to plug lhttpc into the gen_server I'm using for handling messages and I'll be done with the first alpha!
>> 
>> I'm wondering now how the best way to handle payload data is in the erlang client? I seem to be crashing the broker when trying to do anything with it. It looks like this in the console:
>> 
>> <<"{ \"my\": \"test\" }">>
>> 
>> I don't know what it doesn't like about that. Looks like valid JSON data to me. I'm sending this message from my Groovy DSL.
>> 
>> How do I need to define my handle_call() function to get access to the payload without causing the broker to barf? I'm using:
>> 
>> handle_call({Info, Msg}, State) 
> 
> 
> I meant handle_info() here, not handle_call()...
> 
> I'm trying to filter out basic.consume_ok and other stuff. Pattern matching these isn't being nice to me. :/

It was semi-colons. Arg. :P

Well...it was semi-colons (or lack thereof) AND the fact that the docs out in the wild aren't accurate any more (attributes on records have changed so pattern matches don't match any more).

I'll write up a blog post or something with an example of using a Pid as a consumer with 2.0/0-9-1.

Jon Brisbin
Portal Webmaster
NPC International, Inc.


From david at rabbitmq.com  Thu Aug 26 09:12:37 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 26 Aug 2010 09:12:37 +0100
Subject: [rabbitmq-discuss] macports for 2.0?
In-Reply-To: <58299CD9-54C1-4E59-8B82-0482BEF561C4@npcinternational.com> (Jon
	Brisbin's message of "Wed, 25 Aug 2010 15:12:05 -0500")
References: <58299CD9-54C1-4E59-8B82-0482BEF561C4@npcinternational.com>
Message-ID: <yrv4cwrrdn66i.fsf@dwragg.eng.vmware.com>

Hi Jon,

Jon Brisbin <jon.brisbin at npcinternational.com> writes:
> I've been using MacPorts to keep my RabbitMQ install updated for local
> development (though I'm using a checkout for my plugin
> development). Just wondering if  MacPorts will be updated for 2.0 so I
> can start seeing what I'll need to change for existing code?

2.0.0 should make it into macports, but the process of getting the
update into the central repository usually takes a few days.  So we
maintain a separate repository with the latest release.  You can find
instructions for enabling it at <http://www.rabbitmq.com/macports.html>.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jiri at krutil.com  Thu Aug 26 09:50:24 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Thu, 26 Aug 2010 10:50:24 +0200
Subject: [rabbitmq-discuss] Access control in RabbitMQ 2.0.0
Message-ID: <20100826105024.1511607fwfq420gs@webmail.active24.cz>

Hi all

It seems that the Access Control seciton of the server Admin Guide [1]  
has been updated for release 2.0.0. When reading this, I'm confused:

1) You mention that permissions with client scope are enforced only  
for client-named resources, others for all resources. But which  
permissions have which scope?

2) Server generated names seem to have prefix "amq.gen-", not  
"amq.gen.", as stated here.

3) The paragraph starting with "The regular expression ^$" seems to be  
obsolete.

Can someone please clarify this?

Cheers
Jiri


[1] http://www.rabbitmq.com/admin-guide.html#access-control


From alexandru at rabbitmq.com  Thu Aug 26 10:22:01 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 26 Aug 2010 10:22:01 +0100
Subject: [rabbitmq-discuss] Access control in RabbitMQ 2.0.0
In-Reply-To: <20100826105024.1511607fwfq420gs@webmail.active24.cz>
References: <20100826105024.1511607fwfq420gs@webmail.active24.cz>
Message-ID: <20100826092201.GB2537@dakota.eng.vmware.com>

Hi Jiri,

> 1) You mention that permissions with client scope are enforced only  
> for client-named resources, others for all resources. But which  
> permissions have which scope?

In previous releases, resources with server generated names (i.e.
anything starting with amq.gen) were NOT checked for permissions.  Only
resources with client specified names were.  This is what we now call
``client'' scope permissions.  So,
  - clients can do whatever they want with sever-generated names (they
    have full access to amq.gen resources),
  - permissions are enforced only for client named resources (so, you
    can restrict a client from creating named queues, etc.)

Permissions with ``all'' scope are applied to everything -- server-named
resources are NOT treated differently than client-named ones.

The "all" scope gives you a way to specify more fine-grained
permissions, if need them.  If you don't, you can just do everything as
before.

> 2) Server generated names seem to have prefix "amq.gen-", not  
> "amq.gen.", as stated here.

Actually they just have the prefix "amq.gen", so the only problem is
that the regexp is one character longer than it could be.  Good catch;
we'll fix it.

> 3) The paragraph starting with "The regular expression ^$" seems to be  
> obsolete.

Permissions are regular expressions.  The regular expression "^$"
matches nothing.  The regular expressions "" matches everything,
so it would mean allow-everything.  We found this confusing, so "" is now
treated specially to mean "^$".  That paragraph explains this.


Cheers,
Alex

On Thu, Aug 26, 2010 at 10:50:24AM +0200, jiri at krutil.com wrote:
> Hi all
> 
> It seems that the Access Control seciton of the server Admin Guide [1]  
> has been updated for release 2.0.0. When reading this, I'm confused:
> 
> 1) You mention that permissions with client scope are enforced only  
> for client-named resources, others for all resources. But which  
> permissions have which scope?
> 
> 2) Server generated names seem to have prefix "amq.gen-", not  
> "amq.gen.", as stated here.
> 
> 3) The paragraph starting with "The regular expression ^$" seems to be  
> obsolete.
> 
> Can someone please clarify this?
> 
> Cheers
> Jiri
> 
> 
> [1] http://www.rabbitmq.com/admin-guide.html#access-control
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Thu Aug 26 10:38:09 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 26 Aug 2010 10:38:09 +0100
Subject: [rabbitmq-discuss] macports for 2.0?
In-Reply-To: <AANLkTimKsV3gEqFYNo-=tGeQ0YggQuTUK_FhbL97d2yg@mail.gmail.com>
	(Abhishek K.'s message of "Thu, 26 Aug 2010 14:52:52 +0530")
References: <58299CD9-54C1-4E59-8B82-0482BEF561C4@npcinternational.com>
	<yrv4cwrrdn66i.fsf@dwragg.eng.vmware.com>
	<AANLkTimKsV3gEqFYNo-=tGeQ0YggQuTUK_FhbL97d2yg@mail.gmail.com>
Message-ID: <yrv4ck4ndn27y.fsf@dwragg.eng.vmware.com>

Hi Abhishek,

Abhishek K <abhishek.kona at gmail.com> writes:
> And is the Ubuntu repository also updated?

The rabbitmq-server package in Ubuntu will get updated at some point.
But a lot of that process is out of our hands, so I'm not sure how long
it will take.

But you can easily install the latest rabbitmq-server on Ubuntu, either
by installing the .deb directly, or by enabling our APT repository, as
described at <http://rabbitmq.dwragg.eng.vmware.com/debian.html>.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jiri at krutil.com  Thu Aug 26 12:23:30 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Thu, 26 Aug 2010 13:23:30 +0200
Subject: [rabbitmq-discuss] Access control in RabbitMQ 2.0.0
In-Reply-To: <20100826092201.GB2537@dakota.eng.vmware.com>
References: <20100826105024.1511607fwfq420gs@webmail.active24.cz>
	<20100826092201.GB2537@dakota.eng.vmware.com>
Message-ID: <20100826132330.18161280vwwfi66s@webmail.active24.cz>

Hi Alex

> In previous releases, resources with server generated names (i.e.
> anything starting with amq.gen) were NOT checked for permissions.  Only
> resources with client specified names were.  This is what we now call
> ``client'' scope permissions.  So,
>   - clients can do whatever they want with sever-generated names (they
>     have full access to amq.gen resources),
>   - permissions are enforced only for client named resources (so, you
>     can restrict a client from creating named queues, etc.)

I'm trying this in RabbitMQ 2.0.0 and don't get the expected results.  
I have set the following permissions (they have client scope by  
default):

rabbitmqctl set_permissions -p $VHOST $USER "" "" ""

When the client app tries to declare a server-named exclusive  
auto-delete queue, it gets:

ACCESS_REFUSED - access to queue 'amq.gen-579strgPMK52VQEcVFKqkA==' in  
vhost '$VHOST' refused for user '$USER'

The declare command only works if I explicitly give $USER permissions  
for "amq.gen.*".


> Permissions are regular expressions.  The regular expression "^$"
> matches nothing.  The regular expressions "" matches everything,
> so it would mean allow-everything.  We found this confusing, so "" is now
> treated specially to mean "^$".  That paragraph explains this.

Does that mean that "" with scope 'client' means 'allow only resources  
with server-generated names' and "" with scope 'all' means 'allow  
nothing'?

Cheers
Jiri


From alexandru at rabbitmq.com  Thu Aug 26 12:59:20 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 26 Aug 2010 12:59:20 +0100
Subject: [rabbitmq-discuss] Access control in RabbitMQ 2.0.0
In-Reply-To: <20100826132330.18161280vwwfi66s@webmail.active24.cz>
References: <20100826105024.1511607fwfq420gs@webmail.active24.cz>
	<20100826092201.GB2537@dakota.eng.vmware.com>
	<20100826132330.18161280vwwfi66s@webmail.active24.cz>
Message-ID: <20100826115920.GC2537@dakota.eng.vmware.com>

Hi Jiri,

> I'm trying this in RabbitMQ 2.0.0 and don't get the expected results.  
> I have set the following permissions (they have client scope by  
> default):
> 
> rabbitmqctl set_permissions -p $VHOST $USER "" "" ""
> 
> When the client app tries to declare a server-named exclusive  
> auto-delete queue, it gets:
> 
> ACCESS_REFUSED - access to queue 'amq.gen-579strgPMK52VQEcVFKqkA==' in  
> vhost '$VHOST' refused for user '$USER'
> 
> The declare command only works if I explicitly give $USER permissions  
> for "amq.gen.*".

You're right.  It's a bug: all permissions are interpreted as having
scope "all".

> Does that mean that "" with scope 'client' means 'allow only resources  
> with server-generated names' and "" with scope 'all' means 'allow  
> nothing'?

That's the idea, but until we fix this bug, it's just ``allow nothing''.


Alex

On Thu, Aug 26, 2010 at 01:23:30PM +0200, jiri at krutil.com wrote:
> Hi Alex
> 
> > In previous releases, resources with server generated names (i.e.
> > anything starting with amq.gen) were NOT checked for permissions.  Only
> > resources with client specified names were.  This is what we now call
> > ``client'' scope permissions.  So,
> >   - clients can do whatever they want with sever-generated names (they
> >     have full access to amq.gen resources),
> >   - permissions are enforced only for client named resources (so, you
> >     can restrict a client from creating named queues, etc.)
> 
> I'm trying this in RabbitMQ 2.0.0 and don't get the expected results.  
> I have set the following permissions (they have client scope by  
> default):
> 
> rabbitmqctl set_permissions -p $VHOST $USER "" "" ""
> 
> When the client app tries to declare a server-named exclusive  
> auto-delete queue, it gets:
> 
> ACCESS_REFUSED - access to queue 'amq.gen-579strgPMK52VQEcVFKqkA==' in  
> vhost '$VHOST' refused for user '$USER'
> 
> The declare command only works if I explicitly give $USER permissions  
> for "amq.gen.*".
> 
> 
> > Permissions are regular expressions.  The regular expression "^$"
> > matches nothing.  The regular expressions "" matches everything,
> > so it would mean allow-everything.  We found this confusing, so "" is now
> > treated specially to mean "^$".  That paragraph explains this.
> 
> Does that mean that "" with scope 'client' means 'allow only resources  
> with server-generated names' and "" with scope 'all' means 'allow  
> nothing'?
> 
> Cheers
> Jiri
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jon at jbrisbin.com  Thu Aug 26 13:09:31 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 26 Aug 2010 07:09:31 -0500
Subject: [rabbitmq-discuss] macports for 2.0?
In-Reply-To: <yrv4ck4ndn27y.fsf@dwragg.eng.vmware.com>
References: <58299CD9-54C1-4E59-8B82-0482BEF561C4@npcinternational.com>
	<yrv4cwrrdn66i.fsf@dwragg.eng.vmware.com>
	<AANLkTimKsV3gEqFYNo-=tGeQ0YggQuTUK_FhbL97d2yg@mail.gmail.com>
	<yrv4ck4ndn27y.fsf@dwragg.eng.vmware.com>
Message-ID: <B8CAA151-B9C8-4D20-B5C0-FBDAF5DC1746@jbrisbin.com>


On Aug 26, 2010, at 4:38 AM, David Wragg wrote:

> 
> But you can easily install the latest rabbitmq-server on Ubuntu, either
> by installing the .deb directly, or by enabling our APT repository, as
> described at <http://rabbitmq.dwragg.eng.vmware.com/debian.html>.

Using the RabbitMQ APT repo is how we keep up-to-date. That's how I knew the 2.0 update was coming even before it was announced. It showed up ready to update the other day. :)


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/027454ce/attachment.htm>

From david at rabbitmq.com  Thu Aug 26 13:15:58 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 26 Aug 2010 13:15:58 +0100
Subject: [rabbitmq-discuss] macports for 2.0?
In-Reply-To: <yrv4ck4ndn27y.fsf@dwragg.eng.vmware.com> (David Wragg's message
	of "Thu, 26 Aug 2010 10:38:09 +0100")
References: <58299CD9-54C1-4E59-8B82-0482BEF561C4@npcinternational.com>
	<yrv4cwrrdn66i.fsf@dwragg.eng.vmware.com>
	<AANLkTimKsV3gEqFYNo-=tGeQ0YggQuTUK_FhbL97d2yg@mail.gmail.com>
	<yrv4ck4ndn27y.fsf@dwragg.eng.vmware.com>
Message-ID: <yrv4cfwy1muwx.fsf@dwragg.eng.vmware.com>

David Wragg <david at rabbitmq.com> writes:
> But you can easily install the latest rabbitmq-server on Ubuntu, either
> by installing the .deb directly, or by enabling our APT repository, as
> described at <http://rabbitmq.dwragg.eng.vmware.com/debian.html>.

Oops - wrong tab!  That URL should be <http://www.rabbitmq.com/debian.html>

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From flocha2000-agile at yahoo.fr  Thu Aug 26 14:16:33 2010
From: flocha2000-agile at yahoo.fr (Florence Chabanois)
Date: Thu, 26 Aug 2010 13:16:33 +0000 (GMT)
Subject: [rabbitmq-discuss] To know when a queue is empty from a Java client
In-Reply-To: <yrv4cfwy1muwx.fsf@dwragg.eng.vmware.com>
Message-ID: <352810.42359.qm@web26008.mail.ukl.yahoo.com>

Hello,
>From a Java client we need to know when a queue is empty.Is there a way to know it via the Java api (or to know the numberof messages in a queue).
We would rather have another way than calling "rabbitmqctl list_queues"via Runtime.exec()
Thanks for any help,Florence.


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/49ce68ce/attachment.htm>

From iverodin at gmail.com  Thu Aug 26 14:20:29 2010
From: iverodin at gmail.com (Iver Odin Kvello)
Date: Thu, 26 Aug 2010 15:20:29 +0200
Subject: [rabbitmq-discuss] Troubles getting Shovel to work on Windows on
	2.0.0
Message-ID: <AANLkTikRJYbO4XWSX8SimuT_kYKcPPx1+sH7++SYna1-@mail.gmail.com>

Hello,

I'm trying to get Shovel to work on Windows using the new 2.0.0
release of rabbit and the new binary distribution of Shovel.

I've made a very simple test configuration which upon testing produces
this in the logs:

 =WARNING REPORT==== 25-Aug-2010::17:26:23 ===
 Could not start the network driver: etimedout

And then a bit later a series of shovel-related errors ending the
messages following. It seems to me that the connection to localhost
itself fails upon timeout, and I'm not sure what I've done wrong.
I've checked that the password still is guest:guest. The Erlang
version is the 5.7.4 from the Windows bundle.

I'm hoping the problem is something really obvious, but I can't seem
to spot it. Does anybody have a extremely basic  test-configuration
for shovel that should work on a completely new installation that I
could try?

This is the test configuration I'm using:

[
{rabbit_shovel,
 [{shovels,
   [{outgoing,
     [{sources,      [{brokers,
                         ["amqp://guest:guest at 127.0.0.1/"]}
                      ]},
      {destinations, [{broker, "amqp://guest:guest at secundus/"}
                      ]},
      {queue, <<"outgoing">>},
      {prefetch_count, 10},
      {auto_ack, false},
      {tx_size, 0},
      {publish_properties, [{delivery_mode, 2}]},
      {publish_fields, [{exchange, <<"main">>},
                        {routing_key, <<"from_shovel">>}]},
      {reconnect_delay, 5}
     ]}
    ]
  }]
}

].

And here are the error messages:

=ERROR REPORT==== 25-Aug-2010::17:26:23 ===
** Generic server <0.182.0> terminating
** Last message in was {'EXIT',<0.181.0>,
                          {bad_return_value,
                              {error,
                                  {auth_failure_likely,{error,etimedout}}}}}
** When Server state == {nc_state,
                           {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
                               "127.0.1",5672,0,0,0,none,[]},
                           #Port<0.2148>,<0.187.0>,<0.186.0>,<0.185.0>,0,0,
                           false,
                           [{<<"product">>,longstr,<<"RabbitMQ">>},
                            {<<"version">>,longstr,<<"2.0.0">>},
                            {<<"platform">>,longstr,<<"Erlang/OTP">>},
                            {<<"copyright">>,longstr,
                             <<"Copyright (C) 2007-2010 LShift Ltd.,
Cohesive Financial Technologies LLC., and Rabbit Technologies
Ltd.">>},
                            {<<"information">>,longstr,
                             <<"Licensed under the MPL.  See
http://www.rabbitmq.com/">>}],
                           {{1,{1,<0.190.0>,nil,nil}},
                            {dict,1,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 [],[]},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [[<0.190.0>|1]],
                                  []}}}}}
** Reason for termination ==
** {bad_return_value,{error,{auth_failure_likely,{error,etimedout}}}}

=ERROR REPORT==== 25-Aug-2010::17:26:23 ===
** Generic server <0.190.0> terminating
** Last message in was {'EXIT',<0.182.0>,
                          {bad_return_value,
                              {error,
                                  {auth_failure_likely,{error,etimedout}}}}}
** When Server state == {c_state,1,<0.182.0>,<0.191.0>,<0.192.0>,network,
                           {[],[]},
                           {[],[]},
                           {dict,0,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 [],[]}}},
                           false,none,false,none,
                           {dict,0,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 [],[]}}},
                           unknown}
** Reason for termination ==
** {bad_return_value,{error,{auth_failure_likely,{error,etimedout}}}


Regards,
Iver Odin Kvello

From mikeb at rabbitmq.com  Thu Aug 26 14:24:25 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 26 Aug 2010 14:24:25 +0100
Subject: [rabbitmq-discuss] To know when a queue is empty from a Java
 client
In-Reply-To: <352810.42359.qm@web26008.mail.ukl.yahoo.com>
References: <352810.42359.qm@web26008.mail.ukl.yahoo.com>
Message-ID: <4C766B09.8030700@rabbitmq.com>

>  From a Java client we need to know when a queue is empty.
> Is there a way to know it via the Java api (or to know the number
> of messages in a queue).
> 
> We would rather have another way than calling /"rabbitmqctl list_queues"/
> via Runtime.exec()

A queue.declare_ok frame includes the number of messages on the queue; 
so, you could send a passive queue.declare, and examine the response.

Regards,
Michael

From jon at jbrisbin.com  Thu Aug 26 14:25:55 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 26 Aug 2010 08:25:55 -0500
Subject: [rabbitmq-discuss] To know when a queue is empty from a Java
	client
In-Reply-To: <352810.42359.qm@web26008.mail.ukl.yahoo.com>
References: <352810.42359.qm@web26008.mail.ukl.yahoo.com>
Message-ID: <7DCB16D1-2E71-4359-8632-CF76C4A58455@jbrisbin.com>


The "official" folks should correct me here, but when you declare an existing queue, you get an object back that gives you the message count:

http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.0.0/rabbitmq-java-client-javadoc-2.0.0/com/rabbitmq/client/AMQP.Queue.DeclareOk.html

I don't think there's a way to poll for the message count on a long-running process, though...

jb


On Aug 26, 2010, at 8:16 AM, Florence Chabanois wrote:

> Hello,
> 
> From a Java client we need to know when a queue is empty.
> Is there a way to know it via the Java api (or to know the number
> of messages in a queue).
> 
> We would rather have another way than calling "rabbitmqctl list_queues"
> via Runtime.exec()
> 
> Thanks for any help,
> Florence.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/58c94e5e/attachment.htm>

From flocha2000-agile at yahoo.fr  Thu Aug 26 15:05:59 2010
From: flocha2000-agile at yahoo.fr (Florence Chabanois)
Date: Thu, 26 Aug 2010 14:05:59 +0000 (GMT)
Subject: [rabbitmq-discuss] To know when a queue is empty from a Java
	client
In-Reply-To: <4C766B09.8030700@rabbitmq.com>
Message-ID: <368190.38326.qm@web26004.mail.ukl.yahoo.com>

Thanks for your answer !
We may be using it in a wrong way but so far, the method getMessageCount() always displays 0 message, when "rabbitmqctl list_queues" displays 8 messages or keeps growing.
DeclareOk declareOk = channel.queueDeclare();System.out.println(">>>> MESSAGES : " + declareOk.getMessageCount());
Cheers,Florence.

--- En date de?: Jeu 26.8.10, Michael Bridgen <mikeb at rabbitmq.com> a ?crit?:

De: Michael Bridgen <mikeb at rabbitmq.com>
Objet: Re: [rabbitmq-discuss] To know when a queue is empty from a Java client
?: flocha2000-agile at yahoo.fr
Cc: rabbitmq-discuss at lists.rabbitmq.com
Date: Jeudi 26 ao?t 2010, 15h24

>? From a Java client we need to know when a queue is empty.
> Is there a way to know it via the Java api (or to know the number
> of messages in a queue).
> 
> We would rather have another way than calling /"rabbitmqctl list_queues"/
> via Runtime.exec()

A queue.declare_ok frame includes the number of messages on the queue; so, you could send a passive queue.declare, and examine the response.

Regards,
Michael



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/2bc93f42/attachment.htm>

From simon at rabbitmq.com  Thu Aug 26 15:13:15 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 26 Aug 2010 15:13:15 +0100
Subject: [rabbitmq-discuss] To know when a queue is empty from a Java
 client
In-Reply-To: <368190.38326.qm@web26004.mail.ukl.yahoo.com>
References: <368190.38326.qm@web26004.mail.ukl.yahoo.com>
Message-ID: <4C76767B.2060203@rabbitmq.com>

On 26/08/10 15:05, Florence Chabanois wrote:
> Thanks for your answer !
>
> We may be using it in a wrong way but so far, the method
> getMessageCount() always displays 0 message, when /"rabbitmqctl
> list_queues"/ displays 8 messages or keeps growing.
>
>     DeclareOk declareOk = channel.queueDeclare();

That's declaring a *new* server-named queue - which has 0 messages in 
it. Is that literally your code, or a paraphrase?

Cheers, Simon

>     System.out.println(">>>> MESSAGES : " + declareOk.getMessageCount());
>
>
> Cheers,
> Florence.
>
> --- En date de : *Jeu 26.8.10, Michael Bridgen /<mikeb at rabbitmq.com>/* a
> ?crit :
>
>
>     De: Michael Bridgen <mikeb at rabbitmq.com>
>     Objet: Re: [rabbitmq-discuss] To know when a queue is empty from a
>     Java client
>     ?: flocha2000-agile at yahoo.fr
>     Cc: rabbitmq-discuss at lists.rabbitmq.com
>     Date: Jeudi 26 ao?t 2010, 15h24
>
>      > From a Java client we need to know when a queue is empty.
>      > Is there a way to know it via the Java api (or to know the number
>      > of messages in a queue).
>      >
>      > We would rather have another way than calling /"rabbitmqctl
>     list_queues"/
>      > via Runtime.exec()
>
>     A queue.declare_ok frame includes the number of messages on the
>     queue; so, you could send a passive queue.declare, and examine the
>     response.
>
>     Regards,
>     Michael
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From flocha2000-agile at yahoo.fr  Thu Aug 26 15:34:20 2010
From: flocha2000-agile at yahoo.fr (Florence Chabanois)
Date: Thu, 26 Aug 2010 14:34:20 +0000 (GMT)
Subject: [rabbitmq-discuss] To know when a queue is empty from a Java
	client
Message-ID: <316260.54321.qm@web26004.mail.ukl.yahoo.com>


Hum indeed, this is literally our code...
So if declare_ok always refers to a new queue,?we have no choice but use Runtime.exec("rabbitmqctl list_queues") if?we want to know this kind of information on an existing queue??
Cheers,Florence.


--- En date de?: Jeu 26.8.10, Simon MacMullen <simon at rabbitmq.com> a ?crit?:

De: Simon MacMullen <simon at rabbitmq.com>
Objet: Re: [rabbitmq-discuss] To know when a queue is empty from a Java client
?: rabbitmq-discuss at lists.rabbitmq.com
Date: Jeudi 26 ao?t 2010, 16h13

On 26/08/10 15:05, Florence
 Chabanois wrote:
> Thanks for your answer !
>
> We may be using it in a wrong way but so far, the method
> getMessageCount() always displays 0 message, when /"rabbitmqctl
> list_queues"/ displays 8 messages or keeps growing.
>
>? ???DeclareOk declareOk = channel.queueDeclare();

That's declaring a *new* server-named queue - which has 0 messages in 
it. Is that literally your code, or a paraphrase?

Cheers, Simon

>? ???System.out.println(">>>> MESSAGES : " + declareOk.getMessageCount());
>
>
> Cheers,
> Florence.
>
> --- En date de : *Jeu 26.8.10, Michael Bridgen /<mikeb at rabbitmq.com>/* a
> ?crit :
>
>
>? ???De: Michael Bridgen <mikeb at rabbitmq.com>
>? ???Objet: Re: [rabbitmq-discuss] To know when a queue is empty from a
>? ???Java client
>? ????: flocha2000-agile at yahoo.fr
>? ???Cc: rabbitmq-discuss at lists.rabbitmq.com
>? ???Date: Jeudi 26 ao?t 2010, 15h24
>
>? ? ? > From a Java client we need to know when a queue is empty.
>? ? ? > Is there a way to know it via the Java api (or to know the number
>? ? ? > of messages in a queue).
>? ? ? >
>? ? ? > We would rather
 have another way than calling /"rabbitmqctl
>? ???list_queues"/
>? ? ? > via Runtime.exec()
>
>? ???A queue.declare_ok frame includes the number of messages on the
>? ???queue; so, you could send a passive queue.declare, and examine the
>? ???response.
>
>? ???Regards,
>? ???Michael
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon
 MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss






      


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/9800cd49/attachment-0001.htm>

From jon.brisbin at npcinternational.com  Thu Aug 26 15:41:12 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 26 Aug 2010 09:41:12 -0500
Subject: [rabbitmq-discuss] To know when a queue is empty from a Java
	client
In-Reply-To: <316260.54321.qm@web26004.mail.ukl.yahoo.com>
References: <316260.54321.qm@web26004.mail.ukl.yahoo.com>
Message-ID: <D77EA536-5D14-4BAD-BF4F-FCE225D4EF74@npcinternational.com>




On Aug 26, 2010, at 9:34 AM, Florence Chabanois wrote:

> 
> Hum indeed, this is literally our code...
> 
> So if declare_ok always refers to a new queue, we have no choice but use Runtime.exec("rabbitmqctl list_queues") if we want to know this kind of information on an existing queue? 
> 
> Cheers,
> Florence.
> 

Actually, your code is creating a new queue, so in your example, the declare_ok will always refer to a new queue.

But if you declare a queue that already exists (which a producer has already populated with messages), you'll get back the message count. Give a name to your queue and have the producer and consumer use the same name.

If you attach your consumer to a new queue (which you're doing by creating an anonymous queue) the message count will obviously be zero because nothing has put messages in it yet.


Jon Brisbin
Portal Webmaster
NPC International, Inc.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/8d45d57b/attachment.htm>

From mikeb at rabbitmq.com  Thu Aug 26 15:45:08 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 26 Aug 2010 15:45:08 +0100
Subject: [rabbitmq-discuss] To know when a queue is empty from a Java
 client
In-Reply-To: <316260.54321.qm@web26004.mail.ukl.yahoo.com>
References: <316260.54321.qm@web26004.mail.ukl.yahoo.com>
Message-ID: <4C767DF4.4020001@rabbitmq.com>

> So if declare_ok always refers to a new queue, we have no choice but use 
> Runtime.exec("rabbitmqctl list_queues") if we want to know this kind of 
> information on an existing queue? 

No, queue.declare_ok does not always refer to a new queue.

If you don't supply a name to queue.declare, the server will construct a 
fresh name, and the responding queue.declare_ok will refer to a new 
queue.  If you *do* supply a name, and the queue already exists, then 
queue.declare_ok will refer to that queue.

Using a passive queue.declare means you only need supply the name of the 
queue.  In recent versions of the Java library, it's a separate method 
in ChannelN.

Cheers,
Michael

> 
>     --- En date de : *Jeu 26.8.10, Simon MacMullen
>     /<simon at rabbitmq.com>/* a ?crit :
> 
> 
>         De: Simon MacMullen <simon at rabbitmq.com>
>         Objet: Re: [rabbitmq-discuss] To know when a queue is empty from
>         a Java client
>         ?: rabbitmq-discuss at lists.rabbitmq.com
>         Date: Jeudi 26 ao?t 2010, 16h13
> 
>         On 26/08/10 15:05, Florence Chabanois wrote:
>          > Thanks for your answer !
>          >
>          > We may be using it in a wrong way but so far, the method
>          > getMessageCount() always displays 0 message, when /"rabbitmqctl
>          > list_queues"/ displays 8 messages or keeps growing.
>          >
>          >     DeclareOk declareOk = channel.queueDeclare();
> 
>         That's declaring a *new* server-named queue - which has 0
>         messages in
>         it. Is that literally your code, or a paraphrase?
> 
>         Cheers, Simon
> 
>          >     System.out.println(">>>> MESSAGES : " +
>         declareOk.getMessageCount());
>          >
>          >
>          > Cheers,
>          > Florence.
>          >
>          > --- En date de : *Jeu 26.8.10, Michael Bridgen
>         /<mikeb at rabbitmq.com>/* a
>          > ?crit :
>          >
>          >
>          >     De: Michael Bridgen <mikeb at rabbitmq.com>
>          >     Objet: Re: [rabbitmq-discuss] To know when a queue is
>         empty from a
>          >     Java client
>          >     ?: flocha2000-agile at yahoo.fr
>          >     Cc: rabbitmq-discuss at lists.rabbitmq.com
>          >     Date: Jeudi 26 ao?t 2010, 15h24
>          >
>          >      > From a Java client we need to know when a queue is empty.
>          >      > Is there a way to know it via the Java api (or to know
>         the number
>          >      > of messages in a queue).
>          >      >
>          >      > We would rather have another way than calling
>         /"rabbitmqctl
>          >     list_queues"/
>          >      > via Runtime.exec()
>          >
>          >     A queue.declare_ok frame includes the number of messages
>         on the
>          >     queue; so, you could send a passive queue.declare, and
>         examine the
>          >     response.
>          >
>          >     Regards,
>          >     Michael
>          >
>          >
>          >
>          >
>          > _______________________________________________
>          > rabbitmq-discuss mailing list
>          > rabbitmq-discuss at lists.rabbitmq.com
>          >
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
>         -- 
>         Simon MacMullen
>         Staff Engineer, RabbitMQ
>         SpringSource, a division of VMware
> 
>         _______________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Thu Aug 26 15:57:25 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Aug 2010 15:57:25 +0100
Subject: [rabbitmq-discuss] persist to disk feature
In-Reply-To: <555BCB283BEB174F9BF8A0A73C880BB2030D80B580@exchange02.crispthinking.local>
References: <555BCB283BEB174F9BF8A0A73C880BB2030D814874@exchange02.crispthinking.local>	<4C5960D3.2060407@rabbitmq.com>
	<555BCB283BEB174F9BF8A0A73C880BB2030D80B580@exchange02.crispthinking.local>
Message-ID: <4C7680D5.2030205@rabbitmq.com>

James,

On 05/08/10 17:39, James Geary wrote:
> this feature is going to make a monumental difference to our use of
> rabbit. I think we can wait for the next release.... when will that
> be?

Yesterday :)


Matthias.

From matthias at rabbitmq.com  Thu Aug 26 16:43:05 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Aug 2010 16:43:05 +0100
Subject: [rabbitmq-discuss] Troubles getting Shovel to work on Windows
 on 2.0.0
In-Reply-To: <AANLkTikRJYbO4XWSX8SimuT_kYKcPPx1+sH7++SYna1-@mail.gmail.com>
References: <AANLkTikRJYbO4XWSX8SimuT_kYKcPPx1+sH7++SYna1-@mail.gmail.com>
Message-ID: <4C768B89.6020000@rabbitmq.com>

Iver,

On 26/08/10 14:20, Iver Odin Kvello wrote:
> I'm trying to get Shovel to work on Windows using the new 2.0.0
> release of rabbit and the new binary distribution of Shovel.
>
> I've made a very simple test configuration which upon testing produces
> this in the logs:
>
>   =WARNING REPORT==== 25-Aug-2010::17:26:23 ===
>   Could not start the network driver: etimedout
>
> [...]
>       [{sources,      [{brokers,
>                           ["amqp://guest:guest at 127.0.0.1/"]}
>                        ]},
> [...]
> ** When Server state == {nc_state,
>                             {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
>                                 "127.0.1",5672,0,0,0,none,[]},

Note the reference to "127.0.1" in the error. Any idea where that is 
coming from?

Also, if 127.0.0.1 is the broker in which the shovel is embedded, then 
you many want to try a direct connection - see the README for details; 
iirc you can just specify "amqp://".


Regards,

Matthias.

From jamesgeary at CrispThinking.com  Thu Aug 26 16:45:49 2010
From: jamesgeary at CrispThinking.com (James Geary)
Date: Thu, 26 Aug 2010 16:45:49 +0100
Subject: [rabbitmq-discuss] persist to disk feature
In-Reply-To: <4C7680D5.2030205@rabbitmq.com>
References: <555BCB283BEB174F9BF8A0A73C880BB2030D814874@exchange02.crispthinking.local>
	<4C5960D3.2060407@rabbitmq.com>
	<555BCB283BEB174F9BF8A0A73C880BB2030D80B580@exchange02.crispthinking.local>
	<4C7680D5.2030205@rabbitmq.com>
Message-ID: <555BCB283BEB174F9BF8A0A73C880BB203478248AA@exchange02.crispthinking.local>

Matthias, that is awesome :-)

Please pass my thanks on to your dev team.

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: 26 August 2010 15:57
To: James Geary
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] persist to disk feature

James,

On 05/08/10 17:39, James Geary wrote:
> this feature is going to make a monumental difference to our use of 
> rabbit. I think we can wait for the next release.... when will that 
> be?

Yesterday :)


Matthias.

From jpellerin at leapfrogonline.com  Thu Aug 26 16:41:03 2010
From: jpellerin at leapfrogonline.com (Jason Pellerin)
Date: Thu, 26 Aug 2010 11:41:03 -0400
Subject: [rabbitmq-discuss] BAD signature on 2.0.0 tar.gz?
Message-ID: <4C768B0F.9010305@leapfrogonline.com>

I just downloaded the 2.0.0 .tar.gz, .deb and their associated signature
files. The deb says it has a good signature, but the .tar.gz says:

$ gpg --verify rabbitmq-server-2.0.0.tar.gz.asc rabbitmq-server-2.0.0.tar.gz
gpg: Signature made Mon 23 Aug 2010 10:06:35 AM EDT using DSA key ID
056E8E56
gpg: BAD signature from "RabbitMQ Release Signing Key <info at rabbitmq.com>"

Does anyone else see a bad signature from the .tar.gz, or have I done
something wrong, or gotten a corrupt download or something?

Thanks,

JP

CONFIDENTIALITY NOTE
The document(s) accompanying this e-mail transmission, if any, and the e-mail transmittal message containing information from Leapfrog Online Customer Acquisition, LLC is confidential or privileged. The information is intended to be for the use of the individual(s) or entity(ies) named on this e-mail transmission message. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please immediately delete this e-mail and notify us by telephone of the error.

From mpollack at vmware.com  Thu Aug 26 16:58:16 2010
From: mpollack at vmware.com (Mark Pollack)
Date: Thu, 26 Aug 2010 08:58:16 -0700
Subject: [rabbitmq-discuss] To know when a queue is empty from a
	Java	client
In-Reply-To: <D77EA536-5D14-4BAD-BF4F-FCE225D4EF74@npcinternational.com>
References: <316260.54321.qm@web26004.mail.ukl.yahoo.com>
	<D77EA536-5D14-4BAD-BF4F-FCE225D4EF74@npcinternational.com>
Message-ID: <806F700D7E08E9408413160B05EB66672A484D8F59@EXCH-MBX-1.vmware.com>

Hi,

The Spring AMQP project provides some initial support for an admin API.  We use JInterface to call the erlang functions used by rabbitmqctl.

Take a look at the javadocs here

http://static.springsource.org/spring-amqp/docs/1.0.x/api/org/springframework/amqp/rabbit/admin/package-summary.html

We are not yet complete in supporting the full range of functionality available in rabbitmqctl but that is the goal.

There is also a .NET version.

Mark





From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jon Brisbin
Sent: Thursday, August 26, 2010 10:41 AM
To: flocha2000-agile at yahoo.fr
Cc: RabbitMQ
Subject: Re: [rabbitmq-discuss] To know when a queue is empty from a Java client




On Aug 26, 2010, at 9:34 AM, Florence Chabanois wrote:



Hum indeed, this is literally our code...

So if declare_ok always refers to a new queue, we have no choice but use Runtime.exec("rabbitmqctl list_queues") if we want to know this kind of information on an existing queue?

Cheers,
Florence.



Actually, your code is creating a new queue, so in your example, the declare_ok will always refer to a new queue.

But if you declare a queue that already exists (which a producer has already populated with messages), you'll get back the message count. Give a name to your queue and have the producer and consumer use the same name.

If you attach your consumer to a new queue (which you're doing by creating an anonymous queue) the message count will obviously be zero because nothing has put messages in it yet.


Jon Brisbin
Portal Webmaster
NPC International, Inc.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/957ae4b7/attachment-0001.htm>

From mikeb at rabbitmq.com  Thu Aug 26 17:03:06 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 26 Aug 2010 17:03:06 +0100
Subject: [rabbitmq-discuss] BAD signature on 2.0.0 tar.gz?
In-Reply-To: <4C768B0F.9010305@leapfrogonline.com>
References: <4C768B0F.9010305@leapfrogonline.com>
Message-ID: <4C76903A.2080807@rabbitmq.com>

> $ gpg --verify rabbitmq-server-2.0.0.tar.gz.asc 
> rabbitmq-server-2.0.0.tar.gz
> gpg: Signature made Mon 23 Aug 2010 10:06:35 AM EDT using DSA key ID
> 056E8E56
> gpg: BAD signature from "RabbitMQ Release Signing Key <info at rabbitmq.com>"
> 
> Does anyone else see a bad signature from the .tar.gz, or have I done
> something wrong, or gotten a corrupt download or something?

I just tried it out too, and you are right, the source tarball has a bad 
signature.  I'll investigate -- thanks for letting us know, Jason.

Michael

From jon at jbrisbin.com  Thu Aug 26 22:14:39 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 26 Aug 2010 16:14:39 -0500
Subject: [rabbitmq-discuss] RabbitMQ Webhooks plugin on Github
Message-ID: <4CFDA2BB-C1A4-4F7F-BD23-901ADF66AB00@jbrisbin.com>

I just pushed the first alpha of a webhooks plugin for RabbitMQ to Github:

http://github.com/jbrisbin/rabbitmq-webhooks

This plugin takes a message from a configurable queue and sends it to a REST URL using whatever method you tell it to (PUT|POST|DELETE|etc...).

I haven't yet added the throttling and "wait until" scheduling I plan to add. This will let you interact with Google AppEngine or any other cloud provider by exposing REST services to asynchronous messaging.

The problems I'm trying to solve are:

In Google AppEngine, for example, you don't know how many of your web applications will be running. Some might die off and others might be started at any time to handle the traffic load. If you start consumers within the context of your web application, you will get fewer or more consumers depending on the number of web application instances running in the cloud. This is not always a bad thing, but you don't have any control over that process and I'm a control freak. :)

I'd like to be able to have asynchronous "triggers" for CouchDB that do things automatically and when I want them to.

This also allows greater parallelism because, looking again at the cloud provider scenario, if I wanted to dump 10,000 requests on my cloud application, I could, because the cloud that powers my web application is designed to handle that kind of elastic load. I can't say the same for standard AMQP consumers. I would have to run them on something like EC2 and manually fire up instances to get greater parallelism. This could be pretty interesting for map/reduce jobs on Internet scale. :)

This plugin is pretty configurable already but will be more so as time goes on. Message headers get transferred to HTTP request headers automatically. The contentType message property becomes the Content-Type HTTP header. I will eventually let messages override everything on per-message basis: url, method, etc...

I built against a checkout of the server, but we're close enough to the 2.0 release that it should Just Work by dumping the .ez files into your 2.0 plugins directory. I'd love to know if this works in 1.8, too. I haven't even tried. I'm not really doing anything special, so I can't imagine it would be hard to make it backwards-compatible.

Let me know what you think!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/19329f76/attachment.htm>

From andrius.norkaitis at oryo.lt  Thu Aug 26 22:41:47 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Fri, 27 Aug 2010 00:41:47 +0300
Subject: [rabbitmq-discuss] AMQP on Windows CE
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>

Hello All, 

I would like to know if someone already use or did the source code port of
AMQP client API to run on Windows CE operating system ? 

Thanks in advance.

 

Regards,

Andrius Norkaitis 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100827/54efcc9b/attachment.htm>

From matthias at rabbitmq.com  Thu Aug 26 22:44:57 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Aug 2010 22:44:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ Webhooks plugin on Github
In-Reply-To: <4CFDA2BB-C1A4-4F7F-BD23-901ADF66AB00@jbrisbin.com>
References: <4CFDA2BB-C1A4-4F7F-BD23-901ADF66AB00@jbrisbin.com>
Message-ID: <4C76E059.6090301@rabbitmq.com>

Jon,

Jon Brisbin wrote:
> I just pushed the first alpha of a webhooks plugin for RabbitMQ to Github:
> 
> http://github.com/jbrisbin/rabbitmq-webhooks

Congrats on writing the first community plugin for RabbitMQ 2.0!

And it's looking pretty good too.

Btw, this intrinsically doesn't need to be a plug-in, since all its 
interactions with the broker are over AMQP. So you could make it a 
standalone app. The same is true of several other existing plug-ins, 
including the shovel.

Embedding in the broker has its advantages of course. One less piece of 
software to start/stop/manage, easy to deploy, better performance. The 
downside is that if it dies it could take out the broker.


Regards,

Matthias.

From jon at jbrisbin.com  Thu Aug 26 22:52:27 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 26 Aug 2010 16:52:27 -0500
Subject: [rabbitmq-discuss] RabbitMQ Webhooks plugin on Github
In-Reply-To: <4C76E059.6090301@rabbitmq.com>
References: <4CFDA2BB-C1A4-4F7F-BD23-901ADF66AB00@jbrisbin.com>
	<4C76E059.6090301@rabbitmq.com>
Message-ID: <08D095D2-585F-4541-815C-97962BF25AA6@jbrisbin.com>

	
On Aug 26, 2010, at 4:44 PM, Matthias Radestock wrote:

> Jon,
> 
> Jon Brisbin wrote:
>> I just pushed the first alpha of a webhooks plugin for RabbitMQ to Github:
>> http://github.com/jbrisbin/rabbitmq-webhooks
> 
> Congrats on writing the first community plugin for RabbitMQ 2.0!
> 
> And it's looking pretty good too.
> 
> Btw, this intrinsically doesn't need to be a plug-in, since all its interactions with the broker are over AMQP. So you could make it a standalone app. The same is true of several other existing plug-ins, including the shovel.
> 
> Embedding in the broker has its advantages of course. One less piece of software to start/stop/manage, easy to deploy, better performance. The downside is that if it dies it could take out the broker.

I really debated about this. But one of the problems I'm trying to solve is to not have to have any other service to manage. 

I see this more as an extension of the broker than a standalone app, too.

But I do worry about killing the broker... :/ So far, errors making HTTP requests have resulted in terminating the gen_server, which is respawned by the supervisor. If there's a configuration error or somesuch (or syntax error in my code, as an example), it causes the broker to start, then stop immediately without always giving a clear idea of where the error is. I end up going back to putting log statements in every other line. :) Old school debugging...

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100826/33cac1d8/attachment-0001.htm>

From iverodin at gmail.com  Fri Aug 27 10:35:01 2010
From: iverodin at gmail.com (Iver Odin Kvello)
Date: Fri, 27 Aug 2010 11:35:01 +0200
Subject: [rabbitmq-discuss] Troubles getting Shovel to work on Windows
	on 2.0.0
Message-ID: <AANLkTikAc570QH2WHFVG+NtPCKUrVwSnaG1vLgCdNADL@mail.gmail.com>

> Note the reference to "127.0.1" in the error. Any idea where that is
> coming from?

No, I think I must probably have edited the text when writing the
email - it was supposed to be 127.0.0.1.

The problem actually was that the other server hadn't been upgradet to
2.0.0 yet.

I tried using first the direct connection and then using localhost
both as source and destination, which worked fine. Shovelling to the
other server still failed, but upgrading it to 2.0.0  fixed the
problem.  It seems shovelling to older versions will cause these kinds
of errors (on another, older server I got enomem instead).

Thank you very much for the assistance!

Regards,
Iver

From matthias at rabbitmq.com  Fri Aug 27 10:43:02 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 27 Aug 2010 10:43:02 +0100
Subject: [rabbitmq-discuss] Troubles getting Shovel to work on Windows
 on 2.0.0
In-Reply-To: <AANLkTikAc570QH2WHFVG+NtPCKUrVwSnaG1vLgCdNADL@mail.gmail.com>
References: <AANLkTikAc570QH2WHFVG+NtPCKUrVwSnaG1vLgCdNADL@mail.gmail.com>
Message-ID: <4C7788A6.7070400@rabbitmq.com>

Iver,

On 27/08/10 10:35, Iver Odin Kvello wrote:
> The problem actually was that the other server hadn't been upgradet to
> 2.0.0 yet.
> [...]
> It seems shovelling to older versions will cause these kinds
> of errors (on another, older server I got enomem instead).

That makes sense. The erlang-client speaks AMQP 0-9-1 these days, which 
older rabbits do not support.

Regards,

Matthias.

From majek04 at gmail.com  Fri Aug 27 12:20:53 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 27 Aug 2010 12:20:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
In-Reply-To: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
References: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
Message-ID: <AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>

Tim,

On Tue, Aug 24, 2010 at 14:15, Tim Child <tim at cantemo.com> wrote:
> One part of my application is to provide realtime feedback on jobs going on in the system, there will be a job overview page, which will list the status of x number of jobs (probably about 40), and a job 'detail' page which will have more in-depth information on that job. I have been working with Orbited and Morbidq, and basically it works today by creating STOMP channels for each job, and on going to the detail page of a particular job my Javascript subscribes to the job channel /jobs/jobID ?using STOMP. I have a publisher that when there are any updates to the jobs publishes to the channel, and if any consumers are listening on that particular channel the page is updated with the new details.
>
> Now moving over to using RabbitMQ, and the stomp plugin, I understand that my setup will change slightly.
>
> I currently have a VHOST / , and I publish to an exchange, my understanding is that I have to send to a particular exchange "amq.topic" to be able to broadcast to more than one consumer that may or may not be listening. I don't care if my message doesn't ever get received as someone will not always be on the system.
>
> And then my STOMP consumer will listen to VHOST / and amq.topic ? But if I want to replicate my jobs channels, should I create a routing key, binding and different queues for each job? Records of jobs can stay on my system forever, but the period that they get updated is sporadic - much in the first minutes of their life, hardly ever after they have been finished.

I don't thin I understand what you mean by 'replicating jobs channels'.
Instead, let me focus on our STOMP plugin semantics.

First, the basic flow of AMQP messages goes like that:

[Producer]--->Exchange--->(using binding)--->Queue--->[Consumer]

You need to decide where to do dispatching of messages from multiple producers,
do you have a queue per customer or maybe many queues for every customer?
Does a 'customer' mean a browser session and or is it just a single page view?

Next problem is that the mapping of AMQP to STOMP is not straightforward,
it requires pretty good understanding of AMQP routing.

The best examples of STOMP and rabbitmq-stomp semantics that I'm aware of
are in the test file:
http://hg.rabbitmq.com/rabbitmq-stomp/file/0404cb2620df/test/test.py

For example the "test_broadcast" may be useful to you. The next example
"test_roundrobin" shows how to declare a named queue. Take look
at the subtle difference in 'destination:' headers between this and a
previous example.

Cheers,
  Marek

From tim at cantemo.com  Fri Aug 27 12:41:00 2010
From: tim at cantemo.com (Tim Child)
Date: Fri, 27 Aug 2010 13:41:00 +0200
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
In-Reply-To: <AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>
References: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
	<AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>
Message-ID: <DE2D21E1-F6C7-4EEA-B10F-2173201A3706@cantemo.com>

Thanks for your answer.

A job (task) is something that our web based system monitors - external system(s) do things for us as a Job, and we provide feedback on that. At the moment, its very old-school, if we want to see the status of a job we make a request to the external system and get the status and display it in our web interface. I want to move to a system where the external system sends us callbacks as the job progresses, and if anyone is on the web interface looking at that job they get updates on the status.

I am actually considering dropping STOMP, and writing consumers and broadcasters in AMQP. But the overall functionality will be the same,

I will have processes that will receive external notifications of updates on jobs (the callbacks) and should then place them onto a queue in RabbitMQ for that particular job, so any consumer that is listening to the queue gets a notification. (Broadcast, not round-robin).

Each Job will have its own queue, plus a queue for all Jobs.

The consumer, or customer is a browser session at the end of the day, using browser (Javascript) websocket - to a  proxy - to a long polling handler capable of listen to AMQP queues (thus getting rid of my STOMP need). The long polling handler listens to a queue as told by the browser, sending any feedback to the browser.

In more detail:

Browser ( Javascript, websocket)
       |
Orbited2.0 
       |
Tornado
       |
RabbitMQ


Tornado will handle the websockets, user authentication and connect to RabbitMQ using AMQP.

Thats it in theory. My question is really is there any glaring errors in this, and also about the queue setup - but I will look at your example.

Thanks,

Tim.



On 27 Aug 2010, at 13:20, Marek Majkowski wrote:

> Tim,
> 
> On Tue, Aug 24, 2010 at 14:15, Tim Child <tim at cantemo.com> wrote:
>> One part of my application is to provide realtime feedback on jobs going on in the system, there will be a job overview page, which will list the status of x number of jobs (probably about 40), and a job 'detail' page which will have more in-depth information on that job. I have been working with Orbited and Morbidq, and basically it works today by creating STOMP channels for each job, and on going to the detail page of a particular job my Javascript subscribes to the job channel /jobs/jobID  using STOMP. I have a publisher that when there are any updates to the jobs publishes to the channel, and if any consumers are listening on that particular channel the page is updated with the new details.
>> 
>> Now moving over to using RabbitMQ, and the stomp plugin, I understand that my setup will change slightly.
>> 
>> I currently have a VHOST / , and I publish to an exchange, my understanding is that I have to send to a particular exchange "amq.topic" to be able to broadcast to more than one consumer that may or may not be listening. I don't care if my message doesn't ever get received as someone will not always be on the system.
>> 
>> And then my STOMP consumer will listen to VHOST / and amq.topic ? But if I want to replicate my jobs channels, should I create a routing key, binding and different queues for each job? Records of jobs can stay on my system forever, but the period that they get updated is sporadic - much in the first minutes of their life, hardly ever after they have been finished.
> 
> I don't thin I understand what you mean by 'replicating jobs channels'.
> Instead, let me focus on our STOMP plugin semantics.
> 
> First, the basic flow of AMQP messages goes like that:
> 
> [Producer]--->Exchange--->(using binding)--->Queue--->[Consumer]
> 
> You need to decide where to do dispatching of messages from multiple producers,
> do you have a queue per customer or maybe many queues for every customer?
> Does a 'customer' mean a browser session and or is it just a single page view?
> 
> Next problem is that the mapping of AMQP to STOMP is not straightforward,
> it requires pretty good understanding of AMQP routing.
> 
> The best examples of STOMP and rabbitmq-stomp semantics that I'm aware of
> are in the test file:
> http://hg.rabbitmq.com/rabbitmq-stomp/file/0404cb2620df/test/test.py
> 
> For example the "test_broadcast" may be useful to you. The next example
> "test_roundrobin" shows how to declare a named queue. Take look
> at the subtle difference in 'destination:' headers between this and a
> previous example.
> 
> Cheers,
>  Marek

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com


From mikeb at rabbitmq.com  Fri Aug 27 13:11:28 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 27 Aug 2010 13:11:28 +0100
Subject: [rabbitmq-discuss] BAD signature on 2.0.0 tar.gz?
In-Reply-To: <4C768B0F.9010305@leapfrogonline.com>
References: <4C768B0F.9010305@leapfrogonline.com>
Message-ID: <4C77AB70.9040600@rabbitmq.com>

Jason,

> $ gpg --verify rabbitmq-server-2.0.0.tar.gz.asc 
> rabbitmq-server-2.0.0.tar.gz gpg: Signature made Mon 23 Aug 2010
> 10:06:35 AM EDT using DSA key ID 056E8E56 gpg: BAD signature from
> "RabbitMQ Release Signing Key <info at rabbitmq.com>"

I've uploaded the correct signature.  Thanks for reporting this.

Cheers,
Michael

From majek04 at gmail.com  Fri Aug 27 14:21:19 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 27 Aug 2010 14:21:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
In-Reply-To: <DE2D21E1-F6C7-4EEA-B10F-2173201A3706@cantemo.com>
References: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
	<AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>
	<DE2D21E1-F6C7-4EEA-B10F-2173201A3706@cantemo.com>
Message-ID: <AANLkTimQDv8hX9cOZOXHnYjKeCy5F38EY+Z-Nno0cfsy@mail.gmail.com>

Tim,

Two comments:
1) does Tornado speak AMQP? I don't know any python AMQP client that
will work correctly in Tornado environment. Have I missed anything?

2) I'm afraid the idea of one queue per job and one queue for all the
jobs is not good. As that implies that only a  _single_ consumer will
receive a message produced by a job. What you probably want is a
transient queue _for a page view_. That way, when someone views your
page, you create a queue in the background and bind it to a proper job
(via separate exchange for every job, or via a single amq.topic
exchange but with routing_key set in the messages from the jobs). In
that scenario if you had two browsers seeing the same page, they will
access two different queues. And a message send to an exchange will be
copied to both queues. This is what you may need.

Cheers,
  Marek

On Fri, Aug 27, 2010 at 12:41, Tim Child <tim at cantemo.com> wrote:
> Thanks for your answer.
>
> A job (task) is something that our web based system monitors - external system(s) do things for us as a Job, and we provide feedback on that. At the moment, its very old-school, if we want to see the status of a job we make a request to the external system and get the status and display it in our web interface. I want to move to a system where the external system sends us callbacks as the job progresses, and if anyone is on the web interface looking at that job they get updates on the status.
>
> I am actually considering dropping STOMP, and writing consumers and broadcasters in AMQP. But the overall functionality will be the same,
>
> I will have processes that will receive external notifications of updates on jobs (the callbacks) and should then place them onto a queue in RabbitMQ for that particular job, so any consumer that is listening to the queue gets a notification. (Broadcast, not round-robin).
>
> Each Job will have its own queue, plus a queue for all Jobs.
>
> The consumer, or customer is a browser session at the end of the day, using browser (Javascript) websocket - to a ?proxy - to a long polling handler capable of listen to AMQP queues (thus getting rid of my STOMP need). The long polling handler listens to a queue as told by the browser, sending any feedback to the browser.
>
> In more detail:
>
> Browser ( Javascript, websocket)
> ? ? ? |
> Orbited2.0
> ? ? ? |
> Tornado
> ? ? ? |
> RabbitMQ
>
>
> Tornado will handle the websockets, user authentication and connect to RabbitMQ using AMQP.
>
> Thats it in theory. My question is really is there any glaring errors in this, and also about the queue setup - but I will look at your example.
>
> Thanks,
>
> Tim.
>
>
>
> On 27 Aug 2010, at 13:20, Marek Majkowski wrote:
>
>> Tim,
>>
>> On Tue, Aug 24, 2010 at 14:15, Tim Child <tim at cantemo.com> wrote:
>>> One part of my application is to provide realtime feedback on jobs going on in the system, there will be a job overview page, which will list the status of x number of jobs (probably about 40), and a job 'detail' page which will have more in-depth information on that job. I have been working with Orbited and Morbidq, and basically it works today by creating STOMP channels for each job, and on going to the detail page of a particular job my Javascript subscribes to the job channel /jobs/jobID ?using STOMP. I have a publisher that when there are any updates to the jobs publishes to the channel, and if any consumers are listening on that particular channel the page is updated with the new details.
>>>
>>> Now moving over to using RabbitMQ, and the stomp plugin, I understand that my setup will change slightly.
>>>
>>> I currently have a VHOST / , and I publish to an exchange, my understanding is that I have to send to a particular exchange "amq.topic" to be able to broadcast to more than one consumer that may or may not be listening. I don't care if my message doesn't ever get received as someone will not always be on the system.
>>>
>>> And then my STOMP consumer will listen to VHOST / and amq.topic ? But if I want to replicate my jobs channels, should I create a routing key, binding and different queues for each job? Records of jobs can stay on my system forever, but the period that they get updated is sporadic - much in the first minutes of their life, hardly ever after they have been finished.
>>
>> I don't thin I understand what you mean by 'replicating jobs channels'.
>> Instead, let me focus on our STOMP plugin semantics.
>>
>> First, the basic flow of AMQP messages goes like that:
>>
>> [Producer]--->Exchange--->(using binding)--->Queue--->[Consumer]
>>
>> You need to decide where to do dispatching of messages from multiple producers,
>> do you have a queue per customer or maybe many queues for every customer?
>> Does a 'customer' mean a browser session and or is it just a single page view?
>>
>> Next problem is that the mapping of AMQP to STOMP is not straightforward,
>> it requires pretty good understanding of AMQP routing.
>>
>> The best examples of STOMP and rabbitmq-stomp semantics that I'm aware of
>> are in the test file:
>> http://hg.rabbitmq.com/rabbitmq-stomp/file/0404cb2620df/test/test.py
>>
>> For example the "test_broadcast" may be useful to you. The next example
>> "test_roundrobin" shows how to declare a named queue. Take look
>> at the subtle difference in 'destination:' headers between this and a
>> previous example.
>>
>> Cheers,
>> ?Marek
>
> Tim Child
> +46 (0) 7602 17785
> Skype: timchild
> http://www.cantemo.com
>
>

From david at rabbitmq.com  Fri Aug 27 14:34:17 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 27 Aug 2010 14:34:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
In-Reply-To: <AANLkTimQDv8hX9cOZOXHnYjKeCy5F38EY+Z-Nno0cfsy@mail.gmail.com>
	(Marek Majkowski's message of "Fri, 27 Aug 2010 14:21:19 +0100")
References: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
	<AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>
	<DE2D21E1-F6C7-4EEA-B10F-2173201A3706@cantemo.com>
	<AANLkTimQDv8hX9cOZOXHnYjKeCy5F38EY+Z-Nno0cfsy@mail.gmail.com>
Message-ID: <yrv4csk2041t2.fsf@dwragg.eng.vmware.com>

Marek Majkowski <majek04 at gmail.com> writes:
> Two comments:
> 1) does Tornado speak AMQP? I don't know any python AMQP client that
> will work correctly in Tornado environment. Have I missed anything?

Openstack Compute currently uses py-amqplib under Tornado:

http://bazaar.launchpad.net/~hudson-openstack/nova/trunk/annotate/257/nova/rpc.py#L86

But the approach they use is very ugly, and they are moving away from
Tornado, I believe.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From tim at cantemo.com  Fri Aug 27 15:32:42 2010
From: tim at cantemo.com (Tim Child)
Date: Fri, 27 Aug 2010 16:32:42 +0200
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
In-Reply-To: <AANLkTimQDv8hX9cOZOXHnYjKeCy5F38EY+Z-Nno0cfsy@mail.gmail.com>
References: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
	<AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>
	<DE2D21E1-F6C7-4EEA-B10F-2173201A3706@cantemo.com>
	<AANLkTimQDv8hX9cOZOXHnYjKeCy5F38EY+Z-Nno0cfsy@mail.gmail.com>
Message-ID: <046E08A3-CAE9-4B32-AF9F-6744381BAEBB@cantemo.com>

I was going to use py-amqplib with Tornado.

You are right I don't want just a single consumer per job, I want to be able to attach multiple consumers. I don't care if the messages are lost because no one is looking at them in this case.

My use case for queue for all jobs isn't very strong - getting an overview of what is happening on multiple jobs at the same time. Another use case for me, is that upon a certain message on the queue, I can hook up jobs - such as starting other jobs off when a job is finished.. 

So basically what you are saying is that I can't have multiple consumers in the way I want? What about if I was building a stock ticker watcher - hundreds of clients viewing what is happening to the same 20 stocks? Its the same scenario. Would this be done in using the exchange mechnism you are proposing?

Thanks for your time.

Tim.



On 27 Aug 2010, at 15:21, Marek Majkowski wrote:

> Tim,
> 
> Two comments:
> 1) does Tornado speak AMQP? I don't know any python AMQP client that
> will work correctly in Tornado environment. Have I missed anything?
> 
> 2) I'm afraid the idea of one queue per job and one queue for all the
> jobs is not good. As that implies that only a  _single_ consumer will
> receive a message produced by a job. What you probably want is a
> transient queue _for a page view_. That way, when someone views your
> page, you create a queue in the background and bind it to a proper job
> (via separate exchange for every job, or via a single amq.topic
> exchange but with routing_key set in the messages from the jobs). In
> that scenario if you had two browsers seeing the same page, they will
> access two different queues. And a message send to an exchange will be
> copied to both queues. This is what you may need.
> 
> Cheers,
>  Marek
> 
> On Fri, Aug 27, 2010 at 12:41, Tim Child <tim at cantemo.com> wrote:
>> Thanks for your answer.
>> 
>> A job (task) is something that our web based system monitors - external system(s) do things for us as a Job, and we provide feedback on that. At the moment, its very old-school, if we want to see the status of a job we make a request to the external system and get the status and display it in our web interface. I want to move to a system where the external system sends us callbacks as the job progresses, and if anyone is on the web interface looking at that job they get updates on the status.
>> 
>> I am actually considering dropping STOMP, and writing consumers and broadcasters in AMQP. But the overall functionality will be the same,
>> 
>> I will have processes that will receive external notifications of updates on jobs (the callbacks) and should then place them onto a queue in RabbitMQ for that particular job, so any consumer that is listening to the queue gets a notification. (Broadcast, not round-robin).
>> 
>> Each Job will have its own queue, plus a queue for all Jobs.
>> 
>> The consumer, or customer is a browser session at the end of the day, using browser (Javascript) websocket - to a  proxy - to a long polling handler capable of listen to AMQP queues (thus getting rid of my STOMP need). The long polling handler listens to a queue as told by the browser, sending any feedback to the browser.
>> 
>> In more detail:
>> 
>> Browser ( Javascript, websocket)
>>       |
>> Orbited2.0
>>       |
>> Tornado
>>       |
>> RabbitMQ
>> 
>> 
>> Tornado will handle the websockets, user authentication and connect to RabbitMQ using AMQP.
>> 
>> Thats it in theory. My question is really is there any glaring errors in this, and also about the queue setup - but I will look at your example.
>> 
>> Thanks,
>> 
>> Tim.
>> 
>> 
>> 
>> On 27 Aug 2010, at 13:20, Marek Majkowski wrote:
>> 
>>> Tim,
>>> 
>>> On Tue, Aug 24, 2010 at 14:15, Tim Child <tim at cantemo.com> wrote:
>>>> One part of my application is to provide realtime feedback on jobs going on in the system, there will be a job overview page, which will list the status of x number of jobs (probably about 40), and a job 'detail' page which will have more in-depth information on that job. I have been working with Orbited and Morbidq, and basically it works today by creating STOMP channels for each job, and on going to the detail page of a particular job my Javascript subscribes to the job channel /jobs/jobID  using STOMP. I have a publisher that when there are any updates to the jobs publishes to the channel, and if any consumers are listening on that particular channel the page is updated with the new details.
>>>> 
>>>> Now moving over to using RabbitMQ, and the stomp plugin, I understand that my setup will change slightly.
>>>> 
>>>> I currently have a VHOST / , and I publish to an exchange, my understanding is that I have to send to a particular exchange "amq.topic" to be able to broadcast to more than one consumer that may or may not be listening. I don't care if my message doesn't ever get received as someone will not always be on the system.
>>>> 
>>>> And then my STOMP consumer will listen to VHOST / and amq.topic ? But if I want to replicate my jobs channels, should I create a routing key, binding and different queues for each job? Records of jobs can stay on my system forever, but the period that they get updated is sporadic - much in the first minutes of their life, hardly ever after they have been finished.
>>> 
>>> I don't thin I understand what you mean by 'replicating jobs channels'.
>>> Instead, let me focus on our STOMP plugin semantics.
>>> 
>>> First, the basic flow of AMQP messages goes like that:
>>> 
>>> [Producer]--->Exchange--->(using binding)--->Queue--->[Consumer]
>>> 
>>> You need to decide where to do dispatching of messages from multiple producers,
>>> do you have a queue per customer or maybe many queues for every customer?
>>> Does a 'customer' mean a browser session and or is it just a single page view?
>>> 
>>> Next problem is that the mapping of AMQP to STOMP is not straightforward,
>>> it requires pretty good understanding of AMQP routing.
>>> 
>>> The best examples of STOMP and rabbitmq-stomp semantics that I'm aware of
>>> are in the test file:
>>> http://hg.rabbitmq.com/rabbitmq-stomp/file/0404cb2620df/test/test.py
>>> 
>>> For example the "test_broadcast" may be useful to you. The next example
>>> "test_roundrobin" shows how to declare a named queue. Take look
>>> at the subtle difference in 'destination:' headers between this and a
>>> previous example.
>>> 
>>> Cheers,
>>>  Marek
>> 
>> Tim Child
>> +46 (0) 7602 17785
>> Skype: timchild
>> http://www.cantemo.com
>> 
>> 

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com


From tim at cantemo.com  Fri Aug 27 15:33:26 2010
From: tim at cantemo.com (Tim Child)
Date: Fri, 27 Aug 2010 16:33:26 +0200
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
In-Reply-To: <yrv4csk2041t2.fsf@dwragg.eng.vmware.com>
References: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
	<AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>
	<DE2D21E1-F6C7-4EEA-B10F-2173201A3706@cantemo.com>
	<AANLkTimQDv8hX9cOZOXHnYjKeCy5F38EY+Z-Nno0cfsy@mail.gmail.com>
	<yrv4csk2041t2.fsf@dwragg.eng.vmware.com>
Message-ID: <924D0EBA-D616-4EAE-BCF2-7DF232025CDB@cantemo.com>

Interesting,

Do you know why they are moving away from it?

Cheers,

Tim.

On 27 Aug 2010, at 15:34, David Wragg wrote:

> Marek Majkowski <majek04 at gmail.com> writes:
>> Two comments:
>> 1) does Tornado speak AMQP? I don't know any python AMQP client that
>> will work correctly in Tornado environment. Have I missed anything?
> 
> Openstack Compute currently uses py-amqplib under Tornado:
> 
> http://bazaar.launchpad.net/~hudson-openstack/nova/trunk/annotate/257/nova/rpc.py#L86
> 
> But the approach they use is very ugly, and they are moving away from
> Tornado, I believe.
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com


From david at rabbitmq.com  Fri Aug 27 15:46:49 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 27 Aug 2010 15:46:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
In-Reply-To: <924D0EBA-D616-4EAE-BCF2-7DF232025CDB@cantemo.com> (Tim Child's
	message of "Fri, 27 Aug 2010 16:33:26 +0200")
References: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
	<AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>
	<DE2D21E1-F6C7-4EEA-B10F-2173201A3706@cantemo.com>
	<AANLkTimQDv8hX9cOZOXHnYjKeCy5F38EY+Z-Nno0cfsy@mail.gmail.com>
	<yrv4csk2041t2.fsf@dwragg.eng.vmware.com>
	<924D0EBA-D616-4EAE-BCF2-7DF232025CDB@cantemo.com>
Message-ID: <yrv4clj7s3yg6.fsf@dwragg.eng.vmware.com>

Tim Child <tim at cantemo.com> writes:
> Do you know why they are moving away from it [Tornado]?

Because they want to standardize around either Twisted or Eventlet (at
the moment, OpenStack uses all three).  Their web services (such as
their implementation of the Amazon AWS APIs) typically make requests
over the network to other software components (often over rabbit).  So
they need a framework that makes it easy to do non-blocking clients
within a non-blocking server.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jon at jbrisbin.com  Fri Aug 27 15:48:09 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 27 Aug 2010 09:48:09 -0500
Subject: [rabbitmq-discuss] webhooks plugin now has gzip support
Message-ID: <281A465F-9595-4806-B054-7A8BDE6DD69C@jbrisbin.com>

Just pushed to Github a couple changes to the webhooks plugin:

1) To announce itself to the REST service via custom "X-Requested-With" header ("RabbitMQ-Webhooks")
2) Added an "X-ReplyTo" header to help the REST service reply to messages
3) Added support for gzipping content from REST service back to the plugin (for eventually re-queueing responses based on return "X-Replyto-Exchange", etc... headers)

http://github.com/jbrisbin/rabbitmq-webhooks

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100827/e2f2f0c6/attachment.htm>

From david at rabbitmq.com  Fri Aug 27 16:38:23 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 27 Aug 2010 16:38:23 +0100
Subject: [rabbitmq-discuss] AMQP on Windows CE
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>
	(Andrius Norkaitis's message of "Fri, 27 Aug 2010 00:41:47 +0300")
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>
Message-ID: <yrv4chbig3w28.fsf@dwragg.eng.vmware.com>

Hi Andrius,

"Andrius Norkaitis" <andrius.norkaitis at oryo.lt> writes:
> I would like to know if someone already use or did the source code port of
> AMQP client API to run on Windows CE operating system ? 

What programming language/platform are you using to develop your Windows
CE applications?

(Forgive me if there is an obvious answer to this question; I'm not very
familiar with WinCE.)

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jon at jbrisbin.com  Fri Aug 27 17:21:41 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 27 Aug 2010 11:21:41 -0500
Subject: [rabbitmq-discuss] more goodies for webhooks plugin
Message-ID: <FD6F1D99-FA1A-4FB8-BF3A-A7A06403A356@jbrisbin.com>

Just pushed some more changes:

1) URLs are parameter-replaced with message headers that don't start with an "X-". "http://localhost:8000/rest/{oid}" will be replaced with the value of "oid" from the message headers before calling the URL. The part between the {}'s is a regex, actually, not a simple parameter name, so all the problems/features that come with regex matches will apply here.

2) URLs and HTTP methods are overrideable on a per-message basis. Each message can tell the plugin where to send it by including a "url" and/or "method" header.

3) Any message headers that start with "X-" are considered HTTP headers and are passed on to the REST URL as-is. Headers that do NOT start with an "X-" are considered "parameters" for the URL replacement, and are not sent through to the REST URL (that's what the message body is for).

I need to do a couple wiki pages before I get too much farther. :)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100827/eb70bac6/attachment.htm>

From markfisher at vmware.com  Fri Aug 27 17:34:35 2010
From: markfisher at vmware.com (Mark Fisher)
Date: Fri, 27 Aug 2010 09:34:35 -0700
Subject: [rabbitmq-discuss] basicConsume() change in 2.0 Java client
Message-ID: <392922E81643B245A905B42E3E34C24014D3516C87@EXCH-MBX-1.vmware.com>

In 1.8.1, the following basicConsume() method existed on Channel:
    String basicConsume(String queue, boolean noAck, String consumerTag, boolean noLocal, boolean exclusive, Consumer callback) throws IOException;

In 2.0.0, that particular signature is no longer available, but a new version containing a "filter" Map as the penultimate argument does exist. However, as shown below, there is no documentation for that argument in the JavaDoc. Could someone please explain the role of the "filter"?... and is NULL allowed?

    /**
     * Start a consumer. Calls the consumer's {@link Consumer#handleConsumeOk}
     * method before returning.
     * @param queue the name of the queue
     * @param noAck true if no handshake is required
     * @param consumerTag a client-generated consumer tag to establish context
     * @param noLocal flag set to true unless server local buffering is required
     * @param exclusive true if this is an exclusive consumer
     * @param callback an interface to the consumer object
     * @return the consumerTag associated with the new consumer
     * @throws java.io.IOException if an error is encountered
     * @see com.rabbitmq.client.AMQP.Basic.Consume
     * @see com.rabbitmq.client.AMQP.Basic.ConsumeOk
     */
    String basicConsume(String queue, boolean noAck, String consumerTag, boolean noLocal, boolean exclusive, Map<String, Object> filter, Consumer callback) throws IOException;

Thanks,
Mark

From andrius.norkaitis at oryo.lt  Fri Aug 27 18:17:31 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Fri, 27 Aug 2010 20:17:31 +0300
Subject: [rabbitmq-discuss] AMQP on Windows CE
In-Reply-To: <yrv4chbig3w28.fsf@dwragg.eng.vmware.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>
	<yrv4chbig3w28.fsf@dwragg.eng.vmware.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACwv9x25VzBPtBYobneQQm4BAAAAAA==@oryo.lt>

We're using Microsoft .NET. As I know RabbitMQ .NET Client is not directly
compatible with Microsoft .NET Compact Framework, isn't it?.
My question is maybe somebody ported it to work on .NET Compact or has
experience by using other client with interop.

Best,
Andrius Norkaitis


-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: Friday, August 27, 2010 6:38 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] AMQP on Windows CE

Hi Andrius,

"Andrius Norkaitis" <andrius.norkaitis at oryo.lt> writes:
> I would like to know if someone already use or did the source code 
> port of AMQP client API to run on Windows CE operating system ?

What programming language/platform are you using to develop your Windows CE
applications?

(Forgive me if there is an obvious answer to this question; I'm not very
familiar with WinCE.)

David

--
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri Aug 27 18:39:44 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 Aug 2010 18:39:44 +0100
Subject: [rabbitmq-discuss] basicConsume() change in 2.0 Java client
In-Reply-To: <392922E81643B245A905B42E3E34C24014D3516C87@EXCH-MBX-1.vmware.com>
References: <392922E81643B245A905B42E3E34C24014D3516C87@EXCH-MBX-1.vmware.com>
Message-ID: <4C77F860.5080907@rabbitmq.com>

On 27/08/10 17:34, Mark Fisher wrote:
> In 2.0.0, that particular signature is no longer available, but a new
> version containing a "filter" Map as the penultimate argument does
> exist. However, as shown below, there is no documentation for that
> argument in the JavaDoc. Could someone please explain the role of the
> "filter"?... and is NULL allowed?

Very short answer before the weekend:

It's in AMQP 0-9-1. RabbitMQ does nothing with it (yet!). null is allowed.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From alexis at rabbitmq.com  Fri Aug 27 19:20:06 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 27 Aug 2010 19:20:06 +0100
Subject: [rabbitmq-discuss] AMQP on Windows CE
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACwv9x25VzBPtBYobneQQm4BAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>
	<yrv4chbig3w28.fsf@dwragg.eng.vmware.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACwv9x25VzBPtBYobneQQm4BAAAAAA==@oryo.lt>
Message-ID: <AANLkTimBLLghW61V2tsAFrcvxrYi=GZDO03fEScKzGbQ@mail.gmail.com>

Andrius

I checked the archives and afaict only you have spoken up on this in the past!

Do you know why the .NET client might not work on WinCE?

alexis


On Fri, Aug 27, 2010 at 6:17 PM, Andrius Norkaitis
<andrius.norkaitis at oryo.lt> wrote:
> We're using Microsoft .NET. As I know RabbitMQ .NET Client is not directly
> compatible with Microsoft .NET Compact Framework, isn't it?.
> My question is maybe somebody ported it to work on .NET Compact or has
> experience by using other client with interop.
>
> Best,
> Andrius Norkaitis
>
>
> -----Original Message-----
> From: David Wragg [mailto:david at rabbitmq.com]
> Sent: Friday, August 27, 2010 6:38 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
>
> Hi Andrius,
>
> "Andrius Norkaitis" <andrius.norkaitis at oryo.lt> writes:
>> I would like to know if someone already use or did the source code
>> port of AMQP client API to run on Windows CE operating system ?
>
> What programming language/platform are you using to develop your Windows CE
> applications?
>
> (Forgive me if there is an obvious answer to this question; I'm not very
> familiar with WinCE.)
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From andrius.norkaitis at oryo.lt  Sat Aug 28 00:20:04 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Sat, 28 Aug 2010 02:20:04 +0300
Subject: [rabbitmq-discuss] AMQP on Windows CE
In-Reply-To: <AANLkTimBLLghW61V2tsAFrcvxrYi=GZDO03fEScKzGbQ@mail.gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>	<yrv4chbig3w28.fsf@dwragg.eng.vmware.com>	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACwv9x25VzBPtBYobneQQm4BAAAAAA==@oryo.lt>
	<AANLkTimBLLghW61V2tsAFrcvxrYi=GZDO03fEScKzGbQ@mail.gmail.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAJQQ2PBVBzpCs/OnVIcmCE8BAAAAAA==@oryo.lt>

Last time I tried using Rabbit .NET client in Windows Mobile/CE, some .NET
function which was used was missing in .NET Compact.
Maybe somebody has some ideas and want to look for solution? I'm not very
familiar with source code of Rabbit .NET client, but I would be glad to
help.
Bringing RabbitMQ to mobile platforms would open so much possibilities...

Best,
Andrius Norkaitis


-----Original Message-----
From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On
Behalf Of Alexis Richardson
Sent: Friday, August 27, 2010 9:20 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] AMQP on Windows CE

Andrius

I checked the archives and afaict only you have spoken up on this in the
past!

Do you know why the .NET client might not work on WinCE?

alexis


On Fri, Aug 27, 2010 at 6:17 PM, Andrius Norkaitis
<andrius.norkaitis at oryo.lt> wrote:
> We're using Microsoft .NET. As I know RabbitMQ .NET Client is not 
> directly compatible with Microsoft .NET Compact Framework, isn't it?.
> My question is maybe somebody ported it to work on .NET Compact or has 
> experience by using other client with interop.
>
> Best,
> Andrius Norkaitis
>
>
> -----Original Message-----
> From: David Wragg [mailto:david at rabbitmq.com]
> Sent: Friday, August 27, 2010 6:38 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
>
> Hi Andrius,
>
> "Andrius Norkaitis" <andrius.norkaitis at oryo.lt> writes:
>> I would like to know if someone already use or did the source code 
>> port of AMQP client API to run on Windows CE operating system ?
>
> What programming language/platform are you using to develop your 
> Windows CE applications?
>
> (Forgive me if there is an obvious answer to this question; I'm not 
> very familiar with WinCE.)
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From nishtiak at mail.ua  Sat Aug 28 05:24:52 2010
From: nishtiak at mail.ua (=?UTF-8?B?0J7Qu9C10LrRgdCw0L3QtNGAINCR0L7QudC60L4=?=)
Date: Sat, 28 Aug 2010 07:24:52 +0300
Subject: [rabbitmq-discuss] =?utf-8?q?Error=3A_invalid_command?=
In-Reply-To: <4C6DF54A.4090600.rabbitmq.com>
References: <4C6DF54A.4090600.rabbitmq.com>
Message-ID: <1282969492.80Fe0.3126@mail.ua>

>  Did you manage to resolve this?
>  
>  
>  Regards,
>  
>  Matthias.
>  

Yes. I installed Debian.

From tim at cantemo.com  Sat Aug 28 09:05:47 2010
From: tim at cantemo.com (Tim Child)
Date: Sat, 28 Aug 2010 10:05:47 +0200
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
References: <20100828012138.4FBC513B625@lists.rabbitmq.com>
Message-ID: <B2E03925-E32E-4BDA-AD09-07F15516CACD@cantemo.com>

Thanks for your answer.

A job (task) is something that our web based system monitors - external system(s) do things for us as a Job, and we provide feedback on that. At the moment, its very old-school, if we want to see the status of a job we make a request to the external system and get the status and display it in our web interface. I want to move to a system where the external system sends us callbacks as the job progresses, and if anyone is on the web interface looking at that job they get updates on the status.

I am actually considering dropping STOMP, and writing consumers and broadcasters in AMQP. But the overall functionality will be the same,

I will have processes that will receive external notifications of updates on jobs (the callbacks) and should then place them onto a queue in RabbitMQ for that particular job, so any consumer that is listening to the queue gets a notification. (Broadcast, not round-robin).

Each Job will have its own queue, plus a queue for all Jobs.

The consumer, or customer is a browser session at the end of the day, using browser (Javascript) websocket - to a  proxy - to a long polling handler capable of listen to AMQP queues (thus getting rid of my STOMP need). The long polling handler listens to a queue as told by the browser, sending any feedback to the browser.

In more detail:

Browser ( Javascript, websocket)
      |
Orbited2.0 
      |
Tornado
      |
RabbitMQ


Tornado will handle the websockets, user authentication and connect to RabbitMQ using AMQP.

Thats it in theory. My question is really is there any glaring errors in this, and also about the queue setup - but I will look at your example.

Thanks,

Tim.


On 27 Aug 2010, at 13:20, Marek Majkowski wrote:

> Tim,
> 
> On Tue, Aug 24, 2010 at 14:15, Tim Child <tim at cantemo.com> wrote:
>> One part of my application is to provide realtime feedback on jobs going on in the system, there will be a job overview page, which will list the status of x number of jobs (probably about 40), and a job 'detail' page which will have more in-depth information on that job. I have been working with Orbited and Morbidq, and basically it works today by creating STOMP channels for each job, and on going to the detail page of a particular job my Javascript subscribes to the job channel /jobs/jobID  using STOMP. I have a publisher that when there are any updates to the jobs publishes to the channel, and if any consumers are listening on that particular channel the page is updated with the new details.
>> 
>> Now moving over to using RabbitMQ, and the stomp plugin, I understand that my setup will change slightly.
>> 
>> I currently have a VHOST / , and I publish to an exchange, my understanding is that I have to send to a particular exchange "amq.topic" to be able to broadcast to more than one consumer that may or may not be listening. I don't care if my message doesn't ever get received as someone will not always be on the system.
>> 
>> And then my STOMP consumer will listen to VHOST / and amq.topic ? But if I want to replicate my jobs channels, should I create a routing key, binding and different queues for each job? Records of jobs can stay on my system forever, but the period that they get updated is sporadic - much in the first minutes of their life, hardly ever after they have been finished.
> 
> I don't thin I understand what you mean by 'replicating jobs channels'.
> Instead, let me focus on our STOMP plugin semantics.
> 
> First, the basic flow of AMQP messages goes like that:
> 
> [Producer]--->Exchange--->(using binding)--->Queue--->[Consumer]
> 
> You need to decide where to do dispatching of messages from multiple producers,
> do you have a queue per customer or maybe many queues for every customer?
> Does a 'customer' mean a browser session and or is it just a single page view?
> 
> Next problem is that the mapping of AMQP to STOMP is not straightforward,
> it requires pretty good understanding of AMQP routing.
> 
> The best examples of STOMP and rabbitmq-stomp semantics that I'm aware of
> are in the test file:
> http://hg.rabbitmq.com/rabbitmq-stomp/file/0404cb2620df/test/test.py
> 
> For example the "test_broadcast" may be useful to you. The next example
> "test_roundrobin" shows how to declare a named queue. Take look
> at the subtle difference in 'destination:' headers between this and a
> previous example.
> 
> Cheers,
> Marek

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100828/39a5812e/attachment-0001.htm>

From jon at jbrisbin.com  Sat Aug 28 16:42:40 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sat, 28 Aug 2010 10:42:40 -0500
Subject: [rabbitmq-discuss] use worker_pool from plugins?
Message-ID: <EE001552-6AB5-4144-B0D7-EF9FAAB7362A@jbrisbin.com>

I'm needing to be a little more careful about how I submit HTTP requests in my webhooks plugin and in searching around, I see that RabbitMQ has a worker_pool already. Rather than implement something similar myself, I was wondering if plugins could submit functions to the worker_pool or if they need to manage their own copy of worker_pool_sup, etc...?


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100828/1b799d65/attachment.htm>

From matthew at rabbitmq.com  Sat Aug 28 16:46:20 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 28 Aug 2010 16:46:20 +0100
Subject: [rabbitmq-discuss] use worker_pool from plugins?
In-Reply-To: <EE001552-6AB5-4144-B0D7-EF9FAAB7362A@jbrisbin.com>
References: <EE001552-6AB5-4144-B0D7-EF9FAAB7362A@jbrisbin.com>
Message-ID: <20100828154620.GA27464@rabbitmq.com>

On Sat, Aug 28, 2010 at 10:42:40AM -0500, Jon Brisbin wrote:
> I'm needing to be a little more careful about how I submit HTTP requests in my webhooks plugin and in searching around, I see that RabbitMQ has a worker_pool already. Rather than implement something similar myself, I was wondering if plugins could submit functions to the worker_pool or if they need to manage their own copy of worker_pool_sup, etc...?

No, you're perfectly welcome to use that. I assume the tasks you're
submitting are fairly short tasks and that you're just trying to limit
parallelism?

Matthew

From jon at jbrisbin.com  Sat Aug 28 16:56:28 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sat, 28 Aug 2010 10:56:28 -0500
Subject: [rabbitmq-discuss] use worker_pool from plugins?
In-Reply-To: <20100828154620.GA27464@rabbitmq.com>
References: <EE001552-6AB5-4144-B0D7-EF9FAAB7362A@jbrisbin.com>
	<20100828154620.GA27464@rabbitmq.com>
Message-ID: <51B7DAB6-0301-439B-AAF6-043C1DBF1A4F@jbrisbin.com>


On Aug 28, 2010, at 10:46 AM, Matthew Sackman wrote:

> On Sat, Aug 28, 2010 at 10:42:40AM -0500, Jon Brisbin wrote:
>> I'm needing to be a little more careful about how I submit HTTP requests in my webhooks plugin and in searching around, I see that RabbitMQ has a worker_pool already. Rather than implement something similar myself, I was wondering if plugins could submit functions to the worker_pool or if they need to manage their own copy of worker_pool_sup, etc...?
> 
> No, you're perfectly welcome to use that. I assume the tasks you're
> submitting are fairly short tasks and that you're just trying to limit
> parallelism?
> 
> Matthew


That's exactly it. I want to control how quickly I swamp the app server on the other end of the webhook. :)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100828/745ba2f3/attachment.htm>

From matthew at rabbitmq.com  Sat Aug 28 17:11:37 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 28 Aug 2010 17:11:37 +0100
Subject: [rabbitmq-discuss] use worker_pool from plugins?
In-Reply-To: <51B7DAB6-0301-439B-AAF6-043C1DBF1A4F@jbrisbin.com>
References: <EE001552-6AB5-4144-B0D7-EF9FAAB7362A@jbrisbin.com>
	<20100828154620.GA27464@rabbitmq.com>
	<51B7DAB6-0301-439B-AAF6-043C1DBF1A4F@jbrisbin.com>
Message-ID: <20100828161137.GB27464@rabbitmq.com>

On Sat, Aug 28, 2010 at 10:56:28AM -0500, Jon Brisbin wrote:
> That's exactly it. I want to control how quickly I swamp the app server on the other end of the webhook. :)

Ok, that's a very good fit then. If you also need to gather results in
from these tasks but want to submit async then look at gatherer.erl (or
probably more illuminating are the places where it's used).

Matthew

From stevvooe at gmail.com  Sun Aug 29 09:50:01 2010
From: stevvooe at gmail.com (Stephen Day)
Date: Sun, 29 Aug 2010 01:50:01 -0700
Subject: [rabbitmq-discuss] Python AMQPLib causes exception when trying to
	declare queue with X-Expires
Message-ID: <AANLkTi=_anQJDOqxGO5gWGA7=YnGwMyJMT2VQRVsn_dK@mail.gmail.com>

Here is the traceback showing the exception as thrown by amqplib, with
the channel exception code:

>>> ch.queue_declare('bdirect', arguments={"x-expires": 600})
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/channel.py",
line 1294, in queue_declare
    (50, 11),    # Channel.queue_declare_ok
  File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/abstract_channel.py",
line 105, in wait
    return amqp_method(self, args)
  File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/channel.py",
line 273, in _close
    (class_id, method_id))
amqplib.client_0_8.exceptions.AMQPChannelException: (406,
u"PRECONDITION_FAILED - invalid arg 'x-expires' for queue 'bdirect' in
vhost '/': expires_not_of_type_long", (50, 10),
'Channel.queue_declare')

In the library code, it looks like it properly packs the integer, but
0-8 doesn't support the desired integer type:

amqplib/client_0_8/serialization.py

372             elif isinstance(v, (int, long)):
373                 table_data.write('I')
374                 table_data.write(pack('>i', v))

The problem might actually lie in the server side parser code:

src/rabbit_binary_parser.erl

99 parse_field_value(<<"l", Value:64/signed, Rest/binary>>) ->
100     {long, Value, Rest};

The 0-8 specification doesn't define a long type outside of the "I"
type, so this excludes this feature (which is a *great* feature) from
older clients.

You should probably just have x-expires look for a regular 0-8
supported, 4-byte "I"-type integer. It will limit queue time expiry
maximum to 68 years, but one has to make design tradeoffs every once
and awhile ;).

Good work on the 2.0 release. Its looking fantastic thus far.

Stephen

From stevvooe at gmail.com  Sun Aug 29 09:57:12 2010
From: stevvooe at gmail.com (Stephen Day)
Date: Sun, 29 Aug 2010 01:57:12 -0700
Subject: [rabbitmq-discuss] Python AMQPLib causes exception when trying
	to declare queue with X-Expires
In-Reply-To: <AANLkTi=_anQJDOqxGO5gWGA7=YnGwMyJMT2VQRVsn_dK@mail.gmail.com>
References: <AANLkTi=_anQJDOqxGO5gWGA7=YnGwMyJMT2VQRVsn_dK@mail.gmail.com>
Message-ID: <AANLkTimTfh37uE+Pq3WVzw3K+mSTyCg+SDgY6f+QkMj_@mail.gmail.com>

Small correction:

x-expires granularity is in milliseconds, so changing to a 4 byte
integer will limit the expiry range to 24 days, which doesn't provide
as much headroom.

On Sun, Aug 29, 2010 at 1:50 AM, Stephen Day <stevvooe at gmail.com> wrote:
> Here is the traceback showing the exception as thrown by amqplib, with
> the channel exception code:
>
>>>> ch.queue_declare('bdirect', arguments={"x-expires": 600})
> Traceback (most recent call last):
> ?File "<stdin>", line 1, in <module>
> ?File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/channel.py",
> line 1294, in queue_declare
> ? ?(50, 11), ? ?# Channel.queue_declare_ok
> ?File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/abstract_channel.py",
> line 105, in wait
> ? ?return amqp_method(self, args)
> ?File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/channel.py",
> line 273, in _close
> ? ?(class_id, method_id))
> amqplib.client_0_8.exceptions.AMQPChannelException: (406,
> u"PRECONDITION_FAILED - invalid arg 'x-expires' for queue 'bdirect' in
> vhost '/': expires_not_of_type_long", (50, 10),
> 'Channel.queue_declare')
>
> In the library code, it looks like it properly packs the integer, but
> 0-8 doesn't support the desired integer type:
>
> amqplib/client_0_8/serialization.py
>
> 372 ? ? ? ? ? ? elif isinstance(v, (int, long)):
> 373 ? ? ? ? ? ? ? ? table_data.write('I')
> 374 ? ? ? ? ? ? ? ? table_data.write(pack('>i', v))
>
> The problem might actually lie in the server side parser code:
>
> src/rabbit_binary_parser.erl
>
> 99 parse_field_value(<<"l", Value:64/signed, Rest/binary>>) ->
> 100 ? ? {long, Value, Rest};
>
> The 0-8 specification doesn't define a long type outside of the "I"
> type, so this excludes this feature (which is a *great* feature) from
> older clients.
>
> You should probably just have x-expires look for a regular 0-8
> supported, 4-byte "I"-type integer. It will limit queue time expiry
> maximum to 68 years, but one has to make design tradeoffs every once
> and awhile ;).
>
> Good work on the 2.0 release. Its looking fantastic thus far.
>
> Stephen
>

From frank.goenninger at consequor.de  Sun Aug 29 11:56:23 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Sun, 29 Aug 2010 12:56:23 +0200
Subject: [rabbitmq-discuss] C client library for RabbitMQ using VS2010 as
	build tool
Message-ID: <5715E584-556B-47F4-8149-D54511164BD8@consequor.de>

Hi again,

a couple of weeks (months?) ago I announced here that we are working on a "native" DLL for the C client lib. Well, finally, here it is:

http://github.com/dg1sbg/librabbitmq

This contains (see the README there) "only" the librabbitmq part of the C client lib. Tests, examples etc still open, but I wanted to make sure everybody is aware that we are making progress. Comments, feedback, hints, bug reports all really welcome!

Cheers
  Frank

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From pdezwart at rubiconproject.com  Mon Aug 30 05:09:23 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 30 Aug 2010 00:09:23 -0400
Subject: [rabbitmq-discuss] C client library for RabbitMQ using VS2010
	asbuild tool
Message-ID: <7C1046148D91C244A98F4C14673588670232FAC2@BE43.exg3.exghost.com>

This is fantastic. Is this stable or how long before you have something stable? I need to start working on the PHP library and want to know what the deal is =)

Pieter



----- Original Message -----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com <rabbitmq-discuss-bounces at lists.rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Sun Aug 29 06:56:23 2010
Subject: [rabbitmq-discuss] C client library for RabbitMQ using VS2010 asbuild tool

Hi again,

a couple of weeks (months?) ago I announced here that we are working on a "native" DLL for the C client lib. Well, finally, here it is:

http://github.com/dg1sbg/librabbitmq

This contains (see the README there) "only" the librabbitmq part of the C client lib. Tests, examples etc still open, but I wanted to make sure everybody is aware that we are making progress. Comments, feedback, hints, bug reports all really welcome!

Cheers
  Frank

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100830/39313074/attachment.htm>

From abhishek.kona at gmail.com  Mon Aug 30 09:51:30 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Mon, 30 Aug 2010 14:21:30 +0530
Subject: [rabbitmq-discuss] Unique Message IDs
Message-ID: <4C7B7112.103@gmail.com>

  Hi
I need to maintain unique message IDs across different queues. I believe 
The current message ID tag is only unique till the channel closes . So 
is there a way (or some message property) I can use to maintain unique 
message IDs. What can be the best approach to do it.

Abhishek Kona

From frank.goenninger at consequor.de  Mon Aug 30 12:13:28 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Mon, 30 Aug 2010 13:13:28 +0200
Subject: [rabbitmq-discuss] C client library for RabbitMQ using VS2010
 asbuild tool
In-Reply-To: <7C1046148D91C244A98F4C14673588670232FAC2@BE43.exg3.exghost.com>
References: <7C1046148D91C244A98F4C14673588670232FAC2@BE43.exg3.exghost.com>
Message-ID: <F426CD89-0F34-432C-BDDF-F1F4E24377D1@consequor.de>

Hi Peter,

it *should* be stable. I did not tweak anything special except for the fact of non-empty structs. This *might* have some impact. Testing is definitely still not completed.

I'd say: Try it. Seriously: It really should work. You may get some benefits if you use the added API calls to amqp_lib_open (and amqp_lib_close) and amqp_get_error. See the file API_CHANGES in Git.

I am ready to jump in to support you...

Cheers
  Frank



Am 30.08.2010 um 06:09 schrieb Pieter de Zwart:

> This is fantastic. Is this stable or how long before you have something stable? I need to start working on the PHP library and want to know what the deal is =)
> 
> Pieter
> 
> 
> 
> ----- Original Message -----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com <rabbitmq-discuss-bounces at lists.rabbitmq.com>
> To: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Sun Aug 29 06:56:23 2010
> Subject: [rabbitmq-discuss] C client library for RabbitMQ using VS2010 asbuild tool
> 
> Hi again,
> 
> a couple of weeks (months?) ago I announced here that we are working on a "native" DLL for the C client lib. Well, finally, here it is:
> 
> http://github.com/dg1sbg/librabbitmq
> 
> This contains (see the README there) "only" the librabbitmq part of the C client lib. Tests, examples etc still open, but I wanted to make sure everybody is aware that we are making progress. Comments, feedback, hints, bug reports all really welcome!
> 
> Cheers
>   Frank
> 
> --
>   C o n s e q u o r   C o n s u l t i n g   A G
>   Frank Goenninger
> 
>   E-Mail: frank.goenninger at consequor.de
>   Phone: +49 711 781 181-10
>   Fax:   +49 711 781 181-11
> 
>   Consequor Consulting AG
>   Liebknechstr. 33
>   D-70565 Stuttgart
> 
>   Vorstand: Frank G?nninger (Vors.), Martin Melcher
>   Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
>   Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
>   Registergericht Amtsgericht Stuttgart HRB 727446
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From jon at jbrisbin.com  Mon Aug 30 14:28:33 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 30 Aug 2010 08:28:33 -0500
Subject: [rabbitmq-discuss] Turning consumers on/off in Erlang client
Message-ID: <1C120551-F1AB-484D-8602-5217F247D770@jbrisbin.com>

In my webhooks plugin, I'm trying to add some basic support for scheduling requests to go out at a particular time. Rather than try to implement some kind of sleep() call that waits until the next configured send window (which is getting a little complicated to manage) I'd like to simply cancel the consumer whenever the time is after a send window and start it back up whenever the window opens. I can figure out whether I'm in a send window easy enough but when I try to turn the consumer on and off (by asynchronously doing basic.cancel and basic.consume) it will give me an error something along the lines of (my logs have rolled past this error long ago, sorry for not having it verbatim) "unexpected delivery and no default consumer". I think this is coming from the erlang client, not the broker. 

Is there a way to "nicely" manage the consumer so that it stops reasonably (not by simply interrupting whatever it's currently doing)? A kind of "cancel this consumer after the next message delivery"? Or should I be doing this in a different way?

I've got my consume and cancel calls in a handle_info() which I trigger with the usual "self() ! cancel" etc... from the code that checks whether or not I'm within a send window.

The problem is a little more complicated than I thought in that I can configure multiple windows and I have to figure out which one is closer to the present time (including wrapping around midnight into the next morning). Though the code to manage this is a little more unwieldy than I'd like, it's really only the consumer cancel/consume calls that are giving me fits. Everything else seems to work okay. Arg! :/

Can anyone point me in the right direction on troubleshooting this?

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100830/4c4f43fe/attachment.htm>

From jmann at versatile.com  Mon Aug 30 15:02:09 2010
From: jmann at versatile.com (John Mann)
Date: Mon, 30 Aug 2010 10:02:09 -0400
Subject: [rabbitmq-discuss] Unique Message IDs
In-Reply-To: <4C7B7112.103@gmail.com>
References: <4C7B7112.103@gmail.com>
Message-ID: <AANLkTike=2ez-b_+DatMMx6HvzA18ot5wD0=Y+_vWOEB@mail.gmail.com>

When dealing with distributed systems, I've found that using GUID or UUID is
the best approach:

http://en.wikipedia.org/wiki/Universally_unique_identifier

HTH

-JC

On Mon, Aug 30, 2010 at 4:51 AM, Abhishek Kona <abhishek.kona at gmail.com>wrote:

>  Hi
> I need to maintain unique message IDs across different queues. I believe
> The current message ID tag is only unique till the channel closes . So is
> there a way (or some message property) I can use to maintain unique message
> IDs. What can be the best approach to do it.
>
> Abhishek Kona
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100830/a5e09633/attachment.htm>

From alexis at rabbitmq.com  Mon Aug 30 18:34:25 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 30 Aug 2010 18:34:25 +0100
Subject: [rabbitmq-discuss] Unique Message IDs
In-Reply-To: <AANLkTike=2ez-b_+DatMMx6HvzA18ot5wD0=Y+_vWOEB@mail.gmail.com>
References: <4C7B7112.103@gmail.com>
	<AANLkTike=2ez-b_+DatMMx6HvzA18ot5wD0=Y+_vWOEB@mail.gmail.com>
Message-ID: <AANLkTi=gJSnUHQ_6vmu4teUy8Eqv7GC+XmQApXtkDdrD@mail.gmail.com>

+1

Abhishek,

RabbitMQ doesn't provide that itself, but you can roll your own.  IIUC
the 'dual redundant queues' approach taken by Beetle, does this:
http://github.com/xing/beetle

Please take a look and ask again here if you have more questions about this.

alexis




On Mon, Aug 30, 2010 at 3:02 PM, John Mann <jmann at versatile.com> wrote:
> When dealing with distributed systems, I've found that using GUID or UUID is
> the best approach:
>
> http://en.wikipedia.org/wiki/Universally_unique_identifier
> HTH
> -JC
> On Mon, Aug 30, 2010 at 4:51 AM, Abhishek Kona <abhishek.kona at gmail.com>
> wrote:
>>
>> ?Hi
>> I need to maintain unique message IDs across different queues. I believe
>> The current message ID tag is only unique till the channel closes . So is
>> there a way (or some message property) I can use to maintain unique message
>> IDs. What can be the best approach to do it.
>>
>> Abhishek Kona
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alexis at rabbitmq.com  Mon Aug 30 18:35:18 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 30 Aug 2010 18:35:18 +0100
Subject: [rabbitmq-discuss] C client library for RabbitMQ using VS2010
 asbuild tool
In-Reply-To: <F426CD89-0F34-432C-BDDF-F1F4E24377D1@consequor.de>
References: <7C1046148D91C244A98F4C14673588670232FAC2@BE43.exg3.exghost.com>
	<F426CD89-0F34-432C-BDDF-F1F4E24377D1@consequor.de>
Message-ID: <AANLkTik2amPGyZsJzD27369+t+E6by=15eibjLF9OyAg@mail.gmail.com>

Thanks guys - this is great to see!

alexis


On Mon, Aug 30, 2010 at 12:13 PM, Frank G?nninger
<frank.goenninger at consequor.de> wrote:
> Hi Peter,
>
> it *should* be stable. I did not tweak anything special except for the fact of non-empty structs. This *might* have some impact. Testing is definitely still not completed.
>
> I'd say: Try it. Seriously: It really should work. You may get some benefits if you use the added API calls to amqp_lib_open (and amqp_lib_close) and amqp_get_error. See the file API_CHANGES in Git.
>
> I am ready to jump in to support you...
>
> Cheers
> ?Frank
>
>
>
> Am 30.08.2010 um 06:09 schrieb Pieter de Zwart:
>
>> This is fantastic. Is this stable or how long before you have something stable? I need to start working on the PHP library and want to know what the deal is =)
>>
>> Pieter
>>
>>
>>
>> ----- Original Message -----
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com <rabbitmq-discuss-bounces at lists.rabbitmq.com>
>> To: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Sun Aug 29 06:56:23 2010
>> Subject: [rabbitmq-discuss] C client library for RabbitMQ using VS2010 asbuild tool
>>
>> Hi again,
>>
>> a couple of weeks (months?) ago I announced here that we are working on a "native" DLL for the C client lib. Well, finally, here it is:
>>
>> http://github.com/dg1sbg/librabbitmq
>>
>> This contains (see the README there) "only" the librabbitmq part of the C client lib. Tests, examples etc still open, but I wanted to make sure everybody is aware that we are making progress. Comments, feedback, hints, bug reports all really welcome!
>>
>> Cheers
>> ? Frank
>>
>> --
>> ? C o n s e q u o r ? C o n s u l t i n g ? A G
>> ? Frank Goenninger
>>
>> ? E-Mail: frank.goenninger at consequor.de
>> ? Phone: +49 711 781 181-10
>> ? Fax: ? +49 711 781 181-11
>>
>> ? Consequor Consulting AG
>> ? Liebknechstr. 33
>> ? D-70565 Stuttgart
>>
>> ? Vorstand: Frank G?nninger (Vors.), Martin Melcher
>> ? Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
>> ? Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
>> ? Registergericht Amtsgericht Stuttgart HRB 727446
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> --
> ?C o n s e q u o r ? C o n s u l t i n g ? A G
> ?Frank Goenninger
>
> ?E-Mail: frank.goenninger at consequor.de
> ?Phone: +49 711 781 181-10
> ?Fax: ? +49 711 781 181-11
>
> ?Consequor Consulting AG
> ?Liebknechstr. 33
> ?D-70565 Stuttgart
>
> ?Vorstand: Frank G?nninger (Vors.), Martin Melcher
> ?Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
> ?Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
> ?Registergericht Amtsgericht Stuttgart HRB 727446
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Mon Aug 30 18:43:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 30 Aug 2010 18:43:18 +0100
Subject: [rabbitmq-discuss] Turning consumers on/off in Erlang client
In-Reply-To: <1C120551-F1AB-484D-8602-5217F247D770@jbrisbin.com>
References: <1C120551-F1AB-484D-8602-5217F247D770@jbrisbin.com>
Message-ID: <20100830174318.GC3857@rabbitmq.com>

Hi Jon,

On Mon, Aug 30, 2010 at 08:28:33AM -0500, Jon Brisbin wrote:
> In my webhooks plugin, I'm trying to add some basic support for scheduling requests to go out at a particular time. Rather than try to implement some kind of sleep() call that waits until the next configured send window (which is getting a little complicated to manage) I'd like to simply cancel the consumer whenever the time is after a send window and start it back up whenever the window opens. I can figure out whether I'm in a send window easy enough but when I try to turn the consumer on and off (by asynchronously doing basic.cancel and basic.consume) it will give me an error something along the lines of (my logs have rolled past this error long ago, sorry for not having it verbatim) "unexpected delivery and no default consumer". I think this is coming from the erlang client, not the broker. 

Hmm, that error was meant to catch the case where you do a basic.cancel,
but you have outstanding unack'd messages and then you do
basic.redeliver - the messages get resend but the client has since lost
knowledge about that ctag, hence the error.

If you're doing a basic.cancel with nowait = true then I can certainly
believe this would happen then too. But why are you doing that?

> Is there a way to "nicely" manage the consumer so that it stops reasonably (not by simply interrupting whatever it's currently doing)? A kind of "cancel this consumer after the next message delivery"? Or should I be doing this in a different way?

Yes - any of:
1. don't use the nowait version of basic.cancel
2. set qos prefetch_count to 1 and never cancel unless you have an
unacknowledged message
3. use amqp_channel:register_default_consumer to set a consumer which
will be invoked if the ctag isn't recognised.

Matthew

From sigurd.hogsbro at museeka.com  Mon Aug 30 18:55:17 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Mon, 30 Aug 2010 10:55:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
Message-ID: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>

Hi,

Since the upgrade to 2.0.0 I notice that the known_hosts property is
no longer getting populated by the hostname of the server to which
I've connected. This was quite useful to us for diagnostics since we
use a proxy-based connection layer. Is this an oversight, or a
deliberate change related to 0.9.1?

Sigurd

From stevvooe at gmail.com  Mon Aug 30 19:01:38 2010
From: stevvooe at gmail.com (Stephen Day)
Date: Mon, 30 Aug 2010 11:01:38 -0700
Subject: [rabbitmq-discuss] Python AMQPLib causes exception when trying
	to declare queue with X-Expires
In-Reply-To: <AANLkTimTfh37uE+Pq3WVzw3K+mSTyCg+SDgY6f+QkMj_@mail.gmail.com>
References: <AANLkTi=_anQJDOqxGO5gWGA7=YnGwMyJMT2VQRVsn_dK@mail.gmail.com>
	<AANLkTimTfh37uE+Pq3WVzw3K+mSTyCg+SDgY6f+QkMj_@mail.gmail.com>
Message-ID: <AANLkTi=TidEJVA5WPqeoqEpaKiauR9y=TYpYmPLpij55@mail.gmail.com>

Anyone on this? Is there a place I should file a bug?

On Sun, Aug 29, 2010 at 1:57 AM, Stephen Day <stevvooe at gmail.com> wrote:
> Small correction:
>
> x-expires granularity is in milliseconds, so changing to a 4 byte
> integer will limit the expiry range to 24 days, which doesn't provide
> as much headroom.
>
> On Sun, Aug 29, 2010 at 1:50 AM, Stephen Day <stevvooe at gmail.com> wrote:
>> Here is the traceback showing the exception as thrown by amqplib, with
>> the channel exception code:
>>
>>>>> ch.queue_declare('bdirect', arguments={"x-expires": 600})
>> Traceback (most recent call last):
>> ?File "<stdin>", line 1, in <module>
>> ?File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/channel.py",
>> line 1294, in queue_declare
>> ? ?(50, 11), ? ?# Channel.queue_declare_ok
>> ?File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/abstract_channel.py",
>> line 105, in wait
>> ? ?return amqp_method(self, args)
>> ?File "/usr/lib/pymodules/python2.6/amqplib/client_0_8/channel.py",
>> line 273, in _close
>> ? ?(class_id, method_id))
>> amqplib.client_0_8.exceptions.AMQPChannelException: (406,
>> u"PRECONDITION_FAILED - invalid arg 'x-expires' for queue 'bdirect' in
>> vhost '/': expires_not_of_type_long", (50, 10),
>> 'Channel.queue_declare')
>>
>> In the library code, it looks like it properly packs the integer, but
>> 0-8 doesn't support the desired integer type:
>>
>> amqplib/client_0_8/serialization.py
>>
>> 372 ? ? ? ? ? ? elif isinstance(v, (int, long)):
>> 373 ? ? ? ? ? ? ? ? table_data.write('I')
>> 374 ? ? ? ? ? ? ? ? table_data.write(pack('>i', v))
>>
>> The problem might actually lie in the server side parser code:
>>
>> src/rabbit_binary_parser.erl
>>
>> 99 parse_field_value(<<"l", Value:64/signed, Rest/binary>>) ->
>> 100 ? ? {long, Value, Rest};
>>
>> The 0-8 specification doesn't define a long type outside of the "I"
>> type, so this excludes this feature (which is a *great* feature) from
>> older clients.
>>
>> You should probably just have x-expires look for a regular 0-8
>> supported, 4-byte "I"-type integer. It will limit queue time expiry
>> maximum to 68 years, but one has to make design tradeoffs every once
>> and awhile ;).
>>
>> Good work on the 2.0 release. Its looking fantastic thus far.
>>
>> Stephen
>>
>

From jon at jbrisbin.com  Mon Aug 30 19:08:52 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 30 Aug 2010 13:08:52 -0500
Subject: [rabbitmq-discuss] Turning consumers on/off in Erlang client
In-Reply-To: <20100830174318.GC3857@rabbitmq.com>
References: <1C120551-F1AB-484D-8602-5217F247D770@jbrisbin.com>
	<20100830174318.GC3857@rabbitmq.com>
Message-ID: <482972BD-382A-4C8E-AC1C-28ED89EC4983@jbrisbin.com>


On Aug 30, 2010, at 12:43 PM, Matthew Sackman wrote:

> Hi Jon,
> 
> On Mon, Aug 30, 2010 at 08:28:33AM -0500, Jon Brisbin wrote:
>> In my webhooks plugin, I'm trying to add some basic support for scheduling requests to go out at a particular time. Rather than try to implement some kind of sleep() call that waits until the next configured send window (which is getting a little complicated to manage) I'd like to simply cancel the consumer whenever the time is after a send window and start it back up whenever the window opens. I can figure out whether I'm in a send window easy enough but when I try to turn the consumer on and off (by asynchronously doing basic.cancel and basic.consume) it will give me an error something along the lines of (my logs have rolled past this error long ago, sorry for not having it verbatim) "unexpected delivery and no default consumer". I think this is coming from the erlang client, not the broker. 
> 
> Hmm, that error was meant to catch the case where you do a basic.cancel,
> but you have outstanding unack'd messages and then you do
> basic.redeliver - the messages get resend but the client has since lost
> knowledge about that ctag, hence the error.

I probably do have unack'd messages waiting because I'm trying to limit the number of messages coming through. But I wasn't doing a redeliver, though...

> 
> If you're doing a basic.cancel with nowait = true then I can certainly
> believe this would happen then too. But why are you doing that?
> 
>> Is there a way to "nicely" manage the consumer so that it stops reasonably (not by simply interrupting whatever it's currently doing)? A kind of "cancel this consumer after the next message delivery"? Or should I be doing this in a different way?
> 
> Yes - any of:
> 1. don't use the nowait version of basic.cancel
> 2. set qos prefetch_count to 1 and never cancel unless you have an
> unacknowledged message
> 3. use amqp_channel:register_default_consumer to set a consumer which
> will be invoked if the ctag isn't recognised.
> 
> Matthew


Hmmm. I was using the defaults:

amqp_channel.call(Channel, #'basic.cancel'{ consumer_tag=Tag }),

I probably want to do #3 as well, no matter what. I don't really *care* if a message sneaks through after a window is closed. I don't have to be that accurate. I just need it to stop any new messages from being processed until I start the consumer again when another send window has opened. 


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100830/176844df/attachment.htm>

From matthew at rabbitmq.com  Mon Aug 30 19:15:28 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 30 Aug 2010 19:15:28 +0100
Subject: [rabbitmq-discuss] Turning consumers on/off in Erlang client
In-Reply-To: <482972BD-382A-4C8E-AC1C-28ED89EC4983@jbrisbin.com>
References: <1C120551-F1AB-484D-8602-5217F247D770@jbrisbin.com>
	<20100830174318.GC3857@rabbitmq.com>
	<482972BD-382A-4C8E-AC1C-28ED89EC4983@jbrisbin.com>
Message-ID: <20100830181528.GE3857@rabbitmq.com>

On Mon, Aug 30, 2010 at 01:08:52PM -0500, Jon Brisbin wrote:
> Hmmm. I was using the defaults:
> 
> amqp_channel.call(Channel, #'basic.cancel'{ consumer_tag=Tag }),

Hmm. The default for nowait is false. I've just checked the erlang
client and it's only unregistering the ctag when it gets the
basic.cancel_ok back from the server, at which point it shouldn't be
seeing any further messages with that ctag.

Thus I'm not sure why you're getting such messages. If you do set the
default_consumer, could you just check that you are getting messages end
up there which correspond to subscriptions you've cancelled? If so, it
likely points to a bug in the erlang client (thus updating to the latest
head of default on the erlang-client is probably a good idea too if
you've not already).

Matthew

From matthias at rabbitmq.com  Mon Aug 30 19:19:44 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 30 Aug 2010 19:19:44 +0100
Subject: [rabbitmq-discuss] Python AMQPLib causes exception when trying
 to declare queue with X-Expires
In-Reply-To: <AANLkTi=TidEJVA5WPqeoqEpaKiauR9y=TYpYmPLpij55@mail.gmail.com>
References: <AANLkTi=_anQJDOqxGO5gWGA7=YnGwMyJMT2VQRVsn_dK@mail.gmail.com>	<AANLkTimTfh37uE+Pq3WVzw3K+mSTyCg+SDgY6f+QkMj_@mail.gmail.com>
	<AANLkTi=TidEJVA5WPqeoqEpaKiauR9y=TYpYmPLpij55@mail.gmail.com>
Message-ID: <4C7BF640.20303@rabbitmq.com>

Stephen,

Stephen Day wrote:
> Anyone on this?

it's a bank holiday in the UK ...

> Is there a place I should file a bug?

I have filed a bug. The type of the "x-expires" argument should indeed 
be 'I'. No idea how it ended up being 'l' since that is actually signed.


Regards,

Matthias.

From jon at jbrisbin.com  Mon Aug 30 19:32:27 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 30 Aug 2010 13:32:27 -0500
Subject: [rabbitmq-discuss] Turning consumers on/off in Erlang client
In-Reply-To: <20100830181528.GE3857@rabbitmq.com>
References: <1C120551-F1AB-484D-8602-5217F247D770@jbrisbin.com>
	<20100830174318.GC3857@rabbitmq.com>
	<482972BD-382A-4C8E-AC1C-28ED89EC4983@jbrisbin.com>
	<20100830181528.GE3857@rabbitmq.com>
Message-ID: <F77E9D7D-8FC6-40F8-9C24-695ED9980218@jbrisbin.com>


On Aug 30, 2010, at 1:15 PM, Matthew Sackman wrote:

> On Mon, Aug 30, 2010 at 01:08:52PM -0500, Jon Brisbin wrote:
>> Hmmm. I was using the defaults:
>> 
>> amqp_channel.call(Channel, #'basic.cancel'{ consumer_tag=Tag }),
> 
> Hmm. The default for nowait is false. I've just checked the erlang
> client and it's only unregistering the ctag when it gets the
> basic.cancel_ok back from the server, at which point it shouldn't be
> seeing any further messages with that ctag.
> 
> Thus I'm not sure why you're getting such messages. If you do set the
> default_consumer, could you just check that you are getting messages end
> up there which correspond to subscriptions you've cancelled? If so, it
> likely points to a bug in the erlang client (thus updating to the latest
> head of default on the erlang-client is probably a good idea too if
> you've not already).
> 
> Matthew


I set a default consumer so haven't seen this error message again and haven't seen any negative side effects. Now when I go outside a send window, it will cancel the consumer and messages will stack up in the queue until the next send window, at which time the consumer will be reattached and messages will start flowing again.

I may take the default consumer off again and see if I can break it...

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100830/2190bfc3/attachment.htm>

From aaron at agoragames.com  Mon Aug 30 19:38:21 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 30 Aug 2010 14:38:21 -0400
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
Message-ID: <AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>

Some time ago we had a conversation with the team and learned that the
redirect was removed in the 0.9.1 spec.  I suspect that the
corresponding known_hosts data may have also been removed.  A quick
check of the protocol docs seem to confirm this.

-Aaron

2010/8/30 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>:
> Hi,
>
> Since the upgrade to 2.0.0 I notice that the known_hosts property is
> no longer getting populated by the hostname of the server to which
> I've connected. This was quite useful to us for diagnostics since we
> use a proxy-based connection layer. Is this an oversight, or a
> deliberate change related to 0.9.1?
>
> Sigurd
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From jon at jbrisbin.com  Mon Aug 30 19:55:02 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 30 Aug 2010 13:55:02 -0500
Subject: [rabbitmq-discuss] Updated webhooks plugin with send windows
Message-ID: <D2C3227C-896A-40F8-995E-85097E3F5FAF@jbrisbin.com>

Thanks to Matthew's help getting the consumer cancel issue worked out, I pushed changes to Github (and uploaded a binary of the .ez files needed for the plugin) that implement the "send window" functionality I was talking about.

I added it to the wiki page on configuration, but basically it lets you set up windows of time during which outgoing HTTP requests are allowed to go out. This will be useful to me personally by allowing me to configure webhooks that do heavy-lifting updating of data views at off-peak times.

I wish I had time to implement a web UI using the mochiweb plugin and more flexible, live (re)configuration.

http://github.com/jbrisbin/rabbitmq-webhooks

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100830/3d10a67f/attachment.htm>

From stevvooe at gmail.com  Mon Aug 30 20:41:54 2010
From: stevvooe at gmail.com (Stephen Day)
Date: Mon, 30 Aug 2010 12:41:54 -0700
Subject: [rabbitmq-discuss] Python AMQPLib causes exception when trying
 to declare queue with X-Expires
In-Reply-To: <4C7BF640.20303@rabbitmq.com>
References: <AANLkTi=_anQJDOqxGO5gWGA7=YnGwMyJMT2VQRVsn_dK@mail.gmail.com>
	<AANLkTimTfh37uE+Pq3WVzw3K+mSTyCg+SDgY6f+QkMj_@mail.gmail.com>
	<AANLkTi=TidEJVA5WPqeoqEpaKiauR9y=TYpYmPLpij55@mail.gmail.com>
	<4C7BF640.20303@rabbitmq.com>
Message-ID: <AANLkTimanGgiRoBo_yBJB8boDO4nY5c7oyTvDX_EXN7q@mail.gmail.com>

My apologies good sir; enjoy your holiday!

Thank you for the response.

On Mon, Aug 30, 2010 at 11:19 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Stephen,
>
> Stephen Day wrote:
>>
>> Anyone on this?
>
> it's a bank holiday in the UK ...
>
>> Is there a place I should file a bug?
>
> I have filed a bug. The type of the "x-expires" argument should indeed be
> 'I'. No idea how it ended up being 'l' since that is actually signed.
>
>
> Regards,
>
> Matthias.
>

From sigurd.hogsbro at museeka.com  Tue Aug 31 02:16:18 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Mon, 30 Aug 2010 18:16:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
Message-ID: <cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>

Thanks Aaron, I was afraid that's what would be coming back ;-)

Sigurd

On Aug 30, 8:38?pm, Aaron Westendorf <aa... at agoragames.com> wrote:
> Some time ago we had a conversation with the team and learned that the
> redirect was removed in the 0.9.1 spec. ?I suspect that the
> corresponding known_hosts data may have also been removed. ?A quick
> check of the protocol docs seem to confirm this.
>
> -Aaron
>
> 2010/8/30 Sigurd H?gsbro <sigurd.hogs... at museeka.com>:
>
> > Hi,
>
> > Since the upgrade to 2.0.0 I notice that the known_hosts property is
> > no longer getting populated by the hostname of the server to which
> > I've connected. This was quite useful to us for diagnostics since we
> > use a proxy-based connection layer. Is this an oversight, or a
> > deliberate change related to 0.9.1?
>
> > Sigurd
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aa... at agoragames.comwww.agoragames.com
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jamesgeary at CrispThinking.com  Tue Aug 31 11:38:10 2010
From: jamesgeary at CrispThinking.com (James Geary)
Date: Tue, 31 Aug 2010 11:38:10 +0100
Subject: [rabbitmq-discuss] Exchange to Exchange bindings
Message-ID: <555BCB283BEB174F9BF8A0A73C880BB20347824A30@exchange02.crispthinking.local>

Hi.

Has the feature from this wiki post been implemented yet?

https://dev.rabbitmq.com/wiki/ExchangeToExchangeBindings

Thanks,

James

From mikeb at rabbitmq.com  Tue Aug 31 11:43:11 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 31 Aug 2010 11:43:11 +0100
Subject: [rabbitmq-discuss] Exchange to Exchange bindings
In-Reply-To: <555BCB283BEB174F9BF8A0A73C880BB20347824A30@exchange02.crispthinking.local>
References: <555BCB283BEB174F9BF8A0A73C880BB20347824A30@exchange02.crispthinking.local>
Message-ID: <4C7CDCBF.6070306@rabbitmq.com>

James,

> Has the feature from this wiki post been implemented yet?
> 
> https://dev.rabbitmq.com/wiki/ExchangeToExchangeBindings

It's not; but there's hope yet.  For what were you thinking of using it?

Cheers,
Michael

From ovidiudeac at gmail.com  Tue Aug 31 11:56:40 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Tue, 31 Aug 2010 13:56:40 +0300
Subject: [rabbitmq-discuss] default queue for unroutable messages
Message-ID: <AANLkTinL3L6AujpZ9WYt89EhcdGPxyifNGYtqYieeG_3@mail.gmail.com>

Hello everybody!

I would like to tell RabbitMQ to put all the unroutable messages that
were sent to an exchange in a "default" queue.

Is it possible?

thanks,
ovidiu

From alexandru at rabbitmq.com  Tue Aug 31 12:29:39 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 31 Aug 2010 12:29:39 +0100
Subject: [rabbitmq-discuss] default queue for unroutable messages
In-Reply-To: <AANLkTinL3L6AujpZ9WYt89EhcdGPxyifNGYtqYieeG_3@mail.gmail.com>
References: <AANLkTinL3L6AujpZ9WYt89EhcdGPxyifNGYtqYieeG_3@mail.gmail.com>
Message-ID: <20100831112939.GD2657@dakota.eng.vmware.com>

Hi Ovidiu,

> I would like to tell RabbitMQ to put all the unroutable messages that
> were sent to an exchange in a "default" queue.

It can't be done automatically.

You could do it like this:
  - set the mandatory and immediate flags on all messages;
  - the unroutable ones will be basic.return'd;
  - have the client re-publish every basic.return'd message so that it
    gets to your dead-letter queue.

The mandatory flag causes a basic.return if the message wasn't routed to
a queue.

The immediate flag causes a basic.return if the message got to some
queues but there were no consumers waiting for it.

Hope this helps.

Cheers,
Alex

On Tue, Aug 31, 2010 at 01:56:40PM +0300, Ovidiu Deac wrote:
> Hello everybody!
> 
> I would like to tell RabbitMQ to put all the unroutable messages that
> were sent to an exchange in a "default" queue.
> 
> Is it possible?
> 
> thanks,
> ovidiu
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mikeb at rabbitmq.com  Tue Aug 31 12:33:15 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 31 Aug 2010 12:33:15 +0100
Subject: [rabbitmq-discuss] default queue for unroutable messages
In-Reply-To: <AANLkTinL3L6AujpZ9WYt89EhcdGPxyifNGYtqYieeG_3@mail.gmail.com>
References: <AANLkTinL3L6AujpZ9WYt89EhcdGPxyifNGYtqYieeG_3@mail.gmail.com>
Message-ID: <4C7CE87B.7080600@rabbitmq.com>

Hi Ovidiu,

> I would like to tell RabbitMQ to put all the unroutable messages that
> were sent to an exchange in a "default" queue.
> 
> Is it possible?

I think alternate exchanges (a.k.a., unroutable message exchanges) may help:
http://www.rabbitmq.com/extensions.html#alternate-exchange

Michael

From riteshrathi at gmail.com  Tue Aug 31 12:56:28 2010
From: riteshrathi at gmail.com (rathi)
Date: Tue, 31 Aug 2010 17:26:28 +0530
Subject: [rabbitmq-discuss] Acknowledging multiple messages.
Message-ID: <AANLkTimFXwQ_dRHdfXYwbAp9pNKPLc0Zs9=_kub0z4JJ@mail.gmail.com>

void *basicAck*(long deliveryTag, boolean multiple) throws java.io.IOException
Acknowledge one or several received messages. Supply the deliveryTag
from the AMQP.Basic.GetOk
<http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.1/rabbitmq-java-client-javadoc-1.5.1/com/rabbitmq/client/AMQP.Basic.GetOk.html>
or AMQP.Basic.Deliver
<http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.1/rabbitmq-java-client-javadoc-1.5.1/com/rabbitmq/client/AMQP.Basic.Deliver.html>
method containing the received message being acknowledged.

The above method allows to acknowledge multiple messages based on the
deliveryTag. But how do we set the same deliveryTag for multiple
messages. Don't know
if my understanding here is right. Please correct me if I am wrong.

thanks & regards,
ritesh rathi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100831/f7730016/attachment.htm>

From alexandru at rabbitmq.com  Tue Aug 31 13:07:54 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Tue, 31 Aug 2010 13:07:54 +0100
Subject: [rabbitmq-discuss] default queue for unroutable messages
In-Reply-To: <20100831112939.GD2657@dakota.eng.vmware.com>
References: <AANLkTinL3L6AujpZ9WYt89EhcdGPxyifNGYtqYieeG_3@mail.gmail.com>
	<20100831112939.GD2657@dakota.eng.vmware.com>
Message-ID: <20100831120754.GE2657@dakota.eng.vmware.com>

> It can't be done automatically.

My bad, as Michael pointed out, using an alternate exchange (you'd
probably want a fanout exchange) would be a simpler way to go
client-wise.

Cheers,
Alex

On Tue, Aug 31, 2010 at 12:29:39PM +0100, Alexandru Scvor?ov wrote:
> Hi Ovidiu,
> 
> > I would like to tell RabbitMQ to put all the unroutable messages that
> > were sent to an exchange in a "default" queue.
> 
> It can't be done automatically.
> 
> You could do it like this:
>   - set the mandatory and immediate flags on all messages;
>   - the unroutable ones will be basic.return'd;
>   - have the client re-publish every basic.return'd message so that it
>     gets to your dead-letter queue.
> 
> The mandatory flag causes a basic.return if the message wasn't routed to
> a queue.
> 
> The immediate flag causes a basic.return if the message got to some
> queues but there were no consumers waiting for it.
> 
> Hope this helps.
> 
> Cheers,
> Alex
> 
> On Tue, Aug 31, 2010 at 01:56:40PM +0300, Ovidiu Deac wrote:
> > Hello everybody!
> > 
> > I would like to tell RabbitMQ to put all the unroutable messages that
> > were sent to an exchange in a "default" queue.
> > 
> > Is it possible?
> > 
> > thanks,
> > ovidiu
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Tue Aug 31 13:12:22 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 31 Aug 2010 13:12:22 +0100
Subject: [rabbitmq-discuss] sasl_error_logger tty problem on 2.0.0?
In-Reply-To: <20100825191212.GD8173@wellquite.org>
References: <AANLkTikuV8A_WsOMHUCh4cPR8V=FPsu2kqZG6oJyyxGO@mail.gmail.com>
	<20100825191212.GD8173@wellquite.org>
Message-ID: <4C7CF1A6.50906@rabbitmq.com>

On 25/08/10 20:12, Matthew Sackman wrote:
> On Wed, Aug 25, 2010 at 11:55:44AM -0700, elij wrote:
>> I tried '-sasl sasl_error_logger tty', and experience the identical
>> crash as above.
>
> Confirmed. I get exactly the same.

The fix for this has just been merged into 'default', so it will be in 
the next release.

Matthias.

From ovidiudeac at gmail.com  Tue Aug 31 13:25:31 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Tue, 31 Aug 2010 15:25:31 +0300
Subject: [rabbitmq-discuss] default queue for unroutable messages
In-Reply-To: <4C7CE87B.7080600@rabbitmq.com>
References: <AANLkTinL3L6AujpZ9WYt89EhcdGPxyifNGYtqYieeG_3@mail.gmail.com>
	<4C7CE87B.7080600@rabbitmq.com>
Message-ID: <AANLkTikjhWVm=TnSQWewhL_u240vGsCe6umsvvRY4i+D@mail.gmail.com>

This is very nice.

Thanks for the answers!
ovidiu

On Tue, Aug 31, 2010 at 2:33 PM, Michael Bridgen <mikeb at rabbitmq.com> wrote:
> Hi Ovidiu,
>
>> I would like to tell RabbitMQ to put all the unroutable messages that
>> were sent to an exchange in a "default" queue.
>>
>> Is it possible?
>
> I think alternate exchanges (a.k.a., unroutable message exchanges) may help:
> http://www.rabbitmq.com/extensions.html#alternate-exchange
>
> Michael
>

From alexis at rabbitmq.com  Tue Aug 31 13:51:21 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 31 Aug 2010 13:51:21 +0100
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>
Message-ID: <AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>

Sigurd

Do you think you will be able to develop a workaround?

alexis


2010/8/31 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>:
> Thanks Aaron, I was afraid that's what would be coming back ;-)
>
> Sigurd
>
> On Aug 30, 8:38?pm, Aaron Westendorf <aa... at agoragames.com> wrote:
>> Some time ago we had a conversation with the team and learned that the
>> redirect was removed in the 0.9.1 spec. ?I suspect that the
>> corresponding known_hosts data may have also been removed. ?A quick
>> check of the protocol docs seem to confirm this.
>>
>> -Aaron
>>
>> 2010/8/30 Sigurd H?gsbro <sigurd.hogs... at museeka.com>:
>>
>> > Hi,
>>
>> > Since the upgrade to 2.0.0 I notice that the known_hosts property is
>> > no longer getting populated by the hostname of the server to which
>> > I've connected. This was quite useful to us for diagnostics since we
>> > use a proxy-based connection layer. Is this an oversight, or a
>> > deliberate change related to 0.9.1?
>>
>> > Sigurd
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-disc... at lists.rabbitmq.com
>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> --
>> Aaron Westendorf
>> Senior Software Engineer
>> Agora Games
>> 359 Broadway
>> Troy, NY 12180
>> Phone: 518.268.1000
>> aa... at agoragames.comwww.agoragames.com
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jigar87 at gmail.com  Tue Aug 31 13:47:37 2010
From: jigar87 at gmail.com (jigar sheth)
Date: Tue, 31 Aug 2010 18:17:37 +0530
Subject: [rabbitmq-discuss] RabbitMQ Message Server Connection.
Message-ID: <AANLkTi=wGENrNJks8p_aKXoyO20USUF8cmMgBDuLAT2U@mail.gmail.com>

How can i check if there is a message Server  Connection available or not,
so that i dont get Connection Error at Create Connection Statement if no
Server is Running ?


Regards,
Jigar Sheth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100831/45ceebac/attachment-0001.htm>

From majek04 at gmail.com  Tue Aug 31 14:01:39 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 31 Aug 2010 14:01:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ, STOMP,
	Python and Orbited - design question.
In-Reply-To: <046E08A3-CAE9-4B32-AF9F-6744381BAEBB@cantemo.com>
References: <59F4708F-0B65-48BF-8BC2-211E38E92F63@cantemo.com>
	<AANLkTinSbZDztUBGVMeivWfJF-ZJ0fVPizMA6-Z4qpA+@mail.gmail.com>
	<DE2D21E1-F6C7-4EEA-B10F-2173201A3706@cantemo.com>
	<AANLkTimQDv8hX9cOZOXHnYjKeCy5F38EY+Z-Nno0cfsy@mail.gmail.com>
	<046E08A3-CAE9-4B32-AF9F-6744381BAEBB@cantemo.com>
Message-ID: <AANLkTinEdAxTGm1S+ReztEh9iJ9Gm0GOq=U-grdm1Wg8@mail.gmail.com>

Tim,

On Fri, Aug 27, 2010 at 15:32, Tim Child <tim at cantemo.com> wrote:
> I was going to use py-amqplib with Tornado.
>
> You are right I don't want just a single consumer per job, I want to be able to attach multiple consumers. I don't care if the messages are lost because no one is looking at them in this case.
>
> My use case for queue for all jobs isn't very strong - getting an overview of what is happening on multiple jobs at the same time. Another use case for me, is that upon a certain message on the queue, I can hook up jobs - such as starting other jobs off when a job is finished..
>
> So basically what you are saying is that I can't have multiple consumers in the way I want? What about if I was building a stock ticker watcher - hundreds of clients viewing what is happening to the same 20 stocks? Its the same scenario. Would this be done in using the exchange mechnism you are proposing?

Of course you can. You just need to publish messages to "exchanges"
using meaningful routing keys and you need to create a single queue
for every web page view (or session). And use "bindings" to bind
together exchanges with queues (or use some similar architecture).
What you can't do is to publish a message _directly_ to the queue. As
this implies that only a single consumer will be able to pick it up.
It won't be duplicated. If you want it to be duplicated - use
exchanges. See the STOMP broadcast example.

Cheers,
  Marek Majkowski

From sigurd.hogsbro at museeka.com  Tue Aug 31 14:57:40 2010
From: sigurd.hogsbro at museeka.com (=?utf-8?Q?Sigurd_H=C3=B8gsbro?=)
Date: Tue, 31 Aug 2010 14:57:40 +0100
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>
	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>
Message-ID: <88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>

Hi Alexis,

As it is mainly for diagnostics we'll deal without it.

Regards,

Sigurd

On 31 Aug 2010, at 13:51, Alexis Richardson <alexis at rabbitmq.com> wrote:

> Sigurd
> 
> Do you think you will be able to develop a workaround?
> 
> alexis
> 
> 
> 2010/8/31 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>:
>> Thanks Aaron, I was afraid that's what would be coming back ;-)
>> 
>> Sigurd
>> 
>> On Aug 30, 8:38 pm, Aaron Westendorf <aa... at agoragames.com> wrote:
>>> Some time ago we had a conversation with the team and learned that the
>>> redirect was removed in the 0.9.1 spec.  I suspect that the
>>> corresponding known_hosts data may have also been removed.  A quick
>>> check of the protocol docs seem to confirm this.
>>> 
>>> -Aaron
>>> 
>>> 2010/8/30 Sigurd H?gsbro <sigurd.hogs... at museeka.com>:
>>> 
>>>> Hi,
>>> 
>>>> Since the upgrade to 2.0.0 I notice that the known_hosts property is
>>>> no longer getting populated by the hostname of the server to which
>>>> I've connected. This was quite useful to us for diagnostics since we
>>>> use a proxy-based connection layer. Is this an oversight, or a
>>>> deliberate change related to 0.9.1?
>>> 
>>>> Sigurd
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> --
>>> Aaron Westendorf
>>> Senior Software Engineer
>>> Agora Games
>>> 359 Broadway
>>> Troy, NY 12180
>>> Phone: 518.268.1000
>>> aa... at agoragames.comwww.agoragames.com
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 

From ovidiudeac at gmail.com  Tue Aug 31 20:44:47 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Tue, 31 Aug 2010 22:44:47 +0300
Subject: [rabbitmq-discuss] can I do cascade routing in rabbitmq?
Message-ID: <AANLkTi=iGOTMub8VdAWgqy=QzXcQUFWEo00uXfj1-s15@mail.gmail.com>

I have the following situation:

I get all the messages in a topic exchange and they are routed to
several queues. The messages that get to a certain queue are sent to
another topic exchange with the same routing key and a new set of
routing rules is applied.

The current implementation is done using two topic exchanges a queue
and a client which takes messages from the queue and publishes them
into the second exchange. Is it possible to do this by routing rules
only so I don't need to write any client code?

Thanks,
Ovidiu

From matthew at rabbitmq.com  Tue Aug 31 20:56:24 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 31 Aug 2010 20:56:24 +0100
Subject: [rabbitmq-discuss] can I do cascade routing in rabbitmq?
In-Reply-To: <AANLkTi=iGOTMub8VdAWgqy=QzXcQUFWEo00uXfj1-s15@mail.gmail.com>
References: <AANLkTi=iGOTMub8VdAWgqy=QzXcQUFWEo00uXfj1-s15@mail.gmail.com>
Message-ID: <20100831195623.GB4232@rabbitmq.com>

On Tue, Aug 31, 2010 at 10:44:47PM +0300, Ovidiu Deac wrote:
> The current implementation is done using two topic exchanges a queue
> and a client which takes messages from the queue and publishes them
> into the second exchange. Is it possible to do this by routing rules
> only so I don't need to write any client code?

Not by routing rules alone, but you can use the shovel for this purpose
which has the advantage of being embeddable within the same Erlang VM as
Rabbit itself, thus avoid the TCP stack.

See http://www.rabbitmq.com/plugins.html and
http://hg.rabbitmq.com/rabbitmq-shovel/file/rabbitmq_v2_0_0/README

Matthew

From ovidiudeac at gmail.com  Tue Aug 31 21:11:44 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Tue, 31 Aug 2010 23:11:44 +0300
Subject: [rabbitmq-discuss] can I do cascade routing in rabbitmq?
In-Reply-To: <20100831195623.GB4232@rabbitmq.com>
References: <AANLkTi=iGOTMub8VdAWgqy=QzXcQUFWEo00uXfj1-s15@mail.gmail.com>
	<20100831195623.GB4232@rabbitmq.com>
Message-ID: <AANLkTin5Uq+J2_=MnNGTQdCc2fv9y8HC5MUN-qhHBVuy@mail.gmail.com>

Thanks for the answer. I'll check it out.

Ovidiu

On Tue, Aug 31, 2010 at 10:56 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Tue, Aug 31, 2010 at 10:44:47PM +0300, Ovidiu Deac wrote:
>> The current implementation is done using two topic exchanges a queue
>> and a client which takes messages from the queue and publishes them
>> into the second exchange. Is it possible to do this by routing rules
>> only so I don't need to write any client code?
>
> Not by routing rules alone, but you can use the shovel for this purpose
> which has the advantage of being embeddable within the same Erlang VM as
> Rabbit itself, thus avoid the TCP stack.
>
> See http://www.rabbitmq.com/plugins.html and
> http://hg.rabbitmq.com/rabbitmq-shovel/file/rabbitmq_v2_0_0/README
>
> Matthew
>

From matthew at rabbitmq.com  Tue Aug 31 21:22:25 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 31 Aug 2010 21:22:25 +0100
Subject: [rabbitmq-discuss] can I do cascade routing in rabbitmq?
In-Reply-To: <AANLkTin5Uq+J2_=MnNGTQdCc2fv9y8HC5MUN-qhHBVuy@mail.gmail.com>
References: <AANLkTi=iGOTMub8VdAWgqy=QzXcQUFWEo00uXfj1-s15@mail.gmail.com>
	<20100831195623.GB4232@rabbitmq.com>
	<AANLkTin5Uq+J2_=MnNGTQdCc2fv9y8HC5MUN-qhHBVuy@mail.gmail.com>
Message-ID: <20100831202225.GD4232@rabbitmq.com>

On Tue, Aug 31, 2010 at 11:11:44PM +0300, Ovidiu Deac wrote:
> Thanks for the answer. I'll check it out.

Cool. The other solution to this might be exchange-to-exchange bindings
which we've not implemented yet but have been considering for some time.
Any chance you could explain a bit more about your use case - we're
always looking for compelling excuses to implement such features!

Matthew

From clegnitto at mozilla.com  Tue Aug 31 21:41:30 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Tue, 31 Aug 2010 13:41:30 -0700
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
Message-ID: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>

Does RabbitMQ currently support (or are there plans to) something like:

http://activemq.apache.org/slow-consumer-handling.html

I'd like to define a max size for a queue and configure the behavior when the threshold is released. I guess I could have some cleanup consumer that drains the queues periodically, but that seems error-prone and brittle.

Thanks,
Christian

From matthias at rabbitmq.com  Tue Aug 31 21:50:04 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 31 Aug 2010 21:50:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
Message-ID: <4C7D6AFC.6060805@rabbitmq.com>

Christian,

Christian Legnitto wrote:
> Does RabbitMQ currently support (or are there plans to) something
> like:
> 
> http://activemq.apache.org/slow-consumer-handling.html
> 
> I'd like to define a max size for a queue and configure the behavior
> when the threshold is released. I guess I could have some cleanup
> consumer that drains the queues periodically, but that seems
> error-prone and brittle.

What's the problem with just keeping the messages in the queue? RabbitMQ 
automatically pages messages to disk, so it's not bounded by memory. And 
the disk paging is quite clever in that it gives more memory to fast 
moving queues.


Regards,

Matthias.

From jon.brisbin at npcinternational.com  Tue Aug 31 22:01:44 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 31 Aug 2010 16:01:44 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
Message-ID: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>

When I'm using the erlang client I have checked out with the server, using the direct connection works okay. Now I'm writing a standalone client against 2.0 (release) and getting a funky error (more below):

{error,
            {{writer_died,<0.64.0>,
                 {badarg,
                     [{rabbit_framing_amqp_0_9_1,encode_method_fields,1},
                      {rabbit_binary_generator,build_simple_method_frame,3},
                      {rabbit_writer,internal_send_command_async,4},
                      {rabbit_writer,handle_message,2},
                      {rabbit_writer,mainloop,1}]}},
             {gen_server,call,
                 [<0.62.0>,
                  {call,
                      {'queue.bind',0,<<"amq.gen-YL0TlFxCix5C0ddBrXzKNg==">>,
                          {'exchange.declare',0,<<"pgload.test">>,
                              <<"topic">>,false,true,false,false,false,[]},
                          <<"pgload.sql">>,false,[]},
                      none},
                  infinity]}}}

Is there a rev I need to check out explicitly to get a 2.0-release-friendly erlang client?

Jon Brisbin
Portal Webmaster
NPC International, Inc.



=ERROR REPORT==== 31-Aug-2010::15:55:48 ===
Channel 1 closing: received exit signal from writer. Reason: {badarg,
                                                              [{rabbit_framing_amqp_0_9_1,
                                                                encode_method_fields,
                                                                1},
                                                               {rabbit_binary_generator,
                                                                build_simple_method_frame,
                                                                3},
                                                               {rabbit_writer,
                                                                internal_send_command_async,
                                                                4},
                                                               {rabbit_writer,
                                                                handle_message,
                                                                2},
                                                               {rabbit_writer,
                                                                mainloop,1}]}

=ERROR REPORT==== 31-Aug-2010::15:55:48 ===
** Generic server <0.62.0> terminating 
** Last message in was {'EXIT',<0.64.0>,
                           {badarg,
                               [{rabbit_framing_amqp_0_9_1,
                                    encode_method_fields,1},
                                {rabbit_binary_generator,
                                    build_simple_method_frame,3},
                                {rabbit_writer,internal_send_command_async,4},
                                {rabbit_writer,handle_message,2},
                                {rabbit_writer,mainloop,1}]}}
** When Server state == {c_state,1,<0.55.0>,<0.63.0>,<0.64.0>,network,
                            {[{{<0.54.0>,#Ref<0.0.0.78>},
                               {'queue.bind',0,
                                   <<"amq.gen-YL0TlFxCix5C0ddBrXzKNg==">>,
                                   {'exchange.declare',0,<<"pgload.test">>,
                                       <<"topic">>,false,true,false,false,
                                       false,[]},
                                   <<"pgload.sql">>,false,[]},
                               none}],
                             []},
                            {[],[]},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            false,none,false,none,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            unknown}
** Reason for termination == 
** {writer_died,<0.64.0>,
                {badarg,[{rabbit_framing_amqp_0_9_1,encode_method_fields,1},
                         {rabbit_binary_generator,build_simple_method_frame,3},
                         {rabbit_writer,internal_send_command_async,4},
                         {rabbit_writer,handle_message,2},
                         {rabbit_writer,mainloop,1}]}}



From matthias at rabbitmq.com  Tue Aug 31 22:08:03 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 31 Aug 2010 22:08:03 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>
Message-ID: <4C7D6F33.4050101@rabbitmq.com>

Jon,

Jon Brisbin wrote:
> Is there a rev I need to check out explicitly to get a
> 2.0-release-friendly erlang client?

Try the revision tagged 'rabbitmq_v2_0_0'.

Regards,

Matthias.

From clegnitto at mozilla.com  Tue Aug 31 22:16:11 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Tue, 31 Aug 2010 14:16:11 -0700
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <4C7D6AFC.6060805@rabbitmq.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
Message-ID: <6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>

My main issue is I intend to have hundreds of queues with 100k+ messages that may or may not be processed in a timely manner. Memory is ok with the new persister (yay!), but the disk fills up quickly. Right now with only 1 consumer, if I don't ack messages coming from bugzilla for 2 days I use up 20GB of disk. I can of course throw hardware at the problem, but it seems I'd reach a point where it merely wouldn't scale. I don't think it is unreasonable to tell consumers that all messages up to a point will be persisted, but once a threshold is reached only x amount of messages will persist. I see other brokers support such a thing, though it sounds like RabbitMQ likely does not.

Thanks,
Christian

On Aug 31, 2010, at 1:50 PM, Matthias Radestock wrote:

> Christian,
> 
> Christian Legnitto wrote:
>> Does RabbitMQ currently support (or are there plans to) something
>> like:
>> http://activemq.apache.org/slow-consumer-handling.html
>> I'd like to define a max size for a queue and configure the behavior
>> when the threshold is released. I guess I could have some cleanup
>> consumer that drains the queues periodically, but that seems
>> error-prone and brittle.
> 
> What's the problem with just keeping the messages in the queue? RabbitMQ automatically pages messages to disk, so it's not bounded by memory. And the disk paging is quite clever in that it gives more memory to fast moving queues.
> 
> 
> Regards,
> 
> Matthias.


From oyvind at tjervaag.com  Tue Aug 31 22:24:33 2010
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Tue, 31 Aug 2010 23:24:33 +0200
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
Message-ID: <C82F86B6-62C5-4C5B-AF47-D33BDA8E1D3E@tjervaag.com>

Hi!

Not to hijack anyones thread, but I thought I would chime in to second this feature-request :) I've got a couple of queues that might fill the disk if consumers are not working properly, and I still want the rest of the "slow moving" queues to live on.

In my case it would be nice if the server could throw out old messages (one by one as new messages come in) once the queue reaches a storage threshold/message count.

regards,
?yvind

On Aug 31, 2010, at 11:16 PM, Christian Legnitto wrote:

> My main issue is I intend to have hundreds of queues with 100k+ messages that may or may not be processed in a timely manner. Memory is ok with the new persister (yay!), but the disk fills up quickly. Right now with only 1 consumer, if I don't ack messages coming from bugzilla for 2 days I use up 20GB of disk. I can of course throw hardware at the problem, but it seems I'd reach a point where it merely wouldn't scale. I don't think it is unreasonable to tell consumers that all messages up to a point will be persisted, but once a threshold is reached only x amount of messages will persist. I see other brokers support such a thing, though it sounds like RabbitMQ likely does not.
> 
> Thanks,
> Christian
> 
> On Aug 31, 2010, at 1:50 PM, Matthias Radestock wrote:
> 
>> Christian,
>> 
>> Christian Legnitto wrote:
>>> Does RabbitMQ currently support (or are there plans to) something
>>> like:
>>> http://activemq.apache.org/slow-consumer-handling.html
>>> I'd like to define a max size for a queue and configure the behavior
>>> when the threshold is released. I guess I could have some cleanup
>>> consumer that drains the queues periodically, but that seems
>>> error-prone and brittle.
>> 
>> What's the problem with just keeping the messages in the queue? RabbitMQ automatically pages messages to disk, so it's not bounded by memory. And the disk paging is quite clever in that it gives more memory to fast moving queues.
>> 
>> 
>> Regards,
>> 
>> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Tue Aug 31 22:29:22 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 31 Aug 2010 22:29:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
Message-ID: <4C7D7432.2050505@rabbitmq.com>

Christian,

Christian Legnitto wrote:
> My main issue is I intend to have hundreds of queues with 100k+ 
> messages that may or may not be processed in a timely manner. Memory 
> is ok with the new persister (yay!), but the disk fills up quickly. 
> Right now with only 1 consumer, if I don't ack messages coming from 
> bugzilla for 2 days I use up 20GB of disk. I can of course throw 
> hardware at the problem, but it seems I'd reach a point where it 
> merely wouldn't scale.

Thanks for explaining the problem you are trying to solve.

Note that in RabbitMQ messages are shared between queues, i.e. if the 
same message ends up in multiple queues we have at most one copy in 
memory and at most one copy on disk.

So you may find RabbitMQ scales better here than you expected.

> I don't think it is unreasonable to tell consumers that all messages
> up to a point will be persisted, but once a threshold is reached only
> x amount of messages will persist. I see other brokers support such a
> thing, though it sounds like RabbitMQ likely does not.

We did introduce queue leases in the 2.0.0 release, which allows the 
server to remove entire queues when they haven't been used for a while. 
That may not be the best fit for your use case, but it's certainly a 
feature aimed at addressing similar problems.

Another feature we have in our plans is per-queue message TTLs, i.e. 
messages will get removed from queues if they are older than a specified 
threshold. It sounds like that would fit your use case nicely, and 
arguably better than a count-based limit. Though the latter too is 
something we may support one day.


Regards,

Matthias.

From jon.brisbin at npcinternational.com  Tue Aug 31 22:32:25 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 31 Aug 2010 16:32:25 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>
Message-ID: <DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>

Tried checking out the 2.0 tag and I'm getting a different error this time:

worker: {error,
            {bad_return_value,
                {error,
                    {auth_failure_likely,
                        {error,
                            {undef,
                                [{rabbit_writer,start_link,
                                     [#Port<0.704>,0,4096,
                                      rabbit_framing_amqp_0_9_1]},
                                 {amqp_channel_util,
                                     start_channel_infrastructure,3},
                                 {amqp_network_connection,do_handshake,1},
                                 {amqp_network_connection,init,1},
                                 {gen_server,init_it,6},
                                 {proc_lib,init_p_do_apply,3}]}}}}}}


But I know guest can access the server:

+-( ~ ):> sudo rabbitmqctl list_permissions
Listing permissions in vhost "/" ...
guest	.*	.*	.*	client
...done.

Is there something else I need to do in 2.0 to permit guest to create anonymous queues, etc...? There's a brief mention of something like that on the website. Something about allowing amq.gen ,etc... Does that apply here?

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Aug 31, 2010, at 4:01 PM, Jon Brisbin wrote:

> When I'm using the erlang client I have checked out with the server, using the direct connection works okay. Now I'm writing a standalone client against 2.0 (release) and getting a funky error (more below):
> 
> {error,
>            {{writer_died,<0.64.0>,
>                 {badarg,
>                     [{rabbit_framing_amqp_0_9_1,encode_method_fields,1},
>                      {rabbit_binary_generator,build_simple_method_frame,3},
>                      {rabbit_writer,internal_send_command_async,4},
>                      {rabbit_writer,handle_message,2},
>                      {rabbit_writer,mainloop,1}]}},
>             {gen_server,call,
>                 [<0.62.0>,
>                  {call,
>                      {'queue.bind',0,<<"amq.gen-YL0TlFxCix5C0ddBrXzKNg==">>,
>                          {'exchange.declare',0,<<"pgload.test">>,
>                              <<"topic">>,false,true,false,false,false,[]},
>                          <<"pgload.sql">>,false,[]},
>                      none},
>                  infinity]}}}
> 
> Is there a rev I need to check out explicitly to get a 2.0-release-friendly erlang client?
> 
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
> 
> 
> 
> =ERROR REPORT==== 31-Aug-2010::15:55:48 ===
> Channel 1 closing: received exit signal from writer. Reason: {badarg,
>                                                              [{rabbit_framing_amqp_0_9_1,
>                                                                encode_method_fields,
>                                                                1},
>                                                               {rabbit_binary_generator,
>                                                                build_simple_method_frame,
>                                                                3},
>                                                               {rabbit_writer,
>                                                                internal_send_command_async,
>                                                                4},
>                                                               {rabbit_writer,
>                                                                handle_message,
>                                                                2},
>                                                               {rabbit_writer,
>                                                                mainloop,1}]}
> 
> =ERROR REPORT==== 31-Aug-2010::15:55:48 ===
> ** Generic server <0.62.0> terminating 
> ** Last message in was {'EXIT',<0.64.0>,
>                           {badarg,
>                               [{rabbit_framing_amqp_0_9_1,
>                                    encode_method_fields,1},
>                                {rabbit_binary_generator,
>                                    build_simple_method_frame,3},
>                                {rabbit_writer,internal_send_command_async,4},
>                                {rabbit_writer,handle_message,2},
>                                {rabbit_writer,mainloop,1}]}}
> ** When Server state == {c_state,1,<0.55.0>,<0.63.0>,<0.64.0>,network,
>                            {[{{<0.54.0>,#Ref<0.0.0.78>},
>                               {'queue.bind',0,
>                                   <<"amq.gen-YL0TlFxCix5C0ddBrXzKNg==">>,
>                                   {'exchange.declare',0,<<"pgload.test">>,
>                                       <<"topic">>,false,true,false,false,
>                                       false,[]},
>                                   <<"pgload.sql">>,false,[]},
>                               none}],
>                             []},
>                            {[],[]},
>                            {dict,0,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  [],[]}}},
>                            false,none,false,none,
>                            {dict,0,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  [],[]}}},
>                            unknown}
> ** Reason for termination == 
> ** {writer_died,<0.64.0>,
>                {badarg,[{rabbit_framing_amqp_0_9_1,encode_method_fields,1},
>                         {rabbit_binary_generator,build_simple_method_frame,3},
>                         {rabbit_writer,internal_send_command_async,4},
>                         {rabbit_writer,handle_message,2},
>                         {rabbit_writer,mainloop,1}]}}
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Tue Aug 31 22:38:19 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 31 Aug 2010 22:38:19 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>
	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>
Message-ID: <20100831213818.GA13575@rabbitmq.com>

On Tue, Aug 31, 2010 at 04:32:25PM -0500, Jon Brisbin wrote:
> Tried checking out the 2.0 tag and I'm getting a different error this time:

I suspect that in the course of checking out the erlang client, it's
also brought down the server sources as well, which must also be on the
v2.0.0 revision. Sadly the erlang client can't be built without the
sources for the broker being around, though this is some I hope we'll
fix in the future.

Thus in the rabbitmq-server directory, please also do an
hg up -C rabbitmq_v2_0_0 && make clean

then the same in the erlang client, and then everything should build and
work correctly.

Apologies for how convoluted this all is.

Matthew

From matthias at rabbitmq.com  Tue Aug 31 22:40:23 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 31 Aug 2010 22:40:23 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>
	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>
Message-ID: <4C7D76C7.3040201@rabbitmq.com>

Jon,

Jon Brisbin wrote:
> Tried checking out the 2.0 tag and I'm getting a different error this time:

Did you check out the 'rabbitmq_v2_0_0' tag on *all* the repos you are 
using (broker, codegen, erlang-client, etc)? And do a clean build?

Because ...

> worker: {error,
>             {bad_return_value,
>                 {error,
>                     {auth_failure_likely,
>                         {error,
>                             {undef,
>                                 [{rabbit_writer,start_link,
>                                      [#Port<0.704>,0,4096,
>                                       rabbit_framing_amqp_0_9_1]},
>                                  {amqp_channel_util,
>                                      start_channel_infrastructure,3},
>                                  {amqp_network_connection,do_handshake,1},
>                                  {amqp_network_connection,init,1},
>                                  {gen_server,init_it,6},
>                                  {proc_lib,init_p_do_apply,3}]}}}}}}

indicates that you have the wrong version of the broker code.

Also, why are you building from source anyway? Can't you simply use the 
stock 2.0.0 server and associated binary plugins?


Regards,

Matthias.

From jon.brisbin at npcinternational.com  Tue Aug 31 22:50:16 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 31 Aug 2010 16:50:16 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <4C7D76C7.3040201@rabbitmq.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>
	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>
	<4C7D76C7.3040201@rabbitmq.com>
Message-ID: <066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>


On Aug 31, 2010, at 4:40 PM, Matthias Radestock wrote:

> Jon,
> 
> Jon Brisbin wrote:
>> Tried checking out the 2.0 tag and I'm getting a different error this time:
> 
> Did you check out the 'rabbitmq_v2_0_0' tag on *all* the repos you are using (broker, codegen, erlang-client, etc)? And do a clean build?

I actually updated the Makefile with the "-u rabbitmq_v2_0_0" so they would all be of the right tag.

'Taint my first rodeo. ;)

> 
> Because ...
> 
>> worker: {error,
>>            {bad_return_value,
>>                {error,
>>                    {auth_failure_likely,
>>                        {error,
>>                            {undef,
>>                                [{rabbit_writer,start_link,
>>                                     [#Port<0.704>,0,4096,
>>                                      rabbit_framing_amqp_0_9_1]},
>>                                 {amqp_channel_util,
>>                                     start_channel_infrastructure,3},
>>                                 {amqp_network_connection,do_handshake,1},
>>                                 {amqp_network_connection,init,1},
>>                                 {gen_server,init_it,6},
>>                                 {proc_lib,init_p_do_apply,3}]}}}}}}
> 
> indicates that you have the wrong version of the broker code.
> 
> Also, why are you building from source anyway? Can't you simply use the stock 2.0.0 server and associated binary plugins?

I didn't see a link to the Erlang client (only) on the download page. Did I miss it? 

I would prefer to use a binary I didn't build myself but I need something I can put in my project deps directory (I'm using rebar) to compile against. This is a standalone OTP app.

Thanks!

Jon Brisbin
Portal Webmaster
NPC International, Inc.


From matthias at rabbitmq.com  Tue Aug 31 22:58:45 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 31 Aug 2010 22:58:45 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>
	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>
Message-ID: <4C7D7B15.6060106@rabbitmq.com>

Jon,

Jon Brisbin wrote:
> I actually updated the Makefile with the "-u rabbitmq_v2_0_0" so they
> would all be of the right tag.

Well, if you have the right source code then it must be picking up an 
old version of the server beams from somewhere. If a clean build (as 
suggested by Matthew) doesn't fix it then go hunting for stray .beam and 
.ez files.

>> Also, why are you building from source anyway? Can't you simply use
>> the stock 2.0.0 server and associated binary plugins?
> 
> I didn't see a link to the Erlang client (only) on the download page.
> Did I miss it?
> 
> I would prefer to use a binary I didn't build myself but I need
> something I can put in my project deps directory (I'm using rebar) to
> compile against. This is a standalone OTP app.

Ah ok. No, there isn't a .ez for the standalone Erlang client, only the 
embedded version. The latter is on our todo list.


Regards,

Matthias.

From irrer at umich.edu  Tue Aug 31 23:54:01 2010
From: irrer at umich.edu (Jim Irrer)
Date: Tue, 31 Aug 2010 18:54:01 -0400
Subject: [rabbitmq-discuss] Fwd:  RabbitMQ and queue message limits?
In-Reply-To: <4C7D7432.2050505@rabbitmq.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
	<4C7D7432.2050505@rabbitmq.com>
Message-ID: <AANLkTi=n8eSLNAZbTsksbL=gLvBJP3LuSE0EoCtDnwvG@mail.gmail.com>

Our group has wanted this sort of functionality also.  The problem we want
to solve
is pretty much the same:  If a queue comes to contain more than X entries,
then it
means that there is a problem with the consumer(s), and we would like to be
notified.

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


---------- Forwarded message ----------
From: Matthias Radestock <matthias at rabbitmq.com>
Date: Tue, Aug 31, 2010 at 5:29 PM
Subject: Re: [rabbitmq-discuss] RabbitMQ and queue message limits?
To: Christian Legnitto <clegnitto at mozilla.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com


Christian,


Christian Legnitto wrote:

> My main issue is I intend to have hundreds of queues with 100k+ messages
> that may or may not be processed in a timely manner. Memory is ok with the
> new persister (yay!), but the disk fills up quickly. Right now with only 1
> consumer, if I don't ack messages coming from bugzilla for 2 days I use up
> 20GB of disk. I can of course throw hardware at the problem, but it seems
> I'd reach a point where it merely wouldn't scale.
>

Thanks for explaining the problem you are trying to solve.

Note that in RabbitMQ messages are shared between queues, i.e. if the same
message ends up in multiple queues we have at most one copy in memory and at
most one copy on disk.

So you may find RabbitMQ scales better here than you expected.


 I don't think it is unreasonable to tell consumers that all messages
> up to a point will be persisted, but once a threshold is reached only
> x amount of messages will persist. I see other brokers support such a
> thing, though it sounds like RabbitMQ likely does not.
>

We did introduce queue leases in the 2.0.0 release, which allows the server
to remove entire queues when they haven't been used for a while. That may
not be the best fit for your use case, but it's certainly a feature aimed at
addressing similar problems.

Another feature we have in our plans is per-queue message TTLs, i.e.
messages will get removed from queues if they are older than a specified
threshold. It sounds like that would fit your use case nicely, and arguably
better than a count-based limit. Though the latter too is something we may
support one day.



Regards,

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100831/9061c2db/attachment.htm>

From matthew at rabbitmq.com  Tue Aug 31 23:59:45 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 31 Aug 2010 23:59:45 +0100
Subject: [rabbitmq-discuss] Fwd:  RabbitMQ and queue message limits?
In-Reply-To: <AANLkTi=n8eSLNAZbTsksbL=gLvBJP3LuSE0EoCtDnwvG@mail.gmail.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
	<4C7D7432.2050505@rabbitmq.com>
	<AANLkTi=n8eSLNAZbTsksbL=gLvBJP3LuSE0EoCtDnwvG@mail.gmail.com>
Message-ID: <20100831225943.GA15761@rabbitmq.com>

On Tue, Aug 31, 2010 at 06:54:01PM -0400, Jim Irrer wrote:
> Our group has wanted this sort of functionality also.  The problem we want
> to solve
> is pretty much the same:  If a queue comes to contain more than X entries,
> then it
> means that there is a problem with the consumer(s), and we would like to be
> notified.

That smells to me slightly like using the wrong tool for the job - is
there not some other monitoring mechanism that would be more appropriate
for detecting such issues or are such issues really invisible to the
outside world except for the clients interaction with the queue?

Matthew

