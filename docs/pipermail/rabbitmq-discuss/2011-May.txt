From Denis.Conan at telecom-sudparis.eu  Sun May  1 19:34:00 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Sun, 01 May 2011 20:34:00 +0200
Subject: [rabbitmq-discuss] Pika v0.9.5,
	how to get the routing key when consuming
Message-ID: <4DBDA798.1000304@telecom-sudparis.eu>


Hi all,

not being a Python programmer, it is difficult to find how the next lines from 
an old version of Pika must be written in v0.9.5:
def callback(ch, method, properties, body):
     print " [x] %r:%r" % (method.routing_key, body,)

More precisely, how to get the routing key of message consumed?

Thanks in advance.

Denis

From gmr at myyearbook.com  Sun May  1 19:42:37 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 1 May 2011 14:42:37 -0400
Subject: [rabbitmq-discuss] Pika v0.9.5,
 how to get the routing key when consuming
In-Reply-To: <4DBDA798.1000304@telecom-sudparis.eu>
References: <4DBDA798.1000304@telecom-sudparis.eu>
Message-ID: <442061E4C1DF4906B11333EB82BE34B3@myyearbook.com>

That does look correct, this is what your method parameter should look something like:

<Basic.Deliver(['consumer_tag=ctag0', 'redelivered=False', 'routing_key=test', 'delivery_tag=1', 'exchange='])>

Take a look at the examples at:

http://pika.github.com/examples.html

or in:

https://github.com/pika/pika/tree/master/examples 
On Sunday, May 1, 2011 at 2:34 PM, Denis Conan wrote:

> Hi all,
> 
> not being a Python programmer, it is difficult to find how the next lines from 
> an old version of Pika must be written in v0.9.5:
> def callback(ch, method, properties, body):
>  print " [x] %r:%r" % (method.routing_key, body,)
> 
> More precisely, how to get the routing key of message consumed?
> 
> Thanks in advance.
> 
> Denis
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110501/2a373faa/attachment.htm>

From Denis.Conan at telecom-sudparis.eu  Sun May  1 19:42:40 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Sun, 01 May 2011 20:42:40 +0200
Subject: [rabbitmq-discuss] Pika v0.9.5,
 how to get the routing key when consuming
In-Reply-To: <4DBDA798.1000304@telecom-sudparis.eu>
References: <4DBDA798.1000304@telecom-sudparis.eu>
Message-ID: <4DBDA9A0.9050408@telecom-sudparis.eu>

Le 01/05/2011 20:34, Denis Conan a ?crit :
>
> Hi all,
>
> not being a Python programmer, it is difficult to find how the next lines from
> an old version of Pika must be written in v0.9.5:
> def callback(ch, method, properties, body):
> print " [x] %r:%r" % (method.routing_key, body,)
>
> More precisely, how to get the routing key of message consumed?

same code

sorry for the noise

Denis

From Denis.Conan at telecom-sudparis.eu  Mon May  2 07:31:13 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Mon, 02 May 2011 08:31:13 +0200
Subject: [rabbitmq-discuss] Pika and XML-RPC
Message-ID: <4DBE4FB1.8090604@telecom-sudparis.eu>


Hi all,

using Pika with XML-RPC (in separate threads) leads sometimes to the following 
exception when starting the process and the two threads. Is there a known issue 
for when mixing Pika and XML-RPC?

Process Process-1:
Traceback (most recent call last):
   File "/usr/lib/python2.6/multiprocessing/process.py", line 232, in _bootstrap
     self.run()
   File "/usr/lib/python2.6/multiprocessing/process.py", line 88, in run
     self._target(*self._args, **self._kwargs)
   File 
"/home/denis/SVN/totemit/trunk/MARGE/RabbitMQ-Redmine-TOTEM/TSP-MARGE-Communication/RabbitMQ/RabbitMQTOTEMLibrary/Python/net/totem/gamelogic/creategamelogicserver.py", 
line 39, in createGameLogicServer
     mystate.connection.ioloop.start()
   File 
"/home/denis/Tmp/Local/Python/pika-0.9.5/pika/adapters/select_connection.py", 
line 124, in start
     self.poller.start()
   File 
"/home/denis/Tmp/Local/Python/pika-0.9.5/pika/adapters/select_connection.py", 
line 374, in start
     self.poll()
   File 
"/home/denis/Tmp/Local/Python/pika-0.9.5/pika/adapters/select_connection.py", 
line 388, in poll
     self._handler(events[0][0], events[0][1])
   File 
"/home/denis/Tmp/Local/Python/pika-0.9.5/pika/adapters/base_connection.py", 
line 134, in _handle_events
     self._handle_read()
   File 
"/home/denis/Tmp/Local/Python/pika-0.9.5/pika/adapters/base_connection.py", 
line 162, in _handle_read
     self._on_data_available(data)
   File "/home/denis/Tmp/Local/Python/pika-0.9.5/pika/connection.py", line 599, 
in _on_data_available
     self._channels[frame.channel_number].transport.deliver(frame)
   File "/home/denis/Tmp/Local/Python/pika-0.9.5/pika/channel.py", line 64, in 
deliver
     self.frame_dispatcher.process(frame)
   File "/home/denis/Tmp/Local/Python/pika-0.9.5/pika/frame.py", line 202, in 
process
     self._handler(frame)
   File "/home/denis/Tmp/Local/Python/pika-0.9.5/pika/frame.py", line 220, in 
_handle_method_frame
     raise NotImplementedError(frame.method.__class__)
NotImplementedError: <class 'pika.spec.DeclareOk'>

Denis

From james.anderson at setf.de  Mon May  2 13:01:41 2011
From: james.anderson at setf.de (james anderson)
Date: Mon, 2 May 2011 14:01:41 +0200
Subject: [rabbitmq-discuss] difficulties with prefetch count
Message-ID: <840D5188-98CF-4414-BE74-00AAB0AC764D@setf.de>

good afternoon, gentlemen;


we find that a qos request with prefetch count of 1 does not reliably  
achieve "fair dispatch" and seek advice, what we should reconfigure  
in order to achieve it.

the specification page[1] indicates that rmq supports local prefetch  
limits, but not global ones. the BasicQosDesign[2] wiki entry  
describes some restrictions, in particular qos/consume ordering. the  
work queue tutorial describes how to use prefetch constraints to  
achieve "fair dispatch".

despite adhering to these understandings, we observe the following  
with rmq 2.1.1:

a server process establishes four worker threads, each of which
  - creates a connection to the rmq broker
  - creates a shared work queue (most likely redundantly)
  - a private sub-task queue for responses to delegated tasks
  - creates two channels on its connection;
    - one channel is for task messages; there it requests qos 
(prefetch=1), consume(work queue).
    - one channel is used to delegate tasks; on this one just consume 
(delegated response queue).
  - accepts delivery of task messages, processes them, publishes  
results to a task-identified response queue.

a front-end process establishes equivalent threads, each of which  
supports http requests and mediates them to the server.
for each front-end request, a thread
  - creates a connection to the rmq server
  - creates a task-specific queue (as per routing) for an eventual  
response
  - subscribes to the response queue
  - publishes a task message with routing to the work queue
  - accepts delivery of task responses
  - tears down the task response subscription and queue.

in this particular situation, no delegation occurs. that is, no  
messages pass through the delegated work queue.

we observe that, if a posted task takes an "long" time, not only its  
front-end thread will wait until that processing completes, but one  
additional front-end task hangs was well.

while the long task transpires, other http requests are processed  
without delay. that is, their setup, request, subscription, delivery,  
and tear-down, all complete as normal. their task messages are  
delivered to one of the three unoccupied server threads which does  
the work and produces the response.

independent of whether the front-end leaves the hung task to wait for  
a response or aborts it, by canceling the subscription, deleting the  
queue, and closing the connection, once the long-running server  
thread completes its task, the next message delivered to it is that  
message from the waiting-or-aborted front-end thread.

if we use rabbitmqctl to display the connection/subscription/queue  
state during the long task processing, we observe that
- the work queue has one unacknowledged message, but zero ready messages
- the server task channels have a prefetch window of 1
- no connection has a send pending

that is, it appears as if one single message is held up until the  
long task complete, but is no where to be seen.
what do we not understand about prefetch windows?

---------------

[1] http://www.rabbitmq.com/specification.html
[2] https://dev.rabbitmq.com/wiki/BasicQosDesign
[3] http://www.rabbitmq.com/tutorials/tutorial-two-python.html


From kamauallan at gmail.com  Mon May  2 13:28:24 2011
From: kamauallan at gmail.com (Allan Kamau)
Date: Mon, 2 May 2011 15:28:24 +0300
Subject: [rabbitmq-discuss] difficulties with prefetch count
In-Reply-To: <840D5188-98CF-4414-BE74-00AAB0AC764D@setf.de>
References: <840D5188-98CF-4414-BE74-00AAB0AC764D@setf.de>
Message-ID: <BANLkTim4OsCDNZwefpqSGbEBTC7a+tgA2A@mail.gmail.com>

On Mon, May 2, 2011 at 3:01 PM, james anderson <james.anderson at setf.de> wrote:
> good afternoon, gentlemen;
>
>
> we find that a qos request with prefetch count of 1 does not reliably
> achieve "fair dispatch" and seek advice, what we should reconfigure in order
> to achieve it.
>
> the specification page[1] indicates that rmq supports local prefetch limits,
> but not global ones. the BasicQosDesign[2] wiki entry describes some
> restrictions, in particular qos/consume ordering. the work queue tutorial
> describes how to use prefetch constraints to achieve "fair dispatch".
>
> despite adhering to these understandings, we observe the following with rmq
> 2.1.1:
>
> a server process establishes four worker threads, each of which
> ?- creates a connection to the rmq broker
> ?- creates a shared work queue (most likely redundantly)
> ?- a private sub-task queue for responses to delegated tasks
> ?- creates two channels on its connection;
> ? - one channel is for task messages; there it requests qos(prefetch=1),
> consume(work queue).
> ? - one channel is used to delegate tasks; on this one just
> consume(delegated response queue).
> ?- accepts delivery of task messages, processes them, publishes results to a
> task-identified response queue.
>
> a front-end process establishes equivalent threads, each of which supports
> http requests and mediates them to the server.
> for each front-end request, a thread
> ?- creates a connection to the rmq server
> ?- creates a task-specific queue (as per routing) for an eventual response
> ?- subscribes to the response queue
> ?- publishes a task message with routing to the work queue
> ?- accepts delivery of task responses
> ?- tears down the task response subscription and queue.
>
> in this particular situation, no delegation occurs. that is, no messages
> pass through the delegated work queue.
>
> we observe that, if a posted task takes an "long" time, not only its
> front-end thread will wait until that processing completes, but one
> additional front-end task hangs was well.
>
> while the long task transpires, other http requests are processed without
> delay. that is, their setup, request, subscription, delivery, and tear-down,
> all complete as normal. their task messages are delivered to one of the
> three unoccupied server threads which does the work and produces the
> response.
>
> independent of whether the front-end leaves the hung task to wait for a
> response or aborts it, by canceling the subscription, deleting the queue,
> and closing the connection, once the long-running server thread completes
> its task, the next message delivered to it is that message from the
> waiting-or-aborted front-end thread.
>
> if we use rabbitmqctl to display the connection/subscription/queue state
> during the long task processing, we observe that
> - the work queue has one unacknowledged message, but zero ready messages
> - the server task channels have a prefetch window of 1
> - no connection has a send pending
>
> that is, it appears as if one single message is held up until the long task
> complete, but is no where to be seen.
> what do we not understand about prefetch windows?
>
> ---------------
>
> [1] http://www.rabbitmq.com/specification.html
> [2] https://dev.rabbitmq.com/wiki/BasicQosDesign
> [3] http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

I am quite new to RabbitMQ, reading your first line it seem you would
like the "fair dispatch" or round robin message fetching. This is the
default behaviour. The prefetch count of 1 does disable this "fair
dispatch" and lets the jobs be fetched by clients at quickly as they
can manage to consume them.

Allan.

From gmr at myyearbook.com  Mon May  2 19:32:16 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 2 May 2011 14:32:16 -0400
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1
In-Reply-To: <BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>
References: <4DB8A74B.9000105@echostar.com>
	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>
Message-ID: <BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>

In checking my cluster, I am seeing this too.  Looks like it pre-existed
2.4.1, the drop at week 16 is an upgrade from 2.3.1 to 2.4.1:

   [image: Memory.png]

The management plugin is reporting RAM usage for this node at 330MB and
Rabbit is the only service running on the box.  Anyone have some ideas on
how to try and figure out where the leak is?

Gavin


On Thu, Apr 28, 2011 at 8:34 AM, Aaron Westendorf <aaron at agoragames.com>wrote:

> Are you running the management plugin?  Specifically the web
> interface? We haven't had trouble with the agents, but we observed the
> same pattern you're describing on a node that was running the web
> stack, with similar traffic loads. Haven't had time to write up a bug
> report yet but I mentioned it in another thread.
>
> -Aaron
>
> On Wed, Apr 27, 2011 at 7:31 PM, Mark Geib <mark.geib at echostar.com> wrote:
> >
> > -----BEGIN PGP SIGNED MESSAGE-----
> > Hash: SHA1
> >
> > We have rabbitmq 2.4.1 on debian squeeze, erlang is R14A.
> >
> > Currently we have a dozen or some queue and 2-3 exchanges with message
> > rates of about 500/sec to 2000/sec over all the queues. These are all
> > direct exchanges, but both the exchanges and queues are durable and
> > all publishing is persistent.
> >
> > What we see is that the memory footprint of rabbitmq grows after
> > running for just a couple to a few hours. And eventually we get VM
> > alarms in the rabbitmq log. The funny thing is that we never queue up
> > more a 10-50 messages in any queue, usually in the single digits. So
> > the activity seems low, and the queue sizes are small, based on number
> > of messages.
> >
> > We have seem this with 2.3.1 and then upgraded to 2.4.1 and see the
> > same thing.
> >
> > With this level of usage, etc. this does not make sense. Any ideas.??
> >
> > Thanks,
> > Mark.
> >
> > - --
> > Principal Engineer
> > Cheyenne Software Engineering
> > mark.geib at echostar.com / 35-215
> >
> > PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
> > -----BEGIN PGP SIGNATURE-----
> > Version: GnuPG v1.4.10 (GNU/Linux)
> > Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> >
> > iEYEARECAAYFAk24p0sACgkQNMVrR9CRdv0kCQCfVya+xhlE6cN6MCdICPjzdWJq
> > kLQAnjgJQ+skYHgfirUatLLZxjjVhroc
> > =HBcw
> > -----END PGP SIGNATURE-----
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
>
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110502/c8a8a6f7/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 20393 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110502/c8a8a6f7/attachment-0001.png>

From matthias at rabbitmq.com  Mon May  2 19:48:58 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 02 May 2011 19:48:58 +0100
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1
In-Reply-To: <BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>
References: <4DB8A74B.9000105@echostar.com>	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>
	<BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>
Message-ID: <4DBEFC9A.4040705@rabbitmq.com>

Gavin,

Gavin M. Roy wrote:
> In checking my cluster, I am seeing this too.  Looks like it pre-existed 
> 2.4.1, the drop at week 16 is an upgrade from 2.3.1 to 2.4.1:
> 
> Memory.png
> 
> 
> The management plugin is reporting RAM usage for this node at 330MB and 
> Rabbit is the only service running on the box.  Anyone have some ideas 
> on how to try and figure out where the leak is?

The above graph shows system memory usage. It is perfectly normal for a 
non-idle linux system to gradually fill up all the memory with cached 
files. And, as you say, rabbit thinks it is only using 330MB. Is the 
rabbit Erlang process considerably bigger than that?

Mark reported that he was seeing memory alarms in the logs, which only 
happens when rabbit itself thinks it has exceeded the watermark.

Regards,

Matthias.

From gmr at myyearbook.com  Mon May  2 20:12:34 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 2 May 2011 15:12:34 -0400
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1
In-Reply-To: <4DBEFC9A.4040705@rabbitmq.com>
References: <4DB8A74B.9000105@echostar.com>
	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>
	<BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>
	<4DBEFC9A.4040705@rabbitmq.com>
Message-ID: <812F5896312E4A8FAA2DFA2D5972DE41@myyearbook.com>


On Monday, May 2, 2011 at 2:48 PM, Matthias Radestock wrote: 
> Gavin,
> 
> The above graph shows system memory usage. It is perfectly normal for a 
> non-idle linux system to gradually fill up all the memory with cached 
> files.
Which I expect in disk buffers in that graph. The inactive memory is what threw me, going back and re-reading up on it, this is memory that previously been allocated in vm that can be reclaimed for other use, correct? I had read, I thought, that it was allocated and yet to be freed memory that was not actively being used.
>  And, as you say, rabbit thinks it is only using 330MB. Is the 
> rabbit Erlang process considerably bigger than that?
No, it is in that range.

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110502/acf3f34e/attachment.htm>

From matthias at rabbitmq.com  Mon May  2 20:29:16 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 02 May 2011 20:29:16 +0100
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1
In-Reply-To: <812F5896312E4A8FAA2DFA2D5972DE41@myyearbook.com>
References: <4DB8A74B.9000105@echostar.com>
	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>
	<BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>
	<4DBEFC9A.4040705@rabbitmq.com>
	<812F5896312E4A8FAA2DFA2D5972DE41@myyearbook.com>
Message-ID: <4DBF060C.2010103@rabbitmq.com>

Gavin,

Gavin M. Roy wrote:
> On Monday, May 2, 2011 at 2:48 PM, Matthias Radestock wrote:
>> The above graph shows system memory usage. It is perfectly normal for a
>> non-idle linux system to gradually fill up all the memory with cached
>> files.
> Which I expect in disk buffers in that graph. The inactive memory is 
> what threw me, going back and re-reading up on it, this is memory that 
> previously been allocated in vm that can be reclaimed for other use, 
> correct?

I have no idea. Consult your resident Linux expert ;)

As long as the system is not swapping it is probably fine. Have you ever 
seen it swap?

>> And, as you say, rabbit thinks it is only using 330MB. Is the
>> rabbit Erlang process considerably bigger than that?
> No, it is in that range.

In which case it's clearly not rabbit that is using the memory. So don't 
blame the poor bunny.


Regards,

Matthias.

From alexis at rabbitmq.com  Mon May  2 23:26:19 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 2 May 2011 23:26:19 +0100
Subject: [rabbitmq-discuss] Introducing bunny_farm: an erlang client for
	RabbitMQ
In-Reply-To: <B70A51C1-1F2C-4437-9012-7E2B7F22D0EF@muxspace.com>
References: <2AB2AE1D-46C7-40D5-9639-13EBB9A9F825@muxspace.com>
	<BANLkTikBxP3T1f4JSmhRoudO+v122fqb6w@mail.gmail.com>
	<B70A51C1-1F2C-4437-9012-7E2B7F22D0EF@muxspace.com>
Message-ID: <BANLkTi=mqCS-buPDm1=Jzme=yj8hxPbA9g@mail.gmail.com>

Cool :-)

On Sat, Apr 30, 2011 at 2:24 PM, Brian Rowe <rowe at muxspace.com> wrote:
> Alexis,
>
> A link would be great. I'm actively developing this library so any bug reports/feature requests will be addressed/accommodated quickly.
>
> Regards,
> Brian
>
>
>
> On Apr 28, 2011, at 4:20 AM, Alexis Richardson wrote:
>
>> Brian
>>
>> Many thanks! ?We shall add a link to this from the web site.
>>
>> alexis
>>
>>
>> On Sat, Apr 23, 2011 at 11:29 PM, Brian Rowe <rowe at muxspace.com> wrote:
>>> Hello,
>>>
>>> For any erlang users out there, I wanted to introduce a rabbitmq client library I've been working on for a little while called bunny_farm. This library wraps up the wiring for connecting to a message queue and provides queue-based implementations of gen_server and gen_fsm behaviors. These behaviors (called gen_qserver and gen_qfsm, respectively) can subscribe to multiple exchanges with different routing keys and will dispatch messages received from the queue to handle_cast and Module:StateName/2 for standard messages, wrapping the payload in a tuple for the sake of pattern matching.
>>>
>>> handle_cast({<<RoutingKey/binary>>, Payload}, State)
>>>
>>> These behaviors also understand RPC semantics (if the reply_to field is populated) and will instead dispatch to handle_call and Module:StateName/3 instead. Under this scenario, the reply is automatically sent to the caller based on the contents of the routing key, which can be to a different exchange. I introduce a special format for the reply_to field so that if the key is colon-separated, the first token is used as the exchange: <<"exchange:routing_key">>. If no exchange is specified, then it defaults to the exchange the message was received on.
>>>
>>> Publishing messages are as easy as consuming messages:
>>> ?BusHandle = bunny_farm:open(<<"exchange">>)
>>> ?bunny_farm:publish([{key1,message}], <<"routing_key.1">>, BusHandle)
>>>
>>> Messages can be encoded as either erlang binaries or BSON, depending on the need. When receiving messages, the library auto-detects the format.
>>>
>>> The bunny_farm library is available on github at https://github.com/muxspace/bunny_farm. There is an example gen_qserver implementation and gen_qfsm implementation in the test directory. I'm hopeful this is useful for the community and any feedback is warmly appreciated.
>>>
>>>
>>> Regards,
>>> Brian Rowe
>>>
>>> P.S. Apologies if this is not the right list for this announcement.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>

From alexis at rabbitmq.com  Mon May  2 23:27:36 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 2 May 2011 23:27:36 +0100
Subject: [rabbitmq-discuss] New project with examples in Erlang
In-Reply-To: <FE8EF389-585E-4E87-A86E-6E0B7D4515D1@gmail.com>
References: <FE8EF389-585E-4E87-A86E-6E0B7D4515D1@gmail.com>
Message-ID: <BANLkTi=1b=p3tDB635T+pLups0Cz7kLJzQ@mail.gmail.com>

Alvaro

Very cool.

Have you looked at Spring Integration?  That aspires to some similar
things... but for Java and .NET people.

Also what do you think of this?  https://github.com/krasserm/scalaz-camel/wiki

alexis




On Sat, Apr 30, 2011 at 10:42 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi list,
>
> I've just released a library called "rmq_patterns" which implements some messaging patterns as they are explained in this book: ?http://www.eaipatterns.com/
>
> The examples showcase how to use the Rabbitmq Erlang Client adding more details on what's already explained here: http://www.rabbitmq.com/erlang-client-user-guide.html
>
> There's a new blog post explaining some of them here: http://videlalvaro.github.com/2011/04/an-army-of-minions-for-rabbitmq.html
>
> Cheers,
>
> Alvaro
>
> Sent form my Nokia 1100
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From amenges at vmware.com  Tue May  3 03:25:31 2011
From: amenges at vmware.com (Tony Menges)
Date: Mon, 02 May 2011 19:25:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnect logic for C library
In-Reply-To: <BANLkTim8uL5q7FZo-f-wE_02g78M__dcsg@mail.gmail.com>
Message-ID: <0adcfd20-2639-4884-a22d-be569742ba83@zimbra-prod-mbox-1.vmware.com>

Hi Paul,

I started to take a look at this and wanted to make sure I understand the problem. Is the basic problem that the return code from amqp_basic_publish() shows success even after the broker has closed the connection? Are you doing a commit after each message is published? Is commit showing success when the broker is down?

I've written a simple test driver program that allows me to vary the number of messages per transaction and the amount of delay between messages and after commits. I set the number of messages per transaction to 5, the delay between publishes to 0 and the delay after each transaction to a few seconds. After I see a commit, I ctl-C Rabbit and I see usually 5 (the transaction batch size) messages published and the commit fails with a connection closed error. The Wireshark trace shows that only 1 of the messages was actually put on the wire.

If I put a delay between message sends, I get a SIGPIPE usually after 1 or 2 messages have been sent.

I think that in the first case, the messages are put into the socket's output buffer fast enough that the close from the other side has not been processed (my messages are quite small so they all fit in the socket's buffer); amqp_tx_commit() actually tries to read from the socket so it will notice the socket closed.

Does this sound consistent with your experience?

Tony Menges
VMware, Inc

----- Original Message -----
From: "Paul Dix" <paul at pauldix.net>
To: "Matthias Radestock" <matthias at rabbitmq.com>
Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Tuesday, April 12, 2011 6:50:13 AM
Subject: Re: [rabbitmq-discuss] Reconnect logic for C library

Hi Matthias,
I briefly tried to use these two:

amqp_tx_commit(connection, channel);
amqp_get_rpc_reply(connection)

Then check the result. However, I found that it would indicate success
for a message or two after I took RabbitMQ down before it indicated a
problem. I ended up bailing on C, but I'd be interested to hear if
this is possible with the library. The two things are: fail if a
message doesn't get published (i.e. don't fail silently) and check
that a connection/channel is open.

Thanks,
Paul

On Tue, Apr 12, 2011 at 7:04 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Paul,
>
> On 01/04/11 22:40, Paul Dix wrote:
>>
>> I'm working with the rabbitmq c library and I need to have reconnect
>> logic in there. Basically, try to send a message, if it fails, attempt
>> reconnect and try again. How do I accomplish this? I've been using
>> amqp_basic_publish and if I try that it just hangs.
>
> Did you work out what the problem was? The people familiar with the C client
> at Rabbit HQ are a bit swamped at the moment, so it will likely be a while
> before we can look into this.
>
> Matthias.
>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at myyearbook.com  Tue May  3 04:28:58 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 2 May 2011 23:28:58 -0400
Subject: [rabbitmq-discuss] Pika and XML-RPC
In-Reply-To: <4DBE4FB1.8090604@telecom-sudparis.eu>
References: <4DBE4FB1.8090604@telecom-sudparis.eu>
Message-ID: <7D966D7E12D74C84B65C585035922261@myyearbook.com>

That's a pretty odd error, in essence it is getting a frame it does not understand, which is missing the AMQP Class for the frame sent.

You can try and catch this in your app by handling the NotImplementedError exception for "normal operation," as it appears that this is just a confirmation frame for something you're trying to do, declaring an exchange or queue.

Ideally, if you could get me more information, that'd be great. Please feel free to reply off list. What would help if you can edit line 220 of /home/denis/Tmp/Local/Python/pika-0.9.5/pika/frame.py and change it to raise NotImplementedError(frame), catching the exception and printing the repr of the frame. I could then use that data to try and figure out why you're not getting a valid AMQP Class when the frame is being decoded.

I've not used it with XML-RPC at all. If you want to send test code, I can see about putting it through its paces with that.

Gavin

On Monday, May 2, 2011 at 2:31 AM, Denis Conan wrote: 
> 
> Hi all,
> 
> using Pika with XML-RPC (in separate threads) leads sometimes to the following 
> exception when starting the process and the two threads. Is there a known issue 
> for when mixing Pika and XML-RPC?
> 
> Process Process-1:
> Traceback (most recent call last):
>  File "/usr/lib/python2.6/multiprocessing/process.py", line 232, in _bootstrap
>  self.run()
> File "/home/denis/Tmp/Local/Python/pika-0.9.5/pika/channel.py", line 64, in 
> deliver
>  self.frame_dispatcher.process(frame)
>  File "/home/denis/Tmp/Local/Python/pika-0.9.5/pika/frame.py", line 202, in 
> process
>  self._handler(frame)
>  File "/home/denis/Tmp/Local/Python/pika-0.9.5/pika/frame.py", line 220, in 
> _handle_method_frame
>  raise NotImplementedError(frame.method.__class__)
> NotImplementedError: <class 'pika.spec.DeclareOk'>
> 
> Denis
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110502/ee0d308f/attachment-0001.htm>

From josh at gebaschtel.ch  Tue May  3 06:26:31 2011
From: josh at gebaschtel.ch (Josh Geisser)
Date: Tue, 3 May 2011 07:26:31 +0200
Subject: [rabbitmq-discuss] WG:  Message Aggregating Queue
Message-ID: <9C37154E143FE14CBA656B2D2232745F080CACC1E145@popeye.gebaschtel.bnet>

Let me quickly try to understand that:

You want to get the most accurate instrument-data. As long as you're not overloaded, the sequential message processing is fine (queue size <=1). The Problem occurs if you can't keep up with the producers (>1). Then you have the case of consuming UBS at 12.3 although the very latest information (12.8) is already in the queue, but not yet processed, right?

A na?ve way to overcome that would be a Stack/FILO instead of a queue, not? Instead of consuming the next message, you'd consume the most recent one.
This way you get 12.8 before 12.3.

Of coarse this imposes that you have to take care of which tick is which (they are time stamped, not?) when you working down the stack. 

The further problem of starving messages could be reduced if the broker could kind of match and remove out-dated messages on a same pattern.

afaik not possible with rabbit :(

My 2 cents :)

Cheers
Josh


-----Urspr?ngliche Nachricht-----
Von: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] Im Auftrag von Jason Zaugg
Gesendet: Donnerstag, 28. April 2011 16:18
An: Irmo Manie
Cc: Alexis Richardson; rabbitmq-discuss at lists.rabbitmq.com
Betreff: Re: [rabbitmq-discuss] Message Aggregating Queue

On Thu, Apr 28, 2011 at 3:44 PM, Irmo Manie <irmo.manie at gmail.com> wrote:
> The problem is actually a bit more tricky than this. When it comes to
> market data you would route all the data to a client specific
> exclusive queue based on a subscription because every client has its
> own authorization, authentication and quality of service. (real-time,
> delayed, only eu stocks, tick by tick, tick only every minute, etc,
> etc).

But each client specific queue could implement the 'obsolete tick'
discarding in the broker, right?

> So the easy way is still just to have the consumer do the filtering
> itself by storing all messages in a key value store and empty this
> based on a ordered queue of ids to process.
> That way the consumer can 'consume' as fast as it can put the values
> in the K/V store which probably always is fast enough :-)

I would feel more comfortable knowing that the number of messages in
the broker is naturally bounded, even if the consumer misbehaves. It
would also be nice to have the possibility to have a pool of consumers
processing from a single queue, be able to restart the consumers
without losing unprocessed messages etc. Anyway, we should discuss
this some more internally; as always these sort of cats are amenable
to being skinned in multitude of ways :)

> Only if you can process the data (ticks) independently from each other
> it makes sense to have this filtering on the broker because then it
> would be useful for a cluster of consumers apps processing the data.
> But 9 out of 10 times you need the ticks of more than one instrument
> to do your business logic so you'd already keep a cache with the last
> values anyway.

> Still there could be other usecases of course where having this
> functionality at the broker can be really useful and powerful.

> /2cents

And well worth both of them :)

-jason
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-----Urspr?ngliche Nachricht-----

Among other things, we're using RabbitMQ to distribute market data ticks. The interesting characteristic about this stream of messages is that a new tick for a obsoletes previous, unprocessed, ticks for the same stock.

After a little brainstorming last night with Alvaro Videla, I'm curious to discuss how this could be modeled with an extension to RabbitMQ.

It seems a similar problem to the Queue Based TTL [1], however TTL isn't quite right for this case, as the validity period of a tick depends on the liquidity of the stock. We really just want the
*latest* tick.

Assume a message stream:

1. Tick { stock = "UBS", bid = 12.3 }   RK="tick.UBS"
2. Tick { stock = "ABB", bid = 15.3 }  RK="tick.ABB"
3. Tick { stock = "UBS", bid = 12.28 } RK="tick.UBS"

These are sent to a fanout exchange, and on to a queue(s) for a Consumer(s). Assume that consumer is slow, and the messages are not processed immediately. Rather than just en queuing message #3, I would like to insert it in place of message #1.

This has the nice property that the broker won't overrun with messages if the consumer can't keep up; and that the consumer doesn't do work that is obsolete.

What would be the suitable way to identify that #1 and #3 refer to the same stock? Is the routing key of message #1 retained after it has been en queued?

An generalization of this would be to provide a function that takes the old and new message and combines them into an aggregated message.
For example, we might want to track the latest, min and max:

  AggregatedTick { stock = "UBS", latestBid = 12.28 minBid=12.28 maxBid=12.30 }

So, does this sound sensible and possible?

-jason

[1] http://www.rabbitmq.com/extensions.html#queue-ttl

From alexis at rabbitmq.com  Tue May  3 06:33:57 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 3 May 2011 06:33:57 +0100
Subject: [rabbitmq-discuss] WG: Message Aggregating Queue
In-Reply-To: <9C37154E143FE14CBA656B2D2232745F080CACC1E145@popeye.gebaschtel.bnet>
References: <9C37154E143FE14CBA656B2D2232745F080CACC1E145@popeye.gebaschtel.bnet>
Message-ID: <BANLkTinrLhhrO8jOCqeBkdRGDyfsvWfNpg@mail.gmail.com>

I'd be interested to see what semantics for "update" people on this
list would propose, that would make sense for queues.  Include the
case where messages are routed to multiple queues which have different
sets of consumers.

alexis


On Tue, May 3, 2011 at 6:26 AM, Josh Geisser <josh at gebaschtel.ch> wrote:
> Let me quickly try to understand that:
>
> You want to get the most accurate instrument-data. As long as you're not overloaded, the sequential message processing is fine (queue size <=1). The Problem occurs if you can't keep up with the producers (>1). Then you have the case of consuming UBS at 12.3 although the very latest information (12.8) is already in the queue, but not yet processed, right?
>
> A na?ve way to overcome that would be a Stack/FILO instead of a queue, not? Instead of consuming the next message, you'd consume the most recent one.
> This way you get 12.8 before 12.3.
>
> Of coarse this imposes that you have to take care of which tick is which (they are time stamped, not?) when you working down the stack.
>
> The further problem of starving messages could be reduced if the broker could kind of match and remove out-dated messages on a same pattern.
>
> afaik not possible with rabbit :(
>
> My 2 cents :)
>
> Cheers
> Josh
>
>
> -----Urspr?ngliche Nachricht-----
> Von: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] Im Auftrag von Jason Zaugg
> Gesendet: Donnerstag, 28. April 2011 16:18
> An: Irmo Manie
> Cc: Alexis Richardson; rabbitmq-discuss at lists.rabbitmq.com
> Betreff: Re: [rabbitmq-discuss] Message Aggregating Queue
>
> On Thu, Apr 28, 2011 at 3:44 PM, Irmo Manie <irmo.manie at gmail.com> wrote:
>> The problem is actually a bit more tricky than this. When it comes to
>> market data you would route all the data to a client specific
>> exclusive queue based on a subscription because every client has its
>> own authorization, authentication and quality of service. (real-time,
>> delayed, only eu stocks, tick by tick, tick only every minute, etc,
>> etc).
>
> But each client specific queue could implement the 'obsolete tick'
> discarding in the broker, right?
>
>> So the easy way is still just to have the consumer do the filtering
>> itself by storing all messages in a key value store and empty this
>> based on a ordered queue of ids to process.
>> That way the consumer can 'consume' as fast as it can put the values
>> in the K/V store which probably always is fast enough :-)
>
> I would feel more comfortable knowing that the number of messages in
> the broker is naturally bounded, even if the consumer misbehaves. It
> would also be nice to have the possibility to have a pool of consumers
> processing from a single queue, be able to restart the consumers
> without losing unprocessed messages etc. Anyway, we should discuss
> this some more internally; as always these sort of cats are amenable
> to being skinned in multitude of ways :)
>
>> Only if you can process the data (ticks) independently from each other
>> it makes sense to have this filtering on the broker because then it
>> would be useful for a cluster of consumers apps processing the data.
>> But 9 out of 10 times you need the ticks of more than one instrument
>> to do your business logic so you'd already keep a cache with the last
>> values anyway.
>
>> Still there could be other usecases of course where having this
>> functionality at the broker can be really useful and powerful.
>
>> /2cents
>
> And well worth both of them :)
>
> -jason
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> -----Urspr?ngliche Nachricht-----
>
> Among other things, we're using RabbitMQ to distribute market data ticks. The interesting characteristic about this stream of messages is that a new tick for a obsoletes previous, unprocessed, ticks for the same stock.
>
> After a little brainstorming last night with Alvaro Videla, I'm curious to discuss how this could be modeled with an extension to RabbitMQ.
>
> It seems a similar problem to the Queue Based TTL [1], however TTL isn't quite right for this case, as the validity period of a tick depends on the liquidity of the stock. We really just want the
> *latest* tick.
>
> Assume a message stream:
>
> 1. Tick { stock = "UBS", bid = 12.3 } ? RK="tick.UBS"
> 2. Tick { stock = "ABB", bid = 15.3 } ?RK="tick.ABB"
> 3. Tick { stock = "UBS", bid = 12.28 } RK="tick.UBS"
>
> These are sent to a fanout exchange, and on to a queue(s) for a Consumer(s). Assume that consumer is slow, and the messages are not processed immediately. Rather than just en queuing message #3, I would like to insert it in place of message #1.
>
> This has the nice property that the broker won't overrun with messages if the consumer can't keep up; and that the consumer doesn't do work that is obsolete.
>
> What would be the suitable way to identify that #1 and #3 refer to the same stock? Is the routing key of message #1 retained after it has been en queued?
>
> An generalization of this would be to provide a function that takes the old and new message and combines them into an aggregated message.
> For example, we might want to track the latest, min and max:
>
> ?AggregatedTick { stock = "UBS", latestBid = 12.28 minBid=12.28 maxBid=12.30 }
>
> So, does this sound sensible and possible?
>
> -jason
>
> [1] http://www.rabbitmq.com/extensions.html#queue-ttl
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From dmaher at milestonelab.com  Tue May  3 08:46:05 2011
From: dmaher at milestonelab.com (Daniel Maher)
Date: Tue, 03 May 2011 09:46:05 +0200
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1
In-Reply-To: <4DBF060C.2010103@rabbitmq.com>
References: <4DB8A74B.9000105@echostar.com>
	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>
	<BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>
	<4DBEFC9A.4040705@rabbitmq.com>
	<812F5896312E4A8FAA2DFA2D5972DE41@myyearbook.com>
	<4DBF060C.2010103@rabbitmq.com>
Message-ID: <1304408765.2451.5.camel@danstation>

On Mon, 2011-05-02 at 20:29 +0100, Matthias Radestock wrote:
> Gavin M. Roy wrote:
> > On Monday, May 2, 2011 at 2:48 PM, Matthias Radestock wrote:
> >> The above graph shows system memory usage. It is perfectly normal for a
> >> non-idle linux system to gradually fill up all the memory with cached
> >> files.
> > Which I expect in disk buffers in that graph. The inactive memory is 
> > what threw me, going back and re-reading up on it, this is memory that 
> > previously been allocated in vm that can be reclaimed for other use, 
> > correct?
> 
> I have no idea. Consult your resident Linux expert ;)
> 
> As long as the system is not swapping it is probably fine. Have you ever 
> seen it swap?
> 
> >> And, as you say, rabbit thinks it is only using 330MB. Is the
> >> rabbit Erlang process considerably bigger than that?
> > No, it is in that range.
> 
> In which case it's clearly not rabbit that is using the memory. So don't 
> blame the poor bunny.

We saw exactly this behaviour in our environment as well : steadily
increasing memory usage over time, related to Rabbit virtual memory
usage increasing over time ; however Rabbit real memory usage remained
relatively low.

The culprit in our case was that we had created far too many queues, and
that we weren't clearing them out when they weren't being used.  Once we
started managing this properly (read : architecting our queues more
efficiently, destroying them when not in use) our memory usage plummeted
- real and virtual - plummeted.

Cheers,


-- 
Daniel Maher
? can't talk, too busy calculating computrons. ?


From simon at rabbitmq.com  Tue May  3 11:02:09 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 May 2011 11:02:09 +0100
Subject: [rabbitmq-discuss] Minor nit type bugs in the Management Plugin
 interface
In-Reply-To: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>
References: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>
Message-ID: <4DBFD2A1.70702@rabbitmq.com>

Hi Gavin.

On 21/04/11 15:24, Gavin M. Roy wrote:
> Hey, these bugs are in no way a functional concern but figured would be
> worth pointing out.
>
> 1) > 8 digit #'s in the Overview boxes on the main management plugin ui
> page overflows the box.
> Screenshot: box-overflow.png

Bah. CSS. I will be drinking from this mug while looking at that:

http://www.cafepress.co.uk/+css_is_awesome_large_mug,399749999

> 2) If stomp is listening on all of the nodes in a cluster, the Listening
> Ports section of the main page only lists the first node in the cluster
> as having that port open.
> Screenshot: listening-ports.png

I think you misattached this one, seems a duplicate of the 
json-rpc-channel one. Anyway, that should definitely work, I'll try to 
reproduce.

> 3) Conceptually in the same spirit, even though it's obvious since
> you're talking to it on 55672, but shouldn't the Listening Ports list
> 55672 too?

There's some code on a branch to fix this but it's dependent on some 
pending changes to rabbitmq-mochiweb. Hopefully some day.

> 4) This is more of an internal thing with the plugin I believe, but when
> using the JSON-RPC-Channel Plugin, the channels are listed as
> "unknown:1". Ideally the json-rpc-channel plugin would present itself in
> the channel name as being a json-rpc-channel channel.
> Screenshot: json-rpc-channel.png
>
> 5) In relation to #4, if you click on a json-rpc-channel channel in the
> channels list it will kick back a 500 error on the page and not give you
> details on the channel.
> Screenshot: 500-error-json-rpc-channel.png

Yeah, all released versions of the mgmt plugin only really understand 
AMQP connections. This is fixed on default, with the plugin correctly 
showing STOMP, JSON-RPC and Erlang-direct connections.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From newtons at packtpub.com  Tue May  3 09:52:16 2011
From: newtons at packtpub.com (Newton Sequeira)
Date: Tue, 03 May 2011 14:22:16 +0530
Subject: [rabbitmq-discuss] Interested in writing a RabbitMQ book
Message-ID: <4DBFC240.60304@packtpub.com>

Hi,

My name is Newton Sequeiraand I am an Author Relationship Executive at 
Packt Publishing. Packt recently green lit a book on *RabbitMQ* and we 
are now searching for an author to develop the book.

Would anybody be interested in this project? Do contact me with your 
views and recommendations. It could be a single author project or dual 
author if need be. Do feel free to pass the word around.

Thanks for considering this proposal. I would appreciate if you could 
please get in touch.

Thanks,
-- 

**Newton Sequeira
** *Author Relationship Executive
Packt Publishing
*www.packtpub.com <http://www.packtpub.com/>
* **MSN*: newtons at packtpub.com
<newtons at packtpub.com%3C> Interested in becoming an author? Visit 
http://authors.packtpub.com for all the information you need about 
writing for Packt.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110503/baf388f8/attachment.htm>

From tim at rabbitmq.com  Tue May  3 12:11:13 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Tue, 03 May 2011 12:11:13 +0100
Subject: [rabbitmq-discuss] Message Aggregating Queue
In-Reply-To: <BANLkTintM=H=J_zkb0131G8Xbq+pHdsp4g@mail.gmail.com>
References: <BANLkTi=8hzoE5X2LvPqaVxriEd8++ppaww@mail.gmail.com>	<BANLkTimNz8AQSFOG-d2fPEcY11JHoO_nVw@mail.gmail.com>	<4DB930E9.1020700@rabbitmq.com>	<EB18BEAA-7A85-465A-A198-4503157D048D@gmail.com>
	<BANLkTintM=H=J_zkb0131G8Xbq+pHdsp4g@mail.gmail.com>
Message-ID: <4DBFE2D1.9060703@rabbitmq.com>

On 28/04/11 13:54, Jason Zaugg wrote:
> The Last Value Caching Exchange seems to solve a slightly different
> problem (although one that we also have!). If I understand it, a queue
> attached to the LVC exchange would receive *every* newly delivered
> message, regardless of how fast it is able to process them.
Indeed. Maintaining the map at the queue level prevents the consumer 
getting overwhelmed with messages, which is kind of the point last-value 
in the first place. E.g. you may have a stock ticker app which only 
updates every second. It doesn't want to be flooded by millions of ticks 
it can't handle.

LVC exchange seems to be handling a somewhat different use-case 
sometimes known as "value + updates", where you're interested in syncing 
with some state machine (i.e. obtain current state), and also interested 
in getting all updates on that state from then on, so you can maintain a 
replica of that state machine. That's a common and valid use case, but 
not the same as the last-value queue case.

If you were so inclined, you could transform the "value+updates" case 
into the "last-value-queue" case by taking the  values+updates and 
maintaining a map yourself on the client-side to weed out "old" entries 
(as someone else mentioned), but this is a) extra work for you to do b) 
burns lots of bandwidth + cpu in sending unwanted messages to the 
client, and c) your client may still not be able to keep up with the 
firehose anyway.


From simon at rabbitmq.com  Tue May  3 13:45:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 May 2011 13:45:45 +0100
Subject: [rabbitmq-discuss] Fwd: Management UI plugin issue on 2 node
 cluster
In-Reply-To: <CB1B0C94-E22D-4831-841B-453016627E6B@dwim.org>
References: <86CD90E7-A172-4A09-A73C-282BA2B36644@dwim.org>
	<CB1B0C94-E22D-4831-841B-453016627E6B@dwim.org>
Message-ID: <4DBFF8F9.3040800@rabbitmq.com>

On 26/04/11 23:37, Jos Boumans wrote:
> Hi Matthias & list,
>
> fearing this has fallen between the cracks, I'm reposting this;
> my own investigation hasn't helped me find a resolution yet.

Hi Jos. Thanks for the tarballs.

I still don't understand this. I set up a two node cluster with 2.4.1 on 
Ubuntu with the mgmt and stomp plugins on both nodes, installed the 
mnesia directories from the tarballs, and... the cluster started up 
fine. Just to be absolutely clear - rabbit-a002 does not start up for 
you with that mnesia dir and the mgmt plugin?

So I wonder if you have some different configuration in /etc or 
something? Not that the tarballs showed that.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Tue May  3 14:20:53 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 May 2011 14:20:53 +0100
Subject: [rabbitmq-discuss] Minor nit type bugs in the Management Plugin
 interface
In-Reply-To: <4DBFD2A1.70702@rabbitmq.com>
References: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>
	<4DBFD2A1.70702@rabbitmq.com>
Message-ID: <4DC00135.9060506@rabbitmq.com>

On 03/05/11 11:02, Simon MacMullen wrote:
> Hi Gavin.
>
> On 21/04/11 15:24, Gavin M. Roy wrote:
>> 2) If stomp is listening on all of the nodes in a cluster, the Listening
>> Ports section of the main page only lists the first node in the cluster
>> as having that port open.
>> Screenshot: listening-ports.png
>
> I think you misattached this one, seems a duplicate of the
> json-rpc-channel one. Anyway, that should definitely work, I'll try to
> reproduce.

Hmm, this works for me.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp-cluster.png
Type: image/png
Size: 5807 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110503/20ffe14b/attachment.png>

From mark.geib at echostar.com  Tue May  3 16:28:07 2011
From: mark.geib at echostar.com (Mark Geib)
Date: Tue, 3 May 2011 09:28:07 -0600
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1 (Solution)
In-Reply-To: <1304408765.2451.5.camel@danstation>
References: <4DB8A74B.9000105@echostar.com>	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>	<BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>	<4DBEFC9A.4040705@rabbitmq.com>	<812F5896312E4A8FAA2DFA2D5972DE41@myyearbook.com>	<4DBF060C.2010103@rabbitmq.com>
	<1304408765.2451.5.camel@danstation>
Message-ID: <4DC01F07.9010203@echostar.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Quick update. At least in our case this issue was completely resolved
by upgrading erlang to R14B02, from R14A02.

During our investigation we removed all plugins, with no change. We
have since restored the admin plugins, etc. and see no issues. There
is a slight performance hit it appears with the admin plugins enabled,
but nothing significant.

Mark.

On 05/03/2011 01:46 AM, Daniel Maher wrote:
> On Mon, 2011-05-02 at 20:29 +0100, Matthias Radestock wrote:
>> Gavin M. Roy wrote:
>>> On Monday, May 2, 2011 at 2:48 PM, Matthias Radestock wrote:
>>>> The above graph shows system memory usage. It is perfectly
>>>> normal for a non-idle linux system to gradually fill up all
>>>> the memory with cached files.
>>> Which I expect in disk buffers in that graph. The inactive
>>> memory is what threw me, going back and re-reading up on it,
>>> this is memory that previously been allocated in vm that can be
>>> reclaimed for other use, correct?
>>
>> I have no idea. Consult your resident Linux expert ;)
>>
>> As long as the system is not swapping it is probably fine. Have
>> you ever seen it swap?
>>
>>>> And, as you say, rabbit thinks it is only using 330MB. Is
>>>> the rabbit Erlang process considerably bigger than that?
>>> No, it is in that range.
>>
>> In which case it's clearly not rabbit that is using the memory.
>> So don't blame the poor bunny.
>
> We saw exactly this behaviour in our environment as well :
> steadily increasing memory usage over time, related to Rabbit
> virtual memory usage increasing over time ; however Rabbit real
> memory usage remained relatively low.
>
> The culprit in our case was that we had created far too many
> queues, and that we weren't clearing them out when they weren't
> being used. Once we started managing this properly (read :
> architecting our queues more efficiently, destroying them when not
> in use) our memory usage plummeted - real and virtual - plummeted.
>
> Cheers,
>
>

- -- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk3AHwcACgkQNMVrR9CRdv03WQCeIxlszRSb30fdkszhm7PgPSpZ
DcUAnj8tDzALwUR9DCQTBQfvr3yXhzD7
=RVkY
-----END PGP SIGNATURE-----



From matthias at rabbitmq.com  Tue May  3 16:34:32 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 03 May 2011 16:34:32 +0100
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1
In-Reply-To: <1304408765.2451.5.camel@danstation>
References: <4DB8A74B.9000105@echostar.com>	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>	<BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>	<4DBEFC9A.4040705@rabbitmq.com>	<812F5896312E4A8FAA2DFA2D5972DE41@myyearbook.com>	<4DBF060C.2010103@rabbitmq.com>
	<1304408765.2451.5.camel@danstation>
Message-ID: <4DC02088.6030102@rabbitmq.com>

On 03/05/11 08:46, Daniel Maher wrote:
> On Mon, 2011-05-02 at 20:29 +0100, Matthias Radestock wrote:
>> Gavin M. Roy wrote:
>>>> And, as you say, rabbit thinks it is only using 330MB. Is the
>>>> rabbit Erlang process considerably bigger than that?
>>> No, it is in that range.
>>
>> In which case it's clearly not rabbit that is using the memory. So don't
>> blame the poor bunny.
>
> We saw exactly this behaviour in our environment as well : steadily
> increasing memory usage over time, related to Rabbit virtual memory
> usage increasing over time ; however Rabbit real memory usage remained
> relatively low.

That is *not* the same behaviour as Gavin is describing. He is seeing 
the rabbit process memory usage (both as reported by rabbit itself and 
by the O/S) staying fairly modest at around 330M of virtual memory. 
However, the memory usage on the machine overall is increasing over time.

Regards,

Matthias.

From Chris.Hampson at arm.com  Tue May  3 17:11:53 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Tue, 3 May 2011 17:11:53 +0100
Subject: [rabbitmq-discuss] (Very) Low priority: Wrong date on Management
	Web Interface
In-Reply-To: <4DC00135.9060506@rabbitmq.com>
References: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>
	<4DBFD2A1.70702@rabbitmq.com> <4DC00135.9060506@rabbitmq.com>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E169AAE02A4@GEORGE.Emea.Arm.com>

Hi Guys,

A VERY low priority one here, but also pretty odd.

The date as reported on our management web interface for our RabbitMQ server is wrong:

Last update: 2011-05-02 17:07:20

Yet the system date seems fine...

[rabbit_user at rabbit_host ~]# date
Tue May  3 17:08:12 BST 2011
[rabbit_user at rabbit_host ~]#
[rabbit_user at rabbit_host ~]# echo 'date().' | erl
Eshell V5.8.1  (abort with ^G)
1> {2011,5,3}
2> *** Terminating erlang (nonode at nohost)

If anyone's got an idea why this might be the case I'd be most grateful, to satisfy a curiosity if nothing else ;-)

Many thanks,

Chris

-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From simon at rabbitmq.com  Tue May  3 17:16:17 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 May 2011 17:16:17 +0100
Subject: [rabbitmq-discuss] (Very) Low priority: Wrong date on
 Management Web Interface
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E169AAE02A4@GEORGE.Emea.Arm.com>
References: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>	<4DBFD2A1.70702@rabbitmq.com>
	<4DC00135.9060506@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E169AAE02A4@GEORGE.Emea.Arm.com>
Message-ID: <4DC02A51.8030705@rabbitmq.com>

On 03/05/11 17:11, Chris Hampson wrote:
> Hi Guys,
>
> A VERY low priority one here, but also pretty odd.
>
> The date as reported on our management web interface for our RabbitMQ server is wrong:
>
> Last update: 2011-05-02 17:07:20
>
> Yet the system date seems fine...

<snip server transcript>

That's the date as seen by the web browser; not the server (since it may 
end up saying something like "could not connect at xxx").

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From Chris.Hampson at arm.com  Tue May  3 17:34:38 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Tue, 3 May 2011 17:34:38 +0100
Subject: [rabbitmq-discuss] (Very) Low priority: Wrong date on
 Management Web Interface
In-Reply-To: <4DC02A51.8030705@rabbitmq.com>
References: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>
	<4DBFD2A1.70702@rabbitmq.com>	<4DC00135.9060506@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E169AAE02A4@GEORGE.Emea.Arm.com>
	<4DC02A51.8030705@rabbitmq.com>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E169AAE02BB@GEORGE.Emea.Arm.com>

Aha, yes.

In the fmt_date function in (mgmt/js/formatters.js) it calls:

d.getDay on the date object... which returns a (probably zero-indexed) day part of the JS date object.

I can sleep easier tonight now ;-)

Thanks Simon

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
> Sent: 03 May 2011 17:16
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] (Very) Low priority: Wrong date on
> Management Web Interface
>
> On 03/05/11 17:11, Chris Hampson wrote:
> > Hi Guys,
> >
> > A VERY low priority one here, but also pretty odd.
> >
> > The date as reported on our management web interface for our RabbitMQ
> server is wrong:
> >
> > Last update: 2011-05-02 17:07:20
> >
> > Yet the system date seems fine...
>
> <snip server transcript>
>
> That's the date as seen by the web browser; not the server (since it
> may
> end up saying something like "could not connect at xxx").
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From simon at rabbitmq.com  Tue May  3 17:40:35 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 May 2011 17:40:35 +0100
Subject: [rabbitmq-discuss] (Very) Low priority: Wrong date on
 Management Web Interface
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E169AAE02BB@GEORGE.Emea.Arm.com>
References: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>	<4DBFD2A1.70702@rabbitmq.com>	<4DC00135.9060506@rabbitmq.com>	<A610E03AD50BFC4D95529A36D37FA55E169AAE02A4@GEORGE.Emea.Arm.com>
	<4DC02A51.8030705@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E169AAE02BB@GEORGE.Emea.Arm.com>
Message-ID: <4DC03003.1080303@rabbitmq.com>

On 03/05/11 17:34, Chris Hampson wrote:
> d.getDay on the date object... which returns a (probably zero-indexed) day part of the JS date object.

Wow. When responding to your previous mail I hadn't thought to check if 
we were actually formatting the date right. Oops.

Fixed in hg now :)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From ian.ragsdale at gmail.com  Tue May  3 19:18:04 2011
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Tue, 3 May 2011 13:18:04 -0500
Subject: [rabbitmq-discuss] Lightweight query for queues?
Message-ID: <8CC56202-E3E6-4F31-9A42-0DD59FCA5306@gmail.com>

So the updated management plugin seems to have gotten rid of the crashes I was seeing, which is great - thanks to the rabbitmq devs for a quick response!

One useful thing about that thread was figuring out just how resource-intensive the management plugin is when querying the API for queues.  On my server with around 6000 queues, I can run 'rabbitmqctl list_queues' and get results in a second, but if I query the API for the list of queues it pegs one of the CPUs for upwards of 30 seconds, returning over 8MB of data.

I know all of this data is useful for the web interface you have built, but for my purposes I really just need to pull the data returned by 'rabbitmqctl list_queues name messages messages_unacknowledged', which seems like it should be really quick to gather and return, based on the performance of that command.  In addition, I generally don't need this information for every queue, but for a subset of queues, which can generally be described with a simple regex on the name.

So, what I'd like to be able to do is:

1. Allow specifying which data needs to be returned, so that more expensive statistics can be avoided if necessary.
2. Allow filtering the list of queues to return data for with a search term

I can't find anything in the docs that suggests this is currently possible, and although I don't really know Erlang, I spent some time looking through the management plugin source and it doesn't look like that functionality exists.

Besides making it more usable for 3rd party integration, it would allow you to improve the management web interface.  You currently only show a subset of the data on the queues tab, and you only show the top 500, so people with more than 500 queues often can't find the one they want.  With those additions you can make the interface more responsive by only requesting data that is actually shown, and adding a search box to let people show just the queues they are looking for.

Is this something you guys would consider?  If you guys aren't interested in doing the work but would be interested in a patch, I could give it a shot - I don't really know Erlang yet but this seems like a somewhat simple project to take on.

Thanks,
Ian


From ian.ragsdale at gmail.com  Tue May  3 20:09:12 2011
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Tue, 3 May 2011 14:09:12 -0500
Subject: [rabbitmq-discuss] Lightweight query for queues?
In-Reply-To: <8CC56202-E3E6-4F31-9A42-0DD59FCA5306@gmail.com>
References: <8CC56202-E3E6-4F31-9A42-0DD59FCA5306@gmail.com>
Message-ID: <3E9663CE-24D6-4207-9209-3A75EAE0A870@gmail.com>

If this is helpful for anyone, I've developed a small ruby script that just calls rabbitmqctl list_queues and returns the output in the same format as the management plugin API.  It listens on one port higher than the management plugin, so it can run alongside it.  Using this instead has really helped with the load on my server.

- Ian

-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmqapi.rb
Type: text/x-ruby-script
Size: 467 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110503/772a1cac/attachment.bin>
-------------- next part --------------

On May 3, 2011, at 1:18 PM, Ian Ragsdale wrote:

> So the updated management plugin seems to have gotten rid of the crashes I was seeing, which is great - thanks to the rabbitmq devs for a quick response!
> 
> One useful thing about that thread was figuring out just how resource-intensive the management plugin is when querying the API for queues.  On my server with around 6000 queues, I can run 'rabbitmqctl list_queues' and get results in a second, but if I query the API for the list of queues it pegs one of the CPUs for upwards of 30 seconds, returning over 8MB of data.
> 
> I know all of this data is useful for the web interface you have built, but for my purposes I really just need to pull the data returned by 'rabbitmqctl list_queues name messages messages_unacknowledged', which seems like it should be really quick to gather and return, based on the performance of that command.  In addition, I generally don't need this information for every queue, but for a subset of queues, which can generally be described with a simple regex on the name.
> 
> So, what I'd like to be able to do is:
> 
> 1. Allow specifying which data needs to be returned, so that more expensive statistics can be avoided if necessary.
> 2. Allow filtering the list of queues to return data for with a search term
> 
> I can't find anything in the docs that suggests this is currently possible, and although I don't really know Erlang, I spent some time looking through the management plugin source and it doesn't look like that functionality exists.
> 
> Besides making it more usable for 3rd party integration, it would allow you to improve the management web interface.  You currently only show a subset of the data on the queues tab, and you only show the top 500, so people with more than 500 queues often can't find the one they want.  With those additions you can make the interface more responsive by only requesting data that is actually shown, and adding a search box to let people show just the queues they are looking for.
> 
> Is this something you guys would consider?  If you guys aren't interested in doing the work but would be interested in a patch, I could give it a shot - I don't really know Erlang yet but this seems like a somewhat simple project to take on.
> 
> Thanks,
> Ian
> 


From luke.winikates at gmail.com  Tue May  3 20:41:24 2011
From: luke.winikates at gmail.com (Luke Winikates)
Date: Tue, 3 May 2011 12:41:24 -0700
Subject: [rabbitmq-discuss] .NET API (2.4.1) -- does BasicAcks event ever
	fire?
Message-ID: <BANLkTi=JO_cQ88yCV=+rp-=fK4V3SaXiPA@mail.gmail.com>

I recently started experimenting with RabbitMQ using the .NET Client,
version 2.4.1 (via NuGet).

When I first started playing with it, I ran into a bit of a puzzler when I
tried to add an EventHandler to the IModel.BasicAcks event. It seems as
though the event never gets raised, and I'm wondering if I'm using the .NET
Client wrong. An event handler on the IModel.ModelShutdown event works just
fine. Messages are definitely getting Ack-ed (the management console
confirms this), but I'm getting nothing on the event front.

I posted the same question on Stack Overflow not long ago, trying to see if
anyone out there had a suggestion. Nobody has yet, but it does show the code
that I was using to experiment with RabbitMQ:

http://stackoverflow.com/questions/5784697/how-do-i-get-imodel-basicacks-to-fire

I'm curious if anyone has used this feature successfully. I'm wondering if
this is just a seldom-used part of the .NET Client that nobody's actually
touched except me.

Thanks,
-Luke Winikates
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110503/dcb9748c/attachment-0001.htm>

From alexis at rabbitmq.com  Tue May  3 21:34:09 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 3 May 2011 21:34:09 +0100
Subject: [rabbitmq-discuss] Reconnect logic for C library
In-Reply-To: <0adcfd20-2639-4884-a22d-be569742ba83@zimbra-prod-mbox-1.vmware.com>
References: <BANLkTim8uL5q7FZo-f-wE_02g78M__dcsg@mail.gmail.com>
	<0adcfd20-2639-4884-a22d-be569742ba83@zimbra-prod-mbox-1.vmware.com>
Message-ID: <BANLkTimU-xRpwfrzYPU0OpTmwNNQ4uBGhw@mail.gmail.com>

Paul

Can you tell us more about what you are trying to do please?

alexis


On Tue, May 3, 2011 at 3:25 AM, Tony Menges <amenges at vmware.com> wrote:
> Hi Paul,
>
> I started to take a look at this and wanted to make sure I understand the problem. Is the basic problem that the return code from amqp_basic_publish() shows success even after the broker has closed the connection? Are you doing a commit after each message is published? Is commit showing success when the broker is down?
>
> I've written a simple test driver program that allows me to vary the number of messages per transaction and the amount of delay between messages and after commits. I set the number of messages per transaction to 5, the delay between publishes to 0 and the delay after each transaction to a few seconds. After I see a commit, I ctl-C Rabbit and I see usually 5 (the transaction batch size) messages published and the commit fails with a connection closed error. The Wireshark trace shows that only 1 of the messages was actually put on the wire.
>
> If I put a delay between message sends, I get a SIGPIPE usually after 1 or 2 messages have been sent.
>
> I think that in the first case, the messages are put into the socket's output buffer fast enough that the close from the other side has not been processed (my messages are quite small so they all fit in the socket's buffer); amqp_tx_commit() actually tries to read from the socket so it will notice the socket closed.
>
> Does this sound consistent with your experience?
>
> Tony Menges
> VMware, Inc
>
> ----- Original Message -----
> From: "Paul Dix" <paul at pauldix.net>
> To: "Matthias Radestock" <matthias at rabbitmq.com>
> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Tuesday, April 12, 2011 6:50:13 AM
> Subject: Re: [rabbitmq-discuss] Reconnect logic for C library
>
> Hi Matthias,
> I briefly tried to use these two:
>
> amqp_tx_commit(connection, channel);
> amqp_get_rpc_reply(connection)
>
> Then check the result. However, I found that it would indicate success
> for a message or two after I took RabbitMQ down before it indicated a
> problem. I ended up bailing on C, but I'd be interested to hear if
> this is possible with the library. The two things are: fail if a
> message doesn't get published (i.e. don't fail silently) and check
> that a connection/channel is open.
>
> Thanks,
> Paul
>
> On Tue, Apr 12, 2011 at 7:04 AM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
>> Paul,
>>
>> On 01/04/11 22:40, Paul Dix wrote:
>>>
>>> I'm working with the rabbitmq c library and I need to have reconnect
>>> logic in there. Basically, try to send a message, if it fails, attempt
>>> reconnect and try again. How do I accomplish this? I've been using
>>> amqp_basic_publish and if I try that it just hangs.
>>
>> Did you work out what the problem was? The people familiar with the C client
>> at Rabbit HQ are a bit swamped at the moment, so it will likely be a while
>> before we can look into this.
>>
>> Matthias.
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Tue May  3 22:01:58 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 3 May 2011 22:01:58 +0100
Subject: [rabbitmq-discuss] .NET API (2.4.1) -- does BasicAcks event
 ever fire?
In-Reply-To: <BANLkTi=JO_cQ88yCV=+rp-=fK4V3SaXiPA@mail.gmail.com>
References: <BANLkTi=JO_cQ88yCV=+rp-=fK4V3SaXiPA@mail.gmail.com>
Message-ID: <20110503210158.GA32391@wellquite.org>

On Tue, May 03, 2011 at 12:41:24PM -0700, Luke Winikates wrote:
> When I first started playing with it, I ran into a bit of a puzzler when I
> tried to add an EventHandler to the IModel.BasicAcks event. It seems as
> though the event never gets raised, and I'm wondering if I'm using the .NET
> Client wrong. An event handler on the IModel.ModelShutdown event works just
> fine. Messages are definitely getting Ack-ed (the management console
> confirms this), but I'm getting nothing on the event front.

The BasicAcks events corresponds to publisher confirms, not you acking
msgs when consuming them.

See http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/

Matthew

From matthew at rabbitmq.com  Tue May  3 22:14:05 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 3 May 2011 22:14:05 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes
In-Reply-To: <4DB0452D.3010105@tripwolf.com>
References: <4DA9C82E.7080505@tripwolf.com>
	<20110419100807.GG7850@wellquite.org>
	<4DB0452D.3010105@tripwolf.com>
Message-ID: <20110503211405.GB32391@wellquite.org>

On Thu, Apr 21, 2011 at 04:54:37PM +0200, David Schmidt wrote:
> rabbitmq-server crashed, using rabbitmqctl quite understandably yields:
> 
> rabbitmqctl list_queues name messages
> Listing queues ...
> Error: unable to connect to node rabbit at db19: nodedown
> diagnostics:
> - nodes and their ports on db19: [{rabbitmqctl26359,39062}]
> - current node: rabbitmqctl26359 at db19
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: MGjkgA5U5XxYMPKTviwAWw==

I was suggesting that you use rabbitmqctl before rabbit crashes in order
to inspect whether you can identify any source of leaks (eg acks) that
is causing the crash.

Also I would expect there will be some log entries suggesting what's
going on.

Matthew

From matthew at rabbitmq.com  Tue May  3 22:19:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 3 May 2011 22:19:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.3.1 high CPU usage & disks
 operations
In-Reply-To: <BANLkTinvLO0puWP5fzqsZTE_B343OjSCyg@mail.gmail.com>
References: <BANLkTindRBsXO-FSDj4+Ps3Zmpzs4qC6TQ@mail.gmail.com>
	<20110421104215.GA14121@rabbitmq.com>
	<BANLkTim0-mw8QTy-RbzVKq+Kc8hM759paQ@mail.gmail.com>
	<BANLkTinvLO0puWP5fzqsZTE_B343OjSCyg@mail.gmail.com>
Message-ID: <20110503211954.GC32391@wellquite.org>

Hi Raphael,

On Mon, Apr 25, 2011 at 03:12:07PM -0700, Raphael Simon wrote:
> Following up on this as we are still having the issue, I've pasted the
> output of etop for a broker in a 'good state' [1] vs. one in a 'bad state'
> [2]. You'll notice that broker1-1 (the one in 'bad state' i.e. using ~120%
> cpu compared to ~20% for the one in 'good state') is spending a lot of time
> in timers and reading from disk. Looking at the timer_server process on 1-1
> shows that it's mostly running rabbit_amqqueue:sync_timeout, this seems to
> be the culprit for the high cpu and disk ops. So what is the purpose of this
> timer? and why would it suddenly trigger more often or at least be more
> expensive to handle?

Interesting. Are you using confirms when publishing msgs? If you are,
and the msgs are published persistent, then there could be an awful lot
of fsyncs being scheduled which could possibly cause a cascade. Maybe. I
can't come up with any better cause... Or maybe an awful lot of
transactions with persistent msgs?

Matthew

From matthew at rabbitmq.com  Tue May  3 22:20:53 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 3 May 2011 22:20:53 +0100
Subject: [rabbitmq-discuss] Where is the code for RabbitMQ HA project?
In-Reply-To: <BANLkTi=EfRq=kc3HN1QzT49whHQhvW2obg@mail.gmail.com>
References: <BANLkTi=EfRq=kc3HN1QzT49whHQhvW2obg@mail.gmail.com>
Message-ID: <20110503212052.GD32391@wellquite.org>

On Tue, Apr 26, 2011 at 10:19:24AM +0900, Tsuyoshi OZAWA wrote:
> > The former. Note that development of this is no longer ongoing in the
> > separate repo as the changes needed to Rabbit itself were too extensive.
> > Thus it's now solely being developed as a branch of the broker, and that
> > repo should be removed.
> 
> However, what does it mean?
> Where is the code for the project? Is there branch in rabbitmq-server
> repository?

The branch is called bug23554
You'll need to compile from source. There's no documentation as of yet.

Matthew

From paul at pauldix.net  Tue May  3 22:35:29 2011
From: paul at pauldix.net (Paul Dix)
Date: Tue, 3 May 2011 17:35:29 -0400
Subject: [rabbitmq-discuss] Reconnect logic for C library
In-Reply-To: <BANLkTimU-xRpwfrzYPU0OpTmwNNQ4uBGhw@mail.gmail.com>
References: <BANLkTim8uL5q7FZo-f-wE_02g78M__dcsg@mail.gmail.com>
	<0adcfd20-2639-4884-a22d-be569742ba83@zimbra-prod-mbox-1.vmware.com>
	<BANLkTimU-xRpwfrzYPU0OpTmwNNQ4uBGhw@mail.gmail.com>
Message-ID: <BANLkTikLeQWacE8YE2xvUcZ6R0iVWrnHJg@mail.gmail.com>

I've moved on from it now. However, here's basically what I wanted:
I have a publisher publishing messages. If the rabbit server fails, I
want the publisher to be able to tell which messages actually got
published and which didn't. Basically something like an atomic
publish. If it returns successfully, I can be sure that the message,
which is marked persistent, is actually stored on the server. Or put
even more simply: guaranteed delivery.

Thanks,
Paul

On Tue, May 3, 2011 at 4:34 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Paul
>
> Can you tell us more about what you are trying to do please?
>
> alexis
>
>
> On Tue, May 3, 2011 at 3:25 AM, Tony Menges <amenges at vmware.com> wrote:
>> Hi Paul,
>>
>> I started to take a look at this and wanted to make sure I understand the problem. Is the basic problem that the return code from amqp_basic_publish() shows success even after the broker has closed the connection? Are you doing a commit after each message is published? Is commit showing success when the broker is down?
>>
>> I've written a simple test driver program that allows me to vary the number of messages per transaction and the amount of delay between messages and after commits. I set the number of messages per transaction to 5, the delay between publishes to 0 and the delay after each transaction to a few seconds. After I see a commit, I ctl-C Rabbit and I see usually 5 (the transaction batch size) messages published and the commit fails with a connection closed error. The Wireshark trace shows that only 1 of the messages was actually put on the wire.
>>
>> If I put a delay between message sends, I get a SIGPIPE usually after 1 or 2 messages have been sent.
>>
>> I think that in the first case, the messages are put into the socket's output buffer fast enough that the close from the other side has not been processed (my messages are quite small so they all fit in the socket's buffer); amqp_tx_commit() actually tries to read from the socket so it will notice the socket closed.
>>
>> Does this sound consistent with your experience?
>>
>> Tony Menges
>> VMware, Inc
>>
>> ----- Original Message -----
>> From: "Paul Dix" <paul at pauldix.net>
>> To: "Matthias Radestock" <matthias at rabbitmq.com>
>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Tuesday, April 12, 2011 6:50:13 AM
>> Subject: Re: [rabbitmq-discuss] Reconnect logic for C library
>>
>> Hi Matthias,
>> I briefly tried to use these two:
>>
>> amqp_tx_commit(connection, channel);
>> amqp_get_rpc_reply(connection)
>>
>> Then check the result. However, I found that it would indicate success
>> for a message or two after I took RabbitMQ down before it indicated a
>> problem. I ended up bailing on C, but I'd be interested to hear if
>> this is possible with the library. The two things are: fail if a
>> message doesn't get published (i.e. don't fail silently) and check
>> that a connection/channel is open.
>>
>> Thanks,
>> Paul
>>
>> On Tue, Apr 12, 2011 at 7:04 AM, Matthias Radestock
>> <matthias at rabbitmq.com> wrote:
>>> Paul,
>>>
>>> On 01/04/11 22:40, Paul Dix wrote:
>>>>
>>>> I'm working with the rabbitmq c library and I need to have reconnect
>>>> logic in there. Basically, try to send a message, if it fails, attempt
>>>> reconnect and try again. How do I accomplish this? I've been using
>>>> amqp_basic_publish and if I try that it just hangs.
>>>
>>> Did you work out what the problem was? The people familiar with the C client
>>> at Rabbit HQ are a bit swamped at the moment, so it will likely be a while
>>> before we can look into this.
>>>
>>> Matthias.
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From alexis at rabbitmq.com  Tue May  3 22:46:32 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 3 May 2011 22:46:32 +0100
Subject: [rabbitmq-discuss] Reconnect logic for C library
In-Reply-To: <BANLkTikLeQWacE8YE2xvUcZ6R0iVWrnHJg@mail.gmail.com>
References: <BANLkTim8uL5q7FZo-f-wE_02g78M__dcsg@mail.gmail.com>
	<0adcfd20-2639-4884-a22d-be569742ba83@zimbra-prod-mbox-1.vmware.com>
	<BANLkTimU-xRpwfrzYPU0OpTmwNNQ4uBGhw@mail.gmail.com>
	<BANLkTikLeQWacE8YE2xvUcZ6R0iVWrnHJg@mail.gmail.com>
Message-ID: <BANLkTikw_MLZp9iK-XghZ_9f=A4XqrWv5A@mail.gmail.com>

Publisher confirms?

http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/


On Tue, May 3, 2011 at 10:35 PM, Paul Dix <paul at pauldix.net> wrote:
> I've moved on from it now. However, here's basically what I wanted:
> I have a publisher publishing messages. If the rabbit server fails, I
> want the publisher to be able to tell which messages actually got
> published and which didn't. Basically something like an atomic
> publish. If it returns successfully, I can be sure that the message,
> which is marked persistent, is actually stored on the server. Or put
> even more simply: guaranteed delivery.
>
> Thanks,
> Paul
>
> On Tue, May 3, 2011 at 4:34 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Paul
>>
>> Can you tell us more about what you are trying to do please?
>>
>> alexis
>>
>>
>> On Tue, May 3, 2011 at 3:25 AM, Tony Menges <amenges at vmware.com> wrote:
>>> Hi Paul,
>>>
>>> I started to take a look at this and wanted to make sure I understand the problem. Is the basic problem that the return code from amqp_basic_publish() shows success even after the broker has closed the connection? Are you doing a commit after each message is published? Is commit showing success when the broker is down?
>>>
>>> I've written a simple test driver program that allows me to vary the number of messages per transaction and the amount of delay between messages and after commits. I set the number of messages per transaction to 5, the delay between publishes to 0 and the delay after each transaction to a few seconds. After I see a commit, I ctl-C Rabbit and I see usually 5 (the transaction batch size) messages published and the commit fails with a connection closed error. The Wireshark trace shows that only 1 of the messages was actually put on the wire.
>>>
>>> If I put a delay between message sends, I get a SIGPIPE usually after 1 or 2 messages have been sent.
>>>
>>> I think that in the first case, the messages are put into the socket's output buffer fast enough that the close from the other side has not been processed (my messages are quite small so they all fit in the socket's buffer); amqp_tx_commit() actually tries to read from the socket so it will notice the socket closed.
>>>
>>> Does this sound consistent with your experience?
>>>
>>> Tony Menges
>>> VMware, Inc
>>>
>>> ----- Original Message -----
>>> From: "Paul Dix" <paul at pauldix.net>
>>> To: "Matthias Radestock" <matthias at rabbitmq.com>
>>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>> Sent: Tuesday, April 12, 2011 6:50:13 AM
>>> Subject: Re: [rabbitmq-discuss] Reconnect logic for C library
>>>
>>> Hi Matthias,
>>> I briefly tried to use these two:
>>>
>>> amqp_tx_commit(connection, channel);
>>> amqp_get_rpc_reply(connection)
>>>
>>> Then check the result. However, I found that it would indicate success
>>> for a message or two after I took RabbitMQ down before it indicated a
>>> problem. I ended up bailing on C, but I'd be interested to hear if
>>> this is possible with the library. The two things are: fail if a
>>> message doesn't get published (i.e. don't fail silently) and check
>>> that a connection/channel is open.
>>>
>>> Thanks,
>>> Paul
>>>
>>> On Tue, Apr 12, 2011 at 7:04 AM, Matthias Radestock
>>> <matthias at rabbitmq.com> wrote:
>>>> Paul,
>>>>
>>>> On 01/04/11 22:40, Paul Dix wrote:
>>>>>
>>>>> I'm working with the rabbitmq c library and I need to have reconnect
>>>>> logic in there. Basically, try to send a message, if it fails, attempt
>>>>> reconnect and try again. How do I accomplish this? I've been using
>>>>> amqp_basic_publish and if I try that it just hangs.
>>>>
>>>> Did you work out what the problem was? The people familiar with the C client
>>>> at Rabbit HQ are a bit swamped at the moment, so it will likely be a while
>>>> before we can look into this.
>>>>
>>>> Matthias.
>>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>

From paul at pauldix.net  Tue May  3 22:54:08 2011
From: paul at pauldix.net (Paul Dix)
Date: Tue, 3 May 2011 17:54:08 -0400
Subject: [rabbitmq-discuss] Reconnect logic for C library
In-Reply-To: <BANLkTikw_MLZp9iK-XghZ_9f=A4XqrWv5A@mail.gmail.com>
References: <BANLkTim8uL5q7FZo-f-wE_02g78M__dcsg@mail.gmail.com>
	<0adcfd20-2639-4884-a22d-be569742ba83@zimbra-prod-mbox-1.vmware.com>
	<BANLkTimU-xRpwfrzYPU0OpTmwNNQ4uBGhw@mail.gmail.com>
	<BANLkTikLeQWacE8YE2xvUcZ6R0iVWrnHJg@mail.gmail.com>
	<BANLkTikw_MLZp9iK-XghZ_9f=A4XqrWv5A@mail.gmail.com>
Message-ID: <BANLkTi=Tqfj=cU0ULZOyJwtGu+Gf-XKkmg@mail.gmail.com>

yeah, that looks exactly like what I was looking for. However, is the
amqp_tx_commit a transaction or just something that confirms that the
connection is still open and usable? This all started with the fact
that I couldn't even tell if a connection was up. Thus there was no
way to do error handling in the case the connection drops (for
whatever reason).

On Tue, May 3, 2011 at 5:46 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Publisher confirms?
>
> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>
>
> On Tue, May 3, 2011 at 10:35 PM, Paul Dix <paul at pauldix.net> wrote:
>> I've moved on from it now. However, here's basically what I wanted:
>> I have a publisher publishing messages. If the rabbit server fails, I
>> want the publisher to be able to tell which messages actually got
>> published and which didn't. Basically something like an atomic
>> publish. If it returns successfully, I can be sure that the message,
>> which is marked persistent, is actually stored on the server. Or put
>> even more simply: guaranteed delivery.
>>
>> Thanks,
>> Paul
>>
>> On Tue, May 3, 2011 at 4:34 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>>> Paul
>>>
>>> Can you tell us more about what you are trying to do please?
>>>
>>> alexis
>>>
>>>
>>> On Tue, May 3, 2011 at 3:25 AM, Tony Menges <amenges at vmware.com> wrote:
>>>> Hi Paul,
>>>>
>>>> I started to take a look at this and wanted to make sure I understand the problem. Is the basic problem that the return code from amqp_basic_publish() shows success even after the broker has closed the connection? Are you doing a commit after each message is published? Is commit showing success when the broker is down?
>>>>
>>>> I've written a simple test driver program that allows me to vary the number of messages per transaction and the amount of delay between messages and after commits. I set the number of messages per transaction to 5, the delay between publishes to 0 and the delay after each transaction to a few seconds. After I see a commit, I ctl-C Rabbit and I see usually 5 (the transaction batch size) messages published and the commit fails with a connection closed error. The Wireshark trace shows that only 1 of the messages was actually put on the wire.
>>>>
>>>> If I put a delay between message sends, I get a SIGPIPE usually after 1 or 2 messages have been sent.
>>>>
>>>> I think that in the first case, the messages are put into the socket's output buffer fast enough that the close from the other side has not been processed (my messages are quite small so they all fit in the socket's buffer); amqp_tx_commit() actually tries to read from the socket so it will notice the socket closed.
>>>>
>>>> Does this sound consistent with your experience?
>>>>
>>>> Tony Menges
>>>> VMware, Inc
>>>>
>>>> ----- Original Message -----
>>>> From: "Paul Dix" <paul at pauldix.net>
>>>> To: "Matthias Radestock" <matthias at rabbitmq.com>
>>>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>>> Sent: Tuesday, April 12, 2011 6:50:13 AM
>>>> Subject: Re: [rabbitmq-discuss] Reconnect logic for C library
>>>>
>>>> Hi Matthias,
>>>> I briefly tried to use these two:
>>>>
>>>> amqp_tx_commit(connection, channel);
>>>> amqp_get_rpc_reply(connection)
>>>>
>>>> Then check the result. However, I found that it would indicate success
>>>> for a message or two after I took RabbitMQ down before it indicated a
>>>> problem. I ended up bailing on C, but I'd be interested to hear if
>>>> this is possible with the library. The two things are: fail if a
>>>> message doesn't get published (i.e. don't fail silently) and check
>>>> that a connection/channel is open.
>>>>
>>>> Thanks,
>>>> Paul
>>>>
>>>> On Tue, Apr 12, 2011 at 7:04 AM, Matthias Radestock
>>>> <matthias at rabbitmq.com> wrote:
>>>>> Paul,
>>>>>
>>>>> On 01/04/11 22:40, Paul Dix wrote:
>>>>>>
>>>>>> I'm working with the rabbitmq c library and I need to have reconnect
>>>>>> logic in there. Basically, try to send a message, if it fails, attempt
>>>>>> reconnect and try again. How do I accomplish this? I've been using
>>>>>> amqp_basic_publish and if I try that it just hangs.
>>>>>
>>>>> Did you work out what the problem was? The people familiar with the C client
>>>>> at Rabbit HQ are a bit swamped at the moment, so it will likely be a while
>>>>> before we can look into this.
>>>>>
>>>>> Matthias.
>>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>
>

From alexis at rabbitmq.com  Tue May  3 23:00:46 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 3 May 2011 23:00:46 +0100
Subject: [rabbitmq-discuss] Reconnect logic for C library
In-Reply-To: <BANLkTi=Tqfj=cU0ULZOyJwtGu+Gf-XKkmg@mail.gmail.com>
References: <BANLkTim8uL5q7FZo-f-wE_02g78M__dcsg@mail.gmail.com>
	<0adcfd20-2639-4884-a22d-be569742ba83@zimbra-prod-mbox-1.vmware.com>
	<BANLkTimU-xRpwfrzYPU0OpTmwNNQ4uBGhw@mail.gmail.com>
	<BANLkTikLeQWacE8YE2xvUcZ6R0iVWrnHJg@mail.gmail.com>
	<BANLkTikw_MLZp9iK-XghZ_9f=A4XqrWv5A@mail.gmail.com>
	<BANLkTi=Tqfj=cU0ULZOyJwtGu+Gf-XKkmg@mail.gmail.com>
Message-ID: <BANLkTinxdcFLqs7yYLZE11VhtBgUe3UzGQ@mail.gmail.com>

Is there an amqp_tx_commit?

This is the key phrase in the post (imo) "once a channel is put into
confirm mode, the broker will confirm messages as it processes them.
Since this is done asynchronously, the producer can stream publishes
and not wait for the broker and the broker can batch disk writes
effectively"



On Tue, May 3, 2011 at 10:54 PM, Paul Dix <paul at pauldix.net> wrote:
> yeah, that looks exactly like what I was looking for. However, is the
> amqp_tx_commit a transaction or just something that confirms that the
> connection is still open and usable? This all started with the fact
> that I couldn't even tell if a connection was up. Thus there was no
> way to do error handling in the case the connection drops (for
> whatever reason).
>
> On Tue, May 3, 2011 at 5:46 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Publisher confirms?
>>
>> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>>
>>
>> On Tue, May 3, 2011 at 10:35 PM, Paul Dix <paul at pauldix.net> wrote:
>>> I've moved on from it now. However, here's basically what I wanted:
>>> I have a publisher publishing messages. If the rabbit server fails, I
>>> want the publisher to be able to tell which messages actually got
>>> published and which didn't. Basically something like an atomic
>>> publish. If it returns successfully, I can be sure that the message,
>>> which is marked persistent, is actually stored on the server. Or put
>>> even more simply: guaranteed delivery.
>>>
>>> Thanks,
>>> Paul
>>>
>>> On Tue, May 3, 2011 at 4:34 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>>>> Paul
>>>>
>>>> Can you tell us more about what you are trying to do please?
>>>>
>>>> alexis
>>>>
>>>>
>>>> On Tue, May 3, 2011 at 3:25 AM, Tony Menges <amenges at vmware.com> wrote:
>>>>> Hi Paul,
>>>>>
>>>>> I started to take a look at this and wanted to make sure I understand the problem. Is the basic problem that the return code from amqp_basic_publish() shows success even after the broker has closed the connection? Are you doing a commit after each message is published? Is commit showing success when the broker is down?
>>>>>
>>>>> I've written a simple test driver program that allows me to vary the number of messages per transaction and the amount of delay between messages and after commits. I set the number of messages per transaction to 5, the delay between publishes to 0 and the delay after each transaction to a few seconds. After I see a commit, I ctl-C Rabbit and I see usually 5 (the transaction batch size) messages published and the commit fails with a connection closed error. The Wireshark trace shows that only 1 of the messages was actually put on the wire.
>>>>>
>>>>> If I put a delay between message sends, I get a SIGPIPE usually after 1 or 2 messages have been sent.
>>>>>
>>>>> I think that in the first case, the messages are put into the socket's output buffer fast enough that the close from the other side has not been processed (my messages are quite small so they all fit in the socket's buffer); amqp_tx_commit() actually tries to read from the socket so it will notice the socket closed.
>>>>>
>>>>> Does this sound consistent with your experience?
>>>>>
>>>>> Tony Menges
>>>>> VMware, Inc
>>>>>
>>>>> ----- Original Message -----
>>>>> From: "Paul Dix" <paul at pauldix.net>
>>>>> To: "Matthias Radestock" <matthias at rabbitmq.com>
>>>>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>>>> Sent: Tuesday, April 12, 2011 6:50:13 AM
>>>>> Subject: Re: [rabbitmq-discuss] Reconnect logic for C library
>>>>>
>>>>> Hi Matthias,
>>>>> I briefly tried to use these two:
>>>>>
>>>>> amqp_tx_commit(connection, channel);
>>>>> amqp_get_rpc_reply(connection)
>>>>>
>>>>> Then check the result. However, I found that it would indicate success
>>>>> for a message or two after I took RabbitMQ down before it indicated a
>>>>> problem. I ended up bailing on C, but I'd be interested to hear if
>>>>> this is possible with the library. The two things are: fail if a
>>>>> message doesn't get published (i.e. don't fail silently) and check
>>>>> that a connection/channel is open.
>>>>>
>>>>> Thanks,
>>>>> Paul
>>>>>
>>>>> On Tue, Apr 12, 2011 at 7:04 AM, Matthias Radestock
>>>>> <matthias at rabbitmq.com> wrote:
>>>>>> Paul,
>>>>>>
>>>>>> On 01/04/11 22:40, Paul Dix wrote:
>>>>>>>
>>>>>>> I'm working with the rabbitmq c library and I need to have reconnect
>>>>>>> logic in there. Basically, try to send a message, if it fails, attempt
>>>>>>> reconnect and try again. How do I accomplish this? I've been using
>>>>>>> amqp_basic_publish and if I try that it just hangs.
>>>>>>
>>>>>> Did you work out what the problem was? The people familiar with the C client
>>>>>> at Rabbit HQ are a bit swamped at the moment, so it will likely be a while
>>>>>> before we can look into this.
>>>>>>
>>>>>> Matthias.
>>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>
>>
>

From amenges at vmware.com  Tue May  3 23:09:18 2011
From: amenges at vmware.com (Tony Menges)
Date: Tue, 03 May 2011 15:09:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnect logic for C library
In-Reply-To: <BANLkTi=Tqfj=cU0ULZOyJwtGu+Gf-XKkmg@mail.gmail.com>
Message-ID: <38a9906e-5423-4761-a958-25ddac44ed9a@zimbra-prod-mbox-1.vmware.com>

amqp_tx_commit does perform a transaction commit on the server; thus the
performance is impacted quite a bit but you do have a better guarantee that
the messages have been handled by the server. I haven't used the publisher 
confirms yet - I'll modify my test program to have that as an option. With 
publisher confirms, one could hold messages until they are confirmed and 
retransmit on connection failure. It may be possible to write a generic 
layer on top of the API to handle this.

The problem of knowing when the connection drops will require a bit more 
digging on my part.

Tony

----- Original Message -----
From: "Paul Dix" <paul at pauldix.net>
To: "Alexis Richardson" <alexis at rabbitmq.com>
Cc: "Tony Menges" <amenges at vmware.com>, "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Tuesday, May 3, 2011 2:54:08 PM
Subject: Re: [rabbitmq-discuss] Reconnect logic for C library

yeah, that looks exactly like what I was looking for. However, is the
amqp_tx_commit a transaction or just something that confirms that the
connection is still open and usable? This all started with the fact
that I couldn't even tell if a connection was up. Thus there was no
way to do error handling in the case the connection drops (for
whatever reason).

On Tue, May 3, 2011 at 5:46 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Publisher confirms?
>
> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>
>
> On Tue, May 3, 2011 at 10:35 PM, Paul Dix <paul at pauldix.net> wrote:
>> I've moved on from it now. However, here's basically what I wanted:
>> I have a publisher publishing messages. If the rabbit server fails, I
>> want the publisher to be able to tell which messages actually got
>> published and which didn't. Basically something like an atomic
>> publish. If it returns successfully, I can be sure that the message,
>> which is marked persistent, is actually stored on the server. Or put
>> even more simply: guaranteed delivery.
>>
>> Thanks,
>> Paul
>>
>> On Tue, May 3, 2011 at 4:34 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>>> Paul
>>>
>>> Can you tell us more about what you are trying to do please?
>>>
>>> alexis
>>>
>>>
>>> On Tue, May 3, 2011 at 3:25 AM, Tony Menges <amenges at vmware.com> wrote:
>>>> Hi Paul,
>>>>
>>>> I started to take a look at this and wanted to make sure I understand the problem. Is the basic problem that the return code from amqp_basic_publish() shows success even after the broker has closed the connection? Are you doing a commit after each message is published? Is commit showing success when the broker is down?
>>>>
>>>> I've written a simple test driver program that allows me to vary the number of messages per transaction and the amount of delay between messages and after commits. I set the number of messages per transaction to 5, the delay between publishes to 0 and the delay after each transaction to a few seconds. After I see a commit, I ctl-C Rabbit and I see usually 5 (the transaction batch size) messages published and the commit fails with a connection closed error. The Wireshark trace shows that only 1 of the messages was actually put on the wire.
>>>>
>>>> If I put a delay between message sends, I get a SIGPIPE usually after 1 or 2 messages have been sent.
>>>>
>>>> I think that in the first case, the messages are put into the socket's output buffer fast enough that the close from the other side has not been processed (my messages are quite small so they all fit in the socket's buffer); amqp_tx_commit() actually tries to read from the socket so it will notice the socket closed.
>>>>
>>>> Does this sound consistent with your experience?
>>>>
>>>> Tony Menges
>>>> VMware, Inc
>>>>
>>>> ----- Original Message -----
>>>> From: "Paul Dix" <paul at pauldix.net>
>>>> To: "Matthias Radestock" <matthias at rabbitmq.com>
>>>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>>> Sent: Tuesday, April 12, 2011 6:50:13 AM
>>>> Subject: Re: [rabbitmq-discuss] Reconnect logic for C library
>>>>
>>>> Hi Matthias,
>>>> I briefly tried to use these two:
>>>>
>>>> amqp_tx_commit(connection, channel);
>>>> amqp_get_rpc_reply(connection)
>>>>
>>>> Then check the result. However, I found that it would indicate success
>>>> for a message or two after I took RabbitMQ down before it indicated a
>>>> problem. I ended up bailing on C, but I'd be interested to hear if
>>>> this is possible with the library. The two things are: fail if a
>>>> message doesn't get published (i.e. don't fail silently) and check
>>>> that a connection/channel is open.
>>>>
>>>> Thanks,
>>>> Paul
>>>>
>>>> On Tue, Apr 12, 2011 at 7:04 AM, Matthias Radestock
>>>> <matthias at rabbitmq.com> wrote:
>>>>> Paul,
>>>>>
>>>>> On 01/04/11 22:40, Paul Dix wrote:
>>>>>>
>>>>>> I'm working with the rabbitmq c library and I need to have reconnect
>>>>>> logic in there. Basically, try to send a message, if it fails, attempt
>>>>>> reconnect and try again. How do I accomplish this? I've been using
>>>>>> amqp_basic_publish and if I try that it just hangs.
>>>>>
>>>>> Did you work out what the problem was? The people familiar with the C client
>>>>> at Rabbit HQ are a bit swamped at the moment, so it will likely be a while
>>>>> before we can look into this.
>>>>>
>>>>> Matthias.
>>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>
>

From simon at rabbitmq.com  Wed May  4 13:05:38 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 May 2011 13:05:38 +0100
Subject: [rabbitmq-discuss] Lightweight query for queues?
In-Reply-To: <8CC56202-E3E6-4F31-9A42-0DD59FCA5306@gmail.com>
References: <8CC56202-E3E6-4F31-9A42-0DD59FCA5306@gmail.com>
Message-ID: <4DC14112.4090403@rabbitmq.com>

Hi Ian.

On 03/05/11 19:18, Ian Ragsdale wrote:
> So the updated management plugin seems to have gotten rid of the
> crashes I was seeing, which is great - thanks to the rabbitmq devs
> for a quick response!

Cool.

> One useful thing about that thread was figuring out just how
> resource-intensive the management plugin is when querying the API for
> queues.  On my server with around 6000 queues, I can run 'rabbitmqctl
> list_queues' and get results in a second, but if I query the API for
> the list of queues it pegs one of the CPUs for upwards of 30 seconds,
> returning over 8MB of data.

That seems really wrong. While the management plugin hasn't received 
much performance tuning it should in theory be capable of being faster 
than rabbitmqctl in such scenarios, since the management plugin 
maintains its own statistics database while rabbitmqctl has to go off 
and talk to each queue individually.

And indeed, for a trivial test (declare 6k empty queues, time 
rabbitmqadmin -f raw_json list queues > /dev/null), I get 1.9 seconds on 
my workstation. That should be improved (preliminary profiling suggests 
it's spending a lot of time *sorting* the list!), but I'm not sure why 
you're seeing something so much slower.

I know this would have been very slow prior to fixing the bug you 
encountered (due to writing very large error messages in the logs) - 
sorry if this is patronising but you're definitely seeing the slow 
response with the fixed version?

Also, if you set force_fine_statistics to false for the 
rabbit_management_agent application - e.g with a 
/etc/rabbitmq/rabbitmq.config file like:

[{rabbit_management_agent, [{force_fine_statistics, false}]}].

  - does it make any difference?

<snip>

> So, what I'd like to be able to do is:
>
> 1. Allow specifying which data needs to be returned, so that more
> expensive statistics can be avoided if necessary. 2. Allow filtering
> the list of queues to return data for with a search term

<snip>

> Is this something you guys would consider?

Probably not (1) right now, since none of these statistics are supposed 
to be even slightly expensive, they should all just be hash lookups. (2) 
is somewhat interesting, probably simpler to implement and more 
generally useful. But I'd like to find out why you're seeing this run so 
slowly first.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From salvo.picci at gmail.com  Wed May  4 14:22:24 2011
From: salvo.picci at gmail.com (Salvatore Piccione)
Date: Wed, 4 May 2011 15:22:24 +0200
Subject: [rabbitmq-discuss] [RabbitMQ - HTTP API] Strange behaviour in the
	creation of a new binding
Message-ID: <BANLkTikMJ72aqLV+6RkByzurV2dXYs7srA@mail.gmail.com>

Hello,

I'm working with RabbitMQ 2.4.1 for windows and I'm interacting with the
server through the HTTP Interface. I notice that I get a HTTP 400 result if
I try to create a binding and in the POST request body I don't indicate the
"arguments" key. The Management HTTP API specification states that for that
command all keys are optional; anyway the server creates the binding but the
HTTP Error message doesn't contain the "Location" header (where the URI of
your new binding should be reported).
Please, find below the messages I send to RabbitMQ and the replies I
receive.

1. Request body without "argument" key
REQUEST: POST /api/bindings/%2f/e/exchange1/q/queue1
REQUEST BODY: {"routing_key":"txtRoute"}
RESPONSE: HTTP/1.1 400 Bad Request
    Date: Wed, 04 May 2011 13:02:53 GMT
    Content-Length: 60
    Content-Type: application/json
    Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
RESPONSE BODY: {"error":"bad_request","reason":{"key_missing":"arguments"}}

2. Empty request body
REQUEST: POST /api/bindings/%2f/e/exchange1/q/queue1
REQUEST BODY: {}
RESPONSE: HTTP/1.1 400 Bad Request
    Date: Wed, 04 May 2011 13:09:53 GMT
    Content-Length: 88
    Content-Type: application/json
    Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
RESPONSE BODY:
{"error":"bad_request","reason":{"key_missing":"routing_key","key_missing":"arguments"}}


3. Request body with all keys
REQUEST: POST /api/bindings/%2f/e/exchange1/q/queue1
REQUEST BODY: {"arguments":[],"routing_key":"txtRoute"}
RESPONSE: HTTP/1.1 201 Created
    Date: Wed, 04 May 2011 13:00:29 GMT
    Content-Length: 0
    Location: ../../../../%2F/e/txtExchange/q/SubscriberHTTP1/txtRoute
    Content-Type: application/json
    Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)

Just to recap:
Case1: the binding is created with the given "routing_key" but no location
is returned
Case2: the binding is created but no location is returned
Case3: it works as expected

All above cases have been tested using a direct and a topic exchange.

Is there something wrong in my HTTP request or the HTTP API Specification
should be changed?

Regards,

Salvatore
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110504/02801b87/attachment.htm>

From salvo.picci at gmail.com  Wed May  4 16:12:51 2011
From: salvo.picci at gmail.com (Salvatore Piccione)
Date: Wed, 4 May 2011 17:12:51 +0200
Subject: [rabbitmq-discuss] [RabbitMQ - HTTP API] Encoding key is mandatory
 in order to get messages from a queue
Message-ID: <BANLkTi=yFvgd06AK0xWC=u7NqX0vqPdDfw@mail.gmail.com>

Hello,

I'm working with RabbitMQ 2.4.1 for Windows and using the HTTP API to
interact with the RabbitMQ server. I notice that, when I try to get messages
from a queue, I have to specify the payload encoding - even if the HTTP API
Specification (
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_4_1/priv/www-api/help.html)
doesn't list it in the mandatory keys - and the only accepted value is
"base64".
Please, find below the tests I performed:

1: Specify in the request body all the mandatory fields listed in the HTTP
API Specification
REQUEST: POST /api/queues/%2f/queue1/get
REQUEST BODY: {"count":10,"requeue":false}
Response: HTTP/1.1 400 Bad Request
    Date: Wed, 04 May 2011 14:47:48 GMT
    Content-Length: 59
    Content-Type: text/html
    Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
response body: {"error":"bad_request","reason":{"key_missing":"encoding"}}

2. Specify in the request body all the mandatory fields (including
"encoding" but using "string" as value)
REQUEST: POST /api/queues/%2f/queue1/get
REQUEST BODY: {"count":10,"requeue":false,"encoding":"string"}
Response: HTTP/1.1 400 Bad Request
    Date: Wed, 04 May 2011 15:03:03 GMT
    Content-Length: 58
    Content-Type: text/html
    Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
response body: {"error":"bad_request","reason":["bad_encoding","string"]}

3. Specify in the request body all the mandatory fields (including
"encoding" but using "base64" as value)
REQUEST: POST /api/queues/%2f/queue1/get
REQUEST BODY: {"count":10,"requeue":false,"encoding":"base64"}
Response: HTTP/1.1 200 OK
    content-type: application/json
    Date: Wed, 04 May 2011 15:05:14 GMT
    Content-Length: 2
    Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
    Cache-Control: no-cache
response body: []

Case 1 raises an error because of the lack of a mandatory field (the payload
encoding).
Case 2 raises an error because of a bad "encoding" value even if when
publishing a message into an exchange the values allowed for the
"payload_encoding" key are either "string" or "base64".
Case 3 works as expected.

Is there something wrong in my requests or there is a problem on the server
side?

Regards,

Salvatore
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110504/8df63a4f/attachment.htm>

From simon at rabbitmq.com  Wed May  4 16:29:31 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 May 2011 16:29:31 +0100
Subject: [rabbitmq-discuss] [RabbitMQ - HTTP API] Strange behaviour in
 the	creation of a new binding
In-Reply-To: <BANLkTikMJ72aqLV+6RkByzurV2dXYs7srA@mail.gmail.com>
References: <BANLkTikMJ72aqLV+6RkByzurV2dXYs7srA@mail.gmail.com>
Message-ID: <4DC170DB.1010906@rabbitmq.com>

On 04/05/11 14:22, Salvatore Piccione wrote:
> Is there something wrong in my HTTP request or the HTTP API
> Specification should be changed?

Nope, I think you found a bug. Thanks for the report.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed May  4 16:40:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 May 2011 16:40:23 +0100
Subject: [rabbitmq-discuss] [RabbitMQ - HTTP API] Encoding key is
 mandatory in order to get messages from a queue
In-Reply-To: <BANLkTi=yFvgd06AK0xWC=u7NqX0vqPdDfw@mail.gmail.com>
References: <BANLkTi=yFvgd06AK0xWC=u7NqX0vqPdDfw@mail.gmail.com>
Message-ID: <4DC17367.3050008@rabbitmq.com>

On 04/05/11 16:12, Salvatore Piccione wrote:
> Hello,

Hi.

> I'm working with RabbitMQ 2.4.1 for Windows and using the HTTP API to
> interact with the RabbitMQ server. I notice that, when I try to get
> messages from a queue, I have to specify the payload encoding - even if
> the HTTP API Specification
> (http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_4_1/priv/www-api/help.html)
> doesn't list it in the mandatory keys

I think it should. Will fix.

> - and the only accepted value is "base64".

You should also be able to use "auto", meaning "send me a string if the 
contents of the message can be decoded as UTF-8, and base64 otherwise".

<snip>

> Is there something wrong in my requests or there is a problem on the
> server side?

In this case it's more a failure of documentation, but I'll get that 
fixed too :)

If you're planning on driving the publish / get part of the management 
plugin API programatically, please remember that it's intended for 
injecting test messages, diagnostics etc - it does nothing around 
reliable delivery (and isn't terribly performant) and so should really 
only be treated as a sysadmin's tool.

For messaging from your application you should use AMQP / STOMP / 
JSON-RPC / etc.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From mike.hadlow at 15below.com  Wed May  4 17:15:51 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Wed, 4 May 2011 11:15:51 -0500
Subject: [rabbitmq-discuss] My attempt at a high-level API for .NET
Message-ID: <3095E7BFC8C0664E97D71288189F19C6177CE656C5@AUSP01VMBX29.collaborationhost.net>

Hi All,

I've just published details of a high level .NET API for Rabbit/AMQP:
http://mikehadlow.blogspot.com/2011/05/easynetq-simple-net-api-for-rabbitmq.html

Feedback would be much appreciated. I'm especially hoping that someone will look at the way I'm consuming messages. Currently with a simple while loop in a new thread:
https://github.com/mikehadlow/EasyNetQ/blob/master/EasyNetQ/QueueingConsumerFactory.cs

I'm sure there must be a better way.

Many thanks
Mike

15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110504/50b744e7/attachment-0001.htm>

From gmr at myyearbook.com  Wed May  4 20:42:01 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 4 May 2011 15:42:01 -0400
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1
In-Reply-To: <4DBF060C.2010103@rabbitmq.com>
References: <4DB8A74B.9000105@echostar.com>
	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>
	<BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>
	<4DBEFC9A.4040705@rabbitmq.com>
	<812F5896312E4A8FAA2DFA2D5972DE41@myyearbook.com>
	<4DBF060C.2010103@rabbitmq.com>
Message-ID: <BANLkTimg8GV-p5d=WRVoFuWmvtFkY2ZywA@mail.gmail.com>

On Mon, May 2, 2011 at 3:29 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Gavin,
>
> Gavin M. Roy wrote:
>
>> On Monday, May 2, 2011 at 2:48 PM, Matthias Radestock wrote:
>>
>>> The above graph shows system memory usage. It is perfectly normal for a
>>> non-idle linux system to gradually fill up all the memory with cached
>>> files.
>>>
>> Which I expect in disk buffers in that graph. The inactive memory is what
>> threw me, going back and re-reading up on it, this is memory that previously
>> been allocated in vm that can be reclaimed for other use, correct?
>>
>
> I have no idea. Consult your resident Linux expert ;)


So some more color, I decided to dive deeper into this to see what I could
find. The short version is I jumped into erl using -remsh and ran
erlang:garbage_collect(). and saw an immediate drop in that inactive memory.

I am using R14B01. I am reluctant to let that inactivity hit the upper
bounds of my ram, but at the same time, I want to see if the erlang vm is
just allocating until it can't and then will reclaim usage.

I did however with a certain level of clarity find that by issuing the
command in the erlang attached process, inactive memory held in the linux
kernel dropped by 83%.

Commands run:

$ erl -sname temp -remsh rabbit at rabbit03
1> erlang:garbage_collect().
true

May not be the bunny, but it seems to the vm.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110504/59756dd3/attachment.htm>

From gmr at myyearbook.com  Thu May  5 02:03:23 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 4 May 2011 21:03:23 -0400
Subject: [rabbitmq-discuss] Minor nit type bugs in the Management Plugin
 interface
In-Reply-To: <4DC00135.9060506@rabbitmq.com>
References: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>
	<4DBFD2A1.70702@rabbitmq.com> <4DC00135.9060506@rabbitmq.com>
Message-ID: <E8D15BDABBB242F2A2D668158E28409B@myyearbook.com>

On Tuesday, May 3, 2011 at 9:20 AM, Simon MacMullen wrote:
> On 03/05/11 11:02, Simon MacMullen wrote:
> 
> Hmm, this works for me.
> 
> Cheers, Simon

Hey, I've attached another plugin and startup logs for three of the nodes in the cluster to prove my alleged sanity ;-)

In reviewing the logs I did notice something interesting... In the nodes that I added to the cluster, when I had issues start_app after adding them, the "starting STOMP Adapter (binding to [61613]) ...done" line did not show. All brokers are listening on the port. The startup logs for these two nodes include the initial startup then the startup after the following commands were issued:

stop_app
reset
cluster [nodes to cluster with]
start_app

I wonder if the oddity is in that. I did not restart the brokers themselves after adding them to the cluster. They were added in order.

Hope this helps,

Gavin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110504/a3321862/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen shot 2011-05-04 at 8.50.50 PM.png
Type: image/png
Size: 45543 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110504/a3321862/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: startup_logs.txt
Type: application/octet-stream
Size: 17089 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110504/a3321862/attachment-0001.obj>

From salvo.picci at gmail.com  Thu May  5 09:07:42 2011
From: salvo.picci at gmail.com (Salvatore Piccione)
Date: Thu, 5 May 2011 10:07:42 +0200
Subject: [rabbitmq-discuss] R: Re: [RabbitMQ - HTTP API] Encoding key is
 mandatory in order to get messages from a queue
Message-ID: <BANLkTikv_6kEN5d+TLTh1X93L_m+QOzdwA@mail.gmail.com>

Hello Simon,

thanks for your reply! Just few words on the reason why I'm using the
Management HTTP API: I'm working on a proof-of-concept about the usage of
RabbitMQ on a Android device (basically receiving messages from a queue) and
I decided to use such interface because I had a vary short time for working
on it and Android provides a great support for HTTP connections and JSON. I
read a mailing list thread about the realization of an Android client for
RabbitMQ but I noticed that it hasn't been developed as an "official" plugin
and I also gave a look to the XMPP gateway (Android supports XMPP) that I
could try to configure and use in the future.

Have a nice day,

Salvatore
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/f4ef07ac/attachment.htm>

From simone.busoli at gmail.com  Thu May  5 10:05:33 2011
From: simone.busoli at gmail.com (Simone)
Date: Thu, 5 May 2011 02:05:33 -0700 (PDT)
Subject: [rabbitmq-discuss] My attempt at a high-level API for .NET
In-Reply-To: <3095E7BFC8C0664E97D71288189F19C6177CE656C5@AUSP01VMBX29.collaborationhost.net>
Message-ID: <2584675.871.1304586333664.JavaMail.geo-discussion-forums@yqgy8>

Hi Mike, nice to see you here, I started working with RabbitMQ recently and 
would definitely like a high level API to play with. About your question, 
lookup the EventingConsumer or look at my rewrite of the 6 initial tutorials 
here: http://code.google.com/p/mexexp/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/30454785/attachment.htm>

From simone.busoli at gmail.com  Thu May  5 10:19:09 2011
From: simone.busoli at gmail.com (Simone)
Date: Thu, 5 May 2011 02:19:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster, shovel,
 how to accomplish this scenario?
In-Reply-To: <BANLkTimYXvijK4FNz3o8YZ4La6MmDZvB6g@mail.gmail.com>
Message-ID: <341655.99.1304587149745.JavaMail.geo-discussion-forums@yqmc16>

Hi, I'm going to try setting it up soon, here is what I need to accomplish, 
any guidance is appreciated.
Clients shouldn't need to know anything about the instance of RabbitMQ it is 
connected to (we will have two instances for now, maybe more in the future), 
except for its url. From then on a message published from a client connected 
to one instance should reach clients connected to another instance without 
the recipients needing to know anything about this additional hop. That is, 
the two instances should really behave as one and the same client code 
should be able to connect to either of them without any change except for 
the instance url, which will come from some configuration.

Thank you very much for your help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/62c4adec/attachment.htm>

From simon at rabbitmq.com  Thu May  5 10:47:33 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 May 2011 10:47:33 +0100
Subject: [rabbitmq-discuss] R: Re: [RabbitMQ - HTTP API] Encoding key is
 mandatory in order to get messages from a queue
In-Reply-To: <BANLkTikv_6kEN5d+TLTh1X93L_m+QOzdwA@mail.gmail.com>
References: <BANLkTikv_6kEN5d+TLTh1X93L_m+QOzdwA@mail.gmail.com>
Message-ID: <4DC27235.4090106@rabbitmq.com>

On 05/05/11 09:07, Salvatore Piccione wrote:
> thanks for your reply! Just few words on the reason why I'm using the
> Management HTTP API: I'm working on a proof-of-concept about the usage
> of RabbitMQ on a Android device (basically receiving messages from a
> queue) and I decided to use such interface because I had a vary short
> time for working on it and Android provides a great support for HTTP
> connections and JSON. I read a mailing list thread about the realization
> of an Android client for RabbitMQ but I noticed that it hasn't been
> developed as an "official" plugin and I also gave a look to the XMPP
> gateway (Android supports XMPP) that I could try to configure and use in
> the future.

Ah, that makes sense.

FTR the latest Java client should have had most of the 
Android-problematic stuff ripped out, so compiling it for Android 
shouldn't be too hard now (you'd hopefully need to just delete 
JDKSaslConfig.java). I'd definitely recommend that for the future over 
XMPP. But HTTP should be fine for a POC.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Thu May  5 11:01:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 May 2011 11:01:18 +0100
Subject: [rabbitmq-discuss] Minor nit type bugs in the Management Plugin
 interface
In-Reply-To: <E8D15BDABBB242F2A2D668158E28409B@myyearbook.com>
References: <A8C4AEF4FDAA4B4AB7C936BF6EC6CB99@myyearbook.com>
	<4DBFD2A1.70702@rabbitmq.com> <4DC00135.9060506@rabbitmq.com>
	<E8D15BDABBB242F2A2D668158E28409B@myyearbook.com>
Message-ID: <4DC2756E.5090509@rabbitmq.com>

On 05/05/11 02:03, Gavin M. Roy wrote:
> I did not restart the brokers themselves after adding them to the cluster.

Ah, that makes sense now. The STOMP adapter notifies the cluster that 
it's listening when it starts up. But rabbitmqctl stop_app and start_app 
only stop and start the broker, the adapter keeps running. So if you 
restart a node its STOMP listener will appear there.

I think we have a bug open to change stop_app / start_app to stop and 
start all the plugins, but I don't think it's likely to be soon.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From david at rabbitmq.com  Thu May  5 11:23:54 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 05 May 2011 11:23:54 +0100
Subject: [rabbitmq-discuss] looks like a memory leak, 2.4.1
In-Reply-To: <BANLkTimg8GV-p5d=WRVoFuWmvtFkY2ZywA@mail.gmail.com> (Gavin
	M. Roy's message of "Wed, 4 May 2011 15:42:01 -0400")
References: <4DB8A74B.9000105@echostar.com>
	<BANLkTimF8XUoki=A9ksDLR3Xhf551q9pRA@mail.gmail.com>
	<BANLkTimFD=k1Pms1f81hJvL7a4LFRgQ-Fg@mail.gmail.com>
	<4DBEFC9A.4040705@rabbitmq.com>
	<812F5896312E4A8FAA2DFA2D5972DE41@myyearbook.com>
	<4DBF060C.2010103@rabbitmq.com>
	<BANLkTimg8GV-p5d=WRVoFuWmvtFkY2ZywA@mail.gmail.com>
Message-ID: <yrv4csjstxx6t.fsf@dwragg.eng.vmware.com>

"Gavin M. Roy" <gmr at myyearbook.com> writes:
> So some more color, I decided to dive deeper into this to see what I could
> find. The short version is I jumped into erl using -remsh and ran
> erlang:garbage_collect(). and saw an immediate drop in that inactive
> memory.

By inactive memory, you mean that measured by the "Inactive" line in
/proc/meminfo?

> I am using R14B01. I am reluctant to let that inactivity hit the upper
> bounds of my ram, but at the same time, I want to see if the erlang vm is
> just allocating until it can't and then will reclaim usage.

Inactive memory, in the Linux MM sense, is merely memory that has been
touched less recently, and would therefore be more eligible to be
reclaimed when the kernel wants to free up memory.  Unless you are
looking into the internal details of Linux memory management, it is not
a particularly interesting number.  It is completely unrelated to erlang
VM memory allocations, and certainly does not indicate a memory leak.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From awitbrock at vmware.com  Thu May  5 12:44:49 2011
From: awitbrock at vmware.com (Ann Witbrock)
Date: Thu, 5 May 2011 04:44:49 -0700
Subject: [rabbitmq-discuss] Upgrading windows bundle?
In-Reply-To: <4DB0B4C8.3000405@cpicorp.com>
References: <4DB0B4C8.3000405@cpicorp.com>
Message-ID: <596AA34C9AE73245BFEC2A5202A00BA1069FB87507@EXCH-MBX-21.vmware.com>

I am curious as to why you would want a broker on so many sites. It would be more typical to have clients at a myriad of sites, communicating via much fewer brokers.

If you are able to use default locations, you may find the new (experimental) installer is helpful to manage an upgrade.

Ann Witbrock
awitbrock at vmware.com
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Derek Chen-Becker [dbecker at cpicorp.com]
Sent: 21 April 2011 23:50
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Upgrading windows bundle?

Hi all,
    We're looking at deploying a RabbitMQ broker on Windows at
potentially several thousand sites and our QA group has come up with a
few questions. First, the windows bundle is essentially a zip file that
we unpack to a specific directory for the install. When we want to
upgrade can we just stop the service, unpack the new files to the same
location and then start the service, or do we need to additionally
deregister the service, remove all of the old files, and then unpack and
re-register the service?

    They were also wondering if the permissions are stored in a file
somewhere that we could push out if we decide we want to add users,
perms, etc, or if we'll need to run a script against rabbitmqctl on each
box (slightly more work but not a big deal). I know RabbitMQ stores that
data somewhere, we're just not sure if it's the same name on each box
and if it's safe to copy that file to a different host (each host is
going to have a unique node name based on the computer name).

Thanks,

Derek
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jim at rabbitmq.com  Thu May  5 14:36:45 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Thu, 5 May 2011 14:36:45 +0100
Subject: [rabbitmq-discuss] rabbitmq-c + 1.6.0 = bad headers
In-Reply-To: <E953179D-E115-461A-98BB-722A4E8244D5@3crowd.com>
References: <C9DEE614.1D714%pdezwart@rubiconproject.com>
	<E953179D-E115-461A-98BB-722A4E8244D5@3crowd.com>
Message-ID: <BANLkTimH-Uh+4YNSD7wsUnXtetLtv0jGFg@mail.gmail.com>

On 28 April 2011 20:51, David Hawthorne <dhawth at 3crowd.com> wrote:

> FWIW, it's not easy to find out what versions of the AMQP spec the various
> versions of rabbitmq support when digging through the website.


It could be clearer, I know, but you can infer some of that from
http://www.rabbitmq.com/changelog.html.

Jim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/2dfadca5/attachment.htm>

From bmurphy1976 at gmail.com  Thu May  5 15:13:34 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 5 May 2011 09:13:34 -0500
Subject: [rabbitmq-discuss] My attempt at a high-level API for .NET
In-Reply-To: <3095E7BFC8C0664E97D71288189F19C6177CE656C5@AUSP01VMBX29.collaborationhost.net>
References: <AcwKdiNLBluoijewSMuPwFyNDsnWQA==>
	<3095E7BFC8C0664E97D71288189F19C6177CE656C5@AUSP01VMBX29.collaborationhost.net>
Message-ID: <BANLkTi=OAg8Bp6yLWJJX2KHX3_1FJBK--A@mail.gmail.com>

On Wed, May 4, 2011 at 11:15 AM, Mike Hadlow <mike.hadlow at 15below.com> wrote:
> I?ve just published details of a high level .NET API for Rabbit/AMQP:
>
> http://mikehadlow.blogspot.com/2011/05/easynetq-simple-net-api-for-rabbitmq.html

I've more or less gone through the same process as you.  I've been
through a few iterations, and this is what I've settled on so far.

I have an IBus interface that is configured to send messages to a
topic exchange, and then I create multiple instances of that class
configured to multiple exchange (i.e. new Bus("host", "port",
"exchange")).  The reason I do this is to de-emphasize exchanges and
emphasize routes to reduce the cognitive burden for the rest of our
team.  The whole exchange/route model gives us more flexibility than
we need so I've simplified somewhat.

IBus looks like this:

variations of send:

	void Send(params object[] messages)
	void Send<TMessage>(params TMessage[] messages)
	void Send(IEnumerable<object> messages)
	void Send<TMessage>(IEnumerable<TMessage> messages)

a route method allowing explicit definition of the route:

	void Route(string routeName, params object[] messages)
	void Route(string routeName, IEnumerable<object> messages)
	void Route<TMessage>(string routeName, params TMessage[] messages)
	void Route<TMessage>(string routeName, IEnumerable<TMessage> messages)

async versions of all of the above:

	void SendAsync<TMessage>(IEnumerable<TMessage> messages)
	void RouteAsync<TMessage>(string routeName, params TMessage[] messages)
 	etc.

RPC requests:

	object SendAndReceive(Type responseType, object request)
	object SendAndReceive(Type responseType, object request, TimeSpan timeout)
	TResponse SendAndReceive<TRequest, TResponse>(TRequest request)
	TResponse SendAndReceive<TRequest, TResponse>(TRequest request,
TimeSpan timeout)

	object RouteAndReceive(Type responseType, string routeName, object request)
	object RouteAndReceive(Type responseType, string routeName, object
request, TimeSpan timeout)
	TResponse RouteAndReceive<TRequest, TResponse>(string routeName,
TRequest request)
	TResponse RouteAndReceive<TRequest, TResponse>(string routeName,
TRequest request, TimeSpan timeout)

IBus also has a RouteNameSelector property that references a class
with one method:

	string SelectRouteName(BusConfig config, object message);

This can be swapped out for alternate implementations, but the default
does the following when calling Send methods (this is not used for the
Route methods):

	1. if message implements IRoutable, return IRoutable.RouteName
	2. if message has [RouteNameAttribute("RouteName")] return "RouteName"
	3. otherwise return message.GetType().Name

subscriptions look like this:

var subscription = bus.Subscribe
	.ToRoute("routeName")
	.WithHandler(msg => { do something });

or

// where THandler : ConsumerOf<TMessage>
var subscription = bus.Subscribe
	.ToQueue("queue name #1")
   	.ToQueue("queue name #2")
	.WithContainerScopedHandler<TMessage, THandler>(container);

// equates for each message to:
// using (var childContainer = container.CreateLifeTimeContainer()) {
//	var handler = container.Resolve<THandler>();
//	handler.Consume(message);
// }

subscription.Start();
subscription.Stop();

There are, of course, many overloads that allow me to consume messages
in a variety of different ways (interface based, reflection method
based, delegate based, etc. with and without scoping to a container)
and additional fluent methods to control retries, timeouts, dead
letter handling, and the likes.

> Feedback would be much appreciated. I?m especially hoping that someone will
> look at the way I?m consuming messages. Currently with a simple while loop
> in a new thread:
>
> https://github.com/mikehadlow/EasyNetQ/blob/master/EasyNetQ/QueueingConsumerFactory.cs
>
>
>
> I?m sure there must be a better way.

We use QueueingBasicConsumer and are quite happy with it.  I haven't
had a need to use anything else.  Looking at our code, it's a little
different, but most of that just has to do error handling and the
additional code needed to support our abstractions.

Bryan

From simone.busoli at gmail.com  Thu May  5 15:20:41 2011
From: simone.busoli at gmail.com (Simone)
Date: Thu, 5 May 2011 07:20:41 -0700 (PDT)
Subject: [rabbitmq-discuss] My attempt at a high-level API for .NET
In-Reply-To: <BANLkTi=OAg8Bp6yLWJJX2KHX3_1FJBK--A@mail.gmail.com>
Message-ID: <26490413.2417.1304605241798.JavaMail.geo-discussion-forums@yqbw30>

I like RhinoServiceBus public API quite a lot, therefore if I had to 
implement one on top of RabbitMQ it would be very similar to that one.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/d5855db7/attachment.htm>

From bmurphy1976 at gmail.com  Thu May  5 15:35:41 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 5 May 2011 09:35:41 -0500
Subject: [rabbitmq-discuss] My attempt at a high-level API for .NET
In-Reply-To: <26490413.2417.1304605241798.JavaMail.geo-discussion-forums@yqbw30>
References: <BANLkTi=OAg8Bp6yLWJJX2KHX3_1FJBK--A@mail.gmail.com>
	<26490413.2417.1304605241798.JavaMail.geo-discussion-forums@yqbw30>
Message-ID: <BANLkTimYNFGqwNmuFA-y-V927FGrD=vP4A@mail.gmail.com>

On Thu, May 5, 2011 at 9:20 AM, Simone <simone.busoli at gmail.com> wrote:
> I like RhinoServiceBus public API quite a lot, therefore if I had to
> implement one on top of RabbitMQ it would be very similar to that one.

Never looked at Rhino but I have taken some inspiration from
MassTransit and NServiceBus.  The new version of MassTransit is
looking pretty good, *and* it sounds like they are working on real
honest-to-god integration with RabbitMQ which is GREAT.  We run our
services under mono and MSMQ is simply not an option and I won't touch
ActiveMQ with a 10 foot pole.

Bryan

From mike.hadlow at 15below.com  Thu May  5 15:50:32 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Thu, 5 May 2011 09:50:32 -0500
Subject: [rabbitmq-discuss] My attempt at a high-level API for .NET
In-Reply-To: <BANLkTi=OAg8Bp6yLWJJX2KHX3_1FJBK--A@mail.gmail.com>
References: <AcwKdiNLBluoijewSMuPwFyNDsnWQA==>
	<3095E7BFC8C0664E97D71288189F19C6177CE656C5@AUSP01VMBX29.collaborationhost.net>
	<BANLkTi=OAg8Bp6yLWJJX2KHX3_1FJBK--A@mail.gmail.com>
Message-ID: <3095E7BFC8C0664E97D71288189F19C6177CE65C49@AUSP01VMBX29.collaborationhost.net>

Thanks Brian,

It's reassuring to hear that you are also successfully using QueueingBasicConsumer. I don't suppose you'd be willing to share your code?

Very interesting to hear that you are working with Mono. So I guess that means that the Rabbit .NET client is mono compatible. EasyNetQ should run well under mono too, I'll give it a try.

Mike

-----Original Message-----
From: Bryan Murphy [mailto:bmurphy1976 at gmail.com]
Sent: 05 May 2011 15:14
To: Mike Hadlow
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] My attempt at a high-level API for .NET

On Wed, May 4, 2011 at 11:15 AM, Mike Hadlow <mike.hadlow at 15below.com> wrote:
> I've just published details of a high level .NET API for Rabbit/AMQP:
>
> http://mikehadlow.blogspot.com/2011/05/easynetq-simple-net-api-for-rab
> bitmq.html

I've more or less gone through the same process as you.  I've been through a few iterations, and this is what I've settled on so far.

I have an IBus interface that is configured to send messages to a topic exchange, and then I create multiple instances of that class configured to multiple exchange (i.e. new Bus("host", "port", "exchange")).  The reason I do this is to de-emphasize exchanges and emphasize routes to reduce the cognitive burden for the rest of our team.  The whole exchange/route model gives us more flexibility than we need so I've simplified somewhat.

IBus looks like this:

variations of send:

        void Send(params object[] messages)
        void Send<TMessage>(params TMessage[] messages)
        void Send(IEnumerable<object> messages)
        void Send<TMessage>(IEnumerable<TMessage> messages)

a route method allowing explicit definition of the route:

        void Route(string routeName, params object[] messages)
        void Route(string routeName, IEnumerable<object> messages)
        void Route<TMessage>(string routeName, params TMessage[] messages)
        void Route<TMessage>(string routeName, IEnumerable<TMessage> messages)

async versions of all of the above:

        void SendAsync<TMessage>(IEnumerable<TMessage> messages)
        void RouteAsync<TMessage>(string routeName, params TMessage[] messages)
        etc.

RPC requests:

        object SendAndReceive(Type responseType, object request)
        object SendAndReceive(Type responseType, object request, TimeSpan timeout)
        TResponse SendAndReceive<TRequest, TResponse>(TRequest request)
        TResponse SendAndReceive<TRequest, TResponse>(TRequest request, TimeSpan timeout)

        object RouteAndReceive(Type responseType, string routeName, object request)
        object RouteAndReceive(Type responseType, string routeName, object request, TimeSpan timeout)
        TResponse RouteAndReceive<TRequest, TResponse>(string routeName, TRequest request)
        TResponse RouteAndReceive<TRequest, TResponse>(string routeName, TRequest request, TimeSpan timeout)

IBus also has a RouteNameSelector property that references a class with one method:

        string SelectRouteName(BusConfig config, object message);

This can be swapped out for alternate implementations, but the default does the following when calling Send methods (this is not used for the Route methods):

        1. if message implements IRoutable, return IRoutable.RouteName
        2. if message has [RouteNameAttribute("RouteName")] return "RouteName"
        3. otherwise return message.GetType().Name

subscriptions look like this:

var subscription = bus.Subscribe
        .ToRoute("routeName")
        .WithHandler(msg => { do something });

or

// where THandler : ConsumerOf<TMessage> var subscription = bus.Subscribe
        .ToQueue("queue name #1")
        .ToQueue("queue name #2")
        .WithContainerScopedHandler<TMessage, THandler>(container);

// equates for each message to:
// using (var childContainer = container.CreateLifeTimeContainer()) {
//      var handler = container.Resolve<THandler>();
//      handler.Consume(message);
// }

subscription.Start();
subscription.Stop();

There are, of course, many overloads that allow me to consume messages in a variety of different ways (interface based, reflection method based, delegate based, etc. with and without scoping to a container) and additional fluent methods to control retries, timeouts, dead letter handling, and the likes.

> Feedback would be much appreciated. I'm especially hoping that someone
> will look at the way I'm consuming messages. Currently with a simple
> while loop in a new thread:
>
> https://github.com/mikehadlow/EasyNetQ/blob/master/EasyNetQ/QueueingCo
> nsumerFactory.cs
>
>
>
> I'm sure there must be a better way.

We use QueueingBasicConsumer and are quite happy with it.  I haven't had a need to use anything else.  Looking at our code, it's a little different, but most of that just has to do error handling and the additional code needed to support our abstractions.


Bryan

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From mike.hadlow at 15below.com  Thu May  5 15:53:45 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Thu, 5 May 2011 09:53:45 -0500
Subject: [rabbitmq-discuss] My attempt at a high-level API for .NET
In-Reply-To: <BANLkTimYNFGqwNmuFA-y-V927FGrD=vP4A@mail.gmail.com>
References: <BANLkTi=OAg8Bp6yLWJJX2KHX3_1FJBK--A@mail.gmail.com>
	<26490413.2417.1304605241798.JavaMail.geo-discussion-forums@yqbw30>
	<BANLkTimYNFGqwNmuFA-y-V927FGrD=vP4A@mail.gmail.com>
Message-ID: <3095E7BFC8C0664E97D71288189F19C6177CE65C59@AUSP01VMBX29.collaborationhost.net>

I haven't looked at RhinoServiceBus, my inspiration is mainly MassTransit. Agreed that the new version is looking really nice.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Bryan Murphy
Sent: 05 May 2011 15:36
To: rabbitmq-discuss at googlegroups.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] My attempt at a high-level API for .NET

On Thu, May 5, 2011 at 9:20 AM, Simone <simone.busoli at gmail.com> wrote:
> I like RhinoServiceBus public API quite a lot, therefore if I had to
> implement one on top of RabbitMQ it would be very similar to that one.

Never looked at Rhino but I have taken some inspiration from MassTransit and NServiceBus.  The new version of MassTransit is looking pretty good, *and* it sounds like they are working on real honest-to-god integration with RabbitMQ which is GREAT.  We run our services under mono and MSMQ is simply not an option and I won't touch ActiveMQ with a 10 foot pole.

Bryan
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From brandon.craig.rhodes at gmail.com  Thu May  5 16:17:28 2011
From: brandon.craig.rhodes at gmail.com (Brandon Craig Rhodes)
Date: Thu, 05 May 2011 11:17:28 -0400
Subject: [rabbitmq-discuss] how to detect bad username/password in 0.9.5?
Message-ID: <8762pp2n3r.fsf@asaph.rhodesmill.org>

When a error occurs while connecting in Pika 0.9.5, I have to go log on
to my RabbitMQ server and look at its logs to discover what happened -
the IOLoop in the local program simply returns after three seconds and
my next piece of code breaks because the `on_open_callback` callback
that I am passing to my `SelectConnection` never gets called when the
username and password are wrong.

How am I supposed to intercept this condition so that I can return an
error message to my user?  I tried registering a callback with the
`connection.add_on_close_callback()` method but, sensibly enough, it
never gets called because this is not really a connection-close, but a
connection not getting established in the first place.  I have looked
around for some sort of a `connection.add_on_error_callback()` or some
similar sort of facility, but cannot find one.

How do I catch and handle asynchronous errors?

Thanks for ANY help that you guys can offer - and thanks, Gavin, for
writing such an important part of the modern Python ecosystem!

-- 
Brandon Craig Rhodes   brandon at rhodesmill.org   http://rhodesmill.org/brandon

From bmurphy1976 at gmail.com  Thu May  5 16:58:51 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 5 May 2011 10:58:51 -0500
Subject: [rabbitmq-discuss] My attempt at a high-level API for .NET
In-Reply-To: <3095E7BFC8C0664E97D71288189F19C6177CE65C49@AUSP01VMBX29.collaborationhost.net>
References: <3095E7BFC8C0664E97D71288189F19C6177CE656C5@AUSP01VMBX29.collaborationhost.net>
	<BANLkTi=OAg8Bp6yLWJJX2KHX3_1FJBK--A@mail.gmail.com>
	<3095E7BFC8C0664E97D71288189F19C6177CE65C49@AUSP01VMBX29.collaborationhost.net>
Message-ID: <BANLkTinifxfEW4093wzZ=gYeE7RqXY-f7w@mail.gmail.com>

On Thu, May 5, 2011 at 9:50 AM, Mike Hadlow <mike.hadlow at 15below.com> wrote:
> Thanks Brian,
>
> It's reassuring to hear that you are also successfully using QueueingBasicConsumer. I don't suppose you'd be willing to share your code?
>
> Very interesting to hear that you are working with Mono. So I guess that means that the Rabbit .NET client is mono compatible. EasyNetQ should run well under mono too, I'll give it a try.
>
> Mike

I'm willing.  My employer is not. :(

Bryan

From luke.winikates at gmail.com  Thu May  5 17:19:33 2011
From: luke.winikates at gmail.com (Luke Winikates)
Date: Thu, 5 May 2011 09:19:33 -0700
Subject: [rabbitmq-discuss] .NET API (2.4.1) -- does BasicAcks event
	ever fire?
Message-ID: <BANLkTim6u9VjwssggiaLdpz-6+KNnZEH=A@mail.gmail.com>

Matthew--

Thanks. That clarifies a lot, and that use case makes a lot more sense.

The name for this event in the .NET API is much different from its Java
counterpart... in a way that seems misleading (perhaps only to me?). Put
another way, if i had been coming at this from the other direction-- wanting
to listen for Publisher Confirms from the broker-- I'm pretty sure that
adding a listener to an event called "BasicAcks" would never have occurred
to me as the way to achieve that.

Thanks again for the response. I've enjoyed using RabbitMQ immensely so far.

-Luke Winikates
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/c4d99e9e/attachment.htm>

From elevy at sourcefire.com  Thu May  5 22:33:49 2011
From: elevy at sourcefire.com (Elias Levy)
Date: Thu, 5 May 2011 14:33:49 -0700
Subject: [rabbitmq-discuss] Published message not queued after publish-ok
 received when connection quickly closed
Message-ID: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>

Good day,

While writing some code using the Ruby AMQP gem against RabbitMQ, I've
noticed that if I publish a message and quickly close the connection, even
though I've received a publish-ok response from the server, the message
fails to be queued by the broker.

The code in question looks like:

require 'amqp'
EM.run do
  client   = AMQP.connect(:host => '127.0.0.1')
  channel  = AMQP::Channel.new(client)
  channel.on_error { puts 'channel error'; EM.stop }
  exchange = channel.topic 'foo',:durable => true
  exchange.publish( 'hello world', :routing_key => "some_topic", :persistent
=> true, :nowait => false ) { puts 'publish-ok'; EM.stop }
end

I should clarify that there is a binding in place to route messages with
routing_key "some_topic" to the a queue on the "foo" exchange.

If I remove the EM.stop call in the publish-ok callback, allowing the
connection to exist after the publish, then I the message is queued.

Is this expected behavior?

I would expect that if the broker has responded with a publish-ok, then
regardless of what happens to the connection from that point forward, it
will do its best to deliver that message to a queue.

-- 
*Elias Levy*
Fellow, Technical Research Group
SourceFire
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/c4caa36d/attachment.htm>

From mlong at rozoom.com  Fri May  6 02:40:02 2011
From: mlong at rozoom.com (Matthew Long)
Date: Thu, 5 May 2011 20:40:02 -0500
Subject: [rabbitmq-discuss] Fwd: Management UI plugin issue on 2 node
	cluster
In-Reply-To: <4DBFF8F9.3040800@rabbitmq.com>
References: <86CD90E7-A172-4A09-A73C-282BA2B36644@dwim.org>
	<CB1B0C94-E22D-4831-841B-453016627E6B@dwim.org>
	<4DBFF8F9.3040800@rabbitmq.com>
Message-ID: <BANLkTimGuyqRq16KHRuD4Zcg7FMa8fgwWA@mail.gmail.com>

Hello,

We experienced the exact same issue with rabbitmq crashing with a two node
cluster. But what we found out is that it wasn't the management interface at
all. From our testing it seemed to be that one server was a disk node while
the other was a ram node. After changing the second server to a disk node
all seems to work correctly.

Obviously, the cluster should functioning whether the second node is ram or
disk based. We are going to setup another cluster on EC2 and see if we can
reproduce the results.

Thanks,
Matthew

On Tue, May 3, 2011 at 7:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 26/04/11 23:37, Jos Boumans wrote:
>
>> Hi Matthias & list,
>>
>> fearing this has fallen between the cracks, I'm reposting this;
>> my own investigation hasn't helped me find a resolution yet.
>>
>
> Hi Jos. Thanks for the tarballs.
>
> I still don't understand this. I set up a two node cluster with 2.4.1 on
> Ubuntu with the mgmt and stomp plugins on both nodes, installed the mnesia
> directories from the tarballs, and... the cluster started up fine. Just to
> be absolutely clear - rabbit-a002 does not start up for you with that mnesia
> dir and the mgmt plugin?
>
> So I wonder if you have some different configuration in /etc or something?
> Not that the tarballs showed that.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Matthew Long
CEO - roZoom, Inc
Phone: 773-584-8225
Email: mlong at rozoom.com
*www.rozoom.com*
<http://rozoom.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/6b2842cf/attachment-0001.htm>

From gmr at myyearbook.com  Fri May  6 03:32:26 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 5 May 2011 22:32:26 -0400
Subject: [rabbitmq-discuss] JSON-RPC Channel Plugin
Message-ID: <5B2B3A640BEA4F3E8AABA8BC11B0B88A@myyearbook.com>

The JSON-RPC Channel plugin appears to log to stdout which makes it immune to the "rabbitmqctl rotate_logs" command. As we're using it in production, the startup file is getting pretty large in places. Is this considered a bug? Any suggestions?

An example of what ends up being spit out in the startup log:

debug:: HTTP Channel started, timeout 300
debug:: HTTP Channel timed out, closing.

(picture lots and lots of those)

Regards,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110505/105dfa27/attachment.htm>

From james.anderson at setf.de  Fri May  6 06:22:43 2011
From: james.anderson at setf.de (james anderson)
Date: Fri, 6 May 2011 07:22:43 +0200
Subject: [rabbitmq-discuss] difficulties with prefetch count
In-Reply-To: <BANLkTim4OsCDNZwefpqSGbEBTC7a+tgA2A@mail.gmail.com>
References: <840D5188-98CF-4414-BE74-00AAB0AC764D@setf.de>
	<BANLkTim4OsCDNZwefpqSGbEBTC7a+tgA2A@mail.gmail.com>
Message-ID: <A40D2567-1868-4A7E-9D7D-8451344A8DFA@setf.de>

good morning,

as the sole response to date, below, contradicts the discussion on  
fair dispatch in [3], i rephrase the question.
with this message, i enclose simple client and server implementations  
which can be used to demonstrate the problem.
it is intended to be run with de.setf.amqp[4], but the amqp operation  
sequence is language-independent.

when run with a rmq broker @2.1.1 (that is, the version which we have  
in production), one observes that each time a subscriber delays  
acknowledgment of one message, one additional message is delayed by  
being queued for delivery to that subscriber despite a pending  
unacknowledged message. this although the subscriber has a prefetch  
limit of 1 and the held message appears nowhere in queue lists  
produced by rabbitmqctl.

this can be observed in two combinations.

1. with two clients and two servers.
   a. start a server which runs without delay.
   b. start two clients

one observes, that the server receives and replies to alternating  
messages from each client

   c. start a second server, with a delay

one observes, that first one client and then the second hangs until  
the message to the first client has been acknowledged.


2. with three clients and two servers
   a. start a server which runs without delay.
   b. start three clients.

one observes, that the server receives and replies to alternating  
messages from each client in turn.

   c. start a second server, with delay

one observes,  that first one client and then a second hangs until  
the message to the first client has been acknowledged, but the third  
client's messages are delivered to the non-waiting server without delay.


that is, one gets the distinct impression that rmq does not  
consistently honor the prefetch count constraint.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: fair-allocation-1-1.lisp
Type: application/applefile
Size: 584 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110506/31fdb650/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fair-allocation-1-1.lisp
Type: application/octet-stream
Size: 6981 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110506/31fdb650/attachment.obj>
-------------- next part --------------

-------
[4] https://github.com/lisp/de.setf.amqp






On 2011-05-02, at 14:28 , Allan Kamau wrote:

> On Mon, May 2, 2011 at 3:01 PM, james anderson  
> <james.anderson at setf.de> wrote:
>> good afternoon, gentlemen;
>>
>>
>> we find that a qos request with prefetch count of 1 does not reliably
>> achieve "fair dispatch" and seek advice, what we should  
>> reconfigure in order
>> to achieve it.
>>
>> the specification page[1] indicates that rmq supports local  
>> prefetch limits,
>> but not global ones. the BasicQosDesign[2] wiki entry describes some
>> restrictions, in particular qos/consume ordering. the work queue  
>> tutorial
>> describes how to use prefetch constraints to achieve "fair dispatch".
>>
>> despite adhering to these understandings, we observe the following  
>> with rmq
>> 2.1.1:
>>
>> a server process establishes four worker threads, each of which
>>  - creates a connection to the rmq broker
>>  - creates a shared work queue (most likely redundantly)
>>  - a private sub-task queue for responses to delegated tasks
>>  - creates two channels on its connection;
>>   - one channel is for task messages; there it requests qos 
>> (prefetch=1),
>> consume(work queue).
>>   - one channel is used to delegate tasks; on this one just
>> consume(delegated response queue).
>>  - accepts delivery of task messages, processes them, publishes  
>> results to a
>> task-identified response queue.
>>
>> a front-end process establishes equivalent threads, each of which  
>> supports
>> http requests and mediates them to the server.
>> for each front-end request, a thread
>>  - creates a connection to the rmq server
>>  - creates a task-specific queue (as per routing) for an eventual  
>> response
>>  - subscribes to the response queue
>>  - publishes a task message with routing to the work queue
>>  - accepts delivery of task responses
>>  - tears down the task response subscription and queue.
>>
>> in this particular situation, no delegation occurs. that is, no  
>> messages
>> pass through the delegated work queue.
>>
>> we observe that, if a posted task takes an "long" time, not only its
>> front-end thread will wait until that processing completes, but one
>> additional front-end task hangs was well.
>>
>> while the long task transpires, other http requests are processed  
>> without
>> delay. that is, their setup, request, subscription, delivery, and  
>> tear-down,
>> all complete as normal. their task messages are delivered to one  
>> of the
>> three unoccupied server threads which does the work and produces the
>> response.
>>
>> independent of whether the front-end leaves the hung task to wait  
>> for a
>> response or aborts it, by canceling the subscription, deleting the  
>> queue,
>> and closing the connection, once the long-running server thread  
>> completes
>> its task, the next message delivered to it is that message from the
>> waiting-or-aborted front-end thread.
>>
>> if we use rabbitmqctl to display the connection/subscription/queue  
>> state
>> during the long task processing, we observe that
>> - the work queue has one unacknowledged message, but zero ready  
>> messages
>> - the server task channels have a prefetch window of 1
>> - no connection has a send pending
>>
>> that is, it appears as if one single message is held up until the  
>> long task
>> complete, but is no where to be seen.
>> what do we not understand about prefetch windows?
>>
>> ---------------
>>
>> [1] http://www.rabbitmq.com/specification.html
>> [2] https://dev.rabbitmq.com/wiki/BasicQosDesign
>> [3] http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> I am quite new to RabbitMQ, reading your first line it seem you would
> like the "fair dispatch" or round robin message fetching. This is the
> default behaviour. The prefetch count of 1 does disable this "fair
> dispatch" and lets the jobs be fetched by clients at quickly as they
> can manage to consume them.
>
> Allan.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From james.anderson at setf.de  Fri May  6 07:19:13 2011
From: james.anderson at setf.de (james anderson)
Date: Fri, 6 May 2011 08:19:13 +0200
Subject: [rabbitmq-discuss] difficulties with prefetch count [ps]
In-Reply-To: <A40D2567-1868-4A7E-9D7D-8451344A8DFA@setf.de>
References: <840D5188-98CF-4414-BE74-00AAB0AC764D@setf.de>
	<BANLkTim4OsCDNZwefpqSGbEBTC7a+tgA2A@mail.gmail.com>
	<A40D2567-1868-4A7E-9D7D-8451344A8DFA@setf.de>
Message-ID: <D2319DA7-7159-4EB0-8391-5258F7B89FE3@setf.de>

ps: the 2.1.1 version is that of the instant tests. we have  
experienced the phenomena also with production code with the current  
2.4.1 rmq version, but that's a trifle more context than would be  
appropriate here.

On 2011-05-06, at 07:22 , james anderson wrote:

> good morning,
>
> as the sole response to date, below, contradicts the discussion on  
> fair dispatch in [3], i rephrase the question.
> with this message, i enclose simple client and server  
> implementations which can be used to demonstrate the problem.
> it is intended to be run with de.setf.amqp[4], but the amqp  
> operation sequence is language-independent.
>
> when run with a rmq broker @2.1.1 (that is, the version which we  
> have in production), one observes that each time a subscriber  
> delays acknowledgment of one message, one additional message is  
> delayed by being queued for delivery to that subscriber despite a  
> pending unacknowledged message. this although the subscriber has a  
> prefetch limit of 1 and the held message appears nowhere in queue  
> lists produced by rabbitmqctl.
>
> this can be observed in two combinations.
>
> 1. with two clients and two servers.
>   a. start a server which runs without delay.
>   b. start two clients
>
> one observes, that the server receives and replies to alternating  
> messages from each client
>
>   c. start a second server, with a delay
>
> one observes, that first one client and then the second hangs until  
> the message to the first client has been acknowledged.
>
>
> 2. with three clients and two servers
>   a. start a server which runs without delay.
>   b. start three clients.
>
> one observes, that the server receives and replies to alternating  
> messages from each client in turn.
>
>   c. start a second server, with delay
>
> one observes,  that first one client and then a second hangs until  
> the message to the first client has been acknowledged, but the  
> third client's messages are delivered to the non-waiting server  
> without delay.
>
>
> that is, one gets the distinct impression that rmq does not  
> consistently honor the prefetch count constraint.
>
>
> <fair-allocation-1-1.lisp>
> -------
> [4] https://github.com/lisp/de.setf.amqp
>
>
>
>
>
>
> On 2011-05-02, at 14:28 , Allan Kamau wrote:
>
>> On Mon, May 2, 2011 at 3:01 PM, james anderson  
>> <james.anderson at setf.de> wrote:
>>> good afternoon, gentlemen;
>>>
>>>
>>> we find that a qos request with prefetch count of 1 does not  
>>> reliably
>>> achieve "fair dispatch" and seek advice, what we should  
>>> reconfigure in order
>>> to achieve it.
>>>
>>> the specification page[1] indicates that rmq supports local  
>>> prefetch limits,
>>> but not global ones. the BasicQosDesign[2] wiki entry describes some
>>> restrictions, in particular qos/consume ordering. the work queue  
>>> tutorial
>>> describes how to use prefetch constraints to achieve "fair  
>>> dispatch".
>>>
>>> despite adhering to these understandings, we observe the  
>>> following with rmq
>>> 2.1.1:
>>>
>>> a server process establishes four worker threads, each of which
>>>  - creates a connection to the rmq broker
>>>  - creates a shared work queue (most likely redundantly)
>>>  - a private sub-task queue for responses to delegated tasks
>>>  - creates two channels on its connection;
>>>   - one channel is for task messages; there it requests qos 
>>> (prefetch=1),
>>> consume(work queue).
>>>   - one channel is used to delegate tasks; on this one just
>>> consume(delegated response queue).
>>>  - accepts delivery of task messages, processes them, publishes  
>>> results to a
>>> task-identified response queue.
>>>
>>> a front-end process establishes equivalent threads, each of which  
>>> supports
>>> http requests and mediates them to the server.
>>> for each front-end request, a thread
>>>  - creates a connection to the rmq server
>>>  - creates a task-specific queue (as per routing) for an eventual  
>>> response
>>>  - subscribes to the response queue
>>>  - publishes a task message with routing to the work queue
>>>  - accepts delivery of task responses
>>>  - tears down the task response subscription and queue.
>>>
>>> in this particular situation, no delegation occurs. that is, no  
>>> messages
>>> pass through the delegated work queue.
>>>
>>> we observe that, if a posted task takes an "long" time, not only its
>>> front-end thread will wait until that processing completes, but one
>>> additional front-end task hangs was well.
>>>
>>> while the long task transpires, other http requests are processed  
>>> without
>>> delay. that is, their setup, request, subscription, delivery, and  
>>> tear-down,
>>> all complete as normal. their task messages are delivered to one  
>>> of the
>>> three unoccupied server threads which does the work and produces the
>>> response.
>>>
>>> independent of whether the front-end leaves the hung task to wait  
>>> for a
>>> response or aborts it, by canceling the subscription, deleting  
>>> the queue,
>>> and closing the connection, once the long-running server thread  
>>> completes
>>> its task, the next message delivered to it is that message from the
>>> waiting-or-aborted front-end thread.
>>>
>>> if we use rabbitmqctl to display the connection/subscription/ 
>>> queue state
>>> during the long task processing, we observe that
>>> - the work queue has one unacknowledged message, but zero ready  
>>> messages
>>> - the server task channels have a prefetch window of 1
>>> - no connection has a send pending
>>>
>>> that is, it appears as if one single message is held up until the  
>>> long task
>>> complete, but is no where to be seen.
>>> what do we not understand about prefetch windows?
>>>
>>> ---------------
>>>
>>> [1] http://www.rabbitmq.com/specification.html
>>> [2] https://dev.rabbitmq.com/wiki/BasicQosDesign
>>> [3] http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> I am quite new to RabbitMQ, reading your first line it seem you would
>> like the "fair dispatch" or round robin message fetching. This is the
>> default behaviour. The prefetch count of 1 does disable this "fair
>> dispatch" and lets the jobs be fetched by clients at quickly as they
>> can manage to consume them.
>>
>> Allan.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri May  6 10:43:19 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 May 2011 10:43:19 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
Message-ID: <4DC3C2B7.701@rabbitmq.com>

Hi Elias.

On 05/05/11 22:33, Elias Levy wrote:
> While writing some code using the Ruby AMQP gem against RabbitMQ, I've
> noticed that if I publish a message and quickly close the connection,
> even though I've received a publish-ok response from the server, the
> message fails to be queued by the broker.

I'm not at all familiar with the Ruby client, but I should point out 
that unlike many of the other AMQP methods, basic.publish does not have 
a corresponding basic.publish-ok method; it's always asynchronous. So I 
imagine the post-publish callback fires immediately.

In order to be able to know when the broker has taken responsibility for 
a message you can either wrap the publish in a transaction (when you see 
tx.commit-ok you know the server has the message) or use the rather more 
lightweight publish confirms:

http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/

...but I'm not sure if they are supported by the Ruby gem yet (Jakub, 
can you comment?)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri May  6 10:45:02 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 06 May 2011 10:45:02 +0100
Subject: [rabbitmq-discuss] JSON-RPC Channel Plugin
In-Reply-To: <5B2B3A640BEA4F3E8AABA8BC11B0B88A@myyearbook.com>
References: <5B2B3A640BEA4F3E8AABA8BC11B0B88A@myyearbook.com>
Message-ID: <4DC3C31E.5040202@rabbitmq.com>

On 06/05/11 03:32, Gavin M. Roy wrote:
> The JSON-RPC Channel plugin appears to log to stdout which makes it
> immune to the "rabbitmqctl rotate_logs" command. As we're using it in
> production, the startup file is getting pretty large in places. Is this
> considered a bug? Any suggestions?
>
> An example of what ends up being spit out in the startup log:
>
> debug:: HTTP Channel started, timeout 300
> debug:: HTTP Channel timed out, closing.

Bleh. One quirk of the rabbit_log module is that debug messages are 
always written to stdout. I don't think those should be debug messages - 
I'll raise a bug to fix this.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From david at rabbitmq.com  Fri May  6 12:08:22 2011
From: david at rabbitmq.com (David Wragg)
Date: Fri, 06 May 2011 12:08:22 +0100
Subject: [rabbitmq-discuss] Published message not queued after
	publish-ok received when connection quickly closed
In-Reply-To: <4DC3C2B7.701@rabbitmq.com> (Simon MacMullen's message of "Fri,
	06 May 2011 10:43:19 +0100")
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
Message-ID: <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>

Simon MacMullen <simon at rabbitmq.com> writes:
> On 05/05/11 22:33, Elias Levy wrote:
>> While writing some code using the Ruby AMQP gem against RabbitMQ, I've
>> noticed that if I publish a message and quickly close the connection,
>> even though I've received a publish-ok response from the server, the
>> message fails to be queued by the broker.
>
> I'm not at all familiar with the Ruby client, but I should point out
> that unlike many of the other AMQP methods, basic.publish does not
> have a corresponding basic.publish-ok method; it's always
> asynchronous. So I imagine the post-publish callback fires
> immediately.
>
> In order to be able to know when the broker has taken responsibility
> for a message you can either wrap the publish in a transaction (when
> you see tx.commit-ok you know the server has the message) or use the
> rather more lightweight publish confirms:
o>
> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/

Another way to solve the problem is to do a synchronous AMQP method
rather than abruptly closing the connection.  If this the sync method
completes successfully, you can be sure that your published messages
have reached the broker (it doesn't give you all the guarantees of
transactions, but it is much lighter weight).

An easy way to do this with all versions of the AMQP gem (even 0.6.7) is
to use the AMQP#close callback.  E.g., add something like this to your
code:

  client.close { puts "Closed ok" ; EM.stop }

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From videlalvaro at gmail.com  Fri May  6 14:51:34 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 6 May 2011 15:51:34 +0200
Subject: [rabbitmq-discuss] New Custom Exchagne: Last History
Message-ID: <B331F8BC-59D4-46C7-BF93-778CDD60F8A6@gmail.com>

Hi list,

I created a new custom exchange called Recent History Exchange.

The use case for what I created it is for a Web Chat that I'm implementing. 

Each user has an "anonymous" exclusive/auto delete queue that is bound to a "group-chat" exchange when they join the chat room.

The idea is that the last 20 messages that went through this exchange are kept in Mnesia, so whenever there's a new Binding, that queue will get those messages. This will make a user that joins the chat will get the last messages so he has a context of the conversations.

The exchange is heavily inspired in the Last Value Cache exchange: https://github.com/squaremo/rabbitmq-lvc-plugin

The custom exchange type is: x-recent-history

And here's the code: https://github.com/videlalvaro/rabbitmq-recent-history-exchange

Soon I will open source the webchat application so there will be an example on how to use it.

Cheers,

Alvaro

Sent form my Nokia 1100




From alexis at rabbitmq.com  Fri May  6 15:19:34 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 6 May 2011 15:19:34 +0100
Subject: [rabbitmq-discuss] New Custom Exchagne: Last History
In-Reply-To: <B331F8BC-59D4-46C7-BF93-778CDD60F8A6@gmail.com>
References: <B331F8BC-59D4-46C7-BF93-778CDD60F8A6@gmail.com>
Message-ID: <BANLkTimKVPxz=q-gLFfFD7fCO9Hm5L+Wrw@mail.gmail.com>

very cool!

On Fri, May 6, 2011 at 2:51 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi list,
>
> I created a new custom exchange called Recent History Exchange.
>
> The use case for what I created it is for a Web Chat that I'm implementing.
>
> Each user has an "anonymous" exclusive/auto delete queue that is bound to a "group-chat" exchange when they join the chat room.
>
> The idea is that the last 20 messages that went through this exchange are kept in Mnesia, so whenever there's a new Binding, that queue will get those messages. This will make a user that joins the chat will get the last messages so he has a context of the conversations.
>
> The exchange is heavily inspired in the Last Value Cache exchange: https://github.com/squaremo/rabbitmq-lvc-plugin
>
> The custom exchange type is: x-recent-history
>
> And here's the code: https://github.com/videlalvaro/rabbitmq-recent-history-exchange
>
> Soon I will open source the webchat application so there will be an example on how to use it.
>
> Cheers,
>
> Alvaro
>
> Sent form my Nokia 1100
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mbaffa at opus.com.br  Fri May  6 15:40:48 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Fri, 6 May 2011 11:40:48 -0300
Subject: [rabbitmq-discuss] Best Practices using Connection and Channels
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D5024@srv-opus-02.opus.net>

I am new to RabbitMq and I need to develop an application that will have
something like 30 to 50 concurrent clients. Each client will send
commands to my server. The server applicaton, a .NET C# application,
will start a new thread to execute each command. 

 

I would like to know if you consider a good practice in using AMQP
Connections and Channels:

 

*         1 Connection per application or 1 Connection per Client;

*         1 Channel per Exchange/Queue and/or Thread. If the application
has more than one thread each one must create a new channel using the
same application/client connection. 

*         Some people advise to create a Channel Pools, is it a good
practice. 

 

What do you think about it ???

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110506/6bbacc02/attachment.htm>

From chrisch at ecollege.com  Fri May  6 17:27:40 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Fri, 6 May 2011 16:27:40 +0000
Subject: [rabbitmq-discuss] Problems With OCF Script - Race between start
	and wait
Message-ID: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2F848D@EXMB02OSG.eclg.org>

Hi Everybody.

Doing some testing on 2.4.1 towards upgrading from 2.2, I've noticed an odd behavior when using the OCF scripts to start Rabbit ala the Pacemaker guide.

There seems to be a race condition in the time I call `rabbitmq-server...` and then call `rabbitmqctl -n <host> wait`:  If the erlang node hasn't started up yet, then `rabbitmqctl -n <host> wait` will fail saying the node is down.  This failure causes the OCF process to fail and then falsely report that Rabbit is not running (rabbit still starts up just fine).

I fixed this temporarily on my installation by adding `sleep 2` in the rabbit_start() method of the rabbitmq-server OCF script between the lines where the server is started and the rabbit_wait function is invoked.

Interesting, and this through off the path for a while, the race condition is only lost when I install the management plugin && set mnesia_base to a shared (network-attached) volume.  Just one or the other is not enough to lose the race, but both are.  This might also helps explain why this might not have been seen before.

Anyways...does this seem plausible or am I just watching shadows on a cave wall, as it were?

Thanks!

Chris Chew

From james.anderson at setf.de  Fri May  6 19:42:54 2011
From: james.anderson at setf.de (james anderson)
Date: Fri, 6 May 2011 20:42:54 +0200
Subject: [rabbitmq-discuss] difficulties with prefetch count [reposted]
Message-ID: <934B1801-ECF5-4E10-8DD1-D9B480FED5FA@setf.de>

good evening;

[reposted anew on its own thread]

we find that a qos request with prefetch count of 1 does not reliably  
achieve "fair dispatch" and seek advice, how to achieve it.

the specification page[1] indicates that rmq supports local prefetch  
limits, but not global ones. the BasicQosDesign[2] wiki entry  
describes some restrictions, in particular qos/consume ordering. the  
work queue tutorial describes how to use prefetch constraints to  
achieve "fair dispatch".

despite adhering to these understandings, we observe the following in  
a running application with rmq 2.1.1 and 2.4.1:

a server process establishes four worker threads, each of which
  - creates a connection to the rmq broker
  - creates a shared work queue (which, in this case, remains unused)
  - registers the work queue to a request exchange
  - creates a private queue for responses to delegated requests  
(which, in this case, also remains unused)
  - creates two channels on its connection;
    - one channel is for task messages; there it requests qos 
(prefetch=1), consume(work queue).
    - one channel is used to delegate tasks; on this one it just  
consumed (on the private response queue).
  - accepts delivery of task messages, processes them, publishes  
results to a task-identified response queue.

a front-end process establishes equivalent threads, each of which  
supports http requests and mediates them to the server.
for each front-end request, a thread
  - creates a connection to the rmq server
  - creates a task-specific queue (as per routing) for an eventual  
response
  - subscribes to the response queue
  - publishes a task message to the request exchange with routing to  
the work queue
  - accepts delivery of task responses
  - tears down the task response subscription and queue.

in this particular situation, no delegation occurs. that is, no  
messages pass through the delegated request queue.

we observe that, if a posted task takes an "long" time, not only its  
front-end thread will wait until that processing completes, but one  
additional front-end task hangs as well.

while the long task transpires, other front-end requests are  
processed without delay. that is, their setup, request, subscription,  
delivery, and tear-down, all complete as normal. their task messages  
are delivered to one of the three unoccupied server threads which  
does the work and produces the response.

independent of whether the front-end leaves the hung task to wait for  
a response or aborts it, by canceling the subscription, deleting the  
queue, and closing the connection, once the long-running server  
thread completes its task, the next message delivered to it is that  
message from the waiting-or-aborted front-end thread.

if we use rabbitmqctl to display the connection/subscription/queue  
state during the long task processing, we observe that
- the work queue has one unacknowledged message, but zero ready messages
- the server task channels have a prefetch window of 1
- no connection has a send pending

it appears as if one single message is held up until the long task  
complete, but is no where to be seen. in order to isolate the  
problem, i enclose simple client and server implementations which can  
be used to demonstrate the problem. it is intended to be run with  
de.setf.amqp[4], but the amqp operation sequence is language- 
independent. when run with a rmq broker @2.1.1 (that is, the version  
which we have in production), one observes that each time a  
subscriber delays acknowledgment of one message, one additional  
message is delayed by being queued for delivery to that subscriber  
despite a pending unacknowledged message. this although the  
subscriber has a prefetch limit of 1 and the held message appears  
nowhere in queue lists produced by rabbitmqctl.

this can be observed in two combinations.

1. with two clients and two servers.
   a. start a server which runs without delay.
   b. start two clients

one observes, that the server receives and replies to alternating  
messages from each client

   c. start a second server, with a delay

one observes, that first one client and then the second hangs until  
the message to the first client has been acknowledged.


2. with three clients and two servers
   a. start a server which runs without delay.
   b. start three clients.

one observes, that the server receives and replies to alternating  
messages from each client in turn.

   c. start a second server, with delay

one observes,  that first one client and then a second hangs until  
the message to the first client has been acknowledged, but the third  
client's messages are delivered to the non-waiting server without delay.


that is, one gets the distinct impression that rmq does not  
consistently honor the prefetch count constraint.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fair-allocation-1-1.lisp
Type: application/applefile
Size: 584 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110506/4c9810ea/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fair-allocation-1-1.lisp
Type: application/octet-stream
Size: 6981 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110506/4c9810ea/attachment-0001.obj>
-------------- next part --------------


-------
[1] http://www.rabbitmq.com/specification.html
[2] https://dev.rabbitmq.com/wiki/BasicQosDesign
[3] http://www.rabbitmq.com/tutorials/tutorial-two-python.html
[4] https://github.com/lisp/de.setf.amqp


From jos at dwim.org  Fri May  6 19:47:10 2011
From: jos at dwim.org (Jos Boumans)
Date: Fri, 6 May 2011 11:47:10 -0700
Subject: [rabbitmq-discuss] Fwd: Management UI plugin issue on 2 node
	cluster
In-Reply-To: <4DBFF8F9.3040800@rabbitmq.com>
References: <86CD90E7-A172-4A09-A73C-282BA2B36644@dwim.org>
	<CB1B0C94-E22D-4831-841B-453016627E6B@dwim.org>
	<4DBFF8F9.3040800@rabbitmq.com>
Message-ID: <2CF490B2-43DD-4A9F-86CB-57CA79254FDD@dwim.org>

Hi Simon,

On 3 May 2011, at 05:45, Simon MacMullen wrote:

> On 26/04/11 23:37, Jos Boumans wrote:
>> Hi Matthias & list,
>>
>> fearing this has fallen between the cracks, I'm reposting this;
>> my own investigation hasn't helped me find a resolution yet.
>
> Hi Jos. Thanks for the tarballs.
>
> I still don't understand this. I set up a two node cluster with  
> 2.4.1 on Ubuntu with the mgmt and stomp plugins on both nodes,  
> installed the mnesia directories from the tarballs, and... the  
> cluster started up fine. Just to be absolutely clear - rabbit-a002  
> does not start up for you with that mnesia dir and the mgmt plugin?

Correct; if I move the mgmt plugin (not the client, the ui), out of  
the way, everything starts as expected. I've left the mnesia dir  
completely untouched.

> So I wonder if you have some different configuration in /etc or  
> something? Not that the tarballs showed that.

I'm not sure what else to look for.

The difference I can see between your test and mine is that mine was  
an upgrade from the previous version, with those plugins installed.

Could there be some sort of artifact left behind on the system that is  
affecting this?

Thanks,

-Jos

From videlalvaro at gmail.com  Fri May  6 20:17:48 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 6 May 2011 21:17:48 +0200
Subject: [rabbitmq-discuss] Showcase app - RabbitMQ Web Chat
Message-ID: <75E6174E-5BDF-4BB9-AF2D-340BAC39B66E@gmail.com>

Hi list,

I've just published the Web Chat based on RabbitMQ that I've mentioned earlier here: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-May/012704.html

You can find the code on Github: https://github.com/videlalvaro/rabbitmq-chat

Cheers,

Alvaro

Sent form my Nokia 1100




From michael.s.klishin at gmail.com  Fri May  6 20:22:11 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 6 May 2011 23:22:11 +0400
Subject: [rabbitmq-discuss] Showcase app - RabbitMQ Web Chat
In-Reply-To: <75E6174E-5BDF-4BB9-AF2D-340BAC39B66E@gmail.com>
References: <75E6174E-5BDF-4BB9-AF2D-340BAC39B66E@gmail.com>
Message-ID: <D7A4314239ED4D42BE51BF716FBB3C9E@gmail.com>

Alvaro,

Looks like make doesn't pull down recent history exchange plugin:


=SUPERVISOR REPORT==== 6-May-2011::23:20:40 ===
 Supervisor: {local,rabbitmq_chat_sup}
 Context: start_error
 Reason:  {'EXIT',
 {{shutdown,
{connection_closing,
{server_initiated_close,503,
<<"COMMAND_INVALID - unknown exchange type 'x-recent-history'">>}}},
{gen_server,call,
[<0.66.0>,
 {call,
 {'exchange.declare',0,<<"chat_room">>,
<<"x-recent-history">>,false,true,false,
 false,false,[]},
 none},
 infinity]}}}
 Offender:  [{pid,undefined},
{name,rabbitmq_chat_rest},
{mfargs,{rabbitmq_chat_rest,start_link,[8080]}},
{restart_type,permanent},
{shutdown,5000},
{child_type,worker}]

-- 
MK
On venerd? 6 maggio 2011 at 23.17, Alvaro Videla wrote: 
> Hi list,
> 
> I've just published the Web Chat based on RabbitMQ that I've mentioned earlier here: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-May/012704.html
> 
> You can find the code on Github: https://github.com/videlalvaro/rabbitmq-chat
> 
> Cheers,
> 
> Alvaro
> 
> Sent form my Nokia 1100
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From videlalvaro at gmail.com  Fri May  6 20:25:58 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 6 May 2011 21:25:58 +0200
Subject: [rabbitmq-discuss] Showcase app - RabbitMQ Web Chat
In-Reply-To: <D7A4314239ED4D42BE51BF716FBB3C9E@gmail.com>
References: <75E6174E-5BDF-4BB9-AF2D-340BAC39B66E@gmail.com>
	<D7A4314239ED4D42BE51BF716FBB3C9E@gmail.com>
Message-ID: <741B943F-A5FB-4C8A-ABF2-4AD80D08E4AB@gmail.com>

Michael,

It won't.

You have to install the plugin manually as it says on the README under *Usage*.

I will add a *Requirements* entry to specify that clearly.

Thanks,

-Alvaro

On May 6, 2011, at 9:22 PM, Michael Klishin wrote:

> Alvaro,
> 
> Looks like make doesn't pull down recent history exchange plugin:
> 
> 
> =SUPERVISOR REPORT==== 6-May-2011::23:20:40 ===
> Supervisor: {local,rabbitmq_chat_sup}
> Context: start_error
> Reason:  {'EXIT',
> {{shutdown,
> {connection_closing,
> {server_initiated_close,503,
> <<"COMMAND_INVALID - unknown exchange type 'x-recent-history'">>}}},
> {gen_server,call,
> [<0.66.0>,
> {call,
> {'exchange.declare',0,<<"chat_room">>,
> <<"x-recent-history">>,false,true,false,
> false,false,[]},
> none},
> infinity]}}}
> Offender:  [{pid,undefined},
> {name,rabbitmq_chat_rest},
> {mfargs,{rabbitmq_chat_rest,start_link,[8080]}},
> {restart_type,permanent},
> {shutdown,5000},
> {child_type,worker}]
> 
> -- 
> MK
> On venerd? 6 maggio 2011 at 23.17, Alvaro Videla wrote: 
>> Hi list,
>> 
>> I've just published the Web Chat based on RabbitMQ that I've mentioned earlier here: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-May/012704.html
>> 
>> You can find the code on Github: https://github.com/videlalvaro/rabbitmq-chat
>> 
>> Cheers,
>> 
>> Alvaro
>> 
>> Sent form my Nokia 1100
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 

Sent form my Nokia 1100




From mbaffa at opus.com.br  Fri May  6 20:27:28 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Fri, 6 May 2011 16:27:28 -0300
Subject: [rabbitmq-discuss] Queues Per Client or Per Company
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D5156@srv-opus-02.opus.net>

Hi,

 

I have an application that will send and receive messages to Users
associated with Groups. Each Group is independent will have 5 to 10
users associated.

 

The Users, Client applications, will send commands to the server
application that will execute it and return a response (typical async
RPC). The server application will push to Users and to the Groups
relevant informations.

 

I am thinking about what could be the best architecture:

 

1)      For each User one  Command Queue where the Client applications
will send the commands and one Response Queue where the User will
receive the response sent by the server;

2)      For each User one Information Queue where the Server will push
informations specific to the user;

3)      For each Group one Information Queue where the Server will push
informations specific to the Group. In this case all users of this group
will receive the informations published in this queue;

 

My concern is that if I have 30 groups and 6 users per group I will have
180 users and considering the architecture above I will have 540 queues
(30*3) for Users and 30 queues for the Groups. Does it sound OK or too
much for RabbitMQ.

 

I could have, instead of this, another architecture that could use
topics exchanges. Each user could publish and receive commands and
informations using a topic: group.user. This way I could have this:

 

1)      For each Group one  Command Queue where the Client applications
will send the commands and one Response Queue where the User will
receive the response sent by the server;

2)      For each Group one Information Queue where the Server will push
informations specific to the Group. In this case all users of this group
will receive the informations published in this queue;

 

This will  lead me to 90 Queues (30*3) for Users and 30 Queues for
Groups.

 

Which one is the better ??? 

Thanks in advance

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110506/d145a22f/attachment.htm>

From michael.s.klishin at gmail.com  Fri May  6 20:35:49 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 6 May 2011 23:35:49 +0400
Subject: [rabbitmq-discuss] Showcase app - RabbitMQ Web Chat
In-Reply-To: <741B943F-A5FB-4C8A-ABF2-4AD80D08E4AB@gmail.com>
References: <75E6174E-5BDF-4BB9-AF2D-340BAC39B66E@gmail.com>
	<D7A4314239ED4D42BE51BF716FBB3C9E@gmail.com>
	<741B943F-A5FB-4C8A-ABF2-4AD80D08E4AB@gmail.com>
Message-ID: <EEE763D251404CA8B66F88B9D910D39E@gmail.com>


On venerd? 6 maggio 2011 at 23.25, Alvaro Videla wrote: 
> It won't.

Um, well, but it does pull down everything else ;) 
> 
> You have to install the plugin manually as it says on the README under *Usage*.
> 
> I will add a *Requirements* entry to specify that clearly.
> Ok, deal.

Works fine for me in Safari and Chrome. Very nice.
-- 
MK 

From videlalvaro at gmail.com  Fri May  6 20:37:23 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 6 May 2011 21:37:23 +0200
Subject: [rabbitmq-discuss] Showcase app - RabbitMQ Web Chat
In-Reply-To: <EEE763D251404CA8B66F88B9D910D39E@gmail.com>
References: <75E6174E-5BDF-4BB9-AF2D-340BAC39B66E@gmail.com>
	<D7A4314239ED4D42BE51BF716FBB3C9E@gmail.com>
	<741B943F-A5FB-4C8A-ABF2-4AD80D08E4AB@gmail.com>
	<EEE763D251404CA8B66F88B9D910D39E@gmail.com>
Message-ID: <7E8E3559-81E6-4E71-82BE-430390D6DFC1@gmail.com>

Thanks for testing it! 

At least I know for sure it works in another computer besides mine :D

-Alvaro

On May 6, 2011, at 9:35 PM, Michael Klishin wrote:

> 
> On venerd? 6 maggio 2011 at 23.25, Alvaro Videla wrote: 
>> It won't.
> 
> Um, well, but it does pull down everything else ;) 
>> 
>> You have to install the plugin manually as it says on the README under *Usage*.
>> 
>> I will add a *Requirements* entry to specify that clearly.
>> Ok, deal.
> 
> Works fine for me in Safari and Chrome. Very nice.
> -- 
> MK 

Sent form my Nokia 1100




From michael.s.klishin at gmail.com  Fri May  6 21:01:24 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 7 May 2011 00:01:24 +0400
Subject: [rabbitmq-discuss] Queues Per Client or Per Company
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D5156@srv-opus-02.opus.net>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D5156@srv-opus-02.opus.net>
Message-ID: <DE248E412CB64825B969290725DAF4FA@gmail.com>

A common solution is to use one server-named exclusive queue per client and a well-known, durable queue for the server, then use message-id and reply-to message headers to identify peers and replies.

A few hundred queues is certainly something Rabbit can handle easily. In fact, queues number matters less than number of bindings and message copies that have to be delivered. In your case it sounds like one client request will result in one message being delivered to the server, and one server reply is routed to just one client. Not a big deal.
-- 
MK
On venerd? 6 maggio 2011 at 23.27, Marcus Vinitius Baffa wrote: 
> The Users, Client applications, will send commands to the server application that will execute it and return a response (typical async RPC). The server application will push to Users and to the Groups relevant informations.
> 


From mbaffa at opus.com.br  Fri May  6 21:20:31 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Fri, 6 May 2011 17:20:31 -0300
Subject: [rabbitmq-discuss] Queues Per Client or Per Company
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D51B2@srv-opus-02.opus.net>

Thanks Michael

 

I have posted another question that is related to this one, if you could
advise me I would appreciate. I will copy the question here:

 

I would like to know if you consider a good practice in using AMQP
Connections and Channels:

 

*         1 Connection per application or 1 Connection per Client;

*         1 Channel per Exchange/Queue and/or Thread. If the application
has more than one thread each one must create a new channel using the
same application/client connection. 

*         Some people advise to create a Channel Pools, is it a good
practice. 

 

What do you think about it ???

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110506/dfcc48fe/attachment.htm>

From michael.s.klishin at gmail.com  Fri May  6 21:35:04 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 7 May 2011 00:35:04 +0400
Subject: [rabbitmq-discuss] Queues Per Client or Per Company
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D51B2@srv-opus-02.opus.net>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D51B2@srv-opus-02.opus.net>
Message-ID: <BANLkTik9=qkQQC9qS6QgbCd+yfiqMeNdzg@mail.gmail.com>

Are we talking about the same applications? If so, I think each client and
server can use 1 connection and 1 channel. You definitely can start with
that and switch to more channels in the future if necessary.

2011/5/7 Marcus Vinitius Baffa <mbaffa at opus.com.br>

> Thanks Michael
>
>
>
> I have posted another question that is related to this one, if you could
> advise me I would appreciate. I will copy the question here:
>
>
>
> I would like to know if you consider a good practice in using AMQP
> Connections and Channels:
>
>
>
> ?         1 Connection per application or 1 Connection per Client;
>
> ?         1 Channel per Exchange/Queue and/or Thread. If the application
> has more than one thread each one must create a new channel using the same
> application/client connection.
>
> ?         Some people advise to create a Channel Pools, is it a good
> practice.
>
>
>
> What do you think about it ???
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110507/c9d8628d/attachment.htm>

From michael.s.klishin at gmail.com  Fri May  6 21:50:29 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 7 May 2011 00:50:29 +0400
Subject: [rabbitmq-discuss] Queues Per Client or Per Company
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D51D7@srv-opus-02.opus.net>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D51B2@srv-opus-02.opus.net>
	<0E97FCA172634D2CA806E775989526F5@gmail.com>
	<5EFADC7B94CAF64BAB113AD9DE1ACD200A0D51D7@srv-opus-02.opus.net>
Message-ID: <17CF9643A6BF48F1B30548B31B3DE666@gmail.com>

On sabato 7 maggio 2011 at 00.38, Marcus Vinitius Baffa wrote:
> The server application will start a new thread for each command it receives, and the thread will execute the command and publish in the output queue of the User the response. I believed that I would have to use one channel per thread and that channel would be created by the thread. 
> 
> If the cost of creating channel is high I could create a Channel Pool.

If you are going to use N threads for N clients in the server app, it can use N channels, however, if amount of time it takes to calculate the result is larger than it is to push data down the network, 1 channel can work perfectly fine. In any case, you probably can get 80% of work done with just 1 channel and then switch to N. 

Opening a channel results in a network round trip between your app and AMQP broker but most apps probably can consider this "a lightweight operation". 
-- 
MK 

From videlalvaro at gmail.com  Fri May  6 23:13:17 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 7 May 2011 00:13:17 +0200
Subject: [rabbitmq-discuss] Showcase app - RabbitMQ Web Chat
In-Reply-To: <EEE763D251404CA8B66F88B9D910D39E@gmail.com>
References: <75E6174E-5BDF-4BB9-AF2D-340BAC39B66E@gmail.com>
	<D7A4314239ED4D42BE51BF716FBB3C9E@gmail.com>
	<741B943F-A5FB-4C8A-ABF2-4AD80D08E4AB@gmail.com>
	<EEE763D251404CA8B66F88B9D910D39E@gmail.com>
Message-ID: <D5BE33C3-25BD-418A-81B4-715B03C2E3B1@gmail.com>

Chat is online here for now: http://69.195.198.92:8080/

If someone wants to try/break it :)

On May 6, 2011, at 9:35 PM, Michael Klishin wrote:

> 
> On venerd? 6 maggio 2011 at 23.25, Alvaro Videla wrote: 
>> It won't.
> 
> Um, well, but it does pull down everything else ;) 
>> 
>> You have to install the plugin manually as it says on the README under *Usage*.
>> 
>> I will add a *Requirements* entry to specify that clearly.
>> Ok, deal.
> 
> Works fine for me in Safari and Chrome. Very nice.
> -- 
> MK 

Sent form my Nokia 1100




From alex at kinishi.com  Fri May  6 23:36:40 2011
From: alex at kinishi.com (Alexander Goldstone)
Date: Fri, 6 May 2011 23:36:40 +0100
Subject: [rabbitmq-discuss] STOMP Heartbeat
Message-ID: <7A3ABB35-E4BB-4909-B421-2036593984BE@kinishi.com>


I am running RabbitMQ 2.4.1 with Erlang R13B03 and I have the management and stomp plugins installed.

I have clients connecting via STOMP over GPRS and I have noticed that if the client does not gracefully disconnect from the server then the 'channel' stays open.

The cause seems to be that the mobile network (APN) does not realise that the connection has been closed and so it stays connected to the RabbitMQ server.

The problem with this is that if a message is sent to the remote client and the client does not ACK the message before being non-gracefully disconnected then RabbitMQ does not re-deliver the message to the client the next time it connects to the server.

I assume the mobile network would time-out eventually however I have seen it hold connections for several hours during testing before I give up and restart the RabbitMQ process to kill off the erroneous connections.

I see that the new (version 1.1) STOMP protocol provides a heartbeat feature. Does RabbitMQ support this? My assumption is that RabbitMQ would see that the heartbeat frames had stopped being transmitted by the client and the RabbitMQ server would therefore close the channel even if the mobile network is holding the connection open. Is this correct?

I have not been able to get the heartbeat feature of the STOMP protocol to work however I can see the word "heartbeat" in several locations of the source code implying that it is implemented.

If I sent this to the server:

		CONNECT
		accept-version:1.1
		host:/
		login:guest
		passcode:guest
		prefetch:1
		heart-beat:1,1

Then I receive this:

		CONNECTED
		session:session-lnvfUXmXdtlVdBE7p35KZQ==
		heartbeat:0,0
		version:1.1 

Any feedback as to how I should be using the heartbeat feature of the new STOMP protocol or any other suggestions as to how I solve the underlying problem of channels incorrectly being kept open would be gratefully appreciated.

Regards,

Alex


From alex at kinishi.com  Sat May  7 00:02:54 2011
From: alex at kinishi.com (Alexander Goldstone)
Date: Sat, 7 May 2011 00:02:54 +0100
Subject: [rabbitmq-discuss] Messages Sent Via STOMP Not Surviving Server
	Restart
Message-ID: <B8F980F7-08DB-4A1A-9FDD-AE5B36D0BBC1@kinishi.com>


I am running RabbitMQ 2.4.1 with Erlang R13B03 and I have the management and stomp plugins installed.

I am connecting via telnet to the STOMP port to create a queue and send a message using the following five steps:

STEP 1 - Start the STOMP session using:

		CONNECT
		login:guest
		passcode:guest
		prefetch:1

		^@

STEP 2 - Create a queue using:

		SUBSCRIBE
		destination:/queue/testq
		auto-delete:false
		durable:true

		^@

STEP 3 - Unsubscribe from the queue using:

		UNSUBSCRIBE
		destination:/queue/testq

		^@

STEP 4 - Send a message to the same queue using:

		SEND
		destination:/queue/testq
		delivery-mode:2
		receipt:1

		Test Message Body
		^@

STEP 5 - Disconnect from the STOMP connection using:

		DISCONNECT

		^@

I can see that the message is queued via the management plugin however on restarting the server using 'sudo service rabbitmq-server restart' the queue remains but the message has been lost.

It does not seem to make any difference how long I wait before restarting the server.

Am I doing something obvious wrong? What can I add or change to the above steps to cause messages to persist after a server restart (and therefore hopefully a less graceful server termination)?

Thanks,

Alex

From robert.nicholson at gmail.com  Sat May  7 02:01:00 2011
From: robert.nicholson at gmail.com (Robert Nicholson)
Date: Fri, 6 May 2011 20:01:00 -0500
Subject: [rabbitmq-discuss] Can I acknowledge a message in a separate thread
	to that which received the message?
Message-ID: <0BF62449-A8DA-40A4-AA8C-2879691ACDB0@gmail.com>

Does anybody know if using the Java client I'm allowed to acknowledge a message on a different thread than which picked up the message? 

More generally can I use a channel from a different thread? 

I think I read that you should not use a channel simulatenously across threads?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110506/7f612ce2/attachment.htm>

From matthew at rabbitmq.com  Sat May  7 07:50:52 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 7 May 2011 07:50:52 +0100
Subject: [rabbitmq-discuss] Can I acknowledge a message in a separate
 thread to that which received the message?
In-Reply-To: <0BF62449-A8DA-40A4-AA8C-2879691ACDB0@gmail.com>
References: <0BF62449-A8DA-40A4-AA8C-2879691ACDB0@gmail.com>
Message-ID: <20110507065052.GA12773@rabbitmq.com>

On Fri, May 06, 2011 at 08:01:00PM -0500, Robert Nicholson wrote:
> Does anybody know if using the Java client I'm allowed to acknowledge a message on a different thread than which picked up the message? 

Behaviour is likely undefined in this case.

> More generally can I use a channel from a different thread? 

It's not recommended, as the API guide says -
http://www.rabbitmq.com/api-guide.html#channel-threads

Matthew

From robert at elastica.com  Sat May  7 00:18:08 2011
From: robert at elastica.com (steffi2)
Date: Fri, 6 May 2011 16:18:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Can I acknowledge a message in a separate thread
 to that which received the message?
Message-ID: <31562934.post@talk.nabble.com>


Does anybody know if using the Java client I'm allowed to acknowledge a
message on a different thread than which picked up the message?

More generally can I use a channel from a different thread?

I think I read that you should not use a channel simulatenously across
threads?
-- 
View this message in context: http://old.nabble.com/Can-I-acknowledge-a-message-in-a-separate-thread-to-that-which-received-the-message--tp31562934p31562934.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From ian.ragsdale at gmail.com  Sat May  7 20:02:57 2011
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Sat, 7 May 2011 14:02:57 -0500
Subject: [rabbitmq-discuss] Lightweight query for queues?
In-Reply-To: <4DC14112.4090...@rabbitmq.com>
References: <8CC56202-E3E6-4F31-9A42-0DD59FCA5...@gmail.com>
	<4DC14112.4090...@rabbitmq.com>
Message-ID: <E70D83EB-383D-4755-A9FE-576AC9AA03EE@gmail.com>

On May 4, 2011, at 7:05 AM, Simon MacMullen wrote:

>> One useful thing about that thread was figuring out just how
>> resource-intensive the management plugin is when querying the API for
>> queues.  On my server with around 6000 queues, I can run 'rabbitmqctl
>> list_queues' and get results in a second, but if I query the API for
>> the list of queues it pegs one of the CPUs for upwards of 30 seconds,
>> returning over 8MB of data.
> 
> That seems really wrong. While the management plugin hasn't received much performance tuning it should in theory be capable of being faster than rabbitmqctl in such scenarios, since the management plugin maintains its own statistics database while rabbitmqctl has to go off and talk to each queue individually.
> 
> And indeed, for a trivial test (declare 6k empty queues, time rabbitmqadmin -f raw_json list queues > /dev/null), I get 1.9 seconds on my workstation. That should be improved (preliminary profiling suggests it's spending a lot of time *sorting* the list!), but I'm not sure why you're seeing something so much slower.
> 
> I know this would have been very slow prior to fixing the bug you encountered (due to writing very large error messages in the logs) - sorry if this is patronising but you're definitely seeing the slow response with the fixed version?

It's not patronizing, it always makes sense to double-check your assumptions. I'm pretty positive, when I look at my plugins directory I see the mem-fix version of the management plugin:

root at ip-10-242-73-123:/var/log/rabbitmq# ls /usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins/
amqp_client-2.4.1.ez  rabbitmq-management-2.4.1-mem-fix.ez  rabbitmq-mochiweb-2.4.1.ez  webmachine-2.4.1.ez
mochiweb-2.4.1.ez     rabbitmq-management-agent-2.4.1.ez    README

> 
> Also, if you set force_fine_statistics to false for the rabbit_management_agent application - e.g with a /etc/rabbitmq/rabbitmq.config file like:
> 
> [{rabbit_management_agent, [{force_fine_statistics, false}]}].
> 
> - does it make any difference?

I tried that already and it didn't make any difference.  One big difference between your trivial test and my environment is that I have a few consumers on most of those queues, which adds a heck of a lot of data.

>> So, what I'd like to be able to do is:
>> 
>> 1. Allow specifying which data needs to be returned, so that more
>> expensive statistics can be avoided if necessary. 2. Allow filtering
>> the list of queues to return data for with a search term
> 
> <snip>
> 
>> Is this something you guys would consider?
> 
> Probably not (1) right now, since none of these statistics are supposed to be even slightly expensive, they should all just be hash lookups. (2) is somewhat interesting, probably simpler to implement and more generally useful. But I'd like to find out why you're seeing this run so slowly first.

Yeah, I wouldn't even bother with (1) except for the fact that it's so slow on my system.

Anything else I can do to try to find the cause?

Thanks,
Ian



From gmr at myyearbook.com  Sun May  8 06:19:28 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 8 May 2011 01:19:28 -0400
Subject: [rabbitmq-discuss] RabbitMQ extended specification
Message-ID: <0D3BC780F7A94FC7AEE14D34A9907704@myyearbook.com>


I am building auto-documentation into Pika's codegen and noticed that Connection.Open's capabilities field is listed as deprecated in:

http://www.rabbitmq.com/resources/specs/amqp0-9-1.xml

Any chance the XML doc will be updated with a label and doc node for the field? Also I noticed auto-delete is considered deprecated in both the AMQP 0-9-1 xml doc and the extended spec xml doc. Is this an error or is auto-delete considered an extension of 0-9-1 for RabbitMQ since it's deprecated?

Regards,

Gavin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110508/2d8d21c8/attachment.htm>

From gmr at myyearbook.com  Sun May  8 06:24:58 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 8 May 2011 01:24:58 -0400
Subject: [rabbitmq-discuss] RabbitMQ extended specification
In-Reply-To: <0D3BC780F7A94FC7AEE14D34A9907704@myyearbook.com>
References: <0D3BC780F7A94FC7AEE14D34A9907704@myyearbook.com>
Message-ID: <E98C65ABAE93452CBFCA5EDBF6E1FA11@myyearbook.com>

On Sunday, May 8, 2011 at 1:19 AM, Gavin M. Roy wrote:
Any chance the XML doc will be updated with a label and doc node for the field?
> 
> 
> 

My bad, I went back and realized that the capabilities used in the extension is part of the server-properties and client-properties field.
> Also I noticed auto-delete is considered deprecated in both the AMQP 0-9-1 xml doc and the extended spec xml doc. Is this an error or is auto-delete considered an extension of 0-9-1 for RabbitMQ since it's deprecated?
> 
> 
> 
> 

I am still curious on this question though.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110508/723639fc/attachment.htm>

From matthew at rabbitmq.com  Sun May  8 08:35:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 8 May 2011 08:35:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ extended specification
In-Reply-To: <E98C65ABAE93452CBFCA5EDBF6E1FA11@myyearbook.com>
References: <0D3BC780F7A94FC7AEE14D34A9907704@myyearbook.com>
	<E98C65ABAE93452CBFCA5EDBF6E1FA11@myyearbook.com>
Message-ID: <20110508073556.GA15792@rabbitmq.com>

On Sun, May 08, 2011 at 01:24:58AM -0400, Gavin M. Roy wrote:
> On Sunday, May 8, 2011 at 1:19 AM, Gavin M. Roy wrote:
> Any chance the XML doc will be updated with a label and doc node for the field?

No - the AMQP 0-9-1 WG decided, I believe, rather than to leave field
names alone and deprecate them, decided to rename fields as well, which
is why every method that could take a "ticket" in 0-8, now has a
"reserved" field in 0-9-1.

> My bad, I went back and realized that the capabilities used in the
> extension is part of the server-properties and client-properties
> field.

Yeah - as I explain at
http://www.rabbitmq.com/extensions.html#capabilities, the 0-8
capabilities field was almost unusable, being a shortstr. Adding a
nested table into the client properties and server properties was a
nicer route that doesn't mess with the spec at all because the content
of that table is undefined by the spec.

> > Also I noticed auto-delete is considered deprecated in both the AMQP
> > 0-9-1 xml doc and the extended spec xml doc. Is this an error or is
> > auto-delete considered an extension of 0-9-1 for RabbitMQ since it's
> > deprecated?

Oh, I assume you mean exchange.declare{auto_delete}
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.exchange

Yes indeed. I'll raise a bug to get this fixed.

Matthew

From rabbitmq at o2.pl  Sun May  8 08:48:20 2011
From: rabbitmq at o2.pl (=?UTF-8?Q?rabbitmq?=)
Date: Sun, 08 May 2011 09:48:20 +0200
Subject: [rabbitmq-discuss] =?utf-8?q?Problem_while_one_of_clients_crashes?=
	=?utf-8?q?=2E?=
Message-ID: <2d184cd7.73831287.4dc64ac4.d2ae1@o2.pl>

Hi,

I'm using rabbit version 1.7.1 I've observed a strange behavior.  When i have two consumers (A,B) and one of them (A) is closed unexpectedly (so without closing channel etc - for example forced shutdown) than the server still shows that two clients are connected, and is trying to send message to this terminated client (A).This results in having unacknowledged message in the queue. In most cases after some time this connection is timed out and message is returned to queue and processed by the other client (B). But it also often happens that even though connection is timed out the unacknowledged message still remains and is blocking the other client (B). Other messages are waiting in the queue unconsumed. When new client  (C) is connected to server then all waiting massages are consumed by the new client. So there are two clients again (B,C). Now when the old client (B) is being closed and disconnected from server , this unacknowledged message remains and starts blocking remaining client (C).  Messages are stuck in queue.

What could be the reason of such behavior? Maybe it is a known bug? Maybe some walk-arounds?
I really would appreciate any ideas and solutions.
Thanks in advance. 

Krzysztof.

From matthias at rabbitmq.com  Sun May  8 16:30:19 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 08 May 2011 16:30:19 +0100
Subject: [rabbitmq-discuss]
 =?utf-8?q?rabbitmq-c_+_1=2E6=2E0_=3D_bad_heade?= =?utf-8?q?rs?=
In-Reply-To: <BANLkTimH-Uh+4YNSD7wsUnXtetLtv0jGFg@mail.gmail.com>
References: "<C9DEE614.1D714%pdezwart@rubiconproject.com>"
	<E953179D-E115-461A-98BB-722A4E8244D5@3crowd.com>
	<BANLkTimH-Uh+4YNSD7wsUnXtetLtv0jGFg@mail.gmail.com>
Message-ID: <760c449d5266e857ddd2e24636bc1e57@rabbitmq.com>

Jim Apperly wrote:
> On 28 April 2011 20:51, David Hawthorne <dhawth at 3crowd.com 
> <mailto:dhawth at 3crowd.com>> wrote:
> FWIW, it's not easy to find out what versions of the AMQP spec the
>     various versions of rabbitmq support when digging through the 
> website.
>
> It could be clearer, I know, but you can infer some of that from 
> http://www.rabbitmq.com/changelog.html.

Or take a look at

http://www.rabbitmq.com/specification.html#release-version-mapping

:)

Matthias.



From simone.busoli at gmail.com  Sun May  8 23:29:24 2011
From: simone.busoli at gmail.com (Simone)
Date: Sun, 8 May 2011 15:29:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster, shovel,
 how to accomplish this scenario?
In-Reply-To: <341655.99.1304587149745.JavaMail.geo-discussion-forums@yqmc16>
Message-ID: <20023058.8137.1304893764093.JavaMail.geo-discussion-forums@vbvc21>

Hello, I managed to set up a shovel correctly. I have some doubts about the 
usage scenarios of this feature. Ideally I would like the shovel to be 
transparent to my application, but I realized that since you have to create 
a queue on one side and an exchange on the other side then these two make 
the applications built to use Rabbit somewhat aware of the shovel. 
With that I refer to the input queue of the shovel needding to be bound to 
an exchange, therefore the exchange has to exist and someone has to publish 
messages to it. The same holds true on the other side of the shovel, where 
clients need to bind to the shovel exchange.
All this makes sense and works great, but makes my application aware of the 
exchanges used by the shovel. 

Here's a scenario. My application has some publishers publishing to a topic 
exchange named X and some subscribers with their queues bound to that 
exchange. Setting up a shovel to have the same subscriber clients running on 
both sides of the shovel with no client code changes and no configuration 
changes except for the node url requires that the shovel needs to bind its 
input queue to exchange X and that an equal exchange X is created to the 
other end of the shovel so that clients on either side bind their queues 
their node's X exchange.

This makes the shovel mechanism somewhat aware of my application internals 
(the exchanges it uses) and requires that the same exchanges exist as soon 
as the nodes are started, thus moving (or worse, duplicating) their 
definition in the shovel configuration file. In addition it limits the 
flexibility as a new exchange creation which needs to be "mirrored" on the 
other node requires a change in the configuration of the shovel addin.

As said this works fine, but ideally I would like this mechanism to be 
transparent to the application. I read about the federation addin, which 
from a brief read seems to do exactly this. Any ideas or suggestions?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110508/b7e8660f/attachment.htm>

From james.r.carr at gmail.com  Mon May  9 02:22:54 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 8 May 2011 20:22:54 -0500
Subject: [rabbitmq-discuss] System Exchange Examples?
Message-ID: <BANLkTinptatqMEdjf3Ccgd0G4ZGRhoXUgA@mail.gmail.com>

Are there any examples where the use of a System Exchange would make
sense? So far I cannot seem to think of any and haven't found any
examples online.

Thanks,
James

From simone.busoli at gmail.com  Mon May  9 08:23:52 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 00:23:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster, shovel,
 how to accomplish this scenario?
In-Reply-To: <BANLkTinVkuG49C8-T_b8d=YcZEymVh1=5g@mail.gmail.com>
Message-ID: <33309530.8266.1304925832234.JavaMail.geo-discussion-forums@vbvc21>

That's exactly what I mean, no code at all. Messages published on one node 
would be repeated on the other node without neither the client code nor the 
server needing to know beforehand the name of the exchanges the application 
is going to use.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/6ec0626a/attachment.htm>

From simone.busoli at gmail.com  Mon May  9 08:44:56 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 00:44:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Receive all history routed through exchange
Message-ID: <4985924.8112.1304927096933.JavaMail.geo-discussion-forums@vbji14>

Hello, I am looking for ideas about how to implement this scenario, 
specifically if there are known patterns in RabbitMQ to do it. I am quite 
new to this messaging thing so any advice is appreciated.
When publishing messages to a topic exchange I need all subscribers to 
always have the whole history of the messages published through it. The 
concept sounds similar to a group chat, so that anytime you join you see the 
whole story of the chat (since some moment in the past), regardless 
of whether:

- you were already in when the first message was sent or
- you joined later or
- you join, leave and join

I am wondering if RabbitMQ is suitable to design this scenario or it is a 
typical use case covered by XMPP and thus I am trying to use RabbitMQ for 
something it was not designed for.
BTW I also noticed this recent post<https://groups.google.com/d/topic/rabbitmq-discuss/eTGLy7F0STo/discussion>which sounds interesting: 

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/dd0cbb7c/attachment.htm>

From simone.busoli at gmail.com  Mon May  9 08:51:07 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 00:51:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Best Practices using Connection and Channels
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D5024@srv-opus-02.opus.net>
Message-ID: <5821843.8281.1304927467198.JavaMail.geo-discussion-forums@vbvc21>

Hi Marcus, you can find some info in the Java API guide<http://www.rabbitmq.com/api-guide.html#channel-threads>. 
I am going to use the .NET API soon but I didn't have time to look into the 
code to tell you what pattern is good, hopefully someone else can.
BTW I can tell you what I think would be a good way to use it. If you're 
familiar with NHibernate you know about session factory and session. I think 
that in the same way I would like to design my application so that there is 
a single connection and each thread creates its own channel, thus making the 
connection the mirror of NH session factory and channel the mirror of NH 
session.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/ef3afdd0/attachment.htm>

From simone.busoli at gmail.com  Mon May  9 08:52:45 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 00:52:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster, shovel,
 how to accomplish this scenario?
In-Reply-To: <BANLkTimiKeTcBjKU8nkBTiCg4kg+4kE6Pw@mail.gmail.com>
Message-ID: <28881859.8284.1304927565826.JavaMail.geo-discussion-forums@vbvc21>

Something along the lines, yes. Am I right in thinking that this is 
something related to federation?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/16365341/attachment.htm>

From simone.busoli at gmail.com  Mon May  9 09:58:40 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 01:58:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster, shovel,
 how to accomplish this scenario?
In-Reply-To: <BANLkTi=imudU2uM87bGOtY6yPWgZKmHkpg@mail.gmail.com>
Message-ID: <30483141.8309.1304931520397.JavaMail.geo-discussion-forums@vbjl31>

You're more ore less right. I am just trying to figure out - also look at 
the other thread<https://groups.google.com/d/topic/rabbitmq-discuss/X6CthPL4VTo/discussion>I started - whether RabbitMQ is suited for what I need to do. Thanks for 
your input!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/580fbc58/attachment-0001.htm>

From david at rabbitmq.com  Mon May  9 10:46:14 2011
From: david at rabbitmq.com (David Wragg)
Date: Mon, 09 May 2011 10:46:14 +0100
Subject: [rabbitmq-discuss] System Exchange Examples?
In-Reply-To: <BANLkTinptatqMEdjf3Ccgd0G4ZGRhoXUgA@mail.gmail.com> (James
	Carr's message of "Sun, 8 May 2011 20:22:54 -0500")
References: <BANLkTinptatqMEdjf3Ccgd0G4ZGRhoXUgA@mail.gmail.com>
Message-ID: <yrv4cbozctdeh.fsf@dwragg.eng.vmware.com>

James Carr <james.r.carr at gmail.com> writes:
> Are there any examples where the use of a System Exchange would make
> sense? So far I cannot seem to think of any and haven't found any
> examples online.

RabbitMQ doesn't implement the system exchange type.  From the
description in the spec, it's very unclear what form an implementation
would take.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From simone.busoli at gmail.com  Mon May  9 11:06:36 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 03:06:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Receive all history routed through exchange
In-Reply-To: <8F8FB1F2-4CEC-4F71-B24B-3B520E8C2CD9@gmail.com>
Message-ID: <7003678.8349.1304935596031.JavaMail.geo-discussion-forums@vbjl31>

Thanks Alvaro, the History queue was what I was thinking about already, I 
was just wondering if RabbitMQ had something built-in already, or whether 
what I'm looking for is something that is native in other systems, for 
example Jabber with its group chats.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/23afd166/attachment.htm>

From simone.busoli at gmail.com  Mon May  9 13:44:09 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 05:44:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Best Practices using Connection and Channels
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D5024@srv-opus-02.opus.net>
Message-ID: <23009711.8901.1304945049188.JavaMail.geo-discussion-forums@vbqe26>

Hi Marcus, I was going through the faq and picked up this one:
Can you recommend the best way to work with connections and channels in my 
application?

In general, it is better to create a single connection and as many channels 
as you need (rather than many connections with a single channel each).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/c60ff230/attachment.htm>

From jon at jbrisbin.com  Mon May  9 16:10:19 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 9 May 2011 10:10:19 -0500
Subject: [rabbitmq-discuss] Cluster, shovel,
	how to accomplish this scenario?
In-Reply-To: <20023058.8137.1304893764093.JavaMail.geo-discussion-forums@vbvc21>
References: <20023058.8137.1304893764093.JavaMail.geo-discussion-forums@vbvc21>
Message-ID: <9908E041-081A-41D0-9B7A-1C1BB6E34CD6@jbrisbin.com>

FWIW- I hinted at this in my blog post about the RabbitMQ <-> Riak integration, but I envisioned a scenario just as you've described (one broker/exchange/whatever knows nothing about the other). I think it would be relatively straightforward to extend this to encompass your other problem (the cache exchange...where you get all the messages historically when binding a new queue) as well.

The Riak exchange type will route messages locally (it's an exchange like any other...you set the type-module argument when declaring the exchange to the erlang module to use when routing the message). When the message gets stored in Riak, the commit hook is triggered, which causes that message to be sent to the configured exchange. You can set what broker, exchange, etc... on a per-bucket basis, so your individual messages don't have to know anything about your routing architecture.

https://github.com/jbrisbin/riak-exchange
https://github.com/jbrisbin/riak-rabbitmq-commit-hooks

It would be good to implement something similar but that bypasses an external data store. An exchange type could handle this without forcing the application to know what's going on (you could put broker settings, exchange settings, etc... on the exchange declaration as arguments). It could "echo" the message into that other broker. Such a thing doesn't, as yet, exist. :)


Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin


On May 8, 2011, at 5:29 PM, Simone wrote:

> Hello, I managed to set up a shovel correctly. I have some doubts about the usage scenarios of this feature. Ideally I would like the shovel to be transparent to my application, but I realized that since you have to create a queue on one side and an exchange on the other side then these two make the applications built to use Rabbit somewhat aware of the shovel. 
> With that I refer to the input queue of the shovel needding to be bound to an exchange, therefore the exchange has to exist and someone has to publish messages to it. The same holds true on the other side of the shovel, where clients need to bind to the shovel exchange.
> All this makes sense and works great, but makes my application aware of the exchanges used by the shovel. 
> 
> Here's a scenario. My application has some publishers publishing to a topic exchange named X and some subscribers with their queues bound to that exchange. Setting up a shovel to have the same subscriber clients running on both sides of the shovel with no client code changes and no configuration changes except for the node url requires that the shovel needs to bind its input queue to exchange X and that an equal exchange X is created to the other end of the shovel so that clients on either side bind their queues their node's X exchange.
> 
> This makes the shovel mechanism somewhat aware of my application internals (the exchanges it uses) and requires that the same exchanges exist as soon as the nodes are started, thus moving (or worse, duplicating) their definition in the shovel configuration file. In addition it limits the flexibility as a new exchange creation which needs to be "mirrored" on the other node requires a change in the configuration of the shovel addin.
> 
> As said this works fine, but ideally I would like this mechanism to be transparent to the application. I read about the federation addin, which from a brief read seems to do exactly this. Any ideas or suggestions?
> 
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From gmr at myyearbook.com  Mon May  9 16:12:40 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 9 May 2011 11:12:40 -0400
Subject: [rabbitmq-discuss] how to detect bad username/password in 0.9.5?
In-Reply-To: <8762pp2n3r.fsf@asaph.rhodesmill.org>
References: <8762pp2n3r.fsf@asaph.rhodesmill.org>
Message-ID: <BF526B1D8B404322BB6E6DA40423ED36@myyearbook.com>

In trying to track this down with RabbitMQ 2.4.1 and Pika 0.9.6pre0 I am not seeing any reply back from Rabbit after a Connection.StartOk is sent, the socket just closes.

Is this expected behavior from the broker perspective? I imagine since the connection is never negotiating doing a Connection.Close from the server is not appropriate. Any suggestions on how to raise this as an Exception since it seems to be an implied behavior that broker disconnects if the mechanism or response values are incorrect?

The error logs do show the error as expected.

=ERROR REPORT==== 9-May-2011::11:05:32 ===
exception on TCP connection <0.6098.0> from 127.0.0.1:58311
{channel0_error,starting,
{amqp_error,access_refused,
"PLAIN login refused: user 'gmr' - invalid credentials",
'connection.start_ok'}}

=INFO REPORT==== 9-May-2011::11:05:32 ===
closing TCP connection <0.6098.0> from 127.0.0.1:58311

On Thursday, May 5, 2011 at 11:17 AM, Brandon Craig Rhodes wrote:
When a error occurs while connecting in Pika 0.9.5, I have to go log on
> to my RabbitMQ server and look at its logs to discover what happened -
> the IOLoop in the local program simply returns after three seconds and
> my next piece of code breaks because the `on_open_callback` callback
> that I am passing to my `SelectConnection` never gets called when the
> username and password are wrong.
> 
> How am I supposed to intercept this condition so that I can return an
> error message to my user? I tried registering a callback with the
> `connection.add_on_close_callback()` method but, sensibly enough, it
> never gets called because this is not really a connection-close, but a
> connection not getting established in the first place. I have looked
> around for some sort of a `connection.add_on_error_callback()` or some
> similar sort of facility, but cannot find one.
> 
> How do I catch and handle asynchronous errors?
> 
> Thanks for ANY help that you guys can offer - and thanks, Gavin, for
> writing such an important part of the modern Python ecosystem!
> 
> -- 
> Brandon Craig Rhodes brandon at rhodesmill.org http://rhodesmill.org/brandon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/6b5d21ea/attachment.htm>

From simon at rabbitmq.com  Mon May  9 16:13:06 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 09 May 2011 16:13:06 +0100
Subject: [rabbitmq-discuss] Cluster, shovel,
	how to accomplish this scenario?
In-Reply-To: <9908E041-081A-41D0-9B7A-1C1BB6E34CD6@jbrisbin.com>
References: <20023058.8137.1304893764093.JavaMail.geo-discussion-forums@vbvc21>
	<9908E041-081A-41D0-9B7A-1C1BB6E34CD6@jbrisbin.com>
Message-ID: <4DC80482.6080702@rabbitmq.com>

On 09/05/11 16:10, Jon Brisbin wrote:
> Such a thing doesn't, as yet, exist.

Under development :)

http://hg.rabbitmq.com/rabbitmq-federation/file/default/README

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Mon May  9 16:38:04 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 May 2011 16:38:04 +0100
Subject: [rabbitmq-discuss] how to detect bad username/password in 0.9.5?
In-Reply-To: <BF526B1D8B404322BB6E6DA40423ED36@myyearbook.com>
References: <8762pp2n3r.fsf@asaph.rhodesmill.org>
	<BF526B1D8B404322BB6E6DA40423ED36@myyearbook.com>
Message-ID: <4DC80A5C.70603@rabbitmq.com>

On 09/05/11 16:12, Gavin M. Roy wrote:
> In trying to track this down with RabbitMQ 2.4.1 and Pika 0.9.6pre0 I am
> not seeing any reply back from Rabbit after a Connection.StartOk is
> sent, the socket just closes.
>
> Is this expected behavior from the broker perspective?

Indeed, AMQP says:

"""
There is no hand-shaking for errors on connections that are not fully 
open. [...P]rior to sending or receiving Open or Open-Ok, a peer that 
detects an error MUST close the socket without sending any further data.
"""

The names of exceptions thrown by other RabbitMQ libraries when this 
condition is encountered (e.g. PossibleAuthenticationFailureException) 
aim to provide a hint that incorrect login details are the leading cause 
of problems in this area.


-Emile

From jon at jbrisbin.com  Mon May  9 16:42:50 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 9 May 2011 10:42:50 -0500
Subject: [rabbitmq-discuss] Cluster, shovel,
	how to accomplish this scenario?
In-Reply-To: <4DC80482.6080702@rabbitmq.com>
References: <20023058.8137.1304893764093.JavaMail.geo-discussion-forums@vbvc21>
	<9908E041-081A-41D0-9B7A-1C1BB6E34CD6@jbrisbin.com>
	<4DC80482.6080702@rabbitmq.com>
Message-ID: <AA6036DA-A16E-46B2-8011-CDFFE829CB6B@jbrisbin.com>


On May 9, 2011, at 10:13 AM, Simon MacMullen wrote:

> On 09/05/11 16:10, Jon Brisbin wrote:
>> Such a thing doesn't, as yet, exist.
> 
> Under development :)
> 
> http://hg.rabbitmq.com/rabbitmq-federation/file/default/README
> 

Should have been more specific. Thanks for the clarification. :)


Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From michael.s.klishin at gmail.com  Mon May  9 16:44:25 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 9 May 2011 19:44:25 +0400
Subject: [rabbitmq-discuss] how to detect bad username/password in 0.9.5?
In-Reply-To: <BF526B1D8B404322BB6E6DA40423ED36@myyearbook.com>
References: <8762pp2n3r.fsf@asaph.rhodesmill.org>
	<BF526B1D8B404322BB6E6DA40423ED36@myyearbook.com>
Message-ID: <D57A98E480A24D1A951FF67917BC8FF1@gmail.com>

On luned? 9 maggio 2011 at 19.12, Gavin M. Roy wrote:
> In trying to track this down with RabbitMQ 2.4.1 and Pika 0.9.6pre0 I am not seeing any reply back from Rabbit after a Connection.StartOk is sent, the socket just closes.
> 
> Is this expected behavior from the broker perspective? 
Yes. AMQP 0.9.1 spec dictates that before connection is open, any peer that detects connection-level exception must close TCP connection without sending any more data.

> I imagine since the connection is never negotiating doing a Connection.Close from the server is not appropriate. Any suggestions on how to raise this as an Exception since it seems to be an implied behavior that broker disconnects if the mechanism or response values are incorrect?

Several client libraries keep track of whether authentication was started and finished. If TCP connection is closed and
we are in the "still authenticating" state, they raise an exception that hints at possible authentication failure.

amqp gem and Java client work this way and raise PossibleAuthenticationFailureError and PossibleAuthenticationFailureException, respectively.
-- 
MK



From matthew at rabbitmq.com  Mon May  9 16:47:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 9 May 2011 16:47:34 +0100
Subject: [rabbitmq-discuss] Problems With OCF Script - Race between
 start and wait
In-Reply-To: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2F848D@EXMB02OSG.eclg.org>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2F848D@EXMB02OSG.eclg.org>
Message-ID: <20110509154734.GF32738@rabbitmq.com>

Hi Chris,

On Fri, May 06, 2011 at 04:27:40PM +0000, Chris Chew wrote:
> Doing some testing on 2.4.1 towards upgrading from 2.2, I've noticed an odd behavior when using the OCF scripts to start Rabbit ala the Pacemaker guide.
> 
> There seems to be a race condition in the time I call `rabbitmq-server...` and then call `rabbitmqctl -n <host> wait`:  If the erlang node hasn't started up yet, then `rabbitmqctl -n <host> wait` will fail saying the node is down.  This failure causes the OCF process to fail and then falsely report that Rabbit is not running (rabbit still starts up just fine).
> 
> I fixed this temporarily on my installation by adding `sleep 2` in the rabbit_start() method of the rabbitmq-server OCF script between the lines where the server is started and the rabbit_wait function is invoked.
> 
> Interesting, and this through off the path for a while, the race condition is only lost when I install the management plugin && set mnesia_base to a shared (network-attached) volume.  Just one or the other is not enough to lose the race, but both are.  This might also helps explain why this might not have been seen before.
> 
> Anyways...does this seem plausible or am I just watching shadows on a cave wall, as it were?

Yeah, that does seem rather likely actually, and I'm annoyed I managed
to miss this possibility in the great rewrite of starting rabbit that
happened late last year - the relevant bug was reopened dozens of times
as more and more corrections were found, but it looks like this got
through.

I guess really it needs to look at the pid once the fork has happened
and work off that rather than whether or not the erlang node is
contactable. Sigh, I'll open a bug...

Thanks for the report though.

Matthew

From matthew at rabbitmq.com  Mon May  9 16:54:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 9 May 2011 16:54:34 +0100
Subject: [rabbitmq-discuss] Problems With OCF Script - Race between
 start and wait
In-Reply-To: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2F848D@EXMB02OSG.eclg.org>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2F848D@EXMB02OSG.eclg.org>
Message-ID: <20110509155434.GG32738@rabbitmq.com>

Hi Chris,

On Fri, May 06, 2011 at 04:27:40PM +0000, Chris Chew wrote:
> Doing some testing on 2.4.1 towards upgrading from 2.2, I've noticed an odd behavior when using the OCF scripts to start Rabbit ala the Pacemaker guide.
> 
> There seems to be a race condition in the time I call `rabbitmq-server...` and then call `rabbitmqctl -n <host> wait`:  If the erlang node hasn't started up yet, then `rabbitmqctl -n <host> wait` will fail saying the node is down.  This failure causes the OCF process to fail and then falsely report that Rabbit is not running (rabbit still starts up just fine).
> 
> I fixed this temporarily on my installation by adding `sleep 2` in the rabbit_start() method of the rabbitmq-server OCF script between the lines where the server is started and the rabbit_wait function is invoked.
> 
> Interesting, and this through off the path for a while, the race condition is only lost when I install the management plugin && set mnesia_base to a shared (network-attached) volume.  Just one or the other is not enough to lose the race, but both are.  This might also helps explain why this might not have been seen before.

Having thought about this some more, I'm now puzzled. ctl -n <host> wait
should wait for a minimum of 5 seconds before giving up on the host.
This should be enough time for the rabbit erlang node to start (if not
fully boot). As long as the erlang node is contactable in some form
within 5 seconds then the wait will then wait forever for the erlang
node to fully boot and then report if rabbit's managed to start up ok or
not.

What you're reporting seems to be the inverse: i.e. if the server starts
too quickly then you encounter a problem.

Could you clarify?

Matthew

From alexis at rabbitmq.com  Mon May  9 17:01:36 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 9 May 2011 17:01:36 +0100
Subject: [rabbitmq-discuss] rabbitmq + ejabberd
In-Reply-To: <BANLkTiktKTaHPOqAeZ-JB=k-a95VFk76Zg@mail.gmail.com>
References: <BANLkTiktKTaHPOqAeZ-JB=k-a95VFk76Zg@mail.gmail.com>
Message-ID: <BANLkTiktLvRY2Q0BhHRZ2qJ10WFxADN7SA@mail.gmail.com>

Hi

Were you able to get this working?

alexis


On Sun, Apr 24, 2011 at 8:34 PM, aw4y <mobile at rehacktive.net> wrote:
> hi all,
> i'm a new member of this list, and a new user of rabbitmq.
> so glad to be here.
> i'm trying to integrate rabbitmq with ejabberd, to have client communicating
> throught XMPP and AMQP in the same app.
> I've followed this tutorial:
> http://ndpar.blogspot.com/2010/03/integrating-rabbitmq-with-ejabberd.html
> and of course this:
> http://hg.rabbitmq.com/rabbitmq-xmpp/raw-file/default/doc/index.html
> my problem is when i try to add an exchange JDI with my IM client (i use
> adium on osx): this is the error i see on ejabberd logs:
> =ERROR REPORT==== 2011-04-24 16:17:39 ===
> E(<0.502.0>:mod_rabbitmq:154) : {undef,
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [{rabbit_amqqueue,declare,
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [{resource,<<"/">>,queue,
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? <<"YYY at server.XXXX.com">>},
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?true,false,[]]},
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{rpc,'-handle_call_call/6-fun-0-',5}]}
> when processing: {{jid,"YYY","server.XXX.com",[],"clare",
> ?? ? ? ? ? ? ? ? ? ? ? "server.XXX.com",[]},
> ?? ? ? ? ? ? ? ? ?{jid,"amq.fanout","rabbitmq.server.XXX.com",[],
> ?? ? ? ? ? ? ? ? ? ? ? "amq.fanout","rabbitmq.server.XXX.com",[]},
> ?? ? ? ? ? ? ? ? ?{xmlelement,"presence",
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[{"to",
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?"amq.fanout at rabbitmq.server.XXX.com"},
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {"type","subscribed"}],
> ?? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[]}}
> and i have similar errors if i try to send a message to exchange through
> XMPP (by adium client). Of course i think it depends on error about "adding
> the contact" to IM client.
> have someone tried something like it?
> thanks in advance
> regards
> aw4y
> --
> www.rehacktive.net
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From simone.busoli at gmail.com  Mon May  9 17:09:01 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 09:09:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster, shovel,
 how to accomplish this scenario?
In-Reply-To: <9908E041-081A-41D0-9B7A-1C1BB6E34CD6@jbrisbin.com>
Message-ID: <8683714.9036.1304957341738.JavaMail.geo-discussion-forums@vbbcw2>

Thanks Jon, I'll definitely look into it. It would also be cool to implement 
my own addin in erlang, but I use to work on a different platform and 
anything I would write would not be something I would use in production 
right now.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/5b3632bf/attachment.htm>

From simone.busoli at gmail.com  Mon May  9 17:09:43 2011
From: simone.busoli at gmail.com (Simone)
Date: Mon, 9 May 2011 09:09:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster, shovel,
 how to accomplish this scenario?
In-Reply-To: <4DC80482.6080702@rabbitmq.com>
Message-ID: <9515509.8360.1304957383508.JavaMail.geo-discussion-forums@vbjh33>

I had looked into it already, unfortunately it's not ready yet.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/ba723647/attachment.htm>

From gmr at myyearbook.com  Mon May  9 17:26:55 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 9 May 2011 12:26:55 -0400
Subject: [rabbitmq-discuss] how to detect bad username/password in 0.9.5?
In-Reply-To: <8762pp2n3r.fsf@asaph.rhodesmill.org>
References: <8762pp2n3r.fsf@asaph.rhodesmill.org>
Message-ID: <0EE524E350E246CB907D096EE0F7AC26@myyearbook.com>

Based on the follow-up emails, I'll have an Exception raised when the connection closes after start-ok in 0.9.6.

Gavin

On Thursday, May 5, 2011 at 11:17 AM, Brandon Craig Rhodes wrote:
When a error occurs while connecting in Pika 0.9.5, I have to go log on
> to my RabbitMQ server and look at its logs to discover what happened -
> the IOLoop in the local program simply returns after three seconds and
> my next piece of code breaks because the `on_open_callback` callback
> that I am passing to my `SelectConnection` never gets called when the
> username and password are wrong.
> 
> How am I supposed to intercept this condition so that I can return an
> error message to my user? I tried registering a callback with the
> `connection.add_on_close_callback()` method but, sensibly enough, it
> never gets called because this is not really a connection-close, but a
> connection not getting established in the first place. I have looked
> around for some sort of a `connection.add_on_error_callback()` or some
> similar sort of facility, but cannot find one.
> 
> How do I catch and handle asynchronous errors?
> 
> Thanks for ANY help that you guys can offer - and thanks, Gavin, for
> writing such an important part of the modern Python ecosystem!
> 
> -- 
> Brandon Craig Rhodes brandon at rhodesmill.org http://rhodesmill.org/brandon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/f765b0bb/attachment.htm>

From mbaffa at opus.com.br  Mon May  9 17:42:52 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Mon, 9 May 2011 13:42:52 -0300
Subject: [rabbitmq-discuss] Best Practices using Connection and Channels
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D54B3@srv-opus-02.opus.net>

Thanks Simone,

 

That's what I presumed to be the best solution. One connection opened
when the receiver starts and for each thread that will execute a command
create a channel so that the thread can send the response to the respose
queue.

 

Thank you very much

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/eff89317/attachment-0001.htm>

From Peet.Denny at man.com  Mon May  9 17:44:58 2011
From: Peet.Denny at man.com (Denny, Peet (London)(c))
Date: Mon, 9 May 2011 17:44:58 +0100
Subject: [rabbitmq-discuss] Password Hashing
Message-ID: <A869D3C4CFA0E4459239B0C946F1C9773BB3F008@PLONINEXMS01.maninvestments.ad.man.com>

Hi,

The REST api documentation says that we can create users with a hashed password instead of one in clear text.

An individual user. To PUT a user, you will need a body looking something like this:

... {"password_hash":"2lmoth8l4H0DViLaK9Fxi6l9ds8=", "administrator":true}

This suggests that there is a hashing library somewhere for us to use to acheive this.
Is that the case?



Cheers



Peet


Peet Denny
GPS: Messaging Systems Architect
pdenny at maninvestments.com<mailto:pdenny at maninvestments.com>
Tel +44 20 7144 2564
Mob +44 7709 357 261


[http://www.maninvestments.com/gfx/email/corporate/mi-web-cht-logo-74-79.jpg]
        Man Investments Ltd | Sugar Quay, Lower Thames Street | London EC3R 6DU | England
www.maninvestments.com | A member of the Man Group
Registered in England no. 2921462

The contents of this email are for the named addressee(s) only. It contains information which may be confidential and privileged. If you are not the intended recipient, please notify the sender immediately, destroy this email and any attachments and do not otherwise disclose or use them. Email transmission is not a secure method of communication and Man Investments cannot accept responsibility for the completeness or accuracy of this email or any attachments. Whilst Man Investments makes every effort to keep its network free from viruses, it does not accept responsibility for any computer virus which might be transferred by way of this email or any attachments. This email does not constitute a request, offer, recommendation or solicitation of any kind to buy, subscribe, sell or redeem any investment instruments or to perform other such transactions of any kind. Man Investment s reserves the right to monitor, record and retain all electronic communications through its network to ensure the integrity of its systems, for record keeping and regulatory purposes.

Visit us at: www.maninvestments.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/8c240923/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mi-web-cht-logo-74-79.jpg
Type: image/jpeg
Size: 5047 bytes
Desc: mi-web-cht-logo-74-79.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/8c240923/attachment.jpg>

From michael.s.klishin at gmail.com  Mon May  9 18:02:04 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 9 May 2011 21:02:04 +0400
Subject: [rabbitmq-discuss] how to detect bad username/password in 0.9.5?
In-Reply-To: <0EE524E350E246CB907D096EE0F7AC26@myyearbook.com>
References: <8762pp2n3r.fsf@asaph.rhodesmill.org>
	<0EE524E350E246CB907D096EE0F7AC26@myyearbook.com>
Message-ID: <55A75972592E4F01AA558001E05E97DD@gmail.com>

Gavin,

I see that pika is callbacks-oriented. If so, maybe it can do what amqp gem does: it actually runs an errback when possible authentication failure is detected, but also provides a default callback that raises an exception. This way library user can choose between the two and failure to define the errback is visible. Just a suggestion.

-- 
MK
On luned? 9 maggio 2011 at 20.26, Gavin M. Roy wrote: 
> Based on the follow-up emails, I'll have an Exception raised when the connection closes after start-ok in 0.9.6.
> 


From gmr at myyearbook.com  Mon May  9 18:07:28 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 9 May 2011 13:07:28 -0400
Subject: [rabbitmq-discuss] how to detect bad username/password in 0.9.5?
In-Reply-To: <55A75972592E4F01AA558001E05E97DD@gmail.com>
References: <8762pp2n3r.fsf@asaph.rhodesmill.org>
	<0EE524E350E246CB907D096EE0F7AC26@myyearbook.com>
	<55A75972592E4F01AA558001E05E97DD@gmail.com>
Message-ID: <BANLkTimtUtz16oQXm7mH4jb26V66xdysDA@mail.gmail.com>

On Mon, May 9, 2011 at 1:02 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

> Gavin,
>
> I see that pika is callbacks-oriented. If so, maybe it can do what amqp gem
> does: it actually runs an errback when possible authentication failure is
> detected, but also provides a default callback that raises an exception.
> This way library user can choose between the two and failure to define the
> errback is visible. Just a suggestion.
>

Thanks, that sounds like a good solution. The main issue right now is we
don't start tracking state for callbacks until after the connection is
negotiated and do so based upon frames.  It should be trivial to add the
right kind of errback prior to connection.open-ok, I just want to make sure
I implement it correctly where it comes across as a kludgy after-thought.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/6ac7d43a/attachment.htm>

From chrisch at ecollege.com  Tue May 10 00:23:28 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Mon, 9 May 2011 23:23:28 +0000
Subject: [rabbitmq-discuss] Problems With OCF Script - Race between
 start and wait
In-Reply-To: <20110509155434.GG32738@rabbitmq.com>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2F848D@EXMB02OSG.eclg.org>,
	<20110509155434.GG32738@rabbitmq.com>
Message-ID: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FE22A@EXMB02OSG.eclg.org>

Thanks, Matthew.

It seems like an edge case that would be easy to miss...  I should reiterate that my shared volume is slow.  slooowww, as in 4 MB/sec according to dd.  This is also just a test instance and not a production installation, so the priority is pretty low (except for the case when there is a large amount of data in the queue?).

> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Matthew Sackman [matthew at rabbitmq.com]
> Sent: Monday, May 09, 2011 9:54 AM
> 
> Hi Chris,
> 
> On Fri, May 06, 2011 at 04:27:40PM +0000, Chris Chew wrote:
> > Doing some testing on 2.4.1 towards upgrading from 2.2, I've noticed an odd behavior when using the OCF scripts to start Rabbit ala the Pacemaker guide.
> >
> > There seems to be a race condition in the time I call `rabbitmq-server...` and then call `rabbitmqctl -n <host> wait`:  If the erlang node hasn't started up yet, then `rabbitmqctl -n <host> wait` will fail saying the node is down.  This failure causes the OCF process to fail and then falsely report that Rabbit is not running (rabbit still starts up just fine).
> >
> > I fixed this temporarily on my installation by adding `sleep 2` in the rabbit_start() method of the rabbitmq-server OCF script between the lines where the server is started and the rabbit_wait function is invoked.
> >
> > Interesting, and this through off the path for a while, the race condition is only lost when I install the management plugin && set mnesia_base to a shared (network-attached) volume.  Just one or the other is not enough to lose the race, but both are.  This might also helps explain why this might not have been seen before.
> 
> Having thought about this some more, I'm now puzzled. ctl -n <host> wait
> should wait for a minimum of 5 seconds before giving up on the host.
> This should be enough time for the rabbit erlang node to start (if not
> fully boot). As long as the erlang node is contactable in some form
> within 5 seconds then the wait will then wait forever for the erlang
> node to fully boot and then report if rabbit's managed to start up ok or
> not.
> 
> What you're reporting seems to be the inverse: i.e. if the server starts
> too quickly then you encounter a problem.
> 
> Could you clarify?

Yes, I am seeing that 5 second wait behavior from rabbitmqctl, it's just that apparently 5 seconds is not long enough for the rabbit node to boot when using this shared volume as the mnesia_base.  I'm wondering if the rabbit_start() function should have a "spinner" built in just like the rabbit_stop() function has.

Here's a more detailed description of the behavior I'm seeing:

With a stock 2.4.1 setup, the problem is that crm_mon thinks the rabbit process did not start up, even though it actually has.  The Pacemaker logs look like this:

========================================================================
May  5 16:04:27 sm6nic02 lrmd: [1339]: info: rsc:rabbitmq-service:116: start
May  5 16:04:27 sm6nic02 crmd: [1342]: info: process_lrm_event: LRM operation rabbitmq-ip_monitor_10000 (call=115, rc=0, cib-update=214, confirmed=false) ok
May  5 16:04:32 sm6nic02 rabbitmq-server[30971]: INFO: rabbitmq-server start failed: 7
May  5 16:04:32 sm6nic02 crmd: [1342]: info: process_lrm_event: LRM operation rabbitmq-service_start_0 (call=116, rc=1, cib-update=215, confirmed=true) unknown error
========================================================================

...where the "7" return code on the third line seems to be $OCF_NOT_RUNNING, as returned by the rabbitmqctl_action() function.  However, rabbit does actually get up and fully-functional even though Pacemaker thinks startup failed.

When I modify the rabbitmqctl_action() function to send the output and timestamps to /tmp/log, I can confirm the 5 second delay is occurring inside the `rabbitmqctl -n ... wait` command.  For example, I added two `date` calls and appended them along with the output from the rabbitmqctl call into /tmp/log:

========================================================================
rabbitmqctl_action() {
    ...
    ocf_log info "executing $RABBITMQ_CTL $NODENAME_ARG $action > /dev/null 2> /dev/null"
    echo `date` >> /tmp/log
    $RABBITMQ_CTL $NODENAME_ARG $action >> /tmp/log 2>> /tmp/log
    rc=$?
    echo `date` >> /tmp/log
    ...
========================================================================

...which produces this output in /tmp/log:

========================================================================
Mon May 9 12:49:24 MDT 2011
Status of node rabbit at localhost ...
Error: unable to connect to node rabbit at localhost: nodedown
diagnostics:
- nodes and their ports on localhost: [{rabbitmqctl13264,38158}]
- current node: rabbitmqctl13264 at sm6nic02
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: M+L/i5fJ87oOQ373piDAXQ==
Mon May 9 12:49:25 MDT 2011
Mon May 9 12:49:25 MDT 2011
Waiting for rabbit at localhost ...
Error: unable to connect to node rabbit at localhost: nodedown
diagnostics:
- nodes and their ports on localhost: [{rabbitmqprelaunch13333,36527},
                                       {rabbitmqctl13346,49342}]
- current node: rabbitmqctl13346 at sm6nic02
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: M+L/i5fJ87oOQ373piDAXQ==
Mon May 9 12:49:30 MDT 2011
Mon May 9 12:49:30 MDT 2011
Status of node rabbit at localhost ...
Error: unable to connect to node rabbit at localhost: nodedown
diagnostics:
- nodes and their ports on localhost: [{rabbitmqprelaunch13333,36527},
                                       {rabbitmqctl13447,43772}]
- current node: rabbitmqctl13447 at sm6nic02
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: M+L/i5fJ87oOQ373piDAXQ==
Mon May 9 12:49:30 MDT 2011
========================================================================

...note the 5 second jump in the timestamp between lines 10 and 19 which indicates the 5 second wait inside `rabbitmqctl wait`.


I can "fix" the problem by simply adding a `sleep 2` inside the rabbit_start() function like this:

========================================================================
rabbit_start() {
    ...
    setsid sh -c "$RABBITMQ_SERVER > ${RABBITMQ_LOG_BASE}/startup_log 2> ${RABBITMQ_LOG_BASE}/startup_err" &

    # Wait for the server to come up.
    # Let the CRM/LRM time us out if required
    
    sleep 2  #Chris: Just like Pete Rose, we want rabbitmqctl to lose the race between it and the rabbit-server vm startup...

    rabbit_wait
    ...
========================================================================

...of course the "sleep <arbitrary amount of time>" is not a proper fix.  I noticed the rabbit_stop() function has a "spinner" that waits for rabbit to shut down, deferring to the cluster stack to abort the process upon timeout...does it make sense to add the same type of wait loop for rabbit_start() and push the concern of the timeout into the cluster stack?

Hopefully this helps clarify...and thanks for your time!

-Chris

From mpxr at yahoo.com.au  Tue May 10 02:40:22 2011
From: mpxr at yahoo.com.au (mp)
Date: Mon, 9 May 2011 18:40:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Synchronous Message Response
Message-ID: <343209.79679.qm@web36105.mail.mud.yahoo.com>

Hi,

  I'm struggling with a simple concept of synchronous communication with 
rabbitMQ, in terms of getting a response message back to the client. 


I'm trying to work out how to send it and also what the client will need to do 
to receive the message?

I have an exchange defined, I create a model, and queue, use .Call() and it 
arrives in my "server". FYI syntax below is C#.NET 4.

client side:
model.ExchangeDeclare(ExchangeName, "direct");

var queueName = ch.QueueDeclare(queueId, false, false, false, null);
var client = new SimpleRpcClient(model, queueName)

var replyMessageBytes = client.Call(msgToSend);server side:
//similar setup like client side  
var model = conn.CreateModel() 
model.BasicGet(queueName, false);


ch.BasicAck(msg.DeliveryTag, false);

byte[] response; //... //how do I send a response?
client side:

//what does the client do to retrieve the ACK and RESPONSE. 

I had a search of the mailing list archive and couldn't find a similar question 
 

(Also sorry sent twice, because I sent before confirming my address in mailing 
group, it was in my spam folder),


Thanks &
Regards
-mp
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/4fafb85d/attachment.htm>

From mpxr at yahoo.com.au  Tue May 10 02:37:02 2011
From: mpxr at yahoo.com.au (mp)
Date: Mon, 9 May 2011 18:37:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Synchronous Message Response
Message-ID: <686672.757.qm@web36105.mail.mud.yahoo.com>

Hi,

  I'm struggling with a simple concept of synchronous communication with 
rabbitMQ, in terms of getting a response message back to the client. 


I'm trying to work out how to send it and also what the client will need to do 
to receive the message?

I have an exchange defined, I create a model, and queue, use .Call() and it 
arrives in my "server". FYI syntax below is C#.NET 4.

client side:
  model.ExchangeDeclare(ExchangeName, "direct");

var queueName = ch.QueueDeclare(queueId, false, false, false, null);
var client = new SimpleRpcClient(model, queueName)

var replyMessageBytes = client.Call(msgToSend);server side:
//similar setup like client side   
var model = conn.CreateModel()  
  model.BasicGet(queueName, false);


ch.BasicAck(msg.DeliveryTag, false);

byte[] response; //...  //how do I send a response?
client side:

//what does the client do to retrieve the ACK and RESPONSE.  

I had a search of the mailing list archive and couldn't find a similar question 
 


Thanks &
Regards
-mp
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110509/eb221066/attachment.htm>

From simone.busoli at gmail.com  Tue May 10 10:31:31 2011
From: simone.busoli at gmail.com (Simone)
Date: Tue, 10 May 2011 02:31:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Acks versus Publisher confirms
Message-ID: <22224728.9003.1305019891861.JavaMail.geo-discussion-forums@vbvc21>

Hello, I read about publisher confirms<http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/>to achieve guaranteed delivery but it's not clear to me how it relates to 
acks on the consumer side in a pub-sub scenario.
Specifically, if I need to achieve the strongest delivery warranty what 
should I use?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/e69f4b1b/attachment.htm>

From simone.busoli at gmail.com  Tue May 10 10:42:17 2011
From: simone.busoli at gmail.com (Simone)
Date: Tue, 10 May 2011 02:42:17 -0700 (PDT)
Subject: [rabbitmq-discuss] RPC - handling response in request callback
Message-ID: <31737614.9433.1305020537900.JavaMail.geo-discussion-forums@vbqe26>

Hello, suppose a RCP scenario where a server receives requests from clients, 
performs some operations and the reply back to the client. 
I thought read that it's not a good practice to publish to a channel in the 
same thread/function which is handling a message received from a client. If 
that is so, what is the recommended way to accomplish this scenario?

request -> processing -> reply

Should the server use different channels to handle request and reply phases?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/717bff83/attachment.htm>

From matthew at rabbitmq.com  Tue May 10 10:42:52 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 10 May 2011 10:42:52 +0100
Subject: [rabbitmq-discuss] Acks versus Publisher confirms
In-Reply-To: <22224728.9003.1305019891861.JavaMail.geo-discussion-forums@vbvc21>
References: <22224728.9003.1305019891861.JavaMail.geo-discussion-forums@vbvc21>
Message-ID: <20110510094251.GA21735@rabbitmq.com>

Simone,

Please can you, and anyone else, stop posting directly to
rabbitmq-discuss at googlegroups.com ? If you do so then there seem to be
some cases in which replies only make it to google and do not make it
back to the RabbitMQ-discuss mailing list proper.

Please always just post to rabbitmq-discuss at lists.rabbitmq.com.

On Tue, May 10, 2011 at 02:31:31AM -0700, Simone wrote:
> Hello, I read about publisher
> confirms<http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/>to
> achieve guaranteed delivery but it's not clear to me how it relates to
> acks on the consumer side in a pub-sub scenario.

It does not really relate client side acks.

Publisher confirms, as I've written before, are about the broker (or
something else further downstream) confirming that they've taken
responsibility for the further delivery of the msg, from the publisher.

Once the broker has received the msg, it will confirm it if when it is
able to.

In the case of transient msgs, this is done as soon as the msg reaches a
queue.

In the case of persistent msgs, this is done once the msg has been
written to disk _and_ fsync'd, _or_ consumed-and-acknowledged by a
consumer, whichever happens sooner.

> Specifically, if I need to achieve the strongest delivery warranty what 
> should I use?

Define "strongest delivery warranty".

Matthew

From simone.busoli at gmail.com  Tue May 10 11:01:48 2011
From: simone.busoli at gmail.com (Simone)
Date: Tue, 10 May 2011 03:01:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Acks versus Publisher confirms
In-Reply-To: <20110510094251.GA21735@rabbitmq.com>
Message-ID: <9673128.8763.1305021708674.JavaMail.geo-discussion-forums@vbjh33>

Ok so I get publisher confirms have to do with messages getting from the 
publisher to the broker, while acks concern the link from the broker to the 
consumer, correct?

With strongest delivery warranty I mean to make sure that once a message has 
been published by a publisher it is going to reach all of the consumers 
supposed to be receiving it.

Therefore to achieve this sort of thing without using transactions I have to 
use both publisher confirms and consumer acks, right? Just trying to get a 
better understanding at how this works.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/131a1c50/attachment-0001.htm>

From simon at rabbitmq.com  Tue May 10 11:06:34 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 May 2011 11:06:34 +0100
Subject: [rabbitmq-discuss] Password Hashing
In-Reply-To: <A869D3C4CFA0E4459239B0C946F1C9773BB3F008@PLONINEXMS01.maninvestments.ad.man.com>
References: <A869D3C4CFA0E4459239B0C946F1C9773BB3F008@PLONINEXMS01.maninvestments.ad.man.com>
Message-ID: <4DC90E2A.9020300@rabbitmq.com>

On 09/05/11 17:44, Denny, Peet (London)(c) wrote:
> Hi,
> The REST api documentation says that we can create users with a hashed
> password instead of one in clear text.
> An individual user. To PUT a user, you will need a body looking
> something like this:
>
> ... {"password_hash":"2lmoth8l4H0DViLaK9Fxi6l9ds8=", "administrator":true}
>
> This suggests that there is a hashing library somewhere for us to use to acheive this.
> Is that the case?

Hi Danny. My expectation in writing that documentation was that people 
would use a password hash from a user they'd already done a GET on, or 
set it to "" to lock the account. So there's no library apart from the 
server implementation, starting at 
rabbit_auth_backend_internal:hash_password/1:

http://hg.rabbitmq.com/rabbitmq-server/file/df7aa5d114ae/src/rabbit_auth_backend_internal.erl#l204

However, the algorithm is quite simple if you want to implement it 
yourself. Here's a worked example:

Generate a random 32 bit salt:
CA D5 08 9B

Concatenate that with the UTF-8 representation of the password (in this 
case "simon"):
CA D5 08 9B 73 69 6D 6F 6E

Take the MD5 hash:
CB 37 02 72 AC 5D 08 E9 B6 99 4A 17 2B 5F 57 12

Concatenate the salt again:
CA D5 08 9B CB 37 02 72 AC 5D 08 E9 B6 99 4A 17 2B 5F 57 12

And convert to base64 encoding:
ytUIm8s3AnKsXQjptplKFytfVxI=

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Tue May 10 11:08:43 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 10 May 2011 11:08:43 +0100
Subject: [rabbitmq-discuss] Acks versus Publisher confirms
In-Reply-To: <9673128.8763.1305021708674.JavaMail.geo-discussion-forums@vbjh33>
References: <20110510094251.GA21735@rabbitmq.com>
	<9673128.8763.1305021708674.JavaMail.geo-discussion-forums@vbjh33>
Message-ID: <20110510100842.GB21735@rabbitmq.com>

On Tue, May 10, 2011 at 03:01:48AM -0700, Simone wrote:
> With strongest delivery warranty I mean to make sure that once a message has 
> been published by a publisher it is going to reach all of the consumers 
> supposed to be receiving it.

You can't assert that, because when you publish, you have no way of
asserting which queues the msg can end up in, and even less so which
consumers receive said msg (or when).

The only things you can control is which exchange(s) the msg goes to,
and, if you use the mandatory flag, a notification of whether the msg
made it to any queues or none.

Matthew

From simone.busoli at gmail.com  Tue May 10 11:14:59 2011
From: simone.busoli at gmail.com (Simone)
Date: Tue, 10 May 2011 03:14:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Acks versus Publisher confirms
In-Reply-To: <20110510100842.GB21735@rabbitmq.com>
Message-ID: <575503.8766.1305022499626.JavaMail.geo-discussion-forums@vbjh33>

Thanks Matthew, that makes it clearer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/b703b59b/attachment.htm>

From tim at rabbitmq.com  Tue May 10 11:15:38 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Tue, 10 May 2011 11:15:38 +0100
Subject: [rabbitmq-discuss] Acks versus Publisher confirms
In-Reply-To: <9673128.8763.1305021708674.JavaMail.geo-discussion-forums@vbjh33>
References: <9673128.8763.1305021708674.JavaMail.geo-discussion-forums@vbjh33>
Message-ID: <4DC9104A.2030202@rabbitmq.com>

On 10/05/11 11:01, Simone wrote:
> Ok so I get publisher confirms have to do with messages getting from 
> the publisher to the broker, while acks concern the link from the 
> broker to the consumer, correct?
>
> With strongest delivery warranty I mean to make sure that once a 
> message has been published by a publisher it is going to reach all of 
> the consumers supposed to be receiving it.
>
> Therefore to achieve this sort of thing without using transactions I 
> have to use both publisher confirms and consumer acks, right? Just 
> trying to get a better understanding at how this works.
If you want a "once and only once" QoS, as opposed to a "at least once", 
then you'll need to deal with duplicates.

If you use publisher acks, then, when you receive the publisher ack from 
the broker you know the message has reached the server ok. However, if 
the server crashes, then it's possible the message did reach the server 
ok, but you didn't get the ack back before the server died.

If, on recovery, you resend any messages that you didn't receive 
publisher acks for, there is a possibility of duplicate messages on the 
server.

Similarly with consuming messages, if you ack messages from the consumer 
once they have been consumed, then if the server crashes after a message 
has been consumed but before the ack for that message is processed on 
the server, on recovery of the server the message may be redelivered.

if you build your message consumption logic to be idempotent (i.e. no 
harm comes in processing the same message twice), you can get an 
"effective" once and only once QoS. This may be hard or easy depending 
on your application semantics.
>
> Thanks
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/32219ec3/attachment.htm>

From emile at rabbitmq.com  Tue May 10 11:46:25 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 May 2011 11:46:25 +0100
Subject: [rabbitmq-discuss] difficulties with prefetch count
In-Reply-To: <A40D2567-1868-4A7E-9D7D-8451344A8DFA@setf.de>
References: <840D5188-98CF-4414-BE74-00AAB0AC764D@setf.de>	<BANLkTim4OsCDNZwefpqSGbEBTC7a+tgA2A@mail.gmail.com>
	<A40D2567-1868-4A7E-9D7D-8451344A8DFA@setf.de>
Message-ID: <4DC91781.6040707@rabbitmq.com>

Hi James,

On 06/05/11 06:22, james anderson wrote:
> that is, one gets the distinct impression that rmq does not consistently
> honor the prefetch count constraint.

I'm having difficulty recreating the conditions that trigger the 
problem, without compiling de.setf.amqp .

Would it be possible to run your sample code through the tracer?

( 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.4.1/rabbitmq-java-client-javadoc-2.4.1/com/rabbitmq/tools/Tracer.html 
)


Regards

Emile

From simon at rabbitmq.com  Tue May 10 12:29:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 May 2011 12:29:18 +0100
Subject: [rabbitmq-discuss] Synchronous Message Response
In-Reply-To: <686672.757.qm@web36105.mail.mud.yahoo.com>
References: <686672.757.qm@web36105.mail.mud.yahoo.com>
Message-ID: <4DC9218E.4070507@rabbitmq.com>

On 10/05/11 02:37, mp wrote:
> Hi,
> I'm struggling with a simple concept of synchronous communication with
> rabbitMQ, in terms of getting a response message back to the client.
>
> I'm trying to work out how to send it and also what the client will need
> to do to receive the message?

<snip>

Your client needs to declare a response queue, and the server needs to 
send a reply message to it. The RPC tutorial goes into some detail:

http://www.rabbitmq.com/tutorials/tutorial-six-python.html

(Examples are in python, but should be fairly universal)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Tue May 10 12:33:48 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 May 2011 12:33:48 +0100
Subject: [rabbitmq-discuss] Password Hashing
In-Reply-To: <4DC90E2A.9020300@rabbitmq.com>
References: <A869D3C4CFA0E4459239B0C946F1C9773BB3F008@PLONINEXMS01.maninvestments.ad.man.com>
	<4DC90E2A.9020300@rabbitmq.com>
Message-ID: <4DC9229C.103@rabbitmq.com>

On 10/05/11 11:06, Simon MacMullen wrote:
> On 09/05/11 17:44, Denny, Peet (London)(c) wrote:
>> Hi,
> Hi Danny.

Clearly I can't read. Sorry about that.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simone.busoli at gmail.com  Tue May 10 12:38:01 2011
From: simone.busoli at gmail.com (Simone)
Date: Tue, 10 May 2011 04:38:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Acks versus Publisher confirms
In-Reply-To: <4DC9104A.2030202@rabbitmq.com>
Message-ID: <8320219.9487.1305027481622.JavaMail.geo-discussion-forums@vbqe26>

Thanks for the explanation Tim, this makes a lot of sense.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/a84bc50f/attachment.htm>

From emile at rabbitmq.com  Tue May 10 12:40:42 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 May 2011 12:40:42 +0100
Subject: [rabbitmq-discuss] Synchronous Message Response
In-Reply-To: <343209.79679.qm@web36105.mail.mud.yahoo.com>
References: <343209.79679.qm@web36105.mail.mud.yahoo.com>
Message-ID: <4DC9243A.2060804@rabbitmq.com>

Hi,

On 10/05/11 02:40, mp wrote:
>
> var  client  =  new  SimpleRpcClient(model, queueName)

The first thing to check is whether you need RPC. It is often possible 
and better to design your system in a way that the same client does not 
need the server response immediately.

If you do need RPC then the comments in the SimpleRpcClient and 
SimpleRpcServer classes provide guidance for their use.

> byte[] response;//...
>
> //how do I send a response?

In the server, if the request requires a response then this is provided 
by the return value of the HandleSimpleCall() method. If the message 
requires no response then HandleSimpleCast() is called instead and no 
response is sent.

> client side:
>
> //what does the client do to retrieve the ACK and RESPONSE.

Messages from the server are acknowledged internally in the 
SimpleRpcClient implementation. The server response is available as the 
return value of the Call() method.




-Emile

From emile at rabbitmq.com  Tue May 10 12:59:46 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 May 2011 12:59:46 +0100
Subject: [rabbitmq-discuss] Can I acknowledge a message in a separate
 thread to that which received the message?
In-Reply-To: <31562934.post@talk.nabble.com>
References: <31562934.post@talk.nabble.com>
Message-ID: <4DC928B2.1090908@rabbitmq.com>

Hi Robert,

On 07/05/11 00:18, steffi2 wrote:
>
> Does anybody know if using the Java client I'm allowed to acknowledge a
> message on a different thread than which picked up the message?

Yes it is possible, but only if the threads use the same channel.

> More generally can I use a channel from a different thread?

Yes, but you will need to synchronise access to the channel appropriately.

> I think I read that you should not use a channel simulatenously across
> threads?

Indeed. Avoid this if possible. You risk introducing races and protocol 
framing errors.



-Emile

From mbaffa at opus.com.br  Tue May 10 13:28:51 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Tue, 10 May 2011 09:28:51 -0300
Subject: [rabbitmq-discuss] RabbitMQ and GWT
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D572F@srv-opus-02.opus.net>

Hi All,

 

I need to develop a GWT Web application and I would like to use RabbitMQ
since my services are in C#.

Can I use RabbitMQ Java Client Library with GWT. Have you ever tried
this option ???

 

Thank in advance

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/97f1a0a3/attachment.htm>

From alexis at rabbitmq.com  Tue May 10 13:58:36 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 10 May 2011 13:58:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ and GWT
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D572F@srv-opus-02.opus.net>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D572F@srv-opus-02.opus.net>
Message-ID: <BANLkTikaDc3U1gsF3DSTnCE1mAk5NF89Aw@mail.gmail.com>

On Tue, May 10, 2011 at 1:28 PM, Marcus Vinitius Baffa
<mbaffa at opus.com.br> wrote:
> Hi All,
>
>
>
> I need to develop a GWT Web application and I would like to use RabbitMQ
> since my services are in C#.
>
> Can I use RabbitMQ Java Client Library with GWT. Have you ever tried this
> option ???

It should work.  Have you tried using
http://www.springsource.org/node/2595 and Spring AMQP?


>
>
> Thank in advance
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From mbaffa at opus.com.br  Tue May 10 13:59:51 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Tue, 10 May 2011 09:59:51 -0300
Subject: [rabbitmq-discuss] RabbitMQ and GWT
In-Reply-To: <BANLkTikaDc3U1gsF3DSTnCE1mAk5NF89Aw@mail.gmail.com>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D572F@srv-opus-02.opus.net>
	<BANLkTikaDc3U1gsF3DSTnCE1mAk5NF89Aw@mail.gmail.com>
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A17CB86@srv-opus-02.opus.net>

No I, but I will check it out.

Thanks
 
-----Original Message-----
From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com]
On Behalf Of Alexis Richardson
Sent: Tuesday, May 10, 2011 9:59 AM
To: Marcus Vinitius Baffa
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ and GWT

On Tue, May 10, 2011 at 1:28 PM, Marcus Vinitius Baffa
<mbaffa at opus.com.br> wrote:
> Hi All,
>
>
>
> I need to develop a GWT Web application and I would like to use
RabbitMQ
> since my services are in C#.
>
> Can I use RabbitMQ Java Client Library with GWT. Have you ever tried
this
> option ???

It should work.  Have you tried using
http://www.springsource.org/node/2595 and Spring AMQP?


>
>
> Thank in advance
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From mpxr at yahoo.com.au  Tue May 10 14:05:30 2011
From: mpxr at yahoo.com.au (mp)
Date: Tue, 10 May 2011 06:05:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Synchronous Message Response
In-Reply-To: <4DC9243A.2060804@rabbitmq.com>
References: <343209.79679.qm@web36105.mail.mud.yahoo.com>
	<4DC9243A.2060804@rabbitmq.com>
Message-ID: <661247.32907.qm@web36105.mail.mud.yahoo.com>

Hi Emile,
? Thanks for the info, I actually had extended SimpleRpcServer. I had a simple override for byte[] HandleSimpleCall(...)? that's where I started to experience the issue of the client not behaving synchronously. That's why I started down the path of using BasicGet on the server.
?
Thanks to you clarifying that HandleSimpleCall() is what I should be using I found the bug in how I was modifying the out param 'replyProperties' incorrectly which is why the message was not being delivered.
?
Thanks, what I wanted to achieve here looks to be working now.

-mp
?
From: Emile Joubert <emile at rabbitmq.com>
To: mp <mpxr at yahoo.com.au>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, 10 May 2011 9:40 PM
Subject: Re: [rabbitmq-discuss] Synchronous Message Response

Hi,

On 10/05/11 02:40, mp wrote:
> 
> var? client? =? new? SimpleRpcClient(model, queueName)

The first thing to check is whether you need RPC. It is often possible and better to design your system in a way that the same client does not need the server response immediately.

If you do need RPC then the comments in the SimpleRpcClient and SimpleRpcServer classes provide guidance for their use.

> byte[] response;//...
> 
> //how do I send a response?

In the server, if the request requires a response then this is provided by the return value of the HandleSimpleCall() method. If the message requires no response then HandleSimpleCast() is called instead and no response is sent.

> client side:
> 
> //what does the client do to retrieve the ACK and RESPONSE.

Messages from the server are acknowledged internally in the SimpleRpcClient implementation. The server response is available as the return value of the Call() method.




-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/55d9768c/attachment-0001.htm>

From mpxr at yahoo.com.au  Tue May 10 14:12:57 2011
From: mpxr at yahoo.com.au (mp)
Date: Tue, 10 May 2011 06:12:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Synchronous Message Response
In-Reply-To: <4DC9218E.4070507@rabbitmq.com>
References: <686672.757.qm@web36105.mail.mud.yahoo.com>
	<4DC9218E.4070507@rabbitmq.com>
Message-ID: <387703.33649.qm@web36102.mail.mud.yahoo.com>

Hi Simon,
? Thanks it is a straight forward example.
?
I just made a silly mistake and then went down a long path in the wrong direction to try and solve the problem.
?
Cheers,
-mp

From: Simon MacMullen <simon at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, 10 May 2011 9:29 PM
Subject: Re: [rabbitmq-discuss] Synchronous Message Response

On 10/05/11 02:37, mp wrote:
> Hi,
> I'm struggling with a simple concept of synchronous communication with
> rabbitMQ, in terms of getting a response message back to the client.
> 
> I'm trying to work out how to send it and also what the client will need
> to do to receive the message?

<snip>

Your client needs to declare a response queue, and the server needs to send a reply message to it. The RPC tutorial goes into some detail:

http://www.rabbitmq.com/tutorials/tutorial-six-python.html

(Examples are in python, but should be fairly universal)

Cheers, Simon

-- Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/3c8751a1/attachment.htm>

From mbaffa at opus.com.br  Tue May 10 15:42:09 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Tue, 10 May 2011 11:42:09 -0300
Subject: [rabbitmq-discuss] RabbitMQ and GWT
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D572F@srv-opus-02.opus.net>
	<BANLkTikaDc3U1gsF3DSTnCE1mAk5NF89Aw@mail.gmail.com> 
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A17CC2A@srv-opus-02.opus.net>

I am not an Expert in GWT so excuse me if I am saying something stupid.
But It seems GWT has an JRE Emulator that is very limited, supports only
some packages.

Could it be a problem ???

From alfonso.pantoja at gmail.com  Tue May 10 16:21:18 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Tue, 10 May 2011 08:21:18 -0700 (PDT)
Subject: [rabbitmq-discuss] exchanges properties modification and get
	message count from a queue
Message-ID: <43698378-09c0-4952-aedd-1a96bf8fb1b8@s14g2000vbi.googlegroups.com>

Hi,


I have 2 doubts regarding exchanges and queue properties.

Question 1:

I'd would like to know if there is a way to modify an exchange
properties without delete and re-create it again.
In our case we have existing exchanges with queues binded to them.
Having into account that if a exchange is deleted all its bindings are
deleted too automatically I'm wondering how  exchange arguments can be
modified in order to attach an alternate exchange and without stopping
all publishers (because if there is no exchange messages sent to it
will fail while it does not exist)

Question 2:

Using .NET API is it possible to get the number of messages of a queue
and/or other properties such as binding outing keys, etc.?


Thank you in advance.

Regards,

Alfonso


From matthew at rabbitmq.com  Tue May 10 16:26:59 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 10 May 2011 16:26:59 +0100
Subject: [rabbitmq-discuss] exchanges properties modification and get
 message count from a queue
In-Reply-To: <43698378-09c0-4952-aedd-1a96bf8fb1b8@s14g2000vbi.googlegroups.com>
References: <43698378-09c0-4952-aedd-1a96bf8fb1b8@s14g2000vbi.googlegroups.com>
Message-ID: <20110510152659.GE21735@rabbitmq.com>

On Tue, May 10, 2011 at 08:21:18AM -0700, Alfonso Pantoja wrote:
> I'd would like to know if there is a way to modify an exchange
> properties without delete and re-create it again.

Nope.

> In our case we have existing exchanges with queues binded to them.
> Having into account that if a exchange is deleted all its bindings are
> deleted too automatically I'm wondering how  exchange arguments can be
> modified in order to attach an alternate exchange and without stopping
> all publishers (because if there is no exchange messages sent to it
> will fail while it does not exist)

You can't. You must specify the alternate exchange when you create the
exchange.

> Using .NET API is it possible to get the number of messages of a queue
> and/or other properties such as binding outing keys, etc.?

Msgs in the queue will be available from the result of redeclaring a
queue. It is not possible to find out how many bindings there from an
exchange or to a queue.

Best wishes,

Matthew

From jon at jbrisbin.com  Tue May 10 16:29:02 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 10 May 2011 10:29:02 -0500
Subject: [rabbitmq-discuss] RabbitMQ and GWT
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A17CC2A@srv-opus-02.opus.net>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D572F@srv-opus-02.opus.net>
	<BANLkTikaDc3U1gsF3DSTnCE1mAk5NF89Aw@mail.gmail.com>
	<5EFADC7B94CAF64BAB113AD9DE1ACD200A17CC2A@srv-opus-02.opus.net>
Message-ID: <5E2EAF49-1B23-4DA3-B21F-B17CB8CCB0F7@jbrisbin.com>


On May 10, 2011, at 9:42 AM, Marcus Vinitius Baffa wrote:

> I am not an Expert in GWT so excuse me if I am saying something stupid.
> But It seems GWT has an JRE Emulator that is very limited, supports only
> some packages.
> 
> Could it be a problem ???

Are you trying to run the AMQP client code through the GWT compiler so you have direct, client-side access to a broker?

I'd guess that's not gonna work. :)

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From alfonso.pantoja at gmail.com  Tue May 10 16:33:41 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Tue, 10 May 2011 08:33:41 -0700 (PDT)
Subject: [rabbitmq-discuss] exchanges properties modification and get
	message count from a queue
In-Reply-To: <20110510152659.GE21735@rabbitmq.com>
References: <43698378-09c0-4952-aedd-1a96bf8fb1b8@s14g2000vbi.googlegroups.com>
	<20110510152659.GE21735@rabbitmq.com>
Message-ID: <aa3b7bd6-5321-4b0a-9fe1-4fd0c46928fc@w21g2000yqm.googlegroups.com>

Hi Matthew,


> Msgs in the queue will be available from the result of redeclaring a
> queue. It is not possible to find out how many bindings there from an
> exchange or to a queue.
>
Regarding that...
when redeclaring a queue all bindings depending on it are deleted and
should be created again?




Alfonso

From matthew at rabbitmq.com  Tue May 10 16:36:30 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 10 May 2011 16:36:30 +0100
Subject: [rabbitmq-discuss] exchanges properties modification and get
 message count from a queue
In-Reply-To: <aa3b7bd6-5321-4b0a-9fe1-4fd0c46928fc@w21g2000yqm.googlegroups.com>
References: <43698378-09c0-4952-aedd-1a96bf8fb1b8@s14g2000vbi.googlegroups.com>
	<20110510152659.GE21735@rabbitmq.com>
	<aa3b7bd6-5321-4b0a-9fe1-4fd0c46928fc@w21g2000yqm.googlegroups.com>
Message-ID: <20110510153630.GF21735@rabbitmq.com>

On Tue, May 10, 2011 at 08:33:41AM -0700, Alfonso Pantoja wrote:
> > queue. It is not possible to find out how many bindings there from an
> > exchange or to a queue.
> >
> Regarding that...
> when redeclaring a queue all bindings depending on it are deleted and
> should be created again?

Redeclaring a queue will have no effect at all on the queue, its
contents, or any of the bindings to the queue. Likewise for redeclaring
an exchange.

Matthew

From alfonso.pantoja at gmail.com  Tue May 10 16:55:08 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Tue, 10 May 2011 08:55:08 -0700 (PDT)
Subject: [rabbitmq-discuss] exchanges properties modification and get
	message count from a queue
In-Reply-To: <20110510153630.GF21735@rabbitmq.com>
References: <43698378-09c0-4952-aedd-1a96bf8fb1b8@s14g2000vbi.googlegroups.com>
	<20110510152659.GE21735@rabbitmq.com>
	<aa3b7bd6-5321-4b0a-9fe1-4fd0c46928fc@w21g2000yqm.googlegroups.com>
	<20110510153630.GF21735@rabbitmq.com>
Message-ID: <2f2f7314-80f5-4b1d-8880-0f86905fbb7d@g3g2000vbl.googlegroups.com>




> Redeclaring a queue will have no effect at all on the queue, its
> contents, or any of the bindings to the queue. Likewise for redeclaring
> an exchange.
>

Thank you very much Matthew .

From david.hsu at gmail.com  Tue May 10 17:06:20 2011
From: david.hsu at gmail.com (David Hsu)
Date: Tue, 10 May 2011 09:06:20 -0700
Subject: [rabbitmq-discuss] python fabric stalls when using apt-get to
 install 2.4.1 rabbitmq-server
In-Reply-To: <BANLkTinEDe0RQWhdMSuzRhHuMUbMaap+fQ@mail.gmail.com>
References: <BANLkTim5Ouwsg9Ku-=m3ddUeqYXbPkPOsw@mail.gmail.com>
	<4DAFF4EB.3050403@rabbitmq.com>
	<BANLkTinEDe0RQWhdMSuzRhHuMUbMaap+fQ@mail.gmail.com>
Message-ID: <BANLkTinsOXWOoUsWXLQUvrtgQO+WmnG-yQ@mail.gmail.com>

bump.  Is there a way to apt-get 2.3.1 so i can test why my python fabric is
stalling when installing 2.4.1, but installs fine manually.

thx,
david

On Thu, Apr 21, 2011 at 5:59 PM, David Hsu <david.hsu at gmail.com> wrote:

> Hi Matthias,
>
> When i manually install rabbitmq(instead of using python fabric), it works
> fine with the exact same log message pasted below(also i pasted a portion of
> my fabric script).
>
> I noticed the only difference from when it was working to when it stalls is
> the the version(previously used 2.3.1).  Is there a way i can do "apt-get
> install rabbitmq-server=2.3.1" and see if that works?
>
> thx,
> david
>
> ///FABRIC
>     sudo('cd /etc/apt; echo "deb http://www.rabbitmq.com/debian/ testing
> main" >> sources.list;')
>     sudo('cd /home; wget
> http://www.rabbitmq.com/rabbitmq-signing-key-public.asc;')
>     sudo('cd /home; apt-key add rabbitmq-signing-key-public.asc;')
>     sudo('apt-get update')
>     sudo('apt-get -y upgrade')
>     sudo('apt-get install -y python-setuptools')
>     sudo('easy_install pip')
>     sudo('pip install virtualenv')
>     sudo('apt-get install -y rabbitmq-server') //STALLS AFTER THIS IS
> COMPLETE
>     sudo('apt-get install -y apache2')
> ////
>
> ////////LOG
> out: Setting up unixodbc (2.2.11-21) ...
> out:
> out: Setting up erlang-odbc (1:13.b.3-dfsg-2ubuntu2.1) ...
> out: Setting up erlang-nox (1:13.b.3-dfsg-2ubuntu2.1) ...
> out: Setting up rabbitmq-server (2.4.1-1) ...
> out: Adding group `rabbitmq' (GID 105) ...
> out: Done.
> out: Adding system user `rabbitmq' (UID 103) ...
> out: Adding new user `rabbitmq' (UID 103) with group `rabbitmq' ...
> out: Not creating home directory `/var/lib/rabbitmq'.
> out: Starting rabbitmq-server: SUCCESS
> out: rabbitmq-server.
> out: Processing triggers for libc-bin ...
> out: ldconfig deferred processing now taking place //STALLS HERE with
> PYTHON FABRIC
> ///////////
>
>
>
>
> On Thu, Apr 21, 2011 at 2:12 AM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> David,
>>
>>
>> On 19/04/11 22:21, David Hsu wrote:
>>
>>> Recently when i apt-get install rabbitmq-server with python fabric,
>>> fabric stalls after completion of the installation.  any ideas why?
>>>
>>
>> Does a normal installation of rabbitmq, i.e. just running "sudo apt-get
>> install rabbitmq-server" w/o using python fabric, work ok?
>>
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/399fe1df/attachment.htm>

From simon at rabbitmq.com  Tue May 10 17:08:39 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 May 2011 17:08:39 +0100
Subject: [rabbitmq-discuss] python fabric stalls when using apt-get to
 install 2.4.1 rabbitmq-server
In-Reply-To: <BANLkTinsOXWOoUsWXLQUvrtgQO+WmnG-yQ@mail.gmail.com>
References: <BANLkTim5Ouwsg9Ku-=m3ddUeqYXbPkPOsw@mail.gmail.com>	<4DAFF4EB.3050403@rabbitmq.com>	<BANLkTinEDe0RQWhdMSuzRhHuMUbMaap+fQ@mail.gmail.com>
	<BANLkTinsOXWOoUsWXLQUvrtgQO+WmnG-yQ@mail.gmail.com>
Message-ID: <4DC96307.806@rabbitmq.com>

Our debian repo doesn't keep old versions, but you can manually download 
the deb from

http://www.rabbitmq.com/releases/rabbitmq-server/v2.3.1/

and install it with dpkg.

Cheers, Simon

On 10/05/11 17:06, David Hsu wrote:
> bump.  Is there a way to apt-get 2.3.1 so i can test why my python
> fabric is stalling when installing 2.4.1, but installs fine manually.
>
> thx,
> david
>
> On Thu, Apr 21, 2011 at 5:59 PM, David Hsu <david.hsu at gmail.com
> <mailto:david.hsu at gmail.com>> wrote:
>
>     Hi Matthias,
>
>     When i manually install rabbitmq(instead of using python fabric), it
>     works fine with the exact same log message pasted below(also i
>     pasted a portion of my fabric script).
>
>     I noticed the only difference from when it was working to when it
>     stalls is the the version(previously used 2.3.1).  Is there a way i
>     can do "apt-get install rabbitmq-server=2.3.1" and see if that works?
>
>     thx,
>     david
>
>     ///FABRIC
>          sudo('cd /etc/apt; echo "deb http://www.rabbitmq.com/debian/
>     testing main" >> sources.list;')
>          sudo('cd /home; wget
>     http://www.rabbitmq.com/rabbitmq-signing-key-public.asc;')
>          sudo('cd /home; apt-key add rabbitmq-signing-key-public.asc;')
>          sudo('apt-get update')
>          sudo('apt-get -y upgrade')
>          sudo('apt-get install -y python-setuptools')
>          sudo('easy_install pip')
>          sudo('pip install virtualenv')
>          sudo('apt-get install -y rabbitmq-server') //STALLS AFTER THIS
>     IS COMPLETE
>          sudo('apt-get install -y apache2')
>     ////
>
>     ////////LOG
>     out: Setting up unixodbc (2.2.11-21) ...
>     out:
>     out: Setting up erlang-odbc (1:13.b.3-dfsg-2ubuntu2.1) ...
>     out: Setting up erlang-nox (1:13.b.3-dfsg-2ubuntu2.1) ...
>     out: Setting up rabbitmq-server (2.4.1-1) ...
>     out: Adding group `rabbitmq' (GID 105) ...
>     out: Done.
>     out: Adding system user `rabbitmq' (UID 103) ...
>     out: Adding new user `rabbitmq' (UID 103) with group `rabbitmq' ...
>     out: Not creating home directory `/var/lib/rabbitmq'.
>     out: Starting rabbitmq-server: SUCCESS
>     out: rabbitmq-server.
>     out: Processing triggers for libc-bin ...
>     out: ldconfig deferred processing now taking place //STALLS HERE
>     with PYTHON FABRIC
>     ///////////
>
>
>
>
>     On Thu, Apr 21, 2011 at 2:12 AM, Matthias Radestock
>     <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>
>         David,
>
>
>         On 19/04/11 22:21, David Hsu wrote:
>
>             Recently when i apt-get install rabbitmq-server with python
>             fabric,
>             fabric stalls after completion of the installation.  any
>             ideas why?
>
>
>         Does a normal installation of rabbitmq, i.e. just running "sudo
>         apt-get install rabbitmq-server" w/o using python fabric, work ok?
>
>
>         Matthias.
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From gmr at myyearbook.com  Tue May 10 17:12:11 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 10 May 2011 09:12:11 -0700
Subject: [rabbitmq-discuss] python fabric stalls when using apt-get to
	install 2.4.1 rabbitmq-server
In-Reply-To: <BANLkTinsOXWOoUsWXLQUvrtgQO+WmnG-yQ@mail.gmail.com>
References: <BANLkTim5Ouwsg9Ku-=m3ddUeqYXbPkPOsw@mail.gmail.com>
	<4DAFF4EB.3050403@rabbitmq.com>
	<BANLkTinEDe0RQWhdMSuzRhHuMUbMaap+fQ@mail.gmail.com>
	<BANLkTinsOXWOoUsWXLQUvrtgQO+WmnG-yQ@mail.gmail.com>
Message-ID: <28AAAF5D-63D8-4AE6-A3A0-54F220646131@myyearbook.com>

Your log file looks like rabbitmq installs fine to me. I say this because:

> out: Starting rabbitmq-server: SUCCESS
> out: rabbitmq-server.

The command you run after the rabbitmq install is to install apache2, this looks to be the suspect problem to me.

Regards,

Gavin

On May 10, 2011, at 9:06 AM, David Hsu <david.hsu at gmail.com> wrote:

> bump.  Is there a way to apt-get 2.3.1 so i can test why my python fabric is stalling when installing 2.4.1, but installs fine manually.
> 
> thx,
> david
> 
> On Thu, Apr 21, 2011 at 5:59 PM, David Hsu <david.hsu at gmail.com> wrote:
> Hi Matthias,
> 
> When i manually install rabbitmq(instead of using python fabric), it works fine with the exact same log message pasted below(also i pasted a portion of my fabric script).
> 
> I noticed the only difference from when it was working to when it stalls is the the version(previously used 2.3.1).  Is there a way i can do "apt-get install rabbitmq-server=2.3.1" and see if that works?
> 
> thx,
> david
> 
> ///FABRIC
>     sudo('cd /etc/apt; echo "deb http://www.rabbitmq.com/debian/ testing main" >> sources.list;')
>     sudo('cd /home; wget http://www.rabbitmq.com/rabbitmq-signing-key-public.asc;')
>     sudo('cd /home; apt-key add rabbitmq-signing-key-public.asc;')
>     sudo('apt-get update')
>     sudo('apt-get -y upgrade')
>     sudo('apt-get install -y python-setuptools')
>     sudo('easy_install pip')
>     sudo('pip install virtualenv')
>     sudo('apt-get install -y rabbitmq-server') //STALLS AFTER THIS IS COMPLETE
>     sudo('apt-get install -y apache2')
> ////
> 
> ////////LOG
> out: Setting up unixodbc (2.2.11-21) ...
> out: 
> out: Setting up erlang-odbc (1:13.b.3-dfsg-2ubuntu2.1) ...
> out: Setting up erlang-nox (1:13.b.3-dfsg-2ubuntu2.1) ...
> out: Setting up rabbitmq-server (2.4.1-1) ...
> out: Adding group `rabbitmq' (GID 105) ...
> out: Done.
> out: Adding system user `rabbitmq' (UID 103) ...
> out: Adding new user `rabbitmq' (UID 103) with group `rabbitmq' ...
> out: Not creating home directory `/var/lib/rabbitmq'.
> out: Starting rabbitmq-server: SUCCESS
> out: rabbitmq-server.
> out: Processing triggers for libc-bin ...
> out: ldconfig deferred processing now taking place //STALLS HERE with PYTHON FABRIC
> ///////////
> 
> 
> 
> 
> On Thu, Apr 21, 2011 at 2:12 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:
> David,
> 
> 
> On 19/04/11 22:21, David Hsu wrote:
> Recently when i apt-get install rabbitmq-server with python fabric,
> fabric stalls after completion of the installation.  any ideas why?
> 
> Does a normal installation of rabbitmq, i.e. just running "sudo apt-get install rabbitmq-server" w/o using python fabric, work ok?
> 
> 
> Matthias.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/a5bef950/attachment.htm>

From jon at jbrisbin.com  Tue May 10 17:20:15 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 10 May 2011 11:20:15 -0500
Subject: [rabbitmq-discuss] erlando question
Message-ID: <81C0AD36-B7CF-47B1-81A3-325C2A92F6FE@jbrisbin.com>

Since there's not an Erlando list (that I'm aware of), I thought I'd ask here. I'm trying to digest the new README on github and wondered: is the cut transform kind of like currying?

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From matthew at rabbitmq.com  Tue May 10 17:35:46 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 10 May 2011 17:35:46 +0100
Subject: [rabbitmq-discuss] erlando question
In-Reply-To: <81C0AD36-B7CF-47B1-81A3-325C2A92F6FE@jbrisbin.com>
References: <81C0AD36-B7CF-47B1-81A3-325C2A92F6FE@jbrisbin.com>
Message-ID: <20110510163545.GG21735@rabbitmq.com>

On Tue, May 10, 2011 at 11:20:15AM -0500, Jon Brisbin wrote:
> Since there's not an Erlando list (that I'm aware of)

True. I don't think this is quite the right place for such questions
though - but there's nothing better atm. Whilst I am on erlang-questions
too, I don't really pay it much attention.

If people would like me to set up an erlando mailing list, just email
_me_ directly a "yes", and I'll see what I can do.

>, I thought I'd ask here. I'm trying to digest the new README on github
>and wondered: is the cut transform kind of like currying?

Yes, and it does say that right at the start of the README. Strictly, in
my mind partial application and currying are two different things.

(Sorry, I have to drop into Haskell here, otherwise the difference is
less clear.) Partial application is when you do

 f = (+) 5

and thus end up with f :: (Num a) => a -> a

The key thing is that you're partially applying the arguments in the
order that the occur specified by the function.

Currying, however, is the relationship between a function that takes,
say, 2 arguments, and a function that takes 1 argument which is a tuple
of 2 elements. So in Haskell, we have:

curry :: ((a, b) -> c) -> a -> b -> c

I.e. give it a function that takes a tuple, and it'll make it look like
a function that takes 2 args; and the opposite, uncurry:

uncurry :: (a -> b -> c) -> (a, b) -> c

I.e. give it a function that takes 2 args, and it'll make it look like a
function that takes a tuple.

In languages where parenthesis are required to distinguish between
functions and their arguments (i.e. not Haskell), this all looks a bit
messier.

Most people use currying and partial application interchangably.

Cuts are similar but actually a little more powerful as they allow you
to create holes _before_ known arguments rather than just after. E.g.

 F = wibble(_, 12, _),

which you can't do with partial application, as you can only partially
apply args left to right.

Matthew

From mbaffa at opus.com.br  Tue May 10 17:41:20 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Tue, 10 May 2011 13:41:20 -0300
Subject: [rabbitmq-discuss] RabbitMQ and GWT
In-Reply-To: <5E2EAF49-1B23-4DA3-B21F-B17CB8CCB0F7@jbrisbin.com>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D572F@srv-opus-02.opus.net>
	<BANLkTikaDc3U1gsF3DSTnCE1mAk5NF89Aw@mail.gmail.com>
	<5EFADC7B94CAF64BAB113AD9DE1ACD200A17CC2A@srv-opus-02.opus.net>
	<5E2EAF49-1B23-4DA3-B21F-B17CB8CCB0F7@jbrisbin.com>
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A17CCB3@srv-opus-02.opus.net>

I have read some additional articles and because of the limited support
of some packages I Agree it will not work.

Thanks

-----Original Message-----
From: Jon Brisbin [mailto:jon at jbrisbin.com] 
Sent: Tuesday, May 10, 2011 12:29 PM
To: Marcus Vinitius Baffa
Cc: Alexis Richardson; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ and GWT


On May 10, 2011, at 9:42 AM, Marcus Vinitius Baffa wrote:

> I am not an Expert in GWT so excuse me if I am saying something
stupid.
> But It seems GWT has an JRE Emulator that is very limited, supports
only
> some packages.
> 
> Could it be a problem ???

Are you trying to run the AMQP client code through the GWT compiler so
you have direct, client-side access to a broker?

I'd guess that's not gonna work. :)

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From matthew at rabbitmq.com  Tue May 10 17:42:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 10 May 2011 17:42:39 +0100
Subject: [rabbitmq-discuss] erlando question
In-Reply-To: <20110510163545.GG21735@rabbitmq.com>
References: <81C0AD36-B7CF-47B1-81A3-325C2A92F6FE@jbrisbin.com>
	<20110510163545.GG21735@rabbitmq.com>
Message-ID: <20110510164238.GH21735@rabbitmq.com>

On Tue, May 10, 2011 at 05:35:46PM +0100, Matthew Sackman wrote:
> Most people use currying and partial application interchangably.

It's also worth noting that Haskell B. Curry did not invent currying,
nor did he ever claim credit for it. It first appeared in "?ber die
Bausteine der mathematischen Logik" by Moses Sch?nfinkel in 1924.

http://en.wikipedia.org/wiki/Currying

Matthew

From denny.swindle at gmail.com  Tue May 10 19:37:39 2011
From: denny.swindle at gmail.com (Denny Swindle)
Date: Tue, 10 May 2011 14:37:39 -0400
Subject: [rabbitmq-discuss] Ack'ing messages
Message-ID: <CDBDE5E3-3C4D-4BED-AB1F-9EC244B4A2DC@gmail.com>

I'm trying to understand the CORRECT way of handling messages that cannot be processed, for some reason.  

I have two consumers listening for messages (in a worker queue setup, as described here: http://www.rabbitmq.com/tutorials/tutorial-two-python.html).

Scenario A:
A message is received and processed, then it's ack'd using basic_ack.

Scenario B:
A message is received and processed, but an error occurs.  An error like my consumer loses connection to the DB.  In this case, I don't issue a basic_ack (and my consumer remains running).

In looking at the docs, I understand if a message is not acknowledged and the consumer dies, rabbit will requeue the message for redelivery.  But what if the consumer remains running (and I just can't process the message).  Should I not issue the basic_ack (will it get sent to another consumer)?  Or should I issue the basic_ack and then reject the message?

I'm asking because earlier today I noticed I had an "unacknowledged" message on my queue.   With the unacknowledged message on the queue, only one worker consumer was receiving all messages.  

[root at web2 tmp]# rabbitmqctl list_queues -p / messages messages_unacknowledged messages_ready
Listing queues ...
1	1	0
0	0	0
0	0	0
0	0	0

The other worker was in a 'stale' state and not receiving any messages.  I'm just trying to understand if my logic on not ack'ing a message is correct and if that's how i ended up with an unacknowledged message.  Also trying to understand why my worker just stopped receiving messages.

Any guidance would be appreciated!

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/e394da77/attachment.htm>

From videlalvaro at gmail.com  Tue May 10 22:28:41 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 10 May 2011 23:28:41 +0200
Subject: [rabbitmq-discuss] Yet Another Custom Exchange
Message-ID: <EE812349-ECF2-44BF-A084-416CAB0CBAFC@gmail.com>

Hi List,

Due to a request from @michaelklishin or antares_ at #rabbitmq on freenode, I've created this exchange which just broadcast a message to every queue declared on the broker no matter the vhost?

https://github.com/videlalvaro/rabbitmq-global-fanout-exchange

I don't know if this is useful? he must explain why he needs *such* thing. The only use that comes to my mind is to use it as a way of broadcasting "control" messages to all the consumers. Like configuration changes, or "quit all", etc.

Still? don't kill your brokers with this. It was created for fun in 30 minutes?

Cheers,

Alvaro

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/67effc7c/attachment.htm>

From michael.s.klishin at gmail.com  Tue May 10 22:38:24 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 May 2011 01:38:24 +0400
Subject: [rabbitmq-discuss] Yet Another Custom Exchange
In-Reply-To: <EE812349-ECF2-44BF-A084-416CAB0CBAFC@gmail.com>
References: <EE812349-ECF2-44BF-A084-416CAB0CBAFC@gmail.com>
Message-ID: <C75E374296124C04A9996834712CA273@gmail.com>

My use case is this: when you have a bunch of producers and consumers, and routing doesn't work the way you want it to, this kind of exchange can help validate consumers first (supposedly carefully designed consumers log messages they don't know how to handle and possible log messages they did process).

So I only consider this useful for development/QA purposes, and only some of the time. But hey, it took less than 30 minutes :)

Kudos to Alvaro for helping me our with this. My Erlang skills are n00bish at best.

-- 
MK
On mercoled? 11 maggio 2011 at 01.28, Alvaro Videla wrote: 
> I don't know if this is useful? he must explain why he needs *such* thing. The only use that comes to my mind is to use it as a way of broadcasting "control" messages to all the consumers. Like configuration changes, or "quit all", etc.
> 


From chris at phatboyg.com  Tue May 10 22:29:11 2011
From: chris at phatboyg.com (Chris Patterson)
Date: Tue, 10 May 2011 14:29:11 -0700 (PDT)
Subject: [rabbitmq-discuss] ExchangeUnbind Fails with .NET RabbitMQ.Client
Message-ID: <93269de0-1f5e-4845-9dcc-1bcd46888bca@l6g2000vbn.googlegroups.com>

First, I'm running 2.4.1 on Windows and testing using the .NET
RabbitMQ Client.

Here is the code I'm testing to verify the behavior:

	[When]
	public void An_exchange_is_bound_to_a_queue()
	{
		Model.ExchangeDeclare("TheSource", ExchangeType.Fanout, true, true,
null);
		Model.ExchangeDeclare("TheDestination", ExchangeType.Fanout, true,
true, null);
		Model.QueueDeclare("TheQueue", true, true, true, null);
		Model.QueueBind("TheQueue", "TheDestination", "");

		Model.ExchangeBind("TheDestination", "TheSource", "");
	}

	[Then]
	public void Should_be_able_to_unbind_the_exchanges()
	{
		Model.ExchangeUnbind("TheDestination", "TheSource", "");
	}

The error message displayed is:

RabbitMQ.Client.Exceptions.OperationInterruptedException : The AMQP
operation was interrupted: AMQP close-reason, initiated by Library,
code=540, text="The Class or Method <40.51> is unknown", classId=0,
methodId=0, cause=RabbitMQ.Client.Impl.UnknownClassOrMethodException:
The Class or Method <40.51> is unknown
   at
RabbitMQ.Client.Framing.v0_9_1.Protocol.DecodeMethodFrom(NetworkBinaryReader
reader)
   at RabbitMQ.Client.Impl.CommandAssembler.HandleFrame(Frame f)
   at RabbitMQ.Client.Impl.Session.HandleFrame(Frame frame)
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()<40.51>
	at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply()
	at RabbitMQ.Client.Impl.ModelBase.ModelRpc(MethodBase method,
ContentHeaderBase header, Byte[] body)
	at
RabbitMQ.Client.Framing.Impl.v0_9_1.Model._Private_ExchangeUnbind(String
destination, String source, String routingKey, Boolean nowait,
IDictionary arguments)
	at RabbitMQ.Client.Impl.ModelBase.ExchangeUnbind(String destination,
String source, String routingKey)

This seems like a protocol version issue to me in talking with the
server (and ExchangeUnbind does seem to be a RabbitMQ specific method)
but I'm curious how I can enable this method in the protocol so I can
call it?

From gmr at myyearbook.com  Tue May 10 22:50:57 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 10 May 2011 23:50:57 +0200
Subject: [rabbitmq-discuss] Yet Another Custom Exchange
In-Reply-To: <C75E374296124C04A9996834712CA273@gmail.com>
References: <EE812349-ECF2-44BF-A084-416CAB0CBAFC@gmail.com>
	<C75E374296124C04A9996834712CA273@gmail.com>
Message-ID: <BANLkTi=Xix0SwtjiT_5AQMK635y6MwJnHg@mail.gmail.com>

On Tue, May 10, 2011 at 11:38 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> My use case is this: when you have a bunch of producers and consumers, and
> routing doesn't work the way you want it to, this kind of exchange can help
> validate consumers first (supposedly carefully designed consumers log
> messages they don't know how to handle and possible log messages they did
> process).
>

It is an interesting exchange, but why would you not just bind those
consumers with a basic_consume on a "control" topic exchange that is
separated from the actual message flow?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/75904375/attachment.htm>

From michael.s.klishin at gmail.com  Tue May 10 23:18:14 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 May 2011 02:18:14 +0400
Subject: [rabbitmq-discuss] Yet Another Custom Exchange
In-Reply-To: <BANLkTi=Xix0SwtjiT_5AQMK635y6MwJnHg@mail.gmail.com>
References: <EE812349-ECF2-44BF-A084-416CAB0CBAFC@gmail.com>
	<C75E374296124C04A9996834712CA273@gmail.com>
	<BANLkTi=Xix0SwtjiT_5AQMK635y6MwJnHg@mail.gmail.com>
Message-ID: <D49D3860C4704CE4B708ED3F9F2D5857@gmail.com>

On mercoled? 11 maggio 2011 at 01.50, Gavin M. Roy wrote:
It is an interesting exchange, but why would you not just bind those consumers with a basic_consume on a "control" topic exchange that is separated from the actual message flow?
> 
One reason may be that you don't want to modify/restart running consumers or write/deploy scripts (that will take care of binding all the queues to a freshly declared fanout exchange) in a haste.

At this point it is just an idea that Alvaro took time to implement. We will see how it can be used and abused ;)
-- 
MK 

From alain.dazzi at gmail.com  Wed May 11 00:44:52 2011
From: alain.dazzi at gmail.com (Alain Dazzi)
Date: Tue, 10 May 2011 16:44:52 -0700
Subject: [rabbitmq-discuss] mnesia tables
Message-ID: <BANLkTikuZ_Huhj7F32Fiqm8jV8uFihbVBA@mail.gmail.com>

Hi,

I was wondering if anyone had a procedure to connect to running rabbitmq
node and
 read/extract mnesia records using erlang. For the lack of such tool, I use
grep to try to find stuck
messages in the various queues (cd /var/lib/rabbitmq/mnesia/...node.../ and
grep one of the queues).

Something like ... which seems to only show the schema table.

adazzi at cumulonimbus:~$ erl name node
Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:8:8] [rq:8]
[async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
1> mnesia:start().
ok
2> mnesia:change_config (extra_db_nodes, [ 'node at cumlonimbus.dev.foo.com'
]).
{ok,[]}
3> mnesia:info().
---> Processes holding locks <---
---> Processes waiting for locks <---
---> Participant transactions <---
---> Coordinator transactions <---
---> Uncertain transactions <---
---> Active tables <---
schema         : with 1        records occupying 424      words of mem
===> System info in version "4.4.12", debug level = none <===
opt_disc. Directory "/home/adazzi/Mnesia.nonode at nohost" is NOT used.
use fallback at restart = false
running db nodes   = [nonode at nohost]
stopped db nodes   = []
master node tables = []
remote             = []
ram_copies         = [schema]
disc_copies        = []
disc_only_copies   = []
[{nonode at nohost,ram_copies}] = [schema]
3 transactions committed, 0 aborted, 0 restarted, 0 logged to disc
0 held locks, 0 in queue; 0 local transactions, 0 remote
0 transactions waits for other nodes: []
ok
4>

Thanks!

-A
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/63daeb14/attachment.htm>

From simone.busoli at gmail.com  Wed May 11 02:02:05 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 11 May 2011 03:02:05 +0200
Subject: [rabbitmq-discuss] .NET client for management plugin API
Message-ID: <BANLkTikdy8_QB8+cMTyk0ciR-N-o5J1F+g@mail.gmail.com>

Hello, as it's going to be useful to me for administrative tasks and
automated tests while learning RabbitMQ I am building a client for invoking
the management plugin API from a .NET client. It uses dynamic objects to
deal with generic json objects returned by the API and thus requires .NET
4.0. http://code.google.com/p/mexexp/source/browse/trunk/RabbitMQ/Resbit/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110511/e58ab5f5/attachment.htm>

From michael.s.klishin at gmail.com  Wed May 11 02:57:12 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 May 2011 05:57:12 +0400
Subject: [rabbitmq-discuss] (yet another) STOMP plugin example
Message-ID: <892A9D48AA434436AD21C88E636C3EFA@gmail.com>

A person had an issue with the STOMP plugin on the IRC and I had never used it before, so I put together an example that proves STOMP plugin works as long as you take care of authentication ;)

It's up on Github: http://bit.ly/irNqOR

I hope this help someone looking for STOMP plugin example some day.
-- 
MK




From cpclark at cloudeventprocessing.com  Wed May 11 03:24:10 2011
From: cpclark at cloudeventprocessing.com (Colin Clark)
Date: Tue, 10 May 2011 21:24:10 -0500
Subject: [rabbitmq-discuss] installation on rh5.5
Message-ID: <33e69f906627938876902860693ebd09@mail.gmail.com>

I?m trying to install the 2.4.1 server on redhat 5.5



I?ve installed the latest erlang source (downloaded and compiled) and that
works just fine.



But when I go to install the rpm:



Rpm ?I rabb?.



I get a dependency error on r12b-5.



How can I overcome this?   I?ve tried to force the install, but that wont
work either.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110510/b6017529/attachment-0001.htm>

From alexis at rabbitmq.com  Wed May 11 07:03:10 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 11 May 2011 07:03:10 +0100
Subject: [rabbitmq-discuss] installation on rh5.5
In-Reply-To: <33e69f906627938876902860693ebd09@mail.gmail.com>
References: <33e69f906627938876902860693ebd09@mail.gmail.com>
Message-ID: <BANLkTi=GsqwEDpX6Fpe=kgJWTX6SsykzVQ@mail.gmail.com>

Colin

On the RPM section of our server downloads page it says this:
--
Note to users of RHEL 5 and derived distributions (e.g. CentOS 5): Due
to the EPEL package update policy, EPEL 5 contains Erlang version
R12B-5, which is relatively old. rabbitmq-server supports R12B-5, but
performance may be lower than for more recent Erlang versions, and
certain non-core features are not supported (SSL support, HTTP-based
plugins). Therefore, we recommend that you install the most recent
stable version of Erlang. The easiest way to do this is to use a
package repository provided for this purpose by the owner of the EPEL
Erlang package. Enable it by invoking (as root):

wget -O /etc/yum.repos.d/epel-erlang.repo
http://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo
and then install or update erlang with yum install erlang.
--

Let us know if this works.  Also, let us know how to make it easier
for people to find this info on the web site!

alexis



On Wed, May 11, 2011 at 3:24 AM, Colin Clark
<cpclark at cloudeventprocessing.com> wrote:
> I?m trying to install the 2.4.1 server on redhat 5.5
>
>
>
> I?ve installed the latest erlang source (downloaded and compiled) and that
> works just fine.
>
>
>
> But when I go to install the rpm:
>
>
>
> Rpm ?I rabb?.
>
>
>
> I get a dependency error on r12b-5.
>
>
>
> How can I overcome this? ??I?ve tried to force the install, but that wont
> work either.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From emile at rabbitmq.com  Wed May 11 10:51:18 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 May 2011 10:51:18 +0100
Subject: [rabbitmq-discuss] ExchangeUnbind Fails with .NET
	RabbitMQ.Client
In-Reply-To: <93269de0-1f5e-4845-9dcc-1bcd46888bca@l6g2000vbn.googlegroups.com>
References: <93269de0-1f5e-4845-9dcc-1bcd46888bca@l6g2000vbn.googlegroups.com>
Message-ID: <4DCA5C16.8030207@rabbitmq.com>

Hi Chris,

On 10/05/11 22:29, Chris Patterson wrote:
> RabbitMQ.Client.Exceptions.OperationInterruptedException : The AMQP
> operation was interrupted: AMQP close-reason, initiated by Library,
> code=540, text="The Class or Method<40.51>  is unknown", classId=0,
> methodId=0, cause=RabbitMQ.Client.Impl.UnknownClassOrMethodException:

Thanks for reporting this problem. There is indeed a discrepancy between 
the method id for exchange.unbind in the broker and the .net library. I 
will file a bug for this issue.



-Emile

From majek04 at gmail.com  Wed May 11 11:46:39 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 11 May 2011 11:46:39 +0100
Subject: [rabbitmq-discuss] Ack'ing messages
In-Reply-To: <CDBDE5E3-3C4D-4BED-AB1F-9EC244B4A2DC@gmail.com>
References: <CDBDE5E3-3C4D-4BED-AB1F-9EC244B4A2DC@gmail.com>
Message-ID: <BANLkTinmBaPdqQPFKx8b-Cu3gRPjxxNn4g@mail.gmail.com>

On Tue, May 10, 2011 at 19:37, Denny Swindle <denny.swindle at gmail.com> wrote:
> I'm trying to understand the CORRECT way of handling messages that cannot be
> processed, for some reason.
> I have two consumers listening for messages (in a worker queue setup, as
> described here:?http://www.rabbitmq.com/tutorials/tutorial-two-python.html).
> Scenario A:
> A message is received and processed, then it's ack'd using basic_ack.
> Scenario B:
> A message is received and processed, but an error occurs. ?An error like my
> consumer loses connection to the DB. ?In this case, I don't issue a
> basic_ack (and my consumer remains running).
> In looking at the docs, I understand if a message is not acknowledged and
> the consumer dies, rabbit will requeue the message for redelivery.

Correct.

> But what
> if the consumer remains running (and I just can't process the message).

The message will be stalled, until the consumer dies.

> ?Should I not issue the basic_ack (will it get sent to another consumer)?
> ?Or should I issue the basic_ack and then reject the message?

Take a look at basic.reject:
http://www.rabbitmq.com/blog/2010/08/03/well-ill-let-you-go-basicreject-in-rabbitmq/

> I'm asking because earlier today I noticed I had an "unacknowledged" message
> on my queue. ? With the unacknowledged message on the queue, only one worker
> consumer was receiving all messages.
> [root at web2 tmp]# rabbitmqctl list_queues -p / messages
> messages_unacknowledged messages_ready
> Listing queues ...
> 1 1 0
> 0 0 0
> 0 0 0
> 0 0 0
> The other worker was in a 'stale' state and not receiving any messages. ?I'm
> just trying to understand if my logic on not ack'ing a message is correct
> and if that's how i ended up with an unacknowledged message. ?Also trying to
> understand why my worker just stopped receiving messages.
> Any guidance would be appreciated!
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jim at rabbitmq.com  Wed May 11 12:33:36 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Wed, 11 May 2011 12:33:36 +0100
Subject: [rabbitmq-discuss] (yet another) STOMP plugin example
In-Reply-To: <892A9D48AA434436AD21C88E636C3EFA@gmail.com>
References: <892A9D48AA434436AD21C88E636C3EFA@gmail.com>
Message-ID: <BANLkTinu5uy68NaRpCrPkkGT8EJfL+02+Q@mail.gmail.com>

Michael,

Thank you for letting us know. I've added a link from the new STOMP section
on our developer tools page:
http://www.rabbitmq.com/devtools.html#stomp

<http://www.rabbitmq.com/devtools.html#stomp>Jim


On 11 May 2011 02:57, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> A person had an issue with the STOMP plugin on the IRC and I had never used
> it before, so I put together an example that proves STOMP plugin works as
> long as you take care of authentication ;)
>
> It's up on Github: http://bit.ly/irNqOR
>
> I hope this help someone looking for STOMP plugin example some day.
> --
> MK
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110511/48f87a6a/attachment.htm>

From emile at rabbitmq.com  Wed May 11 13:15:14 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 May 2011 13:15:14 +0100
Subject: [rabbitmq-discuss] mnesia tables
In-Reply-To: <BANLkTikuZ_Huhj7F32Fiqm8jV8uFihbVBA@mail.gmail.com>
References: <BANLkTikuZ_Huhj7F32Fiqm8jV8uFihbVBA@mail.gmail.com>
Message-ID: <4DCA7DD2.1080504@rabbitmq.com>

Hi Alain,

On 11/05/11 00:44, Alain Dazzi wrote:
> Hi,
>
> I was wondering if anyone had a procedure to connect to running
> rabbitmq node and read/extract mnesia records using erlang. For the
> lack of such tool, I use grep to try to find stuck messages in the
> various queues (cd /var/lib/rabbitmq/mnesia/...node.../ and grep one
> of the queues).

The mnesia table layout could change in the future, so it would be 
dangerous to rely on that. "rabbitmqctl list_queues" or the management & 
monitoring plugin is a better way of inspecting queues. Do you need 
additional information not displayed by these tools?



-Emile

From cpclark at cloudeventprocessing.com  Wed May 11 13:37:55 2011
From: cpclark at cloudeventprocessing.com (Colin Clark)
Date: Wed, 11 May 2011 07:37:55 -0500
Subject: [rabbitmq-discuss] installation on rh5.5
In-Reply-To: <BANLkTi=GsqwEDpX6Fpe=kgJWTX6SsykzVQ@mail.gmail.com>
References: <33e69f906627938876902860693ebd09@mail.gmail.com>
	<BANLkTi=GsqwEDpX6Fpe=kgJWTX6SsykzVQ@mail.gmail.com>
Message-ID: <23913076dc3a82fa4dd82a6901ce1846@mail.gmail.com>

Alexis,

Thank you - I saw that.  But we had already installed and built Erlang
from source.  For some reason though, you can't install the rpm even
though Erlang is current.

We'll try your approach.

-----Original Message-----
From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On
Behalf Of Alexis Richardson
Sent: Wednesday, May 11, 2011 1:03 AM
To: Colin Clark
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] installation on rh5.5

Colin

On the RPM section of our server downloads page it says this:
--
Note to users of RHEL 5 and derived distributions (e.g. CentOS 5): Due to
the EPEL package update policy, EPEL 5 contains Erlang version R12B-5,
which is relatively old. rabbitmq-server supports R12B-5, but performance
may be lower than for more recent Erlang versions, and certain non-core
features are not supported (SSL support, HTTP-based plugins). Therefore,
we recommend that you install the most recent stable version of Erlang.
The easiest way to do this is to use a package repository provided for
this purpose by the owner of the EPEL Erlang package. Enable it by
invoking (as root):

wget -O /etc/yum.repos.d/epel-erlang.repo
http://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo
and then install or update erlang with yum install erlang.
--

Let us know if this works.  Also, let us know how to make it easier for
people to find this info on the web site!

alexis



On Wed, May 11, 2011 at 3:24 AM, Colin Clark
<cpclark at cloudeventprocessing.com> wrote:
> I?m trying to install the 2.4.1 server on redhat 5.5
>
>
>
> I?ve installed the latest erlang source (downloaded and compiled) and
> that works just fine.
>
>
>
> But when I go to install the rpm:
>
>
>
> Rpm ?I rabb?.
>
>
>
> I get a dependency error on r12b-5.
>
>
>
> How can I overcome this? ??I?ve tried to force the install, but that
> wont work either.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From rob at rabbitmq.com  Wed May 11 15:04:24 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Wed, 11 May 2011 15:04:24 +0100
Subject: [rabbitmq-discuss] STOMP Heartbeat
In-Reply-To: <7A3ABB35-E4BB-4909-B421-2036593984BE@kinishi.com>
References: <7A3ABB35-E4BB-4909-B421-2036593984BE@kinishi.com>
Message-ID: <4DCA9768.8050406@rabbitmq.com>

I spotted the problem, we are spelling the header "heartbeat" but the 
spec has "heart-beat".

If you can tweak your code to send "heartbeat" for now that should work, 
I'll fix this and get the server to send/receive heart-beat.

Regards,

Rob

Alexander Goldstone wrote:
> I am running RabbitMQ 2.4.1 with Erlang R13B03 and I have the management and stomp plugins installed.
>
> I have clients connecting via STOMP over GPRS and I have noticed that if the client does not gracefully disconnect from the server then the 'channel' stays open.
>
> The cause seems to be that the mobile network (APN) does not realise that the connection has been closed and so it stays connected to the RabbitMQ server.
>
> The problem with this is that if a message is sent to the remote client and the client does not ACK the message before being non-gracefully disconnected then RabbitMQ does not re-deliver the message to the client the next time it connects to the server.
>
> I assume the mobile network would time-out eventually however I have seen it hold connections for several hours during testing before I give up and restart the RabbitMQ process to kill off the erroneous connections.
>
> I see that the new (version 1.1) STOMP protocol provides a heartbeat feature. Does RabbitMQ support this? My assumption is that RabbitMQ would see that the heartbeat frames had stopped being transmitted by the client and the RabbitMQ server would therefore close the channel even if the mobile network is holding the connection open. Is this correct?
>
> I have not been able to get the heartbeat feature of the STOMP protocol to work however I can see the word "heartbeat" in several locations of the source code implying that it is implemented.
>
> If I sent this to the server:
>
> 		CONNECT
> 		accept-version:1.1
> 		host:/
> 		login:guest
> 		passcode:guest
> 		prefetch:1
> 		heart-beat:1,1
>
> Then I receive this:
>
> 		CONNECTED
> 		session:session-lnvfUXmXdtlVdBE7p35KZQ==
> 		heartbeat:0,0
> 		version:1.1
>
> Any feedback as to how I should be using the heartbeat feature of the new STOMP protocol or any other suggestions as to how I solve the underlying problem of channels incorrectly being kept open would be gratefully appreciated.
>
> Regards,
>
> Alex
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alex at kinishi.com  Wed May 11 15:31:47 2011
From: alex at kinishi.com (Alexander Goldstone)
Date: Wed, 11 May 2011 15:31:47 +0100
Subject: [rabbitmq-discuss] STOMP Heartbeat
In-Reply-To: <4DCA9768.8050406@rabbitmq.com>
References: <7A3ABB35-E4BB-4909-B421-2036593984BE@kinishi.com>
	<4DCA9768.8050406@rabbitmq.com>
Message-ID: <135547F4-AFAB-4851-BFEC-F7374B94E49C@kinishi.com>


Thank you Rob. I had not spotted the discrepancy and I can confirm that sending "heartbeat" works exactly as I would have expected and should solve my underlying problem with connections being incorrectly held open by the network.

Much appreciated!

Regards,

Alex


On 11 May 2011, at 15:04, Rob Harrop wrote:

> I spotted the problem, we are spelling the header "heartbeat" but the spec has "heart-beat".
> 
> If you can tweak your code to send "heartbeat" for now that should work, I'll fix this and get the server to send/receive heart-beat.
> 
> Regards,
> 
> Rob
> 
> Alexander Goldstone wrote:
>> I am running RabbitMQ 2.4.1 with Erlang R13B03 and I have the management and stomp plugins installed.
>> 
>> I have clients connecting via STOMP over GPRS and I have noticed that if the client does not gracefully disconnect from the server then the 'channel' stays open.
>> 
>> The cause seems to be that the mobile network (APN) does not realise that the connection has been closed and so it stays connected to the RabbitMQ server.
>> 
>> The problem with this is that if a message is sent to the remote client and the client does not ACK the message before being non-gracefully disconnected then RabbitMQ does not re-deliver the message to the client the next time it connects to the server.
>> 
>> I assume the mobile network would time-out eventually however I have seen it hold connections for several hours during testing before I give up and restart the RabbitMQ process to kill off the erroneous connections.
>> 
>> I see that the new (version 1.1) STOMP protocol provides a heartbeat feature. Does RabbitMQ support this? My assumption is that RabbitMQ would see that the heartbeat frames had stopped being transmitted by the client and the RabbitMQ server would therefore close the channel even if the mobile network is holding the connection open. Is this correct?
>> 
>> I have not been able to get the heartbeat feature of the STOMP protocol to work however I can see the word "heartbeat" in several locations of the source code implying that it is implemented.
>> 
>> If I sent this to the server:
>> 
>> 		CONNECT
>> 		accept-version:1.1
>> 		host:/
>> 		login:guest
>> 		passcode:guest
>> 		prefetch:1
>> 		heart-beat:1,1
>> 
>> Then I receive this:
>> 
>> 		CONNECTED
>> 		session:session-lnvfUXmXdtlVdBE7p35KZQ==
>> 		heartbeat:0,0
>> 		version:1.1
>> 
>> Any feedback as to how I should be using the heartbeat feature of the new STOMP protocol or any other suggestions as to how I solve the underlying problem of channels incorrectly being kept open would be gratefully appreciated.
>> 
>> Regards,
>> 
>> Alex
>> 


From alain.dazzi at gmail.com  Wed May 11 16:08:14 2011
From: alain.dazzi at gmail.com (Alain Dazzi)
Date: Wed, 11 May 2011 08:08:14 -0700
Subject: [rabbitmq-discuss] mnesia tables
In-Reply-To: <4DCA7DD2.1080504@rabbitmq.com>
References: <BANLkTikuZ_Huhj7F32Fiqm8jV8uFihbVBA@mail.gmail.com>
	<4DCA7DD2.1080504@rabbitmq.com>
Message-ID: <BANLkTink_LY0S1MzwZ-EqejyD=NFhfM2TA@mail.gmail.com>

On Wed, May 11, 2011 at 5:15 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Alain,
>
>
> On 11/05/11 00:44, Alain Dazzi wrote:
>
>> Hi,
>>
>> I was wondering if anyone had a procedure to connect to running
>> rabbitmq node and read/extract mnesia records using erlang. For the
>> lack of such tool, I use grep to try to find stuck messages in the
>> various queues (cd /var/lib/rabbitmq/mnesia/...node.../ and grep one
>> of the queues).
>>
>
> The mnesia table layout could change in the future, so it would be
> dangerous to rely on that. "rabbitmqctl list_queues" or the management &
> monitoring plugin is a better way of inspecting queues. Do you need
> additional information not displayed by these tools?
>
> -Emile
>

The monitoring plugin and rabbitmqctl utility are great tools! However those
tools only tell me that for instance n messages are in the queue (in a
certain state).  I am debugging a case where we have 4 messages (financial
transactions) that are stuck in the queue in un-Acked state. Without some
type of messageId or transactionID, I have to look directly at mnesia file
system and try to find my data. It would be nice to be able to dump the
records to analyse the data in the various queues (kind of a mysqldump that
would be legible).

Thanks!

-Alain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110511/5a9665cd/attachment-0001.htm>

From michael.s.klishin at gmail.com  Wed May 11 18:17:00 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 11 May 2011 21:17:00 +0400
Subject: [rabbitmq-discuss] IMPORTANT: amqp gem 0.8.0+ will no longer
 support Ruby 1.8.7-p249 (this specific patchlevel) due to a Ruby bug
Message-ID: <E7F7739EAB1E422DAB40A36786C00392@gmail.com>

This message is cross-posted to rabbitmq-discuss and amqp gem mailing list. If you do not use Ruby or amqp gem, feel free to ignore this message. Otherwise please do read on.


I just found out (in the QA process of my apps) that Ruby 1.8.7-p249 (this specific patchlevel) struggles from a bug
that affects 0.8.0 (and possibly earlier versions, too, if you subclass Exchange or Queue, as some libraries do): http://bit.ly/iONBmH

Unfortunately, there is absolutely no way we can provide all the features (including backwards-compatibility behavior/features) and work around this bug on 1.8.7-249, so this version is NO LONGER SUPPORTED by amqp gem.

1.8.7-p174 and p334 are NOT affected by this issue so either downgrading or upgrading will help. That bug was fixed more than a year ago (in December 2009), also affected Ruby Enterprise Edition users and there was at least one stable patchlevel release of 1.8.7 since that time.

If you use Ruby Enterprise Edition or some custom build of 1.8.7 and not sure whether the fix is included with your build, figuring this out is easy: run the following example (managed by Bundler) and see if you get "super called outside of method" exception (usually NoMethodError but can also be a SystemExit):

https://github.com/ruby-amqp/amqp/blob/master/examples/hello_world_with_eventmachine_in_a_separate_thread.rb

If you know anyone who may be running Ruby 1.8.7-p249 or equivalent REE release, please pass this information on to them. If you have any questions, just reply to
this message or contact me directly if you have reasons to do so.

Thank you.
-- 
MK


From d.schmidt at tripwolf.com  Wed May 11 20:25:40 2011
From: d.schmidt at tripwolf.com (David Schmidt)
Date: Wed, 11 May 2011 21:25:40 +0200
Subject: [rabbitmq-discuss] rabbitmq-server crashes
In-Reply-To: <20110503211405.GB32391@wellquite.org>
References: <4DA9C82E.7080505@tripwolf.com>	<20110419100807.GG7850@wellquite.org>	<4DB0452D.3010105@tripwolf.com>
	<20110503211405.GB32391@wellquite.org>
Message-ID: <4DCAE2B4.3060605@tripwolf.com>

On 05/03/2011 11:14 PM, Matthew Sackman wrote:
> On Thu, Apr 21, 2011 at 04:54:37PM +0200, David Schmidt wrote:
>> rabbitmq-server crashed, using rabbitmqctl quite understandably yields:
>>
>> rabbitmqctl list_queues name messages
>> Listing queues ...
>> Error: unable to connect to node rabbit at db19: nodedown
>> diagnostics:
>> - nodes and their ports on db19: [{rabbitmqctl26359,39062}]
>> - current node: rabbitmqctl26359 at db19
>> - current node home dir: /var/lib/rabbitmq
>> - current node cookie hash: MGjkgA5U5XxYMPKTviwAWw==
> 
> I was suggesting that you use rabbitmqctl before rabbit crashes in order
> to inspect whether you can identify any source of leaks (eg acks) that
> is causing the crash.
> 
> Also I would expect there will be some log entries suggesting what's
> going on.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


I am still having the same issues.

This time I started rabbitmq-server directly (not in daemon mode)

###############################

db19:~/tmp# rabbitmq-server
Activating RabbitMQ plugins ...
*WARNING* Undefined function gb_trees:map/2
*WARNING* Undefined function mnesia:read/2
*WARNING* Undefined function os:timestamp/0
*WARNING* Undefined function public_key:pkix_decode_cert/2
*WARNING* Undefined function random:seed/1
*WARNING* Undefined function ssl:ssl_accept/3
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.4.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at db19
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : MGjkgA5U5XxYMPKTviwAWw==
log            : /var/log/rabbitmq/rabbit at db19.log
sasl log       : /var/log/rabbitmq/rabbit at db19-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at db19
erlang version : 5.6.3

starting file handle cache server
...done
starting worker pool
...done
starting database
...done
starting codec correctness check
...done
-- external infrastructure ready
starting statistics event manager
...done
starting logging server
...done
starting plugin registry
...done
starting auth mechanism amqplain
...done
starting auth mechanism cr-demo
...done
starting auth mechanism plain
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
...done
starting exchange type topic
...done
-- kernel ready
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting alarm handler
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange recovery
...done
starting queue supervisor and queue recovery
...done
-- message delivery logic ready
starting error log relay
...done
starting networking
...done
starting notify cluster nodes
...done
starting direct_client
...done

broker running
db19:~/tmp#

###############################


and my perl process that is using rabbitmq (with Net::RabbitMQ) failed with:

caught error: basic_get: Connection reset by peer
caught error: basic_get: (end-of-stream)


###############################


rabbitmq logfiles dont yield any information why the process stopped/crashed







the last 2 calls to rabbitmqctl

db19:~/tmp# rabbitmqctl list_queues name messages
Listing queues ...
q_raw_pages     12
q_result_pages  0
q_new_pages     37528
...done.

db19:~/tmp# rabbitmqctl list_queues name messages
Listing queues ...
Error: unable to connect to node rabbit at db19: nodedown
diagnostics:
- nodes and their ports on db19: [{rabbitmqctl23183,44081}]
- current node: rabbitmqctl23183 at db19
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: MGjkgA5U5XxYMPKTviwAWw==




I am not using acks, as far as I understand messages are automatically
acknowledged the way I use it. messages_unacknowledged always returns 0
for all queues.


thanks for any help

david

From Byron.Albert at dealer.com  Wed May 11 22:02:51 2011
From: Byron.Albert at dealer.com (Byron Albert)
Date: Wed, 11 May 2011 21:02:51 +0000
Subject: [rabbitmq-discuss] api/connections failing
Message-ID: <E84B542096D9F5469A7CA1F600F59B9D107000AD@vtmbx2.dealerdotcom.corp>

Hello,

I am getting the bellow error when I try and get /api/connections

Internal Server Error

The server encountered an error while processing this request:
{error,{exit,{json_encode,{bad_term,{<<"exchange_exchange_bindings">>,bool,
                                     true}}},
             [{mochijson2,json_encode,2},
              {mochijson2,'-json_encode_array/2-fun-0-',3},
              {lists,foldl,3},
              {mochijson2,json_encode_array,2},
              {mochijson2,'-json_encode_proplist/2-fun-0-',3},
              {lists,foldl,3},
              {mochijson2,json_encode_proplist,2},
              {mochijson2,'-json_encode_proplist/2-fun-0-',3}]}}
mochiweb+webmachine web server


Here is the info for the version of everything I am running

Name    Version
amqp_client       2.1.1
crypto   2.0.1
inets      5.5
kernel   2.14.1
mnesia 4.4.15
mochiweb           1.3
os_mon               2.2.5
rabbit    2.1.1
rabbit_management      2.1.1
rabbit_mochiweb            2.1.1
sasl         2.1.9.2
stdlib     1.17.1
webmachine      1.7.0


Any ideas?

Byron



_____________________________________
Byron Albert | Systems Architect
[Description: Description: Description: cid:part1.01070402.03060807 at dealer.com]
V 877-327-8422 x496 F 802.658.0926
1 Howard St., Burlington, VT 05401
Byron.Albert at dealer.com<mailto:Byron.Albert at dealer.com> | www.dealer.com<http://www.dealer.com>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110511/5309e487/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1658 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110511/5309e487/attachment.gif>

From alex at kinishi.com  Thu May 12 00:55:52 2011
From: alex at kinishi.com (Alexander Goldstone)
Date: Thu, 12 May 2011 00:55:52 +0100
Subject: [rabbitmq-discuss] Messages Sent Via STOMP Not Surviving Server
	Restart
In-Reply-To: <B8F980F7-08DB-4A1A-9FDD-AE5B36D0BBC1@kinishi.com>
References: <B8F980F7-08DB-4A1A-9FDD-AE5B36D0BBC1@kinishi.com>
Message-ID: <C13235D9-C700-4876-A865-B920C70F0A38@kinishi.com>


For anyone looking at this mailing-list thread retrospectively... I had missed the fact that recent versions of the STOMP plugin now expect "persistent:true" instead of "delivery-mode:2".

My problem is solved by replacing this:

		SEND
		destination:/queue/testq
		delivery-mode:2
		receipt:1

With this:

		SEND
		destination:/queue/testq
		persistent:true 
		receipt:1

Regards,

Alex

On 7 May 2011, at 00:02, Alexander Goldstone wrote:

> 
> I am running RabbitMQ 2.4.1 with Erlang R13B03 and I have the management and stomp plugins installed.
> 
> I am connecting via telnet to the STOMP port to create a queue and send a message using the following five steps:
> 
> STEP 1 - Start the STOMP session using:
> 
> 		CONNECT
> 		login:guest
> 		passcode:guest
> 		prefetch:1
> 
> 		^@
> 
> STEP 2 - Create a queue using:
> 
> 		SUBSCRIBE
> 		destination:/queue/testq
> 		auto-delete:false
> 		durable:true
> 
> 		^@
> 
> STEP 3 - Unsubscribe from the queue using:
> 
> 		UNSUBSCRIBE
> 		destination:/queue/testq
> 
> 		^@
> 
> STEP 4 - Send a message to the same queue using:
> 
> 		SEND
> 		destination:/queue/testq
> 		delivery-mode:2
> 		receipt:1
> 
> 		Test Message Body
> 		^@
> 
> STEP 5 - Disconnect from the STOMP connection using:
> 
> 		DISCONNECT
> 
> 		^@
> 
> I can see that the message is queued via the management plugin however on restarting the server using 'sudo service rabbitmq-server restart' the queue remains but the message has been lost.
> 
> It does not seem to make any difference how long I wait before restarting the server.
> 
> Am I doing something obvious wrong? What can I add or change to the above steps to cause messages to persist after a server restart (and therefore hopefully a less graceful server termination)?
> 
> Thanks,
> 
> Alex


From d.schmidt at tripwolf.com  Thu May 12 05:53:43 2011
From: d.schmidt at tripwolf.com (David Schmidt)
Date: Thu, 12 May 2011 06:53:43 +0200
Subject: [rabbitmq-discuss] rabbitmq-server crashes
In-Reply-To: <4DCAE2B4.3060605@tripwolf.com>
References: <4DA9C82E.7080505@tripwolf.com>	<20110419100807.GG7850@wellquite.org>	<4DB0452D.3010105@tripwolf.com>	<20110503211405.GB32391@wellquite.org>
	<4DCAE2B4.3060605@tripwolf.com>
Message-ID: <4DCB67D7.4030700@tripwolf.com>

On 05/11/2011 09:25 PM, David Schmidt wrote:
> On 05/03/2011 11:14 PM, Matthew Sackman wrote:
>> On Thu, Apr 21, 2011 at 04:54:37PM +0200, David Schmidt wrote:
>>> rabbitmq-server crashed, using rabbitmqctl quite understandably yields:
>>>
>>> rabbitmqctl list_queues name messages
>>> Listing queues ...
>>> Error: unable to connect to node rabbit at db19: nodedown
>>> diagnostics:
>>> - nodes and their ports on db19: [{rabbitmqctl26359,39062}]
>>> - current node: rabbitmqctl26359 at db19
>>> - current node home dir: /var/lib/rabbitmq
>>> - current node cookie hash: MGjkgA5U5XxYMPKTviwAWw==
>>
>> I was suggesting that you use rabbitmqctl before rabbit crashes in order
>> to inspect whether you can identify any source of leaks (eg acks) that
>> is causing the crash.
>>
>> Also I would expect there will be some log entries suggesting what's
>> going on.
>>
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> I am still having the same issues.
> 
> This time I started rabbitmq-server directly (not in daemon mode)
> 
> ###############################
> 
> db19:~/tmp# rabbitmq-server
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function gb_trees:map/2
> *WARNING* Undefined function mnesia:read/2
> *WARNING* Undefined function os:timestamp/0
> *WARNING* Undefined function public_key:pkix_decode_cert/2
> *WARNING* Undefined function random:seed/1
> *WARNING* Undefined function ssl:ssl_accept/3
> 0 plugins activated:
> 
> 
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.4.0  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
> 
> node           : rabbit at db19
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.4.0/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : MGjkgA5U5XxYMPKTviwAWw==
> log            : /var/log/rabbitmq/rabbit at db19.log
> sasl log       : /var/log/rabbitmq/rabbit at db19-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at db19
> erlang version : 5.6.3
> 
> starting file handle cache server
> ...done
> starting worker pool
> ...done
> starting database
> ...done
> starting codec correctness check
> ...done
> -- external infrastructure ready
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting plugin registry
> ...done
> starting auth mechanism amqplain
> ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism plain
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
> ...done
> starting exchange type topic
> ...done
> -- kernel ready
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting alarm handler
> ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting exchange recovery
> ...done
> starting queue supervisor and queue recovery
> ...done
> -- message delivery logic ready
> starting error log relay
> ...done
> starting networking
> ...done
> starting notify cluster nodes
> ...done
> starting direct_client
> ...done
> 
> broker running
> db19:~/tmp#
> 
> ###############################
> 
> 
> and my perl process that is using rabbitmq (with Net::RabbitMQ) failed with:
> 
> caught error: basic_get: Connection reset by peer
> caught error: basic_get: (end-of-stream)
> 
> 
> ###############################
> 
> 
> rabbitmq logfiles dont yield any information why the process stopped/crashed
> 
> 
> 
> 
> 
> 
> 
> the last 2 calls to rabbitmqctl
> 
> db19:~/tmp# rabbitmqctl list_queues name messages
> Listing queues ...
> q_raw_pages     12
> q_result_pages  0
> q_new_pages     37528
> ...done.
> 
> db19:~/tmp# rabbitmqctl list_queues name messages
> Listing queues ...
> Error: unable to connect to node rabbit at db19: nodedown
> diagnostics:
> - nodes and their ports on db19: [{rabbitmqctl23183,44081}]
> - current node: rabbitmqctl23183 at db19
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: MGjkgA5U5XxYMPKTviwAWw==
> 
> 
> 
> 
> I am not using acks, as far as I understand messages are automatically
> acknowledged the way I use it. messages_unacknowledged always returns 0
> for all queues.
> 
> 
> thanks for any help
> 
> david
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Update

It crashed again this time the last message of the rabbitmq-server was

"Erlang has closed"

I searched for this and found
"http://old.nabble.com/Erlang-has-closed--td28600093.html" but there is
nothing that helps me with this problem.

david

From rtrlists at googlemail.com  Thu May 12 08:36:13 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 12 May 2011 08:36:13 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes
In-Reply-To: <4DCAE2B4.3060605@tripwolf.com>
References: <4DA9C82E.7080505@tripwolf.com>
	<20110419100807.GG7850@wellquite.org>
	<4DB0452D.3010105@tripwolf.com>
	<20110503211405.GB32391@wellquite.org>
	<4DCAE2B4.3060605@tripwolf.com>
Message-ID: <BANLkTik4zheVZf2C76zjMdy_T61WOSopmg@mail.gmail.com>

On Wed, May 11, 2011 at 8:25 PM, David Schmidt <d.schmidt at tripwolf.com>wrote:

> db19:~/tmp# rabbitmq-server
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function gb_trees:map/2
> *WARNING* Undefined function mnesia:read/2
> *WARNING* Undefined function os:timestamp/0
> *WARNING* Undefined function public_key:pkix_decode_cert/2
> *WARNING* Undefined function random:seed/1
> *WARNING* Undefined function ssl:ssl_accept/3
>

These warnings are worrying, as they all point to standard Erlang library
functions as being missing. I would think something in your Erlang setup is
not correct.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110512/ee787d89/attachment.htm>

From matthew at rabbitmq.com  Thu May 12 09:20:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 12 May 2011 09:20:56 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes
In-Reply-To: <BANLkTik4zheVZf2C76zjMdy_T61WOSopmg@mail.gmail.com>
References: <4DA9C82E.7080505@tripwolf.com>
	<20110419100807.GG7850@wellquite.org>
	<4DB0452D.3010105@tripwolf.com>
	<20110503211405.GB32391@wellquite.org>
	<4DCAE2B4.3060605@tripwolf.com>
	<BANLkTik4zheVZf2C76zjMdy_T61WOSopmg@mail.gmail.com>
Message-ID: <20110512082055.GA2594@rabbitmq.com>

On Thu, May 12, 2011 at 08:36:13AM +0100, Robert Raschke wrote:
> On Wed, May 11, 2011 at 8:25 PM, David Schmidt <d.schmidt at tripwolf.com>wrote:
> 
> > db19:~/tmp# rabbitmq-server
> > Activating RabbitMQ plugins ...
> > *WARNING* Undefined function gb_trees:map/2
> > *WARNING* Undefined function mnesia:read/2
> > *WARNING* Undefined function os:timestamp/0
> > *WARNING* Undefined function public_key:pkix_decode_cert/2
> > *WARNING* Undefined function random:seed/1
> > *WARNING* Undefined function ssl:ssl_accept/3
> >
> 
> These warnings are worrying, as they all point to standard Erlang library
> functions as being missing. I would think something in your Erlang setup is
> not correct.

Yeah, I'd not spotted you're running 2.4.0, which is buggy, especially
on Erlang R12. The gb_trees:map call in particular is a problem. Please
upgrade to Rabbit 2.4.1 which does not require some of those missing
functions or/and upgrade your version of Erlang.

Matthew

From simon at rabbitmq.com  Thu May 12 11:31:13 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 May 2011 11:31:13 +0100
Subject: [rabbitmq-discuss] api/connections failing
In-Reply-To: <E84B542096D9F5469A7CA1F600F59B9D107000AD@vtmbx2.dealerdotcom.corp>
References: <E84B542096D9F5469A7CA1F600F59B9D107000AD@vtmbx2.dealerdotcom.corp>
Message-ID: <4DCBB6F1.2020705@rabbitmq.com>

On 11/05/11 22:02, Byron Albert wrote:
> Hello,
>
> I am getting the bellow error when I try and get /api/connections

<snip>

> {error,{exit,{json_encode,{bad_term,{<<"exchange_exchange_bindings">>,bool,

Short answer: you need to upgrade the server to 2.4.1.

Slightly longer answer: versions of the management plugin prior to 2.4.0 
did not correctly handle display of nested AMQP tables. And recent 
clients send nested tables to list their capabilities. This is failing 
trying to encode the client properties of a newer client.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matteo.carbone at network.txtgroup.com  Thu May 12 11:57:29 2011
From: matteo.carbone at network.txtgroup.com (Matteo Carbone)
Date: Thu, 12 May 2011 12:57:29 +0200
Subject: [rabbitmq-discuss] manage permission Subscriber with RPC send system
Message-ID: <000501cc1093$656eaa10$304bfe30$@carbone@network.txtgroup.com>

Hello I am new to this forum ... my name is Matteo ...

 

Let me explain a bit that I would use the system and the problem I have
encountered ...

 

I have the following tools:

 

request_vhost

request_queue

request_exchange

 

appClient

AppServer

 

Operation:

the client sends a request to the RPC and waits for a response, the server
processes the request and returns a response on RPC queue(autogenerate)...

 

Problem:

To implement the RPC service to the client have given the following
permissions on request_vhost ".*" ".*" ".*"

because they must be able to write to the queue request_queue, but must also
be able to create a response queue

with the RPC service (which generates a wild-queue random name) and then
must also have permission to read up on the corner of the PRC,

which will have an arbitrary name ...

So how can I avoid that the client can subscribe or cancel the queue
"request_queue?

or rather I would like that the only things I can do is send the client a
message on the queue request_queue

and read the response from the queue created with the RPC service ...

What kind of permission do I set? is achievable? 

 

thanks ...

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110512/79a0ede4/attachment.htm>

From matteo.carbone at network.txtgroup.com  Thu May 12 12:00:45 2011
From: matteo.carbone at network.txtgroup.com (Matteo Carbone)
Date: Thu, 12 May 2011 13:00:45 +0200
Subject: [rabbitmq-discuss] manage permission Subscriber with RPC send system
Message-ID: <000a01cc1093$d9935490$8cb9fdb0$@carbone@network.txtgroup.com>

Hello I am new to this forum ... my name is Matteo ...

 

Let me explain a bit that I would use the system and the problem I have
encountered ...

 

I have the following tools:

 

request_vhost

request_queue

request_exchange

 

appClient

AppServer

 

Operation:

the client sends a request to the RPC and waits for a response, the server
processes the request and returns a response on RPC queue(autogenerate)...

 

Problem:

To implement the RPC service to the client have given the following
permissions on request_vhost ".*" ".*" ".*"

because they must be able to write to the queue request_queue, but must also
be able to create a response queue

with the RPC service (which generates a wild-queue random name) and then
must also have permission to read up on the corner of the PRC,

which will have an arbitrary name ...

So how can I avoid that the client can subscribe or cancel the queue
"request_queue?

or rather I would like that the only things I can do is send the client a
message on the queue request_queue

and read the response from the queue created with the RPC service ...

What kind of permission do I set? is achievable? 

 

thanks ...

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110512/209fc597/attachment.htm>

From matteo.carbone at network.txtgroup.com  Thu May 12 12:07:00 2011
From: matteo.carbone at network.txtgroup.com (Matteo Carbone)
Date: Thu, 12 May 2011 13:07:00 +0200
Subject: [rabbitmq-discuss] manage permission Subscriber with RPC send system
Message-ID: <001b01cc1094$b9715bc0$2c541340$@carbone@network.txtgroup.com>

Hello I am new to this forum ... my name is Matteo ...

 

Let me explain a bit that I would use the system and the problem I have
encountered ...

 

I have the following tools:

 

request_vhost

request_queue

request_exchange

 

appClient

AppServer

 

Operation:

the client sends a request to the RPC and waits for a response, the server
processes the request and returns a response on RPC queue(autogenerate)...

 

Problem:

To implement the RPC service to the client have given the following
permissions on request_vhost ".*" ".*" ".*"

because they must be able to write to the queue request_queue, but must also
be able to create a response queue

with the RPC service (which generates a wild-queue random name) and then
must also have permission to read up on the corner of the PRC,

which will have an arbitrary name ...

So how can I avoid that the client can subscribe or cancel the queue
"request_queue?

or rather I would like that the only things I can do is send the client a
message on the queue request_queue

and read the response from the queue created with the RPC service ...

What kind of permission do I set? is achievable? thanks ...

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110512/2244fb69/attachment.htm>

From praddyjindal at gmail.com  Thu May 12 12:14:03 2011
From: praddyjindal at gmail.com (Pradeep Jindal)
Date: Thu, 12 May 2011 16:44:03 +0530
Subject: [rabbitmq-discuss] mail loop problem with shovel
Message-ID: <BANLkTimKmfbMTgEUCCmmLmZ_v_HRou+eiQ@mail.gmail.com>

Hi,

I have two brokers in different data centers, both the brokers serve the
same purpose. I wanted to see messages from broker1's "/topic/test" in
broker2's "/topic/test" and vice-versa. So, i tried configuring shovel
plugin, but it's going in a loop. Here's my configuration, please tell me
what else is needed in these configurations to fulfill my requirement?

====hare.config====
[
{mnesia, [{dump_log_write_threshold, 100}
    ]},
{rabbit, [{vm_memory_high_watermark, 0.4}
    ]},
{rabbit_shovel,
    [{shovels,
        [{hellos_shovel,
            [{sources,      [{broker, "amqp://guest:guest at localhost:5672/"}
                    ]},
            {destinations, [{broker, "amqp://"}
                    ]},
            {queue, <<"hellos">>},
            {auto_ack, false},
            {tx_size, 0},
            {reconnect_delay, 5}
            ]}
            ]
    }]
}
].
====hare.config====

====rabbit.config====
[
{mnesia, [{dump_log_write_threshold, 100}
    ]},
{rabbit, [{vm_memory_high_watermark, 0.4}
    ]},
{rabbit_shovel,
    [{shovels,
        [{hellos_shovel,
            [{sources,      [{broker, "amqp://guest:guest at localhost:5673/"}
                    ]},
            {destinations, [{broker, "amqp://"}
                    ]},
            {queue, <<"hellos">>},
            {auto_ack, false},
            {tx_size, 0},
            {reconnect_delay, 5}
            ]}
            ]
    }]
}
].
====rabbit.config====

- praddy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110512/e834816b/attachment.htm>

From brandon.craig.rhodes at gmail.com  Thu May 12 12:27:19 2011
From: brandon.craig.rhodes at gmail.com (Brandon Craig Rhodes)
Date: Thu, 12 May 2011 07:27:19 -0400
Subject: [rabbitmq-discuss] how to detect bad username/password in 0.9.5?
In-Reply-To: <BANLkTimtUtz16oQXm7mH4jb26V66xdysDA@mail.gmail.com> (Gavin
	M. Roy's message of "Mon, 9 May 2011 13:07:28 -0400")
References: <8762pp2n3r.fsf@asaph.rhodesmill.org>
	<0EE524E350E246CB907D096EE0F7AC26@myyearbook.com>
	<55A75972592E4F01AA558001E05E97DD@gmail.com>
	<BANLkTimtUtz16oQXm7mH4jb26V66xdysDA@mail.gmail.com>
Message-ID: <87hb90tazs.fsf@asaph.rhodesmill.org>

"Gavin M. Roy" <gmr at myyearbook.com> writes:

> On Mon, May 9, 2011 at 1:02 PM, Michael Klishin
> <michael.s.klishin at gmail.com> wrote:
>
>> I see that pika is callbacks-oriented. If so, maybe it can do what
>> amqp gem does: it actually runs an errback when possible
>> authentication failure is detected...

> Thanks, that sounds like a good solution.

Gavin, thank you for looking into this!  A callback will be perfect, and
let me clean things up and alert the user when communication is not
taking place.

If you have a Stack Overflow account, feel free to leave the true
answer, "the AMQP protocol has no concept of a 'bad password' response
but we can raise an exception if we are hung up on," on the question I
asked and receive the green check-mark of victory:

http://stackoverflow.com/questions/5918316/how-can-python-detect-that-my-rabbitmq-password-failed/

-- 
Brandon Craig Rhodes   brandon at rhodesmill.org   http://rhodesmill.org/brandon

From Linley.Smith at 192.com  Thu May 12 15:39:07 2011
From: Linley.Smith at 192.com (Linley Smith)
Date: Thu, 12 May 2011 15:39:07 +0100
Subject: [rabbitmq-discuss] Does RabbitMQ have an embedded broker plugin for
 Maven similar to the AciveMQ one?
Message-ID: <952B54BDFDFADF44B961AB66E1DB4A73167859A2EC@ukicdpostal9000.icd.192.com>

Hi,

We are starting to use RabbitMQ and would like to have our projects configured for continuous integration testing using an embedded broker within the JVM.  Does RabbitMQ have something similar to the ActiveMQ one: http://activemq.apache.org/how-do-i-embed-a-broker-inside-a-connection.html?  Also, is there a plugin that can boot up the broker similar to this: http://activemq.apache.org/maven2-activemq-broker-plugin.html?

I have reviewed the online content but have not been able to find anything.

Kind Regards,
Linley Smith
----------------------------------------------------------
This transmission is strictly confidential, possibly legally privileged, and intended solely for the 
addressee.  Any views or opinions expressed within it are those of the author and do not necessarily 
represent those of 192.com, i-CD Publishing (UK) Ltd or any of it's subsidiary companies.  If you 
are not the intended recipient then you must not disclose, copy or take any action in reliance of this 
transmission. If you have received this transmission in error, please notify the sender as soon as 
possible.  No employee or agent is authorised to conclude any binding agreement on behalf of 
i-CD Publishing (UK) Ltd with another party by email without express written confirmation by an 
authorised employee of the Company. http://www.192.com (Tel: 08000 192 192).  i-CD Publishing (UK) Ltd 
is incorporated in England and Wales, company number 3148549, VAT No. GB 673128728.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110512/4c6a5f64/attachment-0001.htm>

From videlalvaro at gmail.com  Thu May 12 16:17:20 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 12 May 2011 17:17:20 +0200
Subject: [rabbitmq-discuss] Experiments with the fanout exchange and many
	queues
Message-ID: <EB6876A2-C89C-4DA2-B042-9F3566258E95@gmail.com>

Hi List,

With @michaelklishin we tried to reproduce the problems of the RabbitMQ chat. I wrote an Erlang test scenario, he did the same for Ruby. 

This is the repository: https://github.com/videlalvaro/massive_fanout

The scenario is this:

- Open 1 connection
- Create many consumers, one with one channel for itself and one private queue. The queues are bound to a fanout exchange. (I tried with 8K consumers)
- Route messages. With 10 msgs you should see the broker having problems. Also the management plugin starts having problems.

Please keep in mind that in my case I don't consider this use case a typical one, far from it. Still it might be useful for you guys to be able to easily reproduce this.

I wrote a README on how to reproduce it.

Best,

Alvaro

From simon at rabbitmq.com  Thu May 12 17:34:40 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 May 2011 17:34:40 +0100
Subject: [rabbitmq-discuss] Experiments with the fanout exchange and
 many queues
In-Reply-To: <EB6876A2-C89C-4DA2-B042-9F3566258E95@gmail.com>
References: <EB6876A2-C89C-4DA2-B042-9F3566258E95@gmail.com>
Message-ID: <4DCC0C20.4010703@rabbitmq.com>

On 12/05/11 16:17, Alvaro Videla wrote:
> Please keep in mind that in my case I don't consider this use case a
> typical one, far from it. Still it might be useful for you guys to be
> able to easily reproduce this.

Thanks.

It pains me to say it, but I suspect the management plugin to be the 
source of most of your problems. Currently it doesn't deal very well 
with large numbers (many thousands) of queues, all of which are active 
at once, or with very high rates of connection / channel churn. 
Switching off fine grained statistics helps quite a bit, but it's still 
not as good as it should be.

Coincidentally I've been doing some work in this area (inspired by Ian 
Ragsdale's recent postings), some of which is starting to bear fruit, so 
hopefully this sort of scenario will improve in the relatively short term...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From gmr at myyearbook.com  Thu May 12 18:12:08 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 12 May 2011 10:12:08 -0700
Subject: [rabbitmq-discuss] Help tracking down disconnection locations in
	code
Message-ID: <BA9F7F74C9094BF3BAD45C693DF9648D@myyearbook.com>

I am looking to enumerate in Pika the places or reasons that RabbitMQ may disconnect the client connection. There's the case of bad credentials and permission issues with the vhost for example. Is there a common module/function called within the RabbitMQ source to handle these types of disconnects? Any pointers to where to look in the Rabbit code base would be helpful.

Thanks,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110512/36675253/attachment.htm>

From chrisch at ecollege.com  Thu May 12 19:06:33 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Thu, 12 May 2011 18:06:33 +0000
Subject: [rabbitmq-discuss] Erlang Client Changes Since 2.2.0?
Message-ID: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FF701@EXMB02OSG.eclg.org>

Hi Everybody.

I'm getting ready to freshen my instance of the erlang client as part of an upcoming release of our message bus.  Is there a concise list of changes and/or upgrade steps for the erlang client from 2.2.0 to 2.4.1?

You do a great job with this with the java and .net clients, but I don't see the analog for the erlang client.  There are a bunch of commits in the hg repo since that time of 2.2.0, but I'd love to be able to just skim past them...  :)

If there is no such summary, is there anything I should know up-front about the changes?

Thanks in advance!

-Chris

From gmr at myyearbook.com  Fri May 13 04:06:02 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 12 May 2011 23:06:02 -0400
Subject: [rabbitmq-discuss] Writing to the mnesia table rabbit_queue,
	bad idea?
Message-ID: <BANLkTik0SmhUe3LKXvfYGwrdsy4cG4GAHA@mail.gmail.com>

I am working on a project to manage custom attributes in the queue arguments
table and found that if I write to the rabbit_queue table it will reflect in
the management plugin as I want, without interrupting existing publishers or
consumers.

It seems like it does exactly what I want it to do, which is very cool but
 I can't help but wonder if it's a bad idea though.

Would someone with a good handle on RabbitMQ internals mind taking a look at
my code and let me know if I have anything to worry about?

All write related functions use the write_record/1 function:

https://github.com/gmr/elmer/blob/master/elmer.erl#L98

And examples of use can be found in setup_monitoring/4 at:

https://github.com/gmr/elmer/blob/master/elmer.erl#L27

And toggle_monitoring/2 at:

https://github.com/gmr/elmer/blob/master/elmer.erl#L46

I'm currently working on a cli wrapper for these and plan on releasing this
and the accompanying Nagios integration bits if this is sane enough.

Thanks,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110512/609874ff/attachment.htm>

From chris at phatboyg.com  Fri May 13 05:21:19 2011
From: chris at phatboyg.com (Chris Patterson)
Date: Thu, 12 May 2011 21:21:19 -0700 (PDT)
Subject: [rabbitmq-discuss] ExchangeUnbind Fails with .NET
	RabbitMQ.Client
In-Reply-To: <4DCA5C16.8030207@rabbitmq.com>
References: <93269de0-1f5e-4845-9dcc-1bcd46888bca@l6g2000vbn.googlegroups.com>
	<4DCA5C16.8030207@rabbitmq.com>
Message-ID: <9f74921b-3502-4c0d-bf24-e8d50da6c6da@z19g2000yqz.googlegroups.com>

Great, let me know what I can do to patch and submit a pull request
for the .NET client.

Chris


On May 11, 4:51?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Chris,
>
> On 10/05/11 22:29, Chris Patterson wrote:
>
> > RabbitMQ.Client.Exceptions.OperationInterruptedException : The AMQP
> > operation was interrupted: AMQP close-reason, initiated by Library,
> > code=540, text="The Class or Method<40.51> ?is unknown", classId=0,
> > methodId=0, cause=RabbitMQ.Client.Impl.UnknownClassOrMethodException:
>
> Thanks for reporting this problem. There is indeed a discrepancy between
> the method id for exchange.unbind in the broker and the .net library. I
> will file a bug for this issue.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Fri May 13 08:47:54 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 08:47:54 +0100
Subject: [rabbitmq-discuss] ExchangeUnbind Fails with .NET
	RabbitMQ.Client
In-Reply-To: <9f74921b-3502-4c0d-bf24-e8d50da6c6da@z19g2000yqz.googlegroups.com>
References: <93269de0-1f5e-4845-9dcc-1bcd46888bca@l6g2000vbn.googlegroups.com>
	<4DCA5C16.8030207@rabbitmq.com>
	<9f74921b-3502-4c0d-bf24-e8d50da6c6da@z19g2000yqz.googlegroups.com>
Message-ID: <20110513074753.GA2389@rabbitmq.com>

Hi Chris,

On Thu, May 12, 2011 at 09:21:19PM -0700, Chris Patterson wrote:
> Great, let me know what I can do to patch and submit a pull request
> for the .NET client.

This has been fixed and has gone through QA. It will be part of the next
release.

In the mean time, if you're able to pull from our hg repo for the .net
client and build from source you should find the problem gone.

Matthew

From emile at rabbitmq.com  Fri May 13 10:14:53 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 May 2011 10:14:53 +0100
Subject: [rabbitmq-discuss] mnesia tables
In-Reply-To: <BANLkTink_LY0S1MzwZ-EqejyD=NFhfM2TA@mail.gmail.com>
References: <BANLkTikuZ_Huhj7F32Fiqm8jV8uFihbVBA@mail.gmail.com>	<4DCA7DD2.1080504@rabbitmq.com>
	<BANLkTink_LY0S1MzwZ-EqejyD=NFhfM2TA@mail.gmail.com>
Message-ID: <4DCCF68D.7070906@rabbitmq.com>


Hi Alain,

> I am debugging a case where we have 4 messages
> (financial transactions) that are stuck in the queue in un-Acked state.
> Without some type of messageId or transactionID, I have to look directly
> at mnesia file system and try to find my data. It would be nice to be
> able to dump the records to analyse the data in the various queues (kind
> of a mysqldump that would be legible).

The contents of messages are on disk in a specialised format or in RAM 
(or both), instead of mnesia tables, so mnesia browsing won't solve this 
problem.

If you are trying to track down which consumer amongst many is 
responsible for failing to acknowledge some messages, then "rabbitmqctl 
list_channels messages_unacknowledged" and "rabbitmqctl list_consumers" 
could help.

For debugging you could have all clients connect via a proxy that tracks 
which consumers receives and acknowledges messages. A comparison will 
reveal unacknowledged messages. The tracer tool ( 
http://www.rabbitmq.com/faq.html#analyse-network-traffic ) or Wireshark 
( http://wiki.wireshark.org/AMQP ) may help.

Another option is to provide an alternative queue implementation which 
is browsable. Alternative queue implementations that implement these 
callbacks (
http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_backing_queue.erl 
) can be swapped in by defining the "backing_queue_module" erlang 
variable appropriately. If your queue implementation stores messages in 
a SQL database then a "select" statement will list messages.

-Emile


From simon at rabbitmq.com  Fri May 13 10:58:34 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 May 2011 10:58:34 +0100
Subject: [rabbitmq-discuss] Writing to the mnesia table rabbit_queue,
 bad idea?
In-Reply-To: <BANLkTik0SmhUe3LKXvfYGwrdsy4cG4GAHA@mail.gmail.com>
References: <BANLkTik0SmhUe3LKXvfYGwrdsy4cG4GAHA@mail.gmail.com>
Message-ID: <4DCD00CA.80705@rabbitmq.com>

On 13/05/11 04:06, Gavin M. Roy wrote:
> I am working on a project to manage custom attributes in the queue
> arguments table and found that if I write to the rabbit_queue table it
> will reflect in the management plugin as I want, without interrupting
> existing publishers or consumers.
>
> It seems like it does exactly what I want it to do, which is very cool
> but  I can't help but wonder if it's a bad idea though.
>
> Would someone with a good handle on RabbitMQ internals mind taking a
> look at my code and let me know if I have anything to worry about?

Depends how you define "bad idea". In terms of today's implementation 
you should be fine, as long as you don't expect (for example) to be able 
to flip the durability field and have that mean something.

Of course, you're going very much behind the scenes here and anything 
you do today is not guaranteed to work tomorrow. Raymond Chen is not on 
our team. While I don't see anything on the horizon that would break 
this general property, you should should certainly be prepared for the 
schema to change.

> All write related functions use the write_record/1 function:
>
> https://github.com/gmr/elmer/blob/master/elmer.erl#L98
>
> And examples of use can be found in setup_monitoring/4 at:
>
> https://github.com/gmr/elmer/blob/master/elmer.erl#L27
>
> And toggle_monitoring/2 at:
>
> https://github.com/gmr/elmer/blob/master/elmer.erl#L46
>
> I'm currently working on a cli wrapper for these and plan on releasing
> this and the accompanying Nagios integration bits if this is sane enough.

Cool, sounds interesting.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Fri May 13 12:18:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:18:47 +0100
Subject: [rabbitmq-discuss] rabbitmq.conf memory configuration
In-Reply-To: <35CC4C9595855B43903A67B297EFA8E399A997@HYD-MKD-MBX01.wipro.com>
References: <35CC4C9595855B43903A67B297EFA8E399A997@HYD-MKD-MBX01.wipro.com>
Message-ID: <20110513111847.GD10457@rabbitmq.com>

Hi Vinayagamoorthi,

On Tue, Apr 19, 2011 at 10:15:37PM +0530, Vinayagamoorthi.Kvi at wipro.com wrote:
>       I need your help to define/assign the certain memory specifically
> via rabbitmq.conf file but I don't know how to. Kindly help.

You don't use the rabbitmq.conf file for that; you use the
rabbitmq.config file. See

http://www.rabbitmq.com/extensions.html#memsup

Best wishes,

Matthew

From matthew at rabbitmq.com  Fri May 13 12:19:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:19:47 +0100
Subject: [rabbitmq-discuss] Unable to start RabbitMQ on Ubuntu 8.10
In-Reply-To: <4DB59036.7020000@porticosys.com>
References: <4DB59036.7020000@porticosys.com>
Message-ID: <20110513111947.GE10457@rabbitmq.com>

On Mon, Apr 25, 2011 at 11:16:06AM -0400, Angelo Iacovella wrote:
> I've tried installing multiple versions or RabbitMQ - on 32 and 64 bit
> Ubuntu distributions with no luck.
> 
> I keep getting this when attempting to start it from the script
> 
> {"init terminating in
> do_boot",{undef,[{rabbit_prelaunch,start,[]},{init,start_it,1},{init,start_em,1}]}}
> init terminating in do_boot ()

undef suggests that erlang can't find the code correctly. How have you
installed Rabbit? Have you used a debian package, or installed from
source, or...?

Matthew

From simon at rabbitmq.com  Fri May 13 12:21:32 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 May 2011 12:21:32 +0100
Subject: [rabbitmq-discuss] Help tracking down disconnection locations
 in	code
In-Reply-To: <BA9F7F74C9094BF3BAD45C693DF9648D@myyearbook.com>
References: <BA9F7F74C9094BF3BAD45C693DF9648D@myyearbook.com>
Message-ID: <4DCD143C.6070909@rabbitmq.com>

On 12/05/11 18:12, Gavin M. Roy wrote:
> I am looking to enumerate in Pika the places or reasons that RabbitMQ
> may disconnect the client connection. There's the case of bad
> credentials and permission issues with the vhost for example. Is there a
> common module/function called within the RabbitMQ source to handle these
> types of disconnects?

In pretty much every case an #amqp_error{} record will be constructed, 
then thrown as an exception. #amqp_error{} is in general constructed and 
thrown by a call to rabbit_misc:protocol_error(), so that's probably the 
best thing to look for.

Note that some AMQP exceptions lead to connections being disconnected 
("hard" errors) while some lead to channels being disconnected ("soft" 
errors). Both go through rabbit_misc:protocol_error(). The 0-9-1 XML 
spec lists which are which (under "CONSTANTS", near the top).

Can I ask why you want to know though? In general the spec document 
lists the error codes that can occur, and each error should be 
accompanied by a descriptive text. The only exception is for errors that 
happen while the connection is being established (is that what you're 
asking about? - in which case I think it's permissions as you already 
know, framing errors and internal errors.)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Fri May 13 12:26:01 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:26:01 +0100
Subject: [rabbitmq-discuss] access to queue or binding arguments?
In-Reply-To: <21A57C8E-F351-4379-8D27-E702147D76C3@jbrisbin.com>
References: <21A57C8E-F351-4379-8D27-E702147D76C3@jbrisbin.com>
Message-ID: <20110513112600.GF10457@rabbitmq.com>

On Wed, Apr 27, 2011 at 12:00:46PM -0500, Jon Brisbin wrote:
> How do I access the queue or binding arguments from plugins

Plugins: you can't - plugins mainly just use the erlang client and are
generally normal client programs which happen to be running in the same
Erlang VM as Rabbit. Or, they use some other defined API such as

> or custom exchange types?

amqqueue:with/{2,3} is probably what you're after: from there you can
get the #amqqueue record, which contains arguments.

binding:list_for_source/1, binding:list_for_destination/1 et al are what
you want for bindings. From the results, you'll have a list of #binding
records, which contain args.

> Will I need to look this up in mnesia or something?

Yes, but don't do so directly. Use the APIs we provide.

Matthew

From matthew at rabbitmq.com  Fri May 13 12:30:25 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:30:25 +0100
Subject: [rabbitmq-discuss] Cluster, shovel,
 how to accomplish this scenario?
In-Reply-To: <21390390.254.1303993166036.JavaMail.geo-discussion-forums@vbvc21>
References: <21390390.254.1303993166036.JavaMail.geo-discussion-forums@vbvc21>
Message-ID: <20110513113024.GG10457@rabbitmq.com>

On Thu, Apr 28, 2011 at 05:19:26AM -0700, Simone wrote:
> I need to have two instances of the server located in two different and 
> distant places connected by a network link with limited bandwidth. Clients 
> need to be able to connect to their nearest instance only and to communicate 
> with clients connected to the other server instance using the least 
> bandwidth possible. Is this accomplished using clustering, shovel or do they 
> have a different purpose? In any case, how would I set-up the infrastructure 
> described above?

Clustering is unlikely to work well over a WAN because Erlang's
clustering (specifically mnesia) doesn't cope well with recovery from
partitions.

Shovel is an alternative but can only do static configuration. If you
have, or can arrange at the boundaries between your two systems, a fixed
number of queues then the shovel can work well. However, note that with
clustering, you have one logical broker. With shovel, you do not: you
have two distinct brokers.

Matthew

From simon at rabbitmq.com  Fri May 13 12:35:25 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 May 2011 12:35:25 +0100
Subject: [rabbitmq-discuss] Help tracking down disconnection locations
 in	code
In-Reply-To: <4DCD143C.6070909@rabbitmq.com>
References: <BA9F7F74C9094BF3BAD45C693DF9648D@myyearbook.com>
	<4DCD143C.6070909@rabbitmq.com>
Message-ID: <4DCD177D.3000002@rabbitmq.com>

On 13/05/11 12:21, Simon MacMullen wrote:
> The only exception is for errors that
> happen while the connection is being established (is that what you're
> asking about? - in which case I think it's permissions as you already
> know, framing errors and internal errors.)

Gah, not quite true. The "silent" disconnections include anything that 
goes wrong before sending connection.open-ok, which at a quick glance at 
rabbit_reader looks like the possibilities listed above plus the 
requested frame_max being out of bounds. In theory it could be that 
heartbeat or channel_max could be out of bounds too, but in practice our 
"negotiation" for those options is to grant whatever the client asks for.

I don't like this bit of the spec.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Fri May 13 12:36:23 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:36:23 +0100
Subject: [rabbitmq-discuss] Problem while one of clients crashes.
In-Reply-To: <2d184cd7.73831287.4dc64ac4.d2ae1@o2.pl>
References: <2d184cd7.73831287.4dc64ac4.d2ae1@o2.pl>
Message-ID: <20110513113623.GH10457@rabbitmq.com>

Hi Krzysztof,

On Sun, May 08, 2011 at 09:48:20AM +0200, rabbitmq wrote:
> I'm using rabbit version 1.7.1,

Please don't. 1.7.1 is ancient. Please upgrade.

> I've observed a strange behavior.  When i have two consumers (A,B) and
> one of them (A) is closed unexpectedly (so without closing channel etc
> - for example forced shutdown) than the server still shows that two
> clients are connected, and is trying to send message to this
> terminated client (A).This results in having unacknowledged message in
> the queue. In most cases after some time this connection is timed out
> and message is returned to queue and processed by the other client
> (B).

Right, that sounds like a TCP FIN not getting through or some such issue
which is causing the server to keep the socket open until some timeout
occurs. You might try setting the heartbeat parameters on the
connections.

> But it also often happens that even though connection is timed
> out the unacknowledged message still remains and is blocking the other
> client (B). Other messages are waiting in the queue unconsumed. When
> new client  (C) is connected to server then all waiting massages are
> consumed by the new client. So there are two clients again (B,C). Now
> when the old client (B) is being closed and disconnected from server ,
> this unacknowledged message remains and starts blocking remaining
> client (C).  Messages are stuck in queue.
> 
> What could be the reason of such behavior? Maybe it is a known bug? Maybe some walk-arounds?

I'm afraid I've no idea. Thousands of bugs have been created and
possibly more fixed since 1.7.1. I have very little recollection of how
most things worked back then.

Matthew

From matthew at rabbitmq.com  Fri May 13 12:40:13 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:40:13 +0100
Subject: [rabbitmq-discuss] Best Practices using Connection and Channels
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D5024@srv-opus-02.opus.net>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A0D5024@srv-opus-02.opus.net>
Message-ID: <20110513114013.GI10457@rabbitmq.com>

On Fri, May 06, 2011 at 11:40:48AM -0300, Marcus Vinitius Baffa wrote:
> *         1 Connection per application or 1 Connection per Client;

For the numbers you're talking about, 1 connection per application is
not going to be an issue. The IPC et al to do 1 connection per client is
likely going to be quite painful to do, so I'd not recommend that.

> *         1 Channel per Exchange/Queue and/or Thread. If the application
> has more than one thread each one must create a new channel using the
> same application/client connection. 

1 Channel per Thread is definitely best practise. Certainly in the Java
client it's unwise to share channels between threads, and I suspect the
same is true of the .net client.

> *         Some people advise to create a Channel Pools, is it a good
> practice. 

Generally no, because channels are stateful, and thus it's difficult to
ensure that a random channel grabbed from a pool is indeed in the
expected state. This is especially true of things like publisher
confirms, transactions etc.

Matthew

From matthew at rabbitmq.com  Fri May 13 12:42:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:42:35 +0100
Subject: [rabbitmq-discuss] rabbitmq + ejabberd
In-Reply-To: <BANLkTiktKTaHPOqAeZ-JB=k-a95VFk76Zg@mail.gmail.com>
References: <BANLkTiktKTaHPOqAeZ-JB=k-a95VFk76Zg@mail.gmail.com>
Message-ID: <20110513114234.GA26681@rabbitmq.com>

On Sun, Apr 24, 2011 at 09:34:55PM +0200, aw4y wrote:
> http://ndpar.blogspot.com/2010/03/integrating-rabbitmq-with-ejabberd.html
> and of course this:
> http://hg.rabbitmq.com/rabbitmq-xmpp/raw-file/default/doc/index.html

Yeah, I'm afraid the xmpp plugin is badly bitrotted. It's been unloved
for many many months.

Matthew

From matthew at rabbitmq.com  Fri May 13 12:46:36 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:46:36 +0100
Subject: [rabbitmq-discuss] Problems With OCF Script - Race between
 start and wait
In-Reply-To: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FE22A@EXMB02OSG.eclg.org>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2F848D@EXMB02OSG.eclg.org>
	<20110509155434.GG32738@rabbitmq.com>
	<1C7E61787A08F34BBBBD9E7A7CBC368B0A2FE22A@EXMB02OSG.eclg.org>
Message-ID: <20110513114636.GB26681@rabbitmq.com>

On Mon, May 09, 2011 at 11:23:28PM +0000, Chris Chew wrote:
> Yes, I am seeing that 5 second wait behavior from rabbitmqctl, it's
> just that apparently 5 seconds is not long enough for the rabbit node
> to boot when using this shared volume as the mnesia_base.  I'm
> wondering if the rabbit_start() function should have a "spinner" built
> in just like the rabbit_stop() function has.

I think we should probably just wait indefinitely provided the pid that
we get back from the setsid is still alive (i.e. kill -0 $PID doesn't
error). Magic numbers are evil, and bumping 5 to 30 is no less evil.

> I can "fix" the problem by simply adding a `sleep 2` inside the rabbit_start() function like this:
> 
> ========================================================================
> rabbit_start() {
>     ...
>     setsid sh -c "$RABBITMQ_SERVER > ${RABBITMQ_LOG_BASE}/startup_log 2> ${RABBITMQ_LOG_BASE}/startup_err" &
> 
>     # Wait for the server to come up.
>     # Let the CRM/LRM time us out if required
>     
>     sleep 2  #Chris: Just like Pete Rose, we want rabbitmqctl to lose the race between it and the rabbit-server vm startup...
> 
>     rabbit_wait
>     ...
> ========================================================================
> 
> ...of course the "sleep <arbitrary amount of time>" is not a proper
> fix.  I noticed the rabbit_stop() function has a "spinner" that waits
> for rabbit to shut down, deferring to the cluster stack to abort the
> process upon timeout...does it make sense to add the same type of wait
> loop for rabbit_start() and push the concern of the timeout into the
> cluster stack?

Yes, and OCF is very much in favour of that. But I think OCF can do that
even if the actual script doing the booting of Rabbit is blocked waiting
for it to come up.

Thanks for the details. I'll file a bug.

Matthew

From matthew at rabbitmq.com  Fri May 13 12:57:28 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 12:57:28 +0100
Subject: [rabbitmq-discuss] mail loop problem with shovel
In-Reply-To: <BANLkTimKmfbMTgEUCCmmLmZ_v_HRou+eiQ@mail.gmail.com>
References: <BANLkTimKmfbMTgEUCCmmLmZ_v_HRou+eiQ@mail.gmail.com>
Message-ID: <20110513115728.GC26681@rabbitmq.com>

Hi Pradeep,

On Thu, May 12, 2011 at 04:44:03PM +0530, Pradeep Jindal wrote:
> I have two brokers in different data centers, both the brokers serve the
> same purpose. I wanted to see messages from broker1's "/topic/test" in
> broker2's "/topic/test" and vice-versa. So, i tried configuring shovel
> plugin, but it's going in a loop.

Yes, it will do. Routing keys/binding keys give you conditional
branching, but sadly there's no form of assignment, so it's not
Turing-complete. Bit of a shame really... :(

One solution to this is to use exchange-to-exchange bindings. ASCII art
to the rescue:

              /---------------------[ Shovel 2 ]---------------------\
              |                                                      |
              V                                                      |
--->[X1]--->[X2]---->[[my queues]]        [[my queues]]<---[X2]<---[X1]<---
     |                                                       ^
     |                                                       |
     \------------------[ Shovel 1 ]-------------------------/

So the point is that the shovel injects msgs into the other broker
_below_ the point at which its own shovel copies msgs out.

Matthew

From matthew at rabbitmq.com  Fri May 13 13:02:41 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 13:02:41 +0100
Subject: [rabbitmq-discuss] Erlang Client Changes Since 2.2.0?
In-Reply-To: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FF701@EXMB02OSG.eclg.org>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FF701@EXMB02OSG.eclg.org>
Message-ID: <20110513120241.GD26681@rabbitmq.com>

Hi Chris,

On Thu, May 12, 2011 at 06:06:33PM +0000, Chris Chew wrote:
> I'm getting ready to freshen my instance of the erlang client as part
> of an upcoming release of our message bus.  Is there a concise list of
> changes and/or upgrade steps for the erlang client from 2.2.0 to
> 2.4.1?

Erm, no. And you'll be delighted to hear that some more API changes are
in the pipeline too...

> You do a great job with this with the java and .net clients, but I
> don't see the analog for the erlang client.  There are a bunch of
> commits in the hg repo since that time of 2.2.0, but I'd love to be
> able to just skim past them...

Yeah, the problem is that the Erlang client "is not yet a supported
client". It's very close to being there though: beyond the upcoming
changes there's not much more that's in store for it and so it should
enter a more stable period a la the Java and .Net clients.

> If there is no such summary, is there anything I should know up-front
> about the changes?

I can't remember the state of things in 2.2.0!

Things like amqp_connection:start and :open_channel now return {ok,
Thing} rather than just Thing. The main changes have been dealing with
errors in a consistent and predictable way. Without working through all
the bugs myself, I'm not really able to produce a summary. Possibly one
sane way of finding out what's changed is to look at the merges to
default of something like the shovel, which is really just a program
using the erlang client and is also entirely in maintanance mode. Thus
changes that have affected the shovel are also likely to affect you.

Best wishes,

Matthew

From matthew at rabbitmq.com  Fri May 13 13:10:36 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 13:10:36 +0100
Subject: [rabbitmq-discuss] Writing to the mnesia table rabbit_queue,
 bad idea?
In-Reply-To: <4DCD00CA.80705@rabbitmq.com>
References: <BANLkTik0SmhUe3LKXvfYGwrdsy4cG4GAHA@mail.gmail.com>
	<4DCD00CA.80705@rabbitmq.com>
Message-ID: <20110513121035.GE26681@rabbitmq.com>

On Fri, May 13, 2011 at 10:58:34AM +0100, Simon MacMullen wrote:
> Depends how you define "bad idea". In terms of today's
> implementation you should be fine, as long as you don't expect (for
> example) to be able to flip the durability field and have that mean
> something.

It's a very bad idea. For one thing, Rabbit assumes that the queue
record is unaltered after the queue has been created. Consequently the
amqqueue_process process takes a copy of the #amqqueue record and holds
it in its state. It never updates it. So if you change the copy in
mnesia, then you subsquently have divergence between the queue process's
copy, and the mnesia copy. This can lead to suprising results.

For example if you issue amqqueue:info on a queue then it'll go through
to the queue and not mnesia. Thus you'll find that results in management
and in rabbitmqctl now don't match.

You then have things like the property that queue redeclaration should
fail if arguments do not match (semantically) the original declaration.
But this only goes as far as mnesia. Consequently, you will have the
queue, if you interrogate it, claiming its arguments are one thing, but
if you try to redeclare the queue with those arguments, you can find
it'll fail because the mnesia copy is different.

Finally, you'll have the fact that if the broker is restarted, you'll
have the queues recovered with their arguments taken from mnesia. So
suddenly on startup, you'll have queues being restarted with different
arguments from that which they were last running with.

Matthew

From yaohui1984 at qq.com  Fri May 13 13:17:17 2011
From: yaohui1984 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Fri, 13 May 2011 20:17:17 +0800
Subject: [rabbitmq-discuss] Problem rabbitmq crash
Message-ID: <tencent_4988A2135BD79A03203B9E10@qq.com>

Rabbitmq 2.2 crash whith lots of messages in queues but less than memory limit.
  
 I found that :
 1. the memory of machine is not enougth that would cause this problem
 2. when delete lots of messages would make mq crash
  
 anyone can't explain that?
 thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110513/97d25547/attachment.htm>

From matthew at rabbitmq.com  Fri May 13 13:25:48 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 13:25:48 +0100
Subject: [rabbitmq-discuss] Problem rabbitmq crash
In-Reply-To: <tencent_4988A2135BD79A03203B9E10@qq.com>
References: <tencent_4988A2135BD79A03203B9E10@qq.com>
Message-ID: <20110513122548.GF26681@rabbitmq.com>

On Fri, May 13, 2011 at 08:17:17PM +0800, yaohui wrote:
>  I found that :
>  1. the memory of machine is not enougth that would cause this problem
>  2. when delete lots of messages would make mq crash

Can you elaborate on what you mean by "delete lots of messages would
make mq crash". You can't "delete" a message...

Also, please try upgrading to the latest, 2.4.1.

Matthew

From emile at rabbitmq.com  Fri May 13 14:17:42 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 May 2011 14:17:42 +0100
Subject: [rabbitmq-discuss] Does RabbitMQ have an embedded broker plugin
 for Maven similar to the AciveMQ one?
In-Reply-To: <952B54BDFDFADF44B961AB66E1DB4A73167859A2EC@ukicdpostal9000.icd.192.com>
References: <952B54BDFDFADF44B961AB66E1DB4A73167859A2EC@ukicdpostal9000.icd.192.com>
Message-ID: <4DCD2F76.2060409@rabbitmq.com>

Hi Linley,

On 12/05/11 15:39, Linley Smith wrote:
> Hi,
>
> We are starting to use RabbitMQ and would like to have our projects
> configured for continuous integration testing using an embedded broker
> within the JVM. Does RabbitMQ have something similar to the ActiveMQ
> one:
> http://activemq.apache.org/how-do-i-embed-a-broker-inside-a-connection.html?

RabbitMQ runs in an Erlang VM, which is quite different from the JVM. 
Something conceptually similar is possible though. RabbitMQ is an Erlang 
application and it is possible to run a RabbitMQ broker in the same 
Erlang VM with another set of applications. RabbitMQ normally runs in a 
dedicated Erlang VM though.

It is also possible to run the Erlang AMQP client in the same Erlang VM 
as the broker. This removes a network hop and serialisation steps. See 
the description of the direct driver in
http://www.rabbitmq.com/erlang-client-user-guide.html#model

> Also, is there a plugin that can boot up the broker similar to this:
> http://activemq.apache.org/maven2-activemq-broker-plugin.html?

Maven is able to load and execute Java bytecode within the same JVM. It 
is not possible to execute an Erlang application in this way. It is 
possible for maven to launch RabbitMQ and the Erlang VM as an external 
process.



-Emile

From videlalvaro at gmail.com  Fri May 13 14:51:09 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 May 2011 15:51:09 +0200
Subject: [rabbitmq-discuss] Problem rabbitmq crash
In-Reply-To: <20110513122548.GF26681@rabbitmq.com>
References: <tencent_4988A2135BD79A03203B9E10@qq.com>
	<20110513122548.GF26681@rabbitmq.com>
Message-ID: <D2745DE5-5CCE-4D6C-8D42-C2AC20125B83@gmail.com>

Probably he refers to a bug that was in an older version of RabbitMQ? I don't remember which one, but I recall that purging a queue with many messages will make RabbitMQ crash, or go very very slow.

If that's the case, then upgrading should do. 

On May 13, 2011, at 2:25 PM, Matthew Sackman wrote:

> On Fri, May 13, 2011 at 08:17:17PM +0800, yaohui wrote:
>> I found that :
>> 1. the memory of machine is not enougth that would cause this problem
>> 2. when delete lots of messages would make mq crash
> 
> Can you elaborate on what you mean by "delete lots of messages would
> make mq crash". You can't "delete" a message...
> 
> Also, please try upgrading to the latest, 2.4.1.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From yaohui1984 at qq.com  Fri May 13 14:59:31 2011
From: yaohui1984 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Fri, 13 May 2011 21:59:31 +0800
Subject: [rabbitmq-discuss] Problem rabbitmq crash
Message-ID: <tencent_7A70B680101206D45AF74238@qq.com>

>Can you elaborate on what you mean by "delete lots of messages would
>make mq crash". You can't "delete" a message...

>Also, please try upgrading to the latest, 2.4.1.



I delete messages from queues with plugins web UI management. after a while i can't connect with rabbitmq.


I do a test delete lots of message, it costs a lot of time. During that time, i can't connect, after being deleted, i can connect.


The lastest release will be better?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110513/4105b645/attachment.htm>

From videlalvaro at gmail.com  Fri May 13 15:43:54 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 May 2011 16:43:54 +0200
Subject: [rabbitmq-discuss] Experiments with the fanout exchange and
	many queues
In-Reply-To: <4DCC0C20.4010703@rabbitmq.com>
References: <EB6876A2-C89C-4DA2-B042-9F3566258E95@gmail.com>
	<4DCC0C20.4010703@rabbitmq.com>
Message-ID: <AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>

Hi,

I think I have a pretty convincing theory of why the fanout exchange is slow when is bound to too many queues. The problem is that it does crash the server when this happens.

1) On rabbit_exchange_type_fanout:route there's a full Mnesia table scan. That's really slow and AFAIK is not Mnesia's best part. I've encountered problems like that with Mnesia when I tried to use it for other projects. Also the same table scan is done by the rabbit_exchange_type_direct:route call. If I'm not mistaken no indexes are used here.

2) This table scan is made to obtain a list of rabbit_types:binding_destination which will be or queue names, or exchange names. Then? that's used on rabbit_router:lookup_qpids/1to finally get the QPids. For each queue name that the previous call returned, a mnesia:dirty_read({rabbit_queue, QName}) operation is performed.

3) Then finally the message is delivered to the queue.

Imagine this process happening for each of the 5000 msgs/sec. I think is not optimal. I'm sure your devs know about it. I understand that having a reliable persister is more important than a fanout exchange that works for 1000s queues. Really, I don't see what's the use case of that, besides for a Game or a Chat App.

After I created 500 queues bound to one fanout exchange I ran mnesia:info() on the RabbitMQ node., I've got this:

rabbit_queue   : with 500      records occupying 14822    words of mem
rabbit_route   : with 1000     records occupying 47112    words of mem

The rabbit_route table will be scanned to obtain the queue names, then the rabbit_queue will get *dirty_read* 500 times to get the qpids.

How would I optimize this?

1) on Mnesia I will have a map like this:  rabbit_exchange:name() -> [rabbit_types:binding_destination], probably on a new table managed by the exchange. So in one operation I can get all the bindings, instead of scanning a Mnesia table. (I'm pretty sure this is the main problem). The problem here is to find the right data structure that is easy to update in case of binding removals. I think a list wouldn't do in this case. I was looking into the gb_trees module and some others, but I'm really not sure in this particular case. I don't know if the data structure used for the topic exchange will help here, I've probably have to read some papers about it.

The next set changes seems doable, but will require changes on many places of RabbitMQ's code.

2) I would alter the rabbit_route table definition, so the #route{} record will also have the Pid to the Queue. If I'm not mistaken, the rabbit_route can also contain alternate exchanges inside, so that could present a problem. By having the Queue Pid on this record, there's no need for all the mnesia:dirty_read operations mentioned before. 

What problems can this present? When the server restarts and it has to bring back all the persistent queues, then the Pids stored on Mnesia are meaningless. This means that once the Queue is back up, then this record will have to get updated. Here we have the tradeoff of a slower start up, but the message routing will be faster. Same has to be taken into account when declaring a queue, that is, to store the QPid in the respective rabbit_route record if needed.

In my point of view, a RabbitMQ server is doing much more *route* calls than queue_declare, or server restarts. So I think this should be worth trying.

Cheers,

Alvaro


On May 12, 2011, at 6:34 PM, Simon MacMullen wrote:

> On 12/05/11 16:17, Alvaro Videla wrote:
>> Please keep in mind that in my case I don't consider this use case a
>> typical one, far from it. Still it might be useful for you guys to be
>> able to easily reproduce this.
> 
> Thanks.
> 
> It pains me to say it, but I suspect the management plugin to be the source of most of your problems. Currently it doesn't deal very well with large numbers (many thousands) of queues, all of which are active at once, or with very high rates of connection / channel churn. Switching off fine grained statistics helps quite a bit, but it's still not as good as it should be.
> 
> Coincidentally I've been doing some work in this area (inspired by Ian Ragsdale's recent postings), some of which is starting to bear fruit, so hopefully this sort of scenario will improve in the relatively short term...
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From chrisch at ecollege.com  Fri May 13 16:25:03 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Fri, 13 May 2011 15:25:03 +0000
Subject: [rabbitmq-discuss] Erlang Client Changes Since 2.2.0?
In-Reply-To: <20110513120241.GD26681@rabbitmq.com>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FF701@EXMB02OSG.eclg.org>,
	<20110513120241.GD26681@rabbitmq.com>
Message-ID: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FFBFA@EXMB02OSG.eclg.org>

> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf > > of Matthew Sackman [matthew at rabbitmq.com]
> Sent: Friday, May 13, 2011 6:02 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Erlang Client Changes Since 2.2.0?
> 
> Erm, no. And you'll be delighted to hear that some more API changes are
> in the pipeline too...

I see them!  I'm happy to see the Erlang client continues to grow up.

> > You do a great job with this with the java and .net clients, but I
> > don't see the analog for the erlang client.  There are a bunch of
> > commits in the hg repo since that time of 2.2.0, but I'd love to be
> > able to just skim past them...
> 
> Yeah, the problem is that the Erlang client "is not yet a supported
> client". It's very close to being there though: beyond the upcoming
> changes there's not much more that's in store for it and so it should
> enter a more stable period a la the Java and .Net clients.
> 
> > If there is no such summary, is there anything I should know up-front
> > about the changes?

> I can't remember the state of things in 2.2.0!

In 2.2.0 the connection:start methods had already been refactored between direct and network, functions generally returned standard erlang return values, but the error messages weren't all that consistent yet.

> Things like amqp_connection:start and :open_channel now return {ok,
> Thing} rather than just Thing. The main changes have been dealing with
> errors in a consistent and predictable way. Without working through all
> the bugs myself, I'm not really able to produce a summary. Possibly one
> sane way of finding out what's changed is to look at the merges to
> default of something like the shovel, which is really just a program
> using the erlang client and is also entirely in maintanance mode. Thus
> changes that have affected the shovel are also likely to affect you.

The shovel tip was a good one, thanks for that!

Between reading the shovel changes and the changes in the erlang-client repo itself, I see these highlights:

* Several internal cleanups and a few bug fixes
* Support for publisher confirms
* Better error messages sent back to the parent pid (brought to us by link() instead of monitor(), I think)

Does it sound like enough of the basic picture?

Thanks!

-Chris


From matthew at rabbitmq.com  Fri May 13 16:38:37 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 16:38:37 +0100
Subject: [rabbitmq-discuss] Erlang Client Changes Since 2.2.0?
In-Reply-To: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FFBFA@EXMB02OSG.eclg.org>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A2FF701@EXMB02OSG.eclg.org>
	<20110513120241.GD26681@rabbitmq.com>
	<1C7E61787A08F34BBBBD9E7A7CBC368B0A2FFBFA@EXMB02OSG.eclg.org>
Message-ID: <20110513153837.GM26681@rabbitmq.com>

On Fri, May 13, 2011 at 03:25:03PM +0000, Chris Chew wrote:
> Between reading the shovel changes and the changes in the erlang-client repo itself, I see these highlights:
> 
> * Several internal cleanups and a few bug fixes
> * Support for publisher confirms
> * Better error messages sent back to the parent pid (brought to us by link() instead of monitor(), I think)
> 
> Does it sound like enough of the basic picture?

Yes, I reckon that's probably right - I can't think of anything else,
and yes, it's now a link(), not a monitor().

Matthew

From gmr at myyearbook.com  Fri May 13 17:13:13 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 13 May 2011 12:13:13 -0400
Subject: [rabbitmq-discuss] Writing to the mnesia table rabbit_queue,
 bad idea?
In-Reply-To: <20110513121035.GE26681@rabbitmq.com>
References: <BANLkTik0SmhUe3LKXvfYGwrdsy4cG4GAHA@mail.gmail.com>
	<4DCD00CA.80705@rabbitmq.com> <20110513121035.GE26681@rabbitmq.com>
Message-ID: <9CAF26398CE94FD9B1A17D2013BC9AC8@myyearbook.com>

Matthew,


From matthew at rabbitmq.com  Fri May 13 17:22:37 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 May 2011 17:22:37 +0100
Subject: [rabbitmq-discuss] Writing to the mnesia table rabbit_queue,
 bad idea?
In-Reply-To: <9CAF26398CE94FD9B1A17D2013BC9AC8@myyearbook.com>
References: <BANLkTik0SmhUe3LKXvfYGwrdsy4cG4GAHA@mail.gmail.com>
	<4DCD00CA.80705@rabbitmq.com> <20110513121035.GE26681@rabbitmq.com>
	<9CAF26398CE94FD9B1A17D2013BC9AC8@myyearbook.com>
Message-ID: <20110513162236.GO26681@rabbitmq.com>

On Fri, May 13, 2011 at 12:13:13PM -0400, Gavin M. Roy wrote:
> From your perspective is there any way to do this that's not a bad
> idea while not impacting production queue use?

No. There are implementation details of Rabbit that make the assumption
this will never happen.

> Your points are valid,
> however since they're arguments and Rabbit doesn't care about or use
> arguments, I wonder how impacting it can be.

Incorrect. Arguments can contain things like queue expiry, or queue
message ttl, or any other extension to queue semantics that we dream up.

That said, with some careful choice, you can be fairly sure to avoid
choosing names that collide with anything we might do, and because
arguments that Rabbit doesn't understand are not semantic altering
anyway, Rabbit will ignore them.

Matthew

From michael.s.klishin at gmail.com  Fri May 13 19:40:40 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 May 2011 22:40:40 +0400
Subject: [rabbitmq-discuss] AMQP 0.8 producers talking to AMQP 0.9.1
 consumers: how dangerous is this idea?
Message-ID: <7D96475953F640A9A046F9BC261E8EDF@gmail.com>

Hi,

I am facing a situation when (because of library versions I cannot yet upgrade), AMQP 0.8 producers need talking to AMQP 0.9.1 consumers. I tried 0.9.1 producer and 0.8 consumer so far (so, the opposite way) and messages are delivered as expected.

Is this a dangerous endeavor? Are there any known issues? All my apps need is what 0.8 spec has, no advanced features or RabbitMQ-specific extensions. Just publish messages here, process them there.


Thoughts? Thank you.
-- 
MK


From aaron at agoragames.com  Fri May 13 20:06:57 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Fri, 13 May 2011 15:06:57 -0400
Subject: [rabbitmq-discuss] Preview Release of Haigha
Message-ID: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>

I'm pleased to announce that we finally have a preview release of
haigha, our Python AMQP client library built off libevent, available
on github and pypi. See the repo for documentation, examples and
installation instructions. I hope everyone finds this useful, and I
look forward to your feedback.

https://github.com/agoragames/haigha
http://pypi.python.org/pypi/haigha

cheers,
Aaron

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From simone.busoli at gmail.com  Sat May 14 01:19:28 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 14 May 2011 02:19:28 +0200
Subject: [rabbitmq-discuss] Cluster, shovel,
	how to accomplish this scenario?
In-Reply-To: <20110513113024.GG10457@rabbitmq.com>
References: <21390390.254.1303993166036.JavaMail.geo-discussion-forums@vbvc21>
	<20110513113024.GG10457@rabbitmq.com>
Message-ID: <BANLkTi=-x9ScdjAoSLYZXPkgcv5dHB05EQ@mail.gmail.com>

Thanks Matthew, that's something I have figured out in the meanwhile, and
it's unfortunate that there is not built-in support for something like this.

On Fri, May 13, 2011 at 13:30, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Thu, Apr 28, 2011 at 05:19:26AM -0700, Simone wrote:
> > I need to have two instances of the server located in two different and
> > distant places connected by a network link with limited bandwidth.
> Clients
> > need to be able to connect to their nearest instance only and to
> communicate
> > with clients connected to the other server instance using the least
> > bandwidth possible. Is this accomplished using clustering, shovel or do
> they
> > have a different purpose? In any case, how would I set-up the
> infrastructure
> > described above?
>
> Clustering is unlikely to work well over a WAN because Erlang's
> clustering (specifically mnesia) doesn't cope well with recovery from
> partitions.
>
> Shovel is an alternative but can only do static configuration. If you
> have, or can arrange at the boundaries between your two systems, a fixed
> number of queues then the shovel can work well. However, note that with
> clustering, you have one logical broker. With shovel, you do not: you
> have two distinct brokers.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110514/82ac3dc5/attachment.htm>

From videlalvaro at gmail.com  Sat May 14 12:07:49 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 14 May 2011 13:07:49 +0200
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
Message-ID: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>

Hi,

I was reading the blog post about the improved topic exchange: http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routing-part-2/

I see some nice graphs there, so I was wondering which tool do you guys used to stress test / benchmark the exchange.

My main goal is to be able to measure routing speed while I try different approaches for storing the bindings. 

I tried creating an alternate_fanout exchange, storing the bindings in a gb_tree, dicts, and plain lists? still I can see much improvement compared to the default fanout exchange. My goal was to avoid the mnesia:dirty_select() done at rabbit_router:match_routing_key.

Regards,

Alvaro

From matthew at rabbitmq.com  Sat May 14 12:32:41 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 14 May 2011 12:32:41 +0100
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
In-Reply-To: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>
	<AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>
Message-ID: <20110514113240.GB11419@wellquite.org>

On Sat, May 14, 2011 at 01:07:49PM +0200, Alvaro Videla wrote:
> I tried creating an alternate_fanout exchange, storing the bindings in
> a gb_tree, dicts, and plain lists? still I can see much improvement
> compared to the default fanout exchange. My goal was to avoid the
> mnesia:dirty_select() done at rabbit_router:match_routing_key.

Have you tried benchmarking mnesia:dirty_select? I think you'll find
it's actually pretty quick.

Also, in the context of a fanout exchange with many thousands of
bindings, you're basically going to be reading the entire binding table
anyway, so it make no difference whether you're able to use indices or
not.

Also rabbit_route is an orderedset table. The key of #route is #binding.
#binding is (obviously) just a tuple, and we fill as much as possible
from left to right in the tuple as the matchhead:

-record(binding, {source, key, destination, args = []}).

match_routing_key(SrcName, [RoutingKey]) ->
    MatchHead = #route{binding = #binding{source      = SrcName,
                                          destination = '$1',
                                          key         = RoutingKey,
                                          _           = '_'}},

So we will have {binding, SrcName, RoutingKey, '$1', '_'} as the key to
query on an orderedset table. That's not inefficient.

mnesia:dirty_read is very fast indeed. Please benchmark it. I think
you'll find it's basically the same speed as ets:match_object which is
actually what it'll be doing under the bonnet.


I have not looked into your benchmark, however, what size msgs are you
using? I suspect that if the binary fragments end up under 64 bytes then
that is the cause of memory explosion: each msg is being _copied_ rather
than reference counted to each queue. If you try with msgs with a bigger
payload, I wonder whether you see the same behaviour.

Matthew

From matthew at rabbitmq.com  Sat May 14 12:57:38 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 14 May 2011 12:57:38 +0100
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
In-Reply-To: <20110514113240.GB11419@wellquite.org>
References: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>
	<AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>
	<20110514113240.GB11419@wellquite.org>
Message-ID: <20110514115738.GC11419@wellquite.org>

On Sat, May 14, 2011 at 12:32:41PM +0100, Matthew Sackman wrote:
> I have not looked into your benchmark, however, what size msgs are you
> using? I suspect that if the binary fragments end up under 64 bytes then
> that is the cause of memory explosion: each msg is being _copied_ rather
> than reference counted to each queue. If you try with msgs with a bigger
> payload, I wonder whether you see the same behaviour.

Hmm, I've changed my mind on that. Even with 64-byte binaries being
copied to 8k queues, we're only talking 0.5MB, which is very unlikely to
be an issue unless the binary alloctor is horribly slow, which I'm
fairly sure it's not.

Matthew

From videlalvaro at gmail.com  Sat May 14 13:51:54 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 14 May 2011 14:51:54 +0200
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
In-Reply-To: <20110514115738.GC11419@wellquite.org>
References: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>
	<AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>
	<20110514113240.GB11419@wellquite.org>
	<20110514115738.GC11419@wellquite.org>
Message-ID: <32294DA8-578B-45D8-8A45-F73A1DC46D40@gmail.com>

Hi Matthew,

Here's my na?ve implementation of the exchange: 
	
	https://github.com/videlalvaro/rabbitmq-alternate-fanout

The binding storage seems to be suboptimal. I think the main difference with the default fanout is how it retrieves the list of matches for the *route* call.

Then this repo has the code for the benchmarks. I've just updated it, with the instructions I used on my machine: 

	https://github.com/videlalvaro/massive_fanout

To get the memory *explosion* thing happening, I had to set up the memory_high_watermark to 0.1 for my 4gb Mac. In the real world nobody will do that I guess.

I tried with 5000 queues. To do that perform this call:

	alternate_fanout:start(5000).

The README of the massive_fanout repo explain the usage.

As a side note, from my point of view my benchmarks are not scientific at all, I would compare them with those useless "hello world" benchmarks for web frameworks. So as RabbitMQ user I wouldn't be concerned about the results. It was interesting for me to run them and I think I learned quite a bit of RabbitMQ internals.

-Alvaro

On May 14, 2011, at 1:57 PM, Matthew Sackman wrote:

> On Sat, May 14, 2011 at 12:32:41PM +0100, Matthew Sackman wrote:
>> I have not looked into your benchmark, however, what size msgs are you
>> using? I suspect that if the binary fragments end up under 64 bytes then
>> that is the cause of memory explosion: each msg is being _copied_ rather
>> than reference counted to each queue. If you try with msgs with a bigger
>> payload, I wonder whether you see the same behaviour.
> 
> Hmm, I've changed my mind on that. Even with 64-byte binaries being
> copied to 8k queues, we're only talking 0.5MB, which is very unlikely to
> be an issue unless the binary alloctor is horribly slow, which I'm
> fairly sure it's not.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From matthias at rabbitmq.com  Sat May 14 14:42:35 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 14 May 2011 14:42:35 +0100
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
In-Reply-To: <32294DA8-578B-45D8-8A45-F73A1DC46D40@gmail.com>
References: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>	<AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>	<20110514113240.GB11419@wellquite.org>	<20110514115738.GC11419@wellquite.org>
	<32294DA8-578B-45D8-8A45-F73A1DC46D40@gmail.com>
Message-ID: <4DCE86CB.9050300@rabbitmq.com>

Alvaro,

Alvaro Videla wrote:
> Here's my na?ve implementation of the exchange:  
> https://github.com/videlalvaro/rabbitmq-alternate-fanout
> 
> The binding storage seems to be suboptimal. I think the main
> difference with the default fanout is how it retrieves the list of
> matches for the *route* call.

The representation chosen there results in O(n^2) time complexity for 
binding addition and removal.

Btw, for massive fanout the bulk of the time and space complexity is 
likely in the distribution of the messages to the queues, storage of the 
messages in the queues, and sending of the messages to consumers. The 
routing logic should only take up a fraction of the overall time, so by 
Amdahl's law any improvements there will have little impact on the 
overall performance.

Matthias.

From videlalvaro at gmail.com  Sat May 14 15:02:05 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 14 May 2011 16:02:05 +0200
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
In-Reply-To: <4DCE86CB.9050300@rabbitmq.com>
References: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>	<AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>	<20110514113240.GB11419@wellquite.org>	<20110514115738.GC11419@wellquite.org>
	<32294DA8-578B-45D8-8A45-F73A1DC46D40@gmail.com>
	<4DCE86CB.9050300@rabbitmq.com>
Message-ID: <A1A9378F-8190-4310-845C-22C553644944@gmail.com>

Matthias,

Yes, the binding add/removal is slow. In that case I thought that is more common to be routing messages than adding removing bindings.

Also my goal was to easily get an implementation to see if the route part could be improved by skipping the mnesia:dirty_select. One reason I thought Mnesia could be a problem was because I started getting logs like: Mnesia(rabbit at mrhyde): ** WARNING ** Mnesia is overloaded?

My reasoning was that scanning the table every time a message is routed could be slower than just returning a somehow cached list of bindings, which is what I tried to do.

As you say if the bulk of the job for message routing is done somewhere else, then of course optimizing here won't matter that much. Is like when people get their uber fast web frameworks for hello world benchmarks but then writing or reading form MySQL makes the app slow.

BTW, thanks for taking the time of testing all this.

Alvaro

On May 14, 2011, at 3:42 PM, Matthias Radestock wrote:

> Alvaro,
> 
> Alvaro Videla wrote:
>> Here's my na?ve implementation of the exchange:  https://github.com/videlalvaro/rabbitmq-alternate-fanout
>> The binding storage seems to be suboptimal. I think the main
>> difference with the default fanout is how it retrieves the list of
>> matches for the *route* call.
> 
> The representation chosen there results in O(n^2) time complexity for binding addition and removal.
> 
> Btw, for massive fanout the bulk of the time and space complexity is likely in the distribution of the messages to the queues, storage of the messages in the queues, and sending of the messages to consumers. The routing logic should only take up a fraction of the overall time, so by Amdahl's law any improvements there will have little impact on the overall performance.
> 
> Matthias.

Sent form my Nokia 1100




From mikeb at rabbitmq.com  Sat May 14 21:22:12 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Sat, 14 May 2011 21:22:12 +0100
Subject: [rabbitmq-discuss] AMQP 0.8 producers talking to AMQP 0.9.1
 consumers: how dangerous is this idea?
In-Reply-To: <7D96475953F640A9A046F9BC261E8EDF@gmail.com>
References: <7D96475953F640A9A046F9BC261E8EDF@gmail.com>
Message-ID: <4DCEE474.5080807@rabbitmq.com>

Michael,

> I am facing a situation when (because of library versions I cannot
> yet upgrade), AMQP 0.8 producers need talking to AMQP 0.9.1
> consumers. I tried 0.9.1 producer and 0.8 consumer so far (so, the
> opposite way) and messages are delivered as expected.
>
> Is this a dangerous endeavor? Are there any known issues? All my apps
> need is what 0.8 spec has, no advanced features or RabbitMQ-specific
> extensions. Just publish messages here, process them there.

You will be relieved to know this is safe.  The respective clients will 
paper over differences in most cases, and RabbitMQ will send the correct 
frames for each client.

Message format didn't change between 0-8 and 0-9-1; and very few frames 
changed, except to rename fields.  The changes were largely in 
semantics, deprecating (renaming) a few fields, different error codes, 
and dropping unused features.

For the record, there's a list of differences at
http://dev.rabbitmq.com/wiki/Amqp08To091

Regards,
Michael

From brian at agoragames.com  Sun May 15 01:17:53 2011
From: brian at agoragames.com (Brian Corrigan)
Date: Sat, 14 May 2011 20:17:53 -0400
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
Message-ID: <BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>

Aaron -

Wow man, I know how long you guys have been working on this.  Congrats and
really nice work!

-B

On Fri, May 13, 2011 at 3:06 PM, Aaron Westendorf <aaron at agoragames.com>wrote:

> I'm pleased to announce that we finally have a preview release of
> haigha, our Python AMQP client library built off libevent, available
> on github and pypi. See the repo for documentation, examples and
> installation instructions. I hope everyone finds this useful, and I
> look forward to your feedback.
>
> https://github.com/agoragames/haigha
> http://pypi.python.org/pypi/haigha
>
> cheers,
> Aaron
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com
> _______________________________________________
> platform-team mailing list
> platform-team at lists.agoragames.com
> https://lists.agoragames.com/cgi-bin/mailman/listinfo/platform-team
>



-- 
Brian Corrigan
359 Broadway
Troy, NY 12180
W: 518.288.8075 (New)
C: 518.867.1439
Skype: agorabrian
agoragames.com | majorleaguegaming.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110514/a551d345/attachment.htm>

From jasonjwwilliams at gmail.com  Sun May 15 02:40:49 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sat, 14 May 2011 19:40:49 -0600
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
	<BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
Message-ID: <9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>

How does this differ from Pika's asyncore or Tornado bindings in terms of performance?

-J

Sent via iPhone

Is your email Premiere?

On May 14, 2011, at 18:17, Brian Corrigan <brian at agoragames.com> wrote:

> Aaron - 
> 
> Wow man, I know how long you guys have been working on this.  Congrats and really nice work!
> 
> -B
> 
> On Fri, May 13, 2011 at 3:06 PM, Aaron Westendorf <aaron at agoragames.com> wrote:
> I'm pleased to announce that we finally have a preview release of
> haigha, our Python AMQP client library built off libevent, available
> on github and pypi. See the repo for documentation, examples and
> installation instructions. I hope everyone finds this useful, and I
> look forward to your feedback.
> 
> https://github.com/agoragames/haigha
> http://pypi.python.org/pypi/haigha
> 
> cheers,
> Aaron
> 
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com
> _______________________________________________
> platform-team mailing list
> platform-team at lists.agoragames.com
> https://lists.agoragames.com/cgi-bin/mailman/listinfo/platform-team
> 
> 
> 
> -- 
> Brian Corrigan
> 359 Broadway
> Troy, NY 12180
> W: 518.288.8075 (New)
> C: 518.867.1439
> Skype: agorabrian
> agoragames.com | majorleaguegaming.com
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110514/94dbb93d/attachment.htm>

From matthias at rabbitmq.com  Sun May 15 17:58:43 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 15 May 2011 17:58:43 +0100
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
In-Reply-To: <A1A9378F-8190-4310-845C-22C553644944@gmail.com>
References: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>	<AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>	<20110514113240.GB11419@wellquite.org>	<20110514115738.GC11419@wellquite.org>
	<32294DA8-578B-45D8-8A45-F73A1DC46D40@gmail.com>
	<4DCE86CB.9050300@rabbitmq.com>
	<A1A9378F-8190-4310-845C-22C553644944@gmail.com>
Message-ID: <4DD00643.50702@rabbitmq.com>

Alvaro,

Alvaro Videla wrote:
> Yes, the binding add/removal is slow. In that case I thought that is
> more common to be routing messages than adding removing bindings.

Given that you were trying to optimise massive fanout, the binding count 
will be high, so the O(n^2) time complexity on add/remove really hurts 
and imposes a limit on the fanout degree which is way lower than it 
would be otherwise. I am surprised you haven't come up against this in 
your tests.

> Also my goal was to easily get an implementation to see if the route
> part could be improved by skipping the mnesia:dirty_select. One
> reason I thought Mnesia could be a problem was because I started
> getting logs like: Mnesia(rabbit at mrhyde): ** WARNING ** Mnesia is
> overloaded?

These warnings are issued when mnesia's write-behind logic gets too far, 
er, behind. They are generally harmless. More importantly though they 
cannot originate from dirty_select/read operations. So if you are seeing 
these warnings in your tests they are most likely due to binding 
addition/removal, not routing.

> My reasoning was that scanning the table every time a message is
> routed could be slower than just returning a somehow cached list of
> bindings, which is what I tried to do.

Caching routing results in, say, the channel's process dictionary, can 
indeed yield significant performance gains for some use cases. We have 
experimented with that but trying to apply caching generally turns out 
to be hard. The problem, unsurprisingly, is keeping such caches up to 
date. Particularly when trying to maintain AMQP's quite strict 
visibility guarantees. Another problem is keeping the caches from taking 
up too much memory.


Regards,

Matthias.

From videlalvaro at gmail.com  Sun May 15 18:16:55 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 15 May 2011 19:16:55 +0200
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
In-Reply-To: <4DD00643.50702@rabbitmq.com>
References: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>	<AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>	<20110514113240.GB11419@wellquite.org>	<20110514115738.GC11419@wellquite.org>
	<32294DA8-578B-45D8-8A45-F73A1DC46D40@gmail.com>
	<4DCE86CB.9050300@rabbitmq.com>
	<A1A9378F-8190-4310-845C-22C553644944@gmail.com>
	<4DD00643.50702@rabbitmq.com>
Message-ID: <222F5BBC-5347-422E-BAC5-C9E50C5E0FD6@gmail.com>

Matthias,

I didn't suffer from the add/remove binding problem because in my tests I was just creating the bindings, ?which yes, was really slow (30 secs for 5000 bindings)?, and then routing messages.

So as I said, I was just *stressing* the routing part. That is, I didn't have any new bindings once I started publishing messages.

Regarding the caching? yes I know it can be pretty hard to manage. I already had many nightmares doing caching in web apps. In RabbitMQ's case if you are routing many thousands of messages per second and then there's a bindings coming and going I think things can start to get out of sync pretty easily.

Anyway? it was a lot of fun going around the rabbit internals. I really like all the Erlang specs you have there. That makes it really easy to follow along with the code, understand which parameters to expect and so on.

Regards,

-Alvaro

On May 15, 2011, at 6:58 PM, Matthias Radestock wrote:

> Alvaro,
> 
> Alvaro Videla wrote:
>> Yes, the binding add/removal is slow. In that case I thought that is
>> more common to be routing messages than adding removing bindings.
> 
> Given that you were trying to optimise massive fanout, the binding count will be high, so the O(n^2) time complexity on add/remove really hurts and imposes a limit on the fanout degree which is way lower than it would be otherwise. I am surprised you haven't come up against this in your tests.
> 
>> Also my goal was to easily get an implementation to see if the route
>> part could be improved by skipping the mnesia:dirty_select. One
>> reason I thought Mnesia could be a problem was because I started
>> getting logs like: Mnesia(rabbit at mrhyde): ** WARNING ** Mnesia is
>> overloaded?
> 
> These warnings are issued when mnesia's write-behind logic gets too far, er, behind. They are generally harmless. More importantly though they cannot originate from dirty_select/read operations. So if you are seeing these warnings in your tests they are most likely due to binding addition/removal, not routing.
> 
>> My reasoning was that scanning the table every time a message is
>> routed could be slower than just returning a somehow cached list of
>> bindings, which is what I tried to do.
> 
> Caching routing results in, say, the channel's process dictionary, can indeed yield significant performance gains for some use cases. We have experimented with that but trying to apply caching generally turns out to be hard. The problem, unsurprisingly, is keeping such caches up to date. Particularly when trying to maintain AMQP's quite strict visibility guarantees. Another problem is keeping the caches from taking up too much memory.
> 
> 
> Regards,
> 
> Matthias.

Sent form my Nokia 1100




From aaron at agoragames.com  Sun May 15 18:33:17 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Sun, 15 May 2011 13:33:17 -0400
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
	<BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
	<9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
Message-ID: <BANLkTim6k5ic4kip2GwZm1ey58GX2Zm+ZQ@mail.gmail.com>

I haven't directly compared to pika, but here are some numbers from a
post I made back in April. We forked the py-amqpib library to support
libevent early in 2009, and then late last year re-wrote it from
scratch. The stress_test script included in the haigha source
generated these numbers and could be ported to compare against pika.

Server:
Ubuntu 10.04 2.6.32-24-server x86_64
2 cpu, 6 cores each with hyperthreading, Xeon X5650 @ 2.67GHz
132GB RAM (beam used 500MB max)
Rabbit 2.4.0 in SMP mode, default configuration (-K true -A30 -P 1048576)
1 direct exchange, 6000 queues, 6000 channels each pub-subing their own queue
48k messages/sec

Clients:
Ubuntu 10.04 2.6.32-24-server x86_64
4 VMware hosts, 4 processors each, Xeon X7350 @ 2.93 GHz
3 client processes, 500 channels each

On Sat, May 14, 2011 at 9:40 PM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> How does this differ from Pika's asyncore or Tornado bindings in terms of
> performance?
> -J
> Sent via iPhone
> Is your email Premiere?
> On May 14, 2011, at 18:17, Brian Corrigan <brian at agoragames.com> wrote:
>
> Aaron -
> Wow man, I know how long you guys have been working on this. ?Congrats and
> really nice work!
> -B
>
> On Fri, May 13, 2011 at 3:06 PM, Aaron Westendorf <aaron at agoragames.com>
> wrote:
>>
>> I'm pleased to announce that we finally have a preview release of
>> haigha, our Python AMQP client library built off libevent, available
>> on github and pypi. See the repo for documentation, examples and
>> installation instructions. I hope everyone finds this useful, and I
>> look forward to your feedback.
>>
>> https://github.com/agoragames/haigha
>> http://pypi.python.org/pypi/haigha
>>
>> cheers,
>> Aaron
>>
>> --
>> Aaron Westendorf
>> Senior Software Engineer
>> Agora Games
>> 359 Broadway
>> Troy, NY 12180
>> Phone: 518.268.1000
>> aaron at agoragames.com
>> www.agoragames.com
>> _______________________________________________
>> platform-team mailing list
>> platform-team at lists.agoragames.com
>> https://lists.agoragames.com/cgi-bin/mailman/listinfo/platform-team
>
>
>
> --
> Brian Corrigan
> 359 Broadway
> Troy, NY 12180
> W: 518.288.8075 (New)
> C: 518.867.1439
> Skype: agorabrian
> agoragames.com | majorleaguegaming.com
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthias at rabbitmq.com  Sun May 15 18:36:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 15 May 2011 18:36:10 +0100
Subject: [rabbitmq-discuss] Stress testing RabbitMQ
In-Reply-To: <222F5BBC-5347-422E-BAC5-C9E50C5E0FD6@gmail.com>
References: <096741FE-4B52-4763-A496-9BF7F4EE2FE1@gmail.com>	<AEA52859-55F8-4B0D-9838-ECF40D1AA64A@gmail.com>	<20110514113240.GB11419@wellquite.org>	<20110514115738.GC11419@wellquite.org>
	<32294DA8-578B-45D8-8A45-F73A1DC46D40@gmail.com>
	<4DCE86CB.9050300@rabbitmq.com>
	<A1A9378F-8190-4310-845C-22C553644944@gmail.com>
	<4DD00643.50702@rabbitmq.com>
	<222F5BBC-5347-422E-BAC5-C9E50C5E0FD6@gmail.com>
Message-ID: <4DD00F0A.1040203@rabbitmq.com>

Alvaro,

Alvaro Videla wrote:
> I didn't suffer from the add/remove binding problem because in my 
> tests I was just creating the bindings, ?which yes, was really slow 
> (30 secs for 5000 bindings)?, and then routing messages.

Try 1M bindings. See you in two weeks ;)

> I really like all the Erlang specs you have there. That makes it
> really easy to follow along with the code, understand which
> parameters to expect and so on.

That's what the specs are there for. Very occasionally they reveal a 
bug, but their main purpose is documentation.


Regards,

Matthias.

From matthias at rabbitmq.com  Sun May 15 19:21:30 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 15 May 2011 19:21:30 +0100
Subject: [rabbitmq-discuss] Cluster size limit
In-Reply-To: <BANLkTikiFLA-B4KhExYa21i0JGdzG0s_zA@mail.gmail.com>
References: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>	<20110328171936.GH18713@rabbitmq.com>	<BANLkTinq8qHxnfnpn4fq25bSXXDwZGPT3w@mail.gmail.com>	<20110406144809.GL7558@rabbitmq.com>	<BANLkTi=2dEL8rQJtRaRWbOxr9GU5c1QDDQ@mail.gmail.com>	<20110406150440.GM7558@rabbitmq.com>	<BANLkTi==+DTnDqF0iuzjCQze8k7VJMefWQ@mail.gmail.com>	<20110419105727.GL7850@wellquite.org>
	<BANLkTikiFLA-B4KhExYa21i0JGdzG0s_zA@mail.gmail.com>
Message-ID: <4DD019AA.7060406@rabbitmq.com>

Advait,

Advait Alai wrote:
> I am clearing the /var/lib/rabbitmq/mnesia directory entirely before 
> starting the clustering process -- doesn't that ensure that any 
> persistent objects are cleared?

Yes, it does.

> In any case, I will check the initial conditions of queues, exchanges 
> etc. and get back soon.

Have you managed to resolve the problem in the meantime?


Regards,

Matthias.

From matthias at rabbitmq.com  Sun May 15 19:43:36 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 15 May 2011 19:43:36 +0100
Subject: [rabbitmq-discuss] Question about architecture
In-Reply-To: <FBEFCDAE-12ED-494A-ABD3-2CCF8525B8CE@mac.com>
References: <FBEFCDAE-12ED-494A-ABD3-2CCF8525B8CE@mac.com>
Message-ID: <4DD01ED8.4020404@rabbitmq.com>

Michael,

apologies for the delay in getting back to you...

Michael Beam wrote:
> I'm new to RabbitMQ and AMQP, and I'd like to see what people with
> more experience have to say about exchange & queue design.  I'm
> experimenting with using RabbitMQ to replace a homegrown thrift-based
> messaging solution that is used to relay change notifications from 10
> or so CouchDB databases to several hundred running instances of our
> application.

Interesting. Distribution of DB change notifications seems to be an 
increasingly popular RabbitMQ application.

> My first thought was to create an exchange for each observed database
> observed, each exchange named after the database (i.e.,
> couchdb_changes.db1 ... couchdb_changes.db10).  A routing key would
> be set for messages based on the value of some field in the database
> document. Each client application session would then create and bind
> a queue to each of the exchanges.
> 
> My second thought was that I could create a single exchange named
> "couchdb_changes", and then add the database name to the routing key.
> When binding queues to the exchange the application would also
> incorporate the database name into the routing key.
> 
> So, are there advantages or disadvantages between the two approaches
> here, or are they largely functionally equivalent.  I prefer the feel
> an exchange per observed database; just curious if there are
> established patterns that I should know about to better inform design
> decisions.

I can think of two main criteria to guide your decision here:

1) Is the set of DB names fairly static, or does it change quite often? 
In the one-exchange-per-db model the list of exchanges need to be kept 
in sync with the list of databases, which might be tricky depending on 
how/when the list changes.

2) What kind of subscriptions do you want to support, i.e. how do 
consumers narrow the event stream down to what they want to receive? A 
single topic exchange would give you the most flexibility here, but a 
set of direct exchanges will perform better in most cases.


Regards,

Matthias.

From matthias at rabbitmq.com  Sun May 15 21:13:38 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 15 May 2011 21:13:38 +0100
Subject: [rabbitmq-discuss] .NET API (2.4.1) -- does BasicAcks
 event	ever fire?
In-Reply-To: <BANLkTim6u9VjwssggiaLdpz-6+KNnZEH=A@mail.gmail.com>
References: <BANLkTim6u9VjwssggiaLdpz-6+KNnZEH=A@mail.gmail.com>
Message-ID: <4DD033F2.2050102@rabbitmq.com>

Luke,

Luke Winikates wrote:
> Thanks. That clarifies a lot, and that use case makes a lot more sense.
> 
> The name for this event in the .NET API is much different from its Java 
> counterpart... in a way that seems misleading (perhaps only to me?).

The difference is due to the fact that events are first class in .net 
but not Java.

In the .net client there is one event for each async AMQP command that 
the client can receive on a channel. In that design it is logical and 
sensible to name the events after their corresponding commands.

By contrast, in the Java client we have listener interfaces that group 
related event handling methods. There the *methods* are named after the 
events, with the listener interface name identifying the broader 
functionality (e.g. confirms, consumer).


Regards,

Matthias.

From alexis at rabbitmq.com  Sun May 15 21:18:27 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sun, 15 May 2011 21:18:27 +0100
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <BANLkTim6k5ic4kip2GwZm1ey58GX2Zm+ZQ@mail.gmail.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
	<BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
	<9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
	<BANLkTim6k5ic4kip2GwZm1ey58GX2Zm+ZQ@mail.gmail.com>
Message-ID: <BANLkTimbOHWdmTzCWb9x3V=iF9nw0PvL+A@mail.gmail.com>

Aaron

What is the fanout ratio and is the 48k measuring ingress or total
throughput?  I'm guessing it's 1:1 and ingress.

alexis


On Sun, May 15, 2011 at 6:33 PM, Aaron Westendorf <aaron at agoragames.com> wrote:
> I haven't directly compared to pika, but here are some numbers from a
> post I made back in April. We forked the py-amqpib library to support
> libevent early in 2009, and then late last year re-wrote it from
> scratch. The stress_test script included in the haigha source
> generated these numbers and could be ported to compare against pika.
>
> Server:
> Ubuntu 10.04 2.6.32-24-server x86_64
> 2 cpu, 6 cores each with hyperthreading, Xeon X5650 @ 2.67GHz
> 132GB RAM (beam used 500MB max)
> Rabbit 2.4.0 in SMP mode, default configuration (-K true -A30 -P 1048576)
> 1 direct exchange, 6000 queues, 6000 channels each pub-subing their own queue
> 48k messages/sec
>
> Clients:
> Ubuntu 10.04 2.6.32-24-server x86_64
> 4 VMware hosts, 4 processors each, Xeon X7350 @ 2.93 GHz
> 3 client processes, 500 channels each
>
> On Sat, May 14, 2011 at 9:40 PM, Jason J. W. Williams
> <jasonjwwilliams at gmail.com> wrote:
>> How does this differ from Pika's asyncore or Tornado bindings in terms of
>> performance?
>> -J
>> Sent via iPhone
>> Is your email Premiere?
>> On May 14, 2011, at 18:17, Brian Corrigan <brian at agoragames.com> wrote:
>>
>> Aaron -
>> Wow man, I know how long you guys have been working on this. ?Congrats and
>> really nice work!
>> -B
>>
>> On Fri, May 13, 2011 at 3:06 PM, Aaron Westendorf <aaron at agoragames.com>
>> wrote:
>>>
>>> I'm pleased to announce that we finally have a preview release of
>>> haigha, our Python AMQP client library built off libevent, available
>>> on github and pypi. See the repo for documentation, examples and
>>> installation instructions. I hope everyone finds this useful, and I
>>> look forward to your feedback.
>>>
>>> https://github.com/agoragames/haigha
>>> http://pypi.python.org/pypi/haigha
>>>
>>> cheers,
>>> Aaron
>>>
>>> --
>>> Aaron Westendorf
>>> Senior Software Engineer
>>> Agora Games
>>> 359 Broadway
>>> Troy, NY 12180
>>> Phone: 518.268.1000
>>> aaron at agoragames.com
>>> www.agoragames.com
>>> _______________________________________________
>>> platform-team mailing list
>>> platform-team at lists.agoragames.com
>>> https://lists.agoragames.com/cgi-bin/mailman/listinfo/platform-team
>>
>>
>>
>> --
>> Brian Corrigan
>> 359 Broadway
>> Troy, NY 12180
>> W: 518.288.8075 (New)
>> C: 518.867.1439
>> Skype: agorabrian
>> agoragames.com | majorleaguegaming.com
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From gmr at myyearbook.com  Mon May 16 03:22:05 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 15 May 2011 22:22:05 -0400
Subject: [rabbitmq-discuss] Plugins don't respect RABBITMQ_NODE_IP_ADDRESS
Message-ID: <2207BF2FB4874C12BC1263C610CA3BFA@myyearbook.com>

I noticed when changing the binding IP address on my RabbitMQ broker on a test machine that plugins do not respect the RABBITMQ_NODE_IP_ADDRESS variable. This includes the stomp plugin and the mochiweb based plugins.

Is this expected behavior?

from my /etc/rabbitmq/rabbitmq-env.conf file:

RABBITMQ_NODE_IP_ADDRESS="127.0.0.1"

Regards,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110515/5c2e6e8f/attachment.htm>

From gmr at myyearbook.com  Mon May 16 08:01:17 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 16 May 2011 03:01:17 -0400
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
	<BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
	<9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
Message-ID: <2E20D7BFF04641869CE455B1001732B6@myyearbook.com>

Hey Aaron, cool work. Using libevent is a nice approach. Given Pika's modular approach, I'll have to see what that looks like as an option in Pika v2. 

Given Jason's questions, I decided to port your bench to Pika and threw in py-amqplib (single channel only) to boot.

As I had expected, Haigha benched faster than Pika, but surprisingly only by 2.84% with 500 channels. I does, however, start to show its performance benefits on a single connection with multiple channels when the single socket is not over-saturated. It was 13.29% faster than Pika with 50 channels and 21.57% faster with 10 channels. 

I was somewhat surprised to find that Pika benched 13.08% faster with only 1 channel. So surprised that I had to triple check the numbers ;-) 

I used the 500 number as the initial baseline because it the default value in your test app. I am curious what the use case for so many channels is in the test. Is it to simulate concurrency in a client app?

Anyway here is the info on my tests:

Box:
Dual quad core AMD 2.2Gz (Model 2356)
8GB Ram
Max CPU utilization during all tests: 19%
Max IOWait during all tests: 0.2%
Gentoo Linux with a custom compiled 2.6.28 kernel


RabbitMQ:
2.4.1
Erlang R14B02
Default settings


Client libraries:
Haigha 0.2.1
Pika 0.9.6p0
py-amqplib 0.6.1


Test Parameters:
Duration: 300 seconds
Channel Count: 1, 10, 50, 500
No-Ack: True
Transactions: Off
Single threaded
Single Process


The 1 channel option was to accommodate py-admqplib and BlockingConnection. BlockingConnection can handle multiple channels but the overhead for setting up 500 connections on BlockingAdapter in Pika was prohibitive. The test ended prior to all queues being bound and a single full setup is roughly 1.2 seconds in my environment. For the Pika/TornadoConnection test, I used Tornado 1.2.


A few important things were uncovered in Pika with this test:
There is an interesting recursion bug under heavy loads in all 0.9.x versions. This bug would only present itself if there was always a frame to read or frame to publish in the buffer. If the IOLoop ever had a cycle without inbound or outbound data, the bug will not present. But if there is always data to process, for up to 1,000 frames, there will be a RuntimeError. 1,000 is the default Python recursion limit. This bug has been fixed.
BlockingConnection is very slow! It is roughly 1/8th the speed of py-amqplib. While Asyncore can do roughly 1,800 messages a second on a single channel, Blocking can only do roughly 4!

I didn't make much of an effort to clean up the code or remove the parts I don't use, but the stress_test app hack for pika is at https://gist.github.com/974021

Haigha looks nice. You're doing some of the things I have been thinking about with future versions of Pika such as in your haigha/classes modules (More natural AMQP mapping of classes for use in the client). I look forward to seeing where you take it.

Regards,

Gavin 
On Saturday, May 14, 2011 at 9:40 PM, Jason J. W. Williams wrote:
> How does this differ from Pika's asyncore or Tornado bindings in terms of performance?
> 
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110516/b5c28ee4/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Benchmark.png
Type: image/png
Size: 44296 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110516/b5c28ee4/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Benchmark.csv
Type: application/octet-stream
Size: 1813 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110516/b5c28ee4/attachment-0001.obj>

From emile at rabbitmq.com  Mon May 16 10:05:38 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 May 2011 10:05:38 +0100
Subject: [rabbitmq-discuss] ssl error on rabbitmq server
In-Reply-To: <4DA47DAD.3010204@gmail.com>
References: <4DA4732A.6040903@gmail.com> <20110412162507.GA2284@dakota>
	<4DA47DAD.3010204@gmail.com>
Message-ID: <4DD0E8E2.9050106@rabbitmq.com>

Hi Cha,

Apologies for the delay in replying to your query. Can you confirm 
whether you have solved this problem yet?

Erlang version R14B or later is recommended when connecting with a Java 
client - can you reproduce the bug with a more recent version of Erlang?


-Emile


On 12/04/11 17:28, Cha wrote:
> Hi Alex, I use OpenSSL 0.9.8o 01 Jun 2010 . Thanks for help.
>
> Cha.
> On 04/12/2011 12:25 PM, Alexandru Scvor?ov wrote:
>> Hi,
>>
>> What version of OpenSSL are you using?
>>
>> Alex
>>
>> On Tue, Apr 12, 2011 at 11:43:38AM -0400, Cha wrote:
>>> Hello,

[...]

>>>
>>> I use ubuntu 10.10 with Erlang R13B03.
>>>
>>> Any ideas?
>>>
>>> Thanks,
>>>
>>> Cha

From simon at rabbitmq.com  Mon May 16 10:50:59 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 May 2011 10:50:59 +0100
Subject: [rabbitmq-discuss] Lightweight query for queues?
In-Reply-To: <4DC14112.4090403@rabbitmq.com>
References: <8CC56202-E3E6-4F31-9A42-0DD59FCA5306@gmail.com>
	<4DC14112.4090403@rabbitmq.com>
Message-ID: <4DD0F383.7030403@rabbitmq.com>

On 04/05/11 13:05, Simon MacMullen wrote:
> On 03/05/11 19:18, Ian Ragsdale wrote:
>> So, what I'd like to be able to do is:
>>
>> 1. Allow specifying which data needs to be returned, so that more
>> expensive statistics can be avoided if necessary. 2. Allow filtering
>> the list of queues to return data for with a search term
>
> <snip>
>
>> Is this something you guys would consider?
>
> Probably not (1) right now, since none of these statistics are supposed
> to be even slightly expensive, they should all just be hash lookups. (2)
> is somewhat interesting, probably simpler to implement and more
> generally useful. But I'd like to find out why you're seeing this run so
> slowly first.

Well, it turned out that some things were a bit expensive and the JSON 
encoding is also expensive, so (1) is now implemented and will be in the 
next release. (2) will probably follow on at some point.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Mon May 16 10:58:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 May 2011 10:58:20 +0100
Subject: [rabbitmq-discuss] Plugins don't respect
	RABBITMQ_NODE_IP_ADDRESS
In-Reply-To: <2207BF2FB4874C12BC1263C610CA3BFA@myyearbook.com>
References: <2207BF2FB4874C12BC1263C610CA3BFA@myyearbook.com>
Message-ID: <4DD0F53C.1090604@rabbitmq.com>

On 16/05/11 03:22, Gavin M. Roy wrote:
> I noticed when changing the binding IP address on my RabbitMQ broker on
> a test machine that plugins do not respect the RABBITMQ_NODE_IP_ADDRESS
> variable. This includes the stomp plugin and the mochiweb based plugins.
>
> Is this expected behavior?

Largely, yes. Each plugin has its own method for configuring which 
interface to listen on. For stomp see 
http://www.rabbitmq.com/stomp.html. For mochiweb... we're working on it, 
hopefully in the next release.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From aaron at agoragames.com  Mon May 16 13:08:00 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 16 May 2011 08:08:00 -0400
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <BANLkTimbOHWdmTzCWb9x3V=iF9nw0PvL+A@mail.gmail.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
	<BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
	<9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
	<BANLkTim6k5ic4kip2GwZm1ey58GX2Zm+ZQ@mail.gmail.com>
	<BANLkTimbOHWdmTzCWb9x3V=iF9nw0PvL+A@mail.gmail.com>
Message-ID: <BANLkTi=_4grqVb-kU02QocBCC2etyk3v0A@mail.gmail.com>

Alexis,

The script is coded at 10 exchanges, for no particular reason other
than that's where I left it. It's measuring round-trip time, and I
picked a default of 500 channels to saturate the stack with frames,
partial frames, channel switching, etc. In addition to testing raw
speed, I use it to regression test memory management.

-Aaron

On Sun, May 15, 2011 at 4:18 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Aaron
>
> What is the fanout ratio and is the 48k measuring ingress or total
> throughput? ?I'm guessing it's 1:1 and ingress.
>
> alexis
>
>
> On Sun, May 15, 2011 at 6:33 PM, Aaron Westendorf <aaron at agoragames.com> wrote:
>> I haven't directly compared to pika, but here are some numbers from a
>> post I made back in April. We forked the py-amqpib library to support
>> libevent early in 2009, and then late last year re-wrote it from
>> scratch. The stress_test script included in the haigha source
>> generated these numbers and could be ported to compare against pika.
>>
>> Server:
>> Ubuntu 10.04 2.6.32-24-server x86_64
>> 2 cpu, 6 cores each with hyperthreading, Xeon X5650 @ 2.67GHz
>> 132GB RAM (beam used 500MB max)
>> Rabbit 2.4.0 in SMP mode, default configuration (-K true -A30 -P 1048576)
>> 1 direct exchange, 6000 queues, 6000 channels each pub-subing their own queue
>> 48k messages/sec
>>
>> Clients:
>> Ubuntu 10.04 2.6.32-24-server x86_64
>> 4 VMware hosts, 4 processors each, Xeon X7350 @ 2.93 GHz
>> 3 client processes, 500 channels each
>>
>> On Sat, May 14, 2011 at 9:40 PM, Jason J. W. Williams
>> <jasonjwwilliams at gmail.com> wrote:
>>> How does this differ from Pika's asyncore or Tornado bindings in terms of
>>> performance?
>>> -J
>>> Sent via iPhone
>>> Is your email Premiere?
>>> On May 14, 2011, at 18:17, Brian Corrigan <brian at agoragames.com> wrote:
>>>
>>> Aaron -
>>> Wow man, I know how long you guys have been working on this. ?Congrats and
>>> really nice work!
>>> -B
>>>
>>> On Fri, May 13, 2011 at 3:06 PM, Aaron Westendorf <aaron at agoragames.com>
>>> wrote:
>>>>
>>>> I'm pleased to announce that we finally have a preview release of
>>>> haigha, our Python AMQP client library built off libevent, available
>>>> on github and pypi. See the repo for documentation, examples and
>>>> installation instructions. I hope everyone finds this useful, and I
>>>> look forward to your feedback.
>>>>
>>>> https://github.com/agoragames/haigha
>>>> http://pypi.python.org/pypi/haigha
>>>>
>>>> cheers,
>>>> Aaron
>>>>
>>>> --
>>>> Aaron Westendorf
>>>> Senior Software Engineer
>>>> Agora Games
>>>> 359 Broadway
>>>> Troy, NY 12180
>>>> Phone: 518.268.1000
>>>> aaron at agoragames.com
>>>> www.agoragames.com
>>>> _______________________________________________
>>>> platform-team mailing list
>>>> platform-team at lists.agoragames.com
>>>> https://lists.agoragames.com/cgi-bin/mailman/listinfo/platform-team
>>>
>>>
>>>
>>> --
>>> Brian Corrigan
>>> 359 Broadway
>>> Troy, NY 12180
>>> W: 518.288.8075 (New)
>>> C: 518.867.1439
>>> Skype: agorabrian
>>> agoragames.com | majorleaguegaming.com
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>>
>> --
>> Aaron Westendorf
>> Senior Software Engineer
>> Agora Games
>> 359 Broadway
>> Troy, NY 12180
>> Phone: 518.268.1000
>> aaron at agoragames.com
>> www.agoragames.com
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From aaron at agoragames.com  Mon May 16 13:34:06 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 16 May 2011 08:34:06 -0400
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <2E20D7BFF04641869CE455B1001732B6@myyearbook.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
	<BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
	<9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
	<2E20D7BFF04641869CE455B1001732B6@myyearbook.com>
Message-ID: <BANLkTinh_d+hBV+yG1ranBH-ZOTcg6dQdA@mail.gmail.com>

Gavin,

Thank you, I knew there was a good reason for kicking this out the
door despite some missing tests, documentation and features.

These numbers are very interesting, I'm most surprised by the single
channel one. I'll take a look at that. The test script supports
running a profiler, which I've used to fix a lot of bottlenecks.
That's why I picked the 500 number, but also just because I like to
push network protocols as hard as I can.

I wouldn't be surprised if the depth of the stack or the time-slicing
in the underlying socket abstraction incurs an overhead at one channel
that goes away once more data is flowing. We could also test with a
single channel but more normal conditions, where that channel is
trying to consume from a queue under heavy load, or push large volumes
of data.


From huntermorris+rabbitmq at gmail.com  Mon May 16 15:28:21 2011
From: huntermorris+rabbitmq at gmail.com (Hunter Morris)
Date: Mon, 16 May 2011 15:28:21 +0100
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <BANLkTinh_d+hBV+yG1ranBH-ZOTcg6dQdA@mail.gmail.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
	<BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
	<9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
	<2E20D7BFF04641869CE455B1001732B6@myyearbook.com>
	<BANLkTinh_d+hBV+yG1ranBH-ZOTcg6dQdA@mail.gmail.com>
Message-ID: <BANLkTinkidHbLJjj7M0+XMwZcPzoDJautQ@mail.gmail.com>

On Mon, May 16, 2011 at 1:34 PM, Aaron Westendorf <aaron at agoragames.com> wrote:
> Thank you, I knew there was a good reason for kicking this out the
> door despite some missing tests, documentation and features.

First of all, thank you for releasing haigha. It's very encouraging to
see the Python AMQP ecosystem growing and maturing.

> If you like what you see perhaps we can figure out how to merge or
> otherwise mutually improve haigha and pika. We recently used eventlet
> to great success, which gave me inspiration to think about haigha with
> an abstract connection layer. I found that since we only rely on
> libevent in the Connection class, we're not far away from that design,
> which I gather is also what pika is going for.

I'm particularly interested in your use of haigha with eventlet, so
any information about your experiences would be valuable. Does your
recent use of eventlet include production use?

Best,
Hunter Morris

From aaron at agoragames.com  Mon May 16 16:02:07 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 16 May 2011 11:02:07 -0400
Subject: [rabbitmq-discuss] [Platform Team] Preview Release of Haigha
In-Reply-To: <BANLkTinkidHbLJjj7M0+XMwZcPzoDJautQ@mail.gmail.com>
References: <BANLkTinKiBHCCf3fYcMuZMb7-bECtEn_xg@mail.gmail.com>
	<BANLkTim94jUgOB+HN9WkcN9L72t-dzkoOQ@mail.gmail.com>
	<9883AC06-315F-4709-A938-AC9FBB59EC43@gmail.com>
	<2E20D7BFF04641869CE455B1001732B6@myyearbook.com>
	<BANLkTinh_d+hBV+yG1ranBH-ZOTcg6dQdA@mail.gmail.com>
	<BANLkTinkidHbLJjj7M0+XMwZcPzoDJautQ@mail.gmail.com>
Message-ID: <BANLkTi=sBLFJLrLejan1kQpHvZc9GKtdow@mail.gmail.com>

We put eventlet into production use to handle a specific UDP service
when our old solution failed to scale. We also used it to build some
test clients to perform load/stress testing on our production
infrastructure.

I was overall very happy with it and we're looking into ways to roll
it out into our standard stack. That's where incorporating it into
haigha would be a major benefit, as our AMQP clients would be using
eventlet for all IO and time sharing.

cheers,
Aaron

On Mon, May 16, 2011 at 10:28 AM, Hunter Morris
<huntermorris+rabbitmq at gmail.com> wrote:
> On Mon, May 16, 2011 at 1:34 PM, Aaron Westendorf <aaron at agoragames.com> wrote:
>> Thank you, I knew there was a good reason for kicking this out the
>> door despite some missing tests, documentation and features.
>
> First of all, thank you for releasing haigha. It's very encouraging to
> see the Python AMQP ecosystem growing and maturing.
>
>> If you like what you see perhaps we can figure out how to merge or
>> otherwise mutually improve haigha and pika. We recently used eventlet
>> to great success, which gave me inspiration to think about haigha with
>> an abstract connection layer. I found that since we only rely on
>> libevent in the Connection class, we're not far away from that design,
>> which I gather is also what pika is going for.
>
> I'm particularly interested in your use of haigha with eventlet, so
> any information about your experiences would be valuable. Does your
> recent use of eventlet include production use?
>
> Best,
> Hunter Morris
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From danbarua at gmail.com  Tue May 17 09:44:11 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 17 May 2011 01:44:11 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ management plugin - "No contexts
	installed"
Message-ID: <b252c31f-4e7e-40ad-bfa8-f36fe30caf7e@y19g2000yqk.googlegroups.com>

Hi all,

I've just started playing with RabbitMQ. I'm trying to get the
management plugin up and running and I'm getting the cryptic message
"Contexts available: No contexts installed".

I got the following warnings when installing the plugins:

C:\Code\Libraries\RabbitMq\Server\sbin>rabbitmq-server.bat start
Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
5 plugins activated:
* amqp_client-2.4.1
* mochiweb-1.3
* rabbit_management_agent-2.4.1
* rabbit_mochiweb-2.4.1
* webmachine-1.7.0

I'm running erlang version 5.8.3 on Windows 7 Ultimate x64.

Any ideas?

Regards,

Dan

From simon at rabbitmq.com  Tue May 17 10:04:29 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 May 2011 10:04:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ management plugin - "No contexts
 installed"
In-Reply-To: <b252c31f-4e7e-40ad-bfa8-f36fe30caf7e@y19g2000yqk.googlegroups.com>
References: <b252c31f-4e7e-40ad-bfa8-f36fe30caf7e@y19g2000yqk.googlegroups.com>
Message-ID: <4DD23A1D.9040205@rabbitmq.com>

Hi Dan.

On 17/05/2011 9:44AM, Dan B wrote:
> Hi all,
>
> I've just started playing with RabbitMQ. I'm trying to get the
> management plugin up and running and I'm getting the cryptic message
> "Contexts available: No contexts installed".

That's because you have rabbitmq-mochiweb installed (which allows 
multiple plugins to serve web contexts on the same socket) but do not 
have any plugins installed that actually provide contexts.

> I got the following warnings when installing the plugins:
>
> C:\Code\Libraries\RabbitMq\Server\sbin>rabbitmq-server.bat start
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function fdsrv:bind_socket/2
> *WARNING* Undefined function fdsrv:start/0
> *WARNING* Undefined function fdsrv:stop/0
> *WARNING* Undefined function webmachine_resource:start_link/2
> 5 plugins activated:
> * amqp_client-2.4.1
> * mochiweb-1.3
> * rabbit_management_agent-2.4.1
> * rabbit_mochiweb-2.4.1
> * webmachine-1.7.0

And there's your problem. You have installed all of 
rabbitmq-management's dependencies, but not the plugin itself.

(Those warnings are harmless BTW.)

Cheers, Simon

From Kotreshi_Chikkabidari at mindtree.com  Tue May 17 09:58:04 2011
From: Kotreshi_Chikkabidari at mindtree.com (Kotreshi Chikkabidari)
Date: Tue, 17 May 2011 08:58:04 +0000
Subject: [rabbitmq-discuss] Null pointer exception while dispaching to
 dynamic(temporary) queues
Message-ID: <4FA68B7495F3C44487DB72B8762B1CD416C11F@MTW02MBX05.mindtree.com>

Hi,

We are using rabbitmq1.8 with mule for multithreading. In multi threading its creating separate connection for each request and after 24 requests reaching max pool size and throwing below exception.
May I know how we can handle this issue ? This issue is only with dynamic queues ? How we can use single connector for multiple requests. It may be related to Mule issue if you have any idea please let me know thanks in advance.


Failed to connect/reconnect: http://10.3.12.227:9093/IdentityManagementCallback. Root Exception was: Cannot assign requested address: JVM_Bind. Type: class java.net.BindException
13-May 16:28:59,500 [ERROR] [                main] [                 org.mule.DefaultExceptionStrategy] -
********************************************************************************
Message               : Failed to bind to uri "http://10.3.12.227:9093/IdentityManagementCallback"
Type                  : org.mule.transport.ConnectException
Code                  : MULE_ERROR-0
JavaDoc               : http://www.mulesource.org/docs/site/current2/apidocs/org/mule/transport/ConnectException.html
********************************************************************************
Exception stack is:
1. Cannot assign requested address: JVM_Bind (java.net.BindException)
  java.net.PlainSocketImpl:-2 (null)
2. Failed to bind to uri "http://10.3.12.227:9093/IdentityManagementCallback" (org.mule.transport.ConnectException)
  org.mule.transport.tcp.TcpMessageReceiver:81 (http://www.mulesource.org/docs/site/current2/apidocs/org/mule/transport/ConnectException.html)
********************************************************************************
Root Exception stack trace:
java.net.BindException: Cannot assign requested address: JVM_Bind
                at java.net.PlainSocketImpl.socketBind(Native Method)
                at java.net.PlainSocketImpl.bind(Unknown Source)
                at java.net.ServerSocket.bind(Unknown Source)
                at org.mule.transport.tcp.TcpServerSocketFactory.configure(TcpServerSocketFactory.java:59)
                at org.mule.transport.tcp.TcpServerSocketFactory.createServerSocket(TcpServerSocketFactory.java:43)
                at org.mule.transport.tcp.TcpServerSocketFactory.createServerSocket(TcpServerSocketFactory.java:37)
                at org.mule.transport.tcp.TcpConnector.getServerSocket(TcpConnector.java:438)
                at org.mule.transport.tcp.TcpMessageReceiver.doConnect(TcpMessageReceiver.java:77)
                at org.mule.transport.http.HttpMessageReceiver.doConnect(HttpMessageReceiver.java:88)
                at org.mule.transport.AbstractConnectable$1.doWork(AbstractConnectable.java:173)
                at org.mule.retry.policies.AbstractPolicyTemplate.execute(AbstractPolicyTemplate.java:59)
                at org.mule.transport.AbstractConnectable.connect(AbstractConnectable.java:166)
                at org.mule.service.AbstractService.connectListeners(AbstractService.java:681)


regards
Kotresh


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110517/fce25c49/attachment.htm>

From emile at rabbitmq.com  Tue May 17 11:27:32 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 May 2011 11:27:32 +0100
Subject: [rabbitmq-discuss] Null pointer exception while dispaching to
 dynamic(temporary) queues
In-Reply-To: <4FA68B7495F3C44487DB72B8762B1CD416C11F@MTW02MBX05.mindtree.com>
References: <4FA68B7495F3C44487DB72B8762B1CD416C11F@MTW02MBX05.mindtree.com>
Message-ID: <4DD24D94.3090101@rabbitmq.com>

Hi Kotresh,

I don't see any Rabbit library calls in the stacktrace - are you running 
out of Rabbit connections? Perhaps someone on the list with Mule 
experience can help you better, but it looks like you need to ensure 
that completed requests return their connections to the pool or you 
might need a larger pool.

-Emile

On 17/05/11 09:58, Kotreshi Chikkabidari wrote:
>
> Hi,
>
> We are using rabbitmq1.8 with mule for multithreading. In multi 
> threading its creating separate connection for each request and after 
> 24 requests reaching max pool size and throwing below exception.
>
> May I know how we can handle this issue ? This issue is only with 
> dynamic queues ? How we can use single connector for multiple 
> requests. It may be related to Mule issue if you have any idea please 
> let me know thanks in advance.
>
> Failed to connect/reconnect: 
> http://10.3.12.227:9093/IdentityManagementCallback. Root Exception 
> was: Cannot assign requested address: JVM_Bind. Type: class 
> java.net.BindException
>
> 13-May 16:28:59,500 [ERROR] [                main] [                 
> org.mule.DefaultExceptionStrategy] -
>
> ********************************************************************************
>
> Message               : Failed to bind to uri 
> "http://10.3.12.227:9093/IdentityManagementCallback"
>
> Type                  : org.mule.transport.ConnectException
>
> Code                  : MULE_ERROR-0
>
> JavaDoc               : 
> http://www.mulesource.org/docs/site/current2/apidocs/org/mule/transport/ConnectException.html
>
> ********************************************************************************
>
> Exception stack is:
>
> 1. Cannot assign requested address: JVM_Bind (java.net.BindException)
>
>   java.net.PlainSocketImpl:-2 (null)
>
> 2. Failed to bind to uri 
> "http://10.3.12.227:9093/IdentityManagementCallback" 
> (org.mule.transport.ConnectException)
>
>   org.mule.transport.tcp.TcpMessageReceiver:81 
> (http://www.mulesource.org/docs/site/current2/apidocs/org/mule/transport/ConnectException.html)
>
> ********************************************************************************
>
> Root Exception stack trace:
>
> java.net.BindException: Cannot assign requested address: JVM_Bind
>
>                 at java.net.PlainSocketImpl.socketBind(Native Method)
>
>                 at java.net.PlainSocketImpl.bind(Unknown Source)
>
>                 at java.net.ServerSocket.bind(Unknown Source)
>
>                 at 
> org.mule.transport.tcp.TcpServerSocketFactory.configure(TcpServerSocketFactory.java:59)
>
>                 at 
> org.mule.transport.tcp.TcpServerSocketFactory.createServerSocket(TcpServerSocketFactory.java:43)
>
>                 at 
> org.mule.transport.tcp.TcpServerSocketFactory.createServerSocket(TcpServerSocketFactory.java:37)
>
>                 at 
> org.mule.transport.tcp.TcpConnector.getServerSocket(TcpConnector.java:438)
>
>                 at 
> org.mule.transport.tcp.TcpMessageReceiver.doConnect(TcpMessageReceiver.java:77)
>
>                 at 
> org.mule.transport.http.HttpMessageReceiver.doConnect(HttpMessageReceiver.java:88)
>
>                 at 
> org.mule.transport.AbstractConnectable$1.doWork(AbstractConnectable.java:173)
>
>                 at 
> org.mule.retry.policies.AbstractPolicyTemplate.execute(AbstractPolicyTemplate.java:59)
>
>                 at 
> org.mule.transport.AbstractConnectable.connect(AbstractConnectable.java:166)
>
>                 at 
> org.mule.service.AbstractService.connectListeners(AbstractService.java:681)
>
> regards
>
> Kotresh
>
>
> ------------------------------------------------------------------------
>
> http://www.mindtree.com/email/disclaimer.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110517/635204b6/attachment.htm>

From ramgroups.chan at gmail.com  Tue May 17 12:00:33 2011
From: ramgroups.chan at gmail.com (Ram Chan)
Date: Tue, 17 May 2011 16:30:33 +0530
Subject: [rabbitmq-discuss] Query reg migration of queue
Message-ID: <BANLkTi=WMPqQ5afiHU6uqmzyqb3JELi6DA@mail.gmail.com>

Hi all,

 I have setup rabbitmq on a server, but now want to change the hostname of
server. The queue is under mnesia/rabbit at hostname.
How to migrate the queue to new hostname. I tried renaming the dir but dint
help.
Request to help me on this.
Thanks.

Regards,
Ram
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110517/7d563619/attachment.htm>

From matthew at rabbitmq.com  Tue May 17 12:20:33 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 17 May 2011 12:20:33 +0100
Subject: [rabbitmq-discuss] Query reg migration of queue
In-Reply-To: <BANLkTi=WMPqQ5afiHU6uqmzyqb3JELi6DA@mail.gmail.com>
References: <BANLkTi=WMPqQ5afiHU6uqmzyqb3JELi6DA@mail.gmail.com>
Message-ID: <20110517112033.GA10359@rabbitmq.com>

On Tue, May 17, 2011 at 04:30:33PM +0530, Ram Chan wrote:
>  I have setup rabbitmq on a server, but now want to change the hostname of
> server. The queue is under mnesia/rabbit at hostname.
> How to migrate the queue to new hostname. I tried renaming the dir but dint
> help.

After changing the hostname of the machine, you'll find that rabbit
starts up using the new hostname, and thus a different location to store
queue contents.

The only way you'll be able to migrate the queue contents is to change
the hostname back to the original, startup rabbit, then drain the queue
to some other machine with a stable hostname, make the change to your
hostname, restart rabbit, and then drain it back in.

Or you could use a client of some sort to drain the contents of the
queue, something like that. But the point is that the msgs will have to
come out of rabbit before the hostname change, then make the change,
then send them back in.

Matthew

From alvaro.saurin at gmail.com  Tue May 17 12:39:45 2011
From: alvaro.saurin at gmail.com (Alvaro Saurin)
Date: Tue, 17 May 2011 13:39:45 +0200
Subject: [rabbitmq-discuss] RabbitMQ with WAN latencies
Message-ID: <BC413F8A-D540-4F0B-989D-970F42F0BE58@gmail.com>


Hi there,

I was wondering if you could help me determining if RabbitMQ is appropriate for some WAN scenario...

I have to send control messages to 50 or 60 machines deployed around the world, so they can subscribe to some message types and then perform some actions. Maybe some machines will be grouped in small clusters of 4-5 machines, and some tasks can be run by any machine in that group, but there will also be some tasks that will be targeted to some specific machines. There should be a very low traffic, with maybe just a couple of messages per second, so I was planning to use a simple architecture, with one central broker.

I want to keep things simple, but I'm a bit concerned about the effects latency could have, and I have also read that connectivity losses could have some negative impact. My question is, could I keep this simple architecture or will I need something a bit more complicated like rabbitmq with xmpp or shovel? I have not found many docs about using RabbitMQ on WANs, so maybe nobody is crazy enough for trying this... maybe I should not use RabbitMQ at all?  :)



Cheers


Alvaro


From bostjan at japina.eu  Tue May 17 13:50:31 2011
From: bostjan at japina.eu (=?ISO-8859-2?Q?Bo=B9tjan_Jerko?=)
Date: Tue, 17 May 2011 14:50:31 +0200
Subject: [rabbitmq-discuss] troubles with running management plugin
Message-ID: <BANLkTinHaRV8gzWVj4Bf97TsVC+eWazbuQ@mail.gmail.com>

Hi!

On the Ubuntu I've install RabbitMQ-2.3.1 and created a management
plugin by using rabbitmq-plugin-umbrella (getting it with hg from the
repository) when I copy rabbitmq-management-agent to the plugin
directory and starting server I get the message:

BOOT ERROR: Could not add boot step dependency of rabbit_mgmt_database
on recovery:
Boot step not registered: recovery
Erlang has closed
{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

I've checked the archive and the only reply is about old version of
RabbitMQ which I don't think is relevant in my case.
Can anybody help or suggest what might be a problem...

Bo?tjan

-- 


homepage: http://www.japina.eu
val202igra: http://www.t-42.eu/val202igra

From simon at rabbitmq.com  Tue May 17 14:19:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 May 2011 14:19:45 +0100
Subject: [rabbitmq-discuss] troubles with running management plugin
In-Reply-To: <BANLkTinHaRV8gzWVj4Bf97TsVC+eWazbuQ@mail.gmail.com>
References: <BANLkTinHaRV8gzWVj4Bf97TsVC+eWazbuQ@mail.gmail.com>
Message-ID: <4DD275F1.2080207@rabbitmq.com>

On 17/05/2011 1:50PM, Bo?tjan Jerko wrote:
> Hi!
>
> On the Ubuntu I've install RabbitMQ-2.3.1

<snip>

> Boot step not registered: recovery

<snip>

You've compiled the plugins against default, but your broker is 2.3.1. 
This will not work.

Either "hg update -r rabbitmq_v2_3_1" every repository, the make clean 
*everywhere*, then rebuild, or (more easily) download the binary plugins 
for 2.3.1 from http://www.rabbitmq.com/releases/plugins/v2.3.1/

Cheers, Simon

From simon at rabbitmq.com  Tue May 17 14:28:09 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 May 2011 14:28:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ with WAN latencies
In-Reply-To: <BC413F8A-D540-4F0B-989D-970F42F0BE58@gmail.com>
References: <BC413F8A-D540-4F0B-989D-970F42F0BE58@gmail.com>
Message-ID: <4DD277E9.5060305@rabbitmq.com>

On 17/05/2011 12:39PM, Alvaro Saurin wrote:
> I was wondering if you could help me determining if RabbitMQ is
> appropriate for some WAN scenario...
>
> I have to send control messages to 50 or 60 machines deployed around
> the world, so they can subscribe to some message types and then
> perform some actions. Maybe some machines will be grouped in small
> clusters of 4-5 machines, and some tasks can be run by any machine in
> that group, but there will also be some tasks that will be targeted
> to some specific machines. There should be a very low traffic, with
> maybe just a couple of messages per second, so I was planning to use
> a simple architecture, with one central broker.
>
> I want to keep things simple, but I'm a bit concerned about the
> effects latency could have, and I have also read that connectivity
> losses could have some negative impact. My question is, could I keep
> this simple architecture or will I need something a bit more
> complicated like rabbitmq with xmpp or shovel? I have not found many
> docs about using RabbitMQ on WANs, so maybe nobody is crazy enough
> for trying this... maybe I should not use RabbitMQ at all?  :)

If you are going for a central broker model you should be fine. The 
discussions that we've had about network partitioning and use of the 
shovel to mitigate it have all been about clustering over a WAN, which 
is not recommended. But AMQP over WAN is fine.

Obviously synchronous methods will be slow when latency is slow 
(although no worse than e.g. HTTP would be), but with low traffic like 
that you probably don't even care.

Cheers, Simon

From subbareddykv at gmail.com  Tue May 17 14:51:12 2011
From: subbareddykv at gmail.com (Venkata Subba Reddy Kota)
Date: Tue, 17 May 2011 19:21:12 +0530
Subject: [rabbitmq-discuss] RabbitMQ server installation issue on SUSE Linux
	(SLES)
Message-ID: <BANLkTikjT1hsW-KDXyfhFLnK8xySsnqd3g@mail.gmail.com>

Hi,

       We are trying to setup RabbitMQ Server 2.4.1 on SUSE Linux Enterprise
Server11 (64-bit).
We have a question and an issue.

1. Anybody tested RabbitMQ Server 2.4.1 on SUSE Linux Enterprise Server11
(64-bit)?
We saw the following message in rabbitmq server link (
http://www.rabbitmq.com/server.html)
*"The openSUSE RPM files are intended for Novell's openSUSE Linux and
derived distributions (SLES and SLERT). We haven't tested these under recent
releases, but expect that they work."*

2. We observed that erlang is dependent on libcrypto.so.6. We could not find
suitable rpm to install libcrypto.so.6 for 64-bit system.
When we install latest SSL libraries (libopenssl1_0_0-1.0.0-5.4
and libopenssl-devel-1.0.0-6.7.1), we could see libcrypto.so.1.
Kindly help us to resolve the issue.

Here is the log:

*# rpm -i rabbitmq-server-2.4.1-1.suse.noarch.rpm
warning: rabbitmq-server-2.4.1-1.suse.noarch.rpm: Header V4 DSA signature:
NOKEY, key ID 056e8e56
error: Failed dependencies:
        erlang >= R12B-3 is needed by rabbitmq-server-2.4.1-1.suse.noarch*

*# rpm -i erlang-R12B-5.10.el5.x86_64.rpm.1
warning: erlang-R12B-5.10.el5.x86_64.rpm.1: Header V3 DSA signature: NOKEY,
key ID 217521f6
error: Failed dependencies:
        libcrypto.so.6()(64bit) is needed by erlang-R12B-5.10.el5.x86_64
        libssl.so.6()(64bit) is needed by erlang-R12B-5.10.el5.x86_64*

*# rpm -qa | grep ssl
openssl-certs-0.9.8h-27.1.30
libopenssl0_9_8-32bit-0.9.8h-30.32.1
libopenssl0_9_8-0.9.8h-30.32.1
libopenssl1_0_0-1.0.0-5.4
libopenssl-devel-1.0.0-6.7.1
openssl-0.9.8h-30.32.1*


Thanks in advance.

Best Regards,
Subba Reddy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110517/bcd479ac/attachment.htm>

From alvaro.saurin at gmail.com  Tue May 17 14:59:54 2011
From: alvaro.saurin at gmail.com (Alvaro Saurin)
Date: Tue, 17 May 2011 15:59:54 +0200
Subject: [rabbitmq-discuss] RabbitMQ with WAN latencies
In-Reply-To: <4DD277E9.5060305@rabbitmq.com>
References: <BC413F8A-D540-4F0B-989D-970F42F0BE58@gmail.com>
	<4DD277E9.5060305@rabbitmq.com>
Message-ID: <CAEA444F-AE7A-48BD-8A35-821B80567095@gmail.com>


On 17/05/2011, at 15:28, Simon MacMullen wrote:

> On 17/05/2011 12:39PM, Alvaro Saurin wrote:
>> I was wondering if you could help me determining if RabbitMQ is
>> appropriate for some WAN scenario...
>> 
>> I have to send control messages to 50 or 60 machines deployed around
>> the world, so they can subscribe to some message types and then
>> perform some actions. Maybe some machines will be grouped in small
>> clusters of 4-5 machines, and some tasks can be run by any machine in
>> that group, but there will also be some tasks that will be targeted
>> to some specific machines. There should be a very low traffic, with
>> maybe just a couple of messages per second, so I was planning to use
>> a simple architecture, with one central broker.
>> 
>> I want to keep things simple, but I'm a bit concerned about the
>> effects latency could have, and I have also read that connectivity
>> losses could have some negative impact. My question is, could I keep
>> this simple architecture or will I need something a bit more
>> complicated like rabbitmq with xmpp or shovel? I have not found many
>> docs about using RabbitMQ on WANs, so maybe nobody is crazy enough
>> for trying this... maybe I should not use RabbitMQ at all?  :)
> 
> If you are going for a central broker model you should be fine. The discussions that we've had about network partitioning and use of the shovel to mitigate it have all been about clustering over a WAN, which is not recommended. But AMQP over WAN is fine.
> 
> Obviously synchronous methods will be slow when latency is slow (although no worse than e.g. HTTP would be), but with low traffic like that you probably don't even care.
> 
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Great! That?s what I wanted to hear! I?ll try this setup and see what happens...

Cheers


Alvaro





From david at rabbitmq.com  Tue May 17 15:08:19 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 17 May 2011 15:08:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ server installation issue on SUSE
	Linux (SLES)
In-Reply-To: <BANLkTikjT1hsW-KDXyfhFLnK8xySsnqd3g@mail.gmail.com> (Venkata
	Subba Reddy Kota's message of "Tue, 17 May 2011 19:21:12 +0530")
References: <BANLkTikjT1hsW-KDXyfhFLnK8xySsnqd3g@mail.gmail.com>
Message-ID: <yrv4cboz1qv1o.fsf@dwragg.eng.vmware.com>

Venkata Subba Reddy Kota <subbareddykv at gmail.com> writes:
> *# rpm -i erlang-R12B-5.10.el5.x86_64.rpm.1
> warning: erlang-R12B-5.10.el5.x86_64.rpm.1: Header V3 DSA signature: NOKEY,
> key ID 217521f6
> error: Failed dependencies:
>         libcrypto.so.6()(64bit) is needed by erlang-R12B-5.10.el5.x86_64
>         libssl.so.6()(64bit) is needed by erlang-R12B-5.10.el5.x86_64*

It looks like you are trying to install an erlang package from RHEL/EPEL
on SLES.  That's probably not going to work - while both distros use
RPM, there are many differences between them.

So you should install an erlang package specifically for SLES.  See the
erlang project at opensuse.org:
https://build.opensuse.org/project/show?project=devel%3Alanguages%3Aerlang

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From sp.mari3k at gmail.com  Tue May 17 23:19:34 2011
From: sp.mari3k at gmail.com (Mari Muthu)
Date: Tue, 17 May 2011 15:19:34 -0700
Subject: [rabbitmq-discuss] Queue declaration
Message-ID: <BANLkTi=RvDziD14Ap=4st98viRC=iCx8uA@mail.gmail.com>

Hi,

    1) What are the possible argument we can pass when i declare  the Queue.
And when these arguments will be used.

channel.queueDeclare(queue.getQueueName(), queue.isDurable(),
queue.isExclusive(), queue.isAutoDelete(),
            queue.getArguments());

this arguments is  a map.

2) Can i say like these queue should be deleted after some day/date. Lets
say if the queue is idle for 5 days then delete it(no consumer/publisher).




Thanks & Regards

Marimuthu.SP
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110517/72c659a7/attachment.htm>

From simon at rabbitmq.com  Tue May 17 23:23:34 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 May 2011 23:23:34 +0100
Subject: [rabbitmq-discuss] Queue declaration
In-Reply-To: <BANLkTi=RvDziD14Ap=4st98viRC=iCx8uA@mail.gmail.com>
References: <BANLkTi=RvDziD14Ap=4st98viRC=iCx8uA@mail.gmail.com>
Message-ID: <4DD2F566.5050706@rabbitmq.com>

On 17/05/2011 11:19PM, Mari Muthu wrote:
> Hi,
>
>      1) What are the possible argument we can pass when i declare  the
> Queue. And when these arguments will be used.
>
> channel.queueDeclare(queue.getQueueName(), queue.isDurable(),
> queue.isExclusive(), queue.isAutoDelete(),
>              queue.getArguments());
>
> this arguments is  a map.

At the moment, two arguments are supported for queues: x-expires and 
x-message-ttl.

> 2) Can i say like these queue should be deleted after some day/date.
> Lets say if the queue is idle for 5 days then delete it(no
> consumer/publisher).

You want x-expires:

http://www.rabbitmq.com/extensions.html#queue-leases

Cheers, Simon

From lists at truthisfreedom.org.uk  Wed May 18 07:18:31 2011
From: lists at truthisfreedom.org.uk (Matthew Macdonald-Wallace)
Date: Wed, 18 May 2011 07:18:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ with WAN latencies
In-Reply-To: <BC413F8A-D540-4F0B-989D-970F42F0BE58@gmail.com>
References: <BC413F8A-D540-4F0B-989D-970F42F0BE58@gmail.com>
Message-ID: <1305699511.2787.7.camel@lappy.edison.local>

On Tue, 2011-05-17 at 13:39 +0200, Alvaro Saurin wrote:
> Hi there,
> 
> I was wondering if you could help me determining if RabbitMQ is appropriate for some WAN scenario...
> 
> I have to send control messages to 50 or 60 machines deployed around the world, so they can subscribe to some message types and then perform some actions. Maybe some machines will be grouped in small clusters of 4-5 machines, and some tasks can be run by any machine in that group, but there will also be some tasks that will be targeted to some specific machines. There should be a very low traffic, with maybe just a couple of messages per second, so I was planning to use a simple architecture, with one central broker.
> 
> I want to keep things simple, but I'm a bit concerned about the effects latency could have, and I have also read that connectivity losses could have some negative impact. My question is, could I keep this simple architecture or will I need something a bit more complicated like rabbitmq with xmpp or shovel? I have not found many docs about using RabbitMQ on WANs, so maybe nobody is crazy enough for trying this... maybe I should not use RabbitMQ at all?  :)
> 
> 
> 
> Cheers
> 
> 
> Alvaro

Hi Alvaro,

Out of interest, is this for MCollective?  If so, I'd love to know how
you get on, we're just setting up MC with rabbitmq across at three
geographically separate locations (2 in the UK and one in Ireland to
begin with and possibly more to come across Europe).

My main concern is addressing the secure transfer of data between
clusters of rabbitmq nodes, however that's a question for the list at a
another time... :)

Cheers,

M.


From subbareddykv at gmail.com  Wed May 18 07:51:35 2011
From: subbareddykv at gmail.com (Venkata Subba Reddy Kota)
Date: Wed, 18 May 2011 12:21:35 +0530
Subject: [rabbitmq-discuss] RabbitMQ server installation issue on SUSE
 Linux (SLES)
In-Reply-To: <yrv4cboz1qv1o.fsf@dwragg.eng.vmware.com>
References: <BANLkTikjT1hsW-KDXyfhFLnK8xySsnqd3g@mail.gmail.com>
	<yrv4cboz1qv1o.fsf@dwragg.eng.vmware.com>
Message-ID: <BANLkTimWcfMy3EZ=cSwywP+D4TtWn6pCzw@mail.gmail.com>

It worked david. Thank you.
Did anybody tested RabbitMQ Server 2.4.1 on SLES?

On Tue, May 17, 2011 at 7:38 PM, David Wragg <david at rabbitmq.com> wrote:

> Venkata Subba Reddy Kota <subbareddykv at gmail.com> writes:
> > *# rpm -i erlang-R12B-5.10.el5.x86_64.rpm.1
> > warning: erlang-R12B-5.10.el5.x86_64.rpm.1: Header V3 DSA signature:
> NOKEY,
> > key ID 217521f6
> > error: Failed dependencies:
> >         libcrypto.so.6()(64bit) is needed by erlang-R12B-5.10.el5.x86_64
> >         libssl.so.6()(64bit) is needed by erlang-R12B-5.10.el5.x86_64*
>
> It looks like you are trying to install an erlang package from RHEL/EPEL
> on SLES.  That's probably not going to work - while both distros use
> RPM, there are many differences between them.
>
> So you should install an erlang package specifically for SLES.  See the
> erlang project at opensuse.org:
> https://build.opensuse.org/project/show?project=devel%3Alanguages%3Aerlang
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110518/bc255cca/attachment.htm>

From david at rabbitmq.com  Wed May 18 11:38:58 2011
From: david at rabbitmq.com (David Wragg)
Date: Wed, 18 May 2011 11:38:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ server installation issue on SUSE
	Linux (SLES)
In-Reply-To: <BANLkTimWcfMy3EZ=cSwywP+D4TtWn6pCzw@mail.gmail.com> (Venkata
	Subba Reddy Kota's message of "Wed, 18 May 2011 12:21:35 +0530")
References: <BANLkTikjT1hsW-KDXyfhFLnK8xySsnqd3g@mail.gmail.com>
	<yrv4cboz1qv1o.fsf@dwragg.eng.vmware.com>
	<BANLkTimWcfMy3EZ=cSwywP+D4TtWn6pCzw@mail.gmail.com>
Message-ID: <yrv4c39kcqon1.fsf@dwragg.eng.vmware.com>

Venkata Subba Reddy Kota <subbareddykv at gmail.com> writes:
> Did anybody tested RabbitMQ Server 2.4.1 on SLES?

We don't currently test on SLES as part of our normal pre-release
testing.

But people do download our RPM packages for SuSE (including the 2.4.1
one), and we haven't had any problems reported, so presumably they do
work.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From alvaro.saurin at gmail.com  Wed May 18 15:24:24 2011
From: alvaro.saurin at gmail.com (Alvaro Saurin)
Date: Wed, 18 May 2011 16:24:24 +0200
Subject: [rabbitmq-discuss] RabbitMQ with WAN latencies
In-Reply-To: <1305699511.2787.7.camel@lappy.edison.local>
References: <BC413F8A-D540-4F0B-989D-970F42F0BE58@gmail.com>
	<1305699511.2787.7.camel@lappy.edison.local>
Message-ID: <F4F04146-B863-43FB-BD89-80DA45F2BFC9@gmail.com>


On 18/05/2011, at 08:18, Matthew Macdonald-Wallace wrote:

> On Tue, 2011-05-17 at 13:39 +0200, Alvaro Saurin wrote:
>> Hi there,
>> 
>> I was wondering if you could help me determining if RabbitMQ is appropriate for some WAN scenario...
>> 
>> I have to send control messages to 50 or 60 machines deployed around the world, so they can subscribe to some message types and then perform some actions. Maybe some machines will be grouped in small clusters of 4-5 machines, and some tasks can be run by any machine in that group, but there will also be some tasks that will be targeted to some specific machines. There should be a very low traffic, with maybe just a couple of messages per second, so I was planning to use a simple architecture, with one central broker.
>> 
>> I want to keep things simple, but I'm a bit concerned about the effects latency could have, and I have also read that connectivity losses could have some negative impact. My question is, could I keep this simple architecture or will I need something a bit more complicated like rabbitmq with xmpp or shovel? I have not found many docs about using RabbitMQ on WANs, so maybe nobody is crazy enough for trying this... maybe I should not use RabbitMQ at all?  :)
>> 
>> 
>> 
>> Cheers
>> 
>> 
>> Alvaro
> 
> Hi Alvaro,
> 
> Out of interest, is this for MCollective?  If so, I'd love to know how
> you get on, we're just setting up MC with rabbitmq across at three
> geographically separate locations (2 in the UK and one in Ireland to
> begin with and possibly more to come across Europe).
> 
> My main concern is addressing the secure transfer of data between
> clusters of rabbitmq nodes, however that's a question for the list at a
> another time... :)
> 
> Cheers,
> 
> M.
> 


Hi Matthew,

I didn't plan to use MCollective but our own custom framework, built with Python/Celery/RabbitMQ. Our infrastructure will impose some tight requirements, as we have machines all around the globe and latencies can become a big problem, but I think we can live with it as long as we don?t need a high throughput (or many synchronous operations).  And regarding the security, I?m also interested this: my plan is to deploy our systems with the SSL module...

Cheers



Alvaro



From jerryk at vmware.com  Wed May 18 16:03:43 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 18 May 2011 08:03:43 -0700
Subject: [rabbitmq-discuss] RabbitMQ server installation issue on SUSE
 Linux (SLES)
In-Reply-To: <BANLkTimWcfMy3EZ=cSwywP+D4TtWn6pCzw@mail.gmail.com>
References: <BANLkTikjT1hsW-KDXyfhFLnK8xySsnqd3g@mail.gmail.com>
	<yrv4cboz1qv1o.fsf@dwragg.eng.vmware.com>,
	<BANLkTimWcfMy3EZ=cSwywP+D4TtWn6pCzw@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5028DD5E2A9@EXCH-MBX-3.vmware.com>

Hi, Venkata:

> It worked david. Thank you.
> Did anybody tested RabbitMQ Server 2.4.1 on SLES?

Indeed, the combination of a 2.4.1 RabbitMQ broker, running on
SLES-11, is regularly used by a couple of teams within VMware.

Although the testing of it isn't focused on exercising Rabbit per se,
it is in regular enough use to support confidence in the
configuration.

Best regards,
Jerry

From iconara at gmail.com  Wed May 18 16:22:13 2011
From: iconara at gmail.com (Theo)
Date: Wed, 18 May 2011 08:22:13 -0700 (PDT)
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
	even when no messages left
Message-ID: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>

Hi,

I'm load testing my RabbitMQ setup and I'm having problems I can't get
my head around. After publishing a lot of messages (millions) it seems
like the cluster is put into a bad state. The performance completely
rots and all connections are marked as blocked -- and even when all
queues eventually have been drained (after I've shut down the
producers) and all connections closed at least one of the nodes is
still showing memory usage well above the high watermark. This has
happened multiple times during my testing, and seems completely
reproducible.

Please have a look at this screenshot:

https://skitch.com/iconara/fynbd/rabbitmq-management

(the screenshot shows the web based management console, zero messages
queued, but very high memory usage for one of the cluster nodes).

At the same time that I took the screenshot the Connections tab showed
no connections. It was several minutes (perhaps ten) since the last
connection was closed.

If I start a producer, or a consumer, at this point the connection is
immediately marked as blocked in the Connections tab, and the message
rate numbers on the Overview tab shows zero, even though my code is
reporting that it's sending thousands of messages (the number of
queued/ready messages increases though).

Removing all queues seems to resolve the problem, but that is not a
feasible workaround. It feels like I should be able to run the cluster
continuously without having to stop and clean up from time to time.

More specifics on the setup: the cluster consists of 4 EC2 instances
with 8 CPUs and 7 Gb RAM each (I forget the exact instance name)
running RabbitMQ 2.4. The producers and consumers are Ruby processed
running the latest RC of the AMQP gem. Each node has three queues
bound to one exchange with a single routing key each, the producers
connect to a random cluster node and publish "hello world" with a
random routing key, so that each message will end up in exactly one
queue. The consumers connect to one of the cluster nodes (one consumer
per cluster node, in this test setup), and subscribe to all of the
queues on that node. The consumers do nothing beside ack the message.
The idea behind the setup is to get load balancing, and high
throughput.

Before the cluster rots, we publish, deliver and ack 15-20K messages
per second.

Thanks in advance for any tips,
Theo

From matthew at rabbitmq.com  Wed May 18 17:01:48 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 18 May 2011 17:01:48 +0100
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>
Message-ID: <20110518160148.GB14406@wellquite.org>

Hi Theo,

On Wed, May 18, 2011 at 08:22:13AM -0700, Theo wrote:
> More specifics on the setup: the cluster consists of 4 EC2 instances
> with 8 CPUs and 7 Gb RAM each (I forget the exact instance name)
> running RabbitMQ 2.4.

Is that 2.4.0 or 2.4.1? If not 2.4.1, please upgrade. Which version of
Erlang are you running? Is there anything of note other than connections
and memory alarms in any of the logs?

Matthew

From iconara at gmail.com  Wed May 18 17:15:39 2011
From: iconara at gmail.com (Theo)
Date: Wed, 18 May 2011 09:15:39 -0700 (PDT)
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <20110518160148.GB14406@wellquite.org>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>
	<20110518160148.GB14406@wellquite.org>
Message-ID: <08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>

2.4.1, should have been more specific. the OS is ubuntu 10.04, btw.

there's a lot of warnings in the log about memory usage, but it's more
or less the same thing over and over again:

=INFO REPORT==== 18-May-2011::14:37:20 ===
vm_memory_high_watermark set. Memory used:3327376104 allowed:
3006570496

=INFO REPORT==== 18-May-2011::14:37:20 ===
    alarm_handler: {set,
{{vm_memory_high_watermark,rabbit at rfmmqstaging01},[]}}

then I found this, not sure if it's important (pasted it into a gist):

https://gist.github.com/978897

this is the version of erlang:

Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:8:8] [rq:8] [async-
threads:0] [hipe] [kernel-poll:false]

I've been watching the management UI since I posted my first message
(almost an hour ago) and the memory usage hasn't gone down. can a node
get bad? the other nodes look ok, but the one that's in the red in the
screenshot is still in the red. no connections to the server for an
hour.

T#

On May 18, 6:01?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> Hi Theo,
>
> On Wed, May 18, 2011 at 08:22:13AM -0700, Theo wrote:
> > More specifics on the setup: the cluster consists of 4 EC2 instances
> > with 8 CPUs and 7 Gb RAM each (I forget the exact instance name)
> > running RabbitMQ 2.4.
>
> Is that 2.4.0 or 2.4.1? If not 2.4.1, please upgrade. Which version of
> Erlang are you running? Is there anything of note other than connections
> and memory alarms in any of the logs?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From colpclark at gmail.com  Wed May 18 19:34:41 2011
From: colpclark at gmail.com (Colin)
Date: Wed, 18 May 2011 13:34:41 -0500
Subject: [rabbitmq-discuss] RabbitMQ with WAN latencies
In-Reply-To: <1305699511.2787.7.camel@lappy.edison.local>
References: <BC413F8A-D540-4F0B-989D-970F42F0BE58@gmail.com>
	<1305699511.2787.7.camel@lappy.edison.local>
Message-ID: <C48CDB8F-4E0F-4265-8E0D-2EBAD1C8B169@gmail.com>

We do this today across the US and it works great.  We use central broker.

--
Colin Clark
+1 315 886 3422 cell
+1 701 212 4314 office
http://cloudeventprocessing.com
http://blog.cloudeventprocessing.com
@EventCloudPro

*Sent from Star Trek like flat panel device, which although larger than my Star Trek like communicator device, may have typo's and exhibit improper grammar due to haste and less than perfect use of the virtual keyboard*
 

On May 18, 2011, at 1:18 AM, Matthew Macdonald-Wallace <lists at truthisfreedom.org.uk> wrote:

> On Tue, 2011-05-17 at 13:39 +0200, Alvaro Saurin wrote:
>> Hi there,
>> 
>> I was wondering if you could help me determining if RabbitMQ is appropriate for some WAN scenario...
>> 
>> I have to send control messages to 50 or 60 machines deployed around the world, so they can subscribe to some message types and then perform some actions. Maybe some machines will be grouped in small clusters of 4-5 machines, and some tasks can be run by any machine in that group, but there will also be some tasks that will be targeted to some specific machines. There should be a very low traffic, with maybe just a couple of messages per second, so I was planning to use a simple architecture, with one central broker.
>> 
>> I want to keep things simple, but I'm a bit concerned about the effects latency could have, and I have also read that connectivity losses could have some negative impact. My question is, could I keep this simple architecture or will I need something a bit more complicated like rabbitmq with xmpp or shovel? I have not found many docs about using RabbitMQ on WANs, so maybe nobody is crazy enough for trying this... maybe I should not use RabbitMQ at all?  :)
>> 
>> 
>> 
>> Cheers
>> 
>> 
>> Alvaro
> 
> Hi Alvaro,
> 
> Out of interest, is this for MCollective?  If so, I'd love to know how
> you get on, we're just setting up MC with rabbitmq across at three
> geographically separate locations (2 in the UK and one in Ireland to
> begin with and possibly more to come across Europe).
> 
> My main concern is addressing the secure transfer of data between
> clusters of rabbitmq nodes, however that's a question for the list at a
> another time... :)
> 
> Cheers,
> 
> M.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From wtkane07 at gmail.com  Wed May 18 19:13:15 2011
From: wtkane07 at gmail.com (kane)
Date: Wed, 18 May 2011 20:13:15 +0200
Subject: [rabbitmq-discuss] question on the RpcClient class
Message-ID: <BANLkTi=9V5b6kLgn-HKfZnt4FC-LGs6DPA@mail.gmail.com>

I have a question regarding a class of the package com.rabbitmq.client
the calss in question is RpcClient and use as follows:

  RpcClient service = new RpcClient (channel, "", cost.request_queue);

  return = service.stringCall (message);


This calss I automatically generates a queue on which the client waits for a
response.

Let me know if this queue is exclusive?

I make this question because in the javadoc documentation of the class is
written as follows:

rpcclient public (the English Channel,
                    java.lang.String exchange,
                    java.lang.String routingKey)
             throws java.io.IOException

       Building a new rpcclient that communicate on the designated channel,
sending requests for data routing with the given key.

       Causes the creation of a temporary private queue autodelete.

...

The last sentence says that creates a temporary queue, autodelete and here
we are, then says that the tail is private

I wonder if the word in the phrase "private" is intended to be exclusive ...
may seem trivial but sometimes a word changes the meaning of a sentence ...
thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110518/69fec3b8/attachment-0001.htm>

From iconara at gmail.com  Wed May 18 21:47:45 2011
From: iconara at gmail.com (Theo)
Date: Wed, 18 May 2011 13:47:45 -0700 (PDT)
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>
	<20110518160148.GB14406@wellquite.org>
	<08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>
Message-ID: <07539175-27e8-4899-ab62-04a9910bcde5@j23g2000yqc.googlegroups.com>

Eventually (a couple of hours without any connections) the node
returned to normal memory usage, so I launched a new batch of tests. I
saw a sustained load of 20K published/delivered/acked for a few
minutes, with the memory usage of each node increasing rapidly. After
perhaps five minutes the cluster rotted completely. No messages
published, nothing delivered, all connections are blocked.

20K messages over four nodes, that shouldn't be a problem? From my
point of view it looks like RabbitMQ is leaking memory badly, but that
couldn't be, could it?

At this point there is no message on any queue, according to the web
UI, but each node is still using over 3Gb RAM.

Theo

On May 18, 6:15?pm, Theo <icon... at gmail.com> wrote:
> 2.4.1, should have been more specific. the OS is ubuntu 10.04, btw.
>
> there's a lot of warnings in the log about memory usage, but it's more
> or less the same thing over and over again:
>
> =INFO REPORT==== 18-May-2011::14:37:20 ===
> vm_memory_high_watermark set. Memory used:3327376104 allowed:
> 3006570496
>
> =INFO REPORT==== 18-May-2011::14:37:20 ===
> ? ? alarm_handler: {set,
> {{vm_memory_high_watermark,rabbit at rfmmqstaging01},[]}}
>
> then I found this, not sure if it's important (pasted it into a gist):
>
> https://gist.github.com/978897
>
> this is the version of erlang:
>
> Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:8:8] [rq:8] [async-
> threads:0] [hipe] [kernel-poll:false]
>
> I've been watching the management UI since I posted my first message
> (almost an hour ago) and the memory usage hasn't gone down. can a node
> get bad? the other nodes look ok, but the one that's in the red in the
> screenshot is still in the red. no connections to the server for an
> hour.
>
> T#
>
> On May 18, 6:01?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:> Hi Theo,
>
> > On Wed, May 18, 2011 at 08:22:13AM -0700, Theo wrote:
> > > More specifics on the setup: the cluster consists of 4 EC2 instances
> > > with 8 CPUs and 7 Gb RAM each (I forget the exact instance name)
> > > running RabbitMQ 2.4.
>
> > Is that 2.4.0 or 2.4.1? If not 2.4.1, please upgrade. Which version of
> > Erlang are you running? Is there anything of note other than connections
> > and memory alarms in any of the logs?
>
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lgreg.meredith at gmail.com  Thu May 19 01:45:42 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Wed, 18 May 2011 17:45:42 -0700
Subject: [rabbitmq-discuss] successful plugins?
Message-ID: <BANLkTi=Ya5B7umsWdmS=YKO_Kg799GcqqA@mail.gmail.com>

Dear Rabbitters,

i've decided to dip my toe in the waters of the plugins -- especially the
management plugin. i've copied

  /Users/lgm/work/src/devtools/rabbit/rabbitmq_server-2.2.0/plugins:
  total used in directory 1568 available 829354284
  drwxr-xr-x@  9 lgm  staff     306 May 18 13:46 .
  drwxr-xr-x@ 10 lgm  staff     340 Nov 29 04:33 ..
  -rw-r--r--@  1 lgm  staff      45 Nov 29 04:33 README
  -rw-r--r--   1 lgm  staff  155938 May 18 13:42 amqp_client-2.4.1.ez
  -rw-r--r--   1 lgm  staff  209210 May 18 13:42 mochiweb-2.4.1.ez
  -rw-r--r--   1 lgm  staff  329415 May 18 13:42
rabbitmq-management-2.4.1.ez
  -rw-r--r--   1 lgm  staff   14922 May 18 13:42
rabbitmq-management-agent-2.4.1.ez
  -rw-r--r--   1 lgm  staff   19682 May 18 13:42 rabbitmq-mochiweb-2.4.1.ez
  -rw-r--r--   1 lgm  staff   57049 May 18 13:42 webmachine-2.4.1.ez


to the plugins directory. When i initiate the rabbit server i get some
interesting reports. Does the trace below indicate a healthy install and
start up?

Best wishes,

--greg

bash-3.2$ sudo rabbitmq-server &
[1] 47962
bash-3.2$ Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function file_handle_cache:info/1
*WARNING* Undefined function rabbit_access_control:list_vhosts/2
*WARNING* Undefined function rabbit_auth_backend_internal:add_user/2
*WARNING* Undefined function rabbit_auth_backend_internal:clear_admin/1
*WARNING* Undefined function
rabbit_auth_backend_internal:clear_permissions/2
*WARNING* Undefined function rabbit_auth_backend_internal:delete_user/1
*WARNING* Undefined function rabbit_auth_backend_internal:list_permissions/0
*WARNING* Undefined function
rabbit_auth_backend_internal:list_user_permissions/1
*WARNING* Undefined function
rabbit_auth_backend_internal:list_user_vhost_permissions/2
*WARNING* Undefined function rabbit_auth_backend_internal:list_users/0
*WARNING* Undefined function
rabbit_auth_backend_internal:list_vhost_permissions/1
*WARNING* Undefined function rabbit_auth_backend_internal:lookup_user/1
*WARNING* Undefined function rabbit_auth_backend_internal:set_admin/1
*WARNING* Undefined function rabbit_auth_backend_internal:set_permissions/5
*WARNING* Undefined function rabbit_channel:ready_for_close/1
*WARNING* Undefined function rabbit_command_assembler:analyze_frame/3
*WARNING* Undefined function rabbit_command_assembler:init/1
*WARNING* Undefined function rabbit_exchange:declare/6
*WARNING* Undefined function rabbit_misc:ntoa/1
*WARNING* Undefined function rabbit_misc:ntoab/1
*WARNING* Undefined function rabbit_reader:process_channel_frame/5
*WARNING* Undefined function rabbit_registry:lookup_all/1
*WARNING* Undefined function rabbit_vhost:add/1
*WARNING* Undefined function rabbit_vhost:delete/1
*WARNING* Undefined function rabbit_vhost:exists/1
*WARNING* Undefined function rabbit_vhost:list/0
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.4.1
* mochiweb-1.3
* rabbit_management-2.4.1
* rabbit_management_agent-2.4.1
* rabbit_mochiweb-2.4.1
* webmachine-1.7.0


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.2.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at BiosimiMac1-2
app descriptor :
/Users/lgm/work/src/devtools/rabbit/rabbitmq_server-2.2.0/sbin/../ebin/rabbit.app
home dir       : /Users/lgm
cookie hash    : 7vyF5kbCgbq9jjMP2sUa3w==
log            : /var/log/rabbitmq/rabbit at BiosimiMac1-2.log
sasl log       : /var/log/rabbitmq/rabbit at BiosimiMac1-2-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at BiosimiMac1-2
erlang version : 5.8.2

starting file handle cache server
...done
starting worker pool
 ...done
starting database
...done
starting codec correctness check
 ...done
-- external infrastructure ready
starting statistics event manager
...done
starting logging server
...done
starting exchange type registry
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
 ...done
starting exchange type topic
 ...done
-- kernel ready
starting alarm handler
 ...done
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange recovery
 ...done
starting management agent
...done
starting management statistics database
...done
starting queue supervisor and queue recovery
 ...done
-- message delivery logic ready
starting error log relay
 ...done
starting networking
...done
-- network listeners available

broker running
** Found 0 name clashes in code paths

bash-3.2$

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110518/ceb58af8/attachment.htm>

From randall at trellisapp.com  Thu May 19 02:22:36 2011
From: randall at trellisapp.com (Randall Richard)
Date: Wed, 18 May 2011 21:22:36 -0400
Subject: [rabbitmq-discuss] question on the RpcClient class
In-Reply-To: <BANLkTi=9V5b6kLgn-HKfZnt4FC-LGs6DPA@mail.gmail.com>
References: <BANLkTi=9V5b6kLgn-HKfZnt4FC-LGs6DPA@mail.gmail.com>
Message-ID: <BANLkTimHFFKdivm_xZO0Wvki=Y2OzocLLg@mail.gmail.com>

I happened to have the source code handy for RpcClient.  Looks like the
reply queue is set up via the setupReplyQueue() method below.

    /**
     * Creates a server-named exclusive autodelete queue to use for
     * receiving replies to RPC requests.
     * @throws IOException if an error is encountered
     * @return the name of the reply queue
     */
    protected String setupReplyQueue() throws IOException {
        return _channel.queueDeclare("", false, true, true,
null).getQueue();
    }

*queueDeclare<http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.4.1/rabbitmq-java-client-javadoc-2.4.1/com/rabbitmq/client/Channel.html#queueDeclare(java.lang.String,
boolean, boolean, boolean, java.util.Map)>*(java.lang.String queue,
boolean durable, boolean exclusive, boolean autoDelete,
java.util.Map<java.lang.String,java.lang.Object> arguments)

So, it looks like it's declared with exclusivity as true.

Regards,

-Randall

On Wed, May 18, 2011 at 2:13 PM, kane <wtkane07 at gmail.com> wrote:

> I have a question regarding a class of the package com.rabbitmq.client
> the calss in question is RpcClient and use as follows:
>
>   RpcClient service = new RpcClient (channel, "", cost.request_queue);
>
>   return = service.stringCall (message);
>
>
> This calss I automatically generates a queue on which the client waits for
> a response.
>
> Let me know if this queue is exclusive?
>
> I make this question because in the javadoc documentation of the class is
> written as follows:
>
> rpcclient public (the English Channel,
>                     java.lang.String exchange,
>                     java.lang.String routingKey)
>              throws java.io.IOException
>
>        Building a new rpcclient that communicate on the designated channel,
> sending requests for data routing with the given key.
>
>        Causes the creation of a temporary private queue autodelete.
>
> ...
>
> The last sentence says that creates a temporary queue, autodelete and here
> we are, then says that the tail is private
>
> I wonder if the word in the phrase "private" is intended to be exclusive
> ...
> may seem trivial but sometimes a word changes the meaning of a sentence ...
> thanks!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110518/afb7be4e/attachment-0001.htm>

From gmr at myyearbook.com  Thu May 19 02:31:31 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 18 May 2011 21:31:31 -0400
Subject: [rabbitmq-discuss] successful plugins?
In-Reply-To: <BANLkTi=Ya5B7umsWdmS=YKO_Kg799GcqqA@mail.gmail.com>
References: <BANLkTi=Ya5B7umsWdmS=YKO_Kg799GcqqA@mail.gmail.com>
Message-ID: <9B7A3711B03948E2AAD5475479A7A32C@myyearbook.com>

Looks to me like you're using 2.4.1 plugins with a 2.2.0 install. 2.4.1 is a worthwhile upgrade, and since you're already restarting for the plugins, it should be a minimal thing to update. Otherwise, you'll want to grab the 2.2.0 tagged plugins.

Regards,

Gavin
On Wednesday, May 18, 2011 at 8:45 PM, Meredith Gregory wrote: 
> Dear Rabbitters,
> 
> i've decided to dip my toe in the waters of the plugins -- especially the management plugin. i've copied
> 
>  /Users/lgm/work/src/devtools/rabbit/rabbitmq_server-2.2.0/plugins: 
>  total used in directory 1568 available 829354284
>  drwxr-xr-x@ 9 lgm staff  306 May 18 13:46 .
>  drwxr-xr-x@ 10 lgm staff  340 Nov 29 04:33 ..
>  -rw-r--r--@ 1 lgm staff 45 Nov 29 04:33 README
>  -rw-r--r--  1 lgm staff 155938 May 18 13:42 amqp_client-2.4.1.ez
>  -rw-r--r--  1 lgm staff 209210 May 18 13:42 mochiweb-2.4.1.ez
>  -rw-r--r--  1 lgm staff 329415 May 18 13:42 rabbitmq-management-2.4.1.ez
>  -rw-r--r--  1 lgm staff  14922 May 18 13:42 rabbitmq-management-agent-2.4.1.ez
>  -rw-r--r--  1 lgm staff  19682 May 18 13:42 rabbitmq-mochiweb-2.4.1.ez
>  -rw-r--r--  1 lgm staff  57049 May 18 13:42 webmachine-2.4.1.ez
> 
> 
> 
> to the plugins directory. When i initiate the rabbit server i get some interesting reports. Does the trace below indicate a healthy install and start up?
> 
> Best wishes, 
> 
> --greg
> 
> bash-3.2$ sudo rabbitmq-server &
> [1] 47962
> bash-3.2$ Activating RabbitMQ plugins ...
> *WARNING* Undefined function fdsrv:bind_socket/2
> *WARNING* Undefined function fdsrv:start/0
> *WARNING* Undefined function fdsrv:stop/0
> *WARNING* Undefined function file_handle_cache:info/1
> *WARNING* Undefined function rabbit_access_control:list_vhosts/2
> *WARNING* Undefined function rabbit_auth_backend_internal:add_user/2
> *WARNING* Undefined function rabbit_auth_backend_internal:clear_admin/1
> *WARNING* Undefined function rabbit_auth_backend_internal:clear_permissions/2
> *WARNING* Undefined function rabbit_auth_backend_internal:delete_user/1
> *WARNING* Undefined function rabbit_auth_backend_internal:list_permissions/0
> *WARNING* Undefined function rabbit_auth_backend_internal:list_user_permissions/1
> *WARNING* Undefined function rabbit_auth_backend_internal:list_user_vhost_permissions/2
> *WARNING* Undefined function rabbit_auth_backend_internal:list_users/0
> *WARNING* Undefined function rabbit_auth_backend_internal:list_vhost_permissions/1
> *WARNING* Undefined function rabbit_auth_backend_internal:lookup_user/1
> *WARNING* Undefined function rabbit_auth_backend_internal:set_admin/1
> *WARNING* Undefined function rabbit_auth_backend_internal:set_permissions/5
> *WARNING* Undefined function rabbit_channel:ready_for_close/1
> *WARNING* Undefined function rabbit_command_assembler:analyze_frame/3
> *WARNING* Undefined function rabbit_command_assembler:init/1
> *WARNING* Undefined function rabbit_exchange:declare/6
> *WARNING* Undefined function rabbit_misc:ntoa/1
> *WARNING* Undefined function rabbit_misc:ntoab/1
> *WARNING* Undefined function rabbit_reader:process_channel_frame/5
> *WARNING* Undefined function rabbit_registry:lookup_all/1
> *WARNING* Undefined function rabbit_vhost:add/1
> *WARNING* Undefined function rabbit_vhost:delete/1
> *WARNING* Undefined function rabbit_vhost:exists/1
> *WARNING* Undefined function rabbit_vhost:list/0
> *WARNING* Undefined function webmachine_resource:start_link/2
> 6 plugins activated:
> * amqp_client-2.4.1
> * mochiweb-1.3
>  * rabbit_management-2.4.1
> * rabbit_management_agent-2.4.1
> * rabbit_mochiweb-2.4.1
> * webmachine-1.7.0
> 
> 
> +---+  +---+
> |  |  |  |
> |  |  |  |
> |  |  |  |
> |  +---+  +-------+
> |  |
> | RabbitMQ +---+  |
> |  |  |  |
> |  v2.2.0 +---+  |
> |  |
>  +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
> Licensed under the MPL. See http://www.rabbitmq.com/
> 
> node  : rabbit at BiosimiMac1-2
> app descriptor : /Users/lgm/work/src/devtools/rabbit/rabbitmq_server-2.2.0/sbin/../ebin/rabbit.app
> home dir  : /Users/lgm
> cookie hash : 7vyF5kbCgbq9jjMP2sUa3w==
> log : /var/log/rabbitmq/rabbit at BiosimiMac1-2.log
> sasl log  : /var/log/rabbitmq/rabbit at BiosimiMac1-2-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit at BiosimiMac1-2
>  erlang version : 5.8.2
> 
> starting file handle cache server  ...done
> starting worker pool ...done
>  starting database  ...done
> starting codec correctness check ...done
> -- external infrastructure ready
> starting statistics event manager  ...done
> starting logging server  ...done
> starting exchange type registry  ...done
> starting exchange type direct  ...done
> starting exchange type fanout  ...done
> starting exchange type headers ...done
> starting exchange type topic ...done
> -- kernel ready
> starting alarm handler ...done
> starting node monitor  ...done
> starting cluster delegate  ...done
> starting guid generator  ...done
> starting memory monitor  ...done
> -- core initialized
> starting empty DB check  ...done
> starting exchange recovery ...done
> starting management agent  ...done
> starting management statistics database  ...done
> starting queue supervisor and queue recovery ...done
> -- message delivery logic ready
> starting error log relay ...done
>  starting networking  ...done
> -- network listeners available
> 
> broker running
> ** Found 0 name clashes in code paths 
> 
> bash-3.2$ 
> -- 
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136
> 
> +1 206.650.3740
> 
> http://biosimilarity.blogspot.com 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110518/e66d190b/attachment.htm>

From subbareddykv at gmail.com  Thu May 19 06:11:33 2011
From: subbareddykv at gmail.com (Venkata Subba Reddy Kota)
Date: Thu, 19 May 2011 10:41:33 +0530
Subject: [rabbitmq-discuss] RabbitMQ server installation issue on SUSE
 Linux (SLES)
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5028DD5E2A9@EXCH-MBX-3.vmware.com>
References: <BANLkTikjT1hsW-KDXyfhFLnK8xySsnqd3g@mail.gmail.com>
	<yrv4cboz1qv1o.fsf@dwragg.eng.vmware.com>
	<BANLkTimWcfMy3EZ=cSwywP+D4TtWn6pCzw@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5E2A9@EXCH-MBX-3.vmware.com>
Message-ID: <BANLkTimHLO6v8R+udAH8dW9PC99OVi7qzA@mail.gmail.com>

Thanks jerry and david

On Wed, May 18, 2011 at 8:33 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Venkata:
>
> > It worked david. Thank you.
> > Did anybody tested RabbitMQ Server 2.4.1 on SLES?
>
> Indeed, the combination of a 2.4.1 RabbitMQ broker, running on
> SLES-11, is regularly used by a couple of teams within VMware.
>
> Although the testing of it isn't focused on exercising Rabbit per se,
> it is in regular enough use to support confidence in the
> configuration.
>
> Best regards,
> Jerry
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110519/2d839270/attachment.htm>

From Kotreshi_Chikkabidari at mindtree.com  Thu May 19 06:28:19 2011
From: Kotreshi_Chikkabidari at mindtree.com (Kotreshi Chikkabidari)
Date: Thu, 19 May 2011 05:28:19 +0000
Subject: [rabbitmq-discuss] Connections are blocked after long idle time
Message-ID: <4FA68B7495F3C44487DB72B8762B1CD416C85E@MTW02MBX05.mindtree.com>

Hi,

                We are using rabbitmq 2.2 , Sometime after long idle time (70+ hours) connections are blocked and not consuming any messages. If we restart/recreate connections then working fine.
May I know what might be the problem ? It's not happening consistently.

Regards,
Kotreshi Chikkabidari | MindTree Ltd. | Global Village, RVCE Post, Mysore Road, Bangalore - 560059 | Mobile +91-9743978229 | email: kotreshi_chikkabidari at mindtree.com<https://email.mindtree.com/OWA/redir.aspx?C=1e7bf18508bd42f7972f2bcf6a2905a2&URL=mailto%3aPallavi_Garg%40mindtree.com> | www.mindtree.com<https://email.mindtree.com/OWA/redir.aspx?C=1e7bf18508bd42f7972f2bcf6a2905a2&URL=https%3a%2f%2femail.mindtree.com%2fowa%2fUrlBlockedError.aspx>


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110519/f9b714b9/attachment-0001.htm>

From iconara at gmail.com  Thu May 19 06:35:34 2011
From: iconara at gmail.com (Theo)
Date: Wed, 18 May 2011 22:35:34 -0700 (PDT)
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <07539175-27e8-4899-ab62-04a9910bcde5@j23g2000yqc.googlegroups.com>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>
	<20110518160148.GB14406@wellquite.org>
	<08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>
	<07539175-27e8-4899-ab62-04a9910bcde5@j23g2000yqc.googlegroups.com>
Message-ID: <cea1328c-b8a6-43bc-88d9-64db0db93f55@e21g2000yqe.googlegroups.com>

I rewrote my test code in Java, just to make sure there's nothing with
the Ruby driver that is causing the problem, here is the code:
https://gist.github.com/980238

I ran that with more or less the same result. After a few minutes at
20K publishes/deliveries/acks per second the cluster rotted and all
connections got blocked. What's more, this time I saw that if I turned
off my producers the web UI still reported messages being published
for several minutes -- no producers were running (I'm absolutely sure
the processes were terminated) but there were still messages being
published.

Theo

On May 18, 10:47?pm, Theo <icon... at gmail.com> wrote:
> Eventually (a couple of hours without any connections) the node
> returned to normal memory usage, so I launched a new batch of tests. I
> saw a sustained load of 20K published/delivered/acked for a few
> minutes, with the memory usage of each node increasing rapidly. After
> perhaps five minutes the cluster rotted completely. No messages
> published, nothing delivered, all connections are blocked.
>
> 20K messages over four nodes, that shouldn't be a problem? From my
> point of view it looks like RabbitMQ is leaking memory badly, but that
> couldn't be, could it?
>
> At this point there is no message on any queue, according to the web
> UI, but each node is still using over 3Gb RAM.
>
> Theo
>
> On May 18, 6:15?pm, Theo <icon... at gmail.com> wrote:
>
>
>
>
>
>
>
> > 2.4.1, should have been more specific. the OS is ubuntu 10.04, btw.
>
> > there's a lot of warnings in the log about memory usage, but it's more
> > or less the same thing over and over again:
>
> > =INFO REPORT==== 18-May-2011::14:37:20 ===
> > vm_memory_high_watermark set. Memory used:3327376104 allowed:
> > 3006570496
>
> > =INFO REPORT==== 18-May-2011::14:37:20 ===
> > ? ? alarm_handler: {set,
> > {{vm_memory_high_watermark,rabbit at rfmmqstaging01},[]}}
>
> > then I found this, not sure if it's important (pasted it into a gist):
>
> >https://gist.github.com/978897
>
> > this is the version of erlang:
>
> > Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:8:8] [rq:8] [async-
> > threads:0] [hipe] [kernel-poll:false]
>
> > I've been watching the management UI since I posted my first message
> > (almost an hour ago) and the memory usage hasn't gone down. can a node
> > get bad? the other nodes look ok, but the one that's in the red in the
> > screenshot is still in the red. no connections to the server for an
> > hour.
>
> > T#
>
> > On May 18, 6:01?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:> Hi Theo,
>
> > > On Wed, May 18, 2011 at 08:22:13AM -0700, Theo wrote:
> > > > More specifics on the setup: the cluster consists of 4 EC2 instances
> > > > with 8 CPUs and 7 Gb RAM each (I forget the exact instance name)
> > > > running RabbitMQ 2.4.
>
> > > Is that 2.4.0 or 2.4.1? If not 2.4.1, please upgrade. Which version of
> > > Erlang are you running? Is there anything of note other than connections
> > > and memory alarms in any of the logs?
>
> > > Matthew
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From wtkane07 at gmail.com  Thu May 19 08:37:38 2011
From: wtkane07 at gmail.com (kane)
Date: Thu, 19 May 2011 09:37:38 +0200
Subject: [rabbitmq-discuss] question on the RpcClient class
In-Reply-To: <BANLkTimHFFKdivm_xZO0Wvki=Y2OzocLLg@mail.gmail.com>
References: <BANLkTi=9V5b6kLgn-HKfZnt4FC-LGs6DPA@mail.gmail.com>
	<BANLkTimHFFKdivm_xZO0Wvki=Y2OzocLLg@mail.gmail.com>
Message-ID: <BANLkTimvkpMqgcwpit90QkTMus7tz9a+PQ@mail.gmail.com>

thanks for removing the question...

2011/5/19 Randall Richard <randall at trellisapp.com>

>
> I happened to have the source code handy for RpcClient.  Looks like the
> reply queue is set up via the setupReplyQueue() method below.
>
>     /**
>      * Creates a server-named exclusive autodelete queue to use for
>      * receiving replies to RPC requests.
>      * @throws IOException if an error is encountered
>      * @return the name of the reply queue
>      */
>     protected String setupReplyQueue() throws IOException {
>         return _channel.queueDeclare("", false, true, true,
> null).getQueue();
>     }
>
> *queueDeclare<http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.4.1/rabbitmq-java-client-javadoc-2.4.1/com/rabbitmq/client/Channel.html#queueDeclare%28java.lang.String,+boolean,+boolean,+boolean,+java.util.Map%29>
> *(java.lang.String queue, boolean durable, boolean exclusive,
> boolean autoDelete,
> java.util.Map<java.lang.String,java.lang.Object> arguments)
>
> So, it looks like it's declared with exclusivity as true.
>
> Regards,
>
> -Randall
>
> On Wed, May 18, 2011 at 2:13 PM, kane <wtkane07 at gmail.com> wrote:
>
>> I have a question regarding a class of the package com.rabbitmq.client
>> the calss in question is RpcClient and use as follows:
>>
>>   RpcClient service = new RpcClient (channel, "", cost.request_queue);
>>
>>   return = service.stringCall (message);
>>
>>
>> This calss I automatically generates a queue on which the client waits for
>> a response.
>>
>> Let me know if this queue is exclusive?
>>
>> I make this question because in the javadoc documentation of the class is
>> written as follows:
>>
>> rpcclient public (the English Channel,
>>                     java.lang.String exchange,
>>                     java.lang.String routingKey)
>>              throws java.io.IOException
>>
>>        Building a new rpcclient that communicate on the designated
>> channel, sending requests for data routing with the given key.
>>
>>        Causes the creation of a temporary private queue autodelete.
>>
>> ...
>>
>> The last sentence says that creates a temporary queue, autodelete and here
>> we are, then says that the tail is private
>>
>> I wonder if the word in the phrase "private" is intended to be exclusive
>> ...
>> may seem trivial but sometimes a word changes the meaning of a sentence
>> ... thanks!
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110519/f4495322/attachment.htm>

From matthew at rabbitmq.com  Thu May 19 08:41:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 19 May 2011 08:41:57 +0100
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <cea1328c-b8a6-43bc-88d9-64db0db93f55@e21g2000yqe.googlegroups.com>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>
	<20110518160148.GB14406@wellquite.org>
	<08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>
	<07539175-27e8-4899-ab62-04a9910bcde5@j23g2000yqc.googlegroups.com>
	<cea1328c-b8a6-43bc-88d9-64db0db93f55@e21g2000yqe.googlegroups.com>
Message-ID: <20110519074157.GA2560@rabbitmq.com>

Hi Theo,

R13B03 is a little old, but I think should still be fine.

> > >https://gist.github.com/978897

Hmm, curious. As a first change, could you try removing all plugins and
trying again please?

Matthew

From iconara at gmail.com  Thu May 19 09:08:57 2011
From: iconara at gmail.com (Theo)
Date: Thu, 19 May 2011 01:08:57 -0700 (PDT)
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <20110519074157.GA2560@rabbitmq.com>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>
	<20110518160148.GB14406@wellquite.org>
	<08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>
	<07539175-27e8-4899-ab62-04a9910bcde5@j23g2000yqc.googlegroups.com>
	<cea1328c-b8a6-43bc-88d9-64db0db93f55@e21g2000yqe.googlegroups.com>
	<20110519074157.GA2560@rabbitmq.com>
Message-ID: <ef46c06d-8bc7-4b52-986f-eefe0dac8d3e@m10g2000yqd.googlegroups.com>

we only have the requirements for the management UI installed, should
I remove these? I don't know how to monitor the performance of the
cluster without the management UI. I know of rabbitmqctl, but is there
a way to see publishes/deliveries/acks per second in the same way as
you can in the UI?

these are the files in the plugins directory, from what I can tell
they correspond exactly to the requirements of the management UI:

amqp_client-2.4.1.ez
mochiweb-2.4.1.ez
rabbitmq-management-2.4.1.ez
rabbitmq-management-agent-2.4.1.ez
rabbitmq-mochiweb-2.4.1.ez
webmachine-2.4.1.ez

Theo


On May 19, 9:41?am, Matthew Sackman <matt... at rabbitmq.com> wrote:
> Hi Theo,
>
> R13B03 is a little old, but I think should still be fine.
>
> > > >https://gist.github.com/978897
>
> Hmm, curious. As a first change, could you try removing all plugins and
> trying again please?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Thu May 19 09:34:29 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 19 May 2011 09:34:29 +0100
Subject: [rabbitmq-discuss] Connections are blocked after long idle time
In-Reply-To: <4FA68B7495F3C44487DB72B8762B1CD416C85E@MTW02MBX05.mindtree.com>
References: <4FA68B7495F3C44487DB72B8762B1CD416C85E@MTW02MBX05.mindtree.com>
Message-ID: <4DD4D615.1050305@rabbitmq.com>


Hi Kotreshi,

On 19/05/11 06:28, Kotreshi Chikkabidari wrote:
> Hi,
>
> We are using rabbitmq 2.2 , Sometime after long idle time (70+ hours)
> connections are blocked and not consuming any messages. If we
> restart/recreate connections then working fine.
>
> May I know what might be the problem ? It?s not happening consistently.

You have not provided enough information to venture a diagnosis. Is 
there anything in the broker logfile around the time when connections 
become blocked? Does "rabbitmqctl list_connections" return the expected 
number of connections? (And does this agree with the number of 
connections reported by netstat?)

Are there any network devices between the broker and the clients that 
could be interfering with the traffic? Does turning on AMQP heartbeats 
make any difference?


-Emile

From emile at rabbitmq.com  Thu May 19 09:47:54 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 19 May 2011 09:47:54 +0100
Subject: [rabbitmq-discuss] question on the RpcClient class
In-Reply-To: <BANLkTi=9V5b6kLgn-HKfZnt4FC-LGs6DPA@mail.gmail.com>
References: <BANLkTi=9V5b6kLgn-HKfZnt4FC-LGs6DPA@mail.gmail.com>
Message-ID: <4DD4D93A.5030101@rabbitmq.com>

Hi kane,

On 18/05/11 19:13, kane wrote:

> [...] the javadoc documentation of the class is written as follows:
> rpcclient public (the English Channel,

If it says that then javadoc is badly broken! I assume this is 
over-eager spell-checking. It should say this:

    public RpcClient(Channel channel,

> I wonder if the word in the phrase "private" is intended to be exclusive ...

Yes.


-Emile

From matthias at rabbitmq.com  Thu May 19 10:28:29 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 May 2011 10:28:29 +0100
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <cea1328c-b8a6-43bc-88d9-64db0db93f55@e21g2000yqe.googlegroups.com>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>	<20110518160148.GB14406@wellquite.org>	<08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>	<07539175-27e8-4899-ab62-04a9910bcde5@j23g2000yqc.googlegroups.com>
	<cea1328c-b8a6-43bc-88d9-64db0db93f55@e21g2000yqe.googlegroups.com>
Message-ID: <4DD4E2BD.3050206@rabbitmq.com>

Theo,

On 19/05/11 06:35, Theo wrote:
> I rewrote my test code in Java, just to make sure there's nothing with
> the Ruby driver that is causing the problem, here is the code:
> https://gist.github.com/980238
>
> I ran that with more or less the same result. After a few minutes at
> 20K publishes/deliveries/acks per second the cluster rotted and all
> connections got blocked. What's more, this time I saw that if I turned
> off my producers the web UI still reported messages being published
> for several minutes -- no producers were running (I'm absolutely sure
> the processes were terminated) but there were still messages being
> published.

The figure you see reported in the management UI is the rate at which 
rabbit processes these messages. The publisher code publishes messages 
as fast as it can, which is a far higher rate than rabbit can process 
them. Hence rabbit is buffering the messages in order to try to keep up. 
That way rabbit can handle brief periods of high publishing rate.

However, if publishing continues at a high rate then eventually the 
buffers fill up all memory. At that point rabbit blocks further 
publishes until the buffers have been drained sufficiently to allow 
publishing to resume. This can take a while since rabbit has to page the 
messages to disk in order to free up space.

Moreover, as soon as the publishers are unblocked, if they resume 
publishing at the high rate, as is the case in your test, the memory 
limit will be hit again quickly. Hence you will see rabbit "bouncing off 
the limiter", where publishers get unblocked briefly and then blocked again.


This is all quite normal.


Regards,

Matthias.

From simon at rabbitmq.com  Thu May 19 10:36:39 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 May 2011 10:36:39 +0100
Subject: [rabbitmq-discuss] successful plugins?
In-Reply-To: <9B7A3711B03948E2AAD5475479A7A32C@myyearbook.com>
References: <BANLkTi=Ya5B7umsWdmS=YKO_Kg799GcqqA@mail.gmail.com>
	<9B7A3711B03948E2AAD5475479A7A32C@myyearbook.com>
Message-ID: <4DD4E4A7.10604@rabbitmq.com>

On 19/05/11 02:31, Gavin M. Roy wrote:
> Looks to me like you're using 2.4.1 plugins with a 2.2.0 install. 2.4.1
> is a worthwhile upgrade, and since you're already restarting for the
> plugins, it should be a minimal thing to update. Otherwise, you'll want
> to grab the 2.2.0 tagged plugins.

 From here: http://www.rabbitmq.com/releases/plugins/v2.2.0/

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From suniluiit at gmail.com  Thu May 19 10:56:47 2011
From: suniluiit at gmail.com (Sunil Kapoor)
Date: Thu, 19 May 2011 15:26:47 +0530
Subject: [rabbitmq-discuss] Unable RabbitMQ Server as no-root user
Message-ID: <BANLkTi=juEZWAXBHiO_y=xdrdvicxqK0cQ@mail.gmail.com>

Hi all,
I have install rabbitmq server through rpm. It is running fine when running
from root user or sudo user.
I have created a user sunil and assigned rabbitmq group as secondary group
for user sunil. And I have also given permission to installed directories
and log directory of rabbitmq setup. But still when i am running
/etc/init.d/rabbitmq-server start it is not able to run in the startup log i
am getting following exception in the log file
/var/log/rabbitmq/startup_log.

Usage:
rabbitmq-multi <command> [<command options>]

Commands:
    start_all <count>
    status
    stop_all
    rotate_logs



Only root or rabbitmq should run rabbitmq-multi




Please let me know if i am doing anything wrong.

Sunil Kumar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110519/60545bec/attachment.htm>

From iconara at gmail.com  Thu May 19 11:00:01 2011
From: iconara at gmail.com (Theo)
Date: Thu, 19 May 2011 03:00:01 -0700 (PDT)
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <4DD4E2BD.3050206@rabbitmq.com>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>
	<20110518160148.GB14406@wellquite.org>
	<08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>
	<07539175-27e8-4899-ab62-04a9910bcde5@j23g2000yqc.googlegroups.com>
	<cea1328c-b8a6-43bc-88d9-64db0db93f55@e21g2000yqe.googlegroups.com>
	<4DD4E2BD.3050206@rabbitmq.com>
Message-ID: <2153f4f9-d1dd-4b22-a46a-141373088a52@x3g2000yqj.googlegroups.com>

Ok, thanks for the clarification, it makes sense, and it's more or
less what we figured. I was hoping there was another explanation, that
would be fixable.

What kind of performance should we expect when running on EC2? It
feels like 20K messages per second shouldn't be a problem for a four
node cluster where each node has 8 CPUs and 7 Gb RAM. to get any kind
of performance and stability we have had to tune how we work with the
cluster, making sure that queues are distributed over the nodes, that
each node has more than one queue, that the connections from the
producers and consumers are evenly distributed over the nodes, etc.
even slight asymmetries show up quite quickly in the memory usage of a
node, and as soon as that happens it's only minutes before the whole
cluster goes bad. Topic exchanges seem to be completely out of the
question, it only takes minutes before every node gets overloaded.

With a direct exchange and extreme attention to symmetry we have
achieved a sustained publish/deliver/ack load of 40K/s for as long as
we ran the test, and we can probably live with that. The idea was to
use a topic exchange, but at this point it seems like that is
completely out of the question, but we can probably move that
functionality into the application (just like we had to move load
balancing into the application because queues are bound to CPUs).

Theo

On May 19, 11:28?am, Matthias Radestock <matth... at rabbitmq.com> wrote:
> Theo,
>
> On 19/05/11 06:35, Theo wrote:
>
> > I rewrote my test code in Java, just to make sure there's nothing with
> > the Ruby driver that is causing the problem, here is the code:
> >https://gist.github.com/980238
>
> > I ran that with more or less the same result. After a few minutes at
> > 20K publishes/deliveries/acks per second the cluster rotted and all
> > connections got blocked. What's more, this time I saw that if I turned
> > off my producers the web UI still reported messages being published
> > for several minutes -- no producers were running (I'm absolutely sure
> > the processes were terminated) but there were still messages being
> > published.
>
> The figure you see reported in the management UI is the rate at which
> rabbit processes these messages. The publisher code publishes messages
> as fast as it can, which is a far higher rate than rabbit can process
> them. Hence rabbit is buffering the messages in order to try to keep up.
> That way rabbit can handle brief periods of high publishing rate.
>
> However, if publishing continues at a high rate then eventually the
> buffers fill up all memory. At that point rabbit blocks further
> publishes until the buffers have been drained sufficiently to allow
> publishing to resume. This can take a while since rabbit has to page the
> messages to disk in order to free up space.
>
> Moreover, as soon as the publishers are unblocked, if they resume
> publishing at the high rate, as is the case in your test, the memory
> limit will be hit again quickly. Hence you will see rabbit "bouncing off
> the limiter", where publishers get unblocked briefly and then blocked again.
>
> This is all quite normal.
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu May 19 11:05:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 May 2011 11:05:11 +0100
Subject: [rabbitmq-discuss] Unable RabbitMQ Server as no-root user
In-Reply-To: <BANLkTi=juEZWAXBHiO_y=xdrdvicxqK0cQ@mail.gmail.com>
References: <BANLkTi=juEZWAXBHiO_y=xdrdvicxqK0cQ@mail.gmail.com>
Message-ID: <4DD4EB57.9@rabbitmq.com>

On 19/05/11 10:56, Sunil Kapoor wrote:
> Hi all,
> I have install rabbitmq server through rpm. It is running fine when
> running from root user or sudo user.
> I have created a user sunil and assigned rabbitmq group as secondary
> group for user sunil. And I have also given permission to installed
> directories and log directory of rabbitmq setup. But still when i am
> running /etc/init.d/rabbitmq-server start it is not able to run in the
> startup log i am getting following exception in the log file
> /var/log/rabbitmq/startup_log.
>
> Usage:
> rabbitmq-multi <command> [<command options>]
>
> Commands:
>      start_all <count>
>      status
>      stop_all
>      rotate_logs
>
>
>
> Only root or rabbitmq should run rabbitmq-multi

With the standard RPM packaging of RabbitMQ, running 
/etc/init.d/rabbitmq-server start as root will cause the server to run 
as the rabbitmq user.

This is achieved by wrapping the rabbitmq-server, rabbitmqctl and (on 
older versions that have it) rabbitmq-multi scripts in a script that 
becomes the rabbitmq user (and thus needs root privileges to do so).

If you want to run RabbitMQ as a different user, you'll need to invoke 
the "real" scripts which are located in /usr/lib/rabbitmq/bin/. You may 
also need to do some redirecting and nohupping.

But if you just want to drop privileges, that happens by default.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From suniluiit at gmail.com  Thu May 19 10:49:07 2011
From: suniluiit at gmail.com (Sunil Kumar)
Date: Thu, 19 May 2011 02:49:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable RabbitMQ Server as no-root user
Message-ID: <26c582fe-df56-46bc-a7fb-36473b646cc5@z13g2000prk.googlegroups.com>

Hi all,
I have install rabbitmq server through rpm. It is running fine when
running from root user or sudo user.
I have created a user sunil and assigned rabbitmq group as secondary
group for user sunil. And I have also given permission to installed
directories and log directory of rabbitmq setup. But still when i am
running /etc/init.d/rabbitmq-server start it is not able to run in the
startup log i am getting following exception in the log file /var/log/
rabbitmq/startup_log.

Usage:
rabbitmq-multi <command> [<command options>]

Commands:
    start_all <count>
    status
    stop_all
    rotate_logs



Only root or rabbitmq should run rabbitmq-multi




Please let me know if i am doing anything wrong.

From suniluiit at gmail.com  Thu May 19 11:15:37 2011
From: suniluiit at gmail.com (Sunil Kapoor)
Date: Thu, 19 May 2011 15:45:37 +0530
Subject: [rabbitmq-discuss] Unable to run RabbitMQ Server as no-root user
Message-ID: <BANLkTi=ET68rBjmbnjxo81YFmdVUhGr-bg@mail.gmail.com>

Hi all,
I have install rabbitmq server through rpm. It is running fine when running
from root user or sudo user.
I have created a user sunil and assigned rabbitmq group as secondary group
for user sunil. And I have also given permission to installed directories
and log directory of rabbitmq setup. But still when i am running
/etc/init.d/rabbitmq-server start it is not able to run in the startup log i
am getting following exception in the log file
/var/log/rabbitmq/startup_log.

Usage:
rabbitmq-multi <command> [<command options>]

Commands:
    start_all <count>
    status
    stop_all
    rotate_logs



Only root or rabbitmq should run rabbitmq-multi




Please let me know if i am doing anything wrong.

-Sunil Kumar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110519/0179f833/attachment-0001.htm>

From matthias at rabbitmq.com  Thu May 19 11:19:47 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 May 2011 11:19:47 +0100
Subject: [rabbitmq-discuss] exessive memory usage and blocked connection,
 even when no messages left
In-Reply-To: <2153f4f9-d1dd-4b22-a46a-141373088a52@x3g2000yqj.googlegroups.com>
References: <4e130a49-5783-45fa-a99b-9a2c1ae720be@v10g2000yqn.googlegroups.com>	<20110518160148.GB14406@wellquite.org>	<08ae3ccf-c835-4c85-ab05-e1860ef6472b@y12g2000yqh.googlegroups.com>	<07539175-27e8-4899-ab62-04a9910bcde5@j23g2000yqc.googlegroups.com>	<cea1328c-b8a6-43bc-88d9-64db0db93f55@e21g2000yqe.googlegroups.com>	<4DD4E2BD.3050206@rabbitmq.com>
	<2153f4f9-d1dd-4b22-a46a-141373088a52@x3g2000yqj.googlegroups.com>
Message-ID: <4DD4EEC3.8070803@rabbitmq.com>

Theo,

On 19/05/11 11:00, Theo wrote:
> Ok, thanks for the clarification, it makes sense, and it's more or
> less what we figured. I was hoping there was another explanation,
> that would be fixable.
>
> What kind of performance should we expect when running on EC2? It
> feels like 20K messages per second shouldn't be a problem for a four
>  node cluster where each node has 8 CPUs and 7 Gb RAM.

20kHz shouldn't be a problem even for just a single 4-core machine,
assuming messages sizes are fairly small.

> to get any kind of performance and stability we have had to tune how
> we work with the cluster, making sure that queues are distributed
> over the nodes, that each node has more than one queue, that the
> connections from the producers and consumers are evenly distributed
> over the nodes, etc. even slight asymmetries show up quite quickly
> in the memory usage of a node, and as soon as that happens it's only
> minutes before the whole cluster goes bad.

You shouldn't have to do that kind of tuning to get 20kHz. As I said in
your previous email, your publishers publish at a rate far higher than
20kHz. And they do that all the time, not just for some brief peak
period. That's why rabbit eventually fills up all memory with buffered
messages and has to pause producers. If you run tests with throttled
producer, e.g. get producers to publish messages at a certain rate, then
rabbit will happily keep up with that rate forever.

> Topic exchanges seem to be completely out of the question, it only
> takes minutes before every node gets overloaded.

Again, that is due to the fact that the publishers operate at a far 
higher rate than is sustainable.

Regards,

Matthias.

From tstagl at digitalriver.com  Thu May 19 13:35:34 2011
From: tstagl at digitalriver.com (Thomas Stagl)
Date: Thu, 19 May 2011 14:35:34 +0200
Subject: [rabbitmq-discuss] queue hands - timeout
Message-ID: <9C5CE94A-0666-4633-8E86-A5EF80A809BE@digitalriver.com>

Hello,

we are running a queue in our test environment with different vhosts. When we do a long running perf test, we recognise that the responses from the queue are timing out and from that moment on, it is not possible to connect to the queue again. Neither with the java lib (which we use in our application) nor with celery (which I use for testing purposes.)

We have recognised that beam.smp is running on 30% CPU time from that moment on.

When we trace a connection, we see this with tcpdump:
12:23:52.700093 IP CLIENT.43248 > RABBIT.amqp: Flags [P.], seq 2421288989:2421289002, ack 2617563671, win 54, options [nop,nop,TS val 2047452 ecr 1377663677], length 13
12:23:52.700124 IP RABBIT.amqp > CLIENT.43248: Flags [.], ack 13, win 62, options [nop,nop,TS val 1377881158 ecr 2047452], length 0

From that moment on, the connection is hanging.

After a restart of the rabbitmq server, everything is running fine again, for a certain amount of time.

We also have a second test stack and we switched to the second rabbitmq test server, same behaviour here. It worked fine and after a couple of hours it stopped responding.

Any ideas? Any though about where we can start debugging would be very much appreciated.

Best regards, tom


From Kotreshi_Chikkabidari at mindtree.com  Thu May 19 14:08:41 2011
From: Kotreshi_Chikkabidari at mindtree.com (Kotreshi Chikkabidari)
Date: Thu, 19 May 2011 13:08:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ - Message parsing
Message-ID: <4FA68B7495F3C44487DB72B8762B1CD416CAA5@MTW02MBX05.mindtree.com>

Hi,

Do RabbitMQ has mechanism to parse the queue and pick selective message based on header/message content?

If message need to be de-queued for above, is there a mechanism to put message back in queue (basically not sending acknowledgment and release lock or sending a negative acknowledgement)?

Regards
Kotresh


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110519/e865e5a2/attachment.htm>

From matthew at rabbitmq.com  Thu May 19 14:11:01 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 19 May 2011 14:11:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ - Message parsing
In-Reply-To: <4FA68B7495F3C44487DB72B8762B1CD416CAA5@MTW02MBX05.mindtree.com>
References: <4FA68B7495F3C44487DB72B8762B1CD416CAA5@MTW02MBX05.mindtree.com>
Message-ID: <20110519131101.GB23652@rabbitmq.com>

Hi,

On Thu, May 19, 2011 at 01:08:41PM +0000, Kotreshi Chikkabidari wrote:
> Do RabbitMQ has mechanism to parse the queue and pick selective message based on header/message content?

Nope.

> If message need to be de-queued for above, is there a mechanism to put message back in queue (basically not sending acknowledgment and release lock or sending a negative acknowledgement)?

Nope.

Queues in Rabbit are strict FIFO structures. There is no queue browsing,
peeking or any other such.

Matthew

From rkimball at pangeamedia.com  Thu May 19 21:44:59 2011
From: rkimball at pangeamedia.com (Ronald J Kimball)
Date: Thu, 19 May 2011 16:44:59 -0400
Subject: [rabbitmq-discuss] Perl Net::RabbitMQ and failure conditions
Message-ID: <BANLkTim==hb=hDLCqEN=0J5vfbHQN14BOw@mail.gmail.com>

I'm trying to understand how RabbitMQ behaves under failure conditions,
specifically when using the Net::RabbitMQ Perl module.

We have RabbitMQ set up with three nodes, one on the backend, which holds
the actual queues, and two on the frontend, which receive publish requests.

RabbitMQ 2.2.0
Net::RabbitMQ 0.1.8


Below is the chart of behaviors that I have observed.

"+" means the behavior is as I expected: either the message is successfully
queued, or an error is thrown.
"-" means the behavior is not as I expected, but can be managed:
specifically, the process receives a SIGPIPE, which I can trap and recover
from.
"!" means the behavior is not as I expected, and cannot be managed: the
message is not queued but no error is thrown and/or the process hangs.

"App down" means I ran `rabbitmqctl stop_app`.  "Daemon down" means I ran
`rabbitmqctl stop`.

  As publishing process starts up:

    Remote daemon up, app up
      + Everything okay

    Remote daemon up, app down
      ! Net::RabbitMQ hangs when declaring queue

    Remote daemon down
      + Net::RabbitMQ throws error when declaring queue
        "Declaring queue: server channel error 404, message: NOT_FOUND - no
queue 'test' in vhost '/'"

    Local daemon up, app down
      + Net::RabbitMQ throws error when connecting
        "Opening socket: Connection refused"

    Local daemon down
      + Net::RabbitMQ throws error when connecting
        "Opening socket: Connection refused"


  After publishing process starts up:

    Local app goes down
      - Process receives SIGPIPE

    Local daemon goes down
      - Process receives SIGPIPE

    Remote app goes down
      ! Net::RabbitMQ falsely indicates success when publishing, then hangs
(in DESTROY?)

    Remote daemon goes down
      ! Net::RabbitMQ falsely indicates success when publishing


    Local app goes down, comes back up
      - Process receives SIGPIPE

    Local daemon goes down, comes back up
      - Process receives SIGPIPE

    Remote app goes down, comes back up
      + Everything okay

    Remote daemon goes down, comes back up
      + Everything okay


Have other people had these problems with Net::RabbitMQ?  Can we resolve
these issues by changing something in our RabbitMQ configuration?


thanks,
Ronald


P.S. Here's my script.

#!/usr/local/bin/perl

use strict;
use warnings;

use Net::RabbitMQ;

$| = 1;

$SIG{'PIPE'} = sub { die "SIGPIPE\n" };

my $mq = Net::RabbitMQ->new();

alarm(10);

print "Connecting\n";
$mq->connect('localhost', { user => 'engagement', password => '********' })
  or die "Can't connect to RabbitMQ\n";

print "Opening channel\n";
$mq->channel_open(1);

print "Declaring exchange\n";
$mq->exchange_declare(1, 'ee_exchange', { durable => 1 });

print "Declaring queue\n";
$mq->queue_declare(1, 'test', { durable => 1 });

print "Binding queue\n";
$mq->queue_bind(1, 'test', 'ee_exchange', 'ee_test');

alarm(0);

print "> ";
<>;

alarm(10);

print "Publishing message\n";
my $rc =
  $mq->publish(1, 'ee_test', 'hello world!',
               { exchange => 'ee_exchange', mandatory => 1, immediate => 0
},
               { delivery_mode => 2 });
print "Result: $rc\n";

__END__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110519/22c6bf1e/attachment.htm>

From emile at rabbitmq.com  Fri May 20 12:02:36 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 20 May 2011 12:02:36 +0100
Subject: [rabbitmq-discuss] queue hands - timeout
In-Reply-To: <9C5CE94A-0666-4633-8E86-A5EF80A809BE@digitalriver.com>
References: <9C5CE94A-0666-4633-8E86-A5EF80A809BE@digitalriver.com>
Message-ID: <4DD64A4C.7090602@rabbitmq.com>

Hi Thomas,

On 19/05/11 13:35, Thomas Stagl wrote:
> Hello,
>
> we are running a queue in our test environment with different vhosts.
> When we do a long running perf test, we recognise that the responses
> from the queue are timing out and from that moment on, it is not
> possible to connect to the queue again. Neither with the java lib
> (which we use in our application) nor with celery (which I use for
> testing purposes.)
>
> We have recognised that beam.smp is running on 30% CPU time from that
> moment on.
>
> When we trace a connection, we see this with tcpdump: 12:23:52.700093
> IP CLIENT.43248>  RABBIT.amqp: Flags [P.], seq 2421288989:2421289002,
> ack 2617563671, win 54, options [nop,nop,TS val 2047452 ecr
> 1377663677], length 13 12:23:52.700124 IP RABBIT.amqp>  CLIENT.43248:
> Flags [.], ack 13, win 62, options [nop,nop,TS val 1377881158 ecr
> 2047452], length 0
>
> From that moment on, the connection is hanging.
>
> After a restart of the rabbitmq server, everything is running fine
> again, for a certain amount of time.
>
> We also have a second test stack and we switched to the second
> rabbitmq test server, same behaviour here. It worked fine and after a
> couple of hours it stopped responding.
>
> Any ideas? Any though about where we can start debugging would be
> very much appreciated.

We have brokers that have been running for weeks without exhibiting the 
behaviour you describe. Can you help us to emulate your test environment 
more closely?

What version of Erlang, OS and rabbit are you using?
What is the contents of the rabbit config file?
What exactly does the perf test doing? What is the rate and size of 
messsages, number of producers, consumers, are the messages persistent?
If you have the management plugin installed then a copy of the broker 
configuration may be useful.

Does rabbitmqctl still work when the problem occurs? The output of all 
the list_* commands at the time of failure will be useful.

The broker logfile entries around the onset of the problem will also help.

Were there any other applications running on the same OS as rabbit?

Were the consumers (if any) keeping up with producers at or just before 
the onset of the problem?

What was the memory consumption reported by the management plugin at 
this time?

If you can help us to narrow this down to a specific set of conditions 
that reliably trigger the problem that will be a big step towards a 
solution.



Thanks

Emile

From rob at rabbitmq.com  Fri May 20 13:22:27 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 20 May 2011 13:22:27 +0100
Subject: [rabbitmq-discuss] STOMP Heartbeat
In-Reply-To: <135547F4-AFAB-4851-BFEC-F7374B94E49C@kinishi.com>
References: <7A3ABB35-E4BB-4909-B421-2036593984BE@kinishi.com>
	<4DCA9768.8050406@rabbitmq.com>
	<135547F4-AFAB-4851-BFEC-F7374B94E49C@kinishi.com>
Message-ID: <4DD65D03.7070007@rabbitmq.com>

Alex,

I pushed a fix (courtesy of Steve Powell) for this to default today.

Please note that the old, incorrect spelling of 'heartbeat' is not 
supported on default now.

Rob

On 11/05/11 15:31, Alexander Goldstone wrote:
> Thank you Rob. I had not spotted the discrepancy and I can confirm that sending "heartbeat" works exactly as I would have expected and should solve my underlying problem with connections being incorrectly held open by the network.
>
> Much appreciated!
>
> Regards,
>
> Alex
>
>
> On 11 May 2011, at 15:04, Rob Harrop wrote:
>
>> I spotted the problem, we are spelling the header "heartbeat" but the spec has "heart-beat".
>>
>> If you can tweak your code to send "heartbeat" for now that should work, I'll fix this and get the server to send/receive heart-beat.
>>
>> Regards,
>>
>> Rob
>>
>> Alexander Goldstone wrote:
>>> I am running RabbitMQ 2.4.1 with Erlang R13B03 and I have the management and stomp plugins installed.
>>>
>>> I have clients connecting via STOMP over GPRS and I have noticed that if the client does not gracefully disconnect from the server then the 'channel' stays open.
>>>
>>> The cause seems to be that the mobile network (APN) does not realise that the connection has been closed and so it stays connected to the RabbitMQ server.
>>>
>>> The problem with this is that if a message is sent to the remote client and the client does not ACK the message before being non-gracefully disconnected then RabbitMQ does not re-deliver the message to the client the next time it connects to the server.
>>>
>>> I assume the mobile network would time-out eventually however I have seen it hold connections for several hours during testing before I give up and restart the RabbitMQ process to kill off the erroneous connections.
>>>
>>> I see that the new (version 1.1) STOMP protocol provides a heartbeat feature. Does RabbitMQ support this? My assumption is that RabbitMQ would see that the heartbeat frames had stopped being transmitted by the client and the RabbitMQ server would therefore close the channel even if the mobile network is holding the connection open. Is this correct?
>>>
>>> I have not been able to get the heartbeat feature of the STOMP protocol to work however I can see the word "heartbeat" in several locations of the source code implying that it is implemented.
>>>
>>> If I sent this to the server:
>>>
>>> 		CONNECT
>>> 		accept-version:1.1
>>> 		host:/
>>> 		login:guest
>>> 		passcode:guest
>>> 		prefetch:1
>>> 		heart-beat:1,1
>>>
>>> Then I receive this:
>>>
>>> 		CONNECTED
>>> 		session:session-lnvfUXmXdtlVdBE7p35KZQ==
>>> 		heartbeat:0,0
>>> 		version:1.1
>>>
>>> Any feedback as to how I should be using the heartbeat feature of the new STOMP protocol or any other suggestions as to how I solve the underlying problem of channels incorrectly being kept open would be gratefully appreciated.
>>>
>>> Regards,
>>>
>>> Alex
>>>


From taylste at gmail.com  Fri May 20 18:58:33 2011
From: taylste at gmail.com (Steven Taylor)
Date: Fri, 20 May 2011 18:58:33 +0100
Subject: [rabbitmq-discuss] RPC
Message-ID: <BANLkTim-YJLBJUj9SG8XRDo19ovBFVzyvQ@mail.gmail.com>

Is there an example for the RpcClient and the RpcServer classes
(SimpleRpcClient / SimpleRpcServer).  Is it advistable to use these classes?

Alternatively, there's this tutorial
http://www.rabbitmq.com/tutorials/tutorial-six-python.html ... but I don't
know python.  I'm not following the "rpc_client.py" portion.

Here's a guess.  def on_response is defining an event.

"return int(self.response)" waits until the result of "def on_response" is
fired?  If the correlation match fails, execution doesn't return to "return
int(self.response)"

btw: I shouldn't guess.
Is there a C# or Java version?

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110520/52ba0541/attachment.htm>

From simone.busoli at gmail.com  Fri May 20 19:15:44 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 20 May 2011 20:15:44 +0200
Subject: [rabbitmq-discuss] RPC
In-Reply-To: <BANLkTim-YJLBJUj9SG8XRDo19ovBFVzyvQ@mail.gmail.com>
References: <BANLkTim-YJLBJUj9SG8XRDo19ovBFVzyvQ@mail.gmail.com>
Message-ID: <BANLkTi=qAE0i6aqRC-4QNTga29yw2Xtcog@mail.gmail.com>

   Hi Steven, I've written the tutorials in C# here
http://code.google.com/p/mexexp/source/browse/trunk/RabbitMQ

On Fri, May 20, 2011 at 19:58, Steven Taylor <taylste at gmail.com> wrote:

> Is there an example for the RpcClient and the RpcServer classes
> (SimpleRpcClient / SimpleRpcServer).  Is it advistable to use these classes?
>
> Alternatively, there's this tutorial
> http://www.rabbitmq.com/tutorials/tutorial-six-python.html ... but I don't
> know python.  I'm not following the "rpc_client.py" portion.
>
> Here's a guess.  def on_response is defining an event.
>
> "return int(self.response)" waits until the result of "def on_response" is
> fired?  If the correlation match fails, execution doesn't return to "
> return int(self.response)"
>
> btw: I shouldn't guess.
> Is there a C# or Java version?
>
> thanks,
> -Steven
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110520/24a0b7ad/attachment.htm>

From wtkane07 at gmail.com  Fri May 20 22:38:21 2011
From: wtkane07 at gmail.com (kane)
Date: Fri, 20 May 2011 23:38:21 +0200
Subject: [rabbitmq-discuss] RPC
Message-ID: <BANLkTi=g_gJW+m0W9_AGACrHAye0kYOC5A@mail.gmail.com>

This might be useful ...


http://stackoverflow.com/questions/3665515/how-to-implement-rpc-mechanism-using-rabbitmq-in-java
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110520/41be9f86/attachment.htm>

From taylste at gmail.com  Fri May 20 23:34:35 2011
From: taylste at gmail.com (Steven Taylor)
Date: Fri, 20 May 2011 23:34:35 +0100
Subject: [rabbitmq-discuss] RPC
In-Reply-To: <BANLkTi=qAE0i6aqRC-4QNTga29yw2Xtcog@mail.gmail.com>
References: <BANLkTim-YJLBJUj9SG8XRDo19ovBFVzyvQ@mail.gmail.com>
	<BANLkTi=qAE0i6aqRC-4QNTga29yw2Xtcog@mail.gmail.com>
Message-ID: <BANLkTikQXr8X3+PT=vS8t03-v4u5gGiTrQ@mail.gmail.com>

Hi Simone,

thanks.  That's really helpful.

Also, I like your "Run<ProjectX.Runner>(args);" idea.  That's quite neat.
-Steven
On 20 May 2011 19:15, Simone Busoli <simone.busoli at gmail.com> wrote:

>    Hi Steven, I've written the tutorials in C# here
> http://code.google.com/p/mexexp/source/browse/trunk/RabbitMQ
>
> On Fri, May 20, 2011 at 19:58, Steven Taylor <taylste at gmail.com> wrote:
>
>> Is there an example for the RpcClient and the RpcServer classes
>> (SimpleRpcClient / SimpleRpcServer).  Is it advistable to use these classes?
>>
>> Alternatively, there's this tutorial
>> http://www.rabbitmq.com/tutorials/tutorial-six-python.html ... but I
>> don't know python.  I'm not following the "rpc_client.py" portion.
>>
>> Here's a guess.  def on_response is defining an event.
>>
>> "return int(self.response)" waits until the result of "def on_response"
>> is fired?  If the correlation match fails, execution doesn't return to "
>> return int(self.response)"
>>
>> btw: I shouldn't guess.
>> Is there a C# or Java version?
>>
>> thanks,
>> -Steven
>>
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110520/85cb1920/attachment-0001.htm>

From taylste at gmail.com  Fri May 20 23:56:02 2011
From: taylste at gmail.com (Steven Taylor)
Date: Fri, 20 May 2011 23:56:02 +0100
Subject: [rabbitmq-discuss] RPC
In-Reply-To: <BANLkTikQXr8X3+PT=vS8t03-v4u5gGiTrQ@mail.gmail.com>
References: <BANLkTim-YJLBJUj9SG8XRDo19ovBFVzyvQ@mail.gmail.com>
	<BANLkTi=qAE0i6aqRC-4QNTga29yw2Xtcog@mail.gmail.com>
	<BANLkTikQXr8X3+PT=vS8t03-v4u5gGiTrQ@mail.gmail.com>
Message-ID: <BANLkTikmhkYHQotWEhwgGEKE0Rs76FavkA@mail.gmail.com>

Hi Kane,

also a very interesting implementation.  Nice use of anonymous class/types.
Once you get the channel setup out of the way, you get RPC in only a few
lines of code.

For the client side does the server side "handleStringCall" drop "handle"
through convention?  Just tracing this through visually.  I'm not a java
guy.

-Steven

On 20 May 2011 23:34, Steven Taylor <taylste at gmail.com> wrote:

> Hi Simone,
>
> thanks.  That's really helpful.
>
> Also, I like your "Run<ProjectX.Runner>(args);" idea.  That's quite neat.
> -Steven
> On 20 May 2011 19:15, Simone Busoli <simone.busoli at gmail.com> wrote:
>
>>    Hi Steven, I've written the tutorials in C# here
>> http://code.google.com/p/mexexp/source/browse/trunk/RabbitMQ
>>
>> On Fri, May 20, 2011 at 19:58, Steven Taylor <taylste at gmail.com> wrote:
>>
>>> Is there an example for the RpcClient and the RpcServer classes
>>> (SimpleRpcClient / SimpleRpcServer).  Is it advistable to use these classes?
>>>
>>> Alternatively, there's this tutorial
>>> http://www.rabbitmq.com/tutorials/tutorial-six-python.html ... but I
>>> don't know python.  I'm not following the "rpc_client.py" portion.
>>>
>>> Here's a guess.  def on_response is defining an event.
>>>
>>> "return int(self.response)" waits until the result of "def on_response"
>>> is fired?  If the correlation match fails, execution doesn't return to "
>>> return int(self.response)"
>>>
>>> btw: I shouldn't guess.
>>> Is there a C# or Java version?
>>>
>>> thanks,
>>> -Steven
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110520/e4491b81/attachment.htm>

From taylste at gmail.com  Sat May 21 12:14:24 2011
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 21 May 2011 12:14:24 +0100
Subject: [rabbitmq-discuss] 2.4.1 features
Message-ID: <BANLkTim4XMaB+pPMnKsw7=VN7D2EdnJKig@mail.gmail.com>

Hi,

just upgrading from 2.2 to 2.4.1.  Would noAck typically be set to "false"
in prior versions for BasicConsume?
   BasicConsume(string queue, bool noAck, string consumerTag, IBasicConsumer
consumer)

Also, seems like you've snuck in some nice features into the patterns area
like EventingBasicConsumer (thanks Simone for your example on this...
otherwise I wouldn't have known about it). How are you Rabbit folk currently
making announcements about new features?

-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110521/44d30835/attachment.htm>

From taylste at gmail.com  Sat May 21 12:33:00 2011
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 21 May 2011 12:33:00 +0100
Subject: [rabbitmq-discuss] 2.4.1 features
In-Reply-To: <BANLkTim4XMaB+pPMnKsw7=VN7D2EdnJKig@mail.gmail.com>
References: <BANLkTim4XMaB+pPMnKsw7=VN7D2EdnJKig@mail.gmail.com>
Message-ID: <BANLkTimNV4NH0FE6MdMrCJHo6ZYTPyEYWQ@mail.gmail.com>

also, what's consumerTag?  Best I could find on it is, "The ConsumerTag
property of DefaultBasicConsumer can be used to retrieve the
server-generated consumer tag, in cases where none was supplied to the
original IModel.BasicConsume call."

Does that say I can uniquely identify the client, or alternatively
the server... or make some other miscellaneous use out of it?  It'd be nice
if the protocol gurus could put a few notes in about intention, or how the
concept originated.

thanks,
-Steven
On 21 May 2011 12:14, Steven Taylor <taylste at gmail.com> wrote:

> Hi,
>
> just upgrading from 2.2 to 2.4.1.  Would noAck typically be set to "false"
> in prior versions for BasicConsume?
>    BasicConsume(string queue, bool noAck, string consumerTag,
> IBasicConsumer consumer)
>
> Also, seems like you've snuck in some nice features into the patterns area
> like EventingBasicConsumer (thanks Simone for your example on this...
> otherwise I wouldn't have known about it). How are you Rabbit folk currently
> making announcements about new features?
>
> -Steven
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110521/8472d823/attachment.htm>

From taylste at gmail.com  Sat May 21 12:50:10 2011
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 21 May 2011 12:50:10 +0100
Subject: [rabbitmq-discuss] 2.4.1 features
In-Reply-To: <BANLkTimNV4NH0FE6MdMrCJHo6ZYTPyEYWQ@mail.gmail.com>
References: <BANLkTim4XMaB+pPMnKsw7=VN7D2EdnJKig@mail.gmail.com>
	<BANLkTimNV4NH0FE6MdMrCJHo6ZYTPyEYWQ@mail.gmail.com>
Message-ID: <BANLkTikpNV03hS0RAYYJZ3PYN_8b42UdGQ@mail.gmail.com>

slightly better info here:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.consumer-tag

"The consumer tag is local to a channel" -- so we're talking about
identifying one consumer, of many listenning in to a single channel?

If we've got a field/tag for a particular consumer (even one on the same
channel), perhaps it'd be nice to have a publisher-tag as well.  i.e.
issolate a particular publisher for tracing purposes.  reply-to merely
distinguishes the queue.

Maybe I could use "IDictionary arguments" could be used for this instead?
I've ignored "arguments" up until now.

thanks,
-Steven

On 21 May 2011 12:33, Steven Taylor <taylste at gmail.com> wrote:

> also, what's consumerTag?  Best I could find on it is, "The ConsumerTag
> property of DefaultBasicConsumer can be used to retrieve the
> server-generated consumer tag, in cases where none was supplied to the
> original IModel.BasicConsume call."
>
> Does that say I can uniquely identify the client, or alternatively
> the server... or make some other miscellaneous use out of it?  It'd be nice
> if the protocol gurus could put a few notes in about intention, or how the
> concept originated.
>
> thanks,
> -Steven
> On 21 May 2011 12:14, Steven Taylor <taylste at gmail.com> wrote:
>
>> Hi,
>>
>> just upgrading from 2.2 to 2.4.1.  Would noAck typically be set to "false"
>> in prior versions for BasicConsume?
>>    BasicConsume(string queue, bool noAck, string consumerTag,
>> IBasicConsumer consumer)
>>
>> Also, seems like you've snuck in some nice features into the patterns area
>> like EventingBasicConsumer (thanks Simone for your example on this...
>> otherwise I wouldn't have known about it). How are you Rabbit folk currently
>> making announcements about new features?
>>
>> -Steven
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110521/81a70bc8/attachment.htm>

From jon at jbrisbin.com  Sat May 21 21:35:58 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sat, 21 May 2011 15:35:58 -0500
Subject: [rabbitmq-discuss] trying to figure out erlando
Message-ID: <5BD92F51-EAA7-4028-8633-23488DB333A9@jbrisbin.com>

I'm digging through the blog post on Erlando and it seems there's some changes in Erlando recently w.r.t. the error monad. It seems to be called "error_t" now and looks like it works similarly to state_t. Is that correct?

At any rate, I'm still missing something because I can't seem to figure how to use this in the context of the erlang amqp client.

I'm basically trying to do a maybe on getting a channel so I don't have to do: 

case amqp_connection:start(network, AMQPParams) of
  {ok, Conn} -> case amqp_connection:open_channel(AMQP) of
    {ok, Channel} -> % do some work
  end
end

and so on and so forth...

How would I use Erlando for this?

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From matthew at rabbitmq.com  Sun May 22 12:25:58 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 22 May 2011 12:25:58 +0100
Subject: [rabbitmq-discuss] trying to figure out erlando
In-Reply-To: <5BD92F51-EAA7-4028-8633-23488DB333A9@jbrisbin.com>
References: <5BD92F51-EAA7-4028-8633-23488DB333A9@jbrisbin.com>
Message-ID: <20110522112558.GB3010@rabbitmq.com>

On Sat, May 21, 2011 at 03:35:58PM -0500, Jon Brisbin wrote:
> I'm digging through the blog post on Erlando and it seems there's some
> changes in Erlando recently w.r.t. the error monad. It seems to be
> called "error_t" now and looks like it works similarly to state_t. Is
> that correct?

Yes.

> At any rate, I'm still missing something because I can't seem to
> figure how to use this in the context of the erlang amqp client.
> 
> I'm basically trying to do a maybe on getting a channel so I don't
> have to do:
> 
> case amqp_connection:start(network, AMQPParams) of
>   {ok, Conn} -> case amqp_connection:open_channel(AMQP) of
>     {ok, Channel} -> % do some work
>   end
> end
> 
> and so on and so forth...
> 
> How would I use Erlando for this?

ErrorT = error_t:new(identity_m),
do([ErrorT || {ok, Conn} <- amqp_connection:start(AMQPParams),
              {ok, Chan} <- amqp_connection:open_channel(Conn),
              etc
   ]).

Matthew

From Hagbard at gmx.de  Sun May 22 21:09:27 2011
From: Hagbard at gmx.de (Hagbard at gmx.de)
Date: Sun, 22 May 2011 22:09:27 +0200
Subject: [rabbitmq-discuss] Memory usage
Message-ID: <20110522200927.245460@gmx.net>

Hi,
im new to RabbitMQ and i have a question about the memory usage of RabbitMQ. I read that since RabbitMQ 2.x i don't need to care about fast producers and slow consumers and so don't need to care about the amount of messages in a queue and memory usage. After a test yesterday with 2GB memory and 4M messages in a queue (no consumer) RabbitMQ reached high memory watermark and stopped. Can somebody explain that behaviour?

Thanks a lot
Hagbard
-- 
Empfehlen Sie GMX DSL Ihren Freunden und Bekannten und wir
belohnen Sie mit bis zu 50,- Euro! https://freundschaftswerbung.gmx.de

From jon at jbrisbin.com  Sun May 22 22:29:34 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sun, 22 May 2011 16:29:34 -0500 (CDT)
Subject: [rabbitmq-discuss] trying to figure out erlando
In-Reply-To: <20110522112558.GB3010@rabbitmq.com>
Message-ID: <a8663db2-48f9-4caa-a7aa-c72109ca4a90@jbrisbin.local>

Building on this, how do I translate what's in the blog post w.r.t. error_m so I get the behaviour of always doing an amqp_channel:close(Chan) no matter what happens in my publish step (right after the open_channel)?

jb


----- Original Message -----
From: "Matthew Sackman" <matthew at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, May 22, 2011 6:25:58 AM
Subject: Re: [rabbitmq-discuss] trying to figure out erlando

On Sat, May 21, 2011 at 03:35:58PM -0500, Jon Brisbin wrote:
> I'm digging through the blog post on Erlando and it seems there's some
> changes in Erlando recently w.r.t. the error monad. It seems to be
> called "error_t" now and looks like it works similarly to state_t. Is
> that correct?

Yes.

> At any rate, I'm still missing something because I can't seem to
> figure how to use this in the context of the erlang amqp client.
> 
> I'm basically trying to do a maybe on getting a channel so I don't
> have to do:
> 
> case amqp_connection:start(network, AMQPParams) of
>   {ok, Conn} -> case amqp_connection:open_channel(AMQP) of
>     {ok, Channel} -> % do some work
>   end
> end
> 
> and so on and so forth...
> 
> How would I use Erlando for this?

ErrorT = error_t:new(identity_m),
do([ErrorT || {ok, Conn} <- amqp_connection:start(AMQPParams),
              {ok, Chan} <- amqp_connection:open_channel(Conn),
              etc
   ]).

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Sun May 22 22:36:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 22 May 2011 22:36:26 +0100
Subject: [rabbitmq-discuss] trying to figure out erlando
In-Reply-To: <a8663db2-48f9-4caa-a7aa-c72109ca4a90@jbrisbin.local>
References: <20110522112558.GB3010@rabbitmq.com>
	<a8663db2-48f9-4caa-a7aa-c72109ca4a90@jbrisbin.local>
Message-ID: <20110522213625.GA15158@wellquite.org>

On Sun, May 22, 2011 at 04:29:34PM -0500, Jon Brisbin wrote:
> Building on this, how do I translate what's in the blog post w.r.t.
> error_m so I get the behaviour of always doing an
> amqp_channel:close(Chan) no matter what happens in my publish step
> (right after the open_channel)?

with_channel(AMQPParams, Fun) ->
    ErrorT = error_t:new(identity_m),
    do([ErrorT || {ok, Conn} <- amqp_connection:start(AMQPParams),
                  {ok, Chan} <- amqp_connection:open_channel(Conn),
                  {ok, Res}  <- return(Fun(Chan)),
                  ok <- amqp_channel:close(Chan),
                  Res
       ]).

Matthew

From rob at rabbitmq.com  Mon May 23 08:55:38 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Mon, 23 May 2011 08:55:38 +0100
Subject: [rabbitmq-discuss] Memory usage
In-Reply-To: <20110522200927.245460@gmx.net>
References: <20110522200927.245460@gmx.net>
Message-ID: <4DDA12FA.8010008@rabbitmq.com>

Hagbard,

Since 2.x, RabbitMQ will no longer allow the Erlang process to run out 
of memory and stop due to fast producers and slow consumers.

If you have a fast producer running constantly, accompanied by a slow 
consumer then the number of queued messages will grow. To prevent this 
from causing out of memory problems, Rabbit will throttle the producer 
once the memory high watermark is hit.

The throttling works by simply blocking the producer from sending any 
more data over the TCP socket. Once memory drops below the high 
watermark, due to the consumer catching up or messages being flushed to 
disk, the producer can send data again.

Note that your producer might bounce off the watermark frequently if it 
just keeps publishing without let up.

Rob

Hagbard at gmx.de wrote:
> Hi,
> im new to RabbitMQ and i have a question about the memory usage of RabbitMQ. I read that since RabbitMQ 2.x i don't need to care about fast producers and slow consumers and so don't need to care about the amount of messages in a queue and memory usage. After a test yesterday with 2GB memory and 4M messages in a queue (no consumer) RabbitMQ reached high memory watermark and stopped. Can somebody explain that behaviour?
>
> Thanks a lot
> Hagbard

From simon at rabbitmq.com  Mon May 23 11:46:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 23 May 2011 11:46:27 +0100
Subject: [rabbitmq-discuss] 2.4.1 features
In-Reply-To: <BANLkTim4XMaB+pPMnKsw7=VN7D2EdnJKig@mail.gmail.com>
References: <BANLkTim4XMaB+pPMnKsw7=VN7D2EdnJKig@mail.gmail.com>
Message-ID: <4DDA3B03.705@rabbitmq.com>

On 21/05/11 12:14, Steven Taylor wrote:
> just upgrading from 2.2 to 2.4.1.  Would noAck typically be set to
> "false" in prior versions for BasicConsume?

The overridden versions of BasicConsume that don't take noAck do set it 
to false.

>     BasicConsume(string queue, bool noAck, string consumerTag,
> IBasicConsumer consumer)


> Also, seems like you've snuck in some nice features into the patterns
> area like EventingBasicConsumer (thanks Simone for your example on
> this... otherwise I wouldn't have known about it). How are you Rabbit
> folk currently making announcements about new features?

The release notes are posted to the rabbitmq-announce mailing list:

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-announce

and are available archived from our news page:

http://www.rabbitmq.com/news.html

Highlights for each release are summarised at the changelog:

http://www.rabbitmq.com/changelog.html

 > "The consumer tag is local to a channel" -- so we're talking about
 > identifying one consumer, of many listenning in to a single channel?

Yes, to allow you to:

* Know which messages arrived for which consumer.

* Cancel an individual consumer.

NB: the consumer tag always exists, the server will; generate one for 
you if you don't provide one.

 > If we've got a field/tag for a particular consumer (even one on the same
 > channel), perhaps it'd be nice to have a publisher-tag as well.  i.e.
 > issolate a particular publisher for tracing purposes.  reply-to merely
 > distinguishes the queue.

The trouble is that AMQP 0-9-1 doesn't require you to declare a 
"publisher" in the same way that you do a consumer (maybe it should) - 
so it's not clear where this would live.

 > Maybe I could use "IDictionary arguments" could be used for this
 > instead?  I've ignored "arguments" up until now.

If you want to identify a particular publisher, the canonical way to do 
that is with the "app-id" property in BasicProperties.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From tstagl at digitalriver.com  Mon May 23 13:07:34 2011
From: tstagl at digitalriver.com (Thomas Stagl)
Date: Mon, 23 May 2011 14:07:34 +0200
Subject: [rabbitmq-discuss] queue hands - timeout
In-Reply-To: <4DD64A4C.7090602@rabbitmq.com>
References: <9C5CE94A-0666-4633-8E86-A5EF80A809BE@digitalriver.com>
	<4DD64A4C.7090602@rabbitmq.com>
Message-ID: <6969F969-EE84-404C-A574-23D32631F5D7@digitalriver.com>

Hello Emile,

thanks a lot for your very quick reply. Please find enclosed the requested details

This morning I have seen a response on this mailing list, where I assume, that this could be the case:
>> If you have a fast producer running constantly, accompanied by a slow consumer then the number of queued messages will grow. To prevent this from causing out of memory problems, Rabbit will throttle the producer once the memory high watermark is hit.
>> 
>> The throttling works by simply blocking the producer from sending any more data over the TCP socket. Once memory drops below the high watermark, due to the consumer catching up or messages being flushed to disk, the producer can send data again.

regards, tom

On May 20, 2011, at 1:02 PM, Emile Joubert wrote:

> Hi Thomas,
> 
> On 19/05/11 13:35, Thomas Stagl wrote:
>> Hello,
>> 
>> we are running a queue in our test environment with different vhosts.
>> When we do a long running perf test, we recognise that the responses
>> from the queue are timing out and from that moment on, it is not
>> possible to connect to the queue again. Neither with the java lib
>> (which we use in our application) nor with celery (which I use for
>> testing purposes.)
>> 
>> We have recognised that beam.smp is running on 30% CPU time from that
>> moment on.
>> 
>> When we trace a connection, we see this with tcpdump: 12:23:52.700093
>> IP CLIENT.43248>  RABBIT.amqp: Flags [P.], seq 2421288989:2421289002,
>> ack 2617563671, win 54, options [nop,nop,TS val 2047452 ecr
>> 1377663677], length 13 12:23:52.700124 IP RABBIT.amqp>  CLIENT.43248:
>> Flags [.], ack 13, win 62, options [nop,nop,TS val 1377881158 ecr
>> 2047452], length 0
>> 
>> From that moment on, the connection is hanging.
>> 
>> After a restart of the rabbitmq server, everything is running fine
>> again, for a certain amount of time.
>> 
>> We also have a second test stack and we switched to the second
>> rabbitmq test server, same behaviour here. It worked fine and after a
>> couple of hours it stopped responding.
>> 
>> Any ideas? Any though about where we can start debugging would be
>> very much appreciated.
> 
> We have brokers that have been running for weeks without exhibiting the behaviour you describe. Can you help us to emulate your test environment more closely?
> 
> What version of Erlang, OS and rabbit are you using?
RabbitMQ 2.3.1 / R14A running on Debian Squeeze

> What is the contents of the rabbit config file?
We do not use the config file

> What exactly does the perf test doing?
We are creating new users on our application and we issue the new profile to another application, we use the queue to send the message asynchronously.


> What is the rate and size of messsages, number of producers, consumers, are the messages persistent?
> If you have the management plugin installed then a copy of the broker configuration may be useful.
We use persistent queues and we send ~500 messages per second, there is one producer active and one consumer. Where the consumer is definitly much slower than the producer.
> 
> Does rabbitmqctl still work when the problem occurs? The output of all the list_* commands at the time of failure will be useful.
No, we can connect, but we can not send anything to the queue

> 
> The broker logfile entries around the onset of the problem will also help.


> 
> Were there any other applications running on the same OS as rabbit?
No, there are no other applications running instead of rabbitmq
> 
> Were the consumers (if any) keeping up with producers at or just before the onset of the problem?
> 
> What was the memory consumption reported by the management plugin at this time?
1.6GB
> 
> If you can help us to narrow this down to a specific set of conditions that reliably trigger the problem that will be a big step towards a solution.
> 
> 
> 
> Thanks
> 
> Emile


From jon at jbrisbin.com  Mon May 23 14:59:00 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 23 May 2011 08:59:00 -0500
Subject: [rabbitmq-discuss] trying to figure out erlando
In-Reply-To: <20110522213625.GA15158@wellquite.org>
References: <20110522112558.GB3010@rabbitmq.com>
	<a8663db2-48f9-4caa-a7aa-c72109ca4a90@jbrisbin.local>
	<20110522213625.GA15158@wellquite.org>
Message-ID: <6F5BE10E-5113-4B3B-B34B-A6D069244749@jbrisbin.com>

Sorry to keep bugging you, but the result I get from something similar is:

r: #Fun<error_t.0.94248885>

Here's what I'm doing:

      ErrorT = error_t:new(identity_m),
      R = do([ErrorT ||
        {ok, Channel} <- amqp_connection:open_channel(AMQP),
        {ok, Response} <- return(Publish(Channel)),
        ok <- amqp_channel:close(Channel),
        Response
      ]),
      io:format("r: ~p~n", [R]),
      {reply, R, State}

I'm sure I'm not doing something right, I just don't know what it is. :/

Thanks for all the help so far, though! :)

jb


(Publish is a fun that does amqp_channel:cast(Channel, PublishCmd, Msg) and formats a response based on the result)

On May 22, 2011, at 4:36 PM, Matthew Sackman wrote:

> On Sun, May 22, 2011 at 04:29:34PM -0500, Jon Brisbin wrote:
>> Building on this, how do I translate what's in the blog post w.r.t.
>> error_m so I get the behaviour of always doing an
>> amqp_channel:close(Chan) no matter what happens in my publish step
>> (right after the open_channel)?
> 
> with_channel(AMQPParams, Fun) ->
>    ErrorT = error_t:new(identity_m),
>    do([ErrorT || {ok, Conn} <- amqp_connection:start(AMQPParams),
>                  {ok, Chan} <- amqp_connection:open_channel(Conn),
>                  {ok, Res}  <- return(Fun(Chan)),
>                  ok <- amqp_channel:close(Chan),
>                  Res
>       ]).
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From james.r.carr at gmail.com  Mon May 23 15:01:28 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 23 May 2011 09:01:28 -0500
Subject: [rabbitmq-discuss] Dead Letter Channel?
Message-ID: <BANLkTi=EJsnQu7JTkOvrpy3bQG+Ap-DRtA@mail.gmail.com>

Hi All,

Last time I checked I recall that RabbitMQ doesn't yet support a dead
letter channel. Is there a way to implement this? One question that
hase came up as we begin looking into bringing RabbitMQ into our
organization is how to handle messages that don't get processed by a
consumer due to an exception or some other resource related error or
programming defect.

I know you can set the message to retry, but this doesn't help if none
of the consumers are able to process the message.

Thanks,
James

From matthew at rabbitmq.com  Mon May 23 15:05:28 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 23 May 2011 15:05:28 +0100
Subject: [rabbitmq-discuss] trying to figure out erlando
In-Reply-To: <6F5BE10E-5113-4B3B-B34B-A6D069244749@jbrisbin.com>
References: <20110522112558.GB3010@rabbitmq.com>
	<a8663db2-48f9-4caa-a7aa-c72109ca4a90@jbrisbin.local>
	<20110522213625.GA15158@wellquite.org>
	<6F5BE10E-5113-4B3B-B34B-A6D069244749@jbrisbin.com>
Message-ID: <20110523140528.GA5914@rabbitmq.com>

On Mon, May 23, 2011 at 08:59:00AM -0500, Jon Brisbin wrote:
> Sorry to keep bugging you, but the result I get from something similar is:
> 
> r: #Fun<error_t.0.94248885>

Oh right, yeah, just like with state_t, you'll actually need to run it.

> Here's what I'm doing:
> 
>       ErrorT = error_t:new(identity_m),
>       M = do([ErrorT ||
>         {ok, Channel} <- amqp_connection:open_channel(AMQP),
>         {ok, Response} <- return(Publish(Channel)),
>         ok <- amqp_channel:close(Channel),
>         Response
>       ]),
        R = error_t:run(M),
>       io:format("r: ~p~n", [R]),
>       {reply, R, State}

Just like state_t, error_t actually results in the value of the monad
being a fun. Thus you need to run it. state_t has exec, eval and run,
depending on whether you want the transformed state, value or both back,
but error_t just needs run, as its not doing as much.

Of course, you can have multiple transforms. Consider the difference
between:

M = state_t:new(error_t:new(identity_m))

versus

M = error_t:new(state_t:new(identity_m))

!

Matthew

From Hagbard at gmx.de  Mon May 23 15:49:13 2011
From: Hagbard at gmx.de (Hagbard Celine)
Date: Mon, 23 May 2011 16:49:13 +0200
Subject: [rabbitmq-discuss] Memory usage
In-Reply-To: <4DDA12FA.8010008@rabbitmq.com>
References: <20110522200927.245460@gmx.net> <4DDA12FA.8010008@rabbitmq.com>
Message-ID: <20110523144913.246320@gmx.net>

Thanks for your answer and sorry for the questions - i just want to know if RabbitMQ is a possible solution for my problem.

--

Does it mean that RabbitMQ will nerver hit the watermark if the producer slow enough (and the speed of my producers depends on the amount of memory i use)?

In my tests (with no consumers) the memory usage grows constantly with the amount of messages. Sometimes the memory usage decreased but overall it grows until the watermark. Are the producers still too fast for RabbitMQ (and my hardware)?

To solve my problem i have to guarantee that all messages will be queued and not blocked by RabbitMQ.

Thanks a lot
Hagbard

> Hagbard,
> 
> Since 2.x, RabbitMQ will no longer allow the Erlang process to run out 
> of memory and stop due to fast producers and slow consumers.
> 
> If you have a fast producer running constantly, accompanied by a slow 
> consumer then the number of queued messages will grow. To prevent this 
> from causing out of memory problems, Rabbit will throttle the producer 
> once the memory high watermark is hit.
> 
> The throttling works by simply blocking the producer from sending any 
> more data over the TCP socket. Once memory drops below the high 
> watermark, due to the consumer catching up or messages being flushed to 
> disk, the producer can send data again.
> 
> Note that your producer might bounce off the watermark frequently if it 
> just keeps publishing without let up.
> 
> Rob
> 
> Hagbard at gmx.de wrote:
> > Hi,
> > im new to RabbitMQ and i have a question about the memory usage of
> RabbitMQ. I read that since RabbitMQ 2.x i don't need to care about fast
> producers and slow consumers and so don't need to care about the amount of
> messages in a queue and memory usage. After a test yesterday with 2GB memory and
> 4M messages in a queue (no consumer) RabbitMQ reached high memory watermark
> and stopped. Can somebody explain that behaviour?
> >
> > Thanks a lot
> > Hagbard
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
NEU: FreePhone - kostenlos mobil telefonieren!			
Jetzt informieren: http://www.gmx.net/de/go/freephone

From danbarua at gmail.com  Mon May 23 16:25:39 2011
From: danbarua at gmail.com (Dan B)
Date: Mon, 23 May 2011 08:25:39 -0700 (PDT)
Subject: [rabbitmq-discuss] WCF Bindings do not honor config settings
Message-ID: <91d22ca1-37e4-4057-acf2-b59580b606fb@f9g2000vbz.googlegroups.com>

Hi all,

I've been playing around with the .Net client solution with a view to
using RabbitMQ with WCF.
I have changed my RabbitMQ username and password, so the WCF examples
explode because the ConnectionFactories are being initialized with the
default values.

To get the binding configuration values honoured, I changed lines
113-115 in RabbitMQBindingConfigurationElement.cs from

            rabbind.Transport.ConnectionFactory.Password =
this.Password;
            rabbind.Transport.ConnectionFactory.UserName =
this.Username;
            rabbind.Transport.ConnectionFactory.VirtualHost =
this.VirtualHost;

to
            rabbind.Transport.Password = this.Password;
            rabbind.Transport.Username = this.Username;
            rabbind.Transport.VirtualHost = this.VirtualHost;

So this now works where we have configured the endpoint to use non-
default settings for virtual host, username and password.

Moving onto trying to run the RabbitMQ.ServiceModel.Test project, to
see if we can set the config in code... similarly, setting the
hostname, port and protocol from app.config on the RabbitMQBinding has
no effect on the settings of the RabbitMQTransportBindingElement.
Username, password and virtual host properties on the
RabbitMQTransportBindingElementhave been marked as internal so can not
be modified from code.

Getting this to work requires a little more effort than modifying a
few lines - shall I just report this as a bug or may I submit a pull
request?

Regards,

Dan



From jon at jbrisbin.com  Mon May 23 16:53:53 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 23 May 2011 10:53:53 -0500
Subject: [rabbitmq-discuss] trying to figure out erlando
In-Reply-To: <20110523140528.GA5914@rabbitmq.com>
References: <20110522112558.GB3010@rabbitmq.com>
	<a8663db2-48f9-4caa-a7aa-c72109ca4a90@jbrisbin.local>
	<20110522213625.GA15158@wellquite.org>
	<6F5BE10E-5113-4B3B-B34B-A6D069244749@jbrisbin.com>
	<20110523140528.GA5914@rabbitmq.com>
Message-ID: <BF3BB6D4-0712-41D6-BA7B-EB2C041ADF88@jbrisbin.com>

I keep thinking I can conquer this and, like a neurotic who expects a different result every time after doing the same thing, I have failed utterly! :)

Doing error_t:run(M) gives me: {undef,[{error_t,run,[#Fun<error_t.0.94248885>]}

and doing ErrorT:run(M) gives me: {{badfun,{ok,<0.39.0>}}

I'm afraid I'm going to have to drop this because I'm probably too right brain to make real use of this. I feel like I gave it a good effort, but I'm afraid I'm not smart enough to really wrap my head around what's going on. I'll just have to stick with case statements since I can understand those and the code works.

Ah well. Live and learn!

jb

On May 23, 2011, at 9:05 AM, Matthew Sackman wrote:

> On Mon, May 23, 2011 at 08:59:00AM -0500, Jon Brisbin wrote:
>> Sorry to keep bugging you, but the result I get from something similar is:
>> 
>> r: #Fun<error_t.0.94248885>
> 
> Oh right, yeah, just like with state_t, you'll actually need to run it.
> 
>> Here's what I'm doing:
>> 
>>      ErrorT = error_t:new(identity_m),
>>      M = do([ErrorT ||
>>        {ok, Channel} <- amqp_connection:open_channel(AMQP),
>>        {ok, Response} <- return(Publish(Channel)),
>>        ok <- amqp_channel:close(Channel),
>>        Response
>>      ]),
>        R = error_t:run(M),
>>      io:format("r: ~p~n", [R]),
>>      {reply, R, State}
> 
> Just like state_t, error_t actually results in the value of the monad
> being a fun. Thus you need to run it. state_t has exec, eval and run,
> depending on whether you want the transformed state, value or both back,
> but error_t just needs run, as its not doing as much.
> 
> Of course, you can have multiple transforms. Consider the difference
> between:
> 
> M = state_t:new(error_t:new(identity_m))
> 
> versus
> 
> M = error_t:new(state_t:new(identity_m))
> 
> !
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From emile at rabbitmq.com  Mon May 23 16:55:32 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 23 May 2011 16:55:32 +0100
Subject: [rabbitmq-discuss] WCF Bindings do not honor config settings
In-Reply-To: <91d22ca1-37e4-4057-acf2-b59580b606fb@f9g2000vbz.googlegroups.com>
References: <91d22ca1-37e4-4057-acf2-b59580b606fb@f9g2000vbz.googlegroups.com>
Message-ID: <4DDA8374.5050606@rabbitmq.com>

Hi Dan,

On 23/05/11 16:25, Dan B wrote:
> Hi all,
>
> I've been playing around with the .Net client solution with a view to
> using RabbitMQ with WCF.
> I have changed my RabbitMQ username and password, so the WCF examples
> explode because the ConnectionFactories are being initialized with the
> default values.

A bug with a similar description was fixed and released in version 2.4.0 
- can you please confirm which release of the .net client library you 
are using? If you are building from source, does it include the merge of 
branch bug23887?

If you still experience problems with the WCF binding included in the 
latest release of the .net client library then please follow-up with 
details.


Thanks

Emile

From danbarua at gmail.com  Mon May 23 17:09:15 2011
From: danbarua at gmail.com (Dan Barua)
Date: Mon, 23 May 2011 17:09:15 +0100
Subject: [rabbitmq-discuss] WCF Bindings do not honor config settings
In-Reply-To: <4DDA8374.5050606@rabbitmq.com>
References: <91d22ca1-37e4-4057-acf2-b59580b606fb@f9g2000vbz.googlegroups.com>
	<4DDA8374.5050606@rabbitmq.com>
Message-ID: <BANLkTimhU1zaMuCazQt-Bekv2nQ+e6Cg_Q@mail.gmail.com>

Hi Emile,

I found the problem with .Net client 2.4.1, and also I just pulled from the
repository this afternoon revision 643 on default branch. It appears to
have bug23887 merged into default.

-Dan

On Mon, May 23, 2011 at 4:55 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Dan,
>
> On 23/05/11 16:25, Dan B wrote:
>
>> Hi all,
>>
>> I've been playing around with the .Net client solution with a view to
>> using RabbitMQ with WCF.
>> I have changed my RabbitMQ username and password, so the WCF examples
>> explode because the ConnectionFactories are being initialized with the
>> default values.
>>
>
> A bug with a similar description was fixed and released in version 2.4.0 -
> can you please confirm which release of the .net client library you are
> using? If you are building from source, does it include the merge of branch
> bug23887?
>
> If you still experience problems with the WCF binding included in the
> latest release of the .net client library then please follow-up with
> details.
>
>
> Thanks
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110523/d9776633/attachment.htm>

From matthew at rabbitmq.com  Mon May 23 17:51:23 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 23 May 2011 17:51:23 +0100
Subject: [rabbitmq-discuss] trying to figure out erlando
In-Reply-To: <BF3BB6D4-0712-41D6-BA7B-EB2C041ADF88@jbrisbin.com>
References: <20110522112558.GB3010@rabbitmq.com>
	<a8663db2-48f9-4caa-a7aa-c72109ca4a90@jbrisbin.local>
	<20110522213625.GA15158@wellquite.org>
	<6F5BE10E-5113-4B3B-B34B-A6D069244749@jbrisbin.com>
	<20110523140528.GA5914@rabbitmq.com>
	<BF3BB6D4-0712-41D6-BA7B-EB2C041ADF88@jbrisbin.com>
Message-ID: <20110523165122.GF5914@rabbitmq.com>

Hi Jon,

I'm afraid most of my replies on this thread have been riddled with
errors one way or another.

Firstly, error_t strips of the {ok, ...} in bind. So you should be
writing "X <- foo()" rather than "{ok, X} <- foo()".

Secondly, you are right - it should be ErrorT:run(M), not error_t:run(M)
(I'm rapidly losing any enthusiasm for parameterised modules...).

Thirdly, if your function just returns 'ok' then you're in trouble as
each and every function must return something of the form {ok, X} or
{error, X}. So the amqp_channel:close(Chan) becomes a problem. About the
only way around is to change that to:

case amqp_channel:close(Chan) of
    ok  -> return(ok);
    Err -> fail(Err)
end

Fourthly (slight repeat of 1st point), don't match {ok, X} against a
return - again, the {ok,..} gets stripped.

So, in summary, I think you want:

ErrorT = error_t:new(identity_m),
M = do([ErrorT ||
        Chan <- amqp_connection:open_channel(AMQP),
        Resp <- return(Publish(Channel)),
        case amqp_channel:close(Channel) of
            ok           -> return(ok);
            {error, Err} -> fail(Err)
        end,
        Resp]),
ErrorT:run(M).

I *think* that should work!

Matthew

From yluppo at leads360.com  Mon May 23 20:15:35 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Mon, 23 May 2011 12:15:35 -0700
Subject: [rabbitmq-discuss] RabbitMQ cluster w/ .Net client
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A309107833@l360xch01.office.leads360.com>

Hi,

I've read many posts and blogs at this point and I'm still not sure
about how to cluster correctly my 2 RabbitMQ nodes.

I've read the RabbitMQ clustering guide:
http://www.rabbitmq.com/clustering.html
<http://www.rabbitmq.com/clustering.html> 

I found out about a mysterious ClusterId in the API guide, with no
explanation on how to get that Id in the first place:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.4.1/rabbitmq-
dotnet-client-2.4.1-api-guide.pdf
<http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.4.1/rabbitmq
-dotnet-client-2.4.1-api-guide.pdf> 

Learned in that StackOverflow post that basically I'd need my clients to
be aware of each node in the cluster and code for failover scenario:
rabbitmq HA cluster
<http://stackoverflow.com/questions/4140653/rabbitmq-ha-cluster> 

Now... The behavior I'd like to have is something a little more
transparent if possible. Where I would potentially use that "ClusterId"
on the client to make the consumer cluster aware and then hopefully the
library knows to randomly connect to either node to grab messages.

Granted I know a message can only be on one server at a time, so I'm
hoping for some round robin magic from the DotNet client library that
would also handle fail over situations.

What I was hoping also from a publisher perspective is that the exchange
would round robin distribute messages to the various nodes in the
cluster. The exchange would also be cluster aware and handle fail over
situations gracefully.

Basically I was hoping for the whole thing to scale without changing any
code or configuration on the publisher or consumer apps.

Now based on my readings it doesn't quite work like that... unless I
missed something. If my knowledge is up to date and I have to code all
that cluster aware business, then... why does RabbitMQ have a cluster
feature in the first place? How is it used?

Is there a way to have that kind of behavior out of RabbitMQ without
coding that much?

Thanks

Yann

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110523/c063afec/attachment-0001.htm>

From yaohui1984 at qq.com  Tue May 24 03:15:38 2011
From: yaohui1984 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Tue, 24 May 2011 10:15:38 +0800
Subject: [rabbitmq-discuss] Memory usage
Message-ID: <tencent_5F9FCE98160FE14750044BFB@qq.com>

If the producer sends plenty of messages constantly over the memory throttling,and couldn't stop, where these messages is? stay on the side of producer? in this case, i think the producer would crash out of memory.
  
 >Hagbard,

>Since 2.x, RabbitMQ will no longer allow the Erlang process to run out 
>of memory and stop due to fast producers and slow consumers.

>If you have a fast producer running constantly, accompanied by a slow 
>consumer then the number of queued messages will grow. To prevent this 
>from causing out of memory problems, Rabbit will throttle the producer 
>once the memory high watermark is hit.

>The throttling works by simply blocking the producer from sending any 
>more data over the TCP socket. Once memory drops below the high 
>watermark, due to the consumer catching up or messages being flushed to 
>disk, the producer can send data again.

>Note that your producer might bounce off the watermark frequently if it 
>just keeps publishing without let up.

Rob

>>Hagbard at gmx.de wrote:
>> Hi,
>> im new to RabbitMQ and i have a question about the memory usage of RabbitMQ. I read that since RabbitMQ 2.x i don't need to care about fast producers and slow consumers and so don't need to care about the amount of messages in a queue and memory usage. After a test yesterday with 2GB memory and 4M messages in a queue (no consumer) RabbitMQ reached high memory watermark and stopped. Can somebody explain that behaviour?
>>
>> Thanks a lot
>> Hagbard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110524/b78b58ce/attachment.htm>

From mihirm at omc-international.com.au  Tue May 24 07:11:47 2011
From: mihirm at omc-international.com.au (Mihir Mone)
Date: Tue, 24 May 2011 16:11:47 +1000
Subject: [rabbitmq-discuss] RabbitMQ shovel with SSL
Message-ID: <003601cc19d9$768ab060$63a01120$@com.au>

Hi guys,

 

I have a problem with configuring RabbitMQ shovel over SSL.

On our internal network the exact same configuration works. But when I try
to connect from outside the office, I get "insufficient security" errors !

 

See attached files. I have attached my rabbitmq.config and the log file
generated on startup.

 

-- 

Best Regards,

Mihir Mone

Research Engineer

 

OMC International

Melbourne, Australia

Ph: +61 3 9412 6525

Fx: +61 3 9412 9105

 

 <http://www.omc-international.com.au> http://www.omc-international.com.au

 

Dedicated to safer and more efficient shipping.

 

CONFIDENTIAL COMMUNICATIONS. The information contained in this e-mail
isconfidential and may be subject to legal professional privilege. It is
intended solely for the addressee. If you received this correspondence by
mistake, please promptly inform us by reply e-mail or by telephoning +61 3
9412 6500 and then delete the e-mail and destroy any printed copy. You must
not disclose, copy or rely on any part of this correspondence if you are not
the intended recipient.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110524/62dd0eba/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at DUKC-Monitor.log
Type: application/octet-stream
Size: 516255 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110524/62dd0eba/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq.config
Type: application/xml
Size: 1500 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110524/62dd0eba/attachment-0001.xml>

From yaohui1984 at qq.com  Tue May 24 07:55:12 2011
From: yaohui1984 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Tue, 24 May 2011 14:55:12 +0800
Subject: [rabbitmq-discuss] rabbitmq crash?
Message-ID: <tencent_62B67EB34BC069072AF7D8EF@qq.com>

when i use performence test using  bash runjava.sh com.rabbitmq.examples.MulticastMain
 
mq crash,this is dump file
 
=erl_crash_dump:0.1
Tue May 24 14:44:18 2011
Slogan: eheap_alloc: Cannot allocate 912262800 bytes of memory (of type "heap").
System version: Erlang R14B (erts-5.8.1) [source] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]
Compiled: Tue Mar  8 12:24:16 2011
Taints: 
Atoms: 18757
=memory
total: 1025071712
processes: 843523524
processes_used: 843511988
system: 181548188
atom: 845513
atom_used: 844386
binary: 3890032
code: 7703375
ets: 19926572
 java client log
 recving rate: 1774 msg/s, min/avg/max latency: 360445189/360852144/361229952 microseconds
sending rate: 6122 msg/s
Exception in thread "Thread-3" java.lang.RuntimeException: java.net.SocketException: Broken pipe
        at com.rabbitmq.examples.MulticastMain$Producer.run(MulticastMain.java:336)
        at java.lang.Thread.run(Thread.java:619)
Caused by: java.net.SocketException: Broken pipe
        at java.net.SocketOutputStream.socketWrite0(Native Method)
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
        at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
        at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
        at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
        at java.io.DataOutputStream.flush(DataOutputStream.java:106)
        at com.rabbitmq.client.impl.SocketFrameHandler.writeFrame(SocketFrameHandler.java:155)
        at com.rabbitmq.client.impl.AMQConnection.writeFrame(AMQConnection.java:416)
        at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:173)
        at com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:301)
        at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:277)
        at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:520)
        at com.rabbitmq.examples.MulticastMain$Producer.publish(MulticastMain.java:351)
        at com.rabbitmq.examples.MulticastMain$Producer.run(MulticastMain.java:325)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110524/a32306d5/attachment.htm>

From matthias at rabbitmq.com  Tue May 24 08:11:57 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 24 May 2011 08:11:57 +0100
Subject: [rabbitmq-discuss] rabbitmq crash?
In-Reply-To: <tencent_62B67EB34BC069072AF7D8EF@qq.com>
References: <tencent_62B67EB34BC069072AF7D8EF@qq.com>
Message-ID: <4DDB5A3D.8050002@rabbitmq.com>

yaohui wrote:
> when i use performence test using  bash runjava.sh 
> com.rabbitmq.examples.MulticastMain

What versions of the RabbitMQ broker and the Java client are you running?

Regards,

Matthias.

From matthias at rabbitmq.com  Tue May 24 08:27:00 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 24 May 2011 08:27:00 +0100
Subject: [rabbitmq-discuss] rabbitmq crash?
In-Reply-To: <tencent_19A07BAA5F7142C564374CD2@qq.com>
References: <tencent_19A07BAA5F7142C564374CD2@qq.com>
Message-ID: <4DDB5DC4.5060401@rabbitmq.com>

yaohui wrote:
> RabbitMQ 2.4.0 / erlang  R14B
> Java client rabbitmq-java-client-bin-2.4.0

Are these all running on the same machine? How much physical and virtual 
memory have you got configured on that machine? What memory limit does 
rabbit think it has? (check the rabbit.log near the beginning).

It looks like the broker owns about 1G of memory and is trying to 
allocate another gig. Could it be that some other applications 
(including the test client) are consuming the bulk of virtual memory? If 
so you need to configure rabbit with a lower memory threshold (see 
http://www.rabbitmq.com/extensions.html#memsup), setting it to about 
half of what is available for the broker to use after all the other 
applications running on the machine have been taken into account.

Regards,

Matthias
PS: please keep the list cc'ed.

From yaohui1984 at qq.com  Tue May 24 08:46:54 2011
From: yaohui1984 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Tue, 24 May 2011 15:46:54 +0800
Subject: [rabbitmq-discuss] |Spam| Re:  rabbitmq crash?
Message-ID: <tencent_43CC3A7323D8F6006C8BC875@qq.com>

</:includetail> 
 >yaohui wrote:
> RabbitMQ 2.4.0 / erlang  R14B
> Java client rabbitmq-java-client-bin-2.4.0

>Are these all running on the same machine?</:includetail>
 yes</:includetail>
 > How much physical and virtual memory have you got configured on that machine?</:includetail>
 2g physical memory ,7g virtual memory </:includetail>
 > What memory limit does rabbit think it has? (check the rabbit.log near the beginning).</:includetail>
 40% physical memory by defaut (992.4m),

>It looks like the broker owns about 1G of memory and is trying to 
allocate another gig. Could it be that some other applications 
(including the test client) are consuming the bulk of virtual memory? If 
so you need to configure rabbit with a lower memory threshold</:includetail>
 i think that's the point</:includetail>
 </:includetail> 
  >(see http://www.rabbitmq.com/extensions.html#memsup), setting it to about 
half of what is available for the broker to use after all the other 
applications running on the machine have been taken into account.</:includetail>
 I see

>Regards,

>Matthias
>PS: please keep the list cc'ed.</:includetail>
 Excuse me, i forgot that.</:includetail>
 </:includetail> 
 Another question : if a producer sends plenty of messages constantly over the memory throttling, rabbitmq broker will block producer sending message, where these messages is? stay in the memory of producer? in this case, i think the producer would crash out of memory.</:includetail>
 
Regards,
 
Yao

</:includetail>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110524/118e3d66/attachment.htm>

From matthias at rabbitmq.com  Tue May 24 09:15:54 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 24 May 2011 09:15:54 +0100
Subject: [rabbitmq-discuss] rabbitmq crash?
In-Reply-To: <tencent_43CC3A7323D8F6006C8BC875@qq.com>
References: <tencent_43CC3A7323D8F6006C8BC875@qq.com>
Message-ID: <4DDB693A.3000002@rabbitmq.com>

yaohui wrote:
> Another question : if a producer sends plenty of messages constantly
>  over the memory throttling, rabbitmq broker will block producer
> sending message, where these messages is?

Yes.

> stay in the memory of producer? in this case, i think the producer
> would crash out of memory.

That very much depends on how the application is written and what client 
library is being used. For example, in our Java and .net client the 
thread invoking basicPublish will get blocked, so the producer could 
only run out of memory if there are other threads allocating memory.

Ultimately though if you have a source consistently producing messages 
at a higher rate than rabbit can handle (by passing them to consumers or 
paging them to disk) then eventually the app will either have to 
throttle the source, throw away messages, or it will run out of memory.

Regards,

Matthias.

From yaohui1984 at qq.com  Tue May 24 10:57:51 2011
From: yaohui1984 at qq.com (=?gbk?B?eWFvaHVp?=)
Date: Tue, 24 May 2011 17:57:51 +0800
Subject: [rabbitmq-discuss] Message to disk?
Message-ID: <tencent_63F604BA37A836A929FF504F@qq.com>

I found that there are files .rdq in dir msg_store_transient  even if below memory pressure.
 Do messages already be written to disk?
 These files means what?
  
 Regards,
 Yao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110524/e22f0c15/attachment-0001.htm>

From matthew at rabbitmq.com  Tue May 24 11:18:42 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 24 May 2011 11:18:42 +0100
Subject: [rabbitmq-discuss] Message to disk?
In-Reply-To: <tencent_63F604BA37A836A929FF504F@qq.com>
References: <tencent_63F604BA37A836A929FF504F@qq.com>
Message-ID: <20110524101842.GA10897@rabbitmq.com>

On Tue, May 24, 2011 at 05:57:51PM +0800, yaohui wrote:
> I found that there are files .rdq in dir msg_store_transient  even if below memory pressure.
>  Do messages already be written to disk?
>  These files means what?

If Rabbit only started to write messages to disk when it ran out of
memory then you'd promptly find Rabbit sitting there for some time
thrashing the disk, whilst nothing else could occur.

Consequently, Rabbit can decide to write messages out to disk fairly
early on to ensure that when, some time in the future, there is no RAM
left, Rabbit has already written to disk most of its messages to disk,
thus there is little to no interruption of service.

Of course, as discussed on this list recently, clients can easily
publish at such a rate as to rapidly overwhelm Rabbit: ultimately, if a
queue has no or few consumers that can operate at the rate at which
messages are being published then you will end up being bound by disk
bandwidth.

Anyway, the rdq files are some of the files in which Rabbit can store
messages.

Matthew

From simon at rabbitmq.com  Tue May 24 11:28:24 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 24 May 2011 11:28:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ shovel with SSL
In-Reply-To: <003601cc19d9$768ab060$63a01120$@com.au>
References: <003601cc19d9$768ab060$63a01120$@com.au>
Message-ID: <4DDB8848.90106@rabbitmq.com>

On 24/05/11 07:11, Mihir Mone wrote:
> I have a problem with configuring RabbitMQ shovel over SSL.
>
> On our internal network the exact same configuration works. But when I
> try to connect from outside the office, I get ?insufficient security?
> errors !

Hi Mihir.

We haven't seen this error before. However, looking at the OTP source 
this appears to mean that client and server were unable to negotiate an 
acceptable cipher suite to use. The fact that it works from inside the 
office makes me wonder if you have some dubious proxy that is 
intercepting SSL connections and re-establishing them (with worse 
security?). I think you could provoke this error without a proxy by 
changing the 'ciphers' option in ssl_options to incomaptible settings at 
both ends, but I assume you're not doing that.

I'm afraid you need to get WireShark out to see what cipher suites are 
being offered by the client - we don't get to see what happens during 
negotiation. For reference, you can check the agreed suite after 
successful negotiation by adding the ssl_* columns to rabbitmqctl 
list_connections or looking at the management plugin connection details 
page.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From rob at rabbitmq.com  Tue May 24 15:34:24 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 24 May 2011 15:34:24 +0100
Subject: [rabbitmq-discuss] Memory usage
In-Reply-To: <20110523144913.246320@gmx.net>
References: <20110522200927.245460@gmx.net> <4DDA12FA.8010008@rabbitmq.com>
	<20110523144913.246320@gmx.net>
Message-ID: <4DDBC1F0.5030704@rabbitmq.com>



Hagbard Celine wrote:
> Thanks for your answer and sorry for the questions - i just want to know if RabbitMQ is a possible solution for my problem.
>
> --
>
> Does it mean that RabbitMQ will nerver hit the watermark if the producer slow enough (and the speed of my producers depends on the amount of memory i use)?

RabbitMQ will only hit the watermark if there are too many messages in 
memory. This can be caused by many different factors, the most likely 
being that messages are arriving at the broker faster than they can be 
sent to consumers or written to disk.

Rabbit will flush messages to disk if memory is low, but it also has to 
stop messages arriving while it does this otherwise it could still run 
out of memory while doing the paging.

Messages are only flushed to disk once the high watermark is hit, so 
you'll always see memory tend towards the watermark if the message 
ingress rate outweighs the message egress rate.

Once the high watermark is hit, messages are paged to disk until enough 
memory is reclaimed to drop below the watermark. For the duration of 
this process, producers are throttled.

>
> In my tests (with no consumers) the memory usage grows constantly with the amount of messages. Sometimes the memory usage decreased but overall it grows until the watermark. Are the producers still too fast for RabbitMQ (and my hardware)?

This is expected due to the behaviour above. If you have no consumers 
the only way to reclaim memory is to flush messages to disk.
>
> To solve my problem i have to guarantee that all messages will be queued and not blocked by RabbitMQ.

You have a few options I think, but the most sensible one is to simply 
perform your own throttling of your producer.

>
> Thanks a lot
> Hagbard
>
>> Hagbard,
>>
>> Since 2.x, RabbitMQ will no longer allow the Erlang process to run out
>> of memory and stop due to fast producers and slow consumers.
>>
>> If you have a fast producer running constantly, accompanied by a slow
>> consumer then the number of queued messages will grow. To prevent this
>> from causing out of memory problems, Rabbit will throttle the producer
>> once the memory high watermark is hit.
>>
>> The throttling works by simply blocking the producer from sending any
>> more data over the TCP socket. Once memory drops below the high
>> watermark, due to the consumer catching up or messages being flushed to
>> disk, the producer can send data again.
>>
>> Note that your producer might bounce off the watermark frequently if it
>> just keeps publishing without let up.
>>
>> Rob
>>
>> Hagbard at gmx.de wrote:
>>> Hi,
>>> im new to RabbitMQ and i have a question about the memory usage of
>> RabbitMQ. I read that since RabbitMQ 2.x i don't need to care about fast
>> producers and slow consumers and so don't need to care about the amount of
>> messages in a queue and memory usage. After a test yesterday with 2GB memory and
>> 4M messages in a queue (no consumer) RabbitMQ reached high memory watermark
>> and stopped. Can somebody explain that behaviour?
>>> Thanks a lot
>>> Hagbard
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From rob at rabbitmq.com  Tue May 24 15:37:23 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 24 May 2011 15:37:23 +0100
Subject: [rabbitmq-discuss] Memory usage
In-Reply-To: <4DDBC1F0.5030704@rabbitmq.com>
References: <20110522200927.245460@gmx.net> <4DDA12FA.8010008@rabbitmq.com>
	<20110523144913.246320@gmx.net> <4DDBC1F0.5030704@rabbitmq.com>
Message-ID: <4DDBC2A3.7070103@rabbitmq.com>



Rob Harrop wrote:
>
>
> Hagbard Celine wrote:
>> Thanks for your answer and sorry for the questions - i just want to
>> know if RabbitMQ is a possible solution for my problem.
>>
>> --
>>
>> Does it mean that RabbitMQ will nerver hit the watermark if the
>> producer slow enough (and the speed of my producers depends on the
>> amount of memory i use)?
>
> RabbitMQ will only hit the watermark if there are too many messages in
> memory. This can be caused by many different factors, the most likely
> being that messages are arriving at the broker faster than they can be
> sent to consumers or written to disk.
>
> Rabbit will flush messages to disk if memory is low, but it also has to
> stop messages arriving while it does this otherwise it could still run
> out of memory while doing the paging.
>
> Messages are only flushed to disk once the high watermark is hit, so
> you'll always see memory tend towards the watermark if the message
> ingress rate outweighs the message egress rate.

Of course, this is actually nonsense. What I wanted to write is that 
Rabbit will flush messages to disk as needed, even if the watermark 
isn't hit. However, if you do hit the watermark then Rabbit has to flush 
messages to disk *and* it can't receive any more - hence the blocking 
behaviour on the producers.

>
> Once the high watermark is hit, messages are paged to disk until enough
> memory is reclaimed to drop below the watermark. For the duration of
> this process, producers are throttled.
>
>>
>> In my tests (with no consumers) the memory usage grows constantly with
>> the amount of messages. Sometimes the memory usage decreased but
>> overall it grows until the watermark. Are the producers still too fast
>> for RabbitMQ (and my hardware)?
>
> This is expected due to the behaviour above. If you have no consumers
> the only way to reclaim memory is to flush messages to disk.
>>
>> To solve my problem i have to guarantee that all messages will be
>> queued and not blocked by RabbitMQ.
>
> You have a few options I think, but the most sensible one is to simply
> perform your own throttling of your producer.
>
>>
>> Thanks a lot
>> Hagbard
>>
>>> Hagbard,
>>>
>>> Since 2.x, RabbitMQ will no longer allow the Erlang process to run out
>>> of memory and stop due to fast producers and slow consumers.
>>>
>>> If you have a fast producer running constantly, accompanied by a slow
>>> consumer then the number of queued messages will grow. To prevent this
>>> from causing out of memory problems, Rabbit will throttle the producer
>>> once the memory high watermark is hit.
>>>
>>> The throttling works by simply blocking the producer from sending any
>>> more data over the TCP socket. Once memory drops below the high
>>> watermark, due to the consumer catching up or messages being flushed to
>>> disk, the producer can send data again.
>>>
>>> Note that your producer might bounce off the watermark frequently if it
>>> just keeps publishing without let up.
>>>
>>> Rob
>>>
>>> Hagbard at gmx.de wrote:
>>>> Hi,
>>>> im new to RabbitMQ and i have a question about the memory usage of
>>> RabbitMQ. I read that since RabbitMQ 2.x i don't need to care about fast
>>> producers and slow consumers and so don't need to care about the
>>> amount of
>>> messages in a queue and memory usage. After a test yesterday with 2GB
>>> memory and
>>> 4M messages in a queue (no consumer) RabbitMQ reached high memory
>>> watermark
>>> and stopped. Can somebody explain that behaviour?
>>>> Thanks a lot
>>>> Hagbard
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>

From emile at rabbitmq.com  Tue May 24 16:15:00 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 24 May 2011 16:15:00 +0100
Subject: [rabbitmq-discuss] WCF Bindings do not honor config settings
In-Reply-To: <BANLkTimhU1zaMuCazQt-Bekv2nQ+e6Cg_Q@mail.gmail.com>
References: <91d22ca1-37e4-4057-acf2-b59580b606fb@f9g2000vbz.googlegroups.com>	<4DDA8374.5050606@rabbitmq.com>
	<BANLkTimhU1zaMuCazQt-Bekv2nQ+e6Cg_Q@mail.gmail.com>
Message-ID: <4DDBCB74.6000604@rabbitmq.com>

On 23/05/11 17:09, Dan Barua wrote:
> Hi Emile,
>
> I found the problem with .Net client 2.4.1, and also I just pulled from
> the repository this afternoon revision 643 on default branch. It appears
> to have bug23887 merged into default.

Hi Dan,

Thanks for reporting this problem. I have filed a bug. Please consult 
future release notes to confirm when the solution gets released. A fix 
will appear in the branch labelled "bug24131".


-Emile

From danbarua at gmail.com  Tue May 24 16:16:53 2011
From: danbarua at gmail.com (Dan Barua)
Date: Tue, 24 May 2011 16:16:53 +0100
Subject: [rabbitmq-discuss] WCF Bindings do not honor config settings
In-Reply-To: <4DDBCB74.6000604@rabbitmq.com>
References: <91d22ca1-37e4-4057-acf2-b59580b606fb@f9g2000vbz.googlegroups.com>
	<4DDA8374.5050606@rabbitmq.com>
	<BANLkTimhU1zaMuCazQt-Bekv2nQ+e6Cg_Q@mail.gmail.com>
	<4DDBCB74.6000604@rabbitmq.com>
Message-ID: <BANLkTimH-p1FhY8gw5zXQ6xG1z5i9J5OUA@mail.gmail.com>

Thanks Emile,

If you start with a clean install of rabbit, delete the "/" virtual host and
guest user, create a new virtual host, username and password then step
through the code you will see the problem.

On Tue, May 24, 2011 at 4:15 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 23/05/11 17:09, Dan Barua wrote:
>
>> Hi Emile,
>>
>> I found the problem with .Net client 2.4.1, and also I just pulled from
>> the repository this afternoon revision 643 on default branch. It appears
>> to have bug23887 merged into default.
>>
>
> Hi Dan,
>
> Thanks for reporting this problem. I have filed a bug. Please consult
> future release notes to confirm when the solution gets released. A fix will
> appear in the branch labelled "bug24131".
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110524/7a576282/attachment.htm>

From Joe.Fitzgerald at emc.com  Tue May 24 18:31:23 2011
From: Joe.Fitzgerald at emc.com (Fitzgerald, Joe)
Date: Tue, 24 May 2011 17:31:23 +0000
Subject: [rabbitmq-discuss] On-Premise / Public RabbitMQ Cluster
Message-ID: <CA014788.8149%joe.fitzgerald@emc.com>

Hi,

I'm interested in understanding if anyone's established a RabbitMQ cluster that spans private infrastructure and public infrastructure. For example:

  *   RabbitMQ nodes on-premise
  *   RabbitMQ nodes on EC2 instances
  *   One single cluster
  *   A message sent to a queue via an on-premise node can be retrieved from the queue from an EC2 node, and vice-versa
  *   Etc?

Recognizing that the Shovel plugin could be used to partially simulate this scenario, are there any other options? What are the security / connectivity / latency implications? Can this be done without a VPN?

Best Regards,

Joe Fitzgerald
National Competency Lead ? App Dev & Integration

EMC Consulting
Mobile: (303) 888-3964 | joe.fitzgerald at emc.com<mailto:joe.fitzgerald at emc.com>

From alexis at rabbitmq.com  Tue May 24 19:16:22 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 24 May 2011 19:16:22 +0100
Subject: [rabbitmq-discuss] On-Premise / Public RabbitMQ Cluster
In-Reply-To: <CA014788.8149%joe.fitzgerald@emc.com>
References: <CA014788.8149%joe.fitzgerald@emc.com>
Message-ID: <BANLkTi=UDiPWpi4o91HMYsWv2eDHQLVO_A@mail.gmail.com>

Joe

Clusters are designed to run on a local network.  You would use shovel
or federation for this.  Federation is still being worked on.

alexis


On Tue, May 24, 2011 at 6:31 PM, Fitzgerald, Joe <Joe.Fitzgerald at emc.com> wrote:
> Hi,
>
> I'm interested in understanding if anyone's established a RabbitMQ cluster that spans private infrastructure and public infrastructure. For example:
>
> ?* ? RabbitMQ nodes on-premise
> ?* ? RabbitMQ nodes on EC2 instances
> ?* ? One single cluster
> ?* ? A message sent to a queue via an on-premise node can be retrieved from the queue from an EC2 node, and vice-versa
> ?* ? Etc?
>
> Recognizing that the Shovel plugin could be used to partially simulate this scenario, are there any other options? What are the security / connectivity / latency implications? Can this be done without a VPN?
>
> Best Regards,
>
> Joe Fitzgerald
> National Competency Lead ? App Dev & Integration
>
> EMC Consulting
> Mobile: (303) 888-3964 | joe.fitzgerald at emc.com<mailto:joe.fitzgerald at emc.com>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From clegnitto at mozilla.com  Tue May 24 23:45:14 2011
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Tue, 24 May 2011 15:45:14 -0700
Subject: [rabbitmq-discuss] Daemon processes, sporadic messages,
	and heartbeats?
Message-ID: <9D461C67-DD20-4B2D-8D8C-465A6BB3418E@mozilla.com>

Hi:

I'm using python with carrot to connect to RabbitMQ. I'm finding in some cases that long-running processes can "wedge" after they don't get messages for a long time. They don't throw an error and it looks like they are waiting for messages but they never get them. I guess they are connected to the local socket but the server connection is closed (either because the TCP/IP connection times out or the VM sleeps, etc). Once the scripts are killed and restarted they receive messages again.

Is there a heartbeat built into the protocol I can use to keep the connection alive? Is this a bug in the client libs (the fact that they don't throw?).

Has anyone had success running long-running processes (> a couple of days with no messages) with carrot/python (default backend)?

Thanks,
Christian

From matthias at rabbitmq.com  Wed May 25 13:35:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 May 2011 13:35:20 +0100
Subject: [rabbitmq-discuss] queue hands - timeout
In-Reply-To: <6969F969-EE84-404C-A574-23D32631F5D7@digitalriver.com>
References: <9C5CE94A-0666-4633-8E86-A5EF80A809BE@digitalriver.com>	<4DD64A4C.7090602@rabbitmq.com>
	<6969F969-EE84-404C-A574-23D32631F5D7@digitalriver.com>
Message-ID: <4DDCF788.7050701@rabbitmq.com>

Thomas,

On 23/05/11 13:07, Thomas Stagl wrote:
> On May 20, 2011, at 1:02 PM, Emile Joubert wrote:
>> Does rabbitmqctl still work when the problem occurs? The output of all the list_* commands at the time of failure will be useful.
> No, we can connect, but we can not send anything to the queue
>
>>
>> The broker logfile entries around the onset of the problem will also help.

We need the above info to look into this further, i.e. the output of the 
rabbitmqctl list_* commands at the time of the problem, and broker log 
file entries around the time of the problem.


Regards,

Matthias.

From matthias at rabbitmq.com  Wed May 25 13:36:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 May 2011 13:36:41 +0100
Subject: [rabbitmq-discuss] Dead Letter Channel?
In-Reply-To: <BANLkTi=EJsnQu7JTkOvrpy3bQG+Ap-DRtA@mail.gmail.com>
References: <BANLkTi=EJsnQu7JTkOvrpy3bQG+Ap-DRtA@mail.gmail.com>
Message-ID: <4DDCF7D9.2000509@rabbitmq.com>

James,

On 23/05/11 15:01, James Carr wrote:
> Last time I checked I recall that RabbitMQ doesn't yet support a dead
> letter channel.

Dead lettering is still on our todo list.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed May 25 13:51:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 May 2011 13:51:48 +0100
Subject: [rabbitmq-discuss] Daemon processes, sporadic messages,
	and heartbeats?
In-Reply-To: <9D461C67-DD20-4B2D-8D8C-465A6BB3418E@mozilla.com>
References: <9D461C67-DD20-4B2D-8D8C-465A6BB3418E@mozilla.com>
Message-ID: <4DDCFB64.7030100@rabbitmq.com>

Christian,

On 24/05/11 23:45, Christian Legnitto wrote:
> I'm using python with carrot to connect to RabbitMQ. I'm finding in
> some cases that long-running processes can "wedge" after they don't
> get messages for a long time. They don't throw an error and it looks
> like they are waiting for messages but they never get them. I guess
> they are connected to the local socket but the server connection is
> closed (either because the TCP/IP connection times out or the VM
> sleeps, etc). Once the scripts are killed and restarted they receive
> messages again.

Do the connection show up with 'rabbitmqctl list_connections'? If so, 
what's their 'state' and 'send_pend'?

> Is there a heartbeat built into the protocol I can use to keep the
> connection alive?

Yes. And if the heartbeats (or other data) don't arrive then both ends 
of the connection are torn down.

Heartbeats are off by default; they need to be enabled at the time AMQP 
connection establishment. No idea how to do that in carrot, but one 
would hope it's possible.


Regards,

Matthias.

From simon at rabbitmq.com  Wed May 25 14:14:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 May 2011 14:14:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ cluster w/ .Net client
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A309107833@l360xch01.office.leads360.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A309107833@l360xch01.office.leads360.com>
Message-ID: <4DDD00AA.2040305@rabbitmq.com>

On 23/05/11 20:15, Yann Luppo wrote:
> Hi,
>
> I've read many posts and blogs at this point and I'm still not sure
> about how to cluster correctly my 2 RabbitMQ nodes.
>
> I've read the RabbitMQ clustering
> guide:http://www.rabbitmq.com/clustering.html
>
> I found out about a mysterious ClusterId in the API guide, with no
> explanation on how to get that Id in the first
> place:http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.4.1/rabbitmq-dotnet-client-2.4.1-api-guide.pdf

The ClusterId is not documented because it doesn't do anything in 
RabbitMQ. In fact it was never well defined and was deprecated in 0-9-1. 
I'm not sure what it's still doing in that guide; I've filed a bug.

> Learned in that StackOverflow post that basically I'd need my clients to
> be aware of each node in the cluster and code for failover
> scenario:rabbitmq HA cluster
> <http://stackoverflow.com/questions/4140653/rabbitmq-ha-cluster>
>
> Now... The behavior I'd like to have is something a little more
> transparent if possible. Where I would potentially use that "ClusterId"
> on the client to make the consumer cluster aware and then hopefully the
> library knows to randomly connect to either node to grab messages.
>
> Granted I know a message can only be on one server at a time, so I'm
> hoping for some round robin magic from the DotNet client library that
> would also handle fail over situations.

I'm afraid that all the client libraries just know how to connect to the 
host you give them.

> Basically I was hoping for the whole thing to scale without changing any
> code or configuration on the publisher or consumer apps.
>
> Now based on my readings it doesn't quite work like that... unless I
> missed something. If my knowledge is up to date and I have to code all
> that cluster aware business, then... why does RabbitMQ have a cluster
> feature in the first place? How is it used?

Clustering exists to:

* Allow you to get higher throughput than a single node can manage.

* In the near future, allow queues to exist on more than one node, and 
survive node failure.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Wed May 25 16:07:22 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 25 May 2011 16:07:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Erlang R14B03
Message-ID: <20110525150722.GD24650@rabbitmq.com>

For those of you living on the bleeding edge:

Erlang R14B03 has just been released. It's currently not possible to
_compile_ rabbitmq-server with R14B03 unless you do some hacking. Note
though that I believe running a pre-compiled rabbitmq-server with R14B03
should be fine.

A fix is already done and pending QA and then rabbitmq-server will be
able to be compiled with R14B03 again.

The problem was solely related to types: R14B03 moved some types out of
inet.hrl and into inet.erl and then exported them. As a result they
vanished from scope where we were doing an
-include_lib("kernel/include/inet.hrl").

Matthew

From aaron at agoragames.com  Wed May 25 20:31:31 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 25 May 2011 15:31:31 -0400
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
Message-ID: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>

What is the expected behavior of Rabbit when Erlang runs out of
processes? We had an event over the past weekend that went something
like this:

  =ERROR REPORT==== 22-May-2011::17:35:58 ===
  Too many processes

This continued for many hours. Rabbit is configured with 1048576 procs
and with mid-day load is reporting 595400 in use. At the time of this
event, our databases were beginning a prolonged period of fail, and
messages were starting to pile up. I don't have numbers for count of
pending messages at the time of this first log report, but when it
outright crashed 2.5 hours later, the backlog had spiked to more than
2 million and was declining after we fixed the databases and messages
were finally draining.

I have mountains of application and SASL logs and have already poured
through them to highlight notable sections. I'll gladly provide any
data to help diagnose the crash. The final seconds, triggered by a
rabbitmqctl call to list queues, resulted in rex dying and mnesia
exiting.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From mlortiz at uci.cu  Wed May 25 21:23:27 2011
From: mlortiz at uci.cu (Marcos Ortiz)
Date: Wed, 25 May 2011 15:53:27 -0430
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
In-Reply-To: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
References: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
Message-ID: <4DDD653F.70308@uci.cu>

On 05/25/2011 03:01 PM, Aaron Westendorf wrote:
> What is the expected behavior of Rabbit when Erlang runs out of
> processes? We had an event over the past weekend that went something
> like this:
>
>    =ERROR REPORT==== 22-May-2011::17:35:58 ===
>    Too many processes
Regards, Aaron, Can you provide your environment's details?
- Operating System
- Erlang version
- RabbitMQ version

Second
  Can you provide minor details which are the basic workflows of the 
RabbitMQ'use on Agora?

Can you check with erlang:system_info(process_limit) which is the 
process limit in your O.S?

Regards

> This continued for many hours. Rabbit is configured with 1048576 procs
> and with mid-day load is reporting 595400 in use. At the time of this
> event, our databases were beginning a prolonged period of fail, and
> messages were starting to pile up. I don't have numbers for count of
> pending messages at the time of this first log report, but when it
> outright crashed 2.5 hours later, the backlog had spiked to more than
> 2 million and was declining after we fixed the databases and messages
> were finally draining.
>
> I have mountains of application and SASL logs and have already poured
> through them to highlight notable sections. I'll gladly provide any
> data to help diagnose the crash. The final seconds, triggered by a
> rabbitmqctl call to list queues, resulted in rex dying and mnesia
> exiting.
>
> -Aaron
>
>


-- 
Marcos Luis Ortiz Valmaseda
  Software Engineer (Distributed Systems)
  http://uncubanitolinuxero.blogspot.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110525/d1a1289b/attachment.htm>

From matthias at rabbitmq.com  Wed May 25 22:02:40 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 May 2011 22:02:40 +0100
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
In-Reply-To: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
References: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
Message-ID: <4DDD6E70.1060608@rabbitmq.com>

Aaron,

Aaron Westendorf wrote:
> What is the expected behavior of Rabbit when Erlang runs out of 
> processes?

Bad things happen.

> We had an event over the past weekend that went something like this:
> 
> =ERROR REPORT==== 22-May-2011::17:35:58 === Too many processes
> 
> This continued for many hours.

That's bad.

> Rabbit is configured with 1048576 procs and with mid-day load is
> reporting 595400 in use.

There are very few things in rabbit that use up processes. Queues, 
connections and channels being the main ones. Do you expect high numbers 
of these in your application? If yes then there is no harm in raising 
the process limit except for an increased initial memory footprint. If 
no then you may want to have a look at the state of your system with 
'rabbitmqctl list_*' to determine what kind of resource is showing an 
unexpectedly high count.


Regards,

Matthias.

From matthew at rabbitmq.com  Wed May 25 22:06:50 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 25 May 2011 22:06:50 +0100
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
In-Reply-To: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
References: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
Message-ID: <20110525210649.GA14745@wellquite.org>

Hi Aaron,

On Wed, May 25, 2011 at 03:31:31PM -0400, Aaron Westendorf wrote:
> What is the expected behavior of Rabbit when Erlang runs out of
> processes? We had an event over the past weekend that went something
> like this:
> 
>   =ERROR REPORT==== 22-May-2011::17:35:58 ===
>   Too many processes

Ahh well. That's a problem. Basically, we don't try to deal nicely with
this situation, and just let the universe slowly approach its event
horizon. So, really, the only advice I can give is to adjust the P value
so as to have a good level of confidence that you're not going to run
out of processes. The max value is, I think, about 4 billion, so you
have some wiggle room.

Matthew

From yluppo at leads360.com  Thu May 26 01:17:14 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Wed, 25 May 2011 17:17:14 -0700
Subject: [rabbitmq-discuss] BasicAck and Timeout
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A309108703@l360xch01.office.leads360.com>

Hi,

 

I'm using RabbitMq to process tasks that can be processed anywhere in
the range of 1 sec to a couple of days, albeit the later should be a
rare case, and I was wondering if there is any timeout set in Erlang or
RabbitMq that would prevent me from sending the BasicAck after a very
long period of time and work as expected?

 

I read stuff about some connection heartbeat but couldn't quite figure
out if it's related.

 

Thanks,

Yann

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110525/ba14061b/attachment.htm>

From vbernard42 at gmail.com  Thu May 26 08:30:28 2011
From: vbernard42 at gmail.com (Valentin Bernard)
Date: Thu, 26 May 2011 00:30:28 -0700 (PDT)
Subject: [rabbitmq-discuss] BasicAck and Timeout
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A309108703@l360xch01.office.leads360.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A309108703@l360xch01.office.leads360.com>
Message-ID: <72d200b1-741b-4fbe-9c82-ad8b9aacdce4@g28g2000yqa.googlegroups.com>

Hi,

That shouldn't be a problem. Here is what the 2nd tutorial says:
"If a consumer dies without sending an ack, RabbitMQ will understand
that a message wasn't processed fully and will redeliver it to another
consumer. That way you can be sure that no message is lost, even if
the workers occasionally die.

There aren't any message timeouts; RabbitMQ will redeliver the message
only when the worker connection dies. It's fine even if processing a
message takes a very, very long time."

Regards,

Valentin.

On May 26, 2:17?am, Yann Luppo <ylu... at leads360.com> wrote:
> Hi,
>
> I'm using RabbitMq to process tasks that can be processed anywhere in
> the range of 1 sec to a couple of days, albeit the later should be a
> rare case, and I was wondering if there is any timeout set in Erlang or
> RabbitMq that would prevent me from sending the BasicAck after a very
> long period of time and work as expected?
>
> I read stuff about some connection heartbeat but couldn't quite figure
> out if it's related.
>
> Thanks,
>
> Yann
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu May 26 10:44:42 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 26 May 2011 10:44:42 +0100
Subject: [rabbitmq-discuss] BasicAck and Timeout
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A309108703@l360xch01.office.leads360.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A309108703@l360xch01.office.leads360.com>
Message-ID: <4DDE210A.4000705@rabbitmq.com>

I think Valentin has already answered your question, but:

On 26/05/11 01:17, Yann Luppo wrote:
> I read stuff about some connection heartbeat but couldn?t quite figure
> out if it?s related.

Not really. The purpose of heartbeating is to ensure that interrupted 
TCP connections are detected in a timely manner, even in the face of 
lower-level networking that is trying to ensure the opposite.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthias at rabbitmq.com  Thu May 26 10:54:51 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 May 2011 10:54:51 +0100
Subject: [rabbitmq-discuss] BasicAck and Timeout
In-Reply-To: <4DDE210A.4000705@rabbitmq.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A309108703@l360xch01.office.leads360.com>
	<4DDE210A.4000705@rabbitmq.com>
Message-ID: <4DDE236B.7000905@rabbitmq.com>

Simon MacMullen wrote:
> I think Valentin has already answered your question, but:
> 
> On 26/05/11 01:17, Yann Luppo wrote:
>> I read stuff about some connection heartbeat but couldn?t quite figure
>> out if it?s related.
> 
> Not really. The purpose of heartbeating is to ensure that interrupted 
> TCP connections are detected in a timely manner, even in the face of 
> lower-level networking that is trying to ensure the opposite.

It's actually also useful to keep connections alive in the face of 
low-level networking trying to nuke them due to inactivity.


Matthias.

From aaron at agoragames.com  Thu May 26 13:25:20 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 26 May 2011 08:25:20 -0400
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
In-Reply-To: <20110525210649.GA14745@wellquite.org>
References: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
	<20110525210649.GA14745@wellquite.org>
Message-ID: <BANLkTi=zfQPwjh4YPhwC2LFTPDY16UR2Uw@mail.gmail.com>

Thanks guys, I expected that. For what it's worth, Rabbit hung in
there for several hours before finally breaching said horizon.

We're going to adjust our settings and add some monitoring for how
close we are to the limit.

cheers,
Aaron


On Wed, May 25, 2011 at 5:06 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hi Aaron,
>
> On Wed, May 25, 2011 at 03:31:31PM -0400, Aaron Westendorf wrote:
>> What is the expected behavior of Rabbit when Erlang runs out of
>> processes? We had an event over the past weekend that went something
>> like this:
>>
>> ? =ERROR REPORT==== 22-May-2011::17:35:58 ===
>> ? Too many processes
>
> Ahh well. That's a problem. Basically, we don't try to deal nicely with
> this situation, and just let the universe slowly approach its event
> horizon. So, really, the only advice I can give is to adjust the P value
> so as to have a good level of confidence that you're not going to run
> out of processes. The max value is, I think, about 4 billion, so you
> have some wiggle room.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthew at rabbitmq.com  Thu May 26 13:38:58 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 26 May 2011 13:38:58 +0100
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
In-Reply-To: <BANLkTi=zfQPwjh4YPhwC2LFTPDY16UR2Uw@mail.gmail.com>
References: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
	<20110525210649.GA14745@wellquite.org>
	<BANLkTi=zfQPwjh4YPhwC2LFTPDY16UR2Uw@mail.gmail.com>
Message-ID: <20110526123857.GG30140@rabbitmq.com>

On Thu, May 26, 2011 at 08:25:20AM -0400, Aaron Westendorf wrote:
> Thanks guys, I expected that. For what it's worth, Rabbit hung in
> there for several hours before finally breaching said horizon.

The problem really amounts to the same as why our memory monitoring is
very very conservative: we just have no idea what the rest of the Erlang
stdlibs and kernel gets up to, so monitoring our own usage of processes
is never going to be a reliable metric as for some reason the kernel
could suddenly decide to start using hundreds more processes. In
reality, that's not especially likely to happen, but it's still
complexity with thorns that we've yet to grasp at.

> We're going to adjust our settings and add some monitoring for how
> close we are to the limit.

Sounds sensible.

Matthew

From matthias at rabbitmq.com  Thu May 26 13:48:07 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 May 2011 13:48:07 +0100
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
In-Reply-To: <BANLkTi=zfQPwjh4YPhwC2LFTPDY16UR2Uw@mail.gmail.com>
References: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>	<20110525210649.GA14745@wellquite.org>
	<BANLkTi=zfQPwjh4YPhwC2LFTPDY16UR2Uw@mail.gmail.com>
Message-ID: <4DDE4C07.6010107@rabbitmq.com>

Aaron,

Aaron Westendorf wrote:
> Thanks guys, I expected that. For what it's worth, Rabbit hung in
> there for several hours before finally breaching said horizon.
> 
> We're going to adjust our settings and add some monitoring for how
> close we are to the limit.

I don't think increasing the process limit is a good idea unless you 
know there are good reasons for why your application would exceed the 
defaults. As I said in my earlier reply ...

<quote>
There are very few things in rabbit that use up processes. Queues, 
connections and channels being the main ones. Do you expect high numbers 
of these in your application? If yes then there is no harm in raising 
the process limit except for an increased initial memory footprint. If 
no then you may want to have a look at the state of your system with 
'rabbitmqctl list_*' to determine what kind of resource is showing an 
unexpectedly high count.
</quote>

Regards,

Matthias.

From aaron at agoragames.com  Thu May 26 14:11:55 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 26 May 2011 09:11:55 -0400
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
In-Reply-To: <4DDE4C07.6010107@rabbitmq.com>
References: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>
	<20110525210649.GA14745@wellquite.org>
	<BANLkTi=zfQPwjh4YPhwC2LFTPDY16UR2Uw@mail.gmail.com>
	<4DDE4C07.6010107@rabbitmq.com>
Message-ID: <BANLkTikko9TRA-U4h8N+-3gPBNiEazTvzw@mail.gmail.com>

Matthias,

> I don't think increasing the process limit is a good idea unless you know
> there are good reasons for why your application would exceed the defaults.
> As I said in my earlier reply ...

We're very likely to, especially with regards to channels. At the
moment most of our traffic is routed over one host, and all the
applications use at least a few queues each. Where we're really likely
to use Erlang procs is for channels, as we use them liberally both on
their own and via haigha's ChannelPool. In this case, where messages
were piling up and it's possible that ChannelPools were growing large
because transactions were slowing down, we could have hit our process
limit quite readily. Adding an optional cap to the pool size is a
feature I intend to add.

-Aaron

From matthias at rabbitmq.com  Thu May 26 14:19:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 May 2011 14:19:48 +0100
Subject: [rabbitmq-discuss] behavior when erlang processes exhausted
In-Reply-To: <BANLkTikko9TRA-U4h8N+-3gPBNiEazTvzw@mail.gmail.com>
References: <BANLkTikiUH740bEt1Bt8=_PbXh=T9NvGUw@mail.gmail.com>	<20110525210649.GA14745@wellquite.org>	<BANLkTi=zfQPwjh4YPhwC2LFTPDY16UR2Uw@mail.gmail.com>	<4DDE4C07.6010107@rabbitmq.com>
	<BANLkTikko9TRA-U4h8N+-3gPBNiEazTvzw@mail.gmail.com>
Message-ID: <4DDE5374.80502@rabbitmq.com>

Aaron,

Aaron Westendorf wrote:
> We're very likely to, especially with regards to channels. At the 
> moment most of our traffic is routed over one host, and all the 
> applications use at least a few queues each. Where we're really
> likely to use Erlang procs is for channels, as we use them liberally
> both on their own and via haigha's ChannelPool.

ok. It's probably worth confirming that channels are indeed the culprit
by counting them with 'rabbitmqctl list_channels'.

> In this case, where messages were piling up and it's possible that
> ChannelPools were growing large because transactions were slowing
> down, we could have hit our process limit quite readily. Adding an
> optional cap to the pool size is a feature I intend to add.

Processes have a memory footprint. That's generally quite small when 
they are hibernating, but once you get into the millions you might 
easily lose a few hundred meg that way.

In summary, it's ok to create channels liberally, just not *too* 
liberally :)


Regards,

Matthias.

From yluppo at leads360.com  Thu May 26 16:58:51 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Thu, 26 May 2011 08:58:51 -0700
Subject: [rabbitmq-discuss] BasicAck and Timeout
In-Reply-To: <4DDE236B.7000905@rabbitmq.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A309108703@l360xch01.office.leads360.com><4DDE210A.4000705@rabbitmq.com>
	<4DDE236B.7000905@rabbitmq.com>
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A30916EE6C@l360xch01.office.leads360.com>

Thank you guys for the clarifications on the heart beats. :)

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
Matthias Radestock
Sent: Thursday, May 26, 2011 2:55 AM
To: Simon MacMullen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] BasicAck and Timeout

Simon MacMullen wrote:
> I think Valentin has already answered your question, but:
> 
> On 26/05/11 01:17, Yann Luppo wrote:
>> I read stuff about some connection heartbeat but couldn't quite
figure
>> out if it's related.
> 
> Not really. The purpose of heartbeating is to ensure that interrupted 
> TCP connections are detected in a timely manner, even in the face of 
> lower-level networking that is trying to ensure the opposite.

It's actually also useful to keep connections alive in the face of 
low-level networking trying to nuke them due to inactivity.


Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yluppo at leads360.com  Thu May 26 17:57:38 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Thu, 26 May 2011 09:57:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ cluster w/ .Net client
In-Reply-To: <4DDD00AA.2040305@rabbitmq.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A309107833@l360xch01.office.leads360.com>
	<4DDD00AA.2040305@rabbitmq.com>
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A30916EEE2@l360xch01.office.leads360.com>

To follow up on the clustering question, is it safe to assume the
following scenario would work as expected?

* 2 rabbitMQ nodes clustered, rabbit1 and rabbit2
* Client A connects to rabbit1, creates a new queue QueueX and pushes
messages at regular interval to that queue
* Client B connects to rabbit2 to consume messages from QueueX. Since
servers are clustered rabbit2 knows how to route the messages from
QueueX on rabbit1 to Client B.
* Client C connects to rabbit2 and pushes messages to QueueX and again
rabbit2 knows how to route the messages to QueueX.

Here is my understanding and I'd like it corrected if it's wrong in
anyway please: 

QueueX really only exists on the server it's been created but other
rabbitmq nodes on that cluster know how to communicate to and from that
queue.

Is that an accurate picture of rabbitmq clustering?

Thank you,
Yann

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon
MacMullen
Sent: Wednesday, May 25, 2011 6:14 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ cluster w/ .Net client

On 23/05/11 20:15, Yann Luppo wrote:
> Hi,
>
> I've read many posts and blogs at this point and I'm still not sure
> about how to cluster correctly my 2 RabbitMQ nodes.
>
> I've read the RabbitMQ clustering
> guide:http://www.rabbitmq.com/clustering.html
>
> I found out about a mysterious ClusterId in the API guide, with no
> explanation on how to get that Id in the first
>
place:http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.4.1/rab
bitmq-dotnet-client-2.4.1-api-guide.pdf

The ClusterId is not documented because it doesn't do anything in 
RabbitMQ. In fact it was never well defined and was deprecated in 0-9-1.

I'm not sure what it's still doing in that guide; I've filed a bug.

> Learned in that StackOverflow post that basically I'd need my clients
to
> be aware of each node in the cluster and code for failover
> scenario:rabbitmq HA cluster
> <http://stackoverflow.com/questions/4140653/rabbitmq-ha-cluster>
>
> Now... The behavior I'd like to have is something a little more
> transparent if possible. Where I would potentially use that
"ClusterId"
> on the client to make the consumer cluster aware and then hopefully
the
> library knows to randomly connect to either node to grab messages.
>
> Granted I know a message can only be on one server at a time, so I'm
> hoping for some round robin magic from the DotNet client library that
> would also handle fail over situations.

I'm afraid that all the client libraries just know how to connect to the

host you give them.

> Basically I was hoping for the whole thing to scale without changing
any
> code or configuration on the publisher or consumer apps.
>
> Now based on my readings it doesn't quite work like that... unless I
> missed something. If my knowledge is up to date and I have to code all
> that cluster aware business, then... why does RabbitMQ have a cluster
> feature in the first place? How is it used?

Clustering exists to:

* Allow you to get higher throughput than a single node can manage.

* In the near future, allow queues to exist on more than one node, and 
survive node failure.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Thu May 26 18:05:18 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 26 May 2011 10:05:18 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ cluster w/ .Net client
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A30916EEE2@l360xch01.office.leads360.com>
Message-ID: <278087392.291476.1306429518739.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Hi, Yann...

Yes, your understanding is correct.  Worrying about what particular Rabbit node a given queue "really" lives on is really only of concern when nodes fail.

Best regards,
Jerry

----- Original Message -----
From: "Yann Luppo" <yluppo at leads360.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, May 26, 2011 9:57:38 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ cluster w/ .Net client

To follow up on the clustering question, is it safe to assume the
following scenario would work as expected?

* 2 rabbitMQ nodes clustered, rabbit1 and rabbit2
* Client A connects to rabbit1, creates a new queue QueueX and pushes
messages at regular interval to that queue
* Client B connects to rabbit2 to consume messages from QueueX. Since
servers are clustered rabbit2 knows how to route the messages from
QueueX on rabbit1 to Client B.
* Client C connects to rabbit2 and pushes messages to QueueX and again
rabbit2 knows how to route the messages to QueueX.

Here is my understanding and I'd like it corrected if it's wrong in
anyway please: 

QueueX really only exists on the server it's been created but other
rabbitmq nodes on that cluster know how to communicate to and from that
queue.

Is that an accurate picture of rabbitmq clustering?

Thank you,
Yann

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon
MacMullen
Sent: Wednesday, May 25, 2011 6:14 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ cluster w/ .Net client

On 23/05/11 20:15, Yann Luppo wrote:
> Hi,
>
> I've read many posts and blogs at this point and I'm still not sure
> about how to cluster correctly my 2 RabbitMQ nodes.
>
> I've read the RabbitMQ clustering
> guide:http://www.rabbitmq.com/clustering.html
>
> I found out about a mysterious ClusterId in the API guide, with no
> explanation on how to get that Id in the first
>
place:http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.4.1/rab
bitmq-dotnet-client-2.4.1-api-guide.pdf

The ClusterId is not documented because it doesn't do anything in 
RabbitMQ. In fact it was never well defined and was deprecated in 0-9-1.

I'm not sure what it's still doing in that guide; I've filed a bug.

> Learned in that StackOverflow post that basically I'd need my clients
to
> be aware of each node in the cluster and code for failover
> scenario:rabbitmq HA cluster
> <http://stackoverflow.com/questions/4140653/rabbitmq-ha-cluster>
>
> Now... The behavior I'd like to have is something a little more
> transparent if possible. Where I would potentially use that
"ClusterId"
> on the client to make the consumer cluster aware and then hopefully
the
> library knows to randomly connect to either node to grab messages.
>
> Granted I know a message can only be on one server at a time, so I'm
> hoping for some round robin magic from the DotNet client library that
> would also handle fail over situations.

I'm afraid that all the client libraries just know how to connect to the

host you give them.

> Basically I was hoping for the whole thing to scale without changing
any
> code or configuration on the publisher or consumer apps.
>
> Now based on my readings it doesn't quite work like that... unless I
> missed something. If my knowledge is up to date and I have to code all
> that cluster aware business, then... why does RabbitMQ have a cluster
> feature in the first place? How is it used?

Clustering exists to:

* Allow you to get higher throughput than a single node can manage.

* In the near future, allow queues to exist on more than one node, and 
survive node failure.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rajc at myquu.com  Thu May 26 18:58:53 2011
From: rajc at myquu.com (Rajarshi Chakravarty)
Date: Thu, 26 May 2011 23:28:53 +0530
Subject: [rabbitmq-discuss] multiple workers
Message-ID: <000001cc1bce$95749440$c05dbcc0$@com>

Hi,

I have implemented Rabbit queues in java.

 

In the "Work Queues" example given on the site, 2 programs are created and
each runs an infinite loop.

My question is instead of doing that, can I create 2 threads in a program
and run an infinite loop in each thread?

 

Regards,

Raj

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110526/86d6fdfa/attachment.htm>

From rajc at myquu.com  Thu May 26 19:05:17 2011
From: rajc at myquu.com (Rajarshi Chakravarty)
Date: Thu, 26 May 2011 23:35:17 +0530
Subject: [rabbitmq-discuss] long running producer
Message-ID: <000501cc1bcf$7a0ec3f0$6e2c4bd0$@com>

Hi,

 

Can anyone post an example of a Producer program in Java that creates a
connection to a queue and keeps it open infinitely?

My requirement is to listen to a port and whenever data comes to it, send it
to a Rabbit queue.

There should be some recovery mechanism like if the connection gets broken,
the program should attempt a reconnect.

 

Thanks and regards,

Raj

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110526/56482c44/attachment.htm>

From lgreg.meredith at gmail.com  Thu May 26 19:55:20 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Thu, 26 May 2011 11:55:20 -0700
Subject: [rabbitmq-discuss] Journaling for RabbitMQ?
Message-ID: <BANLkTikFaU-nVqWueBWYk_iam2Tz7cBNbg@mail.gmail.com>

Dear Rabbitters,

i was working with a client recently and they asked whether RabbitMQ had a
journaling feature. The client was used to working with MSMQ which has such
a feature and allows them to get a view of queue usage history, such as
message deposited to queue, message read from queue, etc. The question came
up in the context of debugging a message processing code path where we
couldn't readily tell whether the message had been deposited to the queue
and was being nabbed by a dispatcher faster than we could see or whether the
message was never arriving at the queue at all. The client observed that
with a journaling feature there would be no need to introduce more debugging
statements into application code. So, i'm passing their question along to
you.

In this connection i will raise a point i've made before to this community.
With such a journaling log i can take off-the-shelf tools and probe message
traces for correctness properties. Specifically, i have already demonstrated
with a little project called XTrace that with an xml-based message history
format we can use schema conformance to probe message trace for properties.
The basic idea is to encode a property as a schema. The beauty of this
approach is that it is post facto and does not require a specific schema to
govern message trace history. Rather, an application programmer devises
schema to investigate the message trace history to look for conformance to
protocol or validate a guess about where/how things might be going awry.

i mention this latter point in connection with the client's question to
amplify the argument for the feature. Their sense of the separation of
concerns and independent value for RabbitMQ is right on track and only the
tip of the iceberg of what can be done.

Best wishes,

--greg

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110526/7f0aa176/attachment.htm>

From jon at jbrisbin.com  Thu May 26 20:26:31 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 26 May 2011 14:26:31 -0500 (CDT)
Subject: [rabbitmq-discuss] Journaling for RabbitMQ?
In-Reply-To: <BANLkTikFaU-nVqWueBWYk_iam2Tz7cBNbg@mail.gmail.com>
Message-ID: <cb0a1386-ca3f-4222-ba31-b196b05220fb@jbrisbin.local>

I suspect it would take about 30 minutes to create a special journaled exchange type that simply logged every message that came through to a log file. You'd need to use a custom exchange rather than a built-in version. That being said, it would act just like a built-in exchange type. But you probably wouldn't want to run something like this in production anyway, right? 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Meredith Gregory" <lgreg.meredith at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Thursday, May 26, 2011 1:55:20 PM
> Subject: [rabbitmq-discuss] Journaling for RabbitMQ?

> Dear Rabbitters,

> i was working with a client recently and they asked whether RabbitMQ
> had a journaling feature. The client was used to working with MSMQ
> which has such a feature and allows them to get a view of queue
> usage history, such as message deposited to queue, message read from
> queue, etc. The question came up in the context of debugging a
> message processing code path where we couldn't readily tell whether
> the message had been deposited to the queue and was being nabbed by
> a dispatcher faster than we could see or whether the message was
> never arriving at the queue at all. The client observed that with a
> journaling feature there would be no need to introduce more
> debugging statements into application code. So, i'm passing their
> question along to you.

> In this connection i will raise a point i've made before to this
> community. With such a journaling log i can take off-the-shelf tools
> and probe message traces for correctness properties. Specifically, i
> have already demonstrated with a little project called XTrace that
> with an xml-based message history format we can use schema
> conformance to probe message trace for properties. The basic idea is
> to encode a property as a schema. The beauty of this approach is
> that it is post facto and does not require a specific schema to
> govern message trace history. Rather, an application programmer
> devises schema to investigate the message trace history to look for
> conformance to protocol or validate a guess about where/how things
> might be going awry.

> i mention this latter point in connection with the client's question
> to amplify the argument for the feature. Their sense of the
> separation of concerns and independent value for RabbitMQ is right
> on track and only the tip of the iceberg of what can be done.

> Best wishes,

> --greg

> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136

> +1 206.650.3740

> http://biosimilarity.blogspot.com

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110526/b2b47f4f/attachment.htm>

From shankar.kundargi at hp.com  Thu May 26 20:23:16 2011
From: shankar.kundargi at hp.com (Kundargi, Shankar)
Date: Thu, 26 May 2011 19:23:16 +0000
Subject: [rabbitmq-discuss] Needed Info
Message-ID: <920C05C422F9A84CACAF9B37DD3BC4B85E2972314A@GVW1161EXB.americas.hpqcorp.net>

Hi Team,
I wanted to know whether there is a way to pint the RabbitMQ Mnesia directory to some directory say for example the default directory for Mnesia now is /var/lib/rabbitmq and I want that to change that to /dev/sda1.
I am using RHEL as the Operating system.

Can you please help me on this.

Thanks & Regards,
Shankar Kundargi|HLS & G Vertical
HP Enterprise Services,BAS India center
39/40 Hewlett Packard Avenue
Electronics City phase I, Bangalore, India 560100
* +91 80 26132098   [office]
"Deserve before you Desire"


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110526/1415b606/attachment-0001.htm>

From lgreg.meredith at gmail.com  Thu May 26 21:09:26 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Thu, 26 May 2011 13:09:26 -0700
Subject: [rabbitmq-discuss] Journaling for RabbitMQ?
In-Reply-To: <cb0a1386-ca3f-4222-ba31-b196b05220fb@jbrisbin.local>
References: <BANLkTikFaU-nVqWueBWYk_iam2Tz7cBNbg@mail.gmail.com>
	<cb0a1386-ca3f-4222-ba31-b196b05220fb@jbrisbin.local>
Message-ID: <BANLkTik1pyK=RLXKZ-s-EZJKNPMimfejqQ@mail.gmail.com>

Dear Jon,

Thanks! Would that also log when a message was read?

Best wishes,

--greg

On Thu, May 26, 2011 at 12:26 PM, Jon Brisbin <jon at jbrisbin.com> wrote:

> I suspect it would take about 30 minutes to create a special journaled
> exchange type that simply logged every message that came through to a log
> file. You'd need to use a custom exchange rather than a built-in version.
> That being said, it would act just like a built-in exchange type. But you
> probably wouldn't want to run something like this in production anyway,
> right?
>
>
> Thanks!
>
> Jon Brisbin
> http//jbrisbin.com
>
>
> ------------------------------
>
> *From: *"Meredith Gregory" <lgreg.meredith at gmail.com>
> *To: *rabbitmq-discuss at lists.rabbitmq.com
> *Sent: *Thursday, May 26, 2011 1:55:20 PM
> *Subject: *[rabbitmq-discuss] Journaling for RabbitMQ?
>
>
> Dear Rabbitters,
>
> i was working with a client recently and they asked whether RabbitMQ had a
> journaling feature. The client was used to working with MSMQ which has such
> a feature and allows them to get a view of queue usage history, such as
> message deposited to queue, message read from queue, etc. The question came
> up in the context of debugging a message processing code path where we
> couldn't readily tell whether the message had been deposited to the queue
> and was being nabbed by a dispatcher faster than we could see or whether the
> message was never arriving at the queue at all. The client observed that
> with a journaling feature there would be no need to introduce more debugging
> statements into application code. So, i'm passing their question along to
> you.
>
> In this connection i will raise a point i've made before to this community.
> With such a journaling log i can take off-the-shelf tools and probe message
> traces for correctness properties. Specifically, i have already demonstrated
> with a little project called XTrace that with an xml-based message history
> format we can use schema conformance to probe message trace for properties.
> The basic idea is to encode a property as a schema. The beauty of this
> approach is that it is post facto and does not require a specific schema to
> govern message trace history. Rather, an application programmer devises
> schema to investigate the message trace history to look for conformance to
> protocol or validate a guess about where/how things might be going awry.
>
> i mention this latter point in connection with the client's question to
> amplify the argument for the feature. Their sense of the separation of
> concerns and independent value for RabbitMQ is right on track and only the
> tip of the iceberg of what can be done.
>
> Best wishes,
>
> --greg
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>


-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110526/05d5ed72/attachment.htm>

From david.leblanc at gmail.com  Thu May 26 22:19:15 2011
From: david.leblanc at gmail.com (Dave LeBlanc)
Date: Thu, 26 May 2011 14:19:15 -0700
Subject: [rabbitmq-discuss] Advice on simplifying design
Message-ID: <BANLkTin=PXbrkMpAzv4GCy6TcV6jgc_ABQ@mail.gmail.com>

I'm working with RabbitMQ and wondering if anyone has some suggestions to
simplify my design or follow more rabbit-specific idioms.

Currently we receive messages in a packaged format, and dump those into a
single queue for unpackaging later (so far so good).

We have a listener on that queue that unpacks these messages, and dumps them
into a queue-per-customer kind of approach. We have ~15,000 potential
customers, so we've approached it as follows:

 - Every so often, do a call to the management API to get a list of queues
that have messages ready
 - iterate over the queues and process any messages waiting there (in a
separate thread pool)
 - delete the queue if it's empty

Since the scheduled management API approach isn't a very realtime operation
(especially with a few thousand queues - it can be very slow) we also have
an approach where we have a 'queue-updated' queue, which we listen on and
when a message is received there, we process the appropriate queue. Since
processing the queue entries can take a long time, we don't tie the
'queue-updated' message success to the actual processing of the consumer
queues, but use them as hints that we should check a particular consumer
queue.

Is there a better/simpler approach? Perhaps a listener on the exchange
itself? The queue-per-customer approach is advantageous for us given how we
interact with the data - we can batch up messages for the same customer and
save a lot of processing and I/O.

Thanks,

 -Dave

-- 
Dave LeBlanc <david.leblanc at gmail.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110526/74d0fe49/attachment.htm>

From mlortiz at uci.cu  Thu May 26 23:11:38 2011
From: mlortiz at uci.cu (Marcos Ortiz)
Date: Thu, 26 May 2011 17:41:38 -0430
Subject: [rabbitmq-discuss] Needed Info
In-Reply-To: <920C05C422F9A84CACAF9B37DD3BC4B85E2972314A@GVW1161EXB.americas.hpqcorp.net>
References: <920C05C422F9A84CACAF9B37DD3BC4B85E2972314A@GVW1161EXB.americas.hpqcorp.net>
Message-ID: <4DDED01A.1070109@uci.cu>

On 05/26/2011 02:53 PM, Kundargi, Shankar wrote:
>
> Hi Team,
>
> I wanted to know whether there is a way to pint the RabbitMQ Mnesia 
> directory to some directory say for example the default directory for 
> Mnesia now is /var/lib/rabbitmq and I want that to change that to 
> /dev/sda1.
>
> I am using RHEL as the Operating system.
>
> Can you please help me on this.
>
> Thanks & Regards,
>
> _Shankar Kundargi|__HLS & G Vertical_
>
> HP Enterprise Services,BAS India center
>
> 39/40 Hewlett Packard Avenue
>
> Electronics City phase I, Bangalore, India 560100
>
> (+91 80 26132098   [office]
>
> "Deserve before you Desire"
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
On RPM based distributions (CentOS, Fedora, OpenSUSE, Red Hat, etc) you 
can edit your settings on
the /etc/rabbitmq/rabbitmq.conf file and change the RABBITMQ_MNESIA_BASE 
variable for your directory

You can additionally set NODE_COUNT in /etc/sysconfig/rabbitmq to define 
the number of nodes to
run on a single machine.

Regards


-- 
Marcos Luis Ortiz Valmaseda
  Software Engineer (Distributed Systems)
  http://uncubanitolinuxero.blogspot.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110526/fea7db72/attachment.htm>

From simon at rabbitmq.com  Fri May 27 00:04:09 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 27 May 2011 00:04:09 +0100
Subject: [rabbitmq-discuss] Journaling for RabbitMQ?
In-Reply-To: <BANLkTikFaU-nVqWueBWYk_iam2Tz7cBNbg@mail.gmail.com>
References: <BANLkTikFaU-nVqWueBWYk_iam2Tz7cBNbg@mail.gmail.com>
Message-ID: <4DDEDC69.1060806@rabbitmq.com>

On 26/05/2011 7:55PM, Meredith Gregory wrote:
> i was working with a client recently and they asked whether RabbitMQ had
> a journaling feature. The client was used to working with MSMQ which has
> such a feature and allows them to get a view of queue usage history,
> such as message deposited to queue, message read from queue, etc. The
> question came up in the context of debugging a message processing code
> path where we couldn't readily tell whether the message had been
> deposited to the queue and was being nabbed by a dispatcher faster than
> we could see or whether the message was never arriving at the queue at
> all. The client observed that with a journaling feature there would be
> no need to introduce more debugging statements into application code.
> So, i'm passing their question along to you.

Hi Greg.

The next release will contain a simple tracer. When turned on it sends 
information about each publish and each delivery to a special exchange. 
At the moment there's nothing to log such messages but it wouldn't be 
hard to write one and I'll probably add something to mgmt at some point.

There's also the tracer in the Java client since forever, but that's a 
bit fiddly to set up and quite low-level.

Cheers, Simon

From michael.s.klishin at gmail.com  Fri May 27 00:12:19 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 27 May 2011 03:12:19 +0400
Subject: [rabbitmq-discuss] Journaling for RabbitMQ?
In-Reply-To: <BANLkTikFaU-nVqWueBWYk_iam2Tz7cBNbg@mail.gmail.com>
References: <BANLkTikFaU-nVqWueBWYk_iam2Tz7cBNbg@mail.gmail.com>
Message-ID: <A6D3B6D784A045A58B45BC17ADAF3984@gmail.com>

Meredith Gregory escribi?:
> The question came up in the context of debugging a message processing code path where we couldn't readily tell whether the message had been deposited to the queue and was being nabbed by a dispatcher faster than we could see or whether the message was never arriving at the queue at all. The client observed that with a journaling feature there would be no need to introduce more debugging statements into application code.

Meredith,

Maybe using management plugin [1] or a little tracer tool that Java client ships with [2] can help you? I find those too invaluable during development and QA.

1. http://www.rabbitmq.com/management.html
2. http://www.rabbitmq.com/examples.html, see AMQP Protocol Capture/Analysis Tool section.
-- 
MK








From emile at rabbitmq.com  Fri May 27 09:24:09 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 27 May 2011 09:24:09 +0100
Subject: [rabbitmq-discuss] long running producer
In-Reply-To: <000501cc1bcf$7a0ec3f0$6e2c4bd0$@com>
References: <000501cc1bcf$7a0ec3f0$6e2c4bd0$@com>
Message-ID: <4DDF5FA9.1090401@rabbitmq.com>

Hi,

On 26/05/11 19:05, Rajarshi Chakravarty wrote:
> Hi,
>
> Can anyone post an example of a Producer program in Java that creates a
> connection to a queue and keeps it open infinitely?
>
> My requirement is to listen to a port and whenever data comes to it,
> send it to a Rabbit queue.
>
> There should be some recovery mechanism like if the connection gets
> broken, the program should attempt a reconnect.

It should be possible to construct a solution using the Java message 
patterns library, which implements reconnection logic:

http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/


-Emile




From jim at rabbitmq.com  Fri May 27 09:30:57 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Fri, 27 May 2011 09:30:57 +0100
Subject: [rabbitmq-discuss] long running producer
In-Reply-To: <4DDF5FA9.1090401@rabbitmq.com>
References: <000501cc1bcf$7a0ec3f0$6e2c4bd0$@com>
	<4DDF5FA9.1090401@rabbitmq.com>
Message-ID: <BANLkTikJm6Jc9mRVrZBfmmRcp9Mo6gDZNg@mail.gmail.com>

Raj,

On 27 May 2011 09:24, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
>
> On 26/05/11 19:05, Rajarshi Chakravarty wrote:
>
>> Hi,
>>
>> Can anyone post an example of a Producer program in Java that creates a
>> connection to a queue and keeps it open infinitely?
>>
>> My requirement is to listen to a port and whenever data comes to it,
>> send it to a Rabbit queue.
>>
>> There should be some recovery mechanism like if the connection gets
>> broken, the program should attempt a reconnect.
>>
>
> It should be possible to construct a solution using the Java message
> patterns library, which implements reconnection logic:
>
> http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/
>
>
> -Emile
>
>
You may also want to take a look at this:
https://github.com/joshdevins/rabbitmq-ha-client

Jim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110527/5298aad2/attachment.htm>

From rajc at myquu.com  Fri May 27 11:25:18 2011
From: rajc at myquu.com (Rajarshi Chakravarty)
Date: Fri, 27 May 2011 15:55:18 +0530
Subject: [rabbitmq-discuss] long running producer
In-Reply-To: <4DDF5FA9.1090401@rabbitmq.com>
References: <000501cc1bcf$7a0ec3f0$6e2c4bd0$@com>
	<4DDF5FA9.1090401@rabbitmq.com>
Message-ID: <000301cc1c58$623ff440$26bfdcc0$@com>

Thank you, Emile.
Java messagepatterns look very promising.
Is there a tutorial or documentation for it?

Regards,
Raj

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Friday, May 27, 2011 1:54 PM
To: Rajarshi Chakravarty
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] long running producer

Hi,

On 26/05/11 19:05, Rajarshi Chakravarty wrote:
> Hi,
>
> Can anyone post an example of a Producer program in Java that creates a
> connection to a queue and keeps it open infinitely?
>
> My requirement is to listen to a port and whenever data comes to it,
> send it to a Rabbit queue.
>
> There should be some recovery mechanism like if the connection gets
> broken, the program should attempt a reconnect.

It should be possible to construct a solution using the Java message 
patterns library, which implements reconnection logic:

http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/


-Emile




From david at rabbitmq.com  Fri May 27 12:25:40 2011
From: david at rabbitmq.com (David Wragg)
Date: Fri, 27 May 2011 12:25:40 +0100
Subject: [rabbitmq-discuss] Needed Info
In-Reply-To: <4DDED01A.1070109@uci.cu> (Marcos Ortiz's message of "Thu, 26 May
	2011 17:41:38 -0430")
References: <920C05C422F9A84CACAF9B37DD3BC4B85E2972314A@GVW1161EXB.americas.hpqcorp.net>
	<4DDED01A.1070109@uci.cu>
Message-ID: <yrv4cfwo0o05n.fsf@dwragg.eng.vmware.com>

Marcos Ortiz <mlortiz at uci.cu> writes:
> You can additionally set NODE_COUNT in /etc/sysconfig/rabbitmq to
> define the number of nodes to run on a single machine.

Not since 2.4.0.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From jon at jbrisbin.com  Fri May 27 14:15:35 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 27 May 2011 08:15:35 -0500 (CDT)
Subject: [rabbitmq-discuss] Journaling for RabbitMQ?
In-Reply-To: <BANLkTik1pyK=RLXKZ-s-EZJKNPMimfejqQ@mail.gmail.com>
Message-ID: <4fce86cc-925e-4aa4-81f9-3fb5a4f31bb7@jbrisbin.local>

If by "read" you mean "delivered to a client", then no, because exchanges don't do that sort of thing. Messages to consumers come from queues. 

But that sounds like something the client should be concerned with because, regardless of the state of messages in a queue in the broker, the client knows whether it's receiving messages or not. 

The admin client can happily report on any messages currently delivered to a queue. :) 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Meredith Gregory" <lgreg.meredith at gmail.com>
> To: "Jon Brisbin" <jon at jbrisbin.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Thursday, May 26, 2011 3:09:26 PM
> Subject: Re: [rabbitmq-discuss] Journaling for RabbitMQ?

> Dear Jon,

> Thanks! Would that also log when a message was read?

> Best wishes,

> --greg

> On Thu, May 26, 2011 at 12:26 PM, Jon Brisbin < jon at jbrisbin.com >
> wrote:

> > I suspect it would take about 30 minutes to create a special
> > journaled exchange type that simply logged every message that came
> > through to a log file. You'd need to use a custom exchange rather
> > than a built-in version. That being said, it would act just like a
> > built-in exchange type. But you probably wouldn't want to run
> > something like this in production anyway, right?
> 

> > Thanks!
> 

> > Jon Brisbin
> 
> > http// jbrisbin.com
> 

> > > From: "Meredith Gregory" < lgreg.meredith at gmail.com >
> > 
> 
> > > To: rabbitmq-discuss at lists.rabbitmq.com
> > 
> 
> > > Sent: Thursday, May 26, 2011 1:55:20 PM
> > 
> 
> > > Subject: [rabbitmq-discuss] Journaling for RabbitMQ?
> > 
> 

> > > Dear Rabbitters,
> > 
> 

> > > i was working with a client recently and they asked whether
> > > RabbitMQ
> > > had a journaling feature. The client was used to working with
> > > MSMQ
> > > which has such a feature and allows them to get a view of queue
> > > usage history, such as message deposited to queue, message read
> > > from
> > > queue, etc. The question came up in the context of debugging a
> > > message processing code path where we couldn't readily tell
> > > whether
> > > the message had been deposited to the queue and was being nabbed
> > > by
> > > a dispatcher faster than we could see or whether the message was
> > > never arriving at the queue at all. The client observed that with
> > > a
> > > journaling feature there would be no need to introduce more
> > > debugging statements into application code. So, i'm passing their
> > > question along to you.
> > 
> 

> > > In this connection i will raise a point i've made before to this
> > > community. With such a journaling log i can take off-the-shelf
> > > tools
> > > and probe message traces for correctness properties.
> > > Specifically,
> > > i
> > > have already demonstrated with a little project called XTrace
> > > that
> > > with an xml-based message history format we can use schema
> > > conformance to probe message trace for properties. The basic idea
> > > is
> > > to encode a property as a schema. The beauty of this approach is
> > > that it is post facto and does not require a specific schema to
> > > govern message trace history. Rather, an application programmer
> > > devises schema to investigate the message trace history to look
> > > for
> > > conformance to protocol or validate a guess about where/how
> > > things
> > > might be going awry.
> > 
> 

> > > i mention this latter point in connection with the client's
> > > question
> > > to amplify the argument for the feature. Their sense of the
> > > separation of concerns and independent value for RabbitMQ is
> > > right
> > > on track and only the tip of the iceberg of what can be done.
> > 
> 

> > > Best wishes,
> > 
> 

> > > --greg
> > 
> 

> > > --
> > 
> 
> > > L.G. Meredith
> > 
> 
> > > Managing Partner
> > 
> 
> > > Biosimilarity LLC
> > 
> 
> > > 7329 39th Ave SW
> > 
> 
> > > Seattle, WA 98136
> > 
> 

> > > +1 206.650.3740
> > 
> 

> > > http://biosimilarity.blogspot.com
> > 
> 

> > > _______________________________________________
> > 
> 
> > > rabbitmq-discuss mailing list
> > 
> 
> > > rabbitmq-discuss at lists.rabbitmq.com
> > 
> 
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 

> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136

> +1 206.650.3740

> http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110527/0046e177/attachment.htm>

From david_syer at hotmail.com  Fri May 27 16:27:56 2011
From: david_syer at hotmail.com (Dave Syer)
Date: Fri, 27 May 2011 08:27:56 -0700 (PDT)
Subject: [rabbitmq-discuss] long running producer
In-Reply-To: <000301cc1c58$623ff440$26bfdcc0$@com>
References: <000501cc1bcf$7a0ec3f0$6e2c4bd0$@com>
	<4DDF5FA9.1090401@rabbitmq.com>
	<000301cc1c58$623ff440$26bfdcc0$@com>
Message-ID: <a1283f35-2e87-4e93-adfd-85a24f9d06d6@y12g2000yqh.googlegroups.com>

Spring AMQP (http://github.com/SpringSource/spring-amqp) also has
reconnection features in Java (and eventually in .NET when that code
catches up).

From james.r.carr at gmail.com  Fri May 27 21:45:58 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 27 May 2011 15:45:58 -0500
Subject: [rabbitmq-discuss] Dead Letter Channel?
In-Reply-To: <4DE00B80.1080200@rabbitmq.com>
References: <BANLkTi=EJsnQu7JTkOvrpy3bQG+Ap-DRtA@mail.gmail.com>
	<4DDCF7D9.2000509@rabbitmq.com>
	<BANLkTimxC9Pm-Q3fat8rNs1TTBVjOU1PaQ@mail.gmail.com>
	<4DE00B80.1080200@rabbitmq.com>
Message-ID: <BANLkTi=Vw9x8vaj8uD59ROGpQE7HpG5hgA@mail.gmail.com>

So is there a good way to handle clients that can't understand a
message they recieve? Ideally this is more of a programmer mistake
rather than application behavior and should be handled by the teams
that maintain that code but just curious if there is a good abstract
way to store that message for later processing.

Thanks,
James


On Fri, May 27, 2011 at 3:37 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> James,
>
> James Carr wrote:
>>
>> For now would an appropriate way to handle this be to just attach a
>> ReturnListener on each publisher and have those publish to a
>> designated "dead letter" queue?
>
> No, since returns are triggered by unroutable *publishes* and have nothing
> to do with *consumers* rejecting messages / dying when processing them.
>
> Regards,
>
> Matthias.
> PS: next time, please mail the list.
>

From matthias at rabbitmq.com  Fri May 27 21:52:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 27 May 2011 21:52:48 +0100
Subject: [rabbitmq-discuss] Dead Letter Channel?
In-Reply-To: <BANLkTi=Vw9x8vaj8uD59ROGpQE7HpG5hgA@mail.gmail.com>
References: <BANLkTi=EJsnQu7JTkOvrpy3bQG+Ap-DRtA@mail.gmail.com>	<4DDCF7D9.2000509@rabbitmq.com>	<BANLkTimxC9Pm-Q3fat8rNs1TTBVjOU1PaQ@mail.gmail.com>	<4DE00B80.1080200@rabbitmq.com>
	<BANLkTi=Vw9x8vaj8uD59ROGpQE7HpG5hgA@mail.gmail.com>
Message-ID: <4DE00F20.4070102@rabbitmq.com>

James,

James Carr wrote:
> So is there a good way to handle clients that can't understand a
> message they recieve? Ideally this is more of a programmer mistake
> rather than application behavior and should be handled by the teams
> that maintain that code but just curious if there is a good abstract
> way to store that message for later processing.

Get the client that is rejecting the message to post it to a special 
queue from where it can be picked up later.

This requires code in the app / client lib and doesn't work if the 
message crashes the app. Hence the desire to get the broker to take care 
of re-routing these messages automagically.

Regards,

Matthias.

From iusable at gmail.com  Fri May 27 22:05:27 2011
From: iusable at gmail.com (Diya C)
Date: Sat, 28 May 2011 02:35:27 +0530
Subject: [rabbitmq-discuss] n00b: Install RabbitMQ 2.4.1 on SliceHost Ubuntu
	10.04 & PHP 5
Message-ID: <BANLkTikNX7MeDpytq2MaMHYGKWBSX549sg@mail.gmail.com>

Hello
I am absolutely convinced RabbitMQ is the right tool for my new startup.

Is there any chance we could get a quick and dirty guide to get it up and
running with Slicehost + Ubuntu 10.04 + PHP 5? My HUGE startup (read 2
believers, including me) would thank you immensely!

Thank you.
--
Regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110528/f8be894a/attachment-0001.htm>

From michael.s.klishin at gmail.com  Fri May 27 22:10:07 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 28 May 2011 01:10:07 +0400
Subject: [rabbitmq-discuss] n00b: Install RabbitMQ 2.4.1 on SliceHost
 Ubuntu 10.04 & PHP 5
In-Reply-To: <BANLkTikNX7MeDpytq2MaMHYGKWBSX549sg@mail.gmail.com>
References: <BANLkTikNX7MeDpytq2MaMHYGKWBSX549sg@mail.gmail.com>
Message-ID: <3639F89C05D6450498C10E2645F834D5@gmail.com>


Diya C escribi?:

> Is there any chance we could get a quick and dirty guide to get it up and running with Slicehost + Ubuntu 10.04 + PHP 5? My HUGE startup (read 2 believers, including me) would thank you immensely!
I am not the right person to recommend anything php-related, but as far as the broker goes, just don't use default rabbitmq packages Ubuntu ships with. They are very old.
Use APT repository RabbitMQ team provides:

http://www.rabbitmq.com/install.html#debian
http://www.rabbitmq.com/debian.html#apt

-- 
MK

From jasonjwwilliams at gmail.com  Fri May 27 23:20:36 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 27 May 2011 16:20:36 -0600
Subject: [rabbitmq-discuss] rabbitmqctl wait
Message-ID: <BANLkTim4VBqJzDEoA-4tpAeHbhaxHrsAZA@mail.gmail.com>

Has wait been removed from rabbitmqctl?

-J

From matthias at rabbitmq.com  Sat May 28 07:57:24 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 28 May 2011 07:57:24 +0100
Subject: [rabbitmq-discuss] rabbitmqctl wait
In-Reply-To: <BANLkTim4VBqJzDEoA-4tpAeHbhaxHrsAZA@mail.gmail.com>
References: <BANLkTim4VBqJzDEoA-4tpAeHbhaxHrsAZA@mail.gmail.com>
Message-ID: <4DE09CD4.8020903@rabbitmq.com>

Jason J. W. Williams wrote:
> Has wait been removed from rabbitmqctl?

No.

From rajc at myquu.com  Sat May 28 09:29:48 2011
From: rajc at myquu.com (Rajarshi Chakravarty)
Date: Sat, 28 May 2011 13:59:48 +0530
Subject: [rabbitmq-discuss] 2 services on one machine
Message-ID: <000301cc1d11$69cf61f0$3d6e25d0$@com>

Hi,

I have an old version(1.7.2) of RabbitMQ running as a service on my machine.

I want to keep that as well as run the latest version as a service too.

Please tell how to make that happen.

I guess the rabbitmq-service.bat file will have to be changed.

 

Regards,

Raj

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110528/c3617a6e/attachment.htm>

From harvey.robin at gmail.com  Sat May 28 12:47:56 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Sat, 28 May 2011 12:47:56 +0100
Subject: [rabbitmq-discuss] n00b: Install RabbitMQ 2.4.1 on SliceHost
 Ubuntu 10.04 & PHP 5
In-Reply-To: <BANLkTikNX7MeDpytq2MaMHYGKWBSX549sg@mail.gmail.com>
References: <BANLkTikNX7MeDpytq2MaMHYGKWBSX549sg@mail.gmail.com>
Message-ID: <BANLkTi=GsiKNvXoJpDVPKyT9v+qZqD6DJA@mail.gmail.com>

Hi Diya,

For the PHP side of things you could read the documentation of my PHP 5.3
Amqp library:

https://github.com/BraveSirRobin/amqphp/wiki/Documentation

It doesn't cover installing RMQ, but it does cover some of the basic of Amqp
and using this with PHP.

HTH.
--Robin

On Fri, May 27, 2011 at 10:05 PM, Diya C <iusable at gmail.com> wrote:

> Hello
> I am absolutely convinced RabbitMQ is the right tool for my new startup.
>
> Is there any chance we could get a quick and dirty guide to get it up and
> running with Slicehost + Ubuntu 10.04 + PHP 5? My HUGE startup (read 2
> believers, including me) would thank you immensely!
>
> Thank you.
> --
> Regards
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110528/434cf4a7/attachment.htm>

From rabbitmq at smetj.net  Sat May 28 18:22:36 2011
From: rabbitmq at smetj.net (Js)
Date: Sat, 28 May 2011 18:22:36 +0100
Subject: [rabbitmq-discuss] Message destined for 1 consumer of a group.
Message-ID: <445c6bce730a25def262433feb31a96a@mail.smetj.net>

 Hi list,

 Would it be possible to send a message to a group of consumers and the 
 consumer of that group who responds first gets the message and the rest 
 not? All consumers of that group a treated equal so it doesn't matter 
 who it is.
 What would be the best approach to this kind of setup?

 Cheers,

 Jay


From videlalvaro at gmail.com  Sat May 28 20:12:50 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 28 May 2011 21:12:50 +0200
Subject: [rabbitmq-discuss] Message destined for 1 consumer of a group.
In-Reply-To: <445c6bce730a25def262433feb31a96a@mail.smetj.net>
References: <445c6bce730a25def262433feb31a96a@mail.smetj.net>
Message-ID: <D0765B7C-4922-42A0-B7D3-626460D90292@gmail.com>

Hi,

I think what you need is the following:

- Bind a queue to a direct exchange.
- Publish messages to that direct exchange.
- Subscribe or "basic.consume" many consumers to that queue. 

RabbitMQ will take care of "round robin" messages to your consumers.

I think this example should help you too: http://www.rabbitmq.com/tutorials/tutorial-two-python.html

Cheers,

-Alvaro

On May 28, 2011, at 7:22 PM, Js wrote:

> Hi list,
> 
> Would it be possible to send a message to a group of consumers and the consumer of that group who responds first gets the message and the rest not? All consumers of that group a treated equal so it doesn't matter who it is.
> What would be the best approach to this kind of setup?
> 
> Cheers,
> 
> Jay
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From kuleshovmail at gmail.com  Mon May 30 12:42:34 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Mon, 30 May 2011 11:42:34 +0000
Subject: [rabbitmq-discuss] Build rabbitmq-server-2.4.1 from source problem
Message-ID: <BANLkTi=QKUbU17Yvp9e22nuwkyEgFrzZ_g@mail.gmail.com>

Hello,

I try to build rabbitmq-server-2.4.1 from source. But get error:

make
python codegen.py body codegen/amqp-rabbitmq-0.9.1.json
src/rabbit_framing_amqp_0_9_1.erl
Traceback (most recent call last):
  File "codegen.py", line 492, in <module>
    "body": generateErl})
  File "codegen/amqp_codegen.py", line 283, in do_main_dict
    execute(funcDict[function], sources, dest)
  File "codegen/amqp_codegen.py", line 262, in execute
    fn(amqp_specs)
  File "codegen.py", line 485, in generateErl
    genErl(AmqpSpec(specPath))
  File "codegen/amqp_codegen.py", line 140, in __init__
    self.major = self.spec['major-version']
KeyError: 'major-version'
make: *** No rule to make target `deps.mk', needed by
`ebin/bpqueue.beam'.  Stop.

I use python 2.7.1

Thank you.

From dhinesh.ravi at gmail.com  Mon May 30 13:49:47 2011
From: dhinesh.ravi at gmail.com (Dhinesh Kumar)
Date: Mon, 30 May 2011 18:19:47 +0530
Subject: [rabbitmq-discuss] maximum number of amqp connections to a rabbitmq
	broker
Message-ID: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>

Hi,

I am trying to find the maximum number of amqp connections i can establish
with a RabbitMQ broker running on Ubuntu.
I tried both Java and erlang client to create connections but i could not
succeed more than 829 connections.

I like to know how can i increase the number ??

Thanks in advance,
Dhinesh Kumar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110530/6d53b710/attachment.htm>

From matthew at rabbitmq.com  Mon May 30 15:14:59 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 30 May 2011 15:14:59 +0100
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>
Message-ID: <20110530141459.GA4152@wellquite.org>

On Mon, May 30, 2011 at 06:19:47PM +0530, Dhinesh Kumar wrote:
> I am trying to find the maximum number of amqp connections i can establish
> with a RabbitMQ broker running on Ubuntu.
> I tried both Java and erlang client to create connections but i could not
> succeed more than 829 connections.
> 
> I like to know how can i increase the number ??

You're likely hitting the ulimit. Edit /etc/security/limits.conf and
allow the rabbitmq user to have a much higher "nofile" setting. Rabbit
will log on start up how many sockets it's permitting, so once the
change has taken effect and you've restarted rabbit, you should find log
entries to demonstrate it's working.

Matthew

From mlortiz at uci.cu  Mon May 30 15:53:33 2011
From: mlortiz at uci.cu (Marcos Ortiz)
Date: Mon, 30 May 2011 10:23:33 -0430
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>
Message-ID: <4DE3AF6D.7050501@uci.cu>

On 05/30/2011 08:19 AM, Dhinesh Kumar wrote:
> Hi,
>
> I am trying to find the maximum number of amqp connections i can 
> establish with a RabbitMQ broker running on Ubuntu.
> I tried both Java and erlang client to create connections but i could 
> not succeed more than 829 connections.
>
> I like to know how can i increase the number ??
>
> Thanks in advance,
> Dhinesh Kumar
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
Can you share with us your RabbitMQ server configuration?
On the RabbitMQ FAQs(http://www.rabbitmq.com/faq.html), you can
find good points about these topics on the Performance, Scability & 
Clustering?s section
The number of concurrent connections that RabbitMQ can support depends 
in theory of the operating
system, in this case: Ubuntu. For this reason, you can search 
information about the Linux Network Stack and How you can
improve its performance? The main file for these changes is sysctl.conf, 
but, first, search information before to do any change
there.
A really good resource about it is: 
http://www.psc.edu/networking/projects/tcptune/
and this https://calomel.org/network_performance.html

Regards

-- 
Marcos Luis Ortiz Valmaseda
  Software Engineer (Distributed Systems)
  http://uncubanitolinuxero.blogspot.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110530/c69faa9b/attachment.htm>

From chrisch at ecollege.com  Tue May 31 00:12:23 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Mon, 30 May 2011 23:12:23 +0000
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <20110530141459.GA4152@wellquite.org>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>,
	<20110530141459.GA4152@wellquite.org>
Message-ID: <1C7E61787A08F34BBBBD9E7A7CBC368B0A30E8BE@EXMB02OSG.eclg.org>

Hi Dhinesh.

> Matthew Sackman [matthew at rabbitmq.com]
> Sent: Monday, May 30, 2011 8:14 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] maximum number of amqp connections to a rabbitmq broker
> 
> On Mon, May 30, 2011 at 06:19:47PM +0530, Dhinesh Kumar wrote:
> > I am trying to find the maximum number of amqp connections i can establish
> > with a RabbitMQ broker running on Ubuntu.
> > I tried both Java and erlang client to create connections but i could not
> > succeed more than 829 connections.
> >
> > I like to know how can i increase the number ??

> You're likely hitting the ulimit. Edit /etc/security/limits.conf and
> allow the rabbitmq user to have a much higher "nofile" setting. Rabbit
> will log on start up how many sockets it's permitting, so once the
> change has taken effect and you've restarted rabbit, you should find log
> entries to demonstrate it's working.

Assuming the connections are all coming from a single client machine, you'll also have to do complimentary tuning on the client side.  Increase the ulimit if the client is unix-based, and on any OS increase the ephemeral port range to be more than the number of connections you are targeting.

Also, if your client is Java-based then you'll need to tune the memory and Garbage Collection settings so that your client JVM can manage the connections.  Java reserves several KB of memory per socket connection...which means you'll run out of memory in a JVM with standard settings before you max out the Rabbit service (after ulimit is set per Matthew's suggestion, of course).

-Chris 

From Matthew.Barry at bksv.com  Tue May 31 03:17:46 2011
From: Matthew.Barry at bksv.com (Matthew Barry)
Date: Tue, 31 May 2011 04:17:46 +0200
Subject: [rabbitmq-discuss] Problem building rabbitmq on FreeBSD
Message-ID: <3D29FD2D0C115645B9DA43DCC4D9A01F013CDB43@dkmail01.bkogc.com>

I am trying to build version 2.4.1 on Freebsd. I get the following error

 

erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
src/rabbit_networking.erl

src/rabbit_networking.erl:49: type hostname() undefined

src/rabbit_networking.erl:71: type ip_port() undefined

gmake: *** [ebin/rabbit_networking.beam] Error 1

template10# gmake

erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
src/rabbit_networking.erl

src/rabbit_networking.erl:49: type hostname() undefined

src/rabbit_networking.erl:71: type ip_port() undefined

gmake: *** [ebin/rabbit_networking.beam] Error 1

 

 

Does anyone know how to resolve this issue?

 

 

 

Matthew


This e-mail is confidential and may be read, copied and used only by the intended recipient. If you have received it in error, please contact the sender immediately by return e-mail. Please then delete the e-mail and do not disclose its contents to any other person.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/65deb08e/attachment-0001.htm>

From mlortiz at uci.cu  Tue May 31 04:43:47 2011
From: mlortiz at uci.cu (Marcos Ortiz)
Date: Mon, 30 May 2011 23:43:47 -0400
Subject: [rabbitmq-discuss] Problem building rabbitmq on FreeBSD
In-Reply-To: <3D29FD2D0C115645B9DA43DCC4D9A01F013CDB43@dkmail01.bkogc.com>
References: <3D29FD2D0C115645B9DA43DCC4D9A01F013CDB43@dkmail01.bkogc.com>
Message-ID: <4DE463F3.7070306@uci.cu>

El 5/30/2011 10:17 PM, Matthew Barry escribi?:
>
> I am trying to build version 2.4.1 on Freebsd. I get the following error
>
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin 
> src/rabbit_networking.erl
>
> src/rabbit_networking.erl:49: type hostname() undefined
>
> src/rabbit_networking.erl:71: type ip_port() undefined
>
> gmake: *** [ebin/rabbit_networking.beam] Error 1
>
> template10# gmake
>
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin 
> src/rabbit_networking.erl
>
> src/rabbit_networking.erl:49: type hostname() undefined
>
> src/rabbit_networking.erl:71: type ip_port() undefined
>
> gmake: *** [ebin/rabbit_networking.beam] Error 1
>
> Does anyone know how to resolve this issue?
>
> Matthew
>
> ------------------------------------------------------------------------
> This e-mail is confidential and may be read, copied and used only by 
> the intended recipient. If you have received it in error, please 
> contact the sender immediately by return e-mail. Please then delete 
> the e-mail and do not disclose its contents to any other person.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
Which version of Erlang did you use?

-- 
Marcos Lu?s Ort?z Valmaseda
  Software Engineer (Large-Scaled Distributed Systems)
  University of Information Sciences,
  La Habana, Cuba
  Linux User # 418229
  http://about.me/marcosortiz

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110530/e22b3032/attachment.htm>

From Matthew.Barry at bksv.com  Tue May 31 05:12:08 2011
From: Matthew.Barry at bksv.com (Matthew Barry)
Date: Tue, 31 May 2011 06:12:08 +0200
Subject: [rabbitmq-discuss] Problem building rabbitmq on FreeBSD
In-Reply-To: <4DE463F3.7070306@uci.cu>
References: <3D29FD2D0C115645B9DA43DCC4D9A01F013CDB43@dkmail01.bkogc.com>
	<4DE463F3.7070306@uci.cu>
Message-ID: <3D29FD2D0C115645B9DA43DCC4D9A01F013CDB7E@dkmail01.bkogc.com>

The source is otp_src_R14B03.tar.gz

 

 

Matthew

 

________________________________

From: Marcos Ortiz [mailto:mlortiz at uci.cu] 
Sent: Tuesday, 31 May 2011 1:44 PM
To: Matthew Barry
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Problem building rabbitmq on FreeBSD

 

El 5/30/2011 10:17 PM, Matthew Barry escribi?: 

I am trying to build version 2.4.1 on Freebsd. I get the following error

 

erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_networking.erl

src/rabbit_networking.erl:49: type hostname() undefined

src/rabbit_networking.erl:71: type ip_port() undefined

gmake: *** [ebin/rabbit_networking.beam] Error 1

template10# gmake

erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_networking.erl

src/rabbit_networking.erl:49: type hostname() undefined

src/rabbit_networking.erl:71: type ip_port() undefined

gmake: *** [ebin/rabbit_networking.beam] Error 1

 

 

Does anyone know how to resolve this issue?

 

 

 

Matthew

________________________________

This e-mail is confidential and may be read, copied and used only by the intended recipient. If you have received it in error, please contact the sender immediately by return e-mail. Please then delete the e-mail and do not disclose its contents to any other person.



 
 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
  

Which version of Erlang did you use?




-- 
Marcos Lu?s Ort?z Valmaseda
 Software Engineer (Large-Scaled Distributed Systems)
 University of Information Sciences,
 La Habana, Cuba
 Linux User # 418229
 http://about.me/marcosortiz 

This e-mail is confidential and may be read, copied and used only by the intended recipient. If you have received it in error, please contact the sender immediately by return e-mail. Please then delete the e-mail and do not disclose its contents to any other person.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/83a7ea42/attachment.htm>

From jim at rabbitmq.com  Tue May 31 08:56:18 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Tue, 31 May 2011 08:56:18 +0100
Subject: [rabbitmq-discuss] n00b: Install RabbitMQ 2.4.1 on SliceHost
 Ubuntu 10.04 & PHP 5
In-Reply-To: <BANLkTi=GsiKNvXoJpDVPKyT9v+qZqD6DJA@mail.gmail.com>
References: <BANLkTikNX7MeDpytq2MaMHYGKWBSX549sg@mail.gmail.com>
	<BANLkTi=GsiKNvXoJpDVPKyT9v+qZqD6DJA@mail.gmail.com>
Message-ID: <BANLkTi=hhRPtO78Stq-CVaSGgzxHNM4zRg@mail.gmail.com>

Diya,

Once you are up and running, you might want to take a look at the PHP
version of of the getting started tutorial code:
https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php

There are more PHP goodies are listed at:
http://www.rabbitmq.com/devtools.html#php-dev<http://rabbit-web-stage.eng.vmware.com/devtools.html#php-dev>

Jim


On 28 May 2011 12:47, Robin Harvey <harvey.robin at gmail.com> wrote:

> Hi Diya,
>
> For the PHP side of things you could read the documentation of my PHP 5.3
> Amqp library:
>
> https://github.com/BraveSirRobin/amqphp/wiki/Documentation
>
> It doesn't cover installing RMQ, but it does cover some of the basic of
> Amqp and using this with PHP.
>
> HTH.
> --Robin
>
> On Fri, May 27, 2011 at 10:05 PM, Diya C <iusable at gmail.com> wrote:
>
>> Hello
>> I am absolutely convinced RabbitMQ is the right tool for my new startup.
>>
>> Is there any chance we could get a quick and dirty guide to get it up and
>> running with Slicehost + Ubuntu 10.04 + PHP 5? My HUGE startup (read 2
>> believers, including me) would thank you immensely!
>>
>> Thank you.
>> --
>> Regards
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/75907058/attachment-0001.htm>

From matthew at rabbitmq.com  Tue May 31 09:13:02 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 31 May 2011 09:13:02 +0100
Subject: [rabbitmq-discuss] Problem building rabbitmq on FreeBSD
In-Reply-To: <3D29FD2D0C115645B9DA43DCC4D9A01F013CDB7E@dkmail01.bkogc.com>
References: <3D29FD2D0C115645B9DA43DCC4D9A01F013CDB43@dkmail01.bkogc.com>
	<4DE463F3.7070306@uci.cu>
	<3D29FD2D0C115645B9DA43DCC4D9A01F013CDB7E@dkmail01.bkogc.com>
Message-ID: <20110531081301.GA2459@rabbitmq.com>

On Tue, May 31, 2011 at 06:12:08AM +0200, Matthew Barry wrote:
> The source is otp_src_R14B03.tar.gz

As I wrote to the list the day R14B03 came out, 2.4.1 will not build
with R14B03. Either build the latest from our hg repos, or make sure you
set USE_SPECS to false - something like "make USE_SPECS=false" should do
the trick.

Matthew

From emile at rabbitmq.com  Tue May 31 10:33:38 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 31 May 2011 10:33:38 +0100
Subject: [rabbitmq-discuss] 2 services on one machine
In-Reply-To: <000301cc1d11$69cf61f0$3d6e25d0$@com>
References: <000301cc1d11$69cf61f0$3d6e25d0$@com>
Message-ID: <4DE4B5F2.2020001@rabbitmq.com>

Hi Raj,

On 28/05/11 09:29, Rajarshi Chakravarty wrote:
> Hi,
>
> I have an old version(1.7.2) of RabbitMQ running as a service on my
> machine.

You should consider upgrading.

> I want to keep that as well as run the latest version as a service
> too.
>
> Please tell how to make that happen.
>
> I guess the rabbitmq-service.bat file will have to be changed.

This is possible, but it's easier to do by setting environment variables 
rather than editing the .bat files. You will need to make sure that at 
least the  service name (RABBITMQ_SERVICENAME) node name 
(RABBITMQ_NODENAME) and port (RABBITMQ_NODE_PORT) are set to values that 
are different from the existing service. The hidden 
"rabbitmq-service.bat list" command can help you make sure the values 
are all different.

Version 1.7.2 is very old. In fact it is so old that recent (R14B0*) 
versions of Erlang are no longer compatible with the compiled .beam 
format, so you will need to install the version 1.7.2 service to use an 
old enough version of Erlang. The two rabbit services do not need to be 
running on the same version of Erlang.



-Emile

From jim at rabbitmq.com  Tue May 31 10:40:47 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Tue, 31 May 2011 10:40:47 +0100
Subject: [rabbitmq-discuss] n00b: Install RabbitMQ 2.4.1 on SliceHost
 Ubuntu 10.04 & PHP 5
In-Reply-To: <BANLkTi=hhRPtO78Stq-CVaSGgzxHNM4zRg@mail.gmail.com>
References: <BANLkTikNX7MeDpytq2MaMHYGKWBSX549sg@mail.gmail.com>
	<BANLkTi=GsiKNvXoJpDVPKyT9v+qZqD6DJA@mail.gmail.com>
	<BANLkTi=hhRPtO78Stq-CVaSGgzxHNM4zRg@mail.gmail.com>
Message-ID: <BANLkTinRZm_GFGspEobeG5NwgyKc-kOZwQ@mail.gmail.com>

On 31 May 2011 08:56, Jim Apperly <jim at rabbitmq.com> wrote:

> Diya,
>
> Once you are up and running, you might want to take a look at the PHP
> version of of the getting started tutorial code:
> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php
>
> There are more PHP goodies are listed at:
> http://www.rabbitmq.com/devtools.html#php-dev<http://rabbit-web-stage.eng.vmware.com/devtools.html#php-dev>
>


Oops. That second link should have been
http://www.rabbitmq.com/devtools.html#php-dev.

Jim





>
> On 28 May 2011 12:47, Robin Harvey <harvey.robin at gmail.com> wrote:
>
>> Hi Diya,
>>
>> For the PHP side of things you could read the documentation of my PHP 5.3
>> Amqp library:
>>
>> https://github.com/BraveSirRobin/amqphp/wiki/Documentation
>>
>> It doesn't cover installing RMQ, but it does cover some of the basic of
>> Amqp and using this with PHP.
>>
>> HTH.
>> --Robin
>>
>> On Fri, May 27, 2011 at 10:05 PM, Diya C <iusable at gmail.com> wrote:
>>
>>> Hello
>>> I am absolutely convinced RabbitMQ is the right tool for my new startup.
>>>
>>> Is there any chance we could get a quick and dirty guide to get it up and
>>> running with Slicehost + Ubuntu 10.04 + PHP 5? My HUGE startup (read 2
>>> believers, including me) would thank you immensely!
>>>
>>> Thank you.
>>> --
>>> Regards
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/57fbf96f/attachment.htm>

From Kotreshi_Chikkabidari at mindtree.com  Tue May 31 10:48:03 2011
From: Kotreshi_Chikkabidari at mindtree.com (Kotreshi Chikkabidari)
Date: Tue, 31 May 2011 09:48:03 +0000
Subject: [rabbitmq-discuss] Failed to Connect Rabbitmq endpoint
Message-ID: <4FA68B7495F3C44487DB72B8762B1CD4260ECE@MTW02MBX05.mindtree.com>

Hi ,

We are facing problem when we try to reconnect the rabbitmq end point.
Please see the logs below.

31-May 13:55:28,323 [ERROR] [  ResponseToInsert.5] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: connection error; reason: {#method<connection.close>(reply-code=530,reply-text=NOT_ALLOWED - parameters for queue 'ACC_UidInsertRspQ' in vhost '/' not equivalent,class-id=50,method-id=10),null,""}. Type: class com.rabbitmq.client.ShutdownSignalException
31-May 13:55:28,768 [ INFO] [  ResponseToInsert.6] [      org.mule.transport.rabbitmq.RabbitDispatcher] - AlreadyClosedException occured clean connection shutdown; reason: Attempt to use closed connection
31-May 13:55:28,769 [ INFO] [  ResponseToInsert.6] [       org.mule.transport.rabbitmq.RabbitConnector] - Error closing existing Connection instance. Continuing by marking Connection instance as null. Error is : clean connection shutdown; reason: Attempt to use closed connection
31-May 13:55:43,610 [ERROR] [  ResponseToInsert.2] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: null. Type: class java.lang.NullPointerException
31-May 13:55:57,757 [ERROR] [  ResponseToInsert.3] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: null. Type: class java.lang.NullPointerException
31-May 13:55:57,765 [ERROR] [  ResponseToInsert.4] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: null. Type: class java.lang.NullPointerException
31-May 13:55:58,327 [ERROR] [  ResponseToInsert.5] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: null. Type: class java.lang.NullPointerException
31-May 13:55:58,778 [ INFO] [  ResponseToInsert.6] [      org.mule.transport.rabbitmq.RabbitDispatcher] - Reconnect with Rabbit instance successful
31-May 13:55:58,778 [ INFO] [  ResponseToInsert.6] [      org.mule.transport.rabbitmq.RabbitDispatcher] - Before getting the channel and queue declarations
31-May 13:55:58,781 [ERROR] [  ResponseToInsert.6] [      org.mule.transport.rabbitmq.RabbitDispatcher] - Exception occured in doConnect...java.io.IOException
31-May 13:55:58,782 [ERROR] [  ResponseToInsert.6] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: connection error; reason: {#method<connection.close>(reply-code=530,reply-text=NOT_ALLOWED - parameters for queue 'ACC_UidInsertRspQ' in vhost '/' not equivalent,class-id=50,method-id=10),null,""}. Type: class com.rabbitmq.client.ShutdownSignalException
31-May 13:56:13,612 [ INFO] [  ResponseToInsert.2] [      org.mule.transport.rabbitmq.RabbitDispatcher] - AlreadyClosedException occured clean connection shutdown; reason: Attempt to use closed connection
31-May 13:56:13,614 [ INFO] [  ResponseToInsert.2] [       org.mule.transport.rabbitmq.RabbitConnector] - Error closing existing Connection instance. Continuing by marking Connection instance as null. Error is : clean connection shutdown; reason: Attempt to use closed connection
31-May 13:56:27,762 [ERROR] [  ResponseToInsert.3] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: null. Type: class java.lang.NullPointerException
31-May 13:56:27,769 [ERROR] [  ResponseToInsert.4] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: null. Type: class java.lang.NullPointerException
31-May 13:56:28,332 [ERROR] [  ResponseToInsert.5] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: null. Type: class java.lang.NullPointerException
31-May 13:56:28,786 [ERROR] [  ResponseToInsert.6] [          org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UidInsertRspQ&replyToExchange. Root Exception was: null. Type: class java.lang.NullPointerException


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/d483bbae/attachment-0001.htm>

From matthew at rabbitmq.com  Tue May 31 10:59:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 31 May 2011 10:59:35 +0100
Subject: [rabbitmq-discuss] Build rabbitmq-server-2.4.1 from source
 problem
In-Reply-To: <BANLkTi=QKUbU17Yvp9e22nuwkyEgFrzZ_g@mail.gmail.com>
References: <BANLkTi=QKUbU17Yvp9e22nuwkyEgFrzZ_g@mail.gmail.com>
Message-ID: <20110531095934.GA3224@rabbitmq.com>

On Mon, May 30, 2011 at 11:42:34AM +0000, Alexander Kuleshov wrote:
> I use python 2.7.1

I suspect that may be the problem. Try a 2.6.

Matthew

From emile at rabbitmq.com  Tue May 31 11:21:42 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 31 May 2011 11:21:42 +0100
Subject: [rabbitmq-discuss] Failed to Connect Rabbitmq endpoint
In-Reply-To: <4FA68B7495F3C44487DB72B8762B1CD4260ECE@MTW02MBX05.mindtree.com>
References: <4FA68B7495F3C44487DB72B8762B1CD4260ECE@MTW02MBX05.mindtree.com>
Message-ID: <4DE4C136.6030702@rabbitmq.com>

Hi Kotreshi,

On 31/05/11 10:48, Kotreshi Chikkabidari wrote:
> reply-text=NOT_ALLOWED - parameters for queue 'ACC_UidInsertRspQ' in
> vhost '/' not equivalent,class-id=50,method-id=10),null,""}

You are getting this error because a queue with the same name already 
exists on the broker, but with different parameters. See the description 
of the passive flag in the queue declare documentation:

"""
...the server MUST check that the existing queue has the same values for 
durable, exclusive, auto-delete, and arguments fields. The server MUST 
respond with Declare-Ok if the requested queue matches these fields, and 
MUST raise a channel exception if not.
"""


-Emile

From alexis at rabbitmq.com  Tue May 31 12:41:21 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 31 May 2011 12:41:21 +0100
Subject: [rabbitmq-discuss] Perl Net::RabbitMQ and failure conditions
In-Reply-To: <BANLkTim==hb=hDLCqEN=0J5vfbHQN14BOw@mail.gmail.com>
References: <BANLkTim==hb=hDLCqEN=0J5vfbHQN14BOw@mail.gmail.com>
Message-ID: <BANLkTi=BKveXBFiObCUDCvUcAhx3-8Oyrg@mail.gmail.com>

Ronald

Were you able to find an answer to this?

alexis



On Thu, May 19, 2011 at 9:44 PM, Ronald J Kimball
<rkimball at pangeamedia.com> wrote:
> I'm trying to understand how RabbitMQ behaves under failure conditions,
> specifically when using the Net::RabbitMQ Perl module.
>
> We have RabbitMQ set up with three nodes, one on the backend, which holds
> the actual queues, and two on the frontend, which receive publish requests.
>
> RabbitMQ 2.2.0
> Net::RabbitMQ 0.1.8
>
>
> Below is the chart of behaviors that I have observed.
>
> "+" means the behavior is as I expected: either the message is successfully
> queued, or an error is thrown.
> "-" means the behavior is not as I expected, but can be managed:
> specifically, the process receives a SIGPIPE, which I can trap and recover
> from.
> "!" means the behavior is not as I expected, and cannot be managed: the
> message is not queued but no error is thrown and/or the process hangs.
>
> "App down" means I ran `rabbitmqctl stop_app`.? "Daemon down" means I ran
> `rabbitmqctl stop`.
>
> ? As publishing process starts up:
>
> ??? Remote daemon up, app up
> ????? + Everything okay
>
> ??? Remote daemon up, app down
> ????? ! Net::RabbitMQ hangs when declaring queue
>
> ??? Remote daemon down
> ????? + Net::RabbitMQ throws error when declaring queue
> ??????? "Declaring queue: server channel error 404, message: NOT_FOUND - no
> queue 'test' in vhost '/'"
>
> ??? Local daemon up, app down
> ????? + Net::RabbitMQ throws error when connecting
> ??????? "Opening socket: Connection refused"
>
> ??? Local daemon down
> ????? + Net::RabbitMQ throws error when connecting
> ??????? "Opening socket: Connection refused"
>
>
> ? After publishing process starts up:
>
> ??? Local app goes down
> ????? - Process receives SIGPIPE
>
> ??? Local daemon goes down
> ????? - Process receives SIGPIPE
>
> ??? Remote app goes down
> ????? ! Net::RabbitMQ falsely indicates success when publishing, then hangs
> (in DESTROY?)
>
> ??? Remote daemon goes down
> ????? ! Net::RabbitMQ falsely indicates success when publishing
>
>
> ??? Local app goes down, comes back up
> ????? - Process receives SIGPIPE
>
> ??? Local daemon goes down, comes back up
> ????? - Process receives SIGPIPE
>
> ??? Remote app goes down, comes back up
> ????? + Everything okay
>
> ??? Remote daemon goes down, comes back up
> ????? + Everything okay
>
>
> Have other people had these problems with Net::RabbitMQ?? Can we resolve
> these issues by changing something in our RabbitMQ configuration?
>
>
> thanks,
> Ronald
>
>
> P.S. Here's my script.
>
> #!/usr/local/bin/perl
>
> use strict;
> use warnings;
>
> use Net::RabbitMQ;
>
> $| = 1;
>
> $SIG{'PIPE'} = sub { die "SIGPIPE\n" };
>
> my $mq = Net::RabbitMQ->new();
>
> alarm(10);
>
> print "Connecting\n";
> $mq->connect('localhost', { user => 'engagement', password => '********' })
> ? or die "Can't connect to RabbitMQ\n";
>
> print "Opening channel\n";
> $mq->channel_open(1);
>
> print "Declaring exchange\n";
> $mq->exchange_declare(1, 'ee_exchange', { durable => 1 });
>
> print "Declaring queue\n";
> $mq->queue_declare(1, 'test', { durable => 1 });
>
> print "Binding queue\n";
> $mq->queue_bind(1, 'test', 'ee_exchange', 'ee_test');
>
> alarm(0);
>
> print "> ";
> <>;
>
> alarm(10);
>
> print "Publishing message\n";
> my $rc =
> ? $mq->publish(1, 'ee_test', 'hello world!',
> ?????????????? { exchange => 'ee_exchange', mandatory => 1, immediate => 0
> },
> ?????????????? { delivery_mode => 2 });
> print "Result: $rc\n";
>
> __END__
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From kuleshovmail at gmail.com  Tue May 31 13:19:47 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Tue, 31 May 2011 12:19:47 +0000
Subject: [rabbitmq-discuss] Build rabbitmq-server-2.4.1 from source
	problem
In-Reply-To: <20110531095934.GA3224@rabbitmq.com>
References: <BANLkTi=QKUbU17Yvp9e22nuwkyEgFrzZ_g@mail.gmail.com>
	<20110531095934.GA3224@rabbitmq.com>
Message-ID: <BANLkTi=5K6YgyCaDMjnh5GyceJ0RhsQt_A@mail.gmail.com>

Hello,

I install python 2.6

Now i get:

make: *** No rule to make target `deps.mk', needed by
`ebin/bpqueue.beam'.  Stop.

From matthew at rabbitmq.com  Tue May 31 13:31:13 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 31 May 2011 13:31:13 +0100
Subject: [rabbitmq-discuss] Build rabbitmq-server-2.4.1 from source
 problem
In-Reply-To: <BANLkTi=5K6YgyCaDMjnh5GyceJ0RhsQt_A@mail.gmail.com>
References: <BANLkTi=QKUbU17Yvp9e22nuwkyEgFrzZ_g@mail.gmail.com>
	<20110531095934.GA3224@rabbitmq.com>
	<BANLkTi=5K6YgyCaDMjnh5GyceJ0RhsQt_A@mail.gmail.com>
Message-ID: <20110531123113.GC3224@rabbitmq.com>

On Tue, May 31, 2011 at 12:19:47PM +0000, Alexander Kuleshov wrote:
> Hello,
> 
> I install python 2.6
> 
> Now i get:
> 
> make: *** No rule to make target `deps.mk', needed by
> `ebin/bpqueue.beam'.  Stop.

Ok, are you building from our hg repos or from the source tarball?

For me, with the tarball:

matthew at hazel:~$ cd /tmp
matthew at hazel:/tmp$ wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.4.1/rabbitmq-server-2.4.1.tar.gz
--2011-05-31 13:29:40--  http://www.rabbitmq.com/releases/rabbitmq-server/v2.4.1/rabbitmq-server-2.4.1.tar.gz
Length: 324199 (317K) [application/x-gzip]
Saving to: `rabbitmq-server-2.4.1.tar.gz'

100%[=====================================================================================================================>] 324,199      182K/s   in 1.7s    

2011-05-31 13:29:42 (182 KB/s) - `rabbitmq-server-2.4.1.tar.gz' saved [324199/324199]

matthew at hazel:/tmp$ tar xzf rabbitmq-server-2.4.1.tar.gz 
matthew at hazel:/tmp$ cd rabbitmq-server-2.4.1/
matthew at hazel:/tmp/rabbitmq-server-2.4.1$ make
python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
xsltproc --stringparam modulename "`basename src/rabbit_ctl_usage.erl .erl`" \
        docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp
sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_ctl_usage.erl.tmp > src/rabbit_ctl_usage.erl.tmp2
fold -s src/rabbit_ctl_usage.erl.tmp2 > src/rabbit_ctl_usage.erl.tmp3
mv src/rabbit_ctl_usage.erl.tmp3 src/rabbit_ctl_usage.erl
rm src/rabbit_ctl_usage.erl.tmp src/rabbit_ctl_usage.erl.tmp2
python codegen.py --ignore-conflicts header codegen/amqp-rabbitmq-0.9.1.json codegen/amqp-rabbitmq-0.8.json include/rabbit_framing.hrl
rm -f deps.mk
echo src/rabbit_control.erl:src/gm_soak_test.erl:src/tcp_listener_sup.erl:src/rabbit_alarm.erl:src/rabbit.erl:src/rabbit_restartable_sup.erl:src/rabbit_types.erl:src/rabbit_net.erl:src/worker_pool.erl:src/rabbit_auth_mechanism.erl:src/rabbit_tests_event_receiver.erl:src/rabbit_msg_store.erl:src/rabbit_exchange_type_topic.erl:src/rabbit_writer.erl:src/rabbit_channel.erl:src/rabbit_exchange_type_fanout.erl:src/rabbit_auth_backend_internal.erl:src/rabbit_prelaunch.erl:src/rabbit_registry.erl:src/rabbit_auth_mechanism_cr_demo.erl:src/gm.erl:src/rabbit_log.erl:src/rabbit_amqqueue.erl:src/rabbit_direct.erl:src/file_handle_cache.erl:src/rabbit_ssl.erl:src/gen_server2.erl:src/rabbit_guid.erl:src/rabbit_auth_mechanism_amqplain.erl:src/rabbit_error_logger.erl:src/rabbit_msg_store_index.erl:src/rabbit_vhost.erl:src/rabbit_backing_queue.erl:src/gm_speed_test.erl:src/rabbit_tests.erl:src/rabbit_exchange_type_direct.erl:src/rabbit_queue_collector.erl:src/tcp_acceptor.erl:src/rabbit_misc.erl:src/rabbit_msg_store_ets_index.erl:src/delegate.erl:src/rabbit_connection_sup.erl:src/worker_pool_sup.erl:src/rabbit_limiter.erl:src/rabbit_node_monitor.erl:src/rabbit_heartbeat.erl:src/rabbit_sasl_report_file_h.erl:src/rabbit_memory_monitor.erl:src/rabbit_auth_backend.erl:src/vm_memory_monitor.erl:src/rabbit_exchange.erl:src/tcp_listener.erl:src/bpqueue.erl:src/rabbit_binary_generator.erl:src/rabbit_networking.erl:src/rabbit_variable_queue.erl:src/priority_queue.erl:src/rabbit_amqqueue_sup.erl:src/gatherer.erl:src/rabbit_auth_mechanism_plain.erl:src/rabbit_msg_store_gc.erl:src/rabbit_queue_index.erl:src/rabbit_channel_sup.erl:src/rabbit_event.erl:src/worker_pool_worker.erl:src/pg_local.erl:src/rabbit_framing.erl:src/rabbit_mnesia.erl:src/rabbit_exchange_type.erl:src/rabbit_command_assembler.erl:src/rabbit_exchange_type_headers.erl:src/rabbit_upgrade_functions.erl:src/supervisor2.erl:src/test_sup.erl:src/rabbit_amqqueue_process.erl:src/gm_tests.erl:src/tcp_acceptor_sup.erl:src/rabbit_upgrade.erl:src/rabbit_error_logger_file_h.erl:src/delegate_sup.erl:src/rabbit_reader.erl:src/rabbit_binding.erl:src/rabbit_msg_file.erl:src/rabbit_client_sup.erl:src/rabbit_access_control.erl:src/rabbit_router.erl:src/rabbit_version.erl:src/rabbit_binary_parser.erl:src/rabbit_channel_sup_sup.erl:src/rabbit_basic.erl:src/rabbit_sup.erl:src/rabbit_framing_amqp_0_9_1.erl:src/rabbit_framing_amqp_0_8.erl:src/rabbit_ctl_usage.erl:include/rabbit_msg_store_index.hrl:include/rabbit_exchange_type_spec.hrl:include/rabbit_auth_backend_spec.hrl:include/gm_specs.hrl:include/rabbit_auth_mechanism_spec.hrl:include/rabbit_backing_queue_spec.hrl:include/rabbit_msg_store.hrl:include/rabbit.hrl:include/rabbit_framing.hrl: | escript generate_deps deps.mk ebin
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_alarm.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_control.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_version.erl

etc etc

What platform etc are you on?

Matthew

From kuleshovmail at gmail.com  Tue May 31 13:37:54 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Tue, 31 May 2011 12:37:54 +0000
Subject: [rabbitmq-discuss] Build rabbitmq-server-2.4.1 from source
	problem
In-Reply-To: <20110531123113.GC3224@rabbitmq.com>
References: <BANLkTi=QKUbU17Yvp9e22nuwkyEgFrzZ_g@mail.gmail.com>
	<20110531095934.GA3224@rabbitmq.com>
	<BANLkTi=5K6YgyCaDMjnh5GyceJ0RhsQt_A@mail.gmail.com>
	<20110531123113.GC3224@rabbitmq.com>
Message-ID: <BANLkTimJ4gzcRSTsTOBRHNn8MOaXMxocTA@mail.gmail.com>

Thank you all. I build it with python 2.6.

Now i have 2 question:

1) How can i use it in my erlang code? I must to user
rabbitmq-erlang-client? or something else?

I build rabbitmq-erlang-client from github git. I put in my code:

-include("amqp_client.hrl").

But get error:

./test.erl:10: can't find include file "amqp_client.hrl"

2) How can i install rabbitmq-server. I build it with make. Them i try
to make install:

make install
Please set TARGET_DIR.
Please set SBIN_DIR.
Please set MAN_DIR.
make: *** [install_dirs] Error 1


Thank you.

From videlalvaro at gmail.com  Tue May 31 13:47:27 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 31 May 2011 14:47:27 +0200
Subject: [rabbitmq-discuss] Build rabbitmq-server-2.4.1 from source
	problem
In-Reply-To: <BANLkTimJ4gzcRSTsTOBRHNn8MOaXMxocTA@mail.gmail.com>
References: <BANLkTi=QKUbU17Yvp9e22nuwkyEgFrzZ_g@mail.gmail.com>
	<20110531095934.GA3224@rabbitmq.com>
	<BANLkTi=5K6YgyCaDMjnh5GyceJ0RhsQt_A@mail.gmail.com>
	<20110531123113.GC3224@rabbitmq.com>
	<BANLkTimJ4gzcRSTsTOBRHNn8MOaXMxocTA@mail.gmail.com>
Message-ID: <7B3B5985-A471-4E04-AE39-D0206B8AE8D0@gmail.com>

Hi,

To use the Erlang client I created an App following the OTP design principles (folder structure, etc).

Then I have a folder deps like this:

deps /
	amqp_client/			
	rabbit_common/

I've got the content of those folders from the .ez files distributed on the plugins area of rabbitmq.com

So I have a rebar.config file like this:

	{erl_opts, [debug_info, fail_on_warning,                                                                                                                                                                  
  		{i, "include"},                                                                                                                                                                                         
		{i, "deps"}                                                                                                                                                                                             
	]}.                                                                                                                                                                                                       

Which AFAIK will be translated to an erlc option like: erlc -I deps -I include ? etc etc

Then on my app .hrl file with the records definitions and so on I added:

-include_lib("amqp_client/include/amqp_client.hrl").

-include_lib then will try to find the amqp_client app in your load path? which is what the -I deps option should take care off.

I think that's the *way* of doing it in Erlang, probably Matthew can comment on that.

Cheers,

-Alvaro

On May 31, 2011, at 2:37 PM, Alexander Kuleshov wrote:

> Thank you all. I build it with python 2.6.
> 
> Now i have 2 question:
> 
> 1) How can i use it in my erlang code? I must to user
> rabbitmq-erlang-client? or something else?
> 
> I build rabbitmq-erlang-client from github git. I put in my code:
> 
> -include("amqp_client.hrl").
> 
> But get error:
> 
> ./test.erl:10: can't find include file "amqp_client.hrl"
> 
> 2) How can i install rabbitmq-server. I build it with make. Them i try
> to make install:
> 
> make install
> Please set TARGET_DIR.
> Please set SBIN_DIR.
> Please set MAN_DIR.
> make: *** [install_dirs] Error 1
> 
> 
> Thank you.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/9b0599d9/attachment-0001.htm>

From david at rabbitmq.com  Tue May 31 13:56:51 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 31 May 2011 13:56:51 +0100
Subject: [rabbitmq-discuss] Build rabbitmq-server-2.4.1 from source
	problem
In-Reply-To: <20110531095934.GA3224@rabbitmq.com> (Matthew Sackman's message
	of "Tue, 31 May 2011 10:59:35 +0100")
References: <BANLkTi=QKUbU17Yvp9e22nuwkyEgFrzZ_g@mail.gmail.com>
	<20110531095934.GA3224@rabbitmq.com>
Message-ID: <yrv4clixnkoz0.fsf@dwragg.eng.vmware.com>

Matthew Sackman <matthew at rabbitmq.com> writes:
> On Mon, May 30, 2011 at 11:42:34AM +0000, Alexander Kuleshov wrote:
>> I use python 2.7.1
>
> I suspect that may be the problem. Try a 2.6.

It works fine for me with python 2.7.1 (on Fedora 15).  There might have
been an issue with Alexander's Python install, but I don't think there
is a general 2.7 issue.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From rafalkot at gmail.com  Tue May 31 14:30:16 2011
From: rafalkot at gmail.com (KooT)
Date: Tue, 31 May 2011 06:30:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
Message-ID: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>

python worker.py
 [*] Waiting for messages. To exit press CTRL+C
Traceback (most recent call last):
  File "worker.py", line 22, in ?
    channel.start_consuming()
AttributeError: Channel instance has no attribute 'start_consuming'


I got pika 0.9.5

From gmr at myyearbook.com  Tue May 31 15:02:52 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 31 May 2011 10:02:52 -0400
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
 attribute 'start_consuming'
In-Reply-To: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
Message-ID: <456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>

Are you using the BlockingConnection adapter?

On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:

> python worker.py
>  [*] Waiting for messages. To exit press CTRL+C
> Traceback (most recent call last):
>  File "worker.py", line 22, in ?
>  channel.start_consuming()
> AttributeError: Channel instance has no attribute 'start_consuming'
> 
> 
> I got pika 0.9.5
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/f40f5596/attachment.htm>

From ian.patton at gmail.com  Tue May 31 15:22:25 2011
From: ian.patton at gmail.com (Ian Patton)
Date: Tue, 31 May 2011 10:22:25 -0400
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
	rabbit 2.4.1
Message-ID: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>

When running a rabbit cluster, the first node that includes the plugin
starts up fine.

Any additional nodes crash on startup. Moving the plugin out of the plugins
folder allows rabbit to start fine. Running the agent alone is not a
problem.

I have seen this mentioned in the mailing lists since 2.4.1 came out, but I
have not seen any follow-up providing a fix.  Any feedback welcome.

Thanks,

-- 

C. Ian Patton
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/9cccc074/attachment.htm>

From simon at rabbitmq.com  Tue May 31 15:39:36 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 May 2011 15:39:36 +0100
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
 rabbit 2.4.1
In-Reply-To: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
Message-ID: <4DE4FDA8.7040606@rabbitmq.com>

Hi Ian.

On 31/05/11 15:22, Ian Patton wrote:
> When running a rabbit cluster, the first node that includes the plugin
> starts up fine.
>
> Any additional nodes crash on startup. Moving the plugin out of the
> plugins folder allows rabbit to start fine. Running the agent alone is
> not a problem.

Are all these nodes on the same machine? If so, the problem is as 
described here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010703.html

If not, then what error messages are you seeing in the logs?

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From charly.hamy at gmail.com  Tue May 31 15:46:40 2011
From: charly.hamy at gmail.com (Charly Hamy)
Date: Tue, 31 May 2011 16:46:40 +0200
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
 rabbit 2.4.1
In-Reply-To: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
Message-ID: <BANLkTimA8j6YbdYdQAcc=HZ8pGtUOj_U_w@mail.gmail.com>

Hi,

you seem to be running your nodes on the same server. Maybe the problem is
that only one management plugin can run on a single machine, because only on
plugin may be listening to the port where the UI is avaiblable.

You could try to load that plugin on one node only.

For this, set different "*RABBITMQ_PLUGINS_DIR" for your nodes: for exemple
you could have one "plugins" directory with the management plugin (and its
dependencies) - used by one of your nodes - and another with the "management
agent" plugin only - for the other nodes.*
*
*
*Hope this will help.*
*
*
*Regards,*
*Charly*


On Tue, May 31, 2011 at 4:22 PM, Ian Patton <ian.patton at gmail.com> wrote:

> When running a rabbit cluster, the first node that includes the plugin
> starts up fine.
>
>

> Any additional nodes crash on startup. Moving the plugin out of the plugins
> folder allows rabbit to start fine. Running the agent alone is not a
> problem.
>
> I have seen this mentioned in the mailing lists since 2.4.1 came out, but I
> have not seen any follow-up providing a fix.  Any feedback welcome.
>
> Thanks,
>
> --
>
> C. Ian Patton
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/10356161/attachment.htm>

From simon at rabbitmq.com  Tue May 31 15:49:32 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 May 2011 15:49:32 +0100
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
 rabbit 2.4.1
In-Reply-To: <BANLkTimA8j6YbdYdQAcc=HZ8pGtUOj_U_w@mail.gmail.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
	<BANLkTimA8j6YbdYdQAcc=HZ8pGtUOj_U_w@mail.gmail.com>
Message-ID: <4DE4FFFC.6030701@rabbitmq.com>

On 31/05/11 15:46, Charly Hamy wrote:
> you seem to be running your nodes on the same server. Maybe the problem
> is that only one management plugin can run on a single machine, because
> only on plugin may be listening to the port where the UI is avaiblable.

No, Ian has been in touch by private email and he's seeing a real 
problem. Not sure what the problem is yet but at least I have a 
meaningful error now.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From ian.patton at gmail.com  Tue May 31 15:54:59 2011
From: ian.patton at gmail.com (Ian Patton)
Date: Tue, 31 May 2011 10:54:59 -0400
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
 rabbit 2.4.1
In-Reply-To: <4DE50030.9050002@rabbitmq.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
	<4DE4FDA8.7040606@rabbitmq.com>
	<BANLkTikN2sXb_1aTC7Y7ViQrsSp5L2ecEA@mail.gmail.com>
	<4DE50030.9050002@rabbitmq.com>
Message-ID: <BANLkTikyzOvSLqtdOMn43cp0fZwsmAuBCQ@mail.gmail.com>

sorry, forgot to loop the list in my last reply.

I looked at http://www.rabbitmq.com/releases/plugins/v2.4.1/
and there is a "-mem-fix" version. I tried this and it seems to do the same
thing. Not sure that this version is for, but it is not linked from the main
plugins page.

Ian

On Tue, May 31, 2011 at 10:50 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 31/05/11 15:44, Ian Patton wrote:
>
>> =SUPERVISOR REPORT==== 31-May-2011::14:41:44 ===
>>      Supervisor: {local,rabbit_sup}
>>      Context:    child_terminated
>>      Reason:     killed
>>      Offender:   [{pid,<0.241.0>},
>>                   {name,rabbit_mgmt_global_sup},
>>                   {mfargs,{rabbit_mgmt_global_sup,start_link,[]}},
>>                   {restart_type,transient},
>>                   {shutdown,4294967295},
>>                   {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 31-May-2011::14:41:44 ===
>>      Supervisor: {local,rabbit_sup}
>>      Context:    shutdown
>>      Reason:     reached_max_restart_intensity
>>      Offender:   [{pid,<0.241.0>},
>>                   {name,rabbit_mgmt_global_sup},
>>                   {mfargs,{rabbit_mgmt_global_sup,start_link,[]}},
>>                   {restart_type,transient},
>>                   {shutdown,4294967295},
>>                   {child_type,worker}]
>>
>
> Ah. That is interesting. Not sure what the problem is yet, but this gives
> me something to get my teeth into.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>


-- 

C. Ian Patton
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/9858b54d/attachment-0001.htm>

From simon at rabbitmq.com  Tue May 31 15:58:32 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 May 2011 15:58:32 +0100
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
 rabbit 2.4.1
In-Reply-To: <BANLkTikyzOvSLqtdOMn43cp0fZwsmAuBCQ@mail.gmail.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>	<4DE4FDA8.7040606@rabbitmq.com>	<BANLkTikN2sXb_1aTC7Y7ViQrsSp5L2ecEA@mail.gmail.com>	<4DE50030.9050002@rabbitmq.com>
	<BANLkTikyzOvSLqtdOMn43cp0fZwsmAuBCQ@mail.gmail.com>
Message-ID: <4DE50218.8090807@rabbitmq.com>

On 31/05/11 15:54, Ian Patton wrote:
> sorry, forgot to loop the list in my last reply.
>
> I looked at http://www.rabbitmq.com/releases/plugins/v2.4.1/
> and there is a "-mem-fix" version. I tried this and it seems to do the
> same thing. Not sure that this version is for, but it is not linked from
> the main plugins page.

That was fixing the bug reported here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-April/012352.html

but that's a different thing; you need a high rate of queue churn to see 
much chance of seeing it.

Your problem hasn't been fixed yet I'm afraid, but now I have something 
to go on.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From danbarua at gmail.com  Tue May 31 17:07:02 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 31 May 2011 09:07:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ management plugin/API - extended
	permissions
Message-ID: <5120b5e0-e083-4e5d-8140-d115179340aa@k3g2000prl.googlegroups.com>

Given the following:
I have a RabbitMQ installation.
According to best practices, I have deleted the guest/guest default
login.
I have installed the RabbitMQ management plugin.

How can I assign the "administrator" flag to my login if my login is
not an administrator?

-Dan

From ian.patton at gmail.com  Tue May 31 17:08:16 2011
From: ian.patton at gmail.com (Ian Patton)
Date: Tue, 31 May 2011 12:08:16 -0400
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
 rabbit 2.4.1
In-Reply-To: <4DE50FE4.3020308@rabbitmq.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
	<4DE4FDA8.7040606@rabbitmq.com>
	<BANLkTikN2sXb_1aTC7Y7ViQrsSp5L2ecEA@mail.gmail.com>
	<4DE50FE4.3020308@rabbitmq.com>
Message-ID: <BANLkTikjCRSpDg50dSfTDvygJXTA2Bitag@mail.gmail.com>

I can create a virtual machine image and ssh it to some server for you to
grab... if you have such a place to put it. If so, let me know which
hypervisor you prefer (ESX, Xen, KVM, etc)

Ian


On Tue, May 31, 2011 at 11:57 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> I don't suppose there's any chance you could give me access to this
> machine? I'm not having any luck reproducing this...
>
> Cheers, Simon
>
>
> On 31/05/11 15:44, Ian Patton wrote:
>
>> The nodes are on separate machines.
>>
>> Here is the log:
>>
>> cat /var/log/rabbitmq/rabbit\@mc-messages2.log
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> Limiting to approx 999900 file handles (899908 sockets)
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> Memory limit set to 1584MB.
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> Management plugin upgraded statistics to fine.
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> Statistics database started.
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> started TCP Listener on [::]:5672
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> node 'rabbit at mc-messages1' up
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> Management agent started.
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> Management plugin started.
>> HTTP API: http://mc-messages2:55672/api/
>> Management UI: http://mc-messages2:55672/mgmt/
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>> stopped TCP Listener on [::]:5672
>>
>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>     application: rabbit
>>     exited: shutdown
>>     type: permanent
>>
>> and here is the sasl log:
>>
>> cat rabbit\@mc-messages2-sasl.log
>>
>> =SUPERVISOR REPORT==== 31-May-2011::14:41:44 ===
>>      Supervisor: {local,rabbit_sup}
>>      Context:    child_terminated
>>      Reason:     killed
>>      Offender:   [{pid,<0.241.0>},
>>                   {name,rabbit_mgmt_global_sup},
>>                   {mfargs,{rabbit_mgmt_global_sup,start_link,[]}},
>>                   {restart_type,transient},
>>                   {shutdown,4294967295},
>>                   {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 31-May-2011::14:41:44 ===
>>      Supervisor: {local,rabbit_sup}
>>      Context:    shutdown
>>      Reason:     reached_max_restart_intensity
>>      Offender:   [{pid,<0.241.0>},
>>                   {name,rabbit_mgmt_global_sup},
>>                   {mfargs,{rabbit_mgmt_global_sup,start_link,[]}},
>>                   {restart_type,transient},
>>                   {shutdown,4294967295},
>>                   {child_type,worker}]
>>
>> --
>>
>> C. Ian Patton
>>
>>
>> On Tue, May 31, 2011 at 10:39 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>    Hi Ian.
>>
>>
>>    On 31/05/11 15:22, Ian Patton wrote:
>>
>>        When running a rabbit cluster, the first node that includes the
>>        plugin
>>        starts up fine.
>>
>>        Any additional nodes crash on startup. Moving the plugin out of the
>>        plugins folder allows rabbit to start fine. Running the agent
>>        alone is
>>        not a problem.
>>
>>
>>    Are all these nodes on the same machine? If so, the problem is as
>>    described here:
>>
>>
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010703.html
>>
>>    If not, then what error messages are you seeing in the logs?
>>
>>    Cheers, Simon
>>    --
>>    Simon MacMullen
>>    Staff Engineer, RabbitMQ
>>    SpringSource, a division of VMware
>>
>>    _______________________________________________
>>    rabbitmq-discuss mailing list
>>    rabbitmq-discuss at lists.rabbitmq.com
>>    <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>
>>    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>>
>>
>>
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>


-- 

C. Ian Patton
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/ebd1412f/attachment.htm>

From simon at rabbitmq.com  Tue May 31 17:09:34 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 May 2011 17:09:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ management plugin/API - extended
 permissions
In-Reply-To: <5120b5e0-e083-4e5d-8140-d115179340aa@k3g2000prl.googlegroups.com>
References: <5120b5e0-e083-4e5d-8140-d115179340aa@k3g2000prl.googlegroups.com>
Message-ID: <4DE512BE.2020507@rabbitmq.com>

On 31/05/11 17:07, Dan B wrote:
> Given the following:
> I have a RabbitMQ installation.
> According to best practices, I have deleted the guest/guest default
> login.
> I have installed the RabbitMQ management plugin.
>
> How can I assign the "administrator" flag to my login if my login is
> not an administrator?

There's no way to do this in the management plugin (unsurprisingly, it 
would be a security hole).

You can do it from the command line with:

  rabbitmqctl set_admin <username>

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From vbernard42 at gmail.com  Tue May 31 17:13:33 2011
From: vbernard42 at gmail.com (Valentin Bernard)
Date: Tue, 31 May 2011 09:13:33 -0700 (PDT)
Subject: [rabbitmq-discuss] multiple workers
In-Reply-To: <000001cc1bce$95749440$c05dbcc0$@com>
References: <000001cc1bce$95749440$c05dbcc0$@com>
Message-ID: <1bd451bb-92b8-486e-a14f-427495ea0985@s16g2000prf.googlegroups.com>

Hi,

As long as you don't access the same channel from multiple threads at
the same time, there should be no problem here.

Also, the "Work Queues" example uses a specific type of consumer, the
QueueingConsumer. You may want to subclass the DefaultConsumer
implementation in order to receive messages in a non-blocking manner.

Regards,

Valentin.

On May 26, 7:58?pm, "Rajarshi Chakravarty" <r... at myquu.com> wrote:
> Hi,
>
> I have implemented Rabbit queues in java.
>
> In the "Work Queues" example given on the site, 2 programs are created and
> each runs an infinite loop.
>
> My question is instead of doing that, can I create 2 threads in a program
> and run an infinite loop in each thread?
>
> Regards,
>
> Raj
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ian.patton at gmail.com  Tue May 31 17:19:36 2011
From: ian.patton at gmail.com (Ian Patton)
Date: Tue, 31 May 2011 12:19:36 -0400
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
 rabbit 2.4.1
In-Reply-To: <BANLkTikjCRSpDg50dSfTDvygJXTA2Bitag@mail.gmail.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
	<4DE4FDA8.7040606@rabbitmq.com>
	<BANLkTikN2sXb_1aTC7Y7ViQrsSp5L2ecEA@mail.gmail.com>
	<4DE50FE4.3020308@rabbitmq.com>
	<BANLkTikjCRSpDg50dSfTDvygJXTA2Bitag@mail.gmail.com>
Message-ID: <BANLkTimYZF=WDvpMAwiCawb=Tn-L1RvkbQ@mail.gmail.com>

Does this help?

mc-messages2:/var/log/rabbitmq # sudo -u rabbitmq rabbitmqctl status
Status of node 'rabbit at mc-messages2' ...
[{pid,23029},
 {running_applications,
     [{webmachine,"webmachine","1.7.0"},
      {rabbit_management_agent,"RabbitMQ Management Agent","2.4.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.4.1"},
      {rabbit,"RabbitMQ","2.4.1"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.3"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.4.1"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {inets,"INETS  CXC 138 49","5.5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
      {stdlib,"ERTS  CXC 138 10","1.17.3"},
      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {nodes,[{disc,['rabbit at mc-messages2','rabbit at mc-messages1']}]},
 {running_nodes,['rabbit at mc-messages1','rabbit at mc-messages2']}]
...done.

mc-messages2:/var/log/rabbitmq # erl
Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:0] [hipe] [kernel-poll:false]


Ian

On Tue, May 31, 2011 at 12:08 PM, Ian Patton <ian.patton at gmail.com> wrote:

> I can create a virtual machine image and ssh it to some server for you to
> grab... if you have such a place to put it. If so, let me know which
> hypervisor you prefer (ESX, Xen, KVM, etc)
>
> Ian
>
>
> On Tue, May 31, 2011 at 11:57 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> I don't suppose there's any chance you could give me access to this
>> machine? I'm not having any luck reproducing this...
>>
>> Cheers, Simon
>>
>>
>> On 31/05/11 15:44, Ian Patton wrote:
>>
>>> The nodes are on separate machines.
>>>
>>> Here is the log:
>>>
>>> cat /var/log/rabbitmq/rabbit\@mc-messages2.log
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> Limiting to approx 999900 file handles (899908 sockets)
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> Memory limit set to 1584MB.
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> Management plugin upgraded statistics to fine.
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> Statistics database started.
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> started TCP Listener on [::]:5672
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> node 'rabbit at mc-messages1' up
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> Management agent started.
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> Management plugin started.
>>> HTTP API: http://mc-messages2:55672/api/
>>> Management UI: http://mc-messages2:55672/mgmt/
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>> stopped TCP Listener on [::]:5672
>>>
>>> =INFO REPORT==== 31-May-2011::14:41:44 ===
>>>     application: rabbit
>>>     exited: shutdown
>>>     type: permanent
>>>
>>> and here is the sasl log:
>>>
>>> cat rabbit\@mc-messages2-sasl.log
>>>
>>> =SUPERVISOR REPORT==== 31-May-2011::14:41:44 ===
>>>      Supervisor: {local,rabbit_sup}
>>>      Context:    child_terminated
>>>      Reason:     killed
>>>      Offender:   [{pid,<0.241.0>},
>>>                   {name,rabbit_mgmt_global_sup},
>>>                   {mfargs,{rabbit_mgmt_global_sup,start_link,[]}},
>>>                   {restart_type,transient},
>>>                   {shutdown,4294967295},
>>>                   {child_type,worker}]
>>>
>>>
>>> =SUPERVISOR REPORT==== 31-May-2011::14:41:44 ===
>>>      Supervisor: {local,rabbit_sup}
>>>      Context:    shutdown
>>>      Reason:     reached_max_restart_intensity
>>>      Offender:   [{pid,<0.241.0>},
>>>                   {name,rabbit_mgmt_global_sup},
>>>                   {mfargs,{rabbit_mgmt_global_sup,start_link,[]}},
>>>                   {restart_type,transient},
>>>                   {shutdown,4294967295},
>>>                   {child_type,worker}]
>>>
>>> --
>>>
>>> C. Ian Patton
>>>
>>>
>>> On Tue, May 31, 2011 at 10:39 AM, Simon MacMullen <simon at rabbitmq.com
>>> <mailto:simon at rabbitmq.com>> wrote:
>>>
>>>    Hi Ian.
>>>
>>>
>>>    On 31/05/11 15:22, Ian Patton wrote:
>>>
>>>        When running a rabbit cluster, the first node that includes the
>>>        plugin
>>>        starts up fine.
>>>
>>>        Any additional nodes crash on startup. Moving the plugin out of
>>> the
>>>        plugins folder allows rabbit to start fine. Running the agent
>>>        alone is
>>>        not a problem.
>>>
>>>
>>>    Are all these nodes on the same machine? If so, the problem is as
>>>    described here:
>>>
>>>
>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010703.html
>>>
>>>    If not, then what error messages are you seeing in the logs?
>>>
>>>    Cheers, Simon
>>>    --
>>>    Simon MacMullen
>>>    Staff Engineer, RabbitMQ
>>>    SpringSource, a division of VMware
>>>
>>>    _______________________________________________
>>>    rabbitmq-discuss mailing list
>>>    rabbitmq-discuss at lists.rabbitmq.com
>>>    <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>
>>>    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>
>> --
>> Simon MacMullen
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>>
>>
>
>
> --
>
> C. Ian Patton
>
>


-- 

C. Ian Patton
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/f3f0b483/attachment-0001.htm>

From danbarua at gmail.com  Tue May 31 17:24:59 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 31 May 2011 09:24:59 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ management plugin/API - extended
	permissions
In-Reply-To: <4DE512BE.2020507@rabbitmq.com>
References: <5120b5e0-e083-4e5d-8140-d115179340aa@k3g2000prl.googlegroups.com>
	<4DE512BE.2020507@rabbitmq.com>
Message-ID: <43e50da1-fcef-4239-9595-ae0cf3e7b522@l14g2000pro.googlegroups.com>

Thank you, that's just what I was looking for.

It would probably be worth mentioning that in the documentation here:
http://www.rabbitmq.com/management.html#permissions

-Dan

On May 31, 5:09?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 31/05/11 17:07, Dan B wrote:
>
> > Given the following:
> > I have a RabbitMQ installation.
> > According to best practices, I have deleted the guest/guest default
> > login.
> > I have installed the RabbitMQ management plugin.
>
> > How can I assign the "administrator" flag to my login if my login is
> > not an administrator?
>
> There's no way to do this in the management plugin (unsurprisingly, it
> would be a security hole).
>
> You can do it from the command line with:
>
> ? rabbitmqctl set_admin <username>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rkimball at pangeamedia.com  Tue May 31 18:34:27 2011
From: rkimball at pangeamedia.com (Ronald J Kimball)
Date: Tue, 31 May 2011 13:34:27 -0400
Subject: [rabbitmq-discuss] Perl Net::RabbitMQ and failure conditions
In-Reply-To: <BANLkTi=BKveXBFiObCUDCvUcAhx3-8Oyrg@mail.gmail.com>
References: <BANLkTim==hb=hDLCqEN=0J5vfbHQN14BOw@mail.gmail.com>
	<BANLkTi=BKveXBFiObCUDCvUcAhx3-8Oyrg@mail.gmail.com>
Message-ID: <BANLkTimz4P1H+NgiAkdhQ_C3CNCjbmum7Q@mail.gmail.com>

Hi, thanks for the response.  Unfortunately, I haven't really found an
answer.

We upgraded RabbitMQ to 2.4.1, after which Net::RabbitMQ no longer hangs
when the remote server is up but the remote app is down.

However, Net::RabbitMQ still returns a false success when the remote server
or app goes down after the publisher connects to the local node.  (The queue
is located on the remote app.)

For now, we've switched to having a single node.  This decreases our
throughput slightly, but at least we don't risk dropping messages.

I think we must be doing something wrong, but I don't know what...

Ronald


On Tue, May 31, 2011 at 7:41 AM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Ronald
>
> Were you able to find an answer to this?
>
> alexis
>
>
>
> On Thu, May 19, 2011 at 9:44 PM, Ronald J Kimball
> <rkimball at pangeamedia.com> wrote:
> > I'm trying to understand how RabbitMQ behaves under failure conditions,
> > specifically when using the Net::RabbitMQ Perl module.
> >
> > We have RabbitMQ set up with three nodes, one on the backend, which holds
> > the actual queues, and two on the frontend, which receive publish
> requests.
> >
> > RabbitMQ 2.2.0
> > Net::RabbitMQ 0.1.8
> >
> >
> > Below is the chart of behaviors that I have observed.
> >
> > "+" means the behavior is as I expected: either the message is
> successfully
> > queued, or an error is thrown.
> > "-" means the behavior is not as I expected, but can be managed:
> > specifically, the process receives a SIGPIPE, which I can trap and
> recover
> > from.
> > "!" means the behavior is not as I expected, and cannot be managed: the
> > message is not queued but no error is thrown and/or the process hangs.
> >
> > "App down" means I ran `rabbitmqctl stop_app`.  "Daemon down" means I ran
> > `rabbitmqctl stop`.
> >
> >   As publishing process starts up:
> >
> >     Remote daemon up, app up
> >       + Everything okay
> >
> >     Remote daemon up, app down
> >       ! Net::RabbitMQ hangs when declaring queue
> >
> >     Remote daemon down
> >       + Net::RabbitMQ throws error when declaring queue
> >         "Declaring queue: server channel error 404, message: NOT_FOUND -
> no
> > queue 'test' in vhost '/'"
> >
> >     Local daemon up, app down
> >       + Net::RabbitMQ throws error when connecting
> >         "Opening socket: Connection refused"
> >
> >     Local daemon down
> >       + Net::RabbitMQ throws error when connecting
> >         "Opening socket: Connection refused"
> >
> >
> >   After publishing process starts up:
> >
> >     Local app goes down
> >       - Process receives SIGPIPE
> >
> >     Local daemon goes down
> >       - Process receives SIGPIPE
> >
> >     Remote app goes down
> >       ! Net::RabbitMQ falsely indicates success when publishing, then
> hangs
> > (in DESTROY?)
> >
> >     Remote daemon goes down
> >       ! Net::RabbitMQ falsely indicates success when publishing
> >
> >
> >     Local app goes down, comes back up
> >       - Process receives SIGPIPE
> >
> >     Local daemon goes down, comes back up
> >       - Process receives SIGPIPE
> >
> >     Remote app goes down, comes back up
> >       + Everything okay
> >
> >     Remote daemon goes down, comes back up
> >       + Everything okay
> >
> >
> > Have other people had these problems with Net::RabbitMQ?  Can we resolve
> > these issues by changing something in our RabbitMQ configuration?
> >
> >
> > thanks,
> > Ronald
> >
> >
> > P.S. Here's my script.
> >
> > #!/usr/local/bin/perl
> >
> > use strict;
> > use warnings;
> >
> > use Net::RabbitMQ;
> >
> > $| = 1;
> >
> > $SIG{'PIPE'} = sub { die "SIGPIPE\n" };
> >
> > my $mq = Net::RabbitMQ->new();
> >
> > alarm(10);
> >
> > print "Connecting\n";
> > $mq->connect('localhost', { user => 'engagement', password => '********'
> })
> >   or die "Can't connect to RabbitMQ\n";
> >
> > print "Opening channel\n";
> > $mq->channel_open(1);
> >
> > print "Declaring exchange\n";
> > $mq->exchange_declare(1, 'ee_exchange', { durable => 1 });
> >
> > print "Declaring queue\n";
> > $mq->queue_declare(1, 'test', { durable => 1 });
> >
> > print "Binding queue\n";
> > $mq->queue_bind(1, 'test', 'ee_exchange', 'ee_test');
> >
> > alarm(0);
> >
> > print "> ";
> > <>;
> >
> > alarm(10);
> >
> > print "Publishing message\n";
> > my $rc =
> >   $mq->publish(1, 'ee_test', 'hello world!',
> >                { exchange => 'ee_exchange', mandatory => 1, immediate =>
> 0
> > },
> >                { delivery_mode => 2 });
> > print "Result: $rc\n";
> >
> > __END__
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/d9ba7523/attachment.htm>

From ian.patton at gmail.com  Tue May 31 18:46:38 2011
From: ian.patton at gmail.com (Ian Patton)
Date: Tue, 31 May 2011 13:46:38 -0400
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
 rabbit 2.4.1
In-Reply-To: <4DE51F41.2080209@rabbitmq.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
	<4DE4FDA8.7040606@rabbitmq.com>
	<BANLkTikN2sXb_1aTC7Y7ViQrsSp5L2ecEA@mail.gmail.com>
	<4DE50FE4.3020308@rabbitmq.com>
	<BANLkTikjCRSpDg50dSfTDvygJXTA2Bitag@mail.gmail.com>
	<4DE518E0.3000704@rabbitmq.com> <4DE51F41.2080209@rabbitmq.com>
Message-ID: <BANLkTinBZbo-BFxRYwEJKRvZA04rkeSh2Q@mail.gmail.com>

That worked!  Do you want to see any output?

Ian

On Tue, May 31, 2011 at 1:02 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 31/05/11 17:35, Simon MacMullen wrote:
>
>> On 31/05/11 17:08, Ian Patton wrote:
>>
>>> I can create a virtual machine image and ssh it to some server for you
>>> to grab... if you have such a place to put it. If so, let me know which
>>> hypervisor you prefer (ESX, Xen, KVM, etc)
>>>
>>
>> I'd prefer ESX but anything really. I'm afraid I don't have a place for
>> you to oput it; could you put it somewhere I could retrieve it?
>>
>
> Actually, could you give this a try:
>
>
> http://www.rabbitmq.com/releases/plugins/test/rabbitmq-management-2.4.1-globals-debug.ez
>
> It contains some additional logging code, as well as a stab-in-the-dark
> attempt at a fix. Please install it instead of rabbitmq-management-2.4.1.ez
> on all the cluster nodes, and then send me the logs from *all* the nodes.
>
> Thanks for your help.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>


-- 

C. Ian Patton
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/9193b394/attachment.htm>

From rafalkot at gmail.com  Tue May 31 19:10:05 2011
From: rafalkot at gmail.com (KooT)
Date: Tue, 31 May 2011 11:10:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
In-Reply-To: <456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
Message-ID: <593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>

Yes, its worker.py from http://www.rabbitmq.com/tutorials/tutorial-two-python.html

#!/usr/bin/env python
import pika
import time

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='localhost'))
channel = connection.channel()

channel.queue_declare(queue='task_queue', durable=True)
print ' [*] Waiting for messages. To exit press CTRL+C'

def callback(ch, method, properties, body):
    print " [x] Received %r" % (body,)
    time.sleep( body.count('.') )
    print " [x] Done"
    ch.basic_ack(delivery_tag = method.delivery_tag)

channel.basic_qos(prefetch_count=1)
channel.basic_consume(callback,
                      queue='task_queue')

channel.start_consuming()


On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> Are you using the BlockingConnection adapter?
>
>
>
>
>
>
>
> On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > python worker.py
> > ?[*] Waiting for messages. To exit press CTRL+C
> > Traceback (most recent call last):
> > ?File "worker.py", line 22, in ?
> > ?channel.start_consuming()
> > AttributeError: Channel instance has no attribute 'start_consuming'
>
> > I got pika 0.9.5
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com (mailto:rabbitmq-disc... at lists.rabbitmq.com)
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at myyearbook.com  Tue May 31 19:15:32 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 31 May 2011 14:15:32 -0400
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
 attribute 'start_consuming'
In-Reply-To: <593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
Message-ID: <BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>

Sounds like it may not be Pika 0.9.5, how did you install?

What output do you get if you do:

python -c "import pika;print pika.__version__"

On Tue, May 31, 2011 at 2:10 PM, KooT <rafalkot at gmail.com> wrote:

> Yes, its worker.py from
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> #!/usr/bin/env python
> import pika
> import time
>
> connection = pika.BlockingConnection(pika.ConnectionParameters(
>        host='localhost'))
> channel = connection.channel()
>
> channel.queue_declare(queue='task_queue', durable=True)
> print ' [*] Waiting for messages. To exit press CTRL+C'
>
> def callback(ch, method, properties, body):
>    print " [x] Received %r" % (body,)
>    time.sleep( body.count('.') )
>    print " [x] Done"
>    ch.basic_ack(delivery_tag = method.delivery_tag)
>
> channel.basic_qos(prefetch_count=1)
> channel.basic_consume(callback,
>                      queue='task_queue')
>
> channel.start_consuming()
>
>
> On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> > Are you using the BlockingConnection adapter?
> >
> >
> >
> >
> >
> >
> >
> > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > python worker.py
> > >  [*] Waiting for messages. To exit press CTRL+C
> > > Traceback (most recent call last):
> > >  File "worker.py", line 22, in ?
> > >  channel.start_consuming()
> > > AttributeError: Channel instance has no attribute 'start_consuming'
> >
> > > I got pika 0.9.5
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com (mailto:
> rabbitmq-disc... at lists.rabbitmq.com)
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/6c907fa6/attachment-0001.htm>

From rafalkot at gmail.com  Tue May 31 19:21:24 2011
From: rafalkot at gmail.com (KooT)
Date: Tue, 31 May 2011 11:21:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
In-Reply-To: <BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
Message-ID: <44601876-abbe-4d64-9c27-386b9c54ea79@g28g2000yqa.googlegroups.com>

Downloaded source pika-0.9.5.tar.gz and then utar pika dir to the same
dir where is worker.py


rkot at a0:~$ ls -lah pika
total 412K
drwxr-xr-x  2 rkot 1000 4.0K 2011-05-31 20:16 .
drwxr-xr-x 22 rkot 1000 8.0K 2011-05-31 20:17 ..
-rw-r--r--  1 rkot 1000 5.1K 2011-05-31 13:31 asyncore_adapter.py
-rw-r--r--  1 rkot 1000 4.7K 2011-05-31 20:16 asyncore_adapter.pyc
-rw-r--r--  1 rkot 1000 3.2K 2011-05-31 13:31 blocking_adapter.py
-rw-r--r--  1 rkot 1000 1.5K 2011-05-31 20:16 blocking_adapter.pyc
-rw-r--r--  1 rkot 1000  12K 2011-05-31 13:31 channel.py
-rw-r--r--  1 rkot 1000 8.8K 2011-05-31 20:16 channel.pyc
-rw-r--r--  1 rkot 1000 7.9K 2011-05-31 13:31 codec.py
-rw-r--r--  1 rkot 1000 6.7K 2011-05-31 20:16 codec.pyc
-rw-r--r--  1 rkot 1000  18K 2011-05-31 13:31 connection.py
-rw-r--r--  1 rkot 1000  17K 2011-05-31 20:16 connection.pyc
-rw-r--r--  1 rkot 1000 3.0K 2011-05-31 13:31 event.py
-rw-r--r--  1 rkot 1000 1.4K 2011-05-31 20:16 event.pyc
-rw-r--r--  1 rkot 1000 2.8K 2011-05-31 13:31 exceptions.py
-rw-r--r--  1 rkot 1000 2.5K 2011-05-31 20:16 exceptions.pyc
-rw-r--r--  1 rkot 1000 2.9K 2011-05-31 13:31 __init__.py
-rw-r--r--  1 rkot 1000 1.1K 2011-05-31 20:16 __init__.pyc
-rw-r--r--  1 rkot 1000 5.3K 2011-05-31 13:31 simplebuffer.py
-rw-r--r--  1 rkot 1000 4.1K 2011-05-31 20:16 simplebuffer.pyc
-rw-r--r--  1 rkot 1000 3.1K 2011-05-31 13:31 specbase.py
-rw-r--r--  1 rkot 1000 2.0K 2011-05-31 20:16 specbase.pyc
-rw-r--r--  1 rkot 1000 118K 2011-05-31 13:31 spec.py
-rw-r--r--  1 rkot 1000 106K 2011-05-31 20:16 spec.pyc
-rw-r--r--  1 rkot 1000 5.2K 2011-05-31 13:31 table.py
-rw-r--r--  1 rkot 1000 2.5K 2011-05-31 20:16 table.pyc



On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> Sounds like it may not be Pika 0.9.5, how did you install?
>
> What output do you get if you do:
>
> python -c "import pika;print pika.__version__"
>
>
>
>
>
>
>
> On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com> wrote:
> > Yes, its worker.py from
> >http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> > #!/usr/bin/env python
> > import pika
> > import time
>
> > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > ? ? ? ?host='localhost'))
> > channel = connection.channel()
>
> > channel.queue_declare(queue='task_queue', durable=True)
> > print ' [*] Waiting for messages. To exit press CTRL+C'
>
> > def callback(ch, method, properties, body):
> > ? ?print " [x] Received %r" % (body,)
> > ? ?time.sleep( body.count('.') )
> > ? ?print " [x] Done"
> > ? ?ch.basic_ack(delivery_tag = method.delivery_tag)
>
> > channel.basic_qos(prefetch_count=1)
> > channel.basic_consume(callback,
> > ? ? ? ? ? ? ? ? ? ? ?queue='task_queue')
>
> > channel.start_consuming()
>
> > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> > > Are you using the BlockingConnection adapter?
>
> > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > python worker.py
> > > > ?[*] Waiting for messages. To exit press CTRL+C
> > > > Traceback (most recent call last):
> > > > ?File "worker.py", line 22, in ?
> > > > ?channel.start_consuming()
> > > > AttributeError: Channel instance has no attribute 'start_consuming'
>
> > > > I got pika 0.9.5
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com (mailto:
> > rabbitmq-disc... at lists.rabbitmq.com)
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rafalkot at gmail.com  Tue May 31 19:21:59 2011
From: rafalkot at gmail.com (KooT)
Date: Tue, 31 May 2011 11:21:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
In-Reply-To: <BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
Message-ID: <e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>

rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
Traceback (most recent call last):
  File "<string>", line 1, in <module>
AttributeError: 'module' object has no attribute '__version__'


On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> Sounds like it may not be Pika 0.9.5, how did you install?
>
> What output do you get if you do:
>
> python -c "import pika;print pika.__version__"
>
>
>
>
>
>
>
> On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com> wrote:
> > Yes, its worker.py from
> >http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> > #!/usr/bin/env python
> > import pika
> > import time
>
> > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > ? ? ? ?host='localhost'))
> > channel = connection.channel()
>
> > channel.queue_declare(queue='task_queue', durable=True)
> > print ' [*] Waiting for messages. To exit press CTRL+C'
>
> > def callback(ch, method, properties, body):
> > ? ?print " [x] Received %r" % (body,)
> > ? ?time.sleep( body.count('.') )
> > ? ?print " [x] Done"
> > ? ?ch.basic_ack(delivery_tag = method.delivery_tag)
>
> > channel.basic_qos(prefetch_count=1)
> > channel.basic_consume(callback,
> > ? ? ? ? ? ? ? ? ? ? ?queue='task_queue')
>
> > channel.start_consuming()
>
> > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> > > Are you using the BlockingConnection adapter?
>
> > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > python worker.py
> > > > ?[*] Waiting for messages. To exit press CTRL+C
> > > > Traceback (most recent call last):
> > > > ?File "worker.py", line 22, in ?
> > > > ?channel.start_consuming()
> > > > AttributeError: Channel instance has no attribute 'start_consuming'
>
> > > > I got pika 0.9.5
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com (mailto:
> > rabbitmq-disc... at lists.rabbitmq.com)
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at myyearbook.com  Tue May 31 19:25:21 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 31 May 2011 14:25:21 -0400
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
 attribute 'start_consuming'
In-Reply-To: <e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
	<e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>
Message-ID: <1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>

That doesn't look like a 0.9.5 install.

Have you tried pip or easy_install?

gmr at binti ~ $ sudo pip install pika
Downloading/unpacking pika
Downloading pika-0.9.5.tar.gz
Running setup.py egg_info for package pika
Installing collected packages: pika
Running setup.py install for pika
Successfully installed pika
Cleaning up...
gmr at binti ~ $ python -c "import pika;print pika.__version__"
0.9.5


On Tuesday, May 31, 2011 at 2:21 PM, KooT wrote:

> rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
> Traceback (most recent call last):
>  File "<string>", line 1, in <module>
> AttributeError: 'module' object has no attribute '__version__'
> 
> 
> On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > Sounds like it may not be Pika 0.9.5, how did you install?
> > 
> > What output do you get if you do:
> > 
> > python -c "import pika;print pika.__version__"
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com (http://gmail.com)> wrote:
> > > Yes, its worker.py from
> > > http://www.rabbitmq.com/tutorials/tutorial-two-python.html
> > 
> > > #!/usr/bin/env python
> > > import pika
> > > import time
> > 
> > > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > > host='localhost'))
> > > channel = connection.channel()
> > 
> > > channel.queue_declare(queue='task_queue', durable=True)
> > > print ' [*] Waiting for messages. To exit press CTRL+C'
> > 
> > > def callback(ch, method, properties, body):
> > > print " [x] Received %r" % (body,)
> > > time.sleep( body.count('.') )
> > > print " [x] Done"
> > > ch.basic_ack(delivery_tag = method.delivery_tag)
> > 
> > > channel.basic_qos(prefetch_count=1)
> > > channel.basic_consume(callback,
> > > queue='task_queue')
> > 
> > > channel.start_consuming()
> > 
> > > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > Are you using the BlockingConnection adapter?
> > 
> > > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > > python worker.py
> > > > > [*] Waiting for messages. To exit press CTRL+C
> > > > > Traceback (most recent call last):
> > > > > File "worker.py", line 22, in ?
> > > > > channel.start_consuming()
> > > > > AttributeError: Channel instance has no attribute 'start_consuming'
> > 
> > > > > I got pika 0.9.5
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com) (mailto:
> > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/9decbb1c/attachment.htm>

From rafalkot at gmail.com  Tue May 31 19:27:24 2011
From: rafalkot at gmail.com (KooT)
Date: Tue, 31 May 2011 11:27:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
In-Reply-To: <1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
	<e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>
	<1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
Message-ID: <c601f5a3-9d7a-4bf3-be41-6c480c3f28d2@z13g2000yqg.googlegroups.com>

I don't have root access there, i want pika as local lib :|

On 31 Maj, 20:25, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> That doesn't look like a 0.9.5 install.
>
> Have you tried pip or easy_install?
>
> gmr at binti ~ $ sudo pip install pika
> Downloading/unpacking pika
> Downloading pika-0.9.5.tar.gz
> Running setup.py egg_info for package pika
> Installing collected packages: pika
> Running setup.py install for pika
> Successfully installed pika
> Cleaning up...
> gmr at binti ~ $ python -c "import pika;print pika.__version__"
> 0.9.5
>
>
>
>
>
>
>
> On Tuesday, May 31, 2011 at 2:21 PM, KooT wrote:
> > rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
> > Traceback (most recent call last):
> > ?File "<string>", line 1, in <module>
> > AttributeError: 'module' object has no attribute '__version__'
>
> > On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > Sounds like it may not be Pika 0.9.5, how did you install?
>
> > > What output do you get if you do:
>
> > > python -c "import pika;print pika.__version__"
>
> > > On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com (http://gmail.com)> wrote:
> > > > Yes, its worker.py from
> > > >http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> > > > #!/usr/bin/env python
> > > > import pika
> > > > import time
>
> > > > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > > > host='localhost'))
> > > > channel = connection.channel()
>
> > > > channel.queue_declare(queue='task_queue', durable=True)
> > > > print ' [*] Waiting for messages. To exit press CTRL+C'
>
> > > > def callback(ch, method, properties, body):
> > > > print " [x] Received %r" % (body,)
> > > > time.sleep( body.count('.') )
> > > > print " [x] Done"
> > > > ch.basic_ack(delivery_tag = method.delivery_tag)
>
> > > > channel.basic_qos(prefetch_count=1)
> > > > channel.basic_consume(callback,
> > > > queue='task_queue')
>
> > > > channel.start_consuming()
>
> > > > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > > Are you using the BlockingConnection adapter?
>
> > > > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > > > python worker.py
> > > > > > [*] Waiting for messages. To exit press CTRL+C
> > > > > > Traceback (most recent call last):
> > > > > > File "worker.py", line 22, in ?
> > > > > > channel.start_consuming()
> > > > > > AttributeError: Channel instance has no attribute 'start_consuming'
>
> > > > > > I got pika 0.9.5
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com) (mailto:
> > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > > > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com)
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss(http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com (mailto:rabbitmq-disc... at lists.rabbitmq.com)
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rafalkot at gmail.com  Tue May 31 19:30:25 2011
From: rafalkot at gmail.com (KooT)
Date: Tue, 31 May 2011 11:30:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
In-Reply-To: <1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
	<e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>
	<1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
Message-ID: <f7d1f8af-2cdd-47ba-9cc9-4e2d88a9487d@z33g2000yqb.googlegroups.com>

You are right.

rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
0.9.5

It was old pika dir... i dont know how... b

On 31 Maj, 20:25, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> That doesn't look like a 0.9.5 install.
>
> Have you tried pip or easy_install?
>
> gmr at binti ~ $ sudo pip install pika
> Downloading/unpacking pika
> Downloading pika-0.9.5.tar.gz
> Running setup.py egg_info for package pika
> Installing collected packages: pika
> Running setup.py install for pika
> Successfully installed pika
> Cleaning up...
> gmr at binti ~ $ python -c "import pika;print pika.__version__"
> 0.9.5
>
>
>
>
>
>
>
> On Tuesday, May 31, 2011 at 2:21 PM, KooT wrote:
> > rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
> > Traceback (most recent call last):
> > ?File "<string>", line 1, in <module>
> > AttributeError: 'module' object has no attribute '__version__'
>
> > On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > Sounds like it may not be Pika 0.9.5, how did you install?
>
> > > What output do you get if you do:
>
> > > python -c "import pika;print pika.__version__"
>
> > > On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com (http://gmail.com)> wrote:
> > > > Yes, its worker.py from
> > > >http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> > > > #!/usr/bin/env python
> > > > import pika
> > > > import time
>
> > > > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > > > host='localhost'))
> > > > channel = connection.channel()
>
> > > > channel.queue_declare(queue='task_queue', durable=True)
> > > > print ' [*] Waiting for messages. To exit press CTRL+C'
>
> > > > def callback(ch, method, properties, body):
> > > > print " [x] Received %r" % (body,)
> > > > time.sleep( body.count('.') )
> > > > print " [x] Done"
> > > > ch.basic_ack(delivery_tag = method.delivery_tag)
>
> > > > channel.basic_qos(prefetch_count=1)
> > > > channel.basic_consume(callback,
> > > > queue='task_queue')
>
> > > > channel.start_consuming()
>
> > > > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > > Are you using the BlockingConnection adapter?
>
> > > > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > > > python worker.py
> > > > > > [*] Waiting for messages. To exit press CTRL+C
> > > > > > Traceback (most recent call last):
> > > > > > File "worker.py", line 22, in ?
> > > > > > channel.start_consuming()
> > > > > > AttributeError: Channel instance has no attribute 'start_consuming'
>
> > > > > > I got pika 0.9.5
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com) (mailto:
> > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > > > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com)
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss(http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com (mailto:rabbitmq-disc... at lists.rabbitmq.com)
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rafalkot at gmail.com  Tue May 31 19:30:50 2011
From: rafalkot at gmail.com (KooT)
Date: Tue, 31 May 2011 11:30:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
In-Reply-To: <1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
	<e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>
	<1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
Message-ID: <f9498df6-d9e5-49d7-9d91-134aaf2ff67c@e35g2000yqc.googlegroups.com>



On 31 Maj, 20:25, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> That doesn't look like a 0.9.5 install.
>
> Have you tried pip or easy_install?
>
> gmr at binti ~ $ sudo pip install pika
> Downloading/unpacking pika
> Downloading pika-0.9.5.tar.gz
> Running setup.py egg_info for package pika
> Installing collected packages: pika
> Running setup.py install for pika
> Successfully installed pika
> Cleaning up...
> gmr at binti ~ $ python -c "import pika;print pika.__version__"
> 0.9.5
>
>
>
>
>
>
>
> On Tuesday, May 31, 2011 at 2:21 PM, KooT wrote:
> > rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
> > Traceback (most recent call last):
> > ?File "<string>", line 1, in <module>
> > AttributeError: 'module' object has no attribute '__version__'
>
> > On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > Sounds like it may not be Pika 0.9.5, how did you install?
>
> > > What output do you get if you do:
>
> > > python -c "import pika;print pika.__version__"
>
> > > On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com (http://gmail.com)> wrote:
> > > > Yes, its worker.py from
> > > >http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> > > > #!/usr/bin/env python
> > > > import pika
> > > > import time
>
> > > > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > > > host='localhost'))
> > > > channel = connection.channel()
>
> > > > channel.queue_declare(queue='task_queue', durable=True)
> > > > print ' [*] Waiting for messages. To exit press CTRL+C'
>
> > > > def callback(ch, method, properties, body):
> > > > print " [x] Received %r" % (body,)
> > > > time.sleep( body.count('.') )
> > > > print " [x] Done"
> > > > ch.basic_ack(delivery_tag = method.delivery_tag)
>
> > > > channel.basic_qos(prefetch_count=1)
> > > > channel.basic_consume(callback,
> > > > queue='task_queue')
>
> > > > channel.start_consuming()
>
> > > > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > > Are you using the BlockingConnection adapter?
>
> > > > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > > > python worker.py
> > > > > > [*] Waiting for messages. To exit press CTRL+C
> > > > > > Traceback (most recent call last):
> > > > > > File "worker.py", line 22, in ?
> > > > > > channel.start_consuming()
> > > > > > AttributeError: Channel instance has no attribute 'start_consuming'
>
> > > > > > I got pika 0.9.5
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com) (mailto:
> > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > > > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com)
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss(http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com (mailto:rabbitmq-disc... at lists.rabbitmq.com)
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rafalkot at gmail.com  Tue May 31 19:31:18 2011
From: rafalkot at gmail.com (KooT)
Date: Tue, 31 May 2011 11:31:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
In-Reply-To: <1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
	<e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>
	<1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
Message-ID: <ddef18ef-f616-4667-adad-f40154e52606@g12g2000yqd.googlegroups.com>

Thank You very much for Your time and help!


On 31 Maj, 20:25, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> That doesn't look like a 0.9.5 install.
>
> Have you tried pip or easy_install?
>
> gmr at binti ~ $ sudo pip install pika
> Downloading/unpacking pika
> Downloading pika-0.9.5.tar.gz
> Running setup.py egg_info for package pika
> Installing collected packages: pika
> Running setup.py install for pika
> Successfully installed pika
> Cleaning up...
> gmr at binti ~ $ python -c "import pika;print pika.__version__"
> 0.9.5
>
>
>
>
>
>
>
> On Tuesday, May 31, 2011 at 2:21 PM, KooT wrote:
> > rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
> > Traceback (most recent call last):
> > ?File "<string>", line 1, in <module>
> > AttributeError: 'module' object has no attribute '__version__'
>
> > On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > Sounds like it may not be Pika 0.9.5, how did you install?
>
> > > What output do you get if you do:
>
> > > python -c "import pika;print pika.__version__"
>
> > > On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com (http://gmail.com)> wrote:
> > > > Yes, its worker.py from
> > > >http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> > > > #!/usr/bin/env python
> > > > import pika
> > > > import time
>
> > > > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > > > host='localhost'))
> > > > channel = connection.channel()
>
> > > > channel.queue_declare(queue='task_queue', durable=True)
> > > > print ' [*] Waiting for messages. To exit press CTRL+C'
>
> > > > def callback(ch, method, properties, body):
> > > > print " [x] Received %r" % (body,)
> > > > time.sleep( body.count('.') )
> > > > print " [x] Done"
> > > > ch.basic_ack(delivery_tag = method.delivery_tag)
>
> > > > channel.basic_qos(prefetch_count=1)
> > > > channel.basic_consume(callback,
> > > > queue='task_queue')
>
> > > > channel.start_consuming()
>
> > > > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > > Are you using the BlockingConnection adapter?
>
> > > > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > > > python worker.py
> > > > > > [*] Waiting for messages. To exit press CTRL+C
> > > > > > Traceback (most recent call last):
> > > > > > File "worker.py", line 22, in ?
> > > > > > channel.start_consuming()
> > > > > > AttributeError: Channel instance has no attribute 'start_consuming'
>
> > > > > > I got pika 0.9.5
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com) (mailto:
> > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > > > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com)
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss(http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com (mailto:rabbitmq-disc... at lists.rabbitmq.com)
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at myyearbook.com  Tue May 31 19:32:03 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 31 May 2011 14:32:03 -0400
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
 attribute 'start_consuming'
In-Reply-To: <c601f5a3-9d7a-4bf3-be41-6c480c3f28d2@z13g2000yqg.googlegroups.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
	<e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>
	<1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
	<c601f5a3-9d7a-4bf3-be41-6c480c3f28d2@z13g2000yqg.googlegroups.com>
Message-ID: <9C776B18231D420BA49AB1539493BF05@myyearbook.com>

Is it possible that an older version of pika is also installed in the global scope?

You could install in virtualenv to keep it local:

gmr at binti ~ $ virtualenv --no-site-packages test
New python executable in test/bin/python2.6
Also creating executable in test/bin/python
Installing setuptools............done.
Installing pip...............done.
gmr at binti ~ $ cd test/
gmr at binti ~/test $ ls
bin include lib lib64
gmr at binti ~/test $ source bin/activate
(test)gmr at binti ~/test $ pip install pika
Downloading/unpacking pika
Downloading pika-0.9.5.tar.gz
Running setup.py egg_info for package pika
Installing collected packages: pika
Running setup.py install for pika
Successfully installed pika
Cleaning up...
(test)gmr at binti ~/test $ python -c "import pika;print pika.__version__"
0.9.5
(test)gmr at binti ~/test $ 


On Tuesday, May 31, 2011 at 2:27 PM, KooT wrote:

> I don't have root access there, i want pika as local lib :|
> 
> On 31 Maj, 20:25, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > That doesn't look like a 0.9.5 install.
> > 
> > Have you tried pip or easy_install?
> > 
> > gmr at binti ~ $ sudo pip install pika
> > Downloading/unpacking pika
> > Downloading pika-0.9.5.tar.gz
> > Running setup.py egg_info for package pika
> > Installing collected packages: pika
> > Running setup.py install for pika
> > Successfully installed pika
> > Cleaning up...
> > gmr at binti ~ $ python -c "import pika;print pika.__version__"
> > 0.9.5
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > On Tuesday, May 31, 2011 at 2:21 PM, KooT wrote:
> > > rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
> > > Traceback (most recent call last):
> > > File "<string>", line 1, in <module>
> > > AttributeError: 'module' object has no attribute '__version__'
> > 
> > > On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > Sounds like it may not be Pika 0.9.5, how did you install?
> > 
> > > > What output do you get if you do:
> > 
> > > > python -c "import pika;print pika.__version__"
> > 
> > > > On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com (http://gmail.com)> wrote:
> > > > > Yes, its worker.py from
> > > > > http://www.rabbitmq.com/tutorials/tutorial-two-python.html
> > 
> > > > > #!/usr/bin/env python
> > > > > import pika
> > > > > import time
> > 
> > > > > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > > > > host='localhost'))
> > > > > channel = connection.channel()
> > 
> > > > > channel.queue_declare(queue='task_queue', durable=True)
> > > > > print ' [*] Waiting for messages. To exit press CTRL+C'
> > 
> > > > > def callback(ch, method, properties, body):
> > > > > print " [x] Received %r" % (body,)
> > > > > time.sleep( body.count('.') )
> > > > > print " [x] Done"
> > > > > ch.basic_ack(delivery_tag = method.delivery_tag)
> > 
> > > > > channel.basic_qos(prefetch_count=1)
> > > > > channel.basic_consume(callback,
> > > > > queue='task_queue')
> > 
> > > > > channel.start_consuming()
> > 
> > > > > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > > > Are you using the BlockingConnection adapter?
> > 
> > > > > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > > > > python worker.py
> > > > > > > [*] Waiting for messages. To exit press CTRL+C
> > > > > > > Traceback (most recent call last):
> > > > > > > File "worker.py", line 22, in ?
> > > > > > > channel.start_consuming()
> > > > > > > AttributeError: Channel instance has no attribute 'start_consuming'
> > 
> > > > > > > I got pika 0.9.5
> > > > > > > _______________________________________________
> > > > > > > rabbitmq-discuss mailing list
> > > > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com) (mailto:
> > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > > > > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com)
> > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss(http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com (mailto:rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/d4d88a85/attachment-0001.htm>

From simon at rabbitmq.com  Tue May 31 22:42:30 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 31 May 2011 22:42:30 +0100
Subject: [rabbitmq-discuss] rabbitmq-management plugin crashes clustered
	rabbit 2.4.1
In-Reply-To: <BANLkTinBZbo-BFxRYwEJKRvZA04rkeSh2Q@mail.gmail.com>
References: <BANLkTim2-9Yf8ftpjGtRaXfvKWa1mWRo9A@mail.gmail.com>
	<4DE4FDA8.7040606@rabbitmq.com>
	<BANLkTikN2sXb_1aTC7Y7ViQrsSp5L2ecEA@mail.gmail.com>
	<4DE50FE4.3020308@rabbitmq.com>
	<BANLkTikjCRSpDg50dSfTDvygJXTA2Bitag@mail.gmail.com>
	<4DE518E0.3000704@rabbitmq.com> <4DE51F41.2080209@rabbitmq.com>
	<BANLkTinBZbo-BFxRYwEJKRvZA04rkeSh2Q@mail.gmail.com>
Message-ID: <8f46cf6b-cd94-4653-a421-32631182d330@email.android.com>

Yes please! That would help confirm exactly what's happening.

Cheers, Simon
-- 
Sent from my Android phone with K-9 Mail. Please excuse my brevity.

Ian Patton <ian.patton at gmail.com> wrote:

That worked!  Do you want to see any output?


Ian

On Tue, May 31, 2011 at 1:02 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

On 31/05/11 17:35, Simon MacMullen wrote:

On 31/05/11 17:08, Ian Patton wrote:

I can create a virtual machine image and ssh it to some server for you
to grab... if you have such a place to put it. If so, let me know which
hypervisor you prefer (ESX, Xen, KVM, etc)


I'd prefer ESX but anything really. I'm afraid I don't have a place for
you to oput it; could you put it somewhere I could retrieve it?


Actually, could you give this a try:

http://www.rabbitmq.com/releases/plugins/test/rabbitmq-management-2.4.1-globals-debug.ez

It contains some additional logging code, as well as a stab-in-the-dark attempt at a fix. Please install it instead of rabbitmq-management-2.4.1.ez on all the cluster nodes, and then send me the logs from *all* the nodes.

Thanks for your help.



Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware




-- 

C. Ian Patton


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110531/8e87c7e3/attachment.htm>

From brett.r.cameron at gmail.com  Tue May 31 22:43:42 2011
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 1 Jun 2011 09:43:42 +1200
Subject: [rabbitmq-discuss] libRabbitMQ on OpenVMS
Message-ID: <BANLkTi=+NFrsFsNKayK8RBwXLgE4JFUSyg@mail.gmail.com>

FYI, for anyone interested in using RabbitMQ with HP OpenVMS, we've put
together a version of the C API that can be readily incorporated into
OpenVMS applications written in pretty much any 3GL. See
http://rabbitmqonopenvs.blogspot.com/2011/05/librabbitmq-v10-released-on-openvms.html
for
details.

Brett
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110601/740bdd36/attachment.htm>

