<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] New exchange type
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20New%20exchange%20type&In-Reply-To=ffa3c1da0804222019g5ea00885j57a68b9dac806385%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000752.html">
   <LINK REL="Next"  HREF="000754.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] New exchange type</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20New%20exchange%20type&In-Reply-To=ffa3c1da0804222019g5ea00885j57a68b9dac806385%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] New exchange type">matthias at lshift.net
       </A><BR>
    <I>Wed Apr 23 06:18:57 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000752.html">[rabbitmq-discuss] New exchange type
</A></li>
        <LI>Next message: <A HREF="000754.html">[rabbitmq-discuss] New exchange type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#753">[ date ]</a>
              <a href="thread.html#753">[ thread ]</a>
              <a href="subject.html#753">[ subject ]</a>
              <a href="author.html#753">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Kyle,

Kyle wrote:
&gt;<i> Matthias,
</I>&gt;<i>     - use a flag in the process dictionary to indicate whether the
</I>&gt;<i>     random number generator has been seeded. Check/set that flag in your
</I>&gt;<i>     current code that invokes random:uniform. This has the same effect
</I>&gt;<i>     as the previous approach but is a less intrusive change since you
</I>&gt;<i>     don't need to touch any other modules.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Got this working, and less intrusive wins out in my mind. I'll send out 
</I>&gt;<i> another version of the diff when I get to the above change, or if I 
</I>&gt;<i> leave that on the back burner for too long.
</I>
Btw, if you look at the code (and docs) of the 'random' module you'll 
see it is using the process dictionary already to remember the last 
seed. So, to save duplication of work, I'd use something like the following:

random_uniform(N) -&gt;
     Seed = case get(random_seed) of
                undefined -&gt; erlang:now();
                Tuple -&gt; Tuple
            end,
     {V, NewSeed} = random:uniform_s(N, Seed),
     put(random_seed, NewSeed),
     V.

&gt;<i>  From what I could tell from the RabbitMQ docs,  even if I have a single 
</I>&gt;<i> exchange, messages can be routed through any node in the cluster. 
</I>&gt;<i> Therefore there should be no significant bottleneck with a single 
</I>&gt;<i> exchange, because there is no single node that all messages must go 
</I>&gt;<i> through. With a single queue, however, every message has to be sent to 
</I>&gt;<i> the machine on which that queue lives, after which different subscribers 
</I>&gt;<i> can pull messages off. This looks like a bottleneck to me, where all 
</I>&gt;<i> messages go through one machine, whereas a single exchange does not have 
</I>&gt;<i> that problem (unless I missed something).
</I>
That analysis is correct. I think what Martin is getting at is that this 
is really an implementation issue - in principle AMQP queues do what you 
want, it just so happens that in RabbitMQ they are implemented as a 
single (Erlang) process rather than being distributed. The latter is 
something we are looking into, but it will take a while to implement. 
Meanwhile your solution is an excellent way of addressing the problem.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000752.html">[rabbitmq-discuss] New exchange type
</A></li>
	<LI>Next message: <A HREF="000754.html">[rabbitmq-discuss] New exchange type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#753">[ date ]</a>
              <a href="thread.html#753">[ thread ]</a>
              <a href="subject.html#753">[ subject ]</a>
              <a href="author.html#753">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
