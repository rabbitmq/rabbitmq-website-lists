<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] pub-sub part 2: erlang consume
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20pub-sub%20part%202%3A%20erlang%20consume&In-Reply-To=50ec7a2e0804101318g3d1c84by9521fe2f133b4ec%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000698.html">
   <LINK REL="Next"  HREF="000701.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] pub-sub part 2: erlang consume</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20pub-sub%20part%202%3A%20erlang%20consume&In-Reply-To=50ec7a2e0804101318g3d1c84by9521fe2f133b4ec%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] pub-sub part 2: erlang consume">0x6e6562 at gmail.com
       </A><BR>
    <I>Thu Apr 10 22:40:46 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000698.html">[rabbitmq-discuss] pub-sub part 2: erlang consume
</A></li>
        <LI>Next message: <A HREF="000701.html">[rabbitmq-discuss] pub-sub part 2: erlang consume
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#699">[ date ]</a>
              <a href="thread.html#699">[ thread ]</a>
              <a href="subject.html#699">[ subject ]</a>
              <a href="author.html#699">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Joe,

On 10 Apr 2008, at 21:18, Joe Lee wrote:

&gt;<i> Does null queue have any special functionality?
</I>&gt;<i>
</I>
Not really. As you correctly observe below, the expected behaviour of  
passing an empty queue name is that the broker fills this in for you  
and tells you what name it gave the queue. This is also the behaviour  
of RabbitMQ.

&gt;<i>
</I>&gt;<i> Abstract from the amqp docs:
</I>&gt;<i>
</I>&gt;<i> 2.1.5.3 Constructing a PubSub
</I>&gt;<i> Subscription Queue
</I>&gt;<i>
</I>&gt;<i> Here is the pseudocode
</I>&gt;<i> for creating and binding the pubsub subscription queue:
</I>&gt;<i> Queue.Declare
</I>&gt;<i>     queue=&lt;empty&gt;
</I>&gt;<i>     auto_delete=TRUE
</I>&gt;<i> S:Queue.Declare-Ok
</I>&gt;<i>     queue=tmp.2
</I>&gt;<i> Queue.Bind
</I>&gt;<i>     queue=tmp.2
</I>&gt;<i>     TO exchange=amq.topic
</I>&gt;<i>     WHERE routing_key=STOCK.USD.*
</I>&gt;<i>
</I>&gt;<i> To consume from the subscription queue, the consumer does this:
</I>&gt;<i>
</I>&gt;<i> Basic.Consume
</I>&gt;<i>     queue=tmp.2
</I>&gt;<i>
</I>&gt;<i> When publishing a message, the producer does something like this:
</I>&gt;<i>
</I>&gt;<i> Basic.Publish
</I>&gt;<i>     exchange=amq.topic
</I>&gt;<i>     routing_key=STOCK.USD.IBM
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Maybe you can tell us what you are trying to achieve.
</I>&gt;<i>
</I>&gt;<i> I just want to do simple publish a message and then consume the  
</I>&gt;<i> message.
</I>

This will work with Rabbit. The issue I think you are have is not to  
do with non-compliance with the specification.

As I said in my previous mail, I think you have a bug in your code  
where you match the response of the queue declare call.

In your code, one of the fields of the tuple you are matching on is  
already bound, and as Erlang doesn't allow destructive assignment, it  
treats the assignment operator in this context as a comparison.

The way to fix this is the following:

'queue.declare_ok'{
		       %% Don't use the previously bound variable called Q to store  
the
		       %% queue name field because the Erlang runtime will complain
		       queue = SomeVariableNameOtherThanTheOneYouPreviouslyAssigned,
                        message_count = MessageCount,
                        consumer_count = ConsumerCount}
                        = amqp_channel:call(Channel,QueueDeclare)

and then perform a basic consume using the value stored in the  
variable &quot;SomeVariableNameOtherThanTheOneYouPreviouslyAssigned&quot;.

HTH,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080410/65236243/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080410/65236243/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000698.html">[rabbitmq-discuss] pub-sub part 2: erlang consume
</A></li>
	<LI>Next message: <A HREF="000701.html">[rabbitmq-discuss] pub-sub part 2: erlang consume
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#699">[ date ]</a>
              <a href="thread.html#699">[ thread ]</a>
              <a href="subject.html#699">[ subject ]</a>
              <a href="author.html#699">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
