<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ and monit?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20monit%3F&In-Reply-To=167204d20804090752s1c850783h2e35ccb7b5f6393f%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000681.html">
   <LINK REL="Next"  HREF="000684.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ and monit?</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20monit%3F&In-Reply-To=167204d20804090752s1c850783h2e35ccb7b5f6393f%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ and monit?">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Wed Apr  9 17:33:08 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000681.html">[rabbitmq-discuss] RabbitMQ and monit?
</A></li>
        <LI>Next message: <A HREF="000684.html">[rabbitmq-discuss] RabbitMQ and monit?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#683">[ date ]</a>
              <a href="thread.html#683">[ thread ]</a>
              <a href="subject.html#683">[ subject ]</a>
              <a href="author.html#683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Steve,

You can obtain broker's OS process ID by something like this:
sed 's/.*,\(.*\)\}.*/\1/' /var/lib/rabbitmq/pids &gt; /var/run/rabbitmq.pid
or
perl -ne 'm/,(.*)}/; print $1' /var/lib/rabbitmq/pids

(put it somewhere inside startup script around echo SUCCESS)


This will work if you have one rabbit node. If you have multiple, you can create multiple 
pid files for monit from /var/lib/rabbitmq/pids and monitor each process separately.


And then for monit:

check process rabbitmq-broker with pidfile /var/run/rabbitmq.pid
  start program = &quot;/etc/init.d/rabbitmq start&quot;
  stop program = &quot;/etc/init.d/rabbitmq stop&quot;
  if 5 restarts within 5 cycles then timeout
  alert <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">someone at example.com</A> only on { timeout }

Something like this might work. Please note however that I don't actually run this setup - 
it's just how I might do it when I get around to it.

- Dmitriy



Alexis Richardson wrote:
&gt;<i> Steve
</I>&gt;<i> 
</I>&gt;<i> It's the first I'd heard of it.  Is it something that you would recommend?
</I>&gt;<i> 
</I>&gt;<i> alexis
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Tue, Apr 8, 2008 at 8:02 PM, Steve Jenson &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">stevej at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Does anybody out there use rabbitmq with monit?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Thanks,
</I>&gt;&gt;<i>  Steve
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  _______________________________________________
</I>&gt;&gt;<i>  rabbitmq-discuss mailing list
</I>&gt;&gt;<i>  <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i>  <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000681.html">[rabbitmq-discuss] RabbitMQ and monit?
</A></li>
	<LI>Next message: <A HREF="000684.html">[rabbitmq-discuss] RabbitMQ and monit?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#683">[ date ]</a>
              <a href="thread.html#683">[ thread ]</a>
              <a href="subject.html#683">[ subject ]</a>
              <a href="author.html#683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
