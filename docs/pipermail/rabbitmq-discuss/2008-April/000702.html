<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] pub-sub part 2: erlang consume
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20pub-sub%20part%202%3A%20erlang%20consume&In-Reply-To=50ec7a2e0804102124v1bc2ef78rc2b3c53056191e84%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000701.html">
   <LINK REL="Next"  HREF="000704.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] pub-sub part 2: erlang consume</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20pub-sub%20part%202%3A%20erlang%20consume&In-Reply-To=50ec7a2e0804102124v1bc2ef78rc2b3c53056191e84%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] pub-sub part 2: erlang consume">0x6e6562 at gmail.com
       </A><BR>
    <I>Fri Apr 11 06:36:16 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000701.html">[rabbitmq-discuss] pub-sub part 2: erlang consume
</A></li>
        <LI>Next message: <A HREF="000704.html">[rabbitmq-discuss] pub-sub part 2: erlang consume
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#702">[ date ]</a>
              <a href="thread.html#702">[ thread ]</a>
              <a href="subject.html#702">[ subject ]</a>
              <a href="author.html#702">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 11 Apr 2008, at 05:24, Joe Lee wrote:

&gt;<i> Hello all,
</I>&gt;<i>
</I>&gt;<i> On Thu, Apr 10, 2008 at 6:55 AM, Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt; wrote:
</I>&gt;<i> You are trying to match this tuple
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #'queue.declare_ok'{queue = Q,
</I>&gt;<i>                        message_count = MessageCount,
</I>&gt;<i>                        consumer_count = ConsumerCount}
</I>&gt;<i>                       = amqp_channel:call(Channel,QueueDeclare)
</I>&gt;<i>
</I>&gt;<i> with this tuple:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> {'queue.declare_ok',
</I>&gt;<i>                         &lt;&lt;&quot;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">amq.q.gen1_rabbit at home_20080409224223_</A>&quot;&gt;&gt;, 
</I>&gt;<i> 0,0}
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> so that fact that Q, which was previously bound to &lt;&lt;&quot;&quot;&gt;&gt; is being  
</I>&gt;<i> compared to &lt;&quot;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">amq.q.gen1_rabbit at home_20080409224223_</A>&quot;&gt;&gt; which  
</I>&gt;<i> violates the match condition.
</I>&gt;<i>
</I>&gt;<i> To fix this, don't re-use the *variable* Q, because in Erlang, it's  
</I>&gt;<i> not really a variable (non-destructive assignment).
</I>&gt;<i>
</I>&gt;<i> I have tried what Ben suggested and used a new variable called Q1.   
</I>&gt;<i> It helped me get over that problem.  Now I have another issue with  
</I>&gt;<i> the consume code.
</I>&gt;<i>
</I>&gt;<i> I tried looking into mnesia tables and ets tables, but not much  
</I>&gt;<i> help.  Receive is timing out at after 2000 -&gt;   
</I>&gt;<i> exit(did_not_receive_message) end.  Only reason for to get timeout  
</I>&gt;<i> is when there isn't a message in the exchange.  This shouldn't be  
</I>&gt;<i> the case because I just published the message.
</I>&gt;<i>
</I>&gt;<i>  receive
</I>&gt;<i>         {#'basic.deliver'{delivery_tag = DeliveryTag}, Content} -&gt;
</I>&gt;<i>             #content{payload_fragments_rev = [Payload]} = Content,
</I>&gt;<i>             io:format(&quot;Message received: ~p~n&quot;, [Payload])
</I>&gt;<i>     after 2000 -&gt;
</I>&gt;<i>         exit(did_not_receive_message)
</I>&gt;<i>     end
</I>
f you are using the same code that you posted yesterday, this won't  
work because you are consuming from the wrong queue:

BasicConsume = #'basic.consume'{ticket = Ticket,
                                     queue = Q,
                                     consumer_tag = &lt;&lt;&quot;&quot;&gt;&gt;,
                                     no_local = false,
                                     no_ack = true,
                                     exclusive = false,
                                     nowait = false},
     #'basic.consume_ok'{consumer_tag = ConsumerTag}
         = amqp_channel:call(Channel, BasicConsume, self()),

You need to consume from the queue whose name you stored in Q1.

HTH,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080411/86b94c19/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080411/86b94c19/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000701.html">[rabbitmq-discuss] pub-sub part 2: erlang consume
</A></li>
	<LI>Next message: <A HREF="000704.html">[rabbitmq-discuss] pub-sub part 2: erlang consume
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#702">[ date ]</a>
              <a href="thread.html#702">[ thread ]</a>
              <a href="subject.html#702">[ subject ]</a>
              <a href="author.html#702">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
