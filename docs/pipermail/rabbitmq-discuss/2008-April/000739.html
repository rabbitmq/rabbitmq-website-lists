<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Just publishing messages causes	rabbit_writer:mainloop to hang and simultaneous pub problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Just%20publishing%20messages%20causes%0A%09rabbit_writer%3Amainloop%20to%20hang%20and%20simultaneous%20pub%20problem&In-Reply-To=50ec7a2e0804161721oa0fb604j925e2303a807c5e7%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000738.html">
   <LINK REL="Next"  HREF="000740.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Just publishing messages causes	rabbit_writer:mainloop to hang and simultaneous pub problem</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Just%20publishing%20messages%20causes%0A%09rabbit_writer%3Amainloop%20to%20hang%20and%20simultaneous%20pub%20problem&In-Reply-To=50ec7a2e0804161721oa0fb604j925e2303a807c5e7%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Just publishing messages causes	rabbit_writer:mainloop to hang and simultaneous pub problem">0x6e6562 at gmail.com
       </A><BR>
    <I>Thu Apr 17 08:08:12 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000738.html">[rabbitmq-discuss] Just publishing messages causes	rabbit_writer:mainloop to hang and simultaneous pub problem
</A></li>
        <LI>Next message: <A HREF="000740.html">[rabbitmq-discuss] Just publishing messages causes	rabbit_writer:mainloop to hang and simultaneous pub problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#739">[ date ]</a>
              <a href="thread.html#739">[ thread ]</a>
              <a href="subject.html#739">[ subject ]</a>
              <a href="author.html#739">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Joe,

On 17 Apr 2008, at 01:21, Joe Lee wrote:
&gt;<i> BTW, if you don't supply a host name when starting the connection,  
</I>&gt;<i> the client will start in a direct mode using native Erlang message  
</I>&gt;<i> passing rather than AMQP wire framing. This means that the client  
</I>&gt;<i> and server run in the same interpreter and eliminate the network  
</I>&gt;<i> overhead.
</I>&gt;<i> Is this valid also when running rabbitmq erlang client and rabbitmq  
</I>&gt;<i> server on separate erlang nodes?
</I>
Currently not. At the moment the direct driver only uses local message  
passing. It is conceivable that the direct driver could use Erlang's  
internode communication, but I guess you'd have to message this  
approach against normal AMQP wire framing. In both approaches you  
would have to serialize and deserialize to get the data over the wire.  
If the Erlang variant is significantly more efficient that AMQP, it  
might be worth looking into and benchmarking.

The main point  is that the client API provides a uniform interface to  
user code, irrespective of the actual physical message passing  
technology.

&gt;<i> I sent 3 amqp message to the rabbitmq broker from a separate erlang  
</I>&gt;<i> client node.  The three 3 amqp messages create 3  
</I>&gt;<i> rabbit_writer:mainloop/1 processes.  This rabbit_writer:mainloop/1  
</I>&gt;<i> process never goes away.
</I>&gt;<i>
</I>&gt;<i> &lt;0.71.0&gt;              rabbit_writer:mainloop/1                
</I>&gt;<i> 233      132    0
</I>&gt;<i>                       rabbit_writer:mainloop/1                 2
</I>&gt;<i> &lt;0.72.0&gt;              rabbit_writer:mainloop/1                
</I>&gt;<i> 233      132    0
</I>&gt;<i>                       rabbit_writer:mainloop/1                 2
</I>&gt;<i> &lt;0.73.0&gt;              rabbit_writer:mainloop/1                
</I>&gt;<i> 233      132    0
</I>&gt;<i>                       rabbit_writer:mainloop/1                 2
</I>&gt;<i>
</I>&gt;<i> One rabbit_writer:mainloop process traced:
</I>&gt;<i>
</I>&gt;<i> initial_call: rabbit_writer:mainloop/1
</I>&gt;<i> current_function: rabbit_writer:mainloop/1
</I>&gt;<i> heap_size: 233
</I>&gt;<i> stack_size: 2
</I>&gt;<i> reductions: 132
</I>&gt;<i> trap_exit: false
</I>&gt;<i> &lt;0.72.0&gt;: getting_linked   &lt;0.112.0&gt;
</I>&gt;<i>
</I>&gt;<i> After that I increased number of processes on a single erlang node  
</I>&gt;<i> to something higer than 50 000 and sent 50 000 messages.  For some  
</I>&gt;<i> reason, 50 000 rabbit_writer:mainloop processes are still there.   
</I>&gt;<i> They don't go away.  Processes only go away when I restart the  
</I>&gt;<i> rabbit erlang client node.
</I>&gt;<i>
</I>&gt;<i> 7&gt; erlang:system_info(process_count).
</I>&gt;<i> 50044
</I>
Can you send the source of the test that is producing this behaviour,  
please?

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000738.html">[rabbitmq-discuss] Just publishing messages causes	rabbit_writer:mainloop to hang and simultaneous pub problem
</A></li>
	<LI>Next message: <A HREF="000740.html">[rabbitmq-discuss] Just publishing messages causes	rabbit_writer:mainloop to hang and simultaneous pub problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#739">[ date ]</a>
              <a href="thread.html#739">[ thread ]</a>
              <a href="subject.html#739">[ subject ]</a>
              <a href="author.html#739">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
