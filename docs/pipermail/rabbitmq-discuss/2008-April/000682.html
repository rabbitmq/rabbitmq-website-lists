<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ perfomance testing &amp; troubles
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20perfomance%20testing%20%26%20troubles&In-Reply-To=47FCA0A7.5000006%40brandproduction.ru">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000673.html">
   <LINK REL="Next"  HREF="000725.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ perfomance testing &amp; troubles</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20perfomance%20testing%20%26%20troubles&In-Reply-To=47FCA0A7.5000006%40brandproduction.ru"
       TITLE="[rabbitmq-discuss] RabbitMQ perfomance testing &amp; troubles">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Wed Apr  9 16:56:04 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000673.html">[rabbitmq-discuss] RabbitMQ perfomance testing &amp; troubles
</A></li>
        <LI>Next message: <A HREF="000725.html">[rabbitmq-discuss] RabbitMQ perfomance testing &amp; troubles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#682">[ date ]</a>
              <a href="thread.html#682">[ thread ]</a>
              <a href="subject.html#682">[ subject ]</a>
              <a href="author.html#682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Alexey,

Alexey Slynko wrote:
&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> we have done some stress tests of rabbitmq. Our main goal was the ~10K
</I>&gt;<i> messages per second and maximum cpu &amp; ram usage. Two servers with equal
</I>&gt;<i> configuration listed below were used for this task.
</I>&gt;<i> 
</I>What is your projected number of clients (producers and consumers combined)? In your tests 
below, it looks to me like you had 200, 1000 and 2000 clients - are these your expected 
levels? Each client is a socket. I think you might get higher throughput by reducing the 
number of clients.


&gt;<i> There is a system state after rabbitmq startup:
</I>&gt;<i> 
</I>&gt;<i> top - 22:41:58 up 3 days,  5:10,  3 users,  load average: 0.00, 0.00, 0.00
</I>&gt;<i>    PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
</I>&gt;<i> 31089 rabbitmq  15   0 2499m  15m 1620 S    0  0.4   0:00.29 beam.smp
</I>

&gt;<i> 
</I>&gt;<i> So, let's try to start 100 producer's and
</I>&gt;<i> 100 consumer's. Each producer generate 10 msgs/sec (t
</I>&gt;<i> 1000 msgs/sec at all)
</I>May I suggest increasing the number of messages per second as an alternative test (instead 
of increasing the number of clients)?

&gt;<i> 
</I>&gt;<i> $ java -jar RabbitmqFastMessagingProducerTest.jar 100 &gt; client.log
</I>&gt;<i> 
</I>&gt;<i> System snapshot:
</I>&gt;<i> 
</I>&gt;<i> top - 22:50:39 up 3 days,  5:19,  3 users,  load average: 0.51, 0.11, 0.04
</I>&gt;<i> 
</I>&gt;<i>    PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
</I>&gt;<i> 
</I>&gt;<i> 31089 rabbitmq  15   0 2520m  33m 1620 S  281  0.8   0:45.94 beam.smp
</I>&gt;<i> 
</I>&gt;&gt;<i> $ java -jar RabbitmqFastMessagingProducerTest.jar 500 &gt; client.log
</I>&gt;<i> 
</I>&gt;<i>   top - 23:22:10 up 3 days,  5:51,  3 users,  load average: 4.91, 2.89,  
</I>&gt;<i>    PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
</I>&gt;<i> 
</I>&gt;<i> 31566 rabbitmq  15   0 3062m 572m 1620 S  412 14.2  12:14.58 beam.smp
</I>

It also looks like you restarted the broker before you ran the last top above (changed 
PID). Is there a way to capture its memory footprint right after restart? The difference 
in virt mem is 500M, which is 20% of what the first top shows.


I think one of your your biggest bottlenecks in this case is the number of sockets that 
you ask your OS to juggle at the same time (I may be wrong however). Things you might want 
to try:
1. reduce the number of clients
2. reduce the number of sockets each broker has to open by setting up a RabbitMQ cluster


- Dmitriy




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000673.html">[rabbitmq-discuss] RabbitMQ perfomance testing &amp; troubles
</A></li>
	<LI>Next message: <A HREF="000725.html">[rabbitmq-discuss] RabbitMQ perfomance testing &amp; troubles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#682">[ date ]</a>
              <a href="thread.html#682">[ thread ]</a>
              <a href="subject.html#682">[ subject ]</a>
              <a href="author.html#682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
