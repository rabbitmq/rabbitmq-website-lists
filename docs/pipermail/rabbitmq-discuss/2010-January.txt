From davorin.rusevljan at gmail.com  Sat Jan  2 12:04:02 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Sat, 2 Jan 2010 13:04:02 +0100
Subject: [rabbitmq-discuss] Should requent queue
	creation-attachment-deletion be avoided?
Message-ID: <45d84bd01001020404i48c958adw75e8d8f90b3146cf@mail.gmail.com>

Hi,

I am thinking how to model my problem with RabbitMQ and AMQP. Let me
describe it briefly.

There are something like 1000 entities about which central site should
publish and broadcast information. There are also something like
100-1000 clients which can choose only one of those items and receive
pushed updates to its state. I was thinking about setting an exchange
to which updates are going to be published, and each client would get
its private queue attached to it to fetch updates from. The updates
need not to be persisted or ack-ed.

Now the clients might at some times quite frequently change the entity
they are monitoring, maybe even once per second if they are edgy. Over
the period of 6-10 hours that might cumulate to quite large number of
private queues being created, attached to exchanges and deleted
subsequently. Is this going to be costly and possible time and
resource drain?

Maybe queues need not to be deleted but they could be just reattached
with different keyword pattern? Is that possible and if yes, would it
also present performance and resource issue?

Or maybe this should be modeled in some other way?

Many thanks!

Davorin Rusevljan
http://www.cloud208.com/



From alexis.richardson at gmail.com  Sat Jan  2 17:13:21 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 2 Jan 2010 17:13:21 +0000
Subject: [rabbitmq-discuss] Should requent queue
	creation-attachment-deletion be avoided?
In-Reply-To: <45d84bd01001020404i48c958adw75e8d8f90b3146cf@mail.gmail.com>
References: <45d84bd01001020404i48c958adw75e8d8f90b3146cf@mail.gmail.com>
Message-ID: <167204d21001020913h67077df5w98d79974ef1d91ce@mail.gmail.com>

Davorin

You are definitely thinking along the right lines here.

* Queue creation, binding, etc, carries a small cost in time and space
* For some use cases (eg managing a lot of chat style sessions) it
would be great to have a way to 'hide' bindings temporarily, instead
of deleting them
* A mechanism akin to 'presence' has been mooted but not implemented yet

Space costs:

* The space cost is usually the more critical to considerations of
scale in our practical experience with real apps, to date
* Each binding takes a couple of 100 bytes, last time I asked the
engineering team about this, but this may have improved recently, or
be about to improve with the new persistor - you'll have to ask
Matthew
* Obviously if you have a large machine (8Gb RAM or more) this goes a
long way to helping.
* Memory consumption in RabbitMQ 1.7 is the cost of the entities plus
the bindings plus any messages in memory (messages are stored at most
once per node if they are larger than 60 bytes)
* Per message memory consumption will decrease for persistent
messages, with the new persistor
* For more on this, read
http://www.lshift.net/blog/2009/12/07/rabbitmq-at-the-skills-matter-functional-programming-exchange

Time costs:

* Direct exchange lookup is order log(n) and topic is order n.  Yes,
this could be improved.
* So if you are using topic exchanges at large scale, time is likely
to be a factor too.

Space and time:

* When you run a clustered broker, the routing table ("exchange") is
replicated across nodes.
* Replication is synchronised to the binding lifecycle
* The combination of large scale, heavy binding churn, and clustering,
is therefore not a happy one
* That said almost all problems can be made to go away with
intelligent partitioning or hashing, and reasonably big boxes

Bottom line:

* RabbitMQ can handle pretty large applications on one box provided
you do not do anything daft
* Avoid churn if you can
* The new persistor will help with some cases

alexis







On Sat, Jan 2, 2010 at 12:04 PM, Davorin Rusevljan
<davorin.rusevljan at gmail.com> wrote:
> Hi,
>
> I am thinking how to model my problem with RabbitMQ and AMQP. Let me
> describe it briefly.
>
> There are something like 1000 entities about which central site should
> publish and broadcast information. There are also something like
> 100-1000 clients which can choose only one of those items and receive
> pushed updates to its state. I was thinking about setting an exchange
> to which updates are going to be published, and each client would get
> its private queue attached to it to fetch updates from. The updates
> need not to be persisted or ack-ed.
>
> Now the clients might at some times quite frequently change the entity
> they are monitoring, maybe even once per second if they are edgy. Over
> the period of 6-10 hours that might cumulate to quite large number of
> private queues being created, attached to exchanges and deleted
> subsequently. Is this going to be costly and possible time and
> resource drain?
>
> Maybe queues need not to be deleted but they could be just reattached
> with different keyword pattern? Is that possible and if yes, would it
> also present performance and resource issue?
>
> Or maybe this should be modeled in some other way?
>
> Many thanks!
>
> Davorin Rusevljan
> http://www.cloud208.com/
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From b at b3k.us  Sun Jan  3 08:36:15 2010
From: b at b3k.us (Benjamin Black)
Date: Sun, 03 Jan 2010 00:36:15 -0800
Subject: [rabbitmq-discuss] Encoding message payload for multiple
	languages
In-Reply-To: <D9CD1F7C-3EA3-4063-A77B-1588A2B1F881@gmail.com>
References: <ce2570e20912311117u2587a516oc07b750daef3f63a@mail.gmail.com>
	<D9CD1F7C-3EA3-4063-A77B-1588A2B1F881@gmail.com>
Message-ID: <4B4056FF.9060301@b3k.us>

On 12/31/09 11:35 AM, Jeremy Dunck wrote:
> 
> 
> On Dec 31, 2009, at 1:17 PM, Garrett Smith <g at rre.tt> wrote:
>> Binary representation of Erlang terms is darned near perfect (fast and
>> flexible), but it's not as easy to consume from other language
>> environments.
>>
> 
> Have you seen Bert?
> http://github.com/blog/531-introducing-bert-and-bert-rpc
> 

Another vote for BERT.  I'm using it quite happily:
http://github.com/b/bertrem .  Piece of cake to encode/decode as
evidenced by the proliferation of client libraries.


b

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 550 bytes
Desc: OpenPGP digital signature
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100103/1bbc84ba/attachment.pgp 

From b at b3k.us  Sun Jan  3 08:37:45 2010
From: b at b3k.us (Benjamin Black)
Date: Sun, 03 Jan 2010 00:37:45 -0800
Subject: [rabbitmq-discuss] Encoding message payload for multiple
	languages
In-Reply-To: <167204d20912311151if291ba3h12035c4d7f94c71@mail.gmail.com>
References: <ce2570e20912311117u2587a516oc07b750daef3f63a@mail.gmail.com>	<D9CD1F7C-3EA3-4063-A77B-1588A2B1F881@gmail.com>
	<167204d20912311151if291ba3h12035c4d7f94c71@mail.gmail.com>
Message-ID: <4B405759.1050201@b3k.us>

On 12/31/09 11:51 AM, Alexis Richardson wrote:
> On Thu, Dec 31, 2009 at 7:35 PM, Jeremy Dunck <jdunck at gmail.com> wrote:
>>
>>
>> On Dec 31, 2009, at 1:17 PM, Garrett Smith <g at rre.tt> wrote:
>>> Binary representation of Erlang terms is darned near perfect (fast and
>>> flexible), but it's not as easy to consume from other language
>>> environments.
>>>
>>
>> Have you seen Bert?
>> http://github.com/blog/531-introducing-bert-and-bert-rpc
> 
> And not wholly unrelatedly: http://github.com/b/bertem
> 

FYI, I inconveniently changed the name to bertrem so it could be
pronounced as a name, as is the case with most other BERT bits.  Also
for the lulz.

http://github.com/b/bertrem


b

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 550 bytes
Desc: OpenPGP digital signature
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100103/f033cf38/attachment.pgp 

From sconover at gmail.com  Sun Jan  3 17:05:55 2010
From: sconover at gmail.com (Steve Conover)
Date: Sun, 3 Jan 2010 09:05:55 -0800
Subject: [rabbitmq-discuss] Rabbit-MQ crashing
In-Reply-To: <4AFC1AF3.6000406@lshift.net>
References: <4ece5be60911100944y696030e9ga2ba6d153d0c19b6@mail.gmail.com>
	<4AFC1AF3.6000406@lshift.net>
Message-ID: <d9743bb41001030905g35992b1ema5c1290217415f8f@mail.gmail.com>

We're experiencing this problem as well.  Just from reading the list
it seems that the new persister stuff committed around 12/1 is
supposed to fix it.

I'm curious:

- has this bug indeed been fixed?
- is the code somewhere past bleeding edge?  Would you consider it to be stable?
- please excuse my ignorance, but is there any bug or ticket url that
I can follow to keep track of the fix / when it's been released / etc
?

Regards,
Steve

On Thu, Nov 12, 2009 at 6:25 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Hi Derek,
>
> (Replying here as well for the archive)
>
> Derek Burdick wrote:
>> I have a durable, fanout exchange and queue. ?I post persistent messages
>> to the exchange. ?After sending messages for some time, the ERL process
>> stops and I can not restart RabbitMQ without deleting the contents of
>> the Database. ?Here is the log from startup:
>> [...]
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {{{badmatch,eof},
>> [{rabbit_persister,internal_load_snapshot,2},
>> [...]
>
> RabbitMQ has become overfull, and crashed during persister log rollover
> as a result. You probably have a zero-byte-long rabbit_persister.LOG,
> and a large rabbit_persister.LOG.previous. Make a backup of the
> .previous file somewhere else, just in case, and then copy it over top
> of the rabbit_persister.LOG file and start the broker. You shouldn't
> need to delete the whole database.
>
> We're working on fixing the underlying cause, but for now, you must not
> store more messages than (some proportion of) your available RAM can
> hold. If you are simply buffering things without trying to consume them,
> then you will probably need to introduce some consumers of some kind :-)
> and if you do have consumers running, but Rabbit is running out of
> memory anyway, you should probably check that you are acknowledging
> deliveries from the broker properly.
>
> Regards,
> ?Tony
> --
> ?[][][] Tony Garnock-Jones ? ? | Mob: +44 (0)7905 974 211
> ? [][] LShift Ltd ? ? ? ? ? ? | Tel: +44 (0)20 7729 7060
> ?[] ?[] http://www.lshift.net/ | Email: tonyg at lshift.net
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From celldee at gmail.com  Mon Jan  4 21:26:31 2010
From: celldee at gmail.com (Chris Duncan)
Date: Mon, 4 Jan 2010 21:26:31 +0000
Subject: [rabbitmq-discuss] AMQP message publishing - I wish it was
	synchronous
Message-ID: <18F72087-98D0-4A10-AA04-E8300C8AFF88@gmail.com>

Before I begin let me state for the record that I have read the 0-8  
and 0-9 AMQP specs and realise that they will not change just because  
I believe that it might be a good idea. Neither do I advocate  
deviation from the specs for the sake of expedience.

OK, I've been looking at including Channel.Flow method processing in  
the Bunny client (again) and have come to the conclusion that  
publishing should be synchronous in AMQP terms. My reasoning is as  
follows -

The AMQP Channel.Flow method is a device to try to prevent servers  
getting swamped by message producing clients. The server sends a  
Channel.Flow method with :active argument set to false to a producer  
in order to get the producer to stop sending messages when server  
memory is getting critically low.

When a client application publishes a message it passes that message  
into the care of the server. If something goes wrong the client  
application needs to be notified, but it is equally important for the  
client to know that the server has the message and will do its level  
best to deliver it to an appropriate destination queue. It seems to  
me that the second piece of information, namely a "yes I have your  
message", is missing. This absence of information means that the  
client has to make a judgement on the success of the publish  
operation based on what it does not receive, rather than what is does  
receive.

If, after issuing a Basic.Publish method, a client does not receive  
an error indication or Channel.Flow method, it has to assume that a  
publish has succeeded. For a simple single-threaded synchronous  
client like Bunny, the lack of a publish-ok method means that it has  
to wait to see whether a message arrives that indicates a problem. So  
in the case of Basic.Publish, the client could do a blocking read  
that times out if no message is received. However, even if I could  
rely on the timeout to work without fail (which my current testing is  
suggesting may not be the case), I don't like that solution at all.

With a publish-ok method things become much more straightforward. If  
the client receives a publish-ok then everything is rosy in the  
garden. If not, the client handles the issue. There could be  
a :nowait flag as there are for other methods for asynchronous  
processing.

If anyone has any ideas as to how I can get around this issue using  
Ruby without additional threads, fibers, eventmachine etc. I would be  
very pleased to hear from them.

Regards,

Chris



From alexis.richardson at gmail.com  Mon Jan  4 22:11:36 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 4 Jan 2010 22:11:36 +0000
Subject: [rabbitmq-discuss] AMQP message publishing - I wish it was
	synchronous
In-Reply-To: <18F72087-98D0-4A10-AA04-E8300C8AFF88@gmail.com>
References: <18F72087-98D0-4A10-AA04-E8300C8AFF88@gmail.com>
Message-ID: <167204d21001041411m157b3c55mac74e445285cba59@mail.gmail.com>

It would be nice to have a lazy ack and things like that will be in
future versions of amqp.

For now, have you looked at the TX class?

alexis


On Mon, Jan 4, 2010 at 9:26 PM, Chris Duncan <celldee at gmail.com> wrote:
> Before I begin let me state for the record that I have read the 0-8
> and 0-9 AMQP specs and realise that they will not change just because
> I believe that it might be a good idea. Neither do I advocate
> deviation from the specs for the sake of expedience.
>
> OK, I've been looking at including Channel.Flow method processing in
> the Bunny client (again) and have come to the conclusion that
> publishing should be synchronous in AMQP terms. My reasoning is as
> follows -
>
> The AMQP Channel.Flow method is a device to try to prevent servers
> getting swamped by message producing clients. The server sends a
> Channel.Flow method with :active argument set to false to a producer
> in order to get the producer to stop sending messages when server
> memory is getting critically low.
>
> When a client application publishes a message it passes that message
> into the care of the server. If something goes wrong the client
> application needs to be notified, but it is equally important for the
> client to know that the server has the message and will do its level
> best to deliver it to an appropriate destination queue. It seems to
> me that the second piece of information, namely a "yes I have your
> message", is missing. This absence of information means that the
> client has to make a judgement on the success of the publish
> operation based on what it does not receive, rather than what is does
> receive.
>
> If, after issuing a Basic.Publish method, a client does not receive
> an error indication or Channel.Flow method, it has to assume that a
> publish has succeeded. For a simple single-threaded synchronous
> client like Bunny, the lack of a publish-ok method means that it has
> to wait to see whether a message arrives that indicates a problem. So
> in the case of Basic.Publish, the client could do a blocking read
> that times out if no message is received. However, even if I could
> rely on the timeout to work without fail (which my current testing is
> suggesting may not be the case), I don't like that solution at all.
>
> With a publish-ok method things become much more straightforward. If
> the client receives a publish-ok then everything is rosy in the
> garden. If not, the client handles the issue. There could be
> a :nowait flag as there are for other methods for asynchronous
> processing.
>
> If anyone has any ideas as to how I can get around this issue using
> Ruby without additional threads, fibers, eventmachine etc. I would be
> very pleased to hear from them.
>
> Regards,
>
> Chris
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From celldee at gmail.com  Mon Jan  4 22:57:18 2010
From: celldee at gmail.com (Chris Duncan)
Date: Mon, 4 Jan 2010 22:57:18 +0000
Subject: [rabbitmq-discuss] AMQP message publishing - I wish it was
	synchronous
In-Reply-To: <167204d21001041411m157b3c55mac74e445285cba59@mail.gmail.com>
References: <18F72087-98D0-4A10-AA04-E8300C8AFF88@gmail.com>
	<167204d21001041411m157b3c55mac74e445285cba59@mail.gmail.com>
Message-ID: <F569B8E6-EFCC-4686-8C4C-0A7EFC000175@gmail.com>

Hi Alexis,

I have looked at it, but I obviously didn't understood it correctly.  
So, let's see if I grok this. Suppose I send a tx.select, send my  
basic.publish and then send a tx.commit. If I receive a tx.commit-ok  
all is well, otherwise I'll receive a channel exception from the server.

Not as straightforward as a publish-ok, but hey, if it works ... :)

Thanks,

Chris

On 4 Jan 2010, at 22:11, Alexis Richardson wrote:

> It would be nice to have a lazy ack and things like that will be in
> future versions of amqp.
>
> For now, have you looked at the TX class?
>
> alexis
>
>
> On Mon, Jan 4, 2010 at 9:26 PM, Chris Duncan <celldee at gmail.com>  
> wrote:
>> Before I begin let me state for the record that I have read the 0-8
>> and 0-9 AMQP specs and realise that they will not change just because
>> I believe that it might be a good idea. Neither do I advocate
>> deviation from the specs for the sake of expedience.
>>
>> OK, I've been looking at including Channel.Flow method processing in
>> the Bunny client (again) and have come to the conclusion that
>> publishing should be synchronous in AMQP terms. My reasoning is as
>> follows -
>>
>> The AMQP Channel.Flow method is a device to try to prevent servers
>> getting swamped by message producing clients. The server sends a
>> Channel.Flow method with :active argument set to false to a producer
>> in order to get the producer to stop sending messages when server
>> memory is getting critically low.
>>
>> When a client application publishes a message it passes that message
>> into the care of the server. If something goes wrong the client
>> application needs to be notified, but it is equally important for the
>> client to know that the server has the message and will do its level
>> best to deliver it to an appropriate destination queue. It seems to
>> me that the second piece of information, namely a "yes I have your
>> message", is missing. This absence of information means that the
>> client has to make a judgement on the success of the publish
>> operation based on what it does not receive, rather than what is does
>> receive.
>>
>> If, after issuing a Basic.Publish method, a client does not receive
>> an error indication or Channel.Flow method, it has to assume that a
>> publish has succeeded. For a simple single-threaded synchronous
>> client like Bunny, the lack of a publish-ok method means that it has
>> to wait to see whether a message arrives that indicates a problem. So
>> in the case of Basic.Publish, the client could do a blocking read
>> that times out if no message is received. However, even if I could
>> rely on the timeout to work without fail (which my current testing is
>> suggesting may not be the case), I don't like that solution at all.
>>
>> With a publish-ok method things become much more straightforward. If
>> the client receives a publish-ok then everything is rosy in the
>> garden. If not, the client handles the issue. There could be
>> a :nowait flag as there are for other methods for asynchronous
>> processing.
>>
>> If anyone has any ideas as to how I can get around this issue using
>> Ruby without additional threads, fibers, eventmachine etc. I would be
>> very pleased to hear from them.
>>
>> Regards,
>>
>> Chris
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>




From alexis.richardson at gmail.com  Mon Jan  4 23:03:30 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 4 Jan 2010 23:03:30 +0000
Subject: [rabbitmq-discuss] AMQP message publishing - I wish it was
	synchronous
In-Reply-To: <F569B8E6-EFCC-4686-8C4C-0A7EFC000175@gmail.com>
References: <18F72087-98D0-4A10-AA04-E8300C8AFF88@gmail.com>
	<167204d21001041411m157b3c55mac74e445285cba59@mail.gmail.com>
	<F569B8E6-EFCC-4686-8C4C-0A7EFC000175@gmail.com>
Message-ID: <167204d21001041503t351d203h560eca69092e0068@mail.gmail.com>

Roughly.

Using TX allows you to get a synchronous ack.  But it's comparitively
slow obviously.  You can do acks asyncly but that has a weaker SLA of
course.

I am being vague in the hope that a better-informed person will make a
more precise and possibly helpful statement about how to make the most
of this ;-)

Meanwhile I suggest you experiment based on what you glean from the
spec and searching the rabbitmq.com site...

alexis




On Mon, Jan 4, 2010 at 10:57 PM, Chris Duncan <celldee at gmail.com> wrote:
> Hi Alexis,
>
> I have looked at it, but I obviously didn't understood it correctly. So,
> let's see if I grok this. Suppose I send a tx.select, send my basic.publish
> and then send a tx.commit. If I receive a tx.commit-ok all is well,
> otherwise I'll receive a channel exception from the server.
>
> Not as straightforward as a publish-ok, but hey, if it works ... :)
>
> Thanks,
>
> Chris
>
> On 4 Jan 2010, at 22:11, Alexis Richardson wrote:
>
>> It would be nice to have a lazy ack and things like that will be in
>> future versions of amqp.
>>
>> For now, have you looked at the TX class?
>>
>> alexis
>>
>>
>> On Mon, Jan 4, 2010 at 9:26 PM, Chris Duncan <celldee at gmail.com> wrote:
>>>
>>> Before I begin let me state for the record that I have read the 0-8
>>> and 0-9 AMQP specs and realise that they will not change just because
>>> I believe that it might be a good idea. Neither do I advocate
>>> deviation from the specs for the sake of expedience.
>>>
>>> OK, I've been looking at including Channel.Flow method processing in
>>> the Bunny client (again) and have come to the conclusion that
>>> publishing should be synchronous in AMQP terms. My reasoning is as
>>> follows -
>>>
>>> The AMQP Channel.Flow method is a device to try to prevent servers
>>> getting swamped by message producing clients. The server sends a
>>> Channel.Flow method with :active argument set to false to a producer
>>> in order to get the producer to stop sending messages when server
>>> memory is getting critically low.
>>>
>>> When a client application publishes a message it passes that message
>>> into the care of the server. If something goes wrong the client
>>> application needs to be notified, but it is equally important for the
>>> client to know that the server has the message and will do its level
>>> best to deliver it to an appropriate destination queue. It seems to
>>> me that the second piece of information, namely a "yes I have your
>>> message", is missing. This absence of information means that the
>>> client has to make a judgement on the success of the publish
>>> operation based on what it does not receive, rather than what is does
>>> receive.
>>>
>>> If, after issuing a Basic.Publish method, a client does not receive
>>> an error indication or Channel.Flow method, it has to assume that a
>>> publish has succeeded. For a simple single-threaded synchronous
>>> client like Bunny, the lack of a publish-ok method means that it has
>>> to wait to see whether a message arrives that indicates a problem. So
>>> in the case of Basic.Publish, the client could do a blocking read
>>> that times out if no message is received. However, even if I could
>>> rely on the timeout to work without fail (which my current testing is
>>> suggesting may not be the case), I don't like that solution at all.
>>>
>>> With a publish-ok method things become much more straightforward. If
>>> the client receives a publish-ok then everything is rosy in the
>>> garden. If not, the client handles the issue. There could be
>>> a :nowait flag as there are for other methods for asynchronous
>>> processing.
>>>
>>> If anyone has any ideas as to how I can get around this issue using
>>> Ruby without additional threads, fibers, eventmachine etc. I would be
>>> very pleased to hear from them.
>>>
>>> Regards,
>>>
>>> Chris
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>



From celldee at gmail.com  Mon Jan  4 23:12:22 2010
From: celldee at gmail.com (Chris Duncan)
Date: Mon, 4 Jan 2010 23:12:22 +0000
Subject: [rabbitmq-discuss] AMQP message publishing - I wish it was
	synchronous
In-Reply-To: <167204d21001041503t351d203h560eca69092e0068@mail.gmail.com>
References: <18F72087-98D0-4A10-AA04-E8300C8AFF88@gmail.com>
	<167204d21001041411m157b3c55mac74e445285cba59@mail.gmail.com>
	<F569B8E6-EFCC-4686-8C4C-0A7EFC000175@gmail.com>
	<167204d21001041503t351d203h560eca69092e0068@mail.gmail.com>
Message-ID: <D49B5CB6-BF2F-43DB-B989-CF9EA0CF6523@gmail.com>

OK. I'll keep playing. Thanks for your input.

Regards,

Chris

On 4 Jan 2010, at 23:03, Alexis Richardson wrote:

> Roughly.
>
> Using TX allows you to get a synchronous ack.  But it's comparitively
> slow obviously.  You can do acks asyncly but that has a weaker SLA of
> course.
>
> I am being vague in the hope that a better-informed person will make a
> more precise and possibly helpful statement about how to make the most
> of this ;-)
>
> Meanwhile I suggest you experiment based on what you glean from the
> spec and searching the rabbitmq.com site...
>
> alexis
>
>
>
>
> On Mon, Jan 4, 2010 at 10:57 PM, Chris Duncan <celldee at gmail.com>  
> wrote:
>> Hi Alexis,
>>
>> I have looked at it, but I obviously didn't understood it  
>> correctly. So,
>> let's see if I grok this. Suppose I send a tx.select, send my  
>> basic.publish
>> and then send a tx.commit. If I receive a tx.commit-ok all is well,
>> otherwise I'll receive a channel exception from the server.
>>
>> Not as straightforward as a publish-ok, but hey, if it works ... :)
>>
>> Thanks,
>>
>> Chris
>>
>> On 4 Jan 2010, at 22:11, Alexis Richardson wrote:
>>
>>> It would be nice to have a lazy ack and things like that will be in
>>> future versions of amqp.
>>>
>>> For now, have you looked at the TX class?
>>>
>>> alexis
>>>
>>>
>>> On Mon, Jan 4, 2010 at 9:26 PM, Chris Duncan <celldee at gmail.com>  
>>> wrote:
>>>>
>>>> Before I begin let me state for the record that I have read the 0-8
>>>> and 0-9 AMQP specs and realise that they will not change just  
>>>> because
>>>> I believe that it might be a good idea. Neither do I advocate
>>>> deviation from the specs for the sake of expedience.
>>>>
>>>> OK, I've been looking at including Channel.Flow method  
>>>> processing in
>>>> the Bunny client (again) and have come to the conclusion that
>>>> publishing should be synchronous in AMQP terms. My reasoning is as
>>>> follows -
>>>>
>>>> The AMQP Channel.Flow method is a device to try to prevent servers
>>>> getting swamped by message producing clients. The server sends a
>>>> Channel.Flow method with :active argument set to false to a  
>>>> producer
>>>> in order to get the producer to stop sending messages when server
>>>> memory is getting critically low.
>>>>
>>>> When a client application publishes a message it passes that  
>>>> message
>>>> into the care of the server. If something goes wrong the client
>>>> application needs to be notified, but it is equally important  
>>>> for the
>>>> client to know that the server has the message and will do its  
>>>> level
>>>> best to deliver it to an appropriate destination queue. It seems to
>>>> me that the second piece of information, namely a "yes I have your
>>>> message", is missing. This absence of information means that the
>>>> client has to make a judgement on the success of the publish
>>>> operation based on what it does not receive, rather than what is  
>>>> does
>>>> receive.
>>>>
>>>> If, after issuing a Basic.Publish method, a client does not receive
>>>> an error indication or Channel.Flow method, it has to assume that a
>>>> publish has succeeded. For a simple single-threaded synchronous
>>>> client like Bunny, the lack of a publish-ok method means that it  
>>>> has
>>>> to wait to see whether a message arrives that indicates a  
>>>> problem. So
>>>> in the case of Basic.Publish, the client could do a blocking read
>>>> that times out if no message is received. However, even if I could
>>>> rely on the timeout to work without fail (which my current  
>>>> testing is
>>>> suggesting may not be the case), I don't like that solution at all.
>>>>
>>>> With a publish-ok method things become much more  
>>>> straightforward. If
>>>> the client receives a publish-ok then everything is rosy in the
>>>> garden. If not, the client handles the issue. There could be
>>>> a :nowait flag as there are for other methods for asynchronous
>>>> processing.
>>>>
>>>> If anyone has any ideas as to how I can get around this issue using
>>>> Ruby without additional threads, fibers, eventmachine etc. I  
>>>> would be
>>>> very pleased to hear from them.
>>>>
>>>> Regards,
>>>>
>>>> Chris
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>
>>




From janvanbesien at gmail.com  Tue Jan  5 07:32:41 2010
From: janvanbesien at gmail.com (Jan Van Besien)
Date: Tue, 05 Jan 2010 08:32:41 +0100
Subject: [rabbitmq-discuss] JMS/AMQP use case
Message-ID: <4B42EB19.2060101@gmail.com>

Hi all,

We currently use JMS between a lot of internal components, and also 
expose a JMS interface externally (a set of topics) to our customers. As 
JMS is a Java only thing, we are looking into language neutral 
alternatives for the customer facing interface. The AMQP standard seems 
to fit our needs, but I haven't figured out yet what the ideal 
deployment scenario (with rabbitMQ) would be.

Is it possible (and desirable) to continue using JMS internally (without
rabbitMQ) in a first phase, and have an AMQP interface on top of it? If 
so, could you give me some hints on how the setup would be than. I guess 
I need to deploy the rabbitMQ server, and develop some component which 
makes the "bridge" between JMS and AMQP (listening to incoming JMS 
messages and "forwarding" them to the rabbitMQ server or something like 
that).

Does this sound like a good idea at all, or should I maybe try to use 
rabbitMQ as the underlying implementation for the internal JMS as well?

I'm sorry if these are newbie questions... The individual pieces of 
documentation seem comprehensive enough, but I currently fail to get the 
overall idea of how to apply it to my use case (could be me of course).

Thanks in advance,
Jan



From alexis.richardson at gmail.com  Tue Jan  5 11:06:32 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 5 Jan 2010 11:06:32 +0000
Subject: [rabbitmq-discuss] JMS/AMQP use case
In-Reply-To: <4B42EB19.2060101@gmail.com>
References: <4B42EB19.2060101@gmail.com>
Message-ID: <167204d21001050306h4f8a1106t2b4b5bce4e5913eb@mail.gmail.com>

Jan,

Thanks for your question.

On Tue, Jan 5, 2010 at 7:32 AM, Jan Van Besien <janvanbesien at gmail.com> wrote:
> Hi all,
>
> We currently use JMS between a lot of internal components, and also
> expose a JMS interface externally (a set of topics) to our customers. As
> JMS is a Java only thing, we are looking into language neutral
> alternatives for the customer facing interface. The AMQP standard seems
> to fit our needs, but I haven't figured out yet what the ideal
> deployment scenario (with rabbitMQ) would be.
>
> Is it possible (and desirable) to continue using JMS internally (without
> rabbitMQ) in a first phase, and have an AMQP interface on top of it?

Yes and no ;-)

It's not really possible to do this in an elegant ('built in to the
broker') way at the moment.  The AMQP model is more general than JMS,
making it hard to model AMQP from JMS without (in effect) building a
Java AMQP broker from scratch.  On the other hand, because AMQP is
more general than JMS, providing a JMS interface to an AMQP broker has
been done, modulo some warts and gotchas.

It may get easier to expose AMQP interfaces to JMS brokers when we
finally reach AMQP 1.0.  This is intended to be factored in such a way
that 'legacy' message brokers can expose AMQP message formats but not
full behaviours.  This would be similar, in effect, to how a JMS
broker might expose a STOMP interface today.

That said....

> If
> so, could you give me some hints on how the setup would be than.

Despite my remarks above, about AMQP being more general than JMS, this
is certainly something you could try.  Let's say you want to run JMS
as your core system and gradually layer AMQP on top of it.  You could:

1. Install and run RabbitMQ
2. Set up some queues and bindings (perhaps, one for each of your public topics)
3. Publish AMQP messages to RabbitMQ
4. Consume AMQP messages from RabbitMQ using a Java client.
5. In the same Java client, create JMS messages from the payloads of
the AMQP and forward them to your JMS system

You could do the above yourself, and it would work, but with some
drawbacks I am sure I don't need to enumerate.  Indeed, this approach
could potentially be extended to something a bit more robust.

*Alternatively*

Have you looked at STOMP?  If your infra requires JMS based messaging
inside for some time, then STOMP is one way to cross the language
barrier.  It's not as powerful as AMQP for defining broker behaviour
(routing, delivery, qos), but, you don't always need that.





> I guess
> I need to deploy the rabbitMQ server, and develop some component which
> makes the "bridge" between JMS and AMQP (listening to incoming JMS
> messages and "forwarding" them to the rabbitMQ server or something like
> that).

Well, now you are asking a different question :-)

Above I described how to expose a JMS infra using some sort of AMQP
gateway, so that you could send messages to RabbitMQ in AMQP and
forward them to JMS brokers.

If you want to do this the other way round, ie. send JMS messages to
RabbitMQ, then you can use the JMS client.

Note that:

1) Because JMS is an API not a protocol, it is possible to expose it
on the client side 100%, and use any protocol you like to communicate
between your JMS client and your broker.  This by the way raises the
question "what is a JMS broker?".  And the answer is: "something that
has a JMS client".  Go figure.

2) Because AMQP's model is somewhat different from JMS, not all of the
JMS 'TCK' API is modelled in the current JMS clients.

3) Not very many people use JMS with RabbitMQ, so I am not sure what
currently works with what.

Here is a 'how to' -
http://www.lshift.net/blog/2009/03/16/openamqs-jms-client-with-rabbitmq-server

We hope to make all this much easier to run OOTB very soon.



> Does this sound like a good idea at all, or should I maybe try to use
> rabbitMQ as the underlying implementation for the internal JMS as well?

Honestly, it depends on your use case and the extent to which your
existing messaging infra is welded into place.

At this stage I would recommend *experimenting* with some of the
approaches I described above.  By all means ask any question on this
list if you get stuck.


> I'm sorry if these are newbie questions... The individual pieces of
> documentation seem comprehensive enough, but I currently fail to get the
> overall idea of how to apply it to my use case (could be me of course).

I am sorry the JMS-AMQP thing is not as clear as it could be.

alexis



> Thanks in advance,
> Jan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From celldee at gmail.com  Tue Jan  5 12:21:08 2010
From: celldee at gmail.com (Chris Duncan)
Date: Tue, 5 Jan 2010 12:21:08 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
Message-ID: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>

I've been wanting to incorporate Channel.Flow method handling into the Bunny
Ruby client library for a while. It's needed, but I want to do it in a
simple, efficient way. I want to be able to give a client application the
option to stop sending messages as soon as possible after receiving a
Channel.Flow method (with :active => false) and that means that I need to
know whether a Basic.Publish succeeds as well as whether it fails.

At the moment there is the potential for a client application to keep firing
messages at the server whilst being oblivious to the fact that the server is
telling it to stop. If the client application is just writing and not
reading, purely a publisher of messages, then there has to be an efficient
way of notifying the client that a publish has succeeded. As far as I can
see, the simplest way to do that is with a publish-ok.

Transactions may give me what I want but I don't think that I should be
enforcing the use of transactions in my client library just so that it will
handle Channel.Flow methods properly.

Regards,

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100105/26736c90/attachment.htm 

From alexis.richardson at gmail.com  Tue Jan  5 13:36:02 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 5 Jan 2010 13:36:02 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
Message-ID: <167204d21001050536l721ce70exe597fec8b0a11c6a@mail.gmail.com>

Chris

I agree that use of TX, especially around a single message, is a bit
hefty for many cases, especially in the presence of persistence.  A
form of asynchronous ack is possible with TX too, but of course that
is not really what you are asking about.

The interesting phenomenon here, IMO, is the relationship between flow
control and (n)acks.  It would be good to make this clearer either
within or as an extension of 0-8/0-91.  I'll leave it to others to
comment on your proposed approach.

alexis




On Tue, Jan 5, 2010 at 12:21 PM, Chris Duncan <celldee at gmail.com> wrote:
> I've been wanting to incorporate Channel.Flow method handling into the Bunny
> Ruby client library for a while. It's needed, but I want to do it in a
> simple, efficient way. I want to be able to give a client application the
> option to stop sending messages as soon as possible after receiving a
> Channel.Flow method (with :active => false) and that means that I need to
> know whether a Basic.Publish succeeds as well as whether it fails.
>
> At the moment there is the potential for a client application to keep firing
> messages at the server whilst being oblivious to the fact that the server is
> telling it to stop. If the client application is just writing and not
> reading, purely a publisher of messages, then there has to be an efficient
> way of notifying the client that a publish has succeeded. As far as I can
> see, the simplest way to do that is with a publish-ok.
>
> Transactions may give me what I want but I don't think that I should be
> enforcing the use of transactions in my client library just so that it will
> handle Channel.Flow methods properly.
>
> Regards,
>
> Chris
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From janvanbesien at gmail.com  Tue Jan  5 14:52:05 2010
From: janvanbesien at gmail.com (Jan Van Besien)
Date: Tue, 05 Jan 2010 15:52:05 +0100
Subject: [rabbitmq-discuss] JMS/AMQP use case
In-Reply-To: <167204d21001050306h4f8a1106t2b4b5bce4e5913eb@mail.gmail.com>
References: <4B42EB19.2060101@gmail.com>
	<167204d21001050306h4f8a1106t2b4b5bce4e5913eb@mail.gmail.com>
Message-ID: <4B435215.8040600@gmail.com>

Many thanks for your answers. This already clarified a lot. It also made 
me realise that my question was a bit vague in some parts ;-)

Some further remarks inline:

Alexis Richardson wrote:
> 1. Install and run RabbitMQ
> 2. Set up some queues and bindings (perhaps, one for each of your public topics)
> 3. Publish AMQP messages to RabbitMQ
> 4. Consume AMQP messages from RabbitMQ using a Java client.
> 5. In the same Java client, create JMS messages from the payloads of
> the AMQP and forward them to your JMS system

This sounds like a workable aproach to me. Certainly because my setup 
will even be a bit easier I think.

What I didn't make clear in my initial question is that the JMS 
interface we expose to the "outside" (i.e. the set of topics I 
mentioned) is only used to push data from the internal (JMS) system to 
external clients. From the perspective of the external clients, it is 
read only.

This (I think) means that I wouldn't need to consume AMQP messages from 
RabbitMQ (step 4 and 5 above). I would only need an internal component 
which consumes JMS messages, turns them into AMQP messages and sends 
them to rabbitMQ.
If I understand correctly, the "consume JMS messages" part of that 
component would not depend on rabbitMQ at all (just a JMS message 
listener), and the "turn into AMQP messages and send to rabbitMQ" can be 
done with the rabbitMQ java api.

> *Alternatively*
> 
> Have you looked at STOMP?  If your infra requires JMS based messaging
> inside for some time, then STOMP is one way to cross the language
> barrier.  It's not as powerful as AMQP for defining broker behaviour
> (routing, delivery, qos), but, you don't always need that.

I had never heard of it, but it seems indeed more than enough for my 
simple use case. I'll certainly have a closer look at it.

thanks again,
Jan



From alexis.richardson at gmail.com  Tue Jan  5 14:55:32 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 5 Jan 2010 14:55:32 +0000
Subject: [rabbitmq-discuss] JMS/AMQP use case
In-Reply-To: <4B435215.8040600@gmail.com>
References: <4B42EB19.2060101@gmail.com>
	<167204d21001050306h4f8a1106t2b4b5bce4e5913eb@mail.gmail.com>
	<4B435215.8040600@gmail.com>
Message-ID: <167204d21001050655h383c2b71ta601e6af98d3258e@mail.gmail.com>

Jan

Cool.

Yes, in that case do take a look at STOMP and do take a look at the
JMS client, which lets a publisher speak in JMS to RabbitMQ.  The
client turns the JMSy stuff into AMQPy stuff.,.

Note that the RabbitMQ 'Java client' that is on our web site is not
the JMS client that I am referring to.  Our main Java client is POJO
AMQP.

alexis


On Tue, Jan 5, 2010 at 2:52 PM, Jan Van Besien <janvanbesien at gmail.com> wrote:
> Many thanks for your answers. This already clarified a lot. It also made
> me realise that my question was a bit vague in some parts ;-)
>
> Some further remarks inline:
>
> Alexis Richardson wrote:
>> 1. Install and run RabbitMQ
>> 2. Set up some queues and bindings (perhaps, one for each of your public topics)
>> 3. Publish AMQP messages to RabbitMQ
>> 4. Consume AMQP messages from RabbitMQ using a Java client.
>> 5. In the same Java client, create JMS messages from the payloads of
>> the AMQP and forward them to your JMS system
>
> This sounds like a workable aproach to me. Certainly because my setup
> will even be a bit easier I think.
>
> What I didn't make clear in my initial question is that the JMS
> interface we expose to the "outside" (i.e. the set of topics I
> mentioned) is only used to push data from the internal (JMS) system to
> external clients. From the perspective of the external clients, it is
> read only.
>
> This (I think) means that I wouldn't need to consume AMQP messages from
> RabbitMQ (step 4 and 5 above). I would only need an internal component
> which consumes JMS messages, turns them into AMQP messages and sends
> them to rabbitMQ.
> If I understand correctly, the "consume JMS messages" part of that
> component would not depend on rabbitMQ at all (just a JMS message
> listener), and the "turn into AMQP messages and send to rabbitMQ" can be
> done with the rabbitMQ java api.
>
>> *Alternatively*
>>
>> Have you looked at STOMP? ?If your infra requires JMS based messaging
>> inside for some time, then STOMP is one way to cross the language
>> barrier. ?It's not as powerful as AMQP for defining broker behaviour
>> (routing, delivery, qos), but, you don't always need that.
>
> I had never heard of it, but it seems indeed more than enough for my
> simple use case. I'll certainly have a closer look at it.
>
> thanks again,
> Jan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From scott.brooks at epicadvertising.com  Tue Jan  5 14:48:58 2010
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Tue, 5 Jan 2010 08:48:58 -0600
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
Message-ID: <C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>

Have you tried calling select on your socket to see if there is any data available to be read before a publish?

Then your publish method could throw a ChannelFlowException or something like that.

If you are waiting on tx-ok, then you will have to wait the latency of your link to your rabbit server before sending your next message.  Even a 1 ms delay on your link limits you to 1000 messages/second.


On 2010-01-05, at 7:21 AM, Chris Duncan wrote:

I've been wanting to incorporate Channel.Flow method handling into the Bunny Ruby client library for a while. It's needed, but I want to do it in a simple, efficient way. I want to be able to give a client application the option to stop sending messages as soon as possible after receiving a Channel.Flow method (with :active => false) and that means that I need to know whether a Basic.Publish succeeds as well as whether it fails.

At the moment there is the potential for a client application to keep firing messages at the server whilst being oblivious to the fact that the server is telling it to stop. If the client application is just writing and not reading, purely a publisher of messages, then there has to be an efficient way of notifying the client that a publish has succeeded. As far as I can see, the simplest way to do that is with a publish-ok.

Transactions may give me what I want but I don't think that I should be enforcing the use of transactions in my client library just so that it will handle Channel.Flow methods properly.

Regards,

Chris <ATT00001.c>

---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com<http://www.EpicAdvertising.com>
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
scott.brooks at epicadvertising.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100105/2250434d/attachment.htm 

From celldee at gmail.com  Tue Jan  5 19:32:23 2010
From: celldee at gmail.com (Chris Duncan)
Date: Tue, 5 Jan 2010 19:32:23 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
	<C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>
Message-ID: <8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>

Hi Scott,

If I read the details of the select call correctly, wouldn't I have  
to provide a timeout value so that if there is nothing to read from  
the socket I stop blocking and can publish the next message?

Regards,

Chris

On 5 Jan 2010, at 14:48, Scott Brooks wrote:

> Have you tried calling select on your socket to see if there is any  
> data available to be read before a publish?
>
> Then your publish method could throw a ChannelFlowException or  
> something like that.
>
> If you are waiting on tx-ok, then you will have to wait the latency  
> of your link to your rabbit server before sending your next  
> message.  Even a 1 ms delay on your link limits you to 1000  
> messages/second.
>
>
> On 2010-01-05, at 7:21 AM, Chris Duncan wrote:
>
>> I've been wanting to incorporate Channel.Flow method handling into  
>> the Bunny Ruby client library for a while. It's needed, but I want  
>> to do it in a simple, efficient way. I want to be able to give a  
>> client application the option to stop sending messages as soon as  
>> possible after receiving a Channel.Flow method (with :active =>  
>> false) and that means that I need to know whether a Basic.Publish  
>> succeeds as well as whether it fails.
>>
>> At the moment there is the potential for a client application to  
>> keep firing messages at the server whilst being oblivious to the  
>> fact that the server is telling it to stop. If the client  
>> application is just writing and not reading, purely a publisher of  
>> messages, then there has to be an efficient way of notifying the  
>> client that a publish has succeeded. As far as I can see, the  
>> simplest way to do that is with a publish-ok.
>>
>> Transactions may give me what I want but I don't think that I  
>> should be enforcing the use of transactions in my client library  
>> just so that it will handle Channel.Flow methods properly.
>>
>> Regards,
>>
>> Chris <ATT00001.c>
>
> ---------------------
> Scott Brooks
> Web Developer
> Epic Advertising - New York, Toronto, San Francisco, London
> www.EpicAdvertising.com
> 60 Columbia Way, Suite 310
> Markham, ON L3R 0C9
> (905) 946-0300 x2356 - phone
> (888) 666-3120 - fax
> scott.brooks at epicadvertising.com
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100105/c500a59d/attachment.htm 

From tsuraan at gmail.com  Tue Jan  5 20:55:08 2010
From: tsuraan at gmail.com (tsuraan)
Date: Tue, 5 Jan 2010 14:55:08 -0600
Subject: [rabbitmq-discuss] Erlang R12B and new persister
Message-ID: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>

Is there a desire to support the R12B releases of Erlang with the new
persister code?  It looks like recently ets:update_element snuck in,
which didn't exist until R13.  Can this easily be worked around, or
will R13 be a requirement now?

=SUPERVISOR REPORT==== 5-Jan-2010::20:40:43 ===
     Supervisor: {local,rabbit_sup}
     Context:    child_terminated
     Reason:     {undef,[{ets,update_element,
                              [238,
                               <<19,53,189,149,61,162,5,156,139,171,9,249,66,
                                 14,245,26>>,
                               {3,2}]},
                         {rabbit_msg_store_ets_index,update_fields,3},
                         {rabbit_msg_store,handle_cast,2},
                         {gen_server2,handle_msg,7},
                         {proc_lib,init_p,5}]}
     Offender:   [{pid,<0.268.0>},
                  {name,rabbit_msg_store},
                  {mfa,
                      {rabbit_msg_store,start_link,
...



From cremes.devlist at mac.com  Tue Jan  5 21:15:53 2010
From: cremes.devlist at mac.com (Chuck Remes)
Date: Tue, 05 Jan 2010 15:15:53 -0600
Subject: [rabbitmq-discuss] Erlang R12B and new persister
In-Reply-To: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>
References: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>
Message-ID: <CCC21710-6CB4-4B0A-82EA-A6479EF0DDB4@mac.com>


On Jan 5, 2010, at 2:55 PM, tsuraan wrote:

> Is there a desire to support the R12B releases of Erlang with the new
> persister code?  It looks like recently ets:update_element snuck in,
> which didn't exist until R13.  Can this easily be worked around, or
> will R13 be a requirement now?
>

There was a post to the list about 6 weeks ago talking about how much  
better the R13 garbage collector works with the new persister. I am  
pretty sure the devs are going to make R13 a requirement for that code  
so that it runs and behaves well.

cr




From tsuraan at gmail.com  Tue Jan  5 22:20:02 2010
From: tsuraan at gmail.com (tsuraan)
Date: Tue, 5 Jan 2010 16:20:02 -0600
Subject: [rabbitmq-discuss] Erlang R12B and new persister
In-Reply-To: <CCC21710-6CB4-4B0A-82EA-A6479EF0DDB4@mac.com>
References: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>
	<CCC21710-6CB4-4B0A-82EA-A6479EF0DDB4@mac.com>
Message-ID: <84fb38e31001051420p21546125ibe70e7b223251339@mail.gmail.com>

> There was a post to the list about 6 weeks ago talking about how much
> better the R13 garbage collector works with the new persister. I am
> pretty sure the devs are going to make R13 a requirement for that code
> so that it runs and behaves well.

Yeah, I read the discussion (and the commits where a ton of explicit
gc:collect calls were removed).  I was hoping R12 would still work,
since I have it on about 1200 machines that I'll otherwise have to
upgrade :)



From scott.brooks at epicadvertising.com  Wed Jan  6 00:58:16 2010
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Tue, 5 Jan 2010 18:58:16 -0600
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
	<C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>
	<8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>
Message-ID: <B1EF5BB5-5F73-4936-9A66-F1CAB17D1912@epicadvertising.com>

>From http://www.tin.org/bin/man.cgi?section=2&topic=select

If you specify select with a NULL timeout, then it will wait for ever which you don't want.
You should be able to specify a wait of 0, to have it return immediately.

Scott

On 2010-01-05, at 2:32 PM, Chris Duncan wrote:

Hi Scott,

If I read the details of the select call correctly, wouldn't I have to provide a timeout value so that if there is nothing to read from the socket I stop blocking and can publish the next message?

Regards,

Chris

On 5 Jan 2010, at 14:48, Scott Brooks wrote:

Have you tried calling select on your socket to see if there is any data available to be read before a publish?

Then your publish method could throw a ChannelFlowException or something like that.

If you are waiting on tx-ok, then you will have to wait the latency of your link to your rabbit server before sending your next message.  Even a 1 ms delay on your link limits you to 1000 messages/second.


On 2010-01-05, at 7:21 AM, Chris Duncan wrote:

I've been wanting to incorporate Channel.Flow method handling into the Bunny Ruby client library for a while. It's needed, but I want to do it in a simple, efficient way. I want to be able to give a client application the option to stop sending messages as soon as possible after receiving a Channel.Flow method (with :active => false) and that means that I need to know whether a Basic.Publish succeeds as well as whether it fails.

At the moment there is the potential for a client application to keep firing messages at the server whilst being oblivious to the fact that the server is telling it to stop. If the client application is just writing and not reading, purely a publisher of messages, then there has to be an efficient way of notifying the client that a publish has succeeded. As far as I can see, the simplest way to do that is with a publish-ok.

Transactions may give me what I want but I don't think that I should be enforcing the use of transactions in my client library just so that it will handle Channel.Flow methods properly.

Regards,

Chris <ATT00001.c>

---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com<http://www.EpicAdvertising.com/>
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
scott.brooks at epicadvertising.com<mailto:scott.brooks at epicadvertising.com>



---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com<http://www.EpicAdvertising.com>
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
scott.brooks at epicadvertising.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100105/0d82adab/attachment.htm 

From pathsny at gmail.com  Wed Jan  6 03:53:06 2010
From: pathsny at gmail.com (vishnu)
Date: Wed, 6 Jan 2010 09:23:06 +0530
Subject: [rabbitmq-discuss] Single vs Multiple Queues
Message-ID: <c89c65ea1001051953g49ba123ev582b501254186472@mail.gmail.com>

Hi
   We're looking at building a back end which picks up 3 or 4 different
messages. Now we have the option of using a single queue and sending
different messages through it, or multiple queues each of which is dedicated
for a single kind of message.

We're wondering what's more common. We're thinking of using Scala with lift
amqp or the Java api to connect to RabbitMq. On one hand using multiple
queues makes it seem like we're going to have to prioritise the number of
threads or processes per queue which seems like we're trying to optimise
that.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/97f0cef7/attachment.htm 

From celldee at gmail.com  Wed Jan  6 04:40:51 2010
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 6 Jan 2010 04:40:51 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <B1EF5BB5-5F73-4936-9A66-F1CAB17D1912@epicadvertising.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
	<C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>
	<8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>
	<B1EF5BB5-5F73-4936-9A66-F1CAB17D1912@epicadvertising.com>
Message-ID: <0781FBFE-29BC-4893-9393-4FF3697AB6AF@gmail.com>

Thanks Scott. I'll try that. I was looking to do a similar thing with  
the Ruby socket implementation but got hung up on the timeout issue.  
Do you know if there are any issues with Windows and select used in  
this way? I don't use Windows myself, but I don't want to introduce a  
problem for those who do.

I've also been reading the AMQP 0-10 specification. I have only  
skimmed it before because I wasn't targeting a broker that  
implemented it. It contains a section about transfer of  
responsibility that seems to deal with the issues that I've been  
trying to address in my last two posts.

Regards,

Chris

On 6 Jan 2010, at 00:58, Scott Brooks wrote:

> From http://www.tin.org/bin/man.cgi?section=2&topic=select
>
> If you specify select with a NULL timeout, then it will wait for  
> ever which you don't want.
> You should be able to specify a wait of 0, to have it return  
> immediately.
>
> Scott
>
> On 2010-01-05, at 2:32 PM, Chris Duncan wrote:
>
>> Hi Scott,
>>
>> If I read the details of the select call correctly, wouldn't I  
>> have to provide a timeout value so that if there is nothing to  
>> read from the socket I stop blocking and can publish the next  
>> message?
>>
>> Regards,
>>
>> Chris
>>
>> On 5 Jan 2010, at 14:48, Scott Brooks wrote:
>>
>>> Have you tried calling select on your socket to see if there is  
>>> any data available to be read before a publish?
>>>
>>> Then your publish method could throw a ChannelFlowException or  
>>> something like that.
>>>
>>> If you are waiting on tx-ok, then you will have to wait the  
>>> latency of your link to your rabbit server before sending your  
>>> next message.  Even a 1 ms delay on your link limits you to 1000  
>>> messages/second.
>>>
>>>
>>> On 2010-01-05, at 7:21 AM, Chris Duncan wrote:
>>>
>>>> I've been wanting to incorporate Channel.Flow method handling  
>>>> into the Bunny Ruby client library for a while. It's needed, but  
>>>> I want to do it in a simple, efficient way. I want to be able to  
>>>> give a client application the option to stop sending messages as  
>>>> soon as possible after receiving a Channel.Flow method  
>>>> (with :active => false) and that means that I need to know  
>>>> whether a Basic.Publish succeeds as well as whether it fails.
>>>>
>>>> At the moment there is the potential for a client application to  
>>>> keep firing messages at the server whilst being oblivious to the  
>>>> fact that the server is telling it to stop. If the client  
>>>> application is just writing and not reading, purely a publisher  
>>>> of messages, then there has to be an efficient way of notifying  
>>>> the client that a publish has succeeded. As far as I can see,  
>>>> the simplest way to do that is with a publish-ok.
>>>>
>>>> Transactions may give me what I want but I don't think that I  
>>>> should be enforcing the use of transactions in my client library  
>>>> just so that it will handle Channel.Flow methods properly.
>>>>
>>>> Regards,
>>>>
>>>> Chris <ATT00001.c>
>>>
>>> ---------------------
>>> Scott Brooks
>>> Web Developer
>>> Epic Advertising - New York, Toronto, San Francisco, London
>>> www.EpicAdvertising.com
>>> 60 Columbia Way, Suite 310
>>> Markham, ON L3R 0C9
>>> (905) 946-0300 x2356 - phone
>>> (888) 666-3120 - fax
>>> scott.brooks at epicadvertising.com
>>>
>>
>
> ---------------------
> Scott Brooks
> Web Developer
> Epic Advertising - New York, Toronto, San Francisco, London
> www.EpicAdvertising.com
> 60 Columbia Way, Suite 310
> Markham, ON L3R 0C9
> (905) 946-0300 x2356 - phone
> (888) 666-3120 - fax
> scott.brooks at epicadvertising.com
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/384b6566/attachment.htm 

From alexis.richardson at gmail.com  Wed Jan  6 06:55:38 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 6 Jan 2010 06:55:38 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <0781FBFE-29BC-4893-9393-4FF3697AB6AF@gmail.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>
	<C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>
	<8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>
	<B1EF5BB5-5F73-4936-9A66-F1CAB17D1912@epicadvertising.com>
	<0781FBFE-29BC-4893-9393-4FF3697AB6AF@gmail.com>
Message-ID: <167204d21001052255s2929db30r2a5ed835c0435410@mail.gmail.com>

On Wed, Jan 6, 2010 at 4:40 AM, Chris Duncan <celldee at gmail.com> wrote:
>
> I've also been reading the AMQP 0-10 specification. I have only skimmed it
> before because I wasn't targeting a broker that implemented it. It contains
> a section about transfer of responsibility that seems to deal with the
> issues that I've been trying to address in my last two posts.

Yes, that's how we designed it.  But, the goal of 0-10 was to provide
a way to use acks and nacks for exactly-once delivery.  Your email
only asks for an ack.  That's a bit easier and IMO better.

alexis



> Regards,
> Chris
> On 6 Jan 2010, at 00:58, Scott Brooks wrote:
>
> From?http://www.tin.org/bin/man.cgi?section=2&topic=select
> If you specify select with a NULL timeout, then it will wait for ever which
> you don't want.
> You should be able to specify a wait of 0, to have it return immediately.
> Scott
> On 2010-01-05, at 2:32 PM, Chris Duncan wrote:
>
> Hi Scott,
> If I read the details of the select call correctly, wouldn't I have to
> provide a timeout value so that if there is nothing to read from the socket
> I stop blocking and can publish the next message?
> Regards,
> Chris
> On 5 Jan 2010, at 14:48, Scott Brooks wrote:
>
> Have you tried calling select on your socket to see if there is any data
> available to be read before a publish?
> Then your publish method could throw a ChannelFlowException or something
> like that.
> If you are waiting on tx-ok, then you will have to wait the latency of your
> link to your rabbit server before sending your next message. ?Even a 1 ms
> delay on your link limits you to 1000 messages/second.
>
> On 2010-01-05, at 7:21 AM, Chris Duncan wrote:
>
> I've been wanting to incorporate Channel.Flow method handling into the Bunny
> Ruby client library for a while. It's needed, but I want to do it in a
> simple, efficient way. I want to be able to give a client application the
> option to stop sending messages as soon as possible after receiving a
> Channel.Flow method (with :active => false) and that means that I need to
> know whether a Basic.Publish succeeds as well as whether it fails.
>
> At the moment there is the potential for a client application to keep firing
> messages at the server whilst being oblivious to the fact that the server is
> telling it to stop. If the client application is just writing and not
> reading, purely a publisher of messages, then there has to be an efficient
> way of notifying the client that a publish has succeeded. As far as I can
> see, the simplest way to do that is with a publish-ok.
>
> Transactions may give me what I want but I don't think that I should be
> enforcing the use of transactions in my client library just so that it will
> handle Channel.Flow methods properly.
>
> Regards,
>
> Chris <ATT00001.c>
>
> ---------------------
> Scott Brooks
> Web Developer
> Epic Advertising - New York, Toronto, San Francisco, London
> www.EpicAdvertising.com
> 60 Columbia Way, Suite 310
> Markham, ON L3R 0C9
> (905) 946-0300 x2356 - phone
> (888) 666-3120 - fax
> scott.brooks at epicadvertising.com
>
>
>
> ---------------------
> Scott Brooks
> Web Developer
> Epic Advertising - New York, Toronto, San Francisco, London
> www.EpicAdvertising.com
> 60 Columbia Way, Suite 310
> Markham, ON L3R 0C9
> (905) 946-0300 x2356 - phone
> (888) 666-3120 - fax
> scott.brooks at epicadvertising.com
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Wed Jan  6 07:07:24 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 6 Jan 2010 07:07:24 +0000
Subject: [rabbitmq-discuss] Single vs Multiple Queues
In-Reply-To: <c89c65ea1001051953g49ba123ev582b501254186472@mail.gmail.com>
References: <c89c65ea1001051953g49ba123ev582b501254186472@mail.gmail.com>
Message-ID: <167204d21001052307r761ce78au6f3976be7a2125e9@mail.gmail.com>

Vishnu

If you hang multiple consumers off a single queue, then that queue's
state is shared and those consumers share the messages out between
them "round robin" style.  This is good for the 'master worker'
pattern for example.  Now, you can also have multiple queues doing a
master/worker type application.  For example you could have four
queues, one for 'large' tasks (messages), one for 'medium', one for
'small', and one more queue that gets a copy of all messages for
logging and management.  Each of those queues could be private to one
consumer, or it could be shared among a 'pool' of consumers (eg worker
threads).

In the above 'large'. 'medium', 'small' tasks example, you can load
balance work by size by allocating different numbers of consumers to
each queue.  So, if you want to filter your flows in the broker, use
many queues.  Using just one queue forces you to manage any filtering
in your thread pool.

alexis



On Wed, Jan 6, 2010 at 3:53 AM, vishnu <pathsny at gmail.com> wrote:
> Hi
> ? ?We're looking at building a back end which picks up 3 or 4 different
> messages. Now we have the option of using a single queue and sending
> different messages through it, or multiple queues each of which is dedicated
> for a single kind of message.
> We're wondering what's more common. We're thinking of using Scala with lift
> amqp or the Java api to connect to RabbitMq. On one hand using multiple
> queues makes it seem like we're going to have to prioritise the number of
> threads or processes per queue which seems like we're trying to optimise
> that.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From pathsny at gmail.com  Wed Jan  6 10:18:11 2010
From: pathsny at gmail.com (vishnu)
Date: Wed, 6 Jan 2010 15:48:11 +0530
Subject: [rabbitmq-discuss] Single vs Multiple Queues
In-Reply-To: <167204d21001052307r761ce78au6f3976be7a2125e9@mail.gmail.com>
References: <c89c65ea1001051953g49ba123ev582b501254186472@mail.gmail.com>
	<167204d21001052307r761ce78au6f3976be7a2125e9@mail.gmail.com>
Message-ID: <c89c65ea1001060218i22f83b55t3ebaec36cc34949d@mail.gmail.com>

Hi Alexis
    yeah, I see the argument about how using a single queue means I do the
filtering at the consumer end, but as I see it, it also means I no longer
have to figure out how to prioritise each of the tasks by providing a number
of consumers (though I can imagine that being useful at times).But if I
expect all jobs to as important, but the number of messages to be variable.
Using a single queue seems to give me the advantage that all messages are of
equal priority and so if I get three times the number of messages of one
type as opposed to others, that task is automatically going to get three
times the number of consumers. Do you have any thoughts about this?

This prevents me from having to juggle numbers to optimise different queues
with different pool size. The cost of filtering seems easier if I can make
sure my messages carry that information. I'm trying to figure out if this
advantage I see is deceptive? Is there a way to achieve the same goal with
different queues? For example if I have multiple queues can I make the pool
of consumers subscribe to all queues and pick up the first message that
comes through no matter what? Or does this not make sense.

Another question that might be related is the reason for the "channel"
abstraction. I have a connection over which I create a channel and then
register queues. What are channels for? Why would I have multiple channels
on one connection.

On Wed, Jan 6, 2010 at 12:37 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Vishnu
>
> If you hang multiple consumers off a single queue, then that queue's
> state is shared and those consumers share the messages out between
> them "round robin" style.  This is good for the 'master worker'
> pattern for example.  Now, you can also have multiple queues doing a
> master/worker type application.  For example you could have four
> queues, one for 'large' tasks (messages), one for 'medium', one for
> 'small', and one more queue that gets a copy of all messages for
> logging and management.  Each of those queues could be private to one
> consumer, or it could be shared among a 'pool' of consumers (eg worker
> threads).
>
> In the above 'large'. 'medium', 'small' tasks example, you can load
> balance work by size by allocating different numbers of consumers to
> each queue.  So, if you want to filter your flows in the broker, use
> many queues.  Using just one queue forces you to manage any filtering
> in your thread pool.
>
> alexis
>
>
>
> On Wed, Jan 6, 2010 at 3:53 AM, vishnu <pathsny at gmail.com> wrote:
> > Hi
> >    We're looking at building a back end which picks up 3 or 4 different
> > messages. Now we have the option of using a single queue and sending
> > different messages through it, or multiple queues each of which is
> dedicated
> > for a single kind of message.
> > We're wondering what's more common. We're thinking of using Scala with
> lift
> > amqp or the Java api to connect to RabbitMq. On one hand using multiple
> > queues makes it seem like we're going to have to prioritise the number of
> > threads or processes per queue which seems like we're trying to optimise
> > that.
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/469b1b92/attachment.htm 

From alexis.richardson at gmail.com  Wed Jan  6 10:35:06 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 6 Jan 2010 10:35:06 +0000
Subject: [rabbitmq-discuss] Single vs Multiple Queues
In-Reply-To: <c89c65ea1001060218i22f83b55t3ebaec36cc34949d@mail.gmail.com>
References: <c89c65ea1001051953g49ba123ev582b501254186472@mail.gmail.com>
	<167204d21001052307r761ce78au6f3976be7a2125e9@mail.gmail.com>
	<c89c65ea1001060218i22f83b55t3ebaec36cc34949d@mail.gmail.com>
Message-ID: <167204d21001060235g60cd2df4xbde3e9b9c0c886b5@mail.gmail.com>

Vishnu,

On Wed, Jan 6, 2010 at 10:18 AM, vishnu <pathsny at gmail.com> wrote:
> Hi Alexis
> ? ? yeah, I see the argument about how using a single queue means I do the
> filtering at the consumer end, but as I see it, it also means I no longer
> have to figure out how to prioritise each of the tasks by providing a number
> of consumers (though I can imagine that being useful at times).

Yes and no.

You could easily write your consumers so that they scheduled
themselves across queues on a by-need basis.  For example if a
consumer finds a queue to be empty, then it tries the next queue.  And
so on.  Many strategies are possible.


> But if I
> expect all jobs to as important, but the number of messages to be variable.
> Using a single queue seems to give me the advantage that all messages are of
> equal priority and so if I get three times the number of messages of one
> type as opposed to others, that task is automatically going to get three
> times the number of consumers.

If all messages are of equal priority and you want them to be fairly
shared across all consumers, then using one queue makes sense.

You can always add more queues and more subtle behaviour later!



>  Do you have any thoughts about this?

See above :-)


> This prevents me from having to juggle numbers to optimise different queues
> with different pool size. The cost of filtering seems easier if I can make
> sure my messages carry that information. I'm trying to figure out if this
> advantage I see is deceptive? Is there a way to achieve the same goal with
> different queues? For example if I have multiple queues can I make the pool
> of consumers subscribe to all queues and pick up the first message that
> comes through no matter what? Or does this not make sense.

You can certainly have N queues and connect all M consumers to all N queues.


> Another question that might be related is the reason for the "channel"
> abstraction. I have a connection over which I create a channel and then
> register queues. What are channels for? Why would I have multiple channels
> on one connection.

As I recall, others have asked this question.  IIRC the reason was to
create logically isolated communication links ('channels') without
compelling everyone to open lots of connections.

But perhaps someone can give a better answer.

alexis




> On Wed, Jan 6, 2010 at 12:37 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Vishnu
>>
>> If you hang multiple consumers off a single queue, then that queue's
>> state is shared and those consumers share the messages out between
>> them "round robin" style. ?This is good for the 'master worker'
>> pattern for example. ?Now, you can also have multiple queues doing a
>> master/worker type application. ?For example you could have four
>> queues, one for 'large' tasks (messages), one for 'medium', one for
>> 'small', and one more queue that gets a copy of all messages for
>> logging and management. ?Each of those queues could be private to one
>> consumer, or it could be shared among a 'pool' of consumers (eg worker
>> threads).
>>
>> In the above 'large'. 'medium', 'small' tasks example, you can load
>> balance work by size by allocating different numbers of consumers to
>> each queue. ?So, if you want to filter your flows in the broker, use
>> many queues. ?Using just one queue forces you to manage any filtering
>> in your thread pool.
>>
>> alexis
>>
>>
>>
>> On Wed, Jan 6, 2010 at 3:53 AM, vishnu <pathsny at gmail.com> wrote:
>> > Hi
>> > ? ?We're looking at building a back end which picks up 3 or 4 different
>> > messages. Now we have the option of using a single queue and sending
>> > different messages through it, or multiple queues each of which is
>> > dedicated
>> > for a single kind of message.
>> > We're wondering what's more common. We're thinking of using Scala with
>> > lift
>> > amqp or the Java api to connect to RabbitMq. On one hand using multiple
>> > queues makes it seem like we're going to have to prioritise the number
>> > of
>> > threads or processes per queue which seems like we're trying to optimise
>> > that.
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthew at lshift.net  Wed Jan  6 11:03:08 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 6 Jan 2010 11:03:08 +0000
Subject: [rabbitmq-discuss] adjusting timeout for non-acked messages to
 be requeued
In-Reply-To: <c89c65ea0912291937o7b7b6ff8r161222adc358dcbe@mail.gmail.com>
References: <c89c65ea0912282037x7f04d9d6p13da2530eb8ce1e3@mail.gmail.com>
	<167204d20912290548n2bef2766s5d6c00cee28aaf2f@mail.gmail.com>
	<c89c65ea0912290657v313c8c72te0330365d7aae349@mail.gmail.com>
	<167204d20912290706n23d5b13frb1cd02b0802d3b7e@mail.gmail.com>
	<c89c65ea0912291234s1fbbf958nc64e9e91071439b1@mail.gmail.com>
	<167204d20912291504h121bb51bob14a97af735d8d2b@mail.gmail.com>
	<c89c65ea0912291937o7b7b6ff8r161222adc358dcbe@mail.gmail.com>
Message-ID: <20100106110307.GD27068@wellquite.org>

Hi Vishnu,

On Wed, Dec 30, 2009 at 09:07:53AM +0530, vishnu wrote:
>    thanks, I think Im getting a better understanding now. Initially I wanted
> to look at auto requeueing for circumstances when my client subscribing to
> events went down or got disconnected. Now my understanding is that in those
> cases, messages get auto requeued.

Correct.

>     However, if I choose not to autoack, then it looks like the
> responsibility of requeuing a client, forcing a time delay on the delivery
> and also maybe forcing a limit on the number of passes through the queue is
> going to have to become subscriber responsibility. I was hoping to handle
> that as a configuration on the queue itself outside of code, but I guess
> that isn't possible.
> 
> (the use case we have requires us to make sure that every message is
> processed as far as possible. Meaning actual failures and successes are sent
> onward, but failures for technical reasons require us to try again later, by
> which time the technical issue might have been resolved).

Rabbit does eventual delivery. Thus eventually, the message will be
delivered. However, it may be delivered to more than one consumer. A
message that is not ack'd will, when the channel on which it was
delivered closes (or the connection, or some other condition that I
always forget, but which Matthias pointed out within about the last
month on this list), be reinserted into its queue to be redelivered.

Thus if you set qos.prefetch to 1, don't auto-ack, and then your client
goes down, you have the following set of properties:
1) Your client will only receive the next message when it's successfully
ack'd the current message.
2) If the client crashes, at most 1 message (i.e. the message that it's
currently processing) will be requeued.
3) If you want to do timeouts, if depends where you wish to put the
timeout - kill clients if they're taking too long (this seems odd) - or
drop messages you receive (i.e. ack them but do no work) if they're
deemed too old. But yes, that's all client-side logic - we don't do TTL
in the server yet.

Matthew



From matthew at lshift.net  Wed Jan  6 11:16:51 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 6 Jan 2010 11:16:51 +0000
Subject: [rabbitmq-discuss] High CPU Usage
In-Reply-To: <7fd310d10912301525k231677f3j7f1c0b1d627549fc@mail.gmail.com>
References: <7fd310d10912301525k231677f3j7f1c0b1d627549fc@mail.gmail.com>
Message-ID: <20100106111650.GE27068@wellquite.org>

Hi Bryan,

On Wed, Dec 30, 2009 at 05:25:57PM -0600, Bryan Murphy wrote:
> I want to set up 3 queues, High, Medium, and Low where I always pull
> messages from the higher priority queues first.  Right now, I more or less
> do the following:
> 
> while (true)
> {
>   result = null;
> 
>   foreach (var queue in queues)
>   {
>     result = model.BasicGet(queue, false);
> 
>     if (result != null)
>       break;
>   }
> 
>   if (result != null)
>     DoSomething(result);
> 
>   Thread.Sleep(15); // 15ms
> }
> 
> Functionally this achieves what I'm trying to accomplish, however, the CPU
> usage of the RabbitMQ server goes through the roof once I spin up a few
> listeners.

Hmmm. Which version of Rabbit are you using. I've just done some maths
and this loop may be doing about 143 calls to basic.get per second
(assuming 2ms for each basic.get). I'm just wondering whether you're
using a version before 1.7.0 in which the queues are hibernating and
thawing too frequently, thus burning up a lot of CPU. On the other hand,
if this was the case, then I'd expect adding more listeners would
improve the situation, not make it worse.

> Is there another way I can accomplish the same thing that doesn't hit the
> RabbitMQ server so hard?

Yes. 3 channels, each one consumes from 1 queue. Then (assuming you're
using the Java client), use the QueueingConsumer, and translate your
foreach to the nextDelivery with a timeout of 0. Also set qos.prefetch
to 1.

Thus the logic is effectively pushed client side.

However, this is not quite the same. With this version, each listener
would buffer up to 1 message from the high queue, 1 from the medium
queue and 1 from the low queue. Thus some other listener could come
along, find that there are no messages at all to process, because
they're currently being buffered by the other listeners. Those listeners
will eventually get to those buffered messages when they finish
processing they're current message, get back to their loop, and find the
lower priority messages. So it could simply mean that lower priority
messages are ignored for longer than they otherwise would be.

Oh, and you'll probably want some logic so that if all three queues are
empty, you don't sit spinning.

Matthew



From matthew at lshift.net  Wed Jan  6 11:26:51 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 6 Jan 2010 11:26:51 +0000
Subject: [rabbitmq-discuss] Transactions on acks
In-Reply-To: <c89c65ea0912302051w2ba7b05bra8c775b0d53f9905@mail.gmail.com>
References: <c89c65ea0912302051w2ba7b05bra8c775b0d53f9905@mail.gmail.com>
Message-ID: <20100106112650.GF27068@wellquite.org>

Hi Vishnu,

On Thu, Dec 31, 2009 at 10:21:30AM +0530, vishnu wrote:
>    I'm trying to understand how transactions help on the ack side of things.
> I can understand how I'd do a tx_select, a basic ack, my processing and then
> a tx_commit.

You could do that, yes. But that's not the usual case. The usual case on
consumption is to just ack when you're done with processing a message -
no need to use tx at that point.

However, if, as part of your processing, you need to both ack a message
and publish some other messages, then you may well want that to be an
atomic unit - i.e. either they both happen, or neither happen. So at
that point, you can set tx_commit on the channel, and then when
processing the received message, you can publish and ack and only when
you finally tx_commit, do the actions of your transaction take effect.
Thus if you crash, both the act and all publishes get forgotten.

> But when would I do a tx_rollback?

If, at the application level, you realise due to some external event
that you wish to cancel everything that you've done in this transaction,
use tx_rollback.

Matthew



From matthew at lshift.net  Wed Jan  6 11:36:43 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 6 Jan 2010 11:36:43 +0000
Subject: [rabbitmq-discuss] .Net client foreground threads
In-Reply-To: <2545a92c0912291639j30947627m5636329a0927df83@mail.gmail.com>
References: <2545a92c0912291639j30947627m5636329a0927df83@mail.gmail.com>
Message-ID: <20100106113643.GG27068@wellquite.org>

Hi Jeremy,

On Tue, Dec 29, 2009 at 06:39:28PM -0600, Jeremy Dunck wrote:
> Is there a reason for the main loop and heartbeat threads to be
> Foreground threads?  I was expecting my process to die when my last
> app thread died, but the Rabbit threads are Foreground (the default)
> so they keep the process alive.

Yes, we agree, the standard patterns of use for C# and Java suggest that
these threads should be background/daemon. We have a bug open to cover
this for the Java client, and I've added a not to it so that it covers
the C# thread too.

Although this may sound a bit like doing manual memory-management, it is
probably a good idea to think about how could could manually shutdown
the AMQP connection. That way you will get some guarantees about
messages which are sitting in buffers actually being flushed out (if you
just terminate abruptly, you /could/ lose publishes that have not made
it to the OS TCP buffers yet).

Matthew



From matthew at lshift.net  Wed Jan  6 11:48:07 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 6 Jan 2010 11:48:07 +0000
Subject: [rabbitmq-discuss] Rabbit-MQ crashing
In-Reply-To: <d9743bb41001030905g35992b1ema5c1290217415f8f@mail.gmail.com>
References: <4ece5be60911100944y696030e9ga2ba6d153d0c19b6@mail.gmail.com>
	<4AFC1AF3.6000406@lshift.net>
	<d9743bb41001030905g35992b1ema5c1290217415f8f@mail.gmail.com>
Message-ID: <20100106114807.GH27068@wellquite.org>

Hi Steve,

On Sun, Jan 03, 2010 at 09:05:55AM -0800, Steve Conover wrote:
> We're experiencing this problem as well.  Just from reading the list
> it seems that the new persister stuff committed around 12/1 is
> supposed to fix it.
> 
> I'm curious:
> 
> - has this bug indeed been fixed?
> - is the code somewhere past bleeding edge?  Would you consider it to be stable?
> - please excuse my ignorance, but is there any bug or ticket url that
> I can follow to keep track of the fix / when it's been released / etc
> ?

The new persister is available only from our mercurial repository at
http://hg.rabbitmq.com/rabbitmq-server

You should be on branch bug21673

The code there is a substantial reworking of Rabbit's persister layer -
about a third of the code is different from that released in 1.7.0.
Several people on this list are using bug21673 successfully, but do from
time to time report bugs (which are usually fixed within a matter of
hours!).

Several of my blog posts and presentations that I've given on the new
persister cover the various issues of the current persister that we're
working to solve. Start at
http://www.lshift.net/blog/category/lshift-sw/rabbitmq and look at the
posts by me (not to say the others aren't interesting, just that they
don't cover the new persister!).

We don't really consider anything to be "stable". 1.5.4 was, IIRC,
marked "stable", but I think that's the only release we've ever
indicated as such. 1.7.0 is not marked "stable" because quite a lot of
code changed between 1.6.1 and 1.7.0. However, in reality, I don't know
if anyone has come across any bugs at all in 1.7.0 (which isn't to say
that we haven't, only to say that these bugs haven't been spotted by
others).

Some of the code in bug21673 has been through QA, some of it hasn't. In
reality, that code isn't going to appear in a stable release for some
months, but if you're aware of the risks and are happy to accomodate
them then you may well find bug21673 to be good enough for your
purposes. However, if/when it breaks, you get to keep all the pieces,
and we don't restrain ourselves from introducing changes which mean that
it will crash on startup if you don't nuke out your existing database.
We do however, very much welcome bug reports.

I hope that's of some use.

Matthew



From matthew at lshift.net  Wed Jan  6 12:02:30 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 6 Jan 2010 12:02:30 +0000
Subject: [rabbitmq-discuss] Erlang R12B and new persister
In-Reply-To: <84fb38e31001051420p21546125ibe70e7b223251339@mail.gmail.com>
References: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>
	<CCC21710-6CB4-4B0A-82EA-A6479EF0DDB4@mac.com>
	<84fb38e31001051420p21546125ibe70e7b223251339@mail.gmail.com>
Message-ID: <20100106120230.GI27068@wellquite.org>

On Tue, Jan 05, 2010 at 04:20:02PM -0600, tsuraan wrote:
> > There was a post to the list about 6 weeks ago talking about how much
> > better the R13 garbage collector works with the new persister. I am
> > pretty sure the devs are going to make R13 a requirement for that code
> > so that it runs and behaves well.
> 
> Yeah, I read the discussion (and the commits where a ton of explicit
> gc:collect calls were removed).  I was hoping R12 would still work,
> since I have it on about 1200 machines that I'll otherwise have to
> upgrade :)

Thanks for that report. I need to check with Matthias on this one.
Personally, ets:update_element is so useful (mainly because it's atomic
which helps massively with concurrent access to ets tables) that I would
argue in favour of requiring R13, and indeed I'm planning on adding more
ets:update_element calls this afternoon!

Having checked the code, the update_element calls in msg_store and
msg_store_gc could be worked around. The update_element in
msg_store_ets_index can't be, but if you use the rabbitmq-toke plugin
then that avoids that.

ets:update_element appeared in R12B2, according to
http://www.erlang.org/download/otp_src_R12B-2.readme . The last time we
had this discussion in the office, I _think_ we maybe settled on saying
that we would support back to Debian stable (currently lenny), which is
R12B3. Given that Debian testing (squeeze) is already on R13B2, and our
release cycle is probably slower than Debian's, I would be surprised if
the new persister is released before the squeeze goes stable! Thus you
may well find that by the time it's released, we require R13.

Matthew



From matthew at lshift.net  Wed Jan  6 12:07:40 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 6 Jan 2010 12:07:40 +0000
Subject: [rabbitmq-discuss] Transactions on acks
In-Reply-To: <c89c65ea1001060353g1eda47d8yeb12a4d5462948ae@mail.gmail.com>
References: <c89c65ea0912302051w2ba7b05bra8c775b0d53f9905@mail.gmail.com>
	<20100106112650.GF27068@wellquite.org>
	<c89c65ea1001060353g1eda47d8yeb12a4d5462948ae@mail.gmail.com>
Message-ID: <20100106120740.GJ27068@wellquite.org>

Hi Vishnu,

(Please keep the discussion list CC'd unless you explicitly want to take
the discussion off list - that way google can index these questions for
others to find).

On Wed, Jan 06, 2010 at 05:23:23PM +0530, vishnu wrote:
>    I guess the part that confuses me is when I recieve a message, try to
> perform a bunch of operations in a transaction and then rollback.
> now Im still holding onto the message and it still isn't acked. so my only
> option is to actually try again. Is that right?

Yes. Or you could close the channel or connection at which point the
message will automatically be requeued.

Matthew



From pathsny at gmail.com  Wed Jan  6 14:16:45 2010
From: pathsny at gmail.com (vishnu)
Date: Wed, 6 Jan 2010 19:46:45 +0530
Subject: [rabbitmq-discuss] Queuing for an application that does a fair
	amount of synchronous processing
In-Reply-To: <c89c65ea0912311136y2813251ci68a9bc7a3a9002f5@mail.gmail.com>
References: <c89c65ea0912310715l7411fd43xfd5d9b8294bd4f1d@mail.gmail.com>
	<29F69053-E0CB-4A9F-B4AE-ECB2F697E106@mac.com>
	<c89c65ea0912311136y2813251ci68a9bc7a3a9002f5@mail.gmail.com>
Message-ID: <c89c65ea1001060616q6336693cqbc40d3946123e0cc@mail.gmail.com>

We're also looking at about 3000 messages/second (high side), out of which
we need 1000 of these to be persistent (since they represent payments that
must happen). However all of these are currently meant to be synchronous,
meaning we have someone sitting on a browser waiting for us to deal with
this message and send a response back. So in the short term the only
advantage we're hoping to gain is in the case of the persistent queues. In
this case we're relying on the guarantee that the message will be dealt with
even if there is some temporary glitch, and our web based client gets a
timeout message.

The way we plan to implement these synchronous messages is, similar to the
RPC model, to create a temporary queue when we send out a request and
subscribe to that queue with a timeout for a response, deleting it after
we're done.

now, if the webserver thread breaks out of the wait before the message
returns, my understanding is that the temporary queue gets deleted and the
response from the backend server is sent to the exchange where it dies.
(which is fine)

if the webserver thread breaks out of the wait after the message returns,
the queue gets deleted anyway and the message should vanish.

If the webserver thread dies for some reason, the queue gets auto deleted
and so the  backend server again sends the response to the exchange to a non
existent queue.

However, the problem comes in when the webserver thread dies just as the
response returns on the temporary queue. When this race condition occurs,
the queue should remain on the rabbitmq-server forever. Is this right, or is
there something I'm missing?

On Fri, Jan 1, 2010 at 1:06 AM, vishnu <pathsny at gmail.com> wrote:

> fair enough, let me come back with some numbers :), I just wanted to first
> make sure I'm not doing something brain dead :).
>
>
> On Thu, Dec 31, 2009 at 8:51 PM, Chuck Remes <cremes.devlist at mac.com>wrote:
>
>>
>> On Dec 31, 2009, at 9:15 AM, vishnu wrote:
>>
>> > Hi
>> >    We're looking at building an application that does a fair amount
>> > of synchronous processing. However we are investigating using a
>> > queuing system as a messaging bus because some of these processes
>> > are meant to be reliable. Using a queue helps us guarantee that
>> > messages are dealt with and avoids us having to right background
>> > processes to clean up after us.
>> >
>> > There are, however, a fair number of operations that are not
>> > required to be reliable and we are thinking of implementing these
>> > also through the queue but use non persistent queues. Now the
>> > concern we have is the kinds of latencies we might see. So I'd like
>> > to get general feedback on using this approach.
>>
>> Give us some idea of the data rates you are expecting. I regularly
>> publish 3000+ messages/second using ruby which isn't exactly known for
>> its performance. :)  Latency is a millisecond or so for topic
>> exchanges, and under 1 millisecond for direct and fanout exchanges.
>> (Exchange type matters due to matching overhead.)
>>
>> However, since you say that all processing is synchronous, the length
>> of time to complete that process will be your gating factor.
>>
>> cr
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/23afa1ec/attachment.htm 

From pathsny at gmail.com  Wed Jan  6 14:28:24 2010
From: pathsny at gmail.com (vishnu)
Date: Wed, 6 Jan 2010 19:58:24 +0530
Subject: [rabbitmq-discuss] Transactions on acks
In-Reply-To: <20100106120740.GJ27068@wellquite.org>
References: <c89c65ea0912302051w2ba7b05bra8c775b0d53f9905@mail.gmail.com>
	<20100106112650.GF27068@wellquite.org>
	<c89c65ea1001060353g1eda47d8yeb12a4d5462948ae@mail.gmail.com>
	<20100106120740.GJ27068@wellquite.org>
Message-ID: <c89c65ea1001060628k5ce3217al711519b59fd76096@mail.gmail.com>

Hi Matthew

sure thing, sorry the list doesn't seem to be configured right. The default
reply behavior should be to the list :/

On Wed, Jan 6, 2010 at 5:37 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Vishnu,
>
> (Please keep the discussion list CC'd unless you explicitly want to take
> the discussion off list - that way google can index these questions for
> others to find).
>
> On Wed, Jan 06, 2010 at 05:23:23PM +0530, vishnu wrote:
> >    I guess the part that confuses me is when I recieve a message, try to
> > perform a bunch of operations in a transaction and then rollback.
> > now Im still holding onto the message and it still isn't acked. so my
> only
> > option is to actually try again. Is that right?
>
> Yes. Or you could close the channel or connection at which point the
> message will automatically be requeued.
>
ah I see, thanks.


> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/26be1ed5/attachment.htm 

From celldee at gmail.com  Wed Jan  6 17:07:29 2010
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 6 Jan 2010 17:07:29 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <4B44BF73.6060006@gmail.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>	<C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>	<8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>	<B1EF5BB5-5F73-4936-9A66-F1CAB17D1912@epicadvertising.com>	<0781FBFE-29BC-4893-9393-4FF3697AB6AF@gmail.com>
	<167204d21001052255s2929db30r2a5ed835c0435410@mail.gmail.com>
	<4B44BF73.6060006@gmail.com>
Message-ID: <84FDBAAF-9FC8-4B2C-83FE-B12E21365AF5@gmail.com>

Hi Gordon,

On 6 Jan 2010, at 16:50, Gordon Sim wrote:

> On 01/06/2010 06:55 AM, Alexis Richardson wrote:
>> On Wed, Jan 6, 2010 at 4:40 AM, Chris Duncan<celldee at gmail.com>   
>> wrote:
>>>
>>> I've also been reading the AMQP 0-10 specification. I have only  
>>> skimmed it
>>> before because I wasn't targeting a broker that implemented it.  
>>> It contains
>>> a section about transfer of responsibility that seems to deal  
>>> with the
>>> issues that I've been trying to address in my last two posts.
>>
>> Yes, that's how we designed it.  But, the goal of 0-10 was to provide
>> a way to use acks and nacks for exactly-once delivery.  Your email
>> only asks for an ack.  That's a bit easier and IMO better.
>
> The need for some confirmation of publish is much wider than  
> exactly-once delivery. That confirmation mechanism should also  
> support asynchronous use if desired to avoid the performance impact  
> Scott points out[*].
>
> The 0-10 protocol doesn't really provide nacks per se. It has a  
> message-release command which is useful when subscribers want to  
> use prefetch and need to relinquish some of the messages delivered  
> to them without killing the session.
>
> [*] Perhaps of interest to mention that there was some disagreement  
> within the amqp wg on whether -ok response to methods identified as  
> synchronous by the 0-8 spec could be used asynchronously i.e.  
> whether it was valid to send methods without waiting for the -ok  
> and process receipt of those -ok response as they arrive in the  
> other direction. Most (all?) of them aren't explicitly correlated,  
> so were you to do that you would need to rely on the order of -oks  
> matching the order of methods which if I recall correctly was the  
> cause for concern at the time.

I thought that the :nowait argument in the 0-8, 0-9 and 0-9-1 specs  
was what provides the ability to use synchronous methods in an  
asynchronous fashion. When I use the terms synchronous and  
asynchronous here I'm using them in the manner that the AMQP specs  
seem to use them; namely synchronous methods send a response to tell  
you whether they've succeeded and asynchronous ones don't. If :nowait  
is set to true doesn't that mean that the server will not send an -ok  
response?

Regards,

Chris



From gsim at redhat.com  Wed Jan  6 17:16:49 2010
From: gsim at redhat.com (Gordon Sim)
Date: Wed, 06 Jan 2010 17:16:49 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <167204d21001052255s2929db30r2a5ed835c0435410@mail.gmail.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>	<C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>	<8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>	<B1EF5BB5-5F73-4936-9A66-F1CAB17D1912@epicadvertising.com>	<0781FBFE-29BC-4893-9393-4FF3697AB6AF@gmail.com>
	<167204d21001052255s2929db30r2a5ed835c0435410@mail.gmail.com>
Message-ID: <4B44C581.9030007@redhat.com>

On 01/06/2010 06:55 AM, Alexis Richardson wrote:
> On Wed, Jan 6, 2010 at 4:40 AM, Chris Duncan<celldee at gmail.com>  wrote:
>>
>> I've also been reading the AMQP 0-10 specification. I have only skimmed it
>> before because I wasn't targeting a broker that implemented it. It contains
>> a section about transfer of responsibility that seems to deal with the
>> issues that I've been trying to address in my last two posts.
>
> Yes, that's how we designed it.  But, the goal of 0-10 was to provide
> a way to use acks and nacks for exactly-once delivery.  Your email
> only asks for an ack.  That's a bit easier and IMO better.

The need for some confirmation of publish is much wider than 
exactly-once delivery. That confirmation mechanism should also support 
asynchronous use if desired to avoid the performance impact Scott points 
out[*].

The 0-10 protocol doesn't really provide nacks per se. It has a 
message-release command which is useful when subscribers want to use 
prefetch and need to relinquish some of the messages delivered to them 
without killing the session.

[*] Perhaps of interest to mention that there was some disagreement 
within the amqp wg on whether -ok response to methods identified as 
synchronous by the 0-8 spec could be used asynchronously i.e. whether it 
was valid to send methods without waiting for the -ok and process 
receipt of those -ok response as they arrive in the other direction. 
Most (all?) of them aren't explicitly correlated, so were you to do that 
you would need to rely on the order of -oks matching the order of 
methods which if I recall correctly was the cause for concern at the time.



From gsim at redhat.com  Wed Jan  6 17:17:27 2010
From: gsim at redhat.com (Gordon Sim)
Date: Wed, 06 Jan 2010 17:17:27 +0000
Subject: [rabbitmq-discuss] JMS/AMQP use case
In-Reply-To: <167204d21001050306h4f8a1106t2b4b5bce4e5913eb@mail.gmail.com>
References: <4B42EB19.2060101@gmail.com>
	<167204d21001050306h4f8a1106t2b4b5bce4e5913eb@mail.gmail.com>
Message-ID: <4B44C5A7.7010903@redhat.com>

On 01/05/2010 11:06 AM, Alexis Richardson wrote:
> If you want to do this the other way round, ie. send JMS messages to
> RabbitMQ, then you can use the JMS client.

I believe the Qpid JMS client will interoperate with RabbitMQ also if 
you'd like to try that. There's some info on 
http://www.rabbitmq.com/interoperability.html and I'm sure you would get 
assistance with any issues from the JMS experts on users at qpid.apache.org 
also.



From gsim at redhat.com  Wed Jan  6 17:28:42 2010
From: gsim at redhat.com (Gordon Sim)
Date: Wed, 06 Jan 2010 17:28:42 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <84FDBAAF-9FC8-4B2C-83FE-B12E21365AF5@gmail.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>	<C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>	<8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>	<B1EF5BB5-5F73-4936-9A66-F1CAB17D1912@epicadvertising.com>	<0781FBFE-29BC-4893-9393-4FF3697AB6AF@gmail.com>	<167204d21001052255s2929db30r2a5ed835c0435410@mail.gmail.com>	<4B44BF73.6060006@gmail.com>
	<84FDBAAF-9FC8-4B2C-83FE-B12E21365AF5@gmail.com>
Message-ID: <4B44C84A.3070101@redhat.com>

On 01/06/2010 05:07 PM, Chris Duncan wrote:
> Hi Gordon,
>
> On 6 Jan 2010, at 16:50, Gordon Sim wrote:
>
>> On 01/06/2010 06:55 AM, Alexis Richardson wrote:
>>> On Wed, Jan 6, 2010 at 4:40 AM, Chris Duncan<celldee at gmail.com>
>>> wrote:
>>>>
>>>> I've also been reading the AMQP 0-10 specification. I have only
>>>> skimmed it
>>>> before because I wasn't targeting a broker that implemented it.
>>>> It contains
>>>> a section about transfer of responsibility that seems to deal
>>>> with the
>>>> issues that I've been trying to address in my last two posts.
>>>
>>> Yes, that's how we designed it.  But, the goal of 0-10 was to provide
>>> a way to use acks and nacks for exactly-once delivery.  Your email
>>> only asks for an ack.  That's a bit easier and IMO better.
>>
>> The need for some confirmation of publish is much wider than
>> exactly-once delivery. That confirmation mechanism should also
>> support asynchronous use if desired to avoid the performance impact
>> Scott points out[*].
>>
>> The 0-10 protocol doesn't really provide nacks per se. It has a
>> message-release command which is useful when subscribers want to
>> use prefetch and need to relinquish some of the messages delivered
>> to them without killing the session.
>>
>> [*] Perhaps of interest to mention that there was some disagreement
>> within the amqp wg on whether -ok response to methods identified as
>> synchronous by the 0-8 spec could be used asynchronously i.e.
>> whether it was valid to send methods without waiting for the -ok
>> and process receipt of those -ok response as they arrive in the
>> other direction. Most (all?) of them aren't explicitly correlated,
>> so were you to do that you would need to rely on the order of -oks
>> matching the order of methods which if I recall correctly was the
>> cause for concern at the time.
>
> I thought that the :nowait argument in the 0-8, 0-9 and 0-9-1 specs
> was what provides the ability to use synchronous methods in an
> asynchronous fashion. When I use the terms synchronous and
> asynchronous here I'm using them in the manner that the AMQP specs
> seem to use them; namely synchronous methods send a response to tell
> you whether they've succeeded and asynchronous ones don't. If :nowait
> is set to true doesn't that mean that the server will not send an -ok
> response?

Yes that is correct. My point was simply that sometimes you want to get 
a response (e.g. to confirm success) but you don't want to have to wait 
for that response before sending further requests (i.e. you don't want 
to be forced into strictly synchronous communication, but you do want to 
track success).




From celldee at gmail.com  Wed Jan  6 17:39:05 2010
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 6 Jan 2010 17:39:05 +0000
Subject: [rabbitmq-discuss] Handling Channel.Flow method
In-Reply-To: <4B44C84A.3070101@redhat.com>
References: <e1542d31001050421j5e8b3b0dn8b81ce80dd53d976@mail.gmail.com>	<C9E4BF2C-4E76-4BE3-B260-77AA89A0842A@epicadvertising.com>	<8AD52582-E31C-429C-BC2C-88BB53E88AFE@gmail.com>	<B1EF5BB5-5F73-4936-9A66-F1CAB17D1912@epicadvertising.com>	<0781FBFE-29BC-4893-9393-4FF3697AB6AF@gmail.com>	<167204d21001052255s2929db30r2a5ed835c0435410@mail.gmail.com>	<4B44BF73.6060006@gmail.com>
	<84FDBAAF-9FC8-4B2C-83FE-B12E21365AF5@gmail.com>
	<4B44C84A.3070101@redhat.com>
Message-ID: <F7AA01CC-A1EE-4CEC-8FC5-186FDC6CC8A2@gmail.com>

Hi Gordon,

On 6 Jan 2010, at 17:28, Gordon Sim wrote:

> On 01/06/2010 05:07 PM, Chris Duncan wrote:
>> Hi Gordon,
>>
>> On 6 Jan 2010, at 16:50, Gordon Sim wrote:
>>
>>> On 01/06/2010 06:55 AM, Alexis Richardson wrote:
>>>> On Wed, Jan 6, 2010 at 4:40 AM, Chris Duncan<celldee at gmail.com>
>>>> wrote:
>>>>>
>>>>> I've also been reading the AMQP 0-10 specification. I have only
>>>>> skimmed it
>>>>> before because I wasn't targeting a broker that implemented it.
>>>>> It contains
>>>>> a section about transfer of responsibility that seems to deal
>>>>> with the
>>>>> issues that I've been trying to address in my last two posts.
>>>>
>>>> Yes, that's how we designed it.  But, the goal of 0-10 was to  
>>>> provide
>>>> a way to use acks and nacks for exactly-once delivery.  Your email
>>>> only asks for an ack.  That's a bit easier and IMO better.
>>>
>>> The need for some confirmation of publish is much wider than
>>> exactly-once delivery. That confirmation mechanism should also
>>> support asynchronous use if desired to avoid the performance impact
>>> Scott points out[*].
>>>
>>> The 0-10 protocol doesn't really provide nacks per se. It has a
>>> message-release command which is useful when subscribers want to
>>> use prefetch and need to relinquish some of the messages delivered
>>> to them without killing the session.
>>>
>>> [*] Perhaps of interest to mention that there was some disagreement
>>> within the amqp wg on whether -ok response to methods identified as
>>> synchronous by the 0-8 spec could be used asynchronously i.e.
>>> whether it was valid to send methods without waiting for the -ok
>>> and process receipt of those -ok response as they arrive in the
>>> other direction. Most (all?) of them aren't explicitly correlated,
>>> so were you to do that you would need to rely on the order of -oks
>>> matching the order of methods which if I recall correctly was the
>>> cause for concern at the time.
>>
>> I thought that the :nowait argument in the 0-8, 0-9 and 0-9-1 specs
>> was what provides the ability to use synchronous methods in an
>> asynchronous fashion. When I use the terms synchronous and
>> asynchronous here I'm using them in the manner that the AMQP specs
>> seem to use them; namely synchronous methods send a response to tell
>> you whether they've succeeded and asynchronous ones don't. If :nowait
>> is set to true doesn't that mean that the server will not send an -ok
>> response?
>
> Yes that is correct. My point was simply that sometimes you want to  
> get a response (e.g. to confirm success) but you don't want to have  
> to wait for that response before sending further requests (i.e. you  
> don't want to be forced into strictly synchronous communication,  
> but you do want to track success).
>

I see your point sir :)

Regards,

Chris



From tsuraan at gmail.com  Wed Jan  6 18:04:55 2010
From: tsuraan at gmail.com (tsuraan)
Date: Wed, 6 Jan 2010 12:04:55 -0600
Subject: [rabbitmq-discuss] Erlang R12B and new persister
In-Reply-To: <167204d21001052257uedb4fe7x6c117f73e994a540@mail.gmail.com>
References: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>
	<CCC21710-6CB4-4B0A-82EA-A6479EF0DDB4@mac.com>
	<84fb38e31001051420p21546125ibe70e7b223251339@mail.gmail.com>
	<167204d21001052257uedb4fe7x6c117f73e994a540@mail.gmail.com>
Message-ID: <84fb38e31001061004x5a7685bft4b9230fa352bae23@mail.gmail.com>

> I now *have* to ask what you are doing with 1200 machines.  Please can
> you say a bit about that?  Is RabbitMQ on all of them?

It's not a huge cluster or anything like that; it's around 1200 (I
really don't know the exact number, but I think it's in that
neighborhood) customers that are running the machines we sold them,
and Rabbit's running on all (or at least all up-to-date) of them.  We
started out with the database-as-a-message-queue antipattern, but that
worked as well for us as it does for everybody else, so we found a
nice alternative :)  Even with having to work around rabbit's current
out of memory behaviour, it's a ton better than trying to use a
Postgres table as a queue.



From tsuraan at gmail.com  Wed Jan  6 18:40:25 2010
From: tsuraan at gmail.com (tsuraan)
Date: Wed, 6 Jan 2010 12:40:25 -0600
Subject: [rabbitmq-discuss] Erlang R12B and new persister
In-Reply-To: <20100106120230.GI27068@wellquite.org>
References: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>
	<CCC21710-6CB4-4B0A-82EA-A6479EF0DDB4@mac.com>
	<84fb38e31001051420p21546125ibe70e7b223251339@mail.gmail.com>
	<20100106120230.GI27068@wellquite.org>
Message-ID: <84fb38e31001061040x1a99907cl506bf2fe06e4487e@mail.gmail.com>

> Having checked the code, the update_element calls in msg_store and
> msg_store_gc could be worked around. The update_element in
> msg_store_ets_index can't be, but if you use the rabbitmq-toke plugin
> then that avoids that.

If the update_element makes the code cleaner or makes it work better,
that's probably best. It sounds like upgrading to R13B3 is a really
good idea for the gc behaviour, so I'd imagine I'll have to do the
upgrade either way :)



From tsuraan at gmail.com  Wed Jan  6 19:30:19 2010
From: tsuraan at gmail.com (tsuraan)
Date: Wed, 6 Jan 2010 13:30:19 -0600
Subject: [rabbitmq-discuss] Transactions on acks
In-Reply-To: <c89c65ea1001060628k5ce3217al711519b59fd76096@mail.gmail.com>
References: <c89c65ea0912302051w2ba7b05bra8c775b0d53f9905@mail.gmail.com>
	<20100106112650.GF27068@wellquite.org>
	<c89c65ea1001060353g1eda47d8yeb12a4d5462948ae@mail.gmail.com>
	<20100106120740.GJ27068@wellquite.org>
	<c89c65ea1001060628k5ce3217al711519b59fd76096@mail.gmail.com>
Message-ID: <84fb38e31001061130p5c434464t9401403c363b7e66@mail.gmail.com>

> sure thing, sorry the list doesn't seem to be configured right. The default
> reply behavior should be to the list :/

hehe.  also, don't forget that vi beats emacs, linux beats freebsd,
and c++ beats java :-)  I don't think the list reply behaviour debate
will ever end, but for what it's worth, I also like lists that are
configured so that reply replies to the list.



From matthew at lshift.net  Wed Jan  6 19:34:41 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 6 Jan 2010 19:34:41 +0000
Subject: [rabbitmq-discuss] Erlang R12B and new persister
In-Reply-To: <84fb38e31001061040x1a99907cl506bf2fe06e4487e@mail.gmail.com>
References: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>
	<CCC21710-6CB4-4B0A-82EA-A6479EF0DDB4@mac.com>
	<84fb38e31001051420p21546125ibe70e7b223251339@mail.gmail.com>
	<20100106120230.GI27068@wellquite.org>
	<84fb38e31001061040x1a99907cl506bf2fe06e4487e@mail.gmail.com>
Message-ID: <20100106193440.GA12334@wellquite.org>

On Wed, Jan 06, 2010 at 12:40:25PM -0600, tsuraan wrote:
> If the update_element makes the code cleaner or makes it work better,
> that's probably best.

Because of its atomic pattern, there are simply things that I can't do 
without it.

> It sounds like upgrading to R13B3 is a really
> good idea for the gc behaviour, so I'd imagine I'll have to do the
> upgrade either way :)

Yup, best bite the bullet sooner rather than later! :D

Matthew



From dsinclair at chariotsolutions.com  Wed Jan  6 20:53:45 2010
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Wed, 6 Jan 2010 15:53:45 -0500
Subject: [rabbitmq-discuss] Problem with Clustering
Message-ID: <757cc9481001061253x6efb17a1g68639579022c8b5@mail.gmail.com>

Hi,

I have a simple cluster setup consisting of 2 nodes. Call them A and B going
forward.

Status of node rabbit at B...
[{running_applications,[{rabbit,"RabbitMQ","1.7.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {nodes,[rabbit at A,rabbit at B]},
 {running_nodes,[rabbit at A,rabbit at B]}]
...done.

I have a simple consumer that connect to B and a simple producer that
connects to B and produces messages. This is working fine and I connect to
the cluster via the newConnection method that takes an array of Addresses.

ConnectionParameters params = new ConnectionParameters();
params.setUsername("guest");
params.setPassword("guest");
params.setVirtualHost("/");
params.setRequestedHeartbeat(0);

ConnectionFactory factory = new ConnectionFactory(params);
 Address[] addresses = {new Address("192.168.44.1", 5672),
                new Address("192.168.44.129", 5672)};

Connection conn = factory.newConnection(addresses, 1);
Channel channel = conn.createChannel();

...

The problem comes if I stop node B via the stop_app command

$ sudo rabbitmqctl stop_app
Stopping node rabbit at B ...
...done.

$ sudo rabbitmqctl status

Status of node rabbit at B ...
[{running_applications,[{sasl,"SASL  CXC 138 11","2.1.6"},
                        {stdlib,"ERTS  CXC 138 10","1.16.2"},
                        {kernel,"ERTS  CXC 138 10","2.13.2"}]},
 {nodes,[rabbit at B,rabbit at A]},
 {running_nodes,[rabbit at A]}]
...done.

and start my consumer again I get the following exception

Exception in thread "main" java.io.IOException
    at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
    at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:618)
    at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:582)
    at com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:574)
    at RabbitMQConsumer.main(RabbitMQConsumer.java:38)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:90)
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason: {#method<channel.close>(reply-code=404,reply-text=NOT_FOUND - no
queue 'myQueue' in vhost '/',class-id=60,method-id=20),null,""}
    at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:191)
    at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:159)
    at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
    at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:449)

Can anyone shed some light on what I am doing wrong? I thought that the
queue would be re-created since I am using the declare statement. Snippet
from consumer

channel.exchangeDeclare(exchangeName, "direct", durable);
channel.queueDeclare(queueName, durable);
channel.queueBind(queueName, exchangeName, routingKey);


I have attached the consumer and producer code.

thanks!

dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/7d3a047f/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQConsumer.java
Type: application/octet-stream
Size: 1854 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/7d3a047f/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQProducer.java
Type: application/octet-stream
Size: 2873 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100106/7d3a047f/attachment-0001.obj 

From jdunck at gmail.com  Wed Jan  6 23:45:03 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 6 Jan 2010 17:45:03 -0600
Subject: [rabbitmq-discuss] Trying to understand AMQP: definitions
Message-ID: <2545a92c1001061545h3c8f7774wa6ac0b614cefeb41@mail.gmail.com>

My reason for digging into the AMQP spec is that I'd like to declare a
queue which is auto-delete.  I see in the .Net client that to do so, I
need to use a method overload which requires a bunch of other
parameters-- passive, exclusive, etc.

I've looked at the .Net client source and user guide some and haven't
been enlightened.

Since I'm not really sure what these terms mean, I decided to look at
the AMQP spec; surely it's clear there!

I'm referring to the 0.8 spec found here, since that's apparently
what's (mostly) supported by Rabbit 1.7:
http://www.amqp.org/confluence/download/attachments/720900/amqp0-8.pdf?version=1&modificationDate=1183135458000

I was surprised to find no definition of passive, exclusive, or even
auto-delete within that spec.   Am I missing it?   Did it get
clarified in a later version?



From gsim at redhat.com  Thu Jan  7 08:34:04 2010
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 07 Jan 2010 08:34:04 +0000
Subject: [rabbitmq-discuss] Trying to understand AMQP: definitions
In-Reply-To: <2545a92c1001061545h3c8f7774wa6ac0b614cefeb41@mail.gmail.com>
References: <2545a92c1001061545h3c8f7774wa6ac0b614cefeb41@mail.gmail.com>
Message-ID: <4B459C7C.4000708@redhat.com>

On 01/06/2010 11:45 PM, Jeremy Dunck wrote:
> My reason for digging into the AMQP spec is that I'd like to declare a
> queue which is auto-delete.  I see in the .Net client that to do so, I
> need to use a method overload which requires a bunch of other
> parameters-- passive, exclusive, etc.
>
> I've looked at the .Net client source and user guide some and haven't
> been enlightened.
>
> Since I'm not really sure what these terms mean, I decided to look at
> the AMQP spec; surely it's clear there!
>
> I'm referring to the 0.8 spec found here, since that's apparently
> what's (mostly) supported by Rabbit 1.7:
> http://www.amqp.org/confluence/download/attachments/720900/amqp0-8.pdf?version=1&modificationDate=1183135458000
>
> I was surprised to find no definition of passive, exclusive, or even
> auto-delete within that spec.   Am I missing it?   Did it get
> clarified in a later version?

More detail on the parameters (or fields as AMQP calls them) is given in 
the XML that defines them: 
http://www.amqp.org/confluence/download/attachments/720900/amqp0-8.xml?version=1&modificationDate=1183135648000



From matthew at lshift.net  Thu Jan  7 10:38:30 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 7 Jan 2010 10:38:30 +0000
Subject: [rabbitmq-discuss] Problem with Clustering
In-Reply-To: <757cc9481001061253x6efb17a1g68639579022c8b5@mail.gmail.com>
References: <757cc9481001061253x6efb17a1g68639579022c8b5@mail.gmail.com>
Message-ID: <20100107103829.GB15498@wellquite.org>

Hi David,

You're using the latest default code, yes?

We've just changed the behaviour in this case - previously, yes, the
queue would be recreated. This is incorrect because it then causes many
problems when the failed node comes back up - you end up with the same
queue on both nodes with different concepts of what should be in the
queue. Exciting if undesireable things happen in this case.

Thus if a queue is declared but it's found that the queue does already
exist but is on a downed node, we return a 404, because it's really
saying "the node on which this queue exists can't be found".

>From your code, I see you're declaring the queue durable. This really
reenforces the issue because if its durable, then persistent messages
shouldn't be lost, and yet if you want to be able to recreate the queue
on the other node, then it'll start empty, at which point, logically,
the contents of the queue have been lost.

In general, clustering should not be used for HA purposes. If you wish
to achive HA, then active/passive HA can be achieved by using shared
disk storage, heartbeat/pacemaker, maybe a tcp load balancer on the
front, and make sure you set the node names to localhost, and point both
rabbit instances at the same mnesia dir on the shared storage. When the
passive node comes up, it will recover everything from the storage.

Matthew



From matthew at lshift.net  Thu Jan  7 12:32:40 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 7 Jan 2010 12:32:40 +0000
Subject: [rabbitmq-discuss] .Net client foreground threads
In-Reply-To: <20100106113643.GG27068@wellquite.org>
References: <2545a92c0912291639j30947627m5636329a0927df83@mail.gmail.com>
	<20100106113643.GG27068@wellquite.org>
Message-ID: <20100107123240.GC15498@wellquite.org>

Hi Jeremy,

On Wed, Jan 06, 2010 at 11:36:43AM +0000, Matthew Sackman wrote:
> On Tue, Dec 29, 2009 at 06:39:28PM -0600, Jeremy Dunck wrote:
> > Is there a reason for the main loop and heartbeat threads to be
> > Foreground threads?  I was expecting my process to die when my last
> > app thread died, but the Rabbit threads are Foreground (the default)
> > so they keep the process alive.
> 
> Yes, we agree, the standard patterns of use for C# and Java suggest that
> these threads should be background/daemon. We have a bug open to cover
> this for the Java client, and I've added a not to it so that it covers
> the C# thread too.
> 
> Although this may sound a bit like doing manual memory-management, it is
> probably a good idea to think about how could could manually shutdown
> the AMQP connection. That way you will get some guarantees about
> messages which are sitting in buffers actually being flushed out (if you
> just terminate abruptly, you /could/ lose publishes that have not made
> it to the OS TCP buffers yet).

It would appear I can't read our own bugs. The conclusion of the bug is
that we should not set the threads in the Java or .Net clients as
daemon/background precisely because of the risk of losing messages. The
connection should always be explicitly closed. Furthermore, this offers
fewer surprises - if you find the application's hanging around too long
you know you've got connections left open. The alternative is that you
sometimes see messages disappear without trace which is far worse, and
much harder to debug.

My apologies for misleading you.

Matthew



From tonyg at lshift.net  Thu Jan  7 13:28:03 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 07 Jan 2010 13:28:03 +0000
Subject: [rabbitmq-discuss] Daemonizing connection threads (was Re: .Net
 client foreground threads)
In-Reply-To: <20100107123240.GC15498@wellquite.org>
References: <2545a92c0912291639j30947627m5636329a0927df83@mail.gmail.com>	<20100106113643.GG27068@wellquite.org>
	<20100107123240.GC15498@wellquite.org>
Message-ID: <4B45E163.1030404@lshift.net>

Matthew Sackman wrote:
> It would appear I can't read our own bugs. The conclusion of the bug is
> that we should not set the threads in the Java or .Net clients as
> daemon/background precisely because of the risk of losing messages.

Well, that's where discussion is *resting* at the moment :-) I am
personally of the opinion that the threads *should* be set daemon, on
the theory that not closing an AMQP connection before exiting is like
not flushing a buffer wrapping a socket stream before exiting. Both
result in (potentially) losing data; neither is automatically taken care
of for you by the infrastructure. In the case of sockets, the VM is
happy to exit and force the socket shut without flushing buffers; I
think AMQP should behave in the same way.

> The connection should always be explicitly closed.

I agree with this (just like I'd agree with "you should always flush
your buffers before exiting"), since it's the only way to be sure that
traffic you intended to send actually got sent.

> The alternative is that you
> sometimes see messages disappear without trace which is far worse, and
> much harder to debug.

Well that's true. Perhaps the non-auto-buffer-flushing behaviour around
sockets is simply (yet another instance of) premature optimisation from
the Java library designers?

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From matthew at lshift.net  Thu Jan  7 13:56:09 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 7 Jan 2010 13:56:09 +0000
Subject: [rabbitmq-discuss] Daemonizing connection threads (was Re: .Net
 client foreground threads)
In-Reply-To: <4B45E163.1030404@lshift.net>
References: <2545a92c0912291639j30947627m5636329a0927df83@mail.gmail.com>
	<20100106113643.GG27068@wellquite.org>
	<20100107123240.GC15498@wellquite.org>
	<4B45E163.1030404@lshift.net>
Message-ID: <20100107135609.GE15498@wellquite.org>

On Thu, Jan 07, 2010 at 01:28:03PM +0000, Tony Garnock-Jones wrote:
> > The alternative is that you
> > sometimes see messages disappear without trace which is far worse, and
> > much harder to debug.
> 
> Well that's true. Perhaps the non-auto-buffer-flushing behaviour around
> sockets is simply (yet another instance of) premature optimisation from
> the Java library designers?

Well, the recent ext3/4 "ZOMG closing a file doesn't sync its
content!!!eleven!!" revelations demonstrate that people will rely on
observed behaviour even if it's not guaranteed. For this reason alone, I
think that forcing people to close the connection is "the right thing"
on the grounds that the non-deterministic "you may lose messages, or you
may not" alternative leads to the ext3 situation. If things then changed
in the client to make it much more likely to lose messages in this
situation (now ext4) then people will complain. Far safer to ask users
to tidy up correctly in the first place. Yes, it may be un-Java-like,
but then again so is much good programming practice. ;)

/me throws fuel on fire and runs...

Matthew



From tonyg at lshift.net  Thu Jan  7 14:00:05 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 07 Jan 2010 14:00:05 +0000
Subject: [rabbitmq-discuss] Daemonizing connection threads (was Re: .Net
 client foreground threads)
In-Reply-To: <20100107135609.GE15498@wellquite.org>
References: <2545a92c0912291639j30947627m5636329a0927df83@mail.gmail.com>
	<20100106113643.GG27068@wellquite.org>
	<20100107123240.GC15498@wellquite.org>
	<4B45E163.1030404@lshift.net>
	<20100107135609.GE15498@wellquite.org>
Message-ID: <4B45E8E5.5040804@lshift.net>

Matthew Sackman wrote:
> to tidy up correctly in the first place. Yes, it may be un-Java-like,
> but then again so is much good programming practice. ;)

Indeed.

At the moment there's no easy way to ask for daemon threads if you
decide they're appropriate for your app: so maybe we should go with
non-daemon per default, daemon per user-selectable option. (And as
always, the heartbeat threads, where present, can be daemon all the
time; all the discussion really just applies to the main loops)

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From jdunck at gmail.com  Thu Jan  7 14:14:52 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Thu, 7 Jan 2010 08:14:52 -0600
Subject: [rabbitmq-discuss] Trying to understand AMQP: definitions
In-Reply-To: <4B459C7C.4000708@redhat.com>
References: <2545a92c1001061545h3c8f7774wa6ac0b614cefeb41@mail.gmail.com>
	<4B459C7C.4000708@redhat.com>
Message-ID: <2545a92c1001070614m61fe1790gddab6b23c91105ab@mail.gmail.com>

On Thu, Jan 7, 2010 at 2:34 AM, Gordon Sim <gsim at redhat.com> wrote:
> On 01/06/2010 11:45 PM, Jeremy Dunck wrote:
...
>> I'm referring to the 0.8 spec found here, since that's apparently
>> what's (mostly) supported by Rabbit 1.7:
>>
>> http://www.amqp.org/confluence/download/attachments/720900/amqp0-8.pdf?version=1&modificationDate=1183135458000
>>
>> I was surprised to find no definition of passive, exclusive, or even
>> auto-delete within that spec. ? Am I missing it? ? Did it get
>> clarified in a later version?
>
> More detail on the parameters (or fields as AMQP calls them) is given in the
> XML that defines them:
> http://www.amqp.org/confluence/download/attachments/720900/amqp0-8.xml?version=1&modificationDate=1183135648000

Ah, yes, that helps a lot.  I'm surprised the XML file isn't more
prominently mentioned in the spec PDF, but I should have noticed the
XML file offered next to the PDF on this page:
http://www.amqp.org/confluence/display/AMQP/AMQP+Specification



From tonyg at lshift.net  Thu Jan  7 15:49:30 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 07 Jan 2010 15:49:30 +0000
Subject: [rabbitmq-discuss] python client support for channel.flow
In-Reply-To: <3b949f090912290717x14d77decu50aa1fa8b6c7a044@mail.gmail.com>
References: <b93cb8620912271858s7f0311dch2f8e18cde9a6d7e3@mail.gmail.com>	<167204d20912281318v5304f53fud6296818817192b3@mail.gmail.com>
	<3b949f090912290717x14d77decu50aa1fa8b6c7a044@mail.gmail.com>
Message-ID: <4B46028A.7050506@lshift.net>

Jason J. W. Williams wrote:
> When will Pika implement it's own exceptions? Atm, I'd like to start
> using it instead of py-amqplib, but I think I'd rather have a root
> canal than reverse engineer all the possible exceptions again (like
> you have to with py-ampqlib).

Which exceptions are you particularly interested in? What do you do when
you detect one?

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From alexis.richardson at gmail.com  Thu Jan  7 17:17:14 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 7 Jan 2010 17:17:14 +0000
Subject: [rabbitmq-discuss] Erlang R12B and new persister
In-Reply-To: <84fb38e31001061004x5a7685bft4b9230fa352bae23@mail.gmail.com>
References: <84fb38e31001051255tb524e94ydcc8bcde2ffae71f@mail.gmail.com>
	<CCC21710-6CB4-4B0A-82EA-A6479EF0DDB4@mac.com>
	<84fb38e31001051420p21546125ibe70e7b223251339@mail.gmail.com>
	<167204d21001052257uedb4fe7x6c117f73e994a540@mail.gmail.com>
	<84fb38e31001061004x5a7685bft4b9230fa352bae23@mail.gmail.com>
Message-ID: <167204d21001070917q495e8dc4na63f3f20a06e30dd@mail.gmail.com>

Tsuraan,

Thank-you very much for the info.  That's really good to know.

alexis


On Wed, Jan 6, 2010 at 6:04 PM, tsuraan <tsuraan at gmail.com> wrote:
>> I now *have* to ask what you are doing with 1200 machines. ?Please can
>> you say a bit about that? ?Is RabbitMQ on all of them?
>
> It's not a huge cluster or anything like that; it's around 1200 (I
> really don't know the exact number, but I think it's in that
> neighborhood) customers that are running the machines we sold them,
> and Rabbit's running on all (or at least all up-to-date) of them. ?We
> started out with the database-as-a-message-queue antipattern, but that
> worked as well for us as it does for everybody else, so we found a
> nice alternative :) ?Even with having to work around rabbit's current
> out of memory behaviour, it's a ton better than trying to use a
> Postgres table as a queue.
>



From tonyg at lshift.net  Thu Jan  7 17:24:22 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 07 Jan 2010 17:24:22 +0000
Subject: [rabbitmq-discuss] Pika and Channel.Flow
Message-ID: <4B4618C6.1070503@lshift.net>

Hi all,

I've just added rudimentary Channel.Flow support to Pika. Please see the
section "Dealing with Channel.Flow flow control" of
http://github.com/tonyg/pika#readme for a quick introduction to what's
there.

Feedback welcome!

Cheers,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Thu Jan  7 17:46:55 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 07 Jan 2010 17:46:55 +0000
Subject: [rabbitmq-discuss] Pika and Channel.Flow
In-Reply-To: <4B4618C6.1070503@lshift.net>
References: <4B4618C6.1070503@lshift.net>
Message-ID: <4B461E0F.5070706@lshift.net>

The attached patch to py-amqplib rev aa7a2b480166 is a very very rough
stab at accomplishing approximately the same thing. Please let me know
your experiences with it!

Regards,
  Tony



Tony Garnock-Jones wrote:
> Hi all,
> 
> I've just added rudimentary Channel.Flow support to Pika. Please see the
> section "Dealing with Channel.Flow flow control" of
> http://github.com/tonyg/pika#readme for a quick introduction to what's
> there.
> 
> Feedback welcome!
> 
> Cheers,
>   Tony


-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
-------------- next part --------------
A non-text attachment was scrubbed...
Name: flow_control_patch.patch
Type: text/x-patch
Size: 3692 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100107/22ded28e/attachment.bin 

From jdc at hive7.com  Thu Jan  7 18:39:50 2010
From: jdc at hive7.com (JD Conley)
Date: Thu, 7 Jan 2010 10:39:50 -0800
Subject: [rabbitmq-discuss] Daemonizing connection threads (was Re: .Net
	client foreground threads)
In-Reply-To: <4B45E8E5.5040804@lshift.net>
References: <2545a92c0912291639j30947627m5636329a0927df83@mail.gmail.com>	<20100106113643.GG27068@wellquite.org>	<20100107123240.GC15498@wellquite.org>	<4B45E163.1030404@lshift.net>	<20100107135609.GE15498@wellquite.org>
	<4B45E8E5.5040804@lshift.net>
Message-ID: <066601ca8fc8$ceaf8140$6c0e83c0$@com>

> At the moment there's no easy way to ask for daemon threads if you
> decide they're appropriate for your app: so maybe we should go with
> non-daemon per default, daemon per user-selectable option.

A background/daemon thread would be preferred for our situation as well.
This configurable option would be great.

In our ASP.NET applications we hook the app domain unload event and try to
complete our pending rabbit operations and close things down. Maybe
something along these lines should be recommended in the docs. Doing this
along with making the client use a background thread means you still get the
chance to cleanup and know what has and hasn't been written to the exchange,
and you also know your app will actually shutdown and not hang.


        Thread.GetDomain().DomainUnload += new
EventHandler(RabbitmqAsyncCommandService_DomainUnload);

...

        void RabbitmqAsyncCommandService_DomainUnload(object sender,
EventArgs e)
        {
            if (null != _cnn)
            {
                //wait for stuff to finish (up to a few seconds)... 
                //close the channels...

                _cnn.Close();
            }
        }

-JD






From irrer at umich.edu  Thu Jan  7 19:31:03 2010
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 7 Jan 2010 14:31:03 -0500
Subject: [rabbitmq-discuss] method-like calls
In-Reply-To: <167204d21001070924v65e1967cp7b83a4f5daaa8ad2@mail.gmail.com>
References: <3b6ef0790908180657r6b53d1f4j49bb60015fe65e23@mail.gmail.com>
	<167204d21001070924v65e1967cp7b83a4f5daaa8ad2@mail.gmail.com>
Message-ID: <3b6ef0791001071131j67b53ad9h8875c95f6ba13131@mail.gmail.com>

Alexis -

Funny you should ask now.  I've just resumed working on an AMQP interface
after getting input from our team members and have been doing a lot of
design
work.  Our approach is to write our own code generator that writes code to
do the serialization and de-serialization.  The interface is specified as a
Java
interface, and then we will be using Java introspection to get the methods
and
parameters.  The code generator will be able to make code for any language,
but all I can see happening for the short term is Java and C++.

The transport is in XML.  We use XML a lot and are comfortable with the
technology.
Messages are self-describing and verifiable.  We are leaning towards a
slightly
"heavier" transport that favors abstraction over speed.  I think that if we
have
situations where we need more speed, it will be situations like "we need to
get
4 GB of medical images from here to there", in which case we'll either open
up a "raw" AMQP channel that does no formatting, or, even faster, open up
a socket connection.

I had written an initial version of a library to interface to AMQP that I am
mostly
discarding in favor of a re-write that makes implementing servers easier and
provides
more flexibility (for example: server classes that support messages where
some must be replied
to and others that are not, direct messages, and fanout messages).

I've got chunks of code written but am still working on the lower level
design.  The
architecture is pretty much done.  Lots more coding to do.

I've thought about this (very fun) problem a lot, and have had a few
"epiphanies".  There
is a lot more details I'm not mentioning because there is so much.  I would
be happy
to answer any questions or trade ideas.

PS: I don't always examine every rabbitmq-discuss message, so please feel
free
contact me directly.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Jan 7, 2010 at 12:24 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Jim
>
> Please can I ask how you are getting on with this?
>
> I have a potential customer doing a mega project with Smartgrid who is
> facing the issues you describe below.  They are based in Michigan and
> were keen to hear any success stories and meet people locally who
> could help them find RabbitMQ development skills.
>
> Best wishes
>
> alexis
>
> RabbitMQ
>
>
> On Tue, Aug 18, 2009 at 1:57 PM, Jim Irrer <irrer at umich.edu> wrote:
> > Hi -
> >
> > We are replacing much of our SOAP infrastructure with AMQP, and
> > one problem we are looking at is how to wrap an AMQP call so that
> > it has a nice programming interface.  Basically we want to serialize
> > an object on one side and de-serialize on the other side, and do it
> > in a language independent way (we use Java C#, and C++).
> >
> > I am looking at REST (Representational State Transfer), XML-RPC,
> > and possibly JSON-RPC.  Ideally we would like something that
> > automatically does the serialization/de-serialization or generates
> > code that does it.
> >
> > Has anyone found a technology that they like?
> >
> > Thanks,
> >
> > - Jim
> >
> > Jim Irrer     irrer at umich.edu       (734) 647-4409
> > University of Michigan Hospital Radiation Oncology
> > 519 W. William St.             Ann Arbor, MI 48103
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100107/d5ce4c37/attachment.htm 

From pathsny at gmail.com  Thu Jan  7 19:52:58 2010
From: pathsny at gmail.com (vishnu)
Date: Fri, 8 Jan 2010 01:22:58 +0530
Subject: [rabbitmq-discuss] method-like calls
In-Reply-To: <3b6ef0791001071131j67b53ad9h8875c95f6ba13131@mail.gmail.com>
References: <3b6ef0790908180657r6b53d1f4j49bb60015fe65e23@mail.gmail.com>
	<167204d21001070924v65e1967cp7b83a4f5daaa8ad2@mail.gmail.com>
	<3b6ef0791001071131j67b53ad9h8875c95f6ba13131@mail.gmail.com>
Message-ID: <c89c65ea1001071152x7f4a28a1o25b24ada3ac100a1@mail.gmail.com>

if this is not meant to be consumed by the outside world, aren't thrift or
protocol buffers also good options?

On Fri, Jan 8, 2010 at 1:01 AM, Jim Irrer <irrer at umich.edu> wrote:

> Alexis -
>
> Funny you should ask now.  I've just resumed working on an AMQP interface
> after getting input from our team members and have been doing a lot of
> design
> work.  Our approach is to write our own code generator that writes code to
> do the serialization and de-serialization.  The interface is specified as a
> Java
> interface, and then we will be using Java introspection to get the methods
> and
> parameters.  The code generator will be able to make code for any language,
> but all I can see happening for the short term is Java and C++.
>
> The transport is in XML.  We use XML a lot and are comfortable with the
> technology.
> Messages are self-describing and verifiable.  We are leaning towards a
> slightly
> "heavier" transport that favors abstraction over speed.  I think that if we
> have
> situations where we need more speed, it will be situations like "we need to
> get
> 4 GB of medical images from here to there", in which case we'll either open
> up a "raw" AMQP channel that does no formatting, or, even faster, open up
> a socket connection.
>
> I had written an initial version of a library to interface to AMQP that I
> am mostly
> discarding in favor of a re-write that makes implementing servers easier
> and provides
> more flexibility (for example: server classes that support messages where
> some must be replied
> to and others that are not, direct messages, and fanout messages).
>
> I've got chunks of code written but am still working on the lower level
> design.  The
> architecture is pretty much done.  Lots more coding to do.
>
> I've thought about this (very fun) problem a lot, and have had a few
> "epiphanies".  There
> is a lot more details I'm not mentioning because there is so much.  I would
> be happy
> to answer any questions or trade ideas.
>
> PS: I don't always examine every rabbitmq-discuss message, so please feel
> free
> contact me directly.
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Thu, Jan 7, 2010 at 12:24 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:
>
>> Jim
>>
>> Please can I ask how you are getting on with this?
>>
>> I have a potential customer doing a mega project with Smartgrid who is
>> facing the issues you describe below.  They are based in Michigan and
>> were keen to hear any success stories and meet people locally who
>> could help them find RabbitMQ development skills.
>>
>> Best wishes
>>
>> alexis
>>
>> RabbitMQ
>>
>>
>> On Tue, Aug 18, 2009 at 1:57 PM, Jim Irrer <irrer at umich.edu> wrote:
>> > Hi -
>> >
>> > We are replacing much of our SOAP infrastructure with AMQP, and
>> > one problem we are looking at is how to wrap an AMQP call so that
>> > it has a nice programming interface.  Basically we want to serialize
>> > an object on one side and de-serialize on the other side, and do it
>> > in a language independent way (we use Java C#, and C++).
>> >
>> > I am looking at REST (Representational State Transfer), XML-RPC,
>> > and possibly JSON-RPC.  Ideally we would like something that
>> > automatically does the serialization/de-serialization or generates
>> > code that does it.
>> >
>> > Has anyone found a technology that they like?
>> >
>> > Thanks,
>> >
>> > - Jim
>> >
>> > Jim Irrer     irrer at umich.edu       (734) 647-4409
>> > University of Michigan Hospital Radiation Oncology
>> > 519 W. William St.             Ann Arbor, MI 48103
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100108/a3740989/attachment.htm 

From pkirsanov at 38studios.com  Thu Jan  7 20:00:46 2010
From: pkirsanov at 38studios.com (Philippe Kirsanov)
Date: Thu, 7 Jan 2010 15:00:46 -0500
Subject: [rabbitmq-discuss] method-like calls
In-Reply-To: <c89c65ea1001071152x7f4a28a1o25b24ada3ac100a1@mail.gmail.com>
References: <3b6ef0790908180657r6b53d1f4j49bb60015fe65e23@mail.gmail.com><167204d21001070924v65e1967cp7b83a4f5daaa8ad2@mail.gmail.com><3b6ef0791001071131j67b53ad9h8875c95f6ba13131@mail.gmail.com>
	<c89c65ea1001071152x7f4a28a1o25b24ada3ac100a1@mail.gmail.com>
Message-ID: <D1AC29FC5C9E644C91BE7C9294BF701B02CB26B3@gmg-maynard-mai.greenmonstergames.net>

We're using protocol buffers to encode/decode packets and use AMQP as
RPC transport with RPC interface specified in protocol buffers.

Also we have REST frontend that translates REST requests into protocol
buffers RPC calls.

 

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of vishnu
Sent: Thursday, January 07, 2010 14:53
To: rabbitmq-discuss
Subject: Re: [rabbitmq-discuss] method-like calls

 

if this is not meant to be consumed by the outside world, aren't thrift
or protocol buffers also good options?

On Fri, Jan 8, 2010 at 1:01 AM, Jim Irrer <irrer at umich.edu> wrote:

Alexis -

Funny you should ask now.  I've just resumed working on an AMQP
interface
after getting input from our team members and have been doing a lot of
design
work.  Our approach is to write our own code generator that writes code
to
do the serialization and de-serialization.  The interface is specified
as a Java
interface, and then we will be using Java introspection to get the
methods and
parameters.  The code generator will be able to make code for any
language,
but all I can see happening for the short term is Java and C++.

The transport is in XML.  We use XML a lot and are comfortable with the
technology.
Messages are self-describing and verifiable.  We are leaning towards a
slightly
"heavier" transport that favors abstraction over speed.  I think that if
we have
situations where we need more speed, it will be situations like "we need
to get
4 GB of medical images from here to there", in which case we'll either
open
up a "raw" AMQP channel that does no formatting, or, even faster, open
up
a socket connection.

I had written an initial version of a library to interface to AMQP that
I am mostly
discarding in favor of a re-write that makes implementing servers easier
and provides
more flexibility (for example: server classes that support messages
where some must be replied
to and others that are not, direct messages, and fanout messages).

I've got chunks of code written but am still working on the lower level
design.  The
architecture is pretty much done.  Lots more coding to do.

I've thought about this (very fun) problem a lot, and have had a few
"epiphanies".  There
is a lot more details I'm not mentioning because there is so much.  I
would be happy
to answer any questions or trade ideas.

PS: I don't always examine every rabbitmq-discuss message, so please
feel free
contact me directly.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103



On Thu, Jan 7, 2010 at 12:24 PM, Alexis Richardson <alexis at rabbitmq.com>
wrote:

Jim

Please can I ask how you are getting on with this?

I have a potential customer doing a mega project with Smartgrid who is
facing the issues you describe below.  They are based in Michigan and
were keen to hear any success stories and meet people locally who
could help them find RabbitMQ development skills.

Best wishes

alexis

RabbitMQ



On Tue, Aug 18, 2009 at 1:57 PM, Jim Irrer <irrer at umich.edu> wrote:
> Hi -
>
> We are replacing much of our SOAP infrastructure with AMQP, and
> one problem we are looking at is how to wrap an AMQP call so that
> it has a nice programming interface.  Basically we want to serialize
> an object on one side and de-serialize on the other side, and do it
> in a language independent way (we use Java C#, and C++).
>
> I am looking at REST (Representational State Transfer), XML-RPC,
> and possibly JSON-RPC.  Ideally we would like something that
> automatically does the serialization/de-serialization or generates
> code that does it.
>
> Has anyone found a technology that they like?
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100107/bf9362d7/attachment.htm 

From sjaday at gmail.com  Thu Jan  7 21:17:29 2010
From: sjaday at gmail.com (Stephen Day)
Date: Thu, 7 Jan 2010 13:17:29 -0800
Subject: [rabbitmq-discuss] Problem with Clustering
In-Reply-To: <20100107103829.GB15498@wellquite.org>
References: <757cc9481001061253x6efb17a1g68639579022c8b5@mail.gmail.com>
	<20100107103829.GB15498@wellquite.org>
Message-ID: <4d376de31001071317g4f46516cy8d6902886dac8d45@mail.gmail.com>

Matthew:

This is the best description of the intent of RabbitMQ clustering I have
heard yet. Specifically, the distinction that RabbitMQ clustering is for
high volume messaging, rather than HA concerns. Do you mind adding some of
these points to the RabbitMQ clustering guide (
http://www.rabbitmq.com/clustering.html)?

Steve

On Thu, Jan 7, 2010 at 2:38 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi David,
>
> You're using the latest default code, yes?
>
> We've just changed the behaviour in this case - previously, yes, the
> queue would be recreated. This is incorrect because it then causes many
> problems when the failed node comes back up - you end up with the same
> queue on both nodes with different concepts of what should be in the
> queue. Exciting if undesireable things happen in this case.
>
> Thus if a queue is declared but it's found that the queue does already
> exist but is on a downed node, we return a 404, because it's really
> saying "the node on which this queue exists can't be found".
>
> From your code, I see you're declaring the queue durable. This really
> reenforces the issue because if its durable, then persistent messages
> shouldn't be lost, and yet if you want to be able to recreate the queue
> on the other node, then it'll start empty, at which point, logically,
> the contents of the queue have been lost.
>
> In general, clustering should not be used for HA purposes. If you wish
> to achive HA, then active/passive HA can be achieved by using shared
> disk storage, heartbeat/pacemaker, maybe a tcp load balancer on the
> front, and make sure you set the node names to localhost, and point both
> rabbit instances at the same mnesia dir on the shared storage. When the
> passive node comes up, it will recover everything from the storage.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100107/3de25f98/attachment.htm 

From msteele at beringmedia.com  Thu Jan  7 21:35:29 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Thu, 7 Jan 2010 16:35:29 -0500
Subject: [rabbitmq-discuss] Turning off rabbit logging
Message-ID: <aa3794b1001071335x637251aas7ebff32ca56c0d81@mail.gmail.com>

Is there a method to turn off rabbit's logging? I've poked around the
documentation (administration guide), and have come up empty handed.

-- 
Mark Steele
Director of development
Bering Media Inc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100107/96fef9fa/attachment.htm 

From Loren.Schlomer at echostar.com  Thu Jan  7 21:44:23 2010
From: Loren.Schlomer at echostar.com (Schlomer, Loren)
Date: Thu, 7 Jan 2010 14:44:23 -0700
Subject: [rabbitmq-discuss] Erlang 1.7 client - Unable to make connection
Message-ID: <4B4655B7.7000105@echostar.com>

I am trying to use the 1.7 erlang client with a 1.7 broker on the same 
machine.  The broker does work properly, as tested with a java client.  
When attempting to make a connection using any of the 
amqp_connection:start_network(...) functions, I get the following:

** exception error: no match of right hand side value
                    {error,{undef,[{rabbit_net,send,
                                               
[#Port<0.520>,<<65,77,81,80,1,1,8,0>>]},
                                   {amqp_network_connection,do_handshake,1},
                                   {amqp_network_connection,init,1},
                                   {gen_server,init_it,6},
                                   {proc_lib,init_p_do_apply,3}]}}
     in function  amqp_connection:start_network_internal/2



Any suggestions?





From matthew at lshift.net  Thu Jan  7 22:15:26 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 7 Jan 2010 22:15:26 +0000
Subject: [rabbitmq-discuss] Turning off rabbit logging
In-Reply-To: <aa3794b1001071335x637251aas7ebff32ca56c0d81@mail.gmail.com>
References: <aa3794b1001071335x637251aas7ebff32ca56c0d81@mail.gmail.com>
Message-ID: <20100107221526.GI15498@wellquite.org>

On Thu, Jan 07, 2010 at 04:35:29PM -0500, Mark Steele wrote:
> Is there a method to turn off rabbit's logging? I've poked around the
> documentation (administration guide), and have come up empty handed.

Nope. You could always just redirect the logs to /dev/null.

Matthew



From matthew at lshift.net  Thu Jan  7 22:16:44 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 7 Jan 2010 22:16:44 +0000
Subject: [rabbitmq-discuss] Erlang 1.7 client - Unable to make connection
In-Reply-To: <4B4655B7.7000105@echostar.com>
References: <4B4655B7.7000105@echostar.com>
Message-ID: <20100107221644.GJ15498@wellquite.org>

Hi Schlomer,

You sure that when you checked out the erlang client, you
hg up -C rabbitmq_v1_7_0 ?

I suspect you're using the latest in default in the erlang client which
won't work with server 1.7.0.

Matthew

On Thu, Jan 07, 2010 at 02:44:23PM -0700, Schlomer, Loren wrote:
> I am trying to use the 1.7 erlang client with a 1.7 broker on the same 
> machine.  The broker does work properly, as tested with a java client.  
> When attempting to make a connection using any of the 
> amqp_connection:start_network(...) functions, I get the following:
> 
> ** exception error: no match of right hand side value
>                     {error,{undef,[{rabbit_net,send,
>                                                
> [#Port<0.520>,<<65,77,81,80,1,1,8,0>>]},
>                                    {amqp_network_connection,do_handshake,1},
>                                    {amqp_network_connection,init,1},
>                                    {gen_server,init_it,6},
>                                    {proc_lib,init_p_do_apply,3}]}}
>      in function  amqp_connection:start_network_internal/2
> 
> 
> 
> Any suggestions?
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From matthew at lshift.net  Thu Jan  7 22:31:56 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 7 Jan 2010 22:31:56 +0000
Subject: [rabbitmq-discuss] Turning off rabbit logging
In-Reply-To: <20100107221526.GI15498@wellquite.org>
References: <aa3794b1001071335x637251aas7ebff32ca56c0d81@mail.gmail.com>
	<20100107221526.GI15498@wellquite.org>
Message-ID: <20100107223155.GK15498@wellquite.org>

On Thu, Jan 07, 2010 at 10:15:26PM +0000, Matthew Sackman wrote:
> On Thu, Jan 07, 2010 at 04:35:29PM -0500, Mark Steele wrote:
> > Is there a method to turn off rabbit's logging? I've poked around the
> > documentation (administration guide), and have come up empty handed.
> 
> Nope. You could always just redirect the logs to /dev/null.

Actually, I've just done some more digging into this. If you put in your
/etc/rabbitmq/rabbitmq.conf
SERVER_START_ARGS="-kernel error_logger silent"

then you'll not get the main log. However, it's debatable whether that
should really work. You also can't turn of the sasl log from there (for
some reason). Much better is to edit your rabbitmq-server script and
change the two lines at the bottom which look like:

    -kernel error_logger '{file,"'${RABBITMQ_LOGS}'"}' \
    -sasl sasl_error_logger '{file,"'${RABBITMQ_SASL_LOGS}'"}' \

to

    -kernel error_logger silent \
    -sasl sasl_error_logger false \

Then you'll get rid of both of them.

Matthew



From g at rre.tt  Thu Jan  7 22:46:13 2010
From: g at rre.tt (Garrett Smith)
Date: Thu, 7 Jan 2010 16:46:13 -0600
Subject: [rabbitmq-discuss] Erlang 1.7 client - Unable to make connection
In-Reply-To: <4B4655B7.7000105@echostar.com>
References: <4B4655B7.7000105@echostar.com>
Message-ID: <ce2570e21001071446t4bd508bbkca1a92f5064d7d6b@mail.gmail.com>

On Thu, Jan 7, 2010 at 3:44 PM, Schlomer, Loren
<Loren.Schlomer at echostar.com> wrote:
> I am trying to use the 1.7 erlang client with a 1.7 broker on the same
> machine. ?The broker does work properly, as tested with a java client.
> When attempting to make a connection using any of the
> amqp_connection:start_network(...) functions, I get the following:
>
> ** exception error: no match of right hand side value
> ? ? ? ? ? ? ? ? ? ?{error,{undef,[{rabbit_net,send,

You need the common rabbitmq Erlang beams in your path. These come
with the server.

Garrett



From Loren.Schlomer at echostar.com  Thu Jan  7 23:05:59 2010
From: Loren.Schlomer at echostar.com (Schlomer, Loren)
Date: Thu, 7 Jan 2010 16:05:59 -0700
Subject: [rabbitmq-discuss] Erlang 1.7 client - Unable to make connection
In-Reply-To: <ce2570e21001071446t4bd508bbkca1a92f5064d7d6b@mail.gmail.com>
References: <4B4655B7.7000105@echostar.com>
	<ce2570e21001071446t4bd508bbkca1a92f5064d7d6b@mail.gmail.com>
Message-ID: <4B4668D7.20702@echostar.com>

Garrett,

This was it.  I had installed the broker from a debian package, and did 
not have the rabbitmq-server erlang package in my erlang path.  Thanks 
for the tip!



Garrett Smith wrote:
>
> On Thu, Jan 7, 2010 at 3:44 PM, Schlomer, Loren
> <Loren.Schlomer at echostar.com> wrote:
> > I am trying to use the 1.7 erlang client with a 1.7 broker on the same
> > machine.  The broker does work properly, as tested with a java client.
> > When attempting to make a connection using any of the
> > amqp_connection:start_network(...) functions, I get the following:
> >
> > ** exception error: no match of right hand side value
> >                    {error,{undef,[{rabbit_net,send,
>
> You need the common rabbitmq Erlang beams in your path. These come
> with the server.
>
> Garrett
>




From pathsny at gmail.com  Fri Jan  8 04:42:58 2010
From: pathsny at gmail.com (vishnu)
Date: Fri, 8 Jan 2010 10:12:58 +0530
Subject: [rabbitmq-discuss] running rabbitmq on a laptop
Message-ID: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>

hi
  for the purpose of development Im trying to run rabbitmq on my laptop.
However the server is highly sensitive to the network I'm on and refuses to
shut down for example, if I started it on a seperate network.

my understanding is that this is because rabbitmq stores routing information
in the database and this no longer holds once the network changes. However,
is there a simple work around to deal with this? Maybe to turn off caching
the routes?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100108/cc87cbfd/attachment.htm 

From dinabandhu.mitra at tecnotree.com  Fri Jan  8 10:18:56 2010
From: dinabandhu.mitra at tecnotree.com (Dinabandhu)
Date: Fri, 8 Jan 2010 02:18:56 -0800 (PST)
Subject: [rabbitmq-discuss] compatibility with legacy code
In-Reply-To: <4AF98162.5070405@lshift.net>
References: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>
	<k5my3245rg.fsf@mrbraver.lshift.net>
	<3b6ef0790911100650w475f577bw3c352d02dfbaee81@mail.gmail.com>
	<4AF98162.5070405@lshift.net>
Message-ID: <27073885.post@talk.nabble.com>


Hi Tony,

I am trying to build this. I followed your links & instructions here.
configure still gives error saying it could not find AMQP spec file at
'/codegen/amqp-0.8.json'.

This directory is of course wrong because the file is actually at
/home/dinu/rabbitmq-codegen.

The variable $ac_abs_confdir is blank and that seems to be reason ... from
the configure script it looks like $ac_abs_confdir is expected to point to
the directory from where configure is being run. I don't know enough about
the autoconf tool chain to determine the root cause.

I next modified configure.ac file to point sibling_codegen_dir to the
correct directory ...

#sibling_codegen_dir="$ac_abs_confdir/../rabbitmq-codegen"
sibling_codegen_dir="/home/janus/dinu/rabbitmq-codegen"  

After this change the configure script went through. But make still fails
... 

[dinu at j4 rabbitmq-c]$ make
make  all-recursive
make[1]: Entering directory `/home/dinu/rabbitmq-c'
Making all in librabbitmq
make[2]: Entering directory `/home/dinu/rabbitmq-c/librabbitmq'
PYTHONPATH=/home/dinu/rabbitmq-codegen python2.5 ./codegen.py header
/home/dinu/rabbitmq-codegen/amqp-0.8.json amqp_framing.h
/bin/sh: python2.5: command not found
make[2]: *** [amqp_framing.h] Error 127
make[2]: Leaving directory `/home/dinu/rabbitmq-c/librabbitmq'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/home/dinu/rabbitmq-c'
make: *** [all] Error 2

I don't have python2.5. what is there on my machine is python2.3.

I am using RHEL 4.8 64 bit. Does the library expect some other distribution?
5.x?

I will try by modifying the script files ... but if you can provide some
pointers it would be good.

Regards,
Dinabandhu


Tony Garnock-Jones-2 wrote:
> 
> Hi Jim,
> 
> Jim Irrer wrote:
>> checking location of AMQP codegen directory... configure: error: could
>> not find AMQP spec file at "'/codegen/amqp-0.9.1.json'"
> 
> The MD5sum is correct, b50fd568311a052a45157631ba17c2b5, but are you
> sure you're really building the one you just downloaded? For me, using
> the file with the MD5sum you provided, I get:
> 
> checking location of AMQP codegen directory... configure: error: could
> not find AMQP spec file at
> "'/Users/tonyg/qq/rabbitmq-c-default/codegen/amqp-0.8.json'"
> 
> Note the 0.8 version number.
> 
>> Am I supposed to get that file from somewhere else, or should it be in
>> the tarball?
> 
> You should retrieve rabbitmq-codegen as well. Sorry for the incomplete
> instructions, I really must write this up properly and check it in.
> Here's a complete recipe for building the C client and examples, on the
> 0-8 branch.
> 
>  curl http://hg.rabbitmq.com/rabbitmq-codegen/archive/default.tar.gz\
>   | tar -zxf -
>  curl http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz\
>   | tar -zxf -
>  mv rabbitmq-codegen-default rabbitmq-codegen
>  mv rabbitmq-c-default rabbitmq-c
>  cd rabbitmq-c
>  autoreconf -i
>  ./configure
>  make
> 
> Alternatively, if you have mercurial installed:
> 
>  hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>  hg clone http://hg.rabbitmq.com/rabbitmq-c
>  cd rabbitmq-c
>  autoreconf -i
>  ./configure
>  make
> 
>> Also, I have doubts that this will work anyway, because the RabbitMQ
>> server
>> is running at version 0.8, so it won't be compatible with this client. 
> 
> The "default" branches of both the C client and the server are for 0-8,
> and do work together.
> 
> Cheers,
>   Tony
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/compatibility-with-legacy-code-tp26197670p27073885.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From john.odendahl at gmail.com  Fri Jan  8 12:30:21 2010
From: john.odendahl at gmail.com (john_od)
Date: Fri, 8 Jan 2010 04:30:21 -0800 (PST)
Subject: [rabbitmq-discuss]  How to Connect Glassfish (MDB) to RabbitMQ??
Message-ID: <27026868.post@talk.nabble.com>


Hello,

I am trying to connect to rabbitMQ from a Glassfish Java EE Server (thanks
Alexis for your post on the glassfish forum -
http://forums.java.net/jive/thread.jspa?messageID=379022&#379022).  I was
under the impression the right way to do this would be to use an MDB to poll
for messages integrating with the JMS client wrapped by the generic resource
adapter.  Per Alexis's post that sounds like it won't work.

Can anybody offer insight on the best way to accomplish the integration with
glassfish?  An MDB not using JMS (not sure if it's possible)?? Some SLSB
doing polling? Doesn't sound exactly right.  A servlet?

I have already used the java client from a standalone java app and that was
very straight forward (thanks!). I've got a client working from ruby as
well...also very straight forward.

thanks

--john

 


-- 
View this message in context: http://old.nabble.com/How-to-Connect-Glassfish-%28MDB%29-to-RabbitMQ---tp27026868p27026868.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at gmail.com  Fri Jan  8 13:40:35 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 8 Jan 2010 13:40:35 +0000
Subject: [rabbitmq-discuss] How to Connect Glassfish (MDB) to RabbitMQ??
In-Reply-To: <27026868.post@talk.nabble.com>
References: <27026868.post@talk.nabble.com>
Message-ID: <167204d21001080540s33ef2dbcxeab3dfb5133a0454@mail.gmail.com>

John

I think you could create an MDB much like people have integrated the
RabbitMQ Java client into Spring.

However, as you say, why not just use a Servlet?

alexis


On Fri, Jan 8, 2010 at 12:30 PM, john_od <john.odendahl at gmail.com> wrote:
>
> Hello,
>
> I am trying to connect to rabbitMQ from a Glassfish Java EE Server (thanks
> Alexis for your post on the glassfish forum -
> http://forums.java.net/jive/thread.jspa?messageID=379022&#379022). ?I was
> under the impression the right way to do this would be to use an MDB to poll
> for messages integrating with the JMS client wrapped by the generic resource
> adapter. ?Per Alexis's post that sounds like it won't work.
>
> Can anybody offer insight on the best way to accomplish the integration with
> glassfish? ?An MDB not using JMS (not sure if it's possible)?? Some SLSB
> doing polling? Doesn't sound exactly right. ?A servlet?
>
> I have already used the java client from a standalone java app and that was
> very straight forward (thanks!). I've got a client working from ruby as
> well...also very straight forward.
>
> thanks
>
> --john
>
>
>
>
> --
> View this message in context: http://old.nabble.com/How-to-Connect-Glassfish-%28MDB%29-to-RabbitMQ---tp27026868p27026868.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From gsim at redhat.com  Fri Jan  8 14:24:55 2010
From: gsim at redhat.com (Gordon Sim)
Date: Fri, 08 Jan 2010 14:24:55 +0000
Subject: [rabbitmq-discuss] How to Connect Glassfish (MDB) to RabbitMQ??
In-Reply-To: <27026868.post@talk.nabble.com>
References: <27026868.post@talk.nabble.com>
Message-ID: <4B474037.6030305@redhat.com>

On 01/08/2010 12:30 PM, john_od wrote:
>
> Hello,
>
> I am trying to connect to rabbitMQ from a Glassfish Java EE Server (thanks
> Alexis for your post on the glassfish forum -
> http://forums.java.net/jive/thread.jspa?messageID=379022&#379022).  I was
> under the impression the right way to do this would be to use an MDB to poll
> for messages integrating with the JMS client wrapped by the generic resource
> adapter.  Per Alexis's post that sounds like it won't work.

It should in theory work if you use one of the AMQP based JMS 
clients[1]. You'll need to use the generic JMS resource adapter (and I 
haven't myself tried that), but that should allow intergation with any 
compliant JMS client.

[1] E.g. the openamq JMS client (www.openamq.org, see also 
http://www.lshift.net/blog/2009/03/16/openamqs-jms-client-with-rabbitmq-server) 
or the Qpid JMS client (qpid.apache.org).




From dsinclair at chariotsolutions.com  Fri Jan  8 14:31:31 2010
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Fri, 8 Jan 2010 09:31:31 -0500
Subject: [rabbitmq-discuss] Problem with Clustering
In-Reply-To: <4d376de31001071317g4f46516cy8d6902886dac8d45@mail.gmail.com>
References: <757cc9481001061253x6efb17a1g68639579022c8b5@mail.gmail.com>
	<20100107103829.GB15498@wellquite.org>
	<4d376de31001071317g4f46516cy8d6902886dac8d45@mail.gmail.com>
Message-ID: <757cc9481001080631y10b5ad0byb639281c86de0c42@mail.gmail.com>

-- Sorry if you are getting this twice Matthew, it got bounced from the list

Matthew,

These are roughly the requirements for messaging

- need to ensure there are no messages dropped even if a node in the cluster
goes down (HA)
- easily scales
- zero configuration for brokers (nice to have, but Rabbit is pretty easy to
configure)
- seamless fail over for clients when the node they are connected to fails
(again, nice to have)

Along with those go the *regular* messaging requirements, point to point,
pub/sub, performance, security, integrates well, etc.

As far as the hardware/infrastructure being used for for HA, i was targeting
it for cloud deployment.

thanks again!

On Thu, Jan 7, 2010 at 4:17 PM, Stephen Day <sjaday at gmail.com> wrote:

> Matthew:
>
> This is the best description of the intent of RabbitMQ clustering I have
> heard yet. Specifically, the distinction that RabbitMQ clustering is for
> high volume messaging, rather than HA concerns. Do you mind adding some of
> these points to the RabbitMQ clustering guide (
> http://www.rabbitmq.com/clustering.html)?
>
> Steve
>
> On Thu, Jan 7, 2010 at 2:38 AM, Matthew Sackman <matthew at lshift.net>wrote:
>
>> Hi David,
>>
>> You're using the latest default code, yes?
>>
>> We've just changed the behaviour in this case - previously, yes, the
>> queue would be recreated. This is incorrect because it then causes many
>> problems when the failed node comes back up - you end up with the same
>> queue on both nodes with different concepts of what should be in the
>> queue. Exciting if undesireable things happen in this case.
>>
>> Thus if a queue is declared but it's found that the queue does already
>> exist but is on a downed node, we return a 404, because it's really
>> saying "the node on which this queue exists can't be found".
>>
>> From your code, I see you're declaring the queue durable. This really
>> reenforces the issue because if its durable, then persistent messages
>> shouldn't be lost, and yet if you want to be able to recreate the queue
>> on the other node, then it'll start empty, at which point, logically,
>> the contents of the queue have been lost.
>>
>> In general, clustering should not be used for HA purposes. If you wish
>> to achive HA, then active/passive HA can be achieved by using shared
>> disk storage, heartbeat/pacemaker, maybe a tcp load balancer on the
>> front, and make sure you set the node names to localhost, and point both
>> rabbit instances at the same mnesia dir on the shared storage. When the
>> passive node comes up, it will recover everything from the storage.
>>
>> Matthew
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100108/487c784e/attachment.htm 

From Loren.Schlomer at echostar.com  Fri Jan  8 23:01:00 2010
From: Loren.Schlomer at echostar.com (Schlomer, Loren)
Date: Fri, 8 Jan 2010 16:01:00 -0700
Subject: [rabbitmq-discuss] Erlang Client - Unable to Subscribe with
	basic.consume
Message-ID: <4B47B92C.1070605@echostar.com>

I am trying to subscribe a queue to a Pid using:

amqp_channel:call(Channel, #'basic.consume'{queue=QueueName}, Pid)

and using all other default settings in the #'basic.consume' record.  I 
get the following exception stack and have been unable to discover why.  
Any help would be greatly appreciated!


=ERROR REPORT==== 8-Jan-2010::13:52:43 ===
** Generic server <0.44.0> terminating
** Last message in was {call,
                           {'basic.consume',1,
                               <<"amq.gen-JKETIEiVgO9bzH5ZKfghkA==">>,<<>>,
                               false,false,false,false},
                           <0.47.0>}
** When Server state == {c_state,1,<0.37.0>,<0.45.0>,<0.46.0>,network,
                            {[],[]},
                            {[],[]},
                            {dict,0,16,16,8,80,48,
                                
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            false,none,false,none,
                            {dict,0,16,16,8,80,48,
                                
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}}}
** Reason for termination ==
** {function_clause,[{amqp_channel,build_content,[<0.47.0>]},
                     {amqp_channel,handle_call,3},
                     {gen_server,handle_msg,5},
                     {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 8-Jan-2010::13:52:43 ===
Connection (<0.37.0>) closing: channel (<0.44.0>) died. Reason: 
{function_clause,
                                                                 
[{amqp_channel,
                                                                   
build_content,
                                                                   
[<0.47.0>]},
                                                                  
{amqp_channel,
                                                                   
handle_call,
                                                                   3},
                                                                  
{gen_server,
                                                                   
handle_msg,
                                                                   5},
                                                                  {proc_lib,
                                                                   
init_p_do_apply,
                                                                   3}]}
** exception exit: 
{{function_clause,[{amqp_channel,build_content,[<0.47.0>]},
                                      {amqp_channel,handle_call,3},
                                      {gen_server,handle_msg,5},
                                      {proc_lib,init_p_do_apply,3}]},
                    {gen_server,call,
                                [<0.44.0>,
                                 {call,{'basic.consume',1,
                                                        
<<"amq.gen-JKETIEiVgO9bzH5ZKfghkA==">>,<<>>,false,false,
                                                        false,false},
                                       <0.47.0>},
                                 infinity]}}
     in function  gen_server:call/3
     in call from rabbitmq_test:consume/0
2>
=ERROR REPORT==== 8-Jan-2010::13:52:43 ===
** Generic server <0.37.0> terminating
** Last message in was {'$gen_cast',{method,{'connection.close_ok'},none}}
** When Server state == {nc_state,
                            
{amqp_params,<<"guest">>,<<"guest">>,<<"/test">>,
                                "localhost",5672,0,0,0,none},
                            #Port<0.530>,<0.42.0>,<0.41.0>,<0.40.0>,0,0,
                            {nc_closing,internal_error,
                                {'connection.close',541,<<>>,0,0},
                                none,wait_close_ok},
                            {{0,nil},
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}}}}
** Reason for termination ==
** {internal_error,541,<<>>}



From matthew at lshift.net  Sat Jan  9 14:51:37 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sat, 9 Jan 2010 14:51:37 +0000
Subject: [rabbitmq-discuss] Erlang Client - Unable to Subscribe with
 basic.consume
In-Reply-To: <4B47B92C.1070605@echostar.com>
References: <4B47B92C.1070605@echostar.com>
Message-ID: <20100109145137.GA5236@wellquite.org>

Hi Loren,

It depends which version of the Erlang client you're using, because this
has recently changed.

The version that is tagged with rabbitmq_v1_7_0 has a "subscribe"
function. This should be used as:

#'basic.consume_ok'{ consumer_tag = Tag } =
        amqp_channel:subscribe(Chan, #'basic.consume'{ queue = Q }, Pid),

However, I decided that I really didn't like this as it's non obvious
and doesn't match the rest of the API. Thus on default, consume exists
as a normal call. However, there is no Pid argument: instead you should
pass the Chan to the pid that needs to receive the msgs and get it to do
the consumer itself:

#'basic.consume_ok'{ consumer_tag = Tag } =
        amqp_channel:call(Chan, #'basic.consume'{ queue = Q }),

By using the 3-arg version of call, the client thinks that the consume
method has content, which is why it's exploding, as it can't encode
it. This is why we don't want to have the situation where for consumer,
the 3rd-arg is treated as a Pid, whereas for all other methods it's
treated as method content.

Hopefully the API is now more consistent.

Matthew

On Fri, Jan 08, 2010 at 04:01:00PM -0700, Schlomer, Loren wrote:
> I am trying to subscribe a queue to a Pid using:
> 
> amqp_channel:call(Channel, #'basic.consume'{queue=QueueName}, Pid)
> 
> and using all other default settings in the #'basic.consume' record.  I 
> get the following exception stack and have been unable to discover why.  
> Any help would be greatly appreciated!
> 
> 
> =ERROR REPORT==== 8-Jan-2010::13:52:43 ===
> ** Generic server <0.44.0> terminating
> ** Last message in was {call,
>                            {'basic.consume',1,
>                                <<"amq.gen-JKETIEiVgO9bzH5ZKfghkA==">>,<<>>,
>                                false,false,false,false},
>                            <0.47.0>}
> ** When Server state == {c_state,1,<0.37.0>,<0.45.0>,<0.46.0>,network,
>                             {[],[]},
>                             {[],[]},
>                             {dict,0,16,16,8,80,48,
>                                 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             false,none,false,none,
>                             {dict,0,16,16,8,80,48,
>                                 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}}}
> ** Reason for termination ==
> ** {function_clause,[{amqp_channel,build_content,[<0.47.0>]},
>                      {amqp_channel,handle_call,3},
>                      {gen_server,handle_msg,5},
>                      {proc_lib,init_p_do_apply,3}]}
> 
> =ERROR REPORT==== 8-Jan-2010::13:52:43 ===
> Connection (<0.37.0>) closing: channel (<0.44.0>) died. Reason: 
> {function_clause,
>                                                                  
> [{amqp_channel,
>                                                                    
> build_content,
>                                                                    
> [<0.47.0>]},
>                                                                   
> {amqp_channel,
>                                                                    
> handle_call,
>                                                                    3},
>                                                                   
> {gen_server,
>                                                                    
> handle_msg,
>                                                                    5},
>                                                                   {proc_lib,
>                                                                    
> init_p_do_apply,
>                                                                    3}]}
> ** exception exit: 
> {{function_clause,[{amqp_channel,build_content,[<0.47.0>]},
>                                       {amqp_channel,handle_call,3},
>                                       {gen_server,handle_msg,5},
>                                       {proc_lib,init_p_do_apply,3}]},
>                     {gen_server,call,
>                                 [<0.44.0>,
>                                  {call,{'basic.consume',1,
>                                                         
> <<"amq.gen-JKETIEiVgO9bzH5ZKfghkA==">>,<<>>,false,false,
>                                                         false,false},
>                                        <0.47.0>},
>                                  infinity]}}
>      in function  gen_server:call/3
>      in call from rabbitmq_test:consume/0
> 2>
> =ERROR REPORT==== 8-Jan-2010::13:52:43 ===
> ** Generic server <0.37.0> terminating
> ** Last message in was {'$gen_cast',{method,{'connection.close_ok'},none}}
> ** When Server state == {nc_state,
>                             
> {amqp_params,<<"guest">>,<<"guest">>,<<"/test">>,
>                                 "localhost",5672,0,0,0,none},
>                             #Port<0.530>,<0.42.0>,<0.41.0>,<0.40.0>,0,0,
>                             {nc_closing,internal_error,
>                                 {'connection.close',541,<<>>,0,0},
>                                 none,wait_close_ok},
>                             {{0,nil},
>                              {dict,0,16,16,8,80,48,
>                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]},
>                                  
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]}}}}}
> ** Reason for termination ==
> ** {internal_error,541,<<>>}
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From sconover at gmail.com  Sat Jan  9 16:16:38 2010
From: sconover at gmail.com (Steve Conover)
Date: Sat, 9 Jan 2010 08:16:38 -0800
Subject: [rabbitmq-discuss] Rabbit-MQ crashing
In-Reply-To: <20100106114807.GH27068@wellquite.org>
References: <4ece5be60911100944y696030e9ga2ba6d153d0c19b6@mail.gmail.com>
	<4AFC1AF3.6000406@lshift.net>
	<d9743bb41001030905g35992b1ema5c1290217415f8f@mail.gmail.com>
	<20100106114807.GH27068@wellquite.org>
Message-ID: <d9743bb41001090816n366f3ba4y805d36492dc1dc39@mail.gmail.com>

It is, thank you for the update. -Steve

> I hope that's of some use.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From pathsny at gmail.com  Sun Jan 10 04:08:41 2010
From: pathsny at gmail.com (vishnu)
Date: Sun, 10 Jan 2010 09:38:41 +0530
Subject: [rabbitmq-discuss] running rabbitmq on a laptop
In-Reply-To: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>
References: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>
Message-ID: <c89c65ea1001092008n2069bae5k591ad8407ab04684@mail.gmail.com>

I've tried setting the RABBITMQ_NODENAME and RABBITMQ_NODE_IP_ADDRESS
environment variables. But for some reason rabbitmq doesn't seem to honor
them.
I was hoping the key to this problem was getting rabbitmq to only listen on
127.0.0.1.

am I on the right track here?

On Fri, Jan 8, 2010 at 10:12 AM, vishnu <pathsny at gmail.com> wrote:

> hi
>   for the purpose of development Im trying to run rabbitmq on my laptop.
> However the server is highly sensitive to the network I'm on and refuses to
> shut down for example, if I started it on a seperate network.
>
> my understanding is that this is because rabbitmq stores routing
> information in the database and this no longer holds once the network
> changes. However, is there a simple work around to deal with this? Maybe to
> turn off caching the routes?
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100110/0690f9ab/attachment.htm 

From matthew at lshift.net  Sun Jan 10 12:55:17 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 10 Jan 2010 12:55:17 +0000
Subject: [rabbitmq-discuss] running rabbitmq on a laptop
In-Reply-To: <c89c65ea1001092008n2069bae5k591ad8407ab04684@mail.gmail.com>
References: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>
	<c89c65ea1001092008n2069bae5k591ad8407ab04684@mail.gmail.com>
Message-ID: <20100110125517.GA7537@wellquite.org>

Hi Vishnu,

On Sun, Jan 10, 2010 at 09:38:41AM +0530, vishnu wrote:
> I've tried setting the RABBITMQ_NODENAME and RABBITMQ_NODE_IP_ADDRESS
> environment variables. But for some reason rabbitmq doesn't seem to honor
> them.
> I was hoping the key to this problem was getting rabbitmq to only listen on
> 127.0.0.1.

I assume you're using the latest from default (or the new persister),
and not v1.7.0.

I've just spotted a bug in the way we process the env vars which I'll
fix either later today or tomorrow. I don't think this bug existed in
1.7.0. You should be able to set NODENAME and NODE_IP_ADDRESS in
/etc/rabbitmq/rabbitmq.conf or in the env, but I can see that that's
currently broken.

However, provided you're using some version later than v1.7.0, you can
configure this in /etc/rabbitmq/rabbitmq.config with something like:

[{rabbit, [{tcp_listeners, [{"127.0.0.1", 5672}]}]}].

This is currently working (in fact, it was the changes to support this
that have broken the env var settings. Sigh).

Matthew



From matthew at lshift.net  Sun Jan 10 13:07:14 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 10 Jan 2010 13:07:14 +0000
Subject: [rabbitmq-discuss] running rabbitmq on a laptop
In-Reply-To: <20100110125517.GA7537@wellquite.org>
References: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>
	<c89c65ea1001092008n2069bae5k591ad8407ab04684@mail.gmail.com>
	<20100110125517.GA7537@wellquite.org>
Message-ID: <20100110130714.GB7537@wellquite.org>

On Sun, Jan 10, 2010 at 12:55:17PM +0000, Matthew Sackman wrote:
> I've just spotted a bug in the way we process the env vars which I'll
> fix either later today or tomorrow. I don't think this bug existed in
> 1.7.0. You should be able to set NODENAME and NODE_IP_ADDRESS in
> /etc/rabbitmq/rabbitmq.conf or in the env, but I can see that that's
> currently broken.

Actually, although that is broken, that only refers to putting
NODE_IP_ADDRESS in /etc/rabbitmq/rabbitmq.conf. Setting
RABBITMQ_NODE_IP_ADDRESS=127.0.0.1 in the env really does work just
fine.

And both NODENAME=foo in rabbitmq.conf and RABBITMQ_NODENAME=foo in the
env both work fine.

Matthew



From pathsny at gmail.com  Sun Jan 10 16:52:35 2010
From: pathsny at gmail.com (vishnu)
Date: Sun, 10 Jan 2010 22:22:35 +0530
Subject: [rabbitmq-discuss] Fwd:  running rabbitmq on a laptop
In-Reply-To: <c89c65ea1001100850p238bbb03yc3848ef5d271dff9@mail.gmail.com>
References: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>
	<c89c65ea1001092008n2069bae5k591ad8407ab04684@mail.gmail.com>
	<20100110125517.GA7537@wellquite.org>
	<20100110130714.GB7537@wellquite.org>
	<c89c65ea1001100849i77ce11efr53e356f10be8556c@mail.gmail.com>
	<c89c65ea1001100850p238bbb03yc3848ef5d271dff9@mail.gmail.com>
Message-ID: <c89c65ea1001100852s161da1eeyd0cd59ce9c76da77@mail.gmail.com>

(oops, ccing the list)


On Sun, Jan 10, 2010 at 10:19 PM, vishnu <pathsny at gmail.com> wrote:

> hi, so for some reason I found that setting RABBITMQ_NODENAME or
> RABBITMQ_NODE_IP_ADDRESS before running the rabbitmq-server script didnt
> seem to help. But when I modified the rabbitmq-server script to
> sudo -u rabbitmq -H env <whatever> , then it does work.
>
> sadly none of this helps :(. If I start the server when I'm on the
> internet, I can't shut it down when I'm off and vice versa.
>
> On Sun, Jan 10, 2010 at 6:37 PM, Matthew Sackman <matthew at lshift.net>wrote:
>
>> On Sun, Jan 10, 2010 at 12:55:17PM +0000, Matthew Sackman wrote:
>> > I've just spotted a bug in the way we process the env vars which I'll
>> > fix either later today or tomorrow. I don't think this bug existed in
>> > 1.7.0. You should be able to set NODENAME and NODE_IP_ADDRESS in
>> > /etc/rabbitmq/rabbitmq.conf or in the env, but I can see that that's
>> > currently broken.
>>
>> Actually, although that is broken, that only refers to putting
>> NODE_IP_ADDRESS in /etc/rabbitmq/rabbitmq.conf. Setting
>> RABBITMQ_NODE_IP_ADDRESS=127.0.0.1 in the env really does work just
>> fine.
>>
>> And both NODENAME=foo in rabbitmq.conf and RABBITMQ_NODENAME=foo in the
>> env both work fine.
>>
>> Matthew
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100110/d51881bb/attachment.htm 

From matthew at lshift.net  Sun Jan 10 17:01:12 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 10 Jan 2010 17:01:12 +0000
Subject: [rabbitmq-discuss] running rabbitmq on a laptop
In-Reply-To: <c89c65ea1001100849i77ce11efr53e356f10be8556c@mail.gmail.com>
References: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>
	<c89c65ea1001092008n2069bae5k591ad8407ab04684@mail.gmail.com>
	<20100110125517.GA7537@wellquite.org>
	<20100110130714.GB7537@wellquite.org>
	<c89c65ea1001100849i77ce11efr53e356f10be8556c@mail.gmail.com>
Message-ID: <20100110170112.GD7537@wellquite.org>

Hi Vishnu,

On Sun, Jan 10, 2010 at 10:19:46PM +0530, vishnu wrote:
> hi, so for some reason I found that setting RABBITMQ_NODENAME or
> RABBITMQ_NODE_IP_ADDRESS before running the rabbitmq-server script didnt
> seem to help. But when I modified the rabbitmq-server script to
> sudo -u rabbitmq -H env <whatever> , then it does work.
> 
> sadly none of this helps :(. If I start the server when I'm on the internet,
> I can't shut it down when I'm off and vice versa.

Hmm, I think this is a known Mac issue. There are some people in the
office who use Macs, I'll see if I can get them to suggest some fixes
or maybe other people on the list can help out. Fortunately, I never
go anywhere near OS X...

Matthew



From pathsny at gmail.com  Sun Jan 10 17:26:11 2010
From: pathsny at gmail.com (vishnu)
Date: Sun, 10 Jan 2010 22:56:11 +0530
Subject: [rabbitmq-discuss] running rabbitmq on a laptop
In-Reply-To: <20100110170112.GD7537@wellquite.org>
References: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>
	<c89c65ea1001092008n2069bae5k591ad8407ab04684@mail.gmail.com>
	<20100110125517.GA7537@wellquite.org>
	<20100110130714.GB7537@wellquite.org>
	<c89c65ea1001100849i77ce11efr53e356f10be8556c@mail.gmail.com>
	<20100110170112.GD7537@wellquite.org>
Message-ID: <c89c65ea1001100926w4824e307r86aec33d4d403197@mail.gmail.com>

haha ok, thanks :). It's been driving me nuts

On Sun, Jan 10, 2010 at 10:31 PM, Matthew Sackman <matthew at lshift.net>wrote:

> Hi Vishnu,
>
> On Sun, Jan 10, 2010 at 10:19:46PM +0530, vishnu wrote:
> > hi, so for some reason I found that setting RABBITMQ_NODENAME or
> > RABBITMQ_NODE_IP_ADDRESS before running the rabbitmq-server script didnt
> > seem to help. But when I modified the rabbitmq-server script to
> > sudo -u rabbitmq -H env <whatever> , then it does work.
> >
> > sadly none of this helps :(. If I start the server when I'm on the
> internet,
> > I can't shut it down when I'm off and vice versa.
>
> Hmm, I think this is a known Mac issue. There are some people in the
> office who use Macs, I'll see if I can get them to suggest some fixes
> or maybe other people on the list can help out. Fortunately, I never
> go anywhere near OS X...
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100110/42726ce7/attachment.htm 

From seemasbiradar at gmail.com  Mon Jan 11 07:21:41 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Mon, 11 Jan 2010 12:51:41 +0530
Subject: [rabbitmq-discuss] rabbitmq server to server communication
Message-ID: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>

Hi

My requirement is like this
Two instance of RabbitMQ server are running at different IP.say assume
P1 is a producer of rabitmq1 R1(which is in one mechine)
C2 is a cosumer of rabittmq2 R2 (which is running in another mechine),i
Is it possible  the communication flow in the following manner,

*p1-->R1-->R2-->C2*

If there small example please mail me back


Thanks in advance
Seema
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100111/210c0235/attachment.htm 

From matthias at lshift.net  Mon Jan 11 09:24:47 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 11 Jan 2010 09:24:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ/Stomp on Windows
In-Reply-To: <26813626.post@talk.nabble.com>
References: <4B0E41CD.6020909@gmx.net> <4B13ABA1.7000806@lshift.net>
	<26813626.post@talk.nabble.com>
Message-ID: <4B4AEE5F.2060708@lshift.net>

Michael,

mjustin wrote:
> many thanks for the link. I understand that I have to create a new
> configuration file on Windows and add the required parameters.
> 
> If I start RabbitMQ (on Ubuntu), the startup script (makefile) seems to pass
> parameters and logs then to the console. I am not sure what the
> configuration file should look like, I have only the output of the startup
> [...]
> I guess it is something like this:
> 
>   [
>     {rabbit, 
> 	[{stomp_listeners [{"10.0.2.15",61613}]},
> 	  extra_startup_steps [{"STOMP-listeners",	  rabbit_stomp,kickstart}]}
>              ]}
>   ].

The above is syntactically invalid. It should be

[{rabbit,
   [{stomp_listeners, [{"10.0.2.15",61613}]},
    {extra_startup_steps, [{"STOMP-listeners", rabbit_stomp, 
kickstart}]}]}].

However, that's still not right for 1.7.0, since there we switched stomp 
to be a plug-in and the configuration mechanism changed accordingly. 
Now, as per the README in the rabbitmq-stomp hg repo, you should only need

   [{rabbit_stomp, [{listeners, [{"10.0.2.15",61613}]}]}].


Regards,

Matthias.



From matthias at lshift.net  Mon Jan 11 09:59:26 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 11 Jan 2010 09:59:26 +0000
Subject: [rabbitmq-discuss] Queuing for an application that does a fair
 amount of synchronous processing
In-Reply-To: <c89c65ea1001060616q6336693cqbc40d3946123e0cc@mail.gmail.com>
References: <c89c65ea0912310715l7411fd43xfd5d9b8294bd4f1d@mail.gmail.com>	<29F69053-E0CB-4A9F-B4AE-ECB2F697E106@mac.com>	<c89c65ea0912311136y2813251ci68a9bc7a3a9002f5@mail.gmail.com>
	<c89c65ea1001060616q6336693cqbc40d3946123e0cc@mail.gmail.com>
Message-ID: <4B4AF67E.9030702@lshift.net>

vishnu wrote:
> We're also looking at about 3000 messages/second (high side)
> [...]
> The way we plan to implement these synchronous messages is, similar to 
> the RPC model, to create a temporary queue when we send out a request 
> and subscribe to that queue with a timeout for a response, deleting it 
> after we're done.

Queue creation is quite expensive; creating a temporary queue for every 
single request is therefore quite costly and you may well not be able to 
get 3000Hz throughput that way.

Are you planning to create a connection per request too? That too would 
be costly.

I'd recommend using a pool of connections, with per-connection exclusive 
reply queues.

> now, if the webserver thread breaks out of the wait before the message 
> returns, my understanding is that the temporary queue gets deleted and 
> the response from the backend server is sent to the exchange where it 
> dies. (which is fine)
> 
> if the webserver thread breaks out of the wait after the message 
> returns, the queue gets deleted anyway and the message should vanish.
> 
> If the webserver thread dies for some reason, the queue gets auto 
> deleted and so the  backend server again sends the response to the 
> exchange to a non existent queue.
> 
> However, the problem comes in when the webserver thread dies just as the 
> response returns on the temporary queue. When this race condition 
> occurs, the queue should remain on the rabbitmq-server forever. Is this 
> right, or is there something I'm missing?

Exclusive queues get deleted when their creating connection disappears. 
So the answer to the above depends on how you manage the lifecycle of 
the AMQP connection.


Regards,

Matthias.



From alexis.richardson at gmail.com  Mon Jan 11 11:00:52 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 11 Jan 2010 11:00:52 +0000
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
Message-ID: <167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>

Seema

We have a component called Shovel that does this.  Have a look at:

http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq

Also, some has created a 'relay' project on Github:
http://github.com/slider/amqp-relay

Does this answer your question?

alexis


On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar <seemasbiradar at gmail.com> wrote:
> Hi
>
> My requirement is like this
>
> Two instance of RabbitMQ server are running at different IP.say assume
> P1 is a producer of rabitmq1 R1(which is in one mechine)
> C2 is a cosumer of rabittmq2 R2 (which is running in another mechine),i
> Is it possible? the communication flow in the following manner,
> p1-->R1-->R2-->C2
>
> If there small example please mail me back
>
> Thanks in advance
> Seema
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Mon Jan 11 11:30:07 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 11 Jan 2010 11:30:07 +0000
Subject: [rabbitmq-discuss] compatibility with legacy code
In-Reply-To: <27073885.post@talk.nabble.com>
References: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>
	<k5my3245rg.fsf@mrbraver.lshift.net>
	<3b6ef0790911100650w475f577bw3c352d02dfbaee81@mail.gmail.com>
	<4AF98162.5070405@lshift.net> <27073885.post@talk.nabble.com>
Message-ID: <167204d21001110330o6fcbc77cme308080a458d0195@mail.gmail.com>

Dinabandhu

How are you getting on?  Were you able to get the C client working?

alexis


On Fri, Jan 8, 2010 at 10:18 AM, Dinabandhu
<dinabandhu.mitra at tecnotree.com> wrote:
>
> Hi Tony,
>
> I am trying to build this. I followed your links & instructions here.
> configure still gives error saying it could not find AMQP spec file at
> '/codegen/amqp-0.8.json'.
>
> This directory is of course wrong because the file is actually at
> /home/dinu/rabbitmq-codegen.
>
> The variable $ac_abs_confdir is blank and that seems to be reason ... from
> the configure script it looks like $ac_abs_confdir is expected to point to
> the directory from where configure is being run. I don't know enough about
> the autoconf tool chain to determine the root cause.
>
> I next modified configure.ac file to point sibling_codegen_dir to the
> correct directory ...
>
> #sibling_codegen_dir="$ac_abs_confdir/../rabbitmq-codegen"
> sibling_codegen_dir="/home/janus/dinu/rabbitmq-codegen"
>
> After this change the configure script went through. But make still fails
> ...
>
> [dinu at j4 rabbitmq-c]$ make
> make ?all-recursive
> make[1]: Entering directory `/home/dinu/rabbitmq-c'
> Making all in librabbitmq
> make[2]: Entering directory `/home/dinu/rabbitmq-c/librabbitmq'
> PYTHONPATH=/home/dinu/rabbitmq-codegen python2.5 ./codegen.py header
> /home/dinu/rabbitmq-codegen/amqp-0.8.json amqp_framing.h
> /bin/sh: python2.5: command not found
> make[2]: *** [amqp_framing.h] Error 127
> make[2]: Leaving directory `/home/dinu/rabbitmq-c/librabbitmq'
> make[1]: *** [all-recursive] Error 1
> make[1]: Leaving directory `/home/dinu/rabbitmq-c'
> make: *** [all] Error 2
>
> I don't have python2.5. what is there on my machine is python2.3.
>
> I am using RHEL 4.8 64 bit. Does the library expect some other distribution?
> 5.x?
>
> I will try by modifying the script files ... but if you can provide some
> pointers it would be good.
>
> Regards,
> Dinabandhu
>
>
> Tony Garnock-Jones-2 wrote:
>>
>> Hi Jim,
>>
>> Jim Irrer wrote:
>>> checking location of AMQP codegen directory... configure: error: could
>>> not find AMQP spec file at "'/codegen/amqp-0.9.1.json'"
>>
>> The MD5sum is correct, b50fd568311a052a45157631ba17c2b5, but are you
>> sure you're really building the one you just downloaded? For me, using
>> the file with the MD5sum you provided, I get:
>>
>> checking location of AMQP codegen directory... configure: error: could
>> not find AMQP spec file at
>> "'/Users/tonyg/qq/rabbitmq-c-default/codegen/amqp-0.8.json'"
>>
>> Note the 0.8 version number.
>>
>>> Am I supposed to get that file from somewhere else, or should it be in
>>> the tarball?
>>
>> You should retrieve rabbitmq-codegen as well. Sorry for the incomplete
>> instructions, I really must write this up properly and check it in.
>> Here's a complete recipe for building the C client and examples, on the
>> 0-8 branch.
>>
>> ?curl http://hg.rabbitmq.com/rabbitmq-codegen/archive/default.tar.gz\
>> ? | tar -zxf -
>> ?curl http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz\
>> ? | tar -zxf -
>> ?mv rabbitmq-codegen-default rabbitmq-codegen
>> ?mv rabbitmq-c-default rabbitmq-c
>> ?cd rabbitmq-c
>> ?autoreconf -i
>> ?./configure
>> ?make
>>
>> Alternatively, if you have mercurial installed:
>>
>> ?hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>> ?hg clone http://hg.rabbitmq.com/rabbitmq-c
>> ?cd rabbitmq-c
>> ?autoreconf -i
>> ?./configure
>> ?make
>>
>>> Also, I have doubts that this will work anyway, because the RabbitMQ
>>> server
>>> is running at version 0.8, so it won't be compatible with this client.
>>
>> The "default" branches of both the C client and the server are for 0-8,
>> and do work together.
>>
>> Cheers,
>> ? Tony
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://old.nabble.com/compatibility-with-legacy-code-tp26197670p27073885.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From Loren.Schlomer at echostar.com  Mon Jan 11 15:03:16 2010
From: Loren.Schlomer at echostar.com (Schlomer, Loren)
Date: Mon, 11 Jan 2010 08:03:16 -0700
Subject: [rabbitmq-discuss] Erlang Client - Unable to Subscribe with
 basic.consume
In-Reply-To: <20100109145137.GA5236@wellquite.org>
References: <4B47B92C.1070605@echostar.com>,
	<20100109145137.GA5236@wellquite.org>
Message-ID: <6294CCE6B4CE7D4D81822D7408E0D65709B4F3DDA7@ECHOEXCC1.SATS.CORP>

Matthew, thank you for your help!  The only documentation I could find for subscribing a queue to a pid using basic.consume was here:

http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.html

So, it appeared that the only API changes made was the way connection to the broker was established.  Thanks again!

________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman [matthew at lshift.net]
Sent: Saturday, January 09, 2010 7:51 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang Client - Unable to Subscribe with basic.consume

Hi Loren,

It depends which version of the Erlang client you're using, because this
has recently changed.

The version that is tagged with rabbitmq_v1_7_0 has a "subscribe"
function. This should be used as:

#'basic.consume_ok'{ consumer_tag = Tag } =
        amqp_channel:subscribe(Chan, #'basic.consume'{ queue = Q }, Pid),

However, I decided that I really didn't like this as it's non obvious
and doesn't match the rest of the API. Thus on default, consume exists
as a normal call. However, there is no Pid argument: instead you should
pass the Chan to the pid that needs to receive the msgs and get it to do
the consumer itself:

#'basic.consume_ok'{ consumer_tag = Tag } =
        amqp_channel:call(Chan, #'basic.consume'{ queue = Q }),

By using the 3-arg version of call, the client thinks that the consume
method has content, which is why it's exploding, as it can't encode
it. This is why we don't want to have the situation where for consumer,
the 3rd-arg is treated as a Pid, whereas for all other methods it's
treated as method content.

Hopefully the API is now more consistent.

Matthew

On Fri, Jan 08, 2010 at 04:01:00PM -0700, Schlomer, Loren wrote:
> I am trying to subscribe a queue to a Pid using:
>
> amqp_channel:call(Channel, #'basic.consume'{queue=QueueName}, Pid)
>
> and using all other default settings in the #'basic.consume' record.  I
> get the following exception stack and have been unable to discover why.
> Any help would be greatly appreciated!
>
>
> =ERROR REPORT==== 8-Jan-2010::13:52:43 ===
> ** Generic server <0.44.0> terminating
> ** Last message in was {call,
>                            {'basic.consume',1,
>                                <<"amq.gen-JKETIEiVgO9bzH5ZKfghkA==">>,<<>>,
>                                false,false,false,false},
>                            <0.47.0>}
> ** When Server state == {c_state,1,<0.37.0>,<0.45.0>,<0.46.0>,network,
>                             {[],[]},
>                             {[],[]},
>                             {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             false,none,false,none,
>                             {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}}}
> ** Reason for termination ==
> ** {function_clause,[{amqp_channel,build_content,[<0.47.0>]},
>                      {amqp_channel,handle_call,3},
>                      {gen_server,handle_msg,5},
>                      {proc_lib,init_p_do_apply,3}]}
>
> =ERROR REPORT==== 8-Jan-2010::13:52:43 ===
> Connection (<0.37.0>) closing: channel (<0.44.0>) died. Reason:
> {function_clause,
>
> [{amqp_channel,
>
> build_content,
>
> [<0.47.0>]},
>
> {amqp_channel,
>
> handle_call,
>                                                                    3},
>
> {gen_server,
>
> handle_msg,
>                                                                    5},
>                                                                   {proc_lib,
>
> init_p_do_apply,
>                                                                    3}]}
> ** exception exit:
> {{function_clause,[{amqp_channel,build_content,[<0.47.0>]},
>                                       {amqp_channel,handle_call,3},
>                                       {gen_server,handle_msg,5},
>                                       {proc_lib,init_p_do_apply,3}]},
>                     {gen_server,call,
>                                 [<0.44.0>,
>                                  {call,{'basic.consume',1,
>
> <<"amq.gen-JKETIEiVgO9bzH5ZKfghkA==">>,<<>>,false,false,
>                                                         false,false},
>                                        <0.47.0>},
>                                  infinity]}}
>      in function  gen_server:call/3
>      in call from rabbitmq_test:consume/0
> 2>
> =ERROR REPORT==== 8-Jan-2010::13:52:43 ===
> ** Generic server <0.37.0> terminating
> ** Last message in was {'$gen_cast',{method,{'connection.close_ok'},none}}
> ** When Server state == {nc_state,
>
> {amqp_params,<<"guest">>,<<"guest">>,<<"/test">>,
>                                 "localhost",5672,0,0,0,none},
>                             #Port<0.530>,<0.42.0>,<0.41.0>,<0.40.0>,0,0,
>                             {nc_closing,internal_error,
>                                 {'connection.close',541,<<>>,0,0},
>                                 none,wait_close_ok},
>                             {{0,nil},
>                              {dict,0,16,16,8,80,48,
>                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]}}}}}
> ** Reason for termination ==
> ** {internal_error,541,<<>>}
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From tonyg at lshift.net  Mon Jan 11 15:18:56 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 11 Jan 2010 15:18:56 +0000
Subject: [rabbitmq-discuss] running rabbitmq on a laptop
In-Reply-To: <20100110170112.GD7537@wellquite.org>
References: <c89c65ea1001072042j5520880fj954866814bfc18b1@mail.gmail.com>	<c89c65ea1001092008n2069bae5k591ad8407ab04684@mail.gmail.com>	<20100110125517.GA7537@wellquite.org>	<20100110130714.GB7537@wellquite.org>	<c89c65ea1001100849i77ce11efr53e356f10be8556c@mail.gmail.com>
	<20100110170112.GD7537@wellquite.org>
Message-ID: <4B4B4160.1010704@lshift.net>

Matthew Sackman wrote:
> Hmm, I think this is a known Mac issue.

Yes, it is. It's because of the way macs change their hostname. This
interacts badly with the way epmd looks up its own address. Some relief
might be found by following the ideas from this thread:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-October/005053.html

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From Dinabandhu.Mitra at tecnotree.com  Mon Jan 11 15:34:57 2010
From: Dinabandhu.Mitra at tecnotree.com (Dinabandhu Mitra)
Date: Mon, 11 Jan 2010 17:34:57 +0200
Subject: [rabbitmq-discuss] compatibility with legacy code
In-Reply-To: <167204d21001110330o6fcbc77cme308080a458d0195@mail.gmail.com>
References: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>
	<k5my3245rg.fsf@mrbraver.lshift.net>
	<3b6ef0790911100650w475f577bw3c352d02dfbaee81@mail.gmail.com>
	<4AF98162.5070405@lshift.net> <27073885.post@talk.nabble.com>
	<167204d21001110330o6fcbc77cme308080a458d0195@mail.gmail.com>
Message-ID: <960996F6EFBCB843BFD62DAA96BD1DD818062064D4@esmail10>

Hi Alexis,

Yes :). At least managed to compile. Not tested though as yet.

This is complete set of steps that I followed ... it should (hopefully) work for anyone using RHEL 4.8

1. Downloaded rabbitmq-codegen from http://hg.rabbitmq.com/rabbitmq-codegen/archive/default.tar.gz
2. Downloaded rabbitmq-c from http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz
3. Copied both to /home/dinu [my home directory].
4. Download and install simplejson 2.0.5. from http://pypi.python.org/pypi/simplejson/2.0.5 .
   [The current latest version 2.0.9 is dependent on Python 2.4+ and I don't know if it will 
   work on RHEL 4.8 which comes with python 2.3+.]
5. tar -xvzf rabbitmq-c-default.tar.gz
6. tar -xvzf rabbitmq-codegen-default.tar.gz
7. mv rabbitmq-c-default rabbitmq-c
8. mv rabbitmq-codegen-default rabbitmq-codegen
9. cd rabbitmq-c
10. Edit "configure.ac" file and make the following changes 
	#sibling_codegen_dir="$ac_abs_confdir/../rabbitmq-codegen"
	sibling_codegen_dir="/home/dinu/rabbitmq-codegen"
   Note that this step was required in my environment. But that may be due 
   to something broken in the server I am using and may not be necessary for everyone.
11. autoreconf -i
12. ./configure
13. Edit librabbitmq/Makefile* (three files) and make the following modification in each
    #PYTHON=python2.5
    PYTHON=python
14. make
15. make install [I logged in as root to do the install but may not be necessary]

Lastly, for people like me, for whom the word "python" relates only to a large serpent :), 
this is how I built simplejson -

1. Download simplejson 2.0.5 source from http://pypi.python.org/pypi/simplejson/2.0.5
2. tar -xvzf simplejson-2.0.5.tar.gz
3. cd simplejson-2.0.5
4. python ez_setup.py [I am not sure if this is necessary but I did this]
5. python setup.py build
6. python setup.py install
7. I did above steps as root user.

As of now, the library seems to have built and installed correctly ... i.e. I can see

/usr/local/lib/librabbitmq.*
/usr/local/bin/amqp_* [I guess example binaries]
/usr/local/include/amqp*.h

I will test the installation and keep you posted.

Regards,
Dinabandhu 
	
> -----Original Message-----
> From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
> Sent: Monday, January 11, 2010 5:00 PM
> To: Dinabandhu Mitra
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] compatibility with legacy code
> 
> Dinabandhu
> 
> How are you getting on?  Were you able to get the C client working?
> 
> alexis
> 
> 
> On Fri, Jan 8, 2010 at 10:18 AM, Dinabandhu
> <dinabandhu.mitra at tecnotree.com> wrote:
> >
> > Hi Tony,
> >
> > I am trying to build this. I followed your links & instructions here.
> > configure still gives error saying it could not find AMQP spec file
> at
> > '/codegen/amqp-0.8.json'.
> >
> > This directory is of course wrong because the file is actually at
> > /home/dinu/rabbitmq-codegen.
> >
> > The variable $ac_abs_confdir is blank and that seems to be reason ...
> from
> > the configure script it looks like $ac_abs_confdir is expected to
> point to
> > the directory from where configure is being run. I don't know enough
> about
> > the autoconf tool chain to determine the root cause.
> >
> > I next modified configure.ac file to point sibling_codegen_dir to the
> > correct directory ...
> >
> > #sibling_codegen_dir="$ac_abs_confdir/../rabbitmq-codegen"
> > sibling_codegen_dir="/home/janus/dinu/rabbitmq-codegen"
> >
> > After this change the configure script went through. But make still
> fails
> > ...
> >
> > [dinu at j4 rabbitmq-c]$ make
> > make ?all-recursive
> > make[1]: Entering directory `/home/dinu/rabbitmq-c'
> > Making all in librabbitmq
> > make[2]: Entering directory `/home/dinu/rabbitmq-c/librabbitmq'
> > PYTHONPATH=/home/dinu/rabbitmq-codegen python2.5 ./codegen.py header
> > /home/dinu/rabbitmq-codegen/amqp-0.8.json amqp_framing.h
> > /bin/sh: python2.5: command not found
> > make[2]: *** [amqp_framing.h] Error 127
> > make[2]: Leaving directory `/home/dinu/rabbitmq-c/librabbitmq'
> > make[1]: *** [all-recursive] Error 1
> > make[1]: Leaving directory `/home/dinu/rabbitmq-c'
> > make: *** [all] Error 2
> >
> > I don't have python2.5. what is there on my machine is python2.3.
> >
> > I am using RHEL 4.8 64 bit. Does the library expect some other
> distribution?
> > 5.x?
> >
> > I will try by modifying the script files ... but if you can provide
> some
> > pointers it would be good.
> >
> > Regards,
> > Dinabandhu
> >
> >
> > Tony Garnock-Jones-2 wrote:
> >>
> >> Hi Jim,
> >>
> >> Jim Irrer wrote:
> >>> checking location of AMQP codegen directory... configure: error:
> could
> >>> not find AMQP spec file at "'/codegen/amqp-0.9.1.json'"
> >>
> >> The MD5sum is correct, b50fd568311a052a45157631ba17c2b5, but are you
> >> sure you're really building the one you just downloaded? For me,
> using
> >> the file with the MD5sum you provided, I get:
> >>
> >> checking location of AMQP codegen directory... configure: error:
> could
> >> not find AMQP spec file at
> >> "'/Users/tonyg/qq/rabbitmq-c-default/codegen/amqp-0.8.json'"
> >>
> >> Note the 0.8 version number.
> >>
> >>> Am I supposed to get that file from somewhere else, or should it be
> in
> >>> the tarball?
> >>
> >> You should retrieve rabbitmq-codegen as well. Sorry for the
> incomplete
> >> instructions, I really must write this up properly and check it in.
> >> Here's a complete recipe for building the C client and examples, on
> the
> >> 0-8 branch.
> >>
> >> ?curl http://hg.rabbitmq.com/rabbitmq-
> codegen/archive/default.tar.gz\
> >> ? | tar -zxf -
> >> ?curl http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz\
> >> ? | tar -zxf -
> >> ?mv rabbitmq-codegen-default rabbitmq-codegen
> >> ?mv rabbitmq-c-default rabbitmq-c
> >> ?cd rabbitmq-c
> >> ?autoreconf -i
> >> ?./configure
> >> ?make
> >>
> >> Alternatively, if you have mercurial installed:
> >>
> >> ?hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> >> ?hg clone http://hg.rabbitmq.com/rabbitmq-c
> >> ?cd rabbitmq-c
> >> ?autoreconf -i
> >> ?./configure
> >> ?make
> >>
> >>> Also, I have doubts that this will work anyway, because the
> RabbitMQ
> >>> server
> >>> is running at version 0.8, so it won't be compatible with this
> client.
> >>
> >> The "default" branches of both the C client and the server are for
> 0-8,
> >> and do work together.
> >>
> >> Cheers,
> >> ? Tony
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >>
> >
> > --
> > View this message in context: http://old.nabble.com/compatibility-
> with-legacy-code-tp26197670p27073885.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >



From rajesh.reddy at baml.com  Mon Jan 11 16:56:15 2010
From: rajesh.reddy at baml.com (Reddy, Rajesh (GPT EMEA))
Date: Mon, 11 Jan 2010 16:56:15 +0000
Subject: [rabbitmq-discuss] Java Client library : RPCClient throws
	nullpointerexception
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C3CDD@mllnc20mb056.emea.win.ml.com>
Message-ID: <03FC0D29D4E88943AB7420C524BE8489027C3CDE@mllnc20mb056.emea.win.ml.com>

> Hi
> 
> Iam getting the following EOF Exception when trying to cal the
> mapcall() on Rpcclient in java library. This is the same exception I
> get if trying to create a new instance of JsonRpcClient.
> 
> Similar call() in .net library works. Iam basically using the same
> example as in .net. There are no examples for java libraray.
> 
> Consumer com.rabbitmq.client.RpcClient$1 at 1ae9aaa method handleDelivery
> for channel
> AMQChannel(amqp://guest at GBWMAPPROPC01.emea.win.ml.com:5672/,1) threw
> an exception:
> java.lang.NullPointerException
> 	at
> com.rabbitmq.client.RpcClient$1.handleDelivery(RpcClient.java:153)
> 	at
> com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:223)
> 	at
> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQCh
> annel.java:159)
> 	at
> com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
> 	at
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java
> :456)
> 
> Following is the sample code which is raising the exception
	Connection _conn =
Utility.createConnection("GBWMAPPROPC01.emea.win.ml.com",
Constants.DEFAULT_HEARTBEAT);
	Channel _channel= _conn.createChannel();

	RpcClient _rpcClient = 
	            new RpcClient(_channel,"amq.direct","Admin");

	Map<String, Object> request = createRequest(requestType);

	// this line throws the exception
	Map<String, Object> reply = _rpcClient.mapCall(request); 

> Thanks
> Rajesh

--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. The information contained in this e-mail was obtained from sources believed to be reliable; however, the accuracy or completeness of this information is not guaranteed. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Past performance is no guarantee of future results. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100111/70221201/attachment.htm 

From chetna at rockmelt.com  Tue Jan 12 05:19:48 2010
From: chetna at rockmelt.com (chetna kaur)
Date: Mon, 11 Jan 2010 21:19:48 -0800 (PST)
Subject: [rabbitmq-discuss]  RabbitMQ xmpp gateway
Message-ID: <27121792.post@talk.nabble.com>


Hi,

I was wondering if there are any plans of releasing a production ready
version of the rabbitmq xmpp gateway. Would like to use ejabberd with
rabbitmq for a project!

Thanks,
Chetna

-- 
View this message in context: http://old.nabble.com/RabbitMQ-xmpp-gateway-tp27121792p27121792.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From Dinabandhu.Mitra at tecnotree.com  Tue Jan 12 05:50:24 2010
From: Dinabandhu.Mitra at tecnotree.com (Dinabandhu Mitra)
Date: Tue, 12 Jan 2010 07:50:24 +0200
Subject: [rabbitmq-discuss] compatibility with legacy code
In-Reply-To: <167204d21001110814w4f5285c4vd92739c3c5ead772@mail.gmail.com>
References: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>
	<k5my3245rg.fsf@mrbraver.lshift.net>
	<3b6ef0790911100650w475f577bw3c352d02dfbaee81@mail.gmail.com>
	<4AF98162.5070405@lshift.net> <27073885.post@talk.nabble.com>
	<167204d21001110330o6fcbc77cme308080a458d0195@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD818062064D4@esmail10>
	<167204d21001110814w4f5285c4vd92739c3c5ead772@mail.gmail.com>
Message-ID: <960996F6EFBCB843BFD62DAA96BD1DD8180620668E@esmail10>

Hi,

The sample programs are running. I plan to code a thin C++ wrapper over the C API and try it out.

Regards,
Dinabandhu

> -----Original Message-----
> From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
> Sent: Monday, January 11, 2010 9:44 PM
> To: Dinabandhu Mitra
> Subject: Re: [rabbitmq-discuss] compatibility with legacy code
> 
> Great!
> 
> On Mon, Jan 11, 2010 at 3:34 PM, Dinabandhu Mitra
> <Dinabandhu.Mitra at tecnotree.com> wrote:
> > Hi Alexis,
> >
> > Yes :). At least managed to compile. Not tested though as yet.
> >
> > This is complete set of steps that I followed ... it should
> (hopefully) work for anyone using RHEL 4.8
> >
> > 1. Downloaded rabbitmq-codegen from http://hg.rabbitmq.com/rabbitmq-
> codegen/archive/default.tar.gz
> > 2. Downloaded rabbitmq-c from http://hg.rabbitmq.com/rabbitmq-
> c/archive/default.tar.gz
> > 3. Copied both to /home/dinu [my home directory].
> > 4. Download and install simplejson 2.0.5. from
> http://pypi.python.org/pypi/simplejson/2.0.5 .
> > ? [The current latest version 2.0.9 is dependent on Python 2.4+ and I
> don't know if it will
> > ? work on RHEL 4.8 which comes with python 2.3+.]
> > 5. tar -xvzf rabbitmq-c-default.tar.gz
> > 6. tar -xvzf rabbitmq-codegen-default.tar.gz
> > 7. mv rabbitmq-c-default rabbitmq-c
> > 8. mv rabbitmq-codegen-default rabbitmq-codegen
> > 9. cd rabbitmq-c
> > 10. Edit "configure.ac" file and make the following changes
> > ? ? ? ?#sibling_codegen_dir="$ac_abs_confdir/../rabbitmq-codegen"
> > ? ? ? ?sibling_codegen_dir="/home/dinu/rabbitmq-codegen"
> > ? Note that this step was required in my environment. But that may be
> due
> > ? to something broken in the server I am using and may not be
> necessary for everyone.
> > 11. autoreconf -i
> > 12. ./configure
> > 13. Edit librabbitmq/Makefile* (three files) and make the following
> modification in each
> > ? ?#PYTHON=python2.5
> > ? ?PYTHON=python
> > 14. make
> > 15. make install [I logged in as root to do the install but may not
> be necessary]
> >
> > Lastly, for people like me, for whom the word "python" relates only
> to a large serpent :),
> > this is how I built simplejson -
> >
> > 1. Download simplejson 2.0.5 source from
> http://pypi.python.org/pypi/simplejson/2.0.5
> > 2. tar -xvzf simplejson-2.0.5.tar.gz
> > 3. cd simplejson-2.0.5
> > 4. python ez_setup.py [I am not sure if this is necessary but I did
> this]
> > 5. python setup.py build
> > 6. python setup.py install
> > 7. I did above steps as root user.
> >
> > As of now, the library seems to have built and installed correctly
> ... i.e. I can see
> >
> > /usr/local/lib/librabbitmq.*
> > /usr/local/bin/amqp_* [I guess example binaries]
> > /usr/local/include/amqp*.h
> >
> > I will test the installation and keep you posted.
> >
> > Regards,
> > Dinabandhu
> >
> >> -----Original Message-----
> >> From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
> >> Sent: Monday, January 11, 2010 5:00 PM
> >> To: Dinabandhu Mitra
> >> Cc: rabbitmq-discuss at lists.rabbitmq.com
> >> Subject: Re: [rabbitmq-discuss] compatibility with legacy code
> >>
> >> Dinabandhu
> >>
> >> How are you getting on? ?Were you able to get the C client working?
> >>
> >> alexis
> >>
> >>
> >> On Fri, Jan 8, 2010 at 10:18 AM, Dinabandhu
> >> <dinabandhu.mitra at tecnotree.com> wrote:
> >> >
> >> > Hi Tony,
> >> >
> >> > I am trying to build this. I followed your links & instructions
> here.
> >> > configure still gives error saying it could not find AMQP spec
> file
> >> at
> >> > '/codegen/amqp-0.8.json'.
> >> >
> >> > This directory is of course wrong because the file is actually at
> >> > /home/dinu/rabbitmq-codegen.
> >> >
> >> > The variable $ac_abs_confdir is blank and that seems to be reason
> ...
> >> from
> >> > the configure script it looks like $ac_abs_confdir is expected to
> >> point to
> >> > the directory from where configure is being run. I don't know
> enough
> >> about
> >> > the autoconf tool chain to determine the root cause.
> >> >
> >> > I next modified configure.ac file to point sibling_codegen_dir to
> the
> >> > correct directory ...
> >> >
> >> > #sibling_codegen_dir="$ac_abs_confdir/../rabbitmq-codegen"
> >> > sibling_codegen_dir="/home/janus/dinu/rabbitmq-codegen"
> >> >
> >> > After this change the configure script went through. But make
> still
> >> fails
> >> > ...
> >> >
> >> > [dinu at j4 rabbitmq-c]$ make
> >> > make ?all-recursive
> >> > make[1]: Entering directory `/home/dinu/rabbitmq-c'
> >> > Making all in librabbitmq
> >> > make[2]: Entering directory `/home/dinu/rabbitmq-c/librabbitmq'
> >> > PYTHONPATH=/home/dinu/rabbitmq-codegen python2.5 ./codegen.py
> header
> >> > /home/dinu/rabbitmq-codegen/amqp-0.8.json amqp_framing.h
> >> > /bin/sh: python2.5: command not found
> >> > make[2]: *** [amqp_framing.h] Error 127
> >> > make[2]: Leaving directory `/home/dinu/rabbitmq-c/librabbitmq'
> >> > make[1]: *** [all-recursive] Error 1
> >> > make[1]: Leaving directory `/home/dinu/rabbitmq-c'
> >> > make: *** [all] Error 2
> >> >
> >> > I don't have python2.5. what is there on my machine is python2.3.
> >> >
> >> > I am using RHEL 4.8 64 bit. Does the library expect some other
> >> distribution?
> >> > 5.x?
> >> >
> >> > I will try by modifying the script files ... but if you can
> provide
> >> some
> >> > pointers it would be good.
> >> >
> >> > Regards,
> >> > Dinabandhu
> >> >
> >> >
> >> > Tony Garnock-Jones-2 wrote:
> >> >>
> >> >> Hi Jim,
> >> >>
> >> >> Jim Irrer wrote:
> >> >>> checking location of AMQP codegen directory... configure: error:
> >> could
> >> >>> not find AMQP spec file at "'/codegen/amqp-0.9.1.json'"
> >> >>
> >> >> The MD5sum is correct, b50fd568311a052a45157631ba17c2b5, but are
> you
> >> >> sure you're really building the one you just downloaded? For me,
> >> using
> >> >> the file with the MD5sum you provided, I get:
> >> >>
> >> >> checking location of AMQP codegen directory... configure: error:
> >> could
> >> >> not find AMQP spec file at
> >> >> "'/Users/tonyg/qq/rabbitmq-c-default/codegen/amqp-0.8.json'"
> >> >>
> >> >> Note the 0.8 version number.
> >> >>
> >> >>> Am I supposed to get that file from somewhere else, or should it
> be
> >> in
> >> >>> the tarball?
> >> >>
> >> >> You should retrieve rabbitmq-codegen as well. Sorry for the
> >> incomplete
> >> >> instructions, I really must write this up properly and check it
> in.
> >> >> Here's a complete recipe for building the C client and examples,
> on
> >> the
> >> >> 0-8 branch.
> >> >>
> >> >> ?curl http://hg.rabbitmq.com/rabbitmq-
> >> codegen/archive/default.tar.gz\
> >> >> ? | tar -zxf -
> >> >> ?curl http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz\
> >> >> ? | tar -zxf -
> >> >> ?mv rabbitmq-codegen-default rabbitmq-codegen
> >> >> ?mv rabbitmq-c-default rabbitmq-c
> >> >> ?cd rabbitmq-c
> >> >> ?autoreconf -i
> >> >> ?./configure
> >> >> ?make
> >> >>
> >> >> Alternatively, if you have mercurial installed:
> >> >>
> >> >> ?hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> >> >> ?hg clone http://hg.rabbitmq.com/rabbitmq-c
> >> >> ?cd rabbitmq-c
> >> >> ?autoreconf -i
> >> >> ?./configure
> >> >> ?make
> >> >>
> >> >>> Also, I have doubts that this will work anyway, because the
> >> RabbitMQ
> >> >>> server
> >> >>> is running at version 0.8, so it won't be compatible with this
> >> client.
> >> >>
> >> >> The "default" branches of both the C client and the server are
> for
> >> 0-8,
> >> >> and do work together.
> >> >>
> >> >> Cheers,
> >> >> ? Tony
> >> >>
> >> >> _______________________________________________
> >> >> rabbitmq-discuss mailing list
> >> >> rabbitmq-discuss at lists.rabbitmq.com
> >> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
> discuss
> >> >>
> >> >>
> >> >
> >> > --
> >> > View this message in context: http://old.nabble.com/compatibility-
> >> with-legacy-code-tp26197670p27073885.html
> >> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
> discuss
> >> >
> >



From seemasbiradar at gmail.com  Tue Jan 12 07:00:22 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Tue, 12 Jan 2010 12:30:22 +0530
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
Message-ID: <558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>

Hi,
Thanks for the information.

I need one more help .

Can you please suggest me how can we use Shovel component and RabbitMQ using
in JAVA Programming language.

Using JAVA as programming language (RabbitMQ Java API), how can we make use
of shovel component?
(I am using RabbitMQ bundle for Windows )

If any examples are there ( RabbitMQ Java API + Shovel Application ) .please
let me know.

Thanksin adavance.
Seema




On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Seema
>
> We have a component called Shovel that does this.  Have a look at:
>
>
> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq
>
> Also, some has created a 'relay' project on Github:
> http://github.com/slider/amqp-relay
>
> Does this answer your question?
>
> alexis
>
>
> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar <seemasbiradar at gmail.com>
> wrote:
> > Hi
> >
> > My requirement is like this
> >
> > Two instance of RabbitMQ server are running at different IP.say assume
> > P1 is a producer of rabitmq1 R1(which is in one mechine)
> > C2 is a cosumer of rabittmq2 R2 (which is running in another mechine),i
> > Is it possible  the communication flow in the following manner,
> > p1-->R1-->R2-->C2
> >
> > If there small example please mail me back
> >
> > Thanks in advance
> > Seema
> >
>  > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100112/80fb5710/attachment.htm 

From pradeep.gatram at gmail.com  Tue Jan 12 07:18:38 2010
From: pradeep.gatram at gmail.com (Pradeep Gatram)
Date: Tue, 12 Jan 2010 12:48:38 +0530
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com> 
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com> 
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
Message-ID: <9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>

Seema,

You dont have to interact with Shovel directly. Look at it this way

*p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2

p1 & c2 can be in any programming language. You just have to "configure" the
Shovel/amqp-relay appropriately.

Pradeep
*
On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar <seemasbiradar at gmail.com>wrote:

> Hi,
> Thanks for the information.
>
> I need one more help .
>
> Can you please suggest me how can we use Shovel component and RabbitMQ
> using in JAVA Programming language.
>
> Using JAVA as programming language (RabbitMQ Java API), how can we make use
> of shovel component?
> (I am using RabbitMQ bundle for Windows )
>
> If any examples are there ( RabbitMQ Java API + Shovel Application )
> .please let me know.
>
> Thanksin adavance.
> Seema
>
>
>
>
> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson <
> alexis.richardson at gmail.com> wrote:
>
>> Seema
>>
>> We have a component called Shovel that does this.  Have a look at:
>>
>>
>> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq<http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=%21009922129631189805192%3Akpd1zoym_hq>
>>
>> Also, some has created a 'relay' project on Github:
>> http://github.com/slider/amqp-relay
>>
>> Does this answer your question?
>>
>> alexis
>>
>>
>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar <seemasbiradar at gmail.com>
>> wrote:
>> > Hi
>> >
>> > My requirement is like this
>> >
>> > Two instance of RabbitMQ server are running at different IP.say assume
>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
>> > C2 is a cosumer of rabittmq2 R2 (which is running in another mechine),i
>> > Is it possible  the communication flow in the following manner,
>> > p1-->R1-->R2-->C2
>> >
>> > If there small example please mail me back
>> >
>> > Thanks in advance
>> > Seema
>> >
>>   > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100112/847fc9be/attachment.htm 

From tonyg at lshift.net  Tue Jan 12 17:14:52 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 12 Jan 2010 17:14:52 +0000
Subject: [rabbitmq-discuss] RabbitMQ xmpp gateway
In-Reply-To: <27121792.post@talk.nabble.com>
References: <27121792.post@talk.nabble.com>
Message-ID: <4B4CAE0C.8050209@lshift.net>

chetna kaur wrote:
> I was wondering if there are any plans of releasing a production ready
> version of the rabbitmq xmpp gateway.

No, not at the moment. Or at least, the current gateway works well
enough for us to use internally, and I'm told that a number of people
are using it in production, so we don't have a lot of motivation to make
changes to it :-)

Regards,
  Tony



From tonyg at lshift.net  Tue Jan 12 17:23:19 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 12 Jan 2010 17:23:19 +0000
Subject: [rabbitmq-discuss] Java Client library : RPCClient
	throws	nullpointerexception
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C3CDE@mllnc20mb056.emea.win.ml.com>
References: <03FC0D29D4E88943AB7420C524BE8489027C3CDE@mllnc20mb056.emea.win.ml.com>
Message-ID: <4B4CB007.9020601@lshift.net>

Hi Rajesh,

Reddy, Rajesh (GPT EMEA) wrote:
>       Iam getting the following EOF Exception when trying to cal the
>       mapcall() on Rpcclient in java library. This is the same exception
>       I get if trying to create a new instance of JsonRpcClient.

Your stacktrace indicates that the correlation ID of the reply message
does not match the correlation ID expected by the client.

Off the top of my head, this could happen because of a bug in the RPC
server program, or because there are stale reply messages in the reply
queue.

Do the bundled HelloClient and HelloServer examples work?

>       There are no examples for java libraray.

Yes, there are: See classes HelloClient and HelloServer, which use
RpcClient and RpcServer, and classes HelloJsonClient and HelloJsonServer
which use JsonRpcClient and JsonRpcServer.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From alexis.richardson at gmail.com  Tue Jan 12 17:52:14 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 12 Jan 2010 17:52:14 +0000
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
Message-ID: <167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>

Seema,

I am not the best person to answer your question in full, but:  In
addition to what Pradeep said, you need to be aware that Shovel is a
RabbitMQ plugin.  The plugins are described here:
http://www.rabbitmq.com/admin-guide.html#plugins

The following talk describes a use case involving Shovel -

http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost

And Stefan's slides are here:

http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301

alexis


On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
<pradeep.gatram at gmail.com> wrote:
> Seema,
>
> You dont have to interact with Shovel directly. Look at it this way
>
> p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
>
> p1 & c2 can be in any programming language. You just have to "configure" the
> Shovel/amqp-relay appropriately.
>
> Pradeep
>
> On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar <seemasbiradar at gmail.com>
> wrote:
>>
>> Hi,
>> Thanks for the information.
>>
>> I need one more help .
>>
>> Can you please suggest me how can we use Shovel?component and RabbitMQ
>> using in JAVA Programming language.
>>
>> Using JAVA as programming language (RabbitMQ Java API), how can we make
>> use of shovel component?
>> (I am using RabbitMQ bundle for Windows )
>>
>> If any examples are there ( RabbitMQ Java API + Shovel Application )
>> .please let me know.
>>
>> Thanksin adavance.
>> Seema
>>
>>
>>
>> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
>> <alexis.richardson at gmail.com> wrote:
>>>
>>> Seema
>>>
>>> We have a component called Shovel that does this. ?Have a look at:
>>>
>>>
>>> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq
>>>
>>> Also, some has created a 'relay' project on Github:
>>> http://github.com/slider/amqp-relay
>>>
>>> Does this answer your question?
>>>
>>> alexis
>>>
>>>
>>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar <seemasbiradar at gmail.com>
>>> wrote:
>>> > Hi
>>> >
>>> > My requirement is like this
>>> >
>>> > Two instance of RabbitMQ server are running at different IP.say assume
>>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
>>> > C2 is a cosumer of rabittmq2 R2 (which is running in another mechine),i
>>> > Is it possible? the communication flow in the following manner,
>>> > p1-->R1-->R2-->C2
>>> >
>>> > If there small example please mail me back
>>> >
>>> > Thanks in advance
>>> > Seema
>>> >
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>> >
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From erikba at odysseus.anderson.name  Tue Jan 12 18:16:08 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Tue, 12 Jan 2010 10:16:08 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ/Stomp on Windows
In-Reply-To: <4B4AEE5F.2060708@lshift.net>
References: <4B0E41CD.6020909@gmx.net> <4B13ABA1.7000806@lshift.net> 
	<26813626.post@talk.nabble.com> <4B4AEE5F.2060708@lshift.net>
Message-ID: <cbca37e7-2894-4bbc-9364-1263d01ee742@j24g2000yqa.googlegroups.com>

Okay, I finally figured out that I subscribed to this list in an
insufficient number of places.  I won't paste my original email (which
discussed calling install-plugins and modifying my -server script) but
I will state that I needed to make the following changes to my -
service script in order for it to run the custom boot required to
launch the plugin manager (or whatever it's doing behind the scenes)

"%ERLANG_SERVICE_MANAGER_PATH%\erlsrv" list %RABBITMQ_SERVICENAME%
2>NUL 1>NUL
if errorlevel 1 (
   "%ERLANG_SERVICE_MANAGER_PATH%\erlsrv" add %RABBITMQ_SERVICENAME%
) else (
   echo %RABBITMQ_SERVICENAME% service is already present - only
updating service parameters
)

set RABBIT_EBIN=%~dp0..\ebin
if exist "%RABBIT_EBIN%\rabbit.boot" (
   echo Using Custom Boot File "%RABBIT_EBIN%\rabbit.boot"
   set RABBITMQ_BOOT_FILE="%RABBIT_EBIN%\rabbit"
   set RABBITMQ_EBIN_PATH=
) else (
   set RABBITMQ_BOOT_FILE=start_sasl
   set RABBITMQ_EBIN_PATH=-pa "%RABBIT_EBIN%"
)

set ERLANG_SERVICE_ARGUMENTS= ^
%RABBITMQ_EBIN_PATH% ^
-boot %RABBITMQ_BOOT_FILE% ^
-s rabbit ^
+W w ^
+A30 ^

On Jan 11, 1:24?am, Matthias Radestock <matth... at lshift.net> wrote:
> Michael,
>
> mjustin wrote:
> > many thanks for the link. I understand that I have to create a new
> > configuration file on Windows and add the required parameters.
>
> > If I start RabbitMQ (on Ubuntu), the startup script (makefile) seems to pass
> > parameters and logs then to the console. I am not sure what the
> > configuration file should look like, I have only the output of the startup
> > [...]
> > I guess it is something like this:
>
> > ? [
> > ? ? {rabbit,
> > ? ?[{stomp_listeners [{"10.0.2.15",61613}]},
> > ? ? ?extra_startup_steps [{"STOMP-listeners", ? ? ?rabbit_stomp,kickstart}]}
> > ? ? ? ? ? ? ?]}
> > ? ].
>
> The above is syntactically invalid. It should be
>
> [{rabbit,
> ? ?[{stomp_listeners, [{"10.0.2.15",61613}]},
> ? ? {extra_startup_steps, [{"STOMP-listeners", rabbit_stomp,
> kickstart}]}]}].
>
> However, that's still not right for 1.7.0, since there we switched stomp
> to be a plug-in and the configuration mechanism changed accordingly.
> Now, as per the README in the rabbitmq-stomp hg repo, you should only need
>
> ? ?[{rabbit_stomp, [{listeners, [{"10.0.2.15",61613}]}]}].
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From matthias at lshift.net  Tue Jan 12 18:32:08 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 12 Jan 2010 18:32:08 +0000
Subject: [rabbitmq-discuss] RabbitMQ/Stomp on Windows
In-Reply-To: <cbca37e7-2894-4bbc-9364-1263d01ee742@j24g2000yqa.googlegroups.com>
References: <4B0E41CD.6020909@gmx.net> <4B13ABA1.7000806@lshift.net>
	<26813626.post@talk.nabble.com> <4B4AEE5F.2060708@lshift.net>
	<cbca37e7-2894-4bbc-9364-1263d01ee742@j24g2000yqa.googlegroups.com>
Message-ID: <4B4CC028.2080909@lshift.net>

Erik,

Erik Anderson wrote:
> I will state that I needed to make the following changes to my -
> service script in order for it to run the custom boot required to
> launch the plugin manager (or whatever it's doing behind the scenes)
> [...]

Right. Changes along those lines are already on the default branch and 
will be in the next release.


Matthias.



From chetna at rockmelt.com  Tue Jan 12 20:25:00 2010
From: chetna at rockmelt.com (Chetna Kaur)
Date: Tue, 12 Jan 2010 12:25:00 -0800
Subject: [rabbitmq-discuss] RabbitMQ xmpp gateway
In-Reply-To: <4B4CAE0C.8050209@lshift.net>
References: <27121792.post@talk.nabble.com> <4B4CAE0C.8050209@lshift.net>
Message-ID: <8517b1311001121225m4e5f9abco7ffc23df11269652@mail.gmail.com>

Hi Tony,

Thanks for your response. Yes, I've been using it for a proof of concept
implementation and it works great. Thanks for the great work :)

Some things that I'm concerned may be a problem in production:

1) The gateway doesn't handle loss of connection to the ejabberd server. I
can add code to handle this fairly easily I think.

2) Consumer Processes are not supervised ( I believe this may be on your
To-do list).
If I understand correctly, once a consumer process crashes the user
associated with the queue will no longer receive any data. This data would
continue to queue up at the server. Even if the user were to go offline and
come back online, because of an entry in rabbitmq_consumer_process with
queue and pid, a new process will not be created. Am I missing something
here?

What would be the best way to make these processes supervised?

Thanks again,
Chetna


On Tue, Jan 12, 2010 at 9:14 AM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> chetna kaur wrote:
> > I was wondering if there are any plans of releasing a production ready
> > version of the rabbitmq xmpp gateway.
>
> No, not at the moment. Or at least, the current gateway works well
> enough for us to use internally, and I'm told that a number of people
> are using it in production, so we don't have a lot of motivation to make
> changes to it :-)
>
> Regards,
>   Tony
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100112/ac1c2a77/attachment.htm 

From seemasbiradar at gmail.com  Wed Jan 13 09:17:29 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Wed, 13 Jan 2010 14:47:29 +0530
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
Message-ID: <558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>

Can you please let me know where can i download or get src for the Shove
pluggin.



On Tue, Jan 12, 2010 at 11:22 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Seema,
>
> I am not the best person to answer your question in full, but:  In
> addition to what Pradeep said, you need to be aware that Shovel is a
> RabbitMQ plugin.  The plugins are described here:
> http://www.rabbitmq.com/admin-guide.html#plugins
>
> The following talk describes a use case involving Shovel -
>
>
> http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost
>
> And Stefan's slides are here:
>
> http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301
>
> alexis
>
>
> On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
> <pradeep.gatram at gmail.com> wrote:
> > Seema,
> >
> > You dont have to interact with Shovel directly. Look at it this way
> >
> > p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
> >
> > p1 & c2 can be in any programming language. You just have to "configure"
> the
> > Shovel/amqp-relay appropriately.
> >
> > Pradeep
> >
> > On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar <seemasbiradar at gmail.com
> >
> > wrote:
> >>
> >> Hi,
> >> Thanks for the information.
> >>
> >> I need one more help .
> >>
> >> Can you please suggest me how can we use Shovel component and RabbitMQ
> >> using in JAVA Programming language.
> >>
> >> Using JAVA as programming language (RabbitMQ Java API), how can we make
> >> use of shovel component?
> >> (I am using RabbitMQ bundle for Windows )
> >>
> >> If any examples are there ( RabbitMQ Java API + Shovel Application )
> >> .please let me know.
> >>
> >> Thanksin adavance.
> >> Seema
> >>
> >>
> >>
> >> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
> >> <alexis.richardson at gmail.com> wrote:
> >>>
> >>> Seema
> >>>
> >>> We have a component called Shovel that does this.  Have a look at:
> >>>
> >>>
> >>>
> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq
> >>>
> >>> Also, some has created a 'relay' project on Github:
> >>> http://github.com/slider/amqp-relay
> >>>
> >>> Does this answer your question?
> >>>
> >>> alexis
> >>>
> >>>
> >>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar <
> seemasbiradar at gmail.com>
> >>> wrote:
> >>> > Hi
> >>> >
> >>> > My requirement is like this
> >>> >
> >>> > Two instance of RabbitMQ server are running at different IP.say
> assume
> >>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
> >>> > C2 is a cosumer of rabittmq2 R2 (which is running in another
> mechine),i
> >>> > Is it possible  the communication flow in the following manner,
> >>> > p1-->R1-->R2-->C2
> >>> >
> >>> > If there small example please mail me back
> >>> >
> >>> > Thanks in advance
> >>> > Seema
> >>> >
> >>> > _______________________________________________
> >>> > rabbitmq-discuss mailing list
> >>> > rabbitmq-discuss at lists.rabbitmq.com
> >>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>> >
> >>> >
> >>
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/d22af036/attachment.htm 

From alexis.richardson at gmail.com  Wed Jan 13 11:52:20 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 13 Jan 2010 11:52:20 +0000
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>
Message-ID: <167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>

Seema

I have just asked the team about this and learnt that Shovel was taken
offline for a few weeks pending our next server release.  This is
because we wanted to make some changes to the plugin to align with
server changes.  Would you mind waiting a few weeks?  If you need to
do something quickly, then please let us know.

Best wishes

alexis







On Wed, Jan 13, 2010 at 9:17 AM, Seema Biradar <seemasbiradar at gmail.com> wrote:
> Can you please let me know where can i download or get src for the Shove
> pluggin.
>
>
> On Tue, Jan 12, 2010 at 11:22 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Seema,
>>
>> I am not the best person to answer your question in full, but: ?In
>> addition to what Pradeep said, you need to be aware that Shovel is a
>> RabbitMQ plugin. ?The plugins are described here:
>> http://www.rabbitmq.com/admin-guide.html#plugins
>>
>> The following talk describes a use case involving Shovel -
>>
>>
>> http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost
>>
>> And Stefan's slides are here:
>>
>> http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301
>>
>> alexis
>>
>>
>> On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
>> <pradeep.gatram at gmail.com> wrote:
>> > Seema,
>> >
>> > You dont have to interact with Shovel directly. Look at it this way
>> >
>> > p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
>> >
>> > p1 & c2 can be in any programming language. You just have to "configure"
>> > the
>> > Shovel/amqp-relay appropriately.
>> >
>> > Pradeep
>> >
>> > On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar
>> > <seemasbiradar at gmail.com>
>> > wrote:
>> >>
>> >> Hi,
>> >> Thanks for the information.
>> >>
>> >> I need one more help .
>> >>
>> >> Can you please suggest me how can we use Shovel?component and RabbitMQ
>> >> using in JAVA Programming language.
>> >>
>> >> Using JAVA as programming language (RabbitMQ Java API), how can we make
>> >> use of shovel component?
>> >> (I am using RabbitMQ bundle for Windows )
>> >>
>> >> If any examples are there ( RabbitMQ Java API + Shovel Application )
>> >> .please let me know.
>> >>
>> >> Thanksin adavance.
>> >> Seema
>> >>
>> >>
>> >>
>> >> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
>> >> <alexis.richardson at gmail.com> wrote:
>> >>>
>> >>> Seema
>> >>>
>> >>> We have a component called Shovel that does this. ?Have a look at:
>> >>>
>> >>>
>> >>>
>> >>> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq
>> >>>
>> >>> Also, some has created a 'relay' project on Github:
>> >>> http://github.com/slider/amqp-relay
>> >>>
>> >>> Does this answer your question?
>> >>>
>> >>> alexis
>> >>>
>> >>>
>> >>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar
>> >>> <seemasbiradar at gmail.com>
>> >>> wrote:
>> >>> > Hi
>> >>> >
>> >>> > My requirement is like this
>> >>> >
>> >>> > Two instance of RabbitMQ server are running at different IP.say
>> >>> > assume
>> >>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
>> >>> > C2 is a cosumer of rabittmq2 R2 (which is running in another
>> >>> > mechine),i
>> >>> > Is it possible? the communication flow in the following manner,
>> >>> > p1-->R1-->R2-->C2
>> >>> >
>> >>> > If there small example please mail me back
>> >>> >
>> >>> > Thanks in advance
>> >>> > Seema
>> >>> >
>> >>> > _______________________________________________
>> >>> > rabbitmq-discuss mailing list
>> >>> > rabbitmq-discuss at lists.rabbitmq.com
>> >>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>> >
>> >>> >
>> >>
>> >>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>



From seemasbiradar at gmail.com  Wed Jan 13 12:09:49 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Wed, 13 Jan 2010 17:39:49 +0530
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>
	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>
Message-ID: <558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com>

Ok Thanks for the information!

Please let me know when the next release is? and
The link from where we can download the same ?

Thanks again!
Regards
Seema



On Wed, Jan 13, 2010 at 5:22 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Seema
>
> I have just asked the team about this and learnt that Shovel was taken
> offline for a few weeks pending our next server release.  This is
> because we wanted to make some changes to the plugin to align with
> server changes.  Would you mind waiting a few weeks?  If you need to
> do something quickly, then please let us know.
>
> Best wishes
>
> alexis
>
>
>
>
>
>
>
> On Wed, Jan 13, 2010 at 9:17 AM, Seema Biradar <seemasbiradar at gmail.com>
> wrote:
> > Can you please let me know where can i download or get src for the Shove
> > pluggin.
> >
> >
> > On Tue, Jan 12, 2010 at 11:22 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Seema,
> >>
> >> I am not the best person to answer your question in full, but:  In
> >> addition to what Pradeep said, you need to be aware that Shovel is a
> >> RabbitMQ plugin.  The plugins are described here:
> >> http://www.rabbitmq.com/admin-guide.html#plugins
> >>
> >> The following talk describes a use case involving Shovel -
> >>
> >>
> >>
> http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost
> >>
> >> And Stefan's slides are here:
> >>
> >> http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301
> >>
> >> alexis
> >>
> >>
> >> On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
> >> <pradeep.gatram at gmail.com> wrote:
> >> > Seema,
> >> >
> >> > You dont have to interact with Shovel directly. Look at it this way
> >> >
> >> > p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
> >> >
> >> > p1 & c2 can be in any programming language. You just have to
> "configure"
> >> > the
> >> > Shovel/amqp-relay appropriately.
> >> >
> >> > Pradeep
> >> >
> >> > On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar
> >> > <seemasbiradar at gmail.com>
> >> > wrote:
> >> >>
> >> >> Hi,
> >> >> Thanks for the information.
> >> >>
> >> >> I need one more help .
> >> >>
> >> >> Can you please suggest me how can we use Shovel component and
> RabbitMQ
> >> >> using in JAVA Programming language.
> >> >>
> >> >> Using JAVA as programming language (RabbitMQ Java API), how can we
> make
> >> >> use of shovel component?
> >> >> (I am using RabbitMQ bundle for Windows )
> >> >>
> >> >> If any examples are there ( RabbitMQ Java API + Shovel Application )
> >> >> .please let me know.
> >> >>
> >> >> Thanksin adavance.
> >> >> Seema
> >> >>
> >> >>
> >> >>
> >> >> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
> >> >> <alexis.richardson at gmail.com> wrote:
> >> >>>
> >> >>> Seema
> >> >>>
> >> >>> We have a component called Shovel that does this.  Have a look at:
> >> >>>
> >> >>>
> >> >>>
> >> >>>
> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq
> >> >>>
> >> >>> Also, some has created a 'relay' project on Github:
> >> >>> http://github.com/slider/amqp-relay
> >> >>>
> >> >>> Does this answer your question?
> >> >>>
> >> >>> alexis
> >> >>>
> >> >>>
> >> >>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar
> >> >>> <seemasbiradar at gmail.com>
> >> >>> wrote:
> >> >>> > Hi
> >> >>> >
> >> >>> > My requirement is like this
> >> >>> >
> >> >>> > Two instance of RabbitMQ server are running at different IP.say
> >> >>> > assume
> >> >>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
> >> >>> > C2 is a cosumer of rabittmq2 R2 (which is running in another
> >> >>> > mechine),i
> >> >>> > Is it possible  the communication flow in the following manner,
> >> >>> > p1-->R1-->R2-->C2
> >> >>> >
> >> >>> > If there small example please mail me back
> >> >>> >
> >> >>> > Thanks in advance
> >> >>> > Seema
> >> >>> >
> >> >>> > _______________________________________________
> >> >>> > rabbitmq-discuss mailing list
> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
> >> >>> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >>> >
> >> >>> >
> >> >>
> >> >>
> >> >> _______________________________________________
> >> >> rabbitmq-discuss mailing list
> >> >> rabbitmq-discuss at lists.rabbitmq.com
> >> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >>
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/57656a31/attachment.htm 

From alexis.richardson at gmail.com  Wed Jan 13 12:12:00 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 13 Jan 2010 12:12:00 +0000
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>
	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>
	<558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com>
Message-ID: <167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com>

Seema

It's been imminent for some time - QA in underway currently.  We hit
the usual slowdowns due to the holiday season.

We'll be sure to let you know.

alexis


On Wed, Jan 13, 2010 at 12:09 PM, Seema Biradar <seemasbiradar at gmail.com> wrote:
> Ok Thanks for the information!
>
> Please let me know when the next release is? and
> The link from where we can download the same ?
>
> Thanks again!
> Regards
> Seema
>
>
> On Wed, Jan 13, 2010 at 5:22 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Seema
>>
>> I have just asked the team about this and learnt that Shovel was taken
>> offline for a few weeks pending our next server release. ?This is
>> because we wanted to make some changes to the plugin to align with
>> server changes. ?Would you mind waiting a few weeks? ?If you need to
>> do something quickly, then please let us know.
>>
>> Best wishes
>>
>> alexis
>>
>>
>>
>>
>>
>>
>>
>> On Wed, Jan 13, 2010 at 9:17 AM, Seema Biradar <seemasbiradar at gmail.com>
>> wrote:
>> > Can you please let me know where can i download or get src for the Shove
>> > pluggin.
>> >
>> >
>> > On Tue, Jan 12, 2010 at 11:22 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Seema,
>> >>
>> >> I am not the best person to answer your question in full, but: ?In
>> >> addition to what Pradeep said, you need to be aware that Shovel is a
>> >> RabbitMQ plugin. ?The plugins are described here:
>> >> http://www.rabbitmq.com/admin-guide.html#plugins
>> >>
>> >> The following talk describes a use case involving Shovel -
>> >>
>> >>
>> >>
>> >> http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost
>> >>
>> >> And Stefan's slides are here:
>> >>
>> >> http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301
>> >>
>> >> alexis
>> >>
>> >>
>> >> On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
>> >> <pradeep.gatram at gmail.com> wrote:
>> >> > Seema,
>> >> >
>> >> > You dont have to interact with Shovel directly. Look at it this way
>> >> >
>> >> > p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
>> >> >
>> >> > p1 & c2 can be in any programming language. You just have to
>> >> > "configure"
>> >> > the
>> >> > Shovel/amqp-relay appropriately.
>> >> >
>> >> > Pradeep
>> >> >
>> >> > On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar
>> >> > <seemasbiradar at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> Hi,
>> >> >> Thanks for the information.
>> >> >>
>> >> >> I need one more help .
>> >> >>
>> >> >> Can you please suggest me how can we use Shovel?component and
>> >> >> RabbitMQ
>> >> >> using in JAVA Programming language.
>> >> >>
>> >> >> Using JAVA as programming language (RabbitMQ Java API), how can we
>> >> >> make
>> >> >> use of shovel component?
>> >> >> (I am using RabbitMQ bundle for Windows )
>> >> >>
>> >> >> If any examples are there ( RabbitMQ Java API + Shovel Application )
>> >> >> .please let me know.
>> >> >>
>> >> >> Thanksin adavance.
>> >> >> Seema
>> >> >>
>> >> >>
>> >> >>
>> >> >> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
>> >> >> <alexis.richardson at gmail.com> wrote:
>> >> >>>
>> >> >>> Seema
>> >> >>>
>> >> >>> We have a component called Shovel that does this. ?Have a look at:
>> >> >>>
>> >> >>>
>> >> >>>
>> >> >>>
>> >> >>> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq
>> >> >>>
>> >> >>> Also, some has created a 'relay' project on Github:
>> >> >>> http://github.com/slider/amqp-relay
>> >> >>>
>> >> >>> Does this answer your question?
>> >> >>>
>> >> >>> alexis
>> >> >>>
>> >> >>>
>> >> >>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar
>> >> >>> <seemasbiradar at gmail.com>
>> >> >>> wrote:
>> >> >>> > Hi
>> >> >>> >
>> >> >>> > My requirement is like this
>> >> >>> >
>> >> >>> > Two instance of RabbitMQ server are running at different IP.say
>> >> >>> > assume
>> >> >>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
>> >> >>> > C2 is a cosumer of rabittmq2 R2 (which is running in another
>> >> >>> > mechine),i
>> >> >>> > Is it possible? the communication flow in the following manner,
>> >> >>> > p1-->R1-->R2-->C2
>> >> >>> >
>> >> >>> > If there small example please mail me back
>> >> >>> >
>> >> >>> > Thanks in advance
>> >> >>> > Seema
>> >> >>> >
>> >> >>> > _______________________________________________
>> >> >>> > rabbitmq-discuss mailing list
>> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >>> >
>> >> >>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >>> >
>> >> >>> >
>> >> >>
>> >> >>
>> >> >> _______________________________________________
>> >> >> rabbitmq-discuss mailing list
>> >> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >>
>> >> >
>> >> >
>> >> > _______________________________________________
>> >> > rabbitmq-discuss mailing list
>> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >
>> >> >
>> >
>> >
>
>



From pradeep.gatram at gmail.com  Wed Jan 13 12:48:52 2010
From: pradeep.gatram at gmail.com (Pradeep Gatram)
Date: Wed, 13 Jan 2010 18:18:52 +0530
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com> 
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com> 
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com> 
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com> 
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com> 
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com> 
	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com> 
	<558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com> 
	<167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com>
Message-ID: <9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com>

Here is a quick n dirty amqp replicator that we've been using for a while.
Modified it a bit to remove some project specific stuff. You may use it
while you wait for the new release.

Ruby code:

require 'rubygems'
require 'mq'

EM.run do
  def replicate source, destination, topic
    source_q = MQ::Queue.new(source, "replicator for #{topic}")
    source_q.bind(MQ::Exchange.new(source, :topic, topic))
    destination_ex = MQ::Exchange.new(destination, :topic, topic)

    source_q.subscribe do |headers, msg|
      destination_ex.publish(msg)
    end
  end

  local, remote = %w{one two}, %w{three}
  localhost, remotehost = 'localhost', '192.168.0.26'

  local_channel = MQ.new(AMQP.connect(:host => localhost, :logging =>
false))
  remote_channel = MQ.new(AMQP.connect(:host => remotehost, :logging =>
false))

  local.each  { |t| replicate local_channel, remote_channel, t }
  remote.each { |t| replicate remote_channel, local_channel, t }
end


Regards,
Pradeep


On Wed, Jan 13, 2010 at 5:42 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Seema
>
> It's been imminent for some time - QA in underway currently.  We hit
> the usual slowdowns due to the holiday season.
>
> We'll be sure to let you know.
>
> alexis
>
>
> On Wed, Jan 13, 2010 at 12:09 PM, Seema Biradar <seemasbiradar at gmail.com>
> wrote:
> > Ok Thanks for the information!
> >
> > Please let me know when the next release is? and
> > The link from where we can download the same ?
> >
> > Thanks again!
> > Regards
> > Seema
> >
> >
> > On Wed, Jan 13, 2010 at 5:22 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Seema
> >>
> >> I have just asked the team about this and learnt that Shovel was taken
> >> offline for a few weeks pending our next server release.  This is
> >> because we wanted to make some changes to the plugin to align with
> >> server changes.  Would you mind waiting a few weeks?  If you need to
> >> do something quickly, then please let us know.
> >>
> >> Best wishes
> >>
> >> alexis
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >> On Wed, Jan 13, 2010 at 9:17 AM, Seema Biradar <seemasbiradar at gmail.com
> >
> >> wrote:
> >> > Can you please let me know where can i download or get src for the
> Shove
> >> > pluggin.
> >> >
> >> >
> >> > On Tue, Jan 12, 2010 at 11:22 PM, Alexis Richardson
> >> > <alexis.richardson at gmail.com> wrote:
> >> >>
> >> >> Seema,
> >> >>
> >> >> I am not the best person to answer your question in full, but:  In
> >> >> addition to what Pradeep said, you need to be aware that Shovel is a
> >> >> RabbitMQ plugin.  The plugins are described here:
> >> >> http://www.rabbitmq.com/admin-guide.html#plugins
> >> >>
> >> >> The following talk describes a use case involving Shovel -
> >> >>
> >> >>
> >> >>
> >> >>
> http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost
> >> >>
> >> >> And Stefan's slides are here:
> >> >>
> >> >> http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301
> >> >>
> >> >> alexis
> >> >>
> >> >>
> >> >> On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
> >> >> <pradeep.gatram at gmail.com> wrote:
> >> >> > Seema,
> >> >> >
> >> >> > You dont have to interact with Shovel directly. Look at it this way
> >> >> >
> >> >> > p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
> >> >> >
> >> >> > p1 & c2 can be in any programming language. You just have to
> >> >> > "configure"
> >> >> > the
> >> >> > Shovel/amqp-relay appropriately.
> >> >> >
> >> >> > Pradeep
> >> >> >
> >> >> > On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar
> >> >> > <seemasbiradar at gmail.com>
> >> >> > wrote:
> >> >> >>
> >> >> >> Hi,
> >> >> >> Thanks for the information.
> >> >> >>
> >> >> >> I need one more help .
> >> >> >>
> >> >> >> Can you please suggest me how can we use Shovel component and
> >> >> >> RabbitMQ
> >> >> >> using in JAVA Programming language.
> >> >> >>
> >> >> >> Using JAVA as programming language (RabbitMQ Java API), how can we
> >> >> >> make
> >> >> >> use of shovel component?
> >> >> >> (I am using RabbitMQ bundle for Windows )
> >> >> >>
> >> >> >> If any examples are there ( RabbitMQ Java API + Shovel Application
> )
> >> >> >> .please let me know.
> >> >> >>
> >> >> >> Thanksin adavance.
> >> >> >> Seema
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
> >> >> >> <alexis.richardson at gmail.com> wrote:
> >> >> >>>
> >> >> >>> Seema
> >> >> >>>
> >> >> >>> We have a component called Shovel that does this.  Have a look
> at:
> >> >> >>>
> >> >> >>>
> >> >> >>>
> >> >> >>>
> >> >> >>>
> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq<http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=%21009922129631189805192%3Akpd1zoym_hq>
> >> >> >>>
> >> >> >>> Also, some has created a 'relay' project on Github:
> >> >> >>> http://github.com/slider/amqp-relay
> >> >> >>>
> >> >> >>> Does this answer your question?
> >> >> >>>
> >> >> >>> alexis
> >> >> >>>
> >> >> >>>
> >> >> >>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar
> >> >> >>> <seemasbiradar at gmail.com>
> >> >> >>> wrote:
> >> >> >>> > Hi
> >> >> >>> >
> >> >> >>> > My requirement is like this
> >> >> >>> >
> >> >> >>> > Two instance of RabbitMQ server are running at different IP.say
> >> >> >>> > assume
> >> >> >>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
> >> >> >>> > C2 is a cosumer of rabittmq2 R2 (which is running in another
> >> >> >>> > mechine),i
> >> >> >>> > Is it possible  the communication flow in the following manner,
> >> >> >>> > p1-->R1-->R2-->C2
> >> >> >>> >
> >> >> >>> > If there small example please mail me back
> >> >> >>> >
> >> >> >>> > Thanks in advance
> >> >> >>> > Seema
> >> >> >>> >
> >> >> >>> > _______________________________________________
> >> >> >>> > rabbitmq-discuss mailing list
> >> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >>> >
> >> >> >>> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >>> >
> >> >> >>> >
> >> >> >>
> >> >> >>
> >> >> >> _______________________________________________
> >> >> >> rabbitmq-discuss mailing list
> >> >> >> rabbitmq-discuss at lists.rabbitmq.com
> >> >> >>
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >>
> >> >> >
> >> >> >
> >> >> > _______________________________________________
> >> >> > rabbitmq-discuss mailing list
> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >
> >> >> >
> >> >
> >> >
> >
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/636f83f4/attachment.htm 

From alexis.richardson at gmail.com  Wed Jan 13 13:17:16 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 13 Jan 2010 13:17:16 +0000
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>
	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>
	<558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com>
	<167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com>
	<9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com>
Message-ID: <167204d21001130517m4e92c85bub09a6b70b294f523@mail.gmail.com>

Thanks Pradeep!  Would you mind posting that on github as a gist?  I
would love to link to it from our links repository.

Here is something similar in Scala:

http://github.com/slider/amqp-relay

a


On Wed, Jan 13, 2010 at 12:48 PM, Pradeep Gatram
<pradeep.gatram at gmail.com> wrote:
> Here is a quick n dirty amqp replicator that we've been using for a while.
> Modified it a bit to remove some project specific stuff. You may use it
> while you wait for the new release.
>
> Ruby code:
>
> require 'rubygems'
> require 'mq'
>
> EM.run do
> ? def replicate source, destination, topic
> ??? source_q = MQ::Queue.new(source, "replicator for #{topic}")
> ??? source_q.bind(MQ::Exchange.new(source, :topic, topic))
> ??? destination_ex = MQ::Exchange.new(destination, :topic, topic)
>
> ??? source_q.subscribe do |headers, msg|
> ????? destination_ex.publish(msg)
> ??? end
> ? end
>
> ? local, remote = %w{one two}, %w{three}
> ? localhost, remotehost = 'localhost', '192.168.0.26'
>
> ? local_channel = MQ.new(AMQP.connect(:host => localhost, :logging =>
> false))
> ? remote_channel = MQ.new(AMQP.connect(:host => remotehost, :logging =>
> false))
>
> ? local.each? { |t| replicate local_channel, remote_channel, t }
> ? remote.each { |t| replicate remote_channel, local_channel, t }
> end
>
>
> Regards,
> Pradeep
>
>
> On Wed, Jan 13, 2010 at 5:42 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Seema
>>
>> It's been imminent for some time - QA in underway currently. ?We hit
>> the usual slowdowns due to the holiday season.
>>
>> We'll be sure to let you know.
>>
>> alexis
>>
>>
>> On Wed, Jan 13, 2010 at 12:09 PM, Seema Biradar <seemasbiradar at gmail.com>
>> wrote:
>> > Ok Thanks for the information!
>> >
>> > Please let me know when the next release is? and
>> > The link from where we can download the same ?
>> >
>> > Thanks again!
>> > Regards
>> > Seema
>> >
>> >
>> > On Wed, Jan 13, 2010 at 5:22 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Seema
>> >>
>> >> I have just asked the team about this and learnt that Shovel was taken
>> >> offline for a few weeks pending our next server release. ?This is
>> >> because we wanted to make some changes to the plugin to align with
>> >> server changes. ?Would you mind waiting a few weeks? ?If you need to
>> >> do something quickly, then please let us know.
>> >>
>> >> Best wishes
>> >>
>> >> alexis
>> >>
>> >>
>> >>
>> >>
>> >>
>> >>
>> >>
>> >> On Wed, Jan 13, 2010 at 9:17 AM, Seema Biradar
>> >> <seemasbiradar at gmail.com>
>> >> wrote:
>> >> > Can you please let me know where can i download or get src for the
>> >> > Shove
>> >> > pluggin.
>> >> >
>> >> >
>> >> > On Tue, Jan 12, 2010 at 11:22 PM, Alexis Richardson
>> >> > <alexis.richardson at gmail.com> wrote:
>> >> >>
>> >> >> Seema,
>> >> >>
>> >> >> I am not the best person to answer your question in full, but: ?In
>> >> >> addition to what Pradeep said, you need to be aware that Shovel is a
>> >> >> RabbitMQ plugin. ?The plugins are described here:
>> >> >> http://www.rabbitmq.com/admin-guide.html#plugins
>> >> >>
>> >> >> The following talk describes a use case involving Shovel -
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >> http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost
>> >> >>
>> >> >> And Stefan's slides are here:
>> >> >>
>> >> >> http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301
>> >> >>
>> >> >> alexis
>> >> >>
>> >> >>
>> >> >> On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
>> >> >> <pradeep.gatram at gmail.com> wrote:
>> >> >> > Seema,
>> >> >> >
>> >> >> > You dont have to interact with Shovel directly. Look at it this
>> >> >> > way
>> >> >> >
>> >> >> > p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
>> >> >> >
>> >> >> > p1 & c2 can be in any programming language. You just have to
>> >> >> > "configure"
>> >> >> > the
>> >> >> > Shovel/amqp-relay appropriately.
>> >> >> >
>> >> >> > Pradeep
>> >> >> >
>> >> >> > On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar
>> >> >> > <seemasbiradar at gmail.com>
>> >> >> > wrote:
>> >> >> >>
>> >> >> >> Hi,
>> >> >> >> Thanks for the information.
>> >> >> >>
>> >> >> >> I need one more help .
>> >> >> >>
>> >> >> >> Can you please suggest me how can we use Shovel?component and
>> >> >> >> RabbitMQ
>> >> >> >> using in JAVA Programming language.
>> >> >> >>
>> >> >> >> Using JAVA as programming language (RabbitMQ Java API), how can
>> >> >> >> we
>> >> >> >> make
>> >> >> >> use of shovel component?
>> >> >> >> (I am using RabbitMQ bundle for Windows )
>> >> >> >>
>> >> >> >> If any examples are there ( RabbitMQ Java API + Shovel
>> >> >> >> Application )
>> >> >> >> .please let me know.
>> >> >> >>
>> >> >> >> Thanksin adavance.
>> >> >> >> Seema
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
>> >> >> >> <alexis.richardson at gmail.com> wrote:
>> >> >> >>>
>> >> >> >>> Seema
>> >> >> >>>
>> >> >> >>> We have a component called Shovel that does this. ?Have a look
>> >> >> >>> at:
>> >> >> >>>
>> >> >> >>>
>> >> >> >>>
>> >> >> >>>
>> >> >> >>>
>> >> >> >>> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq
>> >> >> >>>
>> >> >> >>> Also, some has created a 'relay' project on Github:
>> >> >> >>> http://github.com/slider/amqp-relay
>> >> >> >>>
>> >> >> >>> Does this answer your question?
>> >> >> >>>
>> >> >> >>> alexis
>> >> >> >>>
>> >> >> >>>
>> >> >> >>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar
>> >> >> >>> <seemasbiradar at gmail.com>
>> >> >> >>> wrote:
>> >> >> >>> > Hi
>> >> >> >>> >
>> >> >> >>> > My requirement is like this
>> >> >> >>> >
>> >> >> >>> > Two instance of RabbitMQ server are running at different
>> >> >> >>> > IP.say
>> >> >> >>> > assume
>> >> >> >>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
>> >> >> >>> > C2 is a cosumer of rabittmq2 R2 (which is running in another
>> >> >> >>> > mechine),i
>> >> >> >>> > Is it possible? the communication flow in the following
>> >> >> >>> > manner,
>> >> >> >>> > p1-->R1-->R2-->C2
>> >> >> >>> >
>> >> >> >>> > If there small example please mail me back
>> >> >> >>> >
>> >> >> >>> > Thanks in advance
>> >> >> >>> > Seema
>> >> >> >>> >
>> >> >> >>> > _______________________________________________
>> >> >> >>> > rabbitmq-discuss mailing list
>> >> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >>> >
>> >> >> >>> >
>> >> >> >>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >>> >
>> >> >> >>> >
>> >> >> >>
>> >> >> >>
>> >> >> >> _______________________________________________
>> >> >> >> rabbitmq-discuss mailing list
>> >> >> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >>
>> >> >> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >>
>> >> >> >
>> >> >> >
>> >> >> > _______________________________________________
>> >> >> > rabbitmq-discuss mailing list
>> >> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >
>> >> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >
>> >
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From pradeep.gatram at gmail.com  Wed Jan 13 13:52:54 2010
From: pradeep.gatram at gmail.com (Pradeep Gatram)
Date: Wed, 13 Jan 2010 19:22:54 +0530
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <167204d21001130517m4e92c85bub09a6b70b294f523@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com> 
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com> 
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com> 
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com> 
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com> 
	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com> 
	<558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com> 
	<167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com> 
	<9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com> 
	<167204d21001130517m4e92c85bub09a6b70b294f523@mail.gmail.com>
Message-ID: <9a2d8f781001130552k1cbd118arfc49a35c8ec9fd5a@mail.gmail.com>

Alexis,

I've uploaded the gist at http://gist.github.com/276195

Pradeep
www.masplantiz.com

On Wed, Jan 13, 2010 at 6:47 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Thanks Pradeep!  Would you mind posting that on github as a gist?  I
> would love to link to it from our links repository.
>
> Here is something similar in Scala:
>
> http://github.com/slider/amqp-relay
>
> a
>
>
> On Wed, Jan 13, 2010 at 12:48 PM, Pradeep Gatram
> <pradeep.gatram at gmail.com> wrote:
> > Here is a quick n dirty amqp replicator that we've been using for a
> while.
> > Modified it a bit to remove some project specific stuff. You may use it
> > while you wait for the new release.
> >
> > Ruby code:
> >
> > require 'rubygems'
> > require 'mq'
> >
> > EM.run do
> >   def replicate source, destination, topic
> >     source_q = MQ::Queue.new(source, "replicator for #{topic}")
> >     source_q.bind(MQ::Exchange.new(source, :topic, topic))
> >     destination_ex = MQ::Exchange.new(destination, :topic, topic)
> >
> >     source_q.subscribe do |headers, msg|
> >       destination_ex.publish(msg)
> >     end
> >   end
> >
> >   local, remote = %w{one two}, %w{three}
> >   localhost, remotehost = 'localhost', '192.168.0.26'
> >
> >   local_channel = MQ.new(AMQP.connect(:host => localhost, :logging =>
> > false))
> >   remote_channel = MQ.new(AMQP.connect(:host => remotehost, :logging =>
> > false))
> >
> >   local.each  { |t| replicate local_channel, remote_channel, t }
> >   remote.each { |t| replicate remote_channel, local_channel, t }
> > end
> >
> >
> > Regards,
> > Pradeep
> >
> >
> > On Wed, Jan 13, 2010 at 5:42 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Seema
> >>
> >> It's been imminent for some time - QA in underway currently.  We hit
> >> the usual slowdowns due to the holiday season.
> >>
> >> We'll be sure to let you know.
> >>
> >> alexis
> >>
> >>
> >> On Wed, Jan 13, 2010 at 12:09 PM, Seema Biradar <
> seemasbiradar at gmail.com>
> >> wrote:
> >> > Ok Thanks for the information!
> >> >
> >> > Please let me know when the next release is? and
> >> > The link from where we can download the same ?
> >> >
> >> > Thanks again!
> >> > Regards
> >> > Seema
> >> >
> >> >
> >> > On Wed, Jan 13, 2010 at 5:22 PM, Alexis Richardson
> >> > <alexis.richardson at gmail.com> wrote:
> >> >>
> >> >> Seema
> >> >>
> >> >> I have just asked the team about this and learnt that Shovel was
> taken
> >> >> offline for a few weeks pending our next server release.  This is
> >> >> because we wanted to make some changes to the plugin to align with
> >> >> server changes.  Would you mind waiting a few weeks?  If you need to
> >> >> do something quickly, then please let us know.
> >> >>
> >> >> Best wishes
> >> >>
> >> >> alexis
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >> On Wed, Jan 13, 2010 at 9:17 AM, Seema Biradar
> >> >> <seemasbiradar at gmail.com>
> >> >> wrote:
> >> >> > Can you please let me know where can i download or get src for the
> >> >> > Shove
> >> >> > pluggin.
> >> >> >
> >> >> >
> >> >> > On Tue, Jan 12, 2010 at 11:22 PM, Alexis Richardson
> >> >> > <alexis.richardson at gmail.com> wrote:
> >> >> >>
> >> >> >> Seema,
> >> >> >>
> >> >> >> I am not the best person to answer your question in full, but:  In
> >> >> >> addition to what Pradeep said, you need to be aware that Shovel is
> a
> >> >> >> RabbitMQ plugin.  The plugins are described here:
> >> >> >> http://www.rabbitmq.com/admin-guide.html#plugins
> >> >> >>
> >> >> >> The following talk describes a use case involving Shovel -
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>
> http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost
> >> >> >>
> >> >> >> And Stefan's slides are here:
> >> >> >>
> >> >> >> http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301
> >> >> >>
> >> >> >> alexis
> >> >> >>
> >> >> >>
> >> >> >> On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
> >> >> >> <pradeep.gatram at gmail.com> wrote:
> >> >> >> > Seema,
> >> >> >> >
> >> >> >> > You dont have to interact with Shovel directly. Look at it this
> >> >> >> > way
> >> >> >> >
> >> >> >> > p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
> >> >> >> >
> >> >> >> > p1 & c2 can be in any programming language. You just have to
> >> >> >> > "configure"
> >> >> >> > the
> >> >> >> > Shovel/amqp-relay appropriately.
> >> >> >> >
> >> >> >> > Pradeep
> >> >> >> >
> >> >> >> > On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar
> >> >> >> > <seemasbiradar at gmail.com>
> >> >> >> > wrote:
> >> >> >> >>
> >> >> >> >> Hi,
> >> >> >> >> Thanks for the information.
> >> >> >> >>
> >> >> >> >> I need one more help .
> >> >> >> >>
> >> >> >> >> Can you please suggest me how can we use Shovel component and
> >> >> >> >> RabbitMQ
> >> >> >> >> using in JAVA Programming language.
> >> >> >> >>
> >> >> >> >> Using JAVA as programming language (RabbitMQ Java API), how can
> >> >> >> >> we
> >> >> >> >> make
> >> >> >> >> use of shovel component?
> >> >> >> >> (I am using RabbitMQ bundle for Windows )
> >> >> >> >>
> >> >> >> >> If any examples are there ( RabbitMQ Java API + Shovel
> >> >> >> >> Application )
> >> >> >> >> .please let me know.
> >> >> >> >>
> >> >> >> >> Thanksin adavance.
> >> >> >> >> Seema
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
> >> >> >> >> <alexis.richardson at gmail.com> wrote:
> >> >> >> >>>
> >> >> >> >>> Seema
> >> >> >> >>>
> >> >> >> >>> We have a component called Shovel that does this.  Have a look
> >> >> >> >>> at:
> >> >> >> >>>
> >> >> >> >>>
> >> >> >> >>>
> >> >> >> >>>
> >> >> >> >>>
> >> >> >> >>>
> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq<http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=%21009922129631189805192%3Akpd1zoym_hq>
> >> >> >> >>>
> >> >> >> >>> Also, some has created a 'relay' project on Github:
> >> >> >> >>> http://github.com/slider/amqp-relay
> >> >> >> >>>
> >> >> >> >>> Does this answer your question?
> >> >> >> >>>
> >> >> >> >>> alexis
> >> >> >> >>>
> >> >> >> >>>
> >> >> >> >>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar
> >> >> >> >>> <seemasbiradar at gmail.com>
> >> >> >> >>> wrote:
> >> >> >> >>> > Hi
> >> >> >> >>> >
> >> >> >> >>> > My requirement is like this
> >> >> >> >>> >
> >> >> >> >>> > Two instance of RabbitMQ server are running at different
> >> >> >> >>> > IP.say
> >> >> >> >>> > assume
> >> >> >> >>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
> >> >> >> >>> > C2 is a cosumer of rabittmq2 R2 (which is running in another
> >> >> >> >>> > mechine),i
> >> >> >> >>> > Is it possible  the communication flow in the following
> >> >> >> >>> > manner,
> >> >> >> >>> > p1-->R1-->R2-->C2
> >> >> >> >>> >
> >> >> >> >>> > If there small example please mail me back
> >> >> >> >>> >
> >> >> >> >>> > Thanks in advance
> >> >> >> >>> > Seema
> >> >> >> >>> >
> >> >> >> >>> > _______________________________________________
> >> >> >> >>> > rabbitmq-discuss mailing list
> >> >> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >> >>> >
> >> >> >> >>> >
> >> >> >> >>> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >> >>> >
> >> >> >> >>> >
> >> >> >> >>
> >> >> >> >>
> >> >> >> >> _______________________________________________
> >> >> >> >> rabbitmq-discuss mailing list
> >> >> >> >> rabbitmq-discuss at lists.rabbitmq.com
> >> >> >> >>
> >> >> >> >>
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >> >>
> >> >> >> >
> >> >> >> >
> >> >> >> > _______________________________________________
> >> >> >> > rabbitmq-discuss mailing list
> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >> >
> >> >> >> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >> >
> >> >> >> >
> >> >> >
> >> >> >
> >> >
> >> >
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/84a6712f/attachment.htm 

From scottblanc at gmail.com  Wed Jan 13 17:52:11 2010
From: scottblanc at gmail.com (scott w)
Date: Wed, 13 Jan 2010 09:52:11 -0800
Subject: [rabbitmq-discuss] Page to disk feature
Message-ID: <401b577e1001130952r3219e99eg3f3351985538715f@mail.gmail.com>

What is the status of the "page to disk" feature that will ensure the node
doesn't crash when the message exceed memory capacity? I realize it's not in
a stable release yet but is there a stable fix for it yet and if so what
patch do I need to download?

thanks,
Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/bff07fd2/attachment.htm 

From Peter.Townsend at mflow.com  Wed Jan 13 17:55:34 2010
From: Peter.Townsend at mflow.com (Peter Townsend)
Date: Wed, 13 Jan 2010 17:55:34 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
Message-ID: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>

Hi all,

I'm using the .NET client running against a windows installation of the RabbitMQ broker. I have found that calls to IModel.BasicGet(...) will hang after process a number of message. The number of messages processed before it hangs changes with each run.

I refactored to use a BasicConsume approach and I find a similar issue, the consumer stops receiving messages after a number have been processed and there are still remaining message in the queue. Has anyone had a similar experience with the .NET client API?

I'm out of ideas :) The consumer class (including channel setup) I'm using is attached (using direct exchange to a named, durable, queue).

Thanks
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/99d1a52e/attachment.htm 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: MessageConsumer.cs
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/99d1a52e/attachment.txt 

From matthias at lshift.net  Wed Jan 13 18:02:19 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 13 Jan 2010 18:02:19 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
Message-ID: <4B4E0AAB.7060805@lshift.net>

Peter,

Peter Townsend wrote:
> I?m using the .NET client running against a windows installation of the 
> RabbitMQ broker. I have found that calls to IModel.BasicGet(...) will 
> hang after process a number of message. The number of messages processed 
> before it hangs changes with each run.

When it hangs, please take a thread dump and post it here.

> I refactored to use a BasicConsume approach

It will probably be easier to debug this by sticking to BasicGet.


Regards,

Matthias.



From jdunck at gmail.com  Wed Jan 13 18:08:08 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 13 Jan 2010 12:08:08 -0600
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
Message-ID: <2545a92c1001131008x59dd6d99kfdcec7868a6ca935@mail.gmail.com>

On Wed, Jan 13, 2010 at 11:55 AM, Peter Townsend
<Peter.Townsend at mflow.com> wrote:
> Hi all,
>
>
>
> I?m using the .NET client running against a windows installation of the
> RabbitMQ broker. I have found that calls to IModel.BasicGet(...) will hang
> after process a number of message. The number of messages processed before
> it hangs changes with each run.

What's "a number"?  Is it consistent?



From irrer at umich.edu  Wed Jan 13 19:06:57 2010
From: irrer at umich.edu (Jim Irrer)
Date: Wed, 13 Jan 2010 14:06:57 -0500
Subject: [rabbitmq-discuss] suspending and resuming a QueueingConsumer
Message-ID: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>

Hi -

I have several consumers reading from the same queue.  I would like
to be able to interrupt their pending read to suspend and resume any
one of them.   I've played around with:

Channel.basicCancel(consumerTag) : don't know how to resume
Channel.abort()    produces com.rabbitmq.client.ShutdownSignalException
Channel.close()   produces com.rabbitmq.client.ShutdownSignalException

The close() and abort() methods seem to act about the same.  I can resume
reading from the queue by creating a new channel and a new QueueingConsumer.
I could not figure out how to resume after a basicCancel.

Is using close() and then re-constructing the channel and QueueingConsumer
the right way to go?  Will resources be properly taken care of by garbage
collection?

BTW - I use the consumerTag returned by Channel.basicConsume(queueName,
consumer)
for the argument to Channel.basicCancel, eg: *
amq.ctag-1m/H7+SDcZpbzTMgsUyhNg==* .
When called, it prints:

Consumer null method handleCancelOk for channel AMQChannel(amqp://
guest at 172.20.125.34:5672/,1) threw an exception:
java.lang.NullPointerException
    at com.rabbitmq.client.impl.ChannelN$2.transformReply(ChannelN.java:728)
    at com.rabbitmq.client.impl.ChannelN$2.transformReply(ChannelN.java:721)
    at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.handleCommand(AMQChannel.java:327)
    at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:162)
    at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
    at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:456)

Thanks for any hints,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/bc92bfc8/attachment.htm 

From Peter.Townsend at mflow.com  Wed Jan 13 19:07:52 2010
From: Peter.Townsend at mflow.com (Peter Townsend)
Date: Wed, 13 Jan 2010 19:07:52 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <4B4E0AAB.7060805@lshift.net>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
	<4B4E0AAB.7060805@lshift.net>
Message-ID: <0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>

Hi Matthias,

I have the stack trace of the hanging Model.BasicGet call

14	Worker Thread	<No Name DigitalDistribution.RabbitMQ.RabbitMessageQueue<DigitalDistribution.ContentIngest.ServiceModel.V100.Messages.SupplierReleaseUpdate>.GetNormal
[In a sleep, wait, or join]	 
mscorlib.dll!System.Threading.Monitor.Wait(object obj, int millisecondsTimeout, bool exitContext) + 0x18 bytes	 
mscorlib.dll!System.Threading.Monitor.Wait(object obj) + 0xa bytes	 
RabbitMQ.Client.dll!RabbitMQ.Util.BlockingCell.Value.get() + 0x52 bytes	 
RabbitMQ.Client.dll!RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply() + 0x2e bytes	 
RabbitMQ.Client.dll!RabbitMQ.Client.Impl.ModelBase.BasicGet(string queue = "001.load.release.update", bool noAck = false) + 0x82 bytes	 
DigitalDistribution.RabbitMQ.dll!DigitalDistribution.RabbitMQ.RabbitMessageQueue<DigitalDistribution.ContentIngest.ServiceModel.V100.Messages.SupplierReleaseUpdate>.Get() Line 121 + 0x24 bytes	 
DigitalDistribution.ContentIngest.dll!DigitalDistribution.ContentIngest.Messaging.AbstractMessageConsumer<DigitalDistribution.ContentIngest.ServiceModel.V100.Messages.SupplierReleaseUpdate>.ReadNextMessage() Line 155 + 0x53 bytes	 
DigitalDistribution.ContentIngest.dll!DigitalDistribution.ContentIngest.Messaging.AbstractMessageConsumer<DigitalDistribution.ContentIngest.ServiceModel.V100.Messages.SupplierReleaseUpdate>.ProcessMessageLoop() Line 107 + 0x8 bytes	 
mscorlib.dll!System.Threading.ThreadHelper.ThreadStart_Context(object state) + 0x66 bytes	 
mscorlib.dll!System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state) + 0x6f bytes	 
mscorlib.dll!System.Threading.ThreadHelper.ThreadStart() + 0x44 bytes	

@Jeremy

The number is inconsistent when continuing the process but I have just seen it I load an empty queue with the same messages that it is hanging after the same set of messages every time. The message data I'm using is binary serialized XML, could this be perhaps a message content/size restriction? I'll look into getting the message content and size for the message prior to hanging and the one expected next.

Note when I restart the consumer it will happily process the next message. Would it be possible that a corrupt message is blocking and the server re-queues it (I assume its appends it to the end of the queue) thus the restarted consumer skips it?

Thanks for the prompt reply guys
Pete

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 13 January 2010 18:02
To: Peter Townsend
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] .NET client hangs on BasicGet

Peter,

Peter Townsend wrote:
> I'm using the .NET client running against a windows installation of the 
> RabbitMQ broker. I have found that calls to IModel.BasicGet(...) will 
> hang after process a number of message. The number of messages processed 
> before it hangs changes with each run.

When it hangs, please take a thread dump and post it here.

> I refactored to use a BasicConsume approach

It will probably be easier to debug this by sticking to BasicGet.


Regards,

Matthias.



From matthias at lshift.net  Wed Jan 13 19:27:50 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 13 Jan 2010 19:27:50 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
	<4B4E0AAB.7060805@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>
Message-ID: <4B4E1EB6.6000807@lshift.net>

Pete,

Peter Townsend wrote:
> I have the stack trace of the hanging Model.BasicGet call

I need to see a stack trace of *all* the threads.

I am not a Windows programmer, but a quick bit of googling brings up

http://stackoverflow.com/questions/190236/how-do-i-make-a-thread-dump-in-net-a-la-jvm-thread-dumps, 
in particular the Managed Stack Explorer program.

Regards,

Matthias.



From g at rre.tt  Wed Jan 13 19:37:52 2010
From: g at rre.tt (Garrett Smith)
Date: Wed, 13 Jan 2010 13:37:52 -0600
Subject: [rabbitmq-discuss] Chicago Erlang User Group (CEUG) coding sprint
Message-ID: <ce2570e21001131137o551e58e4gc19a4c5b4d855034@mail.gmail.com>

As an exercise to help CEUG members better understand OTP applications
and releases, we're holding a sprint on Jan 23 to work on packaging
for various Erlang apps and libraries. I've volunteered to champion
rabbitmq.

We'll be working with the Erlware tool set (Faxien, etc.) to enable
easy integration of the app/libraries into developer projects. The
scenarios are similar to what Python developers experience with
distutils/eggs or Ruby with gem.

I'm new to that tool set and don't fully understand the implications
to the rabbitmq codebase, but from what I understand this can be done
at arms length - similar to what's involved in creating system
packages. In any event, I hope come away from the sprint with a solid
understanding of what would be needed to get the Erlang components of
rabbitmq plugged into the Erlware packaging and distribution scheme.

If anyone's interested in this, let me know. I'd love to get any
input: good, bad, etc.

Garrett



From Peter.Townsend at mflow.com  Wed Jan 13 19:43:11 2010
From: Peter.Townsend at mflow.com (Peter Townsend)
Date: Wed, 13 Jan 2010 19:43:11 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <4B4E1EB6.6000807@lshift.net>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
	<4B4E0AAB.7060805@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>
	<4B4E1EB6.6000807@lshift.net>
Message-ID: <0357196CB603794BB76F4F6B373F2733036E2F4F5D@SERVER.ddnglobal.local>

Matthias,

Full thread dump from Managed Stack Explorer:

Thread ID: 5968
        0. System.Threading.Monitor.Wait (Source Unavailable)
        1. System.Threading.Monitor.Wait (Source Unavailable)
        2. DigitalDistribution.ContentIngest.Messaging.AbstractMessageConsumer`1.Wait (AbstractMessageConsumer.cs:94)
        3. DigitalDistribution.ContentIngest.Pricing.Program.Main (Program.cs:91)

Thread ID: 3264
        0. [Internal thisFrame, 'M-->U', System.Net.UnsafeNclNativeMethods.OSSOCK::recv] (Source Unavailable)
        1. System.Net.Sockets.Socket.Receive (Source Unavailable)
        2. System.Net.Sockets.Socket.Receive (Source Unavailable)
        3. System.Net.Sockets.NetworkStream.Read (Source Unavailable)
        4. System.IO.BinaryReader.ReadBytes (Source Unavailable)
        5. RabbitMQ.Client.Impl.Frame.ReadFrom (Source Unavailable)
        6. RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame (Source Unavailable)
        7. RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration (Source Unavailable)
        8. RabbitMQ.Client.Impl.ConnectionBase.MainLoop (Source Unavailable)
        9. System.Threading.ThreadHelper.ThreadStart_Context (Source Unavailable)
        10. System.Threading.ExecutionContext.Run (Source Unavailable)
        11. System.Threading.ThreadHelper.ThreadStart (Source Unavailable)

Thread ID: 3836

Thread ID: 3816
        0. System.Threading.Monitor.Wait (Source Unavailable)
        1. RabbitMQ.Util.BlockingCell.get_Value (Source Unavailable)
        2. RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply (Source Unavailable)
        3. RabbitMQ.Client.Impl.ModelBase.BasicGet (Source Unavailable)
        4. DigitalDistribution.RabbitMQ.RabbitMessageQueue`1.Get (RabbitMessageQueue.cs:121)
        5. DigitalDistribution.ContentIngest.Messaging.AbstractMessageConsumer`1.ReadNextMessage (AbstractMessageConsumer.cs:155)
        6. DigitalDistribution.ContentIngest.Messaging.AbstractMessageConsumer`1.ProcessMessageLoop (AbstractMessageConsumer.cs:107)
        7. System.Threading.ThreadHelper.ThreadStart_Context (Source Unavailable)
        8. System.Threading.ExecutionContext.Run (Source Unavailable)
        9. System.Threading.ThreadHelper.ThreadStart (Source Unavailable)

Thanks
Pete

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 13 January 2010 19:28
To: Peter Townsend
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] .NET client hangs on BasicGet

Pete,

Peter Townsend wrote:
> I have the stack trace of the hanging Model.BasicGet call

I need to see a stack trace of *all* the threads.

I am not a Windows programmer, but a quick bit of googling brings up

http://stackoverflow.com/questions/190236/how-do-i-make-a-thread-dump-in-net-a-la-jvm-thread-dumps, 
in particular the Managed Stack Explorer program.

Regards,

Matthias.



From matthias at lshift.net  Wed Jan 13 20:05:50 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 13 Jan 2010 20:05:50 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <0357196CB603794BB76F4F6B373F2733036E2F4F5D@SERVER.ddnglobal.local>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
	<4B4E0AAB.7060805@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>
	<4B4E1EB6.6000807@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5D@SERVER.ddnglobal.local>
Message-ID: <4B4E279E.3090005@lshift.net>

Peter,

Peter Townsend wrote:
> Full thread dump from Managed Stack Explorer:

Thanks. Looks like the client is waiting for the basic.get response. 
That is very odd, since the server should always send such a response. I 
would be amazed if there was a server-side bug here, given how heavily 
used basic.get is. So perhaps the response is somehow going astray in 
the client.

Is there anything odd at all in the server logs?

What version of the server and client are you running?

If you have a spare few minutes, please run your test through the tracer 
(http://www.rabbitmq.com/examples.html#tracer) and post the tracer 
output here (or, if it's very long, put it somewhere where I can 
download it). The tracer output will tell us whether client or server 
are doing anything strange in their interaction.

Also, please post a complete (i.e. ready to compile & run) version of 
the code that is using BasicGet.


Regards,

Matthias.



From dsinclair at chariotsolutions.com  Wed Jan 13 20:35:53 2010
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Wed, 13 Jan 2010 15:35:53 -0500
Subject: [rabbitmq-discuss] Who is using rabbit?
Message-ID: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>

Hi,

I am trying to convince some people why we should be using RabbitMQ. One
thing I am having a hard time finding are people who have been using it in
production, for large scale applications, and what if any problems they
faced. I have search the mailing list archives but haven't found a whole
lot.

If anyone would like to chime in information on their experiences with
rabbit, especially large scale production environments,  I would be very
appreciative! :)

thanks

dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/962eb18a/attachment.htm 

From jdunck at gmail.com  Wed Jan 13 21:00:25 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 13 Jan 2010 15:00:25 -0600
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
Message-ID: <2545a92c1001131300i7231e775xd45c94fdb2648925@mail.gmail.com>

On Wed, Jan 13, 2010 at 2:35 PM, David Sinclair
<dsinclair at chariotsolutions.com> wrote:
> If anyone would like to chime in information on their experiences with
> rabbit, especially large scale production environments,? I would be very
> appreciative! :)

Heroku apparently use it:
http://adamblog.heroku.com/past/2009/7/8/sql_databases_are_an_overapplied_solution_and_what_to_use_instead/



From gmr at myyearbook.com  Wed Jan 13 21:16:07 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 13 Jan 2010 16:16:07 -0500
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
Message-ID: <af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>

We use it at myYearbook.com.

Regards,

Gavin

On Wed, Jan 13, 2010 at 3:35 PM, David Sinclair <
dsinclair at chariotsolutions.com> wrote:

> Hi,
>
> I am trying to convince some people why we should be using RabbitMQ. One
> thing I am having a hard time finding are people who have been using it in
> production, for large scale applications, and what if any problems they
> faced. I have search the mailing list archives but haven't found a whole
> lot.
>
> If anyone would like to chime in information on their experiences with
> rabbit, especially large scale production environments,  I would be very
> appreciative! :)
>
> thanks
>
> dave
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/7d49f6f3/attachment.htm 

From alexis.richardson at gmail.com  Wed Jan 13 21:25:17 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 13 Jan 2010 21:25:17 +0000
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
	<af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>
Message-ID: <167204d21001131325t27c9e98br55eb6a9d2977e62e@mail.gmail.com>

David,

The largest scale deployment we know of is 5,000 machines at a cloud
provider.  The largest load in terms of messages per day that we know
of is in the region of 250m-500m messages per day.

I can provide more details off-list.

The following links database may be helpful:
http://delicious.com/alexisrichardson/rabbitmq+usecase

Or some highlights are here: http://www.rabbitmq.com/how.html

Cheers

alexis


On Wed, Jan 13, 2010 at 9:16 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
> We use it at myYearbook.com.
> Regards,
> Gavin
>
> On Wed, Jan 13, 2010 at 3:35 PM, David Sinclair
> <dsinclair at chariotsolutions.com> wrote:
>>
>> Hi,
>>
>> I am trying to convince some people why we should be using RabbitMQ. One
>> thing I am having a hard time finding are people who have been using it in
>> production, for large scale applications, and what if any problems they
>> faced. I have search the mailing list archives but haven't found a whole
>> lot.
>>
>> If anyone would like to chime in information on their experiences with
>> rabbit, especially large scale production environments,? I would be very
>> appreciative! :)
>>
>> thanks
>>
>> dave
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From gmr at myyearbook.com  Wed Jan 13 21:28:36 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 13 Jan 2010 16:28:36 -0500
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com> 
	<af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>
Message-ID: <af1bce591001131328j169141ccxf06c7b6dd27fb29@mail.gmail.com>

For message usage, right now we're sending about 6M messages a day or
roughly 70 messages a second per RabbitMQ instance.  We're very pleased and
will be migrating a 10 server ActiveMQ cluster over to it in the near
future.

On Wed, Jan 13, 2010 at 4:16 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> We use it at myYearbook.com.
>
> Regards,
>
> Gavin
>
> On Wed, Jan 13, 2010 at 3:35 PM, David Sinclair <
> dsinclair at chariotsolutions.com> wrote:
>
>> Hi,
>>
>> I am trying to convince some people why we should be using RabbitMQ. One
>> thing I am having a hard time finding are people who have been using it in
>> production, for large scale applications, and what if any problems they
>> faced. I have search the mailing list archives but haven't found a whole
>> lot.
>>
>> If anyone would like to chime in information on their experiences with
>> rabbit, especially large scale production environments,  I would be very
>> appreciative! :)
>>
>> thanks
>>
>> dave
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/b150ae0f/attachment.htm 

From jdunck at gmail.com  Wed Jan 13 21:34:57 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 13 Jan 2010 15:34:57 -0600
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <167204d21001131325t27c9e98br55eb6a9d2977e62e@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
	<af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>
	<167204d21001131325t27c9e98br55eb6a9d2977e62e@mail.gmail.com>
Message-ID: <2545a92c1001131334q61ca0324jfae2eee9b6ca13ae@mail.gmail.com>

On Wed, Jan 13, 2010 at 3:25 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
...
> The largest scale deployment we know of is 5,000 machines at a cloud
> provider. ?The largest load in terms of messages per day that we know
> of is in the region of 250m-500m messages per day.

Marketing tip: put this snippet on your homepage.  :-)



From alexis.richardson at gmail.com  Wed Jan 13 21:37:08 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 13 Jan 2010 21:37:08 +0000
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <2545a92c1001131334q61ca0324jfae2eee9b6ca13ae@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
	<af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>
	<167204d21001131325t27c9e98br55eb6a9d2977e62e@mail.gmail.com>
	<2545a92c1001131334q61ca0324jfae2eee9b6ca13ae@mail.gmail.com>
Message-ID: <167204d21001131337y3bad135ekbfee8319a6d69a1b@mail.gmail.com>

On Wed, Jan 13, 2010 at 9:34 PM, Jeremy Dunck <jdunck at gmail.com> wrote:
> On Wed, Jan 13, 2010 at 3:25 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
> ...
>> The largest scale deployment we know of is 5,000 machines at a cloud
>> provider. ?The largest load in terms of messages per day that we know
>> of is in the region of 250m-500m messages per day.
>
> Marketing tip: put this snippet on your homepage. ?:-)

Now there's a thought ;-)

We do ask folks to blog about this kind of thing whenever they can!

alexis



From jdunck at gmail.com  Wed Jan 13 21:37:57 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 13 Jan 2010 15:37:57 -0600
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <167204d21001131325t27c9e98br55eb6a9d2977e62e@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
	<af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>
	<167204d21001131325t27c9e98br55eb6a9d2977e62e@mail.gmail.com>
Message-ID: <2545a92c1001131337h181a2642nf6fd04783f13917f@mail.gmail.com>

On Wed, Jan 13, 2010 at 3:25 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
...
> The following links database may be helpful:
> http://delicious.com/alexisrichardson/rabbitmq+usecase


Dead link from that stream, posted 9th Jan 2010:
http://colinclarkeventprocessing.com/?p=368

That's gotta be a linkrot record.  :-(



From alexis.richardson at gmail.com  Wed Jan 13 21:40:41 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 13 Jan 2010 21:40:41 +0000
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <2545a92c1001131337h181a2642nf6fd04783f13917f@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
	<af1bce591001131316q374851bei83e6630991bc2372@mail.gmail.com>
	<167204d21001131325t27c9e98br55eb6a9d2977e62e@mail.gmail.com>
	<2545a92c1001131337h181a2642nf6fd04783f13917f@mail.gmail.com>
Message-ID: <167204d21001131340k1cd4d22fva51449f25e330cf5@mail.gmail.com>

Gaah.

Colin - is your site down?

On Wed, Jan 13, 2010 at 9:37 PM, Jeremy Dunck <jdunck at gmail.com> wrote:
> On Wed, Jan 13, 2010 at 3:25 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
> ...
>> The following links database may be helpful:
>> http://delicious.com/alexisrichardson/rabbitmq+usecase
>
>
> Dead link from that stream, posted 9th Jan 2010:
> http://colinclarkeventprocessing.com/?p=368
>
> That's gotta be a linkrot record. ?:-(
>



From kpatel at egnyte.com  Wed Jan 13 22:02:15 2010
From: kpatel at egnyte.com (Kalpesh)
Date: Wed, 13 Jan 2010 16:02:15 -0600
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
Message-ID: <009c01ca949c$118ca740$34a5f5c0$@com>

We use it at egnyte.com.

 

------------------------------------------------
Kalpesh Patel 

Egnyte - your Cloud File Server
Big Technology; Small Price
sign up at  <http://www.egnyte.com> http://www.egnyte.com

 

From: David Sinclair [mailto:dsinclair at chariotsolutions.com] 
Sent: Wednesday, January 13, 2010 2:36 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Who is using rabbit?

 

Hi,

I am trying to convince some people why we should be using RabbitMQ. One
thing I am having a hard time finding are people who have been using it in
production, for large scale applications, and what if any problems they
faced. I have search the mailing list archives but haven't found a whole
lot.

If anyone would like to chime in information on their experiences with
rabbit, especially large scale production environments,  I would be very
appreciative! :)

thanks

dave

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100113/720e6ccb/attachment.htm 

From jdunck at gmail.com  Wed Jan 13 22:27:52 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 13 Jan 2010 16:27:52 -0600
Subject: [rabbitmq-discuss] Daemonizing connection threads (was Re: .Net
	client foreground threads)
In-Reply-To: <066601ca8fc8$ceaf8140$6c0e83c0$@com>
References: <2545a92c0912291639j30947627m5636329a0927df83@mail.gmail.com>
	<20100106113643.GG27068@wellquite.org>
	<20100107123240.GC15498@wellquite.org> <4B45E163.1030404@lshift.net>
	<20100107135609.GE15498@wellquite.org> <4B45E8E5.5040804@lshift.net>
	<066601ca8fc8$ceaf8140$6c0e83c0$@com>
Message-ID: <2545a92c1001131427t4b9ec6bav53100ff412f1c1f0@mail.gmail.com>

On Thu, Jan 7, 2010 at 12:39 PM, JD Conley <jdc at hive7.com> wrote:
>> At the moment there's no easy way to ask for daemon threads if you
>> decide they're appropriate for your app: so maybe we should go with
>> non-daemon per default, daemon per user-selectable option.
>
> A background/daemon thread would be preferred for our situation as well.
> This configurable option would be great.

+1



From jdunck at gmail.com  Wed Jan 13 22:34:36 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 13 Jan 2010 16:34:36 -0600
Subject: [rabbitmq-discuss] Bug tracker?
Message-ID: <2545a92c1001131434t331aa3cdu6f9e21933dadab50@mail.gmail.com>

I'm logging an internal bug to do some work on the RabbitMQ .net
client, but meant to refer to a RabbitMQ ticket.  Then I realized that
I'm supposed to send bug reports to legitimategrievance at rabbitmq.com?

Is there not a public bug tracker for RabbitMQ?



From alexis.richardson at gmail.com  Wed Jan 13 22:37:31 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 13 Jan 2010 22:37:31 +0000
Subject: [rabbitmq-discuss] Bug tracker?
In-Reply-To: <2545a92c1001131434t331aa3cdu6f9e21933dadab50@mail.gmail.com>
References: <2545a92c1001131434t331aa3cdu6f9e21933dadab50@mail.gmail.com>
Message-ID: <167204d21001131437q86ec961n2a4960c582097e35@mail.gmail.com>

Jeremy

Please could you send bug reports to the list.  We have a bugzilla
instance but due to how it's set up, making it properly public is a
bit of work.

alexis



On Wed, Jan 13, 2010 at 10:34 PM, Jeremy Dunck <jdunck at gmail.com> wrote:
> I'm logging an internal bug to do some work on the RabbitMQ .net
> client, but meant to refer to a RabbitMQ ticket. ?Then I realized that
> I'm supposed to send bug reports to legitimategrievance at rabbitmq.com?
>
> Is there not a public bug tracker for RabbitMQ?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From g at rre.tt  Wed Jan 13 22:38:47 2010
From: g at rre.tt (Garrett Smith)
Date: Wed, 13 Jan 2010 16:38:47 -0600
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
Message-ID: <ce2570e21001131438k7ff39af5k27039d69d2afb761@mail.gmail.com>

On Wed, Jan 13, 2010 at 2:35 PM, David Sinclair
<dsinclair at chariotsolutions.com> wrote:
> Hi,
>
> I am trying to convince some people why we should be using RabbitMQ. One
> thing I am having a hard time finding are people who have been using it in
> production, for large scale applications, and what if any problems they
> faced. I have search the mailing list archives but haven't found a whole
> lot.
>
> If anyone would like to chime in information on their experiences with
> rabbit, especially large scale production environments,? I would be very
> appreciative! :)

We're using it at Stax Networks (www.stax.net).

In addition to the testimonials here, you might also use AMQP as a
selling point. The background of AMQP is very enterprise architecture
friendly. I can testify to the value of the open spec, having moved
from qpid server to rabbitmq without changing client code. Once you
get buy in on AMQP, rabbitmq is on the short list of grade A servers
(qpid is definitely in the same class, IMO). For risk averse decision
makers, this might resonate.

The Erlang story behind rabbitmq, I think, is another compelling
point. As a quick exercise, if you haven't already, look over the
amount of source code for the rabbitmq server. If your impression is
anything like mine, you'll be surprised at how little code there is.
This is pretty anecdotal, but it's one of the more persuasive points
for me - rabbitmq really leverages the goodness of Erlang and that's
an outstanding match for long running, highly concurrent systems.

Garrett



From jdunck at gmail.com  Wed Jan 13 22:44:52 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Wed, 13 Jan 2010 16:44:52 -0600
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <ce2570e21001131438k7ff39af5k27039d69d2afb761@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
	<ce2570e21001131438k7ff39af5k27039d69d2afb761@mail.gmail.com>
Message-ID: <2545a92c1001131444p2fe7e2efv4a8169c453cb60b@mail.gmail.com>

On Wed, Jan 13, 2010 at 4:38 PM, Garrett Smith <g at rre.tt> wrote:
...
> The Erlang story behind rabbitmq, I think, is another compelling
> point. As a quick exercise, if you haven't already, look over the
> amount of source code for the rabbitmq server. If your impression is
> anything like mine, you'll be surprised at how little code there is.

I don't think it's anecdotal; it's well-shown that cyclomatic
complexity and LOC are the main determinants of bug count.



From matthew at lshift.net  Thu Jan 14 11:16:32 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 14 Jan 2010 11:16:32 +0000
Subject: [rabbitmq-discuss] Page to disk feature
In-Reply-To: <401b577e1001130952r3219e99eg3f3351985538715f@mail.gmail.com>
References: <401b577e1001130952r3219e99eg3f3351985538715f@mail.gmail.com>
Message-ID: <20100114111631.GJ18681@mrnibble.lshift.net>

Hi Scott,

On Wed, Jan 13, 2010 at 09:52:11AM -0800, scott w wrote:
> What is the status of the "page to disk" feature that will ensure the node
> doesn't crash when the message exceed memory capacity? I realize it's not in
> a stable release yet but is there a stable fix for it yet and if so what
> patch do I need to download?

You need to compile from source. If you grab our hg repo following the
instructions on http://www.rabbitmq.com/build-server.html and before you
make hg up -C bug21673

Several people are using it and it is reasonably stable. However, there
are occasional issues found which I very gratefully receive (especially
if I can figure out how to reproduce them!). I'm always very interested
to hear how people are getting on with the new persister - whether
they're liking the behaviour they're seeing, so please do let us know.

Best wishes,

Matthew



From matthew at lshift.net  Thu Jan 14 11:24:59 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 14 Jan 2010 11:24:59 +0000
Subject: [rabbitmq-discuss] suspending and resuming a QueueingConsumer
In-Reply-To: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>
References: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>
Message-ID: <20100114112459.GK18681@mrnibble.lshift.net>

Hi Jim,

On Wed, Jan 13, 2010 at 02:06:57PM -0500, Jim Irrer wrote:
> I have several consumers reading from the same queue.  I would like
> to be able to interrupt their pending read to suspend and resume any
> one of them.   I've played around with:
> 
> Channel.basicCancel(consumerTag) : don't know how to resume
> Channel.abort()    produces com.rabbitmq.client.ShutdownSignalException
> Channel.close()   produces com.rabbitmq.client.ShutdownSignalException
> 
> The close() and abort() methods seem to act about the same.  I can resume
> reading from the queue by creating a new channel and a new QueueingConsumer.
> I could not figure out how to resume after a basicCancel.
> 
> Is using close() and then re-constructing the channel and QueueingConsumer
> the right way to go?  Will resources be properly taken care of by garbage
> collection?

What I would do is set QoS prefetch to 1, and make sure that you're
doing ack-ing manually (i.e. don't set noAck). Then, when you want to
"suspend", just delay acking the last message you received. That'll
prevent further messages being sent to you. Once you want to resume,
send the ack and then the next message will be sent down to you. Does
that help?

> BTW - I use the consumerTag returned by Channel.basicConsume(queueName,
> consumer)
> for the argument to Channel.basicCancel, eg: *
> amq.ctag-1m/H7+SDcZpbzTMgsUyhNg==* .
> When called, it prints:
> 
> Consumer null method handleCancelOk for channel AMQChannel(amqp://
> guest at 172.20.125.34:5672/,1) threw an exception:
> java.lang.NullPointerException
>     at com.rabbitmq.client.impl.ChannelN$2.transformReply(ChannelN.java:728)
>     at com.rabbitmq.client.impl.ChannelN$2.transformReply(ChannelN.java:721)
>     at
> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.handleCommand(AMQChannel.java:327)
>     at
> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:162)
>     at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
>     at
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:456)

The Javadoc says:

    /**
     * Cancel a consumer. Calls the consumer's {@link Consumer#handleCancelOk}
     * method before returning.
     * @param consumerTag a client- or server-generated consumer tag to establish context
     * @throws java.io.IOException if an error is encountered
     * @see com.rabbitmq.client.AMQP.Basic.Cancel
     * @see com.rabbitmq.client.AMQP.Basic.CancelOk
     */
    void basicCancel(String consumerTag) throws IOException;

The DefaultConsumer does have the handleCancelOk filled in, and Consumer
is an interface, so I'm a little alarmed by the possibility that it
can't find the handleCancelOk method. What consumer class are you using?
- in short, could you send us a small code example that exhibits this
behaviour?

Best wishes,

Matthew



From Peter.Townsend at mflow.com  Thu Jan 14 12:33:07 2010
From: Peter.Townsend at mflow.com (Peter Townsend)
Date: Thu, 14 Jan 2010 12:33:07 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <4B4E279E.3090005@lshift.net>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
	<4B4E0AAB.7060805@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>
	<4B4E1EB6.6000807@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5D@SERVER.ddnglobal.local>
	<4B4E279E.3090005@lshift.net>
Message-ID: <0357196CB603794BB76F4F6B373F2733036E2F4F7D@SERVER.ddnglobal.local>

Hi Matthias,

The server logs show nothing unusual. I'm running version 1.7 broker and version 1.7 .NET client.

The tracer output is attached. I've had to clean the message body content. I'll look at getting a source code version posted. 

I mentioned before that the consumer is hanging after the same messages each time. (As I have been reloading the same messages into the queue and reattempting the consumer run). Once the consumer passes message A it hangs. If I continue running it will soon hang after a different message B. If I reset and reload the queue and re-run the consumer it will hang after message A again.

Perhaps an issue with the message content? (binary serialized XML)

Thanks 
Pete

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 13 January 2010 20:06
To: Peter Townsend
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] .NET client hangs on BasicGet

Peter,

Peter Townsend wrote:
> Full thread dump from Managed Stack Explorer:

Thanks. Looks like the client is waiting for the basic.get response. 
That is very odd, since the server should always send such a response. I 
would be amazed if there was a server-side bug here, given how heavily 
used basic.get is. So perhaps the response is somehow going astray in 
the client.

Is there anything odd at all in the server logs?

What version of the server and client are you running?

If you have a spare few minutes, please run your test through the tracer 
(http://www.rabbitmq.com/examples.html#tracer) and post the tracer 
output here (or, if it's very long, put it somewhere where I can 
download it). The tracer output will tell us whether client or server 
are doing anything strange in their interaction.

Also, please post a complete (i.e. ready to compile & run) version of 
the code that is using BasicGet.


Regards,

Matthias.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: output-cleaned.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100114/78f86c2b/attachment.txt 

From matthias at lshift.net  Thu Jan 14 13:53:42 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 14 Jan 2010 13:53:42 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <0357196CB603794BB76F4F6B373F2733036E2F4F7D@SERVER.ddnglobal.local>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
	<4B4E0AAB.7060805@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>
	<4B4E1EB6.6000807@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5D@SERVER.ddnglobal.local>
	<4B4E279E.3090005@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F7D@SERVER.ddnglobal.local>
Message-ID: <4B4F21E6.3030804@lshift.net>

Peter,

Peter Townsend wrote:
> The tracer output is attached.

So the interaction ...

1263466055492: conn#0 ch#1 -> 
{#method<basic.get>(ticket=0,queue=001.load.release.update,no-ack=false),null,""}
1263466055507: conn#0 ch#1 <- 
{#method<basic.get-ok>(delivery-tag=20,redelivered=false,exchange=amq.direct,routing-key=001.load.release.update,message-count=123),#contentHeader<basic>(content-type=null, 
content-encoding=null, headers=null, delivery-mode=2, priority=null, 
correlation-id=null, reply-to=null, expiration=null, message-id=null, 
timestamp=null, type=SupplierReleaseUpdate, user-id=null, app-id=null, 
cluster-id=null),"<MESSAGE>"}
1263466057457: conn#0 ch#1 -> 
{#method<basic.ack>(delivery-tag=20,multiple=false),null,""}
1263466057457: conn#0 ch#1 -> 
{#method<basic.get>(ticket=0,queue=001.load.release.update,no-ack=false),null,""}

... is the very last thing you see before it gets stuck? If so then that 
is very interesting since it would indicate that the server is failing 
to reply to the basic.get. Either that, or the reply from the server has 
gone astray.

The next step is getting your source code so I can try to reproduce your 
observations locally.

> I mentioned before that the consumer is hanging after the same
> messages each time. (As I have been reloading the same messages into the
> queue and reattempting the consumer run). Once the consumer passes
> message A it hangs. If I continue running it will soon hang after a
> different message B. If I reset and reload the queue and re-run the
> consumer it will hang after message A again.
> 
> Perhaps an issue with the message content? (binary serialized XML)

The message content is opaque to the server and the client library.

However, since you are running on Windows ... we have had some reports 
from people indicating that Windows may be interfering with XML 
payloads, resulting in all kinds of mysterious behaviours. So one 
possible thing to try is to encrypt your payloads.


Regards,

Matthias.



From dsinclair at chariotsolutions.com  Thu Jan 14 14:00:09 2010
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Thu, 14 Jan 2010 09:00:09 -0500
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <2545a92c1001131444p2fe7e2efv4a8169c453cb60b@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
	<ce2570e21001131438k7ff39af5k27039d69d2afb761@mail.gmail.com>
	<2545a92c1001131444p2fe7e2efv4a8169c453cb60b@mail.gmail.com>
Message-ID: <757cc9481001140600s253f5de8ya5af201085ddd471@mail.gmail.com>

Thanks for the responses everyone. This gives me plenty of ammo!

On Wed, Jan 13, 2010 at 5:44 PM, Jeremy Dunck <jdunck at gmail.com> wrote:

> On Wed, Jan 13, 2010 at 4:38 PM, Garrett Smith <g at rre.tt> wrote:
> ...
> > The Erlang story behind rabbitmq, I think, is another compelling
> > point. As a quick exercise, if you haven't already, look over the
> > amount of source code for the rabbitmq server. If your impression is
> > anything like mine, you'll be surprised at how little code there is.
>
> I don't think it's anecdotal; it's well-shown that cyclomatic
> complexity and LOC are the main determinants of bug count.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100114/5abc0415/attachment.htm 

From bmurphy1976 at gmail.com  Thu Jan 14 16:01:31 2010
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 14 Jan 2010 10:01:31 -0600
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <0357196CB603794BB76F4F6B373F2733036E2F4F7D@SERVER.ddnglobal.local>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
	<4B4E0AAB.7060805@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>
	<4B4E1EB6.6000807@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5D@SERVER.ddnglobal.local>
	<4B4E279E.3090005@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F7D@SERVER.ddnglobal.local>
Message-ID: <7fd310d11001140801k79f90142s4f522c067dfa4e9c@mail.gmail.com>

Do you have sample code that exhibits the problem?  We use the 1.7 .net
client against a 1.6 server extensively and have never run into any problems
like this.

Are you properly acking your messages after your handle them?

Bryan

On Thu, Jan 14, 2010 at 6:33 AM, Peter Townsend <Peter.Townsend at mflow.com>wrote:

> Hi Matthias,
>
> The server logs show nothing unusual. I'm running version 1.7 broker and
> version 1.7 .NET client.
>
> The tracer output is attached. I've had to clean the message body content.
> I'll look at getting a source code version posted.
>
> I mentioned before that the consumer is hanging after the same messages
> each time. (As I have been reloading the same messages into the queue and
> reattempting the consumer run). Once the consumer passes message A it hangs.
> If I continue running it will soon hang after a different message B. If I
> reset and reload the queue and re-run the consumer it will hang after
> message A again.
>
> Perhaps an issue with the message content? (binary serialized XML)
>
> Thanks
> Pete
>
> -----Original Message-----
> From: Matthias Radestock [mailto:matthias at lshift.net]
> Sent: 13 January 2010 20:06
> To: Peter Townsend
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] .NET client hangs on BasicGet
>
> Peter,
>
> Peter Townsend wrote:
> > Full thread dump from Managed Stack Explorer:
>
> Thanks. Looks like the client is waiting for the basic.get response.
> That is very odd, since the server should always send such a response. I
> would be amazed if there was a server-side bug here, given how heavily
> used basic.get is. So perhaps the response is somehow going astray in
> the client.
>
> Is there anything odd at all in the server logs?
>
> What version of the server and client are you running?
>
> If you have a spare few minutes, please run your test through the tracer
> (http://www.rabbitmq.com/examples.html#tracer) and post the tracer
> output here (or, if it's very long, put it somewhere where I can
> download it). The tracer output will tell us whether client or server
> are doing anything strange in their interaction.
>
> Also, please post a complete (i.e. ready to compile & run) version of
> the code that is using BasicGet.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100114/35cba65c/attachment.htm 

From irrer at umich.edu  Thu Jan 14 16:19:41 2010
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 14 Jan 2010 11:19:41 -0500
Subject: [rabbitmq-discuss] suspending and resuming a QueueingConsumer
In-Reply-To: <20100114112459.GK18681@mrnibble.lshift.net>
References: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>
	<20100114112459.GK18681@mrnibble.lshift.net>
Message-ID: <3b6ef0791001140819m4c8865fbn7d75106eb9cb4e64@mail.gmail.com>

Matthew -

Thanks for trying but that does not really help.  I want to interrupt a
free-running
process that has already posted the read.  To explore this, I modified
RabbitMQ's
SimpleConsumer class (below) to post a read (via the nextDelivery method),
and
while it is waiting, have another thread close the channel.

Thanks,

- Jim

//   The contents of this file are subject to the Mozilla Public License
//   Version 1.1 (the "License"); you may not use this file except in
//   compliance with the License. You may obtain a copy of the License at
//   http://www.mozilla.org/MPL/
//
//   Software distributed under the License is distributed on an "AS IS"
//   basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
//   License for the specific language governing rights and limitations
//   under the License.
//
//   The Original Code is RabbitMQ.
//
//   The Initial Developers of the Original Code are LShift Ltd,
//   Cohesive Financial Technologies LLC, and Rabbit Technologies Ltd.
//
//   Portions created before 22-Nov-2008 00:00:00 GMT by LShift Ltd,
//   Cohesive Financial Technologies LLC, or Rabbit Technologies Ltd
//   are Copyright (C) 2007-2008 LShift Ltd, Cohesive Financial
//   Technologies LLC, and Rabbit Technologies Ltd.
//
//   Portions created by LShift Ltd are Copyright (C) 2007-2009 LShift
//   Ltd. Portions created by Cohesive Financial Technologies LLC are
//   Copyright (C) 2007-2009 Cohesive Financial Technologies
//   LLC. Portions created by Rabbit Technologies Ltd are Copyright
//   (C) 2007-2009 Rabbit Technologies Ltd.
//
//   All Rights Reserved.
//
//   Contributor(s): ______________________________________.
//

package com.rabbitmq.examples;

import com.rabbitmq.client.AMQP;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.QueueingConsumer;

public class SimpleConsumerCancel implements Runnable {

    private static int count = 0;

    private static Channel channel = null;

    private static String consumerTag = null;

    public static void main(String[] args) {
        try {
            String hostName = (args.length > 0) ? args[0] : "172.20.125.34";
            int portNumber = (args.length > 1) ? Integer.parseInt(args[1]) :
AMQP.PROTOCOL.PORT;
            String queueName = (args.length > 2) ? args[2] : "SimpleQueue";

            ConnectionFactory connFactory = new ConnectionFactory();
            Connection conn = connFactory.newConnection(hostName,
portNumber);

            channel = conn.createChannel();

            channel.queueDeclare(queueName);

            Thread thread = new Thread(new SimpleConsumerCancel());
            thread.start();

            QueueingConsumer consumer = new QueueingConsumer(channel);
            consumerTag = channel.basicConsume(queueName, consumer);
            System.out.println("consumerTag: " + consumerTag);
            while (true) {
                try {
                    System.out.println("Waiting for delivery.");
                    QueueingConsumer.Delivery delivery =
consumer.nextDelivery();
                    System.out.println("\nGot delivery.");
                    count++;
                    System.out.println("SimpleConsumerCancel got Message: "
+ new String(delivery.getBody()) + " : " + count);

channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                }
                catch (Exception ex) {
                    System.err.println("Read thread caught exception: " +
ex);

                    channel = conn.createChannel();
                    channel.queueDeclare(queueName);
                    consumer = new QueueingConsumer(channel);
                    consumerTag = channel.basicConsume(queueName, consumer);
                    System.out.println("consumerTag: " + consumerTag);
                }
            }
        }
        catch (Exception ex) {
            System.err.println("Main thread caught exception: " + ex);
            //ex.printStackTrace();
        }
        System.out.println("\nMain thread exiting normally.");
    }

    @Override
    public void run() {

        while (true) {
            try {
                System.out.println("Cancel thread is sleeping...");
                Thread.sleep(4000);
                System.out.println("Going to cancel channel with
consumerTag: " + consumerTag);
                // channel.basicCancel(consumerTag);
                channel.close();
                // channel.abort();
                System.out.println("\nCancelled channel with consumerTag: "
+ consumerTag);
            }
            catch (Exception ex) {
                System.err.println("SimpleConsumerCancel ex: " + ex);
                //ex.printStackTrace();
            }
        }

    }
}



Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Jan 14, 2010 at 6:24 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Jim,
>
> On Wed, Jan 13, 2010 at 02:06:57PM -0500, Jim Irrer wrote:
> > I have several consumers reading from the same queue.  I would like
> > to be able to interrupt their pending read to suspend and resume any
> > one of them.   I've played around with:
> >
> > Channel.basicCancel(consumerTag) : don't know how to resume
> > Channel.abort()    produces com.rabbitmq.client.ShutdownSignalException
> > Channel.close()   produces com.rabbitmq.client.ShutdownSignalException
> >
> > The close() and abort() methods seem to act about the same.  I can resume
> > reading from the queue by creating a new channel and a new
> QueueingConsumer.
> > I could not figure out how to resume after a basicCancel.
> >
> > Is using close() and then re-constructing the channel and
> QueueingConsumer
> > the right way to go?  Will resources be properly taken care of by garbage
> > collection?
>
> What I would do is set QoS prefetch to 1, and make sure that you're
> doing ack-ing manually (i.e. don't set noAck). Then, when you want to
> "suspend", just delay acking the last message you received. That'll
> prevent further messages being sent to you. Once you want to resume,
> send the ack and then the next message will be sent down to you. Does
> that help?
>
> > BTW - I use the consumerTag returned by Channel.basicConsume(queueName,
> > consumer)
> > for the argument to Channel.basicCancel, eg: *
> > amq.ctag-1m/H7+SDcZpbzTMgsUyhNg==* .
> > When called, it prints:
> >
> > Consumer null method handleCancelOk for channel AMQChannel(amqp://
> > guest at 172.20.125.34:5672/,1) threw an exception:
> > java.lang.NullPointerException
> >     at
> com.rabbitmq.client.impl.ChannelN$2.transformReply(ChannelN.java:728)
> >     at
> com.rabbitmq.client.impl.ChannelN$2.transformReply(ChannelN.java:721)
> >     at
> >
> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.handleCommand(AMQChannel.java:327)
> >     at
> >
> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:162)
> >     at
> com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
> >     at
> >
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:456)
>
> The Javadoc says:
>
>    /**
>     * Cancel a consumer. Calls the consumer's {@link
> Consumer#handleCancelOk}
>     * method before returning.
>     * @param consumerTag a client- or server-generated consumer tag to
> establish context
>     * @throws java.io.IOException if an error is encountered
>     * @see com.rabbitmq.client.AMQP.Basic.Cancel
>     * @see com.rabbitmq.client.AMQP.Basic.CancelOk
>     */
>    void basicCancel(String consumerTag) throws IOException;
>
> The DefaultConsumer does have the handleCancelOk filled in, and Consumer
> is an interface, so I'm a little alarmed by the possibility that it
> can't find the handleCancelOk method. What consumer class are you using?
> - in short, could you send us a small code example that exhibits this
> behaviour?
>
> Best wishes,
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100114/65aa8bcb/attachment.htm 

From matthew at lshift.net  Thu Jan 14 17:04:34 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 14 Jan 2010 17:04:34 +0000
Subject: [rabbitmq-discuss] suspending and resuming a QueueingConsumer
In-Reply-To: <3b6ef0791001140819m4c8865fbn7d75106eb9cb4e64@mail.gmail.com>
References: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>
	<20100114112459.GK18681@mrnibble.lshift.net>
	<3b6ef0791001140819m4c8865fbn7d75106eb9cb4e64@mail.gmail.com>
Message-ID: <20100114170434.GA2710@mrnibble.lshift.net>

Hi Jim,

On Thu, Jan 14, 2010 at 11:19:41AM -0500, Jim Irrer wrote:
> Matthew -
> 
> Thanks for trying but that does not really help.  I want to interrupt a
> free-running
> process that has already posted the read.  To explore this, I modified
> RabbitMQ's
> SimpleConsumer class (below) to post a read (via the nextDelivery method),
> and
> while it is waiting, have another thread close the channel.

Hmm. Could you explain why you're wanting to do this? I'm sufficiently
confused that I'm suspecting there's a better solution to the problem
you're trying to solve.

Matthew



From scottblanc at gmail.com  Thu Jan 14 17:47:01 2010
From: scottblanc at gmail.com (scott w)
Date: Thu, 14 Jan 2010 09:47:01 -0800
Subject: [rabbitmq-discuss] Page to disk feature
In-Reply-To: <20100114111631.GJ18681@mrnibble.lshift.net>
References: <401b577e1001130952r3219e99eg3f3351985538715f@mail.gmail.com>
	<20100114111631.GJ18681@mrnibble.lshift.net>
Message-ID: <401b577e1001140947k1362d3f1pc8852d322fee0a7f@mail.gmail.com>

Hi Matthew --

Thanks for that info. I will try it out.

cheers,
Scott

On Thu, Jan 14, 2010 at 3:16 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Scott,
>
> On Wed, Jan 13, 2010 at 09:52:11AM -0800, scott w wrote:
> > What is the status of the "page to disk" feature that will ensure the
> node
> > doesn't crash when the message exceed memory capacity? I realize it's not
> in
> > a stable release yet but is there a stable fix for it yet and if so what
> > patch do I need to download?
>
> You need to compile from source. If you grab our hg repo following the
> instructions on http://www.rabbitmq.com/build-server.html and before you
> make hg up -C bug21673
>
> Several people are using it and it is reasonably stable. However, there
> are occasional issues found which I very gratefully receive (especially
> if I can figure out how to reproduce them!). I'm always very interested
> to hear how people are getting on with the new persister - whether
> they're liking the behaviour they're seeing, so please do let us know.
>
> Best wishes,
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100114/de8094be/attachment.htm 

From irrer at umich.edu  Thu Jan 14 18:30:13 2010
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 14 Jan 2010 13:30:13 -0500
Subject: [rabbitmq-discuss] suspending and resuming a QueueingConsumer
In-Reply-To: <20100114170434.GA2710@mrnibble.lshift.net>
References: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>
	<20100114112459.GK18681@mrnibble.lshift.net>
	<3b6ef0791001140819m4c8865fbn7d75106eb9cb4e64@mail.gmail.com>
	<20100114170434.GA2710@mrnibble.lshift.net>
Message-ID: <3b6ef0791001141030n5f0c89d7wa948c05590289767@mail.gmail.com>

Matthew -

I'm trying to build an infrastructure on top of RabbitMQ that allows
an administrator to remotely suspend and resume a server.

Servers generally run in a loop, and in many cases spend most of
their time (very efficiently) waiting on read.  Given such a server,
we wish to suspend it before it processes another message.

If there are several servers reading from the same queue, and
we want to suspend one of them, and if we used the ack-ing manually
approach, then one message would be held by the suspended server
and could not be processed by any of the others.  We would like that
message to instead be processed by one of the other servers.  I suppose
that the suspended server could write the message back to the queue,
but that seems a little like a hack.

Sorry if I'm not being clear,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Jan 14, 2010 at 12:04 PM, Matthew Sackman <matthew at lshift.net>wrote:

> Hi Jim,
>
> On Thu, Jan 14, 2010 at 11:19:41AM -0500, Jim Irrer wrote:
> > Matthew -
> >
> > Thanks for trying but that does not really help.  I want to interrupt a
> > free-running
> > process that has already posted the read.  To explore this, I modified
> > RabbitMQ's
> > SimpleConsumer class (below) to post a read (via the nextDelivery
> method),
> > and
> > while it is waiting, have another thread close the channel.
>
> Hmm. Could you explain why you're wanting to do this? I'm sufficiently
> confused that I'm suspecting there's a better solution to the problem
> you're trying to solve.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100114/cda00295/attachment.htm 

From jdunck at gmail.com  Thu Jan 14 18:31:02 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Thu, 14 Jan 2010 12:31:02 -0600
Subject: [rabbitmq-discuss] AMQP.org down :-(
Message-ID: <2545a92c1001141031o1fc57588p7ff7ce03297d83fe@mail.gmail.com>

"
Non Clustered Confluence: Database is being updated by another
Confluence instance. Please see
http://confluence.atlassian.com/x/mwiyCg for troubleshooting.

Your server id is: AUTL-CQJB-0RGW-KY87.
"

Been that way since last night.



From Peter.Townsend at mflow.com  Thu Jan 14 18:35:04 2010
From: Peter.Townsend at mflow.com (Peter Townsend)
Date: Thu, 14 Jan 2010 18:35:04 +0000
Subject: [rabbitmq-discuss] .NET client hangs on BasicGet
In-Reply-To: <4B4F21E6.3030804@lshift.net>
References: <0357196CB603794BB76F4F6B373F2733036E2F4F5A@SERVER.ddnglobal.local>
	<4B4E0AAB.7060805@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5B@SERVER.ddnglobal.local>
	<4B4E1EB6.6000807@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F5D@SERVER.ddnglobal.local>
	<4B4E279E.3090005@lshift.net>
	<0357196CB603794BB76F4F6B373F2733036E2F4F7D@SERVER.ddnglobal.local>
	<4B4F21E6.3030804@lshift.net>
Message-ID: <0357196CB603794BB76F4F6B373F2733036E2F4FAD@SERVER.ddnglobal.local>

Hi Matthias,

The basic.get call from client to server is the final interaction before the client hangs.

1263466057457: conn#0 ch#1 -> {#method<basic.get>(ticket=0,queue=001.load.release.update,no-ack=false),null,""}

I'll get the compiling source code soon

Thanks
Pete

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 14 January 2010 13:54
To: Peter Townsend
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] .NET client hangs on BasicGet

Peter,

Peter Townsend wrote:
> The tracer output is attached.

So the interaction ...

1263466055492: conn#0 ch#1 -> 
{#method<basic.get>(ticket=0,queue=001.load.release.update,no-ack=false),null,""}
1263466055507: conn#0 ch#1 <- 
{#method<basic.get-ok>(delivery-tag=20,redelivered=false,exchange=amq.direct,routing-key=001.load.release.update,message-count=123),#contentHeader<basic>(content-type=null, 
content-encoding=null, headers=null, delivery-mode=2, priority=null, 
correlation-id=null, reply-to=null, expiration=null, message-id=null, 
timestamp=null, type=SupplierReleaseUpdate, user-id=null, app-id=null, 
cluster-id=null),"<MESSAGE>"}
1263466057457: conn#0 ch#1 -> 
{#method<basic.ack>(delivery-tag=20,multiple=false),null,""}
1263466057457: conn#0 ch#1 -> 
{#method<basic.get>(ticket=0,queue=001.load.release.update,no-ack=false),null,""}

... is the very last thing you see before it gets stuck? If so then that 
is very interesting since it would indicate that the server is failing 
to reply to the basic.get. Either that, or the reply from the server has 
gone astray.

The next step is getting your source code so I can try to reproduce your 
observations locally.

> I mentioned before that the consumer is hanging after the same
> messages each time. (As I have been reloading the same messages into the
> queue and reattempting the consumer run). Once the consumer passes
> message A it hangs. If I continue running it will soon hang after a
> different message B. If I reset and reload the queue and re-run the
> consumer it will hang after message A again.
> 
> Perhaps an issue with the message content? (binary serialized XML)

The message content is opaque to the server and the client library.

However, since you are running on Windows ... we have had some reports 
from people indicating that Windows may be interfering with XML 
payloads, resulting in all kinds of mysterious behaviours. So one 
possible thing to try is to encrypt your payloads.


Regards,

Matthias.



From alexis.richardson at gmail.com  Thu Jan 14 20:50:42 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 14 Jan 2010 20:50:42 +0000
Subject: [rabbitmq-discuss] AMQP.org down :-(
In-Reply-To: <2545a92c1001141031o1fc57588p7ff7ce03297d83fe@mail.gmail.com>
References: <2545a92c1001141031o1fc57588p7ff7ce03297d83fe@mail.gmail.com>
Message-ID: <167204d21001141250j3b4b70a2u2f9059e4d504ed6e@mail.gmail.com>

Thanks Jeremy.

It should be up again now.  There was some problem with the Confluence
instance of RDS that we (the AMQP WG) use for amqp.org.

alexis


On Thu, Jan 14, 2010 at 6:31 PM, Jeremy Dunck <jdunck at gmail.com> wrote:
> "
> Non Clustered Confluence: Database is being updated by another
> Confluence instance. Please see
> http://confluence.atlassian.com/x/mwiyCg for troubleshooting.
>
> Your server id is: AUTL-CQJB-0RGW-KY87.
> "
>
> Been that way since last night.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tsuraan at gmail.com  Thu Jan 14 22:06:50 2010
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 14 Jan 2010 16:06:50 -0600
Subject: [rabbitmq-discuss] 21673 never recovers from emfile
Message-ID: <84fb38e31001141406w3fa464e3o64dd0b9e7a711020@mail.gmail.com>

I accidentally had a process create about a thousand connections to
rabbit (branch bug21673, checkout from this morning or last night),
and rabbit ran out of available file descriptors.  I killed the rogue
process, which freed all the descriptors (I have about a thousand
lines of connection_closed_abruptly followed by the same number of
lines of closing TCP connection in my rabbit.log), but rabbit now
won't allow any new connections to be made to it.  I think the tcp
acceptor process must have died.  Strace on a python process that's
trying to make a rabbit connection ends with these lines:

connect(3, {sa_family=AF_INET, sin_port=htons(5672),
sin_addr=inet_addr("127.0.0.1")}, 16) = 0
fcntl(3, F_GETFL)                       = 0x2 (flags O_RDWR)
fcntl(3, F_SETFL, O_RDWR)               = 0
brk(0x19cf000)                          = 0x19cf000
sendto(3, "AMQP\1\1\t\1"..., 8, 0, NULL, 0) = 8
recvfrom(3,

Which seems to be an infinite wait for some response from rabbit.
I've attached my sasl.log.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mqueue at master-sasl.log
Type: text/x-log
Size: 12835 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100114/63f62a6e/attachment.bin 

From kpatel at egnyte.com  Thu Jan 14 22:38:53 2010
From: kpatel at egnyte.com (Kalpesh)
Date: Thu, 14 Jan 2010 16:38:53 -0600
Subject: [rabbitmq-discuss] Page to disk feature
In-Reply-To: <401b577e1001140947k1362d3f1pc8852d322fee0a7f@mail.gmail.com>
References: <401b577e1001130952r3219e99eg3f3351985538715f@mail.gmail.com>	<20100114111631.GJ18681@mrnibble.lshift.net>
	<401b577e1001140947k1362d3f1pc8852d322fee0a7f@mail.gmail.com>
Message-ID: <004301ca956a$59c19010$0d44b030$@com>

Hello Matthew,

 

One of my colleague just tried using the new Persister and the previous load
tests that were failing are now passing. Thanks for all the hard work on it.
We are now eagerly waiting for it to be released as GA.

 

Regards

------------------------------------------------
Kalpesh Patel 

Egnyte - your Cloud File Server
Big Technology; Small Price
sign up at http://www.egnyte.com

 

From: scott w [mailto:scottblanc at gmail.com] 
Sent: Thursday, January 14, 2010 11:47 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Page to disk feature

 

Hi Matthew --

Thanks for that info. I will try it out. 

cheers,
Scott

On Thu, Jan 14, 2010 at 3:16 AM, Matthew Sackman <matthew at lshift.net> wrote:

Hi Scott,


On Wed, Jan 13, 2010 at 09:52:11AM -0800, scott w wrote:
> What is the status of the "page to disk" feature that will ensure the node
> doesn't crash when the message exceed memory capacity? I realize it's not
in
> a stable release yet but is there a stable fix for it yet and if so what
> patch do I need to download?

You need to compile from source. If you grab our hg repo following the
instructions on http://www.rabbitmq.com/build-server.html and before you
make hg up -C bug21673

Several people are using it and it is reasonably stable. However, there
are occasional issues found which I very gratefully receive (especially
if I can figure out how to reproduce them!). I'm always very interested
to hear how people are getting on with the new persister - whether
they're liking the behaviour they're seeing, so please do let us know.

Best wishes,

Matthew


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100114/c1b80d7a/attachment.htm 

From bennet83 at gmail.com  Fri Jan 15 06:34:54 2010
From: bennet83 at gmail.com (bennet xavier)
Date: Fri, 15 Jan 2010 12:04:54 +0530
Subject: [rabbitmq-discuss] Can We Get the message again after delivering to
	consumer.
Message-ID: <dd54195e1001142234l51a1a739j86220566df45ee16@mail.gmail.com>

Hi ,

if message is delivered to consumer and consumer failed to save/operate that
message.

is it possible by a consumer to tell the rabbitMQ server only after the
intimation delete from the server.

My Problem:

after i receive the message, i have to do some DB operation, if DB operation
fails, i have to do the same operation with same message again.

if i can retain the message in server, it will be easy for me.

-- 
Fear, It Drives You Or Defeats You.

Bennet Xavier. X
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100115/f9c20724/attachment.htm 

From matthias at lshift.net  Fri Jan 15 10:30:34 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 15 Jan 2010 10:30:34 +0000
Subject: [rabbitmq-discuss] RabbitMQ/Stomp on Windows
In-Reply-To: <4B4F003D.1030300@gmx.net>
References: <4B0E41CD.6020909@gmx.net> <4B13ABA1.7000806@lshift.net>
	<26813626.post@talk.nabble.com> <4B4AEE5F.2060708@lshift.net>
	<4B4F003D.1030300@gmx.net>
Message-ID: <4B5043CA.8010602@lshift.net>

Michael,

Michael Justin wrote:
> Are there plans to release a binary version for Windows including the
> Stomp plugin so that no Linux box is required to try RabbitMQ with
> Stomp on Windows systems?

The plan is to release binary versions of the plug-ins, coordinated with 
server releases, once they graduate from 'experimental' to 'supported'. 
That's still some way off for all the plug-ins.

Regards,

Matthias.



From matthew at lshift.net  Fri Jan 15 12:24:16 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 15 Jan 2010 12:24:16 +0000
Subject: [rabbitmq-discuss] 21673 never recovers from emfile
In-Reply-To: <84fb38e31001141406w3fa464e3o64dd0b9e7a711020@mail.gmail.com>
References: <84fb38e31001141406w3fa464e3o64dd0b9e7a711020@mail.gmail.com>
Message-ID: <20100115122416.GB2710@mrnibble.lshift.net>

Hi,

On Thu, Jan 14, 2010 at 04:06:50PM -0600, tsuraan wrote:
> I accidentally had a process create about a thousand connections to
> rabbit (branch bug21673, checkout from this morning or last night),
> and rabbit ran out of available file descriptors.  I killed the rogue
> process, which freed all the descriptors (I have about a thousand
> lines of connection_closed_abruptly followed by the same number of
> lines of closing TCP connection in my rabbit.log), but rabbit now
> won't allow any new connections to be made to it.  I think the tcp
> acceptor process must have died.  Strace on a python process that's
> trying to make a rabbit connection ends with these lines:

Hmmm, interesting find. I don't think that this is related to the file
descriptor management that's going on in the new persister, but I'll
certainly test and see if I can reproduce.

Matthew



From matthew at lshift.net  Fri Jan 15 12:28:43 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 15 Jan 2010 12:28:43 +0000
Subject: [rabbitmq-discuss] suspending and resuming a QueueingConsumer
In-Reply-To: <3b6ef0791001141030n5f0c89d7wa948c05590289767@mail.gmail.com>
References: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>
	<20100114112459.GK18681@mrnibble.lshift.net>
	<3b6ef0791001140819m4c8865fbn7d75106eb9cb4e64@mail.gmail.com>
	<20100114170434.GA2710@mrnibble.lshift.net>
	<3b6ef0791001141030n5f0c89d7wa948c05590289767@mail.gmail.com>
Message-ID: <20100115122843.GC2710@mrnibble.lshift.net>

Hi Jim,

On Thu, Jan 14, 2010 at 01:30:13PM -0500, Jim Irrer wrote:
> Servers generally run in a loop, and in many cases spend most of
> their time (very efficiently) waiting on read.  Given such a server,
> we wish to suspend it before it processes another message.
> 
> If there are several servers reading from the same queue, and
> we want to suspend one of them, and if we used the ack-ing manually
> approach, then one message would be held by the suspended server
> and could not be processed by any of the others.  We would like that
> message to instead be processed by one of the other servers.  I suppose
> that the suspended server could write the message back to the queue,
> but that seems a little like a hack.

Ok, that makes sense. Is there a reason why you prefer suspending and
resuming rather than just stopping/killing a consumer and starting a new
one up?

>From your description, I'd have thought that closing the channel and
maybe connection too, is the way to go.

Matthew



From matthew at lshift.net  Fri Jan 15 12:36:28 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 15 Jan 2010 12:36:28 +0000
Subject: [rabbitmq-discuss] Can We Get the message again after
 delivering to consumer.
In-Reply-To: <dd54195e1001142234l51a1a739j86220566df45ee16@mail.gmail.com>
References: <dd54195e1001142234l51a1a739j86220566df45ee16@mail.gmail.com>
Message-ID: <20100115123628.GD2710@mrnibble.lshift.net>

Hi,

On Fri, Jan 15, 2010 at 12:04:54PM +0530, bennet xavier wrote:
> if message is delivered to consumer and consumer failed to save/operate that
> message.
> 
> is it possible by a consumer to tell the rabbitMQ server only after the
> intimation delete from the server.
> 
> My Problem:
> 
> after i receive the message, i have to do some DB operation, if DB operation
> fails, i have to do the same operation with same message again.
> 
> if i can retain the message in server, it will be easy for me.

If you are manually acking messages then the server will not forget
about the message until it has received the ack from you. If you fail to
ack a message and the client closes the channel or connection then the
message will be redelivered elsewhere.

RabbitMQ does not implement basic.reject so you can not use that to
explicitly ask the server to resend the message to some other consumer.

Matthew



From irrer at umich.edu  Fri Jan 15 13:46:27 2010
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 15 Jan 2010 08:46:27 -0500
Subject: [rabbitmq-discuss] suspending and resuming a QueueingConsumer
In-Reply-To: <20100115122843.GC2710@mrnibble.lshift.net>
References: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>
	<20100114112459.GK18681@mrnibble.lshift.net>
	<3b6ef0791001140819m4c8865fbn7d75106eb9cb4e64@mail.gmail.com>
	<20100114170434.GA2710@mrnibble.lshift.net>
	<3b6ef0791001141030n5f0c89d7wa948c05590289767@mail.gmail.com>
	<20100115122843.GC2710@mrnibble.lshift.net>
Message-ID: <3b6ef0791001150546r64c3d1aeuc9b918d382032ae@mail.gmail.com>

Matthew -

Ok - I think I'll go with the channel close approach.  I was
really just checking to make sure that I was not stressing
the API in a bad way.

Thanks for your advice,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jan 15, 2010 at 7:28 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Jim,
>
> On Thu, Jan 14, 2010 at 01:30:13PM -0500, Jim Irrer wrote:
> > Servers generally run in a loop, and in many cases spend most of
> > their time (very efficiently) waiting on read.  Given such a server,
> > we wish to suspend it before it processes another message.
> >
> > If there are several servers reading from the same queue, and
> > we want to suspend one of them, and if we used the ack-ing manually
> > approach, then one message would be held by the suspended server
> > and could not be processed by any of the others.  We would like that
> > message to instead be processed by one of the other servers.  I suppose
> > that the suspended server could write the message back to the queue,
> > but that seems a little like a hack.
>
> Ok, that makes sense. Is there a reason why you prefer suspending and
> resuming rather than just stopping/killing a consumer and starting a new
> one up?
>
> From your description, I'd have thought that closing the channel and
> maybe connection too, is the way to go.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100115/13296d7a/attachment.htm 

From jdunck at gmail.com  Fri Jan 15 14:16:02 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Fri, 15 Jan 2010 08:16:02 -0600
Subject: [rabbitmq-discuss] Fwd: Messages not consistently delivered to two
	consumers bound to same key
References: <2545a92c1001142142u7e7a14feg4e73c0cb49b6cdb9@mail.gmail.com>
Message-ID: <B8469918-C4E1-4357-8F19-7B85D16815AA@gmail.com>

Forwarded from the address I subscribed to the list with. :-/

Begin forwarded message:

> From: Jeremy Dunck <jeremy at radiotime.com>
> Date: January 14, 2010 11:42:25 PM CST
> To: rabbitmq-discuss at lists.rabbitmq.com
> Cc: Thomas Hutchings <thomas at radiotime.com>
> Subject: Messages not consistently delivered to two consumers bound  
> to same key
>

> I'm using Rabbit 1.7.0 w/ the .Net client.
>
> I am publishing messages with a routing key, say "A", and two queues
> bound to that routing key on a Direct exchange:
> _mqChannel.ExchangeDeclare(SHARED_EXCHANGE, ExchangeType.Direct,  
> NOT_DURABLE);
>
> (I've aliased the various boolean flags as variables so I can more
> easily maintain the code; I fnd a series of true/false literals pretty
> hard to remember.)
>
> I then have a basic consumer on each of the queues dispatching.
>
> It seems that messages published to A are being alternately delivered
> to the two queues, rather than consistently to both queues.
>
> Here's how I'm declaring and binding the queues (in separate  
> processes):
> _mqChannel.QueueDeclare(_busId, NOT_PASSIVE, NOT_DURABLE,
> NOT_EXCLUSIVE, AUTODELETE, WAIT, new Hashtable());
> _mqChannel.QueueBind(_busId, SHARED_EXCHANGE, "A", WAIT, null);
>
> I then have a basic consumer on each of the queues:
> var consumer = new QueueingBasicConsumer(_mqChannel);
> _mqChannel.BasicConsume(_busId, null, consumer);
> e = (BasicDeliverEventArgs)consumer.Queue.Dequeue();
> ...
> If it matters, I'm acknowledging messages is *both* consumers as  
> follows:
>
> _mqChannel.BasicAck(e.DeliveryTag, false);
>
>
> And here's how I'm publishing:
> _mqChannel.BasicPublish(SHARED_EXCHANGE, "A", MANDATORY,
> NOT_IMMEDIATE, props, <bytes>);
>
> I was wondering what might cause this behavior?
>
> While I'm here, are there any semantics to DeliveryTag?  It appears to
> be a sequentially-incrementing number, but it's not for all messages
> published -- is it per consumer?
>
> Just when I think I've got the hang of Rabbit, I find I'm still on
> shaky ground.  :-/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100115/5f5d7cb3/attachment.htm 

From tonyg at lshift.net  Fri Jan 15 14:35:19 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 15 Jan 2010 14:35:19 +0000
Subject: [rabbitmq-discuss] suspending and resuming a QueueingConsumer
In-Reply-To: <20100115122843.GC2710@mrnibble.lshift.net>
References: <3b6ef0791001131106v785dc590gbe1aef31fe06d9f6@mail.gmail.com>	<20100114112459.GK18681@mrnibble.lshift.net>	<3b6ef0791001140819m4c8865fbn7d75106eb9cb4e64@mail.gmail.com>	<20100114170434.GA2710@mrnibble.lshift.net>	<3b6ef0791001141030n5f0c89d7wa948c05590289767@mail.gmail.com>
	<20100115122843.GC2710@mrnibble.lshift.net>
Message-ID: <4B507D27.6010103@lshift.net>

Matthew Sackman wrote:
> From your description, I'd have thought that closing the channel and
> maybe connection too, is the way to go.

Closing the channel sounds like a reasonable thing to do.

Tony




From matthias at lshift.net  Fri Jan 15 14:50:56 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 15 Jan 2010 14:50:56 +0000
Subject: [rabbitmq-discuss] Fwd: Messages not consistently delivered to
 two	consumers bound to same key
In-Reply-To: <B8469918-C4E1-4357-8F19-7B85D16815AA@gmail.com>
References: <2545a92c1001142142u7e7a14feg4e73c0cb49b6cdb9@mail.gmail.com>
	<B8469918-C4E1-4357-8F19-7B85D16815AA@gmail.com>
Message-ID: <4B5080D0.1060009@lshift.net>

Jeremy,

Jeremy Dunck wrote:
>> I am publishing messages with a routing key, say "A", and two queues
>> bound to that routing key on a Direct exchange:
>> _mqChannel.ExchangeDeclare(SHARED_EXCHANGE, ExchangeType.Direct, 
>> NOT_DURABLE);
>> [...]
>> I then have a basic consumer on each of the queues dispatching.
>>
>> It seems that messages published to A are being alternately delivered
>> to the two queues, rather than consistently to both queues.

That definitely shouldn't happen, and indeed it can't - there is no code 
in the server that would alternate between queues when handling a publish.

Are you sure your consumers are consuming off different queues?

It might be helpful to hook up your code to the tracer - 
http://www.rabbitmq.com/examples.html#tracer. That will tell you exactly 
what commands are sent at the protocol level.

Also, can you post the complete code?


Regards,

Matthias.



From tsuraan at gmail.com  Fri Jan 15 15:57:00 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 15 Jan 2010 09:57:00 -0600
Subject: [rabbitmq-discuss] 21673 never recovers from emfile
In-Reply-To: <20100115122416.GB2710@mrnibble.lshift.net>
References: <84fb38e31001141406w3fa464e3o64dd0b9e7a711020@mail.gmail.com>
	<20100115122416.GB2710@mrnibble.lshift.net>
Message-ID: <84fb38e31001150757g6178b6ceu2278f15840b03ab6@mail.gmail.com>

> Hmmm, interesting find. I don't think that this is related to the file
> descriptor management that's going on in the new persister, but I'll
> certainly test and see if I can reproduce.

Ok, some better test conditions:

Start with a blank rabbit, updated as of this morning (latest
changeset is 2520:4e8508283ca5). Wipe out everything in the
/var/lib/rabbitmq/..., and started rabbit.  Run the following python
program (assuming that amqplib is installed):

from amqplib.client_0_8 import Connection
import sys

def main():
  conns = []
  while True:
    conns.append(Connection('localhost', 'guest', 'guest'))
    sys.stdout.write(".")
    sys.stdout.flush()

if __name__ == "__main__":
  main()

That will run for a while and then hang; I get about 12.5 lines of
output.  At this point, rabbit will print "Erlang has closed", and the
bottom of the node at host.log file will say something like:

=ERROR REPORT==== 15-Jan-2010::09:43:58 ===
** Generic server <0.198.0> terminating
** Last message in was {inet_async,#Port<0.2423>,9030,{ok,#Port<0.9952>}}
** When Server state == none
** Reason for termination ==
** {cannot_accept,{error,emfile}}

At this point, you can never connect again, even if you kill the hog
process that has all of erlang's file descriptors tied up.  Actually,
the last time I ran this test, I also got the following errors:

=ERROR REPORT==== 15-Jan-2010::09:46:08 ===
Mnesia(mqueue at master): ** ERROR ** (core dumped to file:
".../MnesiaCore.mqueue at master_1263_570368_405389")
 ** FATAL ** Cannot open log file ".../rabbit_durable_exchange.DCL":
{file_error,

                       ".../rabbit_durable_exchange.DCL",

                       emfile}

=ERROR REPORT==== 15-Jan-2010::09:46:08 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,<0.92.0>,
                       {<0.95.0>,
                        "Mnesia(~p): ** ERROR ** (core dumped to file:
~p)~n ** FATAL ** Cannot open log file ~p: ~p~n",
                        [mqueue at master,
                         ".../MnesiaCore.mqueue at master_1263_570368_405389",
                         ".../rabbit_durable_exchange.DCL",
                         {file_error,
                             ".../rabbit_durable_exchange.DCL",
                             emfile}]}}
** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
** Reason == {aborted,
                 {no_exists,
                     [rabbit_exchange,
                      {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}]}}

=INFO REPORT==== 15-Jan-2010::09:46:08 ===
    application: mnesia
    exited: shutdown
    type: temporary

So I guess running out of file descriptors is just plain bad.  I think
that the tcp acceptor needs to start rejecting connection attempts one
rabbit only has a dozen or so file descriptors remaining.  It doesn't
look like erlang has a getrlimit function, but there should be some
way to do it.  Anyhow, I hope that helps.



From matthew at lshift.net  Fri Jan 15 16:09:59 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 15 Jan 2010 16:09:59 +0000
Subject: [rabbitmq-discuss] 21673 never recovers from emfile
In-Reply-To: <84fb38e31001150757g6178b6ceu2278f15840b03ab6@mail.gmail.com>
References: <84fb38e31001141406w3fa464e3o64dd0b9e7a711020@mail.gmail.com>
	<20100115122416.GB2710@mrnibble.lshift.net>
	<84fb38e31001150757g6178b6ceu2278f15840b03ab6@mail.gmail.com>
Message-ID: <20100115160958.GG2710@mrnibble.lshift.net>

On Fri, Jan 15, 2010 at 09:57:00AM -0600, tsuraan wrote:
> > Hmmm, interesting find. I don't think that this is related to the file
> > descriptor management that's going on in the new persister, but I'll
> > certainly test and see if I can reproduce.
> 
> Ok, some better test conditions:

Many thanks for these. The Erlang VM gets very upset when it runs out of
available file descriptors. The safest thing to do is just to massively
raise the limit through ulimit. That said, we do have some plans to be
able to artificially limit the number of FDs Rabbit is using to a little
less than the actual limit. This would allow Rabbit to successfully
refuse new connections when it gets to this artificial limit, and leave
enough FDs around for the VM to continue with.

Matthew



From scott.brooks at epicadvertising.com  Fri Jan 15 16:18:39 2010
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Fri, 15 Jan 2010 10:18:39 -0600
Subject: [rabbitmq-discuss] 21673 never recovers from emfile
In-Reply-To: <20100115160958.GG2710@mrnibble.lshift.net>
References: <84fb38e31001141406w3fa464e3o64dd0b9e7a711020@mail.gmail.com>
	<20100115122416.GB2710@mrnibble.lshift.net>
	<84fb38e31001150757g6178b6ceu2278f15840b03ab6@mail.gmail.com>
	<20100115160958.GG2710@mrnibble.lshift.net>
Message-ID: <95163FEE-4B99-49C0-BC2E-046E71A75804@epicadvertising.com>

On 2010-01-15, at 11:09 AM, Matthew Sackman wrote:

> On Fri, Jan 15, 2010 at 09:57:00AM -0600, tsuraan wrote:
>>> Hmmm, interesting find. I don't think that this is related to the file
>>> descriptor management that's going on in the new persister, but I'll
>>> certainly test and see if I can reproduce.
>> 
>> Ok, some better test conditions:
> 
> Many thanks for these. The Erlang VM gets very upset when it runs out of
> available file descriptors. The safest thing to do is just to massively
> raise the limit through ulimit. That said, we do have some plans to be
> able to artificially limit the number of FDs Rabbit is using to a little
> less than the actual limit. This would allow Rabbit to successfully
> refuse new connections when it gets to this artificial limit, and leave
> enough FDs around for the VM to continue with.
> 
> Matthew

Can you confirm if this bug exists in 1.7.0?
We have seen some rare crashes that look similar to this on 1.7.0.

Thanks

---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
scott.brooks at epicadvertising.com




From matthew at lshift.net  Fri Jan 15 16:28:34 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 15 Jan 2010 16:28:34 +0000
Subject: [rabbitmq-discuss] 21673 never recovers from emfile
In-Reply-To: <95163FEE-4B99-49C0-BC2E-046E71A75804@epicadvertising.com>
References: <84fb38e31001141406w3fa464e3o64dd0b9e7a711020@mail.gmail.com>
	<20100115122416.GB2710@mrnibble.lshift.net>
	<84fb38e31001150757g6178b6ceu2278f15840b03ab6@mail.gmail.com>
	<20100115160958.GG2710@mrnibble.lshift.net>
	<95163FEE-4B99-49C0-BC2E-046E71A75804@epicadvertising.com>
Message-ID: <20100115162834.GH2710@mrnibble.lshift.net>

On Fri, Jan 15, 2010 at 10:18:39AM -0600, Scott Brooks wrote:
> On 2010-01-15, at 11:09 AM, Matthew Sackman wrote:
> 
> > On Fri, Jan 15, 2010 at 09:57:00AM -0600, tsuraan wrote:
> >>> Hmmm, interesting find. I don't think that this is related to the file
> >>> descriptor management that's going on in the new persister, but I'll
> >>> certainly test and see if I can reproduce.
> >> 
> >> Ok, some better test conditions:
> > 
> > Many thanks for these. The Erlang VM gets very upset when it runs out of
> > available file descriptors. The safest thing to do is just to massively
> > raise the limit through ulimit. That said, we do have some plans to be
> > able to artificially limit the number of FDs Rabbit is using to a little
> > less than the actual limit. This would allow Rabbit to successfully
> > refuse new connections when it gets to this artificial limit, and leave
> > enough FDs around for the VM to continue with.
> > 
> > Matthew
> 
> Can you confirm if this bug exists in 1.7.0?
> We have seen some rare crashes that look similar to this on 1.7.0.

The same behaviour exists in 1.7.0 - the issue is the Erlang VM blowing
up at some random point. It's not really a bug per se - I wouldn't
expect Java or .Net VMs to do particularly well when they run out of
file descriptors either. If you are seeing this, you should raise the
limit on the number of FDs available to Rabbit.

Matthew



From jdunck at gmail.com  Sat Jan 16 04:08:49 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Fri, 15 Jan 2010 22:08:49 -0600
Subject: [rabbitmq-discuss] Rabbit crash
Message-ID: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>

A Rabbit daemon just crashed for me.  This is 1.7.0 running as a
service on a 64-bit Windows Server 2008.

I have an erlang crash log, but unfortunately lost Rabbit's log
because I started the service in haste, and forgot that I have Rabbit
configured to reuse the logs.

I've attached the crash log.  The slogan is: --
Kernel pid terminated (application_controller)
({application_terminated,kernel,shutdown})

I'm sure the service wasn't shut down, so must have been a crash.  Any
pointers welcome.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erlang-crash.zip
Type: application/zip
Size: 85988 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100115/498a6ae8/attachment.zip 

From bsullivan at lindenlab.com  Mon Jan 18 05:49:08 2010
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Sun, 17 Jan 2010 21:49:08 -0800
Subject: [rabbitmq-discuss] message stats from a given node
Message-ID: <b93cb8621001172149p4e69fe3ekcdd1872d63ff21ea@mail.gmail.com>

Hi,

I was wondering if there are any good ideas out there for tracking message
rates on a given cluster (in our use case, it's mostly topic-routed
messages).  We have been using RabbitMQ for a while now, and have been
limited to tracking stats via a consumer that effectively subscribes to '#'
and simply breaks down these stats by topic.

This works ok until the message volumes get pretty heavy - the node that the
client connects to has to be routed all messages on the cluster, and this
breaks down the scalability model for RabbitMQ - eventually that node will
be a bottleneck.

I asked this question a year or two back during our initial implementation
and was curious to know if there have been any changes since then that makes
this easier/more scalable.  Ideally, each node should be able to track it's
own statistics, which could then be collected.

Is there a way to ask a node to only route traffic that is published
directly to it?  Meaning, a way to set up a binding for only local node
traffic, nothing forwarded from other nodes in the cluster?

Any tips here would be appreciated.

Thanks!
Brian

ps: Tony - I am still looking at that code you sent me, this question is
something unrelated that I am re-pondering in my test cluster.  ;)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100117/821f46f7/attachment.htm 

From james.anderson at setf.de  Mon Jan 18 13:13:58 2010
From: james.anderson at setf.de (james anderson)
Date: Mon, 18 Jan 2010 14:13:58 +0100
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
Message-ID: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>

good morning;

if one has data of finite length, but for which the eventual content  
size is unknown at the outset, (how) is it intended to communicate it  
through amqp? while it would be possible to chunk it in messages, it  
is not clear how one would indicate that the data is complete. from  
the description of queue.delete, one might conclude that, once the  
content was sent, one could delete with no-wait disabled and if-empty  
enabled, but
a, would that even work?
b, it makes queues into single-use entities.
c, it misuses an exception, which should be signal an error, to  
indicate the end of the stream.

how is one intended to accomplish this without buffering the content  
at the source in order to determine the message content size?

thanks,




From jdunck at gmail.com  Mon Jan 18 18:04:49 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Mon, 18 Jan 2010 12:04:49 -0600
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>
References: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>
Message-ID: <2545a92c1001181004y1fb8499ar54ab55fc12746891@mail.gmail.com>

OK, no fair asking Friday night.  Now that it's Monday morning, any ideas? :-/

On Fri, Jan 15, 2010 at 10:08 PM, Jeremy Dunck <jdunck at gmail.com> wrote:
> A Rabbit daemon just crashed for me. ?This is 1.7.0 running as a
> service on a 64-bit Windows Server 2008.
>
> I have an erlang crash log, but unfortunately lost Rabbit's log
> because I started the service in haste, and forgot that I have Rabbit
> configured to reuse the logs.
>
> I've attached the crash log. ?The slogan is: --
> Kernel pid terminated (application_controller)
> ({application_terminated,kernel,shutdown})
>
> I'm sure the service wasn't shut down, so must have been a crash. ?Any
> pointers welcome.
>



From matthias at lshift.net  Mon Jan 18 18:24:45 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 18 Jan 2010 18:24:45 +0000
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>
References: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>
Message-ID: <4B54A76D.5000200@lshift.net>

Jeremy,

Jeremy Dunck wrote:
> I have an erlang crash log

Unfortunately in this instance that doesn't tell us much, except that it 
looks like rabbit *didn't* run out of memory or fail with a 
configuration error, which are the most common causes of crashes we see.

> but unfortunately lost Rabbit's log because I started the service in
> haste, and forgot that I have Rabbit configured to reuse the logs.

The rabbitmq-server.BAT startup script appends the old log to 
rabbit.log.1. Did that not happen?

Anyway, next time (which is hopefully never ;) please send a copy of the 
rabbit.log and rabbit-sasl.log, as well as the crash dump.


Regards,

Matthias.



From rtrlists at googlemail.com  Mon Jan 18 18:29:02 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 18 Jan 2010 18:29:02 +0000
Subject: [rabbitmq-discuss] Who is using rabbit?
In-Reply-To: <757cc9481001140600s253f5de8ya5af201085ddd471@mail.gmail.com>
References: <757cc9481001131235v3e33adc9xa2a6f9c4209d1826@mail.gmail.com>
	<ce2570e21001131438k7ff39af5k27039d69d2afb761@mail.gmail.com>
	<2545a92c1001131444p2fe7e2efv4a8169c453cb60b@mail.gmail.com>
	<757cc9481001140600s253f5de8ya5af201085ddd471@mail.gmail.com>
Message-ID: <6a3ae47e1001181029k2904dc9fl5733b38bb094f745@mail.gmail.com>

We use RabbitMQ 1.6 (yeah, need to move on, I know ;-) at Axios Systems Plc
for internal messaging in our Integration Framework. Mostly used to decouple
DB activities from business logic events and also to drive some load
balancing of business logic snippets. We use Erlang to control business
logic written in Lua and access to the main enterprise app via a Java node.

Haven't yet come across any issues, but we've only started down this route
about 6 months ago. First production installation is currently in UAT.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100118/62316390/attachment.htm 

From jdunck at gmail.com  Mon Jan 18 19:22:30 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Mon, 18 Jan 2010 13:22:30 -0600
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <4B54A76D.5000200@lshift.net>
References: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>
	<4B54A76D.5000200@lshift.net>
Message-ID: <2545a92c1001181122k64c77059hdf4e321c2d9977dd@mail.gmail.com>

On Mon, Jan 18, 2010 at 12:24 PM, Matthias Radestock
<matthias at lshift.net> wrote:
...
>> but unfortunately lost Rabbit's log because I started the service in
>> haste, and forgot that I have Rabbit configured to reuse the logs.
>
> The rabbitmq-server.BAT startup script appends the old log to rabbit.log.1.
> Did that not happen?

There's no init.d for Windows and it has to be restarted every
Tuesday, so I'm not using the .bat file.  :-)

I'm running Rabbit as an NT service.  Registering Rabbit as a service
using  rabbitmq-service.bat didn't work for me-- there were problems
with escaping correctly for DOS vs. Erlang, and I ended up manually
hacking the registry to get it to run at all.  Unfortunately, it
doesn't seem to rotate logs.

> Anyway, next time (which is hopefully never ;) please send a copy of the
> rabbit.log and rabbit-sasl.log, as well as the crash dump.

It turns out that I've been using the .Net client incorrectly -- I've
been publishing (and consuming with basic.consume) using a single
IModel from multiple threads.  This is specifically pointed out as
something to be avoided in the User Guide, so it may be my fault for
crashing the server.

Even so, I'd think that it's a server bug for any client input to be
able to crash the server (other than OOM from pending messages, etc.)
:-)

I'm going to try to work up a sample project that is capable of
crashing the server.  I'll let you know.



From matthias at lshift.net  Mon Jan 18 19:35:14 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 18 Jan 2010 19:35:14 +0000
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <2545a92c1001181122k64c77059hdf4e321c2d9977dd@mail.gmail.com>
References: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>	
	<4B54A76D.5000200@lshift.net>
	<2545a92c1001181122k64c77059hdf4e321c2d9977dd@mail.gmail.com>
Message-ID: <4B54B7F2.7040000@lshift.net>

Jeremy,

Jeremy Dunck wrote:
> I'm running Rabbit as an NT service.  Registering Rabbit as a service
> using  rabbitmq-service.bat didn't work for me-- there were problems
> with escaping correctly for DOS vs. Erlang, and I ended up manually
> hacking the registry to get it to run at all.  Unfortunately, it
> doesn't seem to rotate logs.

True, rabbitmq-service doesn't rotate logs.

re escaping... we have fixed all known escaping issues in 
rabbitmq-service.bat; the changes will be in 1.7.1. Meanwhile you can 
download the latest version from
http://hg.rabbitmq.com/rabbitmq-server/raw-file/v1_7/scripts/rabbitmq-service.bat

> It turns out that I've been using the .Net client incorrectly -- I've
> been publishing (and consuming with basic.consume) using a single
> IModel from multiple threads.  This is specifically pointed out as
> something to be avoided in the User Guide, so it may be my fault for
> crashing the server.

That wouldn't crash the server. The worst thing that can happen is that 
the client ends up sending some garbage, which will cause the server to 
report an error and close the offending connection.


Regards,

Matthias.



From jdunck at gmail.com  Mon Jan 18 19:47:12 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Mon, 18 Jan 2010 13:47:12 -0600
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <4B54B7F2.7040000@lshift.net>
References: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>
	<4B54A76D.5000200@lshift.net>
	<2545a92c1001181122k64c77059hdf4e321c2d9977dd@mail.gmail.com>
	<4B54B7F2.7040000@lshift.net>
Message-ID: <2545a92c1001181147l6af928edp44c198a88f20ce56@mail.gmail.com>

On Mon, Jan 18, 2010 at 1:35 PM, Matthias Radestock <matthias at lshift.net> wrote:
...
(Sorry, I meant to reply to this, too.)

>> It turns out that I've been using the .Net client incorrectly -- I've
>> been publishing (and consuming with basic.consume) using a single
>> IModel from multiple threads. ?This is specifically pointed out as
>> something to be avoided in the User Guide, so it may be my fault for
>> crashing the server.
>
> That wouldn't crash the server. The worst thing that can happen is that the
> client ends up sending some garbage, which will cause the server to report
> an error and close the offending connection.

Unfortunately that leaves me with a mystery.  :-)  I'm still gonna try
to reproduce, because I don't really want to put it back in prod
without feeling good about its chances.



From matthias at lshift.net  Mon Jan 18 19:55:58 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 18 Jan 2010 19:55:58 +0000
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <2545a92c1001181146t4d080c2pb9b35ea18bcd7496@mail.gmail.com>
References: <2545a92c1001152008hdb51a0cr16cac4d630c99c2c@mail.gmail.com>	
	<4B54A76D.5000200@lshift.net>	
	<2545a92c1001181122k64c77059hdf4e321c2d9977dd@mail.gmail.com>	
	<4B54B7F2.7040000@lshift.net>
	<2545a92c1001181146t4d080c2pb9b35ea18bcd7496@mail.gmail.com>
Message-ID: <4B54BCCE.10303@lshift.net>

Jeremy,

Jeremy Dunck wrote:
> On Mon, Jan 18, 2010 at 1:35 PM, Matthias Radestock <matthias at lshift.net> wrote:
> ...
>> re escaping... we have fixed all known escaping issues in
>> rabbitmq-service.bat; the changes will be in 1.7.1. Meanwhile you can
>> download the latest version from
>> http://hg.rabbitmq.com/rabbitmq-server/raw-file/v1_7/scripts/rabbitmq-service.bat
> 
> Sweet.  I just tried it out.
> 
> There's still a small bug; the service installs with this:
> ERL_CRASH_DUMP=C:/Documents and Settings/Administrator/Application
> Data/RabbitMQ/log
> If/when Erlang crashes, it writes a text file named "log" in the
> RabbitMQ directory.
> 
> But the rest of the config expects "log" to be a directory, as here:
> C:/Documents and Settings/Administrator/Application Data/RabbitMQ/log/rabbit.log
> 
> Perhaps it'd be better to set to something like:
> ERL_CRASH_DUMP=C:/Documents and Settings/Administrator/Application
> Data/RabbitMQ/crash.log
> ?

Well spotted. I have filed a bug to get that fixed in 1.7.1.


Matthias.



From matthias at lshift.net  Tue Jan 19 07:57:01 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 19 Jan 2010 07:57:01 +0000
Subject: [rabbitmq-discuss] message stats from a given node
In-Reply-To: <b93cb8621001172149p4e69fe3ekcdd1872d63ff21ea@mail.gmail.com>
References: <b93cb8621001172149p4e69fe3ekcdd1872d63ff21ea@mail.gmail.com>
Message-ID: <4B5565CD.7070709@lshift.net>

Brian,

Brian Sullivan wrote:
> I was wondering if there are any good ideas out there for tracking 
> message rates on a given cluster (in our use case, it's mostly 
> topic-routed messages).  We have been using RabbitMQ for a while now, 
> and have been limited to tracking stats via a consumer that effectively 
> subscribes to '#' and simply breaks down these stats by topic.

So the information you are interested in is "average number of messages 
per second published, per routing key and time period", correct?

> This works ok until the message volumes get pretty heavy - the node that 
> the client connects to has to be routed all messages on the cluster, and 
> this breaks down the scalability model for RabbitMQ - eventually that 
> node will be a bottleneck.

One thing you could do at the AMQP level is introduce stat-collecting 
proxies between the publishers and the brokers. Take a look at the 
RabbitMQ tracer in src/com/rabbitmq/tools/Tracer.java in the 
rabbitmq-java-client repo for an example of a proxy.

Another route is via the "pluggable exchange types" we have under 
development - see the bug22169 branch in the rabbitmq-server hg repo. 
That would allow you to define a custom exchange type that works just 
like an ordinary topic (or other) exchange but collects stats on 
publishes on a per-node basis. In the simplest case this could just dump 
a timestamp and routing key to a file, leaving the actual statistics 
calculations to some other program. Or, at the other extreme, the custom 
exchange could compute per-node stats itself and, furthermore, 
participate in the collation of stats from multiple nodes, using the 
distributed computing features Erlang puts at your disposal.


Regards,

Matthias.



From matthias at lshift.net  Tue Jan 19 08:17:07 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 19 Jan 2010 08:17:07 +0000
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
In-Reply-To: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>
References: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>
Message-ID: <4B556A83.6010104@lshift.net>

James,

james anderson wrote:
> if one has data of finite length, but for which the eventual content  
> size is unknown at the outset, (how) is it intended to communicate it  
> through amqp? while it would be possible to chunk it in messages, it  
> is not clear how one would indicate that the data is complete.

You could simply specially mark the message carrying the last chunk. Or 
have a separate "End of Stream" message.


Regards,

Matthias.



From johndapps at gmail.com  Tue Jan 19 09:22:29 2010
From: johndapps at gmail.com (John Apps)
Date: Tue, 19 Jan 2010 10:22:29 +0100
Subject: [rabbitmq-discuss] Running StressPersister.java client against
	RabbitMQ and finding the stress_persister.log file is being
	"beaten to death"
In-Reply-To: <mailman.163.1263575637.22012.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.163.1263575637.22012.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <173a1edc1001190122n397911c2occ9fba9c028385e8@mail.gmail.com>

What parameters should one tweak in order to reduce the I/O to the log file
in the StressPersister test? And others with similar behaviour, of course.

The file grows to about 140MB using the default StressPersister parameters,
only to be renamed to stress_persister.log.previous and the whole cycle
starts again.
With smaller parameters than the default, i.e., smaller message size, lower
backlog etc., the pattern is the same, but the frequency with which the log
is renamed and recreated is faster.

What would be ideal would be to be able to specify an initial (large)
allocation for the file (so it does not extend it all the time) along with
an extension quantity, should it have to be extended. In addition, if one
could specify how much should be retained in memory prior to be flushed to
disk, that would also make things move along.

I have looked at a few mnesia and Erlang parameters but have not found the
right mix yet.

In case anyone asks, this is running Erlang (BEAM) emulator version 5.7 on
OpenVMS using Java 5.0 for the client.

Cheers, John
---
John Apps
(49) 171 869 1813
Sent from Traunstein, BY, Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100119/e2631db9/attachment.htm 

From john.apps at hp.com  Tue Jan 19 10:04:55 2010
From: john.apps at hp.com (Apps, John)
Date: Tue, 19 Jan 2010 10:04:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ qualifiers "-rabbit xxx". Where are
	they documented?
Message-ID: <7F7AFB31365CC143A50E6370FCCFDFC959FD7C825F@GVW1163EXB.americas.hpqcorp.net>

I am probably being rather blind, but have been unable to find where the RabbitMQ qualifiers are documented, whether on the command line or in the configuration file.

-- John Apps | HP EMEA MFA | John.Apps at HP.com | +491718691813 | http://bit.ly/8DFOYp --





From james.anderson at setf.de  Tue Jan 19 10:51:24 2010
From: james.anderson at setf.de (james anderson)
Date: Tue, 19 Jan 2010 11:51:24 +0100
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
In-Reply-To: <4B556A83.6010104@lshift.net>
References: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>
	<4B556A83.6010104@lshift.net>
Message-ID: <13BC2E82-FA58-4F24-813C-69C1F8874C36@setf.de>

good morning;

On 2010-01-19, at 09:17 , Matthias Radestock wrote:

> James,
>
> james anderson wrote:
>> if one has data of finite length, but for which the eventual  
>> content  size is unknown at the outset, (how) is it intended to  
>> communicate it  through amqp? while it would be possible to chunk  
>> it in messages, it  is not clear how one would indicate that the  
>> data is complete.
>
> You could simply specially mark the message carrying the last  
> chunk. Or have a separate "End of Stream" message.

if it were clear how to do this out-of-band, that would work.

as i read the 0-10 description, messages are not fixed size, but  
rather the fragments are, and together with the first/last fragment  
properties 'eventual' sizing is accomplished in a clear way.

for 0-8|9 it is not clear where this information would travel safely.  
no publish argument permits the sender to specify a value - unless  
one overloads the routing key. the equivalent "place", the body  
header properties for basic class content uses 14 of the first 15. is  
it acceptable to add properties to the content header?




From matthias at lshift.net  Tue Jan 19 10:56:56 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 19 Jan 2010 10:56:56 +0000
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
In-Reply-To: <13BC2E82-FA58-4F24-813C-69C1F8874C36@setf.de>
References: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>	<4B556A83.6010104@lshift.net>
	<13BC2E82-FA58-4F24-813C-69C1F8874C36@setf.de>
Message-ID: <4B558FF8.3000101@lshift.net>

James,

james anderson wrote:
> On 2010-01-19, at 09:17 , Matthias Radestock wrote:
>> You could simply specially mark the message carrying the last  
>> chunk. Or have a separate "End of Stream" message.
> 
> if it were clear how to do this out-of-band, that would work.

You'd do it all at the application level, i.e. you'd break the data into 
chunks and transmit each chunk as a separate AMQP message.

This has nothing to do with AMQP fragmentation.


Regards,

Matthias.



From james.anderson at setf.de  Tue Jan 19 11:07:27 2010
From: james.anderson at setf.de (james anderson)
Date: Tue, 19 Jan 2010 12:07:27 +0100
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
In-Reply-To: <4B558FF8.3000101@lshift.net>
References: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>	<4B556A83.6010104@lshift.net>
	<13BC2E82-FA58-4F24-813C-69C1F8874C36@setf.de>
	<4B558FF8.3000101@lshift.net>
Message-ID: <8A739A05-3207-4083-95ED-F1F2B469D324@setf.de>

good morning;

On 2010-01-19, at 11:56 , Matthias Radestock wrote:

> James,
>
> james anderson wrote:
>> On 2010-01-19, at 09:17 , Matthias Radestock wrote:
>>> You could simply specially mark the message carrying the last   
>>> chunk. Or have a separate "End of Stream" message.
>> if it were clear how to do this out-of-band, that would work.
>
> You'd do it all at the application level, i.e. you'd break the data  
> into chunks and transmit each chunk as a separate AMQP message.
>
> This has nothing to do with AMQP fragmentation.

where there is no facility for it, most definitely.

standard practice is to include such indicators in the message  
content body?





From matthias at lshift.net  Tue Jan 19 11:18:23 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 19 Jan 2010 11:18:23 +0000
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
In-Reply-To: <8A739A05-3207-4083-95ED-F1F2B469D324@setf.de>
References: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>	<4B556A83.6010104@lshift.net>	<13BC2E82-FA58-4F24-813C-69C1F8874C36@setf.de>	<4B558FF8.3000101@lshift.net>
	<8A739A05-3207-4083-95ED-F1F2B469D324@setf.de>
Message-ID: <4B5594FF.5080304@lshift.net>

James,

james anderson wrote:
> standard practice is to include such indicators in the message  
> content body?

I don't think enough people have done this to consider anything to be 
standard practice ;)

You could add an entry to the "headers" basic content property, an AMQP 
table which is the generic place for apps to stash k/v pairs.


Matthias.



From james.anderson at setf.de  Tue Jan 19 11:37:51 2010
From: james.anderson at setf.de (james anderson)
Date: Tue, 19 Jan 2010 12:37:51 +0100
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
In-Reply-To: <4B5594FF.5080304@lshift.net>
References: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>	<4B556A83.6010104@lshift.net>	<13BC2E82-FA58-4F24-813C-69C1F8874C36@setf.de>	<4B558FF8.3000101@lshift.net>
	<8A739A05-3207-4083-95ED-F1F2B469D324@setf.de>
	<4B5594FF.5080304@lshift.net>
Message-ID: <3EE999C2-6417-4278-8500-B8107C694DA8@setf.de>

good morning;

On 2010-01-19, at 12:18 , Matthias Radestock wrote:

> James,
>
> james anderson wrote:
>> standard practice is to include such indicators in the message   
>> content body?
>
> I don't think enough people have done this to consider anything to  
> be standard practice ;)
>
> You could add an entry to the "headers" basic content property, an  
> AMQP table which is the generic place for apps to stash k/v pairs.

yes, that was my original question.
such a practice would be standard enough that, so long as it was an  
additional property (for 0-9r1 property #15), a conforming server  
would not reject the message _and_ would be required to pass it through?





From matthias at lshift.net  Tue Jan 19 11:47:44 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 19 Jan 2010 11:47:44 +0000
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
In-Reply-To: <3EE999C2-6417-4278-8500-B8107C694DA8@setf.de>
References: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>	<4B556A83.6010104@lshift.net>	<13BC2E82-FA58-4F24-813C-69C1F8874C36@setf.de>	<4B558FF8.3000101@lshift.net>	<8A739A05-3207-4083-95ED-F1F2B469D324@setf.de>	<4B5594FF.5080304@lshift.net>
	<3EE999C2-6417-4278-8500-B8107C694DA8@setf.de>
Message-ID: <4B559BE0.2080709@lshift.net>

james anderson wrote:
> On 2010-01-19, at 12:18 , Matthias Radestock wrote:
>> You could add an entry to the "headers" basic content property, an  
>> AMQP table which is the generic place for apps to stash k/v pairs.
> 
> yes, that was my original question.
> such a practice would be standard enough that, so long as it was an  
> additional property (for 0-9r1 property #15), a conforming server  
> would not reject the message _and_ would be required to pass it through?

I was suggesting you use the existing 'headers' property, which itself 
is a table and specifically there for application use.

Generally brokers are meant to pass through all properties unaltered.


Matthias.



From gmr at myyearbook.com  Tue Jan 19 13:48:20 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 19 Jan 2010 08:48:20 -0500
Subject: [rabbitmq-discuss] message stats from a given node
In-Reply-To: <4B5565CD.7070709@lshift.net>
References: <b93cb8621001172149p4e69fe3ekcdd1872d63ff21ea@mail.gmail.com> 
	<4B5565CD.7070709@lshift.net>
Message-ID: <af1bce591001190548m27c19fc1p81c17cefa4f12450@mail.gmail.com>

One thing that would be cool is a counter could be added per queue (at
least) that increments per message delivered.  If we could pull that out
like queue depth using rabbitmqctl or Alice, it would go a long way to
getting deeper metrics into behavior.

On Tue, Jan 19, 2010 at 2:57 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Brian,
>
> Brian Sullivan wrote:
> > I was wondering if there are any good ideas out there for tracking
> > message rates on a given cluster (in our use case, it's mostly
> > topic-routed messages).  We have been using RabbitMQ for a while now,
> > and have been limited to tracking stats via a consumer that effectively
> > subscribes to '#' and simply breaks down these stats by topic.
>
> So the information you are interested in is "average number of messages
> per second published, per routing key and time period", correct?
>
> > This works ok until the message volumes get pretty heavy - the node that
> > the client connects to has to be routed all messages on the cluster, and
> > this breaks down the scalability model for RabbitMQ - eventually that
> > node will be a bottleneck.
>
> One thing you could do at the AMQP level is introduce stat-collecting
> proxies between the publishers and the brokers. Take a look at the
> RabbitMQ tracer in src/com/rabbitmq/tools/Tracer.java in the
> rabbitmq-java-client repo for an example of a proxy.
>
> Another route is via the "pluggable exchange types" we have under
> development - see the bug22169 branch in the rabbitmq-server hg repo.
> That would allow you to define a custom exchange type that works just
> like an ordinary topic (or other) exchange but collects stats on
> publishes on a per-node basis. In the simplest case this could just dump
> a timestamp and routing key to a file, leaving the actual statistics
> calculations to some other program. Or, at the other extreme, the custom
> exchange could compute per-node stats itself and, furthermore,
> participate in the collation of stats from multiple nodes, using the
> distributed computing features Erlang puts at your disposal.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100119/7d3f6f0e/attachment.htm 

From matthew at lshift.net  Tue Jan 19 14:03:22 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 19 Jan 2010 14:03:22 +0000
Subject: [rabbitmq-discuss] Running StressPersister.java client against
 RabbitMQ and finding the stress_persister.log file is being "beaten to
 death"
In-Reply-To: <173a1edc1001190122n397911c2occ9fba9c028385e8@mail.gmail.com>
References: <mailman.163.1263575637.22012.rabbitmq-discuss@lists.rabbitmq.com>
	<173a1edc1001190122n397911c2occ9fba9c028385e8@mail.gmail.com>
Message-ID: <20100119140322.GD32617@mrnibble.lshift.net>

Hi John,

On Tue, Jan 19, 2010 at 10:22:29AM +0100, John Apps wrote:
> What parameters should one tweak in order to reduce the I/O to the log file
> in the StressPersister test? And others with similar behaviour, of course.

A quick look at the code suggests changing the sample interval with s
should do the trick.

> The file grows to about 140MB using the default StressPersister parameters,
> only to be renamed to stress_persister.log.previous and the whole cycle
> starts again.
> With smaller parameters than the default, i.e., smaller message size, lower
> backlog etc., the pattern is the same, but the frequency with which the log
> is renamed and recreated is faster.

That's very odd. I must confess to being totally unfamiliar with this
example - it's not one of the tests I've written to stress the new
persister.

Just running it, I get rather different results to you:

rabbitmq-java-client/build/dist$ sh runjava.sh com/rabbitmq/examples/StressPersister -C blah
... things happen ...
rabbitmq-java-client/build/dist$ ls -l
total 756
... stuff ...
-rw-r--r-- 1 matthew matthew   5077 Jan 19 13:54 stress-persister-b00005000-B0000016384-c00025000-s000100-blah.out

The results there are in a format suitable for plotting with graphviz or
similar. Digging back through our hg repo, Tony wrote this test in order
to replicate some of the results I was seeing using my Erlang-client
tests with the new persister.

> What would be ideal would be to be able to specify an initial (large)
> allocation for the file (so it does not extend it all the time) along with
> an extension quantity, should it have to be extended. In addition, if one
> could specify how much should be retained in memory prior to be flushed to
> disk, that would also make things move along.

Not really. Most modern file systems support holes in files, thus an
initial preallocation is virtually a noop, and buys you nothing later on.
Appending to a file is by far the best way to utilise disk bandwidth in
our experience. The OS is highly likely to be buffering pages of
outstanding writes anyway to disk.

Wrt buffering, the code is using a Java PrintWriter and using println on
it. Now it does call flush appropriately and not on every line.
Hopefully the Java libraries underneath understand that they're writing
to a file and not a terminal and are thus not doing a flush every line
themselves, but I'm not 100% sure about that.

I'm afraid I just can't replicate what you're seeing. How are you
running the example?

Best wishes,

Matthew



From seemasbiradar at gmail.com  Tue Jan 19 14:10:53 2010
From: seemasbiradar at gmail.com (Seema Biradar)
Date: Tue, 19 Jan 2010 19:40:53 +0530
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <9a2d8f781001130552k1cbd118arfc49a35c8ec9fd5a@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>
	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>
	<558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com>
	<167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com>
	<9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com>
	<167204d21001130517m4e92c85bub09a6b70b294f523@mail.gmail.com>
	<9a2d8f781001130552k1cbd118arfc49a35c8ec9fd5a@mail.gmail.com>
Message-ID: <558967a41001190610l43d9365cu65ebc2d80012c10e@mail.gmail.com>

Hi,

I am trying to run the shovel in linux using following cmd.

*erl -pa /home/voms/RabbitMQ/shovel/ebin
/home/voms/RabbitMQ/new/rabbitmq-erlang-client/ebin \
-mnesia dir erlang \
-rabbit tcp_listeners'[{"127.0.0.1",5672}]' \
-boot start_sasl -s  rabbit -s shovel.*

I am getting the fllowing info.

*=INFO REPORT==== 19-Jan-2010::19:23:10 ===
    application: shovel
    exited: {shutdown,{shovel_application,start,[normal,[]]}}
    type: temporary*


if I tried to list of managed OTP applications using
application:which_applications(). cmd in Erlang shell i am getting the
following. Shovel is not running.

 *1> application:which_applications().
[{rabbit,"RabbitMQ","1.7.0"},
 {mnesia,"MNESIA  CXC 138 12","4.4.12"},
 {os_mon,"CPO  CXC 138 46","2.2.4"},
 {sasl,"SASL  CXC 138 11","2.1.8"},
 {stdlib,"ERTS  CXC 138 10","1.16.5"},
 {kernel,"ERTS  CXC 138 10","2.13.5"}]*

I need to run the shovel application.Pease help me on this.
Thanks in advance.
Seema






On Wed, Jan 13, 2010 at 7:22 PM, Pradeep Gatram <pradeep.gatram at gmail.com>wrote:

> Alexis,
>
> I've uploaded the gist at http://gist.github.com/276195
>
> Pradeep
> www.masplantiz.com
>
>
> On Wed, Jan 13, 2010 at 6:47 PM, Alexis Richardson <
> alexis.richardson at gmail.com> wrote:
>
>> Thanks Pradeep!  Would you mind posting that on github as a gist?  I
>> would love to link to it from our links repository.
>>
>> Here is something similar in Scala:
>>
>> http://github.com/slider/amqp-relay
>>
>> a
>>
>>
>> On Wed, Jan 13, 2010 at 12:48 PM, Pradeep Gatram
>>  <pradeep.gatram at gmail.com> wrote:
>> > Here is a quick n dirty amqp replicator that we've been using for a
>> while.
>> > Modified it a bit to remove some project specific stuff. You may use it
>> > while you wait for the new release.
>> >
>> > Ruby code:
>> >
>> > require 'rubygems'
>> > require 'mq'
>> >
>> > EM.run do
>> >   def replicate source, destination, topic
>> >     source_q = MQ::Queue.new(source, "replicator for #{topic}")
>> >     source_q.bind(MQ::Exchange.new(source, :topic, topic))
>> >     destination_ex = MQ::Exchange.new(destination, :topic, topic)
>> >
>> >     source_q.subscribe do |headers, msg|
>> >       destination_ex.publish(msg)
>> >     end
>> >   end
>> >
>> >   local, remote = %w{one two}, %w{three}
>> >   localhost, remotehost = 'localhost', '192.168.0.26'
>> >
>> >   local_channel = MQ.new(AMQP.connect(:host => localhost, :logging =>
>> > false))
>> >   remote_channel = MQ.new(AMQP.connect(:host => remotehost, :logging =>
>> > false))
>> >
>> >   local.each  { |t| replicate local_channel, remote_channel, t }
>> >   remote.each { |t| replicate remote_channel, local_channel, t }
>> > end
>> >
>> >
>> > Regards,
>> > Pradeep
>> >
>> >
>> > On Wed, Jan 13, 2010 at 5:42 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Seema
>> >>
>> >> It's been imminent for some time - QA in underway currently.  We hit
>> >> the usual slowdowns due to the holiday season.
>> >>
>> >> We'll be sure to let you know.
>> >>
>> >> alexis
>> >>
>> >>
>> >> On Wed, Jan 13, 2010 at 12:09 PM, Seema Biradar <
>> seemasbiradar at gmail.com>
>> >> wrote:
>> >> > Ok Thanks for the information!
>> >> >
>> >> > Please let me know when the next release is? and
>> >> > The link from where we can download the same ?
>> >> >
>> >> > Thanks again!
>> >> > Regards
>> >> > Seema
>> >> >
>> >> >
>> >> > On Wed, Jan 13, 2010 at 5:22 PM, Alexis Richardson
>> >> > <alexis.richardson at gmail.com> wrote:
>> >> >>
>> >> >> Seema
>> >> >>
>> >> >> I have just asked the team about this and learnt that Shovel was
>> taken
>> >> >> offline for a few weeks pending our next server release.  This is
>> >> >> because we wanted to make some changes to the plugin to align with
>> >> >> server changes.  Would you mind waiting a few weeks?  If you need to
>> >> >> do something quickly, then please let us know.
>> >> >>
>> >> >> Best wishes
>> >> >>
>> >> >> alexis
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >> On Wed, Jan 13, 2010 at 9:17 AM, Seema Biradar
>> >> >> <seemasbiradar at gmail.com>
>> >> >> wrote:
>> >> >> > Can you please let me know where can i download or get src for the
>> >> >> > Shove
>> >> >> > pluggin.
>> >> >> >
>> >> >> >
>> >> >> > On Tue, Jan 12, 2010 at 11:22 PM, Alexis Richardson
>> >> >> > <alexis.richardson at gmail.com> wrote:
>> >> >> >>
>> >> >> >> Seema,
>> >> >> >>
>> >> >> >> I am not the best person to answer your question in full, but:
>>  In
>> >> >> >> addition to what Pradeep said, you need to be aware that Shovel
>> is a
>> >> >> >> RabbitMQ plugin.  The plugins are described here:
>> >> >> >> http://www.rabbitmq.com/admin-guide.html#plugins
>> >> >> >>
>> >> >> >> The following talk describes a use case involving Shovel -
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> http://qconsf.com/sf2009/presentation/Open+Source+at+Unibet.com+-+10x+Scalability+at+Half+the+Cost
>> >> >> >>
>> >> >> >> And Stefan's slides are here:
>> >> >> >>
>> >> >> >> http://qconsf.com/sf2009/tracks/show_track.jsp?trackOID=301
>> >> >> >>
>> >> >> >> alexis
>> >> >> >>
>> >> >> >>
>> >> >> >> On Tue, Jan 12, 2010 at 7:18 AM, Pradeep Gatram
>> >> >> >> <pradeep.gatram at gmail.com> wrote:
>> >> >> >> > Seema,
>> >> >> >> >
>> >> >> >> > You dont have to interact with Shovel directly. Look at it this
>> >> >> >> > way
>> >> >> >> >
>> >> >> >> > p1-->R1 --> Shovel (or amqp-relay) -->R2-->C2
>> >> >> >> >
>> >> >> >> > p1 & c2 can be in any programming language. You just have to
>> >> >> >> > "configure"
>> >> >> >> > the
>> >> >> >> > Shovel/amqp-relay appropriately.
>> >> >> >> >
>> >> >> >> > Pradeep
>> >> >> >> >
>> >> >> >> > On Tue, Jan 12, 2010 at 12:30 PM, Seema Biradar
>> >> >> >> > <seemasbiradar at gmail.com>
>> >> >> >> > wrote:
>> >> >> >> >>
>> >> >> >> >> Hi,
>> >> >> >> >> Thanks for the information.
>> >> >> >> >>
>> >> >> >> >> I need one more help .
>> >> >> >> >>
>> >> >> >> >> Can you please suggest me how can we use Shovel component and
>> >> >> >> >> RabbitMQ
>> >> >> >> >> using in JAVA Programming language.
>> >> >> >> >>
>> >> >> >> >> Using JAVA as programming language (RabbitMQ Java API), how
>> can
>> >> >> >> >> we
>> >> >> >> >> make
>> >> >> >> >> use of shovel component?
>> >> >> >> >> (I am using RabbitMQ bundle for Windows )
>> >> >> >> >>
>> >> >> >> >> If any examples are there ( RabbitMQ Java API + Shovel
>> >> >> >> >> Application )
>> >> >> >> >> .please let me know.
>> >> >> >> >>
>> >> >> >> >> Thanksin adavance.
>> >> >> >> >> Seema
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >> On Mon, Jan 11, 2010 at 4:30 PM, Alexis Richardson
>> >> >> >> >> <alexis.richardson at gmail.com> wrote:
>> >> >> >> >>>
>> >> >> >> >>> Seema
>> >> >> >> >>>
>> >> >> >> >>> We have a component called Shovel that does this.  Have a
>> look
>> >> >> >> >>> at:
>> >> >> >> >>>
>> >> >> >> >>>
>> >> >> >> >>>
>> >> >> >> >>>
>> >> >> >> >>>
>> >> >> >> >>>
>> http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=!009922129631189805192%3Akpd1zoym_hq<http://www.google.com/custom?hl=en&client=google-coop&cof=FORID%3A13%3BAH%3Aleft%3BCX%3ASearch%2520rabbitmq%252Ecom%3BL%3Ahttp%3A%2F%2Fwww.google.com%2Fintl%2Fen%2Fimages%2Flogos%2Fcustom_search_logo_sm.gif%3BLH%3A30%3BLP%3A1%3BVLC%3A%23551a8b%3BDIV%3A%23cccccc%3B&adkw=AELymgUM4bEBKZRWHklce-FzQ07Y_Ty_1vnaPtrQ8r-mfG-h02gaVCQWhzccmyx_IeDaFY9Tk26r8LoVr4kPf-qF5JYWjXQjBG5fUe-P7g5bl1eaF1uKRUU&boostcse=0&q=shovel+rabbitmq&btnG=Search&cx=%21009922129631189805192%3Akpd1zoym_hq>
>> >> >> >> >>>
>> >> >> >> >>> Also, some has created a 'relay' project on Github:
>> >> >> >> >>> http://github.com/slider/amqp-relay
>> >> >> >> >>>
>> >> >> >> >>> Does this answer your question?
>> >> >> >> >>>
>> >> >> >> >>> alexis
>> >> >> >> >>>
>> >> >> >> >>>
>> >> >> >> >>> On Mon, Jan 11, 2010 at 7:21 AM, Seema Biradar
>> >> >> >> >>> <seemasbiradar at gmail.com>
>> >> >> >> >>> wrote:
>> >> >> >> >>> > Hi
>> >> >> >> >>> >
>> >> >> >> >>> > My requirement is like this
>> >> >> >> >>> >
>> >> >> >> >>> > Two instance of RabbitMQ server are running at different
>> >> >> >> >>> > IP.say
>> >> >> >> >>> > assume
>> >> >> >> >>> > P1 is a producer of rabitmq1 R1(which is in one mechine)
>> >> >> >> >>> > C2 is a cosumer of rabittmq2 R2 (which is running in
>> another
>> >> >> >> >>> > mechine),i
>> >> >> >> >>> > Is it possible  the communication flow in the following
>> >> >> >> >>> > manner,
>> >> >> >> >>> > p1-->R1-->R2-->C2
>> >> >> >> >>> >
>> >> >> >> >>> > If there small example please mail me back
>> >> >> >> >>> >
>> >> >> >> >>> > Thanks in advance
>> >> >> >> >>> > Seema
>> >> >> >> >>> >
>> >> >> >> >>> > _______________________________________________
>> >> >> >> >>> > rabbitmq-discuss mailing list
>> >> >> >> >>> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >> >>> >
>> >> >> >> >>> >
>> >> >> >> >>> >
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >> >>> >
>> >> >> >> >>> >
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >> _______________________________________________
>> >> >> >> >> rabbitmq-discuss mailing list
>> >> >> >> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >> >>
>> >> >> >> >>
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >> >>
>> >> >> >> >
>> >> >> >> >
>> >> >> >> > _______________________________________________
>> >> >> >> > rabbitmq-discuss mailing list
>> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >> >
>> >> >> >> >
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >> >
>> >> >> >> >
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100119/0dcab052/attachment.htm 

From matthew at lshift.net  Tue Jan 19 14:18:45 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 19 Jan 2010 14:18:45 +0000
Subject: [rabbitmq-discuss] Running StressPersister.java client against
 RabbitMQ and finding the stress_persister.log file is being "beaten to
 death"
In-Reply-To: <20100119140322.GD32617@mrnibble.lshift.net>
References: <mailman.163.1263575637.22012.rabbitmq-discuss@lists.rabbitmq.com>
	<173a1edc1001190122n397911c2occ9fba9c028385e8@mail.gmail.com>
	<20100119140322.GD32617@mrnibble.lshift.net>
Message-ID: <20100119141845.GE32617@mrnibble.lshift.net>

On Tue, Jan 19, 2010 at 02:03:22PM +0000, Matthew Sackman wrote:
> On Tue, Jan 19, 2010 at 10:22:29AM +0100, John Apps wrote:
> > What parameters should one tweak in order to reduce the I/O to the log file
> > in the StressPersister test? And others with similar behaviour, of course.
> 
> A quick look at the code suggests changing the sample interval with s
> should do the trick.
> 
> > The file grows to about 140MB using the default StressPersister parameters,
> > only to be renamed to stress_persister.log.previous and the whole cycle
> > starts again.

I've just twigged - you've set the rabbit nodename to stress haven't
you? Thus the stress_persister.log and stress_persister.log.previous are
actually the persister files. These are the very files to which the
(old) persister is writing messages which have to be written to disk.

There are many issues with the old persister, which have been regularly
discussed on this list, and many people are using the new persister
which has been in development for almost a full year now.

See eg http://old.nabble.com/Re:-Rabbit-MQ-crashing-p27042793.html to
start with.

Best wishes,

Matthew



From james.anderson at setf.de  Tue Jan 19 14:22:43 2010
From: james.anderson at setf.de (james anderson)
Date: Tue, 19 Jan 2010 15:22:43 +0100
Subject: [rabbitmq-discuss] (how) is it intended to stream data via AMQP?
In-Reply-To: <4B559BE0.2080709@lshift.net>
References: <F8090FA2-2027-47E8-B64A-C7D325DC7A1B@setf.de>	<4B556A83.6010104@lshift.net>	<13BC2E82-FA58-4F24-813C-69C1F8874C36@setf.de>	<4B558FF8.3000101@lshift.net>	<8A739A05-3207-4083-95ED-F1F2B469D324@setf.de>	<4B5594FF.5080304@lshift.net>
	<3EE999C2-6417-4278-8500-B8107C694DA8@setf.de>
	<4B559BE0.2080709@lshift.net>
Message-ID: <58FBFE95-9FA3-4208-862A-AC37F2C88FCD@setf.de>

good afternoon;

On 2010-01-19, at 12:47 , Matthias Radestock wrote:

> james anderson wrote:
>> On 2010-01-19, at 12:18 , Matthias Radestock wrote:
>>> You could add an entry to the "headers" basic content property,  
>>> an  AMQP table which is the generic place for apps to stash k/v  
>>> pairs.
>> yes, that was my original question.
>> such a practice would be standard enough that, so long as it was  
>> an  additional property (for 0-9r1 property #15), a conforming  
>> server  would not reject the message _and_ would be required to  
>> pass it through?
>
> I was suggesting you use the existing 'headers' property, which  
> itself is a table and specifically there for application use.

aha. i understand.


>
> Generally brokers are meant to pass through all properties unaltered.

? is there to be found anywhere an uml class diagram of the concrete  
models the codegen utility builds when it translates a spec into codecs?
i recall seeing (somewhere) a diagram for its abstract model. which  
is also pretty self-evident in the code, and one can always generate  
diagrams from the any of the various client library implementations,  
but none would be the same as the depictions of the codegen's  
instance models, that is of the respective specification's own model.

do those exist anywhere?

thanks,




From matthew at lshift.net  Tue Jan 19 14:28:23 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 19 Jan 2010 14:28:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ qualifiers "-rabbit xxx". Where are
 they documented?
In-Reply-To: <7F7AFB31365CC143A50E6370FCCFDFC959FD7C825F@GVW1163EXB.americas.hpqcorp.net>
References: <7F7AFB31365CC143A50E6370FCCFDFC959FD7C825F@GVW1163EXB.americas.hpqcorp.net>
Message-ID: <20100119142822.GG32617@mrnibble.lshift.net>

On Tue, Jan 19, 2010 at 10:04:55AM +0000, Apps, John wrote:
> I am probably being rather blind, but have been unable to find where the RabbitMQ qualifiers are documented, whether on the command line or in the configuration file.

On the whole, they are constructed dynamically and you shouldn't need to
use them directly. Because they're somewhat unwieldy, we've been pushing
towards configuration in the rabbitmq.config file for a while now.

There's some documentation about that at:
http://www.rabbitmq.com/install.html#configfile
Other mentions appear in http://www.rabbitmq.com/ssl.html and there's
been some recent discussion on list about tcp_listeners in there (the
coding for that is done and it'll be included in the 1.7.1 release).

Matthew



From johndapps at gmail.com  Tue Jan 19 14:36:29 2010
From: johndapps at gmail.com (John Apps)
Date: Tue, 19 Jan 2010 15:36:29 +0100
Subject: [rabbitmq-discuss] Running StressPersister.java client against
	RabbitMQ and finding the stress_persister.log file is being
	"beaten to death"
In-Reply-To: <20100119141845.GE32617@mrnibble.lshift.net>
References: <mailman.163.1263575637.22012.rabbitmq-discuss@lists.rabbitmq.com>
	<173a1edc1001190122n397911c2occ9fba9c028385e8@mail.gmail.com>
	<20100119140322.GD32617@mrnibble.lshift.net>
	<20100119141845.GE32617@mrnibble.lshift.net>
Message-ID: <173a1edc1001190636j56744543g4259c02a4da42971@mail.gmail.com>

Hey Matthew,

Oh well, please excuse a beginner and someone who asks first and reads
later...

Your assumption is correct. I shall now go and read...

Should we (tongue in cheek) have a crack at it with the new persister?

Thank you, John
On Tue, Jan 19, 2010 at 15:18, Matthew Sackman <matthew at lshift.net> wrote:

> On Tue, Jan 19, 2010 at 02:03:22PM +0000, Matthew Sackman wrote:
> > On Tue, Jan 19, 2010 at 10:22:29AM +0100, John Apps wrote:
> > > What parameters should one tweak in order to reduce the I/O to the log
> file
> > > in the StressPersister test? And others with similar behaviour, of
> course.
> >
> > A quick look at the code suggests changing the sample interval with s
> > should do the trick.
> >
> > > The file grows to about 140MB using the default StressPersister
> parameters,
> > > only to be renamed to stress_persister.log.previous and the whole cycle
> > > starts again.
>
> I've just twigged - you've set the rabbit nodename to stress haven't
> you? Thus the stress_persister.log and stress_persister.log.previous are
> actually the persister files. These are the very files to which the
> (old) persister is writing messages which have to be written to disk.
>
> There are many issues with the old persister, which have been regularly
> discussed on this list, and many people are using the new persister
> which has been in development for almost a full year now.
>
> See eg http://old.nabble.com/Re:-Rabbit-MQ-crashing-p27042793.html to
> start with.
>
> Best wishes,
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
---
John Apps
(49) 171 869 1813
Sent from Grassau, Bavaria, Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100119/9fd1a346/attachment.htm 

From matthew at lshift.net  Tue Jan 19 14:40:21 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 19 Jan 2010 14:40:21 +0000
Subject: [rabbitmq-discuss] Running StressPersister.java client against
 RabbitMQ and finding the stress_persister.log file is being "beaten to
 death"
In-Reply-To: <173a1edc1001190636j56744543g4259c02a4da42971@mail.gmail.com>
References: <mailman.163.1263575637.22012.rabbitmq-discuss@lists.rabbitmq.com>
	<173a1edc1001190122n397911c2occ9fba9c028385e8@mail.gmail.com>
	<20100119140322.GD32617@mrnibble.lshift.net>
	<20100119141845.GE32617@mrnibble.lshift.net>
	<173a1edc1001190636j56744543g4259c02a4da42971@mail.gmail.com>
Message-ID: <20100119144020.GH32617@mrnibble.lshift.net>

Hi John,

On Tue, Jan 19, 2010 at 03:36:29PM +0100, John Apps wrote:
> Oh well, please excuse a beginner and someone who asks first and reads
> later...

No problem at all!

> Should we (tongue in cheek) have a crack at it with the new persister?

We certainly welcome all the testing people have time for, though
obviously with the usual warnings that the code has not been fully
through our QA process (ongoing atm) and there may be bugs - if/when it
breaks, you get to keep all the pieces ;)

Best wishes,

Matthew



From Dinabandhu.Mitra at tecnotree.com  Tue Jan 19 15:18:50 2010
From: Dinabandhu.Mitra at tecnotree.com (Dinabandhu Mitra)
Date: Tue, 19 Jan 2010 17:18:50 +0200
Subject: [rabbitmq-discuss] Will this work?
In-Reply-To: <167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>
References: <26875409.post@talk.nabble.com>
	<167204d21001050554k6f6646d2q53a0fd73d8cb9d77@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD818060D1B48@esmail10>
	<167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>
Message-ID: <960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>

Hi Alexis,

Any further advice on our earlier discussions?


I am currently trying out using c API. I was trying to measure communication latency introduced by RabbitMQ. Following are some of the observations -

1. When the test application starts, the latency for first few messages is very high. The number of messages with high latency depends on the throughput the application tries to generate. E.g -
	a) For 1/2 message per sec latency continues to be very high (over 200 millisecond) throughout.
	b) For 3/4 message per sec it seems to change between high (200) and low (0.200) on every alternate message.
	c) For 5 messages per sec it stabilizes to a low value (0.200 - 0.300) after first 5/6 messages.
	d) For 10 messages per sec it stabilizes to a low value (0.200 - 0.300) after first 5/6 messages.    
	e) For 50 messages per sec it stabilizes to a low value (0.200 - 0.300) after first 15/16 messages.
	f) For 100 messages per sec it stabilizes to a low value (0.200 - 0.300) after first 50/60 messages.
	g) For 500 messages per sec it stabilizes to a low value (0.300 - 0.500) after first 370/380 messages.
	h) For 1000 messages per sec it comes down to a low value (0.500 - 0.700) after first 500 messages. But I have seen intermittent bursts of a sequence of high latency (going over 20 millisecond) messages.
	i) Initial latencies increase with throughput. E.g at 1000 msg/sec it is as high as 380/390 millisecond for some messages.

2. Both publisher and subscriber are in the same server as the broker. In fact the publisher and the subscriber are two threads in the same process.

3. The server is a idle SUN Netra Dual CPU(Quad Core) Xeon class machine with 16G RAM running RHEL 4.7 64 bit.

4. The platform is on the factory configuration; i.e. I have just installed the RPMs and started the RabbitMQ server without any other configuration.

5. I am using approx 1KB sized messages for this.

Is there any configuration that I can do to have better (less variance) latency? Also, I am using 1 producer and 1 consumer (both trivial). Shall I get better results by using multiple producers/consumers?

Regards,
Dinabandhu

> -----Original Message-----
> From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
> Sent: Tuesday, January 05, 2010 10:33 PM
> To: Dinabandhu Mitra
> Cc: rabbitmq info
> Subject: Re: [rabbitmq-discuss] Will this work?
> 
> Dinabandhu
> 
> Answers / comments below also.  Let me know if you want to cc this to
> rabbitmq-discuss.  FYI - info at rabbitmq.com is our private (internal
> team) list.
> 
> alexis
> 
> 
> 
> On Tue, Jan 5, 2010 at 3:16 PM, Dinabandhu Mitra
> <Dinabandhu.Mitra at tecnotree.com> wrote:
> >
> > The scale of the application depends on the implementation. The
> messaging load
> > can vary from few hundred per second to over 30,000/40,000 per
> second. Of course
> > we will add additional equipment depending on the load but the
> application should
> > be able to use additional equipment effectively.
> 
> OK.  That should be fine.  What's the peak ingress per node?
> 
> I.e. what is the max rate that a single publisher might produce in
> messages per second?
> 
> Also - are the messages 'small' (< 500 bytes) or 'large' (>64Kb)?  Is
> this size consistent or volatile?
> 
> 
> 
> 
> >> OK. ?You will be able to do this with direct exchanges too. ?They
> are
> >> faster (in lookup time) than our current topic implementation. ?It
> >> does not look like you need topic exchanges because you do not
> appear
> >> to be routing messages using wildcards, eg. you do not need bindings
> >> of the form "PE.*". ?Is that right?
> >
> > Yes. I was reading the AMQP specification concepts section few days
> back
> > and realized that my understanding of direct exchanges was wrong.
> Direct
> > exchange should be the right option for us.
> 
> Good.
> 
> 
> 
> 
> >> > ? a) When a application engine (LE/PE) boots and declares it's
> queue
> >> and
> >> > binding using a connection to the local broker, the queue and
> >> bindings
> >> > becomes visible to all broker instances running in different
> servers.
> >> Is
> >> > this correct?
> >>
> >> Correct, provided that the other brokers are in the same cluster (as
> >> in your diagram) and vhost (ie. namespace).
> >
> > It should be sufficient. As of now we are looking at a single cluster
> and
> > single vhost.
> 
> OK, cool.
> 
> 
> 
> >> > ? f) Anyone trying send a message that is immediately non-routable
> >> > (possibly mandatory+immediate flag with auto-ack) gets a error and
> >> broker
> >> > drops the message. Is this correct?
> >>
> >> I can't remember exactly how this works. ?Basically the answer is
> YES.
> >> ?I cannot recall under what conditions the broker drops the message
> >> silently, and under what conditions it lets the publisher know that
> an
> >> error occurred.
> >
> > Well, this is not a very hard requirement. The LE instances are timer
> controlled,
> > in the sense that if a LE does not receive a response from any of the
> PEs within
> > certain time limit then the LE assumes that there is a problem is
> handling the
> > request and sends a failure response to the client that originated
> the transaction.
> > However, it is way better if the rejection can be done without
> waiting for the
> > timer to expire in case none of the relevant PE engines are live.
> This is how the
> > application behaves currently.
> 
> OK.  We can return to this point later.
> 
> alexis
> 
> 
> 
> >
> >> alexis
> >>
> >>
> >>
> >> >
> >> > Regards,
> >> > Dinabandhu
> >> > --
> >> > View this message in context: http://old.nabble.com/Will-this-
> work--
> >> tp26875409p26875409.html
> >> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
> discuss
> >> >
> >



From tonyg at lshift.net  Tue Jan 19 19:56:46 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 19 Jan 2010 19:56:46 +0000
Subject: [rabbitmq-discuss] Will this work?
In-Reply-To: <960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>
References: <26875409.post@talk.nabble.com>	
	<167204d21001050554k6f6646d2q53a0fd73d8cb9d77@mail.gmail.com>	
	<960996F6EFBCB843BFD62DAA96BD1DD818060D1B48@esmail10>
	<167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>
Message-ID: <4B560E7E.703@lshift.net>

Hi Dinabandhu,

I think you're running into TCP_NODELAY issues. Try setting your
client's socket to nodelay mode, which disables Nagling:

  int one = 1;
  setsockopt(sockfd, IPPROTO_TCP, TCP_NODELAY, &one, sizeof(one));

This should fix the high observed latency in cases (a) and (b).

Regards,
  Tony



Dinabandhu Mitra wrote:
> Hi Alexis,
> 
> Any further advice on our earlier discussions?
> 
> 
> I am currently trying out using c API. I was trying to measure communication latency introduced by RabbitMQ. Following are some of the observations -
> 
> 1. When the test application starts, the latency for first few messages is very high. The number of messages with high latency depends on the throughput the application tries to generate. E.g -
> 	a) For 1/2 message per sec latency continues to be very high (over 200 millisecond) throughout.
> 	b) For 3/4 message per sec it seems to change between high (200) and low (0.200) on every alternate message.
> 	c) For 5 messages per sec it stabilizes to a low value (0.200 - 0.300) after first 5/6 messages.
> 	d) For 10 messages per sec it stabilizes to a low value (0.200 - 0.300) after first 5/6 messages.    
> 	e) For 50 messages per sec it stabilizes to a low value (0.200 - 0.300) after first 15/16 messages.
> 	f) For 100 messages per sec it stabilizes to a low value (0.200 - 0.300) after first 50/60 messages.
> 	g) For 500 messages per sec it stabilizes to a low value (0.300 - 0.500) after first 370/380 messages.
> 	h) For 1000 messages per sec it comes down to a low value (0.500 - 0.700) after first 500 messages. But I have seen intermittent bursts of a sequence of high latency (going over 20 millisecond) messages.
> 	i) Initial latencies increase with throughput. E.g at 1000 msg/sec it is as high as 380/390 millisecond for some messages.
> 
> 2. Both publisher and subscriber are in the same server as the broker. In fact the publisher and the subscriber are two threads in the same process.
> 
> 3. The server is a idle SUN Netra Dual CPU(Quad Core) Xeon class machine with 16G RAM running RHEL 4.7 64 bit.
> 
> 4. The platform is on the factory configuration; i.e. I have just installed the RPMs and started the RabbitMQ server without any other configuration.
> 
> 5. I am using approx 1KB sized messages for this.
> 
> Is there any configuration that I can do to have better (less variance) latency? Also, I am using 1 producer and 1 consumer (both trivial). Shall I get better results by using multiple producers/consumers?
> 
> Regards,
> Dinabandhu
> 
>> -----Original Message-----
>> From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
>> Sent: Tuesday, January 05, 2010 10:33 PM
>> To: Dinabandhu Mitra
>> Cc: rabbitmq info
>> Subject: Re: [rabbitmq-discuss] Will this work?
>>
>> Dinabandhu
>>
>> Answers / comments below also.  Let me know if you want to cc this to
>> rabbitmq-discuss.  FYI - info at rabbitmq.com is our private (internal
>> team) list.
>>
>> alexis
>>
>>
>>
>> On Tue, Jan 5, 2010 at 3:16 PM, Dinabandhu Mitra
>> <Dinabandhu.Mitra at tecnotree.com> wrote:
>>> The scale of the application depends on the implementation. The
>> messaging load
>>> can vary from few hundred per second to over 30,000/40,000 per
>> second. Of course
>>> we will add additional equipment depending on the load but the
>> application should
>>> be able to use additional equipment effectively.
>> OK.  That should be fine.  What's the peak ingress per node?
>>
>> I.e. what is the max rate that a single publisher might produce in
>> messages per second?
>>
>> Also - are the messages 'small' (< 500 bytes) or 'large' (>64Kb)?  Is
>> this size consistent or volatile?
>>
>>
>>
>>
>>>> OK.  You will be able to do this with direct exchanges too.  They
>> are
>>>> faster (in lookup time) than our current topic implementation.  It
>>>> does not look like you need topic exchanges because you do not
>> appear
>>>> to be routing messages using wildcards, eg. you do not need bindings
>>>> of the form "PE.*".  Is that right?
>>> Yes. I was reading the AMQP specification concepts section few days
>> back
>>> and realized that my understanding of direct exchanges was wrong.
>> Direct
>>> exchange should be the right option for us.
>> Good.
>>
>>
>>
>>
>>>>>   a) When a application engine (LE/PE) boots and declares it's
>> queue
>>>> and
>>>>> binding using a connection to the local broker, the queue and
>>>> bindings
>>>>> becomes visible to all broker instances running in different
>> servers.
>>>> Is
>>>>> this correct?
>>>> Correct, provided that the other brokers are in the same cluster (as
>>>> in your diagram) and vhost (ie. namespace).
>>> It should be sufficient. As of now we are looking at a single cluster
>> and
>>> single vhost.
>> OK, cool.
>>
>>
>>
>>>>>   f) Anyone trying send a message that is immediately non-routable
>>>>> (possibly mandatory+immediate flag with auto-ack) gets a error and
>>>> broker
>>>>> drops the message. Is this correct?
>>>> I can't remember exactly how this works.  Basically the answer is
>> YES.
>>>>  I cannot recall under what conditions the broker drops the message
>>>> silently, and under what conditions it lets the publisher know that
>> an
>>>> error occurred.
>>> Well, this is not a very hard requirement. The LE instances are timer
>> controlled,
>>> in the sense that if a LE does not receive a response from any of the
>> PEs within
>>> certain time limit then the LE assumes that there is a problem is
>> handling the
>>> request and sends a failure response to the client that originated
>> the transaction.
>>> However, it is way better if the rejection can be done without
>> waiting for the
>>> timer to expire in case none of the relevant PE engines are live.
>> This is how the
>>> application behaves currently.
>> OK.  We can return to this point later.
>>
>> alexis
>>
>>
>>
>>>> alexis
>>>>
>>>>
>>>>
>>>>> Regards,
>>>>> Dinabandhu
>>>>> --
>>>>> View this message in context: http://old.nabble.com/Will-this-
>> work--
>>>> tp26875409p26875409.html
>>>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
>> discuss
> 



From john.odendahl at gmail.com  Tue Jan 19 21:44:45 2010
From: john.odendahl at gmail.com (john_od)
Date: Tue, 19 Jan 2010 13:44:45 -0800 (PST)
Subject: [rabbitmq-discuss]  Data may be missing, Corrupt logfile deleted
Message-ID: <27233256.post@talk.nabble.com>


My rabbitmq keeps erroring with the following message:

Mnesia('rabbit at hostname'): Data may be missing, Corrupt logfile deleted:
"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.TMP",
{file_error,"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.TMP",
emfile}

Once this occurs I cannot connect to the queues.  Nor can i run a simple
rabbitctl list_queues.  The following error is produced from rabbitmqctl:

root at hostname:/usr/local/rabbitmq_server-1.7.0/sbin# ./rabbitmqctl
list_queues
Listing queues ...
Error: unable to connect to node 'rabbit at hostname':
{'EXIT',{aborted,{no_exists,[rabbit_queue,{amqqueue,{resource,<<47>>,queue,'_'},'_','_','_','_'}]}}}
diagnostics:
- nodes and their ports on hostname: [{rabbit,45971},
                                         {rabbitmqctl23146,54040}]
- current node: 'rabbitmqctl23146 at hostname'
- current node home dir: /root

I've tried removeing the /var/lib/rabbitmq directory as well as the
/var/log/rabbitmq.  
Once i do this the broker runs ok for a short period of time but then it
errors again.
Disk space does not seem to be a problem. 
I am running the 1.7.0 server in a solaris environment.

Any ideas?


-- 
View this message in context: http://old.nabble.com/Data-may-be-missing%2C-Corrupt-logfile-deleted-tp27233256p27233256.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Tue Jan 19 21:54:50 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 19 Jan 2010 21:54:50 +0000
Subject: [rabbitmq-discuss] Data may be missing, Corrupt logfile deleted
In-Reply-To: <27233256.post@talk.nabble.com>
References: <27233256.post@talk.nabble.com>
Message-ID: <4B562A2A.3030908@lshift.net>

John,

john_od wrote:
> My rabbitmq keeps erroring with the following message:
> 
> Mnesia('rabbit at hostname'): Data may be missing, Corrupt logfile deleted:
> "/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.TMP",
> {file_error,"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_route.TMP",
> emfile}

emfile errors are often an indication that rabbit has run out of file 
descriptors, the most likely cause of which is too many concurrent AMQP 
connections.

I suggest you run 'rabbitmqctl list_connections' repeatedly to see 
whether there is any growth in the connection count. Tools like 
'netstat' and 'lsof' can help too to figure out where the file 
descriptors are going.

If a high connection count is expected in your application, you may have 
to raise the OS-imposed fd limits.


Regards,

Matthias.



From g at rre.tt  Wed Jan 20 04:57:51 2010
From: g at rre.tt (Garrett Smith)
Date: Tue, 19 Jan 2010 22:57:51 -0600
Subject: [rabbitmq-discuss] Exclusive queues and delete-on-disconnect
Message-ID: <ce2570e21001192057y7fef72b4h6829427eae01b122@mail.gmail.com>

My understanding is that declaring a queue as exclusive will cause the
queue to be deleted as soon as the declaring channel (or connection?)
is closed.

I've observed cases when a channel/connection has not been closed
cleanly (e.g. sudden network failure) and the queue is not deleted.
(If this is unintended behavior, I can try to consistently recreate
the problem. It may be the case that this behavior is intermittent).

When the consumer re-declares (e.g. on restart), the broker complains
about an exclusive queue already existing. The fix I'm using is to
manually delete the queue.

Are there any suggestions for dealing with this? Apart from the added
complexity of restarting the consumer, I'm concerned that messages
will pile up in the queue with on one to consume them.

Garrett



From matthias at lshift.net  Wed Jan 20 08:48:18 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 20 Jan 2010 08:48:18 +0000
Subject: [rabbitmq-discuss] Exclusive queues and delete-on-disconnect
In-Reply-To: <ce2570e21001192057y7fef72b4h6829427eae01b122@mail.gmail.com>
References: <ce2570e21001192057y7fef72b4h6829427eae01b122@mail.gmail.com>
Message-ID: <4B56C352.9060800@lshift.net>

Garrett,

Garrett Smith wrote:
> My understanding is that declaring a queue as exclusive will cause the
> queue to be deleted as soon as the declaring channel (or connection?)
> is closed.

It's the declaring *connection*.

> I've observed cases when a channel/connection has not been closed
> cleanly (e.g. sudden network failure) and the queue is not deleted.

That shouldn't happen, except ... certain types of network failure can 
take a while to be recognised as disconnects by the OS' network stack.

One way to counter that is to enable AMQP heartbeats, which most AMQP 
clients (including all the supported RabbitMQ clients) support. That 
will cause a peer to close the connection when it hasn't received any 
data from the server for the configured heartbeat interval and thus puts 
an application-configured upper bound on the length of time a disconnect 
may go unnoticed.

> When the consumer re-declares (e.g. on restart), the broker complains
> about an exclusive queue already existing. The fix I'm using is to
> manually delete the queue.
> 
> Are there any suggestions for dealing with this?

Even with heartbeats enabled you still essentially have a race since the 
re-declaration may happen before a heartbeat has been missed. When that 
happens, you could pause and re-try, or, as you say, explicitly delete 
the queue.

Or perhaps you could declare anonymous queues, i.e. create a queue with 
a fresh name every time you connect? See also the next point.

> Apart from the added complexity of restarting the consumer, I'm 
> concerned that messages will pile up in the queue with on one to
> consume them.

Unless the network is mis-configured or you are using broken network kit 
then even w/o a heartbeat the broker will eventually recognise the 
disconnect and thus delete the queue. It may take a while - seconds, 
minutes - but it will happen.


Regards,

Matthias.



From tonyg at lshift.net  Wed Jan 20 16:06:29 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 20 Jan 2010 16:06:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ xmpp gateway
In-Reply-To: <8517b1311001121225m4e5f9abco7ffc23df11269652@mail.gmail.com>
References: <27121792.post@talk.nabble.com> <4B4CAE0C.8050209@lshift.net>
	<8517b1311001121225m4e5f9abco7ffc23df11269652@mail.gmail.com>
Message-ID: <4B572A05.2070605@lshift.net>

Hi Chetna,

Chetna Kaur wrote:
> 1) The gateway doesn't handle loss of connection to the ejabberd server.

You mean the rabbitmq server? Yes, that's an outstanding issue for sure.
If you fix this, your patch would be very welcome :)

> 2) Consumer Processes are not supervised ( I believe this may be on your
> To-do list).
> If I understand correctly, once a consumer process crashes the user
> associated with the queue will no longer receive any data. This data
> would continue to queue up at the server. Even if the user were to go
> offline and come back online, because of an entry in
> rabbitmq_consumer_process with queue and pid, a new process will not be
> created. Am I missing something here?

It's been a while since I looked at the code. Yes, the mnesia table will
cause problems.

There's also another bug I know of: if the system is up and working, and
I restart ejabberd, it used to ping presence for all the people it was
supposed to be in touch with. When the replies came in, consumer
processes would be started. However, it no longer seems to do the
initial ping reliably. I haven't investigated the problem though: I have
been lazily working around it by signing out and in of chat to
explicitly issue presence notifications to the rabbit-ejabberd.

> What would be the best way to make these processes supervised?

Split out the consumer process into a separate gen_server, introduce a
supervisor, and make the mnesia management more robust (probably by
trapping exits and putting cleanup code in the new gen_server's
terminate/2).

Regards,
  Tony




From anand.ved at Xoriant.Com  Thu Jan 21 11:12:48 2010
From: anand.ved at Xoriant.Com (Anand Ved)
Date: Thu, 21 Jan 2010 16:42:48 +0530
Subject: [rabbitmq-discuss] Heartbeat configuration
Message-ID: <FA3D7C54DA3A1540B2C92C93ACD2156006361F34@XOREXCH.India.XoriantCorp.com>


Hi,

We are using Java Client to bind to durable queue. Configured heartbeat
is say 120 seconds. I would like someone to throw more light on the
following:

How many heartbeats would rabbit server allow to skip before breaking a
connection with the client?
If say it allows 'n' heartbeats to be skipped, then is this 'n'
configurable?
What is the max value for heartbeat in production where in we have
constant CPU spikes due to other processes running?

Thanks & Regards
Anand Ved | Xoriant Solutions Pvt. Ltd. 
Winchester, Hiranandani Business Park, Powai, Mumbai 400076, INDIA. 
IM: anandved | Tel: +91 22 30511000 | Voip: + 1 408 834 4495 |
http://www.xoriant.com <http://www.xoriant.com/>  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100121/59c56568/attachment.htm 

From Dinabandhu.Mitra at tecnotree.com  Thu Jan 21 11:28:36 2010
From: Dinabandhu.Mitra at tecnotree.com (Dinabandhu Mitra)
Date: Thu, 21 Jan 2010 13:28:36 +0200
Subject: [rabbitmq-discuss] Will this work?
In-Reply-To: <4B560E7E.703@lshift.net>
References: <26875409.post@talk.nabble.com>
	<167204d21001050554k6f6646d2q53a0fd73d8cb9d77@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD818060D1B48@esmail10>
	<167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>
	<4B560E7E.703@lshift.net>
Message-ID: <960996F6EFBCB843BFD62DAA96BD1DD81808BE5964@esmail10>

Hi Tony,

Thanks for your reply. 

I tried disabling Nagle, but it does really not help for cases a & b. Moreover, it messes up latency for higher rates.

I tried googling about Nagle, and found a interesting article (http://www.stuartcheshire.org/papers/NagleDelayedAck/) that mentions that there is a possibility of some kind of interaction between nagle and delayed ack that can introduce delays of around 200 ms. The latency figures in cases 1 & 2 are very close to that figure.

>From that article it seems an alternative way (other than disabling nagle) is to have a two way communication between the peers of a socket, i.e if the peer has something to send then the ack will not be delayed. In my test application the communication is always one way, either from application to broker (publisher) or from broker to application (consumer). To have a two way communication I need have two threads (consumer & publisher) sharing the same socket.

I searched the mailing list for correct way to write a multithreaded application for RabbitMQ and found a post from you that suggests I should have a single shared socket but thread specific connection and channel.

But I landed into problem trying doing it. The problem is if I create two connections on the same socket and attempt a login on the second connection, the application simply dies (no core). I simulated this in a trivial code. The code is below -

#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#include <stdint.h>
#include <amqp.h>
#include <amqp_framing.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <netinet/tcp.h>


int main()
{
    int socket = amqp_open_socket("127.0.0.1", 5672);

    amqp_connection_state_t connection1 = amqp_new_connection();
    amqp_set_sockfd(connection1, socket);
    amqp_login(connection1, "/", 0, 131072, 0, AMQP_SASL_METHOD_PLAIN, "guest", "guest");
    amqp_channel_open(connection1, 1);

    printf ("Connection 1 .... ok\n");

    amqp_connection_state_t connection2 = amqp_new_connection();
    amqp_set_sockfd(connection2, socket);
    printf ("Login on Connection 2 ....\n"); /* This print comes */
    amqp_login(connection2, "/", 0, 131072, 0, AMQP_SASL_METHOD_PLAIN, "guest", "guest"); /* Application simply dies here ... no core ...nothing */
    printf ("Login on Connection 2 .... ok\n");  /* This print does not come */
    amqp_channel_open(connection2, 1);

    printf ("Connection 2 .... ok\n");
} 

Can you please help on where I am going wrong?

Regards,
Dinabandhu

> -----Original Message-----
> From: Tony Garnock-Jones [mailto:tonyg at lshift.net]
> Sent: Wednesday, January 20, 2010 1:27 AM
> To: Dinabandhu Mitra
> Cc: Alexis Richardson; rabbitmq info; rabbitmq-
> discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Will this work?
> 
> Hi Dinabandhu,
> 
> I think you're running into TCP_NODELAY issues. Try setting your
> client's socket to nodelay mode, which disables Nagling:
> 
>   int one = 1;
>   setsockopt(sockfd, IPPROTO_TCP, TCP_NODELAY, &one, sizeof(one));
> 
> This should fix the high observed latency in cases (a) and (b).
> 
> Regards,
>   Tony
> 
> 
> 
> Dinabandhu Mitra wrote:
> > Hi Alexis,
> >
> > Any further advice on our earlier discussions?
> >
> >
> > I am currently trying out using c API. I was trying to measure
> communication latency introduced by RabbitMQ. Following are some of the
> observations -
> >
> > 1. When the test application starts, the latency for first few
> messages is very high. The number of messages with high latency depends
> on the throughput the application tries to generate. E.g -
> > 	a) For 1/2 message per sec latency continues to be very high
> (over 200 millisecond) throughout.
> > 	b) For 3/4 message per sec it seems to change between high (200)
> and low (0.200) on every alternate message.
> > 	c) For 5 messages per sec it stabilizes to a low value (0.200 -
> 0.300) after first 5/6 messages.
> > 	d) For 10 messages per sec it stabilizes to a low value (0.200 -
> 0.300) after first 5/6 messages.
> > 	e) For 50 messages per sec it stabilizes to a low value (0.200 -
> 0.300) after first 15/16 messages.
> > 	f) For 100 messages per sec it stabilizes to a low value (0.200 -
> 0.300) after first 50/60 messages.
> > 	g) For 500 messages per sec it stabilizes to a low value (0.300 -
> 0.500) after first 370/380 messages.
> > 	h) For 1000 messages per sec it comes down to a low value (0.500
> - 0.700) after first 500 messages. But I have seen intermittent bursts
> of a sequence of high latency (going over 20 millisecond) messages.
> > 	i) Initial latencies increase with throughput. E.g at 1000
> msg/sec it is as high as 380/390 millisecond for some messages.
> >
> > 2. Both publisher and subscriber are in the same server as the
> broker. In fact the publisher and the subscriber are two threads in the
> same process.
> >
> > 3. The server is a idle SUN Netra Dual CPU(Quad Core) Xeon class
> machine with 16G RAM running RHEL 4.7 64 bit.
> >
> > 4. The platform is on the factory configuration; i.e. I have just
> installed the RPMs and started the RabbitMQ server without any other
> configuration.
> >
> > 5. I am using approx 1KB sized messages for this.
> >
> > Is there any configuration that I can do to have better (less
> variance) latency? Also, I am using 1 producer and 1 consumer (both
> trivial). Shall I get better results by using multiple
> producers/consumers?
> >
> > Regards,
> > Dinabandhu
> >
> >> -----Original Message-----
> >> From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
> >> Sent: Tuesday, January 05, 2010 10:33 PM
> >> To: Dinabandhu Mitra
> >> Cc: rabbitmq info
> >> Subject: Re: [rabbitmq-discuss] Will this work?
> >>
> >> Dinabandhu
> >>
> >> Answers / comments below also.  Let me know if you want to cc this
> to
> >> rabbitmq-discuss.  FYI - info at rabbitmq.com is our private (internal
> >> team) list.
> >>
> >> alexis
> >>
> >>
> >>
> >> On Tue, Jan 5, 2010 at 3:16 PM, Dinabandhu Mitra
> >> <Dinabandhu.Mitra at tecnotree.com> wrote:
> >>> The scale of the application depends on the implementation. The
> >> messaging load
> >>> can vary from few hundred per second to over 30,000/40,000 per
> >> second. Of course
> >>> we will add additional equipment depending on the load but the
> >> application should
> >>> be able to use additional equipment effectively.
> >> OK.  That should be fine.  What's the peak ingress per node?
> >>
> >> I.e. what is the max rate that a single publisher might produce in
> >> messages per second?
> >>
> >> Also - are the messages 'small' (< 500 bytes) or 'large' (>64Kb)?
> Is
> >> this size consistent or volatile?
> >>
> >>
> >>
> >>
> >>>> OK.  You will be able to do this with direct exchanges too.  They
> >> are
> >>>> faster (in lookup time) than our current topic implementation.  It
> >>>> does not look like you need topic exchanges because you do not
> >> appear
> >>>> to be routing messages using wildcards, eg. you do not need
> bindings
> >>>> of the form "PE.*".  Is that right?
> >>> Yes. I was reading the AMQP specification concepts section few days
> >> back
> >>> and realized that my understanding of direct exchanges was wrong.
> >> Direct
> >>> exchange should be the right option for us.
> >> Good.
> >>
> >>
> >>
> >>
> >>>>>   a) When a application engine (LE/PE) boots and declares it's
> >> queue
> >>>> and
> >>>>> binding using a connection to the local broker, the queue and
> >>>> bindings
> >>>>> becomes visible to all broker instances running in different
> >> servers.
> >>>> Is
> >>>>> this correct?
> >>>> Correct, provided that the other brokers are in the same cluster
> (as
> >>>> in your diagram) and vhost (ie. namespace).
> >>> It should be sufficient. As of now we are looking at a single
> cluster
> >> and
> >>> single vhost.
> >> OK, cool.
> >>
> >>
> >>
> >>>>>   f) Anyone trying send a message that is immediately non-
> routable
> >>>>> (possibly mandatory+immediate flag with auto-ack) gets a error
> and
> >>>> broker
> >>>>> drops the message. Is this correct?
> >>>> I can't remember exactly how this works.  Basically the answer is
> >> YES.
> >>>>  I cannot recall under what conditions the broker drops the
> message
> >>>> silently, and under what conditions it lets the publisher know
> that
> >> an
> >>>> error occurred.
> >>> Well, this is not a very hard requirement. The LE instances are
> timer
> >> controlled,
> >>> in the sense that if a LE does not receive a response from any of
> the
> >> PEs within
> >>> certain time limit then the LE assumes that there is a problem is
> >> handling the
> >>> request and sends a failure response to the client that originated
> >> the transaction.
> >>> However, it is way better if the rejection can be done without
> >> waiting for the
> >>> timer to expire in case none of the relevant PE engines are live.
> >> This is how the
> >>> application behaves currently.
> >> OK.  We can return to this point later.
> >>
> >> alexis
> >>
> >>
> >>
> >>>> alexis
> >>>>
> >>>>
> >>>>
> >>>>> Regards,
> >>>>> Dinabandhu
> >>>>> --
> >>>>> View this message in context: http://old.nabble.com/Will-this-
> >> work--
> >>>> tp26875409p26875409.html
> >>>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
> >>>>>
> >>>>>
> >>>>> _______________________________________________
> >>>>> rabbitmq-discuss mailing list
> >>>>> rabbitmq-discuss at lists.rabbitmq.com
> >>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
> >> discuss
> >



From matthias at lshift.net  Thu Jan 21 11:40:06 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 21 Jan 2010 11:40:06 +0000
Subject: [rabbitmq-discuss] Will this work?
In-Reply-To: <960996F6EFBCB843BFD62DAA96BD1DD81808BE5964@esmail10>
References: <26875409.post@talk.nabble.com>	<167204d21001050554k6f6646d2q53a0fd73d8cb9d77@mail.gmail.com>	<960996F6EFBCB843BFD62DAA96BD1DD818060D1B48@esmail10>	<167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>	<960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>	<4B560E7E.703@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD81808BE5964@esmail10>
Message-ID: <4B583D16.4030101@lshift.net>

Dinabandhu,

Dinabandhu Mitra wrote:
> I searched the mailing list for correct way to write a multithreaded
> application for RabbitMQ and found a post from you that suggests I
> should have a single shared socket but thread specific connection and
> channel.

I cannot help you with the C client in general - that is Tony's domain 
and he's on holiday - but the above is definitely wrong: a single tcp 
connection can only handle a single AMQP connection.

OTOH, you can indeed have multiple channels per AMQP connection, and 
that is indeed what you'd do if you have multiple client threads.


Regards,

Matthias.



From Dinabandhu.Mitra at tecnotree.com  Thu Jan 21 11:43:44 2010
From: Dinabandhu.Mitra at tecnotree.com (Dinabandhu Mitra)
Date: Thu, 21 Jan 2010 13:43:44 +0200
Subject: [rabbitmq-discuss] Will this work?
In-Reply-To: <4B583D16.4030101@lshift.net>
References: <26875409.post@talk.nabble.com>
	<167204d21001050554k6f6646d2q53a0fd73d8cb9d77@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD818060D1B48@esmail10>
	<167204d21001050903g59c8b4f8ga30d4fa0a33c021a@mail.gmail.com>
	<960996F6EFBCB843BFD62DAA96BD1DD81808A6C62D@esmail10>
	<4B560E7E.703@lshift.net>
	<960996F6EFBCB843BFD62DAA96BD1DD81808BE5964@esmail10>
	<4B583D16.4030101@lshift.net>
Message-ID: <960996F6EFBCB843BFD62DAA96BD1DD81808BE599F@esmail10>

Hi Matthias,

Thanks. I must have misunderstood the post. I will change my code to have a single shared socket, single shared connection but per thread channel.

Regards,
Dinabandhu 

> -----Original Message-----
> From: Matthias Radestock [mailto:matthias at lshift.net]
> Sent: Thursday, January 21, 2010 5:10 PM
> To: Dinabandhu Mitra
> Cc: Tony Garnock-Jones; rabbitmq-discuss at lists.rabbitmq.com; rabbitmq
> info
> Subject: Re: [rabbitmq-discuss] Will this work?
> 
> Dinabandhu,
> 
> Dinabandhu Mitra wrote:
> > I searched the mailing list for correct way to write a multithreaded
> > application for RabbitMQ and found a post from you that suggests I
> > should have a single shared socket but thread specific connection and
> > channel.
> 
> I cannot help you with the C client in general - that is Tony's domain
> and he's on holiday - but the above is definitely wrong: a single tcp
> connection can only handle a single AMQP connection.
> 
> OTOH, you can indeed have multiple channels per AMQP connection, and
> that is indeed what you'd do if you have multiple client threads.
> 
> 
> Regards,
> 
> Matthias.



From matthias at lshift.net  Thu Jan 21 16:54:26 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 21 Jan 2010 16:54:26 +0000
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <558967a41001190610l43d9365cu65ebc2d80012c10e@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>	<558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com>	<167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com>	<9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com>	<167204d21001130517m4e92c85bub09a6b70b294f523@mail.gmail.com>	<9a2d8f781001130552k1cbd118arfc49a35c8ec9fd5a@mail.gmail.com>
	<558967a41001190610l43d9365cu65ebc2d80012c10e@mail.gmail.com>
Message-ID: <4B5886C2.5050606@lshift.net>

Seema,

Seema Biradar wrote:
> I am trying to run the shovel [...]

That code base is ancient; the RabbitMQ Erlang client library it is 
based on has changed substantially since it was written.

There is a new shovel under development. We will make the source 
repository for it available soon, but need to do some tidying up first, 
which may take a while since we are busy on producing the next rabbit 
releases.

Meanwhile, perhaps you could write your own shovel? Depending on the 
specific use case that may turn out to be quite easy. See the links 
Alexis has posted for similar work.


Regards,

Matthias.



From scott.brooks at epicadvertising.com  Thu Jan 21 17:20:33 2010
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Thu, 21 Jan 2010 11:20:33 -0600
Subject: [rabbitmq-discuss] RabbitMQ SNMP Plugin
Message-ID: <58EE7C1F-EF61-4A10-ACD4-85D72F33BA28@epicadvertising.com>

Hey, I've finally got around to putting our SNMP plugin up on github.

http://github.com/epicadvertising/rabbitmq_snmp_plugin

We haven't pushed it out to production, so I would recommend doing your own QA before you decide to use it.

Also, It would be much better to have the information pushed out of Rabbit rather then polling rabbit_amqqueue:info_all

Let me know if you have a hard time testing it out, and I'll update the readme to suit.

Enjoy

---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
scott.brooks at epicadvertising.com




From alexis.richardson at gmail.com  Thu Jan 21 23:07:10 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 21 Jan 2010 23:07:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ SNMP Plugin
In-Reply-To: <58EE7C1F-EF61-4A10-ACD4-85D72F33BA28@epicadvertising.com>
References: <58EE7C1F-EF61-4A10-ACD4-85D72F33BA28@epicadvertising.com>
Message-ID: <167204d21001211507j6b300aect4ddfcd3b5fbc1ef3@mail.gmail.com>

Scott

Thank-you very much!

This is exciting - we look forward to people trying it out :-)

alexis


On Thu, Jan 21, 2010 at 5:20 PM, Scott Brooks
<scott.brooks at epicadvertising.com> wrote:
> Hey, I've finally got around to putting our SNMP plugin up on github.
>
> http://github.com/epicadvertising/rabbitmq_snmp_plugin
>
> We haven't pushed it out to production, so I would recommend doing your own QA before you decide to use it.
>
> Also, It would be much better to have the information pushed out of Rabbit rather then polling rabbit_amqqueue:info_all
>
> Let me know if you have a hard time testing it out, and I'll update the readme to suit.
>
> Enjoy
>
> ---------------------
> Scott Brooks
> Web Developer
> Epic Advertising - New York, Toronto, San Francisco, London
> www.EpicAdvertising.com
> 60 Columbia Way, Suite 310
> Markham, ON L3R 0C9
> (905) 946-0300 x2356 - phone
> (888) 666-3120 - fax
> scott.brooks at epicadvertising.com
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From krummas at gmail.com  Fri Jan 22 10:11:42 2010
From: krummas at gmail.com (Marcus Eriksson)
Date: Fri, 22 Jan 2010 11:11:42 +0100
Subject: [rabbitmq-discuss] C/C++ client
Message-ID: <7ab768b11001220211r12813583g2497ccafc457dfa7@mail.gmail.com>

Hi

What is the recommended C/C++ client for rabbitmq? I tried QPID, but it only
supports 0-10

/Marcus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100122/c29ae334/attachment.htm 

From alexis.richardson at gmail.com  Fri Jan 22 11:57:12 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 22 Jan 2010 11:57:12 +0000
Subject: [rabbitmq-discuss] C/C++ client
In-Reply-To: <7ab768b11001220211r12813583g2497ccafc457dfa7@mail.gmail.com>
References: <7ab768b11001220211r12813583g2497ccafc457dfa7@mail.gmail.com>
Message-ID: <167204d21001220357o160785c3q758df19d7aafa980@mail.gmail.com>

Marcus

This client is being used by quite a few people:
http://hg.rabbitmq.com/rabbitmq-c/

Please let us know if you have suggestions for how it may be improved.

alexis


On Fri, Jan 22, 2010 at 10:11 AM, Marcus Eriksson <krummas at gmail.com> wrote:
> Hi
> What is the recommended C/C++ client for rabbitmq? I tried QPID, but it only
> supports 0-10
> /Marcus
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From krummas at gmail.com  Fri Jan 22 14:27:04 2010
From: krummas at gmail.com (Marcus Eriksson)
Date: Fri, 22 Jan 2010 15:27:04 +0100
Subject: [rabbitmq-discuss] C/C++ client
In-Reply-To: <167204d21001220357o160785c3q758df19d7aafa980@mail.gmail.com>
References: <7ab768b11001220211r12813583g2497ccafc457dfa7@mail.gmail.com>
	<167204d21001220357o160785c3q758df19d7aafa980@mail.gmail.com>
Message-ID: <7ab768b11001220627i204d0540iedc9bd2490b4feea@mail.gmail.com>

Hi

First error when building;
checking location of AMQP codegen directory... configure: error: could not
find AMQP spec file at
"'/home/marcuse/rabbit/rabbitmq-c/codegen/amqp-0.8.json'"

then, after getting the amqp-0.8.json file:
make
...

PYTHONPATH=/home/marcuse/rabbit/rabbitmq-c/codegen python2.5 ./codegen.py
header /home/marcuse/rabbit/rabbitmq-c/codegen/amqp-0.8.json amqp_framing.h
/bin/sh: python2.5: command not found

and after editing Makefile.in to use python2.6 instead:

Traceback (most recent call last):
  File "./codegen.py", line 34, in <module>
    from amqp_codegen import *
ImportError: No module named amqp_codegen

Any advice? Im on fedora 12

/Marcus


On Fri, Jan 22, 2010 at 12:57 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Marcus
>
> This client is being used by quite a few people:
> http://hg.rabbitmq.com/rabbitmq-c/
>
> Please let us know if you have suggestions for how it may be improved.
>
> alexis
>
>
> On Fri, Jan 22, 2010 at 10:11 AM, Marcus Eriksson <krummas at gmail.com>
> wrote:
> > Hi
> > What is the recommended C/C++ client for rabbitmq? I tried QPID, but it
> only
> > supports 0-10
> > /Marcus
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100122/f5f565b2/attachment.htm 

From pauljones23 at gmail.com  Fri Jan 22 15:33:49 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 22 Jan 2010 15:33:49 +0000
Subject: [rabbitmq-discuss] C/C++ client
In-Reply-To: <7ab768b11001220627i204d0540iedc9bd2490b4feea@mail.gmail.com>
References: <7ab768b11001220211r12813583g2497ccafc457dfa7@mail.gmail.com>
	<167204d21001220357o160785c3q758df19d7aafa980@mail.gmail.com>
	<7ab768b11001220627i204d0540iedc9bd2490b4feea@mail.gmail.com>
Message-ID: <29598b611001220733x6ce0e29x4baa26acbf0df8e3@mail.gmail.com>

Hi Marcus,

Try checking out http://hg.rabbitmq.com/rabbitmq-codegen into the same
directory that contains rabbitmq-c. The configure script looks for it there,
and sets a number of things up based on that (as far as I can tell).

Paul.

On Fri, Jan 22, 2010 at 2:27 PM, Marcus Eriksson <krummas at gmail.com> wrote:

> Hi
>
> First error when building;
> checking location of AMQP codegen directory... configure: error: could not
> find AMQP spec file at
> "'/home/marcuse/rabbit/rabbitmq-c/codegen/amqp-0.8.json'"
>
> then, after getting the amqp-0.8.json file:
> make
> ...
>
> PYTHONPATH=/home/marcuse/rabbit/rabbitmq-c/codegen python2.5 ./codegen.py
> header /home/marcuse/rabbit/rabbitmq-c/codegen/amqp-0.8.json amqp_framing.h
> /bin/sh: python2.5: command not found
>
> and after editing Makefile.in to use python2.6 instead:
>
> Traceback (most recent call last):
>   File "./codegen.py", line 34, in <module>
>     from amqp_codegen import *
> ImportError: No module named amqp_codegen
>
> Any advice? Im on fedora 12
>
> /Marcus
>
>
> On Fri, Jan 22, 2010 at 12:57 PM, Alexis Richardson <
> alexis.richardson at gmail.com> wrote:
>
>> Marcus
>>
>> This client is being used by quite a few people:
>> http://hg.rabbitmq.com/rabbitmq-c/
>>
>> Please let us know if you have suggestions for how it may be improved.
>>
>> alexis
>>
>>
>> On Fri, Jan 22, 2010 at 10:11 AM, Marcus Eriksson <krummas at gmail.com>
>> wrote:
>> > Hi
>> > What is the recommended C/C++ client for rabbitmq? I tried QPID, but it
>> only
>> > supports 0-10
>> > /Marcus
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100122/0cd37fe8/attachment.htm 

From bsullivan at lindenlab.com  Sat Jan 23 09:49:58 2010
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Sat, 23 Jan 2010 01:49:58 -0800
Subject: [rabbitmq-discuss] message stats from a given node
In-Reply-To: <4B5565CD.7070709@lshift.net>
References: <b93cb8621001172149p4e69fe3ekcdd1872d63ff21ea@mail.gmail.com> 
	<4B5565CD.7070709@lshift.net>
Message-ID: <b93cb8621001230149r33ae7c2u76129f8dfc3e29e9@mail.gmail.com>

Yes, that's the information I am looking for.

I'll take a look at the proxy stuff, I hadn't considered that before.
Thanks, Matthias.

Cheers,
Brian


On Mon, Jan 18, 2010 at 11:57 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Brian,
>
>
> Brian Sullivan wrote:
>
>> I was wondering if there are any good ideas out there for tracking message
>> rates on a given cluster (in our use case, it's mostly topic-routed
>> messages).  We have been using RabbitMQ for a while now, and have been
>> limited to tracking stats via a consumer that effectively subscribes to '#'
>> and simply breaks down these stats by topic.
>>
>
> So the information you are interested in is "average number of messages per
> second published, per routing key and time period", correct?
>
>
>  This works ok until the message volumes get pretty heavy - the node that
>> the client connects to has to be routed all messages on the cluster, and
>> this breaks down the scalability model for RabbitMQ - eventually that node
>> will be a bottleneck.
>>
>
> One thing you could do at the AMQP level is introduce stat-collecting
> proxies between the publishers and the brokers. Take a look at the RabbitMQ
> tracer in src/com/rabbitmq/tools/Tracer.java in the rabbitmq-java-client
> repo for an example of a proxy.
>
> Another route is via the "pluggable exchange types" we have under
> development - see the bug22169 branch in the rabbitmq-server hg repo. That
> would allow you to define a custom exchange type that works just like an
> ordinary topic (or other) exchange but collects stats on publishes on a
> per-node basis. In the simplest case this could just dump a timestamp and
> routing key to a file, leaving the actual statistics calculations to some
> other program. Or, at the other extreme, the custom exchange could compute
> per-node stats itself and, furthermore, participate in the collation of
> stats from multiple nodes, using the distributed computing features Erlang
> puts at your disposal.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100123/7e5d8d13/attachment.htm 

From uwe at datek.no  Sun Jan 24 00:36:53 2010
From: uwe at datek.no (Uwe Kubosch)
Date: Sun, 24 Jan 2010 01:36:53 +0100
Subject: [rabbitmq-discuss] Heartbeat configuration
In-Reply-To: <FA3D7C54DA3A1540B2C92C93ACD2156006361F34@XOREXCH.India.XoriantCorp.com>
References: <FA3D7C54DA3A1540B2C92C93ACD2156006361F34@XOREXCH.India.XoriantCorp.com>
Message-ID: <2946E497-D26E-4179-AE4C-D1D2410CE60A@datek.no>


On Jan 21, 2010, at 12:12 PM, Anand Ved wrote:
> We are using Java Client to bind to durable queue. Configured heartbeat is say 120 seconds. I would like someone to throw more light on the following:
> 
> How many heartbeats would rabbit server allow to skip before breaking a connection with the client? 
> 
The server will allow only 1 heartbeat to be missed before disconnecting.
> If say it allows 'n' heartbeats to be skipped, then is this 'n' configurable? 
> 
I suspect this is part of the protocol specification, and not configurable.
> What is the max value for heartbeat in production where in we have constant CPU spikes due to other processes running?
> 
I am not aware of any upper limit for the heartbeat interval.

--
Uwe Kubosch
Systems Developer
Datek Wireless AS
uwe at datek.no
http://datek.no/




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/78b84319/attachment.htm 

From uwe at datek.no  Sun Jan 24 00:42:38 2010
From: uwe at datek.no (Uwe Kubosch)
Date: Sun, 24 Jan 2010 01:42:38 +0100
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<167204d21001110300w1ed7e261n2511e071f60bf637@mail.gmail.com>
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>
	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>
	<558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com>
	<167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com>
	<9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com>
Message-ID: <23EFDA38-B5AA-48C3-B37C-1397ECE9B6D1@datek.no>

On Jan 13, 2010, at 1:48 PM, Pradeep Gatram wrote:

We have made a similar "bridge" component in our project, with the only addition being the use of transactions, delivery confirmations, and acknowledgements for reliable delivery of the messages.  I will post a gist if there is interest.

> Here is a quick n dirty amqp replicator that we've been using for a while. Modified it a bit to remove some project specific stuff. You may use it while you wait for the new release.
> 
> Ruby code:
> 
> require 'rubygems'
> require 'mq'
> 
> EM.run do
>   def replicate source, destination, topic
>     source_q = MQ::Queue.new(source, "replicator for #{topic}")
>     source_q.bind(MQ::Exchange.new(source, :topic, topic))
>     destination_ex = MQ::Exchange.new(destination, :topic, topic)
> 
>     source_q.subscribe do |headers, msg|
>       destination_ex.publish(msg)
>     end
>   end
> 
>   local, remote = %w{one two}, %w{three}
>   localhost, remotehost = 'localhost', '192.168.0.26'
> 
>   local_channel = MQ.new(AMQP.connect(:host => localhost, :logging => false))
>   remote_channel = MQ.new(AMQP.connect(:host => remotehost, :logging => false))
>   
>   local.each  { |t| replicate local_channel, remote_channel, t }
>   remote.each { |t| replicate remote_channel, local_channel, t }
> end
> 
> 
> Regards,
> Pradeep
> 
> 

--
Uwe Kubosch
Systems Developer
Datek Wireless AS
uwe at datek.no
http://datek.no/







From uwe at datek.no  Sun Jan 24 00:49:19 2010
From: uwe at datek.no (Uwe Kubosch)
Date: Sun, 24 Jan 2010 01:49:19 +0100
Subject: [rabbitmq-discuss] AMQP message publishing - I wish it was
 synchronous
In-Reply-To: <F569B8E6-EFCC-4686-8C4C-0A7EFC000175@gmail.com>
References: <18F72087-98D0-4A10-AA04-E8300C8AFF88@gmail.com>
	<167204d21001041411m157b3c55mac74e445285cba59@mail.gmail.com>
	<F569B8E6-EFCC-4686-8C4C-0A7EFC000175@gmail.com>
Message-ID: <18BCF8C0-A730-4DD4-ABBC-57D2E8E8F9B8@datek.no>

On Jan 4, 2010, at 11:57 PM, Chris Duncan wrote:

> I have looked at it, but I obviously didn't understood it correctly.  
> So, let's see if I grok this. Suppose I send a tx.select, send my  
> basic.publish and then send a tx.commit. If I receive a tx.commit-ok  
> all is well, otherwise I'll receive a channel exception from the server.
> 
> Not as straightforward as a publish-ok, but hey, if it works ... :)


I have used TX transactions with delivery report with the amqp gem now for a while, and it works well.

For us reliable delivery of messages is the priority since we have very low traffic, like 1 message per second average.

--
Uwe Kubosch
Systems Developer
Datek Wireless AS
uwe at datek.no
http://datek.no/







From uwe at datek.no  Sun Jan 24 00:54:41 2010
From: uwe at datek.no (Uwe Kubosch)
Date: Sun, 24 Jan 2010 01:54:41 +0100
Subject: [rabbitmq-discuss] adjusting timeout for non-acked messages to
 be requeued
In-Reply-To: <20100106110307.GD27068@wellquite.org>
References: <c89c65ea0912282037x7f04d9d6p13da2530eb8ce1e3@mail.gmail.com>
	<167204d20912290548n2bef2766s5d6c00cee28aaf2f@mail.gmail.com>
	<c89c65ea0912290657v313c8c72te0330365d7aae349@mail.gmail.com>
	<167204d20912290706n23d5b13frb1cd02b0802d3b7e@mail.gmail.com>
	<c89c65ea0912291234s1fbbf958nc64e9e91071439b1@mail.gmail.com>
	<167204d20912291504h121bb51bob14a97af735d8d2b@mail.gmail.com>
	<c89c65ea0912291937o7b7b6ff8r161222adc358dcbe@mail.gmail.com>
	<20100106110307.GD27068@wellquite.org>
Message-ID: <6751EFFC-5A8E-48D5-BDDA-9CBA50474995@datek.no>

> Rabbit does eventual delivery. Thus eventually, the message will be
> delivered. However, it may be delivered to more than one consumer. A
> message that is not ack'd will, when the channel on which it was
> delivered closes (or the connection, or some other condition that I
> always forget, but which Matthias pointed out within about the last
> month on this list), be reinserted into its queue to be redelivered.


Where in the queue is the message requeued on disconnect?

If there is only one client, and prefetch is set to 1, and this client does not ack a message and disconnects, will the same message be delivered first on reconnect, or is there a chance of out-of-order delivery?

--
Uwe Kubosch
Systems Developer
Datek Wireless AS
uwe at datek.no
http://datek.no/







From matthew at lshift.net  Sun Jan 24 01:10:45 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 24 Jan 2010 01:10:45 +0000
Subject: [rabbitmq-discuss] adjusting timeout for non-acked messages to
 be requeued
In-Reply-To: <6751EFFC-5A8E-48D5-BDDA-9CBA50474995@datek.no>
References: <c89c65ea0912282037x7f04d9d6p13da2530eb8ce1e3@mail.gmail.com>
	<167204d20912290548n2bef2766s5d6c00cee28aaf2f@mail.gmail.com>
	<c89c65ea0912290657v313c8c72te0330365d7aae349@mail.gmail.com>
	<167204d20912290706n23d5b13frb1cd02b0802d3b7e@mail.gmail.com>
	<c89c65ea0912291234s1fbbf958nc64e9e91071439b1@mail.gmail.com>
	<167204d20912291504h121bb51bob14a97af735d8d2b@mail.gmail.com>
	<c89c65ea0912291937o7b7b6ff8r161222adc358dcbe@mail.gmail.com>
	<20100106110307.GD27068@wellquite.org>
	<6751EFFC-5A8E-48D5-BDDA-9CBA50474995@datek.no>
Message-ID: <20100124011045.GA27524@wellquite.org>

On Sun, Jan 24, 2010 at 01:54:41AM +0100, Uwe Kubosch wrote:
> > Rabbit does eventual delivery. Thus eventually, the message will be
> > delivered. However, it may be delivered to more than one consumer. A
> > message that is not ack'd will, when the channel on which it was
> > delivered closes (or the connection, or some other condition that I
> > always forget, but which Matthias pointed out within about the last
> > month on this list), be reinserted into its queue to be redelivered.
> 
> Where in the queue is the message requeued on disconnect?

It's not defined in the spec. RabbitMQ puts it at the tail of the queue,
but there is no guarantee that that behaviour will not change in the
future. Do not rely on this.

> If there is only one client, and prefetch is set to 1, and this client does not ack a message and disconnects, will the same message be delivered first on reconnect, or is there a chance of out-of-order delivery?

As above - it's currently the case that the message will be put at the
end of the queue and will be the last message delivered. The spec does
not rule either way on this. You should be able to verify this behaviour
yourself from testing.

Matthew



From alexis.richardson at gmail.com  Sun Jan 24 09:20:53 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 24 Jan 2010 09:20:53 +0000
Subject: [rabbitmq-discuss] rabbitmq server to server communication
In-Reply-To: <23EFDA38-B5AA-48C3-B37C-1397ECE9B6D1@datek.no>
References: <558967a41001102321g1e776964webd0f71806b5815@mail.gmail.com>
	<558967a41001112300i3baffa67rdb3251a882ebae6@mail.gmail.com>
	<9a2d8f781001112318p6f16aeffv76a3f79216c031b2@mail.gmail.com>
	<167204d21001120952j65e61dcodab246f7f67a9236@mail.gmail.com>
	<558967a41001130117o789bba63ma5263669b2613ae8@mail.gmail.com>
	<167204d21001130352g75fd4b17iecfb7284513c8200@mail.gmail.com>
	<558967a41001130409w73329139w36cb0da4c8d4ff3b@mail.gmail.com>
	<167204d21001130412p38b7885fn7033554ad30fc6aa@mail.gmail.com>
	<9a2d8f781001130448m6a9ea8d7nd1f22714d941f946@mail.gmail.com>
	<23EFDA38-B5AA-48C3-B37C-1397ECE9B6D1@datek.no>
Message-ID: <167204d21001240120u2bc984adve2d548092bd540b7@mail.gmail.com>

Uwe

On Sun, Jan 24, 2010 at 12:42 AM, Uwe Kubosch <uwe at datek.no> wrote:
>
> We have made a similar "bridge" component in our project, with the only addition being the use of transactions, delivery confirmations, and acknowledgements for reliable delivery of the messages. ?I will post a gist if there is interest.

That would be great.  Running examples are helpful.

alexis




>> Here is a quick n dirty amqp replicator that we've been using for a while. Modified it a bit to remove some project specific stuff. You may use it while you wait for the new release.
>>
>> Ruby code:
>>
>> require 'rubygems'
>> require 'mq'
>>
>> EM.run do
>> ? def replicate source, destination, topic
>> ? ? source_q = MQ::Queue.new(source, "replicator for #{topic}")
>> ? ? source_q.bind(MQ::Exchange.new(source, :topic, topic))
>> ? ? destination_ex = MQ::Exchange.new(destination, :topic, topic)
>>
>> ? ? source_q.subscribe do |headers, msg|
>> ? ? ? destination_ex.publish(msg)
>> ? ? end
>> ? end
>>
>> ? local, remote = %w{one two}, %w{three}
>> ? localhost, remotehost = 'localhost', '192.168.0.26'
>>
>> ? local_channel = MQ.new(AMQP.connect(:host => localhost, :logging => false))
>> ? remote_channel = MQ.new(AMQP.connect(:host => remotehost, :logging => false))
>>
>> ? local.each ?{ |t| replicate local_channel, remote_channel, t }
>> ? remote.each { |t| replicate remote_channel, local_channel, t }
>> end
>>
>>
>> Regards,
>> Pradeep
>>
>>
>
> --
> Uwe Kubosch
> Systems Developer
> Datek Wireless AS
> uwe at datek.no
> http://datek.no/
>
>
>
>
>



From aquino.gustavo at gmail.com  Sun Jan 24 17:10:49 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 24 Jan 2010 15:10:49 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
Message-ID: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>

Hi,

I really would like to know why Rabbit crash all the time that I stop server
without run rabbitctl stop. It happened 4 times with me, with different
servers.

If server restart with shutdown -h now, when you restart and try to use
rabbit-server it will say:

*+---+   +---+*
*|   |   |   |*
*|   |   |   |*
*|   |   |   |*
*|   +---+   +-------+*
*|                   |*
*| RabbitMQ  +---+   |*
*|           |   |   |*
*|   v1.7.0  +---+   |*
*|                   |*
*+-------------------+*
*AMQP 8-0*
*Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.*
*Licensed under the MPL.  See http://www.rabbitmq.com/*
*
*
*node          : rabbit at 189-94-130-143*
*app descriptor:
/opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
*
*home dir      : /opt/local/var/lib/rabbitmq*
*cookie hash   : diX16VkN3b6UrKJtDPVb1Q==*
*log           : /opt/local/var/log/rabbitmq/rabbit.log*
*sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log*
*database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit*


*starting database             ...{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
*
*
*
*Crash dump was written to: erl_crash.dump*
*init terminating in do_boot ()*

If you do ctrl+C in console running RabbitMQ server the same error
will occur.

The unique way that I resolve it was removing and re-installing erlang and
Rabbitmq.

Well i never got this problem with Rabbit in version 1.5 but this re
happened all the time with 1.7.

What`'s happen ? Anybody know how to solve it ? I got this problem in MacOS/
Debian and RHE

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/0c9a644e/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.tgz
Type: application/x-gzip
Size: 183 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/0c9a644e/attachment.bin 

From mabrek at gmail.com  Sun Jan 24 17:36:30 2010
From: mabrek at gmail.com (mabrek)
Date: Sun, 24 Jan 2010 20:36:30 +0300
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
Message-ID: <4B5C851E.6000908@gmail.com>

Hi.
How long does it take from start to crash?
It may be concerned with large amount of data that takes a long time to load.
If it's your case try to raise "maxwait" parameter as described in http://www.rabbitmq.com/install.html

Regards.

Gustavo Aquino wrote:
> Hi,
> 
> I really would like to know why Rabbit crash all the time that I stop
> server without run rabbitctl stop. It happened 4 times with me, with
> different servers.
> 
> If server restart with shutdown -h now, when you restart and try to use
> rabbit-server it will say:
> 
> /*+---+   +---+*/
> /*|   |   |   |*/
> /*|   |   |   |*/
> /*|   |   |   |*/
> /*|   +---+   +-------+*/
> /*|                   |*/
> /*| RabbitMQ  +---+   |*/
> /*|           |   |   |*/
> /*|   v1.7.0  +---+   |*/
> /*|                   |*/
> /*+-------------------+*/
> /*AMQP 8-0*/
> /*Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
> LLC., and Rabbit Technologies Ltd.*/
> /*Licensed under the MPL.  See http://www.rabbitmq.com/*/
> /*
> */
> /*node          : rabbit at 189-94-130-143*/
> /*app descriptor:
> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app*/
> /*home dir      : /opt/local/var/lib/rabbitmq*/
> /*cookie hash   : diX16VkN3b6UrKJtDPVb1Q==*/
> /*log           : /opt/local/var/log/rabbitmq/rabbit.log*/
> /*sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log*/
> /*database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit*/
> 
> 
> *starting database             ...{"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}*
> *
> *
> *Crash dump was written to: erl_crash.dump*
> *init terminating in do_boot ()*
>  
> If you do ctrl+C in console running RabbitMQ server the same error
> will occur.
> 
> The unique way that I resolve it was removing and re-installing erlang
> and Rabbitmq.
> 
> Well i never got this problem with Rabbit in version 1.5 but this re
> happened all the time with 1.7.
> 
> What`'s happen ? Anybody know how to solve it ? I got this problem in
> MacOS/ Debian and RHE
> 
> Regards.
> 
> 
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From aquino.gustavo at gmail.com  Sun Jan 24 17:43:58 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 24 Jan 2010 15:43:58 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <4B5C851E.6000908@gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
Message-ID: <5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>

Hi,

I don't know exactly but I think about 50 seconds.

No my server don't have any persistent queue. And transient queue has 100
messages when I reboot the machine forgotten to stop rabbit, and when i try
to start it again I got this error.


Here is my log.
=CRASH REPORT==== 24-Jan-2010::15:34:49 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.95.0>
    registered_name: []
    exception exit: {{timeout_waiting_for_tables,
                         [rabbit_user,rabbit_user_permission,rabbit_vhost,

 rabbit_config,rabbit_listener,rabbit_durable_route,
                          rabbit_route,rabbit_reverse_route,
                          rabbit_durable_exchange,rabbit_exchange,
                          rabbit_durable_queue,rabbit_queue]},
                     {rabbit,start,[normal,[]]}}
      in function  application_master:init/4
    ancestors: [<0.94.0>]
    messages: [{'EXIT',<0.96.0>,normal}]
    links: [<0.94.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 226
  neighbours:
----

Here how long time at start to crash

$ date
*Dom 24 Jan 2010 15:41:18 BRST*
$ ./start-rabbitmq.sh
Password:

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.0  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at 189-94-130-143
app descriptor:
/opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
home dir      : /opt/local/var/lib/rabbitmq
cookie hash   : diX16VkN3b6UrKJtDPVb1Q==
log           : /opt/local/var/log/rabbitmq/rabbit.log
sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit

starting database             ...{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
$ date
*Dom 24 Jan 2010 15:42:01 BRST*



Thanks


On Sun, Jan 24, 2010 at 3:36 PM, mabrek <mabrek at gmail.com> wrote:

> Hi.
> How long does it take from start to crash?
> It may be concerned with large amount of data that takes a long time to
> load.
> If it's your case try to raise "maxwait" parameter as described in
> http://www.rabbitmq.com/install.html
>
> Regards.
>
> Gustavo Aquino wrote:
> > Hi,
> >
> > I really would like to know why Rabbit crash all the time that I stop
> > server without run rabbitctl stop. It happened 4 times with me, with
> > different servers.
> >
> > If server restart with shutdown -h now, when you restart and try to use
> > rabbit-server it will say:
> >
> > /*+---+   +---+*/
> > /*|   |   |   |*/
> > /*|   |   |   |*/
> > /*|   |   |   |*/
> > /*|   +---+   +-------+*/
> > /*|                   |*/
> > /*| RabbitMQ  +---+   |*/
> > /*|           |   |   |*/
> > /*|   v1.7.0  +---+   |*/
> > /*|                   |*/
> > /*+-------------------+*/
> > /*AMQP 8-0*/
> > /*Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
> > LLC., and Rabbit Technologies Ltd.*/
> > /*Licensed under the MPL.  See http://www.rabbitmq.com/*/
> > /*
> > */
> > /*node          : rabbit at 189-94-130-143*/
> > /*app descriptor:
> >
> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app*/
> > /*home dir      : /opt/local/var/lib/rabbitmq*/
> > /*cookie hash   : diX16VkN3b6UrKJtDPVb1Q==*/
> > /*log           : /opt/local/var/log/rabbitmq/rabbit.log*/
> > /*sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log*/
> > /*database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit*/
> >
> >
> > *starting database             ...{"init terminating in
> >
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}*
> > *
> > *
> > *Crash dump was written to: erl_crash.dump*
> > *init terminating in do_boot ()*
> >
> > If you do ctrl+C in console running RabbitMQ server the same error
> > will occur.
> >
> > The unique way that I resolve it was removing and re-installing erlang
> > and Rabbitmq.
> >
> > Well i never got this problem with Rabbit in version 1.5 but this re
> > happened all the time with 1.7.
> >
> > What`'s happen ? Anybody know how to solve it ? I got this problem in
> > MacOS/ Debian and RHE
> >
> > Regards.
> >
> >
> >
> >
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/f7128ac2/attachment.htm 

From matthew at lshift.net  Sun Jan 24 17:53:14 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 24 Jan 2010 17:53:14 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
Message-ID: <20100124175314.GA17963@wellquite.org>

Hi,

On Sun, Jan 24, 2010 at 03:43:58PM -0200, Gustavo Aquino wrote:
> No my server don't have any persistent queue. And transient queue has 100
> messages when I reboot the machine forgotten to stop rabbit, and when i try
> to start it again I got this error.

If you're happy to lose everything you have stored in Rabbit, (seeing as
you say you don't have any persistent queues, I expect you may not mind
this - though you will also lose user accounts etc), just delete
everything under /opt/local/var/log/rabbitmq/, or just move it out of the
way. RabbitMQ should then start up fine.

Matthew



From aquino.gustavo at gmail.com  Sun Jan 24 18:06:08 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 24 Jan 2010 16:06:08 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100124175314.GA17963@wellquite.org>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
Message-ID: <5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>

Hi Matthew,

I remove all data in /opt/local/var/log/rabbitmq/

$ ls -la /opt/local/var/log/rabbitmq
total 0
drwxrwxr-x  2 root  rabbitmq   68 24 Jan 16:04 .
drwxr-xr-x  3 root  admin     102 27 Dez 19:56 ..

And Start Rabbit.

*starting database             ...{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
*
*
*
*Crash dump was written to: erl_crash.dump*
*init terminating in do_boot ()*


No success. :(

Thanks.



On Sun, Jan 24, 2010 at 3:53 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi,
>
> On Sun, Jan 24, 2010 at 03:43:58PM -0200, Gustavo Aquino wrote:
> > No my server don't have any persistent queue. And transient queue has 100
> > messages when I reboot the machine forgotten to stop rabbit, and when i
> try
> > to start it again I got this error.
>
> If you're happy to lose everything you have stored in Rabbit, (seeing as
> you say you don't have any persistent queues, I expect you may not mind
> this - though you will also lose user accounts etc), just delete
> everything under /opt/local/var/log/rabbitmq/, or just move it out of the
> way. RabbitMQ should then start up fine.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/a60fa112/attachment.htm 

From matthew at lshift.net  Sun Jan 24 18:20:21 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 24 Jan 2010 18:20:21 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
Message-ID: <20100124182021.GA18298@wellquite.org>

Hi,

On Sun, Jan 24, 2010 at 04:06:08PM -0200, Gustavo Aquino wrote:
> I remove all data in /opt/local/var/log/rabbitmq/
> 
> $ ls -la /opt/local/var/log/rabbitmq
> total 0
> drwxrwxr-x  2 root  rabbitmq   68 24 Jan 16:04 .
> drwxr-xr-x  3 root  admin     102 27 Dez 19:56 ..
> 
> And Start Rabbit.
> 
> *starting database             ...{"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}

Sigh, I'm so sorry - I told you the wrong location. I meant
/opt/local/var/lib/rabbitmq/mnesia/rabbit

though I'm confused as to why in your dump of the startup, there are *
against all those paths.

Matthew



From matthew at lshift.net  Sun Jan 24 18:21:33 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 24 Jan 2010 18:21:33 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100124182021.GA18298@wellquite.org>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
Message-ID: <20100124182133.GA21378@wellquite.org>

On Sun, Jan 24, 2010 at 06:20:21PM +0000, Matthew Sackman wrote:
> though I'm confused as to why in your dump of the startup, there are *
> against all those paths.

Ahh, it just looks like all the lines are pre- and suf-fixed by *s

Matthew



From aquino.gustavo at gmail.com  Sun Jan 24 18:42:31 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 24 Jan 2010 16:42:31 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100124182133.GA21378@wellquite.org>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
Message-ID: <5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>

Hi Matthew,

It's works, I delete all rabbit files and schema.DAT and Rabbit come back to
work, but look that, i do one crtl+C in console and Rabbit crash again.

I really would like to know why it's happened I'm working in a very big
project that planing to use RabbitMQ and this comportment seriously concern
us, principally that we will have persistent queues that can be removed.

Can you explain more about the problem please ?

Regards

On Sun, Jan 24, 2010 at 4:21 PM, Matthew Sackman <matthew at lshift.net> wrote:

> On Sun, Jan 24, 2010 at 06:20:21PM +0000, Matthew Sackman wrote:
> > though I'm confused as to why in your dump of the startup, there are *
> > against all those paths.
>
> Ahh, it just looks like all the lines are pre- and suf-fixed by *s
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/85e00764/attachment.htm 

From matthew at lshift.net  Sun Jan 24 19:07:07 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 24 Jan 2010 19:07:07 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
Message-ID: <20100124190707.GB21378@wellquite.org>

Hi,

On Sun, Jan 24, 2010 at 04:42:31PM -0200, Gustavo Aquino wrote:
> It's works, I delete all rabbit files and schema.DAT and Rabbit come back to
> work, but look that, i do one crtl+C in console and Rabbit crash again.
> 
> I really would like to know why it's happened I'm working in a very big
> project that planing to use RabbitMQ and this comportment seriously concern
> us, principally that we will have persistent queues that can be removed.
> 
> Can you explain more about the problem please ?

Well I would if I could. I'm not sure why what's happening is happening
for you - I've not really seen it before. If your database is empty(ish)
then I have no idea why mnesia is taking so long to start up. Can you
monitor disk activity and CPU activity? - is the startup process
swamping lots of CPU or disk throughput as it tries to come up? Are you
running in a clustered scenario? What OS are you using - is this "in the
cloud" at all, or virtualised in some way?

Normally, with an small database, mnesia should start up very quickly
indeed, so I am puzzled as to why this timeout is occurring for you.

Matthew



From aquino.gustavo at gmail.com  Sun Jan 24 20:07:39 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 24 Jan 2010 18:07:39 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100124190707.GB21378@wellquite.org>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
Message-ID: <5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>

I got this same problem using MacOS 10.5, that I'm using now, RHE and Debian
with RabbitMQ 1.7 never got it with 1.6.

Look I can reproduce it all the time, in all this environments just do
Crtl+C in console running RabbitMQ-server and try to start again, and booom
the problem appears. I just do it again to show the metrics that you request
me.


====== Fail process.
* ./start-rabbitmq.sh *

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.0  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at 189-94-130-143
app descriptor:
/opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
home dir      : /opt/local/var/lib/rabbitmq
cookie hash   : diX16VkN3b6UrKJtDPVb1Q==
log           : /opt/local/var/log/rabbitmq/rabbit.log
sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running
*^C*
*BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded*
*       (v)ersion (k)ill (D)b-tables (d)istribution*
*a*

*$~ gustavoaquino$ ./start-rabbitmq.sh *
Password:

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.0  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at 187-26-170-110
app descriptor:
/opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
home dir      : /opt/local/var/lib/rabbitmq
cookie hash   : diX16VkN3b6UrKJtDPVb1Q==
log           : /opt/local/var/log/rabbitmq/rabbit.log
sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit

*starting database             ...{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
*
*
*
*Crash dump was written to: erl_crash.dump*
*init terminating in do_boot ()*

=== Final fail process

About resources machine, the CPU, Memory and IO increase just 1 or 3 % of
start time, at start time my machine was using 10% of CPU, Memory dont grow
nothing about 20-30mb, and IO just continue in the same way I don't identify
any different in machine status.

To put my rabbit to work again after this test I just delete the schema.DAT
file in /opt/local/var/lib/rabbitmq/mnesia/rabbit, don't remove all the
files.

This is the file size before deleted.

-rw-r--r--   1 rabbitmq  rabbitmq  12K 24 Jan 16:36 schema.DAT


[]s


On Sun, Jan 24, 2010 at 5:07 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi,
>
> On Sun, Jan 24, 2010 at 04:42:31PM -0200, Gustavo Aquino wrote:
> > It's works, I delete all rabbit files and schema.DAT and Rabbit come back
> to
> > work, but look that, i do one crtl+C in console and Rabbit crash again.
> >
> > I really would like to know why it's happened I'm working in a very big
> > project that planing to use RabbitMQ and this comportment seriously
> concern
> > us, principally that we will have persistent queues that can be removed.
> >
> > Can you explain more about the problem please ?
>
> Well I would if I could. I'm not sure why what's happening is happening
> for you - I've not really seen it before. If your database is empty(ish)
> then I have no idea why mnesia is taking so long to start up. Can you
> monitor disk activity and CPU activity? - is the startup process
> swamping lots of CPU or disk throughput as it tries to come up? Are you
> running in a clustered scenario? What OS are you using - is this "in the
> cloud" at all, or virtualised in some way?
>
> Normally, with an small database, mnesia should start up very quickly
> indeed, so I am puzzled as to why this timeout is occurring for you.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/32e10324/attachment.htm 

From g at rre.tt  Sun Jan 24 20:19:42 2010
From: g at rre.tt (Garrett Smith)
Date: Sun, 24 Jan 2010 14:19:42 -0600
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
Message-ID: <ce2570e21001241219k70ac884bt229c488d78e2d876@mail.gmail.com>

On Sun, Jan 24, 2010 at 2:07 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> I got this same problem using MacOS 10.5, that I'm using now, RHE and Debian
> with RabbitMQ 1.7 never got it with 1.6.
> Look I can reproduce it all the time, in all this environments just do
> Crtl+C in console running RabbitMQ-server and try to start again, and booom
> the problem?appears.

I'm not a rabbitmq internals expert, but you might get some insight
into this if you enable debug logging for mnesia during startup.

Generally you'd uses these options with erl:

-mnesia debug verbose

There might be a way to pass this through via a startup script or
config file, otherwise I'd just hack one of the scripts to turn this
on.

Garrett



From matthew at lshift.net  Sun Jan 24 20:19:47 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 24 Jan 2010 20:19:47 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
Message-ID: <20100124201947.GC21378@wellquite.org>

Hi,

On Sun, Jan 24, 2010 at 06:07:39PM -0200, Gustavo Aquino wrote:
> I got this same problem using MacOS 10.5, that I'm using now, RHE and Debian
> with RabbitMQ 1.7 never got it with 1.6.
> 
> Look I can reproduce it all the time, in all this environments just do
> Crtl+C in console running RabbitMQ-server and try to start again, and booom
> the problem appears. I just do it again to show the metrics that you request
> me.

I assure you, we start and stop rabbit all the time in this way, and
don't see this problem. No one else has reported this problem when the
mnesia database is empty (or at least not very big).

Sigh, just looking at your two traces, your IP address has change - and
you appear to be basing your hostname on your IP address. This is a known
problem, especially with Macs.

In message 4B4B4160.1010704 at lshift.net, Tony said:
"Yes, it is. It's because of the way macs change their hostname. This
interacts badly with the way epmd looks up its own address. Some relief
might be found by following the ideas from this thread:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-October/005053.html
"

In short, mnesia will write the full nodename to disk when it creates the
schema. If your nodename changes then it will fail to restart.

Matthew



From aquino.gustavo at gmail.com  Sun Jan 24 20:29:34 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 24 Jan 2010 18:29:34 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100124201947.GC21378@wellquite.org>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<20100124201947.GC21378@wellquite.org>
Message-ID: <5ef296b31001241229lc2f7e7eucb7e757576078468@mail.gmail.com>

Gotcha...

My mac change hostname all the time that I reconnect in internet using 3G.
If i drop rabbit without disconnect Rabbit start without problem. If I stop
and start connection between rabbit's start stop, rabbit crash.

But in RHE and Debian environment I don't change the hostname and the
problem is the same, Tomorrow I will try to reproduce it in my servers and
report here.

Regards.

On Sun, Jan 24, 2010 at 6:19 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi,
>
> On Sun, Jan 24, 2010 at 06:07:39PM -0200, Gustavo Aquino wrote:
> > I got this same problem using MacOS 10.5, that I'm using now, RHE and
> Debian
> > with RabbitMQ 1.7 never got it with 1.6.
> >
> > Look I can reproduce it all the time, in all this environments just do
> > Crtl+C in console running RabbitMQ-server and try to start again, and
> booom
> > the problem appears. I just do it again to show the metrics that you
> request
> > me.
>
> I assure you, we start and stop rabbit all the time in this way, and
> don't see this problem. No one else has reported this problem when the
> mnesia database is empty (or at least not very big).
>
> Sigh, just looking at your two traces, your IP address has change - and
> you appear to be basing your hostname on your IP address. This is a known
> problem, especially with Macs.
>
> In message 4B4B4160.1010704 at lshift.net, Tony said:
> "Yes, it is. It's because of the way macs change their hostname. This
> interacts badly with the way epmd looks up its own address. Some relief
> might be found by following the ideas from this thread:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-October/005053.html
> "
>
> In short, mnesia will write the full nodename to disk when it creates the
> schema. If your nodename changes then it will fail to restart.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/78d2d3ef/attachment.htm 

From alexis.richardson at gmail.com  Sun Jan 24 21:04:11 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 24 Jan 2010 21:04:11 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001241229lc2f7e7eucb7e757576078468@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<20100124201947.GC21378@wellquite.org>
	<5ef296b31001241229lc2f7e7eucb7e757576078468@mail.gmail.com>
Message-ID: <167204d21001241304x4bf356den55248a9bd1a01198@mail.gmail.com>

Gustavo

Thanks - please do let us know how you get on with your server
environment.  As Matthew implied there are some annoyances about the
mac and networks which are usually solvable with a little care.

alexis


On Sun, Jan 24, 2010 at 8:29 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Gotcha...
> My mac change hostname all the time that I reconnect in internet using 3G.
> If i drop rabbit without disconnect Rabbit start without problem. If I stop
> and start connection between rabbit's start stop, rabbit crash.
> But in RHE and Debian environment I don't change the hostname and the
> problem is the same, Tomorrow I will try to reproduce it in my servers and
> report here.
> Regards.
>
> On Sun, Jan 24, 2010 at 6:19 PM, Matthew Sackman <matthew at lshift.net> wrote:
>>
>> Hi,
>>
>> On Sun, Jan 24, 2010 at 06:07:39PM -0200, Gustavo Aquino wrote:
>> > I got this same problem using MacOS 10.5, that I'm using now, RHE and
>> > Debian
>> > with RabbitMQ 1.7 never got it with 1.6.
>> >
>> > Look I can reproduce it all the time, in all this environments just do
>> > Crtl+C in console running RabbitMQ-server and try to start again, and
>> > booom
>> > the problem appears. I just do it again to show the metrics that you
>> > request
>> > me.
>>
>> I assure you, we start and stop rabbit all the time in this way, and
>> don't see this problem. No one else has reported this problem when the
>> mnesia database is empty (or at least not very big).
>>
>> Sigh, just looking at your two traces, your IP address has change - and
>> you appear to be basing your hostname on your IP address. This is a known
>> problem, especially with Macs.
>>
>> In message 4B4B4160.1010704 at lshift.net, Tony said:
>> "Yes, it is. It's because of the way macs change their hostname. This
>> interacts badly with the way epmd looks up its own address. Some relief
>> might be found by following the ideas from this thread:
>>
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-October/005053.html
>> "
>>
>> In short, mnesia will write the full nodename to disk when it creates the
>> schema. If your nodename changes then it will fail to restart.
>>
>> Matthew
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From aquino.gustavo at gmail.com  Sun Jan 24 21:30:26 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Sun, 24 Jan 2010 19:30:26 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <167204d21001241304x4bf356den55248a9bd1a01198@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<20100124201947.GC21378@wellquite.org>
	<5ef296b31001241229lc2f7e7eucb7e757576078468@mail.gmail.com>
	<167204d21001241304x4bf356den55248a9bd1a01198@mail.gmail.com>
Message-ID: <5ef296b31001241330u1e25bf02g6e71fb6c03c06f24@mail.gmail.com>

Alexis,

Good to know and very relieved about this problem, Tomorrow I will post
about my environments with the same problem.

Gustavo

On Sun, Jan 24, 2010 at 7:04 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gustavo
>
> Thanks - please do let us know how you get on with your server
> environment.  As Matthew implied there are some annoyances about the
> mac and networks which are usually solvable with a little care.
>
> alexis
>
>
> On Sun, Jan 24, 2010 at 8:29 PM, Gustavo Aquino
> <aquino.gustavo at gmail.com> wrote:
> > Gotcha...
> > My mac change hostname all the time that I reconnect in internet using
> 3G.
> > If i drop rabbit without disconnect Rabbit start without problem. If I
> stop
> > and start connection between rabbit's start stop, rabbit crash.
> > But in RHE and Debian environment I don't change the hostname and the
> > problem is the same, Tomorrow I will try to reproduce it in my servers
> and
> > report here.
> > Regards.
> >
> > On Sun, Jan 24, 2010 at 6:19 PM, Matthew Sackman <matthew at lshift.net>
> wrote:
> >>
> >> Hi,
> >>
> >> On Sun, Jan 24, 2010 at 06:07:39PM -0200, Gustavo Aquino wrote:
> >> > I got this same problem using MacOS 10.5, that I'm using now, RHE and
> >> > Debian
> >> > with RabbitMQ 1.7 never got it with 1.6.
> >> >
> >> > Look I can reproduce it all the time, in all this environments just do
> >> > Crtl+C in console running RabbitMQ-server and try to start again, and
> >> > booom
> >> > the problem appears. I just do it again to show the metrics that you
> >> > request
> >> > me.
> >>
> >> I assure you, we start and stop rabbit all the time in this way, and
> >> don't see this problem. No one else has reported this problem when the
> >> mnesia database is empty (or at least not very big).
> >>
> >> Sigh, just looking at your two traces, your IP address has change - and
> >> you appear to be basing your hostname on your IP address. This is a
> known
> >> problem, especially with Macs.
> >>
> >> In message 4B4B4160.1010704 at lshift.net, Tony said:
> >> "Yes, it is. It's because of the way macs change their hostname. This
> >> interacts badly with the way epmd looks up its own address. Some relief
> >> might be found by following the ideas from this thread:
> >>
> >>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-October/005053.html
> >> "
> >>
> >> In short, mnesia will write the full nodename to disk when it creates
> the
> >> schema. If your nodename changes then it will fail to restart.
> >>
> >> Matthew
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100124/71bec0a9/attachment.htm 

From alexis.richardson at gmail.com  Sun Jan 24 21:39:06 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 24 Jan 2010 21:39:06 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001241330u1e25bf02g6e71fb6c03c06f24@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<20100124201947.GC21378@wellquite.org>
	<5ef296b31001241229lc2f7e7eucb7e757576078468@mail.gmail.com>
	<167204d21001241304x4bf356den55248a9bd1a01198@mail.gmail.com>
	<5ef296b31001241330u1e25bf02g6e71fb6c03c06f24@mail.gmail.com>
Message-ID: <167204d21001241339q2927ec51p4221af1038cf7d3b@mail.gmail.com>

Gustavo

The main issue with macs is how they grant IP addresses.  A search of
the list archives will reveal a number of irksome consequences of
this.  Unfortunately current network theory does not offer one agreed
elegant solution to this, so we and others have to use ad hoc
workarounds.

alexis


On Sun, Jan 24, 2010 at 9:30 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Alexis,
> Good to know and very relieved about this problem, Tomorrow I will post
> about my environments with the same problem.
> Gustavo
> On Sun, Jan 24, 2010 at 7:04 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gustavo
>>
>> Thanks - please do let us know how you get on with your server
>> environment. ?As Matthew implied there are some annoyances about the
>> mac and networks which are usually solvable with a little care.
>>
>> alexis
>>
>>
>> On Sun, Jan 24, 2010 at 8:29 PM, Gustavo Aquino
>> <aquino.gustavo at gmail.com> wrote:
>> > Gotcha...
>> > My mac change hostname all the time that I reconnect in internet using
>> > 3G.
>> > If i drop rabbit without disconnect Rabbit start without problem. If I
>> > stop
>> > and start connection between rabbit's start stop, rabbit crash.
>> > But in RHE and Debian environment I don't change the hostname and the
>> > problem is the same, Tomorrow I will try to reproduce it in my servers
>> > and
>> > report here.
>> > Regards.
>> >
>> > On Sun, Jan 24, 2010 at 6:19 PM, Matthew Sackman <matthew at lshift.net>
>> > wrote:
>> >>
>> >> Hi,
>> >>
>> >> On Sun, Jan 24, 2010 at 06:07:39PM -0200, Gustavo Aquino wrote:
>> >> > I got this same problem using MacOS 10.5, that I'm using now, RHE and
>> >> > Debian
>> >> > with RabbitMQ 1.7 never got it with 1.6.
>> >> >
>> >> > Look I can reproduce it all the time, in all this environments just
>> >> > do
>> >> > Crtl+C in console running RabbitMQ-server and try to start again, and
>> >> > booom
>> >> > the problem appears. I just do it again to show the metrics that you
>> >> > request
>> >> > me.
>> >>
>> >> I assure you, we start and stop rabbit all the time in this way, and
>> >> don't see this problem. No one else has reported this problem when the
>> >> mnesia database is empty (or at least not very big).
>> >>
>> >> Sigh, just looking at your two traces, your IP address has change - and
>> >> you appear to be basing your hostname on your IP address. This is a
>> >> known
>> >> problem, especially with Macs.
>> >>
>> >> In message 4B4B4160.1010704 at lshift.net, Tony said:
>> >> "Yes, it is. It's because of the way macs change their hostname. This
>> >> interacts badly with the way epmd looks up its own address. Some relief
>> >> might be found by following the ideas from this thread:
>> >>
>> >>
>> >> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-October/005053.html
>> >> "
>> >>
>> >> In short, mnesia will write the full nodename to disk when it creates
>> >> the
>> >> schema. If your nodename changes then it will fail to restart.
>> >>
>> >> Matthew
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>



From richard_holt at btopenworld.com  Mon Jan 25 08:37:34 2010
From: richard_holt at btopenworld.com (Richard Holt)
Date: Mon, 25 Jan 2010 00:37:34 -0800 (PST)
Subject: [rabbitmq-discuss]  RabbitMQ Streaming
Message-ID: <27273093.post@talk.nabble.com>


Hi All,

I was wondering if there is a java implementation of the Stream. functions
i.e. Stream.Publish e.t.c. 

We are using very large files in some cases and the Basic.Publish balks at
very large messages as does the client JVM.

Regards,

Richard
-- 
View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27273093.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From pauljones23 at gmail.com  Mon Jan 25 09:00:01 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 25 Jan 2010 09:00:01 +0000
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27273093.post@talk.nabble.com>
References: <27273093.post@talk.nabble.com>
Message-ID: <29598b611001250100v586fccf3u26af263c4202bd5@mail.gmail.com>

Hi Richard,

At this point, neither Rabbit nor the clients support the stream functions.
However, it shouldn't be too difficult to do this yourself. It has been
discussed a number of times on the list before - one of the simplest
solutions is to break your stream up into pieces yourself, and then include
a custom header indicating when the stream is finished.

Cheers,
Paul.

On Mon, Jan 25, 2010 at 8:37 AM, Richard Holt
<richard_holt at btopenworld.com>wrote:

>
> Hi All,
>
> I was wondering if there is a java implementation of the Stream. functions
> i.e. Stream.Publish e.t.c.
>
> We are using very large files in some cases and the Basic.Publish balks at
> very large messages as does the client JVM.
>
> Regards,
>
> Richard
> --
> View this message in context:
> http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27273093.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/69de07e2/attachment.htm 

From richard_holt at btopenworld.com  Mon Jan 25 09:16:25 2010
From: richard_holt at btopenworld.com (Richard Holt)
Date: Mon, 25 Jan 2010 01:16:25 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27273093.post@talk.nabble.com>
References: <27273093.post@talk.nabble.com>
Message-ID: <27303852.post@talk.nabble.com>


Hi thanks for that it was what i expected as i saw the posts you mention. 

I just wanted to clarify that there wasn't implicit support from the
AMQ.Stream code out of the box that just hadnt been linked into the java
libraries.

What has been discussed seems to indicate the use of the Basic.Publish
mechanism with tailored header support around it.

I was hoping there would be something already written which would allow
this.

Regards,


Richard Holt wrote:
> 
> Hi All,
> 
> I was wondering if there is a java implementation of the Stream. functions
> i.e. Stream.Publish e.t.c. 
> 
> We are using very large files in some cases and the Basic.Publish balks at
> very large messages as does the client JVM.
> 
> Regards,
> 
> Richard
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27303852.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From pauljones23 at gmail.com  Mon Jan 25 09:35:17 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 25 Jan 2010 09:35:17 +0000
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27303852.post@talk.nabble.com>
References: <27273093.post@talk.nabble.com> <27303852.post@talk.nabble.com>
Message-ID: <29598b611001250135l19f0a9fehae1c8a943c442bec@mail.gmail.com>

Not that I know I'm afraid. If you do end up writing code to do it though
(and manage to separate it from the rest of your codebase), I'm sure many in
the community would be interested in using it.

On Mon, Jan 25, 2010 at 9:16 AM, Richard Holt
<richard_holt at btopenworld.com>wrote:

>
> Hi thanks for that it was what i expected as i saw the posts you mention.
>
> I just wanted to clarify that there wasn't implicit support from the
> AMQ.Stream code out of the box that just hadnt been linked into the java
> libraries.
>
> What has been discussed seems to indicate the use of the Basic.Publish
> mechanism with tailored header support around it.
>
> I was hoping there would be something already written which would allow
> this.
>
> Regards,
>
>
> Richard Holt wrote:
> >
> > Hi All,
> >
> > I was wondering if there is a java implementation of the Stream.
> functions
> > i.e. Stream.Publish e.t.c.
> >
> > We are using very large files in some cases and the Basic.Publish balks
> at
> > very large messages as does the client JVM.
> >
> > Regards,
> >
> > Richard
> >
>
> --
> View this message in context:
> http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27303852.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/c9a44195/attachment.htm 

From rtrlists at googlemail.com  Mon Jan 25 09:42:55 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 25 Jan 2010 09:42:55 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<4B5C851E.6000908@gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
Message-ID: <6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>

On Sun, Jan 24, 2010 at 8:07 PM, Gustavo Aquino <aquino.gustavo at gmail.com>wrote:

>
> ====== Fail process.
> * ./start-rabbitmq.sh *
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.0  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
> and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node          : rabbit at 189-94-130-143
> app descriptor:
> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
> home dir      : /opt/local/var/lib/rabbitmq
> cookie hash   : diX16VkN3b6UrKJtDPVb1Q==
> log           : /opt/local/var/log/rabbitmq/rabbit.log
> sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
> database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit
>
> starting database             ...done
> starting core processes       ...done
> starting recovery             ...done
> starting persister            ...done
> starting guid generator       ...done
> starting builtin applications ...done
> starting TCP listeners        ...done
> starting SSL listeners        ...done
>
> broker running
> *^C*
> *BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded*
> *       (v)ersion (k)ill (D)b-tables (d)istribution*
> *a*
>
> *$~ gustavoaquino$ ./start-rabbitmq.sh *
> Password:
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.0  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
> and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node          : rabbit at 187-26-170-110
> app descriptor:
> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
> home dir      : /opt/local/var/lib/rabbitmq
> cookie hash   : diX16VkN3b6UrKJtDPVb1Q==
> log           : /opt/local/var/log/rabbitmq/rabbit.log
> sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
> database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit
>
> *starting database             ...{"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
> *
> *
> *
> *Crash dump was written to: erl_crash.dump*
> *init terminating in do_boot ()*
>
> === Final fail process
>
>
>
The first invocation thinks the node is called rabbit at 189-94-130-143,
whereeas the second one thinks it is rabbit at 187-26-170-110.

I think that may be the root of your issue, since the second one will fail
to start the internal Mnesia DB components.

Why is Rabbit picking up different node names for you?

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/39073166/attachment.htm 

From richard_holt at btopenworld.com  Mon Jan 25 09:50:07 2010
From: richard_holt at btopenworld.com (Richard Holt)
Date: Mon, 25 Jan 2010 01:50:07 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <29598b611001250135l19f0a9fehae1c8a943c442bec@mail.gmail.com>
References: <27273093.post@talk.nabble.com> <27303852.post@talk.nabble.com>
	<29598b611001250135l19f0a9fehae1c8a943c442bec@mail.gmail.com>
Message-ID: <27304228.post@talk.nabble.com>


Thanks and yes I am sure they would :) we will have to see if we have the
time do this work first though as we anticipated a smaller time to develop
this than appears to be necessary now.


Paul Jones-6 wrote:
> 
> Not that I know I'm afraid. If you do end up writing code to do it though
> (and manage to separate it from the rest of your codebase), I'm sure many
> in
> the community would be interested in using it.
> 
> On Mon, Jan 25, 2010 at 9:16 AM, Richard Holt
> <richard_holt at btopenworld.com>wrote:
> 
>>
>> Hi thanks for that it was what i expected as i saw the posts you mention.
>>
>> I just wanted to clarify that there wasn't implicit support from the
>> AMQ.Stream code out of the box that just hadnt been linked into the java
>> libraries.
>>
>> What has been discussed seems to indicate the use of the Basic.Publish
>> mechanism with tailored header support around it.
>>
>> I was hoping there would be something already written which would allow
>> this.
>>
>> Regards,
>>
>>
>> Richard Holt wrote:
>> >
>> > Hi All,
>> >
>> > I was wondering if there is a java implementation of the Stream.
>> functions
>> > i.e. Stream.Publish e.t.c.
>> >
>> > We are using very large files in some cases and the Basic.Publish balks
>> at
>> > very large messages as does the client JVM.
>> >
>> > Regards,
>> >
>> > Richard
>> >
>>
>> --
>> View this message in context:
>> http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27303852.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27304228.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From richard_holt at btopenworld.com  Mon Jan 25 10:42:46 2010
From: richard_holt at btopenworld.com (Richard Holt)
Date: Mon, 25 Jan 2010 02:42:46 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27273093.post@talk.nabble.com>
References: <27273093.post@talk.nabble.com>
Message-ID: <27304798.post@talk.nabble.com>


I have just been reading the specification and it may be that the file
contents class is more relevant has anyone put this client in place or do i
need to write this?

thanks



Richard Holt wrote:
> 
> Hi All,
> 
> I was wondering if there is a java implementation of the Stream. functions
> i.e. Stream.Publish e.t.c. 
> 
> We are using very large files in some cases and the Basic.Publish balks at
> very large messages as does the client JVM.
> 
> Regards,
> 
> Richard
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27304798.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at gmail.com  Mon Jan 25 10:43:52 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 25 Jan 2010 10:43:52 +0000
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27304228.post@talk.nabble.com>
References: <27273093.post@talk.nabble.com> <27303852.post@talk.nabble.com>
	<29598b611001250135l19f0a9fehae1c8a943c442bec@mail.gmail.com>
	<27304228.post@talk.nabble.com>
Message-ID: <167204d21001250243y610d6001vbc00ec38c71f53d6@mail.gmail.com>

Richard

What language are you working in?

If it's Ruby, then Nanite supports streaming by chunking, over RabbitMQ, iirc.

alexis


On Mon, Jan 25, 2010 at 9:50 AM, Richard Holt
<richard_holt at btopenworld.com> wrote:
>
> Thanks and yes I am sure they would :) we will have to see if we have the
> time do this work first though as we anticipated a smaller time to develop
> this than appears to be necessary now.
>
>
> Paul Jones-6 wrote:
>>
>> Not that I know I'm afraid. If you do end up writing code to do it though
>> (and manage to separate it from the rest of your codebase), I'm sure many
>> in
>> the community would be interested in using it.
>>
>> On Mon, Jan 25, 2010 at 9:16 AM, Richard Holt
>> <richard_holt at btopenworld.com>wrote:
>>
>>>
>>> Hi thanks for that it was what i expected as i saw the posts you mention.
>>>
>>> I just wanted to clarify that there wasn't implicit support from the
>>> AMQ.Stream code out of the box that just hadnt been linked into the java
>>> libraries.
>>>
>>> What has been discussed seems to indicate the use of the Basic.Publish
>>> mechanism with tailored header support around it.
>>>
>>> I was hoping there would be something already written which would allow
>>> this.
>>>
>>> Regards,
>>>
>>>
>>> Richard Holt wrote:
>>> >
>>> > Hi All,
>>> >
>>> > I was wondering if there is a java implementation of the Stream.
>>> functions
>>> > i.e. Stream.Publish e.t.c.
>>> >
>>> > We are using very large files in some cases and the Basic.Publish balks
>>> at
>>> > very large messages as does the client JVM.
>>> >
>>> > Regards,
>>> >
>>> > Richard
>>> >
>>>
>>> --
>>> View this message in context:
>>> http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27303852.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27304228.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From richard_holt at btopenworld.com  Mon Jan 25 11:00:35 2010
From: richard_holt at btopenworld.com (Richard Holt)
Date: Mon, 25 Jan 2010 03:00:35 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <167204d21001250243y610d6001vbc00ec38c71f53d6@mail.gmail.com>
References: <27273093.post@talk.nabble.com> <27303852.post@talk.nabble.com>
	<29598b611001250135l19f0a9fehae1c8a943c442bec@mail.gmail.com>
	<27304228.post@talk.nabble.com>
	<167204d21001250243y610d6001vbc00ec38c71f53d6@mail.gmail.com>
Message-ID: <27304999.post@talk.nabble.com>


We are primarily a java house as such we would prefer to work with that if
possible. If however this cuts out the work then ruby may become a
possibility.


Alexis Richardson-4 wrote:
> 
> Richard
> 
> What language are you working in?
> 
> If it's Ruby, then Nanite supports streaming by chunking, over RabbitMQ,
> iirc.
> 
> alexis
> 
> 
> On Mon, Jan 25, 2010 at 9:50 AM, Richard Holt
> <richard_holt at btopenworld.com> wrote:
>>
>> Thanks and yes I am sure they would :) we will have to see if we have the
>> time do this work first though as we anticipated a smaller time to
>> develop
>> this than appears to be necessary now.
>>
>>
>> Paul Jones-6 wrote:
>>>
>>> Not that I know I'm afraid. If you do end up writing code to do it
>>> though
>>> (and manage to separate it from the rest of your codebase), I'm sure
>>> many
>>> in
>>> the community would be interested in using it.
>>>
>>> On Mon, Jan 25, 2010 at 9:16 AM, Richard Holt
>>> <richard_holt at btopenworld.com>wrote:
>>>
>>>>
>>>> Hi thanks for that it was what i expected as i saw the posts you
>>>> mention.
>>>>
>>>> I just wanted to clarify that there wasn't implicit support from the
>>>> AMQ.Stream code out of the box that just hadnt been linked into the
>>>> java
>>>> libraries.
>>>>
>>>> What has been discussed seems to indicate the use of the Basic.Publish
>>>> mechanism with tailored header support around it.
>>>>
>>>> I was hoping there would be something already written which would allow
>>>> this.
>>>>
>>>> Regards,
>>>>
>>>>
>>>> Richard Holt wrote:
>>>> >
>>>> > Hi All,
>>>> >
>>>> > I was wondering if there is a java implementation of the Stream.
>>>> functions
>>>> > i.e. Stream.Publish e.t.c.
>>>> >
>>>> > We are using very large files in some cases and the Basic.Publish
>>>> balks
>>>> at
>>>> > very large messages as does the client JVM.
>>>> >
>>>> > Regards,
>>>> >
>>>> > Richard
>>>> >
>>>>
>>>> --
>>>> View this message in context:
>>>> http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27303852.html
>>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> --
>> View this message in context:
>> http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27304228.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27304999.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at gmail.com  Mon Jan 25 11:05:33 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 25 Jan 2010 11:05:33 +0000
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27304999.post@talk.nabble.com>
References: <27273093.post@talk.nabble.com> <27303852.post@talk.nabble.com>
	<29598b611001250135l19f0a9fehae1c8a943c442bec@mail.gmail.com>
	<27304228.post@talk.nabble.com>
	<167204d21001250243y610d6001vbc00ec38c71f53d6@mail.gmail.com>
	<27304999.post@talk.nabble.com>
Message-ID: <167204d21001250305y2f75e5eas5fa013cab21304a3@mail.gmail.com>

OK.

There are some file transfer java classes out there in the wild.  I
cannot recall where, but google may help a bit here.





On Mon, Jan 25, 2010 at 11:00 AM, Richard Holt
<richard_holt at btopenworld.com> wrote:
>
> We are primarily a java house as such we would prefer to work with that if
> possible. If however this cuts out the work then ruby may become a
> possibility.
>
>
> Alexis Richardson-4 wrote:
>>
>> Richard
>>
>> What language are you working in?
>>
>> If it's Ruby, then Nanite supports streaming by chunking, over RabbitMQ,
>> iirc.
>>
>> alexis
>>
>>
>> On Mon, Jan 25, 2010 at 9:50 AM, Richard Holt
>> <richard_holt at btopenworld.com> wrote:
>>>
>>> Thanks and yes I am sure they would :) we will have to see if we have the
>>> time do this work first though as we anticipated a smaller time to
>>> develop
>>> this than appears to be necessary now.
>>>
>>>
>>> Paul Jones-6 wrote:
>>>>
>>>> Not that I know I'm afraid. If you do end up writing code to do it
>>>> though
>>>> (and manage to separate it from the rest of your codebase), I'm sure
>>>> many
>>>> in
>>>> the community would be interested in using it.
>>>>
>>>> On Mon, Jan 25, 2010 at 9:16 AM, Richard Holt
>>>> <richard_holt at btopenworld.com>wrote:
>>>>
>>>>>
>>>>> Hi thanks for that it was what i expected as i saw the posts you
>>>>> mention.
>>>>>
>>>>> I just wanted to clarify that there wasn't implicit support from the
>>>>> AMQ.Stream code out of the box that just hadnt been linked into the
>>>>> java
>>>>> libraries.
>>>>>
>>>>> What has been discussed seems to indicate the use of the Basic.Publish
>>>>> mechanism with tailored header support around it.
>>>>>
>>>>> I was hoping there would be something already written which would allow
>>>>> this.
>>>>>
>>>>> Regards,
>>>>>
>>>>>
>>>>> Richard Holt wrote:
>>>>> >
>>>>> > Hi All,
>>>>> >
>>>>> > I was wondering if there is a java implementation of the Stream.
>>>>> functions
>>>>> > i.e. Stream.Publish e.t.c.
>>>>> >
>>>>> > We are using very large files in some cases and the Basic.Publish
>>>>> balks
>>>>> at
>>>>> > very large messages as does the client JVM.
>>>>> >
>>>>> > Regards,
>>>>> >
>>>>> > Richard
>>>>> >
>>>>>
>>>>> --
>>>>> View this message in context:
>>>>> http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27303852.html
>>>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> --
>>> View this message in context:
>>> http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27304228.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27304999.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From richard_holt at btopenworld.com  Mon Jan 25 11:22:07 2010
From: richard_holt at btopenworld.com (Richard Holt)
Date: Mon, 25 Jan 2010 03:22:07 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27273093.post@talk.nabble.com>
References: <27273093.post@talk.nabble.com>
Message-ID: <27305221.post@talk.nabble.com>


i have just found 2 posts which discuss the removal of both these facilities
from the specification anyway so is it a good idea for us to even consider
this route?



Richard Holt wrote:
> 
> Hi All,
> 
> I was wondering if there is a java implementation of the Stream. functions
> i.e. Stream.Publish e.t.c. 
> 
> We are using very large files in some cases and the Basic.Publish balks at
> very large messages as does the client JVM.
> 
> Regards,
> 
> Richard
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27305221.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at gmail.com  Mon Jan 25 12:05:08 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 25 Jan 2010 12:05:08 +0000
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27305221.post@talk.nabble.com>
References: <27273093.post@talk.nabble.com> <27305221.post@talk.nabble.com>
Message-ID: <167204d21001250405y3814a0e4s58783eaf66c46f25@mail.gmail.com>

Richard

Yes it is fine for you to do this.  The use case is common and valid.
However that does not mean it needs to be spelt out in the spec
itself.  One thing we realised about AMQP is that it says a bit too
much in the spec.  It needs to talk about *messaging* - everything
else is an application of messaging.

alexis


On Mon, Jan 25, 2010 at 11:22 AM, Richard Holt
<richard_holt at btopenworld.com> wrote:
>
> i have just found 2 posts which discuss the removal of both these facilities
> from the specification anyway so is it a good idea for us to even consider
> this route?
>
>
>
> Richard Holt wrote:
>>
>> Hi All,
>>
>> I was wondering if there is a java implementation of the Stream. functions
>> i.e. Stream.Publish e.t.c.
>>
>> We are using very large files in some cases and the Basic.Publish balks at
>> very large messages as does the client JVM.
>>
>> Regards,
>>
>> Richard
>>
>
> --
> View this message in context: http://old.nabble.com/RabbitMQ-Streaming-tp27273093p27305221.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From frank.goenninger at consequor.de  Mon Jan 25 13:39:21 2010
From: frank.goenninger at consequor.de (Frank Goenninger - Consequor Consulting AG)
Date: Mon, 25 Jan 2010 14:39:21 +0100
Subject: [rabbitmq-discuss] amqp_login -> AMQP_RESPONSE_NONE (RabbitMQ C
	Client)
Message-ID: <D2EDA5E6-B26E-48E6-92F3-728BB218C54B@consequor.de>

Hi all:

Being new to RabbitMQ I am using the C client to write an abstraction  
layer on top of RabbitMQ. I am trying to do an amqp_login call but  
always get a AMQP_RESPONSE_NONE in amqp_rpc_reply.

Is this normal, i.e. this is NOT an error? Do I get a server error if  
the login fails or do I get this AMQP_RESPONSE_NONE if the login fails?

Thanks for any hint or clarification.

Cheers
   Frank





From matthew at lshift.net  Mon Jan 25 14:16:22 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 25 Jan 2010 14:16:22 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.7.1 release
Message-ID: <20100125141622.GA11819@mrnibble.lshift.net>

The RabbitMQ team is pleased to announce the release of RabbitMQ 1.7.1.

This release fixes a number of bugs specific to Windows, several
problems in the ssl support and plug-in system, some race conditions
and corner cases in the AMQP protocol and connection lifecycle
handling, breakages in Debian and RPM package removal, as well as some
minor bugs in rabbitmqctl.

There are also some noteworthy enhancements, such as the support for
complete short node names in all the startup and control scripts
(making it easier to install RabbitMQ on systems with changing host
names), improved memory monitoring and producer throttling, an
extension of the AMQP codec with array types, better support for
MacPorts, and improved performance and error reporting in the Java and
.Net clients.

For details see the attached release notes.

Binary and source distributions of the new release can be found in the
usual place, at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback
on this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.


Regards,

The RabbitMQ Team

Release: RabbitMQ 1.7.1

Release Highlights
==================

server
------
bug fixes
- correct various quoting errors in the Windows scripts that caused
  them to fail
- ensure that stalled ssl negotiation do not block further ssl
  connection acceptance
- prohibit the (re)declaration of queues that reside on node that is
  currently stopped, thus preventing message loss or duplication when
  that node recovers
- eliminate race condition in queue auto-deletion, ensuring that it
  has completed before channel/connection closure completes
- ensure that ack processing cannot stall under heavy load when using
  basic.qos
- make plug-ins and config files work when running as a Windows
  service
- write crash dumps to a sensible location
  (%APPDATA%\RabbitMQ\erl_crash.dump by default) when running as a
  Windows service
- get the Windows service to use Erlang/OTP R12B-5 by default, since
  that, rather than R11B-5, is what we ship in the Windows bundle
- correct formatting of plug-in activation errors
- make column order of 'rabbitmqctl list_bindings' match the
  documentation
- do not escape spaces in rabbitmqctl output
- prevent vars declared in Windows scripts from polluting the
  environment
- clean up properly when the rabbit Erlang application is stopped,
  thus making it more well-behaved and easier to embed

enhancements
- make the various scripts work with complete short node names
- improve memory monitoring and producer throttling. See the updated
  documentation at http://www.rabbitmq.com/extensions.html#memsup.
- make tcp_listeners configurable via the rabbitmq.config file
- use the base64 module instead of ssl_base64 if we can, since the
  latter is sometimes missing from Erlang installations
- display pids instead of just nodes in 'rabbitmqctl list_connections'
  and 'rabbitmqctl list_queues', to aid troubleshooting
- add capability to display the transmitted client_properties in
  'rabbitmqctl list_connections'
- extend codec with array type ('A')
- add proper headers to auto-generated code

Java client
-----------
bug fixes
- eliminate race in connection establishment that could cause errors
  to be reported in different ways
- fix quoting in runjava.bat to stop it from tripping over exotic
  Windows paths

enhancements
- enforce codec size limits, specifically on AMQP's shortstr type,
  thus preventing the creation of invalid AMQP protocol frames
- add support for basic.recover in the API
- name threads, to aid troubleshooting
- allow applications to adjust socket configuration, e.g. buffer sizes
- extend codec with array type ('A')
- throw a more informative exception (UnknownChannelException) when
  receiving a frame for an unknown channel
- add proper headers to auto-generated code

.net client
-----------
bug fixes
- close connections on app domain unload, thus preventing spurious
  errors and possible connection leaks when the client is run in
  certain app containers, e.g. IIS
- close socket on ssl upgrade error, thus plugging a socket leak
- resolve various bugs in the ssl negotiation code that cause it to
  fail on .Net proper (though not mono)

enhancements
- improve performance by introducing I/O buffering
- permit ssl connections that do not validate the server certificate
- improve standard display of BrokerUnreachableException
- make SharedQueue implement IEnumerable and allow multiple concurrent
  enumerators per instance
- switch the code gen to the BSD-licensed version of the AMQP spec
- extend codec with array type ('A')
- add proper headers to auto-generated code

building & packaging
--------------------
bug fixes
- stop Debian package purge from failing after plug-in (de)activation
- when upgrading the rpm package, do not remove rabbit from any
  runlevels
- fix error handling in rabbit.app generation, ensuring that errors
  are reported rather than written to the generated file
- during Debian package removal, only kill epmd if it was started by
  the rabbitmq user, in order to reduce the likelihood of interference
  with other Erlang applications
- resolve minor incompatibility with some versions of 'echo' that
  could result in spurious '-e's appearing in script error messages

enhancements
- make MacPorts package work on Snow Leopard
- streamline dependencies in MacPorts package
- automate generation of MacPorts package and create a RabbitMQ
  MacPorts repository - see http://www.rabbitmq.com/macports.html
- mirror downloads onto Amazon Cloudfront, for better availability and
  download speed
- allow 'rabbitmq' user to execute the various wrapper scripts

Upgrading
=========
The database schema has not changed since the 1.6.0 release, so user
accounts, durable exchanges and queues, and persistent messages will
all be retained during the upgrade.

If, however, you are upgrading from a release prior to 1.6.0, when the
RabbitMQ server detects the presence of an old database, it moves it
to a backup location, creates a fresh, empty database, and logs a
warning. If your RabbitMQ installation contains important data then we
recommend you contact support at rabbitmq.com for assistance with the
upgrade.



From aquino.gustavo at gmail.com  Mon Jan 25 17:35:46 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Mon, 25 Jan 2010 15:35:46 -0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.1 for MacPorts
Message-ID: <5ef296b31001250935t93b2747w602dfb73e9a47788@mail.gmail.com>

Hi,

When we will have the new version of RabbitMQ in MacPorts ? I just tried to
update my RabbitMQ now after selfupdate and ports continue with 1.7.0. :(

*sudo port search rabbitmq-server*
*rabbitmq-server @1.7.0 (net)*
*    The RabbitMQ AMQP Server*



Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/643a93ea/attachment.htm 

From matthias at lshift.net  Mon Jan 25 17:45:25 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 25 Jan 2010 17:45:25 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.7.1 for MacPorts
In-Reply-To: <5ef296b31001250935t93b2747w602dfb73e9a47788@mail.gmail.com>
References: <5ef296b31001250935t93b2747w602dfb73e9a47788@mail.gmail.com>
Message-ID: <4B5DD8B5.9090901@lshift.net>

Gustavo,

Gustavo Aquino wrote:
> When we will have the new version of RabbitMQ in MacPorts ? I just tried 
> to update my RabbitMQ now after selfupdate and ports continue with 1.7.0. :(

 From http://www.rabbitmq.com/install.html#macports:
<quote>
The officially released MacPorts packaging may not always contain the 
lastest released version of RabbitMQ. If you wish to install the latest 
version via MacPorts, we maintain a [dedicated MacPorts 
repository](http://www.rabbitmq.com/macports.html) for this purpose.
</quote>

...so just follow the instructions in the contained link to get the most 
recent version.


Regards,

Matthias.



From mark.geib at echostar.com  Mon Jan 25 17:57:58 2010
From: mark.geib at echostar.com (Mark Geib)
Date: Mon, 25 Jan 2010 10:57:58 -0700
Subject: [rabbitmq-discuss] Is it possible to create/bind a queue so that it
 has a limit of N messages
Message-ID: <4B5DDBA6.4030403@echostar.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Is it possible to create a queue so that the broker will limit the
number of messages in the queue.? I am looking for a simple way to limit
resource usage of a broker should things go wrong, like a very chatty
producer... This is for a production system. I don't care if the
messages are lost or not.

Thanks,
Mark.

- -- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAktd26YACgkQNMVrR9CRdv1qrACfabVfXDtZMbyYI99VH63oMZlO
srkAn2OiKpX/wDpNknC86x3JzoxnXI00
=ewuQ
-----END PGP SIGNATURE-----



From aquino.gustavo at gmail.com  Mon Jan 25 18:21:48 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Mon, 25 Jan 2010 16:21:48 -0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.1 for MacPorts
In-Reply-To: <4B5DD8B5.9090901@lshift.net>
References: <5ef296b31001250935t93b2747w602dfb73e9a47788@mail.gmail.com>
	<4B5DD8B5.9090901@lshift.net>
Message-ID: <5ef296b31001251021m33b34f3eqe5c5a8374169e51@mail.gmail.com>

Hi Matthias,

I done all the steps in your link and search rabbit-server is ok.

But when i tried to upgrade my version using $sudo port upgrade outdated it
doesn't work. I tried force the install and got the same error.

Error====

--->  Computing dependencies for rabbitmq-server
--->  Fetching rabbitmq-server
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://distfiles.macports.org/rabbitmq-server
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://arn.se.distfiles.macports.org/rabbitmq-server
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://aarnet.au.distfiles.macports.org/pub/macports/mpdistfiles/rabbitmq-server
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://stage.rabbitmq.com/releases/rabbitmq-server/v1.7.1/
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://svn.macports.org/repository/macports/distfiles/rabbitmq-server
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://svn.macports.org/repository/macports/distfiles/general/
Error: Target org.macports.fetch returned: fetch failed
Error: Unable to upgrade port: 1
Before reporting a bug, first run the command again with the -d flag to get
complete output.

====


I saw that we don't try to download rabbit from http://www.rabbitmq...... in
mode debug putting -d in ports we can look better it, port never go to
download rabbitmq from www.rabbit...


Do you got this problem before ?



Debug mode=============

DEBUG: aarnet.au.distfiles.macports.org ping time is 1520.171
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://distfiles.macports.org/rabbitmq-server
  % Total    % Received % Xferd  Average Speed   Time    Time     Time
 Current
                                 Dload  Upload   Total   Spent    Left
 Speed
  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--
0
DEBUG: Fetching failed:: HTTP response code said error
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://arn.se.distfiles.macports.org/rabbitmq-server

DEBUG: Fetching failed:: couldn't connect to server
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://aarnet.au.distfiles.macports.org/pub/macports/mpdistfiles/rabbitmq-server
  % Total    % Received % Xferd  Average Speed   Time    Time     Time
 Current
                                 Dload  Upload   Total   Spent    Left
 Speed
  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--
0
DEBUG: Fetching failed:: HTTP response code said error
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://stage.rabbitmq.com/releases/rabbitmq-server/v1.7.1/
  % Total    % Received % Xferd  Average Speed   Time    Time     Time
 Current
                                 Dload  Upload   Total   Spent    Left
 Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--
0
DEBUG: Fetching failed:: HTTP response code said error
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://svn.macports.org/repository/macports/distfiles/rabbitmq-server
  % Total    % Received % Xferd  Average Speed   Time    Time     Time
 Current
                                 Dload  Upload   Total   Spent    Left
 Speed
  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--
0
DEBUG: Fetching failed:: HTTP response code said error
--->  Attempting to fetch rabbitmq-server-1.7.1.tar.gz from
http://svn.macports.org/repository/macports/distfiles/general/
  % Total    % Received % Xferd  Average Speed   Time    Time     Time
 Current
                                 Dload  Upload   Total   Spent    Left
 Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--
0
DEBUG: Fetching failed:: HTTP response code said error
Error: Target org.macports.fetch returned: fetch failed
DEBUG: Backtrace: fetch failed
    while executing
"portfetch::fetchfiles"
    ("standard" arm line 1)
    invoked from within
"switch -- "${fetch.type}" {
        cvs     { return [cvsfetch] }
        svn     { return [svnfetch] }
        git     { return [gitfetch] }
        ..."
    (procedure "portfetch::fetch_main" line 10)
    invoked from within
"$procedure $targetname"
Warning: the following items did not execute (for rabbitmq-server):
org.macports.activate org.macports.fetch org.macports.extract
org.macports.checksum org.macports.patch org.macports.configure
org.macports.build org.macports.destroot org.macports.install
Error: Status 1 encountered during processing.
To report a bug, see <http://guide.macports.org/#project.tickets>





On Mon, Jan 25, 2010 at 3:45 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Gustavo,
>
>
> Gustavo Aquino wrote:
>
>> When we will have the new version of RabbitMQ in MacPorts ? I just tried
>> to update my RabbitMQ now after selfupdate and ports continue with 1.7.0. :(
>>
>
> From http://www.rabbitmq.com/install.html#macports:
> <quote>
> The officially released MacPorts packaging may not always contain the
> lastest released version of RabbitMQ. If you wish to install the latest
> version via MacPorts, we maintain a [dedicated MacPorts repository](
> http://www.rabbitmq.com/macports.html) for this purpose.
> </quote>
>
> ...so just follow the instructions in the contained link to get the most
> recent version.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/4389d568/attachment.htm 

From johndapps at gmail.com  Mon Jan 25 18:27:29 2010
From: johndapps at gmail.com (John Apps)
Date: Mon, 25 Jan 2010 19:27:29 +0100
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang error
	eheap_alloc: Cannot allocate 467078560 bytes of memory (of
	type "heap") (with RabbitMQ 1.7.1)
Message-ID: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>

'Tis with tongue in cheek that I send this along...as the last time I tried
this, it was not supposed to work (always) on Windows.

I have installed 1.7.1 in a new directory, recompiled the Java client and
tried this test again.

This is the contents of rabbitmq.config
[
  {rabbit, [{vm_memory_high_watermark, 3}]},
  {rabbit, [{memory_alarms, true}]},
  {mnesia, [{dump_log_write_threshold, 1000}]},
  {rabbit, []}
].
I have tried various options with the above vm_memory_high_watermark, e.g.,
.4, .6 and so forth, the 3 above being from the last try. Perhaps there more
options that I missed? It would not surprise me.

Running the MulticastMain (Java) test against RabbitMQ with the parameters
shown, leads to an Erlang crash after some time.
The data below is from a Windows 7 X64 machine running JDK 6 X64.

"Cannot allocate 467078560 bytes" is the error message.

C:\AMQP\RabbitMQ\rabbitmq-java-client-1.7.1\test\src>java -server ^
com.rabbitmq.examples.MulticastMain ^
-hlocalhost -p5672 -tdirect -eex1 -i10 -m1024 ^
-n1024 -q20 -r1000 -s100 -x1 -y1
starting consumer #0
starting producer #0
sending rate: 997 msg/s
sending rate: 1000 msg/s
sending rate: 1000 msg/s
sending rate: 1000 msg/s
...
...
...
sending rate: 1000 msg/s
Exception in thread "Thread-1" java.lang.RuntimeException:
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.net.SocketException: Connection reset
        at
com.rabbitmq.examples.MulticastMain$Consumer.run(MulticastMain.java:385)
        at java.lang.Thread.run(Unknown Source)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
reason
: java.net.SocketException: Connection reset
        at
com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:588)
        at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:454)
Caused by: java.net.SocketException: Connection reset
        at java.net.SocketInputStream.read(Unknown Source)
        at java.io.BufferedInputStream.fill(Unknown Source)
        at java.io.BufferedInputStream.read(Unknown Source)
        at java.io.DataInputStream.readUnsignedByte(Unknown Source)
        at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:117)
        at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:151)
        at
com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:379)
        at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:420)
...
...
C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin>"C:\erl5.7.4\bin\erl.exe" -pa
"C:\AM
QP\RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin" -enum_args -noinput -boot
start_
sasl "" -sname rabbit -s rabbit +W w +A30 -kernel
inet_default_listen_options "[
{nodelay, true}, {sndbuf, 16384}, {recbuf, 4096}]" -kernel
inet_default_connect_
options "[{nodelay, true}]" -rabbit tcp_listeners "[{\"0.0.0.0\", 5672}]"
-kerne
l error_logger
{file,\""C:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/log/rabbit.log"\"
}  -sasl errlog_type error -sasl sasl_error_logger
{file,\""C:/AMQP/RabbitMQ/rab
bitmq_server-1.7.1/log/rabbit-sasl.log"\"} -os_mon start_cpu_sup true
-os_mon st
art_disksup false -os_mon start_memsup false -os_mon start_os_sup false
-os_mon
memsup_system_only true -os_mon system_memory_high_watermark 0.95 -mnesia
dir \"
"C:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/rabbit-mnesia"\"


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and R
abbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at BIGPOOH
app descriptor:
c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
home dir      : C:\Users\AppsJ
cookie hash   : 1frVt/baXXdWZIsayTJJ8Q==
log           : C:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/log/rabbit.log
sasl log      : C:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/log/rabbit-sasl.log
database dir  : c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/db/rabbit-mnesia

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running

Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 467078560 bytes of memory (of type "heap").

This application has requested the Runtime to terminate it in an unusual
way.
Please contact the application's support team for more information.

The crash dump is rather large, so I shall not post it here...but will make
it available if someone requires it.
=erl_crash_dump:0.1
Fri Jan 22 18:44:49 2010
Slogan: eheap_alloc: Cannot allocate 467078560 bytes of memory (of type
"heap").
System version: Erlang R13B03 (erts-5.7.4) [smp:2:2] [rq:2]
[async-threads:30]
Compiled: Tue Nov 24 11:12:28 2009
-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/02cc1285/attachment.htm 

From david.wragg at lshift.net  Mon Jan 25 18:41:45 2010
From: david.wragg at lshift.net (David Wragg)
Date: Mon, 25 Jan 2010 18:41:45 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.7.1 for MacPorts
In-Reply-To: <5ef296b31001251021m33b34f3eqe5c5a8374169e51@mail.gmail.com>
	(Gustavo Aquino's message of "Mon\, 25 Jan 2010 16\:21\:48 -0200")
References: <5ef296b31001250935t93b2747w602dfb73e9a47788@mail.gmail.com>
	<4B5DD8B5.9090901@lshift.net>
	<5ef296b31001251021m33b34f3eqe5c5a8374169e51@mail.gmail.com>
Message-ID: <k5iqaq6n86.fsf@mrbraver.lshift.net>

Hi Gustavo,

Gustavo Aquino <aquino.gustavo at gmail.com> writes:
> But when i tried to upgrade my version using $sudo port upgrade outdated it
> doesn't work. I tried force the install and got the same error.

You've found a bug in our www.rabbitmq.com macports repo.  The nature
of the mistake meant that it actually worked from our office, so we
didn't notice it during our post-release testing.  Sorry about that!

It should be fixed now, so please give it another go.  You'll need to
do another 'sudo port sync' first, and then 'sudo port install
rabbitmq-server' should successfully download the .tar.gz file.

Thanks,
David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From aquino.gustavo at gmail.com  Mon Jan 25 18:50:45 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Mon, 25 Jan 2010 16:50:45 -0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.1 for MacPorts
In-Reply-To: <k5iqaq6n86.fsf@mrbraver.lshift.net>
References: <5ef296b31001250935t93b2747w602dfb73e9a47788@mail.gmail.com>
	<4B5DD8B5.9090901@lshift.net>
	<5ef296b31001251021m33b34f3eqe5c5a8374169e51@mail.gmail.com>
	<k5iqaq6n86.fsf@mrbraver.lshift.net>
Message-ID: <5ef296b31001251050y33b2e6c8if36927c2763d7c8b@mail.gmail.com>

Hi David,

Thanks RabbitMQ is now running...


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0



Regards.

On Mon, Jan 25, 2010 at 4:41 PM, David Wragg <david.wragg at lshift.net> wrote:

> Hi Gustavo,
>
> Gustavo Aquino <aquino.gustavo at gmail.com> writes:
> > But when i tried to upgrade my version using $sudo port upgrade outdated
> it
> > doesn't work. I tried force the install and got the same error.
>
> You've found a bug in our www.rabbitmq.com macports repo.  The nature
> of the mistake meant that it actually worked from our office, so we
> didn't notice it during our post-release testing.  Sorry about that!
>
> It should be fixed now, so please give it another go.  You'll need to
> do another 'sudo port sync' first, and then 'sudo port install
> rabbitmq-server' should successfully download the .tar.gz file.
>
> Thanks,
> David
>
> --
>  [][][] David Wragg       | mail: david.wragg at lshift.net
>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
>  []  [] LShift Ltd        | web: www.lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/cd32d96f/attachment.htm 

From aquino.gustavo at gmail.com  Mon Jan 25 19:11:50 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Mon, 25 Jan 2010 17:11:50 -0200
Subject: [rabbitmq-discuss] Exchange stop to work
Message-ID: <5ef296b31001251111t221cc77r2b0645bf5a3d6a4f@mail.gmail.com>

Hi,

I have some codes working with exchange (topic).

I don't have why but after update to RabbitMQ 1.7.1 my tests stop to work, I
produce the message exchange got it but don't forward to queue.

Running the java-client-1.7.0 samples SimpleTopic....... I got the same
status.. exchange don't forward message to queue.

Anyone got this ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100125/529989be/attachment.htm 

From matthias at lshift.net  Mon Jan 25 19:18:31 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 25 Jan 2010 19:18:31 +0000
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
 error eheap_alloc: Cannot allocate 467078560 bytes of memory (of	type
 "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>
Message-ID: <4B5DEE87.1090700@lshift.net>

John,

John Apps wrote:
> I have installed 1.7.1 in a new directory, recompiled the Java client 
> and tried this test again.
> 
> This is the contents of rabbitmq.config
> [
>   {rabbit, [{vm_memory_high_watermark, 3}]},
>   {rabbit, [{memory_alarms, true}]},
>   {mnesia, [{dump_log_write_threshold, 1000}]},
>   {rabbit, []}
> ].
> I have tried various options with the above vm_memory_high_watermark, 
> e.g., .4, .6 and so forth, the 3 above being from the last try. Perhaps 
> there more options that I missed? It would not surprise me.

"3" would mean 300% of system memory, which is probably not what you 
want. I'd stick with the default of "0.4" or lower. I also recommend 
checking what limit is being set by looking in the rabbit.log file for 
the line "Memory limit is set to ...", and to watch out for any memory 
related log messages in general while running your tests.

> Running the MulticastMain (Java) test against RabbitMQ with the 
> parameters shown, leads to an Erlang crash after some time.
> The data below is from a Windows 7 X64 machine running JDK 6 X64.
> 
> "Cannot allocate 467078560 bytes" is the error message.
> 
> C:\AMQP\RabbitMQ\rabbitmq-java-client-1.7.1\test\src>java -server ^
> com.rabbitmq.examples.MulticastMain ^
> -hlocalhost -p5672 -tdirect -eex1 -i10 -m1024 ^
> -n1024 -q20 -r1000 -s100 -x1 -y1

That actually exposes an area of uncertainty in the AMQP spec: At what 
point do transactional acks affect qos? At the time the ack is received 
by the server, or at the time the commit is received? RabbitMQ currently 
takes the latter view, which means with the above settings the consumer 
will not receive more than 20 messages. I have filed a bug to figure out 
whether that's the correct answer.

Anyway, let that not distract us from figuring out why rabbit runs out 
of memory for you... I tried a slightly modified version of the above, 
removing the rate limit and increasing the size to 1000, in order to put 
the server under memory pressure sooner (since at a rate limit of 1000 
and a message size of 100 it would have take several hours). That did 
cause the memory alarms to go off and the producer to be throttled. What 
do you see on your machine when running with these settings?


Regards,

Matthias.



From matthias at lshift.net  Mon Jan 25 21:22:02 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 25 Jan 2010 21:22:02 +0000
Subject: [rabbitmq-discuss] Exchange stop to work
In-Reply-To: <5ef296b31001251111t221cc77r2b0645bf5a3d6a4f@mail.gmail.com>
References: <5ef296b31001251111t221cc77r2b0645bf5a3d6a4f@mail.gmail.com>
Message-ID: <4B5E0B7A.8050907@lshift.net>

Gustavo,

Gustavo Aquino wrote:
> I don't have why but after update to RabbitMQ 1.7.1 my tests stop to 
> work, I produce the message exchange got it but don't forward to queue.
> 
> Running the java-client-1.7.0 samples SimpleTopic....... I got the same 
> status.. exchange don't forward message to queue.

There have been no changes to the core message routing logic between 
1.7.0 and 1.7.1, and SimpleTopic{Producer,Consumer}, in both their 1.7.0 
and 1.7.1 version, work fine for me against a 1.7.1 broker.

If the behaviour you saw is reproducible, please post the steps.


Regards,

Matthias.



From chen650 at yahoo.com  Mon Jan 25 23:49:37 2010
From: chen650 at yahoo.com (alex chen)
Date: Mon, 25 Jan 2010 15:49:37 -0800 (PST)
Subject: [rabbitmq-discuss] keep unacked message at the head of queue
Message-ID: <514557.63266.qm@web31808.mail.mud.yahoo.com>

Hi,

Currently rabbitmq re-queues the unacked messages to the end of queue.  Is it possible to keep those messages at the haed of queue instead?  Our application needs to keep the ordering of the messages.

thanks.


      



From matthias at lshift.net  Tue Jan 26 07:23:23 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 07:23:23 +0000
Subject: [rabbitmq-discuss] keep unacked message at the head of queue
In-Reply-To: <514557.63266.qm@web31808.mail.mud.yahoo.com>
References: <514557.63266.qm@web31808.mail.mud.yahoo.com>
Message-ID: <4B5E986B.6090109@lshift.net>

Alex,

alex chen wrote:
> Currently rabbitmq re-queues the unacked messages to the end of
> queue.  Is it possible to keep those messages at the head of queue
> instead?

No, that isn't possible.

> Our application needs to keep the ordering of the messages.

The ordering guarantees provided by AMQP are very constrained. See 
section 4.7 of the AMQP 0-9-1 spec which, for example, states that all 
bets are off when messages get redelivered.

There are good reasons for being so restrictive: excessive ordering 
guarantees are bad for scalability. Also, it is actually logically 
impossible to maintain message order in all but the simplest scenarios. 
For example, even just adding a second consumer to a queue necessarily 
breaks the order of redeliveries wrt other messages.


Regards,

Matthias.



From matthias at lshift.net  Tue Jan 26 07:58:47 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 07:58:47 +0000
Subject: [rabbitmq-discuss] Is it possible to create/bind a queue so
 that it has a limit of N messages
In-Reply-To: <4B5DDBA6.4030403@echostar.com>
References: <4B5DDBA6.4030403@echostar.com>
Message-ID: <4B5EA0B7.9010005@lshift.net>

Mark,

Mark Geib wrote:
> Is it possible to create a queue so that the broker will limit the
> number of messages in the queue.? I am looking for a simple way to limit
> resource usage of a broker should things go wrong, like a very chatty
> producer... This is for a production system. I don't care if the
> messages are lost or not.

It would be fairly easy to add a per-queue message count limit to 
RabbitMQ, but it generally falls way short of constraining resources in 
a meaningful way to cope with "chatty" producers. Some reasons for that are:
- queues are not directly associated with producers - in principle a 
producer can send messages that end up in any (and any number of) queue(s).
- message counts do not constitute a good measure of resource usage; 
memory consumption would be a better measure but that is hard to 
determine with any degree of accuracy, due to the complexity of the data 
structures involved and the sharing of message data between queues

We are planning to add support for various kinds of rate limits such as 
per-connection message count and data rates. These should control 
resource usage effectively, but requires some careful design, and the 
implementation is far from trivial. So don't expect these features to 
appear any time soon.

Another option is to perform rate limiting in a proxy. That is something 
you may want to consider - writing an AMQP protocol proxy is quite 
straightforward, and with a specific use case in mind the implementation 
of the limiting may not be too complex either.

Yet another option might be to deploy a generic TCP firewall with rate 
limiting capabilities.


Regards,

Matthias.



From chen650 at yahoo.com  Tue Jan 26 08:31:08 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 26 Jan 2010 00:31:08 -0800 (PST)
Subject: [rabbitmq-discuss] keep unacked message at the head of queue
In-Reply-To: <4B5E986B.6090109@lshift.net>
References: <514557.63266.qm@web31808.mail.mud.yahoo.com>
	<4B5E986B.6090109@lshift.net>
Message-ID: <502072.44735.qm@web31810.mail.mud.yahoo.com>

Thanks Matthias for the quick response!  Our application processes time series data so it is crucial to keep the message order.  It has one exclusive consumer only.  It would be really nice if rabbitmq could send the unacked messages first for this use case.

-alex



----- Original Message ----
From: Matthias Radestock <matthias at lshift.net>
To: alex chen <chen650 at yahoo.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Mon, January 25, 2010 11:23:23 PM
Subject: Re: [rabbitmq-discuss] keep unacked message at the head of queue

Alex,

alex chen wrote:
> Currently rabbitmq re-queues the unacked messages to the end of
> queue.  Is it possible to keep those messages at the head of queue
> instead?

No, that isn't possible.

> Our application needs to keep the ordering of the messages.

The ordering guarantees provided by AMQP are very constrained. See section 4.7 of the AMQP 0-9-1 spec which, for example, states that all bets are off when messages get redelivered.

There are good reasons for being so restrictive: excessive ordering guarantees are bad for scalability. Also, it is actually logically impossible to maintain message order in all but the simplest scenarios. For example, even just adding a second consumer to a queue necessarily breaks the order of redeliveries wrt other messages.


Regards,

Matthias.



      



From mabrek at gmail.com  Tue Jan 26 09:18:07 2010
From: mabrek at gmail.com (mabrek)
Date: Tue, 26 Jan 2010 12:18:07 +0300
Subject: [rabbitmq-discuss] java client 1.7.1 artifacts are missing from
	maven central repository
Message-ID: <c26271fb1001260118n5f6d5776n9e061df3a620ea64@mail.gmail.com>

Hello.

Congratulations with the new release!
New java client artifacts are missing from maven central repo. Is
there any other maven repository to get them from?

Regards,
Anton Lebedevich.



From pauljones23 at gmail.com  Tue Jan 26 09:54:53 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Tue, 26 Jan 2010 09:54:53 +0000
Subject: [rabbitmq-discuss] java client 1.7.1 artifacts are missing from
	maven central repository
In-Reply-To: <c26271fb1001260118n5f6d5776n9e061df3a620ea64@mail.gmail.com>
References: <c26271fb1001260118n5f6d5776n9e061df3a620ea64@mail.gmail.com>
Message-ID: <29598b611001260154q14492ea4pb1a2f5666ab69218@mail.gmail.com>

(Actually CC'ing list this time)

Hi Anton,

At this stage, the artifacts aren't available in any repository. We'd
probably recommend uploading them to a local maven repository at this point
in time. We are still looking for a proper solution to this problem, but
there aren't any definite solutions yet I'm afraid.

Paul.

On Tue, Jan 26, 2010 at 9:18 AM, mabrek <mabrek at gmail.com> wrote:

> Hello.
>
> Congratulations with the new release!
> New java client artifacts are missing from maven central repo. Is
> there any other maven repository to get them from?
>
> Regards,
> Anton Lebedevich.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/12ad5244/attachment.htm 

From rajesh.reddy at baml.com  Tue Jan 26 10:20:11 2010
From: rajesh.reddy at baml.com (Reddy, Rajesh (GPT EMEA))
Date: Tue, 26 Jan 2010 10:20:11 +0000
Subject: [rabbitmq-discuss] Java Client library
Message-ID: <03FC0D29D4E88943AB7420C524BE8489027C3D2A@mllnc20mb056.emea.win.ml.com>

Hi,

Is there a way to provide my own queue name instead of the system
generated while instantiating rpcclient. As it uses private methods to
declare/setup reply queue and consumer. So if I need to overrride this I
cant.
 
Any reason why setupReplyQueue() and setupConsumer() is not protected ?

Thanks
Rajesh


--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. The information contained in this e-mail was obtained from sources believed to be reliable; however, the accuracy or completeness of this information is not guaranteed. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Past performance is no guarantee of future results. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 



From aquino.gustavo at gmail.com  Tue Jan 26 10:44:50 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 26 Jan 2010 08:44:50 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
Message-ID: <5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>

Hi,

I'm posting about my others environments that I got the same problem, after
one analysis my conclusion is that hostname and network configuration causes
the problem too.

In two cases RHE and Debian RabbitMQ stop to work when my NOC team change
server address and hostname configurations. I delete the schema.DAT and all
come back to work again.

Can I do a suggestion ? Can rabbitmq-server accept -h parameter where user
specify the hostname ?

Regards.


On Mon, Jan 25, 2010 at 7:42 AM, Robert Raschke <rtrlists at googlemail.com>wrote:

>
>
> On Sun, Jan 24, 2010 at 8:07 PM, Gustavo Aquino <aquino.gustavo at gmail.com>wrote:
>
>>
>> ====== Fail process.
>> * ./start-rabbitmq.sh *
>>
>> +---+   +---+
>> |   |   |   |
>> |   |   |   |
>> |   |   |   |
>> |   +---+   +-------+
>> |                   |
>> | RabbitMQ  +---+   |
>> |           |   |   |
>> |   v1.7.0  +---+   |
>> |                   |
>> +-------------------+
>> AMQP 8-0
>> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
>> and Rabbit Technologies Ltd.
>> Licensed under the MPL.  See http://www.rabbitmq.com/
>>
>> node          : rabbit at 189-94-130-143
>> app descriptor:
>> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
>> home dir      : /opt/local/var/lib/rabbitmq
>> cookie hash   : diX16VkN3b6UrKJtDPVb1Q==
>> log           : /opt/local/var/log/rabbitmq/rabbit.log
>> sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
>> database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit
>>
>> starting database             ...done
>> starting core processes       ...done
>> starting recovery             ...done
>> starting persister            ...done
>> starting guid generator       ...done
>> starting builtin applications ...done
>> starting TCP listeners        ...done
>> starting SSL listeners        ...done
>>
>> broker running
>> *^C*
>> *BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded*
>> *       (v)ersion (k)ill (D)b-tables (d)istribution*
>> *a*
>>
>> *$~ gustavoaquino$ ./start-rabbitmq.sh *
>> Password:
>>
>> +---+   +---+
>>  |   |   |   |
>> |   |   |   |
>> |   |   |   |
>> |   +---+   +-------+
>> |                   |
>> | RabbitMQ  +---+   |
>> |           |   |   |
>> |   v1.7.0  +---+   |
>> |                   |
>> +-------------------+
>> AMQP 8-0
>> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
>> and Rabbit Technologies Ltd.
>> Licensed under the MPL.  See http://www.rabbitmq.com/
>>
>> node          : rabbit at 187-26-170-110
>> app descriptor:
>> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
>> home dir      : /opt/local/var/lib/rabbitmq
>> cookie hash   : diX16VkN3b6UrKJtDPVb1Q==
>> log           : /opt/local/var/log/rabbitmq/rabbit.log
>> sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
>> database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit
>>
>> *starting database             ...{"init terminating in
>> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_listener,rabbit_durable_route,rabbit_route,rabbit_reverse_route,rabbit_durable_exchange,rabbit_exchange,rabbit_durable_queue,rabbit_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
>> *
>> *
>> *
>> *Crash dump was written to: erl_crash.dump*
>> *init terminating in do_boot ()*
>>
>> === Final fail process
>>
>>
>>
> The first invocation thinks the node is called rabbit at 189-94-130-143,
> whereeas the second one thinks it is rabbit at 187-26-170-110.
>
> I think that may be the root of your issue, since the second one will fail
> to start the internal Mnesia DB components.
>
> Why is Rabbit picking up different node names for you?
>
> Robby
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/efc26521/attachment.htm 

From matthias at lshift.net  Tue Jan 26 10:52:10 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 10:52:10 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>	<5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>	<20100124175314.GA17963@wellquite.org>	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>	<20100124182021.GA18298@wellquite.org>	<20100124182133.GA21378@wellquite.org>	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>	<20100124190707.GB21378@wellquite.org>	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
Message-ID: <4B5EC95A.5050501@lshift.net>

Gustavo,

Gustavo Aquino wrote:
> I'm posting about my others environments that I got the same problem, 
> after one analysis my conclusion is that hostname and network 
> configuration causes the problem too.
> [...]
> Can I do a suggestion ? Can rabbitmq-server accept -h parameter where 
> user specify the hostname ?

In the 1.7.1 release of the RabbitMQ server it is possible to specify 
the complete Erlang node name, including the host part. So, for example, 
you can add the following to rabbitmq.conf
   NODENAME=rabbit at localhost
or in the environment set
   RABBITMQ_NODENAME=rabbit at localhost
which will cause rabbit to start up with the same 'rabbit at localhost' 
name regardless of the network config.


Regards,

Matthias.



From matthew at lshift.net  Tue Jan 26 11:03:06 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 11:03:06 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
References: <5ef296b31001240943i2310aa87kb0b2e230ee467f38@mail.gmail.com>
	<20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
Message-ID: <20100126110306.GB11819@mrnibble.lshift.net>

Hi,

On Tue, Jan 26, 2010 at 08:44:50AM -0200, Gustavo Aquino wrote:
> I'm posting about my others environments that I got the same problem, after
> one analysis my conclusion is that hostname and network configuration causes
> the problem too.
> 
> In two cases RHE and Debian RabbitMQ stop to work when my NOC team change
> server address and hostname configurations. I delete the schema.DAT and all
> come back to work again.

Your best bet is to edit the various scripts to use -name instead of
-sname and then to set the node to eg rabbit at localhost.

You'll need to edit the rabbitmq-multi, rabbitmq-server and rabbitmqctl
shell scripts and replace all occurrences of -sname with -name.

Then you should be able to set the NODENAME variable in
/etc/rabbitmq/rabbitmq.conf to rabbit at localhost, or set the
RABBITMQ_NODENAME env var.

This way, it should be resistant to IP changes.

Matthew



From matthew at lshift.net  Tue Jan 26 11:11:18 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 11:11:18 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100126110306.GB11819@mrnibble.lshift.net>
References: <20100124175314.GA17963@wellquite.org>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<20100126110306.GB11819@mrnibble.lshift.net>
Message-ID: <20100126111118.GC11819@mrnibble.lshift.net>

*cough* Ignore what I said, and follow Matthias' instructions ;)

On Tue, Jan 26, 2010 at 11:03:06AM +0000, Matthew Sackman wrote:
> Hi,
> 
> On Tue, Jan 26, 2010 at 08:44:50AM -0200, Gustavo Aquino wrote:
> > I'm posting about my others environments that I got the same problem, after
> > one analysis my conclusion is that hostname and network configuration causes
> > the problem too.
> > 
> > In two cases RHE and Debian RabbitMQ stop to work when my NOC team change
> > server address and hostname configurations. I delete the schema.DAT and all
> > come back to work again.
> 
> Your best bet is to edit the various scripts to use -name instead of
> -sname and then to set the node to eg rabbit at localhost.
> 
> You'll need to edit the rabbitmq-multi, rabbitmq-server and rabbitmqctl
> shell scripts and replace all occurrences of -sname with -name.
> 
> Then you should be able to set the NODENAME variable in
> /etc/rabbitmq/rabbitmq.conf to rabbit at localhost, or set the
> RABBITMQ_NODENAME env var.
> 
> This way, it should be resistant to IP changes.
> 
> Matthew
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From aquino.gustavo at gmail.com  Tue Jan 26 11:37:18 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 26 Jan 2010 09:37:18 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <4B5EC95A.5050501@lshift.net>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>
	<20100124182021.GA18298@wellquite.org>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5EC95A.5050501@lshift.net>
Message-ID: <5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>

Hi Matthias,

RABBITMQ_NODENAME is a O.S environment ? at Unix case that can be set using
export RABBITMQ_NODENAME=.... ?

rabbitmq.conf

On Tue, Jan 26, 2010 at 8:52 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Gustavo,
>
> Gustavo Aquino wrote:
>
>> I'm posting about my others environments that I got the same problem,
>> after one analysis my conclusion is that hostname and network configuration
>> causes the problem too.
>> [...]
>>
>> Can I do a suggestion ? Can rabbitmq-server accept -h parameter where user
>> specify the hostname ?
>>
>
> In the 1.7.1 release of the RabbitMQ server it is possible to specify the
> complete Erlang node name, including the host part. So, for example, you can
> add the following to rabbitmq.conf
>  NODENAME=rabbit at localhost
> or in the environment set
>  RABBITMQ_NODENAME=rabbit at localhost
> which will cause rabbit to start up with the same 'rabbit at localhost' name
> regardless of the network config.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/aa635d30/attachment.htm 

From matthias at lshift.net  Tue Jan 26 11:43:44 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 11:43:44 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>	
	<5ef296b31001241006o56f2c7e0s697759495162ac40@mail.gmail.com>	
	<20100124182021.GA18298@wellquite.org>	
	<20100124182133.GA21378@wellquite.org>	
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>	
	<20100124190707.GB21378@wellquite.org>	
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>	
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>	
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>	
	<4B5EC95A.5050501@lshift.net>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
Message-ID: <4B5ED570.4000103@lshift.net>

Gustavo,

Gustavo Aquino wrote:
> RABBITMQ_NODENAME is a O.S environment ? at Unix case that can be set 
> using export RABBITMQ_NODENAME=.... ?

yes. See http://www.rabbitmq.com/install.html#generic-unix


Matthias.



From aquino.gustavo at gmail.com  Tue Jan 26 12:36:11 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 26 Jan 2010 10:36:11 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <4B5ED570.4000103@lshift.net>
References: <5ef296b31001240910r774aceaay4c240dfc4da4caaf@mail.gmail.com>
	<20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5EC95A.5050501@lshift.net>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
Message-ID: <5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>

Matthias,

I did this question because I have tried it without success. No
rabbitmq-server now rabbitctl recognize the RABBITMQ_NODENAME.

I'm doing something wrong ?

My configurations:

$ *export RABBITMQ_NODENAME=rabbit at Nefertiti*

$ echo $RABBITMQ_NODENAME
*rabbit at Nefertiti*

$ ./start-rabbitmq.sh
Password:

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

*node          : rabbit at 182-26-6-233*
app descriptor:
/opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
home dir      : /opt/local/var/lib/rabbitmq
cookie hash   : diX16VkN3b6UrKJtDPVb1Q==
log           : /opt/local/var/log/rabbitmq/rabbit.log
sasl log      : /opt/local/var/log/rabbitmq/rabbit-sasl.log
database dir  : /opt/local/var/lib/rabbitmq/mnesia/rabbit

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running

=====

udo rabbitmqctl list_queues
Listing queues ...
*Error: unable to connect to node 'rabbit at 182-26-6-233': nodedown*
*diagnostics:*
*- unable to connect to epmd on 182-26-6-233: nxdomain*
- current node: 'rabbitmqctl46430 at 182-26-6-233'
- current node home dir: /opt/local/var/lib/rabbitmq
- current node cookie hash: diX16VkN3b6UrKJtDPVb1Q==



On Tue, Jan 26, 2010 at 9:43 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Gustavo,
>
>
> Gustavo Aquino wrote:
>
>> RABBITMQ_NODENAME is a O.S environment ? at Unix case that can be set
>> using export RABBITMQ_NODENAME=.... ?
>>
>
> yes. See http://www.rabbitmq.com/install.html#generic-unix
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/68620faf/attachment.htm 

From holger.hoffstaette at googlemail.com  Tue Jan 26 12:12:02 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Tue, 26 Jan 2010 13:12:02 +0100
Subject: [rabbitmq-discuss] java client 1.7.1 artifacts are missing from
	maven central repository
References: <c26271fb1001260118n5f6d5776n9e061df3a620ea64@mail.gmail.com>
	<29598b611001260154q14492ea4pb1a2f5666ab69218@mail.gmail.com>
Message-ID: <pan.2010.01.26.12.12.02.817500@googlemail.com>

On Tue, 26 Jan 2010 09:54:53 +0000, Paul Jones wrote:

> At this stage, the artifacts aren't available in any repository. We'd
> probably recommend uploading them to a local maven repository at this
> point in time. We are still looking for a proper solution to this problem,
> but there aren't any definite solutions yet I'm afraid.

http://nexus.sonatype.org/oss-repository-hosting.html

Doesn't really get any easier than that. :)

Holger





From matthew at lshift.net  Tue Jan 26 12:43:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 12:43:15 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
References: <20100124182133.GA21378@wellquite.org>
	<5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5EC95A.5050501@lshift.net>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
Message-ID: <20100126124315.GD11819@mrnibble.lshift.net>

Gustavo,

On Tue, Jan 26, 2010 at 10:36:11AM -0200, Gustavo Aquino wrote:
> I did this question because I have tried it without success. No
> rabbitmq-server now rabbitctl recognize the RABBITMQ_NODENAME.
> 
> I'm doing something wrong ?

Yes. Environment variables do not survive when you change user.

> My configurations:
> 
> $ *export RABBITMQ_NODENAME=rabbit at Nefertiti*
> 
> $ echo $RABBITMQ_NODENAME
> *rabbit at Nefertiti*
> 
> $ ./start-rabbitmq.sh
> *node          : rabbit at 182-26-6-233*

This has not taken effect because start-rabbitmq.sh changes to the
rabbitmq user.

> udo rabbitmqctl list_queues
> Listing queues ...
> *Error: unable to connect to node 'rabbit at 182-26-6-233': nodedown*
> *diagnostics:*
> *- unable to connect to epmd on 182-26-6-233: nxdomain*
> - current node: 'rabbitmqctl46430 at 182-26-6-233'
> - current node home dir: /opt/local/var/lib/rabbitmq
> - current node cookie hash: diX16VkN3b6UrKJtDPVb1Q==

Not quite sure why this hasn't worked though...

matthew at mrnibble:~$ cat foo.sh
#! /bin/sh
echo $FOO
matthew at mrnibble:~$ export FOO=wibble
matthew at mrnibble:~$ echo $FOO
wibble
matthew at mrnibble:~$ ./foo.sh 
wibble
matthew at mrnibble:~$ sudo ./foo.sh


I.e. FOO does not appear when you become root. Put the NODENAME in the
/etc/rabbitmq/rabbitmq.conf file

Matthew



From pauljones23 at gmail.com  Tue Jan 26 12:50:36 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Tue, 26 Jan 2010 12:50:36 +0000
Subject: [rabbitmq-discuss] java client 1.7.1 artifacts are missing from
	maven central repository
In-Reply-To: <pan.2010.01.26.12.12.02.817500@googlemail.com>
References: <c26271fb1001260118n5f6d5776n9e061df3a620ea64@mail.gmail.com>
	<29598b611001260154q14492ea4pb1a2f5666ab69218@mail.gmail.com>
	<pan.2010.01.26.12.12.02.817500@googlemail.com>
Message-ID: <29598b611001260450o1dac76e5uf3ad9205250cf843@mail.gmail.com>

I think this was looked into at one point, and the fact that the Rabbit
build isn't produced via Maven was a sticking point. I'm not sure if this is
still a problem, or whether Sonatype are willing to be more lax on this
point now.

On Tue, Jan 26, 2010 at 12:12 PM, Holger Hoffstaette <
holger.hoffstaette at googlemail.com> wrote:

> On Tue, 26 Jan 2010 09:54:53 +0000, Paul Jones wrote:
>
> > At this stage, the artifacts aren't available in any repository. We'd
> > probably recommend uploading them to a local maven repository at this
> > point in time. We are still looking for a proper solution to this
> problem,
> > but there aren't any definite solutions yet I'm afraid.
>
> http://nexus.sonatype.org/oss-repository-hosting.html
>
> Doesn't really get any easier than that. :)
>
> Holger
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/648c443d/attachment.htm 

From matthew at lshift.net  Tue Jan 26 13:05:34 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 13:05:34 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100126124315.GD11819@mrnibble.lshift.net>
References: <5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<20100124190707.GB21378@wellquite.org>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5EC95A.5050501@lshift.net>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
Message-ID: <20100126130534.GE11819@mrnibble.lshift.net>

Gustavo,

Actually, further testing reveals it's a bit more subtle.

sudo, by default, resets the environment when changing user, unless you
give it the -E option.

su, by default, although it has a --preserve-environment option, will
copy over all the RABBITMQ_* environment settings when changing user.

I wouldn't be surprised if OS X decides to do everything differently
again...

Thus if you repeat my previous foo.sh test, but use su instead of sudo,
you will get "wibble" out.

Our scripts use "su", not "sudo" and so *should* preserve the
environment.

However, that aside, I'd still suggest that putting
NODENAME=rabbit at Nefertiti in your /etc/rabbitmq/rabbitmq.conf - it is on
the whole safer than using env vars. I do hope your machine can resolve
Nefertiti

Matthew



From aquino.gustavo at gmail.com  Tue Jan 26 13:52:20 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 26 Jan 2010 11:52:20 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100126130534.GE11819@mrnibble.lshift.net>
References: <5ef296b31001241042l27dd72faof1f85b99497c4260@mail.gmail.com>
	<5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5EC95A.5050501@lshift.net>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
Message-ID: <5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>

Matthew,

Well, I think that I have a problem I understand very well the problems with
environment, I try to use global environment but sudo ignore it... I'm
trying to understand why.

About rabbit configuration, I didn't fond /etc/rabbitmq.conf it's installed
by default ?



On Tue, Jan 26, 2010 at 11:05 AM, Matthew Sackman <matthew at lshift.net>wrote:

> Gustavo,
>
> Actually, further testing reveals it's a bit more subtle.
>
> sudo, by default, resets the environment when changing user, unless you
> give it the -E option.
>
> su, by default, although it has a --preserve-environment option, will
> copy over all the RABBITMQ_* environment settings when changing user.
>
> I wouldn't be surprised if OS X decides to do everything differently
> again...
>
> Thus if you repeat my previous foo.sh test, but use su instead of sudo,
> you will get "wibble" out.
>
> Our scripts use "su", not "sudo" and so *should* preserve the
> environment.
>
> However, that aside, I'd still suggest that putting
> NODENAME=rabbit at Nefertiti in your /etc/rabbitmq/rabbitmq.conf - it is on
> the whole safer than using env vars. I do hope your machine can resolve
> Nefertiti
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/853fa7a4/attachment.htm 

From matthew at lshift.net  Tue Jan 26 13:56:17 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 13:56:17 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
References: <5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<6a3ae47e1001250142p5a1e17f7w2f61ec1fcf0626d5@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5EC95A.5050501@lshift.net>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
Message-ID: <20100126135617.GF11819@mrnibble.lshift.net>

On Tue, Jan 26, 2010 at 11:52:20AM -0200, Gustavo Aquino wrote:
> About rabbit configuration, I didn't fond /etc/rabbitmq.conf it's installed
> by default ?

There is no default file. You should create it. It should be at
/etc/rabbitmq/rabbitmq.conf

You should just have a single line in it:
NODENAME=rabbit at Nefertiti

Note that you do not need the RABBITMQ_ prefix.

Matthew



From aquino.gustavo at gmail.com  Tue Jan 26 14:09:47 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 26 Jan 2010 12:09:47 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100126135617.GF11819@mrnibble.lshift.net>
References: <5ef296b31001241207u726718b1mfc812aafbe3e6d50@mail.gmail.com>
	<5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5EC95A.5050501@lshift.net>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
	<20100126135617.GF11819@mrnibble.lshift.net>
Message-ID: <5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>

Matthew,

It didn't work here bellow I put the steps.

Gustavo.

==========

$ ls -la /etc/rabbitmq/rabbitmq.conf
*-rw-r--r--  1 root  wheel  26 26 Jan 12:05 /etc/rabbitmq/rabbitmq.conf*

187-26-34-103:~ gustavoaquino$ cat /etc/rabbitmq/rabbitmq.conf
*NODENAME=rabbit at Nefertiti*

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

*node          : rabbit at 182-26-6-233*
app descriptor:
/opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app



187-26-34-103:~ gustavoaquino$ ./start-rabbitmq.sh


On Tue, Jan 26, 2010 at 11:56 AM, Matthew Sackman <matthew at lshift.net>wrote:

> On Tue, Jan 26, 2010 at 11:52:20AM -0200, Gustavo Aquino wrote:
> > About rabbit configuration, I didn't fond /etc/rabbitmq.conf it's
> installed
> > by default ?
>
> There is no default file. You should create it. It should be at
> /etc/rabbitmq/rabbitmq.conf
>
> You should just have a single line in it:
> NODENAME=rabbit at Nefertiti
>
> Note that you do not need the RABBITMQ_ prefix.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/a8cc0907/attachment.htm 

From matthew at lshift.net  Tue Jan 26 14:34:11 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 14:34:11 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>
References: <5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5EC95A.5050501@lshift.net>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
	<20100126135617.GF11819@mrnibble.lshift.net>
	<5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>
Message-ID: <20100126143411.GG11819@mrnibble.lshift.net>

Gustavo,

We really think this should work and are confused by your report.

Where is your start-rabbitmq.sh script, and what is it?

Matthew

On Tue, Jan 26, 2010 at 12:09:47PM -0200, Gustavo Aquino wrote:
> Matthew,
> 
> It didn't work here bellow I put the steps.
> 
> Gustavo.
> 
> ==========
> 
> $ ls -la /etc/rabbitmq/rabbitmq.conf
> *-rw-r--r--  1 root  wheel  26 26 Jan 12:05 /etc/rabbitmq/rabbitmq.conf*
> 
> 187-26-34-103:~ gustavoaquino$ cat /etc/rabbitmq/rabbitmq.conf
> *NODENAME=rabbit at Nefertiti*
> 
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.1  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
> and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
> 
> *node          : rabbit at 182-26-6-233*
> app descriptor:
> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
> 
> 
> 
> 187-26-34-103:~ gustavoaquino$ ./start-rabbitmq.sh
> 
> 
> On Tue, Jan 26, 2010 at 11:56 AM, Matthew Sackman <matthew at lshift.net>wrote:
> 
> > On Tue, Jan 26, 2010 at 11:52:20AM -0200, Gustavo Aquino wrote:
> > > About rabbit configuration, I didn't fond /etc/rabbitmq.conf it's
> > installed
> > > by default ?
> >
> > There is no default file. You should create it. It should be at
> > /etc/rabbitmq/rabbitmq.conf
> >
> > You should just have a single line in it:
> > NODENAME=rabbit at Nefertiti
> >
> > Note that you do not need the RABBITMQ_ prefix.
> >
> > Matthew
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From aquino.gustavo at gmail.com  Tue Jan 26 15:08:22 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 26 Jan 2010 13:08:22 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100126143411.GG11819@mrnibble.lshift.net>
References: <5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
	<20100126135617.GF11819@mrnibble.lshift.net>
	<5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>
	<20100126143411.GG11819@mrnibble.lshift.net>
Message-ID: <5ef296b31001260708ka250161m3604a4d828540ea4@mail.gmail.com>

Hi Matthew,

This is my start-rabbitmq.sh

$ cat start-rabbitmq.sh
sudo rm -rf /opt/local/var/lib/rabbitmq/mnesia/rabbit/schema.DAT
sudo -H -u rabbitmq rabbitmq-server


[]s

On Tue, Jan 26, 2010 at 12:34 PM, Matthew Sackman <matthew at lshift.net>wrote:

> Gustavo,
>
> We really think this should work and are confused by your report.
>
> Where is your start-rabbitmq.sh script, and what is it?
>
> Matthew
>
> On Tue, Jan 26, 2010 at 12:09:47PM -0200, Gustavo Aquino wrote:
> > Matthew,
> >
> > It didn't work here bellow I put the steps.
> >
> > Gustavo.
> >
> > ==========
> >
> > $ ls -la /etc/rabbitmq/rabbitmq.conf
> > *-rw-r--r--  1 root  wheel  26 26 Jan 12:05 /etc/rabbitmq/rabbitmq.conf*
> >
> > 187-26-34-103:~ gustavoaquino$ cat /etc/rabbitmq/rabbitmq.conf
> > *NODENAME=rabbit at Nefertiti*
> >
> > +---+   +---+
> > |   |   |   |
> > |   |   |   |
> > |   |   |   |
> > |   +---+   +-------+
> > |                   |
> > | RabbitMQ  +---+   |
> > |           |   |   |
> > |   v1.7.1  +---+   |
> > |                   |
> > +-------------------+
> > AMQP 8-0
> > Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
> LLC.,
> > and Rabbit Technologies Ltd.
> > Licensed under the MPL.  See http://www.rabbitmq.com/
> >
> > *node          : rabbit at 182-26-6-233*
> > app descriptor:
> >
> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
> >
> >
> >
> > 187-26-34-103:~ gustavoaquino$ ./start-rabbitmq.sh
> >
> >
> > On Tue, Jan 26, 2010 at 11:56 AM, Matthew Sackman <matthew at lshift.net
> >wrote:
> >
> > > On Tue, Jan 26, 2010 at 11:52:20AM -0200, Gustavo Aquino wrote:
> > > > About rabbit configuration, I didn't fond /etc/rabbitmq.conf it's
> > > installed
> > > > by default ?
> > >
> > > There is no default file. You should create it. It should be at
> > > /etc/rabbitmq/rabbitmq.conf
> > >
> > > You should just have a single line in it:
> > > NODENAME=rabbit at Nefertiti
> > >
> > > Note that you do not need the RABBITMQ_ prefix.
> > >
> > > Matthew
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/7afe4e26/attachment.htm 

From jdunck at gmail.com  Tue Jan 26 15:15:56 2010
From: jdunck at gmail.com (Jeremy Dunck)
Date: Tue, 26 Jan 2010 09:15:56 -0600
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001260708ka250161m3604a4d828540ea4@mail.gmail.com>
References: <5ef296b31001260244k1acea482s9e7b40d2b1f7d522@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
	<20100126135617.GF11819@mrnibble.lshift.net>
	<5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>
	<20100126143411.GG11819@mrnibble.lshift.net>
	<5ef296b31001260708ka250161m3604a4d828540ea4@mail.gmail.com>
Message-ID: <2545a92c1001260715w65d7d84dw8f51f385ed38a115@mail.gmail.com>

On Tue, Jan 26, 2010 at 9:08 AM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Hi Matthew,
> This is my start-rabbitmq.sh
> $ cat start-rabbitmq.sh
> sudo rm -rf /opt/local/var/lib/rabbitmq/mnesia/rabbit/schema.DAT
> sudo -H -u rabbitmq rabbitmq-server

Perhaps the config file should live under /opt/local/etc/rabbitmq/rabbitmq.conf?



From matthew at lshift.net  Tue Jan 26 15:19:34 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 15:19:34 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <5ef296b31001260708ka250161m3604a4d828540ea4@mail.gmail.com>
References: <5ef296b31001260337n63e05362gccba0ca0dc1ce846@mail.gmail.com>
	<4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
	<20100126135617.GF11819@mrnibble.lshift.net>
	<5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>
	<20100126143411.GG11819@mrnibble.lshift.net>
	<5ef296b31001260708ka250161m3604a4d828540ea4@mail.gmail.com>
Message-ID: <20100126151934.GH11819@mrnibble.lshift.net>

Hi,

On Tue, Jan 26, 2010 at 01:08:22PM -0200, Gustavo Aquino wrote:
> This is my start-rabbitmq.sh
> 
> $ cat start-rabbitmq.sh
> sudo rm -rf /opt/local/var/lib/rabbitmq/mnesia/rabbit/schema.DAT
> sudo -H -u rabbitmq rabbitmq-server

Ok, well the sudos certainly explain why the env vars weren't getting
passed through.

Which rabbitmq-server script is that second line running? It should be
the one in /usr/sbin/ or /usr/local/sbin/ or /opt/local/usr/sbin/.
I've just checked and it seems that sudo adds the sbins to the PATH even
when you're not sudoing to root so that should still be finding them ok.

But either way, the strange issue is that it would appear that
/usr/lib/rabbitmq/bin/rabbitmq-env (or in your case maybe
/opt/local/usr/lib/rabbitmq/bin/rabbitmq-env) isn't being run. It should
be being run via /opt/local/usr/lib/rabbitmq/bin/rabbitmq-server...

Have you made any changes to these scripts? Do you perhaps have other
older versions of these scripts lying around?

Matthew



From matthew at lshift.net  Tue Jan 26 15:21:34 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 15:21:34 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <2545a92c1001260715w65d7d84dw8f51f385ed38a115@mail.gmail.com>
References: <4B5ED570.4000103@lshift.net>
	<5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
	<20100126135617.GF11819@mrnibble.lshift.net>
	<5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>
	<20100126143411.GG11819@mrnibble.lshift.net>
	<5ef296b31001260708ka250161m3604a4d828540ea4@mail.gmail.com>
	<2545a92c1001260715w65d7d84dw8f51f385ed38a115@mail.gmail.com>
Message-ID: <20100126152133.GI11819@mrnibble.lshift.net>

On Tue, Jan 26, 2010 at 09:15:56AM -0600, Jeremy Dunck wrote:
> On Tue, Jan 26, 2010 at 9:08 AM, Gustavo Aquino
> <aquino.gustavo at gmail.com> wrote:
> > Hi Matthew,
> > This is my start-rabbitmq.sh
> > $ cat start-rabbitmq.sh
> > sudo rm -rf /opt/local/var/lib/rabbitmq/mnesia/rabbit/schema.DAT
> > sudo -H -u rabbitmq rabbitmq-server
> 
> Perhaps the config file should live under /opt/local/etc/rabbitmq/rabbitmq.conf?

That's an excellent suggestion and quite possibly the case. As you can
tell I'm less that totally familiar with the joys of OS X and macports.

Matthew



From matthew at lshift.net  Tue Jan 26 15:23:27 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 26 Jan 2010 15:23:27 +0000
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100126152133.GI11819@mrnibble.lshift.net>
References: <5ef296b31001260436j16803490g6426da84919cde14@mail.gmail.com>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
	<20100126135617.GF11819@mrnibble.lshift.net>
	<5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>
	<20100126143411.GG11819@mrnibble.lshift.net>
	<5ef296b31001260708ka250161m3604a4d828540ea4@mail.gmail.com>
	<2545a92c1001260715w65d7d84dw8f51f385ed38a115@mail.gmail.com>
	<20100126152133.GI11819@mrnibble.lshift.net>
Message-ID: <20100126152327.GJ11819@mrnibble.lshift.net>

On Tue, Jan 26, 2010 at 03:21:34PM +0000, Matthew Sackman wrote:
> On Tue, Jan 26, 2010 at 09:15:56AM -0600, Jeremy Dunck wrote:
> > On Tue, Jan 26, 2010 at 9:08 AM, Gustavo Aquino
> > Perhaps the config file should live under /opt/local/etc/rabbitmq/rabbitmq.conf?
> 
> That's an excellent suggestion and quite possibly the case. As you can
> tell I'm less that totally familiar with the joys of OS X and macports.

Yes, having just checked our build mac, it should indeed be
/opt/local/etc/rabbitmq/rabbitmq.conf

Matthew



From johndapps at gmail.com  Tue Jan 26 15:32:01 2010
From: johndapps at gmail.com (John Apps)
Date: Tue, 26 Jan 2010 16:32:01 +0100
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
	error eheap_alloc: Cannot allocate 467078560 bytes of memory
	(of type "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <4B5DEE87.1090700@lshift.net>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>
	<4B5DEE87.1090700@lshift.net>
Message-ID: <173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>

Matthias,

This is rabbit.log after starting the server:
=INFO REPORT==== 26-Jan-2010::16:09:34 ===
Memory limit set to 1634MB.
=INFO REPORT==== 26-Jan-2010::16:09:34 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/db/rabbit-mnesi
a/rabbit_persister.LOG.previous"
=INFO REPORT==== 26-Jan-2010::16:09:35 ===
started TCP Listener on 0.0.0.0:5672
__________________
These are the parameters, which I hope match what you mean:
java -server ^
com.rabbitmq.examples.MulticastMain ^
-hlocalhost -p5672 -tdirect -eex1 -i10 -m1024 ^
-n1024 -q20 -s1000 -x1 -y1

here we go at 16:19:47.60 2010-01-26
starting consumer #0
starting producer #0
sending rate: 10376 msg/s
sending rate: 10506 msg/s
sending rate: 10141 msg/s
sending rate: 9718 msg/s
sending rate: 8954 msg/s
Exception in thread "Thread-3" java.lang.RuntimeException:
java.io.IOException
        at
com.rabbitmq.examples.MulticastMain$Producer.run(MulticastMain.java:255)
        at java.lang.Thread.run(Unknown Source)
Caused by: java.io.IOException
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
        at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:139)
        at com.rabbitmq.client.impl.ChannelN.txCommit(ChannelN.java:689)
        at com.rabbitmq.client.impl.ChannelN.txCommit(ChannelN.java:70)
        at
com.rabbitmq.examples.MulticastMain$Producer.run(MulticastMain.java:249)
all done at 16:21:17.15 2010-01-26
...
...

The good news is that it crashes very quickly now, so I do not need to wait
long;)

Which is less than before. The dump is not that big, so I have attached a
ZIPped version:

687,358 erl_crash.dump.

First few lines of the dump (the amount of memory being allocated is a good
bit less than in the last crashes):

Slogan: eheap_alloc: Cannot allocate 298930300 bytes of memory (of type
"heap").
System version: Erlang R13B03 (erts-5.7.4) [smp:2:2] [rq:2]
[async-threads:30]
Compiled: Tue Nov 24 11:12:28 2009

Cheers, John
_____________________________________________
On Mon, Jan 25, 2010 at 20:18, Matthias Radestock <matthias at lshift.net>wrote:

> John,
>
>
> John Apps wrote:
>
>> I have installed 1.7.1 in a new directory, recompiled the Java client and
>> tried this test again.
>>
>> This is the contents of rabbitmq.config
>> [
>>  {rabbit, [{vm_memory_high_watermark, 3}]},
>>  {rabbit, [{memory_alarms, true}]},
>>  {mnesia, [{dump_log_write_threshold, 1000}]},
>>  {rabbit, []}
>> ].
>> I have tried various options with the above vm_memory_high_watermark,
>> e.g., .4, .6 and so forth, the 3 above being from the last try. Perhaps
>> there more options that I missed? It would not surprise me.
>>
>
> "3" would mean 300% of system memory, which is probably not what you want.
> I'd stick with the default of "0.4" or lower. I also recommend checking what
> limit is being set by looking in the rabbit.log file for the line "Memory
> limit is set to ...", and to watch out for any memory related log messages
> in general while running your tests.
>
>
>  Running the MulticastMain (Java) test against RabbitMQ with the parameters
>> shown, leads to an Erlang crash after some time.
>> The data below is from a Windows 7 X64 machine running JDK 6 X64.
>>
>> "Cannot allocate 467078560 bytes" is the error message.
>>
>> C:\AMQP\RabbitMQ\rabbitmq-java-client-1.7.1\test\src>java -server ^
>> com.rabbitmq.examples.MulticastMain ^
>> -hlocalhost -p5672 -tdirect -eex1 -i10 -m1024 ^
>> -n1024 -q20 -r1000 -s100 -x1 -y1
>>
>
> That actually exposes an area of uncertainty in the AMQP spec: At what
> point do transactional acks affect qos? At the time the ack is received by
> the server, or at the time the commit is received? RabbitMQ currently takes
> the latter view, which means with the above settings the consumer will not
> receive more than 20 messages. I have filed a bug to figure out whether
> that's the correct answer.
>
> Anyway, let that not distract us from figuring out why rabbit runs out of
> memory for you... I tried a slightly modified version of the above, removing
> the rate limit and increasing the size to 1000, in order to put the server
> under memory pressure sooner (since at a rate limit of 1000 and a message
> size of 100 it would have take several hours). That did cause the memory
> alarms to go off and the producer to be throttled. What do you see on your
> machine when running with these settings?
>
>
> Regards,
>
> Matthias.
>



-- 
---
John Apps
(49) 171 869 1813
Sent from Traunstein, Bavaria, Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/822228bf/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.zip
Type: application/zip
Size: 116926 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/822228bf/attachment.zip 

From aquino.gustavo at gmail.com  Tue Jan 26 15:35:13 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 26 Jan 2010 13:35:13 -0200
Subject: [rabbitmq-discuss] Rabbitmq server crash and no start more
In-Reply-To: <20100126152133.GI11819@mrnibble.lshift.net>
References: <4B5ED570.4000103@lshift.net>
	<20100126124315.GD11819@mrnibble.lshift.net>
	<20100126130534.GE11819@mrnibble.lshift.net>
	<5ef296b31001260552k7619752dkf31ce0e6fc30d239@mail.gmail.com>
	<20100126135617.GF11819@mrnibble.lshift.net>
	<5ef296b31001260609s10b905ecoefaead4a825c55df@mail.gmail.com>
	<20100126143411.GG11819@mrnibble.lshift.net>
	<5ef296b31001260708ka250161m3604a4d828540ea4@mail.gmail.com>
	<2545a92c1001260715w65d7d84dw8f51f385ed38a115@mail.gmail.com>
	<20100126152133.GI11819@mrnibble.lshift.net>
Message-ID: <5ef296b31001260735h2745c829keb5420dfe08866a0@mail.gmail.com>

Matthew,

I don't touch the rabbitmq scripts, yesterday I upgraded my version to 1.7.1
by MacPorts and just it.

I tried to create /opt/local/etc/rabbitmq/rabbitmq.conf and it's works very
well ! :D

Now I can remove my auto delete of schema.DAT file :)

Thanks guys


======

*$ cat /opt/local/etc/rabbitmq/rabbitmq.conf*
*NODENAME=rabbit at Nefertiti*


*$ ./start-rabbitmq.sh *

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : *rabbit at Nefertiti*
app descriptor:
/opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
home dir      : /opt/local/var/lib/rabbitmq




On Tue, Jan 26, 2010 at 1:21 PM, Matthew Sackman <matthew at lshift.net> wrote:

> On Tue, Jan 26, 2010 at 09:15:56AM -0600, Jeremy Dunck wrote:
> > On Tue, Jan 26, 2010 at 9:08 AM, Gustavo Aquino
> > <aquino.gustavo at gmail.com> wrote:
> > > Hi Matthew,
> > > This is my start-rabbitmq.sh
> > > $ cat start-rabbitmq.sh
> > > sudo rm -rf /opt/local/var/lib/rabbitmq/mnesia/rabbit/schema.DAT
> > > sudo -H -u rabbitmq rabbitmq-server
> >
> > Perhaps the config file should live under
> /opt/local/etc/rabbitmq/rabbitmq.conf?
>
> That's an excellent suggestion and quite possibly the case. As you can
> tell I'm less that totally familiar with the joys of OS X and macports.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/9b0d9f84/attachment.htm 

From matthias at lshift.net  Tue Jan 26 15:38:11 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 15:38:11 +0000
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
 error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type
 "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>	
	<4B5DEE87.1090700@lshift.net>
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>
Message-ID: <4B5F0C63.3060806@lshift.net>

John,

John Apps wrote:
> This is rabbit.log after starting the server:
> =INFO REPORT==== 26-Jan-2010::16:09:34 ===
> Memory limit set to 1634MB.

Does that figure seem reasonable? How much physical memory and swap do 
you have? And do you have other processes running that could be eating 
into that?

Basically, you need to make sure that the above figure is well below 
(<40%) the amount of memory the rabbit process can safely ask for from 
the O/S.

> =INFO REPORT==== 26-Jan-2010::16:09:34 ===
> Rolling persister log to 
> "c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/db/rabbit-mnesi
> a/rabbit_persister.LOG.previous"
> =INFO REPORT==== 26-Jan-2010::16:09:35 ===
> started TCP Listener on 0.0.0.0:5672

Have you got the rest of that log file?


Regards,

Matthias.
PS: no need to attach further crash dumps.



From matthias at lshift.net  Tue Jan 26 15:53:54 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 15:53:54 +0000
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
 error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type
 "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <4B5F0C63.3060806@lshift.net>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>		<4B5DEE87.1090700@lshift.net>	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>
	<4B5F0C63.3060806@lshift.net>
Message-ID: <4B5F1012.5090700@lshift.net>

John,

I just spotted a few things ...

Matthias Radestock wrote:
>> =INFO REPORT==== 26-Jan-2010::16:09:34 ===
>> Rolling persister log to 
>> "c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/db/rabbit-mnesi
>> a/rabbit_persister.LOG.previous"

Err, are you actually running the 1.7.1 server? The above says 1.7.0.

Also, from your original post ...

> C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin>"C:\erl5.7.4\bin\erl.exe" -pa "C:\AM
> QP\RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin" -enum_args -noinput -boot start_
> sasl "" -sname rabbit -s rabbit +W w +A30 -kernel inet_default_listen_options "[
> {nodelay, true}, {sndbuf, 16384}, {recbuf, 4096}]" -kernel inet_default_connect_
> options "[{nodelay, true}]" -rabbit tcp_listeners "[{\"0.0.0.0\", 5672}]" -kerne
> l error_logger {file,\""C:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/log/rabbit.log"\"
> }  -sasl errlog_type error -sasl sasl_error_logger {file,\""C:/AMQP/RabbitMQ/rab
> bitmq_server-1.7.1/log/rabbit-sasl.log"\"} -os_mon start_cpu_sup true -os_mon st
> art_disksup false -os_mon start_memsup false -os_mon start_os_sup false -os_mon
> memsup_system_only true -os_mon system_memory_high_watermark 0.95 -mnesia dir \"
> "C:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/rabbit-mnesia"\"

Where did that come from? That's not what a proper 1.7.1 startup line 
looks like. It also explains why your changes to rabbitmq.config made to 
difference - amongst other things the above is missing the option that 
passes in the config file. Please start rabbit with the provided scripts 
(and if that doesn't work, report any problems to the list).


Regards,

Matthias.



From maciej.lotkowski at gmail.com  Tue Jan 26 16:06:35 2010
From: maciej.lotkowski at gmail.com (Maciej Lotkowski)
Date: Tue, 26 Jan 2010 17:06:35 +0100
Subject: [rabbitmq-discuss] rabbitmq 1.7.1 from package on debian
Message-ID: <9b62ed111001260806j60d17fecv444382910cbcf321@mail.gmail.com>

Hello

I just installed rabbitmq-server 1.7.1 from .deb package and I can't
start the server (1.7.0 works).

$ cat /var/log/rabbitmq/startup_log
Starting all nodes...
Starting node rabbit at blip-rabbitmq-1a...

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{undef,[{base64,encode_to_string,[<<16
bytes>>]},{rabbit,print_banner,0},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}

What are possible reasons?

-- 
Maciej



From matthias at lshift.net  Tue Jan 26 16:16:22 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 16:16:22 +0000
Subject: [rabbitmq-discuss] rabbitmq 1.7.1 from package on debian
In-Reply-To: <9b62ed111001260806j60d17fecv444382910cbcf321@mail.gmail.com>
References: <9b62ed111001260806j60d17fecv444382910cbcf321@mail.gmail.com>
Message-ID: <4B5F1556.4000904@lshift.net>

Maciej,

Maciej Lotkowski wrote:
> I just installed rabbitmq-server 1.7.1 from .deb package and I can't
> start the server (1.7.0 works).
> [snip]

Looks like you do not have the base64 package. What version of Erlang 
are you running? RabbitMQ 1.7.1 requires R11B-5 or greater.


Regards,

Matthias.



From maciej.lotkowski at gmail.com  Tue Jan 26 16:47:11 2010
From: maciej.lotkowski at gmail.com (Maciej Lotkowski)
Date: Tue, 26 Jan 2010 17:47:11 +0100
Subject: [rabbitmq-discuss] rabbitmq 1.7.1 from package on debian
In-Reply-To: <4B5F1556.4000904@lshift.net>
References: <9b62ed111001260806j60d17fecv444382910cbcf321@mail.gmail.com> 
	<4B5F1556.4000904@lshift.net>
Message-ID: <9b62ed111001260847l5b7ebe59taa399b3a77260746@mail.gmail.com>

Matthias,

On Tue, Jan 26, 2010 at 5:16 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Maciej,
>
> Maciej Lotkowski wrote:
>>
>> I just installed rabbitmq-server 1.7.1 from .deb package and I can't
>> start the server (1.7.0 works).
>> [snip]
>
> Looks like you do not have the base64 package. What version of Erlang are
> you running? RabbitMQ 1.7.1 requires R11B-5 or greater.

I'm running R11B-2 - it seems that I have to upgrade. I should have
checked this before installing the newer rabbitmq-server.

-- 
thanks,
Maciej



From g at rre.tt  Tue Jan 26 17:32:09 2010
From: g at rre.tt (Garrett Smith)
Date: Tue, 26 Jan 2010 11:32:09 -0600
Subject: [rabbitmq-discuss] Is it possible to create/bind a queue so
	that it has a limit of N messages
In-Reply-To: <4B5EA0B7.9010005@lshift.net>
References: <4B5DDBA6.4030403@echostar.com> <4B5EA0B7.9010005@lshift.net>
Message-ID: <ce2570e21001260932y5cdf06d2m89840fc076b9eb6c@mail.gmail.com>

On Tue, Jan 26, 2010 at 1:58 AM, Matthias Radestock <matthias at lshift.net> wrote:
> Mark,
>
> Mark Geib wrote:
>> Is it possible to create a queue so that the broker will limit the
>> number of messages in the queue.? I am looking for a simple way to limit
>> resource usage of a broker should things go wrong, like a very chatty
>> producer... This is for a production system. I don't care if the
>> messages are lost or not.
>
> It would be fairly easy to add a per-queue message count limit to
> RabbitMQ, but it generally falls way short of constraining resources in
> a meaningful way to cope with "chatty" producers. Some reasons for that are:
> - queues are not directly associated with producers - in principle a
> producer can send messages that end up in any (and any number of) queue(s).
> - message counts do not constitute a good measure of resource usage;
> memory consumption would be a better measure but that is hard to
> determine with any degree of accuracy, due to the complexity of the data
> structures involved and the sharing of message data between queues

I know this has been brought up before a few times, but I've found
that TTL (time to live, expires, etc.) is an effective way to deal
with messages that aren't acked/canceled in a "timely" fashion (as per
the application).

Garrett



From johndapps at gmail.com  Tue Jan 26 17:46:45 2010
From: johndapps at gmail.com (John Apps)
Date: Tue, 26 Jan 2010 18:46:45 +0100
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
	error eheap_alloc: Cannot allocate 467078560 bytes of memory
	(of type "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <4B5F0C63.3060806@lshift.net>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>
	<4B5DEE87.1090700@lshift.net>
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>
	<4B5F0C63.3060806@lshift.net>
Message-ID: <173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>

Matthias,

Here you go:
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
Memory limit set to 817MB.
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
disk_log: repairing
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/ra
bbit_persister.LOG" ...
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
Repaired persister log - 1 recovered, 0 bad
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous"
=INFO REPORT==== 26-Jan-2010::17:56:57 ===
started TCP Listener on 0.0.0.0:5672
=INFO REPORT==== 26-Jan-2010::17:57:07 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:39913
=INFO REPORT==== 26-Jan-2010::17:57:07 ===
starting TCP connection <0.150.0> from 127.0.0.1:39913
=INFO REPORT==== 26-Jan-2010::17:57:07 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:39914
=INFO REPORT==== 26-Jan-2010::17:57:07 ===
starting TCP connection <0.156.0> from 127.0.0.1:39914
=INFO REPORT==== 26-Jan-2010::17:57:51 ===
vm_memory_high_watermark set. Memory used:1002985248 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:57:51 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:57:52 ===
vm_memory_high_watermark clear. Memory used:684715512 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:57:52 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:04 ===
vm_memory_high_watermark set. Memory used:1066534848 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:04 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:05 ===
vm_memory_high_watermark clear. Memory used:772812808 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:05 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:06 ===
vm_memory_high_watermark set. Memory used:1264119968 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:06 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:08 ===
vm_memory_high_watermark clear. Memory used:739226624 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:08 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:11 ===
vm_memory_high_watermark set. Memory used:890590656 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:11 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:13 ===
vm_memory_high_watermark clear. Memory used:766122704 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:13 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:14 ===
vm_memory_high_watermark set. Memory used:890671408 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:14 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:17 ===
vm_memory_high_watermark clear. Memory used:776145328 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:17 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:18 ===
vm_memory_high_watermark set. Memory used:1300245088 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:18 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:21 ===
vm_memory_high_watermark clear. Memory used:784244032 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:21 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:22 ===
vm_memory_high_watermark set. Memory used:902589440 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:22 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:27 ===
vm_memory_high_watermark clear. Memory used:791158912 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:27 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 26-Jan-2010::17:58:28 ===
vm_memory_high_watermark set. Memory used:918087056 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:28 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 26-Jan-2010::17:58:34 ===
vm_memory_high_watermark clear. Memory used:800483800 allowed:856947097
=INFO REPORT==== 26-Jan-2010::17:58:34 ===

    alarm_handler: {clear,vm_memory_high_watermark}
The above log is from a run with 0.2 memory on a 4GB machine running Windows
7 X64. This is the first time I have seen the messages about memory high
watermark.

The attached image is a screen shot from the task manager showing the Erl
statistics right when it crashed using memory of .02. Not sure if it helps,
but hope so...

The following log is from a run with memory set to 0.3:
=INFO REPORT==== 26-Jan-2010::18:15:09 ===
Memory limit set to 1225MB.
=INFO REPORT==== 26-Jan-2010::18:15:09 ===
disk_log: repairing
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/ra
bbit_persister.LOG" ...
=INFO REPORT==== 26-Jan-2010::18:15:09 ===
Repaired persister log - 1 recovered, 0 bad
=INFO REPORT==== 26-Jan-2010::18:15:09 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous"
=INFO REPORT==== 26-Jan-2010::18:15:10 ===
started TCP Listener on 0.0.0.0:5672
=INFO REPORT==== 26-Jan-2010::18:15:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:40341
=INFO REPORT==== 26-Jan-2010::18:15:13 ===
starting TCP connection <0.143.0> from 127.0.0.1:40341
=INFO REPORT==== 26-Jan-2010::18:15:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:40342
INFO REPORT==== 26-Jan-2010::18:15:13 ===
starting TCP connection <0.149.0> from 127.0.0.1:40342

Last test was to run with 0.1 memory. This did not get very far and is now
hanging. The client managed only a few exchanges:

here we go at 18:23:03.19 2010-01-26
starting consumer #0
starting producer #0
sending rate: 11398 msg/s
sending rate: 10602 msg/s
sending rate: 6831 msg/s
sending rate: 2148 msg/s

The rabbit.log for the 0.1 memory run is attached.

Cheers, John
On Tue, Jan 26, 2010 at 16:38, Matthias Radestock <matthias at lshift.net>wrote:

> John,
>
>
> John Apps wrote:
>
>> This is rabbit.log after starting the server:
>> =INFO REPORT==== 26-Jan-2010::16:09:34 ===
>> Memory limit set to 1634MB.
>>
>
> Does that figure seem reasonable? How much physical memory and swap do you
> have? And do you have other processes running that could be eating into
> that?
>
> Basically, you need to make sure that the above figure is well below (<40%)
> the amount of memory the rabbit process can safely ask for from the O/S.
>
>
>  =INFO REPORT==== 26-Jan-2010::16:09:34 ===
>> Rolling persister log to
>> "c:/AMQP/RabbitMQ/rabbitmq_server-1.7.0/db/rabbit-mnesi
>> a/rabbit_persister.LOG.previous"
>> =INFO REPORT==== 26-Jan-2010::16:09:35 ===
>> started TCP Listener on 0.0.0.0:5672
>>
>
> Have you got the rest of that log file?
>
>
> Regards,
>
> Matthias.
> PS: no need to attach further crash dumps.
>



-- 
---
John Apps
(49) 171 869 1813
Sent from Traunstein, Bavaria, Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl (2).png
Type: image/png
Size: 100288 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BIGPOOH.log
Type: application/octet-stream
Size: 3963 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/d614b900/attachment.obj 

From krummas at gmail.com  Tue Jan 26 17:47:41 2010
From: krummas at gmail.com (Marcus Eriksson)
Date: Tue, 26 Jan 2010 18:47:41 +0100
Subject: [rabbitmq-discuss] keep unacked message at the head of queue
In-Reply-To: <502072.44735.qm@web31810.mail.mud.yahoo.com>
References: <514557.63266.qm@web31808.mail.mud.yahoo.com>
	<4B5E986B.6090109@lshift.net>
	<502072.44735.qm@web31810.mail.mud.yahoo.com>
Message-ID: <7ab768b11001260947g7088652agdc3e5a7653e7a5d@mail.gmail.com>

Wouldn't a dead letter queue approach work in this case? I.e if your
consumer gets an unprocessable message, stop the consumer and publish the
message to some other queue. Then, when restarting the application first
consume the message(s) from the DLQ

/Marcus
http://developian.blogspot.com

On Tue, Jan 26, 2010 at 9:31 AM, alex chen <chen650 at yahoo.com> wrote:

> Thanks Matthias for the quick response!  Our application processes time
> series data so it is crucial to keep the message order.  It has one
> exclusive consumer only.  It would be really nice if rabbitmq could send the
> unacked messages first for this use case.
>
> -alex
>
>
>
> ----- Original Message ----
> From: Matthias Radestock <matthias at lshift.net>
> To: alex chen <chen650 at yahoo.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Mon, January 25, 2010 11:23:23 PM
> Subject: Re: [rabbitmq-discuss] keep unacked message at the head of queue
>
> Alex,
>
> alex chen wrote:
> > Currently rabbitmq re-queues the unacked messages to the end of
> > queue.  Is it possible to keep those messages at the head of queue
> > instead?
>
> No, that isn't possible.
>
> > Our application needs to keep the ordering of the messages.
>
> The ordering guarantees provided by AMQP are very constrained. See section
> 4.7 of the AMQP 0-9-1 spec which, for example, states that all bets are off
> when messages get redelivered.
>
> There are good reasons for being so restrictive: excessive ordering
> guarantees are bad for scalability. Also, it is actually logically
> impossible to maintain message order in all but the simplest scenarios. For
> example, even just adding a second consumer to a queue necessarily breaks
> the order of redeliveries wrt other messages.
>
>
> Regards,
>
> Matthias.
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/8c1de419/attachment.htm 

From matthias at lshift.net  Tue Jan 26 18:11:37 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 18:11:37 +0000
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
 error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type
 "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>	
	<4B5DEE87.1090700@lshift.net>	
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>	
	<4B5F0C63.3060806@lshift.net>
	<173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>
Message-ID: <4B5F3059.8060006@lshift.net>

John,

John Apps wrote:
> Here you go:
> =INFO REPORT==== 26-Jan-2010::17:56:57 ===
> Memory limit set to 817MB.
> [...]
> The above log is from a run with 0.2 memory on a 4GB machine running 
> Windows 7 X64. This is the first time I have seen the messages about 
> memory high watermark.

Did RabbitMQ actually crash on that run? It looks perfectly happy.

> The following log is from a run with memory set to 0.3:
> =INFO REPORT==== 26-Jan-2010::18:15:09 ===
> Memory limit set to 1225MB.
> [...]
> INFO REPORT==== 26-Jan-2010::18:15:13 ===
> starting TCP connection <0.149.0> from 127.0.0.1:40342 

Ditto.

Do you have a complete rabbit.log file from a run that
a) had the memory threshold set to no higher than the default 0.4, and
b) crashed the RabbitMQ server
?

> <http://127.0.0.1:40342>
> 
> Last test was to run with 0.1 memory. This did not get very far and is 
> now hanging. The client managed only a few exchanges:

That's exactly what is supposed to happen. Rabbit has told the producer 
to stop sending messages since it is under memory pressure. Once memory 
becomes available again, e.g. when a consumer consumes enough messages, 
or some queues get deleted/purged, or as a result of internal garbage 
collection, Rabbit will tell the producer that it may resume.


Regards,

Matthias.



From johndapps at gmail.com  Tue Jan 26 18:32:51 2010
From: johndapps at gmail.com (John Apps)
Date: Tue, 26 Jan 2010 19:32:51 +0100
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
	error eheap_alloc: Cannot allocate 467078560 bytes of memory
	(of type "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <4B5F3059.8060006@lshift.net>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>
	<4B5DEE87.1090700@lshift.net>
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>
	<4B5F0C63.3060806@lshift.net>
	<173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>
	<4B5F3059.8060006@lshift.net>
Message-ID: <173a1edc1001261032g6757a1d6uc06d33bb4a842fae@mail.gmail.com>

Here are two runs, one with 0.4 and the other, below, with 0.3. Both crash.
The rabbit.log for the 0.3 test is attached. The 0.4 test did not log any
memory watermark messages, only the 0.3 test.
The page file on this machine is 8GB with a maximum size of 16GB.
_________________________________________________
The client:
here we go at 19:16:49.49 2010-01-26
starting consumer #0
starting producer #0
sending rate: 11280 msg/s
sending rate: 10228 msg/s
sending rate: 10017 msg/s
sending rate: 10069 msg/s
sending rate: 9613 msg/s
...
...Crash
...
The server with 0.4 memory:
eheap_alloc: Cannot allocate 298930300 bytes of memory (of type "heap").
=INFO REPORT==== 26-Jan-2010::19:16:46 ===
Memory limit set to 1634MB.

=INFO REPORT==== 26-Jan-2010::19:16:46 ===
disk_log: repairing
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/rabbit_persister.LOG"
...

=INFO REPORT==== 26-Jan-2010::19:16:46 ===
Repaired persister log - 1 recovered, 0 bad

=INFO REPORT==== 26-Jan-2010::19:16:46 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/rabbit_persister.LOG.previous"

=INFO REPORT==== 26-Jan-2010::19:16:46 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 26-Jan-2010::19:16:49 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:42109

=INFO REPORT==== 26-Jan-2010::19:16:49 ===
starting TCP connection <0.143.0> from 127.0.0.1:42109

=INFO REPORT==== 26-Jan-2010::19:16:49 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:42110

=INFO REPORT==== 26-Jan-2010::19:16:49 ===
starting TCP connection <0.149.0> from 127.0.0.1:42110
______________________________________________________________
This is with 0.3 memory:
=INFO REPORT==== 26-Jan-2010::19:22:09 ===
Memory limit set to 1225MB.

=INFO REPORT==== 26-Jan-2010::19:22:09 ===
disk_log: repairing
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/rabbit_persister.LOG"
...

=INFO REPORT==== 26-Jan-2010::19:22:09 ===
Repaired persister log - 1 recovered, 0 bad

=INFO REPORT==== 26-Jan-2010::19:22:09 ===
Rolling persister log to
"c:/AMQP/RabbitMQ/rabbitmq_server-1.7.1/db/BIGPOOH-mnesia/rabbit_persister.LOG.previous"

=INFO REPORT==== 26-Jan-2010::19:22:10 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 26-Jan-2010::19:22:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:42320

=INFO REPORT==== 26-Jan-2010::19:22:13 ===
starting TCP connection <0.143.0> from 127.0.0.1:42320

=INFO REPORT==== 26-Jan-2010::19:22:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:42321

=INFO REPORT==== 26-Jan-2010::19:22:13 ===
starting TCP connection <0.149.0> from 127.0.0.1:42321

___________________________________________________
here we go at 19:25:50.62 2010-01-26
starting consumer #0
starting producer #0
sending rate: 11216 msg/s
sending rate: 11214 msg/s
sending rate: 10332 msg/s
sending rate: 9481 msg/s
sending rate: 7449 msg/s
sending rate: 6095 msg/s
sending rate: 3217 msg/s
sending rate: 998 msg/s
...
...crash
...
temp_alloc: Cannot allocate 197209248 bytes of memory (of type "tmp_heap").

Log file is attached.

________________________
*>>>That's exactly what is supposed to happen. Rabbit has told the producer
to stop sending messages since it is under memory pressure. Once memory
becomes available again, e.g. when a consumer consumes enough messages, or
some queues get deleted/purged, or as a result of internal garbage
collection, Rabbit will tell the producer that it may resume.
*

The funny thing is that rabbitmqctl status returned a 'node down' message. I
suppose that is OK?
_______________

Cheers, John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/0225ebf1/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BIGPOOH.log
Type: application/octet-stream
Size: 4995 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/0225ebf1/attachment.obj 

From matthias at lshift.net  Tue Jan 26 19:10:03 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 19:10:03 +0000
Subject: [rabbitmq-discuss] Java Client library
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C3D2A@mllnc20mb056.emea.win.ml.com>
References: <03FC0D29D4E88943AB7420C524BE8489027C3D2A@mllnc20mb056.emea.win.ml.com>
Message-ID: <4B5F3E0B.6050002@lshift.net>

Rajesh,

Reddy, Rajesh (GPT EMEA) wrote:
> Any reason why setupReplyQueue() and setupConsumer() is not protected ?

No good reason. We'll get that changed in a future release.


Regards,

Matthias.



From matthias at lshift.net  Tue Jan 26 19:32:33 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 26 Jan 2010 19:32:33 +0000
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
 error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type
 "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <173a1edc1001261032g6757a1d6uc06d33bb4a842fae@mail.gmail.com>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>	
	<4B5DEE87.1090700@lshift.net>	
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>	
	<4B5F0C63.3060806@lshift.net>	
	<173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>	
	<4B5F3059.8060006@lshift.net>
	<173a1edc1001261032g6757a1d6uc06d33bb4a842fae@mail.gmail.com>
Message-ID: <4B5F4351.1050806@lshift.net>

John,

John Apps wrote:
> Here are two runs, one with 0.4 and the other, below, with 0.3. Both 
> crash. The rabbit.log for the 0.3 test is attached. The 0.4 test did not 
> log any memory watermark messages, only the 0.3 test.

I cannot see any memory alerts in the 0.3 test log either.

The earlier 0.2 log, showed a limit of 817MB and a max value of ~1.3G. 
Assuming those ratios are similar for the 0.3 case (1225MB), it would 
indicate the O/S isn't happy with Rabbit asking for more than ~2GB of 
memory.

Some quick googling on Erlang under Windows suggests that 2GB may in 
fact be a limit imposed by some flavours of Windows. Different flavours 
have different limits; somebody more familiar with Windows might be able 
to provide more precise information.

I guess you'll have to stick to a limit of 0.2, or perhaps try 0.25.

> />>>That's exactly what is supposed to happen. Rabbit has told the 
> producer to stop sending messages since it is under memory pressure. 
> Once memory becomes available again, e.g. when a consumer consumes 
> enough messages, or some queues get deleted/purged, or as a result of 
> internal garbage collection, Rabbit will tell the producer that it may 
> resume.
> /
> 
> The funny thing is that rabbitmqctl status returned a 'node down' 
> message. I suppose that is OK?

No, that's not ok. Presumably rabbitmqctl normally works fine, right?

Next time this happens, please do the following:
- capture & report the complete output of rabbitmqctl
- check whether the rabbit process is alive
- assuming it is, report whether it's busy or idle
- terminate the test program
- try running rabbitmqctl again and report the results
- post the complete rabbit.log and rabbit-sasl.log


Regards,

Matthias.



From aquino.gustavo at gmail.com  Tue Jan 26 20:35:13 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 26 Jan 2010 18:35:13 -0200
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
	error eheap_alloc: Cannot allocate 467078560 bytes of memory
	(of type "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <4B5F4351.1050806@lshift.net>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>
	<4B5DEE87.1090700@lshift.net>
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>
	<4B5F0C63.3060806@lshift.net>
	<173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>
	<4B5F3059.8060006@lshift.net>
	<173a1edc1001261032g6757a1d6uc06d33bb4a842fae@mail.gmail.com>
	<4B5F4351.1050806@lshift.net>
Message-ID: <5ef296b31001261235q3685fce0h3c3a25ae02bf9849@mail.gmail.com>

Matthias,

Your are right Windows have a limitation to memory allocation per process,
and some versions of Windows is 2Gb the limitation, a long time ago I have a
lot of problems with it.

I don't know what type of windows John are using but this is a link of
Microsoft to talk about this limitations in all versions of windows.

http://msdn.microsoft.com/en-us/library/aa366778(VS.85).aspx

Regards.



On Tue, Jan 26, 2010 at 5:32 PM, Matthias Radestock <matthias at lshift.net>wrote:

> John,
>
> John Apps wrote:
> > Here are two runs, one with 0.4 and the other, below, with 0.3. Both
> > crash. The rabbit.log for the 0.3 test is attached. The 0.4 test did not
> > log any memory watermark messages, only the 0.3 test.
>
> I cannot see any memory alerts in the 0.3 test log either.
>
> The earlier 0.2 log, showed a limit of 817MB and a max value of ~1.3G.
> Assuming those ratios are similar for the 0.3 case (1225MB), it would
> indicate the O/S isn't happy with Rabbit asking for more than ~2GB of
> memory.
>
> Some quick googling on Erlang under Windows suggests that 2GB may in
> fact be a limit imposed by some flavours of Windows. Different flavours
> have different limits; somebody more familiar with Windows might be able
> to provide more precise information.
>
> I guess you'll have to stick to a limit of 0.2, or perhaps try 0.25.
>
> > />>>That's exactly what is supposed to happen. Rabbit has told the
> > producer to stop sending messages since it is under memory pressure.
> > Once memory becomes available again, e.g. when a consumer consumes
> > enough messages, or some queues get deleted/purged, or as a result of
> > internal garbage collection, Rabbit will tell the producer that it may
> > resume.
> > /
> >
> > The funny thing is that rabbitmqctl status returned a 'node down'
> > message. I suppose that is OK?
>
> No, that's not ok. Presumably rabbitmqctl normally works fine, right?
>
> Next time this happens, please do the following:
> - capture & report the complete output of rabbitmqctl
> - check whether the rabbit process is alive
> - assuming it is, report whether it's busy or idle
> - terminate the test program
> - try running rabbitmqctl again and report the results
> - post the complete rabbit.log and rabbit-sasl.log
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/24c8189e/attachment.htm 

From msteele at beringmedia.com  Tue Jan 26 20:42:39 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Tue, 26 Jan 2010 15:42:39 -0500
Subject: [rabbitmq-discuss] Monitoring rabbitmq
Message-ID: <aa3794b1001261242m38149d43m95bb0353b30201b1@mail.gmail.com>

Hi folks,

I'm trying to find a good way to monitor rabbit for inclusion in an HA
cluster (pacemaker/corosync).

Does anyone have a good resource agent already created for such a purpose?

Here is what I've got so far:


#!/bin/bash

#######################################################################
# Initialization:
. /usr/lib/ocf/resource.d/heartbeat/.ocf-shellfuncs
#######################################################################

meta_data() {
        cat <<END
<?xml version="1.0"?>
<!DOCTYPE resource-agent SYSTEM "ra-api-1.dtd">
<resource-agent name="rabbitmq" version="0.9">
<version>1.0</version>

<longdesc lang="en">
Rabbitmq agent
</longdesc>
<shortdesc lang="en">Rabbitmq resource agent</shortdesc>
<actions>
<action name="start"        timeout="90" />
<action name="stop"         timeout="100" />
<action name="monitor"      timeout="20" interval="10" depth="0"
start-delay="0" />
<action name="meta-data"    timeout="5"
/>
<action name="validate-all"   timeout="30"
/>
</actions>

</resource-agent>

END

}


usage() {
        cat <<END
usage: $0 {start|stop|monitor|validate-all|meta-data}

END
}

start() {
        /usr/sbin/rabbitmq-multi start_all 1 2>&1 > /dev/null
        exit $?
}

stop() {
  /usr/sbin/rabbitmq-multi stop_all 2>&1 > /dev/null
  ret=$?

  if [ $ret -eq 2 ]; then
    return $OCF_SUCCESS
  fi

  if [ $ret -ne 0 ]; then
    sleep 5
    pidof beam.smp
    ret=$?
    if [ $ret -eq 1 ]; then
      /usr/bin/killall -TERM epmd beam.smp
      sleep 30
      /usr/bin/killall -KILL epmd beam.smp
    fi
  fi
  return $OCF_SUCCESS
}

monitor() {
  status=`/usr/sbin/rabbitmq-multi status 2>&1`
  res=$?
  if [ $res -eq 2 ]; then
    return $OCF_NOT_RUNNING
  fi

  if [[ $status =~ 'not_running' ]]; then
    return $OCF_NOT_RUNNING
  else
    if [ $res -eq 0 ]; then
      return $OCF_SUCCESS
    else
      return $OCF_ERR_GENERIC
    fi
  fi
}

validate() {
    return $OCF_SUCCESS
}

case $__OCF_ACTION in
meta-data)      meta_data
                exit $OCF_SUCCESS
                ;;
start)          start;;
stop)           stop;;
monitor)        monitor;;
validate-all)   validate;;
usage|help)     usage
                exit $OCF_SUCCESS
                ;;
*)              usage
                exit $OCF_ERR_UNIMPLEMENTED
                ;;
esac
rc=$?
ocf_log debug "${OCF_RESOURCE_INSTANCE} $__OCF_ACTION : $rc"
exit $rc


---------

It feels like a bit of a kludge though. If anyone has any suggestions on how
to thoroughly monitor rabbit, please let me know.


Regards,

-- 
Mark Steele
Director of development
Bering Media Inc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/85ed2d4b/attachment.htm 

From nabble at project23.de  Tue Jan 26 21:24:47 2010
From: nabble at project23.de (domsom)
Date: Tue, 26 Jan 2010 13:24:47 -0800 (PST)
Subject: [rabbitmq-discuss]  .NET BasicPublish randomly blocks forever
Message-ID: <27295461.post@talk.nabble.com>


Hi,

this is my first RabbitMQ project, and I'm trying to signal a Java
application from a Mono/.NET app. So the Mono application only sends
messages (multithreaded, locking the IModel / channel before publishing),
while the Java application only retrieves them. One virtual host, one
exchange bound to one queue, direct type, one routing key, RabbitMQ 1.7.0
client libraries. Both apps use guest logins (i.e. no authentification).

On my dev environment (Ubuntu 09.10) running RabbitMQ server 1.6.0-1ubuntu,
everything runs fine. In the production environment (Debian testing on a
Virtuozzo virtual server) running RabbitMQ server 1.7.0-3, the Mono
application (the message publishing thread, to be precise) randomly blocks
forever when calling BasicPublish.

I found some side effects that frame "randomly" a bit. Given RabbitMQ server
is running, the Java app is running and created the exchange, queue and
binding, I start the Mono app, which blocks after successfully publishing
some (or no) messages. Then:

1)  I kill the Java app, the Mono app unblocks (!) and continues.

1a) If I design the Mono app to create a fresh IModel (channel) before
sending each message, it successfully publishes some more messages before
blocking again.

1b) Restarting the Java app does not influence 1a) behavior, meaning the
"kill Java app to unblock the Mono app" trick only works exactly once.

2) I kill the RabbitMQ server, the Mono app unblocks (throwing an AMQP
close/shutdown exception) and continues.


I tried downgrading the production environment to RabbitMQ 1.6.0-1 - same
effect. The rabbitmqctl outputs all look correct (regarding connections,
exchanges, bindings); list_queues does not change after the Mono app blocks.

The log has a lot of entries like these:

=INFO REPORT==== 24-Jan-2010::15:12:34 ===
    alarm_handler: {set,{system_memory_high_watermark,[]}}

=INFO REPORT==== 24-Jan-2010::15:12:35 ===
    alarm_handler: {clear,system_memory_high_watermark}

After reading the docs, I figured these errors would cause RabbitMQ telling
the application to stop sending messages. So I added these parameters to the
startup command line:
-os_mon memory_alarms false -os_mon memsup_system_only false -os_mon
memsup_system_only false'
to get rid of them. (In Virtuozzo VMs, it seems there's no way to get a
valid figure of free memory, so this always triggers.) No effect though, the
Mono app still blocks.

Any ideas on where else to look?
Dominik


PS: The Mono app should continue committing changes to a MySQL DB in
concurrent threads. Interestingly enough, these commits (via Castle
ActiveRecord / NHibernate) seem to stop as soon as the first BasicPublish
call blocks.
-- 
View this message in context: http://old.nabble.com/.NET-BasicPublish-randomly-blocks-forever-tp27295461p27295461.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From tim.cole at canonical.com  Tue Jan 26 21:30:38 2010
From: tim.cole at canonical.com (Tim Cole)
Date: Tue, 26 Jan 2010 16:30:38 -0500
Subject: [rabbitmq-discuss] syntax and semantics of basic content
	'expiration' field?
Message-ID: <1264541438.7091.10.camel@bede>

Are the syntax and semantics of the basic content 'expiration' field
explained anywhere?  The official AMQP 0.8 specs appear to be almost
entirely silent about it.

Thanks,
Tim
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100126/e4a70bef/attachment.pgp 

From sterini at gmail.com  Tue Jan 26 22:17:36 2010
From: sterini at gmail.com (Ilya Sterin)
Date: Tue, 26 Jan 2010 17:17:36 -0500
Subject: [rabbitmq-discuss] Consuming from multiple queues
Message-ID: <67d2b0c71001261417oba8bb21g7b866e3720bd8d67@mail.gmail.com>

I have a rather standard publish/subscriber architecture, where
publisher publishes messages into numerous queues.  Queues store
distinct message types.

The consumer currently connects to a single queue and processes these
messages.  I spin off multiple consumers, so each queue has at least
one consumer bound and awaiting messages.  A consumer is a distinct
thread, though say if I have 10 threads listening on a queue, these
threads are all blocking even though no deliveries are made to this
queue.

Although these threads are in wait mode and due not utilize any CPU,
I'd much prefer to put them to use.  So my question is, how can a
single consumer listen to multiple queues and process messages as they
arrive on either of the queues.  I don't care about the distinction
between queues on the consumer side, but I do on the producer side as
well as for other monitoring purposes.

I currently have something in the likes of... (I picked out bits and
pieces from my abstraction, so I might of missed something here)

############
Channel channel = conn.createChannel();
QueueingConsumer consumer = new QueueingConsumer(channel);
channel.basicConsume(queueName, false, consumer);

while (!Thread.currentThread().isInterrupted()) {
      QueueingConsumer.Delivery delivery;
      try {
        delivery = consumer.nextDelivery();
      }
      catch (InterruptedException e) {
        LOG.warn("Thread interrupted: ", e);
        channel =
cleanupAndReestablishConnectionsFor(delivery.getProperties().get);
        continue;
      }
      .... do something with message and acknowledge it if OK
}

#############

I can't seem to find documentation related to this.  Is this possible?

Thanks.

Ilya



From sterini at gmail.com  Tue Jan 26 22:18:45 2010
From: sterini at gmail.com (Ilya Sterin)
Date: Tue, 26 Jan 2010 17:18:45 -0500
Subject: [rabbitmq-discuss] Consuming from multiple queues
In-Reply-To: <67d2b0c71001261417oba8bb21g7b866e3720bd8d67@mail.gmail.com>
References: <67d2b0c71001261417oba8bb21g7b866e3720bd8d67@mail.gmail.com>
Message-ID: <67d2b0c71001261418h77ca337aq3c801b3fdfa639bc@mail.gmail.com>

Sorry, the cleanupAndReestablishConnectionsFor.... shouldn't be there.
 So ignore that line.

Ilya

On Tue, Jan 26, 2010 at 5:17 PM, Ilya Sterin <sterini at gmail.com> wrote:
> I have a rather standard publish/subscriber architecture, where
> publisher publishes messages into numerous queues. ?Queues store
> distinct message types.
>
> The consumer currently connects to a single queue and processes these
> messages. ?I spin off multiple consumers, so each queue has at least
> one consumer bound and awaiting messages. ?A consumer is a distinct
> thread, though say if I have 10 threads listening on a queue, these
> threads are all blocking even though no deliveries are made to this
> queue.
>
> Although these threads are in wait mode and due not utilize any CPU,
> I'd much prefer to put them to use. ?So my question is, how can a
> single consumer listen to multiple queues and process messages as they
> arrive on either of the queues. ?I don't care about the distinction
> between queues on the consumer side, but I do on the producer side as
> well as for other monitoring purposes.
>
> I currently have something in the likes of... (I picked out bits and
> pieces from my abstraction, so I might of missed something here)
>
> ############
> Channel channel = conn.createChannel();
> QueueingConsumer consumer = new QueueingConsumer(channel);
> channel.basicConsume(queueName, false, consumer);
>
> while (!Thread.currentThread().isInterrupted()) {
> ? ? ?QueueingConsumer.Delivery delivery;
> ? ? ?try {
> ? ? ? ?delivery = consumer.nextDelivery();
> ? ? ?}
> ? ? ?catch (InterruptedException e) {
> ? ? ? ?LOG.warn("Thread interrupted: ", e);
> ? ? ? ?channel =
> cleanupAndReestablishConnectionsFor(delivery.getProperties().get);
> ? ? ? ?continue;
> ? ? ?}
> ? ? ?.... do something with message and acknowledge it if OK
> }
>
> #############
>
> I can't seem to find documentation related to this. ?Is this possible?
>
> Thanks.
>
> Ilya
>



From johndapps at gmail.com  Wed Jan 27 10:43:11 2010
From: johndapps at gmail.com (John Apps)
Date: Wed, 27 Jan 2010 11:43:11 +0100
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
	error eheap_alloc: Cannot allocate 467078560 bytes of memory
	(of type "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <4B5F4351.1050806@lshift.net>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>
	<4B5DEE87.1090700@lshift.net>
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>
	<4B5F0C63.3060806@lshift.net>
	<173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>
	<4B5F3059.8060006@lshift.net>
	<173a1edc1001261032g6757a1d6uc06d33bb4a842fae@mail.gmail.com>
	<4B5F4351.1050806@lshift.net>
Message-ID: <173a1edc1001270243t68d23305wb240aaaa7a641aa4@mail.gmail.com>

Matthias,

As far as Windows 7 support for physical memory is concerned,
this http://msdn.microsoft.com/en-us/library/aa366778(VS.85).aspx page
mentions a difference with the attribute IMAGE_FILE_LARGE_ADDRESS_AWARE
which
is influenced by the linker option /LARGEADDRESSAWARE.

2 GB with IMAGE_FILE_LARGE_ADDRESS_AWARE cleared (default)
4 GB with IMAGE_FILE_LARGE_ADDRESS_AWARE set
See (http://msdn.microsoft.com/en-us/library/wz223b1z.aspx)

It would be good to know how the images shipped with the kit were linked.

This is Windows 7 X64 on a dual-core Inel with 4GB of physical memory
and a page file of maximum 16GB.
___________________________________________________
. This run is with memory of 0.1.
. The SASL.log is empty, i.e., 0 bytes.
. The rabbit log is attached. (BIGPOOH.log)
. There was no CPU activity after the messages/sec dropped to 0.

. RabbitMQ did respond to rabbitmqctl; the status is captured below,
first time when the client was still connected, second after I
had aborted it.
___________________________________________________
here we go at 11:04:33.47 2010-01-27
starting consumer #0
starting producer #0
sending rate: 9470 msg/s
sending rate: 8778 msg/s
sending rate: 6585 msg/s
sending rate: 3370 msg/s
sending rate: 2189 msg/s
sending rate: 1428 msg/s
sending rate: 0 msg/s
___________________________________________________
C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin>rabbitmqctl status >
rabbitmqctl.status

C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin>more rabbitmqctl.status
=PROGRESS REPORT==== 27-Jan-2010::11:15:40 ===
          supervisor: {local,sasl_safe_sup}
             started: [{pid,<0.38.0>},
                       {name,alarm_handler},
                       {mfa,{alarm_handler,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]
=PROGRESS REPORT==== 27-Jan-2010::11:15:40 ===
          supervisor: {local,sasl_safe_sup}
             started: [{pid,<0.39.0>},
                       {name,overload},
                       {mfa,{overload,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]
Status of node 'BIGPOOH at BIGPOOH' ...
=PROGRESS REPORT==== 27-Jan-2010::11:15:40 ===
          supervisor: {local,sasl_sup}
             started: [{pid,<0.37.0>},
                       {name,sasl_safe_sup},
                       {mfa,
                           {supervisor,start_link,
                               [{local,sasl_safe_sup},sasl,safe]}},
                       {restart_type,permanent},
                       {shutdown,infinity},
                       {child_type,supervisor}]
=PROGRESS REPORT==== 27-Jan-2010::11:15:40 ===
          supervisor: {local,sasl_sup}
             started: [{pid,<0.40.0>},
                       {name,release_handler},
                       {mfa,{release_handler,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]
=PROGRESS REPORT==== 27-Jan-2010::11:15:40 ===
         application: sasl
          started_at: rabbitmqctl at BIGPOOH
=PROGRESS REPORT==== 27-Jan-2010::11:15:40 ===
          supervisor: {local,inet_gethost_native_sup}
             started: [{pid,<0.46.0>},{mfa,{inet_gethost_native,init,[[]]}}]
=PROGRESS REPORT==== 27-Jan-2010::11:15:40 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.45.0>},
                       {name,inet_gethost_native_sup},
                       {mfa,{inet_gethost_native,start_link,[]}},
                       {restart_type,temporary},
                       {shutdown,1000},
                       {child_type,worker}]
[{running_applications,[{rabbit,"RabbitMQ","1.7.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        {os_mon,"CPO  CXC 138 46","2.2.4"},
                        {sasl,"SASL  CXC 138 11","2.1.8"},
                        {stdlib,"ERTS  CXC 138 10","1.16.4"},
                        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,['BIGPOOH at BIGPOOH']},
 {running_nodes,['BIGPOOH at BIGPOOH']}]
...done.
___________________________________________________
C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin>rabbitmqctl status >
rabbitmqctl.status1

C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin>more rabbitmqctl.status1
=PROGRESS REPORT==== 27-Jan-2010::11:20:13 ===
          supervisor: {local,sasl_safe_sup}
             started: [{pid,<0.38.0>},
                       {name,alarm_handler},
                       {mfa,{alarm_handler,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]
=PROGRESS REPORT==== 27-Jan-2010::11:20:14 ===
          supervisor: {local,sasl_safe_sup}
             started: [{pid,<0.39.0>},
                       {name,overload},
                       {mfa,{overload,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]
Status of node 'BIGPOOH at BIGPOOH' ...
=PROGRESS REPORT==== 27-Jan-2010::11:20:14 ===
          supervisor: {local,sasl_sup}
             started: [{pid,<0.37.0>},
                       {name,sasl_safe_sup},
                       {mfa,
                           {supervisor,start_link,
                               [{local,sasl_safe_sup},sasl,safe]}},
                       {restart_type,permanent},
                       {shutdown,infinity},
                       {child_type,supervisor}]
=PROGRESS REPORT==== 27-Jan-2010::11:20:14 ===
          supervisor: {local,sasl_sup}
             started: [{pid,<0.40.0>},
                       {name,release_handler},
                       {mfa,{release_handler,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]
=PROGRESS REPORT==== 27-Jan-2010::11:20:14 ===
         application: sasl
          started_at: rabbitmqctl at BIGPOOH
=PROGRESS REPORT==== 27-Jan-2010::11:20:14 ===
          supervisor: {local,inet_gethost_native_sup}
             started: [{pid,<0.46.0>},{mfa,{inet_gethost_native,init,[[]]}}]
=PROGRESS REPORT==== 27-Jan-2010::11:20:14 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.45.0>},
                       {name,inet_gethost_native_sup},
                       {mfa,{inet_gethost_native,start_link,[]}},
                       {restart_type,temporary},
                       {shutdown,1000},
                       {child_type,worker}]
[{running_applications,[{rabbit,"RabbitMQ","1.7.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        {os_mon,"CPO  CXC 138 46","2.2.4"},
                        {sasl,"SASL  CXC 138 11","2.1.8"},
                        {stdlib,"ERTS  CXC 138 10","1.16.4"},
                        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,['BIGPOOH at BIGPOOH']},
 {running_nodes,['BIGPOOH at BIGPOOH']}]
...done.
___________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100127/cc9411a3/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BIGPOOH.log
Type: application/octet-stream
Size: 5238 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100127/cc9411a3/attachment.obj 

From matthias at lshift.net  Wed Jan 27 11:02:01 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 27 Jan 2010 11:02:01 +0000
Subject: [rabbitmq-discuss] MulticastMain Java client causes Erlang
 error eheap_alloc: Cannot allocate 467078560 bytes of memory (of type
 "heap") (with RabbitMQ 1.7.1)
In-Reply-To: <173a1edc1001270243t68d23305wb240aaaa7a641aa4@mail.gmail.com>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>	
	<4B5DEE87.1090700@lshift.net>	
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>	
	<4B5F0C63.3060806@lshift.net>	
	<173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>	
	<4B5F3059.8060006@lshift.net>	
	<173a1edc1001261032g6757a1d6uc06d33bb4a842fae@mail.gmail.com>	
	<4B5F4351.1050806@lshift.net>
	<173a1edc1001270243t68d23305wb240aaaa7a641aa4@mail.gmail.com>
Message-ID: <4B601D29.4030205@lshift.net>

John,

John Apps wrote:
> 2 GB with IMAGE_FILE_LARGE_ADDRESS_AWARE cleared (default)
> 4 GB with IMAGE_FILE_LARGE_ADDRESS_AWARE set
> See (http://msdn.microsoft.com/en-us/library/wz223b1z.aspx)
> 
> It would be good to know how the images shipped with the kit were linked.

I suspect it's the former.

> . RabbitMQ did respond to rabbitmqctl; the status is captured below,
> first time when the client was still connected, second after I
> had aborted it.

Good. So everything seems to work as expected.

> C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin>rabbitmqctl status > 
> rabbitmqctl.status
> 
> C:\AMQP\RabbitMQ\rabbitmq_server-1.7.1\sbin>more rabbitmqctl.status
> =PROGRESS REPORT==== 27-Jan-2010::11:15:40 ===
>           supervisor: {local,sasl_safe_sup}
>              started: [{pid,<0.38.0>},
>                        {name,alarm_handler},
>                        {mfa,{alarm_handler,start_link,[]}},
>                        {restart_type,permanent},
>                        {shutdown,2000},
>                        {child_type,worker}]
> [...]

Do you always see these progress reports when running rabbitmqctl?


Regards,

Matthias.



From filip at tepper.pl  Wed Jan 27 11:08:43 2010
From: filip at tepper.pl (Filip Tepper)
Date: Wed, 27 Jan 2010 12:08:43 +0100
Subject: [rabbitmq-discuss] Auto-configuration of a cluster
Message-ID: <65483E15-3A9D-43C0-933F-D5236CAB5581@tepper.pl>

I have 2 RabbitMQ nodes on separate machines: 

rabbit at rabbitmq-1a.srv 
rabbit at rabbitmq-1b.srv 

Both with default configs. 

I've added /etc/rabbitmq/rabbitmq_cluster.config: 

["rabbit at brabbitmq-1a.atm", "rabbit at rabbitmq-1b.atm"]. 

After running rabbitmq-server on rabbitmq-1a.srv I get the following error: 

node          : rabbit at rabbitmq-1a 
app descriptor: /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app 
home dir      : /var/lib/rabbitmq 
cookie hash   : 9aG9gSiHJja8V0QJ/HNdzg== 
log           : /var/log/rabbitmq/rabbit.log 
sasl log      : /var/log/rabbitmq/rabbit-sasl.log 
database dir  : /var/lib/rabbitmq/mnesia/rabbit 

starting database             ...{"init terminating in do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{ 
unable_to_join_cluster,["rabbit at rabbitmq-1a.atm","rabbit at rabbitmq-1b.atm"],{function_clause,[{gen_server,d 
o_abcast,[["rabbit at rabbitmq-1a.atm","rabbit at rabbitmq-1b.atm"],mnesia_controller,{'$gen_cast',{merging_sche 
ma,'rabbit at rabbitmq-1a'}}]},{mnesia_controller,connect_nodes2,2}]}},{rabbit,start,[normal,[]]}}}}},[{init,start 
_it,1},{init,start_em,1}]}} 

=INFO REPORT==== 27-Jan-2010::11:46:58 === 
    application: rabbit 
    exited: {{unable_to_join_cluster,["rabbit at rabbitmq-1a.srv", 
                                      "rabbit at rabbitmq-1b.srv"], 
                                     {function_clause, 
                                         [{gen_server, 
                                              do_abcast, 
                                              [["rabbit at rabbitmq-1a.srv", 
                                                "rabbit at rabbitmq-1b.srv"], 
                                               mnesia_controller, 
                                               {'$gen_cast', 
                                                   {merging_schema, 
                                                       'rabbit at rabbitmq-1a'}}]}, 
                                          {mnesia_controller,connect_nodes2,2}]}}, 
             {rabbit,start,[normal,[]]}} 
    type: temporary 

Any ideas how to make it work? Thanks in advance! 

-- 
Filip Tepper


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100127/fcf131a3/attachment.htm 

From johndapps at gmail.com  Wed Jan 27 17:20:52 2010
From: johndapps at gmail.com (John Apps)
Date: Wed, 27 Jan 2010 18:20:52 +0100
Subject: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a query,
	e.g., list_queues, for 	a good 60 seconds or more (Windows 7)
Message-ID: <173a1edc1001270920w278dcbd5gce84a959998fe4de@mail.gmail.com>

Whilst not being a bug per se, it is annoying behaviour when rabbitmqctl
'sits there' for quite some time. Interestingly enough, it does not accept
<CTRL>C either. This wait is only encountered when activity is going on with
RabbitMQ, no matter what it is.

-- 
---
John Apps
(49) 171 869 1813
Sent from Grassau, Bavaria, Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100127/32bdc2ba/attachment.htm 

From erikba at odysseus.anderson.name  Wed Jan 27 22:33:40 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Wed, 27 Jan 2010 14:33:40 -0800 (PST)
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
Message-ID: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>

I'm trying to write up instructions on how I got all this rabbitmq /
orbited / stomp running while installing this on our production server
and this time things don't seem to be working properly.  The
configuration files have changed a bit from the last time I've noticed
(upgraded from 1.7.0 to 1.7.1 on windows?)  This is the error message
that I'm getting, any obvious translation to the config entry I'm
doing wrong?

starting STOMP Adapter (binding to [{"127.0.0.1",61613}])  ...{"Kernel
pid
terminated",application_controller,"{application_start_failure,rabbit_stomp,
{{invalid_host,[49,50,55,46,48,46,48,46,49],timeout},
{rabbit_stomp,start,[normal,[]]}}}"}

I'm getting this no matter what stomp_listeners entry I put in (or
even with no config at all) I still get this same error.

I have noticed that the "TCP Listeners" line takes longer to startup
with this version of RabbitMQ than the previous version did, even
before I ran rabbitmq-activate-plugins.bat, is that affecting this at
all?

These are the build commands that I used to get this built (on the
linux box in my office, once I downloaded all the dependent packages):

cd ~/rabbit/v1.7.1
ln -s rabbitmq-codegen-c73ecfc91be3 rabbitmq-codegen
ln -s rabbitmq-erlang-client-825eceaca84c rabbitmq-erlang-client
ln -s rabbitmq-public-umbrella-d1a272b28e90 rabbitmq-public-umbrella
ln -s rabbitmq-server-90e101fd8b67 rabbitmq-server
ln -s rabbitmq-stomp-da7859ff22c6 rabbitmq-stomp
ln -s rabbitmq-public-umbrella/include.mk
ln -s rabbitmq-erlang-client/dist/rabbit_common
ln -s rabbitmq-stomp/dist/rabbit_stomp.ez ../rabbit_stomp-1.7.1.ez
make -C rabbitmq-server
make -C rabbitmq-erlang-client
make -C rabbitmq-stomp

I'm guessing that either a lot more info is required, I need to drop
back down to 1.7.0, or I need to sit tight for a couple of days?  Is
"tip" the place I should be getting rabbitmq-stomp from?



From matthias at lshift.net  Wed Jan 27 23:01:06 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 27 Jan 2010 23:01:06 +0000
Subject: [rabbitmq-discuss] .NET BasicPublish randomly blocks forever
In-Reply-To: <27295461.post@talk.nabble.com>
References: <27295461.post@talk.nabble.com>
Message-ID: <4B60C5B2.6000304@lshift.net>

Dominik,

domsom wrote:
> On my dev environment (Ubuntu 09.10) running RabbitMQ server 1.6.0-1ubuntu,
> everything runs fine. In the production environment (Debian testing on a
> Virtuozzo virtual server) running RabbitMQ server 1.7.0-3, the Mono
> application (the message publishing thread, to be precise) randomly blocks
> forever when calling BasicPublish.
> [...]
> The log has a lot of entries like these:
> 
> =INFO REPORT==== 24-Jan-2010::15:12:34 ===
>     alarm_handler: {set,{system_memory_high_watermark,[]}}
> 
> =INFO REPORT==== 24-Jan-2010::15:12:35 ===
>     alarm_handler: {clear,system_memory_high_watermark}
> 
> After reading the docs, I figured these errors would cause RabbitMQ telling
> the application to stop sending messages.

That's exactly what is happening and what is causing the publisher to block.

> So I added these parameters to the startup command line:
> -os_mon memory_alarms false -os_mon memsup_system_only false -os_mon
> memsup_system_only false'
> to get rid of them. (In Virtuozzo VMs, it seems there's no way to get a
> valid figure of free memory, so this always triggers.) No effect though, the
> Mono app still blocks.

When you say "no effect", do you mean you still see the alarms?

Can you upgrade to 1.7.1? We changed the memory monitoring in 1.7.1, and 
I don't remember what the options were for controlling it in 1.7.0. The 
new system is documented at http://www.rabbitmq.com/extensions.html#memsup


Regards,

Matthias.



From matthias at lshift.net  Wed Jan 27 23:05:07 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 27 Jan 2010 23:05:07 +0000
Subject: [rabbitmq-discuss] syntax and semantics of basic
 content	'expiration' field?
In-Reply-To: <1264541438.7091.10.camel@bede>
References: <1264541438.7091.10.camel@bede>
Message-ID: <4B60C6A3.5050803@lshift.net>

Tim,

Tim Cole wrote:
> Are the syntax and semantics of the basic content 'expiration' field
> explained anywhere?

No.

> The official AMQP 0.8 specs appear to be almost entirely silent about
> it.

Indeed, and 0-9-1 makes it clear that there is no formally defined 
behaviour.

The RabbitMQ server currently ignores the field. Adding some message 
expiration facilities to RabbitMQ is on our todo list. You'll find 
previous requests / discussions in the mailing list archives.


Regards,

Matthias.



From matthias at lshift.net  Wed Jan 27 23:10:37 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 27 Jan 2010 23:10:37 +0000
Subject: [rabbitmq-discuss] Consuming from multiple queues
In-Reply-To: <67d2b0c71001261417oba8bb21g7b866e3720bd8d67@mail.gmail.com>
References: <67d2b0c71001261417oba8bb21g7b866e3720bd8d67@mail.gmail.com>
Message-ID: <4B60C7ED.2010209@lshift.net>

Ilya,

Ilya Sterin wrote:
> how can a single consumer listen to multiple queues and process
> messages as they arrive on either of the queues.

You should be able to take the following line from your code

> channel.basicConsume(queueName, false, consumer);

and repeat it for every queue you want to consume from, using the same 
consumer object.


Regards,

Matthias.



From matthias at lshift.net  Wed Jan 27 23:15:33 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 27 Jan 2010 23:15:33 +0000
Subject: [rabbitmq-discuss] Auto-configuration of a cluster
In-Reply-To: <65483E15-3A9D-43C0-933F-D5236CAB5581@tepper.pl>
References: <65483E15-3A9D-43C0-933F-D5236CAB5581@tepper.pl>
Message-ID: <4B60C915.7050300@lshift.net>

Filip,

Filip Tepper wrote:
> I have 2 RabbitMQ nodes on separate machines: 
> 
> rabbit at rabbitmq-1a.srv
> rabbit at rabbitmq-1b.srv
> 
> Both with default configs. 
> 
> I've added /etc/rabbitmq/rabbitmq_cluster.config: 
> 
> ["rabbit at brabbitmq-1a.atm", "rabbit at rabbitmq-1b.atm"]. 
> 
> After running rabbitmq-server on rabbitmq-1a.srv I get the following error: 
> 
> node          : rabbit at rabbitmq-1a 

Take a close look at the node names listed above. Your first list has 
.srv suffixes, your second list has .atm suffixes, and the actual node 
name reported by rabbit has no suffix. To get things to work, all three 
need to line up.

Also, the node names in the cluster config should be wrapped in *single* 
quotes, not double quotes.


Regards,

Matthias.



From matthias at lshift.net  Wed Jan 27 23:35:54 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 27 Jan 2010 23:35:54 +0000
Subject: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a
 query, e.g., list_queues, for 	a good 60 seconds or more (Windows 7)
In-Reply-To: <173a1edc1001270920w278dcbd5gce84a959998fe4de@mail.gmail.com>
References: <173a1edc1001270920w278dcbd5gce84a959998fe4de@mail.gmail.com>
Message-ID: <4B60CDDA.4070806@lshift.net>

John,

John Apps wrote:
> Whilst not being a bug per se, it is annoying behaviour when rabbitmqctl 
> 'sits there' for quite some time.

How long is 'quite some time'?

And what rabbitmqctl command were you trying to run? list_queues (as per 
the subject line)? If so, how many queues did you have at the time?

And when you say (in the subject line) that rabbitmqctl hangs *at the 
end* of a query, do you mean it displays the results and *then* hangs?

> Interestingly enough, it does not accept <CTRL>C either.

I'll have to find a Windows machine to try to reproduce that.

Are you running the standard rabbitmqctl.bat script? In the other thread 
you posted some rabbitmqctl output which contained progress log 
information, which is not something we see in testing and for which the 
most plausible explanation is that some additional options have been 
passed to the erl executable.

> This wait is only encountered when activity is going on with
> RabbitMQ, no matter what it is.

So this only happens when rabbit is really busy?

Rabbit does prioritise handling of rabbitmqctl processing over most 
other tasks, but when the server is under heavy load it can still take 
some time to handle these requests. There is not much we can do about 
that really, since we wouldn't want to stop message processing altogether.


Regards,

Matthias.



From alexis.richardson at gmail.com  Thu Jan 28 09:14:33 2010
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 28 Jan 2010 09:14:33 +0000
Subject: [rabbitmq-discuss] syntax and semantics of basic content
	'expiration' field?
In-Reply-To: <4B60C6A3.5050803@lshift.net>
References: <1264541438.7091.10.camel@bede> <4B60C6A3.5050803@lshift.net>
Message-ID: <167204d21001280114q2093ebc8t540a77a33a87914c@mail.gmail.com>

Tim

Do please feel free to suggest appropriate expiry behaviour.  As
Matthias says, there is more to be done here.

alexis



On Wed, Jan 27, 2010 at 11:05 PM, Matthias Radestock
<matthias at lshift.net> wrote:
> Tim,
>
> Tim Cole wrote:
>> Are the syntax and semantics of the basic content 'expiration' field
>> explained anywhere?
>
> No.
>
>> The official AMQP 0.8 specs appear to be almost entirely silent about
>> it.
>
> Indeed, and 0-9-1 makes it clear that there is no formally defined
> behaviour.
>
> The RabbitMQ server currently ignores the field. Adding some message
> expiration facilities to RabbitMQ is on our todo list. You'll find
> previous requests / discussions in the mailing list archives.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From johndapps at gmail.com  Thu Jan 28 09:32:00 2010
From: johndapps at gmail.com (John Apps)
Date: Thu, 28 Jan 2010 10:32:00 +0100
Subject: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a
	query, e.g., list_queues, for a good 60 seconds or more (Windows 7)
In-Reply-To: <4B60CDDA.4070806@lshift.net>
References: <173a1edc1001270920w278dcbd5gce84a959998fe4de@mail.gmail.com>
	<4B60CDDA.4070806@lshift.net>
Message-ID: <173a1edc1001280132h6176d6cic530a683f468bb34@mail.gmail.com>

>
>
>
> How long is 'quite some time'?
> >>>60 seconds
>


> And what rabbitmqctl command were you trying to run? list_queues (as per
> the subject line)? If so, how many queues did you have at the time?
>
> >>>Any command, including no command


> And when you say (in the subject line) that rabbitmqctl hangs *at the end*
> of a query, do you mean it displays the results and *then* hangs?
>
> >>> Yes, when it hangs, it is _after_ display of whatever is to be
> displayed. It will also hang if _no_ command is given. There is no
> pattern ascertainable to exactly when.
>


>  Interestingly enough, it does not accept <CTRL>C either.
>>
>
> I'll have to find a Windows machine to try to reproduce that.
>

>  This wait is only encountered when activity is going on with <<< This
>> statement is _incorrect_ as I have just discovered
>> RabbitMQ, no matter what it is.
>>
>
> So this only happens when rabbit is really busy?
> >>>what is really busy? I just got it to hang for 60 seconds with _no_
> activity, having just started the broker
>


> Rabbit does prioritise handling of rabbitmqctl processing over most other
> tasks, but when the server is under heavy load it can still take some time
> to handle these requests. There is not much we can do about that really,
> since we wouldn't want to stop message processing altogether.
>


> >>>As I said, not a bug per se, just annoying
>
>>
>> Are you running the standard rabbitmqctl.bat script? In the other thread
>> you posted some rabbitmqctl output which contained progress log information,
>> which is not something we see in testing and for which the most plausible
>> explanation is that some additional options have been passed to the erl
>> executable.
>>
>  >>>This is the rabbitmqctl.bat that I am using. It is what the kit
> installed, no modifications by me.
> @echo off
> REM   The contents of this file are subject to the Mozilla Public License
> REM   Version 1.1 (the "License"); you may not use this file except in
> REM   compliance with the License. You may obtain a copy of the License at
> REM   http://www.mozilla.org/MPL/
> REM
> REM   Software distributed under the License is distributed on an "AS IS"
> REM   basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See
> the
> REM   License for the specific language governing rights and limitations
> REM   under the License.
> REM
> REM   The Original Code is RabbitMQ.
> REM
> REM   The Initial Developers of the Original Code are LShift Ltd,
> REM   Cohesive Financial Technologies LLC, and Rabbit Technologies Ltd.
> REM
> REM   Portions created before 22-Nov-2008 00:00:00 GMT by LShift Ltd,
> REM   Cohesive Financial Technologies LLC, or Rabbit Technologies Ltd
> REM   are Copyright (C) 2007-2008 LShift Ltd, Cohesive Financial
> REM   Technologies LLC, and Rabbit Technologies Ltd.
> REM
> REM   Portions created by LShift Ltd are Copyright (C) 2007-2009 LShift
> REM   Ltd. Portions created by Cohesive Financial Technologies LLC are
> REM   Copyright (C) 2007-2009 Cohesive Financial Technologies
> REM   LLC. Portions created by Rabbit Technologies Ltd are Copyright
> REM   (C) 2007-2009 Rabbit Technologies Ltd.
> REM
> REM   All Rights Reserved.
> REM
> REM   Contributor(s): ______________________________________.
> REM
>
> setlocal
>
> if "%RABBITMQ_NODENAME%"=="" (
>     set RABBITMQ_NODENAME=rabbit
> )
>
> if not exist "%ERLANG_HOME%\bin\erl.exe" (
>     echo.
>     echo ******************************
>     echo ERLANG_HOME not set correctly.
>     echo ******************************
>     echo.
>     echo Please either set ERLANG_HOME to point to your Erlang installation
> or p
> lace the
>     echo RabbitMQ server distribution in the Erlang lib folder.
>     echo.
>     exit /B
> )
>
> "%ERLANG_HOME%\bin\erl.exe" -pa "%~dp0..\ebin" -noinput -hidden
> %RABBITMQ_CTL_ER
> L_ARGS% -sname rabbitmqctl -s rabbit_control -nodename %RABBITMQ_NODENAME%
> -extr
> a %*
> endlocal
>
> Regards,
>
> Matthias.
>



-- 
---
John Apps
(49) 171 869 1813
Sent from Grassau, Bavaria, Germany
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/72d08124/attachment.htm 

From matthias at lshift.net  Thu Jan 28 10:34:49 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 28 Jan 2010 10:34:49 +0000
Subject: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a
 query, e.g., list_queues, for a good 60 seconds or more (Windows 7)
In-Reply-To: <173a1edc1001280132h6176d6cic530a683f468bb34@mail.gmail.com>
References: <173a1edc1001270920w278dcbd5gce84a959998fe4de@mail.gmail.com>	
	<4B60CDDA.4070806@lshift.net>
	<173a1edc1001280132h6176d6cic530a683f468bb34@mail.gmail.com>
Message-ID: <4B616849.2060608@lshift.net>

John,

John Apps wrote:
>     And what rabbitmqctl command were you trying to run? list_queues (as
>     per the subject line)? If so, how many queues did you have at the time?
> 
>  >>>Any command, including no command

So sometimes just running 'rabbitmqctl', with no args, displays the help 
message and then hangs for 60s+ before terminating?

How easy is it to reproduce this behaviour?

>      >>>As I said, not a bug per se, just annoying

It is certainly very strange behaviour, and not something we have ever 
seen before.

Btw, is the machine running Windows natively or virtualised?

Do you have a second machine on which to repeat the experiment?

>      >>>This is the rabbitmqctl.bat that I am using. It is what the kit
>     installed, no modifications by me.

ok. Do you by any chance have %RABBITMQ_CTL_ERL_ARGS% set to anything? 
Or any other %RABBITMQ_*% env vars? Your previous post 
(http://old.nabble.com/Re%3A-MulticastMain-Java-client-causes-Erlang-error-eheap_alloc%3A-Cannot-allocate-467078560-bytes-of-memory-%28of-type-%22heap%22%29-%28with-RabbitMQ-1.7.1%29-p27337008.html) 
indicates that at the very least you must have set %RABBITMQ_NODENAME%, 
since the status report is for a node other than 'rabbit'.

Also, do you really get a whole bunch of "PROGRESS REPORT" messages when 
running rabbitmqctl, as indicated by that post?


Regards,

Matthias.



From glenn.ergeerts at artesis.be  Thu Jan 28 11:26:21 2010
From: glenn.ergeerts at artesis.be (glenner)
Date: Thu, 28 Jan 2010 03:26:21 -0800 (PST)
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
Message-ID: <27335731.post@talk.nabble.com>


Hi,

After upgrading the server to 1.7.1 my client hangs forever on the
BasicPublish() line using the following code.

            using (IConnection connection = new
ConnectionFactory().CreateConnection(this.serverAddress))
            {
                using (IModel channel = connection.CreateModel())
                {
                    channel.BasicReturn += new
BasicReturnEventHandler(OnChannelBasicReturn);
                    channel.ExchangeDeclare("", ExchangeType.Direct);
                    channel.QueueBind(EventBrokerQueueName, "", "", false,
null);
                    channel.BasicPublish("", "", true, true, null,
subscriptionRequestMessage.Serialize());
                }
            }

Switching back to 1.7.0 fixes this. I am using v1.7.1 of the .NET client dll
in both cases.
Has anyone got an idea?

Another unrelated issue: i had to add quotes to the following line in
rabbitmq-server.bat to get the script running:
    set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit

changed to :    set RABBITMQ_BOOT_FILE="%RABBITMQ_EBIN_ROOT%\rabbit"


regards,
Glenn
-- 
View this message in context: http://old.nabble.com/BasicPublish%28%29-from-.NET-client-hangs-after-upgrading-server-to-1.7.1-tp27335731p27335731.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Thu Jan 28 11:40:27 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 28 Jan 2010 11:40:27 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <27335731.post@talk.nabble.com>
References: <27335731.post@talk.nabble.com>
Message-ID: <4B6177AB.2030001@lshift.net>

Glenn,

glenner wrote:
> After upgrading the server to 1.7.1 my client hangs forever on the
> BasicPublish() line using the following code.

That's probably due to the improved memory monitoring telling the 
producers to pause in order to prevent the server from running out of 
memory. Do you see any alarms in the rabbit.log?

See http://www.rabbitmq.com/extensions.html#memsup for instructions on 
how to adjust the memory limits.

> Another unrelated issue: i had to add quotes to the following line in
> rabbitmq-server.bat to get the script running:
>     set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
> 
> changed to :    set RABBITMQ_BOOT_FILE="%RABBITMQ_EBIN_ROOT%\rabbit"

Really? Even in the 1.7.1 script? What error do you get?


Regards,

Matthias.



From matthew at lshift.net  Thu Jan 28 11:49:24 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 28 Jan 2010 11:49:24 +0000
Subject: [rabbitmq-discuss] amqp_login -> AMQP_RESPONSE_NONE (RabbitMQ C
 Client)
In-Reply-To: <D2EDA5E6-B26E-48E6-92F3-728BB218C54B@consequor.de>
References: <D2EDA5E6-B26E-48E6-92F3-728BB218C54B@consequor.de>
Message-ID: <20100128114923.GB4613@wellquite.org>

Hi Frank,

The RabbitMQ C client was written by Tony. He's currently on leave but
should be able to help out again soon. None of the rest of us have ever
looked at the C client and it is marked highly experimental.

On Mon, Jan 25, 2010 at 02:39:21PM +0100, Frank Goenninger - Consequor Consulting AG wrote:
> Being new to RabbitMQ I am using the C client to write an abstraction  
> layer on top of RabbitMQ. I am trying to do an amqp_login call but  
> always get a AMQP_RESPONSE_NONE in amqp_rpc_reply.
> 
> Is this normal, i.e. this is NOT an error? Do I get a server error if  
> the login fails or do I get this AMQP_RESPONSE_NONE if the login fails?

We were hoping some of the other users of the C client might be able to
help out with this one. Digging around the Java client though reveals
the following pattern.

The server will send a Start, the client replies with a StartOK which
contains the username and password. Upon sending that, you should get
back a connection tune method back from the server, if all is well.

Now, if the user details are wrong, the server will shut the connection.
So I guess, unless there's something smarted going on in the C client,
simply checking that the connection is still open might work, but in
general, if you get as far as receiving the connection.tune method, you
can trust that the authentication details you provided have been
accepted.

I hope that's of some help.

Matthew



From matthew at lshift.net  Thu Jan 28 12:00:44 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 28 Jan 2010 12:00:44 +0000
Subject: [rabbitmq-discuss] Monitoring rabbitmq
In-Reply-To: <aa3794b1001261242m38149d43m95bb0353b30201b1@mail.gmail.com>
References: <aa3794b1001261242m38149d43m95bb0353b30201b1@mail.gmail.com>
Message-ID: <20100128120044.GC4613@wellquite.org>

Hi Mark,

On Tue, Jan 26, 2010 at 03:42:39PM -0500, Mark Steele wrote:
> I'm trying to find a good way to monitor rabbit for inclusion in an HA
> cluster (pacemaker/corosync).
> 
> Does anyone have a good resource agent already created for such a purpose?

We don't have one off the shelf, though several of our clients are using
RabbitMQ with pacemaker and heartbeat, and presumeably have written similar
such scripts.

Rather than using the rabbitmq-multi script to monitor (which should be
fine), we tend to suggest just checking to see if the port is open (by
default 5672, but that can change on configuration). How does pacemaker
monitor something like apache? - again there would be the option of
either checking the port is open, or using some sort of status
monitoring. I don't know whether one is generally preferred to the
other?

Matthew



From matthew at lshift.net  Thu Jan 28 12:22:15 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 28 Jan 2010 12:22:15 +0000
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>
Message-ID: <20100128122215.GD4613@wellquite.org>

Hi Erik,

On Wed, Jan 27, 2010 at 02:33:40PM -0800, Erik Anderson wrote:
> I'm trying to write up instructions on how I got all this rabbitmq /
> orbited / stomp running while installing this on our production server
> and this time things don't seem to be working properly.  The
> configuration files have changed a bit from the last time I've noticed
> (upgraded from 1.7.0 to 1.7.1 on windows?)  This is the error message
> that I'm getting, any obvious translation to the config entry I'm
> doing wrong?
> 
> starting STOMP Adapter (binding to [{"127.0.0.1",61613}])  ...{"Kernel
> pid
> terminated",application_controller,"{application_start_failure,rabbit_stomp,
> {{invalid_host,[49,50,55,46,48,46,48,46,49],timeout},
> {rabbit_stomp,start,[normal,[]]}}}"}

Hmm, that's a bit odd. I've just installed the stomp adaptor and
literally with zero config, it all just works. This is building
rabbitmq_v1_7_1 from source.

The only things I have in my plugins dir are links to
rabbitmq-erlang-client and rabbitmq-stomp.

> I'm getting this no matter what stomp_listeners entry I put in (or
> even with no config at all) I still get this same error.
> 
> I have noticed that the "TCP Listeners" line takes longer to startup
> with this version of RabbitMQ than the previous version did, even
> before I ran rabbitmq-activate-plugins.bat, is that affecting this at
> all?
> 
> These are the build commands that I used to get this built (on the
> linux box in my office, once I downloaded all the dependent packages):
> 
> cd ~/rabbit/v1.7.1
> ln -s rabbitmq-codegen-c73ecfc91be3 rabbitmq-codegen
> ln -s rabbitmq-erlang-client-825eceaca84c rabbitmq-erlang-client
> ln -s rabbitmq-public-umbrella-d1a272b28e90 rabbitmq-public-umbrella
> ln -s rabbitmq-server-90e101fd8b67 rabbitmq-server
> ln -s rabbitmq-stomp-da7859ff22c6 rabbitmq-stomp
> ln -s rabbitmq-public-umbrella/include.mk
> ln -s rabbitmq-erlang-client/dist/rabbit_common
> ln -s rabbitmq-stomp/dist/rabbit_stomp.ez ../rabbit_stomp-1.7.1.ez
> make -C rabbitmq-server
> make -C rabbitmq-erlang-client
> make -C rabbitmq-stomp

Hmm, this is a bit odd. What we tend to recommend is that you have
everything in rabbitmq-public-umbrella, so it'd look a bit like this:

cd ~/rabbit/v1.7.1
hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
cd rabbitmq-public-umbrella
hg clone http://hg.rabbitmq.com/rabbitmq-codegen
hg clone http://hg.rabbitmq.com/rabbitmq-server
cd rabbitmq-server
hg up -C rabbitmq_v1_7_1
make -j
cd -
hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
cd rabbitmq-erlang-client
make
cd -
hg clone http://hg.rabbitmq.com/rabbitmq-stomp
cd rabbitmq-stomp
make
cd -
cd rabbitmq-server
mkdir -p plugins
cd !!$
ln -s ../../rabbitmq-stomp
ln -s ../../rabbitmq-erlang-client
cd ..
./scripts/rabbitmq-activate-plugins
make cleandb run

Certainly, I've just run all of that lot, and it works fine for me!

"tip" is one of the daftest "features" (and there are many) of hg. You
should be at the head of default - that's certainly what I'm using.

With regards configuration, we would suggest that you use the config file
in /etc/rabbitmq/rabbitmq.config (though this can sometimes be in other
places if eg you're using macports). Having a file like:

[{rabbit_stomp, [{listeners, [{"127.0.0.1",61612}]}]}].

is by far the easiest way to configure plugins like this as it avoids
nasty escaping issues if passing by env vars.

Best wishes,

Matthew



From glenn.ergeerts at artesis.be  Thu Jan 28 12:53:03 2010
From: glenn.ergeerts at artesis.be (Ergeerts Glenn)
Date: Thu, 28 Jan 2010 13:53:03 +0100
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <4B6177AB.2030001@lshift.net>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
Message-ID: <5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>

It Looks like there is a problem indeed.. This is in rabbit.log after starting:

=INFO REPORT==== 28-Jan-2010::13:46:39 ===
Memory limit set to 0MB.

=INFO REPORT==== 28-Jan-2010::13:46:39 ===
vm_memory_high_watermark set. Memory used:5285360 allowed:-663552

=INFO REPORT==== 28-Jan-2010::13:46:39 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}


I tried manually setting the memory limit using the config file and the link you provided (I was using an empty config before),
but it doesn't seem to change anything, still the same output. I'm probably doing something wrong here..

About the startup script: it is the 1.7.1 script indeed. The error i get is:
\RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at this time.

I'm running on windows 7 64bit.

Regards,
Glenn

-----Oorspronkelijk bericht-----
Van: Matthias Radestock [mailto:matthias at lshift.net]
Verzonden: donderdag 28 januari 2010 12:40
Aan: Ergeerts Glenn
CC: rabbitmq-discuss at lists.rabbitmq.com
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

Glenn,

glenner wrote:
> After upgrading the server to 1.7.1 my client hangs forever on the
> BasicPublish() line using the following code.

That's probably due to the improved memory monitoring telling the
producers to pause in order to prevent the server from running out of
memory. Do you see any alarms in the rabbit.log?

See http://www.rabbitmq.com/extensions.html#memsup for instructions on
how to adjust the memory limits.

> Another unrelated issue: i had to add quotes to the following line in
> rabbitmq-server.bat to get the script running:
>     set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
>
> changed to :    set RABBITMQ_BOOT_FILE="%RABBITMQ_EBIN_ROOT%\rabbit"

Really? Even in the 1.7.1 script? What error do you get?


Regards,

Matthias.



From majek04 at gmail.com  Thu Jan 28 13:11:26 2010
From: majek04 at gmail.com (majek04)
Date: Thu, 28 Jan 2010 13:11:26 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
	upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
Message-ID: <3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>

That's pretty interesting. Can I ask how much real memory do you have installed?

I would be also interested in the output of
vm_memory_monitor:get_total_memory()
(rabbit at debian)2> vm_memory_monitor:get_total_memory().

If you have

As a temporary workaround I can suggest setting 'vm_memory_high_watermark' to 0,
which will effectively disable memory based flow control. You can do
it by adding
this line to erl parameters in rabbitmq-server:
    -rabbit vm_memory_high_watermark 0 \

Alternatively you can set that variable in rabbitmq.config. There's an
example in docs:
  http://www.rabbitmq.com/extensions.html#memsup



On Thu, Jan 28, 2010 at 12:53, Ergeerts Glenn <glenn.ergeerts at artesis.be> wrote:
> It Looks like there is a problem indeed.. This is in rabbit.log after starting:
>
> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
> Memory limit set to 0MB.
>
> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
> vm_memory_high_watermark set. Memory used:5285360 allowed:-663552
>
> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
> ? ?alarm_handler: {set,{vm_memory_high_watermark,[]}}
>
>
> I tried manually setting the memory limit using the config file and the link you provided (I was using an empty config before),
> but it doesn't seem to change anything, still the same output. I'm probably doing something wrong here..
>
> About the startup script: it is the 1.7.1 script indeed. The error i get is:
> \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at this time.
>
> I'm running on windows 7 64bit.
>
> Regards,
> Glenn
>
> -----Oorspronkelijk bericht-----
> Van: Matthias Radestock [mailto:matthias at lshift.net]
> Verzonden: donderdag 28 januari 2010 12:40
> Aan: Ergeerts Glenn
> CC: rabbitmq-discuss at lists.rabbitmq.com
> Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1
>
> Glenn,
>
> glenner wrote:
>> After upgrading the server to 1.7.1 my client hangs forever on the
>> BasicPublish() line using the following code.
>
> That's probably due to the improved memory monitoring telling the
> producers to pause in order to prevent the server from running out of
> memory. Do you see any alarms in the rabbit.log?
>
> See http://www.rabbitmq.com/extensions.html#memsup for instructions on
> how to adjust the memory limits.
>
>> Another unrelated issue: i had to add quotes to the following line in
>> rabbitmq-server.bat to get the script running:
>> ? ? set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
>>
>> changed to : ? ?set RABBITMQ_BOOT_FILE="%RABBITMQ_EBIN_ROOT%\rabbit"
>
> Really? Even in the 1.7.1 script? What error do you get?
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From majek04 at gmail.com  Thu Jan 28 13:13:38 2010
From: majek04 at gmail.com (majek04)
Date: Thu, 28 Jan 2010 13:13:38 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
	upgrading server to 1.7.1
In-Reply-To: <3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
Message-ID: <3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>

Sorry for that, my gmail decided to send email before I was done.

So, I would be also interested in the output of
vm_memory_monitor:get_total_memory()
on your macine. Can I ask you to open erlang shell and type this command?
 (rabbit at debian)2> vm_memory_monitor:get_total_memory().


> As a temporary workaround I can suggest setting 'vm_memory_high_watermark' to 0,
> which will effectively disable memory based flow control. You can do
> it by adding
> this line to erl parameters in rabbitmq-server:
> ? ?-rabbit vm_memory_high_watermark 0 \
>
> Alternatively you can set that variable in rabbitmq.config. There's an
> example in docs:
> ?http://www.rabbitmq.com/extensions.html#memsup
>
>
>
> On Thu, Jan 28, 2010 at 12:53, Ergeerts Glenn <glenn.ergeerts at artesis.be> wrote:
>> It Looks like there is a problem indeed.. This is in rabbit.log after starting:
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>> Memory limit set to 0MB.
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>> vm_memory_high_watermark set. Memory used:5285360 allowed:-663552
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>> ? ?alarm_handler: {set,{vm_memory_high_watermark,[]}}
>>
>>
>> I tried manually setting the memory limit using the config file and the link you provided (I was using an empty config before),
>> but it doesn't seem to change anything, still the same output. I'm probably doing something wrong here..
>>
>> About the startup script: it is the 1.7.1 script indeed. The error i get is:
>> \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at this time.
>>
>> I'm running on windows 7 64bit.
>>
>> Regards,
>> Glenn
>>
>> -----Oorspronkelijk bericht-----
>> Van: Matthias Radestock [mailto:matthias at lshift.net]
>> Verzonden: donderdag 28 januari 2010 12:40
>> Aan: Ergeerts Glenn
>> CC: rabbitmq-discuss at lists.rabbitmq.com
>> Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1
>>
>> Glenn,
>>
>> glenner wrote:
>>> After upgrading the server to 1.7.1 my client hangs forever on the
>>> BasicPublish() line using the following code.
>>
>> That's probably due to the improved memory monitoring telling the
>> producers to pause in order to prevent the server from running out of
>> memory. Do you see any alarms in the rabbit.log?
>>
>> See http://www.rabbitmq.com/extensions.html#memsup for instructions on
>> how to adjust the memory limits.
>>
>>> Another unrelated issue: i had to add quotes to the following line in
>>> rabbitmq-server.bat to get the script running:
>>> ? ? set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
>>>
>>> changed to : ? ?set RABBITMQ_BOOT_FILE="%RABBITMQ_EBIN_ROOT%\rabbit"
>>
>> Really? Even in the 1.7.1 script? What error do you get?
>>
>>
>> Regards,
>>
>> Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From glenn.ergeerts at artesis.be  Thu Jan 28 13:32:03 2010
From: glenn.ergeerts at artesis.be (Ergeerts Glenn)
Date: Thu, 28 Jan 2010 14:32:03 +0100
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
Message-ID: <5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>

I have 4GB of RAM.
I tried running the command however it failed with
** exception error: undefined function vm_memory_monitor:get_total_memory/0

I'm new to rabbitMQ/erlang so I'm probably doing something wrong here.
(I set the environment variable, ran rabbitmq-server.bat, opened the erlang emulator and typed in the command.)

-----Oorspronkelijk bericht-----
Van: majek04 [mailto:majek04 at gmail.com]
Verzonden: donderdag 28 januari 2010 14:14
Aan: Ergeerts Glenn
CC: Matthias Radestock; rabbitmq-discuss at lists.rabbitmq.com
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

Sorry for that, my gmail decided to send email before I was done.

So, I would be also interested in the output of
vm_memory_monitor:get_total_memory()
on your macine. Can I ask you to open erlang shell and type this command?
 (rabbit at debian)2> vm_memory_monitor:get_total_memory().


> As a temporary workaround I can suggest setting 'vm_memory_high_watermark' to 0,
> which will effectively disable memory based flow control. You can do
> it by adding
> this line to erl parameters in rabbitmq-server:
>    -rabbit vm_memory_high_watermark 0 \
>
> Alternatively you can set that variable in rabbitmq.config. There's an
> example in docs:
>  http://www.rabbitmq.com/extensions.html#memsup
>
>
>
> On Thu, Jan 28, 2010 at 12:53, Ergeerts Glenn <glenn.ergeerts at artesis.be> wrote:
>> It Looks like there is a problem indeed.. This is in rabbit.log after starting:
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>> Memory limit set to 0MB.
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>> vm_memory_high_watermark set. Memory used:5285360 allowed:-663552
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>>    alarm_handler: {set,{vm_memory_high_watermark,[]}}
>>
>>
>> I tried manually setting the memory limit using the config file and the link you provided (I was using an empty config before),
>> but it doesn't seem to change anything, still the same output. I'm probably doing something wrong here..
>>
>> About the startup script: it is the 1.7.1 script indeed. The error i get is:
>> \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at this time.
>>
>> I'm running on windows 7 64bit.
>>
>> Regards,
>> Glenn
>>
>> -----Oorspronkelijk bericht-----
>> Van: Matthias Radestock [mailto:matthias at lshift.net]
>> Verzonden: donderdag 28 januari 2010 12:40
>> Aan: Ergeerts Glenn
>> CC: rabbitmq-discuss at lists.rabbitmq.com
>> Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1
>>
>> Glenn,
>>
>> glenner wrote:
>>> After upgrading the server to 1.7.1 my client hangs forever on the
>>> BasicPublish() line using the following code.
>>
>> That's probably due to the improved memory monitoring telling the
>> producers to pause in order to prevent the server from running out of
>> memory. Do you see any alarms in the rabbit.log?
>>
>> See http://www.rabbitmq.com/extensions.html#memsup for instructions on
>> how to adjust the memory limits.
>>
>>> Another unrelated issue: i had to add quotes to the following line in
>>> rabbitmq-server.bat to get the script running:
>>>     set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
>>>
>>> changed to :    set RABBITMQ_BOOT_FILE="%RABBITMQ_EBIN_ROOT%\rabbit"
>>
>> Really? Even in the 1.7.1 script? What error do you get?
>>
>>
>> Regards,
>>
>> Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From majek04 at gmail.com  Thu Jan 28 14:04:51 2010
From: majek04 at gmail.com (majek04)
Date: Thu, 28 Jan 2010 14:04:51 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
	upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
Message-ID: <3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>

On Thu, Jan 28, 2010 at 13:32, Ergeerts Glenn <glenn.ergeerts at artesis.be> wrote:
> I have 4GB of RAM.
> I tried running the command however it failed with
> ** exception error: undefined function vm_memory_monitor:get_total_memory/0
>
> I'm new to rabbitMQ/erlang so I'm probably doing something wrong here.
> (I set the environment variable, ran rabbitmq-server.bat, opened the erlang emulator and typed in the command.)

Sorry for that. My previous instructions couldn't work. Can you please try,
first to run erlang interpreter, erl.exe. That works for me from cmd:
"%ERLANG_HOME%\bin\erl.exe"

After this, in erlang interactive interpreter type:
application:start(sasl).
application:start(os_mon).
os_mon_sysinfo:get_mem_info().

If you succeeded, I'm interested in the output of the last command. For
me it starts like: ["42 5636363 ...

Cheers,
   Marek Majkowski



From aquino.gustavo at gmail.com  Thu Jan 28 15:07:21 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Thu, 28 Jan 2010 13:07:21 -0200
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
	upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
Message-ID: <5ef296b31001280707r55b6f009kd8fc1911d442daa3@mail.gmail.com>

Glenn,

Are you sending a lot of messages ?, this source code that you post here are
in one class that are created all time that you send a new message ?

Because a lot of memory will be consumed if all the time you create
connection and forgot it there like you show your source, if it is your case
just open one connection and reuse the Rabbit Object connection, doing it
you will use a little memory and will increase performance of your
application.

If you get the example source coming with RabbitMQ.Net and just put one loop
to send a lot of messages you will get the same error reported.

Regards.



On Thu, Jan 28, 2010 at 11:32 AM, Ergeerts Glenn
<glenn.ergeerts at artesis.be>wrote:

> I have 4GB of RAM.
> I tried running the command however it failed with
> ** exception error: undefined function vm_memory_monitor:get_total_memory/0
>
> I'm new to rabbitMQ/erlang so I'm probably doing something wrong here.
> (I set the environment variable, ran rabbitmq-server.bat, opened the erlang
> emulator and typed in the command.)
>
> -----Oorspronkelijk bericht-----
> Van: majek04 [mailto:majek04 at gmail.com]
> Verzonden: donderdag 28 januari 2010 14:14
> Aan: Ergeerts Glenn
> CC: Matthias Radestock; rabbitmq-discuss at lists.rabbitmq.com
> Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs
> after upgrading server to 1.7.1
>
> Sorry for that, my gmail decided to send email before I was done.
>
> So, I would be also interested in the output of
> vm_memory_monitor:get_total_memory()
> on your macine. Can I ask you to open erlang shell and type this command?
>  (rabbit at debian)2> vm_memory_monitor:get_total_memory().
>
>
> > As a temporary workaround I can suggest setting
> 'vm_memory_high_watermark' to 0,
> > which will effectively disable memory based flow control. You can do
> > it by adding
> > this line to erl parameters in rabbitmq-server:
> >    -rabbit vm_memory_high_watermark 0 \
> >
> > Alternatively you can set that variable in rabbitmq.config. There's an
> > example in docs:
> >  http://www.rabbitmq.com/extensions.html#memsup
> >
> >
> >
> > On Thu, Jan 28, 2010 at 12:53, Ergeerts Glenn <glenn.ergeerts at artesis.be>
> wrote:
> >> It Looks like there is a problem indeed.. This is in rabbit.log after
> starting:
> >>
> >> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
> >> Memory limit set to 0MB.
> >>
> >> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
> >> vm_memory_high_watermark set. Memory used:5285360 allowed:-663552
> >>
> >> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
> >>    alarm_handler: {set,{vm_memory_high_watermark,[]}}
> >>
> >>
> >> I tried manually setting the memory limit using the config file and the
> link you provided (I was using an empty config before),
> >> but it doesn't seem to change anything, still the same output. I'm
> probably doing something wrong here..
> >>
> >> About the startup script: it is the 1.7.1 script indeed. The error i get
> is:
> >> \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at
> this time.
> >>
> >> I'm running on windows 7 64bit.
> >>
> >> Regards,
> >> Glenn
> >>
> >> -----Oorspronkelijk bericht-----
> >> Van: Matthias Radestock [mailto:matthias at lshift.net]
> >> Verzonden: donderdag 28 januari 2010 12:40
> >> Aan: Ergeerts Glenn
> >> CC: rabbitmq-discuss at lists.rabbitmq.com
> >> Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs
> after upgrading server to 1.7.1
> >>
> >> Glenn,
> >>
> >> glenner wrote:
> >>> After upgrading the server to 1.7.1 my client hangs forever on the
> >>> BasicPublish() line using the following code.
> >>
> >> That's probably due to the improved memory monitoring telling the
> >> producers to pause in order to prevent the server from running out of
> >> memory. Do you see any alarms in the rabbit.log?
> >>
> >> See http://www.rabbitmq.com/extensions.html#memsup for instructions on
> >> how to adjust the memory limits.
> >>
> >>> Another unrelated issue: i had to add quotes to the following line in
> >>> rabbitmq-server.bat to get the script running:
> >>>     set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
> >>>
> >>> changed to :    set RABBITMQ_BOOT_FILE="%RABBITMQ_EBIN_ROOT%\rabbit"
> >>
> >> Really? Even in the 1.7.1 script? What error do you get?
> >>
> >>
> >> Regards,
> >>
> >> Matthias.
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/86e1dffe/attachment.htm 

From glenn.ergeerts at artesis.be  Thu Jan 28 15:26:24 2010
From: glenn.ergeerts at artesis.be (Ergeerts Glenn)
Date: Thu, 28 Jan 2010 16:26:24 +0100
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
Message-ID: <5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>

This is the output:

3> os_mon_sysinfo:get_mem_info().
["76 -1658880 1016913920 -1 -1021628416 2147352576 2134794240\n"]

-----Oorspronkelijk bericht-----
Van: majek04 [mailto:majek04 at gmail.com]
Verzonden: donderdag 28 januari 2010 15:05
Aan: Ergeerts Glenn
CC: Matthias Radestock; rabbitmq-discuss at lists.rabbitmq.com
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

On Thu, Jan 28, 2010 at 13:32, Ergeerts Glenn <glenn.ergeerts at artesis.be> wrote:
> I have 4GB of RAM.
> I tried running the command however it failed with
> ** exception error: undefined function vm_memory_monitor:get_total_memory/0
>
> I'm new to rabbitMQ/erlang so I'm probably doing something wrong here.
> (I set the environment variable, ran rabbitmq-server.bat, opened the erlang emulator and typed in the command.)

Sorry for that. My previous instructions couldn't work. Can you please try,
first to run erlang interpreter, erl.exe. That works for me from cmd:
"%ERLANG_HOME%\bin\erl.exe"

After this, in erlang interactive interpreter type:
application:start(sasl).
application:start(os_mon).
os_mon_sysinfo:get_mem_info().

If you succeeded, I'm interested in the output of the last command. For
me it starts like: ["42 5636363 ...

Cheers,
   Marek Majkowski

From glenn.ergeerts at artesis.be  Thu Jan 28 15:27:15 2010
From: glenn.ergeerts at artesis.be (Ergeerts Glenn)
Date: Thu, 28 Jan 2010 16:27:15 +0100
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <5ef296b31001280707r55b6f009kd8fc1911d442daa3@mail.gmail.com>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<5ef296b31001280707r55b6f009kd8fc1911d442daa3@mail.gmail.com>
Message-ID: <5429EF528F02C34281C8573452C749431AB4EEE9E4@ca-win-mbs02.artesis.be>

No, i am only sending 1 message

Van: Gustavo Aquino [mailto:aquino.gustavo at gmail.com]
Verzonden: donderdag 28 januari 2010 16:07
Aan: Ergeerts Glenn
CC: majek04; rabbitmq-discuss at lists.rabbitmq.com
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

Glenn,

Are you sending a lot of messages ?, this source code that you post here are in one class that are created all time that you send a new message ?

Because a lot of memory will be consumed if all the time you create connection and forgot it there like you show your source, if it is your case just open one connection and reuse the Rabbit Object connection, doing it you will use a little memory and will increase performance of your application.

If you get the example source coming with RabbitMQ.Net and just put one loop to send a lot of messages you will get the same error reported.

Regards.


On Thu, Jan 28, 2010 at 11:32 AM, Ergeerts Glenn <glenn.ergeerts at artesis.be<mailto:glenn.ergeerts at artesis.be>> wrote:
I have 4GB of RAM.
I tried running the command however it failed with
** exception error: undefined function vm_memory_monitor:get_total_memory/0

I'm new to rabbitMQ/erlang so I'm probably doing something wrong here.
(I set the environment variable, ran rabbitmq-server.bat, opened the erlang emulator and typed in the command.)

-----Oorspronkelijk bericht-----
Van: majek04 [mailto:majek04 at gmail.com<mailto:majek04 at gmail.com>]
Verzonden: donderdag 28 januari 2010 14:14
Aan: Ergeerts Glenn
CC: Matthias Radestock; rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

Sorry for that, my gmail decided to send email before I was done.

So, I would be also interested in the output of
vm_memory_monitor:get_total_memory()
on your macine. Can I ask you to open erlang shell and type this command?
 (rabbit at debian)2> vm_memory_monitor:get_total_memory().


> As a temporary workaround I can suggest setting 'vm_memory_high_watermark' to 0,
> which will effectively disable memory based flow control. You can do
> it by adding
> this line to erl parameters in rabbitmq-server:
>    -rabbit vm_memory_high_watermark 0 \
>
> Alternatively you can set that variable in rabbitmq.config. There's an
> example in docs:
>  http://www.rabbitmq.com/extensions.html#memsup
>
>
>
> On Thu, Jan 28, 2010 at 12:53, Ergeerts Glenn <glenn.ergeerts at artesis.be<mailto:glenn.ergeerts at artesis.be>> wrote:
>> It Looks like there is a problem indeed.. This is in rabbit.log after starting:
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>> Memory limit set to 0MB.
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>> vm_memory_high_watermark set. Memory used:5285360 allowed:-663552
>>
>> =INFO REPORT==== 28-Jan-2010::13:46:39 ===
>>    alarm_handler: {set,{vm_memory_high_watermark,[]}}
>>
>>
>> I tried manually setting the memory limit using the config file and the link you provided (I was using an empty config before),
>> but it doesn't seem to change anything, still the same output. I'm probably doing something wrong here..
>>
>> About the startup script: it is the 1.7.1 script indeed. The error i get is:
>> \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at this time.
>>
>> I'm running on windows 7 64bit.
>>
>> Regards,
>> Glenn
>>
>> -----Oorspronkelijk bericht-----
>> Van: Matthias Radestock [mailto:matthias at lshift.net<mailto:matthias at lshift.net>]
>> Verzonden: donderdag 28 januari 2010 12:40
>> Aan: Ergeerts Glenn
>> CC: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1
>>
>> Glenn,
>>
>> glenner wrote:
>>> After upgrading the server to 1.7.1 my client hangs forever on the
>>> BasicPublish() line using the following code.
>>
>> That's probably due to the improved memory monitoring telling the
>> producers to pause in order to prevent the server from running out of
>> memory. Do you see any alarms in the rabbit.log?
>>
>> See http://www.rabbitmq.com/extensions.html#memsup for instructions on
>> how to adjust the memory limits.
>>
>>> Another unrelated issue: i had to add quotes to the following line in
>>> rabbitmq-server.bat to get the script running:
>>>     set RABBITMQ_BOOT_FILE=%RABBITMQ_EBIN_ROOT%\rabbit
>>>
>>> changed to :    set RABBITMQ_BOOT_FILE="%RABBITMQ_EBIN_ROOT%\rabbit"
>>
>> Really? Even in the 1.7.1 script? What error do you get?
>>
>>
>> Regards,
>>
>> Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/c2396c06/attachment.htm 

From sterini at gmail.com  Thu Jan 28 16:03:19 2010
From: sterini at gmail.com (Ilya Sterin)
Date: Thu, 28 Jan 2010 11:03:19 -0500
Subject: [rabbitmq-discuss] Consuming from multiple queues
In-Reply-To: <4B60C7ED.2010209@lshift.net>
References: <67d2b0c71001261417oba8bb21g7b866e3720bd8d67@mail.gmail.com>
	<4B60C7ED.2010209@lshift.net>
Message-ID: <67d2b0c71001280803q113d3278uc5d203ed8364dbd7@mail.gmail.com>

Awesome, thanks, that works.

Ilya

On Wed, Jan 27, 2010 at 6:10 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Ilya,
>
> Ilya Sterin wrote:
>>
>> how can a single consumer listen to multiple queues and process
>> messages as they arrive on either of the queues.
>
> You should be able to take the following line from your code
>
>> channel.basicConsume(queueName, false, consumer);
>
> and repeat it for every queue you want to consume from, using the same
> consumer object.
>
>
> Regards,
>
> Matthias.
>



From matthew at lshift.net  Thu Jan 28 16:04:43 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 28 Jan 2010 16:04:43 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
Message-ID: <20100128160443.GE4613@wellquite.org>

On Thu, Jan 28, 2010 at 04:26:24PM +0100, Ergeerts Glenn wrote:
> This is the output:
> 
> 3> os_mon_sysinfo:get_mem_info().
> ["76 -1658880 1016913920 -1 -1021628416 2147352576 2134794240\n"]

Hee hee:

1> <<X:32/unsigned-native>> = <<-1658880:32/signed-native>>, X.
4293308416
2> 4*1024*1024*1024.
4294967296

I think this is an Erlang bug, but we need to dig down further to check -
it looks to me like Erlang is interpreting a value as signed, when it's
actually unsigned. Hence Erlang and correspondingly Rabbit thinking you
have negative amounts of memory installed.

We shall investigate further. Many thanks for your help,

Matthew



From majek04 at gmail.com  Thu Jan 28 16:12:29 2010
From: majek04 at gmail.com (majek04)
Date: Thu, 28 Jan 2010 16:12:29 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
	upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
Message-ID: <3bb0d9711001280812q9233324w99d1798f2cd6923c@mail.gmail.com>

On Thu, Jan 28, 2010 at 15:26, Ergeerts Glenn <glenn.ergeerts at artesis.be> wrote:
> This is the output:
>
> 3> os_mon_sysinfo:get_mem_info().
> ["76 -1658880 1016913920 -1 -1021628416 2147352576 2134794240\n"]

Congratulations. Your system has negative memory.
It looks like you've just found a bug in Erlang or Windows.

As mentioned before. for the time being I suggest disabling memory based
flow control. To do so you need to edit rabbitmq.config and put this
as contents:
  [{rabbit, [{vm_memory_high_watermark, 0}]}].
You can read about this file here:
  http://www.rabbitmq.com/install.html#configfile
This file normally lives in a path like that:
  c:\Documents and Settings\<user>\Application Data\RabbitMQ\rabbitmq.config

To see if this file is working you could peek at the logs. After
setting the value
to zero, you _shouldn't_ see the line:
  Memory limit set to XXXMB

Hope that helps,
   Marek Majkowski



From msteele at beringmedia.com  Thu Jan 28 16:19:34 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Thu, 28 Jan 2010 11:19:34 -0500
Subject: [rabbitmq-discuss] Monitoring rabbitmq
In-Reply-To: <20100128120044.GC4613@wellquite.org>
References: <aa3794b1001261242m38149d43m95bb0353b30201b1@mail.gmail.com> 
	<20100128120044.GC4613@wellquite.org>
Message-ID: <aa3794b1001280819h299e7b35ma140939eeb450407@mail.gmail.com>

I suppose it depends on the level of certainty one is looking for. Checking
that the port is open doesn't mean that rabbit is capable of
receiving/sending messages (eg: SSL listener bug, etc...). I guess the only
real way to monitor would  be to connect, publish, and consume.



On Thu, Jan 28, 2010 at 7:00 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Mark,
>
> On Tue, Jan 26, 2010 at 03:42:39PM -0500, Mark Steele wrote:
> > I'm trying to find a good way to monitor rabbit for inclusion in an HA
> > cluster (pacemaker/corosync).
> >
> > Does anyone have a good resource agent already created for such a
> purpose?
>
> We don't have one off the shelf, though several of our clients are using
> RabbitMQ with pacemaker and heartbeat, and presumeably have written similar
> such scripts.
>
> Rather than using the rabbitmq-multi script to monitor (which should be
> fine), we tend to suggest just checking to see if the port is open (by
> default 5672, but that can change on configuration). How does pacemaker
> monitor something like apache? - again there would be the option of
> either checking the port is open, or using some sort of status
> monitoring. I don't know whether one is generally preferred to the
> other?
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Mark Steele
Director of development
Bering Media Inc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/aa09e4d2/attachment.htm 

From matthew at lshift.net  Thu Jan 28 16:34:30 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 28 Jan 2010 16:34:30 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <20100128160443.GE4613@wellquite.org>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
	<20100128160443.GE4613@wellquite.org>
Message-ID: <20100128163430.GF4613@wellquite.org>

On Thu, Jan 28, 2010 at 04:04:43PM +0000, Matthew Sackman wrote:
> We shall investigate further. Many thanks for your help,

Yup, it's a bug in win32sysinfo.c which Erlang uses to call Windows to
find out how much memory it has. It has the following code:

void get_avail_mem_ext() {
    char answer[512];
    MEMORYSTATUSEX ms;
    ms.dwLength=sizeof(MEMORYSTATUSEX);
    GlobalMemoryStatusEx(&ms);
    sprintf(answer,"%d %I64d %I64d %I64d %I64d %I64d %I64d\n",
	    ms.dwMemoryLoad,
	    ms.ullTotalPhys,
	    ms.ullAvailPhys,
	    ms.ullTotalPageFile,
	    ms.ullAvailPageFile,
	    ms.ullTotalVirtual,
	    ms.ullAvailVirtual
	    );
    return_answer(answer);
    /*    
	DWORD     dwLength;
	DWORD     dwMemoryLoad;
	DWORDLONG ullTotalPhys;
	DWORDLONG ullAvailPhys;
	DWORDLONG ullTotalPageFile;
	DWORDLONG ullAvailPageFile;
	DWORDLONG ullTotalVirtual;
	DWORDLONG ullAvailVirtual;
    */
}

Sadly, whoever wrote that didn't notice the fact that DWORD and DWORDLONG
are unsigned, whereas %I64d says to interpret the value as signed.

$ cat foo.c
#include <stddef.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

main()
{
  uint64_t n = 4293308416;
  printf("%I64d\n", n);
  printf("%I64u\n", n);
  return 0;
}

$ gcc -o foo foo.c && ./foo 
                                                        -1658880
                                                      4293308416

This is exactly what is happening. We'll file a bug with the erlang
people and try and work around it. I don't suppose by any chance you're
compiling erlang from source under Windows are you?

Best wishes,

Matthew



From matthew at lshift.net  Thu Jan 28 17:00:40 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 28 Jan 2010 17:00:40 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <20100128163430.GF4613@wellquite.org>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<3bb0d9711001280511x8cee364re4fde72cfb58298c@mail.gmail.com>
	<3bb0d9711001280513s792ab4d5kbbcc7e1e44e05732@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE994@ca-win-mbs02.artesis.be>
	<3bb0d9711001280604v3befd855k7bc903f74b6c6756@mail.gmail.com>
	<5429EF528F02C34281C8573452C749431AB4EEE9E3@ca-win-mbs02.artesis.be>
	<20100128160443.GE4613@wellquite.org>
	<20100128163430.GF4613@wellquite.org>
Message-ID: <20100128170040.GG4613@wellquite.org>

On Thu, Jan 28, 2010 at 04:34:30PM +0000, Matthew Sackman wrote:
> Sadly, whoever wrote that didn't notice the fact that DWORD and DWORDLONG
> are unsigned, whereas %I64d says to interpret the value as signed.

Err not only that, but DWORDLONG is, err, long, whereas the %d treats it
as a normal int. The %I64 seems to be saying print in the system locale,
and prefix with up to 64 characters of whitespace. This truncation is
why we're seeing the negative values. The %I64u goes wrong as soon as you
have > 4GB RAM installed. I *think* it should be %I64lu.

Matthew



From david.wragg at lshift.net  Thu Jan 28 17:11:46 2010
From: david.wragg at lshift.net (David Wragg)
Date: Thu, 28 Jan 2010 17:11:46 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
	upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	(Ergeerts Glenn's message of "Thu\, 28 Jan 2010 13\:53\:03 +0100")
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
Message-ID: <k5y6ji40j1.fsf@mrbraver.lshift.net>

Hi Glenn,

Ergeerts Glenn <glenn.ergeerts at artesis.be> writes:
> I tried manually setting the memory limit using the config file and
> the link you provided (I was using an empty config before), but it
> doesn't seem to change anything, still the same output. I'm probably
> doing something wrong here..
>
> About the startup script: it is the 1.7.1 script indeed. The error i
> get is: \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was
> unexpected at this time.
>
> I'm running on windows 7 64bit.

I'm attempting to reproduce this problem, but without success so far.

The error message suggests that you have tried to install plugins.  Is
that correct?

Here's what I'm doing.  I'm on Windows 7 32-bit.

- I downloaded rabbitmq-server-windows-1.7.1.zip, and expanded it
  under c:\program files.

- Attempting to reproduce plugins installation, in a cmd window,
  started with "Run as Administator", I did:

C:\Program Files\RabbitMQ\rabbitmq_server-1.7.1>sbin\rabbitmq-activate-plugins.bat

- Then in a normal cmd window, I ran rabbitmq-server.  As you can see,
  it was successful:

C:\Program Files\RabbitMQ\rabbitmq_server-1.7.1>sbin\rabbitmq-server.bat
Using Custom Boot File "C:\Program Files\RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit.boot"

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and R
abbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at win7
app descriptor: c:/Program Files/RabbitMQ/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
home dir      : C:\Users\Dpw
cookie hash   : PfTMX6ZyBIjj104/jcuWQw==
log           : C:/Users/Dpw/AppData/Roaming/RabbitMQ/log/rabbit.log
sasl log      : C:/Users/Dpw/AppData/Roaming/RabbitMQ/log/rabbit-sasl.log
database dir  : c:/Users/Dpw/AppData/Roaming/RabbitMQ/db/rabbit-mnesia

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running



Does a similar procedure work for you?  If you are doing something
different, can you give us more information to help reproduce it?


David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From erikba at odysseus.anderson.name  Thu Jan 28 17:24:58 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Thu, 28 Jan 2010 09:24:58 -0800 (PST)
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <20100128122215.GD4613@wellquite.org>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>
	<20100128122215.GD4613@wellquite.org>
Message-ID: <6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>



On Jan 28, 4:22?am, Matthew Sackman <matt... at lshift.net> wrote:
> Hi Erik,
>
> On Wed, Jan 27, 2010 at 02:33:40PM -0800, Erik Anderson wrote:
> > I'm trying to write up instructions on how I got all this rabbitmq /
> > orbited / stomp running while installing this on our production server
> > and this time things don't seem to be working properly. ?The
> > configuration files have changed a bit from the last time I've noticed
> > (upgraded from 1.7.0 to 1.7.1 on windows?) ?This is the error message
> > that I'm getting, any obvious translation to the config entry I'm
> > doing wrong?
>
> > starting STOMP Adapter (binding to [{"127.0.0.1",61613}]) ?...{"Kernel
> > pid
> > terminated",application_controller,"{application_start_failure,rabbit_stomp ,
> > {{invalid_host,[49,50,55,46,48,46,48,46,49],timeout},
> > {rabbit_stomp,start,[normal,[]]}}}"}
>
> Hmm, that's a bit odd. I've just installed the stomp adaptor and
> literally with zero config, it all just works. This is building
> rabbitmq_v1_7_1 from source.
>
> The only things I have in my plugins dir are links to
> rabbitmq-erlang-client and rabbitmq-stomp.

For what it's worth, it looks on the surface in {invalid_host,
[49,50,55,46,48,46,48,46,49],timeout} that the numbers are the ascii
representation of "127.0.0.1".  Along with a new delay that feels like
a timeout when launching the normal TCP listeners, was some of the
"short node" stuff done in the last version affecting this?

> > I'm getting this no matter what stomp_listeners entry I put in (or
> > even with no config at all) I still get this same error.
>
> > I have noticed that the "TCP Listeners" line takes longer to startup
> > with this version of RabbitMQ than the previous version did, even
> > before I ran rabbitmq-activate-plugins.bat, is that affecting this at
> > all?
>
> > These are the build commands that I used to get this built (on the
> > linux box in my office, once I downloaded all the dependent packages):
>
> > cd ~/rabbit/v1.7.1
> > ln -s rabbitmq-codegen-c73ecfc91be3 rabbitmq-codegen
> > ln -s rabbitmq-erlang-client-825eceaca84c rabbitmq-erlang-client
> > ln -s rabbitmq-public-umbrella-d1a272b28e90 rabbitmq-public-umbrella
> > ln -s rabbitmq-server-90e101fd8b67 rabbitmq-server
> > ln -s rabbitmq-stomp-da7859ff22c6 rabbitmq-stomp
> > ln -s rabbitmq-public-umbrella/include.mk
> > ln -s rabbitmq-erlang-client/dist/rabbit_common
> > ln -s rabbitmq-stomp/dist/rabbit_stomp.ez ../rabbit_stomp-1.7.1.ez
> > make -C rabbitmq-server
> > make -C rabbitmq-erlang-client
> > make -C rabbitmq-stomp
>
> Hmm, this is a bit odd. What we tend to recommend is that you have
> everything in rabbitmq-public-umbrella, so it'd look a bit like this:
>
> cd ~/rabbit/v1.7.1
> hg clonehttp://hg.rabbitmq.com/rabbitmq-public-umbrella
> cd rabbitmq-public-umbrella
> hg clonehttp://hg.rabbitmq.com/rabbitmq-codegen
> hg clonehttp://hg.rabbitmq.com/rabbitmq-server
> cd rabbitmq-server
> hg up -C rabbitmq_v1_7_1
> make -j
> cd -
> hg clonehttp://hg.rabbitmq.com/rabbitmq-erlang-client
> cd rabbitmq-erlang-client
> make
> cd -
> hg clonehttp://hg.rabbitmq.com/rabbitmq-stomp
> cd rabbitmq-stomp
> make
> cd -
> cd rabbitmq-server
> mkdir -p plugins
> cd !!$
> ln -s ../../rabbitmq-stomp
> ln -s ../../rabbitmq-erlang-client
> cd ..
> ./scripts/rabbitmq-activate-plugins
> make cleandb run
>
> Certainly, I've just run all of that lot, and it works fine for me!
>
> "tip" is one of the daftest "features" (and there are many) of hg. You
> should be at the head of default - that's certainly what I'm using.

Umm, I haven't gotten around to installing hg, I'm hoping that I don't
have to get involved enough in the development side of this, so I've
just been downloading packages from the website.  The "tip" thing is
because for two of the packages the files I download from the website
are named that (the others are long hash identities).  I'm also
compiling on a different machine from the server (which has absolutely
no hope of running that Makefile) and copying the .ez file into a
plugins folder I create myself under the rabbitmq_server folder.

> With regards configuration, we would suggest that you use the config file
> in /etc/rabbitmq/rabbitmq.config (though this can sometimes be in other
> places if eg you're using macports). Having a file like:
>
> [{rabbit_stomp, [{listeners, [{"127.0.0.1",61612}]}]}].
>
> is by far the easiest way to configure plugins like this as it avoids
> nasty escaping issues if passing by env vars.

I haven't quite found the location of this file yet, and would like to
(if possible) move it to a more usable location (once I find it).
I've been running RabbitMQ through ProcessMonitor a fair amount to try
to discover these things (haven't found the service log yet either
with the magic cookies, but I haven't tried too hard yet).  I would
not have gotten anywhere near finding the required patches to the
previous version's startup scripts without tracing through the
program.

I must admit though that (not trying to strike back at an obvious
hardworking bunch here) from rabbitmq to orbited getting a comet
server has been almost like pulling teeth in from the perspective of
someone just trying to get a simple solution running.  It took me
almost two weeks trying to get rabbitmq-c compiled and running the
wiretest example under MSVC for instance.  I'm just hoping that I'm
almost there now, was starting to document how to do this for the
future.

> Best wishes,
>
> Matthew

Thank you for the fast response :-)



From gtcampbell at gmail.com  Thu Jan 28 17:44:30 2010
From: gtcampbell at gmail.com (Greg Campbell)
Date: Thu, 28 Jan 2010 09:44:30 -0800
Subject: [rabbitmq-discuss] Which Erlang client version to use with the
	1.7.1 server?
Message-ID: <ac6faba21001280944k2bd40e9fp5f77c642b3002d54@mail.gmail.com>

Should I use the 1_7_0 tag (which is what I've been using against server
version 1.7.0 previously), or will the "tip" work better with 1.7.1?

Thanks,
Greg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100128/532b77ec/attachment.htm 

From holger.hoffstaette at googlemail.com  Thu Jan 28 21:29:00 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Thu, 28 Jan 2010 22:29:00 +0100
Subject: [rabbitmq-discuss] Bug in java-client's build.xml: maven artifacts
	have wrong names
Message-ID: <pan.2010.01.28.21.28.58.757625@googlemail.com>


Hi,

After installing the java-client maven artifacts into my repo manager I
noticed that sources and docs are not properly attached to the jar in the
IDE because of a naming mixup. Patch is attached.

cheers
Holger

--snip--
--- build.xml	2010-01-22 14:14:24.000000000 +0100
+++ build-fixed.xml	2010-01-28 22:20:38.000000000 +0100
@@ -400,10 +400,10 @@
     <mkdir dir="${bundle.out}"/>
     <copy file="${lib.out}/rabbitmq-client.jar"
           tofile="${bundle.out}/amqp-client-${impl.version}.jar"/>
-    <jar destfile="${bundle.out}/amqp-client-sources-${impl.version}.jar">
+    <jar destfile="${bundle.out}/amqp-client-${impl.version}-sources.jar">
         <fileset dir="src"/>
     </jar>
-    <jar destfile="${bundle.out}/amqp-client-javadoc-${impl.version}.jar">
+    <jar destfile="${bundle.out}/amqp-client-${impl.version}-javadoc.jar">
         <fileset dir="${javadoc.out}"/>
     </jar>
     <copy file="pom.xml" tofile="${bundle.out}/amqp-client-${impl.version}.pom"/>
--snip--





From glenn.ergeerts at artesis.be  Thu Jan 28 22:03:13 2010
From: glenn.ergeerts at artesis.be (Ergeerts Glenn)
Date: Thu, 28 Jan 2010 23:03:13 +0100
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <k5y6ji40j1.fsf@mrbraver.lshift.net>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<k5y6ji40j1.fsf@mrbraver.lshift.net>
Message-ID: <5429EF528F02C34281C8573452C749431AB4EEEA2A@ca-win-mbs02.artesis.be>

Hi,

No, i have not installed any plugins, just extracted and ran rabbitmq-server.bat

-----Oorspronkelijk bericht-----
Van: David Wragg [mailto:david.wragg at lshift.net]
Verzonden: donderdag 28 januari 2010 18:12
Aan: Ergeerts Glenn
CC: Matthias Radestock; rabbitmq-discuss at lists.rabbitmq.com
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

Hi Glenn,

Ergeerts Glenn <glenn.ergeerts at artesis.be> writes:
> I tried manually setting the memory limit using the config file and
> the link you provided (I was using an empty config before), but it
> doesn't seem to change anything, still the same output. I'm probably
> doing something wrong here..
>
> About the startup script: it is the 1.7.1 script indeed. The error i
> get is: \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was
> unexpected at this time.
>
> I'm running on windows 7 64bit.

I'm attempting to reproduce this problem, but without success so far.

The error message suggests that you have tried to install plugins.  Is
that correct?

Here's what I'm doing.  I'm on Windows 7 32-bit.

- I downloaded rabbitmq-server-windows-1.7.1.zip, and expanded it
  under c:\program files.

- Attempting to reproduce plugins installation, in a cmd window,
  started with "Run as Administator", I did:

C:\Program Files\RabbitMQ\rabbitmq_server-1.7.1>sbin\rabbitmq-activate-plugins.bat

- Then in a normal cmd window, I ran rabbitmq-server.  As you can see,
  it was successful:

C:\Program Files\RabbitMQ\rabbitmq_server-1.7.1>sbin\rabbitmq-server.bat
Using Custom Boot File "C:\Program Files\RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit.boot"

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and R
abbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at win7
app descriptor: c:/Program Files/RabbitMQ/rabbitmq_server-1.7.1/sbin/../ebin/rabbit.app
home dir      : C:\Users\Dpw
cookie hash   : PfTMX6ZyBIjj104/jcuWQw==
log           : C:/Users/Dpw/AppData/Roaming/RabbitMQ/log/rabbit.log
sasl log      : C:/Users/Dpw/AppData/Roaming/RabbitMQ/log/rabbit-sasl.log
database dir  : c:/Users/Dpw/AppData/Roaming/RabbitMQ/db/rabbit-mnesia

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running



Does a similar procedure work for you?  If you are doing something
different, can you give us more information to help reproduce it?


David

--
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From matthias at lshift.net  Thu Jan 28 22:22:36 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 28 Jan 2010 22:22:36 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEEA2A@ca-win-mbs02.artesis.be>
References: <27335731.post@talk.nabble.com>
	<4B6177AB.2030001@lshift.net>	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<k5y6ji40j1.fsf@mrbraver.lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEEA2A@ca-win-mbs02.artesis.be>
Message-ID: <4B620E2C.6080804@lshift.net>

Glenn,

Ergeerts Glenn wrote:
> No, i have not installed any plugins, just extracted and ran
> rabbitmq-server.bat

That's strange. To help us track this down, please do the following:

1) revert the rabbitmq-server.bat script to its original version 
(ideally by re-extracting the 1.7.1 zip)

2) open a cmd shell, and in that shell
- run 'set' to display all env vars
- run the rabbitmq-server.bat script
If that last step indeed produces the "...unexpected at this time." 
error, copy the *entire* shell output from these two steps into an email 
and send it to the list.

Thanks.

Matthias.



From tsuraan at gmail.com  Thu Jan 28 23:01:32 2010
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 28 Jan 2010 17:01:32 -0600
Subject: [rabbitmq-discuss] Repeated acks of a message
Message-ID: <84fb38e31001281501u2dd78e11vef5b86a803ef0148@mail.gmail.com>

This seems to work just fine, but I thought I'd ask just to be sure:
is it permitted to basicAck the same delivery tag more than once?  It
does work, and the doc doesn't appear to say anything against it, but
I just don't want anything I'm doing to break in the future.



From matthias at lshift.net  Thu Jan 28 23:17:01 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 28 Jan 2010 23:17:01 +0000
Subject: [rabbitmq-discuss] Repeated acks of a message
In-Reply-To: <84fb38e31001281501u2dd78e11vef5b86a803ef0148@mail.gmail.com>
References: <84fb38e31001281501u2dd78e11vef5b86a803ef0148@mail.gmail.com>
Message-ID: <4B621AED.2060202@lshift.net>

Tsuraan,

tsuraan wrote:
> This seems to work just fine, but I thought I'd ask just to be sure:
> is it permitted to basicAck the same delivery tag more than once?  It
> does work, and the doc doesn't appear to say anything against it, but
> I just don't want anything I'm doing to break in the future.

Actually, the 0-9-1 spec makes it clear that a client must not ack a 
message more than once. RabbitMQ, as you observed, currently doesn't 
care, but that may well change.


Regards,

Matthias.





From tsuraan at gmail.com  Fri Jan 29 04:12:51 2010
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 28 Jan 2010 22:12:51 -0600
Subject: [rabbitmq-discuss] Repeated acks of a message
In-Reply-To: <4B621AED.2060202@lshift.net>
References: <84fb38e31001281501u2dd78e11vef5b86a803ef0148@mail.gmail.com>
	<4B621AED.2060202@lshift.net>
Message-ID: <84fb38e31001282012v6aee50eax42733095b594deb2@mail.gmail.com>

> Actually, the 0-9-1 spec makes it clear that a client must not ack a
> message more than once. RabbitMQ, as you observed, currently doesn't
> care, but that may well change.

Is that to allow a single channel to reuse dtags?  I would think the
behaviour of multi-ack would make that impossible anyhow.



From glenn.ergeerts at artesis.be  Fri Jan 29 08:01:11 2010
From: glenn.ergeerts at artesis.be (Ergeerts Glenn)
Date: Fri, 29 Jan 2010 09:01:11 +0100
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
 upgrading server to 1.7.1
In-Reply-To: <4B620E2C.6080804@lshift.net>
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<k5y6ji40j1.fsf@mrbraver.lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEEA2A@ca-win-mbs02.artesis.be>
	<4B620E2C.6080804@lshift.net>
Message-ID: <5429EF528F02C34281C8573452C749431AB4EEEA44@ca-win-mbs02.artesis.be>

This is the output (I re-extracted rabbitmq-server.bat):

C:\Program Files (x86)\RabbitMQ\rabbitmq_server-1.7.1\sbin>set
ALLUSERSPROFILE=C:\ProgramData
APPDATA=C:\Users\glenn\AppData\Roaming
CLASSPATH=.;C:\Program Files (x86)\Java\jre6\lib\ext\QTJava.zip
CommonProgramFiles=C:\Program Files\Common Files
CommonProgramFiles(x86)=C:\Program Files (x86)\Common Files
CommonProgramW6432=C:\Program Files\Common Files
COMPUTERNAME=GLENNVAIO
ComSpec=C:\Windows\system32\cmd.exe
ERLANG_HOME=c:\Program Files (x86)\erl5.6.5\
ERLANG_SERVICE_MANAGER_PATH=c:\Program Files (x86)\erl5.6.5\erts-5.6.5\bin\
FP_NO_HOST_CHECK=NO
HOMEDRIVE=C:
HOMEPATH=\Users\glenn
JAVA_HOME=C:\Program Files\Java\jdk1.6.0_17
JBOSS_HOME=C:\java\jboss-5.1.0.GA
LOCALAPPDATA=C:\Users\glenn\AppData\Local
LOGONSERVER=\\GLENNVAIO
NUMBER_OF_PROCESSORS=2
OS=Windows_NT
Path=C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32
\WindowsPowerShell\v1.0\;C:\Program Files\TortoiseSVN\bin;C:\Program Files\SlikS
vn\bin\;C:\Program Files\java\jre6\bin\;C:\Program Files\MySQL\MySQL Server 5.0\
bin;C:\Program Files (x86)\QuickTime\QTSystem\;c:\MinGW\bin\;C:\Program Files (x
86)\TortoiseSVN\bin
PATHEXT=.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC
PROCESSOR_ARCHITECTURE=AMD64
PROCESSOR_IDENTIFIER=Intel64 Family 6 Model 23 Stepping 6, GenuineIntel
PROCESSOR_LEVEL=6
PROCESSOR_REVISION=1706
ProgramData=C:\ProgramData
ProgramFiles=C:\Program Files
ProgramFiles(x86)=C:\Program Files (x86)
ProgramW6432=C:\Program Files
PROMPT=$P$G
PSModulePath=C:\Windows\system32\WindowsPowerShell\v1.0\Modules\
PUBLIC=C:\Users\Public
QTJAVA=C:\Program Files (x86)\Java\jre6\lib\ext\QTJava.zip
SESSIONNAME=Console
SystemDrive=C:
SystemRoot=C:\Windows
TEMP=C:\Users\glenn\AppData\Local\Temp
TMP=C:\Users\glenn\AppData\Local\Temp
USERDOMAIN=glennvaio
USERNAME=glenn
USERPROFILE=C:\Users\glenn
VBOX_INSTALL_PATH=C:\Program Files\Sun\VirtualBox\
VS90COMNTOOLS=c:\Program Files (x86)\Microsoft Visual Studio 9.0\Common7\Tools\
windir=C:\Windows

C:\Program Files (x86)\RabbitMQ\rabbitmq_server-1.7.1\sbin>rabbitmq-server.bat
\RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at this time.


Regards,
Glenn

-----Oorspronkelijk bericht-----
Van: Matthias Radestock [mailto:matthias at lshift.net]
Verzonden: donderdag 28 januari 2010 23:23
Aan: Ergeerts Glenn
CC: David Wragg; rabbitmq-discuss at lists.rabbitmq.com
Onderwerp: Re: [rabbitmq-discuss] BasicPublish() from .NET client hangs after upgrading server to 1.7.1

Glenn,

Ergeerts Glenn wrote:
> No, i have not installed any plugins, just extracted and ran
> rabbitmq-server.bat

That's strange. To help us track this down, please do the following:

1) revert the rabbitmq-server.bat script to its original version
(ideally by re-extracting the 1.7.1 zip)

2) open a cmd shell, and in that shell
- run 'set' to display all env vars
- run the rabbitmq-server.bat script
If that last step indeed produces the "...unexpected at this time."
error, copy the *entire* shell output from these two steps into an email
and send it to the list.

Thanks.

Matthias.



From matthias at lshift.net  Fri Jan 29 08:07:57 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 29 Jan 2010 08:07:57 +0000
Subject: [rabbitmq-discuss] Repeated acks of a message
In-Reply-To: <84fb38e31001282012v6aee50eax42733095b594deb2@mail.gmail.com>
References: <84fb38e31001281501u2dd78e11vef5b86a803ef0148@mail.gmail.com>	
	<4B621AED.2060202@lshift.net>
	<84fb38e31001282012v6aee50eax42733095b594deb2@mail.gmail.com>
Message-ID: <4B62975D.8070203@lshift.net>

Tsuraan,

tsuraan wrote:
>> Actually, the 0-9-1 spec makes it clear that a client must not ack a
>> message more than once. RabbitMQ, as you observed, currently doesn't
>> care, but that may well change.
> 
> Is that to allow a single channel to reuse dtags?

No. Given that the transport is reliable, there is no good reason for a 
client to issue the same ack more than once. If it does then that 
probably indicates a bug in the client code. So with the restriction in 
place the server can tell the client that it's probably doing something 
wrong.


Regards,

Matthias.



From roland.reumerman at ecosourcing.ph  Fri Jan 29 09:15:54 2010
From: roland.reumerman at ecosourcing.ph (Roland Reumerman)
Date: Fri, 29 Jan 2010 17:15:54 +0800
Subject: [rabbitmq-discuss] problem with rabbitmq-activate-plugins
Message-ID: <390b0ef51001290115v21c6cba6k9b2ed5b565fd3ad@mail.gmail.com>

Hi,
I've followed the instructions on the RabbitMQ website in downloading
rabbitmq-public-umbrella with Mercurial and getting the code there
(including all the plugins) compiled. I created a new plugins
directory in the rabbitmq-server directory and copied all the compiled
.ez files from rabbitmq-smtp there (since that's the plugin I'm
interested in). However, when I run scripts/rabbitmq-activate-plugins
from the rabbitmq-server directory I get the following error:

ERROR: generation of boot script file scripts/../ebin/rabbit.script failed:
Duplicated modules:
	rabbit_writer specified in rabbit and rabbit_common
	rabbit_reader specified in rabbit and rabbit_common
	rabbit_net specified in rabbit and rabbit_common
	rabbit_misc specified in rabbit and rabbit_common
	rabbit_heartbeat specified in rabbit and rabbit_common
	rabbit_framing_channel specified in rabbit and rabbit_common
	rabbit_framing specified in rabbit and rabbit_common
	rabbit_channel specified in rabbit and rabbit_common
	rabbit_binary_parser specified in rabbit and rabbit_common
	rabbit_binary_generator specified in rabbit and rabbit_common
	rabbit_basic specified in rabbit and rabbit_common
	gen_server2 specified in rabbit and rabbit_common

I've googled for this error, but can't find anything relevant that
might help me with this issue. My platform details:

RabbitMQ 1.7.0
Erlang 5.7.2
Ubuntu 9.10 (Karmic Koala)

Any help with this issue is appreciated.
Roland



From pauljones23 at gmail.com  Fri Jan 29 09:23:34 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 29 Jan 2010 09:23:34 +0000
Subject: [rabbitmq-discuss] Bug in java-client's build.xml: maven
	artifacts have wrong names
In-Reply-To: <pan.2010.01.28.21.28.58.757625@googlemail.com>
References: <pan.2010.01.28.21.28.58.757625@googlemail.com>
Message-ID: <29598b611001290123t13c05829l63cc9a8792ca19dd@mail.gmail.com>

Hi Holger,

Thanks for spotting this - I'll raise a bug to get this sorted out.

Cheers,
Paul.

On Thu, Jan 28, 2010 at 9:29 PM, Holger Hoffstaette <
holger.hoffstaette at googlemail.com> wrote:

>
> Hi,
>
> After installing the java-client maven artifacts into my repo manager I
> noticed that sources and docs are not properly attached to the jar in the
> IDE because of a naming mixup. Patch is attached.
>
> cheers
> Holger
>
> --snip--
> --- build.xml   2010-01-22 14:14:24.000000000 +0100
> +++ build-fixed.xml     2010-01-28 22:20:38.000000000 +0100
> @@ -400,10 +400,10 @@
>     <mkdir dir="${bundle.out}"/>
>     <copy file="${lib.out}/rabbitmq-client.jar"
>           tofile="${bundle.out}/amqp-client-${impl.version}.jar"/>
> -    <jar destfile="${bundle.out}/amqp-client-sources-${impl.version}.jar">
> +    <jar destfile="${bundle.out}/amqp-client-${impl.version}-sources.jar">
>         <fileset dir="src"/>
>     </jar>
> -    <jar destfile="${bundle.out}/amqp-client-javadoc-${impl.version}.jar">
> +    <jar destfile="${bundle.out}/amqp-client-${impl.version}-javadoc.jar">
>         <fileset dir="${javadoc.out}"/>
>     </jar>
>     <copy file="pom.xml"
> tofile="${bundle.out}/amqp-client-${impl.version}.pom"/>
> --snip--
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100129/d23414ba/attachment.htm 

From pauljones23 at gmail.com  Fri Jan 29 09:25:16 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 29 Jan 2010 09:25:16 +0000
Subject: [rabbitmq-discuss] problem with rabbitmq-activate-plugins
In-Reply-To: <390b0ef51001290115v21c6cba6k9b2ed5b565fd3ad@mail.gmail.com>
References: <390b0ef51001290115v21c6cba6k9b2ed5b565fd3ad@mail.gmail.com>
Message-ID: <29598b611001290125s1382f0cav765455d331041052@mail.gmail.com>

Hi Roland,

The instructions may be a little lacking in this. rabbit_common is necessary
for compilation and deployment outside of Rabbit. It does, however, include
a bunch of code otherwise included in the server itself. Removing
rabbit_common.ez from the plugins directory should resolve your problem.

Cheers,
Paul.

On Fri, Jan 29, 2010 at 9:15 AM, Roland Reumerman <
roland.reumerman at ecosourcing.ph> wrote:

> Hi,
> I've followed the instructions on the RabbitMQ website in downloading
> rabbitmq-public-umbrella with Mercurial and getting the code there
> (including all the plugins) compiled. I created a new plugins
> directory in the rabbitmq-server directory and copied all the compiled
> .ez files from rabbitmq-smtp there (since that's the plugin I'm
> interested in). However, when I run scripts/rabbitmq-activate-plugins
> from the rabbitmq-server directory I get the following error:
>
> ERROR: generation of boot script file scripts/../ebin/rabbit.script failed:
> Duplicated modules:
>        rabbit_writer specified in rabbit and rabbit_common
>        rabbit_reader specified in rabbit and rabbit_common
>        rabbit_net specified in rabbit and rabbit_common
>        rabbit_misc specified in rabbit and rabbit_common
>        rabbit_heartbeat specified in rabbit and rabbit_common
>        rabbit_framing_channel specified in rabbit and rabbit_common
>        rabbit_framing specified in rabbit and rabbit_common
>        rabbit_channel specified in rabbit and rabbit_common
>        rabbit_binary_parser specified in rabbit and rabbit_common
>        rabbit_binary_generator specified in rabbit and rabbit_common
>        rabbit_basic specified in rabbit and rabbit_common
>        gen_server2 specified in rabbit and rabbit_common
>
> I've googled for this error, but can't find anything relevant that
> might help me with this issue. My platform details:
>
> RabbitMQ 1.7.0
> Erlang 5.7.2
> Ubuntu 9.10 (Karmic Koala)
>
> Any help with this issue is appreciated.
> Roland
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100129/8cee1bed/attachment.htm 

From techabc at gmail.com  Fri Jan 29 09:32:10 2010
From: techabc at gmail.com (techabc)
Date: Fri, 29 Jan 2010 17:32:10 +0800
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++ 2005?
Message-ID: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>

Hi all,
Can rabbitmq-c be compiled use microsoft vc8, and how?
My application developed with vc++, so I want it.



From matthew at lshift.net  Fri Jan 29 10:42:24 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 29 Jan 2010 10:42:24 +0000
Subject: [rabbitmq-discuss] How to compile rabbitmq-c with visual c++
 2005?
In-Reply-To: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>
References: <acc7b4fd1001290132lf8da14bledf7ab27cc1869a4@mail.gmail.com>
Message-ID: <20100129104223.GB11306@wellquite.org>

On Fri, Jan 29, 2010 at 05:32:10PM +0800, techabc wrote:
> Can rabbitmq-c be compiled use microsoft vc8, and how?
> My application developed with vc++, so I want it.

It's unlikely. Rabbitmq-c is in a highly experimental state and I
believe it contains some features of C that are specific to gcc.

Yesterday someone else reported on this list that they managed to get
Rabbitmq-c to compile under Windows, but it took them two weeks of
effort. You might like to liaise with them to share the necessary
details.

This was mentioned near the bottom of
http://old.nabble.com/Re:-error-message-trying-to-start-stomp-adapter--p27359704.html

Matthew



From matthew at lshift.net  Fri Jan 29 10:46:39 2010
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 29 Jan 2010 10:46:39 +0000
Subject: [rabbitmq-discuss] Which Erlang client version to use with the
 1.7.1 server?
In-Reply-To: <ac6faba21001280944k2bd40e9fp5f77c642b3002d54@mail.gmail.com>
References: <ac6faba21001280944k2bd40e9fp5f77c642b3002d54@mail.gmail.com>
Message-ID: <20100129104639.GC11306@wellquite.org>

On Thu, Jan 28, 2010 at 09:44:30AM -0800, Greg Campbell wrote:
> Should I use the 1_7_0 tag (which is what I've been using against server
> version 1.7.0 previously), or will the "tip" work better with 1.7.1?

The 1_7_0 tag was created when the head of the default branch of the
erlang client *stopped* working with 1.7.0 - thus it was saying "this
is the last known version that works with 1.7.0 before the APIs and
shared code diverged".

Given that API divergences are usually symmetric, I'd expect the 1_7_0
Erlang client won't work with 1.7.1 server, though I may be wrong.
Certainly I'm using the head of the default branch of the Erlang client
all the time just at the moment, so I would recommend you use that too.

Again, once the APIs change to the extent that head of default erlang
client stop working with the 1.7.1 server, we'll tag the last good 
version with 1_7_1.

Matthew



From matthias at lshift.net  Fri Jan 29 10:57:16 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 29 Jan 2010 10:57:16 +0000
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>	<20100128122215.GD4613@wellquite.org>
	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>
Message-ID: <4B62BF0C.8000001@lshift.net>

Erik,

Erik Anderson wrote:
> For what it's worth, it looks on the surface in {invalid_host,
> [49,50,55,46,48,46,48,46,49],timeout} that the numbers are the ascii
> representation of "127.0.0.1".  Along with a new delay that feels like
> a timeout when launching the normal TCP listeners, was some of the
> "short node" stuff done in the last version affecting this?

The "short node" changes in the last release relate to Erlang's 
inter-node communication. They do not affect ordinary network 
operations, so that's not the source of the problem.

>> is by far the easiest way to configure plugins like this as it avoids
>> nasty escaping issues if passing by env vars.
> 
> I haven't quite found the location of this file yet, and would like to
> (if possible) move it to a more usable location (once I find it).

The config file location is %APPDATA%\RabbitMQ\rabbitmq.config. See 
http://www.rabbitmq.com/install.html#configfile, which also documents 
how to change its location.

> I must admit though that (not trying to strike back at an obvious
> hardworking bunch here) from rabbitmq to orbited getting a comet
> server has been almost like pulling teeth in from the perspective of
> someone just trying to get a simple solution running.  It took me
> almost two weeks trying to get rabbitmq-c compiled and running the
> wiretest example under MSVC for instance.

rabbitmq-c is highly experimental - so experimental in fact that it's 
not even mentioned in our "Experimental Downloads" section on the web 
site. We have not spent any effort on trying to make it build on 
Windows. So I am not surprised it took a while to get working.

We welcome patches, and feedback in general. If you have managed to 
build rabbitmq-c on Windows, could you perhaps post the instructions?


Regards,

Matthias.



From tsuraan at gmail.com  Fri Jan 29 15:51:13 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 29 Jan 2010 09:51:13 -0600
Subject: [rabbitmq-discuss] Repeated acks of a message
In-Reply-To: <4B62975D.8070203@lshift.net>
References: <84fb38e31001281501u2dd78e11vef5b86a803ef0148@mail.gmail.com>
	<4B621AED.2060202@lshift.net>
	<84fb38e31001282012v6aee50eax42733095b594deb2@mail.gmail.com>
	<4B62975D.8070203@lshift.net>
Message-ID: <84fb38e31001290751g4e2b09f4o20bed09a7590f94@mail.gmail.com>

> No. Given that the transport is reliable, there is no good reason for a
> client to issue the same ack more than once. If it does then that
> probably indicates a bug in the client code. So with the restriction in
> place the server can tell the client that it's probably doing something
> wrong.

Well, maybe it's a little wrong :)  The messages in my system are
handled asynchronously, and once the work associated with some number
of messages is done, I want to ack them.  I can't use the rabbit
channel from the thread that does the processing, so I have a
workaround that has a possiblity of multiple acks on the same tag.
I'm guessing I can come up with a cleaner solution though.  I suppose
maybe the cleanest way to handle this would be to wrap
QueueingConsumer in a class that mantains a list of dtags that need
acking, so whenever the consumer gets a message (or times out) it acks
the messages at once.  I think I'll do it that way; it seems a lot
cleaner that what I'm doing now.



From david.wragg at lshift.net  Fri Jan 29 18:51:46 2010
From: david.wragg at lshift.net (David Wragg)
Date: Fri, 29 Jan 2010 18:51:46 +0000
Subject: [rabbitmq-discuss] BasicPublish() from .NET client hangs after
	upgrading server to 1.7.1
In-Reply-To: <5429EF528F02C34281C8573452C749431AB4EEEA44@ca-win-mbs02.artesis.be>
	(Ergeerts Glenn's message of "Fri\, 29 Jan 2010 09\:01\:11 +0100")
References: <27335731.post@talk.nabble.com> <4B6177AB.2030001@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEE975@ca-win-mbs02.artesis.be>
	<k5y6ji40j1.fsf@mrbraver.lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEEA2A@ca-win-mbs02.artesis.be>
	<4B620E2C.6080804@lshift.net>
	<5429EF528F02C34281C8573452C749431AB4EEEA44@ca-win-mbs02.artesis.be>
Message-ID: <k5iqak4ud9.fsf@mrbraver.lshift.net>

Hi Glenn,

Ergeerts Glenn <glenn.ergeerts at artesis.be> writes:
> C:\Program Files (x86)\RabbitMQ\rabbitmq_server-1.7.1\sbin>rabbitmq-server.bat
> \RabbitMQ\rabbitmq_server-1.7.1\sbin\..\ebin\rabbit was unexpected at this time.

It turns out that installing rabbitmq-server under a path containing
parentheses exposes some bugs in our batch files.  We can reproduce
this problem, and are investigating how to fix it.

As a workaround, you can install under "C:\Program Files\" instead.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From erikba at odysseus.anderson.name  Sat Jan 30 00:40:05 2010
From: erikba at odysseus.anderson.name (Erik Anderson)
Date: Fri, 29 Jan 2010 16:40:05 -0800 (PST)
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <4B62BF0C.8000001@lshift.net>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>
	<20100128122215.GD4613@wellquite.org>
	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>
	<4B62BF0C.8000001@lshift.net>
Message-ID: <3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>



On Jan 29, 2:57?am, Matthias Radestock <matth... at lshift.net> wrote:
> Erik,
>
> Erik Anderson wrote:
> > For what it's worth, it looks on the surface in {invalid_host,
> > [49,50,55,46,48,46,48,46,49],timeout} that the numbers are the ascii
> > representation of "127.0.0.1". ?Along with a new delay that feels like
> > a timeout when launching the normal TCP listeners, was some of the
> > "short node" stuff done in the last version affecting this?
>
> The "short node" changes in the last release relate to Erlang's
> inter-node communication. They do not affect ordinary network
> operations, so that's not the source of the problem.

Okay, this is really starting to get frustrating.  Googling this error
gives me the strong impression that the timeout here is a DNS timeout,
but I have no clue how to get our DNS servers to respond to something
like 127.0.0.1.  I tried changing it to "::1" but it just moved the
error up to when starting up TCP Listeners instead.  It also said that
I should be giving 127.0.0.1 in "tuple form", but i'm not sure what
that means at the moment.

I replaced Erlang v5.6.5 R12B-5 (as included in the official
installation) with v5.7.3 R13B02-1 (what the server that works is
using) with no effect.  I copied the rabbitmq_server.1.7.0 folder
(with the installed plugin) from the server that works with no
effect.  Same with wiping the database folder.

ProcessExplorer trace shows no registry or file activity during the
"timeouts", the next action after the first one is a load of
stomp.beam, the action after the second is a write to the log file.
The only attempt to access %APPDATA% is to write a file
named .erlang.cookie - no other file or folder existence check is
made.

Modifying the stomp_listener line to change the ip address to 0.0.0.0
or scramble to a dummy port has no effect (is this thing hardcoded to
{"127.0.0.1",61613} or something?)

The fact that this is working on the testbed but is throwing a tantrum
on the server it might actually have value on means that it's an
environmental fault of some kind, either a file I haven't found or a
different server setup that is causing confusion.

Maybe I'll try to get this working sometime next week - I'm running
out of ideas.  I don't have anything on me that I can see to intercept
WINSOCK calls either.

Any suggestions on where to go from here?  Dumping my 1.7.1 startup
trace here...

> We welcome patches, and feedback in general. If you have managed to
> build rabbitmq-c on Windows, could you perhaps post the instructions?

Unfortunately, If it hadn't taken two weeks of my boss's time to try
to get it working I think I would be more amenable to sneaking
something like that out.  As it is I'd like to have something to show
first before dealing with that.  I can bellyache some more about the
kinds of changes I needed to make, but I'm not sure how constructive
that would be.

---

Using Custom Boot File "C:\tw\comet\rabbitmq_server-1.7.1\sbin\..\ebin
\rabbit.boot"

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at D3Z2VPD1
app descriptor: c:/tw/comet/rabbitmq_server-1.7.1/sbin/../ebin/
rabbit.app
home dir      : C:\Documents and Settings\EAnderson.TEAMWORK
cookie hash   : hiMbehi/N72av8n8XzaPNg==
log           : c:/tw/comet/rabbitmq-data/log/rabbit.log
sasl log      : c:/tw/comet/rabbitmq-data/log/rabbit-sasl.log
database dir  : c:/tw/comet/rabbitmq-data/db/rabbit-mnesia

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running
starting STOMP Adapter (binding to [{"127.0.0.1",61613}])  ...{"Kernel
pid
terminated",application_controller,"{application_start_failure,rabbit_stomp,
{{invalid_host,[49,50,55,46,48,46,48,46,49],timeout},
{rabbit_stomp,start,[normal,[]]}}}"}


Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit_stomp,{{invalid_host,
[49,50,55,46,48,46,48,46,49],timeout},{rabbit_stomp,start,[normal,
[]]}}})



From roland.reumerman at ecosourcing.ph  Sat Jan 30 02:32:58 2010
From: roland.reumerman at ecosourcing.ph (Roland Reumerman)
Date: Sat, 30 Jan 2010 10:32:58 +0800
Subject: [rabbitmq-discuss] problem with rabbitmq-activate-plugins
In-Reply-To: <29598b611001290125s1382f0cav765455d331041052@mail.gmail.com>
References: <390b0ef51001290115v21c6cba6k9b2ed5b565fd3ad@mail.gmail.com>
	<29598b611001290125s1382f0cav765455d331041052@mail.gmail.com>
Message-ID: <390b0ef51001291832g5f9cd63fpb041d491b44e0ba6@mail.gmail.com>

Hi Paul,
Thanks for the instruction, everything compiles now. I was looking for
documentation on how to use the rabbitmq-stmp plugin, but (besides
from the source code) can't find any.



From pauljones23 at gmail.com  Sat Jan 30 09:26:12 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Sat, 30 Jan 2010 09:26:12 +0000
Subject: [rabbitmq-discuss] problem with rabbitmq-activate-plugins
In-Reply-To: <390b0ef51001291832g5f9cd63fpb041d491b44e0ba6@mail.gmail.com>
References: <390b0ef51001290115v21c6cba6k9b2ed5b565fd3ad@mail.gmail.com>
	<29598b611001290125s1382f0cav765455d331041052@mail.gmail.com>
	<390b0ef51001291832g5f9cd63fpb041d491b44e0ba6@mail.gmail.com>
Message-ID: <29598b611001300126m17d0489aid586dff4a77878b@mail.gmail.com>

Hi,

Unfortunately, that plugin is quite experimental, so the documentation is a
bit absent.

Paul.

On Sat, Jan 30, 2010 at 2:32 AM, Roland Reumerman <
roland.reumerman at ecosourcing.ph> wrote:

> Hi Paul,
> Thanks for the instruction, everything compiles now. I was looking for
> documentation on how to use the rabbitmq-stmp plugin, but (besides
> from the source code) can't find any.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100130/5c907ac7/attachment.htm 

From matthias at lshift.net  Sat Jan 30 14:39:48 2010
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 30 Jan 2010 14:39:48 +0000
Subject: [rabbitmq-discuss] error message trying to start stomp adapter?
In-Reply-To: <3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>
References: <29602010-57cb-42d5-9090-764c5019a996@a12g2000yqj.googlegroups.com>	<20100128122215.GD4613@wellquite.org>	<6345969b-dc00-4033-a382-95163a8c670d@y7g2000prc.googlegroups.com>	<4B62BF0C.8000001@lshift.net>
	<3659a39d-2105-4deb-a9c7-669292555e2a@t31g2000prh.googlegroups.com>
Message-ID: <4B6444B4.3020001@lshift.net>

Erik,

Erik Anderson wrote:
> ProcessExplorer trace shows no registry or file activity during the
> "timeouts", the next action after the first one is a load of
> stomp.beam, the action after the second is a write to the log file.
> The only attempt to access %APPDATA% is to write a file
> named .erlang.cookie - no other file or folder existence check is
> made.
> 
> Modifying the stomp_listener line to change the ip address to 0.0.0.0
> or scramble to a dummy port has no effect (is this thing hardcoded to
> {"127.0.0.1",61613} or something?)

Where are you modifying that line? In the rabbitmq.config? If so then 
from ...

> log           : c:/tw/comet/rabbitmq-data/log/rabbit.log
> sasl log      : c:/tw/comet/rabbitmq-data/log/rabbit-sasl.log
> database dir  : c:/tw/comet/rabbitmq-data/db/rabbit-mnesia

...it looks like you have changed the setting of %RABBITMQ_BASE% to 
C:\tw\comet\rabbitmq-data. In that case the rabbitmq.config file needs 
to go into that dir. If that still makes no difference, I suggest you 
add some debug output to the rabbitmq-server.bat script to display the 
value of %RABBITMQ_CONFIG_FILE% around line 120. That will tell you for 
certain where rabbit is looking for it (minus the .config extension).


Regards,

Matthias.



From vbalandin at griddynamics.com  Sat Jan 30 17:24:35 2010
From: vbalandin at griddynamics.com (Vladimir Balandin)
Date: Sat, 30 Jan 2010 20:24:35 +0300
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
	connection on high-latency networks
Message-ID: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>

We are using single connection as recommended in RabbitMQ FAQ. It is work
fine in LAN but we have problems with WAN and high latency. RabbitMQ client
send packets (packet size is 64 kB) too slow. We have installed RabbitMQ at
remote server with ping from RabbitMQ client about 150-200 ms. Each
basicPublish call require about 3 seconds to complete. So we have a
throughput is about 20 kB/s. Increasing channel numbers does not affect
performance. If we use two or more connections performance is increase
linear, but it is not acceptable for us. We are unable to use so many
connections that required to arrive full bandwidth usage. Is it possible to
increase throughput using a single TCP connection?

-- 
Vladimir Balandin
Grid Dynamics
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100130/fe38bd49/attachment.htm 

From holger.hoffstaette at googlemail.com  Sat Jan 30 21:38:58 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Sat, 30 Jan 2010 22:38:58 +0100
Subject: [rabbitmq-discuss] Poor performance using a single RabbitMQ
	connection on high-latency networks
References: <d00202081001300924l63fde12bx9763289e12b7794c@mail.gmail.com>
Message-ID: <pan.2010.01.30.21.38.58.153375@googlemail.com>

On Sat, 30 Jan 2010 20:24:35 +0300, Vladimir Balandin wrote:

> We are using single connection as recommended in RabbitMQ FAQ. It is work
> fine in LAN but we have problems with WAN and high latency. RabbitMQ
> client send packets (packet size is 64 kB) too slow. We have installed
> RabbitMQ at remote server with ping from RabbitMQ client about 150-200 ms.
> Each basicPublish call require about 3 seconds to complete. So we have a
> throughput is about 20 kB/s. Increasing channel numbers does not affect
> performance. If we use two or more connections performance is increase
> linear, but it is not acceptable for us. We are unable to use so many
> connections that required to arrive full bandwidth usage. Is it possible
> to increase throughput using a single TCP connection?

Multiple connections are one way to help here; keep them in mind as an
option even if you don't want to open the full number of connections to
saturate your bandwidth.

Another thing to try is to increase the TCP send/receive buffers (and
therefore the negotiated TCP transmit windows) on the client.
Depending on the client's OS the default values of the TCP stack may or
may not be way too small for a connection with high latency. For example
they are outright pitiful on Windows XP.

An appropriate place would be to override (using the Java client as
example here) ConnectionFactory.configureSocket() and add the necessary
bits like setSend/ReceiveBufferSize etc. Usual values to try first are in
the range from 64k to 256k.

This should help. The behaviour with multiple channels will likely also be
improved. Changing the send/receive buffers on the broker side should not
be necessary, as the buffers are negotiated by the client.

Holger





